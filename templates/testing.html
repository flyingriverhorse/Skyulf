<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive EDA Notebook</title>
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
  /* ------------------------
     GENERAL LAYOUT STYLING
  ------------------------- */
  body {
    background: #f6f9fc;
    font-family: "Inter", "Segoe UI", sans-serif;
  }

  .card {
    border-radius: 1rem;
    transition: transform 0.15s ease, box-shadow 0.2s ease;
  }
  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.07) !important;
  }

  .card-header {
    border-radius: 1rem 1rem 0 0 !important;
    font-weight: 600;
  }

  .bg-gradient-info {
    background: linear-gradient(135deg, #17a2b8, #138496);
  }
  .bg-gradient-secondary {
    background: linear-gradient(135deg, #6c757d, #495057);
  }
  .bg-gradient-success {
    background: linear-gradient(135deg, #28a745, #218838);
  }

  /* ------------------------
     COLUMN INSIGHTS
  ------------------------- */
  .column-item {
    transition: background 0.2s, transform 0.15s;
    cursor: pointer;
  }
  .column-item:hover {
    background: #f1faff;
    transform: scale(1.01);
  }
  .column-item input[type=checkbox]:checked + label strong {
    color: #28a745;
  }

  /* ------------------------
     ASSISTANT PANEL
  ------------------------- */
  .suggestion-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .suggestion-chip {
    border: none;
    border-radius: 2rem;
    padding: 0.4rem 0.9rem;
    background: #f1f3f5;
    font-size: 0.85rem;
    cursor: pointer;
    transition: background 0.2s, transform 0.15s;
  }
  .suggestion-chip:hover {
    background: #e0f7fa;
    transform: translateY(-2px);
  }
  .suggestion-chip.active {
    background: #17a2b8;
    color: white;
  }

  /* ------------------------
     ANALYSIS GRID
  ------------------------- */
  .analysis-options-compact {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
    gap: 0.75rem;
  }
  .analysis-option {
    border: 1px solid #e9ecef;
    border-radius: 0.75rem;
    padding: 1rem 0.5rem;
    text-align: center;
    cursor: pointer;
    transition: background 0.2s, transform 0.15s;
  }
  .analysis-option:hover {
    background: #f8f9fa;
    transform: translateY(-3px);
  }
  .analysis-option.active {
    background: #28a745;
    color: white;
  }

  /* ------------------------
     NOTEBOOK CELLS
  ------------------------- */
  .notebook-cell {
    border: 1px solid #dee2e6;
    border-radius: 1rem;
    margin-bottom: 1rem;
    overflow: hidden;
    background: white;
    box-shadow: 0 3px 6px rgba(0,0,0,0.05);
  }
  .cell-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
    padding: 0.75rem 1rem;
  }
  .cell-type-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
  }
  .cell-actions button {
    margin-left: 0.25rem;
    transition: transform 0.15s;
  }
  .cell-actions button:hover {
    transform: scale(1.1);
  }
  .cell-content {
    padding: 1rem;
  }
  .code-section {
    margin-bottom: 1rem;
  }
  .code-header {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #495057;
  }
  .code-content {
    background: #212529;
    color: #f8f9fa;
    padding: 0.75rem;
    border-radius: 0.5rem;
    font-family: "Fira Code", monospace;
    font-size: 0.85rem;
  }
  .cell-output {
    border-top: 1px solid #dee2e6;
    padding-top: 0.75rem;
  }
  .output-area {
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ------------------------
     MODAL METRICS
  ------------------------- */
  .quality-metric-card {
    border-radius: 1rem;
    background: #f8f9fa;
    padding: 1rem;
    text-align: center;
    transition: transform 0.15s, background 0.2s;
  }
  .quality-metric-card:hover {
    background: #e9f7f9;
    transform: translateY(-4px);
  }
  .quality-metric-header {
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
  .quality-metric-score {
    font-size: 1.5rem;
    font-weight: 700;
  }
  </style>
</head>
<body>

<div class="container-fluid py-4">
  <!doctype html>
  <html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Interactive EDA Notebook</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
      /* Small, contained styles for notebook UI */
      .notebook-container { padding: 18px; }
      .column-item { cursor: pointer; }
      .analysis-option { display:inline-block; width:96px; text-align:center; padding:8px; margin:6px; border-radius:8px; background:#f8f9fa; cursor:pointer; }
      .analysis-option.active { outline:3px solid #0d6efd; background:#e7f0ff; }
      .notebook-cell { border:1px solid #e9ecef; border-radius:6px; margin-bottom:12px; background:#fff; }
      .cell-header { padding:8px 12px; border-bottom:1px solid #f1f3f5; display:flex; justify-content:space-between; align-items:center; }
      .cell-content { padding:12px; }
      .assistant-panel .suggestion-chip { margin-right:6px; margin-bottom:6px; }
      .code-content pre { background:#0f1720; color:#d1d5db; padding:10px; border-radius:6px; overflow:auto; }
    </style>
  </head>
  <body>

  <div class="notebook-container">
    <div class="row mb-4">
      
      <!-- Left Sidebar -->
      <div class="col-lg-3">         
        <!-- Column Insights -->
        <div class="card shadow-sm">
          <div class="card-header bg-gradient-info text-white py-2">
            <h6 class="mb-0">
              <i class="bi bi-list-columns"></i> Column Insights
              <button class="btn btn-sm btn-outline-light ms-2 float-end" onclick="refreshColumnInsights()" title="Refresh column data">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
            </h6>
          </div>
          <div class="card-body py-2" style="max-height: 400px; overflow-y: auto;">
            <!-- Summary Stats -->
            <div class="mb-3 p-2 bg-light rounded">
              <div class="row text-center">
                <div class="col-4">
                  <small class="text-muted d-block">Total</small>
                  <strong id="totalColumns">12</strong>
                </div>
                <div class="col-4">
                  <small class="text-muted d-block">Selected</small>
                  <strong class="text-success" id="selectedColumns">8</strong>
                </div>
                <div class="col-4">
                  <small class="text-muted d-block">Issues</small>
                  <strong class="text-warning" id="problematicColumns">2</strong>
                </div>
              </div>
            </div>
            
            <!-- Column Items -->
            <div id="columnItems">
              <div class="column-item border p-2 mb-2 rounded">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" checked id="col1">
                  <label class="form-check-label w-100" for="col1">
                    <div class="d-flex justify-content-between align-items-start">
                      <div>
                        <strong>age</strong>
                        <small class="text-muted d-block">int64 • 1000 values</small>
                      </div>
                      <i class="bi bi-check-circle text-success"></i>
                    </div>
                  </label>
                </div>
              </div>
              <div class="column-item border border-warning p-2 mb-2 rounded">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="col2">
                  <label class="form-check-label w-100" for="col2">
                    <div class="d-flex justify-content-between align-items-start">
                      <div>
                        <strong>income</strong>
                        <small class="text-warning d-block">float64 • 34% missing</small>
                      </div>
                      <i class="bi bi-exclamation-triangle text-warning"></i>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Simple UI state helpers
      function refreshColumnInsights() {
        // Placeholder: in real app would fetch updated column info
        const total = document.querySelectorAll('#columnItems .column-item').length;
        const selected = document.querySelectorAll('#columnItems .column-item input:checked').length;
        const problematic = document.querySelectorAll('#columnItems .column-item.border-warning').length;
        document.getElementById('totalColumns').innerText = total;
        document.getElementById('selectedColumns').innerText = selected;
        document.getElementById('problematicColumns').innerText = problematic;
      }

      function applySuggestion(key) {
        // Toggle a suggestion into selected analyses (visual feedback only)
        alert('Applied suggestion: ' + key);
      }

      function processAssistantQuery() {
        const q = document.getElementById('assistantQuery').value.trim();
        if (!q) { alert('Please enter a question for the assistant.'); return; }
        // Minimal placeholder: in real app, call backend assistant
        alert('Assistant query received: "' + q + '" (stub)');
      }

      function loadTemplate(name) {
        alert('Load template: ' + name);
      }

      function addAnalysisCell() {
        const cells = document.getElementById('notebookCells');
        const cell = document.createElement('div');
        cell.className = 'notebook-cell';
        cell.innerHTML = `
          <div class="cell-header">
            <div class="cell-type-indicator analysis-cell"><i class="bi bi-bar-chart-fill"></i> <span>New Analysis</span></div>
            <div class="cell-actions">
              <button class="btn btn-sm btn-outline-primary" onclick="runCell(this)"><i class="bi bi-play-fill"></i></button>
              <button class="btn btn-sm btn-outline-secondary" onclick="editCell(this)"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteCell(this)"><i class="bi bi-trash"></i></button>
            </div>
          </div>
          <div class="cell-content">
            <div class="code-section">
              <div class="code-header"><i class="bi bi-code"></i> Generated Code</div>
              <div class="code-content"><pre><code># New analysis - no code yet</code></pre></div>
            </div>
            <div class="cell-output"><div class="output-area">No output</div></div>
          </div>`;
        cells.prepend(cell);
        refreshColumnInsights();
      }

      function runCell(btn) {
        const cell = btn.closest('.notebook-cell');
        const output = cell.querySelector('.output-area');
        output.innerHTML = '<div class="p-3">Running... (stub)</div>';
        setTimeout(()=> { output.innerHTML = '<div class="p-3 text-success">Done (stub)</div>'; }, 700);
      }

      function editCell(btn) {
        const cell = btn.closest('.notebook-cell');
        const code = cell.querySelector('.code-content code');
        const current = code.innerText;
        const newCode = prompt('Edit code for this cell', current);
        if (newCode !== null) code.innerText = newCode;
      }

      function deleteCell(btn) {
        if (!confirm('Delete this cell?')) return;
        const cell = btn.closest('.notebook-cell');
        cell.remove();
        refreshColumnInsights();
      }

      // Toggle analysis option active state
      document.addEventListener('click', function(e){
        const opt = e.target.closest('.analysis-option');
        if (!opt) return;
        opt.classList.toggle('active');
      });

      // Initialize counts
      document.addEventListener('DOMContentLoaded', refreshColumnInsights);
    </script>

    </body>
    </html>
        </div>
      </div>
      <!-- Main Content -->
      <div class="col-lg-9">
        <!-- Analysis Types -->
        <div class="card shadow-sm">
          <div class="card-header bg-gradient-success text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0"><i class="bi bi-gear-fill"></i> Analysis Types</h6>
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                  <i class="bi bi-collection"></i> Templates
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="#" onclick="loadTemplate('basic_eda')">Basic EDA</a></li>
                  <li><a class="dropdown-item" href="#" onclick="loadTemplate('ml_prep')">ML Preprocessing</a></li>
                  <li><a class="dropdown-item" href="#" onclick="loadTemplate('business_analysis')">Business Analysis</a></li>
                  <li><a class="dropdown-item" href="#" onclick="loadTemplate('data_quality')">Data Quality Check</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="analysis-grid mb-3" id="analysisGrid">
              <div class="analysis-options-compact">
                <div class="analysis-option" data-value="basic_stats" data-name="Basic Statistics">
                  <i class="bi bi-bar-chart-fill"></i>
                  <span>Statistics</span>
                </div>
                <div class="analysis-option" data-value="missing_data_analysis" data-name="Missing Values">
                  <i class="bi bi-question-diamond-fill"></i>
                  <span>Missing</span>
                </div>
                <div class="analysis-option" data-value="correlation_analysis" data-name="Correlation Analysis">
                  <i class="bi bi-diagram-3-fill"></i>
                  <span>Correlation</span>
                </div>
                <div class="analysis-option" data-value="distribution_analysis" data-name="Distribution Analysis">
                  <i class="bi bi-graph-up-arrow"></i>
                  <span>Distribution</span>
                </div>
                <div class="analysis-option" data-value="outlier_detection" data-name="Outlier Detection">
                  <i class="bi bi-exclamation-triangle-fill"></i>
                  <span>Outliers</span>
                </div>
                <div class="analysis-option" data-value="feature_importance" data-name="Feature Importance">
                  <i class="bi bi-trophy-fill"></i>
                  <span>Importance</span>
                </div>
                <div class="analysis-option" data-value="time_series" data-name="Time Series">
                  <i class="bi bi-clock-history"></i>
                  <span>Time Series</span>
                </div>
                <div class="analysis-option" data-value="text_analysis" data-name="Text Analysis">
                  <i class="bi bi-chat-square-text"></i>
                  <span>Text</span>
                </div>
                <div class="analysis-option" data-value="clustering" data-name="Clustering">
                  <i class="bi bi-circle-square"></i>
                  <span>Clustering</span>
                </div>
                <div class="analysis-option" data-value="anomaly_detection" data-name="Anomaly Detection">
                  <i class="bi bi-search"></i>
                  <span>Anomalies</span>
                </div>
                <div class="analysis-option" data-value="data_profiling" data-name="Data Profiling">
                  <i class="bi bi-clipboard-data"></i>
                  <span>Profiling</span>
                </div>
                <div class="analysis-option" data-value="custom_code" data-name="Custom Code">
                  <i class="bi bi-code-slash"></i>
                  <span>Custom</span>
                </div>
              </div>
            </div>
            
            <button class="btn btn-success w-100" id="addCellBtn" onclick="addAnalysisCell()">
              <i class="bi bi-plus-circle"></i> Add Analysis Cell
            </button>
          </div>
        </div>

        <!-- Notebook Cells -->
        <div class="row mt-3">
          <div class="col-12">
            <div class="notebook-cells" id="notebookCells">
              <!-- Sample cell -->
              <div class="notebook-cell">
                <div class="cell-header">
                  <div class="cell-type-indicator analysis-cell">
                    <i class="bi bi-bar-chart-fill"></i>
                    <span>Basic Statistics</span>
                  </div>
                  <div class="cell-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="runCell(this)">
                      <i class="bi bi-play-fill"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="editCell(this)">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteCell(this)">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </div>
                <div class="cell-content">
                  <div class="code-section">
                    <div class="code-header">
                      <i class="bi bi-code"></i> Generated Code
                    </div>
                    <div class="code-content">
                      <pre><code>df.describe(include='all').transpose()</code></pre>
                    </div>
                  </div>
                  <div class="cell-output">
                    <div class="output-area">
                      <div class="dataframe-container">
                        <div class="table-responsive">
                          <table class="table table-sm table-striped">
                            <thead>
                              <tr>
                                <th>Column</th>
                                <th>Count</th>
                                <th>Mean</th>
                                <th>Std</th>
                                <th>Min</th>
                                <th>Max</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>age</td>
                                <td>1000</td>
                                <td>34.5</td>
                                <td>12.3</td>
                                <td>18</td>
                                <td>65</td>
                              </tr>
                              <tr>
                                <td>income</td>
                                <td>660</td>
                                <td>55,000</td>
                                <td>15,000</td>
                                <td>25,000</td>
                                <td>120,000</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div><!-- end notebook cell -->
            </div>
          </div>
        </div>
      </div><!-- col-lg-9 -->
    </div><!-- row -->
  </div>
</div>

<!-- Data Quality Modal -->
<div class="modal fade" id="qualityDetailsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Column Insights Refresh
        function refreshColumnInsights() {
            const btn = event.currentTarget;
            btn.classList.add("spin");
            setTimeout(() => {
                btn.classList.remove("spin");
                alert("Column insights refreshed!");
            }, 1000);
        }

        // Assistant Suggestions
        function applySuggestion(type) {
            let queryBox = document.getElementById("assistantQuery");
            if (type === "correlation_heatmap") {
                queryBox.value = "Show correlation heatmap of numerical variables";
            } else if (type === "missing_pattern") {
                queryBox.value = "Analyze missing data pattern across columns";
            } else if (type === "outlier_analysis") {
                queryBox.value = "Perform outlier analysis on all numerical features";
            } else if (type === "distribution_grid") {
                queryBox.value = "Display distribution plots for all features";
            }
            processAssistantQuery();
        }

        function processAssistantQuery() {
            const query = document.getElementById("assistantQuery").value;
            if (!query.trim()) return;
            addNotebookCell("Custom Query", query, "# Custom analysis code based on query");
        }

        // Add Notebook Cell
        function addAnalysisCell() {
            const selectedOption = document.querySelector(".analysis-option.selected");
            if (!selectedOption) {
                alert("Please select an analysis type first!");
                return;
            }
            const name = selectedOption.getAttribute("data-name");
            const value = selectedOption.getAttribute("data-value");
            let code = generateCodeSnippet(value);
            addNotebookCell(name, value, code);
        }

        function generateCodeSnippet(type) {
            switch(type) {
                case "basic_stats": return "df.describe(include='all').transpose()";
                case "missing_data_analysis": return "df.isnull().sum().sort_values(ascending=False)";
                case "correlation_analysis": return "sns.heatmap(df.corr(), annot=True, cmap='coolwarm')";
                case "distribution_analysis": return "df.hist(figsize=(12,8))";
                case "outlier_detection": return "sns.boxplot(data=df)";
                case "feature_importance": return "# Fit ML model to extract feature importances";
                case "time_series": return "df.plot(x='date', y='value')";
                case "text_analysis": return "# Perform text preprocessing and word cloud";
                case "clustering": return "# Apply KMeans clustering and visualize results";
                case "anomaly_detection": return "# Run Isolation Forest for anomaly detection";
                case "data_profiling": return "import pandas_profiling; df.profile_report()";
                case "custom_code": return "# Write your custom analysis code here";
                default: return "# Analysis code here";
            }
        }

        // Create Notebook Cell
        function addNotebookCell(name, value, code) {
            const container = document.getElementById("notebookCells");
            const cell = document.createElement("div");
            cell.className = "notebook-cell";
            cell.innerHTML = `
                <div class="cell-header">
                    <div class="cell-type-indicator analysis-cell">
                        <i class="bi bi-bar-chart-fill"></i>
                        <span>${name}</span>
                    </div>
                    <div class="cell-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="runCell(this)">
                            <i class="bi bi-play-fill"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="editCell(this)">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCell(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="cell-content">
                    <div class="code-section">
                        <div class="code-header">
                            <i class="bi bi-code"></i> Generated Code
                        </div>
                        <div class="code-content">
                            <pre><code>${code}</code></pre>
                        </div>
                    </div>
                    <div class="cell-output">
                        <div class="output-area">
                            <em class="text-muted">Run the cell to see output...</em>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(cell);
        }

        // Run, Edit, Delete Notebook Cells
        function runCell(btn) {
            const cell = btn.closest(".notebook-cell");
            const output = cell.querySelector(".output-area");
            output.innerHTML = `<div class="spinner-border spinner-border-sm text-success"></div> Running...`;
            setTimeout(() => {
                output.innerHTML = `<div class="alert alert-success p-2 mb-0">✅ Analysis completed (sample output)</div>`;
            }, 1500);
        }

        function editCell(btn) {
            const cell = btn.closest(".notebook-cell");
            const codeBlock = cell.querySelector("code");
            let newCode = prompt("Edit code:", codeBlock.innerText);
            if (newCode !== null) codeBlock.innerText = newCode;
        }

        function deleteCell(btn) {
            if (!confirm("Delete this analysis cell?")) return;
            const cell = btn.closest(".notebook-cell");
            cell.remove();
        }

        // Select Analysis Option
        document.querySelectorAll(".analysis-option").forEach(opt => {
            opt.addEventListener("click", () => {
                document.querySelectorAll(".analysis-option").forEach(o => o.classList.remove("selected"));
                opt.classList.add("selected");
            });
        });
    </script>
</body>
</html>
