var Lm=Object.defineProperty;var cd=t=>{throw TypeError(t)};var Em=(t,r,n)=>r in t?Lm(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var Fi=(t,r,n)=>Em(t,typeof r!="symbol"?r+"":r,n),Bi=(t,r,n)=>r.has(t)||cd("Cannot "+n);var O=(t,r,n)=>(Bi(t,r,"read from private field"),n?n.call(t):r.get(t)),he=(t,r,n)=>r.has(t)?cd("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,n),ne=(t,r,n,i)=>(Bi(t,r,"write to private field"),i?i.call(t,n):r.set(t,n),n),je=(t,r,n)=>(Bi(t,r,"access private method"),n);var fn=(t,r,n,i)=>({set _(o){ne(t,r,o,n)},get _(){return O(t,r,i)}});import{j as e,R as rt,B as os,C as vt,X as _t,Y as jt,T as it,h as Mt,P as yc,k as vc,l as Ea,L as Wn,u as Rm,S as ud,m as Ta,n as La,o as Lo,p as _c,q as Mm,r as Dm,s as Am,t as Om,v as Im,w as zm,x as Fm,y as Bm,z as $m}from"./vendor-charts-BNucQB18.js";import{a as Vn,r as f,b as pt,c as Zm,R as jc}from"./vendor-react-CTqLuYwO.js";import{L as Eo,A as Ve,B as ks,G as Ra,D as ft,a as Ji,R as qn,S as Hm,M as Um,b as Is,P as Ut,c as hd,C as at,E as wc,d as Wt,e as Wm,f as Ht,g as Wa,X as We,U as Vm,F as qm,h as lt,i as br,j as Gm,k as Nc,l as kc,m as Km,n as Ze,o as Vt,p as Ma,q as Xe,r as En,s as yr,t as Cc,T as Ys,u as Sc,v as Pc,w as Ts,x as Jm,y as Ro,z as Qm,H as Ym,I as Xm,J as ex,K as tx,N as Mo,O as Gs,Q as sx,V as xt,W as Tc,Y as rx,Z as ax,_ as Lc,$ as Yr,a0 as Qi,a1 as md,a2 as nx,a3 as ix,a4 as Gn,a5 as Ec,a6 as Do,a7 as Kt,a8 as wt,a9 as Kn,aa as wr,ab as ox,ac as lx,ad as Jn,ae as Rn,af as Ao,ag as Rc,ah as xd,ai as Mn,aj as dx,ak as Qn,al as cx,am as ux,an as Dn,ao as hx,ap as mx,aq as xx,ar as px,as as fx,at as gx,au as bx,av as yx,aw as vx,ax as _x,ay as Mc,az as Oo,aA as jx,aB as wx,aC as pd,aD as Nx,aE as kx,aF as Cx,aG as Sx,aH as Dc}from"./vendor-utils-BnchSzE4.js";import{c as Px,a as Tx,b as Lx,d as Ex,u as Io,H as An,P as Ks,g as Rx,B as fd,E as Mx,R as Dx,i as zo,e as Fo,C as Bo,f as Ac,h as Oc,M as On,j as Nr}from"./vendor-flow-D9a3j6EW.js";import{P as Ax,a as Ox}from"./vendor-plotly-D7n5k6Pc.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(o){if(o.ep)return;o.ep=!0;const d=n(o);fetch(o.href,d)}})();var Yi={},gd=Vn;Yi.createRoot=gd.createRoot,Yi.hydrateRoot=gd.hydrateRoot;var Va=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Ix={setTimeout:(t,r)=>setTimeout(t,r),clearTimeout:t=>clearTimeout(t),setInterval:(t,r)=>setInterval(t,r),clearInterval:t=>clearInterval(t)},zs,To,dc,zx=(dc=class{constructor(){he(this,zs,Ix);he(this,To,!1)}setTimeoutProvider(t){ne(this,zs,t)}setTimeout(t,r){return O(this,zs).setTimeout(t,r)}clearTimeout(t){O(this,zs).clearTimeout(t)}setInterval(t,r){return O(this,zs).setInterval(t,r)}clearInterval(t){O(this,zs).clearInterval(t)}},zs=new WeakMap,To=new WeakMap,dc),or=new zx;function Fx(t){setTimeout(t,0)}var vr=typeof window>"u"||"Deno"in globalThis;function yt(){}function Bx(t,r){return typeof t=="function"?t(r):t}function Xi(t){return typeof t=="number"&&t>=0&&t!==1/0}function Ic(t,r){return Math.max(t+(r||0)-Date.now(),0)}function qs(t,r){return typeof t=="function"?t(r):t}function Rt(t,r){return typeof t=="function"?t(r):t}function bd(t,r){const{type:n="all",exact:i,fetchStatus:o,predicate:d,queryKey:c,stale:h}=t;if(c){if(i){if(r.queryHash!==$o(c,r.options))return!1}else if(!Aa(r.queryKey,c))return!1}if(n!=="all"){const u=r.isActive();if(n==="active"&&!u||n==="inactive"&&u)return!1}return!(typeof h=="boolean"&&r.isStale()!==h||o&&o!==r.state.fetchStatus||d&&!d(r))}function yd(t,r){const{exact:n,status:i,predicate:o,mutationKey:d}=t;if(d){if(!r.options.mutationKey)return!1;if(n){if(Da(r.options.mutationKey)!==Da(d))return!1}else if(!Aa(r.options.mutationKey,d))return!1}return!(i&&r.state.status!==i||o&&!o(r))}function $o(t,r){return((r==null?void 0:r.queryKeyHashFn)||Da)(t)}function Da(t){return JSON.stringify(t,(r,n)=>to(n)?Object.keys(n).sort().reduce((i,o)=>(i[o]=n[o],i),{}):n)}function Aa(t,r){return t===r?!0:typeof t!=typeof r?!1:t&&r&&typeof t=="object"&&typeof r=="object"?Object.keys(r).every(n=>Aa(t[n],r[n])):!1}var $x=Object.prototype.hasOwnProperty;function zc(t,r){if(t===r)return t;const n=vd(t)&&vd(r);if(!n&&!(to(t)&&to(r)))return r;const o=(n?t:Object.keys(t)).length,d=n?r:Object.keys(r),c=d.length,h=n?new Array(c):{};let u=0;for(let x=0;x<c;x++){const p=n?x:d[x],b=t[p],g=r[p];if(b===g){h[p]=b,(n?x<o:$x.call(t,p))&&u++;continue}if(b===null||g===null||typeof b!="object"||typeof g!="object"){h[p]=g;continue}const y=zc(b,g);h[p]=y,y===b&&u++}return o===c&&u===o?t:h}function eo(t,r){if(!r||Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}function vd(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function to(t){if(!_d(t))return!1;const r=t.constructor;if(r===void 0)return!0;const n=r.prototype;return!(!_d(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function _d(t){return Object.prototype.toString.call(t)==="[object Object]"}function Zx(t){return new Promise(r=>{or.setTimeout(r,t)})}function so(t,r,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,r):n.structuralSharing!==!1?zc(t,r):r}function Hx(t,r,n=0){const i=[...t,r];return n&&i.length>n?i.slice(1):i}function Ux(t,r,n=0){const i=[r,...t];return n&&i.length>n?i.slice(0,-1):i}var Zo=Symbol();function Fc(t,r){return!t.queryFn&&(r!=null&&r.initialPromise)?()=>r.initialPromise:!t.queryFn||t.queryFn===Zo?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function Wx(t,r){return typeof t=="function"?t(...r):!!t}var dr,Fs,Br,cc,Vx=(cc=class extends Va{constructor(){super();he(this,dr);he(this,Fs);he(this,Br);ne(this,Br,r=>{if(!vr&&window.addEventListener){const n=()=>r();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){O(this,Fs)||this.setEventListener(O(this,Br))}onUnsubscribe(){var r;this.hasListeners()||((r=O(this,Fs))==null||r.call(this),ne(this,Fs,void 0))}setEventListener(r){var n;ne(this,Br,r),(n=O(this,Fs))==null||n.call(this),ne(this,Fs,r(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(r){O(this,dr)!==r&&(ne(this,dr,r),this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(n=>{n(r)})}isFocused(){var r;return typeof O(this,dr)=="boolean"?O(this,dr):((r=globalThis.document)==null?void 0:r.visibilityState)!=="hidden"}},dr=new WeakMap,Fs=new WeakMap,Br=new WeakMap,cc),Ho=new Vx;function ro(){let t,r;const n=new Promise((o,d)=>{t=o,r=d});n.status="pending",n.catch(()=>{});function i(o){Object.assign(n,o),delete n.resolve,delete n.reject}return n.resolve=o=>{i({status:"fulfilled",value:o}),t(o)},n.reject=o=>{i({status:"rejected",reason:o}),r(o)},n}var qx=Fx;function Gx(){let t=[],r=0,n=h=>{h()},i=h=>{h()},o=qx;const d=h=>{r?t.push(h):o(()=>{n(h)})},c=()=>{const h=t;t=[],h.length&&o(()=>{i(()=>{h.forEach(u=>{n(u)})})})};return{batch:h=>{let u;r++;try{u=h()}finally{r--,r||c()}return u},batchCalls:h=>(...u)=>{d(()=>{h(...u)})},schedule:d,setNotifyFunction:h=>{n=h},setBatchNotifyFunction:h=>{i=h},setScheduler:h=>{o=h}}}var st=Gx(),$r,Bs,Zr,uc,Kx=(uc=class extends Va{constructor(){super();he(this,$r,!0);he(this,Bs);he(this,Zr);ne(this,Zr,r=>{if(!vr&&window.addEventListener){const n=()=>r(!0),i=()=>r(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}}})}onSubscribe(){O(this,Bs)||this.setEventListener(O(this,Zr))}onUnsubscribe(){var r;this.hasListeners()||((r=O(this,Bs))==null||r.call(this),ne(this,Bs,void 0))}setEventListener(r){var n;ne(this,Zr,r),(n=O(this,Bs))==null||n.call(this),ne(this,Bs,r(this.setOnline.bind(this)))}setOnline(r){O(this,$r)!==r&&(ne(this,$r,r),this.listeners.forEach(i=>{i(r)}))}isOnline(){return O(this,$r)}},$r=new WeakMap,Bs=new WeakMap,Zr=new WeakMap,uc),In=new Kx;function Jx(t){return Math.min(1e3*2**t,3e4)}function Bc(t){return(t??"online")==="online"?In.isOnline():!0}var ao=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function $c(t){let r=!1,n=0,i;const o=ro(),d=()=>o.status!=="pending",c=w=>{var j;if(!d()){const C=new ao(w);g(C),(j=t.onCancel)==null||j.call(t,C)}},h=()=>{r=!0},u=()=>{r=!1},x=()=>Ho.isFocused()&&(t.networkMode==="always"||In.isOnline())&&t.canRun(),p=()=>Bc(t.networkMode)&&t.canRun(),b=w=>{d()||(i==null||i(),o.resolve(w))},g=w=>{d()||(i==null||i(),o.reject(w))},y=()=>new Promise(w=>{var j;i=C=>{(d()||x())&&w(C)},(j=t.onPause)==null||j.call(t)}).then(()=>{var w;i=void 0,d()||(w=t.onContinue)==null||w.call(t)}),_=()=>{if(d())return;let w;const j=n===0?t.initialPromise:void 0;try{w=j??t.fn()}catch(C){w=Promise.reject(C)}Promise.resolve(w).then(b).catch(C=>{var A;if(d())return;const S=t.retry??(vr?0:3),T=t.retryDelay??Jx,E=typeof T=="function"?T(n,C):T,P=S===!0||typeof S=="number"&&n<S||typeof S=="function"&&S(n,C);if(r||!P){g(C);return}n++,(A=t.onFail)==null||A.call(t,n,C),Zx(E).then(()=>x()?void 0:y()).then(()=>{r?g(C):_()})})};return{promise:o,status:()=>o.status,cancel:c,continue:()=>(i==null||i(),o),cancelRetry:h,continueRetry:u,canStart:p,start:()=>(p()?_():y().then(_),o)}}var cr,hc,Zc=(hc=class{constructor(){he(this,cr)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Xi(this.gcTime)&&ne(this,cr,or.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(vr?1/0:5*60*1e3))}clearGcTimeout(){O(this,cr)&&(or.clearTimeout(O(this,cr)),ne(this,cr,void 0))}},cr=new WeakMap,hc),ur,Hr,Et,hr,Ye,Ba,mr,$t,bs,mc,Qx=(mc=class extends Zc{constructor(r){super();he(this,$t);he(this,ur);he(this,Hr);he(this,Et);he(this,hr);he(this,Ye);he(this,Ba);he(this,mr);ne(this,mr,!1),ne(this,Ba,r.defaultOptions),this.setOptions(r.options),this.observers=[],ne(this,hr,r.client),ne(this,Et,O(this,hr).getQueryCache()),this.queryKey=r.queryKey,this.queryHash=r.queryHash,ne(this,ur,wd(this.options)),this.state=r.state??O(this,ur),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var r;return(r=O(this,Ye))==null?void 0:r.promise}setOptions(r){if(this.options={...O(this,Ba),...r},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=wd(this.options);n.data!==void 0&&(this.setState(jd(n.data,n.dataUpdatedAt)),ne(this,ur,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&O(this,Et).remove(this)}setData(r,n){const i=so(this.state.data,r,this.options);return je(this,$t,bs).call(this,{data:i,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),i}setState(r,n){je(this,$t,bs).call(this,{type:"setState",state:r,setStateOptions:n})}cancel(r){var i,o;const n=(i=O(this,Ye))==null?void 0:i.promise;return(o=O(this,Ye))==null||o.cancel(r),n?n.then(yt).catch(yt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(O(this,ur))}isActive(){return this.observers.some(r=>Rt(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Zo||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(r=>qs(r.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(r=0){return this.state.data===void 0?!0:r==="static"?!1:this.state.isInvalidated?!0:!Ic(this.state.dataUpdatedAt,r)}onFocus(){var n;const r=this.observers.find(i=>i.shouldFetchOnWindowFocus());r==null||r.refetch({cancelRefetch:!1}),(n=O(this,Ye))==null||n.continue()}onOnline(){var n;const r=this.observers.find(i=>i.shouldFetchOnReconnect());r==null||r.refetch({cancelRefetch:!1}),(n=O(this,Ye))==null||n.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),O(this,Et).notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(n=>n!==r),this.observers.length||(O(this,Ye)&&(O(this,mr)?O(this,Ye).cancel({revert:!0}):O(this,Ye).cancelRetry()),this.scheduleGc()),O(this,Et).notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||je(this,$t,bs).call(this,{type:"invalidate"})}async fetch(r,n){var u,x,p,b,g,y,_,w,j,C,S,T;if(this.state.fetchStatus!=="idle"&&((u=O(this,Ye))==null?void 0:u.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(O(this,Ye))return O(this,Ye).continueRetry(),O(this,Ye).promise}if(r&&this.setOptions(r),!this.options.queryFn){const E=this.observers.find(P=>P.options.queryFn);E&&this.setOptions(E.options)}const i=new AbortController,o=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(ne(this,mr,!0),i.signal)})},d=()=>{const E=Fc(this.options,n),A=(()=>{const R={client:O(this,hr),queryKey:this.queryKey,meta:this.meta};return o(R),R})();return ne(this,mr,!1),this.options.persister?this.options.persister(E,A,this):E(A)},h=(()=>{const E={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:O(this,hr),state:this.state,fetchFn:d};return o(E),E})();(x=this.options.behavior)==null||x.onFetch(h,this),ne(this,Hr,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((p=h.fetchOptions)==null?void 0:p.meta))&&je(this,$t,bs).call(this,{type:"fetch",meta:(b=h.fetchOptions)==null?void 0:b.meta}),ne(this,Ye,$c({initialPromise:n==null?void 0:n.initialPromise,fn:h.fetchFn,onCancel:E=>{E instanceof ao&&E.revert&&this.setState({...O(this,Hr),fetchStatus:"idle"}),i.abort()},onFail:(E,P)=>{je(this,$t,bs).call(this,{type:"failed",failureCount:E,error:P})},onPause:()=>{je(this,$t,bs).call(this,{type:"pause"})},onContinue:()=>{je(this,$t,bs).call(this,{type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0}));try{const E=await O(this,Ye).start();if(E===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(E),(y=(g=O(this,Et).config).onSuccess)==null||y.call(g,E,this),(w=(_=O(this,Et).config).onSettled)==null||w.call(_,E,this.state.error,this),E}catch(E){if(E instanceof ao){if(E.silent)return O(this,Ye).promise;if(E.revert){if(this.state.data===void 0)throw E;return this.state.data}}throw je(this,$t,bs).call(this,{type:"error",error:E}),(C=(j=O(this,Et).config).onError)==null||C.call(j,E,this),(T=(S=O(this,Et).config).onSettled)==null||T.call(S,this.state.data,E,this),E}finally{this.scheduleGc()}}},ur=new WeakMap,Hr=new WeakMap,Et=new WeakMap,hr=new WeakMap,Ye=new WeakMap,Ba=new WeakMap,mr=new WeakMap,$t=new WeakSet,bs=function(r){const n=i=>{switch(r.type){case"failed":return{...i,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...Hc(i.data,this.options),fetchMeta:r.meta??null};case"success":const o={...i,...jd(r.data,r.dataUpdatedAt),dataUpdateCount:i.dataUpdateCount+1,...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return ne(this,Hr,r.manual?o:void 0),o;case"error":const d=r.error;return{...i,error:d,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:d,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...r.state}}};this.state=n(this.state),st.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),O(this,Et).notify({query:this,type:"updated",action:r})})},mc);function Hc(t,r){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Bc(r.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function jd(t,r){return{data:t,dataUpdatedAt:r??Date.now(),error:null,isInvalidated:!1,status:"success"}}function wd(t){const r=typeof t.initialData=="function"?t.initialData():t.initialData,n=r!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:r,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var bt,we,$a,ht,xr,Ur,_s,$s,Za,Wr,Vr,pr,fr,Zs,qr,Pe,Pa,no,io,oo,lo,co,uo,ho,Uc,xc,Yx=(xc=class extends Va{constructor(r,n){super();he(this,Pe);he(this,bt);he(this,we);he(this,$a);he(this,ht);he(this,xr);he(this,Ur);he(this,_s);he(this,$s);he(this,Za);he(this,Wr);he(this,Vr);he(this,pr);he(this,fr);he(this,Zs);he(this,qr,new Set);this.options=n,ne(this,bt,r),ne(this,$s,null),ne(this,_s,ro()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(O(this,we).addObserver(this),Nd(O(this,we),this.options)?je(this,Pe,Pa).call(this):this.updateResult(),je(this,Pe,lo).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return mo(O(this,we),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return mo(O(this,we),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,je(this,Pe,co).call(this),je(this,Pe,uo).call(this),O(this,we).removeObserver(this)}setOptions(r){const n=this.options,i=O(this,we);if(this.options=O(this,bt).defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Rt(this.options.enabled,O(this,we))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");je(this,Pe,ho).call(this),O(this,we).setOptions(this.options),n._defaulted&&!eo(this.options,n)&&O(this,bt).getQueryCache().notify({type:"observerOptionsUpdated",query:O(this,we),observer:this});const o=this.hasListeners();o&&kd(O(this,we),i,this.options,n)&&je(this,Pe,Pa).call(this),this.updateResult(),o&&(O(this,we)!==i||Rt(this.options.enabled,O(this,we))!==Rt(n.enabled,O(this,we))||qs(this.options.staleTime,O(this,we))!==qs(n.staleTime,O(this,we)))&&je(this,Pe,no).call(this);const d=je(this,Pe,io).call(this);o&&(O(this,we)!==i||Rt(this.options.enabled,O(this,we))!==Rt(n.enabled,O(this,we))||d!==O(this,Zs))&&je(this,Pe,oo).call(this,d)}getOptimisticResult(r){const n=O(this,bt).getQueryCache().build(O(this,bt),r),i=this.createResult(n,r);return ep(this,i)&&(ne(this,ht,i),ne(this,Ur,this.options),ne(this,xr,O(this,we).state)),i}getCurrentResult(){return O(this,ht)}trackResult(r,n){return new Proxy(r,{get:(i,o)=>(this.trackProp(o),n==null||n(o),o==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&O(this,_s).status==="pending"&&O(this,_s).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(i,o))})}trackProp(r){O(this,qr).add(r)}getCurrentQuery(){return O(this,we)}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const n=O(this,bt).defaultQueryOptions(r),i=O(this,bt).getQueryCache().build(O(this,bt),n);return i.fetch().then(()=>this.createResult(i,n))}fetch(r){return je(this,Pe,Pa).call(this,{...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),O(this,ht)))}createResult(r,n){var M;const i=O(this,we),o=this.options,d=O(this,ht),c=O(this,xr),h=O(this,Ur),x=r!==i?r.state:O(this,$a),{state:p}=r;let b={...p},g=!1,y;if(n._optimisticResults){const z=this.hasListeners(),I=!z&&Nd(r,n),F=z&&kd(r,i,n,o);(I||F)&&(b={...b,...Hc(p.data,r.options)}),n._optimisticResults==="isRestoring"&&(b.fetchStatus="idle")}let{error:_,errorUpdatedAt:w,status:j}=b;y=b.data;let C=!1;if(n.placeholderData!==void 0&&y===void 0&&j==="pending"){let z;d!=null&&d.isPlaceholderData&&n.placeholderData===(h==null?void 0:h.placeholderData)?(z=d.data,C=!0):z=typeof n.placeholderData=="function"?n.placeholderData((M=O(this,Vr))==null?void 0:M.state.data,O(this,Vr)):n.placeholderData,z!==void 0&&(j="success",y=so(d==null?void 0:d.data,z,n),g=!0)}if(n.select&&y!==void 0&&!C)if(d&&y===(c==null?void 0:c.data)&&n.select===O(this,Za))y=O(this,Wr);else try{ne(this,Za,n.select),y=n.select(y),y=so(d==null?void 0:d.data,y,n),ne(this,Wr,y),ne(this,$s,null)}catch(z){ne(this,$s,z)}O(this,$s)&&(_=O(this,$s),y=O(this,Wr),w=Date.now(),j="error");const S=b.fetchStatus==="fetching",T=j==="pending",E=j==="error",P=T&&S,A=y!==void 0,N={status:j,fetchStatus:b.fetchStatus,isPending:T,isSuccess:j==="success",isError:E,isInitialLoading:P,isLoading:P,data:y,dataUpdatedAt:b.dataUpdatedAt,error:_,errorUpdatedAt:w,failureCount:b.fetchFailureCount,failureReason:b.fetchFailureReason,errorUpdateCount:b.errorUpdateCount,isFetched:b.dataUpdateCount>0||b.errorUpdateCount>0,isFetchedAfterMount:b.dataUpdateCount>x.dataUpdateCount||b.errorUpdateCount>x.errorUpdateCount,isFetching:S,isRefetching:S&&!T,isLoadingError:E&&!A,isPaused:b.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:E&&A,isStale:Uo(r,n),refetch:this.refetch,promise:O(this,_s),isEnabled:Rt(n.enabled,r)!==!1};if(this.options.experimental_prefetchInRender){const z=$=>{N.status==="error"?$.reject(N.error):N.data!==void 0&&$.resolve(N.data)},I=()=>{const $=ne(this,_s,N.promise=ro());z($)},F=O(this,_s);switch(F.status){case"pending":r.queryHash===i.queryHash&&z(F);break;case"fulfilled":(N.status==="error"||N.data!==F.value)&&I();break;case"rejected":(N.status!=="error"||N.error!==F.reason)&&I();break}}return N}updateResult(){const r=O(this,ht),n=this.createResult(O(this,we),this.options);if(ne(this,xr,O(this,we).state),ne(this,Ur,this.options),O(this,xr).data!==void 0&&ne(this,Vr,O(this,we)),eo(n,r))return;ne(this,ht,n);const i=()=>{if(!r)return!0;const{notifyOnChangeProps:o}=this.options,d=typeof o=="function"?o():o;if(d==="all"||!d&&!O(this,qr).size)return!0;const c=new Set(d??O(this,qr));return this.options.throwOnError&&c.add("error"),Object.keys(O(this,ht)).some(h=>{const u=h;return O(this,ht)[u]!==r[u]&&c.has(u)})};je(this,Pe,Uc).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&je(this,Pe,lo).call(this)}},bt=new WeakMap,we=new WeakMap,$a=new WeakMap,ht=new WeakMap,xr=new WeakMap,Ur=new WeakMap,_s=new WeakMap,$s=new WeakMap,Za=new WeakMap,Wr=new WeakMap,Vr=new WeakMap,pr=new WeakMap,fr=new WeakMap,Zs=new WeakMap,qr=new WeakMap,Pe=new WeakSet,Pa=function(r){je(this,Pe,ho).call(this);let n=O(this,we).fetch(this.options,r);return r!=null&&r.throwOnError||(n=n.catch(yt)),n},no=function(){je(this,Pe,co).call(this);const r=qs(this.options.staleTime,O(this,we));if(vr||O(this,ht).isStale||!Xi(r))return;const i=Ic(O(this,ht).dataUpdatedAt,r)+1;ne(this,pr,or.setTimeout(()=>{O(this,ht).isStale||this.updateResult()},i))},io=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(O(this,we)):this.options.refetchInterval)??!1},oo=function(r){je(this,Pe,uo).call(this),ne(this,Zs,r),!(vr||Rt(this.options.enabled,O(this,we))===!1||!Xi(O(this,Zs))||O(this,Zs)===0)&&ne(this,fr,or.setInterval(()=>{(this.options.refetchIntervalInBackground||Ho.isFocused())&&je(this,Pe,Pa).call(this)},O(this,Zs)))},lo=function(){je(this,Pe,no).call(this),je(this,Pe,oo).call(this,je(this,Pe,io).call(this))},co=function(){O(this,pr)&&(or.clearTimeout(O(this,pr)),ne(this,pr,void 0))},uo=function(){O(this,fr)&&(or.clearInterval(O(this,fr)),ne(this,fr,void 0))},ho=function(){const r=O(this,bt).getQueryCache().build(O(this,bt),this.options);if(r===O(this,we))return;const n=O(this,we);ne(this,we,r),ne(this,$a,r.state),this.hasListeners()&&(n==null||n.removeObserver(this),r.addObserver(this))},Uc=function(r){st.batch(()=>{r.listeners&&this.listeners.forEach(n=>{n(O(this,ht))}),O(this,bt).getQueryCache().notify({query:O(this,we),type:"observerResultsUpdated"})})},xc);function Xx(t,r){return Rt(r.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&r.retryOnMount===!1)}function Nd(t,r){return Xx(t,r)||t.state.data!==void 0&&mo(t,r,r.refetchOnMount)}function mo(t,r,n){if(Rt(r.enabled,t)!==!1&&qs(r.staleTime,t)!=="static"){const i=typeof n=="function"?n(t):n;return i==="always"||i!==!1&&Uo(t,r)}return!1}function kd(t,r,n,i){return(t!==r||Rt(i.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Uo(t,n)}function Uo(t,r){return Rt(r.enabled,t)!==!1&&t.isStaleByTime(qs(r.staleTime,t))}function ep(t,r){return!eo(t.getCurrentResult(),r)}function Cd(t){return{onFetch:(r,n)=>{var p,b,g,y,_;const i=r.options,o=(g=(b=(p=r.fetchOptions)==null?void 0:p.meta)==null?void 0:b.fetchMore)==null?void 0:g.direction,d=((y=r.state.data)==null?void 0:y.pages)||[],c=((_=r.state.data)==null?void 0:_.pageParams)||[];let h={pages:[],pageParams:[]},u=0;const x=async()=>{let w=!1;const j=T=>{Object.defineProperty(T,"signal",{enumerable:!0,get:()=>(r.signal.aborted?w=!0:r.signal.addEventListener("abort",()=>{w=!0}),r.signal)})},C=Fc(r.options,r.fetchOptions),S=async(T,E,P)=>{if(w)return Promise.reject();if(E==null&&T.pages.length)return Promise.resolve(T);const R=(()=>{const I={client:r.client,queryKey:r.queryKey,pageParam:E,direction:P?"backward":"forward",meta:r.options.meta};return j(I),I})(),N=await C(R),{maxPages:M}=r.options,z=P?Ux:Hx;return{pages:z(T.pages,N,M),pageParams:z(T.pageParams,E,M)}};if(o&&d.length){const T=o==="backward",E=T?tp:Sd,P={pages:d,pageParams:c},A=E(i,P);h=await S(P,A,T)}else{const T=t??d.length;do{const E=u===0?c[0]??i.initialPageParam:Sd(i,h);if(u>0&&E==null)break;h=await S(h,E),u++}while(u<T)}return h};r.options.persister?r.fetchFn=()=>{var w,j;return(j=(w=r.options).persister)==null?void 0:j.call(w,x,{client:r.client,queryKey:r.queryKey,meta:r.options.meta,signal:r.signal},n)}:r.fetchFn=x}}}function Sd(t,{pages:r,pageParams:n}){const i=r.length-1;return r.length>0?t.getNextPageParam(r[i],r,n[i],n):void 0}function tp(t,{pages:r,pageParams:n}){var i;return r.length>0?(i=t.getPreviousPageParam)==null?void 0:i.call(t,r[0],r,n[0],n):void 0}var Ha,rs,mt,gr,as,Os,pc,sp=(pc=class extends Zc{constructor(r){super();he(this,as);he(this,Ha);he(this,rs);he(this,mt);he(this,gr);ne(this,Ha,r.client),this.mutationId=r.mutationId,ne(this,mt,r.mutationCache),ne(this,rs,[]),this.state=r.state||rp(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){O(this,rs).includes(r)||(O(this,rs).push(r),this.clearGcTimeout(),O(this,mt).notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){ne(this,rs,O(this,rs).filter(n=>n!==r)),this.scheduleGc(),O(this,mt).notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){O(this,rs).length||(this.state.status==="pending"?this.scheduleGc():O(this,mt).remove(this))}continue(){var r;return((r=O(this,gr))==null?void 0:r.continue())??this.execute(this.state.variables)}async execute(r){var c,h,u,x,p,b,g,y,_,w,j,C,S,T,E,P,A,R,N,M;const n=()=>{je(this,as,Os).call(this,{type:"continue"})},i={client:O(this,Ha),meta:this.options.meta,mutationKey:this.options.mutationKey};ne(this,gr,$c({fn:()=>this.options.mutationFn?this.options.mutationFn(r,i):Promise.reject(new Error("No mutationFn found")),onFail:(z,I)=>{je(this,as,Os).call(this,{type:"failed",failureCount:z,error:I})},onPause:()=>{je(this,as,Os).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>O(this,mt).canRun(this)}));const o=this.state.status==="pending",d=!O(this,gr).canStart();try{if(o)n();else{je(this,as,Os).call(this,{type:"pending",variables:r,isPaused:d}),await((h=(c=O(this,mt).config).onMutate)==null?void 0:h.call(c,r,this,i));const I=await((x=(u=this.options).onMutate)==null?void 0:x.call(u,r,i));I!==this.state.context&&je(this,as,Os).call(this,{type:"pending",context:I,variables:r,isPaused:d})}const z=await O(this,gr).start();return await((b=(p=O(this,mt).config).onSuccess)==null?void 0:b.call(p,z,r,this.state.context,this,i)),await((y=(g=this.options).onSuccess)==null?void 0:y.call(g,z,r,this.state.context,i)),await((w=(_=O(this,mt).config).onSettled)==null?void 0:w.call(_,z,null,this.state.variables,this.state.context,this,i)),await((C=(j=this.options).onSettled)==null?void 0:C.call(j,z,null,r,this.state.context,i)),je(this,as,Os).call(this,{type:"success",data:z}),z}catch(z){try{throw await((T=(S=O(this,mt).config).onError)==null?void 0:T.call(S,z,r,this.state.context,this,i)),await((P=(E=this.options).onError)==null?void 0:P.call(E,z,r,this.state.context,i)),await((R=(A=O(this,mt).config).onSettled)==null?void 0:R.call(A,void 0,z,this.state.variables,this.state.context,this,i)),await((M=(N=this.options).onSettled)==null?void 0:M.call(N,void 0,z,r,this.state.context,i)),z}finally{je(this,as,Os).call(this,{type:"error",error:z})}}finally{O(this,mt).runNext(this)}}},Ha=new WeakMap,rs=new WeakMap,mt=new WeakMap,gr=new WeakMap,as=new WeakSet,Os=function(r){const n=i=>{switch(r.type){case"failed":return{...i,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...i,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:r.error,failureCount:i.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=n(this.state),st.batch(()=>{O(this,rs).forEach(i=>{i.onMutationUpdate(r)}),O(this,mt).notify({mutation:this,type:"updated",action:r})})},pc);function rp(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var js,Zt,Ua,fc,ap=(fc=class extends Va{constructor(r={}){super();he(this,js);he(this,Zt);he(this,Ua);this.config=r,ne(this,js,new Set),ne(this,Zt,new Map),ne(this,Ua,0)}build(r,n,i){const o=new sp({client:r,mutationCache:this,mutationId:++fn(this,Ua)._,options:r.defaultMutationOptions(n),state:i});return this.add(o),o}add(r){O(this,js).add(r);const n=gn(r);if(typeof n=="string"){const i=O(this,Zt).get(n);i?i.push(r):O(this,Zt).set(n,[r])}this.notify({type:"added",mutation:r})}remove(r){if(O(this,js).delete(r)){const n=gn(r);if(typeof n=="string"){const i=O(this,Zt).get(n);if(i)if(i.length>1){const o=i.indexOf(r);o!==-1&&i.splice(o,1)}else i[0]===r&&O(this,Zt).delete(n)}}this.notify({type:"removed",mutation:r})}canRun(r){const n=gn(r);if(typeof n=="string"){const i=O(this,Zt).get(n),o=i==null?void 0:i.find(d=>d.state.status==="pending");return!o||o===r}else return!0}runNext(r){var i;const n=gn(r);if(typeof n=="string"){const o=(i=O(this,Zt).get(n))==null?void 0:i.find(d=>d!==r&&d.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}else return Promise.resolve()}clear(){st.batch(()=>{O(this,js).forEach(r=>{this.notify({type:"removed",mutation:r})}),O(this,js).clear(),O(this,Zt).clear()})}getAll(){return Array.from(O(this,js))}find(r){const n={exact:!0,...r};return this.getAll().find(i=>yd(n,i))}findAll(r={}){return this.getAll().filter(n=>yd(r,n))}notify(r){st.batch(()=>{this.listeners.forEach(n=>{n(r)})})}resumePausedMutations(){const r=this.getAll().filter(n=>n.state.isPaused);return st.batch(()=>Promise.all(r.map(n=>n.continue().catch(yt))))}},js=new WeakMap,Zt=new WeakMap,Ua=new WeakMap,fc);function gn(t){var r;return(r=t.options.scope)==null?void 0:r.id}var ns,gc,np=(gc=class extends Va{constructor(r={}){super();he(this,ns);this.config=r,ne(this,ns,new Map)}build(r,n,i){const o=n.queryKey,d=n.queryHash??$o(o,n);let c=this.get(d);return c||(c=new Qx({client:r,queryKey:o,queryHash:d,options:r.defaultQueryOptions(n),state:i,defaultOptions:r.getQueryDefaults(o)}),this.add(c)),c}add(r){O(this,ns).has(r.queryHash)||(O(this,ns).set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const n=O(this,ns).get(r.queryHash);n&&(r.destroy(),n===r&&O(this,ns).delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){st.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return O(this,ns).get(r)}getAll(){return[...O(this,ns).values()]}find(r){const n={exact:!0,...r};return this.getAll().find(i=>bd(n,i))}findAll(r={}){const n=this.getAll();return Object.keys(r).length>0?n.filter(i=>bd(r,i)):n}notify(r){st.batch(()=>{this.listeners.forEach(n=>{n(r)})})}onFocus(){st.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){st.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},ns=new WeakMap,gc),ze,Hs,Us,Gr,Kr,Ws,Jr,Qr,bc,ip=(bc=class{constructor(t={}){he(this,ze);he(this,Hs);he(this,Us);he(this,Gr);he(this,Kr);he(this,Ws);he(this,Jr);he(this,Qr);ne(this,ze,t.queryCache||new np),ne(this,Hs,t.mutationCache||new ap),ne(this,Us,t.defaultOptions||{}),ne(this,Gr,new Map),ne(this,Kr,new Map),ne(this,Ws,0)}mount(){fn(this,Ws)._++,O(this,Ws)===1&&(ne(this,Jr,Ho.subscribe(async t=>{t&&(await this.resumePausedMutations(),O(this,ze).onFocus())})),ne(this,Qr,In.subscribe(async t=>{t&&(await this.resumePausedMutations(),O(this,ze).onOnline())})))}unmount(){var t,r;fn(this,Ws)._--,O(this,Ws)===0&&((t=O(this,Jr))==null||t.call(this),ne(this,Jr,void 0),(r=O(this,Qr))==null||r.call(this),ne(this,Qr,void 0))}isFetching(t){return O(this,ze).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return O(this,Hs).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const r=this.defaultQueryOptions({queryKey:t});return(n=O(this,ze).get(r.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const r=this.defaultQueryOptions(t),n=O(this,ze).build(this,r),i=n.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(qs(r.staleTime,n))&&this.prefetchQuery(r),Promise.resolve(i))}getQueriesData(t){return O(this,ze).findAll(t).map(({queryKey:r,state:n})=>{const i=n.data;return[r,i]})}setQueryData(t,r,n){const i=this.defaultQueryOptions({queryKey:t}),o=O(this,ze).get(i.queryHash),d=o==null?void 0:o.state.data,c=Bx(r,d);if(c!==void 0)return O(this,ze).build(this,i).setData(c,{...n,manual:!0})}setQueriesData(t,r,n){return st.batch(()=>O(this,ze).findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,r,n)]))}getQueryState(t){var n;const r=this.defaultQueryOptions({queryKey:t});return(n=O(this,ze).get(r.queryHash))==null?void 0:n.state}removeQueries(t){const r=O(this,ze);st.batch(()=>{r.findAll(t).forEach(n=>{r.remove(n)})})}resetQueries(t,r){const n=O(this,ze);return st.batch(()=>(n.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},r)))}cancelQueries(t,r={}){const n={revert:!0,...r},i=st.batch(()=>O(this,ze).findAll(t).map(o=>o.cancel(n)));return Promise.all(i).then(yt).catch(yt)}invalidateQueries(t,r={}){return st.batch(()=>(O(this,ze).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},r)))}refetchQueries(t,r={}){const n={...r,cancelRefetch:r.cancelRefetch??!0},i=st.batch(()=>O(this,ze).findAll(t).filter(o=>!o.isDisabled()&&!o.isStatic()).map(o=>{let d=o.fetch(void 0,n);return n.throwOnError||(d=d.catch(yt)),o.state.fetchStatus==="paused"?Promise.resolve():d}));return Promise.all(i).then(yt)}fetchQuery(t){const r=this.defaultQueryOptions(t);r.retry===void 0&&(r.retry=!1);const n=O(this,ze).build(this,r);return n.isStaleByTime(qs(r.staleTime,n))?n.fetch(r):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(yt).catch(yt)}fetchInfiniteQuery(t){return t.behavior=Cd(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(yt).catch(yt)}ensureInfiniteQueryData(t){return t.behavior=Cd(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return In.isOnline()?O(this,Hs).resumePausedMutations():Promise.resolve()}getQueryCache(){return O(this,ze)}getMutationCache(){return O(this,Hs)}getDefaultOptions(){return O(this,Us)}setDefaultOptions(t){ne(this,Us,t)}setQueryDefaults(t,r){O(this,Gr).set(Da(t),{queryKey:t,defaultOptions:r})}getQueryDefaults(t){const r=[...O(this,Gr).values()],n={};return r.forEach(i=>{Aa(t,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(t,r){O(this,Kr).set(Da(t),{mutationKey:t,defaultOptions:r})}getMutationDefaults(t){const r=[...O(this,Kr).values()],n={};return r.forEach(i=>{Aa(t,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const r={...O(this,Us).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return r.queryHash||(r.queryHash=$o(r.queryKey,r)),r.refetchOnReconnect===void 0&&(r.refetchOnReconnect=r.networkMode!=="always"),r.throwOnError===void 0&&(r.throwOnError=!!r.suspense),!r.networkMode&&r.persister&&(r.networkMode="offlineFirst"),r.queryFn===Zo&&(r.enabled=!1),r}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...O(this,Us).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){O(this,ze).clear(),O(this,Hs).clear()}},ze=new WeakMap,Hs=new WeakMap,Us=new WeakMap,Gr=new WeakMap,Kr=new WeakMap,Ws=new WeakMap,Jr=new WeakMap,Qr=new WeakMap,bc),Wc=f.createContext(void 0),op=t=>{const r=f.useContext(Wc);if(!r)throw new Error("No QueryClient set, use QueryClientProvider to set one");return r},lp=({client:t,children:r})=>(f.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(Wc.Provider,{value:t,children:r})),Vc=f.createContext(!1),dp=()=>f.useContext(Vc);Vc.Provider;function cp(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var up=f.createContext(cp()),hp=()=>f.useContext(up),mp=(t,r)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(r.isReset()||(t.retryOnMount=!1))},xp=t=>{f.useEffect(()=>{t.clearReset()},[t])},pp=({result:t,errorResetBoundary:r,throwOnError:n,query:i,suspense:o})=>t.isError&&!r.isReset()&&!t.isFetching&&i&&(o&&t.data===void 0||Wx(n,[t.error,i])),fp=t=>{if(t.suspense){const n=o=>o==="static"?o:Math.max(o??1e3,1e3),i=t.staleTime;t.staleTime=typeof i=="function"?(...o)=>n(i(...o)):n(i),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},gp=(t,r)=>t.isLoading&&t.isFetching&&!r,bp=(t,r)=>(t==null?void 0:t.suspense)&&r.isPending,Pd=(t,r,n)=>r.fetchOptimistic(t).catch(()=>{n.clearReset()});function yp(t,r,n){var b,g,y,_,w;const i=dp(),o=hp(),d=op(),c=d.defaultQueryOptions(t);(g=(b=d.getDefaultOptions().queries)==null?void 0:b._experimental_beforeQuery)==null||g.call(b,c),c._optimisticResults=i?"isRestoring":"optimistic",fp(c),mp(c,o),xp(o);const h=!d.getQueryCache().get(c.queryHash),[u]=f.useState(()=>new r(d,c)),x=u.getOptimisticResult(c),p=!i&&t.subscribed!==!1;if(f.useSyncExternalStore(f.useCallback(j=>{const C=p?u.subscribe(st.batchCalls(j)):yt;return u.updateResult(),C},[u,p]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),f.useEffect(()=>{u.setOptions(c)},[c,u]),bp(c,x))throw Pd(c,u,o);if(pp({result:x,errorResetBoundary:o,throwOnError:c.throwOnError,query:d.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw x.error;if((_=(y=d.getDefaultOptions().queries)==null?void 0:y._experimental_afterQuery)==null||_.call(y,c,x),c.experimental_prefetchInRender&&!vr&&gp(x,i)){const j=h?Pd(c,u,o):(w=d.getQueryCache().get(c.queryHash))==null?void 0:w.promise;j==null||j.catch(yt).finally(()=>{u.updateResult()})}return c.notifyOnChangeProps?x:u.trackResult(x)}function vp(t,r){return yp(t,Yx)}/**
 * react-router v7.10.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Td="popstate";function _p(t={}){function r(i,o){let{pathname:d,search:c,hash:h}=i.location;return xo("",{pathname:d,search:c,hash:h},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(i,o){return typeof o=="string"?o:Oa(o)}return wp(r,n,null,t)}function Oe(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function At(t,r){if(!t){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function jp(){return Math.random().toString(36).substring(2,10)}function Ld(t,r){return{usr:t.state,key:t.key,idx:r}}function xo(t,r,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof r=="string"?sa(r):r,state:n,key:r&&r.key||i||jp()}}function Oa({pathname:t="/",search:r="",hash:n=""}){return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function sa(t){let r={};if(t){let n=t.indexOf("#");n>=0&&(r.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(r.search=t.substring(i),t=t.substring(0,i)),t&&(r.pathname=t)}return r}function wp(t,r,n,i={}){let{window:o=document.defaultView,v5Compat:d=!1}=i,c=o.history,h="POP",u=null,x=p();x==null&&(x=0,c.replaceState({...c.state,idx:x},""));function p(){return(c.state||{idx:null}).idx}function b(){h="POP";let j=p(),C=j==null?null:j-x;x=j,u&&u({action:h,location:w.location,delta:C})}function g(j,C){h="PUSH";let S=xo(w.location,j,C);x=p()+1;let T=Ld(S,x),E=w.createHref(S);try{c.pushState(T,"",E)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;o.location.assign(E)}d&&u&&u({action:h,location:w.location,delta:1})}function y(j,C){h="REPLACE";let S=xo(w.location,j,C);x=p();let T=Ld(S,x),E=w.createHref(S);c.replaceState(T,"",E),d&&u&&u({action:h,location:w.location,delta:0})}function _(j){return Np(j)}let w={get action(){return h},get location(){return t(o,c)},listen(j){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener(Td,b),u=j,()=>{o.removeEventListener(Td,b),u=null}},createHref(j){return r(o,j)},createURL:_,encodeLocation(j){let C=_(j);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:g,replace:y,go(j){return c.go(j)}};return w}function Np(t,r=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Oe(n,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:Oa(t);return i=i.replace(/ $/,"%20"),!r&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function qc(t,r,n="/"){return kp(t,r,n,!1)}function kp(t,r,n,i){let o=typeof r=="string"?sa(r):r,d=Cs(o.pathname||"/",n);if(d==null)return null;let c=Gc(t);Cp(c);let h=null;for(let u=0;h==null&&u<c.length;++u){let x=Ip(d);h=Ap(c[u],x,i)}return h}function Gc(t,r=[],n=[],i="",o=!1){let d=(c,h,u=o,x)=>{let p={relativePath:x===void 0?c.path||"":x,caseSensitive:c.caseSensitive===!0,childrenIndex:h,route:c};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(i)&&u)return;Oe(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length)}let b=Ns([i,p.relativePath]),g=n.concat(p);c.children&&c.children.length>0&&(Oe(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${b}".`),Gc(c.children,r,g,b,u)),!(c.path==null&&!c.index)&&r.push({path:b,score:Mp(b,c.index),routesMeta:g})};return t.forEach((c,h)=>{var u;if(c.path===""||!((u=c.path)!=null&&u.includes("?")))d(c,h);else for(let x of Kc(c.path))d(c,h,!0,x)}),r}function Kc(t){let r=t.split("/");if(r.length===0)return[];let[n,...i]=r,o=n.endsWith("?"),d=n.replace(/\?$/,"");if(i.length===0)return o?[d,""]:[d];let c=Kc(i.join("/")),h=[];return h.push(...c.map(u=>u===""?d:[d,u].join("/"))),o&&h.push(...c),h.map(u=>t.startsWith("/")&&u===""?"/":u)}function Cp(t){t.sort((r,n)=>r.score!==n.score?n.score-r.score:Dp(r.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var Sp=/^:[\w-]+$/,Pp=3,Tp=2,Lp=1,Ep=10,Rp=-2,Ed=t=>t==="*";function Mp(t,r){let n=t.split("/"),i=n.length;return n.some(Ed)&&(i+=Rp),r&&(i+=Tp),n.filter(o=>!Ed(o)).reduce((o,d)=>o+(Sp.test(d)?Pp:d===""?Lp:Ep),i)}function Dp(t,r){return t.length===r.length&&t.slice(0,-1).every((i,o)=>i===r[o])?t[t.length-1]-r[r.length-1]:0}function Ap(t,r,n=!1){let{routesMeta:i}=t,o={},d="/",c=[];for(let h=0;h<i.length;++h){let u=i[h],x=h===i.length-1,p=d==="/"?r:r.slice(d.length)||"/",b=zn({path:u.relativePath,caseSensitive:u.caseSensitive,end:x},p),g=u.route;if(!b&&x&&n&&!i[i.length-1].route.index&&(b=zn({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},p)),!b)return null;Object.assign(o,b.params),c.push({params:o,pathname:Ns([d,b.pathname]),pathnameBase:Zp(Ns([d,b.pathnameBase])),route:g}),b.pathnameBase!=="/"&&(d=Ns([d,b.pathnameBase]))}return c}function zn(t,r){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=Op(t.path,t.caseSensitive,t.end),o=r.match(n);if(!o)return null;let d=o[0],c=d.replace(/(.)\/+$/,"$1"),h=o.slice(1);return{params:i.reduce((x,{paramName:p,isOptional:b},g)=>{if(p==="*"){let _=h[g]||"";c=d.slice(0,d.length-_.length).replace(/(.)\/+$/,"$1")}const y=h[g];return b&&!y?x[p]=void 0:x[p]=(y||"").replace(/%2F/g,"/"),x},{}),pathname:d,pathnameBase:c,pattern:t}}function Op(t,r=!1,n=!0){At(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],o="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,h,u)=>(i.push({paramName:h,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),o+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":t!==""&&t!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,r?void 0:"i"),i]}function Ip(t){try{return t.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return At(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${r}).`),t}}function Cs(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let n=r.endsWith("/")?r.length-1:r.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}var zp=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fp=t=>zp.test(t);function Bp(t,r="/"){let{pathname:n,search:i="",hash:o=""}=typeof t=="string"?sa(t):t,d;if(n)if(Fp(n))d=n;else{if(n.includes("//")){let c=n;n=n.replace(/\/\/+/g,"/"),At(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${n}`)}n.startsWith("/")?d=Rd(n.substring(1),"/"):d=Rd(n,r)}else d=r;return{pathname:d,search:Hp(i),hash:Up(o)}}function Rd(t,r){let n=r.replace(/\/+$/,"").split("/");return t.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function $i(t,r,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${r}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function $p(t){return t.filter((r,n)=>n===0||r.route.path&&r.route.path.length>0)}function Jc(t){let r=$p(t);return r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase)}function Qc(t,r,n,i=!1){let o;typeof t=="string"?o=sa(t):(o={...t},Oe(!o.pathname||!o.pathname.includes("?"),$i("?","pathname","search",o)),Oe(!o.pathname||!o.pathname.includes("#"),$i("#","pathname","hash",o)),Oe(!o.search||!o.search.includes("#"),$i("#","search","hash",o)));let d=t===""||o.pathname==="",c=d?"/":o.pathname,h;if(c==null)h=n;else{let b=r.length-1;if(!i&&c.startsWith("..")){let g=c.split("/");for(;g[0]==="..";)g.shift(),b-=1;o.pathname=g.join("/")}h=b>=0?r[b]:"/"}let u=Bp(o,h),x=c&&c!=="/"&&c.endsWith("/"),p=(d||c===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(x||p)&&(u.pathname+="/"),u}var Ns=t=>t.join("/").replace(/\/\/+/g,"/"),Zp=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Hp=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Up=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Wp(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function Vp(t){return t.map(r=>r.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Yc=["POST","PUT","PATCH","DELETE"];new Set(Yc);var qp=["GET",...Yc];new Set(qp);var ra=f.createContext(null);ra.displayName="DataRouter";var Yn=f.createContext(null);Yn.displayName="DataRouterState";f.createContext(!1);var Xc=f.createContext({isTransitioning:!1});Xc.displayName="ViewTransition";var Gp=f.createContext(new Map);Gp.displayName="Fetchers";var Kp=f.createContext(null);Kp.displayName="Await";var Jt=f.createContext(null);Jt.displayName="Navigation";var qa=f.createContext(null);qa.displayName="Location";var cs=f.createContext({outlet:null,matches:[],isDataRoute:!1});cs.displayName="Route";var Wo=f.createContext(null);Wo.displayName="RouteError";function Jp(t,{relative:r}={}){Oe(Ga(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=f.useContext(Jt),{hash:o,pathname:d,search:c}=Ka(t,{relative:r}),h=d;return n!=="/"&&(h=d==="/"?n:Ns([n,d])),i.createHref({pathname:h,search:c,hash:o})}function Ga(){return f.useContext(qa)!=null}function Ls(){return Oe(Ga(),"useLocation() may be used only in the context of a <Router> component."),f.useContext(qa).location}var eu="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function tu(t){f.useContext(Jt).static||f.useLayoutEffect(t)}function Xn(){let{isDataRoute:t}=f.useContext(cs);return t?hf():Qp()}function Qp(){Oe(Ga(),"useNavigate() may be used only in the context of a <Router> component.");let t=f.useContext(ra),{basename:r,navigator:n}=f.useContext(Jt),{matches:i}=f.useContext(cs),{pathname:o}=Ls(),d=JSON.stringify(Jc(i)),c=f.useRef(!1);return tu(()=>{c.current=!0}),f.useCallback((u,x={})=>{if(At(c.current,eu),!c.current)return;if(typeof u=="number"){n.go(u);return}let p=Qc(u,JSON.parse(d),o,x.relative==="path");t==null&&r!=="/"&&(p.pathname=p.pathname==="/"?r:Ns([r,p.pathname])),(x.replace?n.replace:n.push)(p,x.state,x)},[r,n,d,o,t])}var Yp=f.createContext(null);function Xp(t){let r=f.useContext(cs).outlet;return f.useMemo(()=>r&&f.createElement(Yp.Provider,{value:t},r),[r,t])}function Ka(t,{relative:r}={}){let{matches:n}=f.useContext(cs),{pathname:i}=Ls(),o=JSON.stringify(Jc(n));return f.useMemo(()=>Qc(t,JSON.parse(o),i,r==="path"),[t,o,i,r])}function ef(t,r){return su(t,r)}function su(t,r,n,i,o){var S;Oe(Ga(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:d}=f.useContext(Jt),{matches:c}=f.useContext(cs),h=c[c.length-1],u=h?h.params:{},x=h?h.pathname:"/",p=h?h.pathnameBase:"/",b=h&&h.route;{let T=b&&b.path||"";ru(x,!b||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${x}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let g=Ls(),y;if(r){let T=typeof r=="string"?sa(r):r;Oe(p==="/"||((S=T.pathname)==null?void 0:S.startsWith(p)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),y=T}else y=g;let _=y.pathname||"/",w=_;if(p!=="/"){let T=p.replace(/^\//,"").split("/");w="/"+_.replace(/^\//,"").split("/").slice(T.length).join("/")}let j=qc(t,{pathname:w});At(b||j!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),At(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=nf(j&&j.map(T=>Object.assign({},T,{params:Object.assign({},u,T.params),pathname:Ns([p,d.encodeLocation?d.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:Ns([p,d.encodeLocation?d.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),c,n,i,o);return r&&C?f.createElement(qa.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...y},navigationType:"POP"}},C):C}function tf(){let t=uf(),r=Wp(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i},d={padding:"2px 4px",backgroundColor:i},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=f.createElement(f.Fragment,null,f.createElement("p",null," Hey developer "),f.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",f.createElement("code",{style:d},"ErrorBoundary")," or"," ",f.createElement("code",{style:d},"errorElement")," prop on your route.")),f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},r),n?f.createElement("pre",{style:o},n):null,c)}var sf=f.createElement(tf,null),rf=class extends f.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){this.props.onError?this.props.onError(t,r):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?f.createElement(cs.Provider,{value:this.props.routeContext},f.createElement(Wo.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function af({routeContext:t,match:r,children:n}){let i=f.useContext(ra);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),f.createElement(cs.Provider,{value:t},n)}function nf(t,r=[],n=null,i=null,o=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(r.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let d=t,c=n==null?void 0:n.errors;if(c!=null){let p=d.findIndex(b=>b.route.id&&(c==null?void 0:c[b.route.id])!==void 0);Oe(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),d=d.slice(0,Math.min(d.length,p+1))}let h=!1,u=-1;if(n)for(let p=0;p<d.length;p++){let b=d[p];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(u=p),b.route.id){let{loaderData:g,errors:y}=n,_=b.route.loader&&!g.hasOwnProperty(b.route.id)&&(!y||y[b.route.id]===void 0);if(b.route.lazy||_){h=!0,u>=0?d=d.slice(0,u+1):d=[d[0]];break}}}let x=n&&i?(p,b)=>{var g,y;i(p,{location:n.location,params:((y=(g=n.matches)==null?void 0:g[0])==null?void 0:y.params)??{},unstable_pattern:Vp(n.matches),errorInfo:b})}:void 0;return d.reduceRight((p,b,g)=>{let y,_=!1,w=null,j=null;n&&(y=c&&b.route.id?c[b.route.id]:void 0,w=b.route.errorElement||sf,h&&(u<0&&g===0?(ru("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,j=null):u===g&&(_=!0,j=b.route.hydrateFallbackElement||null)));let C=r.concat(d.slice(0,g+1)),S=()=>{let T;return y?T=w:_?T=j:b.route.Component?T=f.createElement(b.route.Component,null):b.route.element?T=b.route.element:T=p,f.createElement(af,{match:b,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:T})};return n&&(b.route.ErrorBoundary||b.route.errorElement||g===0)?f.createElement(rf,{location:n.location,revalidation:n.revalidation,component:w,error:y,children:S(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:x}):S()},null)}function Vo(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function of(t){let r=f.useContext(ra);return Oe(r,Vo(t)),r}function lf(t){let r=f.useContext(Yn);return Oe(r,Vo(t)),r}function df(t){let r=f.useContext(cs);return Oe(r,Vo(t)),r}function qo(t){let r=df(t),n=r.matches[r.matches.length-1];return Oe(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function cf(){return qo("useRouteId")}function uf(){var i;let t=f.useContext(Wo),r=lf("useRouteError"),n=qo("useRouteError");return t!==void 0?t:(i=r.errors)==null?void 0:i[n]}function hf(){let{router:t}=of("useNavigate"),r=qo("useNavigate"),n=f.useRef(!1);return tu(()=>{n.current=!0}),f.useCallback(async(o,d={})=>{At(n.current,eu),n.current&&(typeof o=="number"?await t.navigate(o):await t.navigate(o,{fromRouteId:r,...d}))},[t,r])}var Md={};function ru(t,r,n){!r&&!Md[t]&&(Md[t]=!0,At(!1,n))}f.memo(mf);function mf({routes:t,future:r,state:n,unstable_onError:i}){return su(t,void 0,n,i,r)}function xf(t){return Xp(t.context)}function ys(t){Oe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function pf({basename:t="/",children:r=null,location:n,navigationType:i="POP",navigator:o,static:d=!1,unstable_useTransitions:c}){Oe(!Ga(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=t.replace(/^\/*/,"/"),u=f.useMemo(()=>({basename:h,navigator:o,static:d,unstable_useTransitions:c,future:{}}),[h,o,d,c]);typeof n=="string"&&(n=sa(n));let{pathname:x="/",search:p="",hash:b="",state:g=null,key:y="default"}=n,_=f.useMemo(()=>{let w=Cs(x,h);return w==null?null:{location:{pathname:w,search:p,hash:b,state:g,key:y},navigationType:i}},[h,x,p,b,g,y,i]);return At(_!=null,`<Router basename="${h}"> is not able to match the URL "${x}${p}${b}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:f.createElement(Jt.Provider,{value:u},f.createElement(qa.Provider,{children:r,value:_}))}function ff({children:t,location:r}){return ef(po(t),r)}function po(t,r=[]){let n=[];return f.Children.forEach(t,(i,o)=>{if(!f.isValidElement(i))return;let d=[...r,o];if(i.type===f.Fragment){n.push.apply(n,po(i.props.children,d));return}Oe(i.type===ys,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Oe(!i.props.index||!i.props.children,"An index route cannot have child routes.");let c={id:i.props.id||d.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(c.children=po(i.props.children,d)),n.push(c)}),n}var Pn="get",Tn="application/x-www-form-urlencoded";function ei(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function gf(t){return ei(t)&&t.tagName.toLowerCase()==="button"}function bf(t){return ei(t)&&t.tagName.toLowerCase()==="form"}function yf(t){return ei(t)&&t.tagName.toLowerCase()==="input"}function vf(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function _f(t,r){return t.button===0&&(!r||r==="_self")&&!vf(t)}function fo(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((r,n)=>{let i=t[n];return r.concat(Array.isArray(i)?i.map(o=>[n,o]):[[n,i]])},[]))}function jf(t,r){let n=fo(t);return r&&r.forEach((i,o)=>{n.has(o)||r.getAll(o).forEach(d=>{n.append(o,d)})}),n}var bn=null;function wf(){if(bn===null)try{new FormData(document.createElement("form"),0),bn=!1}catch{bn=!0}return bn}var Nf=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zi(t){return t!=null&&!Nf.has(t)?(At(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Tn}"`),null):t}function kf(t,r){let n,i,o,d,c;if(bf(t)){let h=t.getAttribute("action");i=h?Cs(h,r):null,n=t.getAttribute("method")||Pn,o=Zi(t.getAttribute("enctype"))||Tn,d=new FormData(t)}else if(gf(t)||yf(t)&&(t.type==="submit"||t.type==="image")){let h=t.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=t.getAttribute("formaction")||h.getAttribute("action");if(i=u?Cs(u,r):null,n=t.getAttribute("formmethod")||h.getAttribute("method")||Pn,o=Zi(t.getAttribute("formenctype"))||Zi(h.getAttribute("enctype"))||Tn,d=new FormData(h,t),!wf()){let{name:x,type:p,value:b}=t;if(p==="image"){let g=x?`${x}.`:"";d.append(`${g}x`,"0"),d.append(`${g}y`,"0")}else x&&d.append(x,b)}}else{if(ei(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Pn,i=null,o=Tn,c=t}return d&&o==="text/plain"&&(c=d,d=void 0),{action:i,method:n.toLowerCase(),encType:o,formData:d,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Go(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function Cf(t,r,n){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return i.pathname==="/"?i.pathname=`_root.${n}`:r&&Cs(i.pathname,r)==="/"?i.pathname=`${r.replace(/\/$/,"")}/_root.${n}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${n}`,i}async function Sf(t,r){if(t.id in r)return r[t.id];try{let n=await import(t.module);return r[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Pf(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function Tf(t,r,n){let i=await Promise.all(t.map(async o=>{let d=r.routes[o.route.id];if(d){let c=await Sf(d,n);return c.links?c.links():[]}return[]}));return Mf(i.flat(1).filter(Pf).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function Dd(t,r,n,i,o,d){let c=(u,x)=>n[x]?u.route.id!==n[x].route.id:!0,h=(u,x)=>{var p;return n[x].pathname!==u.pathname||((p=n[x].route.path)==null?void 0:p.endsWith("*"))&&n[x].params["*"]!==u.params["*"]};return d==="assets"?r.filter((u,x)=>c(u,x)||h(u,x)):d==="data"?r.filter((u,x)=>{var b;let p=i.routes[u.route.id];if(!p||!p.hasLoader)return!1;if(c(u,x)||h(u,x))return!0;if(u.route.shouldRevalidate){let g=u.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:((b=n[0])==null?void 0:b.params)||{},nextUrl:new URL(t,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function Lf(t,r,{includeHydrateFallback:n}={}){return Ef(t.map(i=>{let o=r.routes[i.route.id];if(!o)return[];let d=[o.module];return o.clientActionModule&&(d=d.concat(o.clientActionModule)),o.clientLoaderModule&&(d=d.concat(o.clientLoaderModule)),n&&o.hydrateFallbackModule&&(d=d.concat(o.hydrateFallbackModule)),o.imports&&(d=d.concat(o.imports)),d}).flat(1))}function Ef(t){return[...new Set(t)]}function Rf(t){let r={},n=Object.keys(t).sort();for(let i of n)r[i]=t[i];return r}function Mf(t,r){let n=new Set;return new Set(r),t.reduce((i,o)=>{let d=JSON.stringify(Rf(o));return n.has(d)||(n.add(d),i.push({key:d,link:o})),i},[])}function au(){let t=f.useContext(ra);return Go(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Df(){let t=f.useContext(Yn);return Go(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Ko=f.createContext(void 0);Ko.displayName="FrameworkContext";function nu(){let t=f.useContext(Ko);return Go(t,"You must render this element inside a <HydratedRouter> element"),t}function Af(t,r){let n=f.useContext(Ko),[i,o]=f.useState(!1),[d,c]=f.useState(!1),{onFocus:h,onBlur:u,onMouseEnter:x,onMouseLeave:p,onTouchStart:b}=r,g=f.useRef(null);f.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let w=C=>{C.forEach(S=>{c(S.isIntersecting)})},j=new IntersectionObserver(w,{threshold:.5});return g.current&&j.observe(g.current),()=>{j.disconnect()}}},[t]),f.useEffect(()=>{if(i){let w=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(w)}}},[i]);let y=()=>{o(!0)},_=()=>{o(!1),c(!1)};return n?t!=="intent"?[d,g,{}]:[d,g,{onFocus:wa(h,y),onBlur:wa(u,_),onMouseEnter:wa(x,y),onMouseLeave:wa(p,_),onTouchStart:wa(b,y)}]:[!1,g,{}]}function wa(t,r){return n=>{t&&t(n),n.defaultPrevented||r(n)}}function Of({page:t,...r}){let{router:n}=au(),i=f.useMemo(()=>qc(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?f.createElement(zf,{page:t,matches:i,...r}):null}function If(t){let{manifest:r,routeModules:n}=nu(),[i,o]=f.useState([]);return f.useEffect(()=>{let d=!1;return Tf(t,r,n).then(c=>{d||o(c)}),()=>{d=!0}},[t,r,n]),i}function zf({page:t,matches:r,...n}){let i=Ls(),{manifest:o,routeModules:d}=nu(),{basename:c}=au(),{loaderData:h,matches:u}=Df(),x=f.useMemo(()=>Dd(t,r,u,o,i,"data"),[t,r,u,o,i]),p=f.useMemo(()=>Dd(t,r,u,o,i,"assets"),[t,r,u,o,i]),b=f.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let _=new Set,w=!1;if(r.forEach(C=>{var T;let S=o.routes[C.route.id];!S||!S.hasLoader||(!x.some(E=>E.route.id===C.route.id)&&C.route.id in h&&((T=d[C.route.id])!=null&&T.shouldRevalidate)||S.hasClientLoader?w=!0:_.add(C.route.id))}),_.size===0)return[];let j=Cf(t,c,"data");return w&&_.size>0&&j.searchParams.set("_routes",r.filter(C=>_.has(C.route.id)).map(C=>C.route.id).join(",")),[j.pathname+j.search]},[c,h,i,o,x,r,t,d]),g=f.useMemo(()=>Lf(p,o),[p,o]),y=If(p);return f.createElement(f.Fragment,null,b.map(_=>f.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...n})),g.map(_=>f.createElement("link",{key:_,rel:"modulepreload",href:_,...n})),y.map(({key:_,link:w})=>f.createElement("link",{key:_,nonce:n.nonce,...w})))}function Ff(...t){return r=>{t.forEach(n=>{typeof n=="function"?n(r):n!=null&&(n.current=r)})}}var iu=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{iu&&(window.__reactRouterVersion="7.10.1")}catch{}function Bf({basename:t,children:r,unstable_useTransitions:n,window:i}){let o=f.useRef();o.current==null&&(o.current=_p({window:i,v5Compat:!0}));let d=o.current,[c,h]=f.useState({action:d.action,location:d.location}),u=f.useCallback(x=>{n===!1?h(x):f.startTransition(()=>h(x))},[n]);return f.useLayoutEffect(()=>d.listen(u),[d,u]),f.createElement(pf,{basename:t,children:r,location:c.location,navigationType:c.action,navigator:d,unstable_useTransitions:n===!0})}var ou=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xr=f.forwardRef(function({onClick:r,discover:n="render",prefetch:i="none",relative:o,reloadDocument:d,replace:c,state:h,target:u,to:x,preventScrollReset:p,viewTransition:b,...g},y){let{basename:_,unstable_useTransitions:w}=f.useContext(Jt),j=typeof x=="string"&&ou.test(x),C,S=!1;if(typeof x=="string"&&j&&(C=x,iu))try{let z=new URL(window.location.href),I=x.startsWith("//")?new URL(z.protocol+x):new URL(x),F=Cs(I.pathname,_);I.origin===z.origin&&F!=null?x=F+I.search+I.hash:S=!0}catch{At(!1,`<Link to="${x}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let T=Jp(x,{relative:o}),[E,P,A]=Af(i,g),R=Uf(x,{replace:c,state:h,target:u,preventScrollReset:p,relative:o,viewTransition:b,unstable_useTransitions:w});function N(z){r&&r(z),z.defaultPrevented||R(z)}let M=f.createElement("a",{...g,...A,href:C||T,onClick:S||d?r:N,ref:Ff(y,P),target:u,"data-discover":!j&&n==="render"?"true":void 0});return E&&!j?f.createElement(f.Fragment,null,M,f.createElement(Of,{page:T})):M});Xr.displayName="Link";var $f=f.forwardRef(function({"aria-current":r="page",caseSensitive:n=!1,className:i="",end:o=!1,style:d,to:c,viewTransition:h,children:u,...x},p){let b=Ka(c,{relative:x.relative}),g=Ls(),y=f.useContext(Yn),{navigator:_,basename:w}=f.useContext(Jt),j=y!=null&&Kf(b)&&h===!0,C=_.encodeLocation?_.encodeLocation(b).pathname:b.pathname,S=g.pathname,T=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;n||(S=S.toLowerCase(),T=T?T.toLowerCase():null,C=C.toLowerCase()),T&&w&&(T=Cs(T,w)||T);const E=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let P=S===C||!o&&S.startsWith(C)&&S.charAt(E)==="/",A=T!=null&&(T===C||!o&&T.startsWith(C)&&T.charAt(C.length)==="/"),R={isActive:P,isPending:A,isTransitioning:j},N=P?r:void 0,M;typeof i=="function"?M=i(R):M=[i,P?"active":null,A?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let z=typeof d=="function"?d(R):d;return f.createElement(Xr,{...x,"aria-current":N,className:M,ref:p,style:z,to:c,viewTransition:h},typeof u=="function"?u(R):u)});$f.displayName="NavLink";var Zf=f.forwardRef(({discover:t="render",fetcherKey:r,navigate:n,reloadDocument:i,replace:o,state:d,method:c=Pn,action:h,onSubmit:u,relative:x,preventScrollReset:p,viewTransition:b,...g},y)=>{let{unstable_useTransitions:_}=f.useContext(Jt),w=qf(),j=Gf(h,{relative:x}),C=c.toLowerCase()==="get"?"get":"post",S=typeof h=="string"&&ou.test(h),T=E=>{if(u&&u(E),E.defaultPrevented)return;E.preventDefault();let P=E.nativeEvent.submitter,A=(P==null?void 0:P.getAttribute("formmethod"))||c,R=()=>w(P||E.currentTarget,{fetcherKey:r,method:A,navigate:n,replace:o,state:d,relative:x,preventScrollReset:p,viewTransition:b});_&&n!==!1?f.startTransition(()=>R()):R()};return f.createElement("form",{ref:y,method:C,action:j,onSubmit:i?u:T,...g,"data-discover":!S&&t==="render"?"true":void 0})});Zf.displayName="Form";function Hf(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lu(t){let r=f.useContext(ra);return Oe(r,Hf(t)),r}function Uf(t,{target:r,replace:n,state:i,preventScrollReset:o,relative:d,viewTransition:c,unstable_useTransitions:h}={}){let u=Xn(),x=Ls(),p=Ka(t,{relative:d});return f.useCallback(b=>{if(_f(b,r)){b.preventDefault();let g=n!==void 0?n:Oa(x)===Oa(p),y=()=>u(t,{replace:g,state:i,preventScrollReset:o,relative:d,viewTransition:c});h?f.startTransition(()=>y()):y()}},[x,u,p,n,i,r,t,o,d,c,h])}function du(t){At(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let r=f.useRef(fo(t)),n=f.useRef(!1),i=Ls(),o=f.useMemo(()=>jf(i.search,n.current?null:r.current),[i.search]),d=Xn(),c=f.useCallback((h,u)=>{const x=fo(typeof h=="function"?h(new URLSearchParams(o)):h);n.current=!0,d("?"+x,u)},[d,o]);return[o,c]}var Wf=0,Vf=()=>`__${String(++Wf)}__`;function qf(){let{router:t}=lu("useSubmit"),{basename:r}=f.useContext(Jt),n=cf(),i=t.fetch,o=t.navigate;return f.useCallback(async(d,c={})=>{let{action:h,method:u,encType:x,formData:p,body:b}=kf(d,r);if(c.navigate===!1){let g=c.fetcherKey||Vf();await i(g,n,c.action||h,{preventScrollReset:c.preventScrollReset,formData:p,body:b,formMethod:c.method||u,formEncType:c.encType||x,flushSync:c.flushSync})}else await o(c.action||h,{preventScrollReset:c.preventScrollReset,formData:p,body:b,formMethod:c.method||u,formEncType:c.encType||x,replace:c.replace,state:c.state,fromRouteId:n,flushSync:c.flushSync,viewTransition:c.viewTransition})},[i,o,r,n])}function Gf(t,{relative:r}={}){let{basename:n}=f.useContext(Jt),i=f.useContext(cs);Oe(i,"useFormAction must be used inside a RouteContext");let[o]=i.matches.slice(-1),d={...Ka(t||".",{relative:r})},c=Ls();if(t==null){d.search=c.search;let h=new URLSearchParams(d.search),u=h.getAll("index");if(u.some(p=>p==="")){h.delete("index"),u.filter(b=>b).forEach(b=>h.append("index",b));let p=h.toString();d.search=p?`?${p}`:""}}return(!t||t===".")&&o.route.index&&(d.search=d.search?d.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(d.pathname=d.pathname==="/"?n:Ns([n,d.pathname])),Oa(d)}function Kf(t,{relative:r}={}){let n=f.useContext(Xc);Oe(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=lu("useViewTransitionState"),o=Ka(t,{relative:r});if(!n.isTransitioning)return!1;let d=Cs(n.currentLocation.pathname,i)||n.currentLocation.pathname,c=Cs(n.nextLocation.pathname,i)||n.nextLocation.pathname;return zn(o.pathname,c)!=null||zn(o.pathname,d)!=null}const Jf=()=>{const t=Ls(),[r,n]=f.useState(!1);f.useEffect(()=>{document.documentElement.classList.contains("dark")?n(!0):window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.classList.add("dark"),n(!0))},[]);const i=()=>{const c=!r;n(c),c?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},o=c=>t.pathname===c,d=t.pathname==="/canvas"||t.pathname==="/eda";return e.jsxs("div",{className:"flex h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-200",children:[e.jsxs("aside",{className:`${d?"w-16":"w-64"} bg-slate-900 dark:bg-slate-950 text-white flex flex-col shrink-0 transition-all duration-200`,children:[e.jsxs("div",{className:`${d?"p-4":"p-6"} border-b border-slate-800 dark:border-slate-900 flex items-center ${d?"justify-center":"gap-3"}`,children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center font-bold text-lg shrink-0 shadow-lg shadow-blue-900/20",children:"S"}),!d&&e.jsx("h1",{className:"text-xl font-bold tracking-tight whitespace-nowrap bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent",children:"Skyulf ML"})]}),e.jsxs("nav",{className:"flex-1 p-2 space-y-2",children:[e.jsx(nr,{to:"/",active:o("/"),icon:e.jsx(Eo,{size:20}),collapsed:d,children:"Dashboard"}),e.jsx(nr,{to:"/jobs",active:o("/jobs"),icon:e.jsx(Ve,{size:20}),collapsed:d,children:"Jobs"}),e.jsx(nr,{to:"/eda",active:o("/eda"),icon:e.jsx(ks,{size:20}),collapsed:d,children:"EDA"}),e.jsx(nr,{to:"/canvas",active:o("/canvas"),icon:e.jsx(Ra,{size:20}),collapsed:d,children:"ML Canvas"}),e.jsx(nr,{to:"/data",active:o("/data"),icon:e.jsx(ft,{size:20}),collapsed:d,children:"Data Sources"}),e.jsx(nr,{to:"/registry",active:o("/registry"),icon:e.jsx(Ji,{size:20}),collapsed:d,children:"Model Registry"}),e.jsx(nr,{to:"/deployments",active:o("/deployments"),icon:e.jsx(qn,{size:20}),collapsed:d,children:"Deployments"})]}),e.jsx("div",{className:`${d?"p-2":"p-4"} border-t border-slate-800 space-y-4`,children:e.jsxs("button",{onClick:i,className:`flex items-center ${d?"justify-center":"gap-3"} w-full ${d?"px-2":"px-4"} py-2 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-colors`,title:r?"Light Mode":"Dark Mode",children:[r?e.jsx(Hm,{size:20}):e.jsx(Um,{size:20}),!d&&(r?"Light Mode":"Dark Mode")]})})]}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsx(xf,{})})]})},nr=({to:t,children:r,active:n,icon:i,collapsed:o})=>e.jsxs(Xr,{to:t,className:`flex items-center ${o?"justify-center":"gap-3"} ${o?"px-2":"px-4"} py-3 rounded-md text-sm font-medium transition-colors ${n?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-800"}`,title:o?r:void 0,children:[i,!o&&r]}),Qf="/api",Ae=Is.create({baseURL:Qf,headers:{"Content-Type":"application/json"}}),Yf=async t=>(await Ae.post("/pipeline/preview",t)).data,Xf=async t=>(await Ae.get(`/pipeline/datasets/${t}/schema`)).data,eg=async(t,r)=>(await Ae.post(`/pipeline/save/${t}`,r)).data,tg=async t=>{const r=await Ae.get(`/pipeline/load/${t}`);return r.data?r.data:null},$e={runPipeline:async t=>(await Ae.post("/pipeline/run",t)).data,getJob:async t=>(await Ae.get(`/pipeline/jobs/${t}`)).data,cancelJob:async t=>{await Ae.post(`/pipeline/jobs/${t}/cancel`)},getJobs:async(t=10,r=0,n)=>{const i={limit:t,skip:r};return n&&(i.job_type=n),(await Ae.get("/pipeline/jobs",{params:i})).data},getEDAJobs:async(t=50)=>(await Ae.get("/eda/jobs/all",{params:{limit:t}})).data.map(n=>({job_id:String(n.id),pipeline_id:"eda",node_id:"eda",dataset_id:String(n.dataset_id),dataset_name:n.dataset_name,job_type:"eda",status:n.status.toLowerCase(),start_time:n.created_at,end_time:n.updated_at||n.created_at,error:n.error,result:null,created_at:n.created_at,target_column:n.target_col})),getIngestionJobs:async(t=50,r=0)=>(await Is.get("/data/api/sources",{params:{limit:t,skip:r}})).data.sources.map(i=>({job_id:String(i.id),pipeline_id:"ingestion",node_id:"ingestion",dataset_id:String(i.id),dataset_name:i.name,job_type:"ingestion",status:i.test_status==="success"?"succeeded":i.test_status==="failed"?"failed":"completed",start_time:i.created_at,end_time:i.updated_at,error:null,result:null,created_at:i.created_at,model_type:i.type})),getHyperparameters:async t=>(await Ae.get(`/pipeline/hyperparameters/${t}`)).data,getDefaultSearchSpace:async t=>(await Ae.get(`/pipeline/hyperparameters/${t}/defaults`)).data,getLatestTuningJob:async t=>(await Ae.get(`/pipeline/jobs/tuning/latest/${t}`)).data,getBestTuningJob:async t=>(await Ae.get(`/pipeline/jobs/tuning/best/${t}`)).data,getTuningHistory:async t=>(await Ae.get(`/pipeline/jobs/tuning/history/${t}`)).data},yn=["#10B981","#EF4444","#F59E0B","#3B82F6"],Ad=t=>typeof t=="object"&&t!==null,sg=()=>{const[t,r]=f.useState(null),[n,i]=f.useState([]),[o,d]=f.useState(!0),[c,h]=f.useState({statusDist:[],dailyActivity:[]});return f.useEffect(()=>{(async()=>{try{const[x,p]=await Promise.all([Ae.get("/pipeline/stats"),$e.getJobs(50,0)]);r(x.data);const b=p.map(j=>({id:j.job_id,status:j.status,model_type:j.model_type||"Unknown",created_at:j.start_time||j.created_at||new Date().toISOString(),metrics:(()=>{const C=j.metrics??(Ad(j.result)?j.result.metrics:void 0);return Ad(C)?C:void 0})()}));i(b);const g=b.reduce((j,C)=>(j[C.status]=(j[C.status]||0)+1,j),{}),y=Object.entries(g).map(([j,C])=>({name:j,value:C})),w=[...Array(7)].map((j,C)=>{const S=new Date;return S.setDate(S.getDate()-C),S.toISOString().split("T")[0]}).reverse().map(j=>({date:new Date(j).toLocaleDateString("en-US",{month:"short",day:"numeric"}),count:b.filter(C=>C.created_at.startsWith(j)).length}));h({statusDist:y,dailyActivity:w})}catch(x){console.error("Failed to fetch dashboard data:",x)}finally{d(!1)}})()},[]),e.jsxs("div",{className:"p-8 space-y-8 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Dashboard"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Overview of your ML pipeline activities"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(Xr,{to:"/canvas",className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md shadow-sm transition-all",children:[e.jsx(Ut,{size:18}),"New Experiment"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(vn,{title:"Total Jobs",value:(t==null?void 0:t.total_jobs)??"-",icon:e.jsx(Ve,{className:"text-indigo-500"}),subtext:`${(t==null?void 0:t.training_jobs)??0} Training, ${(t==null?void 0:t.tuning_jobs)??0} Tuning`}),e.jsx(vn,{title:"Active Deployments",value:(t==null?void 0:t.active_deployments)??"-",icon:e.jsx(hd,{className:"text-green-500"}),color:"text-green-600 dark:text-green-400"}),e.jsx(vn,{title:"Data Sources",value:(t==null?void 0:t.data_sources)??"-",icon:e.jsx(ft,{className:"text-blue-500"})}),e.jsx(vn,{title:"Success Rate",value:n.length>0?`${Math.round(n.filter(u=>u.status==="succeeded"||u.status==="completed").length/n.length*100)}%`:"-",icon:e.jsx(at,{className:"text-emerald-500"}),subtext:"Last 50 jobs"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6 text-slate-900 dark:text-slate-100",children:"Weekly Activity"}),e.jsx("div",{className:"h-64",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:c.dailyActivity,children:[e.jsx(vt,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),e.jsx(_t,{dataKey:"date",stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(jt,{stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1,allowDecimals:!1}),e.jsx(it,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#f8fafc"},cursor:{fill:"#f1f5f9"}}),e.jsx(Mt,{dataKey:"count",fill:"#6366f1",radius:[4,4,0,0],barSize:30})]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6 text-slate-900 dark:text-slate-100",children:"Job Status Distribution"}),e.jsx("div",{className:"h-64",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(yc,{children:[e.jsx(vc,{data:c.statusDist,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:c.statusDist.map((u,x)=>e.jsx(Ea,{fill:u.name==="succeeded"?yn[0]:u.name==="failed"?yn[1]:u.name==="running"?yn[3]:yn[2]},`cell-${x}`))}),e.jsx(it,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#f8fafc"}}),e.jsx(Wn,{verticalAlign:"bottom",height:36,iconType:"circle"})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Recent Jobs"}),e.jsxs(Xr,{to:"/jobs",className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1",children:["View All ",e.jsx(wc,{size:14})]})]}),o?e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Loading..."}):n.length===0?e.jsx("div",{className:"p-8 text-center text-slate-500",children:"No recent jobs found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Job ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Model"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Time"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:n.slice(0,5).map(u=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(rg,{status:u.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-slate-100",children:e.jsx("span",{className:"font-mono text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded",children:u.id.substring(0,8)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:u.model_type}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:[new Date(u.created_at).toLocaleDateString()," ",e.jsx("span",{className:"text-xs opacity-70",children:new Date(u.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},u.id))})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-900 dark:text-slate-100",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(_n,{to:"/data",icon:e.jsx(ft,{size:18,className:"text-blue-500"}),title:"Manage Data Sources",desc:"Upload or connect new data"}),e.jsx(_n,{to:"/canvas",icon:e.jsx(Wt,{size:18,className:"text-indigo-500"}),title:"Run Pipeline",desc:"Create and execute ML workflows"}),e.jsx(_n,{to:"/deployments",icon:e.jsx(hd,{size:18,className:"text-green-500"}),title:"View Deployments",desc:"Monitor active model endpoints"}),e.jsx(_n,{to:"/settings",icon:e.jsx(Wm,{size:18,className:"text-slate-500"}),title:"Settings",desc:"Configure system preferences"})]})]})]})]})},vn=({title:t,value:r,icon:n,subtext:i,color:o="text-slate-900 dark:text-slate-100"})=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:t}),e.jsx("div",{className:`mt-2 text-3xl font-bold ${o}`,children:r})]}),n&&e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-full",children:n})]}),i&&e.jsxs("div",{className:"mt-2 text-xs text-slate-400 dark:text-slate-500 flex items-center gap-1",children:[e.jsx(Ve,{size:12})," ",i]})]}),rg=({status:t})=>{const r={succeeded:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",completed:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",failed:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",running:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"},n={succeeded:e.jsx(at,{size:14}),completed:e.jsx(at,{size:14}),failed:e.jsx(Wa,{size:14}),running:e.jsx(Ve,{size:14,className:"animate-pulse"}),pending:e.jsx(Ht,{size:14})},i=t.toLowerCase(),o=r[i]||"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400",d=n[i]||e.jsx(Ht,{size:14});return e.jsxs("span",{className:`px-2.5 py-1 inline-flex items-center gap-1.5 text-xs font-medium rounded-full ${o}`,children:[d,t.charAt(0).toUpperCase()+t.slice(1)]})},_n=({to:t,icon:r,title:n,desc:i})=>e.jsxs(Xr,{to:t,className:"flex items-center gap-4 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors border border-transparent hover:border-slate-200 dark:hover:border-slate-600 group",children:[e.jsx("div",{className:"bg-white dark:bg-slate-700 p-2 rounded-md shadow-sm group-hover:scale-110 transition-transform",children:r}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm",children:n}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:i})]}),e.jsx(wc,{size:14,className:"ml-auto text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity"})]}),Na="/data/api",jn="/api/ingestion",Dt={getAll:async()=>{const t=await fetch(`${Na}/sources`);if(!t.ok)throw new Error("Failed to fetch datasets");return(await t.json()).sources||[]},getUsable:async()=>{const t=await fetch(`${Na}/sources/usable`);if(!t.ok)throw new Error("Failed to fetch usable datasets");return(await t.json()).sources||[]},upload:async t=>{const r=new FormData;r.append("file",t);const n=await fetch(`${jn}/upload`,{method:"POST",body:r});if(!n.ok){const i=await n.json();throw new Error(i.detail||"Failed to upload file")}return await n.json()},createSource:async t=>{const r=await fetch(`${jn}/database`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const n=await r.json();throw new Error(n.detail||"Failed to create data source")}return await r.json()},getIngestionStatus:async t=>{const r=await fetch(`${jn}/${encodeURIComponent(t)}/status`);if(!r.ok)throw new Error("Failed to fetch ingestion status");return await r.json()},cancelIngestion:async t=>{const r=await fetch(`${jn}/${encodeURIComponent(t)}/cancel`,{method:"POST"});if(!r.ok){const n=await r.json();throw new Error(n.detail||"Failed to cancel ingestion")}},getById:async t=>{const r=await fetch(`${Na}/sources/${encodeURIComponent(t)}`);if(!r.ok)throw new Error("Failed to fetch dataset");return(await r.json()).source},getSample:async(t,r=1)=>{const n=new URLSearchParams({limit:r.toString()}),i=await fetch(`${Na}/sources/${encodeURIComponent(t)}/sample?${n.toString()}`);if(!i.ok)throw new Error("Failed to fetch dataset sample");return(await i.json()).data},getProfile:async t=>{const r=await fetch(`/api/pipeline/datasets/${encodeURIComponent(t)}/schema`);if(!r.ok)throw new Error("Failed to fetch dataset profile");const n=await r.json(),i=Object.values(n.columns).map(c=>{const h=c;return{name:h.name,dtype:h.dtype,missing_count:h.missing_count||0,missing_percentage:(h.missing_ratio||0)*100,distinct_count:h.unique_count||0,numeric_summary:h.column_type==="numeric"?{mean:h.mean_value,std:h.std_value,minimum:h.min_value,maximum:h.max_value}:void 0}}),o=n.row_count*n.column_count,d=i.reduce((c,h)=>c+h.missing_count,0);return{metrics:{row_count:n.row_count,column_count:n.column_count,missing_cells:d,missing_percentage:o>0?Number((d/o*100).toFixed(2)):0},columns:i}},delete:async t=>{if(!(await fetch(`${Na}/sources/${encodeURIComponent(t)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete dataset")}},cu=({onUploadComplete:t,onCancel:r})=>{const[n,i]=f.useState(!1),[o,d]=f.useState(!1),[c,h]=f.useState(null),[u,x]=f.useState(0),p=f.useCallback(_=>{_.preventDefault(),_.stopPropagation(),_.type==="dragenter"||_.type==="dragover"?i(!0):_.type==="dragleave"&&i(!1)},[]),b=f.useCallback(_=>{_.preventDefault(),_.stopPropagation(),i(!1),_.dataTransfer.files&&_.dataTransfer.files[0]&&y(_.dataTransfer.files[0])},[]),g=_=>{_.preventDefault(),_.target.files&&_.target.files[0]&&y(_.target.files[0])},y=async _=>{d(!0),h(null),x(0);try{const w=await Dt.upload(_);t(w.job_id,_.name)}catch(w){console.error("Upload failed:",w),h(w.message||"Failed to upload file. Please try again.")}finally{d(!1)}};return e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50 dark:bg-slate-900 dark:border-slate-700 relative",children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full text-slate-500 dark:text-slate-400",children:e.jsx(We,{size:16})}),e.jsxs("h3",{className:"font-medium mb-4 flex items-center gap-2 text-slate-900 dark:text-slate-100",children:[e.jsx(Vm,{size:18,className:"text-blue-600 dark:text-blue-400"}),"Upload New Dataset"]}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${n?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-slate-300 dark:border-slate-700 hover:border-slate-400 dark:hover:border-slate-600"}`,onDragEnter:p,onDragLeave:p,onDragOver:p,onDrop:b,children:o?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${u}%`}})}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["Uploading... ",u,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(qm,{className:"w-10 h-10 text-slate-400 dark:text-slate-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-2",children:["Drag and drop your file here, or"," ",e.jsxs("label",{className:"text-blue-600 dark:text-blue-400 hover:underline cursor-pointer font-medium",children:["browse",e.jsx("input",{type:"file",className:"hidden",accept:".csv,.xlsx,.parquet,.json",onChange:g})]})]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Supports CSV, Excel, Parquet, JSON"})]})}),c&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 text-sm rounded-md flex items-start gap-2",children:[e.jsx(lt,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("span",{children:c})]})]})},uu=(t,r=2)=>{if(!+t)return"0 Bytes";const n=1024,i=r<0?0:r,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],d=Math.floor(Math.log(t)/Math.log(n));return`${parseFloat((t/Math.pow(n,d)).toFixed(i))} ${o[d]}`},ag=({dataset:t,isOpen:r,onClose:n})=>{const[i,o]=f.useState([]),[d,c]=f.useState(null),[h,u]=f.useState(!1),[x,p]=f.useState(null),[b,g]=f.useState("sample"),[y,_]=f.useState(100);f.useEffect(()=>{r&&t?w(100):(o([]),c(null),p(null),g("sample"),_(100))},[r,t]);const w=async P=>{if(t){u(!0),p(null);try{const[A,R]=await Promise.all([Dt.getSample(t.id,P),Dt.getProfile(t.id)]);o(A),c(R)}catch(A){console.error("Failed to fetch data:",A),p("Failed to load dataset preview.")}finally{u(!1)}}},j=()=>{const P=y+500;_(P),w(P)};if(!r||!t)return null;const C=i.length>0?Object.keys(i[0]):[],S=(d==null?void 0:d.metrics.row_count)??t.rows??0,T=(d==null?void 0:d.metrics.column_count)??t.columns??0,E=t.size_bytes??0;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col border border-slate-200 dark:border-slate-700 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-blue-600 dark:text-blue-400",children:e.jsx(ft,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500 dark:text-slate-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(br,{size:14})," ",t.format||"CSV"]}),e.jsx("span",{children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Gm,{size:14})," ",S.toLocaleString()," rows"]}),e.jsx("span",{children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Nc,{size:14})," ",T," columns"]}),e.jsx("span",{children:""}),e.jsx("span",{children:uu(E)})]})]})]}),e.jsx("button",{onClick:n,className:"p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(We,{size:20})})]}),e.jsxs("div",{className:"flex border-b border-slate-200 dark:border-slate-700 px-6",children:[e.jsx("button",{onClick:()=>{g("sample")},className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${b==="sample"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400":"border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}`,children:"Data Sample"}),e.jsx("button",{onClick:()=>{g("stats")},className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${b==="stats"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400":"border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}`,children:"Statistics"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:h?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-500",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{children:"Loading preview data..."})]}):x?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-900/20",children:[e.jsx("p",{children:x}),e.jsx("button",{onClick:()=>{w(y)},className:"mt-4 px-4 py-2 bg-white dark:bg-slate-800 border border-red-200 dark:border-red-800 rounded-md text-sm font-medium hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:"Retry"})]}):b==="sample"?i.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500",children:"No data available to preview."}):C.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500",children:"Data loaded but no columns found."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10",children:e.jsx("tr",{children:C.map(P=>e.jsx("th",{className:"px-4 py-3 font-semibold whitespace-nowrap bg-slate-50 dark:bg-slate-800",children:P},P))})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900",children:i.map((P,A)=>e.jsx("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:C.map(R=>e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-700 dark:text-slate-300",children:String(P[R]??"")},`${A}-${R}`))},A))})]})})}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 border border-blue-200 dark:border-blue-800 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",children:"Load More (+500 rows)"}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Showing first ",i.length," rows"]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(wn,{label:"Total Rows",value:d==null?void 0:d.metrics.row_count.toLocaleString()}),e.jsx(wn,{label:"Total Columns",value:d==null?void 0:d.metrics.column_count}),e.jsx(wn,{label:"Missing Cells",value:d==null?void 0:d.metrics.missing_cells.toLocaleString()}),e.jsx(wn,{label:"Missing %",value:`${d==null?void 0:d.metrics.missing_percentage}%`})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Column"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Missing"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Unique"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Min"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Max"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Mean"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Std Dev"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900",children:d==null?void 0:d.columns.map(P=>{var A,R,N,M;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-slate-900 dark:text-slate-100",children:P.name}),e.jsx("td",{className:"px-4 py-3 font-mono text-xs text-slate-500",children:P.dtype}),e.jsxs("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300",children:[P.missing_count," ",e.jsxs("span",{className:"text-xs text-slate-400",children:["(",P.missing_percentage,"%)"]})]}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300",children:P.distinct_count}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((A=P.numeric_summary)==null?void 0:A.minimum.toFixed(2))??"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((R=P.numeric_summary)==null?void 0:R.maximum.toFixed(2))??"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((N=P.numeric_summary)==null?void 0:N.mean.toFixed(2))??"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((M=P.numeric_summary)==null?void 0:M.std.toFixed(2))??"-"})]},P.name)})})]})})]})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 flex justify-end rounded-b-xl",children:e.jsx("button",{onClick:n,className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Close"})})]})})},wn=({label:t,value:r})=>e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:t}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-1",children:r??"-"})]}),ng=({isOpen:t,onClose:r,onSuccess:n})=>{const[i,o]=f.useState("database"),[d,c]=f.useState(""),[h,u]=f.useState(""),[x,p]=f.useState(""),[b,g]=f.useState(""),[y,_]=f.useState("GET"),[w,j]=f.useState(""),[C,S]=f.useState(!1),[T,E]=f.useState(!1),[P,A]=f.useState(null);if(!t)return null;const R=async N=>{var M,z,I;N.preventDefault(),E(!0),A(null);try{const F={};if(i==="database")F.connection_string=h,F.query=x;else if(i==="s3"){F.path=w;const ee=N.target,te=(M=ee.elements.namedItem("aws_access_key_id"))==null?void 0:M.value,Y=(z=ee.elements.namedItem("aws_secret_access_key"))==null?void 0:z.value,W=(I=ee.elements.namedItem("region_name"))==null?void 0:I.value;te&&Y&&(F.storage_options={aws_access_key_id:te,aws_secret_access_key:Y,region:W||void 0})}else F.url=b,F.method=y;const $={name:d,type:i,config:F,description:`Imported from ${i}`},J=await Dt.createSource($);n(J.job_id),r()}catch(F){A(F.message||"Failed to create source")}finally{E(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[90vh] border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700 shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-900 dark:text-slate-100",children:"Add Data Source"}),e.jsx("button",{onClick:r,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:e.jsx(We,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>{o("database")},className:`flex-1 py-2 px-4 rounded-md flex items-center justify-center gap-2 border ${i==="database"?"bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900/20 dark:border-blue-400 dark:text-blue-400":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400"}`,children:[e.jsx(ft,{size:16})," Database"]}),e.jsxs("button",{onClick:()=>{o("s3")},className:`flex-1 py-2 px-4 rounded-md flex items-center justify-center gap-2 border ${i==="s3"?"bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900/20 dark:border-blue-400 dark:text-blue-400":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400"}`,children:[e.jsx(kc,{size:16})," S3"]}),e.jsxs("button",{onClick:()=>{o("api")},className:`flex-1 py-2 px-4 rounded-md flex items-center justify-center gap-2 border ${i==="api"?"bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900/20 dark:border-blue-400 dark:text-blue-400":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400"}`,children:[e.jsx(Km,{size:16})," API"]})]}),e.jsxs("form",{onSubmit:N=>{R(N)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:d,onChange:N=>{c(N.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"My Dataset"})]}),i==="database"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Connection String"}),e.jsx("input",{type:"text",required:!0,value:h,onChange:N=>{u(N.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"postgresql://user:pass@localhost:5432/db"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"SQL Query"}),e.jsx("textarea",{required:!0,value:x,onChange:N=>{p(N.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 h-24",placeholder:"SELECT * FROM users"})]})]}),i==="s3"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S3 Path"}),e.jsx("input",{type:"text",required:!0,value:w,onChange:N=>{j(N.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"s3://my-bucket/path/to/data.parquet"})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-md overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>S(!C),className:"w-full flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Credentials (Optional)"})}),C?e.jsx(Ze,{size:16,className:"text-slate-500"}):e.jsx(Vt,{size:16,className:"text-slate-500"})]}),C&&e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"If your bucket is private, provide credentials here. They will be stored securely. Leave blank if using backend's IAM role."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Access Key ID"}),e.jsx("input",{type:"text",name:"aws_access_key_id",className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100",placeholder:"AKIA..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Secret Access Key"}),e.jsx("input",{type:"password",name:"aws_secret_access_key",className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100",placeholder:"Secret..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Region"}),e.jsx("input",{type:"text",name:"region_name",className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100",placeholder:"us-east-1"})]})]})]})]})]}),i==="api"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"API URL"}),e.jsx("input",{type:"url",required:!0,value:b,onChange:N=>{g(N.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"https://api.example.com/data"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Method"}),e.jsxs("select",{value:y,onChange:N=>{_(N.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"})]})]})]}),P&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm rounded-md",children:P}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:T,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md flex items-center gap-2 disabled:opacity-50",children:T?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(Ma,{size:16})," Create Source"]})})]})]})]})]})})},ig=({isOpen:t,onClose:r,datasets:n,onRefresh:i})=>{const[o,d]=f.useState(null);if(!t)return null;const c=async u=>{if(window.confirm("Are you sure you want to cancel this ingestion job?")){d(u);try{await Dt.cancelIngestion(u),i&&i()}catch(x){console.error("Failed to cancel ingestion:",x),alert("Failed to cancel ingestion")}finally{d(null)}}},h=n.map(u=>{var x,p,b,g,y,_;return{id:u.id,name:u.name,status:((p=(x=u.source_metadata)==null?void 0:x.ingestion_status)==null?void 0:p.status)||"completed",created_at:u.created_at,message:((g=(b=u.source_metadata)==null?void 0:b.ingestion_status)==null?void 0:g.error)||(((_=(y=u.source_metadata)==null?void 0:y.ingestion_status)==null?void 0:_.status)==="cancelled"?"Ingestion cancelled":"Ingestion completed successfully")}}).sort((u,x)=>new Date(x.created_at).getTime()-new Date(u.created_at).getTime());return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col border border-slate-200 dark:border-slate-700 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Data Ingestion Jobs"}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-slate-500 dark:hover:text-slate-300",children:e.jsx(We,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:h.length===0?e.jsx("div",{className:"text-center text-slate-500 py-8",children:"No ingestion jobs found."}):e.jsx("div",{className:"space-y-4",children:h.map(u=>e.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50",children:[e.jsx("div",{className:"mt-1",children:u.status==="processing"||u.status==="pending"?e.jsx(Xe,{className:"text-blue-500 animate-spin",size:20}):u.status==="failed"?e.jsx(Wa,{className:"text-red-500",size:20}):u.status==="cancelled"?e.jsx(En,{className:"text-slate-500",size:20}):e.jsx(at,{className:"text-green-500",size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-medium text-slate-900 dark:text-slate-100",children:u.name}),e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(Ht,{size:12}),new Date(u.created_at).toLocaleString()]})]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Status: ",e.jsx("span",{className:"capitalize",children:u.status})]}),(u.status==="failed"||u.status==="cancelled")&&e.jsx("p",{className:`text-sm mt-1 p-2 rounded ${u.status==="failed"?"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/10":"text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-800"}`,children:u.message})]}),(u.status==="processing"||u.status==="pending")&&e.jsx("button",{onClick:()=>{c(u.id)},disabled:o===u.id,className:"p-2 text-slate-400 hover:text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-md transition-colors disabled:opacity-50",title:"Cancel Ingestion",children:o===u.id?e.jsx(Xe,{className:"animate-spin",size:20}):e.jsx(En,{size:20})})]},u.id))})})]})})},og=()=>{const t=Xn(),[r,n]=f.useState([]),[i,o]=f.useState(!0),[d,c]=f.useState(!1),[h,u]=f.useState(!1),[x,p]=f.useState(!1),[b,g]=f.useState(null),[y,_]=f.useState(null),[w,j]=f.useState(null),[C,S]=f.useState("completed"),T=r.filter(I=>{var $,J;const F=((J=($=I.source_metadata)==null?void 0:$.ingestion_status)==null?void 0:J.status)||"completed";return C==="all"?!0:F===C}),E=async()=>{r.length===0&&o(!0);try{const I=await Dt.getAll();n(I)}catch(I){console.error("Failed to fetch datasets:",I)}finally{o(!1)}};f.useEffect(()=>{E()},[]),f.useEffect(()=>{const I=setInterval(()=>{r.some($=>{var J,ee,te,Y;return((ee=(J=$.source_metadata)==null?void 0:J.ingestion_status)==null?void 0:ee.status)==="pending"||((Y=(te=$.source_metadata)==null?void 0:te.ingestion_status)==null?void 0:Y.status)==="processing"})&&E()},5e3);return()=>{clearInterval(I)}},[r]);const P=async I=>{if(window.confirm("Are you sure you want to delete this dataset?")){g(I);try{await Dt.delete(I),n(r.filter(F=>F.id!==I))}catch(F){console.error("Failed to delete dataset:",F),alert("Failed to delete dataset")}finally{g(null)}}},A=async I=>{if(window.confirm("Are you sure you want to cancel this ingestion job?")){_(I);try{await Dt.cancelIngestion(I),E()}catch(F){console.error("Failed to cancel ingestion:",F),alert("Failed to cancel ingestion")}finally{_(null)}}},R=I=>{t(`/canvas?source_id=${I}`)},N=()=>{c(!1),E()},M=()=>{u(!1),E()},z=I=>{var $,J;const F=(J=($=I.source_metadata)==null?void 0:$.ingestion_status)==null?void 0:J.status;return!F||F==="completed"?null:F==="failed"?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",children:"Failed"}):F==="cancelled"?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400",children:"Cancelled"}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",children:[e.jsx(Xe,{size:12,className:"animate-spin"}),F==="processing"?"Processing...":"Pending..."]})};return e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsx(ag,{dataset:w,isOpen:!!w,onClose:()=>{j(null)}}),e.jsx(ng,{isOpen:h,onClose:()=>{u(!1)},onSuccess:M}),e.jsx(ig,{isOpen:x,onClose:()=>{p(!1)},datasets:r,onRefresh:E}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Data Sources"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Manage your uploaded datasets and use them in experiments."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{p(!0)},className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-slate-700 dark:text-slate-200",children:[e.jsx(yr,{size:18}),"Ingestion Jobs"]}),e.jsxs("button",{onClick:()=>{u(!0)},className:"flex items-center gap-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-300 dark:border-slate-600 px-4 py-2 rounded-md shadow-sm transition-all hover:bg-slate-50 dark:hover:bg-slate-700",children:[e.jsx(ft,{size:18}),"Add Source"]}),e.jsxs("button",{onClick:()=>{c(!d)},className:"flex items-center gap-2 text-white px-4 py-2 rounded-md shadow-sm transition-all hover:opacity-90",style:{background:"var(--main-gradient)"},children:[e.jsx(Ut,{size:18}),d?"Cancel Upload":"Upload File"]})]})]}),d&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm animate-in fade-in slide-in-from-top-4",children:e.jsx(cu,{onUploadComplete:N,onCancel:()=>{c(!1)}})}),e.jsx("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide",children:["all","completed","failed","cancelled"].map(I=>e.jsx("button",{onClick:()=>{S(I)},className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors whitespace-nowrap ${C===I?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-slate-800 text-slate-600 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:I.charAt(0).toUpperCase()+I.slice(1)},I))}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-4 font-semibold",children:"Dataset Name"}),e.jsx("th",{className:"px-3 py-4 font-semibold",children:"Type"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Format"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Size"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Created"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900",children:i&&r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500 dark:text-slate-400",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"}),"Loading datasets..."]})})}):T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-500 dark:text-slate-400",children:r.length===0?e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"w-12 h-12 mx-auto text-slate-300 dark:text-slate-600 mb-3"}),e.jsx("p",{className:"text-lg font-medium text-slate-900 dark:text-slate-100",children:"No datasets found"}),e.jsx("p",{className:"text-sm",children:"Upload a dataset to get started with your analysis."})]}):e.jsx("p",{className:"text-lg font-medium text-slate-900 dark:text-slate-100",children:"No datasets match the selected filter"})})}):T.map(I=>{var F,$,J,ee,te,Y,W;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"px-3 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded text-blue-600 dark:text-blue-400",children:e.jsx(br,{size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[I.name,z(I)]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono mt-0.5",title:"Dataset ID",children:I.source_id||I.id})]})]})}),e.jsx("td",{className:"px-3 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${I.type==="s3"?"bg-orange-50 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-800":I.type==="file"?"bg-slate-100 text-slate-700 border-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700":"bg-indigo-50 text-indigo-700 border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-400 dark:border-indigo-800"}`,children:I.type==="file"?"Upload":I.type.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200 uppercase border border-slate-200 dark:border-slate-700",children:I.format||"CSV"})}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:uu(I.size_bytes||0)}),e.jsxs("span",{className:"text-xs text-slate-400 dark:text-slate-500",children:[((F=I.rows)==null?void 0:F.toLocaleString())||"-"," rows  ",I.columns||"-"," cols"]})]})}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{size:14,className:"text-slate-400 dark:text-slate-500"}),new Date(I.created_at).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[((J=($=I.source_metadata)==null?void 0:$.ingestion_status)==null?void 0:J.status)==="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{j(I)},className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors",title:"Preview Dataset",children:e.jsx(Cc,{size:16})}),e.jsxs("button",{onClick:()=>{R(I.id)},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors",title:"Use in Canvas",children:[e.jsx(Wt,{size:16}),"Canvas"]}),e.jsxs("button",{onClick:()=>{t(`/eda?dataset_id=${I.id}`)},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-md transition-colors",title:"Analyze with EDA",children:[e.jsx(ks,{size:16}),"EDA"]})]}),(((te=(ee=I.source_metadata)==null?void 0:ee.ingestion_status)==null?void 0:te.status)==="pending"||((W=(Y=I.source_metadata)==null?void 0:Y.ingestion_status)==null?void 0:W.status)==="processing")&&e.jsx("button",{onClick:()=>{A(I.id)},disabled:y===I.id,className:"p-2 text-slate-400 hover:text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-md transition-colors disabled:opacity-50",title:"Cancel Ingestion",children:y===I.id?e.jsx("div",{className:"w-4 h-4 border-2 border-orange-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Wa,{size:16})}),e.jsx("button",{onClick:()=>{P(I.id)},disabled:b===I.id,className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors disabled:opacity-50",title:"Delete Dataset",children:b===I.id?e.jsx("div",{className:"w-4 h-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ys,{size:16})})]})})]},I.id)})})]})})})]})},ir=class ir{constructor(){Fi(this,"nodes",new Map)}static getInstance(){return ir.instance||(ir.instance=new ir),ir.instance}register(r){this.nodes.has(r.type)&&console.warn(`Node type "${r.type}" is already registered. Overwriting.`),this.nodes.set(r.type,r)}get(r){return this.nodes.get(r)}getAll(){return Array.from(this.nodes.values())}getByCategory(){const r={};return this.nodes.forEach(n=>{r[n.category]||(r[n.category]=[]),r[n.category].push(n)}),r}};Fi(ir,"instance");let go=ir;const Ce=go.getInstance(),hu={},{useDebugValue:lg}=pt,{useSyncExternalStoreWithSelector:dg}=Rm;let Od=!1;const cg=t=>t;function ug(t,r=cg,n){(hu?"production":void 0)!=="production"&&n&&!Od&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Od=!0);const i=dg(t.subscribe,t.getState,t.getServerState||t.getInitialState,r,n);return lg(i),i}const Id=t=>{(hu?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const r=typeof t=="function"?Px(t):t,n=(i,o)=>ug(r,i,o);return Object.assign(n,r),n},Jo=t=>t?Id(t):Id,tt=[];for(let t=0;t<256;++t)tt.push((t+256).toString(16).slice(1));function hg(t,r=0){return(tt[t[r+0]]+tt[t[r+1]]+tt[t[r+2]]+tt[t[r+3]]+"-"+tt[t[r+4]]+tt[t[r+5]]+"-"+tt[t[r+6]]+tt[t[r+7]]+"-"+tt[t[r+8]]+tt[t[r+9]]+"-"+tt[t[r+10]]+tt[t[r+11]]+tt[t[r+12]]+tt[t[r+13]]+tt[t[r+14]]+tt[t[r+15]]).toLowerCase()}let Hi;const mg=new Uint8Array(16);function xg(){if(!Hi){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Hi=crypto.getRandomValues.bind(crypto)}return Hi(mg)}const pg=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zd={randomUUID:pg};function fg(t,r,n){var o;t=t||{};const i=t.random??((o=t.rng)==null?void 0:o.call(t))??xg();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,hg(i)}function mu(t,r,n){return zd.randomUUID&&!t?zd.randomUUID():fg(t)}const ye=Jo((t,r)=>({nodes:[],edges:[],executionResult:null,setExecutionResult:n=>t({executionResult:n}),setGraph:(n,i)=>t({nodes:n,edges:i}),onNodesChange:n=>{t({nodes:Ex(n,r().nodes)})},onEdgesChange:n=>{t({edges:Lx(n,r().edges)})},onConnect:n=>{const i=r().nodes,o=r().edges,d=i.find(h=>h.id===n.source),c=i.find(h=>h.id===n.target);if(d&&c&&d.data.definitionType==="feature_target_split"){let u=c.data.definitionType==="TrainTestSplitter";if(!u){const x=[d.id],p=new Set;for(;x.length>0;){const b=x.shift();if(p.has(b))continue;p.add(b);const g=i.find(_=>_.id===b);if((g==null?void 0:g.data.definitionType)==="TrainTestSplitter"){u=!0;break}const y=o.filter(_=>_.target===b);for(const _ of y)x.push(_.source)}}u||alert(`Warning: You are using an X/Y Split without a prior Train-Test Split.

Any processing or modeling done on this data will use 100% of the dataset (Data Leakage).

Recommended: Add a "Train-Test Split" node BEFORE the "Feature-Target Split" node.`)}t({edges:Tx(n,r().edges)})},addNode:(n,i,o={})=>{const d=Ce.get(n);if(!d)return console.error(`Node type ${n} not found in registry`),"";const c=`${n}-${mu()}`,h={id:c,type:"custom",position:i,data:{definitionType:n,catalogType:n,...d.getDefaultConfig(),...o}};return t({nodes:[...r().nodes,h]}),c},updateNodeData:(n,i)=>{t({nodes:r().nodes.map(o=>o.id===n?{...o,data:{...o.data,...i}}:o)})},validateGraph:async()=>{const{nodes:n,edges:i}=r();if(n.length===0)return!1;for(const o of n){const d=Ce.get(o.data.definitionType);if(d){const c=d.validate(o.data);if(!c.isValid)return console.warn(`Node ${o.id} validation failed: ${c.message}`),!1}}for(const o of n){const d=Ce.get(o.data.definitionType);if(d&&d.inputs.length>0&&!i.some(h=>h.target===o.id))return console.warn(`Node ${o.id} (${d.label}) is disconnected.`),!1}return!0}})),aa=Jo(t=>({activeView:"canvas",setView:r=>t({activeView:r}),isSidebarOpen:!0,setSidebarOpen:r=>t({isSidebarOpen:r}),isPropertiesPanelExpanded:!1,setPropertiesPanelExpanded:r=>t({isPropertiesPanelExpanded:r}),isResultsPanelExpanded:!0,setResultsPanelExpanded:r=>t({isResultsPanelExpanded:r})})),gg=()=>{const t=Ce.getAll(),r=ye(x=>x.addNode),{isSidebarOpen:n,setSidebarOpen:i}=aa(),[o,d]=f.useState(""),c=(x,p)=>{x.dataTransfer.setData("application/reactflow",p),x.dataTransfer.effectAllowed="move"};if(!n)return e.jsx("div",{className:"absolute left-4 top-4 z-50",children:e.jsx("button",{onClick:()=>i(!0),className:"p-2 bg-background border shadow-md rounded-md text-muted-foreground hover:text-foreground transition-colors",title:"Expand Components",children:e.jsx(Sc,{className:"w-5 h-5"})})});const h=t.filter(x=>x.label.toLowerCase().includes(o.toLowerCase())||x.category.toLowerCase().includes(o.toLowerCase())),u=["Data Source","Preprocessing","Modeling","Evaluation","Utility"];return e.jsxs("aside",{className:"w-64 shrink-0 border-r bg-background flex flex-col h-full shadow-sm z-10 transition-all duration-300",children:[e.jsxs("div",{className:"p-4 border-b space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold tracking-tight",children:"Components"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Drag and drop to canvas"})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-1 hover:bg-accent rounded-md text-muted-foreground hover:text-foreground transition-colors",title:"Collapse Sidebar",children:e.jsx(Pc,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{placeholder:"Search nodes...",className:"w-full pl-9 pr-3 py-2 text-sm border rounded-md bg-muted/50 focus:bg-background focus:outline-none focus:ring-1 focus:ring-primary transition-colors",value:o,onChange:x=>{d(x.target.value)}})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 scrollbar-thin",children:u.map(x=>{const p=h.filter(b=>b.category===x);return p.length===0?null:e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold text-muted-foreground mb-2 uppercase tracking-wider px-1",children:x}),e.jsx("div",{className:"space-y-2",children:p.map(b=>e.jsxs("div",{className:"group flex items-center p-3 border rounded-lg bg-card hover:border-primary/50 hover:shadow-sm cursor-grab active:cursor-grabbing transition-all",draggable:!0,onDragStart:g=>{c(g,b.type)},onClick:()=>r(b.type,{x:100,y:100}),children:[e.jsx("div",{className:"p-2 bg-primary/5 group-hover:bg-primary/10 rounded-md mr-3 transition-colors",children:b.icon&&e.jsx(b.icon,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:b.label}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:b.description})]})]},b.type))})]},x)})})]})};function bg(t,r){if(Object.is(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;if(t instanceof Map&&r instanceof Map){if(t.size!==r.size)return!1;for(const[i,o]of t)if(!Object.is(o,r.get(i)))return!1;return!0}if(t instanceof Set&&r instanceof Set){if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(r).length)return!1;for(const i of n)if(!Object.prototype.hasOwnProperty.call(r,i)||!Object.is(t[i],r[i]))return!1;return!0}const{useRef:yg}=pt;function vg(t){const r=yg();return n=>{const i=t(n);return bg(r.current,i)?r.current:r.current=i}}const _g=f.memo(({id:t,data:r,selected:n})=>{var x;const i=r.definitionType,o=Ce.get(i),{deleteElements:d}=Io(),c=ye(p=>p.executionResult),h=(x=c==null?void 0:c.node_results)==null?void 0:x[t],u=p=>{p.stopPropagation(),d({nodes:[{id:t}]})};return o?e.jsxs("div",{className:`
      min-w-[200px] bg-card border-2 rounded-lg shadow-sm transition-all
      ${n?"border-primary ring-2 ring-primary/20":"border-border hover:border-primary/50"}
    `,children:[e.jsxs("div",{className:"flex items-center p-3 border-b bg-muted/30 rounded-t-lg relative group",children:[e.jsx("div",{className:"p-1.5 bg-primary/10 rounded mr-3",children:o.icon&&e.jsx(o.icon,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-bold",children:o.label}),h&&e.jsx("div",{className:`flex items-center gap-1 px-1.5 py-0.5 rounded-full text-[10px] font-medium border ${h.status==="success"?"bg-green-50 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-900":"bg-red-50 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-900"}`,children:h.status==="success"?e.jsx(Jm,{size:10}):e.jsx(Wa,{size:10})})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:o.category})]}),e.jsx("button",{onClick:u,className:"p-1 rounded-md hover:bg-destructive/10 hover:text-destructive text-muted-foreground/50 transition-all opacity-0 group-hover:opacity-100 ml-2",title:"Remove Node",children:e.jsx(We,{size:14})})]}),e.jsx("div",{className:"p-3",children:o.component?e.jsx(o.component,{data:r}):e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"No configuration needed"})}),o.inputs.map((p,b)=>e.jsx(An,{type:"target",position:Ks.Left,id:p.id,className:"!w-3 !h-3 !bg-muted-foreground hover:!bg-primary transition-colors",style:{top:`${(b+1)*100/(o.inputs.length+1)}%`},children:e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[10px] text-muted-foreground pointer-events-none whitespace-nowrap",children:p.label})},`input-${p.id}`)),o.outputs.map((p,b)=>e.jsx(An,{type:"source",position:Ks.Right,id:p.id,className:"!w-3 !h-3 !bg-muted-foreground hover:!bg-primary transition-colors",style:{top:`${(b+1)*100/(o.outputs.length+1)}%`},children:e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[10px] text-muted-foreground pointer-events-none whitespace-nowrap",children:p.label})},`output-${p.id}`))]}):e.jsxs("div",{className:"p-4 border-2 border-destructive bg-destructive/10 rounded-md min-w-[150px]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(lt,{size:16}),e.jsx("span",{className:"text-sm font-bold",children:"Unknown Node"})]}),e.jsxs("div",{className:"text-xs mt-1",children:["Type: ",i]})]})}),jg=({id:t,sourceX:r,sourceY:n,targetX:i,targetY:o,sourcePosition:d,targetPosition:c,style:h={},markerEnd:u})=>{const{deleteElements:x}=Io(),[p,b,g]=Rx({sourceX:r,sourceY:n,sourcePosition:d,targetX:i,targetY:o,targetPosition:c,borderRadius:24}),y=_=>{_.stopPropagation(),x({edges:[{id:t}]})};return e.jsxs(e.Fragment,{children:[e.jsx(fd,{path:p,style:{strokeWidth:20,stroke:"transparent",cursor:"pointer"}}),e.jsx(fd,{path:p,markerEnd:u,style:{...h,strokeWidth:2},className:"react-flow__edge-path"}),e.jsx(Mx,{children:e.jsx("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${b}px,${g}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan",children:e.jsx("button",{className:"w-5 h-5 bg-background border border-border text-muted-foreground rounded-full flex items-center justify-center hover:bg-destructive hover:text-destructive-foreground transition-colors shadow-sm",onClick:y,title:"Remove Connection",children:e.jsx(We,{size:10})})})})]})},wg={custom:_g},Ng={custom:jg},kg=()=>{const t=f.useRef(null),{screenToFlowPosition:r}=Io(),{nodes:n,edges:i,onNodesChange:o,onEdgesChange:d,onConnect:c,addNode:h,executionResult:u}=ye(vg(g=>({nodes:g.nodes,edges:g.edges,onNodesChange:g.onNodesChange,onEdgesChange:g.onEdgesChange,onConnect:g.onConnect,addNode:g.addNode,executionResult:g.executionResult}))),{isResultsPanelExpanded:x}=aa(),p=f.useCallback(g=>{g.preventDefault(),g.dataTransfer.dropEffect="move"},[]),b=f.useCallback(g=>{g.preventDefault();const y=g.dataTransfer.getData("application/reactflow");if(typeof y>"u"||!y)return;const _=r({x:g.clientX,y:g.clientY});h(y,_)},[r,h]);return e.jsx("div",{className:"w-full h-full outline-none",ref:t,tabIndex:0,children:e.jsxs(zo,{nodes:n,edges:i,onNodesChange:o,onEdgesChange:d,onConnect:c,nodeTypes:wg,onDragOver:p,onDrop:b,fitView:!0,proOptions:{hideAttribution:!0},defaultEdgeOptions:{type:"custom",style:{stroke:"url(#edge-gradient)",strokeWidth:3,strokeDasharray:"8 6",filter:"url(#glow)"},animated:!0},edgeTypes:Ng,deleteKeyCode:["Backspace","Delete"],children:[e.jsx("svg",{style:{position:"absolute",top:0,left:0,width:0,height:0,pointerEvents:"none"},children:e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"edge-gradient",children:[e.jsx("stop",{offset:"0%",stopColor:"#38bdf8"}),e.jsx("stop",{offset:"50%",stopColor:"#6366f1"}),e.jsx("stop",{offset:"100%",stopColor:"#a855f7"})]}),e.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]})}),e.jsx(Fo,{}),e.jsx(Bo,{position:"bottom-left",style:u&&!x?{marginBottom:"40px",transition:"margin-bottom 0.3s ease-in-out"}:{transition:"margin-bottom 0.3s ease-in-out"}})]})})},Cg=()=>e.jsx(Dx,{children:e.jsx(kg,{})}),Sg=()=>{const t=ye(c=>c.nodes),{isSidebarOpen:r,isPropertiesPanelExpanded:n,setPropertiesPanelExpanded:i}=aa(),o=t.find(c=>c.selected);pt.useEffect(()=>{o||i(!1)},[o,i]);const d=r?"w-[calc(100vw-300px)]":"w-[calc(100vw-50px)]";return e.jsx("aside",{className:`border-l bg-background shrink-0 transition-all duration-300 ease-in-out overflow-hidden ${o?n?`${d} opacity-100`:"w-80 opacity-100":"w-0 opacity-0"}`,children:o&&e.jsx(Pg,{selectedNode:o,isExpanded:n,toggleExpand:()=>i(!n)})})},Pg=({selectedNode:t,isExpanded:r,toggleExpand:n})=>{const i=ye(x=>x.updateNodeData),o=ye(x=>x.onNodesChange),d=()=>{o([{id:t.id,type:"select",selected:!1}])},c=t.data.definitionType,h=Ce.get(c);if(!h)return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-destructive flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Error: Node definition '",c,"' not found."]})});const u=h.settings;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-primary/10 rounded-md",children:e.jsx(Ro,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-sm",children:String(t.data.label||h.label)}),e.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",t.id]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:n,className:"p-1.5 hover:bg-accent rounded-md text-muted-foreground hover:text-foreground transition-colors",children:r?e.jsx(Qm,{className:"w-4 h-4"}):e.jsx(Ym,{className:"w-4 h-4"})}),e.jsx("button",{onClick:d,className:"p-1.5 hover:bg-accent rounded-md text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(We,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"space-y-6",children:e.jsx(u,{config:t.data,onChange:x=>i(t.id,x),nodeId:t.id})})})]})},Tg=3e3,Ms=50,na=Jo((t,r)=>{let n=null;return{jobs:[],isLoading:!1,isDrawerOpen:!1,activeTab:"basic_training",hasMore:!0,skip:0,fetchJobs:async()=>{t({isLoading:!0,skip:0});try{const i=await $e.getJobs(Ms,0);t({jobs:i,isLoading:!1,hasMore:i.length===Ms})}catch(i){console.error("Failed to fetch jobs:",i),t({isLoading:!1})}},loadMoreJobs:async()=>{const{skip:i,jobs:o,isLoading:d,hasMore:c}=r();if(d||!c)return;const h=i+Ms;t({isLoading:!0});try{const u=await $e.getJobs(Ms,h);t({jobs:[...o,...u],isLoading:!1,skip:h,hasMore:u.length===Ms})}catch(u){console.error("Failed to load more jobs:",u),t({isLoading:!1})}},submitJob:async i=>{try{const o=await $e.runPipeline(i);return await r().fetchJobs(),r().startPolling(),o.job_id}catch(o){throw console.error("Failed to submit job:",o),o}},cancelJob:async i=>{try{await $e.cancelJob(i),await r().fetchJobs()}catch(o){throw console.error("Failed to cancel job:",o),o}},toggleDrawer:i=>{const o=r().isDrawerOpen,d=i!==void 0?i:!o;t({isDrawerOpen:d}),d?(r().fetchJobs(),r().startPolling()):r().jobs.some(h=>h.status==="running"||h.status==="queued")||r().stopPolling()},setTab:i=>t({activeTab:i}),startPolling:()=>{n||(n=setInterval(()=>{(async()=>{try{const i=await $e.getJobs(Ms,0);t(d=>d.jobs.length<=Ms?{jobs:i}:{jobs:[...i,...d.jobs.slice(Ms)]}),!i.some(d=>d.status==="running"||d.status==="queued")&&!r().isDrawerOpen&&r().stopPolling()}catch(i){console.error("Polling error:",i)}})()},Tg))},stopPolling:()=>{n&&(clearInterval(n),n=null)}}}),ti=(t,r)=>{const n=[],i=new Set,o=[],d=t.find(h=>h.data.definitionType==="dataset_node"),c=d==null?void 0:d.data.datasetId;for(d&&o.push(d.id);o.length>0;){const h=o.shift();if(!h||i.has(h))continue;i.add(h);const u=t.find(_=>_.id===h);if(!u)continue;let x="unknown",p={};const g=r.filter(_=>_.target===h).map(_=>_.source);if(u.data.definitionType==="dataset_node")x="data_loader",p={dataset_id:u.data.datasetId};else if(u.data.definitionType==="imputation_node"){const _=u.data.method||"simple";_==="knn"?(x="KNNImputer",p={columns:u.data.columns,n_neighbors:u.data.n_neighbors,weights:u.data.weights}):_==="iterative"?(x="IterativeImputer",p={columns:u.data.columns,max_iter:u.data.max_iter,estimator:u.data.estimator,random_state:0}):(x="SimpleImputer",p={columns:u.data.columns,strategy:u.data.strategy,fill_value:u.data.fill_value})}else if(u.data.definitionType==="simple_imputer")x="SimpleImputer",p=u.data||{};else if(u.data.definitionType==="drop_missing_columns"||u.data.definitionType==="DropMissingColumns")x="DropMissingColumns",p={columns:u.data.columns||[],missing_threshold:u.data.missing_threshold};else if(u.data.definitionType==="drop_missing_rows"||u.data.definitionType==="DropMissingRows")x="DropMissingRows",p={missing_threshold:u.data.missing_threshold,drop_if_any_missing:u.data.drop_if_any_missing};else if(u.data.definitionType==="deduplicate"||u.data.definitionType==="Deduplicate")x="Deduplicate",p={subset:u.data.subset,keep:u.data.keep};else if(u.data.definitionType==="casting"||u.data.definitionType==="Casting")x="Casting",p={column_types:u.data.column_types};else if(u.data.definitionType==="MissingIndicator"||u.data.definitionType==="missing_indicator")x="MissingIndicator",p={columns:u.data.columns,flag_suffix:u.data.flag_suffix};else if(u.data.definitionType==="scale_numeric_features"){const _=u.data&&typeof u.data=="object"?u.data:{},w=_.method||"standard";w==="minmax"?x="MinMaxScaler":w==="maxabs"?x="MaxAbsScaler":w==="robust"?x="RobustScaler":x="StandardScaler",p=_}else if(u.data.definitionType==="encoding"){const _=u.data.method;_==="onehot"?x="OneHotEncoder":_==="dummy"?(x="DummyEncoder",p={...u.data,drop_first:!0}):_==="label"?x="LabelEncoder":_==="ordinal"?x="OrdinalEncoder":_==="target"?x="TargetEncoder":_==="hash"?x="HashEncoder":x="OneHotEncoder",x!=="DummyEncoder"&&(p=u.data)}else if(u.data.definitionType==="TrainTestSplitter")x="TrainTestSplitter",p=u.data||{};else if(u.data.definitionType==="label_encoding")x="LabelEncoder",p=u.data||{};else if(u.data.definitionType==="feature_target_split")x="feature_target_split",p=u.data||{};else if(u.data.definitionType==="feature_selection")x="feature_selection",p=u.data||{};else if(u.data.definitionType==="outlier"){const _=u.data.method||"iqr";_==="iqr"?x="IQR":_==="zscore"?x="ZScore":_==="winsorize"?x="Winsorize":_==="elliptic_envelope"?x="EllipticEnvelope":x="IQR",p=u.data}else if(u.data.definitionType==="TransformationNode"){x="GeneralTransformation";const _=u.data.transformations||[],w=[];for(const j of _){const C=j;if(C.columns&&Array.isArray(C.columns))for(const S of C.columns)w.push({column:S,method:C.method,...C.params})}p={transformations:w}}else u.data.definitionType==="BinningNode"?(x="GeneralBinning",p={columns:u.data.columns,strategy:u.data.strategy,n_bins:u.data.n_bins,label_format:u.data.label_format,output_suffix:u.data.output_suffix,drop_original:u.data.drop_original,custom_bins:u.data.custom_bins,custom_labels:u.data.custom_labels}):u.data.definitionType==="ResamplingNode"?((u.data.type||"oversampling")==="oversampling"?x="Oversampling":x="Undersampling",p=u.data):u.data.definitionType==="FeatureGenerationNode"?(x="FeatureMath",p={operations:u.data.operations}):u.data.definitionType==="PolynomialFeaturesNode"?(x="PolynomialFeatures",p={columns:u.data.columns,degree:u.data.degree,interaction_only:u.data.interaction_only,include_bias:u.data.include_bias,output_prefix:u.data.output_prefix,include_input_features:u.data.include_input_features}):u.data.definitionType==="TextCleaning"?(x="TextCleaning",p=u.data):u.data.definitionType==="ValueReplacement"?(x="ValueReplacement",p=u.data):u.data.definitionType==="AliasReplacement"?(x="AliasReplacement",p=u.data):u.data.definitionType==="InvalidValueReplacement"?(x="InvalidValueReplacement",p=u.data):u.data.definitionType==="model_training"||u.data.definitionType==="basic_training"?(x="basic_training",p={target_column:u.data.target_column,model_type:u.data.model_type,hyperparameters:u.data.hyperparameters,cv_enabled:u.data.cv_enabled,cv_folds:u.data.cv_folds,cv_type:u.data.cv_type,cv_shuffle:u.data.cv_shuffle,cv_random_state:u.data.cv_random_state}):u.data.definitionType==="hyperparameter_tuning"||u.data.definitionType==="advanced_tuning"?(x="advanced_tuning",p={target_column:u.data.target_column,algorithm:u.data.model_type,tuning_config:{strategy:u.data.search_strategy,metric:u.data.metric,n_trials:u.data.n_trials,search_space:u.data.search_space,cv_enabled:u.data.cv_enabled,cv_folds:u.data.cv_folds,cv_type:u.data.cv_type,cv_shuffle:u.data.cv_shuffle,cv_random_state:u.data.cv_random_state,random_state:u.data.random_state}}):u.data.definitionType==="data_preview"?(x="data_preview",p={}):(console.warn(`Unknown node type: ${u.data.definitionType}`),x="Unknown",p=u.data&&typeof u.data=="object"?u.data:{});n.push({node_id:u.id,step_type:x,params:p,inputs:g}),r.filter(_=>_.source===h).forEach(_=>o.push(_.target))}return{pipeline_id:`preview_${mu()}`,nodes:n,metadata:{dataset_source_id:c}}},Lg=()=>{const t=ye(w=>w.nodes),r=ye(w=>w.edges),n=ye(w=>w.setExecutionResult),i=ye(w=>w.setGraph),{toggleDrawer:o}=na(),[d,c]=f.useState(!1),[h,u]=f.useState(!1),[x,p]=f.useState(!1),b=()=>({nodes:t.map(w=>({id:w.id,type:w.type,position:w.position,data:{...w.data,catalogType:w.data.catalogType||w.data.definitionType}})),edges:r.map(w=>({id:w.id,source:w.source,target:w.target,sourceHandle:w.sourceHandle,targetHandle:w.targetHandle,type:w.type,data:w.data}))}),g=async()=>{const w=t.find(C=>C.data.definitionType==="dataset_node"),j=w==null?void 0:w.data.datasetId;if(!j){alert("No dataset node found! Cannot save pipeline without a dataset context.");return}u(!0);try{await eg(j,{name:"My Pipeline",description:"Saved from Canvas",graph:b()}),alert("Pipeline saved successfully!")}catch(C){console.error("Save failed:",C),alert("Failed to save pipeline.")}finally{u(!1)}},y=async()=>{const w=t.find(C=>C.data.definitionType==="dataset_node"),j=w==null?void 0:w.data.datasetId;if(!j){alert("No dataset node found! Cannot load pipeline without a dataset context.");return}if(confirm("Loading a pipeline will overwrite your current work. Continue?")){p(!0);try{const C=await tg(j);if(C){const S=Array.isArray(C.graph.nodes)?C.graph.nodes:[],T=Array.isArray(C.graph.edges)?C.graph.edges:[];i(S,T),alert("Pipeline loaded successfully!")}else alert("No saved pipeline found for this dataset.")}catch(C){console.error("Load failed:",C),alert("Failed to load pipeline.")}finally{p(!1)}}},_=async()=>{const w=t.find(C=>C.data.definitionType==="dataset_node");if(!(w==null?void 0:w.data.datasetId)){alert("No dataset node found!");return}c(!0),n(null);try{const C=ti(t,r),S=await Yf(C);n(S)}catch(C){console.error("Pipeline failed:",C),alert("Pipeline execution failed. Check console for details.")}finally{c(!1)}};return e.jsxs("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[e.jsxs("button",{onClick:()=>o(),className:"flex items-center gap-2 px-4 py-2 bg-background border rounded-md shadow-sm hover:bg-accent transition-colors",children:[e.jsx(Xm,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Jobs"})]}),e.jsxs("button",{onClick:()=>{y()},disabled:x||d,className:"flex items-center gap-2 px-4 py-2 bg-background border rounded-md shadow-sm hover:bg-accent transition-colors disabled:opacity-50",children:[x?e.jsx(Xe,{className:"w-4 h-4 animate-spin"}):e.jsx(ex,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:x?"Loading...":"Load"})]}),e.jsxs("button",{onClick:()=>{g()},disabled:h||d,className:"flex items-center gap-2 px-4 py-2 bg-background border rounded-md shadow-sm hover:bg-accent transition-colors disabled:opacity-50",children:[h?e.jsx(Xe,{className:"w-4 h-4 animate-spin"}):e.jsx(tx,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:h?"Saving...":"Save"})]}),e.jsxs("button",{onClick:()=>{_()},disabled:d,className:"flex items-center gap-2 px-4 py-2 text-white rounded-md shadow-sm transition-all disabled:opacity-50",style:{background:"var(--main-gradient)"},children:[d?e.jsx(Xe,{className:"w-4 h-4 animate-spin"}):e.jsx(Wt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:d?"Running...":"Run Preview"})]})]})},Eg=()=>{var y;const t=ye(_=>_.executionResult),{isResultsPanelExpanded:r,setResultsPanelExpanded:n}=aa(),[i,o]=f.useState(null),d=f.useMemo(()=>{const _=t==null?void 0:t.preview_data;return _?Array.isArray(_)?{Result:_}:typeof _=="object"?_:{}:{}},[t]),c=Object.keys(d);if(pt.useEffect(()=>{c.length>0&&(!i||!c.includes(i))&&(c.includes("train")?o("train"):c.includes("X")?o("X"):o(c[0]))},[c,i]),!t)return null;const h=i&&d[i]?d[i]:[],u=h.length>0?Object.keys(h[0]??{}):[],x=t.node_results?Object.keys(t.node_results):[],p=t.node_results||{},b=Object.keys(p).find(_=>{const w=p[_];return(w==null?void 0:w.status)==="failed"}),g=b?(y=p[b])==null?void 0:y.error:null;return e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-background border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] transition-all duration-300 z-20 flex flex-col ${r?"h-96":"h-10"}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-muted/10 cursor-pointer hover:bg-muted/20 border-b select-none",onClick:()=>n(!r),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mo,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-sm",children:"Preview Results"}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:[h.length," rows shown"]}),t.status==="failed"&&e.jsx("span",{className:"text-xs text-red-600 font-bold ml-2",children:"(Failed)"})]}),e.jsx("button",{className:"p-1 hover:bg-muted rounded",children:r?e.jsx(Ze,{className:"w-4 h-4"}):e.jsx(Gs,{className:"w-4 h-4"})})]}),r&&e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[t.status==="failed"&&e.jsxs("div",{className:"p-4 bg-red-50 border-b text-red-800 text-sm overflow-auto max-h-32",children:[e.jsx("div",{className:"font-bold mb-1",children:"Pipeline Execution Failed"}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:g||"Unknown error occurred during execution."})]}),c.length>1&&e.jsxs("div",{className:"flex items-center gap-1 px-2 pt-2 border-b bg-muted/5",children:[e.jsx(sx,{className:"w-3 h-3 text-muted-foreground mr-1"}),c.map(_=>e.jsx("button",{onClick:()=>{o(_)},className:`px-3 py-1 text-xs font-medium rounded-t-md border-t border-l border-r transition-colors ${i===_?"bg-background text-primary border-b-background translate-y-[1px]":"bg-muted/30 text-muted-foreground hover:bg-muted/50 border-transparent"}`,children:_},_))]}),x.length>0&&t.status!=="failed"&&e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-950/20 border-b dark:border-blue-900/30 flex gap-2 overflow-x-auto",children:x.map((_,w)=>e.jsx("div",{className:"text-xs text-blue-800 dark:text-blue-200 bg-blue-100 dark:bg-blue-900/40 px-2 py-1 rounded border border-blue-200 dark:border-blue-800 whitespace-nowrap",children:_},w))}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsxs("table",{className:"w-full text-sm text-left border-collapse",children:[e.jsx("thead",{className:"text-xs text-muted-foreground uppercase bg-muted sticky top-0 z-10 shadow-sm",children:e.jsx("tr",{children:u.map(_=>e.jsx("th",{className:"px-4 py-2 font-medium border-b whitespace-nowrap",children:_},_))})}),e.jsx("tbody",{children:h.map((_,w)=>e.jsx("tr",{className:"border-b hover:bg-muted/10",children:u.map(j=>e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-mono text-xs",children:_[j]!==null?String(_[j]):e.jsx("span",{className:"text-muted-foreground italic",children:"null"})},`${w}-${j}`))},w))})]}),h.length===0&&e.jsxs("div",{className:"flex items-center justify-center h-32 text-muted-foreground text-sm",children:["No preview data available ",i?`for ${i}`:""]})]})]})]})},Rg=()=>{const{activeView:t,setView:r}=aa();return e.jsx("div",{className:"h-14 border-b bg-card px-4 flex items-center justify-center shrink-0 relative",children:e.jsxs("div",{className:"flex items-center gap-1 bg-secondary/50 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>r("canvas"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${t==="canvas"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"}`,children:[e.jsx(Ra,{className:"w-4 h-4"}),"Canvas"]}),e.jsxs("button",{onClick:()=>r("experiments"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${t==="experiments"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"}`,children:[e.jsx(ks,{className:"w-4 h-4"}),"Experiments"]}),e.jsxs("button",{onClick:()=>r("inference"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${t==="inference"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"}`,children:[e.jsx(qn,{className:"w-4 h-4"}),"Inference"]})]})})},Mg=()=>{const{isDrawerOpen:t,toggleDrawer:r,jobs:n,isLoading:i,activeTab:o,setTab:d,fetchJobs:c,hasMore:h,loadMoreJobs:u}=na(),[x,p]=f.useState(null);if(!t)return null;const b=n.filter(g=>g.job_type===o);return e.jsxs("div",{className:"fixed inset-0 z-50 flex justify-center items-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>r(!1)}),e.jsx("div",{className:"relative w-[900px] h-[85vh] bg-white dark:bg-gray-800 shadow-2xl rounded-lg flex flex-col border border-gray-200 dark:border-gray-700 overflow-hidden transition-all",children:x?e.jsx(Dg,{job:x,onBack:()=>{p(null)},onClose:()=>r(!1)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Job History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(),className:`p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 ${i?"animate-spin":""}`,title:"Refresh",children:e.jsx(xt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(!1),className:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",children:e.jsx(We,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{className:`flex-1 py-3 text-sm font-medium border-b-2 transition-colors ${o==="advanced_tuning"?"border-purple-500 text-purple-600 dark:text-purple-400 bg-purple-50/50 dark:bg-purple-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>d("advanced_tuning"),children:"Model Optimization"}),e.jsx("button",{className:`flex-1 py-3 text-sm font-medium border-b-2 transition-colors ${o==="basic_training"?"border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>d("basic_training"),children:"Standard Training"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-2 bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Dataset / Model"}),e.jsx("div",{className:"col-span-3",children:"Job ID"}),e.jsx("div",{className:"col-span-2",children:"Started"}),e.jsx("div",{className:"col-span-1",children:"Duration"}),e.jsx("div",{className:"col-span-1",children:"Ready"}),e.jsx("div",{className:"col-span-1",children:"Result"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 bg-gray-50/30 dark:bg-gray-900/30",children:b.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-400 dark:text-gray-500 text-sm",children:["No ",o==="advanced_tuning"?"optimization":"training"," jobs found."]}):e.jsxs(e.Fragment,{children:[b.map(g=>e.jsx(Ag,{job:g,onClick:()=>{p(g)}},g.job_id)),h&&e.jsx("div",{className:"flex justify-center pt-2 pb-4",children:e.jsxs("button",{onClick:()=>u(),disabled:i,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50 flex items-center gap-1",children:[i?e.jsx(xt,{className:"w-3 h-3 animate-spin"}):e.jsx(Ze,{className:"w-3 h-3"}),"Load More History"]})})]})})]})})]})},Dg=({job:t,onBack:r,onClose:n})=>{const{cancelJob:i}=na(),[o,d]=f.useState(t),[c,h]=f.useState("overview"),[u,x]=f.useState(!1),p=f.useRef(null);f.useEffect(()=>{let g;const y=async()=>{try{const _=await $e.getJob(t.job_id);d(_)}catch(_){console.error("Failed to fetch job details",_)}};return y(),(o.status==="running"||o.status==="queued")&&(g=setInterval(()=>{y()},2e3)),()=>{g&&clearInterval(g)}},[t.job_id,o.status]),f.useEffect(()=>{c==="logs"&&p.current&&p.current.scrollIntoView({behavior:"smooth"})},[o.logs,c]);const b=async()=>{if(confirm("Are you sure you want to stop this job?")){x(!0);try{await i(o.job_id)}catch{alert("Failed to cancel job")}finally{x(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-500",children:e.jsx(Tc,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsxs("h2",{className:"font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:["Job Details",e.jsx("span",{className:"text-xs font-normal text-gray-500 font-mono bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded",children:o.job_id.slice(0,8)})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(o.status==="running"||o.status==="queued")&&e.jsxs("button",{onClick:()=>{b()},disabled:u,className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/40 rounded text-xs font-medium transition-colors border border-red-200 dark:border-red-800",children:[e.jsx(rx,{className:"w-3 h-3 fill-current"}),u?"Stopping...":"Stop Job"]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",children:e.jsx(We,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 px-4",children:[e.jsxs("button",{className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors flex items-center gap-2 ${c==="overview"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>{h("overview")},children:[e.jsx(Eo,{className:"w-4 h-4"}),"Overview"]}),e.jsxs("button",{className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors flex items-center gap-2 ${c==="logs"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>{h("logs")},children:[e.jsx(br,{className:"w-4 h-4"}),"Live Logs",o.status==="running"&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c==="overview"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Status"}),e.jsx("div",{className:"font-medium capitalize flex items-center gap-2 text-gray-800 dark:text-gray-200",children:o.status})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Dataset"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(ft,{className:"w-3 h-3 text-gray-400"}),o.dataset_name||o.dataset_id||"Unknown"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Duration"}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200 font-mono",children:o.start_time&&o.end_time?`${Math.round((new Date(o.end_time).getTime()-new Date(o.start_time).getTime())/1e3)}s`:"-"})]})]}),o.error&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 rounded-lg",children:[e.jsxs("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300 mb-2 flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4"}),"Error Log"]}),e.jsx("pre",{className:"text-xs text-red-700 dark:text-red-400 whitespace-pre-wrap font-mono",children:o.error})]}),o.result&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(ax,{className:"w-4 h-4"}),"Execution Results"]}),o.status==="completed"&&e.jsxs("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1 border border-green-200 dark:border-green-800 font-medium",children:[e.jsx(at,{className:"w-3 h-3"})," Model Ready"]})]}),o.job_type==="basic_training"&&!!o.result.metrics&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:Object.entries(o.result.metrics).map(([g,y])=>e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 capitalize",children:g.replace(/_/g," ")}),e.jsx("div",{className:"font-mono font-medium text-blue-600 dark:text-blue-400",children:typeof y=="number"?y.toFixed(4):String(y)})]},g))}),o.job_type==="advanced_tuning"&&e.jsxs("div",{className:"space-y-4",children:[o.graph&&e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Tuning Configuration"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-xs",children:(()=>{var _,w,j;const g=(w=(_=o.graph)==null?void 0:_.nodes)==null?void 0:w.find(C=>C.node_id===o.node_id),y=(j=g==null?void 0:g.params)==null?void 0:j.tuning_config;return y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Strategy:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300 capitalize",children:y.strategy})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Metric:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.metric})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Trials:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.n_trials})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"CV Enabled:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.cv_enabled?"Yes":"No"})]}),y.cv_enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Folds:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.cv_folds})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Shuffle:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.cv_shuffle?"Yes":"No"})]})]})]}):e.jsx("div",{className:"text-gray-400 col-span-2",children:"No configuration found"})})()})]}),o.result.best_score!==void 0&&e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg w-fit",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Best Score"}),e.jsx("div",{className:"font-mono font-bold text-lg text-purple-600 dark:text-purple-400",children:Number(o.result.best_score).toFixed(4)})]}),!!o.result.metrics&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Evaluation Metrics"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:Object.entries(o.result.metrics).filter(([g])=>!["best_score","best_params","trials"].includes(g)).map(([g,y])=>e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 capitalize",children:g.replace(/_/g," ")}),e.jsx("div",{className:"font-mono font-medium text-blue-600 dark:text-blue-400",children:typeof y=="number"?y.toFixed(4):String(y)})]},g))})]}),!!o.result.best_params&&e.jsxs("div",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg font-mono text-xs overflow-x-auto",children:[e.jsx("div",{className:"text-gray-500 mb-2",children:"# Best Hyperparameters"}),e.jsx("pre",{children:JSON.stringify(o.result.best_params,null,2)})]})]})]})]}):e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 min-h-[400px] font-mono text-xs text-gray-300 overflow-x-auto",children:[o.logs&&o.logs.length>0?o.logs.map((g,y)=>e.jsx("div",{className:"mb-1 border-b border-gray-800 pb-1 last:border-0",children:g},y)):e.jsx("div",{className:"text-gray-500 italic",children:"No logs available yet..."}),e.jsx("div",{ref:p})]})})]})},Ag=({job:t,onClick:r})=>{const n=c=>{switch(c){case"completed":case"succeeded":return e.jsx(at,{className:"w-4 h-4 text-green-500 dark:text-green-400"});case"failed":return e.jsx(lt,{className:"w-4 h-4 text-red-500 dark:text-red-400"});case"running":return e.jsx(xt,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 animate-spin"});default:return e.jsx(Ht,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})}},i=c=>{switch(c){case"completed":return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50";case"failed":return"bg-red-50/30 dark:bg-red-900/10 border-red-100 dark:border-red-900/30 hover:bg-red-50/50 dark:hover:bg-red-900/20";case"running":return"bg-blue-50/30 dark:bg-blue-900/10 border-blue-100 dark:border-blue-900/30 hover:bg-blue-50/50 dark:hover:bg-blue-900/20";default:return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}},o=c=>c?new Date(c).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",d=(c,h)=>{if(!c||!h)return"-";const u=new Date(h).getTime()-new Date(c).getTime(),x=Math.floor(u/1e3);return x<60?`${x}s`:`${Math.floor(x/60)}m ${x%60}s`};return e.jsxs("div",{onClick:r,className:`grid grid-cols-12 gap-4 p-3 rounded-lg border text-sm items-center transition-colors cursor-pointer ${i(t.status)}`,children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[n(t.status),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300 capitalize truncate",children:t.status})]}),e.jsxs("div",{className:"col-span-2 flex flex-col justify-center text-xs text-gray-600 dark:text-gray-400 truncate",children:[e.jsxs("div",{className:"flex items-center gap-1",title:t.dataset_name||t.dataset_id,children:[e.jsx(ft,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:t.dataset_name||t.dataset_id||"-"})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5 text-[10px] text-gray-500",children:[e.jsx("span",{className:"font-medium truncate",children:t.model_type||"Unknown Model"}),t.job_type==="advanced_tuning"&&t.search_strategy&&e.jsxs("span",{className:"text-gray-400 truncate",children:["(",t.search_strategy,")"]})]})]}),e.jsx("div",{className:"col-span-3 font-mono text-xs text-gray-500 dark:text-gray-400 break-all",title:t.job_id,children:t.job_id}),e.jsx("div",{className:"col-span-2 text-gray-600 dark:text-gray-400 text-xs",children:o(t.start_time)}),e.jsx("div",{className:"col-span-1 text-gray-600 dark:text-gray-400 text-xs font-mono",children:d(t.start_time,t.end_time)}),e.jsx("div",{className:"col-span-1",children:t.status==="completed"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1 border border-green-200 dark:border-green-800 w-fit",children:e.jsx(at,{className:"w-3 h-3"})})}),e.jsx("div",{className:"col-span-1",children:t.error?e.jsx("span",{className:"text-red-600 dark:text-red-400 text-xs truncate block",title:t.error,children:"Error"}):t.status==="completed"&&t.result?t.job_type==="basic_training"&&t.result.metrics?e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(t.result.metrics).slice(0,1).map(([c,h])=>e.jsxs("span",{className:"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-600 truncate max-w-full",children:[c,": ",Number(h).toFixed(3)]},c))}):t.job_type==="advanced_tuning"?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.result.best_score!==void 0&&e.jsxs("span",{className:"text-[10px] bg-purple-50 dark:bg-purple-900/20 px-1.5 py-0.5 rounded text-purple-700 dark:text-purple-300 border border-purple-200 dark:border-purple-800 truncate",children:["Score: ",Number(t.result.best_score).toFixed(4)]}),!t.result.best_score&&!!t.result.best_params&&e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 truncate",children:"Params found"})]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})})]})},Vs={deployModel:async t=>(await Ae.post(`/deployment/deploy/${t}`)).data,getActive:async()=>{try{return(await Ae.get("/deployment/active")).data}catch(t){const r=t;if(r.response&&r.response.status===404)return null;throw t}},getHistory:async(t=50,r=0)=>(await Ae.get("/deployment/history",{params:{limit:t,skip:r}})).data,deactivate:async()=>{await Ae.post("/deployment/deactivate")},predict:async t=>(await Ae.post("/deployment/predict",{data:t})).data},Og=()=>{var be,Le,Ie,ct;const{jobs:t,fetchJobs:r,hasMore:n,loadMoreJobs:i,isLoading:o}=na(),[d,c]=f.useState([]),[h,u]=f.useState("all"),[x,p]=f.useState([]),[b,g]=f.useState("all"),[y,_]=f.useState(null),[w,j]=f.useState(!0),[C,S]=f.useState(!0),[T,E]=f.useState(!0),[P,A]=f.useState(!0),[R,N]=f.useState(!0),[M,z]=f.useState("charts"),[I,F]=f.useState(null),[$,J]=f.useState(!1),[ee,te]=f.useState(null),[Y,W]=f.useState(null),[U,q]=f.useState(null);f.useEffect(()=>{r(),K()},[r]),f.useEffect(()=>{var Z,X,ue;if((X=(Z=I==null?void 0:I.splits.train)==null?void 0:Z.y_proba)!=null&&X.classes&&I.splits.train.y_proba.classes.length>0){const oe=I.splits.train.y_proba,_e=((ue=oe.labels)==null?void 0:ue[0])??oe.classes[0];q(String(_e))}},[I]);const K=async()=>{try{const Z=await Ae.get("/pipeline/datasets/list");p(Z.data)}catch(Z){console.error("Failed to fetch datasets",Z)}},ce=async(Z,X)=>{if(Z.stopPropagation(),!!confirm("Are you sure you want to deploy this model to production?"))try{await Vs.deployModel(X),alert("Model deployed successfully!")}catch(ue){alert("Failed to deploy model"),console.error(ue)}},V=async Z=>{var X,ue;J(!0),F(null),te(null),W(Z);try{const oe=await Ae.get(`/pipeline/jobs/${Z}/evaluation`);F(oe.data)}catch(oe){console.error("Failed to fetch evaluation data",oe),te(((ue=(X=oe.response)==null?void 0:X.data)==null?void 0:ue.detail)||"Failed to fetch evaluation data")}finally{J(!1)}},ae=(Z,X,ue)=>{const oe=ue&&ue.length>0?[...ue]:Array.from(new Set([...Z,...X])).sort((qe,It)=>String(qe).localeCompare(String(It))),_e=oe.map(qe=>oe.map(It=>Z.reduce((nt,zt,Ke)=>{const Je=X[Ke];return String(zt)===String(qe)&&String(Je)===String(It)?nt+1:nt},0)));return{classes:oe,matrix:_e}},ie=(Z,X,ue)=>{const oe=String(ue),qe=((X.labels&&X.labels.length===X.classes.length?X.labels:void 0)??X.classes).findIndex(Ge=>String(Ge)===oe);if(qe===-1)return null;const nt=X.values.map(Ge=>Ge[qe]).map((Ge,Yt)=>({score:Ge,actual:String(Z[Yt])===oe?1:0}));nt.sort((Ge,Yt)=>Yt.score-Ge.score);const zt=[];let Ke=0,Je=0;const St=nt.filter(Ge=>Ge.actual===1).length,Xs=nt.length-St;if(St===0||Xs===0)return null;zt.push({fpr:0,tpr:0});for(let Ge=0;Ge<nt.length;Ge++)nt[Ge].actual===1?Ke++:Je++,zt.push({fpr:Je/Xs,tpr:Ke/St});return zt};f.useEffect(()=>{M==="evaluation"&&(!Y&&d.length>0||Y&&!d.includes(Y)&&d.length>0?V(d[0]):d.length===0&&(F(null),W(null)))},[M,d,Y]);const se=t.filter(Z=>{const X=h==="all"||Z.job_type===h,ue=b==="all"||Z.dataset_id===b,oe=Z.status==="completed";return X&&ue&&oe}),le=t.filter(Z=>d.includes(Z.job_id)),Se=Z=>{c(X=>X.includes(Z)?X.filter(ue=>ue!==Z):[...X,Z])},xe=le.map(Z=>{var ue;const X=Z.metrics||((ue=Z.result)==null?void 0:ue.metrics)||{};return{name:Z.job_id,...X}}),Ct=Array.from(new Set(le.flatMap(Z=>{var ue;const X=Z.metrics||((ue=Z.result)==null?void 0:ue.metrics)||{};return Object.keys(X).filter(oe=>{const _e=X[oe];return typeof _e=="number"&&!isNaN(_e)})}))).filter(Z=>!(Z.startsWith("train_")&&!w||Z.startsWith("test_")&&!C||Z.startsWith("val_")&&!T)),Qt=(Z,X)=>{if(!Z||!X)return"-";const ue=new Date(X).getTime()-new Date(Z).getTime(),oe=Math.floor(ue/1e3);return oe<60?`${oe}s`:`${Math.floor(oe/60)}m ${oe%60}s`},dt=Z=>Z==="best_score"?{type:"val",base:"best_score"}:Z.startsWith("train_")?{type:"train",base:Z.replace("train_","")}:Z.startsWith("test_")?{type:"test",base:Z.replace("test_","")}:Z.startsWith("val_")?{type:"val",base:Z.replace("val_","")}:{type:"other",base:Z},Te=new Map;Ct.forEach(Z=>{var ue;const{base:X}=dt(Z);Te.has(X)||Te.set(X,[]),(ue=Te.get(X))==null||ue.push(Z)}),Te.forEach((Z,X)=>{Te.set(X,Z.sort())});const Ot=Array.from(Te.keys()).sort(),Q=y&&Ot.includes(y)?y:Ot[0]||null;return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Experiments & Comparison"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Compare metrics and parameters across multiple runs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5",value:b,onChange:Z=>{g(Z.target.value)},children:[e.jsx("option",{value:"all",children:"All Datasets"}),x.map(Z=>e.jsx("option",{value:Z.id,children:Z.name},Z.id))]}),e.jsxs("select",{className:"bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5",value:h,onChange:Z=>{u(Z.target.value)},children:[e.jsx("option",{value:"all",children:"All Experiments"}),e.jsx("option",{value:"advanced_tuning",children:"Model Optimization"}),e.jsx("option",{value:"basic_training",children:"Standard Training"})]})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-xs font-medium text-gray-500 uppercase",children:["Select Runs to Compare (",d.length,")"]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[se.map(Z=>{var X,ue;return e.jsxs("div",{onClick:()=>{Se(Z.job_id)},className:`p-3 border-b border-gray-100 dark:border-gray-700 cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-700 ${d.includes(Z.job_id)?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:"font-mono text-xs font-semibold text-gray-700 dark:text-gray-300 break-all",children:["#",Z.version," - ",Z.job_id]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Z.status==="completed"&&(Z.job_type==="basic_training"||Z.job_type==="advanced_tuning")&&e.jsx("button",{onClick:oe=>{ce(oe,Z.job_id)},className:"p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded text-blue-600 dark:text-blue-400",title:"Deploy to Test",children:e.jsx(qn,{className:"w-3 h-3"})}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded capitalize ${Z.status==="completed"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":Z.status==="failed"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}`,children:Z.status})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[Z.model_type,"  ",Z.dataset_name||"Unknown Dataset",Z.job_type==="advanced_tuning"&&(Z.search_strategy||((X=Z.config.tuning)==null?void 0:X.strategy))&&e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",Z.search_strategy||((ue=Z.config.tuning)==null?void 0:ue.strategy),")"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] text-gray-400",children:[e.jsx("span",{children:new Date(Z.start_time||Z.created_at).toLocaleString()}),e.jsx("span",{className:"font-mono bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded text-gray-600 dark:text-gray-300",children:Qt(Z.start_time,Z.end_time)})]})]},Z.job_id)}),n&&e.jsx("div",{className:"p-2 flex justify-center border-t border-gray-100 dark:border-gray-700",children:e.jsxs("button",{onClick:()=>i(),disabled:o,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50 flex items-center gap-1",children:[o?e.jsx(xt,{className:"w-3 h-3 animate-spin"}):e.jsx(Ze,{className:"w-3 h-3"}),"Load More"]})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:le.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx(Lc,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"Select runs from the sidebar to compare them."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${M==="charts"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{z("charts")},children:"Visual Comparison"}),e.jsx("button",{className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${M==="table"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{z("table")},children:"Detailed Metrics & Params"}),e.jsx("button",{className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${M==="evaluation"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{z("evaluation")},children:"Model Evaluation"})]}),M==="charts"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Metrics Comparison"}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:Z=>{j(Z.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Train"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:Z=>{S(Z.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Test"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:Z=>{E(Z.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Validation"})]})]})]}),Ot.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 border-b border-gray-200 dark:border-gray-700 pb-2",children:Ot.map(Z=>e.jsx("button",{onClick:()=>{_(Z)},className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${Q===Z?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:Z.toUpperCase()},Z))}),Q&&Te.has(Q)&&e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"h-[300px] w-full",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:xe,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(vt,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),e.jsx(_t,{dataKey:"name",stroke:"#6B7280",fontSize:12}),e.jsx(jt,{stroke:"#6B7280",fontSize:12}),e.jsx(it,{shared:!1,cursor:{fill:"rgba(107, 114, 128, 0.1)"},contentStyle:{backgroundColor:"#1F2937",borderColor:"#374151",color:"#F3F4F6"},itemStyle:{color:"#F3F4F6"}}),e.jsx(Wn,{}),(be=Te.get(Q))==null?void 0:be.map(Z=>{const{type:X}=dt(Z);let ue="#8884d8";return X==="train"&&(ue="#3b82f6"),X==="test"&&(ue="#22c55e"),X==="val"&&(ue="#f97316"),X==="other"&&(ue="#a855f7"),e.jsx(Mt,{dataKey:Z,fill:ue,name:`${X} (${Q})`},Z)})]})})})})]}),M==="table"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden animate-in fade-in duration-300",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Detailed Comparison"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-900/50 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Parameter / Metric"}),le.map(Z=>e.jsx("th",{className:"px-4 py-2 font-mono break-all min-w-[100px]",children:Z.job_id},Z.job_id))]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsxs("tr",{className:"bg-white dark:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-2 font-medium text-gray-900 dark:text-gray-100",children:"Model Type"}),le.map(Z=>e.jsx("td",{className:"px-4 py-2 text-gray-500 dark:text-gray-400",children:Z.model_type},Z.job_id))]}),e.jsx("tr",{className:"bg-gray-50/50 dark:bg-gray-900/20 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors",onClick:()=>{A(!P)},children:e.jsxs("td",{className:"px-4 py-2 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",colSpan:le.length+1,children:[P?e.jsx(Ze,{className:"w-3 h-3"}):e.jsx(Vt,{className:"w-3 h-3"}),"Key Metrics"]})}),P&&Ct.map(Z=>e.jsxs("tr",{className:"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-1.5 text-gray-500 dark:text-gray-400 pl-8",children:Z}),le.map(X=>{var _e;const oe=(X.metrics||((_e=X.result)==null?void 0:_e.metrics)||{})[Z];return e.jsx("td",{className:"px-4 py-1.5 font-mono text-gray-600 dark:text-gray-300",children:typeof oe=="number"?oe.toFixed(4):"-"},X.job_id)})]},Z)),e.jsx("tr",{className:"bg-gray-50/50 dark:bg-gray-900/20 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors",onClick:()=>{N(!R)},children:e.jsxs("td",{className:"px-4 py-2 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",colSpan:le.length+1,children:[R?e.jsx(Ze,{className:"w-3 h-3"}):e.jsx(Vt,{className:"w-3 h-3"}),"Hyperparameters"]})}),R&&Array.from(new Set(le.flatMap(Z=>Object.keys(Z.hyperparameters||{})))).map(Z=>e.jsxs("tr",{className:"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-1.5 text-gray-500 dark:text-gray-400 pl-8",children:Z}),le.map(X=>{var ue,oe,_e;return e.jsx("td",{className:"px-4 py-1.5 font-mono text-gray-600 dark:text-gray-300",children:typeof((ue=X.hyperparameters)==null?void 0:ue[Z])=="object"?JSON.stringify((oe=X.hyperparameters)==null?void 0:oe[Z]):String(((_e=X.hyperparameters)==null?void 0:_e[Z])??"-")},X.job_id)})]},Z))]})]})})]}),M==="evaluation"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[d.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:d.map(Z=>e.jsx("button",{onClick:()=>{V(Z)},className:`px-3 py-1 text-xs font-mono rounded border whitespace-nowrap ${Y===Z?"bg-blue-100 border-blue-300 text-blue-700 dark:bg-blue-900/30 dark:border-blue-700 dark:text-blue-300":"bg-white border-gray-200 text-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400"}`,children:Z},Z))}),$?e.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-400",children:[e.jsx(Ve,{className:"w-6 h-6 animate-spin mr-2"}),"Loading evaluation data..."]}):ee?e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-red-500 p-4 text-center",children:[e.jsx("p",{className:"font-medium",children:"Error loading evaluation data"}),e.jsx("p",{className:"text-sm mt-2 opacity-80",children:ee})]}):I?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:Z=>{j(Z.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Train"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:Z=>{S(Z.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Test"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:Z=>{E(Z.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Validation"})]})]}),I.problem_type==="classification"&&((Le=I.splits.train)==null?void 0:Le.y_proba)&&(()=>{const Z=I.splits.train.y_proba;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Target Class (ROC):"}),e.jsx("select",{className:"bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-1.5",value:U||"",onChange:X=>{q(X.target.value)},children:Z.classes.map((X,ue)=>{var _e;const oe=((_e=Z.labels)==null?void 0:_e[ue])??X;return e.jsx("option",{value:String(oe),children:String(oe)},String(X))})})]})})()]}),I.problem_type==="classification"&&((ct=(Ie=I.splits.train)==null?void 0:Ie.y_proba)==null?void 0:ct.labels)&&(()=>{const Z=I.splits.train.y_proba;return e.jsxs("div",{className:"w-full text-xs text-gray-500 dark:text-gray-400",children:["Mapping: ",Z.classes.map((X,ue)=>{var oe;return`${String(X)}${String(((oe=Z.labels)==null?void 0:oe[ue])??X)}`}).join(", ")]})})()]}),e.jsx("div",{className:"flex flex-col gap-6",children:Object.entries(I.splits).filter(([Z])=>!(Z==="train"&&!w||Z==="test"&&!C||Z==="validation"&&!T)).map(([Z,X])=>{const ue=X.y_true.map((oe,_e)=>({x:oe,y:X.y_pred[_e]}));return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 capitalize",children:[Z," Set"]}),I.problem_type==="regression"?e.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[e.jsxs("div",{className:"h-[300px]",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 text-center",children:"Actual vs Predicted"}),e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(ud,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(vt,{strokeDasharray:"3 3",opacity:.2}),e.jsx(_t,{type:"number",dataKey:"x",name:"Actual",unit:"",label:{value:"Actual Values",position:"bottom",offset:0,fontSize:12},tick:{fontSize:11}}),e.jsx(jt,{type:"number",dataKey:"y",name:"Predicted",unit:"",label:{value:"Predicted Values",angle:-90,position:"left",fontSize:12},tick:{fontSize:11}}),e.jsx(it,{cursor:{strokeDasharray:"3 3"},content:({active:oe,payload:_e})=>{if(oe&&_e&&_e.length){const qe=_e[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 border border-gray-200 dark:border-gray-700 shadow-sm rounded text-xs",children:[e.jsxs("p",{className:"font-medium",children:["Actual: ",qe.x.toFixed(4)]}),e.jsxs("p",{className:"font-medium",children:["Predicted: ",qe.y.toFixed(4)]}),e.jsxs("p",{className:"text-gray-500",children:["Error: ",(qe.y-qe.x).toFixed(4)]})]})}return null}}),e.jsx(Ta,{dataKey:"x",stroke:"#ccc",strokeDasharray:"3 3",dot:!1,activeDot:!1,legendType:"none",isAnimationActive:!1}),e.jsx(La,{name:"Predictions",data:ue,fill:"#8884d8",fillOpacity:.6})]})})]}),e.jsxs("div",{className:"h-[300px]",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 text-center",children:"Residuals vs Predicted"}),e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(ud,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(vt,{strokeDasharray:"3 3",opacity:.2}),e.jsx(_t,{type:"number",dataKey:"y",name:"Predicted",unit:"",label:{value:"Predicted Values",position:"bottom",offset:0,fontSize:12},tick:{fontSize:11}}),e.jsx(jt,{type:"number",dataKey:"residual",name:"Residual",unit:"",label:{value:"Residuals (Actual - Predicted)",angle:-90,position:"left",fontSize:12},tick:{fontSize:11}}),e.jsx(it,{cursor:{strokeDasharray:"3 3"},content:({active:oe,payload:_e})=>{if(oe&&_e&&_e.length){const qe=_e[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 border border-gray-200 dark:border-gray-700 shadow-sm rounded text-xs",children:[e.jsxs("p",{className:"font-medium",children:["Predicted: ",qe.y.toFixed(4)]}),e.jsxs("p",{className:"font-medium",children:["Residual: ",qe.residual.toFixed(4)]})]})}return null}}),e.jsx(Lo,{y:0,stroke:"#ccc",strokeDasharray:"3 3"}),e.jsx(La,{name:"Residuals",data:ue.map(oe=>{const _e=oe;return{..._e,residual:_e.x-_e.y}}),fill:"#82ca9d",fillOpacity:.6})]})})]})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"h-[300px] flex flex-col items-center justify-center",children:(()=>{const oe=X.y_proba,_e=oe==null?void 0:oe.classes;let qe=X.y_true,It=X.y_pred;if(oe!=null&&oe.labels&&oe.labels.length===oe.classes.length){const Ke=new Map;oe.labels.forEach((Je,St)=>{Ke.set(String(Je),oe.classes[St])}),qe=X.y_true.map(Je=>Ke.get(String(Je))??Je),It=X.y_pred.map(Je=>Ke.get(String(Je))??Je)}const{classes:nt,matrix:zt}=ae(qe,It,_e);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-8"})," ",e.jsxs("div",{className:"flex ml-2",children:[" ",nt.map(Ke=>e.jsxs("div",{className:"w-16 text-center text-xs font-medium text-gray-500 dark:text-gray-400 pb-2",children:["Pred ",String(Ke)]},String(Ke)))]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex flex-col justify-center mr-2",children:nt.map(Ke=>e.jsxs("div",{className:"h-16 flex items-center justify-end text-xs font-medium text-gray-500 dark:text-gray-400 pr-2",children:["True ",String(Ke)]},String(Ke)))}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700",children:zt.map((Ke,Je)=>e.jsx("div",{className:"flex",children:Ke.map((St,Xs)=>{const Ge=Math.max(...zt.flat()),Yt=Ge>0?St/Ge:0;return e.jsx("div",{className:"w-16 h-16 flex items-center justify-center text-sm font-mono border border-gray-100 dark:border-gray-800",style:{backgroundColor:`rgba(59, 130, 246, ${Yt*.8+.1})`,color:Yt>.5?"white":"inherit"},title:`True: ${nt[Je]}, Pred: ${nt[Xs]}, Count: ${St}`,children:St},Xs)})},Je))})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-400",children:"Confusion Matrix"})]})})()}),X.y_proba&&e.jsxs("div",{className:"h-[300px] w-full",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 text-center",children:"ROC Curve"}),(()=>{if(!U)return e.jsx("div",{className:"text-center text-xs text-gray-400",children:"Select a class"});const oe=ie(X.y_true,X.y_proba,U);return oe?e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(_c,{data:oe,margin:{top:5,right:20,bottom:20,left:20},children:[e.jsx(vt,{strokeDasharray:"3 3",opacity:.1}),e.jsx(_t,{type:"number",dataKey:"fpr",domain:[0,1],label:{value:"False Positive Rate",position:"bottom",offset:0,fontSize:12}}),e.jsx(jt,{type:"number",dataKey:"tpr",domain:[0,1],label:{value:"True Positive Rate",angle:-90,position:"left",fontSize:12}}),e.jsx(it,{}),e.jsx(Ta,{type:"monotone",dataKey:"tpr",stroke:"#8884d8",dot:!1,strokeWidth:2}),e.jsx(Ta,{dataKey:"fpr",stroke:"#ccc",strokeDasharray:"3 3",dot:!1})]})}):e.jsx("div",{className:"text-center text-xs text-gray-400",children:"ROC not available (multiclass or missing proba)"})})()]})]})]},Z)})})]}):e.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-400 italic text-center",children:[e.jsx("p",{children:"Select a completed job to view evaluation details."}),e.jsx("p",{className:"text-xs mt-2 opacity-70",children:"(Note: Only jobs run after this update have evaluation artifacts)"})]})]})]})})]})]})},Ig=()=>{const[t,r]=f.useState(null),[n,i]=f.useState(`[
  {
    "feature1": 0.5,
    "feature2": 1.2
  }
]`),[o,d]=f.useState(null),[c,h]=f.useState(!1),[u,x]=f.useState(null),[p,b]=f.useState(null);f.useEffect(()=>{g()},[]);const g=async()=>{try{const w=await Vs.getActive();if(r(w),w){let j={},C=!1;if(w.input_schema&&w.input_schema.length>0&&(w.input_schema.forEach(S=>{j[S.name]=0}),C=!0,b(`Schema loaded from artifacts (${w.input_schema.length} features)`)),w.job_id)try{const S=await $e.getJob(w.job_id);if(S.dataset_id){const T=await Dt.getSample(S.dataset_id,1);if(T.length>0){const E=T[0];if(C)Object.keys(j).forEach(P=>{P in E&&(j[P]=E[P])});else{const P=S.target_column,A=S.dropped_columns||[],R={...E};typeof P=="string"&&P in R&&Reflect.deleteProperty(R,P),A.forEach(M=>{typeof M=="string"&&M in R&&Reflect.deleteProperty(R,M)}),j=R;const N=[];P&&N.push(`Target: ${P}`),A.length>0&&N.push(`Dropped: ${A.length} cols`),N.length>0&&b(`Auto-filtered from dataset: ${N.join(", ")}`)}}}}catch(S){console.warn("Failed to fetch dataset sample",S)}Object.keys(j).length>0&&i(JSON.stringify([j],null,2))}}catch{r(null)}},y=async()=>{if(confirm("Are you sure you want to undeploy the current model?"))try{await Vs.deactivate(),r(null),d(null)}catch(w){console.error("Failed to deactivate",w)}},_=async()=>{h(!0),x(null),d(null);try{const w=JSON.parse(n);if(!Array.isArray(w))throw new Error("Input must be a JSON array of objects");const j=await Vs.predict(w);d(j.predictions)}catch(w){x(w.message||"Prediction failed")}finally{h(!1)}};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 p-6 overflow-hidden",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 shrink-0",children:"Model Inference"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 flex-1 min-h-0",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Input Data (JSON)"}),p&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 px-2 py-1 rounded border border-amber-200 dark:border-amber-800",children:p}),e.jsx("span",{className:"text-[10px] text-gray-400 mt-1",children:"Please verify fields before running"})]})]}),e.jsx("textarea",{className:"flex-1 w-full p-4 font-mono text-sm bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none",value:n,onChange:w=>{i(w.target.value)},placeholder:'[{"col1": 1, "col2": "A"}]'}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>{_()},disabled:!t||c,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${!t||c?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-800 dark:text-gray-600":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm"}`,children:c?"Running...":e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"w-4 h-4"})," Run Prediction"]})})})]}),e.jsxs("div",{className:"flex flex-col gap-6 h-full min-h-0",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 shrink-0",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-100 mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yr,{className:"w-5 h-5 text-blue-500"}),"Active Deployment"]}),t&&e.jsxs("button",{onClick:()=>{y()},className:"flex items-center gap-1 text-xs px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400 dark:hover:bg-red-900/50 transition-colors",title:"Undeploy Model",children:[e.jsx(Qi,{className:"w-3 h-3"}),"Undeploy"]})]}),t?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Model Type"}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:t.model_type})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Job ID"}),e.jsx("div",{className:"font-mono text-sm text-gray-800 dark:text-gray-200 break-all",children:t.job_id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Deployed At"}),e.jsx("div",{className:"text-sm text-gray-800 dark:text-gray-200",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 font-medium text-sm",children:[e.jsx(at,{className:"w-4 h-4"})," Active"]})]})]}):e.jsxs("div",{className:"text-gray-500 dark:text-gray-400 italic flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4"}),"No model is currently deployed. Go to Experiments page to deploy one."]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col flex-1 min-h-0",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100 mb-4",children:"Prediction Results"}),e.jsx("div",{className:"flex-1 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4 overflow-auto",children:u?e.jsxs("div",{className:"text-red-600 dark:text-red-400 flex items-start gap-2",children:[e.jsx(lt,{className:"w-5 h-5 shrink-0 mt-0.5"}),e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm",children:u})]}):o?e.jsx("div",{className:"space-y-2",children:o.map((w,j)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-8",children:["#",j+1]}),e.jsx("span",{className:"font-mono font-medium text-blue-600 dark:text-blue-400",children:typeof w=="object"?JSON.stringify(w):String(w)})]},j))}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm italic",children:"Run a prediction to see results here..."})})]})]})]})]})},zg=()=>{const{activeView:t,isPropertiesPanelExpanded:r}=aa();return e.jsxs("div",{className:"flex h-full w-full bg-background overflow-hidden flex-col",children:[e.jsx(Mg,{}),e.jsx(Rg,{}),t==="canvas"?e.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[e.jsx(gg,{}),e.jsxs("main",{className:"flex-1 h-full relative flex flex-col transition-all duration-300 ease-in-out",children:[!r&&e.jsx(Lg,{}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Cg,{}),e.jsx(Eg,{})]})]}),e.jsx(Sg,{})]}):t==="experiments"?e.jsx(Og,{}):e.jsx(Ig,{})]})},Fg=()=>{const t=ye(d=>d.addNode),r=ye(d=>d.nodes),[n,i]=du(),o=f.useRef(!1);return f.useEffect(()=>{const d=n.get("source_id");if(d){if(o.current)return;if(r.some(u=>{var x;return u.type==="dataset_node"&&((x=u.data)==null?void 0:x.datasetId)===d})){const u=new URLSearchParams(n);u.delete("source_id"),i(u,{replace:!0});return}o.current=!0,t("dataset_node",{x:100,y:100},{datasetId:d});const h=new URLSearchParams(n);h.delete("source_id"),i(h,{replace:!0})}},[n,t,r,i]),e.jsx(zg,{})},Bg=()=>{const t=Xn(),[r,n]=f.useState(null),[i,o]=f.useState([]),[d,c]=f.useState(!1),[h,u]=f.useState(null),[x,p]=f.useState(null),[b,g]=f.useState(null),[y,_]=f.useState(null),[w,j]=f.useState(null),[C,S]=f.useState(!1),[T,E]=f.useState(0),[P,A]=f.useState(!0),R=10,[N,M]=f.useState(""),[z,I]=f.useState(""),[F,$]=f.useState(()=>{try{const V=localStorage.getItem("skyulf_manual_deployments");return V?JSON.parse(V):{}}catch{return{}}}),J=V=>{$(ae=>{const ie={...ae,[V]:!ae[V]};return localStorage.setItem("skyulf_manual_deployments",JSON.stringify(ie)),ie})},ee=async V=>{_(V),S(!0),j(null);try{const ae=await fetch(`/api/registry/artifacts/${V}`);if(ae.ok){const ie=await ae.json();j(ie)}else{const ie=await ae.json();j({storage_type:"error",base_uri:"",files:[`Failed to load artifacts: ${ie.detail||"Unknown error"}`]})}}catch{j({storage_type:"error",base_uri:"",files:["Error loading artifacts"]})}finally{S(!1)}},te=async()=>{try{const V=await fetch("/api/registry/stats");if(V.ok){const ae=await V.json();n(ae)}}catch(V){console.error("Failed to fetch stats",V)}},Y=async(V,ae=!1)=>{if(!d)try{c(!0);const ie=V*R,se=new URLSearchParams({skip:ie.toString(),limit:R.toString()}),le=await fetch(`/api/registry/models?${se.toString()}`);if(!le.ok)throw new Error("Failed to fetch models");const Se=await le.json();return Se.length<R?A(!1):A(!0),o(xe=>ae?Se:[...xe,...Se]),Se}catch(ie){return u(ie.message),null}finally{c(!1)}};f.useEffect(()=>{te(),Y(0,!0)},[]),f.useEffect(()=>{const V=ie=>{const se=ie.target;se.scrollTop+se.clientHeight>=se.scrollHeight-100&&!d&&P&&E(le=>le+1)},ae=document.querySelector("main");return ae?(ae.addEventListener("scroll",V),()=>{ae.removeEventListener("scroll",V)}):(window.addEventListener("scroll",V),()=>{window.removeEventListener("scroll",V)})},[d,P]),f.useEffect(()=>{T>0&&Y(T,!1)},[T]);const W=async V=>{if(confirm("Are you sure you want to deploy this model version? This will replace the currently active deployment."))try{g(V);const ae=await fetch(`/api/deployment/deploy/${V}`,{method:"POST"});if(!ae.ok){const se=await ae.json();throw new Error(se.detail||"Deployment failed")}E(0);const ie=await Y(0,!0);if(x&&ie){const se=ie.find(le=>le.model_type===x.model_type&&le.dataset_id===x.dataset_id);se&&p(se)}confirm("Model deployed successfully! Do you want to go to the inference page?")&&t("/deployments")}catch(ae){alert(`Error deploying model: ${ae.message}`)}finally{g(null)}},U=V=>{switch(V.toLowerCase()){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"running":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-slate-700 dark:text-slate-300"}},q=V=>{const ae=V.score||V.accuracy||V.f1_score||V.rmse||V.mse;if(ae!==void 0)return typeof ae=="number"?ae.toFixed(4):String(ae);const ie=Object.keys(V);if(ie.length>0){const se=V[ie[0]];return`${ie[0]}: ${typeof se=="number"?se.toFixed(4):se}`}return"-"},K=V=>V.toLowerCase()==="tuning"?"Advanced Training":V.toLowerCase()==="training"?"Standard Training":V.charAt(0).toUpperCase()+V.slice(1),ce=i.filter(V=>{const ae=(V.dataset_name||"").toLowerCase().includes(N.toLowerCase())||(V.dataset_id||"").toLowerCase().includes(N.toLowerCase()),ie=V.model_type.toLowerCase().includes(z.toLowerCase());return ae&&ie});return d&&!r&&i.length===0?e.jsxs("div",{className:"p-8 flex justify-center items-center h-full text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"}),"Loading registry..."]}):h?e.jsxs("div",{className:"p-8 text-center text-red-600 dark:text-red-400",children:["Error: ",h]}):e.jsxs("div",{className:"p-8 min-h-screen bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 transition-colors duration-200",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900 dark:text-white",children:"Model Registry"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage versions, track metrics, and deploy your best models."})]}),e.jsx("button",{onClick:()=>{E(0),Y(0,!0),te()},className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors shadow-sm",children:"Refresh"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(Ui,{title:"Total Versions",value:(r==null?void 0:r.total_versions)||0,icon:e.jsx(Yr,{className:"text-blue-500"})}),e.jsx(Ui,{title:"Active Deployments",value:(r==null?void 0:r.active_deployments)||0,icon:e.jsx($g,{className:"text-green-500"}),valueColor:"text-green-600 dark:text-green-400"}),e.jsx(Ui,{title:"Model Types",value:i.length,icon:e.jsx(Ji,{className:"text-purple-500"}),valueColor:"text-purple-600 dark:text-purple-400"})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Filter by Model Type"}),e.jsx("input",{type:"text",placeholder:"e.g. RandomForest",value:z,onChange:V=>{I(V.target.value)},className:"w-full px-4 py-2 rounded-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Filter by Dataset"}),e.jsx("input",{type:"text",placeholder:"e.g. Iris Dataset",value:N,onChange:V=>{M(V.target.value)},className:"w-full px-4 py-2 rounded-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/50",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ji,{size:20,className:"text-slate-400"}),"Registered Models"]}),e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Showing ",ce.length," of ",i.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Model Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Dataset"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Latest Version"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Source"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Deployments"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:ce.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-slate-500 dark:text-slate-400",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(Yr,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"No models found matching your filters."})]})})}):ce.map(V=>{const ae=V.latest_version;if(!ae)return null;const ie=`${V.model_type}-${V.dataset_id}`,se=V.deployment_count>0,le=F[ie]||!1,Se=se||le;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-white",children:V.model_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:V.dataset_name}),V.dataset_type&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-600 uppercase",children:V.dataset_type})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:e.jsxs("span",{className:"font-mono bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-xs",children:["v",ae.version]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:K(ae.source)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:new Date(ae.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${U(ae.status)}`,children:ae.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",onClick:xe=>{xe.stopPropagation()},children:[e.jsx("input",{type:"checkbox",checked:Se,onChange:()=>{J(ie)},disabled:se,className:`w-4 h-4 rounded border-gray-300 focus:ring-green-500 ${se?"text-green-600 opacity-50 cursor-not-allowed":"text-blue-600 cursor-pointer"}`}),Se?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400 font-medium bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded-full text-xs",children:[e.jsx(at,{size:12})," ",se?"Active":"Manual"]}):e.jsx("span",{className:"text-slate-400 dark:text-slate-600 text-xs",children:"None"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("button",{onClick:()=>{p(V)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 flex items-center justify-end gap-1 ml-auto",children:["View Versions ",e.jsx(Vt,{size:16})]})})]},ie)})})]})})]}),d&&i.length>0&&e.jsxs("div",{className:"py-4 flex justify-center text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),"Loading more models..."]}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:()=>{p(null)},children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden border border-slate-200 dark:border-slate-700",onClick:V=>{V.stopPropagation()},children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:x.model_type}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Version History"})]}),e.jsx("button",{onClick:()=>{p(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(We,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Version"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Metrics"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:x.versions.map(V=>e.jsxs("tr",{className:`hover:bg-slate-50 dark:hover:bg-slate-700/30 ${V.is_deployed?"bg-green-50/50 dark:bg-green-900/10":""}`,children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-mono",children:["v",V.version]}),V.is_deployed&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-1.5 py-0.5 rounded border border-green-200 dark:border-green-800",children:"Deployed"})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:new Date(V.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300 font-mono",children:q(V.metrics)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${U(V.status)}`,children:V.status})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>{ee(V.job_id)},className:"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",title:"View Artifacts",children:e.jsx(md,{size:16})}),V.status==="completed"&&!V.is_deployed&&e.jsxs("button",{onClick:()=>{W(V.job_id)},disabled:b===V.job_id,className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 disabled:opacity-50 flex items-center gap-1",children:[b===V.job_id?e.jsx("span",{className:"animate-spin h-3 w-3 border-b-2 border-current rounded-full"}):e.jsx(Wt,{size:14}),"Deploy"]}),V.is_deployed&&e.jsxs("span",{className:"text-green-600 dark:text-green-400 text-xs flex items-center gap-1",children:[e.jsx(at,{size:14})," Active"]})]})})]},V.job_id))})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex justify-end",children:e.jsx("button",{onClick:()=>{p(null)},className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md text-sm font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Close"})})]})}),y&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:()=>{_(null)},children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden border border-slate-200 dark:border-slate-700",onClick:V=>{V.stopPropagation()},children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(md,{size:20,className:"text-blue-500"}),"Artifacts"]}),e.jsx("button",{onClick:()=>{_(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(We,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:C?e.jsxs("div",{className:"flex justify-center py-8 text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),"Loading artifacts..."]}):!w||w.files.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No artifacts found."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[w.storage_type==="s3"?e.jsx(kc,{size:20,className:"text-blue-600 dark:text-blue-400 flex-shrink-0"}):e.jsx(nx,{size:20,className:"text-slate-600 dark:text-slate-400 flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-blue-700 dark:text-blue-300",children:w.storage_type==="s3"?"S3 Bucket Storage":"Local Storage"}),e.jsx("span",{className:"text-xs font-mono text-slate-600 dark:text-slate-400 truncate",title:w.base_uri,children:w.base_uri})]})]}),e.jsx("ul",{className:"space-y-2",children:w.files.map((V,ae)=>e.jsxs("li",{className:"flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-700/30 border border-slate-100 dark:border-slate-700",children:[e.jsx(br,{size:18,className:"text-slate-400"}),e.jsx("span",{className:"text-sm font-mono text-slate-700 dark:text-slate-300 break-all",children:V})]},ae))})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex justify-end",children:e.jsx("button",{onClick:()=>{_(null)},className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md text-sm font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Close"})})]})})]})},Ui=({title:t,value:r,icon:n,valueColor:i="text-slate-900 dark:text-white"})=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:t}),e.jsx("div",{className:`mt-2 text-3xl font-bold ${i}`,children:r})]}),e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:n})]}),$g=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),e.jsx("path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),e.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),e.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]}),Zg=()=>{const[t,r]=f.useState(null),[n,i]=f.useState([]),[o,d]=f.useState(!1),[c,h]=f.useState(null),u=async()=>{d(!0),h(null);try{const[b,g]=await Promise.all([Vs.getActive(),Vs.getHistory(50,0)]);r(b),i(g)}catch(b){console.error("Failed to load deployments",b),h("Failed to load deployment data.")}finally{d(!1)}};f.useEffect(()=>{u()},[]);const x=async()=>{if(confirm("Are you sure you want to deactivate the current deployment?"))try{await Vs.deactivate(),await u()}catch(b){console.error("Failed to deactivate",b),alert("Failed to deactivate deployment.")}},p=async b=>{if(confirm(`Are you sure you want to redeploy job ${b}?`))try{await Vs.deployModel(b),await u()}catch(g){console.error("Failed to redeploy",g),alert("Failed to redeploy model.")}};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-100",children:"Model Deployments"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage active models and view deployment history"})]}),e.jsx("button",{onClick:()=>{u()},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:"Refresh",children:e.jsx(xt,{className:`w-5 h-5 ${o?"animate-spin":""}`})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[c&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg border border-red-200 dark:border-red-800 flex items-center gap-2",children:[e.jsx(lt,{className:"w-5 h-5"}),c]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(qn,{className:"w-5 h-5 text-green-500"}),"Active Deployment"]}),t?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-green-200 dark:border-green-900 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(Yr,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:t.model_type}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(at,{className:"w-3 h-3"})," Active"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono",children:["Job ID: ",t.job_id]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Deployed: ",new Date(t.created_at).toLocaleString()]})]})]}),e.jsxs("button",{onClick:()=>{x()},className:"flex items-center gap-2 px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-400 rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Qi,{className:"w-4 h-4"}),"Deactivate"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 text-xs font-mono text-gray-500 dark:text-gray-400 break-all",children:["Artifact URI: ",t.artifact_uri]})]}):e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-dashed border-gray-300 dark:border-gray-700 p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(Qi,{className:"w-6 h-6 text-gray-400"})}),e.jsx("h3",{className:"text-gray-900 dark:text-gray-100 font-medium",children:"No Active Model"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Deploy a model from the Experiments page to see it here."})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Ht,{className:"w-5 h-5 text-blue-500"}),"Deployment History"]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50 text-gray-500 dark:text-gray-400 font-medium border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Model Type"}),e.jsx("th",{className:"px-6 py-3",children:"Job ID"}),e.jsx("th",{className:"px-6 py-3",children:"Deployed At"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500 dark:text-gray-400",children:"No deployment history found."})}):n.map(b=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:b.is_active?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400"}),"Inactive"]})}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 dark:text-gray-100",children:b.model_type}),e.jsxs("td",{className:"px-6 py-4 font-mono text-xs text-gray-500 dark:text-gray-400",children:[b.job_id.slice(0,8),"..."]}),e.jsx("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:new Date(b.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:!b.is_active&&e.jsx("button",{onClick:()=>{p(b.job_id)},className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium text-xs",children:"Redeploy"})})]},b.id))})]})})})]})]})]})},Hg=()=>{const[t,r]=f.useState("training"),[n,i]=f.useState([]),[o,d]=f.useState(!0),[c,h]=f.useState(""),[u,x]=f.useState(0),[p,b]=f.useState(!0),g=20,[y,_]=f.useState({training:{data:[],skip:0,hasMore:!0},tuning:{data:[],skip:0,hasMore:!0},eda:{data:[],skip:0,hasMore:!0},ingestion:{data:[],skip:0,hasMore:!0}}),w=async(T=!1)=>{T&&(d(!0),i([]),x(0),b(!0));try{const E=T?0:u;let P=[];t==="training"||t==="tuning"?P=await $e.getJobs(g,E,t):t==="eda"?P=await $e.getEDAJobs(g):t==="ingestion"&&(P=await $e.getIngestionJobs(g,E)),P.sort((R,N)=>new Date(N.created_at).getTime()-new Date(R.created_at).getTime());const A=P.length>=g;A||b(!1),T?(i(P),_(R=>({...R,[t]:{data:P,skip:E+g,hasMore:A}}))):i(R=>{const N=[...R,...P];return _(M=>({...M,[t]:{data:N,skip:E+g,hasMore:A}})),N}),x(E+g)}catch(E){console.error("Failed to fetch jobs:",E)}finally{d(!1)}};f.useEffect(()=>{const T=y[t];T.data.length>0?(i(T.data),x(T.skip),b(T.hasMore),d(!1)):w(!0)},[t]);const j=()=>{w(!1)},C=n.filter(T=>{if(c){const E=c.toLowerCase();return T.job_id.toLowerCase().includes(E)||T.model_type&&T.model_type.toLowerCase().includes(E)||T.dataset_name&&T.dataset_name.toLowerCase().includes(E)}return!0}),S=(T,E)=>{if(!T||!E)return"-";const P=new Date(T).getTime(),R=new Date(E).getTime()-P;if(R<1e3)return"< 1s";const N=Math.floor(R/1e3);if(N<60)return`${N}s`;const M=Math.floor(N/60);return M<60?`${M}m ${N%60}s`:`${Math.floor(M/60)}h ${M%60}m`};return e.jsxs("div",{className:"p-8 space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Jobs"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Monitor and manage all your pipeline activities"})]}),e.jsxs("button",{onClick:()=>w(),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-slate-700 dark:text-slate-300",children:[e.jsx(xt,{size:16}),"Refresh"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto w-full md:w-auto pb-2 md:pb-0",children:[e.jsx(Nn,{active:t==="training",onClick:()=>r("training"),icon:e.jsx(ix,{size:16}),label:"Training"}),e.jsx(Nn,{active:t==="tuning",onClick:()=>r("tuning"),icon:e.jsx(Ve,{size:16}),label:"Tuning"}),e.jsx(Nn,{active:t==="eda",onClick:()=>r("eda"),icon:e.jsx(ks,{size:16}),label:"EDA"}),e.jsx(Nn,{active:t==="ingestion",onClick:()=>r("ingestion"),icon:e.jsx(ft,{size:16}),label:"Ingestion"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search jobs...",value:c,onChange:T=>h(T.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:text-slate-100"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[o?e.jsxs("div",{className:"p-12 text-center text-slate-500",children:[e.jsx(xt,{className:"animate-spin mx-auto mb-4",size:24}),"Loading jobs..."]}):C.length===0?e.jsx("div",{className:"p-12 text-center text-slate-500",children:"No jobs found matching your criteria."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Job ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Created At"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:C.map(T=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(Ug,{status:T.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-slate-100",children:e.jsx("span",{className:"font-mono text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded",children:T.job_id.substring(0,8)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400 capitalize",children:T.job_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:T.model_type||T.dataset_name||T.target_column||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400 font-mono",children:S(T.start_time,T.end_time)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:[new Date(T.created_at).toLocaleDateString()," ",e.jsx("span",{className:"text-xs opacity-70",children:new Date(T.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},T.job_id))})]})}),!o&&p&&C.length>0&&e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex justify-center",children:e.jsx("button",{onClick:j,className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1 px-4 py-2 rounded-md hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors",children:"Load More"})})]})]})},Nn=({active:t,onClick:r,icon:n,label:i})=>e.jsxs("button",{onClick:r,className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${t?"bg-indigo-600 text-white shadow-sm":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[n,i]}),Ug=({status:t})=>{const r={succeeded:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",completed:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",failed:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",running:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",queued:"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400"},n={succeeded:e.jsx(at,{size:14}),completed:e.jsx(at,{size:14}),failed:e.jsx(Wa,{size:14}),running:e.jsx(Ve,{size:14,className:"animate-pulse"}),pending:e.jsx(Ht,{size:14}),queued:e.jsx(Ht,{size:14})},i=t.toLowerCase(),o=r[i]||"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400",d=n[i]||e.jsx(Ht,{size:14});return e.jsxs("span",{className:`px-2.5 py-1 inline-flex items-center gap-1.5 text-xs font-medium rounded-full ${o}`,children:[d,t.charAt(0).toUpperCase()+t.slice(1)]})},Ir="/api/eda",ws={analyze:async(t,r,n,i,o)=>(await Is.post(`${Ir}/${t}/analyze`,{target_col:r,exclude_cols:n,filters:i,task_type:o})).data,getLatestReport:async t=>(await Is.get(`${Ir}/${t}/latest`)).data,getReport:async t=>(await Is.get(`${Ir}/reports/${t}`)).data,cancelJob:async t=>(await Is.post(`${Ir}/reports/${t}/cancel`)).data,getHistory:async t=>(await Is.get(`${Ir}/${t}/history`)).data,getDecomposition:async(t,r,n,i,o)=>(await Is.post(`${Ir}/${t}/decomposition`,{measure_col:r,measure_agg:n,split_col:i,filters:o})).data},Wg=({isOpen:t,onClose:r,history:n,onSelect:i,onFetchReport:o,onRefresh:d})=>{var j,C,S,T,E,P,A,R;const[c,h]=f.useState(null),[u,x]=f.useState(!1),[p,b]=f.useState(null);if(!t)return null;const g=()=>{h(null),r()},y=async(N,M)=>{if(N.stopPropagation(),confirm("Are you sure you want to cancel this analysis?")){b(M);try{await ws.cancelJob(M),d&&d()}catch(z){console.error("Failed to cancel job",z),alert("Failed to cancel job")}finally{b(null)}}},_=async N=>{x(!0);try{const M=await o(N.id);h(M)}catch(M){console.error("Failed to load report details",M)}finally{x(!1)}},w=N=>{switch(N){case"Numeric":return e.jsx(Do,{className:"w-4 h-4 text-blue-500"});case"Categorical":return e.jsx(Ec,{className:"w-4 h-4 text-purple-500"});case"DateTime":return e.jsx(yr,{className:"w-4 h-4 text-green-500"});default:return e.jsx(br,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full flex flex-col transition-all duration-300 ${c?"max-w-5xl h-[90vh]":"max-w-2xl max-h-[80vh]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c?e.jsx("button",{onClick:()=>h(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(Tc,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})}):e.jsx(Ht,{className:"w-5 h-5 text-blue-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:c?`Analysis #${c.id} Details`:"Analysis History"})]}),e.jsx("button",{onClick:g,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",children:e.jsx(We,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c?u?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Xe,{className:"w-12 h-12 mb-4 animate-spin text-blue-500"}),e.jsx("p",{children:"Loading analysis details..."})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(ft,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs uppercase font-medium",children:"Rows"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:((C=(j=c.profile_data)==null?void 0:j.row_count)==null?void 0:C.toLocaleString())||"-"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(Nc,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs uppercase font-medium",children:"Columns"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:((T=(S=c.profile_data)==null?void 0:S.column_count)==null?void 0:T.toLocaleString())||"-"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(br,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs uppercase font-medium",children:"Missing Cells"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[(P=(E=c.profile_data)==null?void 0:E.missing_cells_percentage)==null?void 0:P.toFixed(1),"%"]})]})]}),((A=c.profile_data)==null?void 0:A.excluded_columns)&&c.profile_data.excluded_columns.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(Gn,{className:"w-4 h-4 text-gray-500"}),"Excluded Columns (",c.profile_data.excluded_columns.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.profile_data.excluded_columns.map(N=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded text-sm line-through",children:N},N))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Variables Overview"}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50 text-gray-500 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Missing"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Distinct"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:((R=c.profile_data)==null?void 0:R.columns)&&Object.values(c.profile_data.columns).map(N=>{var M;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 dark:text-white",children:N.name}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w(N.dtype),e.jsx("span",{children:N.dtype})]})}),e.jsx("td",{className:"px-4 py-3",children:N.missing_percentage>0?e.jsxs("span",{className:"text-amber-600",children:[N.missing_percentage.toFixed(1),"%"]}):e.jsx("span",{className:"text-green-600",children:"0%"})}),e.jsx("td",{className:"px-4 py-3 text-gray-500 dark:text-gray-400",children:((M=N.categorical_stats)==null?void 0:M.unique_count)||"-"})]},N.name)})})]})})]})]}):n.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(Ht,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No history available for this dataset."})]}):e.jsx("div",{className:"space-y-3",children:n.map(N=>e.jsxs("div",{onClick:()=>_(N),className:"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${N.status==="COMPLETED"?"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":N.status==="FAILED"?"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400":N.status==="CANCELLED"?"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400":"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:N.status==="COMPLETED"?e.jsx(at,{className:"w-5 h-5"}):N.status==="FAILED"?e.jsx(lt,{className:"w-5 h-5"}):N.status==="CANCELLED"?e.jsx(En,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5 animate-spin"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 flex items-center gap-2",children:["Analysis #",N.id,e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${N.status==="COMPLETED"?"bg-green-50 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800":N.status==="FAILED"?"bg-red-50 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800":N.status==="CANCELLED"?"bg-gray-50 text-gray-700 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700":"bg-yellow-50 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800"}`,children:N.status})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(N.created_at).toLocaleString()}),N.target_col&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(Wt,{className:"w-3 h-3"})," Target: ",N.target_col,N.task_type&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-[10px]",children:N.task_type})]})]})]}),e.jsx("div",{className:"text-right flex items-center gap-4",children:(N.status==="PENDING"||N.status==="STARTED"||N.status==="RUNNING")&&e.jsx("button",{onClick:M=>y(M,N.id),disabled:p===N.id,className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full transition-colors",title:"Cancel Analysis",children:p===N.id?e.jsx(Xe,{className:"w-4 h-4 animate-spin"}):e.jsx(En,{className:"w-4 h-4"})})})]},N.id))})}),e.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-xl flex justify-between items-center",children:c?e.jsxs("button",{onClick:()=>{i(c),g()},className:"ml-auto flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors shadow-sm",children:[e.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Load this Report"]}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center w-full",children:"Select a previous analysis to view details."})})]})})},ot=({text:t,align:r="center"})=>{const n={center:"left-1/2 -translate-x-1/2",left:"left-0",right:"right-0"},i={center:"left-1/2 -translate-x-1/2",left:"left-2",right:"right-2"};return e.jsxs("div",{className:"group relative ml-2 inline-flex items-center",children:[e.jsx(Kt,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsxs("div",{className:`absolute bottom-full mb-2 w-64 p-2 bg-gray-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none text-center ${n[r]}`,children:[t,e.jsx("div",{className:`absolute top-full border-4 border-transparent border-t-gray-800 ${i[r]}`})]})]})},Vg=({profile:t,onBarClick:r})=>{var o;if(!t)return null;let n=[];const i=t.dtype;if(i==="Numeric"&&t.histogram)n=t.histogram.map(d=>({name:`${Number(d.start).toFixed(2)}`,fullName:`${Number(d.start).toFixed(2)} - ${Number(d.end).toFixed(2)}`,count:d.count,rawBin:d}));else if(i==="Text"&&t.histogram)n=t.histogram.map(d=>({name:`${Number(d.start).toFixed(0)}`,fullName:`${Number(d.start).toFixed(0)} - ${Number(d.end).toFixed(0)} chars`,count:d.count,rawBin:d}));else if(i==="DateTime"&&t.histogram)n=t.histogram.map(d=>({name:new Date(d.start).toLocaleDateString(void 0,{month:"short",year:"2-digit"}),fullName:`${new Date(d.start).toLocaleDateString()} - ${new Date(d.end).toLocaleDateString()}`,count:d.count,rawBin:d}));else if(i==="Categorical"&&((o=t.categorical_stats)!=null&&o.top_k))n=t.categorical_stats.top_k.map(d=>({name:String(d.value).substring(0,15)+(String(d.value).length>15?"...":""),fullName:String(d.value),count:d.count,value:d.value}));else return e.jsx("div",{className:"text-gray-500 text-sm italic p-4 text-center",children:"No distribution data available for this type"});return n.length===0?e.jsx("div",{className:"text-gray-500 text-sm italic p-4 text-center",children:"No data points"}):e.jsxs("div",{className:"h-64 w-full relative",children:[t.normality_test&&e.jsxs("div",{className:"absolute top-0 right-0 bg-white/90 dark:bg-gray-800/90 p-2 rounded border border-gray-200 dark:border-gray-700 text-xs z-10 shadow-sm",children:[e.jsxs("div",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:["Normality Test (",t.normality_test.test_name,")",e.jsx(ot,{text:"Normality tests are performed on a sample of up to 5,000 rows. Shapiro-Wilk is used for smaller datasets (<5,000), and Kolmogorov-Smirnov for larger ones. For very large datasets, rely on Skewness and Kurtosis.",align:"right"})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-gray-500",children:"p-value:"}),e.jsx("span",{className:`font-mono ${t.normality_test.is_normal?"text-green-600":"text-red-500"}`,children:t.normality_test.p_value.toExponential(2)})]}),e.jsx("div",{className:"mt-1 text-[10px] text-gray-400",children:t.normality_test.is_normal?"Likely Normal Distribution":"Likely Not Normal"})]}),e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:n,margin:{top:5,right:30,left:20,bottom:30},children:[e.jsx(vt,{strokeDasharray:"3 3",vertical:!1,stroke:"#e5e7eb"}),e.jsx(_t,{dataKey:"name",tick:{fontSize:11,fill:"#6b7280"},interval:"preserveStartEnd",angle:-45,textAnchor:"end"}),e.jsx(jt,{tick:{fontSize:11,fill:"#6b7280"}}),e.jsx(it,{content:({active:d,payload:c})=>{if(d&&c&&c.length){const h=c[0].payload;return e.jsxs("div",{className:"bg-gray-800 text-white text-xs p-2 rounded shadow-lg",children:[e.jsx("p",{className:"font-semibold mb-1",children:h.fullName}),e.jsxs("p",{children:["Count: ",h.count]}),r&&e.jsx("p",{className:"text-blue-300 mt-1 italic",children:"Click to filter"})]})}return null}}),e.jsx(Mt,{dataKey:"count",radius:[4,4,0,0],onClick:d=>r&&r(d),className:r?"cursor-pointer hover:opacity-80":"",children:n.map((d,c)=>e.jsx(Ea,{fill:i==="Numeric"?"#3b82f6":"#8b5cf6"},`cell-${c}`))})]})})]})},qg=({selectedVariable:t,onClose:r,downloadChart:n,filters:i,setFilters:o,runAnalysis:d,handleAddFilter:c})=>{var h,u,x,p,b,g,y,_,w;return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto flex flex-col animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[t.name,e.jsx("span",{className:`text-sm font-normal px-2 py-0.5 rounded-full ${t.dtype==="Numeric"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":t.dtype==="Categorical"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,children:t.dtype})]})}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",children:e.jsx(We,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mr-2",children:"Distribution"}),e.jsx(ot,{text:"Click on any bar to filter the entire dataset by that range or category."})]}),e.jsx("button",{onClick:()=>{let j;t.normality_test&&(j=`Normality Test (${t.normality_test.test_name})
p-value: ${t.normality_test.p_value.toExponential(2)}
${t.normality_test.is_normal?"Likely Normal":"Likely Not Normal"}`),n("distribution-chart",`distribution-${t.name}`,`Distribution: ${t.name}`,void 0,j)},className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(wt,{className:"w-3 h-3"})})]}),e.jsx("div",{id:"distribution-chart",children:e.jsx(Vg,{profile:t,onBarClick:j=>{if((t.dtype==="Numeric"||t.dtype==="DateTime")&&j.rawBin){const C=[...i,{column:t.name,operator:">=",value:j.rawBin.start},{column:t.name,operator:"<",value:j.rawBin.end}];o(C),d(void 0,C),r()}else t.dtype==="Categorical"&&(c(t.name,j.value,"=="),r())}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2",children:"General Statistics"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-sm",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Missing"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[t.missing_count," (",t.missing_percentage.toFixed(2),"%)"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2",children:[t.dtype," Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.numeric_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Mean"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(h=t.numeric_stats.mean)==null?void 0:h.toFixed(4)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Median"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(u=t.numeric_stats.median)==null?void 0:u.toFixed(4)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Std Dev"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(x=t.numeric_stats.std)==null?void 0:x.toFixed(4)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Min"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.numeric_stats.min})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Max"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.numeric_stats.max})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Zeros"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.numeric_stats.zeros_count})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Skewness"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(p=t.numeric_stats.skewness)==null?void 0:p.toFixed(4)}),e.jsx("span",{className:"block text-[10px] text-gray-500 mt-1",children:Math.abs(t.numeric_stats.skewness)<.5?"Symmetric (Normal-like)":Math.abs(t.numeric_stats.skewness)<1?"Moderately Skewed":"Highly Skewed"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Kurtosis"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(b=t.numeric_stats.kurtosis)==null?void 0:b.toFixed(4)}),e.jsx("span",{className:"block text-[10px] text-gray-500 mt-1",children:Math.abs(t.numeric_stats.kurtosis)<.5?"Mesokurtic (Normal-like)":t.numeric_stats.kurtosis>0?"Leptokurtic (Heavy Tails)":"Platykurtic (Light Tails)"})]}),t.normality_test&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:["Normality (",t.normality_test.test_name,")"]}),e.jsx(ot,{text:"Normality tests are performed on a sample of up to 5,000 rows. Shapiro-Wilk is used for smaller datasets (<5,000), and Kolmogorov-Smirnov for larger ones. For very large datasets, rely on Skewness and Kurtosis."})]}),e.jsx("span",{className:`font-medium ${t.normality_test.is_normal?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:t.normality_test.is_normal?"Normal":"Not Normal"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"P-Value"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.normality_test.p_value.toFixed(4)})]})]})]}),t.categorical_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Unique Values"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.categorical_stats.unique_count})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Rare Labels"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.categorical_stats.rare_labels_count})]})]}),t.text_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Avg Length"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(g=t.text_stats.avg_length)==null?void 0:g.toFixed(2)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Min Length"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.text_stats.min_length})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Max Length"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.text_stats.max_length})]})]}),t.date_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Min Date"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.date_stats.min_date})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Max Date"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.date_stats.max_date})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Duration (Days)"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(y=t.date_stats.duration_days)==null?void 0:y.toFixed(1)})]})]})]})]})]}),((_=t.categorical_stats)==null?void 0:_.top_k)&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 uppercase tracking-wider",children:"Top Categories"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:t.categorical_stats.top_k.map((j,C)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 text-sm",children:[e.jsx("span",{className:"truncate font-medium text-gray-700 dark:text-gray-300",title:j.value,children:j.value}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-900 px-2 py-0.5 rounded-full text-xs",children:j.count})]},C))})]}),((w=t.text_stats)==null?void 0:w.common_words)&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 uppercase tracking-wider",children:"Most Common Words"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.text_stats.common_words.map((j,C)=>e.jsxs("div",{className:"flex items-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 text-sm",children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400 mr-2",children:j.word}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:["(",j.count,")"]})]},C))})]})]})]})}):null},Gg=({activeTab:t,setActiveTab:r,profile:n,filters:i,columns:o,excludedCols:d,onAddFilter:c,onRemoveFilter:h,onClearFilters:u,onToggleExclude:x})=>{const[p,b]=f.useState(!0),[g,y]=f.useState(!1),[_,w]=f.useState(!1),[j,C]=f.useState(!1),[S,T]=f.useState(""),[E,P]=f.useState("=="),[A,R]=f.useState(""),[N,M]=f.useState(!1),z=()=>{S&&A&&(c(S,isNaN(Number(A))?A:Number(A),E),C(!1),T(""),R(""))},I=[{title:"Overview",items:[{id:"dashboard",label:"Dashboard",icon:Eo,show:!0},{id:"sample",label:"Sample Data",icon:Mo,show:!!n.sample_data},{id:"insights",label:"Smart Insights",icon:Kn,show:!0}]},{title:"Univariate Analysis",items:[{id:"variables",label:"Variables",icon:ks,show:!0},{id:"outliers",label:"Outliers",icon:wr,show:!!n.outliers},{id:"target",label:"Target Analysis",icon:ox,show:!!(n.target_col&&n.target_correlations)}]},{title:"Multivariate Analysis",items:[{id:"correlations",label:"Correlations",icon:lx,show:!!(n.correlations||n.correlations_with_target)},{id:"bivariate",label:"Bivariate",icon:Jn,show:!0},{id:"pca",label:"PCA Projection",icon:Rn,show:!!n.pca_data}]},{title:"Structure & Causal",items:[{id:"causal",label:"Causal Graph",icon:Rn,show:!!n.causal_graph},{id:"rules",label:"Decision Rules",icon:Ra,show:!!n.rule_tree},{id:"decomposition",label:"Decomposition",icon:Ao,show:!0}]},{title:"Specialized",items:[{id:"timeseries",label:"Time Series",icon:yr,show:!!n.timeseries},{id:"geospatial",label:"Geospatial",icon:Rc,show:!!n.geospatial}]}];return e.jsxs("div",{className:`${_?"w-14":"w-60"} bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0 h-full overflow-y-auto flex flex-col transition-all duration-300`,children:[!_&&e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 space-y-3 bg-gray-50/50 dark:bg-gray-900/20",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between w-full mb-2",children:[e.jsxs("button",{onClick:()=>b(!p),className:"flex items-center text-xs font-semibold text-gray-500 uppercase tracking-wider hover:text-gray-700",children:[e.jsxs("span",{children:["Active Filters (",i.length,")"]}),p?e.jsx(Gs,{className:"w-3 h-3 ml-1"}):e.jsx(Ze,{className:"w-3 h-3 ml-1"})]}),i.length>0&&e.jsx("button",{onClick:u,className:"text-[10px] text-red-500 hover:text-red-700 hover:underline",children:"Clear All"})]}),p&&e.jsxs("div",{className:"space-y-2",children:[i.map((F,$)=>e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded px-2 py-1 text-xs",children:[e.jsxs("div",{className:"truncate max-w-[140px]",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:F.column}),e.jsx("span",{className:"mx-1 text-gray-500",children:F.operator}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:String(F.value)})]}),e.jsx("button",{onClick:()=>h($),className:"text-gray-400 hover:text-red-500",children:e.jsx(We,{className:"w-3 h-3"})})]},$)),j?e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded border border-gray-200 dark:border-gray-700 space-y-2 shadow-sm",children:[e.jsxs("select",{value:S,onChange:F=>T(F.target.value),className:"w-full text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",children:[e.jsx("option",{value:"",disabled:!0,children:"Column"}),o.map(F=>e.jsx("option",{value:F,children:F},F))]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{value:E,onChange:F=>P(F.target.value),className:"w-1/3 text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",children:[e.jsx("option",{value:"==",children:"=="}),e.jsx("option",{value:"!=",children:"!="}),e.jsx("option",{value:">",children:">"}),e.jsx("option",{value:"<",children:"<"}),e.jsx("option",{value:">=",children:">="}),e.jsx("option",{value:"<=",children:"<="})]}),e.jsx("input",{type:"text",value:A,onChange:F=>R(F.target.value),placeholder:"Value",className:"w-2/3 text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",onKeyDown:F=>F.key==="Enter"&&z()})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>C(!1),className:"text-xs text-gray-500 hover:text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:z,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700",children:"Add"})]})]}):e.jsxs("button",{onClick:()=>C(!0),className:"w-full flex items-center justify-center px-2 py-1 text-xs border border-dashed border-gray-300 dark:border-gray-600 rounded text-gray-500 hover:text-blue-600 hover:border-blue-300 transition-colors",children:[e.jsx(Ut,{className:"w-3 h-3 mr-1"})," Add Filter"]})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>y(!g),className:"flex items-center justify-between w-full text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 hover:text-gray-700",children:[e.jsxs("span",{children:["Excluded (",d.length,")"]}),g?e.jsx(Gs,{className:"w-3 h-3"}):e.jsx(Ze,{className:"w-3 h-3"})]}),g&&e.jsxs("div",{className:"space-y-2",children:[d.map((F,$)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 text-xs",children:[e.jsx("span",{className:"font-medium text-gray-500 line-through truncate max-w-[140px]",children:F}),e.jsx("button",{onClick:()=>x(F,!1),className:"text-gray-400 hover:text-green-500",title:"Include back",children:e.jsx(Ut,{className:"w-3 h-3"})})]},$)),N?e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded border border-gray-200 dark:border-gray-700 space-y-2 shadow-sm",children:[e.jsxs("select",{className:"w-full text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",onChange:F=>{F.target.value&&(x(F.target.value,!0),M(!1))},defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Column"}),o.filter(F=>!d.includes(F)).map(F=>e.jsx("option",{value:F,children:F},F))]}),e.jsx("button",{onClick:()=>M(!1),className:"w-full text-xs text-gray-500 hover:text-gray-700 text-center",children:"Cancel"})]}):e.jsxs("button",{onClick:()=>M(!0),className:"w-full flex items-center justify-center px-2 py-1 text-xs border border-dashed border-gray-300 dark:border-gray-600 rounded text-gray-500 hover:text-red-600 hover:border-red-300 transition-colors",children:[e.jsx(Gn,{className:"w-3 h-3 mr-1"})," Exclude Column"]})]})]})]}),e.jsxs("div",{className:`flex-1 overflow-y-auto ${_?"p-2":"p-3"}`,children:[e.jsxs("div",{className:`flex items-center ${_?"justify-center":"justify-between"} mb-3`,children:[!_&&e.jsx("h2",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Analysis Modules"}),e.jsx("button",{onClick:()=>w(!_),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-gray-500",title:_?"Expand Sidebar":"Collapse Sidebar",children:_?e.jsx(Sc,{className:"w-4 h-4"}):e.jsx(Pc,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-6",children:I.map((F,$)=>{const J=F.items.filter(ee=>ee.show);return J.length===0?null:e.jsxs("div",{children:[!_&&e.jsx("h3",{className:"px-2 text-xs font-medium text-gray-500 mb-2",children:F.title}),e.jsx("div",{className:"space-y-1",children:J.map(ee=>e.jsxs("button",{onClick:()=>r(ee.id),title:_?ee.label:void 0,className:`w-full flex items-center ${_?"justify-center py-2":"px-2 py-2"} text-sm font-medium rounded-md transition-colors ${t===ee.id?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(ee.icon,{className:`${_?"h-5 w-5":"mr-3 h-4 w-4"} ${t===ee.id?"text-blue-500":"text-gray-400"}`}),!_&&ee.label,!_&&t===ee.id&&e.jsx(Vt,{className:"ml-auto h-4 w-4 text-blue-400"})]},ee.id))})]},$)})})]})]})},Kg=({profile:t})=>t?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Rows"}),e.jsx("div",{className:"text-2xl font-bold",children:t.row_count.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Columns"}),e.jsx("div",{className:"text-2xl font-bold",children:t.column_count})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Missing Cells"}),e.jsxs("div",{className:"text-2xl font-bold",children:[t.missing_cells_percentage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Duplicates"}),e.jsx("div",{className:"text-2xl font-bold",children:t.duplicate_rows})]})]}):null,Jg=({alerts:t})=>{const[r,n]=f.useState(!0);return!t||t.length===0?null:e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>n(!r),children:[e.jsxs("h3",{className:"font-medium text-amber-800 dark:text-amber-200 flex items-center",children:[e.jsx(lt,{className:"w-4 h-4 mr-2"}),"Data Quality Alerts (",t.length,")"]}),r?e.jsx(Gs,{className:"w-4 h-4 text-amber-800 dark:text-amber-200"}):e.jsx(Ze,{className:"w-4 h-4 text-amber-800 dark:text-amber-200"})]}),r&&e.jsx("div",{className:"max-h-40 overflow-y-auto pr-2 mt-2 animate-in slide-in-from-top-2 duration-200",children:e.jsx("ul",{className:"space-y-1",children:t.map((i,o)=>e.jsxs("li",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-start",children:[e.jsx("span",{className:"mr-2",children:""}),e.jsxs("span",{children:[i.column&&e.jsxs("span",{className:"font-semibold",children:[i.column,": "]}),i.message]})]},o))})})]})},Fd=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],Qg=({profile:t})=>{const r=f.useMemo(()=>{if(!(t!=null&&t.columns))return[];const i={};return Object.values(t.columns).forEach(o=>{i[o.dtype]=(i[o.dtype]||0)+1}),Object.entries(i).map(([o,d])=>({name:o,value:d}))},[t]),n=f.useMemo(()=>t!=null&&t.columns?Object.values(t.columns).filter(i=>i.missing_percentage>0).sort((i,o)=>o.missing_percentage-i.missing_percentage).slice(0,10).map(i=>({name:i.name,value:i.missing_percentage})):[],[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Kg,{profile:t}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ft,{className:"w-5 h-5 mr-2 text-blue-500"}),"Column Types"]}),e.jsx("div",{className:"h-64",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(yc,{children:[e.jsx(vc,{data:r,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,fill:"#8884d8",paddingAngle:5,dataKey:"value",children:r.map((i,o)=>e.jsx(Ea,{fill:Fd[o%Fd.length]},`cell-${o}`))}),e.jsx(it,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(Wn,{verticalAlign:"bottom",height:36})]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(wr,{className:"w-5 h-5 mr-2 text-amber-500"}),"Top Missing Values"]}),n.length>0?e.jsx("div",{className:"h-64",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:n,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(vt,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#e5e7eb"}),e.jsx(_t,{type:"number",domain:[0,100],unit:"%",hide:!0}),e.jsx(jt,{dataKey:"name",type:"category",width:100,tick:{fontSize:12,fill:"#6b7280"}}),e.jsx(it,{formatter:i=>[i.toFixed(1)+"%","Missing"],contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},cursor:{fill:"transparent"}}),e.jsx(Mt,{dataKey:"value",radius:[0,4,4,0],barSize:20,children:n.map((i,o)=>e.jsx(Ea,{fill:`hsl(10, 80%, ${60-o*5}%)`},`cell-${o}`))})]})})}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(br,{className:"w-12 h-12 mb-2 opacity-20"}),e.jsx("p",{children:"No missing values found!"})]})]})]}),e.jsx(Jg,{alerts:t.alerts})]})},Yg=({profile:t})=>e.jsx("div",{className:"mt-4 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Kn,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Smart Recommendations"]}),t.recommendations&&t.recommendations.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.recommendations.map((r,n)=>e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800 px-2 py-1 rounded border border-blue-100 dark:border-blue-800",children:r.action}),r.column&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:r.column})]}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white text-sm mb-1",children:r.reason}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r.suggestion})]},n))}):e.jsx("p",{className:"text-gray-500 italic",children:"No specific recommendations found. Your data looks clean!"})]})}),xu=({data:t,xKey:r,yKey:n,zKey:i,labelKey:o,xLabel:d,yLabel:c,zLabel:h,height:u=600})=>{const x=[];if(o){const p={};t.forEach(b=>{const g=b[o]||"Other";p[g]||(p[g]=[]),p[g].push(b)}),Object.keys(p).forEach(b=>{const g=p[b];x.push({x:g.map(y=>y[r]),y:g.map(y=>y[n]),z:g.map(y=>y[i]),mode:"markers",type:"scatter3d",name:b,marker:{size:3,opacity:.8},hovertemplate:`<b>${b}</b><br>${d||r}: %{x}<br>${c||n}: %{y}<br>${h||i}: %{z}<extra></extra>`})})}else x.push({x:t.map(p=>p[r]),y:t.map(p=>p[n]),z:t.map(p=>p[i]),mode:"markers",type:"scatter3d",name:"Data Points",marker:{size:3,color:"#8884d8",opacity:.8},hovertemplate:`${d||r}: %{x}<br>${c||n}: %{y}<br>${h||i}: %{z}<extra></extra>`});return e.jsx("div",{style:{height:u,width:"100%"},children:e.jsx(Ax,{data:x,layout:{autosize:!0,height:u,margin:{l:0,r:0,b:0,t:0},scene:{xaxis:{title:{text:d||r}},yaxis:{title:{text:c||n}},zaxis:{title:{text:h||i}}},showlegend:!0,legend:{x:0,y:1}},useResizeHandler:!0,style:{width:"100%",height:"100%"},config:{displayModeBar:!0}})})};Mm.register(Dm,Am,Om,Im,zm);const pu=({data:t,xKey:r,yKey:n,labelKey:i,xLabel:o,yLabel:d,height:c=500})=>{const h=[];if(i){const x={};t.forEach(b=>{const g=b[i]||"Other";x[g]||(x[g]=[]),x[g].push({x:b[r],y:b[n],raw:b})});const p=["#8884d8","#82ca9d","#ffc658","#ff7300","#0088fe","#00C49F","#FFBB28","#FF8042"];Object.keys(x).forEach((b,g)=>{h.push({label:b,data:x[b],backgroundColor:p[g%p.length],pointRadius:3,pointHoverRadius:5})})}else h.push({label:"Data Points",data:t.map(x=>({x:x[r],y:x[n],raw:x})),backgroundColor:"#8884d8",pointRadius:3,pointHoverRadius:5});const u={responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!!o,text:o,color:"#6b7280",font:{weight:"bold"}},grid:{color:"rgba(0, 0, 0, 0.2)",lineWidth:1},ticks:{color:"#6b7280"}},y:{title:{display:!!d,text:d,color:"#6b7280",font:{weight:"bold"}},grid:{color:"rgba(0, 0, 0, 0.2)",lineWidth:1},ticks:{color:"#6b7280"}}},plugins:{tooltip:{callbacks:{label:x=>{const p=x.raw;let b=x.dataset.label||"";return b&&(b+=": "),b+=`(${p.x}, ${p.y})`,b}}},legend:{display:!!i&&h.length<20}}};return e.jsx("div",{style:{height:c,width:"100%"},children:e.jsx(Fm,{options:u,data:{datasets:h}})})},Xg=({profile:t,isPCA3D:r,setIsPCA3D:n,downloadChart:i})=>e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Jn,{className:"w-5 h-5 mr-2 text-purple-500"}),"Multivariate Structure (PCA)",e.jsx(ot,{text:"Reduces data to 2D or 3D. Points closer together are similar. Colors show clusters or target values."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i("pca-chart","pca-analysis","Multivariate Structure (PCA)",r?"3D Projection":"2D Projection"),className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download Chart",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>n(!r),className:`p-2 rounded-md border transition-colors flex items-center gap-2 text-sm ${r?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"}`,children:[e.jsx(Yr,{className:"w-4 h-4"}),r?"Switch to 2D":"Switch to 3D"]})]})]}),e.jsx("div",{id:"pca-chart",children:t.pca_data?r?e.jsx(xu,{data:t.pca_data,xKey:"x",yKey:"y",zKey:"z",labelKey:"label",xLabel:"PC1",yLabel:"PC2",zLabel:"PC3"}):e.jsx(pu,{data:t.pca_data,xKey:"x",yKey:"y",labelKey:"label",xLabel:"Principal Component 1 (PC1)",yLabel:"Principal Component 2 (PC2)"}):e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 dark:bg-gray-900 rounded text-gray-400 text-sm text-center p-4",children:"Not enough numeric data for PCA."})}),e.jsxs("div",{className:"mt-6 flex items-start gap-2 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-100 dark:border-blue-800",children:[e.jsx(Kt,{className:"w-4 h-4 text-blue-500 mt-0.5 shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"About this visualization"}),e.jsxs("p",{children:["This chart shows a ",r?"3D":"2D"," projection of your data using Principal Component Analysis (PCA). Points that are close together share similar characteristics across all numeric features."]}),e.jsxs("p",{className:"mt-1 text-xs opacity-80",children:["* For performance, this visualization uses a random sample of up to ",e.jsx("strong",{children:"5,000 points"}),"."]})]})]})]});function fu(t,r){const n=f.useRef(r);f.useEffect(function(){r!==n.current&&t.attributionControl!=null&&(n.current!=null&&t.attributionControl.removeAttribution(n.current),r!=null&&t.attributionControl.addAttribution(r)),n.current=r},[t,r])}function e0(t,r,n){r.center!==n.center&&t.setLatLng(r.center),r.radius!=null&&r.radius!==n.radius&&t.setRadius(r.radius)}const t0=1;function s0(t){return Object.freeze({__version:t0,map:t})}function r0(t,r){return Object.freeze({...t,...r})}const gu=f.createContext(null),bu=gu.Provider;function Qo(){const t=f.useContext(gu);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function a0(t){function r(n,i){const{instance:o,context:d}=t(n).current;return f.useImperativeHandle(i,()=>o),n.children==null?null:pt.createElement(bu,{value:d},n.children)}return f.forwardRef(r)}function n0(t){function r(n,i){const[o,d]=f.useState(!1),{instance:c}=t(n,d).current;f.useImperativeHandle(i,()=>c),f.useEffect(function(){o&&c.update()},[c,o,n.children]);const h=c._contentNode;return h?Vn.createPortal(n.children,h):null}return f.forwardRef(r)}function i0(t){function r(n,i){const{instance:o}=t(n).current;return f.useImperativeHandle(i,()=>o),null}return f.forwardRef(r)}function Yo(t,r){const n=f.useRef();f.useEffect(function(){return r!=null&&t.instance.on(r),n.current=r,function(){n.current!=null&&t.instance.off(n.current),n.current=null}},[t,r])}function si(t,r){const n=t.pane??r.pane;return n?{...t,pane:n}:t}function o0(t,r){return function(i,o){const d=Qo(),c=t(si(i,d),d);return fu(d.map,i.attribution),Yo(c.current,i.eventHandlers),r(c.current,d,i,o),c}}var bo={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,r){(function(n,i){i(r)})(Zm,function(n){var i="1.9.4";function o(s){var a,l,m,v;for(l=1,m=arguments.length;l<m;l++){v=arguments[l];for(a in v)s[a]=v[a]}return s}var d=Object.create||function(){function s(){}return function(a){return s.prototype=a,new s}}();function c(s,a){var l=Array.prototype.slice;if(s.bind)return s.bind.apply(s,l.call(arguments,1));var m=l.call(arguments,2);return function(){return s.apply(a,m.length?m.concat(l.call(arguments)):arguments)}}var h=0;function u(s){return"_leaflet_id"in s||(s._leaflet_id=++h),s._leaflet_id}function x(s,a,l){var m,v,k,D;return D=function(){m=!1,v&&(k.apply(l,v),v=!1)},k=function(){m?v=arguments:(s.apply(l,arguments),setTimeout(D,a),m=!0)},k}function p(s,a,l){var m=a[1],v=a[0],k=m-v;return s===m&&l?s:((s-v)%k+k)%k+v}function b(){return!1}function g(s,a){if(a===!1)return s;var l=Math.pow(10,a===void 0?6:a);return Math.round(s*l)/l}function y(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}function _(s){return y(s).split(/\s+/)}function w(s,a){Object.prototype.hasOwnProperty.call(s,"options")||(s.options=s.options?d(s.options):{});for(var l in a)s.options[l]=a[l];return s.options}function j(s,a,l){var m=[];for(var v in s)m.push(encodeURIComponent(l?v.toUpperCase():v)+"="+encodeURIComponent(s[v]));return(!a||a.indexOf("?")===-1?"?":"&")+m.join("&")}var C=/\{ *([\w_ -]+) *\}/g;function S(s,a){return s.replace(C,function(l,m){var v=a[m];if(v===void 0)throw new Error("No value provided for variable "+l);return typeof v=="function"&&(v=v(a)),v})}var T=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"};function E(s,a){for(var l=0;l<s.length;l++)if(s[l]===a)return l;return-1}var P="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function A(s){return window["webkit"+s]||window["moz"+s]||window["ms"+s]}var R=0;function N(s){var a=+new Date,l=Math.max(0,16-(a-R));return R=a+l,window.setTimeout(s,l)}var M=window.requestAnimationFrame||A("RequestAnimationFrame")||N,z=window.cancelAnimationFrame||A("CancelAnimationFrame")||A("CancelRequestAnimationFrame")||function(s){window.clearTimeout(s)};function I(s,a,l){if(l&&M===N)s.call(a);else return M.call(window,c(s,a))}function F(s){s&&z.call(window,s)}var $={__proto__:null,extend:o,create:d,bind:c,get lastId(){return h},stamp:u,throttle:x,wrapNum:p,falseFn:b,formatNum:g,trim:y,splitWords:_,setOptions:w,getParamString:j,template:S,isArray:T,indexOf:E,emptyImageUrl:P,requestFn:M,cancelFn:z,requestAnimFrame:I,cancelAnimFrame:F};function J(){}J.extend=function(s){var a=function(){w(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},l=a.__super__=this.prototype,m=d(l);m.constructor=a,a.prototype=m;for(var v in this)Object.prototype.hasOwnProperty.call(this,v)&&v!=="prototype"&&v!=="__super__"&&(a[v]=this[v]);return s.statics&&o(a,s.statics),s.includes&&(ee(s.includes),o.apply(null,[m].concat(s.includes))),o(m,s),delete m.statics,delete m.includes,m.options&&(m.options=l.options?d(l.options):{},o(m.options,s.options)),m._initHooks=[],m.callInitHooks=function(){if(!this._initHooksCalled){l.callInitHooks&&l.callInitHooks.call(this),this._initHooksCalled=!0;for(var k=0,D=m._initHooks.length;k<D;k++)m._initHooks[k].call(this)}},a},J.include=function(s){var a=this.prototype.options;return o(this.prototype,s),s.options&&(this.prototype.options=a,this.mergeOptions(s.options)),this},J.mergeOptions=function(s){return o(this.prototype.options,s),this},J.addInitHook=function(s){var a=Array.prototype.slice.call(arguments,1),l=typeof s=="function"?s:function(){this[s].apply(this,a)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(l),this};function ee(s){if(!(typeof L>"u"||!L||!L.Mixin)){s=T(s)?s:[s];for(var a=0;a<s.length;a++)s[a]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var te={on:function(s,a,l){if(typeof s=="object")for(var m in s)this._on(m,s[m],a);else{s=_(s);for(var v=0,k=s.length;v<k;v++)this._on(s[v],a,l)}return this},off:function(s,a,l){if(!arguments.length)delete this._events;else if(typeof s=="object")for(var m in s)this._off(m,s[m],a);else{s=_(s);for(var v=arguments.length===1,k=0,D=s.length;k<D;k++)v?this._off(s[k]):this._off(s[k],a,l)}return this},_on:function(s,a,l,m){if(typeof a!="function"){console.warn("wrong listener type: "+typeof a);return}if(this._listens(s,a,l)===!1){l===this&&(l=void 0);var v={fn:a,ctx:l};m&&(v.once=!0),this._events=this._events||{},this._events[s]=this._events[s]||[],this._events[s].push(v)}},_off:function(s,a,l){var m,v,k;if(this._events&&(m=this._events[s],!!m)){if(arguments.length===1){if(this._firingCount)for(v=0,k=m.length;v<k;v++)m[v].fn=b;delete this._events[s];return}if(typeof a!="function"){console.warn("wrong listener type: "+typeof a);return}var D=this._listens(s,a,l);if(D!==!1){var B=m[D];this._firingCount&&(B.fn=b,this._events[s]=m=m.slice()),m.splice(D,1)}}},fire:function(s,a,l){if(!this.listens(s,l))return this;var m=o({},a,{type:s,target:this,sourceTarget:a&&a.sourceTarget||this});if(this._events){var v=this._events[s];if(v){this._firingCount=this._firingCount+1||1;for(var k=0,D=v.length;k<D;k++){var B=v[k],H=B.fn;B.once&&this.off(s,H,B.ctx),H.call(B.ctx||this,m)}this._firingCount--}}return l&&this._propagateEvent(m),this},listens:function(s,a,l,m){typeof s!="string"&&console.warn('"string" type argument expected');var v=a;typeof a!="function"&&(m=!!a,v=void 0,l=void 0);var k=this._events&&this._events[s];if(k&&k.length&&this._listens(s,v,l)!==!1)return!0;if(m){for(var D in this._eventParents)if(this._eventParents[D].listens(s,a,l,m))return!0}return!1},_listens:function(s,a,l){if(!this._events)return!1;var m=this._events[s]||[];if(!a)return!!m.length;l===this&&(l=void 0);for(var v=0,k=m.length;v<k;v++)if(m[v].fn===a&&m[v].ctx===l)return v;return!1},once:function(s,a,l){if(typeof s=="object")for(var m in s)this._on(m,s[m],a,!0);else{s=_(s);for(var v=0,k=s.length;v<k;v++)this._on(s[v],a,l,!0)}return this},addEventParent:function(s){return this._eventParents=this._eventParents||{},this._eventParents[u(s)]=s,this},removeEventParent:function(s){return this._eventParents&&delete this._eventParents[u(s)],this},_propagateEvent:function(s){for(var a in this._eventParents)this._eventParents[a].fire(s.type,o({layer:s.target,propagatedFrom:s.target},s),!0)}};te.addEventListener=te.on,te.removeEventListener=te.clearAllEventListeners=te.off,te.addOneTimeEventListener=te.once,te.fireEvent=te.fire,te.hasEventListeners=te.listens;var Y=J.extend(te);function W(s,a,l){this.x=l?Math.round(s):s,this.y=l?Math.round(a):a}var U=Math.trunc||function(s){return s>0?Math.floor(s):Math.ceil(s)};W.prototype={clone:function(){return new W(this.x,this.y)},add:function(s){return this.clone()._add(q(s))},_add:function(s){return this.x+=s.x,this.y+=s.y,this},subtract:function(s){return this.clone()._subtract(q(s))},_subtract:function(s){return this.x-=s.x,this.y-=s.y,this},divideBy:function(s){return this.clone()._divideBy(s)},_divideBy:function(s){return this.x/=s,this.y/=s,this},multiplyBy:function(s){return this.clone()._multiplyBy(s)},_multiplyBy:function(s){return this.x*=s,this.y*=s,this},scaleBy:function(s){return new W(this.x*s.x,this.y*s.y)},unscaleBy:function(s){return new W(this.x/s.x,this.y/s.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=U(this.x),this.y=U(this.y),this},distanceTo:function(s){s=q(s);var a=s.x-this.x,l=s.y-this.y;return Math.sqrt(a*a+l*l)},equals:function(s){return s=q(s),s.x===this.x&&s.y===this.y},contains:function(s){return s=q(s),Math.abs(s.x)<=Math.abs(this.x)&&Math.abs(s.y)<=Math.abs(this.y)},toString:function(){return"Point("+g(this.x)+", "+g(this.y)+")"}};function q(s,a,l){return s instanceof W?s:T(s)?new W(s[0],s[1]):s==null?s:typeof s=="object"&&"x"in s&&"y"in s?new W(s.x,s.y):new W(s,a,l)}function K(s,a){if(s)for(var l=a?[s,a]:s,m=0,v=l.length;m<v;m++)this.extend(l[m])}K.prototype={extend:function(s){var a,l;if(!s)return this;if(s instanceof W||typeof s[0]=="number"||"x"in s)a=l=q(s);else if(s=ce(s),a=s.min,l=s.max,!a||!l)return this;return!this.min&&!this.max?(this.min=a.clone(),this.max=l.clone()):(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(l.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(l.y,this.max.y)),this},getCenter:function(s){return q((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,s)},getBottomLeft:function(){return q(this.min.x,this.max.y)},getTopRight:function(){return q(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(s){var a,l;return typeof s[0]=="number"||s instanceof W?s=q(s):s=ce(s),s instanceof K?(a=s.min,l=s.max):a=l=s,a.x>=this.min.x&&l.x<=this.max.x&&a.y>=this.min.y&&l.y<=this.max.y},intersects:function(s){s=ce(s);var a=this.min,l=this.max,m=s.min,v=s.max,k=v.x>=a.x&&m.x<=l.x,D=v.y>=a.y&&m.y<=l.y;return k&&D},overlaps:function(s){s=ce(s);var a=this.min,l=this.max,m=s.min,v=s.max,k=v.x>a.x&&m.x<l.x,D=v.y>a.y&&m.y<l.y;return k&&D},isValid:function(){return!!(this.min&&this.max)},pad:function(s){var a=this.min,l=this.max,m=Math.abs(a.x-l.x)*s,v=Math.abs(a.y-l.y)*s;return ce(q(a.x-m,a.y-v),q(l.x+m,l.y+v))},equals:function(s){return s?(s=ce(s),this.min.equals(s.getTopLeft())&&this.max.equals(s.getBottomRight())):!1}};function ce(s,a){return!s||s instanceof K?s:new K(s,a)}function V(s,a){if(s)for(var l=a?[s,a]:s,m=0,v=l.length;m<v;m++)this.extend(l[m])}V.prototype={extend:function(s){var a=this._southWest,l=this._northEast,m,v;if(s instanceof ie)m=s,v=s;else if(s instanceof V){if(m=s._southWest,v=s._northEast,!m||!v)return this}else return s?this.extend(se(s)||ae(s)):this;return!a&&!l?(this._southWest=new ie(m.lat,m.lng),this._northEast=new ie(v.lat,v.lng)):(a.lat=Math.min(m.lat,a.lat),a.lng=Math.min(m.lng,a.lng),l.lat=Math.max(v.lat,l.lat),l.lng=Math.max(v.lng,l.lng)),this},pad:function(s){var a=this._southWest,l=this._northEast,m=Math.abs(a.lat-l.lat)*s,v=Math.abs(a.lng-l.lng)*s;return new V(new ie(a.lat-m,a.lng-v),new ie(l.lat+m,l.lng+v))},getCenter:function(){return new ie((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ie(this.getNorth(),this.getWest())},getSouthEast:function(){return new ie(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(s){typeof s[0]=="number"||s instanceof ie||"lat"in s?s=se(s):s=ae(s);var a=this._southWest,l=this._northEast,m,v;return s instanceof V?(m=s.getSouthWest(),v=s.getNorthEast()):m=v=s,m.lat>=a.lat&&v.lat<=l.lat&&m.lng>=a.lng&&v.lng<=l.lng},intersects:function(s){s=ae(s);var a=this._southWest,l=this._northEast,m=s.getSouthWest(),v=s.getNorthEast(),k=v.lat>=a.lat&&m.lat<=l.lat,D=v.lng>=a.lng&&m.lng<=l.lng;return k&&D},overlaps:function(s){s=ae(s);var a=this._southWest,l=this._northEast,m=s.getSouthWest(),v=s.getNorthEast(),k=v.lat>a.lat&&m.lat<l.lat,D=v.lng>a.lng&&m.lng<l.lng;return k&&D},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(s,a){return s?(s=ae(s),this._southWest.equals(s.getSouthWest(),a)&&this._northEast.equals(s.getNorthEast(),a)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ae(s,a){return s instanceof V?s:new V(s,a)}function ie(s,a,l){if(isNaN(s)||isNaN(a))throw new Error("Invalid LatLng object: ("+s+", "+a+")");this.lat=+s,this.lng=+a,l!==void 0&&(this.alt=+l)}ie.prototype={equals:function(s,a){if(!s)return!1;s=se(s);var l=Math.max(Math.abs(this.lat-s.lat),Math.abs(this.lng-s.lng));return l<=(a===void 0?1e-9:a)},toString:function(s){return"LatLng("+g(this.lat,s)+", "+g(this.lng,s)+")"},distanceTo:function(s){return Se.distance(this,se(s))},wrap:function(){return Se.wrapLatLng(this)},toBounds:function(s){var a=180*s/40075017,l=a/Math.cos(Math.PI/180*this.lat);return ae([this.lat-a,this.lng-l],[this.lat+a,this.lng+l])},clone:function(){return new ie(this.lat,this.lng,this.alt)}};function se(s,a,l){return s instanceof ie?s:T(s)&&typeof s[0]!="object"?s.length===3?new ie(s[0],s[1],s[2]):s.length===2?new ie(s[0],s[1]):null:s==null?s:typeof s=="object"&&"lat"in s?new ie(s.lat,"lng"in s?s.lng:s.lon,s.alt):a===void 0?null:new ie(s,a,l)}var le={latLngToPoint:function(s,a){var l=this.projection.project(s),m=this.scale(a);return this.transformation._transform(l,m)},pointToLatLng:function(s,a){var l=this.scale(a),m=this.transformation.untransform(s,l);return this.projection.unproject(m)},project:function(s){return this.projection.project(s)},unproject:function(s){return this.projection.unproject(s)},scale:function(s){return 256*Math.pow(2,s)},zoom:function(s){return Math.log(s/256)/Math.LN2},getProjectedBounds:function(s){if(this.infinite)return null;var a=this.projection.bounds,l=this.scale(s),m=this.transformation.transform(a.min,l),v=this.transformation.transform(a.max,l);return new K(m,v)},infinite:!1,wrapLatLng:function(s){var a=this.wrapLng?p(s.lng,this.wrapLng,!0):s.lng,l=this.wrapLat?p(s.lat,this.wrapLat,!0):s.lat,m=s.alt;return new ie(l,a,m)},wrapLatLngBounds:function(s){var a=s.getCenter(),l=this.wrapLatLng(a),m=a.lat-l.lat,v=a.lng-l.lng;if(m===0&&v===0)return s;var k=s.getSouthWest(),D=s.getNorthEast(),B=new ie(k.lat-m,k.lng-v),H=new ie(D.lat-m,D.lng-v);return new V(B,H)}},Se=o({},le,{wrapLng:[-180,180],R:6371e3,distance:function(s,a){var l=Math.PI/180,m=s.lat*l,v=a.lat*l,k=Math.sin((a.lat-s.lat)*l/2),D=Math.sin((a.lng-s.lng)*l/2),B=k*k+Math.cos(m)*Math.cos(v)*D*D,H=2*Math.atan2(Math.sqrt(B),Math.sqrt(1-B));return this.R*H}}),xe=6378137,Ct={R:xe,MAX_LATITUDE:85.0511287798,project:function(s){var a=Math.PI/180,l=this.MAX_LATITUDE,m=Math.max(Math.min(l,s.lat),-l),v=Math.sin(m*a);return new W(this.R*s.lng*a,this.R*Math.log((1+v)/(1-v))/2)},unproject:function(s){var a=180/Math.PI;return new ie((2*Math.atan(Math.exp(s.y/this.R))-Math.PI/2)*a,s.x*a/this.R)},bounds:function(){var s=xe*Math.PI;return new K([-s,-s],[s,s])}()};function Qt(s,a,l,m){if(T(s)){this._a=s[0],this._b=s[1],this._c=s[2],this._d=s[3];return}this._a=s,this._b=a,this._c=l,this._d=m}Qt.prototype={transform:function(s,a){return this._transform(s.clone(),a)},_transform:function(s,a){return a=a||1,s.x=a*(this._a*s.x+this._b),s.y=a*(this._c*s.y+this._d),s},untransform:function(s,a){return a=a||1,new W((s.x/a-this._b)/this._a,(s.y/a-this._d)/this._c)}};function dt(s,a,l,m){return new Qt(s,a,l,m)}var Te=o({},Se,{code:"EPSG:3857",projection:Ct,transformation:function(){var s=.5/(Math.PI*Ct.R);return dt(s,.5,-s,.5)}()}),Ot=o({},Te,{code:"EPSG:900913"});function Q(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function be(s,a){var l="",m,v,k,D,B,H;for(m=0,k=s.length;m<k;m++){for(B=s[m],v=0,D=B.length;v<D;v++)H=B[v],l+=(v?"L":"M")+H.x+" "+H.y;l+=a?de.svg?"z":"x":""}return l||"M0 0"}var Le=document.documentElement.style,Ie="ActiveXObject"in window,ct=Ie&&!document.addEventListener,Z="msLaunchUri"in navigator&&!("documentMode"in document),X=Xt("webkit"),ue=Xt("android"),oe=Xt("android 2")||Xt("android 3"),_e=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),qe=ue&&Xt("Google")&&_e<537&&!("AudioNode"in window),It=!!window.opera,nt=!Z&&Xt("chrome"),zt=Xt("gecko")&&!X&&!It&&!Ie,Ke=!nt&&Xt("safari"),Je=Xt("phantom"),St="OTransition"in Le,Xs=navigator.platform.indexOf("Win")===0,Ge=Ie&&"transition"in Le,Yt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!oe,ul="MozPerspective"in Le,hh=!window.L_DISABLE_3D&&(Ge||Yt||ul)&&!St&&!Je,ca=typeof orientation<"u"||Xt("mobile"),mh=ca&&X,xh=ca&&Yt,hl=!window.PointerEvent&&window.MSPointerEvent,ml=!!(window.PointerEvent||hl),xl="ontouchstart"in window||!!window.TouchEvent,ph=!window.L_NO_TOUCH&&(xl||ml),fh=ca&&It,gh=ca&&zt,bh=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,yh=function(){var s=!1;try{var a=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("testPassiveEventSupport",b,a),window.removeEventListener("testPassiveEventSupport",b,a)}catch{}return s}(),vh=function(){return!!document.createElement("canvas").getContext}(),hi=!!(document.createElementNS&&Q("svg").createSVGRect),_h=!!hi&&function(){var s=document.createElement("div");return s.innerHTML="<svg/>",(s.firstChild&&s.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),jh=!hi&&function(){try{var s=document.createElement("div");s.innerHTML='<v:shape adj="1"/>';var a=s.firstChild;return a.style.behavior="url(#default#VML)",a&&typeof a.adj=="object"}catch{return!1}}(),wh=navigator.platform.indexOf("Mac")===0,Nh=navigator.platform.indexOf("Linux")===0;function Xt(s){return navigator.userAgent.toLowerCase().indexOf(s)>=0}var de={ie:Ie,ielt9:ct,edge:Z,webkit:X,android:ue,android23:oe,androidStock:qe,opera:It,chrome:nt,gecko:zt,safari:Ke,phantom:Je,opera12:St,win:Xs,ie3d:Ge,webkit3d:Yt,gecko3d:ul,any3d:hh,mobile:ca,mobileWebkit:mh,mobileWebkit3d:xh,msPointer:hl,pointer:ml,touch:ph,touchNative:xl,mobileOpera:fh,mobileGecko:gh,retina:bh,passiveEvents:yh,canvas:vh,svg:hi,vml:jh,inlineSvg:_h,mac:wh,linux:Nh},pl=de.msPointer?"MSPointerDown":"pointerdown",fl=de.msPointer?"MSPointerMove":"pointermove",gl=de.msPointer?"MSPointerUp":"pointerup",bl=de.msPointer?"MSPointerCancel":"pointercancel",mi={touchstart:pl,touchmove:fl,touchend:gl,touchcancel:bl},yl={touchstart:Lh,touchmove:Qa,touchend:Qa,touchcancel:Qa},Pr={},vl=!1;function kh(s,a,l){return a==="touchstart"&&Th(),yl[a]?(l=yl[a].bind(this,l),s.addEventListener(mi[a],l,!1),l):(console.warn("wrong event specified:",a),b)}function Ch(s,a,l){if(!mi[a]){console.warn("wrong event specified:",a);return}s.removeEventListener(mi[a],l,!1)}function Sh(s){Pr[s.pointerId]=s}function Ph(s){Pr[s.pointerId]&&(Pr[s.pointerId]=s)}function _l(s){delete Pr[s.pointerId]}function Th(){vl||(document.addEventListener(pl,Sh,!0),document.addEventListener(fl,Ph,!0),document.addEventListener(gl,_l,!0),document.addEventListener(bl,_l,!0),vl=!0)}function Qa(s,a){if(a.pointerType!==(a.MSPOINTER_TYPE_MOUSE||"mouse")){a.touches=[];for(var l in Pr)a.touches.push(Pr[l]);a.changedTouches=[a],s(a)}}function Lh(s,a){a.MSPOINTER_TYPE_TOUCH&&a.pointerType===a.MSPOINTER_TYPE_TOUCH&&et(a),Qa(s,a)}function Eh(s){var a={},l,m;for(m in s)l=s[m],a[m]=l&&l.bind?l.bind(s):l;return s=a,a.type="dblclick",a.detail=2,a.isTrusted=!1,a._simulated=!0,a}var Rh=200;function Mh(s,a){s.addEventListener("dblclick",a);var l=0,m;function v(k){if(k.detail!==1){m=k.detail;return}if(!(k.pointerType==="mouse"||k.sourceCapabilities&&!k.sourceCapabilities.firesTouchEvents)){var D=Cl(k);if(!(D.some(function(H){return H instanceof HTMLLabelElement&&H.attributes.for})&&!D.some(function(H){return H instanceof HTMLInputElement||H instanceof HTMLSelectElement}))){var B=Date.now();B-l<=Rh?(m++,m===2&&a(Eh(k))):m=1,l=B}}}return s.addEventListener("click",v),{dblclick:a,simDblclick:v}}function Dh(s,a){s.removeEventListener("dblclick",a.dblclick),s.removeEventListener("click",a.simDblclick)}var xi=en(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ua=en(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),jl=ua==="webkitTransition"||ua==="OTransition"?ua+"End":"transitionend";function wl(s){return typeof s=="string"?document.getElementById(s):s}function ha(s,a){var l=s.style[a]||s.currentStyle&&s.currentStyle[a];if((!l||l==="auto")&&document.defaultView){var m=document.defaultView.getComputedStyle(s,null);l=m?m[a]:null}return l==="auto"?null:l}function ke(s,a,l){var m=document.createElement(s);return m.className=a||"",l&&l.appendChild(m),m}function De(s){var a=s.parentNode;a&&a.removeChild(s)}function Ya(s){for(;s.firstChild;)s.removeChild(s.firstChild)}function Tr(s){var a=s.parentNode;a&&a.lastChild!==s&&a.appendChild(s)}function Lr(s){var a=s.parentNode;a&&a.firstChild!==s&&a.insertBefore(s,a.firstChild)}function pi(s,a){if(s.classList!==void 0)return s.classList.contains(a);var l=Xa(s);return l.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(l)}function ge(s,a){if(s.classList!==void 0)for(var l=_(a),m=0,v=l.length;m<v;m++)s.classList.add(l[m]);else if(!pi(s,a)){var k=Xa(s);fi(s,(k?k+" ":"")+a)}}function Be(s,a){s.classList!==void 0?s.classList.remove(a):fi(s,y((" "+Xa(s)+" ").replace(" "+a+" "," ")))}function fi(s,a){s.className.baseVal===void 0?s.className=a:s.className.baseVal=a}function Xa(s){return s.correspondingElement&&(s=s.correspondingElement),s.className.baseVal===void 0?s.className:s.className.baseVal}function Pt(s,a){"opacity"in s.style?s.style.opacity=a:"filter"in s.style&&Ah(s,a)}function Ah(s,a){var l=!1,m="DXImageTransform.Microsoft.Alpha";try{l=s.filters.item(m)}catch{if(a===1)return}a=Math.round(a*100),l?(l.Enabled=a!==100,l.Opacity=a):s.style.filter+=" progid:"+m+"(opacity="+a+")"}function en(s){for(var a=document.documentElement.style,l=0;l<s.length;l++)if(s[l]in a)return s[l];return!1}function er(s,a,l){var m=a||new W(0,0);s.style[xi]=(de.ie3d?"translate("+m.x+"px,"+m.y+"px)":"translate3d("+m.x+"px,"+m.y+"px,0)")+(l?" scale("+l+")":"")}function He(s,a){s._leaflet_pos=a,de.any3d?er(s,a):(s.style.left=a.x+"px",s.style.top=a.y+"px")}function tr(s){return s._leaflet_pos||new W(0,0)}var ma,xa,gi;if("onselectstart"in document)ma=function(){pe(window,"selectstart",et)},xa=function(){Ee(window,"selectstart",et)};else{var pa=en(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ma=function(){if(pa){var s=document.documentElement.style;gi=s[pa],s[pa]="none"}},xa=function(){pa&&(document.documentElement.style[pa]=gi,gi=void 0)}}function bi(){pe(window,"dragstart",et)}function yi(){Ee(window,"dragstart",et)}var tn,vi;function _i(s){for(;s.tabIndex===-1;)s=s.parentNode;s.style&&(sn(),tn=s,vi=s.style.outlineStyle,s.style.outlineStyle="none",pe(window,"keydown",sn))}function sn(){tn&&(tn.style.outlineStyle=vi,tn=void 0,vi=void 0,Ee(window,"keydown",sn))}function Nl(s){do s=s.parentNode;while((!s.offsetWidth||!s.offsetHeight)&&s!==document.body);return s}function ji(s){var a=s.getBoundingClientRect();return{x:a.width/s.offsetWidth||1,y:a.height/s.offsetHeight||1,boundingClientRect:a}}var Oh={__proto__:null,TRANSFORM:xi,TRANSITION:ua,TRANSITION_END:jl,get:wl,getStyle:ha,create:ke,remove:De,empty:Ya,toFront:Tr,toBack:Lr,hasClass:pi,addClass:ge,removeClass:Be,setClass:fi,getClass:Xa,setOpacity:Pt,testProp:en,setTransform:er,setPosition:He,getPosition:tr,get disableTextSelection(){return ma},get enableTextSelection(){return xa},disableImageDrag:bi,enableImageDrag:yi,preventOutline:_i,restoreOutline:sn,getSizedParentNode:Nl,getScale:ji};function pe(s,a,l,m){if(a&&typeof a=="object")for(var v in a)Ni(s,v,a[v],l);else{a=_(a);for(var k=0,D=a.length;k<D;k++)Ni(s,a[k],l,m)}return this}var es="_leaflet_events";function Ee(s,a,l,m){if(arguments.length===1)kl(s),delete s[es];else if(a&&typeof a=="object")for(var v in a)ki(s,v,a[v],l);else if(a=_(a),arguments.length===2)kl(s,function(B){return E(a,B)!==-1});else for(var k=0,D=a.length;k<D;k++)ki(s,a[k],l,m);return this}function kl(s,a){for(var l in s[es]){var m=l.split(/\d/)[0];(!a||a(m))&&ki(s,m,null,null,l)}}var wi={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ni(s,a,l,m){var v=a+u(l)+(m?"_"+u(m):"");if(s[es]&&s[es][v])return this;var k=function(B){return l.call(m||s,B||window.event)},D=k;!de.touchNative&&de.pointer&&a.indexOf("touch")===0?k=kh(s,a,k):de.touch&&a==="dblclick"?k=Mh(s,k):"addEventListener"in s?a==="touchstart"||a==="touchmove"||a==="wheel"||a==="mousewheel"?s.addEventListener(wi[a]||a,k,de.passiveEvents?{passive:!1}:!1):a==="mouseenter"||a==="mouseleave"?(k=function(B){B=B||window.event,Si(s,B)&&D(B)},s.addEventListener(wi[a],k,!1)):s.addEventListener(a,D,!1):s.attachEvent("on"+a,k),s[es]=s[es]||{},s[es][v]=k}function ki(s,a,l,m,v){v=v||a+u(l)+(m?"_"+u(m):"");var k=s[es]&&s[es][v];if(!k)return this;!de.touchNative&&de.pointer&&a.indexOf("touch")===0?Ch(s,a,k):de.touch&&a==="dblclick"?Dh(s,k):"removeEventListener"in s?s.removeEventListener(wi[a]||a,k,!1):s.detachEvent("on"+a,k),s[es][v]=null}function sr(s){return s.stopPropagation?s.stopPropagation():s.originalEvent?s.originalEvent._stopped=!0:s.cancelBubble=!0,this}function Ci(s){return Ni(s,"wheel",sr),this}function fa(s){return pe(s,"mousedown touchstart dblclick contextmenu",sr),s._leaflet_disable_click=!0,this}function et(s){return s.preventDefault?s.preventDefault():s.returnValue=!1,this}function rr(s){return et(s),sr(s),this}function Cl(s){if(s.composedPath)return s.composedPath();for(var a=[],l=s.target;l;)a.push(l),l=l.parentNode;return a}function Sl(s,a){if(!a)return new W(s.clientX,s.clientY);var l=ji(a),m=l.boundingClientRect;return new W((s.clientX-m.left)/l.x-a.clientLeft,(s.clientY-m.top)/l.y-a.clientTop)}var Ih=de.linux&&de.chrome?window.devicePixelRatio:de.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Pl(s){return de.edge?s.wheelDeltaY/2:s.deltaY&&s.deltaMode===0?-s.deltaY/Ih:s.deltaY&&s.deltaMode===1?-s.deltaY*20:s.deltaY&&s.deltaMode===2?-s.deltaY*60:s.deltaX||s.deltaZ?0:s.wheelDelta?(s.wheelDeltaY||s.wheelDelta)/2:s.detail&&Math.abs(s.detail)<32765?-s.detail*20:s.detail?s.detail/-32765*60:0}function Si(s,a){var l=a.relatedTarget;if(!l)return!0;try{for(;l&&l!==s;)l=l.parentNode}catch{return!1}return l!==s}var zh={__proto__:null,on:pe,off:Ee,stopPropagation:sr,disableScrollPropagation:Ci,disableClickPropagation:fa,preventDefault:et,stop:rr,getPropagationPath:Cl,getMousePosition:Sl,getWheelDelta:Pl,isExternalTarget:Si,addListener:pe,removeListener:Ee},Tl=Y.extend({run:function(s,a,l,m){this.stop(),this._el=s,this._inProgress=!0,this._duration=l||.25,this._easeOutPower=1/Math.max(m||.5,.2),this._startPos=tr(s),this._offset=a.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=I(this._animate,this),this._step()},_step:function(s){var a=+new Date-this._startTime,l=this._duration*1e3;a<l?this._runFrame(this._easeOut(a/l),s):(this._runFrame(1),this._complete())},_runFrame:function(s,a){var l=this._startPos.add(this._offset.multiplyBy(s));a&&l._round(),He(this._el,l),this.fire("step")},_complete:function(){F(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(s){return 1-Math.pow(1-s,this._easeOutPower)}}),Ne=Y.extend({options:{crs:Te,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(s,a){a=w(this,a),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(s),this._initLayout(),this._onResize=c(this._onResize,this),this._initEvents(),a.maxBounds&&this.setMaxBounds(a.maxBounds),a.zoom!==void 0&&(this._zoom=this._limitZoom(a.zoom)),a.center&&a.zoom!==void 0&&this.setView(se(a.center),a.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ua&&de.any3d&&!de.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),pe(this._proxy,jl,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(s,a,l){if(a=a===void 0?this._zoom:this._limitZoom(a),s=this._limitCenter(se(s),a,this.options.maxBounds),l=l||{},this._stop(),this._loaded&&!l.reset&&l!==!0){l.animate!==void 0&&(l.zoom=o({animate:l.animate},l.zoom),l.pan=o({animate:l.animate,duration:l.duration},l.pan));var m=this._zoom!==a?this._tryAnimatedZoom&&this._tryAnimatedZoom(s,a,l.zoom):this._tryAnimatedPan(s,l.pan);if(m)return clearTimeout(this._sizeTimer),this}return this._resetView(s,a,l.pan&&l.pan.noMoveStart),this},setZoom:function(s,a){return this._loaded?this.setView(this.getCenter(),s,{zoom:a}):(this._zoom=s,this)},zoomIn:function(s,a){return s=s||(de.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+s,a)},zoomOut:function(s,a){return s=s||(de.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-s,a)},setZoomAround:function(s,a,l){var m=this.getZoomScale(a),v=this.getSize().divideBy(2),k=s instanceof W?s:this.latLngToContainerPoint(s),D=k.subtract(v).multiplyBy(1-1/m),B=this.containerPointToLatLng(v.add(D));return this.setView(B,a,{zoom:l})},_getBoundsCenterZoom:function(s,a){a=a||{},s=s.getBounds?s.getBounds():ae(s);var l=q(a.paddingTopLeft||a.padding||[0,0]),m=q(a.paddingBottomRight||a.padding||[0,0]),v=this.getBoundsZoom(s,!1,l.add(m));if(v=typeof a.maxZoom=="number"?Math.min(a.maxZoom,v):v,v===1/0)return{center:s.getCenter(),zoom:v};var k=m.subtract(l).divideBy(2),D=this.project(s.getSouthWest(),v),B=this.project(s.getNorthEast(),v),H=this.unproject(D.add(B).divideBy(2).add(k),v);return{center:H,zoom:v}},fitBounds:function(s,a){if(s=ae(s),!s.isValid())throw new Error("Bounds are not valid.");var l=this._getBoundsCenterZoom(s,a);return this.setView(l.center,l.zoom,a)},fitWorld:function(s){return this.fitBounds([[-90,-180],[90,180]],s)},panTo:function(s,a){return this.setView(s,this._zoom,{pan:a})},panBy:function(s,a){if(s=q(s).round(),a=a||{},!s.x&&!s.y)return this.fire("moveend");if(a.animate!==!0&&!this.getSize().contains(s))return this._resetView(this.unproject(this.project(this.getCenter()).add(s)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Tl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),a.noMoveStart||this.fire("movestart"),a.animate!==!1){ge(this._mapPane,"leaflet-pan-anim");var l=this._getMapPanePos().subtract(s).round();this._panAnim.run(this._mapPane,l,a.duration||.25,a.easeLinearity)}else this._rawPanBy(s),this.fire("move").fire("moveend");return this},flyTo:function(s,a,l){if(l=l||{},l.animate===!1||!de.any3d)return this.setView(s,a,l);this._stop();var m=this.project(this.getCenter()),v=this.project(s),k=this.getSize(),D=this._zoom;s=se(s),a=a===void 0?D:a;var B=Math.max(k.x,k.y),H=B*this.getZoomScale(D,a),G=v.distanceTo(m)||1,re=1.42,me=re*re;function ve(Ue){var pn=Ue?-1:1,Cm=Ue?H:B,Sm=H*H-B*B+pn*me*me*G*G,Pm=2*Cm*me*G,zi=Sm/Pm,dd=Math.sqrt(zi*zi+1)-zi,Tm=dd<1e-9?-18:Math.log(dd);return Tm}function ut(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Qe(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}function Lt(Ue){return ut(Ue)/Qe(Ue)}var gt=ve(0);function Or(Ue){return B*(Qe(gt)/Qe(gt+re*Ue))}function jm(Ue){return B*(Qe(gt)*Lt(gt+re*Ue)-ut(gt))/me}function wm(Ue){return 1-Math.pow(1-Ue,1.5)}var Nm=Date.now(),od=(ve(1)-gt)/re,km=l.duration?1e3*l.duration:1e3*od*.8;function ld(){var Ue=(Date.now()-Nm)/km,pn=wm(Ue)*od;Ue<=1?(this._flyToFrame=I(ld,this),this._move(this.unproject(m.add(v.subtract(m).multiplyBy(jm(pn)/G)),D),this.getScaleZoom(B/Or(pn),D),{flyTo:!0})):this._move(s,a)._moveEnd(!0)}return this._moveStart(!0,l.noMoveStart),ld.call(this),this},flyToBounds:function(s,a){var l=this._getBoundsCenterZoom(s,a);return this.flyTo(l.center,l.zoom,a)},setMaxBounds:function(s){return s=ae(s),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),s.isValid()?(this.options.maxBounds=s,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(s){var a=this.options.minZoom;return this.options.minZoom=s,this._loaded&&a!==s&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(s):this},setMaxZoom:function(s){var a=this.options.maxZoom;return this.options.maxZoom=s,this._loaded&&a!==s&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(s):this},panInsideBounds:function(s,a){this._enforcingBounds=!0;var l=this.getCenter(),m=this._limitCenter(l,this._zoom,ae(s));return l.equals(m)||this.panTo(m,a),this._enforcingBounds=!1,this},panInside:function(s,a){a=a||{};var l=q(a.paddingTopLeft||a.padding||[0,0]),m=q(a.paddingBottomRight||a.padding||[0,0]),v=this.project(this.getCenter()),k=this.project(s),D=this.getPixelBounds(),B=ce([D.min.add(l),D.max.subtract(m)]),H=B.getSize();if(!B.contains(k)){this._enforcingBounds=!0;var G=k.subtract(B.getCenter()),re=B.extend(k).getSize().subtract(H);v.x+=G.x<0?-re.x:re.x,v.y+=G.y<0?-re.y:re.y,this.panTo(this.unproject(v),a),this._enforcingBounds=!1}return this},invalidateSize:function(s){if(!this._loaded)return this;s=o({animate:!1,pan:!0},s===!0?{animate:!0}:s);var a=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var l=this.getSize(),m=a.divideBy(2).round(),v=l.divideBy(2).round(),k=m.subtract(v);return!k.x&&!k.y?this:(s.animate&&s.pan?this.panBy(k):(s.pan&&this._rawPanBy(k),this.fire("move"),s.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(c(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:a,newSize:l}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(s){if(s=this._locateOptions=o({timeout:1e4,watch:!1},s),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var a=c(this._handleGeolocationResponse,this),l=c(this._handleGeolocationError,this);return s.watch?this._locationWatchId=navigator.geolocation.watchPosition(a,l,s):navigator.geolocation.getCurrentPosition(a,l,s),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(s){if(this._container._leaflet_id){var a=s.code,l=s.message||(a===1?"permission denied":a===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:a,message:"Geolocation error: "+l+"."})}},_handleGeolocationResponse:function(s){if(this._container._leaflet_id){var a=s.coords.latitude,l=s.coords.longitude,m=new ie(a,l),v=m.toBounds(s.coords.accuracy*2),k=this._locateOptions;if(k.setView){var D=this.getBoundsZoom(v);this.setView(m,k.maxZoom?Math.min(D,k.maxZoom):D)}var B={latlng:m,bounds:v,timestamp:s.timestamp};for(var H in s.coords)typeof s.coords[H]=="number"&&(B[H]=s.coords[H]);this.fire("locationfound",B)}},addHandler:function(s,a){if(!a)return this;var l=this[s]=new a(this);return this._handlers.push(l),this.options[s]&&l.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),De(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(F(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var s;for(s in this._layers)this._layers[s].remove();for(s in this._panes)De(this._panes[s]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(s,a){var l="leaflet-pane"+(s?" leaflet-"+s.replace("Pane","")+"-pane":""),m=ke("div",l,a||this._mapPane);return s&&(this._panes[s]=m),m},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var s=this.getPixelBounds(),a=this.unproject(s.getBottomLeft()),l=this.unproject(s.getTopRight());return new V(a,l)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(s,a,l){s=ae(s),l=q(l||[0,0]);var m=this.getZoom()||0,v=this.getMinZoom(),k=this.getMaxZoom(),D=s.getNorthWest(),B=s.getSouthEast(),H=this.getSize().subtract(l),G=ce(this.project(B,m),this.project(D,m)).getSize(),re=de.any3d?this.options.zoomSnap:1,me=H.x/G.x,ve=H.y/G.y,ut=a?Math.max(me,ve):Math.min(me,ve);return m=this.getScaleZoom(ut,m),re&&(m=Math.round(m/(re/100))*(re/100),m=a?Math.ceil(m/re)*re:Math.floor(m/re)*re),Math.max(v,Math.min(k,m))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new W(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(s,a){var l=this._getTopLeftPoint(s,a);return new K(l,l.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(s){return this.options.crs.getProjectedBounds(s===void 0?this.getZoom():s)},getPane:function(s){return typeof s=="string"?this._panes[s]:s},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(s,a){var l=this.options.crs;return a=a===void 0?this._zoom:a,l.scale(s)/l.scale(a)},getScaleZoom:function(s,a){var l=this.options.crs;a=a===void 0?this._zoom:a;var m=l.zoom(s*l.scale(a));return isNaN(m)?1/0:m},project:function(s,a){return a=a===void 0?this._zoom:a,this.options.crs.latLngToPoint(se(s),a)},unproject:function(s,a){return a=a===void 0?this._zoom:a,this.options.crs.pointToLatLng(q(s),a)},layerPointToLatLng:function(s){var a=q(s).add(this.getPixelOrigin());return this.unproject(a)},latLngToLayerPoint:function(s){var a=this.project(se(s))._round();return a._subtract(this.getPixelOrigin())},wrapLatLng:function(s){return this.options.crs.wrapLatLng(se(s))},wrapLatLngBounds:function(s){return this.options.crs.wrapLatLngBounds(ae(s))},distance:function(s,a){return this.options.crs.distance(se(s),se(a))},containerPointToLayerPoint:function(s){return q(s).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(s){return q(s).add(this._getMapPanePos())},containerPointToLatLng:function(s){var a=this.containerPointToLayerPoint(q(s));return this.layerPointToLatLng(a)},latLngToContainerPoint:function(s){return this.layerPointToContainerPoint(this.latLngToLayerPoint(se(s)))},mouseEventToContainerPoint:function(s){return Sl(s,this._container)},mouseEventToLayerPoint:function(s){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(s))},mouseEventToLatLng:function(s){return this.layerPointToLatLng(this.mouseEventToLayerPoint(s))},_initContainer:function(s){var a=this._container=wl(s);if(a){if(a._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");pe(a,"scroll",this._onScroll,this),this._containerId=u(a)},_initLayout:function(){var s=this._container;this._fadeAnimated=this.options.fadeAnimation&&de.any3d,ge(s,"leaflet-container"+(de.touch?" leaflet-touch":"")+(de.retina?" leaflet-retina":"")+(de.ielt9?" leaflet-oldie":"")+(de.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var a=ha(s,"position");a!=="absolute"&&a!=="relative"&&a!=="fixed"&&a!=="sticky"&&(s.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var s=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),He(this._mapPane,new W(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ge(s.markerPane,"leaflet-zoom-hide"),ge(s.shadowPane,"leaflet-zoom-hide"))},_resetView:function(s,a,l){He(this._mapPane,new W(0,0));var m=!this._loaded;this._loaded=!0,a=this._limitZoom(a),this.fire("viewprereset");var v=this._zoom!==a;this._moveStart(v,l)._move(s,a)._moveEnd(v),this.fire("viewreset"),m&&this.fire("load")},_moveStart:function(s,a){return s&&this.fire("zoomstart"),a||this.fire("movestart"),this},_move:function(s,a,l,m){a===void 0&&(a=this._zoom);var v=this._zoom!==a;return this._zoom=a,this._lastCenter=s,this._pixelOrigin=this._getNewPixelOrigin(s),m?l&&l.pinch&&this.fire("zoom",l):((v||l&&l.pinch)&&this.fire("zoom",l),this.fire("move",l)),this},_moveEnd:function(s){return s&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return F(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(s){He(this._mapPane,this._getMapPanePos().subtract(s))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(s){this._targets={},this._targets[u(this._container)]=this;var a=s?Ee:pe;a(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&a(window,"resize",this._onResize,this),de.any3d&&this.options.transform3DLimit&&(s?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){F(this._resizeRequest),this._resizeRequest=I(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var s=this._getMapPanePos();Math.max(Math.abs(s.x),Math.abs(s.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(s,a){for(var l=[],m,v=a==="mouseout"||a==="mouseover",k=s.target||s.srcElement,D=!1;k;){if(m=this._targets[u(k)],m&&(a==="click"||a==="preclick")&&this._draggableMoved(m)){D=!0;break}if(m&&m.listens(a,!0)&&(v&&!Si(k,s)||(l.push(m),v))||k===this._container)break;k=k.parentNode}return!l.length&&!D&&!v&&this.listens(a,!0)&&(l=[this]),l},_isClickDisabled:function(s){for(;s&&s!==this._container;){if(s._leaflet_disable_click)return!0;s=s.parentNode}},_handleDOMEvent:function(s){var a=s.target||s.srcElement;if(!(!this._loaded||a._leaflet_disable_events||s.type==="click"&&this._isClickDisabled(a))){var l=s.type;l==="mousedown"&&_i(a),this._fireDOMEvent(s,l)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(s,a,l){if(s.type==="click"){var m=o({},s);m.type="preclick",this._fireDOMEvent(m,m.type,l)}var v=this._findEventTargets(s,a);if(l){for(var k=[],D=0;D<l.length;D++)l[D].listens(a,!0)&&k.push(l[D]);v=k.concat(v)}if(v.length){a==="contextmenu"&&et(s);var B=v[0],H={originalEvent:s};if(s.type!=="keypress"&&s.type!=="keydown"&&s.type!=="keyup"){var G=B.getLatLng&&(!B._radius||B._radius<=10);H.containerPoint=G?this.latLngToContainerPoint(B.getLatLng()):this.mouseEventToContainerPoint(s),H.layerPoint=this.containerPointToLayerPoint(H.containerPoint),H.latlng=G?B.getLatLng():this.layerPointToLatLng(H.layerPoint)}for(D=0;D<v.length;D++)if(v[D].fire(a,H,!0),H.originalEvent._stopped||v[D].options.bubblingMouseEvents===!1&&E(this._mouseEvents,a)!==-1)return}},_draggableMoved:function(s){return s=s.dragging&&s.dragging.enabled()?s:this,s.dragging&&s.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var s=0,a=this._handlers.length;s<a;s++)this._handlers[s].disable()},whenReady:function(s,a){return this._loaded?s.call(a||this,{target:this}):this.on("load",s,a),this},_getMapPanePos:function(){return tr(this._mapPane)||new W(0,0)},_moved:function(){var s=this._getMapPanePos();return s&&!s.equals([0,0])},_getTopLeftPoint:function(s,a){var l=s&&a!==void 0?this._getNewPixelOrigin(s,a):this.getPixelOrigin();return l.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(s,a){var l=this.getSize()._divideBy(2);return this.project(s,a)._subtract(l)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(s,a,l){var m=this._getNewPixelOrigin(l,a);return this.project(s,a)._subtract(m)},_latLngBoundsToNewLayerBounds:function(s,a,l){var m=this._getNewPixelOrigin(l,a);return ce([this.project(s.getSouthWest(),a)._subtract(m),this.project(s.getNorthWest(),a)._subtract(m),this.project(s.getSouthEast(),a)._subtract(m),this.project(s.getNorthEast(),a)._subtract(m)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(s){return this.latLngToLayerPoint(s).subtract(this._getCenterLayerPoint())},_limitCenter:function(s,a,l){if(!l)return s;var m=this.project(s,a),v=this.getSize().divideBy(2),k=new K(m.subtract(v),m.add(v)),D=this._getBoundsOffset(k,l,a);return Math.abs(D.x)<=1&&Math.abs(D.y)<=1?s:this.unproject(m.add(D),a)},_limitOffset:function(s,a){if(!a)return s;var l=this.getPixelBounds(),m=new K(l.min.add(s),l.max.add(s));return s.add(this._getBoundsOffset(m,a))},_getBoundsOffset:function(s,a,l){var m=ce(this.project(a.getNorthEast(),l),this.project(a.getSouthWest(),l)),v=m.min.subtract(s.min),k=m.max.subtract(s.max),D=this._rebound(v.x,-k.x),B=this._rebound(v.y,-k.y);return new W(D,B)},_rebound:function(s,a){return s+a>0?Math.round(s-a)/2:Math.max(0,Math.ceil(s))-Math.max(0,Math.floor(a))},_limitZoom:function(s){var a=this.getMinZoom(),l=this.getMaxZoom(),m=de.any3d?this.options.zoomSnap:1;return m&&(s=Math.round(s/m)*m),Math.max(a,Math.min(l,s))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Be(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(s,a){var l=this._getCenterOffset(s)._trunc();return(a&&a.animate)!==!0&&!this.getSize().contains(l)?!1:(this.panBy(l,a),!0)},_createAnimProxy:function(){var s=this._proxy=ke("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(s),this.on("zoomanim",function(a){var l=xi,m=this._proxy.style[l];er(this._proxy,this.project(a.center,a.zoom),this.getZoomScale(a.zoom,1)),m===this._proxy.style[l]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){De(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var s=this.getCenter(),a=this.getZoom();er(this._proxy,this.project(s,a),this.getZoomScale(a,1))},_catchTransitionEnd:function(s){this._animatingZoom&&s.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(s,a,l){if(this._animatingZoom)return!0;if(l=l||{},!this._zoomAnimated||l.animate===!1||this._nothingToAnimate()||Math.abs(a-this._zoom)>this.options.zoomAnimationThreshold)return!1;var m=this.getZoomScale(a),v=this._getCenterOffset(s)._divideBy(1-1/m);return l.animate!==!0&&!this.getSize().contains(v)?!1:(I(function(){this._moveStart(!0,l.noMoveStart||!1)._animateZoom(s,a,!0)},this),!0)},_animateZoom:function(s,a,l,m){this._mapPane&&(l&&(this._animatingZoom=!0,this._animateToCenter=s,this._animateToZoom=a,ge(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:s,zoom:a,noUpdate:m}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(c(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Be(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Fh(s,a){return new Ne(s,a)}var Ft=J.extend({options:{position:"topright"},initialize:function(s){w(this,s)},getPosition:function(){return this.options.position},setPosition:function(s){var a=this._map;return a&&a.removeControl(this),this.options.position=s,a&&a.addControl(this),this},getContainer:function(){return this._container},addTo:function(s){this.remove(),this._map=s;var a=this._container=this.onAdd(s),l=this.getPosition(),m=s._controlCorners[l];return ge(a,"leaflet-control"),l.indexOf("bottom")!==-1?m.insertBefore(a,m.firstChild):m.appendChild(a),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(De(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(s){this._map&&s&&s.screenX>0&&s.screenY>0&&this._map.getContainer().focus()}}),ga=function(s){return new Ft(s)};Ne.include({addControl:function(s){return s.addTo(this),this},removeControl:function(s){return s.remove(),this},_initControlPos:function(){var s=this._controlCorners={},a="leaflet-",l=this._controlContainer=ke("div",a+"control-container",this._container);function m(v,k){var D=a+v+" "+a+k;s[v+k]=ke("div",D,l)}m("top","left"),m("top","right"),m("bottom","left"),m("bottom","right")},_clearControlPos:function(){for(var s in this._controlCorners)De(this._controlCorners[s]);De(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ll=Ft.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(s,a,l,m){return l<m?-1:m<l?1:0}},initialize:function(s,a,l){w(this,l),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var m in s)this._addLayer(s[m],m);for(m in a)this._addLayer(a[m],m,!0)},onAdd:function(s){this._initLayout(),this._update(),this._map=s,s.on("zoomend",this._checkDisabledLayers,this);for(var a=0;a<this._layers.length;a++)this._layers[a].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(s){return Ft.prototype.addTo.call(this,s),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var s=0;s<this._layers.length;s++)this._layers[s].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(s,a){return this._addLayer(s,a),this._map?this._update():this},addOverlay:function(s,a){return this._addLayer(s,a,!0),this._map?this._update():this},removeLayer:function(s){s.off("add remove",this._onLayerChange,this);var a=this._getLayer(u(s));return a&&this._layers.splice(this._layers.indexOf(a),1),this._map?this._update():this},expand:function(){ge(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var s=this._map.getSize().y-(this._container.offsetTop+50);return s<this._section.clientHeight?(ge(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=s+"px"):Be(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Be(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var s="leaflet-control-layers",a=this._container=ke("div",s),l=this.options.collapsed;a.setAttribute("aria-haspopup",!0),fa(a),Ci(a);var m=this._section=ke("section",s+"-list");l&&(this._map.on("click",this.collapse,this),pe(a,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var v=this._layersLink=ke("a",s+"-toggle",a);v.href="#",v.title="Layers",v.setAttribute("role","button"),pe(v,{keydown:function(k){k.keyCode===13&&this._expandSafely()},click:function(k){et(k),this._expandSafely()}},this),l||this.expand(),this._baseLayersList=ke("div",s+"-base",m),this._separator=ke("div",s+"-separator",m),this._overlaysList=ke("div",s+"-overlays",m),a.appendChild(m)},_getLayer:function(s){for(var a=0;a<this._layers.length;a++)if(this._layers[a]&&u(this._layers[a].layer)===s)return this._layers[a]},_addLayer:function(s,a,l){this._map&&s.on("add remove",this._onLayerChange,this),this._layers.push({layer:s,name:a,overlay:l}),this.options.sortLayers&&this._layers.sort(c(function(m,v){return this.options.sortFunction(m.layer,v.layer,m.name,v.name)},this)),this.options.autoZIndex&&s.setZIndex&&(this._lastZIndex++,s.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ya(this._baseLayersList),Ya(this._overlaysList),this._layerControlInputs=[];var s,a,l,m,v=0;for(l=0;l<this._layers.length;l++)m=this._layers[l],this._addItem(m),a=a||m.overlay,s=s||!m.overlay,v+=m.overlay?0:1;return this.options.hideSingleBase&&(s=s&&v>1,this._baseLayersList.style.display=s?"":"none"),this._separator.style.display=a&&s?"":"none",this},_onLayerChange:function(s){this._handlingClick||this._update();var a=this._getLayer(u(s.target)),l=a.overlay?s.type==="add"?"overlayadd":"overlayremove":s.type==="add"?"baselayerchange":null;l&&this._map.fire(l,a)},_createRadioElement:function(s,a){var l='<input type="radio" class="leaflet-control-layers-selector" name="'+s+'"'+(a?' checked="checked"':"")+"/>",m=document.createElement("div");return m.innerHTML=l,m.firstChild},_addItem:function(s){var a=document.createElement("label"),l=this._map.hasLayer(s.layer),m;s.overlay?(m=document.createElement("input"),m.type="checkbox",m.className="leaflet-control-layers-selector",m.defaultChecked=l):m=this._createRadioElement("leaflet-base-layers_"+u(this),l),this._layerControlInputs.push(m),m.layerId=u(s.layer),pe(m,"click",this._onInputClick,this);var v=document.createElement("span");v.innerHTML=" "+s.name;var k=document.createElement("span");a.appendChild(k),k.appendChild(m),k.appendChild(v);var D=s.overlay?this._overlaysList:this._baseLayersList;return D.appendChild(a),this._checkDisabledLayers(),a},_onInputClick:function(){if(!this._preventClick){var s=this._layerControlInputs,a,l,m=[],v=[];this._handlingClick=!0;for(var k=s.length-1;k>=0;k--)a=s[k],l=this._getLayer(a.layerId).layer,a.checked?m.push(l):a.checked||v.push(l);for(k=0;k<v.length;k++)this._map.hasLayer(v[k])&&this._map.removeLayer(v[k]);for(k=0;k<m.length;k++)this._map.hasLayer(m[k])||this._map.addLayer(m[k]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var s=this._layerControlInputs,a,l,m=this._map.getZoom(),v=s.length-1;v>=0;v--)a=s[v],l=this._getLayer(a.layerId).layer,a.disabled=l.options.minZoom!==void 0&&m<l.options.minZoom||l.options.maxZoom!==void 0&&m>l.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var s=this._section;this._preventClick=!0,pe(s,"click",et),this.expand();var a=this;setTimeout(function(){Ee(s,"click",et),a._preventClick=!1})}}),Bh=function(s,a,l){return new Ll(s,a,l)},Pi=Ft.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(s){var a="leaflet-control-zoom",l=ke("div",a+" leaflet-bar"),m=this.options;return this._zoomInButton=this._createButton(m.zoomInText,m.zoomInTitle,a+"-in",l,this._zoomIn),this._zoomOutButton=this._createButton(m.zoomOutText,m.zoomOutTitle,a+"-out",l,this._zoomOut),this._updateDisabled(),s.on("zoomend zoomlevelschange",this._updateDisabled,this),l},onRemove:function(s){s.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(s){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(s.shiftKey?3:1))},_zoomOut:function(s){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(s.shiftKey?3:1))},_createButton:function(s,a,l,m,v){var k=ke("a",l,m);return k.innerHTML=s,k.href="#",k.title=a,k.setAttribute("role","button"),k.setAttribute("aria-label",a),fa(k),pe(k,"click",rr),pe(k,"click",v,this),pe(k,"click",this._refocusOnMap,this),k},_updateDisabled:function(){var s=this._map,a="leaflet-disabled";Be(this._zoomInButton,a),Be(this._zoomOutButton,a),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||s._zoom===s.getMinZoom())&&(ge(this._zoomOutButton,a),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||s._zoom===s.getMaxZoom())&&(ge(this._zoomInButton,a),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ne.mergeOptions({zoomControl:!0}),Ne.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Pi,this.addControl(this.zoomControl))});var $h=function(s){return new Pi(s)},El=Ft.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(s){var a="leaflet-control-scale",l=ke("div",a),m=this.options;return this._addScales(m,a+"-line",l),s.on(m.updateWhenIdle?"moveend":"move",this._update,this),s.whenReady(this._update,this),l},onRemove:function(s){s.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(s,a,l){s.metric&&(this._mScale=ke("div",a,l)),s.imperial&&(this._iScale=ke("div",a,l))},_update:function(){var s=this._map,a=s.getSize().y/2,l=s.distance(s.containerPointToLatLng([0,a]),s.containerPointToLatLng([this.options.maxWidth,a]));this._updateScales(l)},_updateScales:function(s){this.options.metric&&s&&this._updateMetric(s),this.options.imperial&&s&&this._updateImperial(s)},_updateMetric:function(s){var a=this._getRoundNum(s),l=a<1e3?a+" m":a/1e3+" km";this._updateScale(this._mScale,l,a/s)},_updateImperial:function(s){var a=s*3.2808399,l,m,v;a>5280?(l=a/5280,m=this._getRoundNum(l),this._updateScale(this._iScale,m+" mi",m/l)):(v=this._getRoundNum(a),this._updateScale(this._iScale,v+" ft",v/a))},_updateScale:function(s,a,l){s.style.width=Math.round(this.options.maxWidth*l)+"px",s.innerHTML=a},_getRoundNum:function(s){var a=Math.pow(10,(Math.floor(s)+"").length-1),l=s/a;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:1,a*l}}),Zh=function(s){return new El(s)},Hh='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ti=Ft.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(de.inlineSvg?Hh+" ":"")+"Leaflet</a>"},initialize:function(s){w(this,s),this._attributions={}},onAdd:function(s){s.attributionControl=this,this._container=ke("div","leaflet-control-attribution"),fa(this._container);for(var a in s._layers)s._layers[a].getAttribution&&this.addAttribution(s._layers[a].getAttribution());return this._update(),s.on("layeradd",this._addAttribution,this),this._container},onRemove:function(s){s.off("layeradd",this._addAttribution,this)},_addAttribution:function(s){s.layer.getAttribution&&(this.addAttribution(s.layer.getAttribution()),s.layer.once("remove",function(){this.removeAttribution(s.layer.getAttribution())},this))},setPrefix:function(s){return this.options.prefix=s,this._update(),this},addAttribution:function(s){return s?(this._attributions[s]||(this._attributions[s]=0),this._attributions[s]++,this._update(),this):this},removeAttribution:function(s){return s?(this._attributions[s]&&(this._attributions[s]--,this._update()),this):this},_update:function(){if(this._map){var s=[];for(var a in this._attributions)this._attributions[a]&&s.push(a);var l=[];this.options.prefix&&l.push(this.options.prefix),s.length&&l.push(s.join(", ")),this._container.innerHTML=l.join(' <span aria-hidden="true">|</span> ')}}});Ne.mergeOptions({attributionControl:!0}),Ne.addInitHook(function(){this.options.attributionControl&&new Ti().addTo(this)});var Uh=function(s){return new Ti(s)};Ft.Layers=Ll,Ft.Zoom=Pi,Ft.Scale=El,Ft.Attribution=Ti,ga.layers=Bh,ga.zoom=$h,ga.scale=Zh,ga.attribution=Uh;var ts=J.extend({initialize:function(s){this._map=s},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ts.addTo=function(s,a){return s.addHandler(a,this),this};var Wh={Events:te},Rl=de.touch?"touchstart mousedown":"mousedown",Es=Y.extend({options:{clickTolerance:3},initialize:function(s,a,l,m){w(this,m),this._element=s,this._dragStartTarget=a||s,this._preventOutline=l},enable:function(){this._enabled||(pe(this._dragStartTarget,Rl,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Es._dragging===this&&this.finishDrag(!0),Ee(this._dragStartTarget,Rl,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(s){if(this._enabled&&(this._moved=!1,!pi(this._element,"leaflet-zoom-anim"))){if(s.touches&&s.touches.length!==1){Es._dragging===this&&this.finishDrag();return}if(!(Es._dragging||s.shiftKey||s.which!==1&&s.button!==1&&!s.touches)&&(Es._dragging=this,this._preventOutline&&_i(this._element),bi(),ma(),!this._moving)){this.fire("down");var a=s.touches?s.touches[0]:s,l=Nl(this._element);this._startPoint=new W(a.clientX,a.clientY),this._startPos=tr(this._element),this._parentScale=ji(l);var m=s.type==="mousedown";pe(document,m?"mousemove":"touchmove",this._onMove,this),pe(document,m?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(s){if(this._enabled){if(s.touches&&s.touches.length>1){this._moved=!0;return}var a=s.touches&&s.touches.length===1?s.touches[0]:s,l=new W(a.clientX,a.clientY)._subtract(this._startPoint);!l.x&&!l.y||Math.abs(l.x)+Math.abs(l.y)<this.options.clickTolerance||(l.x/=this._parentScale.x,l.y/=this._parentScale.y,et(s),this._moved||(this.fire("dragstart"),this._moved=!0,ge(document.body,"leaflet-dragging"),this._lastTarget=s.target||s.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ge(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(l),this._moving=!0,this._lastEvent=s,this._updatePosition())}},_updatePosition:function(){var s={originalEvent:this._lastEvent};this.fire("predrag",s),He(this._element,this._newPos),this.fire("drag",s)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(s){Be(document.body,"leaflet-dragging"),this._lastTarget&&(Be(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ee(document,"mousemove touchmove",this._onMove,this),Ee(document,"mouseup touchend touchcancel",this._onUp,this),yi(),xa();var a=this._moved&&this._moving;this._moving=!1,Es._dragging=!1,a&&this.fire("dragend",{noInertia:s,distance:this._newPos.distanceTo(this._startPos)})}});function Ml(s,a,l){var m,v=[1,4,2,8],k,D,B,H,G,re,me,ve;for(k=0,re=s.length;k<re;k++)s[k]._code=ar(s[k],a);for(B=0;B<4;B++){for(me=v[B],m=[],k=0,re=s.length,D=re-1;k<re;D=k++)H=s[k],G=s[D],H._code&me?G._code&me||(ve=rn(G,H,me,a,l),ve._code=ar(ve,a),m.push(ve)):(G._code&me&&(ve=rn(G,H,me,a,l),ve._code=ar(ve,a),m.push(ve)),m.push(H));s=m}return s}function Dl(s,a){var l,m,v,k,D,B,H,G,re;if(!s||s.length===0)throw new Error("latlngs not passed");Tt(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var me=se([0,0]),ve=ae(s),ut=ve.getNorthWest().distanceTo(ve.getSouthWest())*ve.getNorthEast().distanceTo(ve.getNorthWest());ut<1700&&(me=Li(s));var Qe=s.length,Lt=[];for(l=0;l<Qe;l++){var gt=se(s[l]);Lt.push(a.project(se([gt.lat-me.lat,gt.lng-me.lng])))}for(B=H=G=0,l=0,m=Qe-1;l<Qe;m=l++)v=Lt[l],k=Lt[m],D=v.y*k.x-k.y*v.x,H+=(v.x+k.x)*D,G+=(v.y+k.y)*D,B+=D*3;B===0?re=Lt[0]:re=[H/B,G/B];var Or=a.unproject(q(re));return se([Or.lat+me.lat,Or.lng+me.lng])}function Li(s){for(var a=0,l=0,m=0,v=0;v<s.length;v++){var k=se(s[v]);a+=k.lat,l+=k.lng,m++}return se([a/m,l/m])}var Vh={__proto__:null,clipPolygon:Ml,polygonCenter:Dl,centroid:Li};function Al(s,a){if(!a||!s.length)return s.slice();var l=a*a;return s=Kh(s,l),s=Gh(s,l),s}function Ol(s,a,l){return Math.sqrt(ba(s,a,l,!0))}function qh(s,a,l){return ba(s,a,l)}function Gh(s,a){var l=s.length,m=typeof Uint8Array<"u"?Uint8Array:Array,v=new m(l);v[0]=v[l-1]=1,Ei(s,v,a,0,l-1);var k,D=[];for(k=0;k<l;k++)v[k]&&D.push(s[k]);return D}function Ei(s,a,l,m,v){var k=0,D,B,H;for(B=m+1;B<=v-1;B++)H=ba(s[B],s[m],s[v],!0),H>k&&(D=B,k=H);k>l&&(a[D]=1,Ei(s,a,l,m,D),Ei(s,a,l,D,v))}function Kh(s,a){for(var l=[s[0]],m=1,v=0,k=s.length;m<k;m++)Jh(s[m],s[v])>a&&(l.push(s[m]),v=m);return v<k-1&&l.push(s[k-1]),l}var Il;function zl(s,a,l,m,v){var k=m?Il:ar(s,l),D=ar(a,l),B,H,G;for(Il=D;;){if(!(k|D))return[s,a];if(k&D)return!1;B=k||D,H=rn(s,a,B,l,v),G=ar(H,l),B===k?(s=H,k=G):(a=H,D=G)}}function rn(s,a,l,m,v){var k=a.x-s.x,D=a.y-s.y,B=m.min,H=m.max,G,re;return l&8?(G=s.x+k*(H.y-s.y)/D,re=H.y):l&4?(G=s.x+k*(B.y-s.y)/D,re=B.y):l&2?(G=H.x,re=s.y+D*(H.x-s.x)/k):l&1&&(G=B.x,re=s.y+D*(B.x-s.x)/k),new W(G,re,v)}function ar(s,a){var l=0;return s.x<a.min.x?l|=1:s.x>a.max.x&&(l|=2),s.y<a.min.y?l|=4:s.y>a.max.y&&(l|=8),l}function Jh(s,a){var l=a.x-s.x,m=a.y-s.y;return l*l+m*m}function ba(s,a,l,m){var v=a.x,k=a.y,D=l.x-v,B=l.y-k,H=D*D+B*B,G;return H>0&&(G=((s.x-v)*D+(s.y-k)*B)/H,G>1?(v=l.x,k=l.y):G>0&&(v+=D*G,k+=B*G)),D=s.x-v,B=s.y-k,m?D*D+B*B:new W(v,k)}function Tt(s){return!T(s[0])||typeof s[0][0]!="object"&&typeof s[0][0]<"u"}function Fl(s){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Tt(s)}function Bl(s,a){var l,m,v,k,D,B,H,G;if(!s||s.length===0)throw new Error("latlngs not passed");Tt(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var re=se([0,0]),me=ae(s),ve=me.getNorthWest().distanceTo(me.getSouthWest())*me.getNorthEast().distanceTo(me.getNorthWest());ve<1700&&(re=Li(s));var ut=s.length,Qe=[];for(l=0;l<ut;l++){var Lt=se(s[l]);Qe.push(a.project(se([Lt.lat-re.lat,Lt.lng-re.lng])))}for(l=0,m=0;l<ut-1;l++)m+=Qe[l].distanceTo(Qe[l+1])/2;if(m===0)G=Qe[0];else for(l=0,k=0;l<ut-1;l++)if(D=Qe[l],B=Qe[l+1],v=D.distanceTo(B),k+=v,k>m){H=(k-m)/v,G=[B.x-H*(B.x-D.x),B.y-H*(B.y-D.y)];break}var gt=a.unproject(q(G));return se([gt.lat+re.lat,gt.lng+re.lng])}var Qh={__proto__:null,simplify:Al,pointToSegmentDistance:Ol,closestPointOnSegment:qh,clipSegment:zl,_getEdgeIntersection:rn,_getBitCode:ar,_sqClosestPointOnSegment:ba,isFlat:Tt,_flat:Fl,polylineCenter:Bl},Ri={project:function(s){return new W(s.lng,s.lat)},unproject:function(s){return new ie(s.y,s.x)},bounds:new K([-180,-90],[180,90])},Mi={R:6378137,R_MINOR:6356752314245179e-9,bounds:new K([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(s){var a=Math.PI/180,l=this.R,m=s.lat*a,v=this.R_MINOR/l,k=Math.sqrt(1-v*v),D=k*Math.sin(m),B=Math.tan(Math.PI/4-m/2)/Math.pow((1-D)/(1+D),k/2);return m=-l*Math.log(Math.max(B,1e-10)),new W(s.lng*a*l,m)},unproject:function(s){for(var a=180/Math.PI,l=this.R,m=this.R_MINOR/l,v=Math.sqrt(1-m*m),k=Math.exp(-s.y/l),D=Math.PI/2-2*Math.atan(k),B=0,H=.1,G;B<15&&Math.abs(H)>1e-7;B++)G=v*Math.sin(D),G=Math.pow((1-G)/(1+G),v/2),H=Math.PI/2-2*Math.atan(k*G)-D,D+=H;return new ie(D*a,s.x*a/l)}},Yh={__proto__:null,LonLat:Ri,Mercator:Mi,SphericalMercator:Ct},Xh=o({},Se,{code:"EPSG:3395",projection:Mi,transformation:function(){var s=.5/(Math.PI*Mi.R);return dt(s,.5,-s,.5)}()}),$l=o({},Se,{code:"EPSG:4326",projection:Ri,transformation:dt(1/180,1,-1/180,.5)}),em=o({},le,{projection:Ri,transformation:dt(1,0,-1,0),scale:function(s){return Math.pow(2,s)},zoom:function(s){return Math.log(s)/Math.LN2},distance:function(s,a){var l=a.lng-s.lng,m=a.lat-s.lat;return Math.sqrt(l*l+m*m)},infinite:!0});le.Earth=Se,le.EPSG3395=Xh,le.EPSG3857=Te,le.EPSG900913=Ot,le.EPSG4326=$l,le.Simple=em;var Bt=Y.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(s){return s.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(s){return s&&s.removeLayer(this),this},getPane:function(s){return this._map.getPane(s?this.options[s]||s:this.options.pane)},addInteractiveTarget:function(s){return this._map._targets[u(s)]=this,this},removeInteractiveTarget:function(s){return delete this._map._targets[u(s)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(s){var a=s.target;if(a.hasLayer(this)){if(this._map=a,this._zoomAnimated=a._zoomAnimated,this.getEvents){var l=this.getEvents();a.on(l,this),this.once("remove",function(){a.off(l,this)},this)}this.onAdd(a),this.fire("add"),a.fire("layeradd",{layer:this})}}});Ne.include({addLayer:function(s){if(!s._layerAdd)throw new Error("The provided object is not a Layer.");var a=u(s);return this._layers[a]?this:(this._layers[a]=s,s._mapToAdd=this,s.beforeAdd&&s.beforeAdd(this),this.whenReady(s._layerAdd,s),this)},removeLayer:function(s){var a=u(s);return this._layers[a]?(this._loaded&&s.onRemove(this),delete this._layers[a],this._loaded&&(this.fire("layerremove",{layer:s}),s.fire("remove")),s._map=s._mapToAdd=null,this):this},hasLayer:function(s){return u(s)in this._layers},eachLayer:function(s,a){for(var l in this._layers)s.call(a,this._layers[l]);return this},_addLayers:function(s){s=s?T(s)?s:[s]:[];for(var a=0,l=s.length;a<l;a++)this.addLayer(s[a])},_addZoomLimit:function(s){(!isNaN(s.options.maxZoom)||!isNaN(s.options.minZoom))&&(this._zoomBoundLayers[u(s)]=s,this._updateZoomLevels())},_removeZoomLimit:function(s){var a=u(s);this._zoomBoundLayers[a]&&(delete this._zoomBoundLayers[a],this._updateZoomLevels())},_updateZoomLevels:function(){var s=1/0,a=-1/0,l=this._getZoomSpan();for(var m in this._zoomBoundLayers){var v=this._zoomBoundLayers[m].options;s=v.minZoom===void 0?s:Math.min(s,v.minZoom),a=v.maxZoom===void 0?a:Math.max(a,v.maxZoom)}this._layersMaxZoom=a===-1/0?void 0:a,this._layersMinZoom=s===1/0?void 0:s,l!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Er=Bt.extend({initialize:function(s,a){w(this,a),this._layers={};var l,m;if(s)for(l=0,m=s.length;l<m;l++)this.addLayer(s[l])},addLayer:function(s){var a=this.getLayerId(s);return this._layers[a]=s,this._map&&this._map.addLayer(s),this},removeLayer:function(s){var a=s in this._layers?s:this.getLayerId(s);return this._map&&this._layers[a]&&this._map.removeLayer(this._layers[a]),delete this._layers[a],this},hasLayer:function(s){var a=typeof s=="number"?s:this.getLayerId(s);return a in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(s){var a=Array.prototype.slice.call(arguments,1),l,m;for(l in this._layers)m=this._layers[l],m[s]&&m[s].apply(m,a);return this},onAdd:function(s){this.eachLayer(s.addLayer,s)},onRemove:function(s){this.eachLayer(s.removeLayer,s)},eachLayer:function(s,a){for(var l in this._layers)s.call(a,this._layers[l]);return this},getLayer:function(s){return this._layers[s]},getLayers:function(){var s=[];return this.eachLayer(s.push,s),s},setZIndex:function(s){return this.invoke("setZIndex",s)},getLayerId:function(s){return u(s)}}),tm=function(s,a){return new Er(s,a)},hs=Er.extend({addLayer:function(s){return this.hasLayer(s)?this:(s.addEventParent(this),Er.prototype.addLayer.call(this,s),this.fire("layeradd",{layer:s}))},removeLayer:function(s){return this.hasLayer(s)?(s in this._layers&&(s=this._layers[s]),s.removeEventParent(this),Er.prototype.removeLayer.call(this,s),this.fire("layerremove",{layer:s})):this},setStyle:function(s){return this.invoke("setStyle",s)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var s=new V;for(var a in this._layers){var l=this._layers[a];s.extend(l.getBounds?l.getBounds():l.getLatLng())}return s}}),sm=function(s,a){return new hs(s,a)},Rr=J.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(s){w(this,s)},createIcon:function(s){return this._createIcon("icon",s)},createShadow:function(s){return this._createIcon("shadow",s)},_createIcon:function(s,a){var l=this._getIconUrl(s);if(!l){if(s==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var m=this._createImg(l,a&&a.tagName==="IMG"?a:null);return this._setIconStyles(m,s),(this.options.crossOrigin||this.options.crossOrigin==="")&&(m.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),m},_setIconStyles:function(s,a){var l=this.options,m=l[a+"Size"];typeof m=="number"&&(m=[m,m]);var v=q(m),k=q(a==="shadow"&&l.shadowAnchor||l.iconAnchor||v&&v.divideBy(2,!0));s.className="leaflet-marker-"+a+" "+(l.className||""),k&&(s.style.marginLeft=-k.x+"px",s.style.marginTop=-k.y+"px"),v&&(s.style.width=v.x+"px",s.style.height=v.y+"px")},_createImg:function(s,a){return a=a||document.createElement("img"),a.src=s,a},_getIconUrl:function(s){return de.retina&&this.options[s+"RetinaUrl"]||this.options[s+"Url"]}});function rm(s){return new Rr(s)}var ya=Rr.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(s){return typeof ya.imagePath!="string"&&(ya.imagePath=this._detectIconPath()),(this.options.imagePath||ya.imagePath)+Rr.prototype._getIconUrl.call(this,s)},_stripUrl:function(s){var a=function(l,m,v){var k=m.exec(l);return k&&k[v]};return s=a(s,/^url\((['"])?(.+)\1\)$/,2),s&&a(s,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var s=ke("div","leaflet-default-icon-path",document.body),a=ha(s,"background-image")||ha(s,"backgroundImage");if(document.body.removeChild(s),a=this._stripUrl(a),a)return a;var l=document.querySelector('link[href$="leaflet.css"]');return l?l.href.substring(0,l.href.length-11-1):""}}),Zl=ts.extend({initialize:function(s){this._marker=s},addHooks:function(){var s=this._marker._icon;this._draggable||(this._draggable=new Es(s,s,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ge(s,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Be(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(s){var a=this._marker,l=a._map,m=this._marker.options.autoPanSpeed,v=this._marker.options.autoPanPadding,k=tr(a._icon),D=l.getPixelBounds(),B=l.getPixelOrigin(),H=ce(D.min._subtract(B).add(v),D.max._subtract(B).subtract(v));if(!H.contains(k)){var G=q((Math.max(H.max.x,k.x)-H.max.x)/(D.max.x-H.max.x)-(Math.min(H.min.x,k.x)-H.min.x)/(D.min.x-H.min.x),(Math.max(H.max.y,k.y)-H.max.y)/(D.max.y-H.max.y)-(Math.min(H.min.y,k.y)-H.min.y)/(D.min.y-H.min.y)).multiplyBy(m);l.panBy(G,{animate:!1}),this._draggable._newPos._add(G),this._draggable._startPos._add(G),He(a._icon,this._draggable._newPos),this._onDrag(s),this._panRequest=I(this._adjustPan.bind(this,s))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(s){this._marker.options.autoPan&&(F(this._panRequest),this._panRequest=I(this._adjustPan.bind(this,s)))},_onDrag:function(s){var a=this._marker,l=a._shadow,m=tr(a._icon),v=a._map.layerPointToLatLng(m);l&&He(l,m),a._latlng=v,s.latlng=v,s.oldLatLng=this._oldLatLng,a.fire("move",s).fire("drag",s)},_onDragEnd:function(s){F(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",s)}}),an=Bt.extend({options:{icon:new ya,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(s,a){w(this,a),this._latlng=se(s)},onAdd:function(s){this._zoomAnimated=this._zoomAnimated&&s.options.markerZoomAnimation,this._zoomAnimated&&s.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(s){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&s.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(s){var a=this._latlng;return this._latlng=se(s),this.update(),this.fire("move",{oldLatLng:a,latlng:this._latlng})},setZIndexOffset:function(s){return this.options.zIndexOffset=s,this.update()},getIcon:function(){return this.options.icon},setIcon:function(s){return this.options.icon=s,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var s=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(s)}return this},_initIcon:function(){var s=this.options,a="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),l=s.icon.createIcon(this._icon),m=!1;l!==this._icon&&(this._icon&&this._removeIcon(),m=!0,s.title&&(l.title=s.title),l.tagName==="IMG"&&(l.alt=s.alt||"")),ge(l,a),s.keyboard&&(l.tabIndex="0",l.setAttribute("role","button")),this._icon=l,s.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&pe(l,"focus",this._panOnFocus,this);var v=s.icon.createShadow(this._shadow),k=!1;v!==this._shadow&&(this._removeShadow(),k=!0),v&&(ge(v,a),v.alt=""),this._shadow=v,s.opacity<1&&this._updateOpacity(),m&&this.getPane().appendChild(this._icon),this._initInteraction(),v&&k&&this.getPane(s.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ee(this._icon,"focus",this._panOnFocus,this),De(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&De(this._shadow),this._shadow=null},_setPos:function(s){this._icon&&He(this._icon,s),this._shadow&&He(this._shadow,s),this._zIndex=s.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(s){this._icon&&(this._icon.style.zIndex=this._zIndex+s)},_animateZoom:function(s){var a=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center).round();this._setPos(a)},_initInteraction:function(){if(this.options.interactive&&(ge(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Zl)){var s=this.options.draggable;this.dragging&&(s=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Zl(this),s&&this.dragging.enable()}},setOpacity:function(s){return this.options.opacity=s,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var s=this.options.opacity;this._icon&&Pt(this._icon,s),this._shadow&&Pt(this._shadow,s)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var s=this._map;if(s){var a=this.options.icon.options,l=a.iconSize?q(a.iconSize):q(0,0),m=a.iconAnchor?q(a.iconAnchor):q(0,0);s.panInside(this._latlng,{paddingTopLeft:m,paddingBottomRight:l.subtract(m)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function am(s,a){return new an(s,a)}var Rs=Bt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(s){this._renderer=s.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(s){return w(this,s),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&s&&Object.prototype.hasOwnProperty.call(s,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),nn=Rs.extend({options:{fill:!0,radius:10},initialize:function(s,a){w(this,a),this._latlng=se(s),this._radius=this.options.radius},setLatLng:function(s){var a=this._latlng;return this._latlng=se(s),this.redraw(),this.fire("move",{oldLatLng:a,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(s){return this.options.radius=this._radius=s,this.redraw()},getRadius:function(){return this._radius},setStyle:function(s){var a=s&&s.radius||this._radius;return Rs.prototype.setStyle.call(this,s),this.setRadius(a),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var s=this._radius,a=this._radiusY||s,l=this._clickTolerance(),m=[s+l,a+l];this._pxBounds=new K(this._point.subtract(m),this._point.add(m))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(s){return s.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function nm(s,a){return new nn(s,a)}var Di=nn.extend({initialize:function(s,a,l){if(typeof a=="number"&&(a=o({},l,{radius:a})),w(this,a),this._latlng=se(s),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(s){return this._mRadius=s,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var s=[this._radius,this._radiusY||this._radius];return new V(this._map.layerPointToLatLng(this._point.subtract(s)),this._map.layerPointToLatLng(this._point.add(s)))},setStyle:Rs.prototype.setStyle,_project:function(){var s=this._latlng.lng,a=this._latlng.lat,l=this._map,m=l.options.crs;if(m.distance===Se.distance){var v=Math.PI/180,k=this._mRadius/Se.R/v,D=l.project([a+k,s]),B=l.project([a-k,s]),H=D.add(B).divideBy(2),G=l.unproject(H).lat,re=Math.acos((Math.cos(k*v)-Math.sin(a*v)*Math.sin(G*v))/(Math.cos(a*v)*Math.cos(G*v)))/v;(isNaN(re)||re===0)&&(re=k/Math.cos(Math.PI/180*a)),this._point=H.subtract(l.getPixelOrigin()),this._radius=isNaN(re)?0:H.x-l.project([G,s-re]).x,this._radiusY=H.y-D.y}else{var me=m.unproject(m.project(this._latlng).subtract([this._mRadius,0]));this._point=l.latLngToLayerPoint(this._latlng),this._radius=this._point.x-l.latLngToLayerPoint(me).x}this._updateBounds()}});function im(s,a,l){return new Di(s,a,l)}var ms=Rs.extend({options:{smoothFactor:1,noClip:!1},initialize:function(s,a){w(this,a),this._setLatLngs(s)},getLatLngs:function(){return this._latlngs},setLatLngs:function(s){return this._setLatLngs(s),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(s){for(var a=1/0,l=null,m=ba,v,k,D=0,B=this._parts.length;D<B;D++)for(var H=this._parts[D],G=1,re=H.length;G<re;G++){v=H[G-1],k=H[G];var me=m(s,v,k,!0);me<a&&(a=me,l=m(s,v,k))}return l&&(l.distance=Math.sqrt(a)),l},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Bl(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(s,a){return a=a||this._defaultShape(),s=se(s),a.push(s),this._bounds.extend(s),this.redraw()},_setLatLngs:function(s){this._bounds=new V,this._latlngs=this._convertLatLngs(s)},_defaultShape:function(){return Tt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(s){for(var a=[],l=Tt(s),m=0,v=s.length;m<v;m++)l?(a[m]=se(s[m]),this._bounds.extend(a[m])):a[m]=this._convertLatLngs(s[m]);return a},_project:function(){var s=new K;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,s),this._bounds.isValid()&&s.isValid()&&(this._rawPxBounds=s,this._updateBounds())},_updateBounds:function(){var s=this._clickTolerance(),a=new W(s,s);this._rawPxBounds&&(this._pxBounds=new K([this._rawPxBounds.min.subtract(a),this._rawPxBounds.max.add(a)]))},_projectLatlngs:function(s,a,l){var m=s[0]instanceof ie,v=s.length,k,D;if(m){for(D=[],k=0;k<v;k++)D[k]=this._map.latLngToLayerPoint(s[k]),l.extend(D[k]);a.push(D)}else for(k=0;k<v;k++)this._projectLatlngs(s[k],a,l)},_clipPoints:function(){var s=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}var a=this._parts,l,m,v,k,D,B,H;for(l=0,v=0,k=this._rings.length;l<k;l++)for(H=this._rings[l],m=0,D=H.length;m<D-1;m++)B=zl(H[m],H[m+1],s,m,!0),B&&(a[v]=a[v]||[],a[v].push(B[0]),(B[1]!==H[m+1]||m===D-2)&&(a[v].push(B[1]),v++))}},_simplifyPoints:function(){for(var s=this._parts,a=this.options.smoothFactor,l=0,m=s.length;l<m;l++)s[l]=Al(s[l],a)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(s,a){var l,m,v,k,D,B,H=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(l=0,k=this._parts.length;l<k;l++)for(B=this._parts[l],m=0,D=B.length,v=D-1;m<D;v=m++)if(!(!a&&m===0)&&Ol(s,B[v],B[m])<=H)return!0;return!1}});function om(s,a){return new ms(s,a)}ms._flat=Fl;var Mr=ms.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Dl(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(s){var a=ms.prototype._convertLatLngs.call(this,s),l=a.length;return l>=2&&a[0]instanceof ie&&a[0].equals(a[l-1])&&a.pop(),a},_setLatLngs:function(s){ms.prototype._setLatLngs.call(this,s),Tt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Tt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var s=this._renderer._bounds,a=this.options.weight,l=new W(a,a);if(s=new K(s.min.subtract(l),s.max.add(l)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}for(var m=0,v=this._rings.length,k;m<v;m++)k=Ml(this._rings[m],s,!0),k.length&&this._parts.push(k)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(s){var a=!1,l,m,v,k,D,B,H,G;if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(k=0,H=this._parts.length;k<H;k++)for(l=this._parts[k],D=0,G=l.length,B=G-1;D<G;B=D++)m=l[D],v=l[B],m.y>s.y!=v.y>s.y&&s.x<(v.x-m.x)*(s.y-m.y)/(v.y-m.y)+m.x&&(a=!a);return a||ms.prototype._containsPoint.call(this,s,!0)}});function lm(s,a){return new Mr(s,a)}var xs=hs.extend({initialize:function(s,a){w(this,a),this._layers={},s&&this.addData(s)},addData:function(s){var a=T(s)?s:s.features,l,m,v;if(a){for(l=0,m=a.length;l<m;l++)v=a[l],(v.geometries||v.geometry||v.features||v.coordinates)&&this.addData(v);return this}var k=this.options;if(k.filter&&!k.filter(s))return this;var D=on(s,k);return D?(D.feature=cn(s),D.defaultOptions=D.options,this.resetStyle(D),k.onEachFeature&&k.onEachFeature(s,D),this.addLayer(D)):this},resetStyle:function(s){return s===void 0?this.eachLayer(this.resetStyle,this):(s.options=o({},s.defaultOptions),this._setLayerStyle(s,this.options.style),this)},setStyle:function(s){return this.eachLayer(function(a){this._setLayerStyle(a,s)},this)},_setLayerStyle:function(s,a){s.setStyle&&(typeof a=="function"&&(a=a(s.feature)),s.setStyle(a))}});function on(s,a){var l=s.type==="Feature"?s.geometry:s,m=l?l.coordinates:null,v=[],k=a&&a.pointToLayer,D=a&&a.coordsToLatLng||Ai,B,H,G,re;if(!m&&!l)return null;switch(l.type){case"Point":return B=D(m),Hl(k,s,B,a);case"MultiPoint":for(G=0,re=m.length;G<re;G++)B=D(m[G]),v.push(Hl(k,s,B,a));return new hs(v);case"LineString":case"MultiLineString":return H=ln(m,l.type==="LineString"?0:1,D),new ms(H,a);case"Polygon":case"MultiPolygon":return H=ln(m,l.type==="Polygon"?1:2,D),new Mr(H,a);case"GeometryCollection":for(G=0,re=l.geometries.length;G<re;G++){var me=on({geometry:l.geometries[G],type:"Feature",properties:s.properties},a);me&&v.push(me)}return new hs(v);case"FeatureCollection":for(G=0,re=l.features.length;G<re;G++){var ve=on(l.features[G],a);ve&&v.push(ve)}return new hs(v);default:throw new Error("Invalid GeoJSON object.")}}function Hl(s,a,l,m){return s?s(a,l):new an(l,m&&m.markersInheritOptions&&m)}function Ai(s){return new ie(s[1],s[0],s[2])}function ln(s,a,l){for(var m=[],v=0,k=s.length,D;v<k;v++)D=a?ln(s[v],a-1,l):(l||Ai)(s[v]),m.push(D);return m}function Oi(s,a){return s=se(s),s.alt!==void 0?[g(s.lng,a),g(s.lat,a),g(s.alt,a)]:[g(s.lng,a),g(s.lat,a)]}function dn(s,a,l,m){for(var v=[],k=0,D=s.length;k<D;k++)v.push(a?dn(s[k],Tt(s[k])?0:a-1,l,m):Oi(s[k],m));return!a&&l&&v.length>0&&v.push(v[0].slice()),v}function Dr(s,a){return s.feature?o({},s.feature,{geometry:a}):cn(a)}function cn(s){return s.type==="Feature"||s.type==="FeatureCollection"?s:{type:"Feature",properties:{},geometry:s}}var Ii={toGeoJSON:function(s){return Dr(this,{type:"Point",coordinates:Oi(this.getLatLng(),s)})}};an.include(Ii),Di.include(Ii),nn.include(Ii),ms.include({toGeoJSON:function(s){var a=!Tt(this._latlngs),l=dn(this._latlngs,a?1:0,!1,s);return Dr(this,{type:(a?"Multi":"")+"LineString",coordinates:l})}}),Mr.include({toGeoJSON:function(s){var a=!Tt(this._latlngs),l=a&&!Tt(this._latlngs[0]),m=dn(this._latlngs,l?2:a?1:0,!0,s);return a||(m=[m]),Dr(this,{type:(l?"Multi":"")+"Polygon",coordinates:m})}}),Er.include({toMultiPoint:function(s){var a=[];return this.eachLayer(function(l){a.push(l.toGeoJSON(s).geometry.coordinates)}),Dr(this,{type:"MultiPoint",coordinates:a})},toGeoJSON:function(s){var a=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(a==="MultiPoint")return this.toMultiPoint(s);var l=a==="GeometryCollection",m=[];return this.eachLayer(function(v){if(v.toGeoJSON){var k=v.toGeoJSON(s);if(l)m.push(k.geometry);else{var D=cn(k);D.type==="FeatureCollection"?m.push.apply(m,D.features):m.push(D)}}}),l?Dr(this,{geometries:m,type:"GeometryCollection"}):{type:"FeatureCollection",features:m}}});function Ul(s,a){return new xs(s,a)}var dm=Ul,un=Bt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(s,a,l){this._url=s,this._bounds=ae(a),w(this,l)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ge(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){De(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(s){return this.options.opacity=s,this._image&&this._updateOpacity(),this},setStyle:function(s){return s.opacity&&this.setOpacity(s.opacity),this},bringToFront:function(){return this._map&&Tr(this._image),this},bringToBack:function(){return this._map&&Lr(this._image),this},setUrl:function(s){return this._url=s,this._image&&(this._image.src=s),this},setBounds:function(s){return this._bounds=ae(s),this._map&&this._reset(),this},getEvents:function(){var s={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var s=this._url.tagName==="IMG",a=this._image=s?this._url:ke("img");if(ge(a,"leaflet-image-layer"),this._zoomAnimated&&ge(a,"leaflet-zoom-animated"),this.options.className&&ge(a,this.options.className),a.onselectstart=b,a.onmousemove=b,a.onload=c(this.fire,this,"load"),a.onerror=c(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(a.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),s){this._url=a.src;return}a.src=this._url,a.alt=this.options.alt},_animateZoom:function(s){var a=this._map.getZoomScale(s.zoom),l=this._map._latLngBoundsToNewLayerBounds(this._bounds,s.zoom,s.center).min;er(this._image,l,a)},_reset:function(){var s=this._image,a=new K(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),l=a.getSize();He(s,a.min),s.style.width=l.x+"px",s.style.height=l.y+"px"},_updateOpacity:function(){Pt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var s=this.options.errorOverlayUrl;s&&this._url!==s&&(this._url=s,this._image.src=s)},getCenter:function(){return this._bounds.getCenter()}}),cm=function(s,a,l){return new un(s,a,l)},Wl=un.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var s=this._url.tagName==="VIDEO",a=this._image=s?this._url:ke("video");if(ge(a,"leaflet-image-layer"),this._zoomAnimated&&ge(a,"leaflet-zoom-animated"),this.options.className&&ge(a,this.options.className),a.onselectstart=b,a.onmousemove=b,a.onloadeddata=c(this.fire,this,"load"),s){for(var l=a.getElementsByTagName("source"),m=[],v=0;v<l.length;v++)m.push(l[v].src);this._url=l.length>0?m:[a.src];return}T(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(a.style,"objectFit")&&(a.style.objectFit="fill"),a.autoplay=!!this.options.autoplay,a.loop=!!this.options.loop,a.muted=!!this.options.muted,a.playsInline=!!this.options.playsInline;for(var k=0;k<this._url.length;k++){var D=ke("source");D.src=this._url[k],a.appendChild(D)}}});function um(s,a,l){return new Wl(s,a,l)}var Vl=un.extend({_initImage:function(){var s=this._image=this._url;ge(s,"leaflet-image-layer"),this._zoomAnimated&&ge(s,"leaflet-zoom-animated"),this.options.className&&ge(s,this.options.className),s.onselectstart=b,s.onmousemove=b}});function hm(s,a,l){return new Vl(s,a,l)}var ss=Bt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(s,a){s&&(s instanceof ie||T(s))?(this._latlng=se(s),w(this,a)):(w(this,s),this._source=a),this.options.content&&(this._content=this.options.content)},openOn:function(s){return s=arguments.length?s:this._source._map,s.hasLayer(this)||s.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(s){return this._map?this.close():(arguments.length?this._source=s:s=this._source,this._prepareOpen(),this.openOn(s._map)),this},onAdd:function(s){this._zoomAnimated=s._zoomAnimated,this._container||this._initLayout(),s._fadeAnimated&&Pt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),s._fadeAnimated&&Pt(this._container,1),this.bringToFront(),this.options.interactive&&(ge(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(s){s._fadeAnimated?(Pt(this._container,0),this._removeTimeout=setTimeout(c(De,void 0,this._container),200)):De(this._container),this.options.interactive&&(Be(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(s){return this._latlng=se(s),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(s){return this._content=s,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var s={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Tr(this._container),this},bringToBack:function(){return this._map&&Lr(this._container),this},_prepareOpen:function(s){var a=this._source;if(!a._map)return!1;if(a instanceof hs){a=null;var l=this._source._layers;for(var m in l)if(l[m]._map){a=l[m];break}if(!a)return!1;this._source=a}if(!s)if(a.getCenter)s=a.getCenter();else if(a.getLatLng)s=a.getLatLng();else if(a.getBounds)s=a.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(s),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var s=this._contentNode,a=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof a=="string")s.innerHTML=a;else{for(;s.hasChildNodes();)s.removeChild(s.firstChild);s.appendChild(a)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var s=this._map.latLngToLayerPoint(this._latlng),a=q(this.options.offset),l=this._getAnchor();this._zoomAnimated?He(this._container,s.add(l)):a=a.add(s).add(l);var m=this._containerBottom=-a.y,v=this._containerLeft=-Math.round(this._containerWidth/2)+a.x;this._container.style.bottom=m+"px",this._container.style.left=v+"px"}},_getAnchor:function(){return[0,0]}});Ne.include({_initOverlay:function(s,a,l,m){var v=a;return v instanceof s||(v=new s(m).setContent(a)),l&&v.setLatLng(l),v}}),Bt.include({_initOverlay:function(s,a,l,m){var v=l;return v instanceof s?(w(v,m),v._source=this):(v=a&&!m?a:new s(m,this),v.setContent(l)),v}});var hn=ss.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(s){return s=arguments.length?s:this._source._map,!s.hasLayer(this)&&s._popup&&s._popup.options.autoClose&&s.removeLayer(s._popup),s._popup=this,ss.prototype.openOn.call(this,s)},onAdd:function(s){ss.prototype.onAdd.call(this,s),s.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Rs||this._source.on("preclick",sr))},onRemove:function(s){ss.prototype.onRemove.call(this,s),s.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Rs||this._source.off("preclick",sr))},getEvents:function(){var s=ss.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(s.preclick=this.close),this.options.keepInView&&(s.moveend=this._adjustPan),s},_initLayout:function(){var s="leaflet-popup",a=this._container=ke("div",s+" "+(this.options.className||"")+" leaflet-zoom-animated"),l=this._wrapper=ke("div",s+"-content-wrapper",a);if(this._contentNode=ke("div",s+"-content",l),fa(a),Ci(this._contentNode),pe(a,"contextmenu",sr),this._tipContainer=ke("div",s+"-tip-container",a),this._tip=ke("div",s+"-tip",this._tipContainer),this.options.closeButton){var m=this._closeButton=ke("a",s+"-close-button",a);m.setAttribute("role","button"),m.setAttribute("aria-label","Close popup"),m.href="#close",m.innerHTML='<span aria-hidden="true">&#215;</span>',pe(m,"click",function(v){et(v),this.close()},this)}},_updateLayout:function(){var s=this._contentNode,a=s.style;a.width="",a.whiteSpace="nowrap";var l=s.offsetWidth;l=Math.min(l,this.options.maxWidth),l=Math.max(l,this.options.minWidth),a.width=l+1+"px",a.whiteSpace="",a.height="";var m=s.offsetHeight,v=this.options.maxHeight,k="leaflet-popup-scrolled";v&&m>v?(a.height=v+"px",ge(s,k)):Be(s,k),this._containerWidth=this._container.offsetWidth},_animateZoom:function(s){var a=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center),l=this._getAnchor();He(this._container,a.add(l))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var s=this._map,a=parseInt(ha(this._container,"marginBottom"),10)||0,l=this._container.offsetHeight+a,m=this._containerWidth,v=new W(this._containerLeft,-l-this._containerBottom);v._add(tr(this._container));var k=s.layerPointToContainerPoint(v),D=q(this.options.autoPanPadding),B=q(this.options.autoPanPaddingTopLeft||D),H=q(this.options.autoPanPaddingBottomRight||D),G=s.getSize(),re=0,me=0;k.x+m+H.x>G.x&&(re=k.x+m-G.x+H.x),k.x-re-B.x<0&&(re=k.x-B.x),k.y+l+H.y>G.y&&(me=k.y+l-G.y+H.y),k.y-me-B.y<0&&(me=k.y-B.y),(re||me)&&(this.options.keepInView&&(this._autopanning=!0),s.fire("autopanstart").panBy([re,me]))}},_getAnchor:function(){return q(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),mm=function(s,a){return new hn(s,a)};Ne.mergeOptions({closePopupOnClick:!0}),Ne.include({openPopup:function(s,a,l){return this._initOverlay(hn,s,a,l).openOn(this),this},closePopup:function(s){return s=arguments.length?s:this._popup,s&&s.close(),this}}),Bt.include({bindPopup:function(s,a){return this._popup=this._initOverlay(hn,this._popup,s,a),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(s){return this._popup&&(this instanceof hs||(this._popup._source=this),this._popup._prepareOpen(s||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(s){return this._popup&&this._popup.setContent(s),this},getPopup:function(){return this._popup},_openPopup:function(s){if(!(!this._popup||!this._map)){rr(s);var a=s.layer||s.target;if(this._popup._source===a&&!(a instanceof Rs)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(s.latlng);return}this._popup._source=a,this.openPopup(s.latlng)}},_movePopup:function(s){this._popup.setLatLng(s.latlng)},_onKeyPress:function(s){s.originalEvent.keyCode===13&&this._openPopup(s)}});var mn=ss.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(s){ss.prototype.onAdd.call(this,s),this.setOpacity(this.options.opacity),s.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(s){ss.prototype.onRemove.call(this,s),s.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var s=ss.prototype.getEvents.call(this);return this.options.permanent||(s.preclick=this.close),s},_initLayout:function(){var s="leaflet-tooltip",a=s+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ke("div",a),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+u(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(s){var a,l,m=this._map,v=this._container,k=m.latLngToContainerPoint(m.getCenter()),D=m.layerPointToContainerPoint(s),B=this.options.direction,H=v.offsetWidth,G=v.offsetHeight,re=q(this.options.offset),me=this._getAnchor();B==="top"?(a=H/2,l=G):B==="bottom"?(a=H/2,l=0):B==="center"?(a=H/2,l=G/2):B==="right"?(a=0,l=G/2):B==="left"?(a=H,l=G/2):D.x<k.x?(B="right",a=0,l=G/2):(B="left",a=H+(re.x+me.x)*2,l=G/2),s=s.subtract(q(a,l,!0)).add(re).add(me),Be(v,"leaflet-tooltip-right"),Be(v,"leaflet-tooltip-left"),Be(v,"leaflet-tooltip-top"),Be(v,"leaflet-tooltip-bottom"),ge(v,"leaflet-tooltip-"+B),He(v,s)},_updatePosition:function(){var s=this._map.latLngToLayerPoint(this._latlng);this._setPosition(s)},setOpacity:function(s){this.options.opacity=s,this._container&&Pt(this._container,s)},_animateZoom:function(s){var a=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center);this._setPosition(a)},_getAnchor:function(){return q(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),xm=function(s,a){return new mn(s,a)};Ne.include({openTooltip:function(s,a,l){return this._initOverlay(mn,s,a,l).openOn(this),this},closeTooltip:function(s){return s.close(),this}}),Bt.include({bindTooltip:function(s,a){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(mn,this._tooltip,s,a),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(s){if(!(!s&&this._tooltipHandlersAdded)){var a=s?"off":"on",l={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?l.add=this._openTooltip:(l.mouseover=this._openTooltip,l.mouseout=this.closeTooltip,l.click=this._openTooltip,this._map?this._addFocusListeners():l.add=this._addFocusListeners),this._tooltip.options.sticky&&(l.mousemove=this._moveTooltip),this[a](l),this._tooltipHandlersAdded=!s}},openTooltip:function(s){return this._tooltip&&(this instanceof hs||(this._tooltip._source=this),this._tooltip._prepareOpen(s)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(s){return this._tooltip&&this._tooltip.setContent(s),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(s){var a=typeof s.getElement=="function"&&s.getElement();a&&(pe(a,"focus",function(){this._tooltip._source=s,this.openTooltip()},this),pe(a,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(s){var a=typeof s.getElement=="function"&&s.getElement();a&&a.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(s){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var a=this;this._map.once("moveend",function(){a._openOnceFlag=!1,a._openTooltip(s)});return}this._tooltip._source=s.layer||s.target,this.openTooltip(this._tooltip.options.sticky?s.latlng:void 0)}},_moveTooltip:function(s){var a=s.latlng,l,m;this._tooltip.options.sticky&&s.originalEvent&&(l=this._map.mouseEventToContainerPoint(s.originalEvent),m=this._map.containerPointToLayerPoint(l),a=this._map.layerPointToLatLng(m)),this._tooltip.setLatLng(a)}});var ql=Rr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(s){var a=s&&s.tagName==="DIV"?s:document.createElement("div"),l=this.options;if(l.html instanceof Element?(Ya(a),a.appendChild(l.html)):a.innerHTML=l.html!==!1?l.html:"",l.bgPos){var m=q(l.bgPos);a.style.backgroundPosition=-m.x+"px "+-m.y+"px"}return this._setIconStyles(a,"icon"),a},createShadow:function(){return null}});function pm(s){return new ql(s)}Rr.Default=ya;var va=Bt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:de.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(s){w(this,s)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(s){s._addZoomLimit(this)},onRemove:function(s){this._removeAllTiles(),De(this._container),s._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Tr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Lr(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(s){return this.options.opacity=s,this._updateOpacity(),this},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var s=this._clampZoom(this._map.getZoom());s!==this._tileZoom&&(this._tileZoom=s,this._updateLevels()),this._update()}return this},getEvents:function(){var s={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=x(this._onMoveEnd,this.options.updateInterval,this)),s.move=this._onMove),this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof W?s:new W(s,s)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(s){for(var a=this.getPane().children,l=-s(-1/0,1/0),m=0,v=a.length,k;m<v;m++)k=a[m].style.zIndex,a[m]!==this._container&&k&&(l=s(l,+k));isFinite(l)&&(this.options.zIndex=l+s(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!de.ielt9){Pt(this._container,this.options.opacity);var s=+new Date,a=!1,l=!1;for(var m in this._tiles){var v=this._tiles[m];if(!(!v.current||!v.loaded)){var k=Math.min(1,(s-v.loaded)/200);Pt(v.el,k),k<1?a=!0:(v.active?l=!0:this._onOpaqueTile(v),v.active=!0)}}l&&!this._noPrune&&this._pruneTiles(),a&&(F(this._fadeFrame),this._fadeFrame=I(this._updateOpacity,this))}},_onOpaqueTile:b,_initContainer:function(){this._container||(this._container=ke("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var s=this._tileZoom,a=this.options.maxZoom;if(s!==void 0){for(var l in this._levels)l=Number(l),this._levels[l].el.children.length||l===s?(this._levels[l].el.style.zIndex=a-Math.abs(s-l),this._onUpdateLevel(l)):(De(this._levels[l].el),this._removeTilesAtZoom(l),this._onRemoveLevel(l),delete this._levels[l]);var m=this._levels[s],v=this._map;return m||(m=this._levels[s]={},m.el=ke("div","leaflet-tile-container leaflet-zoom-animated",this._container),m.el.style.zIndex=a,m.origin=v.project(v.unproject(v.getPixelOrigin()),s).round(),m.zoom=s,this._setZoomTransform(m,v.getCenter(),v.getZoom()),b(m.el.offsetWidth),this._onCreateLevel(m)),this._level=m,m}},_onUpdateLevel:b,_onRemoveLevel:b,_onCreateLevel:b,_pruneTiles:function(){if(this._map){var s,a,l=this._map.getZoom();if(l>this.options.maxZoom||l<this.options.minZoom){this._removeAllTiles();return}for(s in this._tiles)a=this._tiles[s],a.retain=a.current;for(s in this._tiles)if(a=this._tiles[s],a.current&&!a.active){var m=a.coords;this._retainParent(m.x,m.y,m.z,m.z-5)||this._retainChildren(m.x,m.y,m.z,m.z+2)}for(s in this._tiles)this._tiles[s].retain||this._removeTile(s)}},_removeTilesAtZoom:function(s){for(var a in this._tiles)this._tiles[a].coords.z===s&&this._removeTile(a)},_removeAllTiles:function(){for(var s in this._tiles)this._removeTile(s)},_invalidateAll:function(){for(var s in this._levels)De(this._levels[s].el),this._onRemoveLevel(Number(s)),delete this._levels[s];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(s,a,l,m){var v=Math.floor(s/2),k=Math.floor(a/2),D=l-1,B=new W(+v,+k);B.z=+D;var H=this._tileCoordsToKey(B),G=this._tiles[H];return G&&G.active?(G.retain=!0,!0):(G&&G.loaded&&(G.retain=!0),D>m?this._retainParent(v,k,D,m):!1)},_retainChildren:function(s,a,l,m){for(var v=2*s;v<2*s+2;v++)for(var k=2*a;k<2*a+2;k++){var D=new W(v,k);D.z=l+1;var B=this._tileCoordsToKey(D),H=this._tiles[B];if(H&&H.active){H.retain=!0;continue}else H&&H.loaded&&(H.retain=!0);l+1<m&&this._retainChildren(v,k,l+1,m)}},_resetView:function(s){var a=s&&(s.pinch||s.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),a,a)},_animateZoom:function(s){this._setView(s.center,s.zoom,!0,s.noUpdate)},_clampZoom:function(s){var a=this.options;return a.minNativeZoom!==void 0&&s<a.minNativeZoom?a.minNativeZoom:a.maxNativeZoom!==void 0&&a.maxNativeZoom<s?a.maxNativeZoom:s},_setView:function(s,a,l,m){var v=Math.round(a);this.options.maxZoom!==void 0&&v>this.options.maxZoom||this.options.minZoom!==void 0&&v<this.options.minZoom?v=void 0:v=this._clampZoom(v);var k=this.options.updateWhenZooming&&v!==this._tileZoom;(!m||k)&&(this._tileZoom=v,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),v!==void 0&&this._update(s),l||this._pruneTiles(),this._noPrune=!!l),this._setZoomTransforms(s,a)},_setZoomTransforms:function(s,a){for(var l in this._levels)this._setZoomTransform(this._levels[l],s,a)},_setZoomTransform:function(s,a,l){var m=this._map.getZoomScale(l,s.zoom),v=s.origin.multiplyBy(m).subtract(this._map._getNewPixelOrigin(a,l)).round();de.any3d?er(s.el,v,m):He(s.el,v)},_resetGrid:function(){var s=this._map,a=s.options.crs,l=this._tileSize=this.getTileSize(),m=this._tileZoom,v=this._map.getPixelWorldBounds(this._tileZoom);v&&(this._globalTileRange=this._pxBoundsToTileRange(v)),this._wrapX=a.wrapLng&&!this.options.noWrap&&[Math.floor(s.project([0,a.wrapLng[0]],m).x/l.x),Math.ceil(s.project([0,a.wrapLng[1]],m).x/l.y)],this._wrapY=a.wrapLat&&!this.options.noWrap&&[Math.floor(s.project([a.wrapLat[0],0],m).y/l.x),Math.ceil(s.project([a.wrapLat[1],0],m).y/l.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(s){var a=this._map,l=a._animatingZoom?Math.max(a._animateToZoom,a.getZoom()):a.getZoom(),m=a.getZoomScale(l,this._tileZoom),v=a.project(s,this._tileZoom).floor(),k=a.getSize().divideBy(m*2);return new K(v.subtract(k),v.add(k))},_update:function(s){var a=this._map;if(a){var l=this._clampZoom(a.getZoom());if(s===void 0&&(s=a.getCenter()),this._tileZoom!==void 0){var m=this._getTiledPixelBounds(s),v=this._pxBoundsToTileRange(m),k=v.getCenter(),D=[],B=this.options.keepBuffer,H=new K(v.getBottomLeft().subtract([B,-B]),v.getTopRight().add([B,-B]));if(!(isFinite(v.min.x)&&isFinite(v.min.y)&&isFinite(v.max.x)&&isFinite(v.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var G in this._tiles){var re=this._tiles[G].coords;(re.z!==this._tileZoom||!H.contains(new W(re.x,re.y)))&&(this._tiles[G].current=!1)}if(Math.abs(l-this._tileZoom)>1){this._setView(s,l);return}for(var me=v.min.y;me<=v.max.y;me++)for(var ve=v.min.x;ve<=v.max.x;ve++){var ut=new W(ve,me);if(ut.z=this._tileZoom,!!this._isValidTile(ut)){var Qe=this._tiles[this._tileCoordsToKey(ut)];Qe?Qe.current=!0:D.push(ut)}}if(D.sort(function(gt,Or){return gt.distanceTo(k)-Or.distanceTo(k)}),D.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Lt=document.createDocumentFragment();for(ve=0;ve<D.length;ve++)this._addTile(D[ve],Lt);this._level.el.appendChild(Lt)}}}},_isValidTile:function(s){var a=this._map.options.crs;if(!a.infinite){var l=this._globalTileRange;if(!a.wrapLng&&(s.x<l.min.x||s.x>l.max.x)||!a.wrapLat&&(s.y<l.min.y||s.y>l.max.y))return!1}if(!this.options.bounds)return!0;var m=this._tileCoordsToBounds(s);return ae(this.options.bounds).overlaps(m)},_keyToBounds:function(s){return this._tileCoordsToBounds(this._keyToTileCoords(s))},_tileCoordsToNwSe:function(s){var a=this._map,l=this.getTileSize(),m=s.scaleBy(l),v=m.add(l),k=a.unproject(m,s.z),D=a.unproject(v,s.z);return[k,D]},_tileCoordsToBounds:function(s){var a=this._tileCoordsToNwSe(s),l=new V(a[0],a[1]);return this.options.noWrap||(l=this._map.wrapLatLngBounds(l)),l},_tileCoordsToKey:function(s){return s.x+":"+s.y+":"+s.z},_keyToTileCoords:function(s){var a=s.split(":"),l=new W(+a[0],+a[1]);return l.z=+a[2],l},_removeTile:function(s){var a=this._tiles[s];a&&(De(a.el),delete this._tiles[s],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(s)}))},_initTile:function(s){ge(s,"leaflet-tile");var a=this.getTileSize();s.style.width=a.x+"px",s.style.height=a.y+"px",s.onselectstart=b,s.onmousemove=b,de.ielt9&&this.options.opacity<1&&Pt(s,this.options.opacity)},_addTile:function(s,a){var l=this._getTilePos(s),m=this._tileCoordsToKey(s),v=this.createTile(this._wrapCoords(s),c(this._tileReady,this,s));this._initTile(v),this.createTile.length<2&&I(c(this._tileReady,this,s,null,v)),He(v,l),this._tiles[m]={el:v,coords:s,current:!0},a.appendChild(v),this.fire("tileloadstart",{tile:v,coords:s})},_tileReady:function(s,a,l){a&&this.fire("tileerror",{error:a,tile:l,coords:s});var m=this._tileCoordsToKey(s);l=this._tiles[m],l&&(l.loaded=+new Date,this._map._fadeAnimated?(Pt(l.el,0),F(this._fadeFrame),this._fadeFrame=I(this._updateOpacity,this)):(l.active=!0,this._pruneTiles()),a||(ge(l.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:l.el,coords:s})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),de.ielt9||!this._map._fadeAnimated?I(this._pruneTiles,this):setTimeout(c(this._pruneTiles,this),250)))},_getTilePos:function(s){return s.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(s){var a=new W(this._wrapX?p(s.x,this._wrapX):s.x,this._wrapY?p(s.y,this._wrapY):s.y);return a.z=s.z,a},_pxBoundsToTileRange:function(s){var a=this.getTileSize();return new K(s.min.unscaleBy(a).floor(),s.max.unscaleBy(a).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var s in this._tiles)if(!this._tiles[s].loaded)return!1;return!0}});function fm(s){return new va(s)}var Ar=va.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(s,a){this._url=s,a=w(this,a),a.detectRetina&&de.retina&&a.maxZoom>0?(a.tileSize=Math.floor(a.tileSize/2),a.zoomReverse?(a.zoomOffset--,a.minZoom=Math.min(a.maxZoom,a.minZoom+1)):(a.zoomOffset++,a.maxZoom=Math.max(a.minZoom,a.maxZoom-1)),a.minZoom=Math.max(0,a.minZoom)):a.zoomReverse?a.minZoom=Math.min(a.maxZoom,a.minZoom):a.maxZoom=Math.max(a.minZoom,a.maxZoom),typeof a.subdomains=="string"&&(a.subdomains=a.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(s,a){return this._url===s&&a===void 0&&(a=!0),this._url=s,a||this.redraw(),this},createTile:function(s,a){var l=document.createElement("img");return pe(l,"load",c(this._tileOnLoad,this,a,l)),pe(l,"error",c(this._tileOnError,this,a,l)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(l.referrerPolicy=this.options.referrerPolicy),l.alt="",l.src=this.getTileUrl(s),l},getTileUrl:function(s){var a={r:de.retina?"@2x":"",s:this._getSubdomain(s),x:s.x,y:s.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var l=this._globalTileRange.max.y-s.y;this.options.tms&&(a.y=l),a["-y"]=l}return S(this._url,o(a,this.options))},_tileOnLoad:function(s,a){de.ielt9?setTimeout(c(s,this,null,a),0):s(null,a)},_tileOnError:function(s,a,l){var m=this.options.errorTileUrl;m&&a.getAttribute("src")!==m&&(a.src=m),s(l,a)},_onTileRemove:function(s){s.tile.onload=null},_getZoomForUrl:function(){var s=this._tileZoom,a=this.options.maxZoom,l=this.options.zoomReverse,m=this.options.zoomOffset;return l&&(s=a-s),s+m},_getSubdomain:function(s){var a=Math.abs(s.x+s.y)%this.options.subdomains.length;return this.options.subdomains[a]},_abortLoading:function(){var s,a;for(s in this._tiles)if(this._tiles[s].coords.z!==this._tileZoom&&(a=this._tiles[s].el,a.onload=b,a.onerror=b,!a.complete)){a.src=P;var l=this._tiles[s].coords;De(a),delete this._tiles[s],this.fire("tileabort",{tile:a,coords:l})}},_removeTile:function(s){var a=this._tiles[s];if(a)return a.el.setAttribute("src",P),va.prototype._removeTile.call(this,s)},_tileReady:function(s,a,l){if(!(!this._map||l&&l.getAttribute("src")===P))return va.prototype._tileReady.call(this,s,a,l)}});function Gl(s,a){return new Ar(s,a)}var Kl=Ar.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(s,a){this._url=s;var l=o({},this.defaultWmsParams);for(var m in a)m in this.options||(l[m]=a[m]);a=w(this,a);var v=a.detectRetina&&de.retina?2:1,k=this.getTileSize();l.width=k.x*v,l.height=k.y*v,this.wmsParams=l},onAdd:function(s){this._crs=this.options.crs||s.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var a=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[a]=this._crs.code,Ar.prototype.onAdd.call(this,s)},getTileUrl:function(s){var a=this._tileCoordsToNwSe(s),l=this._crs,m=ce(l.project(a[0]),l.project(a[1])),v=m.min,k=m.max,D=(this._wmsVersion>=1.3&&this._crs===$l?[v.y,v.x,k.y,k.x]:[v.x,v.y,k.x,k.y]).join(","),B=Ar.prototype.getTileUrl.call(this,s);return B+j(this.wmsParams,B,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+D},setParams:function(s,a){return o(this.wmsParams,s),a||this.redraw(),this}});function gm(s,a){return new Kl(s,a)}Ar.WMS=Kl,Gl.wms=gm;var ps=Bt.extend({options:{padding:.1},initialize:function(s){w(this,s),u(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ge(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var s={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(s.zoomanim=this._onAnimZoom),s},_onAnimZoom:function(s){this._updateTransform(s.center,s.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(s,a){var l=this._map.getZoomScale(a,this._zoom),m=this._map.getSize().multiplyBy(.5+this.options.padding),v=this._map.project(this._center,a),k=m.multiplyBy(-l).add(v).subtract(this._map._getNewPixelOrigin(s,a));de.any3d?er(this._container,k,l):He(this._container,k)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var s in this._layers)this._layers[s]._reset()},_onZoomEnd:function(){for(var s in this._layers)this._layers[s]._project()},_updatePaths:function(){for(var s in this._layers)this._layers[s]._update()},_update:function(){var s=this.options.padding,a=this._map.getSize(),l=this._map.containerPointToLayerPoint(a.multiplyBy(-s)).round();this._bounds=new K(l,l.add(a.multiplyBy(1+s*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Jl=ps.extend({options:{tolerance:0},getEvents:function(){var s=ps.prototype.getEvents.call(this);return s.viewprereset=this._onViewPreReset,s},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ps.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var s=this._container=document.createElement("canvas");pe(s,"mousemove",this._onMouseMove,this),pe(s,"click dblclick mousedown mouseup contextmenu",this._onClick,this),pe(s,"mouseout",this._handleMouseOut,this),s._leaflet_disable_events=!0,this._ctx=s.getContext("2d")},_destroyContainer:function(){F(this._redrawRequest),delete this._ctx,De(this._container),Ee(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var s;this._redrawBounds=null;for(var a in this._layers)s=this._layers[a],s._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ps.prototype._update.call(this);var s=this._bounds,a=this._container,l=s.getSize(),m=de.retina?2:1;He(a,s.min),a.width=m*l.x,a.height=m*l.y,a.style.width=l.x+"px",a.style.height=l.y+"px",de.retina&&this._ctx.scale(2,2),this._ctx.translate(-s.min.x,-s.min.y),this.fire("update")}},_reset:function(){ps.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(s){this._updateDashArray(s),this._layers[u(s)]=s;var a=s._order={layer:s,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=a),this._drawLast=a,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(s){this._requestRedraw(s)},_removePath:function(s){var a=s._order,l=a.next,m=a.prev;l?l.prev=m:this._drawLast=m,m?m.next=l:this._drawFirst=l,delete s._order,delete this._layers[u(s)],this._requestRedraw(s)},_updatePath:function(s){this._extendRedrawBounds(s),s._project(),s._update(),this._requestRedraw(s)},_updateStyle:function(s){this._updateDashArray(s),this._requestRedraw(s)},_updateDashArray:function(s){if(typeof s.options.dashArray=="string"){var a=s.options.dashArray.split(/[, ]+/),l=[],m,v;for(v=0;v<a.length;v++){if(m=Number(a[v]),isNaN(m))return;l.push(m)}s.options._dashArray=l}else s.options._dashArray=s.options.dashArray},_requestRedraw:function(s){this._map&&(this._extendRedrawBounds(s),this._redrawRequest=this._redrawRequest||I(this._redraw,this))},_extendRedrawBounds:function(s){if(s._pxBounds){var a=(s.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new K,this._redrawBounds.extend(s._pxBounds.min.subtract([a,a])),this._redrawBounds.extend(s._pxBounds.max.add([a,a]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var s=this._redrawBounds;if(s){var a=s.getSize();this._ctx.clearRect(s.min.x,s.min.y,a.x,a.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var s,a=this._redrawBounds;if(this._ctx.save(),a){var l=a.getSize();this._ctx.beginPath(),this._ctx.rect(a.min.x,a.min.y,l.x,l.y),this._ctx.clip()}this._drawing=!0;for(var m=this._drawFirst;m;m=m.next)s=m.layer,(!a||s._pxBounds&&s._pxBounds.intersects(a))&&s._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(s,a){if(this._drawing){var l,m,v,k,D=s._parts,B=D.length,H=this._ctx;if(B){for(H.beginPath(),l=0;l<B;l++){for(m=0,v=D[l].length;m<v;m++)k=D[l][m],H[m?"lineTo":"moveTo"](k.x,k.y);a&&H.closePath()}this._fillStroke(H,s)}}},_updateCircle:function(s){if(!(!this._drawing||s._empty())){var a=s._point,l=this._ctx,m=Math.max(Math.round(s._radius),1),v=(Math.max(Math.round(s._radiusY),1)||m)/m;v!==1&&(l.save(),l.scale(1,v)),l.beginPath(),l.arc(a.x,a.y/v,m,0,Math.PI*2,!1),v!==1&&l.restore(),this._fillStroke(l,s)}},_fillStroke:function(s,a){var l=a.options;l.fill&&(s.globalAlpha=l.fillOpacity,s.fillStyle=l.fillColor||l.color,s.fill(l.fillRule||"evenodd")),l.stroke&&l.weight!==0&&(s.setLineDash&&s.setLineDash(a.options&&a.options._dashArray||[]),s.globalAlpha=l.opacity,s.lineWidth=l.weight,s.strokeStyle=l.color,s.lineCap=l.lineCap,s.lineJoin=l.lineJoin,s.stroke())},_onClick:function(s){for(var a=this._map.mouseEventToLayerPoint(s),l,m,v=this._drawFirst;v;v=v.next)l=v.layer,l.options.interactive&&l._containsPoint(a)&&(!(s.type==="click"||s.type==="preclick")||!this._map._draggableMoved(l))&&(m=l);this._fireEvent(m?[m]:!1,s)},_onMouseMove:function(s){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var a=this._map.mouseEventToLayerPoint(s);this._handleMouseHover(s,a)}},_handleMouseOut:function(s){var a=this._hoveredLayer;a&&(Be(this._container,"leaflet-interactive"),this._fireEvent([a],s,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(s,a){if(!this._mouseHoverThrottled){for(var l,m,v=this._drawFirst;v;v=v.next)l=v.layer,l.options.interactive&&l._containsPoint(a)&&(m=l);m!==this._hoveredLayer&&(this._handleMouseOut(s),m&&(ge(this._container,"leaflet-interactive"),this._fireEvent([m],s,"mouseover"),this._hoveredLayer=m)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,s),this._mouseHoverThrottled=!0,setTimeout(c(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(s,a,l){this._map._fireDOMEvent(a,l||a.type,s)},_bringToFront:function(s){var a=s._order;if(a){var l=a.next,m=a.prev;if(l)l.prev=m;else return;m?m.next=l:l&&(this._drawFirst=l),a.prev=this._drawLast,this._drawLast.next=a,a.next=null,this._drawLast=a,this._requestRedraw(s)}},_bringToBack:function(s){var a=s._order;if(a){var l=a.next,m=a.prev;if(m)m.next=l;else return;l?l.prev=m:m&&(this._drawLast=m),a.prev=null,a.next=this._drawFirst,this._drawFirst.prev=a,this._drawFirst=a,this._requestRedraw(s)}}});function Ql(s){return de.canvas?new Jl(s):null}var _a=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(s){return document.createElement("<lvml:"+s+' class="lvml">')}}catch{}return function(s){return document.createElement("<"+s+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),bm={_initContainer:function(){this._container=ke("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ps.prototype._update.call(this),this.fire("update"))},_initPath:function(s){var a=s._container=_a("shape");ge(a,"leaflet-vml-shape "+(this.options.className||"")),a.coordsize="1 1",s._path=_a("path"),a.appendChild(s._path),this._updateStyle(s),this._layers[u(s)]=s},_addPath:function(s){var a=s._container;this._container.appendChild(a),s.options.interactive&&s.addInteractiveTarget(a)},_removePath:function(s){var a=s._container;De(a),s.removeInteractiveTarget(a),delete this._layers[u(s)]},_updateStyle:function(s){var a=s._stroke,l=s._fill,m=s.options,v=s._container;v.stroked=!!m.stroke,v.filled=!!m.fill,m.stroke?(a||(a=s._stroke=_a("stroke")),v.appendChild(a),a.weight=m.weight+"px",a.color=m.color,a.opacity=m.opacity,m.dashArray?a.dashStyle=T(m.dashArray)?m.dashArray.join(" "):m.dashArray.replace(/( *, *)/g," "):a.dashStyle="",a.endcap=m.lineCap.replace("butt","flat"),a.joinstyle=m.lineJoin):a&&(v.removeChild(a),s._stroke=null),m.fill?(l||(l=s._fill=_a("fill")),v.appendChild(l),l.color=m.fillColor||m.color,l.opacity=m.fillOpacity):l&&(v.removeChild(l),s._fill=null)},_updateCircle:function(s){var a=s._point.round(),l=Math.round(s._radius),m=Math.round(s._radiusY||l);this._setPath(s,s._empty()?"M0 0":"AL "+a.x+","+a.y+" "+l+","+m+" 0,"+65535*360)},_setPath:function(s,a){s._path.v=a},_bringToFront:function(s){Tr(s._container)},_bringToBack:function(s){Lr(s._container)}},xn=de.vml?_a:Q,ja=ps.extend({_initContainer:function(){this._container=xn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=xn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){De(this._container),Ee(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ps.prototype._update.call(this);var s=this._bounds,a=s.getSize(),l=this._container;(!this._svgSize||!this._svgSize.equals(a))&&(this._svgSize=a,l.setAttribute("width",a.x),l.setAttribute("height",a.y)),He(l,s.min),l.setAttribute("viewBox",[s.min.x,s.min.y,a.x,a.y].join(" ")),this.fire("update")}},_initPath:function(s){var a=s._path=xn("path");s.options.className&&ge(a,s.options.className),s.options.interactive&&ge(a,"leaflet-interactive"),this._updateStyle(s),this._layers[u(s)]=s},_addPath:function(s){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(s._path),s.addInteractiveTarget(s._path)},_removePath:function(s){De(s._path),s.removeInteractiveTarget(s._path),delete this._layers[u(s)]},_updatePath:function(s){s._project(),s._update()},_updateStyle:function(s){var a=s._path,l=s.options;a&&(l.stroke?(a.setAttribute("stroke",l.color),a.setAttribute("stroke-opacity",l.opacity),a.setAttribute("stroke-width",l.weight),a.setAttribute("stroke-linecap",l.lineCap),a.setAttribute("stroke-linejoin",l.lineJoin),l.dashArray?a.setAttribute("stroke-dasharray",l.dashArray):a.removeAttribute("stroke-dasharray"),l.dashOffset?a.setAttribute("stroke-dashoffset",l.dashOffset):a.removeAttribute("stroke-dashoffset")):a.setAttribute("stroke","none"),l.fill?(a.setAttribute("fill",l.fillColor||l.color),a.setAttribute("fill-opacity",l.fillOpacity),a.setAttribute("fill-rule",l.fillRule||"evenodd")):a.setAttribute("fill","none"))},_updatePoly:function(s,a){this._setPath(s,be(s._parts,a))},_updateCircle:function(s){var a=s._point,l=Math.max(Math.round(s._radius),1),m=Math.max(Math.round(s._radiusY),1)||l,v="a"+l+","+m+" 0 1,0 ",k=s._empty()?"M0 0":"M"+(a.x-l)+","+a.y+v+l*2+",0 "+v+-l*2+",0 ";this._setPath(s,k)},_setPath:function(s,a){s._path.setAttribute("d",a)},_bringToFront:function(s){Tr(s._path)},_bringToBack:function(s){Lr(s._path)}});de.vml&&ja.include(bm);function Yl(s){return de.svg||de.vml?new ja(s):null}Ne.include({getRenderer:function(s){var a=s.options.renderer||this._getPaneRenderer(s.options.pane)||this.options.renderer||this._renderer;return a||(a=this._renderer=this._createRenderer()),this.hasLayer(a)||this.addLayer(a),a},_getPaneRenderer:function(s){if(s==="overlayPane"||s===void 0)return!1;var a=this._paneRenderers[s];return a===void 0&&(a=this._createRenderer({pane:s}),this._paneRenderers[s]=a),a},_createRenderer:function(s){return this.options.preferCanvas&&Ql(s)||Yl(s)}});var Xl=Mr.extend({initialize:function(s,a){Mr.prototype.initialize.call(this,this._boundsToLatLngs(s),a)},setBounds:function(s){return this.setLatLngs(this._boundsToLatLngs(s))},_boundsToLatLngs:function(s){return s=ae(s),[s.getSouthWest(),s.getNorthWest(),s.getNorthEast(),s.getSouthEast()]}});function ym(s,a){return new Xl(s,a)}ja.create=xn,ja.pointsToPath=be,xs.geometryToLayer=on,xs.coordsToLatLng=Ai,xs.coordsToLatLngs=ln,xs.latLngToCoords=Oi,xs.latLngsToCoords=dn,xs.getFeature=Dr,xs.asFeature=cn,Ne.mergeOptions({boxZoom:!0});var ed=ts.extend({initialize:function(s){this._map=s,this._container=s._container,this._pane=s._panes.overlayPane,this._resetStateTimeout=0,s.on("unload",this._destroy,this)},addHooks:function(){pe(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ee(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){De(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(s){if(!s.shiftKey||s.which!==1&&s.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ma(),bi(),this._startPoint=this._map.mouseEventToContainerPoint(s),pe(document,{contextmenu:rr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(s){this._moved||(this._moved=!0,this._box=ke("div","leaflet-zoom-box",this._container),ge(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(s);var a=new K(this._point,this._startPoint),l=a.getSize();He(this._box,a.min),this._box.style.width=l.x+"px",this._box.style.height=l.y+"px"},_finish:function(){this._moved&&(De(this._box),Be(this._container,"leaflet-crosshair")),xa(),yi(),Ee(document,{contextmenu:rr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(s){if(!(s.which!==1&&s.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(c(this._resetState,this),0);var a=new V(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(a).fire("boxzoomend",{boxZoomBounds:a})}},_onKeyDown:function(s){s.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ne.addInitHook("addHandler","boxZoom",ed),Ne.mergeOptions({doubleClickZoom:!0});var td=ts.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(s){var a=this._map,l=a.getZoom(),m=a.options.zoomDelta,v=s.originalEvent.shiftKey?l-m:l+m;a.options.doubleClickZoom==="center"?a.setZoom(v):a.setZoomAround(s.containerPoint,v)}});Ne.addInitHook("addHandler","doubleClickZoom",td),Ne.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var sd=ts.extend({addHooks:function(){if(!this._draggable){var s=this._map;this._draggable=new Es(s._mapPane,s._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),s.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),s.on("zoomend",this._onZoomEnd,this),s.whenReady(this._onZoomEnd,this))}ge(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Be(this._map._container,"leaflet-grab"),Be(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var s=this._map;if(s._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var a=ae(this._map.options.maxBounds);this._offsetLimit=ce(this._map.latLngToContainerPoint(a.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(a.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;s.fire("movestart").fire("dragstart"),s.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(s){if(this._map.options.inertia){var a=this._lastTime=+new Date,l=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(l),this._times.push(a),this._prunePositions(a)}this._map.fire("move",s).fire("drag",s)},_prunePositions:function(s){for(;this._positions.length>1&&s-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var s=this._map.getSize().divideBy(2),a=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=a.subtract(s).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(s,a){return s-(s-a)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var s=this._draggable._newPos.subtract(this._draggable._startPos),a=this._offsetLimit;s.x<a.min.x&&(s.x=this._viscousLimit(s.x,a.min.x)),s.y<a.min.y&&(s.y=this._viscousLimit(s.y,a.min.y)),s.x>a.max.x&&(s.x=this._viscousLimit(s.x,a.max.x)),s.y>a.max.y&&(s.y=this._viscousLimit(s.y,a.max.y)),this._draggable._newPos=this._draggable._startPos.add(s)}},_onPreDragWrap:function(){var s=this._worldWidth,a=Math.round(s/2),l=this._initialWorldOffset,m=this._draggable._newPos.x,v=(m-a+l)%s+a-l,k=(m+a+l)%s-a-l,D=Math.abs(v+l)<Math.abs(k+l)?v:k;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=D},_onDragEnd:function(s){var a=this._map,l=a.options,m=!l.inertia||s.noInertia||this._times.length<2;if(a.fire("dragend",s),m)a.fire("moveend");else{this._prunePositions(+new Date);var v=this._lastPos.subtract(this._positions[0]),k=(this._lastTime-this._times[0])/1e3,D=l.easeLinearity,B=v.multiplyBy(D/k),H=B.distanceTo([0,0]),G=Math.min(l.inertiaMaxSpeed,H),re=B.multiplyBy(G/H),me=G/(l.inertiaDeceleration*D),ve=re.multiplyBy(-me/2).round();!ve.x&&!ve.y?a.fire("moveend"):(ve=a._limitOffset(ve,a.options.maxBounds),I(function(){a.panBy(ve,{duration:me,easeLinearity:D,noMoveStart:!0,animate:!0})}))}}});Ne.addInitHook("addHandler","dragging",sd),Ne.mergeOptions({keyboard:!0,keyboardPanDelta:80});var rd=ts.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(s){this._map=s,this._setPanDelta(s.options.keyboardPanDelta),this._setZoomDelta(s.options.zoomDelta)},addHooks:function(){var s=this._map._container;s.tabIndex<=0&&(s.tabIndex="0"),pe(s,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ee(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var s=document.body,a=document.documentElement,l=s.scrollTop||a.scrollTop,m=s.scrollLeft||a.scrollLeft;this._map._container.focus(),window.scrollTo(m,l)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(s){var a=this._panKeys={},l=this.keyCodes,m,v;for(m=0,v=l.left.length;m<v;m++)a[l.left[m]]=[-1*s,0];for(m=0,v=l.right.length;m<v;m++)a[l.right[m]]=[s,0];for(m=0,v=l.down.length;m<v;m++)a[l.down[m]]=[0,s];for(m=0,v=l.up.length;m<v;m++)a[l.up[m]]=[0,-1*s]},_setZoomDelta:function(s){var a=this._zoomKeys={},l=this.keyCodes,m,v;for(m=0,v=l.zoomIn.length;m<v;m++)a[l.zoomIn[m]]=s;for(m=0,v=l.zoomOut.length;m<v;m++)a[l.zoomOut[m]]=-s},_addHooks:function(){pe(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ee(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){var a=s.keyCode,l=this._map,m;if(a in this._panKeys){if(!l._panAnim||!l._panAnim._inProgress)if(m=this._panKeys[a],s.shiftKey&&(m=q(m).multiplyBy(3)),l.options.maxBounds&&(m=l._limitOffset(q(m),l.options.maxBounds)),l.options.worldCopyJump){var v=l.wrapLatLng(l.unproject(l.project(l.getCenter()).add(m)));l.panTo(v)}else l.panBy(m)}else if(a in this._zoomKeys)l.setZoom(l.getZoom()+(s.shiftKey?3:1)*this._zoomKeys[a]);else if(a===27&&l._popup&&l._popup.options.closeOnEscapeKey)l.closePopup();else return;rr(s)}}});Ne.addInitHook("addHandler","keyboard",rd),Ne.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ad=ts.extend({addHooks:function(){pe(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ee(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(s){var a=Pl(s),l=this._map.options.wheelDebounceTime;this._delta+=a,this._lastMousePos=this._map.mouseEventToContainerPoint(s),this._startTime||(this._startTime=+new Date);var m=Math.max(l-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(c(this._performZoom,this),m),rr(s)},_performZoom:function(){var s=this._map,a=s.getZoom(),l=this._map.options.zoomSnap||0;s._stop();var m=this._delta/(this._map.options.wheelPxPerZoomLevel*4),v=4*Math.log(2/(1+Math.exp(-Math.abs(m))))/Math.LN2,k=l?Math.ceil(v/l)*l:v,D=s._limitZoom(a+(this._delta>0?k:-k))-a;this._delta=0,this._startTime=null,D&&(s.options.scrollWheelZoom==="center"?s.setZoom(a+D):s.setZoomAround(this._lastMousePos,a+D))}});Ne.addInitHook("addHandler","scrollWheelZoom",ad);var vm=600;Ne.mergeOptions({tapHold:de.touchNative&&de.safari&&de.mobile,tapTolerance:15});var nd=ts.extend({addHooks:function(){pe(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ee(this._map._container,"touchstart",this._onDown,this)},_onDown:function(s){if(clearTimeout(this._holdTimeout),s.touches.length===1){var a=s.touches[0];this._startPos=this._newPos=new W(a.clientX,a.clientY),this._holdTimeout=setTimeout(c(function(){this._cancel(),this._isTapValid()&&(pe(document,"touchend",et),pe(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",a))},this),vm),pe(document,"touchend touchcancel contextmenu",this._cancel,this),pe(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function s(){Ee(document,"touchend",et),Ee(document,"touchend touchcancel",s)},_cancel:function(){clearTimeout(this._holdTimeout),Ee(document,"touchend touchcancel contextmenu",this._cancel,this),Ee(document,"touchmove",this._onMove,this)},_onMove:function(s){var a=s.touches[0];this._newPos=new W(a.clientX,a.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(s,a){var l=new MouseEvent(s,{bubbles:!0,cancelable:!0,view:window,screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY});l._simulated=!0,a.target.dispatchEvent(l)}});Ne.addInitHook("addHandler","tapHold",nd),Ne.mergeOptions({touchZoom:de.touch,bounceAtZoomLimits:!0});var id=ts.extend({addHooks:function(){ge(this._map._container,"leaflet-touch-zoom"),pe(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Be(this._map._container,"leaflet-touch-zoom"),Ee(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(s){var a=this._map;if(!(!s.touches||s.touches.length!==2||a._animatingZoom||this._zooming)){var l=a.mouseEventToContainerPoint(s.touches[0]),m=a.mouseEventToContainerPoint(s.touches[1]);this._centerPoint=a.getSize()._divideBy(2),this._startLatLng=a.containerPointToLatLng(this._centerPoint),a.options.touchZoom!=="center"&&(this._pinchStartLatLng=a.containerPointToLatLng(l.add(m)._divideBy(2))),this._startDist=l.distanceTo(m),this._startZoom=a.getZoom(),this._moved=!1,this._zooming=!0,a._stop(),pe(document,"touchmove",this._onTouchMove,this),pe(document,"touchend touchcancel",this._onTouchEnd,this),et(s)}},_onTouchMove:function(s){if(!(!s.touches||s.touches.length!==2||!this._zooming)){var a=this._map,l=a.mouseEventToContainerPoint(s.touches[0]),m=a.mouseEventToContainerPoint(s.touches[1]),v=l.distanceTo(m)/this._startDist;if(this._zoom=a.getScaleZoom(v,this._startZoom),!a.options.bounceAtZoomLimits&&(this._zoom<a.getMinZoom()&&v<1||this._zoom>a.getMaxZoom()&&v>1)&&(this._zoom=a._limitZoom(this._zoom)),a.options.touchZoom==="center"){if(this._center=this._startLatLng,v===1)return}else{var k=l._add(m)._divideBy(2)._subtract(this._centerPoint);if(v===1&&k.x===0&&k.y===0)return;this._center=a.unproject(a.project(this._pinchStartLatLng,this._zoom).subtract(k),this._zoom)}this._moved||(a._moveStart(!0,!1),this._moved=!0),F(this._animRequest);var D=c(a._move,a,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=I(D,this,!0),et(s)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,F(this._animRequest),Ee(document,"touchmove",this._onTouchMove,this),Ee(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ne.addInitHook("addHandler","touchZoom",id),Ne.BoxZoom=ed,Ne.DoubleClickZoom=td,Ne.Drag=sd,Ne.Keyboard=rd,Ne.ScrollWheelZoom=ad,Ne.TapHold=nd,Ne.TouchZoom=id,n.Bounds=K,n.Browser=de,n.CRS=le,n.Canvas=Jl,n.Circle=Di,n.CircleMarker=nn,n.Class=J,n.Control=Ft,n.DivIcon=ql,n.DivOverlay=ss,n.DomEvent=zh,n.DomUtil=Oh,n.Draggable=Es,n.Evented=Y,n.FeatureGroup=hs,n.GeoJSON=xs,n.GridLayer=va,n.Handler=ts,n.Icon=Rr,n.ImageOverlay=un,n.LatLng=ie,n.LatLngBounds=V,n.Layer=Bt,n.LayerGroup=Er,n.LineUtil=Qh,n.Map=Ne,n.Marker=an,n.Mixin=Wh,n.Path=Rs,n.Point=W,n.PolyUtil=Vh,n.Polygon=Mr,n.Polyline=ms,n.Popup=hn,n.PosAnimation=Tl,n.Projection=Yh,n.Rectangle=Xl,n.Renderer=ps,n.SVG=ja,n.SVGOverlay=Vl,n.TileLayer=Ar,n.Tooltip=mn,n.Transformation=Qt,n.Util=$,n.VideoOverlay=Wl,n.bind=c,n.bounds=ce,n.canvas=Ql,n.circle=im,n.circleMarker=nm,n.control=ga,n.divIcon=pm,n.extend=o,n.featureGroup=sm,n.geoJSON=Ul,n.geoJson=dm,n.gridLayer=fm,n.icon=rm,n.imageOverlay=cm,n.latLng=se,n.latLngBounds=ae,n.layerGroup=tm,n.map=Fh,n.marker=am,n.point=q,n.polygon=lm,n.polyline=om,n.popup=mm,n.rectangle=ym,n.setOptions=w,n.stamp=u,n.svg=Yl,n.svgOverlay=hm,n.tileLayer=Gl,n.tooltip=xm,n.transformation=dt,n.version=i,n.videoOverlay=um;var _m=window.L;n.noConflict=function(){return window.L=_m,this},window.L=n})})(bo,bo.exports);var ri=bo.exports;function Xo(t,r,n){return Object.freeze({instance:t,context:r,container:n})}function el(t,r){return r==null?function(i,o){const d=f.useRef();return d.current||(d.current=t(i,o)),d}:function(i,o){const d=f.useRef();d.current||(d.current=t(i,o));const c=f.useRef(i),{instance:h}=d.current;return f.useEffect(function(){c.current!==i&&(r(h,i,c.current),c.current=i)},[h,i,o]),d}}function yu(t,r){f.useEffect(function(){return(r.layerContainer??r.map).addLayer(t.instance),function(){var d;(d=r.layerContainer)==null||d.removeLayer(t.instance),r.map.removeLayer(t.instance)}},[r,t])}function l0(t){return function(n){const i=Qo(),o=t(si(n,i),i);return fu(i.map,n.attribution),Yo(o.current,n.eventHandlers),yu(o.current,i),o}}function d0(t,r){const n=f.useRef();f.useEffect(function(){if(r.pathOptions!==n.current){const o=r.pathOptions??{};t.instance.setStyle(o),n.current=o}},[t,r])}function c0(t){return function(n){const i=Qo(),o=t(si(n,i),i);return Yo(o.current,n.eventHandlers),yu(o.current,i),d0(o.current,n),o}}function u0(t,r){const n=el(t),i=o0(n,r);return n0(i)}function h0(t,r){const n=el(t,r),i=c0(n);return a0(i)}function m0(t,r){const n=el(t,r),i=l0(n);return i0(i)}function x0(t,r,n){const{opacity:i,zIndex:o}=r;i!=null&&i!==n.opacity&&t.setOpacity(i),o!=null&&o!==n.zIndex&&t.setZIndex(o)}const p0=h0(function({center:r,children:n,...i},o){const d=new ri.CircleMarker(r,i);return Xo(d,r0(o,{overlayContainer:d}))},e0);function yo(){return yo=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},yo.apply(this,arguments)}function f0({bounds:t,boundsOptions:r,center:n,children:i,className:o,id:d,placeholder:c,style:h,whenReady:u,zoom:x,...p},b){const[g]=f.useState({className:o,id:d,style:h}),[y,_]=f.useState(null);f.useImperativeHandle(b,()=>(y==null?void 0:y.map)??null,[y]);const w=f.useCallback(C=>{if(C!==null&&y===null){const S=new ri.Map(C,p);n!=null&&x!=null?S.setView(n,x):t!=null&&S.fitBounds(t,r),u!=null&&S.whenReady(u),_(s0(S))}},[]);f.useEffect(()=>()=>{y==null||y.map.remove()},[y]);const j=y?pt.createElement(bu,{value:y},i):c??null;return pt.createElement("div",yo({},g,{ref:w}),j)}const g0=f.forwardRef(f0),b0=u0(function(r,n){const i=new ri.Popup(r,n.overlayContainer);return Xo(i,n)},function(r,n,{position:i},o){f.useEffect(function(){const{instance:c}=r;function h(x){x.popup===c&&(c.update(),o(!0))}function u(x){x.popup===c&&o(!1)}return n.map.on({popupopen:h,popupclose:u}),n.overlayContainer==null?(i!=null&&c.setLatLng(i),c.openOn(n.map)):n.overlayContainer.bindPopup(c),function(){var p;n.map.off({popupopen:h,popupclose:u}),(p=n.overlayContainer)==null||p.unbindPopup(),n.map.removeLayer(c)}},[r,n,o,i])}),y0=m0(function({url:r,...n},i){const o=new ri.TileLayer(r,si(n,i));return Xo(o,i)},function(r,n,i){x0(r,n,i);const{url:o}=n;o!=null&&o!==i.url&&r.setUrl(o)}),Fn=["#8884d8","#82ca9d","#ffc658","#ff7300","#0088fe","#00C49F","#FFBB28","#FF8042","#a4de6c","#d0ed57"],v0=({profile:t})=>e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Rc,{className:"w-5 h-5 mr-2 text-blue-500"}),"Geospatial Analysis",e.jsx(ot,{text:"Visualizes data points on a map based on detected Latitude/Longitude columns. Colors indicate target values."})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Detected columns: ",e.jsx("span",{className:"font-mono bg-gray-100 dark:bg-gray-900 px-1 rounded",children:t.geospatial.lat_col}),", ",e.jsx("span",{className:"font-mono bg-gray-100 dark:bg-gray-900 px-1 rounded",children:t.geospatial.lon_col})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 h-96 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 relative z-0",children:(()=>{const r=[[t.geospatial.min_lat,t.geospatial.min_lon],[t.geospatial.max_lat,t.geospatial.max_lon]],n=Array.from(new Set(t.geospatial.sample_points.map(d=>d.label))).filter(Boolean),i=n.length>20,o=d=>{if(!d||i)return"#3b82f6";const c=n.indexOf(d);return Fn[c%Fn.length]};return e.jsxs(g0,{bounds:r,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,children:[e.jsx(y0,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),t.geospatial.sample_points.map((d,c)=>e.jsx(p0,{center:[d.lat,d.lon],radius:5,pathOptions:{color:o(d.label),fillColor:o(d.label),fillOpacity:.7,weight:1},children:e.jsx(b0,{children:e.jsxs("div",{className:"text-xs",children:[e.jsx("strong",{children:"Lat:"})," ",d.lat.toFixed(4),e.jsx("br",{}),e.jsx("strong",{children:"Lon:"})," ",d.lon.toFixed(4),e.jsx("br",{}),d.label&&e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[t.target_col,":"]})," ",d.label]})]})})},c))]})})()}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-3",children:"Spatial Bounds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-gray-400",children:"Latitude Range"}),e.jsxs("span",{className:"font-mono",children:[t.geospatial.min_lat.toFixed(4)," to ",t.geospatial.max_lat.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-gray-400",children:"Longitude Range"}),e.jsxs("span",{className:"font-mono",children:[t.geospatial.min_lon.toFixed(4)," to ",t.geospatial.max_lon.toFixed(4)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-3",children:"Centroid"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsxs("span",{className:"font-mono text-sm",children:[t.geospatial.centroid_lat.toFixed(4),", ",t.geospatial.centroid_lon.toFixed(4)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-100 dark:border-blue-800",children:[e.jsx(Kt,{className:"w-4 h-4 text-blue-500 mt-0.5 shrink-0"}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:e.jsxs("p",{children:["This scatter plot shows the spatial distribution of your data.",t.target_col&&" Points are colored by the target variable."]})})]})]})]})]}),_0=({profile:t,downloadChart:r,history:n,loading:i,loadSpecificReport:o,report:d})=>{var h;const c=async()=>{if(!(t!=null&&t.target_interactions))return;const u=t.target_interactions,x=400,p=800,b=40,g=2,y=Math.ceil(u.length/g),_=g*p+(g+1)*b,w=y*(x+b)+100,j=document.createElement("canvas");j.width=_,j.height=w;const C=j.getContext("2d");if(!C)return;const S=document.documentElement.classList.contains("dark"),T=S?"#1f2937":"#ffffff",E=S?"#ffffff":"#111827",P=S?"#9ca3af":"#4b5563";C.fillStyle=T,C.fillRect(0,0,j.width,j.height),C.fillStyle=E,C.font="bold 24px sans-serif",C.textAlign="center",C.fillText("Detailed Interactions (Box Plots)",_/2,50);for(let R=0;R<u.length;R++){const N=u[R],M=`interaction-chart-${R}`,z=document.getElementById(M);if(!z)continue;const I=z.querySelector("svg");if(!I)continue;const F=Math.floor(R/g),$=R%g,J=b+$*(p+b),ee=100+F*(x+b);C.fillStyle=P,C.font="bold 16px sans-serif",C.textAlign="left",C.fillText(`${N.feature} vs ${t.target_col}`,J+40,ee),N.p_value!==void 0&&(C.font="14px sans-serif",C.fillStyle=N.p_value<.05?"#059669":P,C.fillText(`ANOVA p: ${Number(N.p_value).toExponential(2)}`,J+40,ee+20));const Y=new XMLSerializer().serializeToString(I),W=new Image,U=new Blob([Y],{type:"image/svg+xml;charset=utf-8"}),q=URL.createObjectURL(U);await new Promise(K=>{W.onload=()=>{C.drawImage(W,J,ee+30,p,x-50),URL.revokeObjectURL(q),K()},W.src=q})}const A=document.createElement("a");A.download="all-interactions.png",A.href=j.toDataURL("image/png"),A.click()};return e.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(ks,{className:"w-5 h-5 mr-2 text-blue-500"}),"Target Analysis: ",e.jsx("span",{className:"ml-2 text-blue-600",children:t.target_col}),e.jsx(ot,{text:"Analyzes relationships between the target variable and other features. Shows top correlations and key drivers."})]}),e.jsx("button",{onClick:()=>r("target-analysis-chart","target-analysis",`Target Analysis: ${t.target_col}`,"Top Associated Features"),className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download Chart",children:e.jsx(wt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Top Associated Features"}),e.jsx("div",{className:"h-64 w-full",id:"target-analysis-chart",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:Object.entries(t.target_correlations).slice(0,10).map(([u,x])=>({name:u,value:x})),layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(vt,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(_t,{type:"number",domain:[0,1]}),e.jsx(jt,{type:"category",dataKey:"name",width:120,tick:{fontSize:12}}),e.jsx(it,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},itemStyle:{color:"#fff"},formatter:u=>[u.toFixed(3),"Association"]}),e.jsx(Lo,{x:0,stroke:"#9ca3af"}),e.jsx(Mt,{dataKey:"value",fill:"#3b82f6",radius:[0,4,4,0],barSize:20})]})})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Key Insights"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 text-blue-500",children:""}),e.jsxs("span",{children:["Target is ",e.jsx("strong",{children:(h=t.columns[t.target_col])==null?void 0:h.dtype})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 text-blue-500",children:""}),e.jsxs("span",{children:["Strongest predictor: ",e.jsx("strong",{children:Object.keys(t.target_correlations)[0]||"None"}),Object.values(t.target_correlations)[0]!==void 0&&e.jsxs(e.Fragment,{children:[" (",Object.values(t.target_correlations)[0].toFixed(2),")"]})]})]})]})]})]})]}),t.target_interactions&&t.target_interactions.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Jn,{className:"w-5 h-5 mr-2 text-purple-500"}),"Detailed Interactions (Box Plots)",e.jsx(ot,{text:"Shows distribution of values across categories. The box represents the middle 50% of data (Q1 to Q3). The line inside is the median."})]}),e.jsx("button",{onClick:c,className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download All Charts",children:e.jsx(wt,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:[e.jsx("span",{className:"font-semibold",children:"ANOVA Analysis:"})," A p-value < 0.05 (highlighted in green) indicates that the feature varies significantly across the target categories, making it a strong predictor."]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.target_interactions.map((u,x)=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800 relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-100",children:e.jsx("button",{onClick:()=>r(`interaction-chart-${x}`,`interaction-${u.feature}`,`${u.feature} vs ${t.target_col}`,u.p_value!==void 0?`ANOVA p: ${Number(u.p_value).toExponential(2)}`:void 0),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(wt,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[u.feature," vs ",t.target_col]}),u.p_value!==void 0&&u.p_value!==null&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full inline-block mt-1 ${u.p_value<.05?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400"}`,children:["ANOVA p: ",Number(u.p_value).toExponential(2)]})]}),e.jsx("div",{className:"h-64 w-full",id:`interaction-chart-${x}`,children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(Bm,{data:u.data.map(p=>({...p,boxBottom:p.stats.q1,boxHeight:p.stats.q3-p.stats.q1})),margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(vt,{strokeDasharray:"3 3",vertical:!1}),e.jsx(_t,{dataKey:"name",tick:{fontSize:11}}),e.jsx(jt,{domain:["auto","auto"],tick:{fontSize:11}}),e.jsx(it,{cursor:{fill:"transparent"},content:({active:p,payload:b})=>{if(p&&b&&b.length){const g=b[0].payload;return e.jsxs("div",{className:"bg-gray-800 text-white text-xs p-2 rounded shadow-lg z-50",children:[e.jsx("p",{className:"font-semibold mb-1",children:g.name}),e.jsxs("p",{children:["Max: ",g.stats.max.toFixed(2)]}),e.jsxs("p",{children:["Q3: ",g.stats.q3.toFixed(2)]}),e.jsxs("p",{children:["Median: ",g.stats.median.toFixed(2)]}),e.jsxs("p",{children:["Q1: ",g.stats.q1.toFixed(2)]}),e.jsxs("p",{children:["Min: ",g.stats.min.toFixed(2)]})]})}return null}}),e.jsx(Mt,{dataKey:"boxBottom",stackId:"a",fill:"transparent",legendType:"none"}),e.jsx(Mt,{dataKey:"boxHeight",stackId:"a",fill:"#8884d8",fillOpacity:.6,name:"IQR (Q1-Q3)"}),e.jsx(La,{name:"Median",dataKey:"stats.median",fill:"#ff7300",shape:"square"}),e.jsx(La,{name:"Max",dataKey:"stats.max",fill:"#82ca9d",shape:"cross"}),e.jsx(La,{name:"Min",dataKey:"stats.min",fill:"#82ca9d",shape:"cross"})]})})}),e.jsx("p",{className:"text-xs text-center text-gray-400 mt-2",children:"* Box: Q1-Q3. Orange square: Median. Green crosses: Min/Max."})]},x))})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm h-fit sticky top-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ht,{className:"w-4 h-4 mr-2"}),"Analysis History"]}),i&&e.jsx(Xe,{className:"w-3 h-3 animate-spin text-blue-500"})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:n.length===0?e.jsx("p",{className:"text-xs text-gray-500 italic",children:"No previous analyses found."}):n.slice(0,10).map(u=>e.jsxs("button",{onClick:()=>!i&&o(u.id),disabled:i,className:`w-full text-left p-3 rounded-md text-sm border transition-colors ${d&&d.id===u.id?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300":"bg-gray-50 border-gray-100 text-gray-600 hover:bg-gray-100 dark:bg-gray-900 dark:border-gray-800 dark:text-gray-400 dark:hover:bg-gray-800"} ${i?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"font-medium truncate",children:u.target_col?`Target: ${u.target_col}`:"General Analysis"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:new Date(u.created_at).toLocaleString()}),e.jsx("div",{className:`text-xs mt-1 inline-block px-1.5 py-0.5 rounded ${u.status==="COMPLETED"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":u.status==="FAILED"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:u.status})]},u.id))})]})})]})},j0=({profile:t,downloadChart:r})=>{var n,i;return e.jsxs("div",{className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(yr,{className:"w-5 h-5 mr-2 text-blue-500"}),"Trend Analysis (",t.timeseries.date_col,")",e.jsx(ot,{text:"Shows how values change over time. Look for long-term trends (up/down) or sudden shifts."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.timeseries.stationarity_test&&e.jsxs("div",{className:`text-xs px-3 py-1 rounded-full border flex items-center gap-1 ${t.timeseries.stationarity_test.is_stationary?"bg-green-50 border-green-200 text-green-700 dark:bg-green-900/20 dark:border-green-800 dark:text-green-300":"bg-yellow-50 border-yellow-200 text-yellow-700 dark:bg-yellow-900/20 dark:border-yellow-800 dark:text-yellow-300"}`,children:[e.jsx(ot,{text:"Augmented Dickey-Fuller Test. Stationary (p<0.05) means the data has constant mean/variance over time. Non-Stationary (p>=0.05) means it has a trend or seasonality."}),e.jsx("span",{className:"font-semibold",children:"ADF Test:"})," ",t.timeseries.stationarity_test.is_stationary?"Stationary":"Non-Stationary",e.jsxs("span",{className:"opacity-75 ml-1",children:["(p=",t.timeseries.stationarity_test.p_value.toFixed(3),")"]})]}),e.jsx("button",{onClick:()=>r("trend-chart","trend-analysis","Trend Analysis",`Date Column: ${t.timeseries.date_col}`,t.timeseries.stationarity_test?`ADF Test: ${t.timeseries.stationarity_test.is_stationary?"Stationary":"Non-Stationary"} (p=${t.timeseries.stationarity_test.p_value.toFixed(3)})`:void 0),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(wt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"h-80 w-full",id:"trend-chart",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(_c,{data:t.timeseries.trend,children:[e.jsx(vt,{strokeDasharray:"3 3",vertical:!1}),e.jsx(_t,{dataKey:"date",tick:{fontSize:12},minTickGap:30}),e.jsx(jt,{}),e.jsx(it,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},labelStyle:{color:"#9ca3af"}}),e.jsx(Wn,{}),Object.keys(((n=t.timeseries.trend[0])==null?void 0:n.values)||{}).map((o,d)=>e.jsx(Ta,{type:"monotone",dataKey:`values.${o}`,name:o,stroke:Fn[d%Fn.length],dot:!1,strokeWidth:2},o)),(!((i=t.timeseries.trend[0])!=null&&i.values)||Object.keys(t.timeseries.trend[0].values).length===0)&&e.jsx(Ta,{type:"monotone",dataKey:"count",stroke:"#3b82f6",dot:!1})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm relative group",children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-100 z-10",children:e.jsx("button",{onClick:()=>r("day-seasonality-chart","day-seasonality","Day of Week Seasonality"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(wt,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Day of Week Seasonality"}),e.jsx(ot,{text:"Average values for each day. Helps identify weekly patterns (e.g., lower on weekends)."})]}),e.jsx("div",{className:"h-64 w-full",id:"day-seasonality-chart",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:t.timeseries.seasonality.day_of_week,children:[e.jsx(vt,{strokeDasharray:"3 3",vertical:!1}),e.jsx(_t,{dataKey:"day",tick:{fontSize:12}}),e.jsx(jt,{}),e.jsx(it,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},cursor:{fill:"transparent"}}),e.jsx(Mt,{dataKey:"count",fill:"#8884d8",radius:[4,4,0,0]})]})})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm relative group",children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-100 z-10",children:e.jsx("button",{onClick:()=>r("month-seasonality-chart","month-seasonality","Monthly Seasonality"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(wt,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Monthly Seasonality"}),e.jsx(ot,{text:"Average values for each month. Helps identify yearly patterns or seasonal effects."})]}),e.jsx("div",{className:"h-64 w-full",id:"month-seasonality-chart",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:t.timeseries.seasonality.month_of_year,children:[e.jsx(vt,{strokeDasharray:"3 3",vertical:!1}),e.jsx(_t,{dataKey:"month",tick:{fontSize:12}}),e.jsx(jt,{}),e.jsx(it,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},cursor:{fill:"transparent"}}),e.jsx(Mt,{dataKey:"count",fill:"#82ca9d",radius:[4,4,0,0]})]})})})]}),t.timeseries.autocorrelation&&t.timeseries.autocorrelation.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Autocorrelation (Lag Analysis)"}),e.jsxs("div",{className:"group relative ml-2",children:[e.jsx(Kt,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-64 p-2 bg-gray-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none text-center",children:["Shows how much the current value depends on past values (lags). High bars indicate repeating patterns or seasonality.",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-800"})]})]})]}),e.jsx("button",{onClick:()=>r("autocorrelation-chart","autocorrelation","Autocorrelation (Lag Analysis)"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(wt,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"h-80 w-full pb-6",id:"autocorrelation-chart",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:t.timeseries.autocorrelation,margin:{bottom:20},children:[e.jsx(vt,{strokeDasharray:"3 3",vertical:!1}),e.jsx(_t,{dataKey:"lag",tick:{fontSize:12},label:{value:"Lag (Days)",position:"insideBottom",offset:-15,fontSize:12}}),e.jsx(jt,{domain:[-1,1]}),e.jsx(it,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},cursor:{fill:"transparent"},formatter:o=>[o.toFixed(3),"Correlation"]}),e.jsx(Lo,{y:0,stroke:"#9ca3af"}),e.jsx(Mt,{dataKey:"corr",fill:"#f59e0b",radius:[2,2,0,0]})]})})})]})]})},Bd=({profile:t,onClick:r,onToggleExclude:n,isExcluded:i=!1})=>{var c;const o=()=>{if(i)return e.jsx(xd,{className:"w-4 h-4 text-gray-400"});switch(t.dtype){case"Numeric":return e.jsx(Do,{className:"w-4 h-4 text-blue-500"});case"Categorical":return e.jsx(Ec,{className:"w-4 h-4 text-purple-500"});case"DateTime":return e.jsx(yr,{className:"w-4 h-4 text-green-500"});default:return e.jsx(xd,{className:"w-4 h-4 text-gray-500"})}};let d=[];return t.dtype==="Numeric"&&t.histogram?d=t.histogram.map(h=>({name:h.start.toFixed(1),count:h.count})):t.dtype==="Text"&&t.histogram?d=t.histogram.map(h=>({name:h.start.toFixed(0),count:h.count})):t.dtype==="DateTime"&&t.histogram?d=t.histogram.map(h=>({name:new Date(h.start).toLocaleDateString(),count:h.count})):t.dtype==="Categorical"&&((c=t.categorical_stats)!=null&&c.top_k)&&(d=t.categorical_stats.top_k.slice(0,5).map(h=>({name:h.value,count:h.count}))),e.jsxs("div",{className:`rounded-lg border p-4 transition-all cursor-pointer flex flex-col h-full ${i?"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-800 opacity-75":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:shadow-md"}`,onClick:r,children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[o(),e.jsx("h3",{className:`font-medium text-sm truncate flex-1 ${i?"text-gray-500 line-through":""}`,title:t.name,children:t.name})]})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[!i&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full",children:t.dtype}),n&&e.jsx("button",{onClick:h=>{h.stopPropagation(),n(t.name,!i)},className:`p-1 rounded transition-colors ml-auto ${i?"hover:bg-green-100 text-gray-400 hover:text-green-600 dark:hover:bg-green-900/30":"hover:bg-red-100 text-gray-400 hover:text-red-500 dark:hover:bg-red-900/30"}`,title:i?"Include in analysis":"Exclude from analysis",children:i?e.jsx(Cc,{className:"w-3 h-3"}):e.jsx(Gn,{className:"w-3 h-3"})})]}),!i&&e.jsxs("div",{className:"flex justify-between items-end mt-auto",children:[e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[t.missing_percentage>0&&e.jsxs("div",{className:"flex items-center text-amber-600",children:[e.jsx(wr,{className:"w-3 h-3 mr-1"}),t.missing_percentage.toFixed(1),"% null"]}),t.is_unique&&e.jsx("div",{className:"text-blue-500",children:"Unique ID"}),t.is_constant&&e.jsx("div",{className:"text-red-500",children:"Constant"}),t.normality_test&&t.normality_test.is_normal&&e.jsx("div",{className:"text-purple-600",title:`Normal Distribution (p=${t.normality_test.p_value.toFixed(3)})`,children:"Normal Dist."}),t.normality_test&&!t.normality_test.is_normal&&e.jsx("div",{className:"text-amber-600",title:`Not Normal Distribution (p=${t.normality_test.p_value.toFixed(3)})`,children:"Not Normal Dist."}),!t.is_unique&&!t.is_constant&&t.missing_percentage===0&&!t.normality_test&&e.jsx("div",{className:"text-green-600",children:"Healthy"})]}),d.length>0&&e.jsx("div",{className:"h-12 w-24",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsx(os,{data:d,children:e.jsx(Mt,{dataKey:"count",fill:t.dtype==="Numeric"?"#3b82f6":t.dtype==="Categorical"?"#8b5cf6":"#10b981",radius:[2,2,0,0]})})})})]}),i&&e.jsx("div",{className:"mt-4 text-xs text-center text-gray-400 italic",children:"Excluded from analysis"})]})},w0=({profile:t,setSelectedVariable:r,handleToggleExclude:n})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[Object.values(t.columns).map(i=>e.jsx(Bd,{profile:i,onClick:()=>r(i),onToggleExclude:n,isExcluded:!1},i.name)),t.excluded_columns&&t.excluded_columns.map(i=>e.jsx(Bd,{profile:{name:i,dtype:"Excluded",missing_percentage:0},onClick:()=>{},onToggleExclude:n,isExcluded:!0},i))]}),N0=({profile:t,downloadChart:r,scatterX:n,setScatterX:i,scatterY:o,setScatterY:d,scatterZ:c,setScatterZ:h,scatterColor:u,setScatterColor:x,is3D:p,setIs3D:b})=>e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Jn,{className:"w-5 h-5 mr-2 text-blue-500"}),"Bivariate Analysis (Scatter Plot)",e.jsx(ot,{text:"Visualize the relationship between two numeric variables."})]}),e.jsx("button",{onClick:()=>r("bivariate-chart","bivariate-analysis","Bivariate Analysis",`${n} vs ${o}`),className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download Chart",children:e.jsx(wt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-4 mb-6 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"X Axis"}),e.jsxs("select",{value:n,onChange:g=>i(g.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"Select Variable"}),Object.values(t.columns).filter(g=>g.dtype==="Numeric").map(g=>e.jsx("option",{value:g.name,children:g.name},g.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Y Axis"}),e.jsxs("select",{value:o,onChange:g=>d(g.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"Select Variable"}),Object.values(t.columns).filter(g=>g.dtype==="Numeric").map(g=>e.jsx("option",{value:g.name,children:g.name},g.name))]})]}),p&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Z Axis"}),e.jsxs("select",{value:c,onChange:g=>h(g.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"Select Variable"}),Object.values(t.columns).filter(g=>g.dtype==="Numeric").map(g=>e.jsx("option",{value:g.name,children:g.name},g.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Color By"}),e.jsxs("select",{value:u,onChange:g=>x(g.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"None"}),Object.values(t.columns).map(g=>e.jsx("option",{value:g.name,children:g.name},g.name))]})]}),e.jsx("button",{onClick:()=>b(!p),className:`p-2 rounded-md border transition-colors ${p?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"}`,title:"Toggle 3D View",children:e.jsx(Yr,{className:"w-5 h-5"})})]}),e.jsx("div",{id:"bivariate-chart",children:n&&o?p&&c?e.jsx(xu,{data:t.sample_data,xKey:n,yKey:o,zKey:c,labelKey:u||void 0,xLabel:n,yLabel:o,zLabel:c}):e.jsx(pu,{data:t.sample_data,xKey:n,yKey:o,labelKey:u||void 0,xLabel:n,yLabel:o}):e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 dark:bg-gray-900 rounded text-gray-400 text-sm",children:"Select X and Y variables to generate scatter plot."})})]}),k0=({profile:t})=>e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(wr,{className:"w-5 h-5 mr-2 text-red-500"}),"Outlier Analysis (",t.outliers.method,")",e.jsx(ot,{text:"Detects anomalous rows using Isolation Forest. Lower scores indicate higher anomaly."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400 block mb-1",children:"Total Outliers"}),e.jsx("span",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:t.outliers.total_outliers})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400 block mb-1",children:"Percentage"}),e.jsxs("span",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:[t.outliers.outlier_percentage.toFixed(2),"%"]})]})]}),e.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white mb-3",children:"Top Anomalous Rows"}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Row Index"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Anomaly Score"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Why is this an outlier?"}),t.outliers.top_outliers[0]&&Object.keys(t.outliers.top_outliers[0].values).slice(0,5).map(r=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:r},r))]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.outliers.top_outliers.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-gray-500",children:r.index}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-red-600",children:r.score.toFixed(4)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.explanation?e.jsx("div",{className:"space-y-1",children:r.explanation.map((n,i)=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:[n.feature,":"]})," ",e.jsx("span",{className:"text-red-600 dark:text-red-400",children:n.value.toFixed(2)})," ",e.jsxs("span",{className:"text-gray-400",children:["(Median: ",n.median.toFixed(2),", Diff: ",n.diff_pct.toFixed(0),"%)"]})]},i))}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No explanation available"})}),Object.entries(r.values).slice(0,5).map(([n,i])=>e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-300",children:typeof i=="number"?i.toFixed(2):String(i)},n))]},r.index))})]})})]}),$d=({data:t})=>{if(!t||!t.columns)return e.jsx("div",{children:"No correlation data available"});const r=20,n=t.columns.slice(0,r),i=t.values.slice(0,r).map(c=>c.slice(0,r)),o=t.columns.length>r,d=c=>{if(c===null)return"rgba(243, 244, 246, 1)";const h=Math.max(.4,Math.abs(c));return c>0?`rgba(239, 68, 68, ${h})`:`rgba(59, 130, 246, ${h})`};return e.jsxs("div",{className:"overflow-x-auto p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[o&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 text-sm rounded-md",children:["Showing top ",r," columns. Full heatmap is too large to render."]}),e.jsx("div",{className:"inline-block min-w-full",children:e.jsxs("div",{className:"grid gap-1",style:{gridTemplateColumns:`100px repeat(${n.length}, minmax(50px, 1fr))`},children:[e.jsx("div",{className:"p-2"}),n.map((c,h)=>e.jsx("div",{className:"p-2 text-xs font-medium truncate text-center",title:c,children:c.length>8?c.substring(0,8)+"...":c},h)),n.map((c,h)=>e.jsxs(pt.Fragment,{children:[e.jsx("div",{className:"p-2 text-xs font-medium truncate text-right pr-4",title:c,children:c}),i[h].map((u,x)=>e.jsx("div",{className:"h-10 w-full flex items-center justify-center text-[10px] text-gray-900 dark:text-gray-100 rounded-sm cursor-help transition-opacity hover:opacity-80",style:{backgroundColor:d(u)},title:`${c} vs ${n[x]}: ${u!==null?u.toFixed(3):"N/A"}`,children:u!==null?u.toFixed(2):""},x))]},h))]})})]})},C0=({profile:t})=>{const r=(n,i,o)=>{if(!n)return;const d=20,c=n.columns.slice(0,d),h=n.values.slice(0,d).map(T=>T.slice(0,d)),u=60,x=document.createElement("canvas"),p=x.getContext("2d");if(!p)return;p.font="12px sans-serif";let b=0;c.forEach(T=>{const E=p.measureText(T).width;E>b&&(b=E)});const g=b+40,y=b*.7+60,_=60,w=g+c.length*u+50,j=y+c.length*u+_+50;x.width=w,x.height=j,p.fillStyle="#ffffff",p.fillRect(0,0,w,j),p.fillStyle="#111827",p.font="bold 24px sans-serif",p.textAlign="center",p.fillText(i,w/2,40);const C=T=>{if(T===null)return"#f3f4f6";const E=Math.max(.2,Math.abs(T));return T>0?`rgba(239, 68, 68, ${E})`:`rgba(59, 130, 246, ${E})`};p.font="12px sans-serif",p.textBaseline="middle",h.forEach((T,E)=>{p.fillStyle="#374151",p.textAlign="right",p.fillText(c[E],g-10,y+_+E*u+u/2),T.forEach((P,A)=>{const R=g+A*u,N=y+_+E*u;p.fillStyle=C(P),p.fillRect(R,N,u-2,u-2),P!==null&&(p.fillStyle=Math.abs(P)>.5?"#ffffff":"#000000",p.textAlign="center",p.fillText(P.toFixed(2),R+u/2,N+u/2))})}),p.save(),c.forEach((T,E)=>{const P=g+E*u+u/2,A=y+_-10;p.translate(P,A),p.rotate(-Math.PI/4),p.fillStyle="#374151",p.textAlign="left",p.fillText(T,0,0),p.rotate(Math.PI/4),p.translate(-P,-A)}),p.restore();const S=document.createElement("a");S.download=o,S.href=x.toDataURL("image/png"),S.click()};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(ks,{className:"w-5 h-5 mr-2 text-blue-500"}),"Feature Correlations (Multicollinearity)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{text:"Correlation between features only. Use this to detect redundant variables (multicollinearity)."}),e.jsx("button",{onClick:()=>r(t.correlations,"Feature Correlations","feature-correlations.png"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Matrix",children:e.jsx(wt,{className:"w-4 h-4"})})]})]}),e.jsx($d,{data:t.correlations})]}),t.correlations_with_target&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(ks,{className:"w-5 h-5 mr-2 text-green-500"}),"Target Correlations (Feature Selection)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{text:"Correlation including the target variable. Use this to identify the most predictive features."}),e.jsx("button",{onClick:()=>r(t.correlations_with_target,"Target Correlations","target-correlations.png"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Matrix",children:e.jsx(wt,{className:"w-4 h-4"})})]})]}),e.jsx($d,{data:t.correlations_with_target})]})]})},S0=({profile:t,excludedCols:r,handleToggleExclude:n})=>{const i=Object.keys(t.sample_data[0]||{}).filter(o=>!r.includes(o)&&!o.endsWith("_encoded"));return e.jsxs("div",{className:"mt-4 overflow-x-auto bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsx("tr",{children:i.map(o=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider group",children:e.jsxs("div",{className:"flex items-center gap-2",children:[o,e.jsx("button",{onClick:d=>{d.stopPropagation(),n(o,!0)},className:"p-1 rounded transition-colors opacity-0 group-hover:opacity-100 hover:bg-red-100 text-gray-400 hover:text-red-500 dark:hover:bg-red-900/30",title:"Exclude from analysis",children:e.jsx(Gn,{className:"w-3 h-3"})})]})},o))})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.sample_data.slice(0,50).map((o,d)=>e.jsx("tr",{children:i.map((c,h)=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:o[c]!==null?String(o[c]):e.jsx("span",{className:"italic text-gray-400",children:"null"})},h))},d))})]}),t.sample_data.length>50&&e.jsxs("div",{className:"p-4 text-center text-sm text-gray-500 border-t border-gray-200 dark:border-gray-700",children:["Showing first 50 rows of ",t.sample_data.length," sample rows."]})]})},Wi=150,Zd=40,P0=({graph:t})=>{const[r,n,i]=Ac([]),[o,d,c]=Oc([]),h=f.useCallback((u,x)=>{try{const p=new Mn.graphlib.Graph;return p.setDefaultEdgeLabel(()=>({})),p.setGraph({rankdir:"LR",nodesep:80,ranksep:200}),u.forEach(g=>{p.setNode(g.id,{width:Wi,height:Zd})}),x.forEach(g=>{p.setEdge(g.source,g.target)}),Mn.layout(p),{nodes:u.map(g=>{const y=p.node(g.id);return y?{...g,targetPosition:Ks.Left,sourcePosition:Ks.Right,position:{x:y.x-Wi/2,y:y.y-Zd/2}}:{...g,position:{x:Math.random()*500,y:Math.random()*500}}}),edges:x}}catch(p){return console.error("Dagre layout failed:",p),{nodes:u.map((g,y)=>({...g,position:{x:y%3*250,y:Math.floor(y/3)*100}})),edges:x}}},[]);return f.useEffect(()=>{if(!t||!t.nodes||t.nodes.length===0)return;const u=g=>g.replace(/[^a-zA-Z0-9-_]/g,"_"),x=t.nodes.map(g=>({id:u(g.id),data:{label:g.label},position:{x:0,y:0},className:"dark:bg-gray-800 dark:text-white dark:border-gray-600 bg-white text-gray-900 border-gray-300",style:{borderRadius:"5px",padding:"10px",width:Wi,textAlign:"center",borderWidth:"1px",borderStyle:"solid"}})),p=t.edges.map((g,y)=>({id:`e${y}`,source:u(g.source),target:u(g.target),animated:!0,type:"default",label:g.type==="directed"?"causes":g.type==="bidirected"?"confounded":"related",style:{stroke:g.type==="directed"?"#333":"#999",strokeDasharray:g.type==="directed"?"0":"5 5"},markerEnd:g.type==="directed"?{type:On.ArrowClosed}:void 0,markerStart:g.type==="bidirected"?{type:On.ArrowClosed}:void 0})),b=h(x,p);n(b.nodes),d(b.edges)},[t,h,n,d]),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{style:{width:"100%",height:"500px"},className:"border rounded-lg bg-gray-50 dark:bg-gray-900 relative",children:e.jsxs(zo,{nodes:r,edges:o,onNodesChange:i,onEdgesChange:c,fitView:!0,className:"dark:bg-gray-900",children:[e.jsx(Fo,{className:"dark:bg-gray-900"}),e.jsx(Bo,{className:"dark:bg-gray-800 dark:text-white dark:border-gray-700"})]})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic flex items-center gap-1",children:[e.jsx(Kt,{className:"w-3 h-3"}),"To ensure fast performance, this graph displays the ",e.jsx("strong",{children:"Target"})," and the top ",e.jsx("strong",{children:"14 features"})," most correlated with it."]})]})},T0=({profile:t})=>{const r=t.causal_graph;return r?e.jsx("div",{className:"space-y-6 mt-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Rn,{className:"w-5 h-5 mr-2 text-purple-500"}),"Causal Discovery (PC Algorithm)",e.jsx(ot,{text:"Inferred causal structure using the Peter-Clark algorithm. Arrows (A->B) suggest A causes B. Lines (A-B) suggest correlation without clear direction. Bidirected arrows (A<->B) suggest a hidden common cause."})]}),e.jsxs("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded border border-yellow-200 dark:border-yellow-800",children:[e.jsx("strong",{children:"Disclaimer:"})," This graph is inferred purely from observational data. Correlation does not imply causation. Use this as a hypothesis generation tool, not absolute truth."]}),e.jsx(P0,{graph:r})]})}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(Rn,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No causal graph available. This might be because there are fewer than 2 numeric columns or the analysis failed."})]})};function vs(t,r,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t==null||t(o),n===!1||!o.defaultPrevented)return r==null?void 0:r(o)}}function Hd(t,r){if(typeof t=="function")return t(r);t!=null&&(t.current=r)}function vu(...t){return r=>{let n=!1;const i=t.map(o=>{const d=Hd(o,r);return!n&&typeof d=="function"&&(n=!0),d});if(n)return()=>{for(let o=0;o<i.length;o++){const d=i[o];typeof d=="function"?d():Hd(t[o],null)}}}}function kr(...t){return f.useCallback(vu(...t),t)}function _u(t,r=[]){let n=[];function i(d,c){const h=f.createContext(c),u=n.length;n=[...n,c];const x=b=>{var C;const{scope:g,children:y,..._}=b,w=((C=g==null?void 0:g[t])==null?void 0:C[u])||h,j=f.useMemo(()=>_,Object.values(_));return e.jsx(w.Provider,{value:j,children:y})};x.displayName=d+"Provider";function p(b,g){var w;const y=((w=g==null?void 0:g[t])==null?void 0:w[u])||h,_=f.useContext(y);if(_)return _;if(c!==void 0)return c;throw new Error(`\`${b}\` must be used within \`${d}\``)}return[x,p]}const o=()=>{const d=n.map(c=>f.createContext(c));return function(h){const u=(h==null?void 0:h[t])||d;return f.useMemo(()=>({[`__scope${t}`]:{...h,[t]:u}}),[h,u])}};return o.scopeName=t,[i,L0(o,...r)]}function L0(...t){const r=t[0];if(t.length===1)return r;const n=()=>{const i=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(d){const c=i.reduce((h,{useScope:u,scopeName:x})=>{const b=u(d)[`__scope${x}`];return{...h,...b}},{});return f.useMemo(()=>({[`__scope${r.scopeName}`]:c}),[c])}};return n.scopeName=r.scopeName,n}function E0(t){const r=R0(t),n=f.forwardRef((i,o)=>{const{children:d,...c}=i,h=f.Children.toArray(d),u=h.find(D0);if(u){const x=u.props.children,p=h.map(b=>b===u?f.Children.count(x)>1?f.Children.only(null):f.isValidElement(x)?x.props.children:null:b);return e.jsx(r,{...c,ref:o,children:f.isValidElement(x)?f.cloneElement(x,void 0,p):null})}return e.jsx(r,{...c,ref:o,children:d})});return n.displayName=`${t}.Slot`,n}function R0(t){const r=f.forwardRef((n,i)=>{const{children:o,...d}=n;if(f.isValidElement(o)){const c=O0(o),h=A0(d,o.props);return o.type!==f.Fragment&&(h.ref=i?vu(i,c):c),f.cloneElement(o,h)}return f.Children.count(o)>1?f.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var M0=Symbol("radix.slottable");function D0(t){return f.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===M0}function A0(t,r){const n={...r};for(const i in r){const o=t[i],d=r[i];/^on[A-Z]/.test(i)?o&&d?n[i]=(...h)=>{const u=d(...h);return o(...h),u}:o&&(n[i]=o):i==="style"?n[i]={...o,...d}:i==="className"&&(n[i]=[o,d].filter(Boolean).join(" "))}return{...t,...n}}function O0(t){var i,o;let r=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=r&&"isReactWarning"in r&&r.isReactWarning;return n?t.ref:(r=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,n=r&&"isReactWarning"in r&&r.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var I0=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Cr=I0.reduce((t,r)=>{const n=E0(`Primitive.${r}`),i=f.forwardRef((o,d)=>{const{asChild:c,...h}=o,u=c?n:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(u,{...h,ref:d})});return i.displayName=`Primitive.${r}`,{...t,[r]:i}},{});function z0(t,r){t&&Vn.flushSync(()=>t.dispatchEvent(r))}function ai(t){const r=f.useRef(t);return f.useEffect(()=>{r.current=t}),f.useMemo(()=>(...n)=>{var i;return(i=r.current)==null?void 0:i.call(r,...n)},[])}function F0(t,r=globalThis==null?void 0:globalThis.document){const n=ai(t);f.useEffect(()=>{const i=o=>{o.key==="Escape"&&n(o)};return r.addEventListener("keydown",i,{capture:!0}),()=>r.removeEventListener("keydown",i,{capture:!0})},[n,r])}var B0="DismissableLayer",vo="dismissableLayer.update",$0="dismissableLayer.pointerDownOutside",Z0="dismissableLayer.focusOutside",Ud,ju=f.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),wu=f.forwardRef((t,r)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:d,onInteractOutside:c,onDismiss:h,...u}=t,x=f.useContext(ju),[p,b]=f.useState(null),g=(p==null?void 0:p.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,y]=f.useState({}),_=kr(r,R=>b(R)),w=Array.from(x.layers),[j]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),C=w.indexOf(j),S=p?w.indexOf(p):-1,T=x.layersWithOutsidePointerEventsDisabled.size>0,E=S>=C,P=W0(R=>{const N=R.target,M=[...x.branches].some(z=>z.contains(N));!E||M||(o==null||o(R),c==null||c(R),R.defaultPrevented||h==null||h())},g),A=V0(R=>{const N=R.target;[...x.branches].some(z=>z.contains(N))||(d==null||d(R),c==null||c(R),R.defaultPrevented||h==null||h())},g);return F0(R=>{S===x.layers.size-1&&(i==null||i(R),!R.defaultPrevented&&h&&(R.preventDefault(),h()))},g),f.useEffect(()=>{if(p)return n&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(Ud=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(p)),x.layers.add(p),Wd(),()=>{n&&x.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=Ud)}},[p,g,n,x]),f.useEffect(()=>()=>{p&&(x.layers.delete(p),x.layersWithOutsidePointerEventsDisabled.delete(p),Wd())},[p,x]),f.useEffect(()=>{const R=()=>y({});return document.addEventListener(vo,R),()=>document.removeEventListener(vo,R)},[]),e.jsx(Cr.div,{...u,ref:_,style:{pointerEvents:T?E?"auto":"none":void 0,...t.style},onFocusCapture:vs(t.onFocusCapture,A.onFocusCapture),onBlurCapture:vs(t.onBlurCapture,A.onBlurCapture),onPointerDownCapture:vs(t.onPointerDownCapture,P.onPointerDownCapture)})});wu.displayName=B0;var H0="DismissableLayerBranch",U0=f.forwardRef((t,r)=>{const n=f.useContext(ju),i=f.useRef(null),o=kr(r,i);return f.useEffect(()=>{const d=i.current;if(d)return n.branches.add(d),()=>{n.branches.delete(d)}},[n.branches]),e.jsx(Cr.div,{...t,ref:o})});U0.displayName=H0;function W0(t,r=globalThis==null?void 0:globalThis.document){const n=ai(t),i=f.useRef(!1),o=f.useRef(()=>{});return f.useEffect(()=>{const d=h=>{if(h.target&&!i.current){let u=function(){Nu($0,n,x,{discrete:!0})};const x={originalEvent:h};h.pointerType==="touch"?(r.removeEventListener("click",o.current),o.current=u,r.addEventListener("click",o.current,{once:!0})):u()}else r.removeEventListener("click",o.current);i.current=!1},c=window.setTimeout(()=>{r.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(c),r.removeEventListener("pointerdown",d),r.removeEventListener("click",o.current)}},[r,n]),{onPointerDownCapture:()=>i.current=!0}}function V0(t,r=globalThis==null?void 0:globalThis.document){const n=ai(t),i=f.useRef(!1);return f.useEffect(()=>{const o=d=>{d.target&&!i.current&&Nu(Z0,n,{originalEvent:d},{discrete:!1})};return r.addEventListener("focusin",o),()=>r.removeEventListener("focusin",o)},[r,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function Wd(){const t=new CustomEvent(vo);document.dispatchEvent(t)}function Nu(t,r,n,{discrete:i}){const o=n.originalEvent.target,d=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});r&&o.addEventListener(t,r,{once:!0}),i?z0(o,d):o.dispatchEvent(d)}var _r=globalThis!=null&&globalThis.document?f.useLayoutEffect:()=>{},q0=jc[" useId ".trim().toString()]||(()=>{}),G0=0;function K0(t){const[r,n]=f.useState(q0());return _r(()=>{n(i=>i??String(G0++))},[t]),r?`radix-${r}`:""}const J0=["top","right","bottom","left"],Js=Math.min,Nt=Math.max,Bn=Math.round,kn=Math.floor,ls=t=>({x:t,y:t}),Q0={left:"right",right:"left",bottom:"top",top:"bottom"},Y0={start:"end",end:"start"};function _o(t,r,n){return Nt(t,Js(r,n))}function Ss(t,r){return typeof t=="function"?t(r):t}function Ps(t){return t.split("-")[0]}function ia(t){return t.split("-")[1]}function tl(t){return t==="x"?"y":"x"}function sl(t){return t==="y"?"height":"width"}const X0=new Set(["top","bottom"]);function is(t){return X0.has(Ps(t))?"y":"x"}function rl(t){return tl(is(t))}function eb(t,r,n){n===void 0&&(n=!1);const i=ia(t),o=rl(t),d=sl(o);let c=o==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return r.reference[d]>r.floating[d]&&(c=$n(c)),[c,$n(c)]}function tb(t){const r=$n(t);return[jo(t),r,jo(r)]}function jo(t){return t.replace(/start|end/g,r=>Y0[r])}const Vd=["left","right"],qd=["right","left"],sb=["top","bottom"],rb=["bottom","top"];function ab(t,r,n){switch(t){case"top":case"bottom":return n?r?qd:Vd:r?Vd:qd;case"left":case"right":return r?sb:rb;default:return[]}}function nb(t,r,n,i){const o=ia(t);let d=ab(Ps(t),n==="start",i);return o&&(d=d.map(c=>c+"-"+o),r&&(d=d.concat(d.map(jo)))),d}function $n(t){return t.replace(/left|right|bottom|top/g,r=>Q0[r])}function ib(t){return{top:0,right:0,bottom:0,left:0,...t}}function ku(t){return typeof t!="number"?ib(t):{top:t,right:t,bottom:t,left:t}}function Zn(t){const{x:r,y:n,width:i,height:o}=t;return{width:i,height:o,top:n,left:r,right:r+i,bottom:n+o,x:r,y:n}}function Gd(t,r,n){let{reference:i,floating:o}=t;const d=is(r),c=rl(r),h=sl(c),u=Ps(r),x=d==="y",p=i.x+i.width/2-o.width/2,b=i.y+i.height/2-o.height/2,g=i[h]/2-o[h]/2;let y;switch(u){case"top":y={x:p,y:i.y-o.height};break;case"bottom":y={x:p,y:i.y+i.height};break;case"right":y={x:i.x+i.width,y:b};break;case"left":y={x:i.x-o.width,y:b};break;default:y={x:i.x,y:i.y}}switch(ia(r)){case"start":y[c]-=g*(n&&x?-1:1);break;case"end":y[c]+=g*(n&&x?-1:1);break}return y}const ob=async(t,r,n)=>{const{placement:i="bottom",strategy:o="absolute",middleware:d=[],platform:c}=n,h=d.filter(Boolean),u=await(c.isRTL==null?void 0:c.isRTL(r));let x=await c.getElementRects({reference:t,floating:r,strategy:o}),{x:p,y:b}=Gd(x,i,u),g=i,y={},_=0;for(let w=0;w<h.length;w++){const{name:j,fn:C}=h[w],{x:S,y:T,data:E,reset:P}=await C({x:p,y:b,initialPlacement:i,placement:g,strategy:o,middlewareData:y,rects:x,platform:c,elements:{reference:t,floating:r}});p=S??p,b=T??b,y={...y,[j]:{...y[j],...E}},P&&_<=50&&(_++,typeof P=="object"&&(P.placement&&(g=P.placement),P.rects&&(x=P.rects===!0?await c.getElementRects({reference:t,floating:r,strategy:o}):P.rects),{x:p,y:b}=Gd(x,g,u)),w=-1)}return{x:p,y:b,placement:g,strategy:o,middlewareData:y}};async function Ia(t,r){var n;r===void 0&&(r={});const{x:i,y:o,platform:d,rects:c,elements:h,strategy:u}=t,{boundary:x="clippingAncestors",rootBoundary:p="viewport",elementContext:b="floating",altBoundary:g=!1,padding:y=0}=Ss(r,t),_=ku(y),j=h[g?b==="floating"?"reference":"floating":b],C=Zn(await d.getClippingRect({element:(n=await(d.isElement==null?void 0:d.isElement(j)))==null||n?j:j.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(h.floating)),boundary:x,rootBoundary:p,strategy:u})),S=b==="floating"?{x:i,y:o,width:c.floating.width,height:c.floating.height}:c.reference,T=await(d.getOffsetParent==null?void 0:d.getOffsetParent(h.floating)),E=await(d.isElement==null?void 0:d.isElement(T))?await(d.getScale==null?void 0:d.getScale(T))||{x:1,y:1}:{x:1,y:1},P=Zn(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:h,rect:S,offsetParent:T,strategy:u}):S);return{top:(C.top-P.top+_.top)/E.y,bottom:(P.bottom-C.bottom+_.bottom)/E.y,left:(C.left-P.left+_.left)/E.x,right:(P.right-C.right+_.right)/E.x}}const lb=t=>({name:"arrow",options:t,async fn(r){const{x:n,y:i,placement:o,rects:d,platform:c,elements:h,middlewareData:u}=r,{element:x,padding:p=0}=Ss(t,r)||{};if(x==null)return{};const b=ku(p),g={x:n,y:i},y=rl(o),_=sl(y),w=await c.getDimensions(x),j=y==="y",C=j?"top":"left",S=j?"bottom":"right",T=j?"clientHeight":"clientWidth",E=d.reference[_]+d.reference[y]-g[y]-d.floating[_],P=g[y]-d.reference[y],A=await(c.getOffsetParent==null?void 0:c.getOffsetParent(x));let R=A?A[T]:0;(!R||!await(c.isElement==null?void 0:c.isElement(A)))&&(R=h.floating[T]||d.floating[_]);const N=E/2-P/2,M=R/2-w[_]/2-1,z=Js(b[C],M),I=Js(b[S],M),F=z,$=R-w[_]-I,J=R/2-w[_]/2+N,ee=_o(F,J,$),te=!u.arrow&&ia(o)!=null&&J!==ee&&d.reference[_]/2-(J<F?z:I)-w[_]/2<0,Y=te?J<F?J-F:J-$:0;return{[y]:g[y]+Y,data:{[y]:ee,centerOffset:J-ee-Y,...te&&{alignmentOffset:Y}},reset:te}}}),db=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(r){var n,i;const{placement:o,middlewareData:d,rects:c,initialPlacement:h,platform:u,elements:x}=r,{mainAxis:p=!0,crossAxis:b=!0,fallbackPlacements:g,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:_="none",flipAlignment:w=!0,...j}=Ss(t,r);if((n=d.arrow)!=null&&n.alignmentOffset)return{};const C=Ps(o),S=is(h),T=Ps(h)===h,E=await(u.isRTL==null?void 0:u.isRTL(x.floating)),P=g||(T||!w?[$n(h)]:tb(h)),A=_!=="none";!g&&A&&P.push(...nb(h,w,_,E));const R=[h,...P],N=await Ia(r,j),M=[];let z=((i=d.flip)==null?void 0:i.overflows)||[];if(p&&M.push(N[C]),b){const J=eb(o,c,E);M.push(N[J[0]],N[J[1]])}if(z=[...z,{placement:o,overflows:M}],!M.every(J=>J<=0)){var I,F;const J=(((I=d.flip)==null?void 0:I.index)||0)+1,ee=R[J];if(ee&&(!(b==="alignment"?S!==is(ee):!1)||z.every(W=>is(W.placement)===S?W.overflows[0]>0:!0)))return{data:{index:J,overflows:z},reset:{placement:ee}};let te=(F=z.filter(Y=>Y.overflows[0]<=0).sort((Y,W)=>Y.overflows[1]-W.overflows[1])[0])==null?void 0:F.placement;if(!te)switch(y){case"bestFit":{var $;const Y=($=z.filter(W=>{if(A){const U=is(W.placement);return U===S||U==="y"}return!0}).map(W=>[W.placement,W.overflows.filter(U=>U>0).reduce((U,q)=>U+q,0)]).sort((W,U)=>W[1]-U[1])[0])==null?void 0:$[0];Y&&(te=Y);break}case"initialPlacement":te=h;break}if(o!==te)return{reset:{placement:te}}}return{}}}};function Kd(t,r){return{top:t.top-r.height,right:t.right-r.width,bottom:t.bottom-r.height,left:t.left-r.width}}function Jd(t){return J0.some(r=>t[r]>=0)}const cb=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(r){const{rects:n}=r,{strategy:i="referenceHidden",...o}=Ss(t,r);switch(i){case"referenceHidden":{const d=await Ia(r,{...o,elementContext:"reference"}),c=Kd(d,n.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:Jd(c)}}}case"escaped":{const d=await Ia(r,{...o,altBoundary:!0}),c=Kd(d,n.floating);return{data:{escapedOffsets:c,escaped:Jd(c)}}}default:return{}}}}},Cu=new Set(["left","top"]);async function ub(t,r){const{placement:n,platform:i,elements:o}=t,d=await(i.isRTL==null?void 0:i.isRTL(o.floating)),c=Ps(n),h=ia(n),u=is(n)==="y",x=Cu.has(c)?-1:1,p=d&&u?-1:1,b=Ss(r,t);let{mainAxis:g,crossAxis:y,alignmentAxis:_}=typeof b=="number"?{mainAxis:b,crossAxis:0,alignmentAxis:null}:{mainAxis:b.mainAxis||0,crossAxis:b.crossAxis||0,alignmentAxis:b.alignmentAxis};return h&&typeof _=="number"&&(y=h==="end"?_*-1:_),u?{x:y*p,y:g*x}:{x:g*x,y:y*p}}const hb=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(r){var n,i;const{x:o,y:d,placement:c,middlewareData:h}=r,u=await ub(r,t);return c===((n=h.offset)==null?void 0:n.placement)&&(i=h.arrow)!=null&&i.alignmentOffset?{}:{x:o+u.x,y:d+u.y,data:{...u,placement:c}}}}},mb=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(r){const{x:n,y:i,placement:o}=r,{mainAxis:d=!0,crossAxis:c=!1,limiter:h={fn:j=>{let{x:C,y:S}=j;return{x:C,y:S}}},...u}=Ss(t,r),x={x:n,y:i},p=await Ia(r,u),b=is(Ps(o)),g=tl(b);let y=x[g],_=x[b];if(d){const j=g==="y"?"top":"left",C=g==="y"?"bottom":"right",S=y+p[j],T=y-p[C];y=_o(S,y,T)}if(c){const j=b==="y"?"top":"left",C=b==="y"?"bottom":"right",S=_+p[j],T=_-p[C];_=_o(S,_,T)}const w=h.fn({...r,[g]:y,[b]:_});return{...w,data:{x:w.x-n,y:w.y-i,enabled:{[g]:d,[b]:c}}}}}},xb=function(t){return t===void 0&&(t={}),{options:t,fn(r){const{x:n,y:i,placement:o,rects:d,middlewareData:c}=r,{offset:h=0,mainAxis:u=!0,crossAxis:x=!0}=Ss(t,r),p={x:n,y:i},b=is(o),g=tl(b);let y=p[g],_=p[b];const w=Ss(h,r),j=typeof w=="number"?{mainAxis:w,crossAxis:0}:{mainAxis:0,crossAxis:0,...w};if(u){const T=g==="y"?"height":"width",E=d.reference[g]-d.floating[T]+j.mainAxis,P=d.reference[g]+d.reference[T]-j.mainAxis;y<E?y=E:y>P&&(y=P)}if(x){var C,S;const T=g==="y"?"width":"height",E=Cu.has(Ps(o)),P=d.reference[b]-d.floating[T]+(E&&((C=c.offset)==null?void 0:C[b])||0)+(E?0:j.crossAxis),A=d.reference[b]+d.reference[T]+(E?0:((S=c.offset)==null?void 0:S[b])||0)-(E?j.crossAxis:0);_<P?_=P:_>A&&(_=A)}return{[g]:y,[b]:_}}}},pb=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(r){var n,i;const{placement:o,rects:d,platform:c,elements:h}=r,{apply:u=()=>{},...x}=Ss(t,r),p=await Ia(r,x),b=Ps(o),g=ia(o),y=is(o)==="y",{width:_,height:w}=d.floating;let j,C;b==="top"||b==="bottom"?(j=b,C=g===(await(c.isRTL==null?void 0:c.isRTL(h.floating))?"start":"end")?"left":"right"):(C=b,j=g==="end"?"top":"bottom");const S=w-p.top-p.bottom,T=_-p.left-p.right,E=Js(w-p[j],S),P=Js(_-p[C],T),A=!r.middlewareData.shift;let R=E,N=P;if((n=r.middlewareData.shift)!=null&&n.enabled.x&&(N=T),(i=r.middlewareData.shift)!=null&&i.enabled.y&&(R=S),A&&!g){const z=Nt(p.left,0),I=Nt(p.right,0),F=Nt(p.top,0),$=Nt(p.bottom,0);y?N=_-2*(z!==0||I!==0?z+I:Nt(p.left,p.right)):R=w-2*(F!==0||$!==0?F+$:Nt(p.top,p.bottom))}await u({...r,availableWidth:N,availableHeight:R});const M=await c.getDimensions(h.floating);return _!==M.width||w!==M.height?{reset:{rects:!0}}:{}}}};function ni(){return typeof window<"u"}function oa(t){return Su(t)?(t.nodeName||"").toLowerCase():"#document"}function kt(t){var r;return(t==null||(r=t.ownerDocument)==null?void 0:r.defaultView)||window}function us(t){var r;return(r=(Su(t)?t.ownerDocument:t.document)||window.document)==null?void 0:r.documentElement}function Su(t){return ni()?t instanceof Node||t instanceof kt(t).Node:!1}function qt(t){return ni()?t instanceof Element||t instanceof kt(t).Element:!1}function ds(t){return ni()?t instanceof HTMLElement||t instanceof kt(t).HTMLElement:!1}function Qd(t){return!ni()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof kt(t).ShadowRoot}const fb=new Set(["inline","contents"]);function Ja(t){const{overflow:r,overflowX:n,overflowY:i,display:o}=Gt(t);return/auto|scroll|overlay|hidden|clip/.test(r+i+n)&&!fb.has(o)}const gb=new Set(["table","td","th"]);function bb(t){return gb.has(oa(t))}const yb=[":popover-open",":modal"];function ii(t){return yb.some(r=>{try{return t.matches(r)}catch{return!1}})}const vb=["transform","translate","scale","rotate","perspective"],_b=["transform","translate","scale","rotate","perspective","filter"],jb=["paint","layout","strict","content"];function al(t){const r=nl(),n=qt(t)?Gt(t):t;return vb.some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!r&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!r&&(n.filter?n.filter!=="none":!1)||_b.some(i=>(n.willChange||"").includes(i))||jb.some(i=>(n.contain||"").includes(i))}function wb(t){let r=Qs(t);for(;ds(r)&&!ea(r);){if(al(r))return r;if(ii(r))return null;r=Qs(r)}return null}function nl(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Nb=new Set(["html","body","#document"]);function ea(t){return Nb.has(oa(t))}function Gt(t){return kt(t).getComputedStyle(t)}function oi(t){return qt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Qs(t){if(oa(t)==="html")return t;const r=t.assignedSlot||t.parentNode||Qd(t)&&t.host||us(t);return Qd(r)?r.host:r}function Pu(t){const r=Qs(t);return ea(r)?t.ownerDocument?t.ownerDocument.body:t.body:ds(r)&&Ja(r)?r:Pu(r)}function za(t,r,n){var i;r===void 0&&(r=[]),n===void 0&&(n=!0);const o=Pu(t),d=o===((i=t.ownerDocument)==null?void 0:i.body),c=kt(o);if(d){const h=wo(c);return r.concat(c,c.visualViewport||[],Ja(o)?o:[],h&&n?za(h):[])}return r.concat(o,za(o,[],n))}function wo(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Tu(t){const r=Gt(t);let n=parseFloat(r.width)||0,i=parseFloat(r.height)||0;const o=ds(t),d=o?t.offsetWidth:n,c=o?t.offsetHeight:i,h=Bn(n)!==d||Bn(i)!==c;return h&&(n=d,i=c),{width:n,height:i,$:h}}function il(t){return qt(t)?t:t.contextElement}function zr(t){const r=il(t);if(!ds(r))return ls(1);const n=r.getBoundingClientRect(),{width:i,height:o,$:d}=Tu(r);let c=(d?Bn(n.width):n.width)/i,h=(d?Bn(n.height):n.height)/o;return(!c||!Number.isFinite(c))&&(c=1),(!h||!Number.isFinite(h))&&(h=1),{x:c,y:h}}const kb=ls(0);function Lu(t){const r=kt(t);return!nl()||!r.visualViewport?kb:{x:r.visualViewport.offsetLeft,y:r.visualViewport.offsetTop}}function Cb(t,r,n){return r===void 0&&(r=!1),!n||r&&n!==kt(t)?!1:r}function jr(t,r,n,i){r===void 0&&(r=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),d=il(t);let c=ls(1);r&&(i?qt(i)&&(c=zr(i)):c=zr(t));const h=Cb(d,n,i)?Lu(d):ls(0);let u=(o.left+h.x)/c.x,x=(o.top+h.y)/c.y,p=o.width/c.x,b=o.height/c.y;if(d){const g=kt(d),y=i&&qt(i)?kt(i):i;let _=g,w=wo(_);for(;w&&i&&y!==_;){const j=zr(w),C=w.getBoundingClientRect(),S=Gt(w),T=C.left+(w.clientLeft+parseFloat(S.paddingLeft))*j.x,E=C.top+(w.clientTop+parseFloat(S.paddingTop))*j.y;u*=j.x,x*=j.y,p*=j.x,b*=j.y,u+=T,x+=E,_=kt(w),w=wo(_)}}return Zn({width:p,height:b,x:u,y:x})}function li(t,r){const n=oi(t).scrollLeft;return r?r.left+n:jr(us(t)).left+n}function Eu(t,r){const n=t.getBoundingClientRect(),i=n.left+r.scrollLeft-li(t,n),o=n.top+r.scrollTop;return{x:i,y:o}}function Sb(t){let{elements:r,rect:n,offsetParent:i,strategy:o}=t;const d=o==="fixed",c=us(i),h=r?ii(r.floating):!1;if(i===c||h&&d)return n;let u={scrollLeft:0,scrollTop:0},x=ls(1);const p=ls(0),b=ds(i);if((b||!b&&!d)&&((oa(i)!=="body"||Ja(c))&&(u=oi(i)),ds(i))){const y=jr(i);x=zr(i),p.x=y.x+i.clientLeft,p.y=y.y+i.clientTop}const g=c&&!b&&!d?Eu(c,u):ls(0);return{width:n.width*x.x,height:n.height*x.y,x:n.x*x.x-u.scrollLeft*x.x+p.x+g.x,y:n.y*x.y-u.scrollTop*x.y+p.y+g.y}}function Pb(t){return Array.from(t.getClientRects())}function Tb(t){const r=us(t),n=oi(t),i=t.ownerDocument.body,o=Nt(r.scrollWidth,r.clientWidth,i.scrollWidth,i.clientWidth),d=Nt(r.scrollHeight,r.clientHeight,i.scrollHeight,i.clientHeight);let c=-n.scrollLeft+li(t);const h=-n.scrollTop;return Gt(i).direction==="rtl"&&(c+=Nt(r.clientWidth,i.clientWidth)-o),{width:o,height:d,x:c,y:h}}const Yd=25;function Lb(t,r){const n=kt(t),i=us(t),o=n.visualViewport;let d=i.clientWidth,c=i.clientHeight,h=0,u=0;if(o){d=o.width,c=o.height;const p=nl();(!p||p&&r==="fixed")&&(h=o.offsetLeft,u=o.offsetTop)}const x=li(i);if(x<=0){const p=i.ownerDocument,b=p.body,g=getComputedStyle(b),y=p.compatMode==="CSS1Compat"&&parseFloat(g.marginLeft)+parseFloat(g.marginRight)||0,_=Math.abs(i.clientWidth-b.clientWidth-y);_<=Yd&&(d-=_)}else x<=Yd&&(d+=x);return{width:d,height:c,x:h,y:u}}const Eb=new Set(["absolute","fixed"]);function Rb(t,r){const n=jr(t,!0,r==="fixed"),i=n.top+t.clientTop,o=n.left+t.clientLeft,d=ds(t)?zr(t):ls(1),c=t.clientWidth*d.x,h=t.clientHeight*d.y,u=o*d.x,x=i*d.y;return{width:c,height:h,x:u,y:x}}function Xd(t,r,n){let i;if(r==="viewport")i=Lb(t,n);else if(r==="document")i=Tb(us(t));else if(qt(r))i=Rb(r,n);else{const o=Lu(t);i={x:r.x-o.x,y:r.y-o.y,width:r.width,height:r.height}}return Zn(i)}function Ru(t,r){const n=Qs(t);return n===r||!qt(n)||ea(n)?!1:Gt(n).position==="fixed"||Ru(n,r)}function Mb(t,r){const n=r.get(t);if(n)return n;let i=za(t,[],!1).filter(h=>qt(h)&&oa(h)!=="body"),o=null;const d=Gt(t).position==="fixed";let c=d?Qs(t):t;for(;qt(c)&&!ea(c);){const h=Gt(c),u=al(c);!u&&h.position==="fixed"&&(o=null),(d?!u&&!o:!u&&h.position==="static"&&!!o&&Eb.has(o.position)||Ja(c)&&!u&&Ru(t,c))?i=i.filter(p=>p!==c):o=h,c=Qs(c)}return r.set(t,i),i}function Db(t){let{element:r,boundary:n,rootBoundary:i,strategy:o}=t;const c=[...n==="clippingAncestors"?ii(r)?[]:Mb(r,this._c):[].concat(n),i],h=c[0],u=c.reduce((x,p)=>{const b=Xd(r,p,o);return x.top=Nt(b.top,x.top),x.right=Js(b.right,x.right),x.bottom=Js(b.bottom,x.bottom),x.left=Nt(b.left,x.left),x},Xd(r,h,o));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function Ab(t){const{width:r,height:n}=Tu(t);return{width:r,height:n}}function Ob(t,r,n){const i=ds(r),o=us(r),d=n==="fixed",c=jr(t,!0,d,r);let h={scrollLeft:0,scrollTop:0};const u=ls(0);function x(){u.x=li(o)}if(i||!i&&!d)if((oa(r)!=="body"||Ja(o))&&(h=oi(r)),i){const y=jr(r,!0,d,r);u.x=y.x+r.clientLeft,u.y=y.y+r.clientTop}else o&&x();d&&!i&&o&&x();const p=o&&!i&&!d?Eu(o,h):ls(0),b=c.left+h.scrollLeft-u.x-p.x,g=c.top+h.scrollTop-u.y-p.y;return{x:b,y:g,width:c.width,height:c.height}}function Vi(t){return Gt(t).position==="static"}function ec(t,r){if(!ds(t)||Gt(t).position==="fixed")return null;if(r)return r(t);let n=t.offsetParent;return us(t)===n&&(n=n.ownerDocument.body),n}function Mu(t,r){const n=kt(t);if(ii(t))return n;if(!ds(t)){let o=Qs(t);for(;o&&!ea(o);){if(qt(o)&&!Vi(o))return o;o=Qs(o)}return n}let i=ec(t,r);for(;i&&bb(i)&&Vi(i);)i=ec(i,r);return i&&ea(i)&&Vi(i)&&!al(i)?n:i||wb(t)||n}const Ib=async function(t){const r=this.getOffsetParent||Mu,n=this.getDimensions,i=await n(t.floating);return{reference:Ob(t.reference,await r(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function zb(t){return Gt(t).direction==="rtl"}const Fb={convertOffsetParentRelativeRectToViewportRelativeRect:Sb,getDocumentElement:us,getClippingRect:Db,getOffsetParent:Mu,getElementRects:Ib,getClientRects:Pb,getDimensions:Ab,getScale:zr,isElement:qt,isRTL:zb};function Du(t,r){return t.x===r.x&&t.y===r.y&&t.width===r.width&&t.height===r.height}function Bb(t,r){let n=null,i;const o=us(t);function d(){var h;clearTimeout(i),(h=n)==null||h.disconnect(),n=null}function c(h,u){h===void 0&&(h=!1),u===void 0&&(u=1),d();const x=t.getBoundingClientRect(),{left:p,top:b,width:g,height:y}=x;if(h||r(),!g||!y)return;const _=kn(b),w=kn(o.clientWidth-(p+g)),j=kn(o.clientHeight-(b+y)),C=kn(p),T={rootMargin:-_+"px "+-w+"px "+-j+"px "+-C+"px",threshold:Nt(0,Js(1,u))||1};let E=!0;function P(A){const R=A[0].intersectionRatio;if(R!==u){if(!E)return c();R?c(!1,R):i=setTimeout(()=>{c(!1,1e-7)},1e3)}R===1&&!Du(x,t.getBoundingClientRect())&&c(),E=!1}try{n=new IntersectionObserver(P,{...T,root:o.ownerDocument})}catch{n=new IntersectionObserver(P,T)}n.observe(t)}return c(!0),d}function $b(t,r,n,i){i===void 0&&(i={});const{ancestorScroll:o=!0,ancestorResize:d=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:h=typeof IntersectionObserver=="function",animationFrame:u=!1}=i,x=il(t),p=o||d?[...x?za(x):[],...za(r)]:[];p.forEach(C=>{o&&C.addEventListener("scroll",n,{passive:!0}),d&&C.addEventListener("resize",n)});const b=x&&h?Bb(x,n):null;let g=-1,y=null;c&&(y=new ResizeObserver(C=>{let[S]=C;S&&S.target===x&&y&&(y.unobserve(r),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var T;(T=y)==null||T.observe(r)})),n()}),x&&!u&&y.observe(x),y.observe(r));let _,w=u?jr(t):null;u&&j();function j(){const C=jr(t);w&&!Du(w,C)&&n(),w=C,_=requestAnimationFrame(j)}return n(),()=>{var C;p.forEach(S=>{o&&S.removeEventListener("scroll",n),d&&S.removeEventListener("resize",n)}),b==null||b(),(C=y)==null||C.disconnect(),y=null,u&&cancelAnimationFrame(_)}}const Zb=hb,Hb=mb,Ub=db,Wb=pb,Vb=cb,tc=lb,qb=xb,Gb=(t,r,n)=>{const i=new Map,o={platform:Fb,...n},d={...o.platform,_c:i};return ob(t,r,{...o,platform:d})};var Kb=typeof document<"u",Jb=function(){},Ln=Kb?f.useLayoutEffect:Jb;function Hn(t,r){if(t===r)return!0;if(typeof t!=typeof r)return!1;if(typeof t=="function"&&t.toString()===r.toString())return!0;let n,i,o;if(t&&r&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==r.length)return!1;for(i=n;i--!==0;)if(!Hn(t[i],r[i]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(r).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(r,o[i]))return!1;for(i=n;i--!==0;){const d=o[i];if(!(d==="_owner"&&t.$$typeof)&&!Hn(t[d],r[d]))return!1}return!0}return t!==t&&r!==r}function Au(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function sc(t,r){const n=Au(t);return Math.round(r*n)/n}function qi(t){const r=f.useRef(t);return Ln(()=>{r.current=t}),r}function Qb(t){t===void 0&&(t={});const{placement:r="bottom",strategy:n="absolute",middleware:i=[],platform:o,elements:{reference:d,floating:c}={},transform:h=!0,whileElementsMounted:u,open:x}=t,[p,b]=f.useState({x:0,y:0,strategy:n,placement:r,middlewareData:{},isPositioned:!1}),[g,y]=f.useState(i);Hn(g,i)||y(i);const[_,w]=f.useState(null),[j,C]=f.useState(null),S=f.useCallback(W=>{W!==A.current&&(A.current=W,w(W))},[]),T=f.useCallback(W=>{W!==R.current&&(R.current=W,C(W))},[]),E=d||_,P=c||j,A=f.useRef(null),R=f.useRef(null),N=f.useRef(p),M=u!=null,z=qi(u),I=qi(o),F=qi(x),$=f.useCallback(()=>{if(!A.current||!R.current)return;const W={placement:r,strategy:n,middleware:g};I.current&&(W.platform=I.current),Gb(A.current,R.current,W).then(U=>{const q={...U,isPositioned:F.current!==!1};J.current&&!Hn(N.current,q)&&(N.current=q,Vn.flushSync(()=>{b(q)}))})},[g,r,n,I,F]);Ln(()=>{x===!1&&N.current.isPositioned&&(N.current.isPositioned=!1,b(W=>({...W,isPositioned:!1})))},[x]);const J=f.useRef(!1);Ln(()=>(J.current=!0,()=>{J.current=!1}),[]),Ln(()=>{if(E&&(A.current=E),P&&(R.current=P),E&&P){if(z.current)return z.current(E,P,$);$()}},[E,P,$,z,M]);const ee=f.useMemo(()=>({reference:A,floating:R,setReference:S,setFloating:T}),[S,T]),te=f.useMemo(()=>({reference:E,floating:P}),[E,P]),Y=f.useMemo(()=>{const W={position:n,left:0,top:0};if(!te.floating)return W;const U=sc(te.floating,p.x),q=sc(te.floating,p.y);return h?{...W,transform:"translate("+U+"px, "+q+"px)",...Au(te.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:U,top:q}},[n,h,te.floating,p.x,p.y]);return f.useMemo(()=>({...p,update:$,refs:ee,elements:te,floatingStyles:Y}),[p,$,ee,te,Y])}const Yb=t=>{function r(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:o}=typeof t=="function"?t(n):t;return i&&r(i)?i.current!=null?tc({element:i.current,padding:o}).fn(n):{}:i?tc({element:i,padding:o}).fn(n):{}}}},Xb=(t,r)=>({...Zb(t),options:[t,r]}),ey=(t,r)=>({...Hb(t),options:[t,r]}),ty=(t,r)=>({...qb(t),options:[t,r]}),sy=(t,r)=>({...Ub(t),options:[t,r]}),ry=(t,r)=>({...Wb(t),options:[t,r]}),ay=(t,r)=>({...Vb(t),options:[t,r]}),ny=(t,r)=>({...Yb(t),options:[t,r]});var iy="Arrow",Ou=f.forwardRef((t,r)=>{const{children:n,width:i=10,height:o=5,...d}=t;return e.jsx(Cr.svg,{...d,ref:r,width:i,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:e.jsx("polygon",{points:"0,0 30,0 15,10"})})});Ou.displayName=iy;var oy=Ou;function ly(t){const[r,n]=f.useState(void 0);return _r(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const d=o[0];let c,h;if("borderBoxSize"in d){const u=d.borderBoxSize,x=Array.isArray(u)?u[0]:u;c=x.inlineSize,h=x.blockSize}else c=t.offsetWidth,h=t.offsetHeight;n({width:c,height:h})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),r}var ol="Popper",[Iu,zu]=_u(ol),[dy,Fu]=Iu(ol),Bu=t=>{const{__scopePopper:r,children:n}=t,[i,o]=f.useState(null);return e.jsx(dy,{scope:r,anchor:i,onAnchorChange:o,children:n})};Bu.displayName=ol;var $u="PopperAnchor",Zu=f.forwardRef((t,r)=>{const{__scopePopper:n,virtualRef:i,...o}=t,d=Fu($u,n),c=f.useRef(null),h=kr(r,c),u=f.useRef(null);return f.useEffect(()=>{const x=u.current;u.current=(i==null?void 0:i.current)||c.current,x!==u.current&&d.onAnchorChange(u.current)}),i?null:e.jsx(Cr.div,{...o,ref:h})});Zu.displayName=$u;var ll="PopperContent",[cy,uy]=Iu(ll),Hu=f.forwardRef((t,r)=>{var le,Se,xe,Ct,Qt,dt;const{__scopePopper:n,side:i="bottom",sideOffset:o=0,align:d="center",alignOffset:c=0,arrowPadding:h=0,avoidCollisions:u=!0,collisionBoundary:x=[],collisionPadding:p=0,sticky:b="partial",hideWhenDetached:g=!1,updatePositionStrategy:y="optimized",onPlaced:_,...w}=t,j=Fu(ll,n),[C,S]=f.useState(null),T=kr(r,Te=>S(Te)),[E,P]=f.useState(null),A=ly(E),R=(A==null?void 0:A.width)??0,N=(A==null?void 0:A.height)??0,M=i+(d!=="center"?"-"+d:""),z=typeof p=="number"?p:{top:0,right:0,bottom:0,left:0,...p},I=Array.isArray(x)?x:[x],F=I.length>0,$={padding:z,boundary:I.filter(my),altBoundary:F},{refs:J,floatingStyles:ee,placement:te,isPositioned:Y,middlewareData:W}=Qb({strategy:"fixed",placement:M,whileElementsMounted:(...Te)=>$b(...Te,{animationFrame:y==="always"}),elements:{reference:j.anchor},middleware:[Xb({mainAxis:o+N,alignmentAxis:c}),u&&ey({mainAxis:!0,crossAxis:!1,limiter:b==="partial"?ty():void 0,...$}),u&&sy({...$}),ry({...$,apply:({elements:Te,rects:Ot,availableWidth:Q,availableHeight:be})=>{const{width:Le,height:Ie}=Ot.reference,ct=Te.floating.style;ct.setProperty("--radix-popper-available-width",`${Q}px`),ct.setProperty("--radix-popper-available-height",`${be}px`),ct.setProperty("--radix-popper-anchor-width",`${Le}px`),ct.setProperty("--radix-popper-anchor-height",`${Ie}px`)}}),E&&ny({element:E,padding:h}),xy({arrowWidth:R,arrowHeight:N}),g&&ay({strategy:"referenceHidden",...$})]}),[U,q]=Vu(te),K=ai(_);_r(()=>{Y&&(K==null||K())},[Y,K]);const ce=(le=W.arrow)==null?void 0:le.x,V=(Se=W.arrow)==null?void 0:Se.y,ae=((xe=W.arrow)==null?void 0:xe.centerOffset)!==0,[ie,se]=f.useState();return _r(()=>{C&&se(window.getComputedStyle(C).zIndex)},[C]),e.jsx("div",{ref:J.setFloating,"data-radix-popper-content-wrapper":"",style:{...ee,transform:Y?ee.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ie,"--radix-popper-transform-origin":[(Ct=W.transformOrigin)==null?void 0:Ct.x,(Qt=W.transformOrigin)==null?void 0:Qt.y].join(" "),...((dt=W.hide)==null?void 0:dt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:e.jsx(cy,{scope:n,placedSide:U,onArrowChange:P,arrowX:ce,arrowY:V,shouldHideArrow:ae,children:e.jsx(Cr.div,{"data-side":U,"data-align":q,...w,ref:T,style:{...w.style,animation:Y?void 0:"none"}})})})});Hu.displayName=ll;var Uu="PopperArrow",hy={top:"bottom",right:"left",bottom:"top",left:"right"},Wu=f.forwardRef(function(r,n){const{__scopePopper:i,...o}=r,d=uy(Uu,i),c=hy[d.placedSide];return e.jsx("span",{ref:d.onArrowChange,style:{position:"absolute",left:d.arrowX,top:d.arrowY,[c]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[d.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[d.placedSide],visibility:d.shouldHideArrow?"hidden":void 0},children:e.jsx(oy,{...o,ref:n,style:{...o.style,display:"block"}})})});Wu.displayName=Uu;function my(t){return t!==null}var xy=t=>({name:"transformOrigin",options:t,fn(r){var j,C,S;const{placement:n,rects:i,middlewareData:o}=r,c=((j=o.arrow)==null?void 0:j.centerOffset)!==0,h=c?0:t.arrowWidth,u=c?0:t.arrowHeight,[x,p]=Vu(n),b={start:"0%",center:"50%",end:"100%"}[p],g=(((C=o.arrow)==null?void 0:C.x)??0)+h/2,y=(((S=o.arrow)==null?void 0:S.y)??0)+u/2;let _="",w="";return x==="bottom"?(_=c?b:`${g}px`,w=`${-u}px`):x==="top"?(_=c?b:`${g}px`,w=`${i.floating.height+u}px`):x==="right"?(_=`${-u}px`,w=c?b:`${y}px`):x==="left"&&(_=`${i.floating.width+u}px`,w=c?b:`${y}px`),{data:{x:_,y:w}}}});function Vu(t){const[r,n="center"]=t.split("-");return[r,n]}var py=Bu,fy=Zu,gy=Hu,by=Wu;function yy(t,r){return f.useReducer((n,i)=>r[n][i]??n,t)}var qu=t=>{const{present:r,children:n}=t,i=vy(r),o=typeof n=="function"?n({present:i.isPresent}):f.Children.only(n),d=kr(i.ref,_y(o));return typeof n=="function"||i.isPresent?f.cloneElement(o,{ref:d}):null};qu.displayName="Presence";function vy(t){const[r,n]=f.useState(),i=f.useRef(null),o=f.useRef(t),d=f.useRef("none"),c=t?"mounted":"unmounted",[h,u]=yy(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return f.useEffect(()=>{const x=Cn(i.current);d.current=h==="mounted"?x:"none"},[h]),_r(()=>{const x=i.current,p=o.current;if(p!==t){const g=d.current,y=Cn(x);t?u("MOUNT"):y==="none"||(x==null?void 0:x.display)==="none"?u("UNMOUNT"):u(p&&g!==y?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,u]),_r(()=>{if(r){let x;const p=r.ownerDocument.defaultView??window,b=y=>{const w=Cn(i.current).includes(CSS.escape(y.animationName));if(y.target===r&&w&&(u("ANIMATION_END"),!o.current)){const j=r.style.animationFillMode;r.style.animationFillMode="forwards",x=p.setTimeout(()=>{r.style.animationFillMode==="forwards"&&(r.style.animationFillMode=j)})}},g=y=>{y.target===r&&(d.current=Cn(i.current))};return r.addEventListener("animationstart",g),r.addEventListener("animationcancel",b),r.addEventListener("animationend",b),()=>{p.clearTimeout(x),r.removeEventListener("animationstart",g),r.removeEventListener("animationcancel",b),r.removeEventListener("animationend",b)}}else u("ANIMATION_END")},[r,u]),{isPresent:["mounted","unmountSuspended"].includes(h),ref:f.useCallback(x=>{i.current=x?getComputedStyle(x):null,n(x)},[])}}function Cn(t){return(t==null?void 0:t.animationName)||"none"}function _y(t){var i,o;let r=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=r&&"isReactWarning"in r&&r.isReactWarning;return n?t.ref:(r=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,n=r&&"isReactWarning"in r&&r.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var jy=Symbol("radix.slottable");function wy(t){const r=({children:n})=>e.jsx(e.Fragment,{children:n});return r.displayName=`${t}.Slottable`,r.__radixId=jy,r}var Ny=jc[" useInsertionEffect ".trim().toString()]||_r;function ky({prop:t,defaultProp:r,onChange:n=()=>{},caller:i}){const[o,d,c]=Cy({defaultProp:r,onChange:n}),h=t!==void 0,u=h?t:o;{const p=f.useRef(t!==void 0);f.useEffect(()=>{const b=p.current;b!==h&&console.warn(`${i} is changing from ${b?"controlled":"uncontrolled"} to ${h?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=h},[h,i])}const x=f.useCallback(p=>{var b;if(h){const g=Sy(p)?p(t):p;g!==t&&((b=c.current)==null||b.call(c,g))}else d(p)},[h,t,d,c]);return[u,x]}function Cy({defaultProp:t,onChange:r}){const[n,i]=f.useState(t),o=f.useRef(n),d=f.useRef(r);return Ny(()=>{d.current=r},[r]),f.useEffect(()=>{var c;o.current!==n&&((c=d.current)==null||c.call(d,n),o.current=n)},[n,o]),[n,i,d]}function Sy(t){return typeof t=="function"}var Py=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Ty="VisuallyHidden",Gu=f.forwardRef((t,r)=>e.jsx(Cr.span,{...t,ref:r,style:{...Py,...t.style}}));Gu.displayName=Ty;var Ly=Gu,[di]=_u("Tooltip",[zu]),ci=zu(),Ku="TooltipProvider",Ey=700,No="tooltip.open",[Ry,dl]=di(Ku),Ju=t=>{const{__scopeTooltip:r,delayDuration:n=Ey,skipDelayDuration:i=300,disableHoverableContent:o=!1,children:d}=t,c=f.useRef(!0),h=f.useRef(!1),u=f.useRef(0);return f.useEffect(()=>{const x=u.current;return()=>window.clearTimeout(x)},[]),e.jsx(Ry,{scope:r,isOpenDelayedRef:c,delayDuration:n,onOpen:f.useCallback(()=>{window.clearTimeout(u.current),c.current=!1},[]),onClose:f.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>c.current=!0,i)},[i]),isPointerInTransitRef:h,onPointerInTransitChange:f.useCallback(x=>{h.current=x},[]),disableHoverableContent:o,children:d})};Ju.displayName=Ku;var Fa="Tooltip",[My,ui]=di(Fa),Qu=t=>{const{__scopeTooltip:r,children:n,open:i,defaultOpen:o,onOpenChange:d,disableHoverableContent:c,delayDuration:h}=t,u=dl(Fa,t.__scopeTooltip),x=ci(r),[p,b]=f.useState(null),g=K0(),y=f.useRef(0),_=c??u.disableHoverableContent,w=h??u.delayDuration,j=f.useRef(!1),[C,S]=ky({prop:i,defaultProp:o??!1,onChange:R=>{R?(u.onOpen(),document.dispatchEvent(new CustomEvent(No))):u.onClose(),d==null||d(R)},caller:Fa}),T=f.useMemo(()=>C?j.current?"delayed-open":"instant-open":"closed",[C]),E=f.useCallback(()=>{window.clearTimeout(y.current),y.current=0,j.current=!1,S(!0)},[S]),P=f.useCallback(()=>{window.clearTimeout(y.current),y.current=0,S(!1)},[S]),A=f.useCallback(()=>{window.clearTimeout(y.current),y.current=window.setTimeout(()=>{j.current=!0,S(!0),y.current=0},w)},[w,S]);return f.useEffect(()=>()=>{y.current&&(window.clearTimeout(y.current),y.current=0)},[]),e.jsx(py,{...x,children:e.jsx(My,{scope:r,contentId:g,open:C,stateAttribute:T,trigger:p,onTriggerChange:b,onTriggerEnter:f.useCallback(()=>{u.isOpenDelayedRef.current?A():E()},[u.isOpenDelayedRef,A,E]),onTriggerLeave:f.useCallback(()=>{_?P():(window.clearTimeout(y.current),y.current=0)},[P,_]),onOpen:E,onClose:P,disableHoverableContent:_,children:n})})};Qu.displayName=Fa;var ko="TooltipTrigger",Yu=f.forwardRef((t,r)=>{const{__scopeTooltip:n,...i}=t,o=ui(ko,n),d=dl(ko,n),c=ci(n),h=f.useRef(null),u=kr(r,h,o.onTriggerChange),x=f.useRef(!1),p=f.useRef(!1),b=f.useCallback(()=>x.current=!1,[]);return f.useEffect(()=>()=>document.removeEventListener("pointerup",b),[b]),e.jsx(fy,{asChild:!0,...c,children:e.jsx(Cr.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...i,ref:u,onPointerMove:vs(t.onPointerMove,g=>{g.pointerType!=="touch"&&!p.current&&!d.isPointerInTransitRef.current&&(o.onTriggerEnter(),p.current=!0)}),onPointerLeave:vs(t.onPointerLeave,()=>{o.onTriggerLeave(),p.current=!1}),onPointerDown:vs(t.onPointerDown,()=>{o.open&&o.onClose(),x.current=!0,document.addEventListener("pointerup",b,{once:!0})}),onFocus:vs(t.onFocus,()=>{x.current||o.onOpen()}),onBlur:vs(t.onBlur,o.onClose),onClick:vs(t.onClick,o.onClose)})})});Yu.displayName=ko;var Dy="TooltipPortal",[xj,Ay]=di(Dy,{forceMount:void 0}),ta="TooltipContent",Xu=f.forwardRef((t,r)=>{const n=Ay(ta,t.__scopeTooltip),{forceMount:i=n.forceMount,side:o="top",...d}=t,c=ui(ta,t.__scopeTooltip);return e.jsx(qu,{present:i||c.open,children:c.disableHoverableContent?e.jsx(eh,{side:o,...d,ref:r}):e.jsx(Oy,{side:o,...d,ref:r})})}),Oy=f.forwardRef((t,r)=>{const n=ui(ta,t.__scopeTooltip),i=dl(ta,t.__scopeTooltip),o=f.useRef(null),d=kr(r,o),[c,h]=f.useState(null),{trigger:u,onClose:x}=n,p=o.current,{onPointerInTransitChange:b}=i,g=f.useCallback(()=>{h(null),b(!1)},[b]),y=f.useCallback((_,w)=>{const j=_.currentTarget,C={x:_.clientX,y:_.clientY},S=$y(C,j.getBoundingClientRect()),T=Zy(C,S),E=Hy(w.getBoundingClientRect()),P=Wy([...T,...E]);h(P),b(!0)},[b]);return f.useEffect(()=>()=>g(),[g]),f.useEffect(()=>{if(u&&p){const _=j=>y(j,p),w=j=>y(j,u);return u.addEventListener("pointerleave",_),p.addEventListener("pointerleave",w),()=>{u.removeEventListener("pointerleave",_),p.removeEventListener("pointerleave",w)}}},[u,p,y,g]),f.useEffect(()=>{if(c){const _=w=>{const j=w.target,C={x:w.clientX,y:w.clientY},S=(u==null?void 0:u.contains(j))||(p==null?void 0:p.contains(j)),T=!Uy(C,c);S?g():T&&(g(),x())};return document.addEventListener("pointermove",_),()=>document.removeEventListener("pointermove",_)}},[u,p,c,x,g]),e.jsx(eh,{...t,ref:d})}),[Iy,zy]=di(Fa,{isInside:!1}),Fy=wy("TooltipContent"),eh=f.forwardRef((t,r)=>{const{__scopeTooltip:n,children:i,"aria-label":o,onEscapeKeyDown:d,onPointerDownOutside:c,...h}=t,u=ui(ta,n),x=ci(n),{onClose:p}=u;return f.useEffect(()=>(document.addEventListener(No,p),()=>document.removeEventListener(No,p)),[p]),f.useEffect(()=>{if(u.trigger){const b=g=>{const y=g.target;y!=null&&y.contains(u.trigger)&&p()};return window.addEventListener("scroll",b,{capture:!0}),()=>window.removeEventListener("scroll",b,{capture:!0})}},[u.trigger,p]),e.jsx(wu,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:b=>b.preventDefault(),onDismiss:p,children:e.jsxs(gy,{"data-state":u.stateAttribute,...x,...h,ref:r,style:{...h.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(Fy,{children:i}),e.jsx(Iy,{scope:n,isInside:!0,children:e.jsx(Ly,{id:u.contentId,role:"tooltip",children:o||i})})]})})});Xu.displayName=ta;var th="TooltipArrow",By=f.forwardRef((t,r)=>{const{__scopeTooltip:n,...i}=t,o=ci(n);return zy(th,n).isInside?null:e.jsx(by,{...o,...i,ref:r})});By.displayName=th;function $y(t,r){const n=Math.abs(r.top-t.y),i=Math.abs(r.bottom-t.y),o=Math.abs(r.right-t.x),d=Math.abs(r.left-t.x);switch(Math.min(n,i,o,d)){case d:return"left";case o:return"right";case n:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function Zy(t,r,n=5){const i=[];switch(r){case"top":i.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":i.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":i.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":i.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return i}function Hy(t){const{top:r,right:n,bottom:i,left:o}=t;return[{x:o,y:r},{x:n,y:r},{x:n,y:i},{x:o,y:i}]}function Uy(t,r){const{x:n,y:i}=t;let o=!1;for(let d=0,c=r.length-1;d<r.length;c=d++){const h=r[d],u=r[c],x=h.x,p=h.y,b=u.x,g=u.y;p>i!=g>i&&n<(b-x)*(i-p)/(g-p)+x&&(o=!o)}return o}function Wy(t){const r=t.slice();return r.sort((n,i)=>n.x<i.x?-1:n.x>i.x?1:n.y<i.y?-1:n.y>i.y?1:0),Vy(r)}function Vy(t){if(t.length<=1)return t.slice();const r=[];for(let i=0;i<t.length;i++){const o=t[i];for(;r.length>=2;){const d=r[r.length-1],c=r[r.length-2];if((d.x-c.x)*(o.y-c.y)>=(d.y-c.y)*(o.x-c.x))r.pop();else break}r.push(o)}r.pop();const n=[];for(let i=t.length-1;i>=0;i--){const o=t[i];for(;n.length>=2;){const d=n[n.length-1],c=n[n.length-2];if((d.x-c.x)*(o.y-c.y)>=(d.y-c.y)*(o.x-c.x))n.pop();else break}n.push(o)}return n.pop(),r.length===1&&n.length===1&&r[0].x===n[0].x&&r[0].y===n[0].y?r:r.concat(n)}var qy=Ju,Gy=Qu,Ky=Yu,sh=Xu;const cl="-",Jy=t=>{const r=Yy(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:c=>{const h=c.split(cl);return h[0]===""&&h.length!==1&&h.shift(),rh(h,r)||Qy(c)},getConflictingClassGroupIds:(c,h)=>{const u=n[c]||[];return h&&i[c]?[...u,...i[c]]:u}}},rh=(t,r)=>{var c;if(t.length===0)return r.classGroupId;const n=t[0],i=r.nextPart.get(n),o=i?rh(t.slice(1),i):void 0;if(o)return o;if(r.validators.length===0)return;const d=t.join(cl);return(c=r.validators.find(({validator:h})=>h(d)))==null?void 0:c.classGroupId},rc=/^\[(.+)\]$/,Qy=t=>{if(rc.test(t)){const r=rc.exec(t)[1],n=r==null?void 0:r.substring(0,r.indexOf(":"));if(n)return"arbitrary.."+n}},Yy=t=>{const{theme:r,prefix:n}=t,i={nextPart:new Map,validators:[]};return ev(Object.entries(t.classGroups),n).forEach(([d,c])=>{Co(c,i,d,r)}),i},Co=(t,r,n,i)=>{t.forEach(o=>{if(typeof o=="string"){const d=o===""?r:ac(r,o);d.classGroupId=n;return}if(typeof o=="function"){if(Xy(o)){Co(o(i),r,n,i);return}r.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([d,c])=>{Co(c,ac(r,d),n,i)})})},ac=(t,r)=>{let n=t;return r.split(cl).forEach(i=>{n.nextPart.has(i)||n.nextPart.set(i,{nextPart:new Map,validators:[]}),n=n.nextPart.get(i)}),n},Xy=t=>t.isThemeGetter,ev=(t,r)=>r?t.map(([n,i])=>{const o=i.map(d=>typeof d=="string"?r+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(([c,h])=>[r+c,h])):d);return[n,o]}):t,tv=t=>{if(t<1)return{get:()=>{},set:()=>{}};let r=0,n=new Map,i=new Map;const o=(d,c)=>{n.set(d,c),r++,r>t&&(r=0,i=n,n=new Map)};return{get(d){let c=n.get(d);if(c!==void 0)return c;if((c=i.get(d))!==void 0)return o(d,c),c},set(d,c){n.has(d)?n.set(d,c):o(d,c)}}},ah="!",sv=t=>{const{separator:r,experimentalParseClassName:n}=t,i=r.length===1,o=r[0],d=r.length,c=h=>{const u=[];let x=0,p=0,b;for(let j=0;j<h.length;j++){let C=h[j];if(x===0){if(C===o&&(i||h.slice(j,j+d)===r)){u.push(h.slice(p,j)),p=j+d;continue}if(C==="/"){b=j;continue}}C==="["?x++:C==="]"&&x--}const g=u.length===0?h:h.substring(p),y=g.startsWith(ah),_=y?g.substring(1):g,w=b&&b>p?b-p:void 0;return{modifiers:u,hasImportantModifier:y,baseClassName:_,maybePostfixModifierPosition:w}};return n?h=>n({className:h,parseClassName:c}):c},rv=t=>{if(t.length<=1)return t;const r=[];let n=[];return t.forEach(i=>{i[0]==="["?(r.push(...n.sort(),i),n=[]):n.push(i)}),r.push(...n.sort()),r},av=t=>({cache:tv(t.cacheSize),parseClassName:sv(t),...Jy(t)}),nv=/\s+/,iv=(t,r)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:o}=r,d=[],c=t.trim().split(nv);let h="";for(let u=c.length-1;u>=0;u-=1){const x=c[u],{modifiers:p,hasImportantModifier:b,baseClassName:g,maybePostfixModifierPosition:y}=n(x);let _=!!y,w=i(_?g.substring(0,y):g);if(!w){if(!_){h=x+(h.length>0?" "+h:h);continue}if(w=i(g),!w){h=x+(h.length>0?" "+h:h);continue}_=!1}const j=rv(p).join(":"),C=b?j+ah:j,S=C+w;if(d.includes(S))continue;d.push(S);const T=o(w,_);for(let E=0;E<T.length;++E){const P=T[E];d.push(C+P)}h=x+(h.length>0?" "+h:h)}return h};function ov(){let t=0,r,n,i="";for(;t<arguments.length;)(r=arguments[t++])&&(n=nh(r))&&(i&&(i+=" "),i+=n);return i}const nh=t=>{if(typeof t=="string")return t;let r,n="";for(let i=0;i<t.length;i++)t[i]&&(r=nh(t[i]))&&(n&&(n+=" "),n+=r);return n};function lv(t,...r){let n,i,o,d=c;function c(u){const x=r.reduce((p,b)=>b(p),t());return n=av(x),i=n.cache.get,o=n.cache.set,d=h,h(u)}function h(u){const x=i(u);if(x)return x;const p=iv(u,n);return o(u,p),p}return function(){return d(ov.apply(null,arguments))}}const Re=t=>{const r=n=>n[t]||[];return r.isThemeGetter=!0,r},ih=/^\[(?:([a-z-]+):)?(.+)\]$/i,dv=/^\d+\/\d+$/,cv=new Set(["px","full","screen"]),uv=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,hv=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,mv=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,xv=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,pv=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,fs=t=>Fr(t)||cv.has(t)||dv.test(t),Ds=t=>la(t,"length",wv),Fr=t=>!!t&&!Number.isNaN(Number(t)),Gi=t=>la(t,"number",Fr),ka=t=>!!t&&Number.isInteger(Number(t)),fv=t=>t.endsWith("%")&&Fr(t.slice(0,-1)),fe=t=>ih.test(t),As=t=>uv.test(t),gv=new Set(["length","size","percentage"]),bv=t=>la(t,gv,oh),yv=t=>la(t,"position",oh),vv=new Set(["image","url"]),_v=t=>la(t,vv,kv),jv=t=>la(t,"",Nv),Ca=()=>!0,la=(t,r,n)=>{const i=ih.exec(t);return i?i[1]?typeof r=="string"?i[1]===r:r.has(i[1]):n(i[2]):!1},wv=t=>hv.test(t)&&!mv.test(t),oh=()=>!1,Nv=t=>xv.test(t),kv=t=>pv.test(t),Cv=()=>{const t=Re("colors"),r=Re("spacing"),n=Re("blur"),i=Re("brightness"),o=Re("borderColor"),d=Re("borderRadius"),c=Re("borderSpacing"),h=Re("borderWidth"),u=Re("contrast"),x=Re("grayscale"),p=Re("hueRotate"),b=Re("invert"),g=Re("gap"),y=Re("gradientColorStops"),_=Re("gradientColorStopPositions"),w=Re("inset"),j=Re("margin"),C=Re("opacity"),S=Re("padding"),T=Re("saturate"),E=Re("scale"),P=Re("sepia"),A=Re("skew"),R=Re("space"),N=Re("translate"),M=()=>["auto","contain","none"],z=()=>["auto","hidden","clip","visible","scroll"],I=()=>["auto",fe,r],F=()=>[fe,r],$=()=>["",fs,Ds],J=()=>["auto",Fr,fe],ee=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],te=()=>["solid","dashed","dotted","double","none"],Y=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],W=()=>["start","end","center","between","around","evenly","stretch"],U=()=>["","0",fe],q=()=>["auto","avoid","all","avoid-page","page","left","right","column"],K=()=>[Fr,fe];return{cacheSize:500,separator:":",theme:{colors:[Ca],spacing:[fs,Ds],blur:["none","",As,fe],brightness:K(),borderColor:[t],borderRadius:["none","","full",As,fe],borderSpacing:F(),borderWidth:$(),contrast:K(),grayscale:U(),hueRotate:K(),invert:U(),gap:F(),gradientColorStops:[t],gradientColorStopPositions:[fv,Ds],inset:I(),margin:I(),opacity:K(),padding:F(),saturate:K(),scale:K(),sepia:U(),skew:K(),space:F(),translate:F()},classGroups:{aspect:[{aspect:["auto","square","video",fe]}],container:["container"],columns:[{columns:[As]}],"break-after":[{"break-after":q()}],"break-before":[{"break-before":q()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ee(),fe]}],overflow:[{overflow:z()}],"overflow-x":[{"overflow-x":z()}],"overflow-y":[{"overflow-y":z()}],overscroll:[{overscroll:M()}],"overscroll-x":[{"overscroll-x":M()}],"overscroll-y":[{"overscroll-y":M()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[w]}],"inset-x":[{"inset-x":[w]}],"inset-y":[{"inset-y":[w]}],start:[{start:[w]}],end:[{end:[w]}],top:[{top:[w]}],right:[{right:[w]}],bottom:[{bottom:[w]}],left:[{left:[w]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",ka,fe]}],basis:[{basis:I()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",fe]}],grow:[{grow:U()}],shrink:[{shrink:U()}],order:[{order:["first","last","none",ka,fe]}],"grid-cols":[{"grid-cols":[Ca]}],"col-start-end":[{col:["auto",{span:["full",ka,fe]},fe]}],"col-start":[{"col-start":J()}],"col-end":[{"col-end":J()}],"grid-rows":[{"grid-rows":[Ca]}],"row-start-end":[{row:["auto",{span:[ka,fe]},fe]}],"row-start":[{"row-start":J()}],"row-end":[{"row-end":J()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",fe]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",fe]}],gap:[{gap:[g]}],"gap-x":[{"gap-x":[g]}],"gap-y":[{"gap-y":[g]}],"justify-content":[{justify:["normal",...W()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...W(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...W(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[S]}],px:[{px:[S]}],py:[{py:[S]}],ps:[{ps:[S]}],pe:[{pe:[S]}],pt:[{pt:[S]}],pr:[{pr:[S]}],pb:[{pb:[S]}],pl:[{pl:[S]}],m:[{m:[j]}],mx:[{mx:[j]}],my:[{my:[j]}],ms:[{ms:[j]}],me:[{me:[j]}],mt:[{mt:[j]}],mr:[{mr:[j]}],mb:[{mb:[j]}],ml:[{ml:[j]}],"space-x":[{"space-x":[R]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[R]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",fe,r]}],"min-w":[{"min-w":[fe,r,"min","max","fit"]}],"max-w":[{"max-w":[fe,r,"none","full","min","max","fit","prose",{screen:[As]},As]}],h:[{h:[fe,r,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[fe,r,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[fe,r,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[fe,r,"auto","min","max","fit"]}],"font-size":[{text:["base",As,Ds]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Gi]}],"font-family":[{font:[Ca]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",fe]}],"line-clamp":[{"line-clamp":["none",Fr,Gi]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",fs,fe]}],"list-image":[{"list-image":["none",fe]}],"list-style-type":[{list:["none","disc","decimal",fe]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[C]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[C]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...te(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",fs,Ds]}],"underline-offset":[{"underline-offset":["auto",fs,fe]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:F()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",fe]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",fe]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[C]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ee(),yv]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",bv]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},_v]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[_]}],"gradient-via-pos":[{via:[_]}],"gradient-to-pos":[{to:[_]}],"gradient-from":[{from:[y]}],"gradient-via":[{via:[y]}],"gradient-to":[{to:[y]}],rounded:[{rounded:[d]}],"rounded-s":[{"rounded-s":[d]}],"rounded-e":[{"rounded-e":[d]}],"rounded-t":[{"rounded-t":[d]}],"rounded-r":[{"rounded-r":[d]}],"rounded-b":[{"rounded-b":[d]}],"rounded-l":[{"rounded-l":[d]}],"rounded-ss":[{"rounded-ss":[d]}],"rounded-se":[{"rounded-se":[d]}],"rounded-ee":[{"rounded-ee":[d]}],"rounded-es":[{"rounded-es":[d]}],"rounded-tl":[{"rounded-tl":[d]}],"rounded-tr":[{"rounded-tr":[d]}],"rounded-br":[{"rounded-br":[d]}],"rounded-bl":[{"rounded-bl":[d]}],"border-w":[{border:[h]}],"border-w-x":[{"border-x":[h]}],"border-w-y":[{"border-y":[h]}],"border-w-s":[{"border-s":[h]}],"border-w-e":[{"border-e":[h]}],"border-w-t":[{"border-t":[h]}],"border-w-r":[{"border-r":[h]}],"border-w-b":[{"border-b":[h]}],"border-w-l":[{"border-l":[h]}],"border-opacity":[{"border-opacity":[C]}],"border-style":[{border:[...te(),"hidden"]}],"divide-x":[{"divide-x":[h]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[h]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[C]}],"divide-style":[{divide:te()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...te()]}],"outline-offset":[{"outline-offset":[fs,fe]}],"outline-w":[{outline:[fs,Ds]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:$()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[C]}],"ring-offset-w":[{"ring-offset":[fs,Ds]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",As,jv]}],"shadow-color":[{shadow:[Ca]}],opacity:[{opacity:[C]}],"mix-blend":[{"mix-blend":[...Y(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Y()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[i]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",As,fe]}],grayscale:[{grayscale:[x]}],"hue-rotate":[{"hue-rotate":[p]}],invert:[{invert:[b]}],saturate:[{saturate:[T]}],sepia:[{sepia:[P]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[x]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[p]}],"backdrop-invert":[{"backdrop-invert":[b]}],"backdrop-opacity":[{"backdrop-opacity":[C]}],"backdrop-saturate":[{"backdrop-saturate":[T]}],"backdrop-sepia":[{"backdrop-sepia":[P]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[c]}],"border-spacing-x":[{"border-spacing-x":[c]}],"border-spacing-y":[{"border-spacing-y":[c]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",fe]}],duration:[{duration:K()}],ease:[{ease:["linear","in","out","in-out",fe]}],delay:[{delay:K()}],animate:[{animate:["none","spin","ping","pulse","bounce",fe]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[E]}],"scale-x":[{"scale-x":[E]}],"scale-y":[{"scale-y":[E]}],rotate:[{rotate:[ka,fe]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[A]}],"skew-y":[{"skew-y":[A]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",fe]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",fe]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":F()}],"scroll-mx":[{"scroll-mx":F()}],"scroll-my":[{"scroll-my":F()}],"scroll-ms":[{"scroll-ms":F()}],"scroll-me":[{"scroll-me":F()}],"scroll-mt":[{"scroll-mt":F()}],"scroll-mr":[{"scroll-mr":F()}],"scroll-mb":[{"scroll-mb":F()}],"scroll-ml":[{"scroll-ml":F()}],"scroll-p":[{"scroll-p":F()}],"scroll-px":[{"scroll-px":F()}],"scroll-py":[{"scroll-py":F()}],"scroll-ps":[{"scroll-ps":F()}],"scroll-pe":[{"scroll-pe":F()}],"scroll-pt":[{"scroll-pt":F()}],"scroll-pr":[{"scroll-pr":F()}],"scroll-pb":[{"scroll-pb":F()}],"scroll-pl":[{"scroll-pl":F()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",fe]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[fs,Ds,Gi]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Sv=lv(Cv);function Pv(...t){return Sv($m(t))}const lh=qy,So=Gy,Po=Ky,Un=f.forwardRef(({className:t,sideOffset:r=4,...n},i)=>e.jsx(sh,{ref:i,sideOffset:r,className:Pv("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 bg-gray-900 text-white",t),...n}));Un.displayName=sh.displayName;const nc=220,ic=100,Tv=({data:t})=>{const r=t.is_leaf,n=t.value.reduce((d,c)=>d+c,0),i=Math.max(...t.value),o=n>0?i/n*100:0;return e.jsxs("div",{className:`px-4 py-3 shadow-md rounded-md border-2 ${r?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-blue-500 bg-white dark:bg-gray-800"} min-w-[200px]`,children:[e.jsx(An,{type:"target",position:Ks.Left,className:"w-3 h-3 !bg-gray-400"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"font-bold text-sm text-gray-900 dark:text-white border-b pb-1 mb-1",children:r?e.jsxs("span",{className:"flex items-center gap-2 text-green-700 dark:text-green-400",children:[e.jsx(at,{className:"w-4 h-4"}),"Prediction: ",t.class_name]}):e.jsxs("span",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-400",children:[e.jsx(dx,{className:"w-4 h-4"}),t.feature," ",t.threshold!==void 0?`<= ${t.threshold.toFixed(2)}`:""]})}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs(lh,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(So,{children:[e.jsx(Po,{asChild:!0,children:e.jsx("span",{className:"cursor-help border-b border-dotted border-gray-400",children:"Samples:"})}),e.jsx(Un,{children:e.jsx("p",{children:"The number of data points that fall into this rule bucket."})})]}),e.jsx("span",{className:"font-mono",children:t.samples})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(So,{children:[e.jsx(Po,{asChild:!0,children:e.jsx("span",{className:"cursor-help border-b border-dotted border-gray-400",children:"Purity:"})}),e.jsx(Un,{children:e.jsx("p",{className:"max-w-xs",children:"The percentage of samples in this node that belong to the majority class. Higher purity means a clearer separation."})})]}),e.jsxs("span",{className:`font-mono ${o>80?"text-green-600 font-bold":""}`,children:[o.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 rounded-full mt-1 overflow-hidden flex",children:t.value.map((d,c)=>e.jsx("div",{style:{width:`${d/n*100}%`,backgroundColor:`hsl(${c*137.5}, 70%, 50%)`},title:`Class ${c}: ${d}`},c))})]})]}),e.jsx(An,{type:"source",position:Ks.Right,className:"w-3 h-3 !bg-gray-400"})]})},Lv={decision:Tv},Ev=({tree:t})=>{const[r,n,i]=Ac([]),[o,d,c]=Oc([]),h=f.useCallback((u,x)=>{try{const p=new Mn.graphlib.Graph;return p.setDefaultEdgeLabel(()=>({})),p.setGraph({rankdir:"LR",nodesep:50,ranksep:150}),u.forEach(g=>{p.setNode(g.id,{width:nc,height:ic})}),x.forEach(g=>{p.setEdge(g.source,g.target)}),Mn.layout(p),{nodes:u.map(g=>{const y=p.node(g.id);return{...g,targetPosition:Ks.Left,sourcePosition:Ks.Right,position:{x:y?y.x-nc/2:0,y:y?y.y-ic/2:0}}}),edges:x}}catch(p){return console.error("Dagre layout failed:",p),{nodes:u,edges:x}}},[]);return f.useEffect(()=>{if(!t||!t.nodes||t.nodes.length===0)return;const u=t.nodes.map(b=>({id:b.id.toString(),type:"decision",data:{...b},position:{x:0,y:0}})),x=[];t.nodes.forEach(b=>{b.children&&b.children.length>0&&(b.children[0]!==void 0&&x.push({id:`e${b.id}-${b.children[0]}`,source:b.id.toString(),target:b.children[0].toString(),label:"True",type:"smoothstep",style:{stroke:"#22c55e",strokeWidth:2},labelStyle:{fill:"#22c55e",fontWeight:700},markerEnd:{type:On.ArrowClosed,color:"#22c55e"}}),b.children[1]!==void 0&&x.push({id:`e${b.id}-${b.children[1]}`,source:b.id.toString(),target:b.children[1].toString(),label:"False",type:"smoothstep",style:{stroke:"#ef4444",strokeWidth:2},labelStyle:{fill:"#ef4444",fontWeight:700},markerEnd:{type:On.ArrowClosed,color:"#ef4444"}}))});const p=h(u,x);n(p.nodes),d(p.edges)},[t,h,n,d]),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{style:{width:"100%",height:"600px"},className:"border rounded-lg bg-gray-50 dark:bg-gray-900 relative",children:e.jsxs(zo,{nodes:r,edges:o,onNodesChange:i,onEdgesChange:c,nodeTypes:Lv,fitView:!0,className:"dark:bg-gray-900",children:[e.jsx(Fo,{className:"dark:bg-gray-900",gap:16,size:1}),e.jsx(Bo,{className:"dark:bg-gray-800 dark:text-white dark:border-gray-700"})]})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic flex items-center gap-1",children:[e.jsx(Kt,{className:"w-3 h-3"}),"This tree is a ",e.jsx("strong",{children:"Surrogate Model"})," trained on your data to discover rules. Green paths indicate the condition is met (True), Red paths indicate it is not (False)."]})]})},Rv=({profile:t})=>{const r=t==null?void 0:t.rule_tree;return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ra,{className:"w-5 h-5 text-blue-600"}),"Decision Tree Analysis"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Visualize how different features combine to predict the target. This tree helps identify key segments and decision rules in your data."})]}),r.accuracy&&e.jsx(lh,{children:e.jsxs(So,{children:[e.jsx(Po,{asChild:!0,children:e.jsxs("div",{className:"text-sm bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full border border-blue-200 dark:border-blue-800 cursor-help",children:["Tree Fidelity: ",e.jsxs("strong",{children:[(r.accuracy*100).toFixed(1),"%"]})]})}),e.jsx(Un,{children:e.jsxs("p",{className:"max-w-xs",children:[e.jsx("strong",{children:"Tree Fidelity (Accuracy):"})," Indicates how well this simplified tree mimics the patterns in your dataset. A higher percentage means these rules are more reliable."]})})]})})]}),e.jsx(Ev,{tree:r})]}),r.feature_importances&&r.feature_importances.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Qn,{className:"w-5 h-5 text-blue-600"}),"Feature Importance (Surrogate Model)"]}),e.jsx("div",{className:"h-80 w-full",children:e.jsx(rt,{width:"100%",height:"100%",children:e.jsxs(os,{data:r.feature_importances.slice(0,10),layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(vt,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#e5e7eb"}),e.jsx(_t,{type:"number",domain:[0,"auto"],hide:!0}),e.jsx(jt,{dataKey:"feature",type:"category",width:150,tick:{fontSize:12,fill:"#6b7280"},interval:0}),e.jsx(it,{formatter:n=>[(n*100).toFixed(1)+"%","Importance"],contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:"8px",border:"1px solid #e5e7eb",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},cursor:{fill:"transparent"}}),e.jsx(Mt,{dataKey:"importance",radius:[0,4,4,0],barSize:20,children:r.feature_importances.slice(0,10).map((n,i)=>e.jsx(Ea,{fill:`hsl(217, 91%, ${60-i*3}%)`},`cell-${i}`))})]})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:"Showing top 10 features driving the decision rules."})]}),r.rules&&r.rules.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-900 dark:text-white mb-4",children:"Extracted Rules"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:r.rules.map((n,i)=>e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded border border-gray-100 dark:border-gray-700 text-sm font-mono text-gray-700 dark:text-gray-300",children:n},i))})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-8",children:[e.jsx(Ra,{className:"w-12 h-12 mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Decision Tree Not Available"}),e.jsx("p",{className:"text-center max-w-md mb-4",children:"No tree was generated. This usually happens if the dataset is too small, or if a target column was not selected for analysis."}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600 bg-amber-50 dark:bg-amber-900/20 dark:text-amber-400 px-4 py-2 rounded-md",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsxs("span",{children:["Ensure you have selected a ",e.jsx("strong",{children:"Target Column"})," and re-run the analysis."]})]})]})},Sn={},Mv=({datasetId:t,measureCol:r,measureAgg:n,columns:i,initialFilters:o})=>{const[d,c]=f.useState([]),[h,u]=f.useState(!1),[x,p]=f.useState(null),[b,g]=f.useState([null]),y=f.useRef(null),_=f.useRef(null),[w,j]=f.useState([]);f.useEffect(()=>{y.current&&y.current.scrollTo({left:y.current.scrollWidth,behavior:"smooth"})},[d.length]);const C=()=>{if(!_.current)return;const R=[],N=_.current.getBoundingClientRect();d.forEach((M,z)=>{if(z>=d.length-1)return;const I=M.selectedItemName;if(!I)return;const F=`node-${z}-${I}`,$=document.getElementById(F);if($){const J=$.getBoundingClientRect(),ee=J.right-N.left,te=J.top+J.height/2-N.top;let Y,W;const U=d[z+1];if(U.selectedItemName){const q=`node-${z+1}-${U.selectedItemName}`,K=document.getElementById(q);if(K){const ce=K.getBoundingClientRect();Y=ce.left-N.left,W=ce.top+ce.height/2-N.top}else return}else{const q=`list-${z+1}`,K=document.getElementById(q);if(K){const ce=K.getBoundingClientRect();Y=ce.left-N.left,W=ce.top+ce.height/2-N.top}else return}if(Y!==void 0&&W!==void 0){const q=(ee+Y)/2,K=`M ${ee} ${te} C ${q} ${te}, ${q} ${W}, ${Y} ${W}`;R.push({d:K})}}}),j(R)};pt.useLayoutEffect(()=>{C()},[d,x]),f.useEffect(()=>{if(d.length>0){const R=`${t}-${r}-${n}`;Sn[R]={levels:d,splitPath:b}}},[d,b,t,r,n]),f.useEffect(()=>{const R=`${t}-${r}-${n}`;Sn[R]?(c(Sn[R].levels),g(Sn[R].splitPath)):S()},[t,r,n]);const S=async()=>{u(!0);try{const N={id:"root",splitColumn:null,items:await ws.getDecomposition(t,r==="count"?null:r,n,"",o),selectedItemName:null,filters:o};c([N]),g([null])}catch(R){console.error(R)}finally{u(!1)}},T=(R,N)=>{var $,J,ee,te,Y;const M=d[R];if(!M.selectedItemName)return;const z=M.items.find(W=>W.name===M.selectedItemName);if(!z)return;const I=N.currentTarget.getBoundingClientRect(),F=($=y.current)==null?void 0:$.getBoundingClientRect();if(F){let W=I.right-F.left+10,U=I.top-F.top;const q=((ee=(J=y.current)==null?void 0:J.parentElement)==null?void 0:ee.clientWidth)||window.innerWidth;W+260>q&&(W=I.left-F.left-270);const K=((Y=(te=y.current)==null?void 0:te.parentElement)==null?void 0:Y.clientHeight)||window.innerHeight;U+300>K&&(U=K-310),p({levelIndex:R,item:z,x:W,y:U})}},E=async(R,N)=>{const M=[...d];M[R].selectedItemName=N.name;const z=b[R+1];if(z){u(!0);try{const I=M[R],F=[...I.filters];I.splitColumn&&F.push({column:I.splitColumn,operator:"==",value:N.name});const $=await ws.getDecomposition(t,r==="count"?null:r,n,z,F),J={id:`level-${R+1}`,splitColumn:z,items:$,selectedItemName:null,filters:F},ee=[...M.slice(0,R+1),J];c(ee),g(b.slice(0,R+2))}catch(I){console.error(I)}finally{u(!1)}}else c(M)},P=async R=>{if(!x)return;const{levelIndex:N,item:M}=x;p(null),u(!0);try{const z=d[N],I=[...z.filters];z.splitColumn&&I.push({column:z.splitColumn,operator:"==",value:M.name});const F=await ws.getDecomposition(t,r==="count"?null:r,n,R,I),$={id:`level-${N+1}`,splitColumn:R,items:F,selectedItemName:null,filters:I},J=[...d.slice(0,N+1),$];c(J);const ee=[...b.slice(0,N+1),R];g(ee)}catch(z){console.error(z)}finally{u(!1)}},A=R=>{c(d.slice(0,R)),g(b.slice(0,R))};return e.jsxs("div",{className:"relative w-full h-[600px] bg-slate-50 dark:bg-slate-900 overflow-hidden flex flex-col",children:[h&&e.jsx("div",{className:"absolute top-2 right-2 z-50",children:e.jsx(Xe,{className:"w-5 h-5 animate-spin text-blue-500"})}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden",ref:y,children:e.jsxs("div",{className:"flex h-full p-8 min-w-max gap-12 relative",ref:_,children:[d.map((R,N)=>e.jsxs("div",{className:"flex flex-col w-[200px] h-full relative z-10",children:[e.jsxs("div",{id:`header-${N}`,className:"flex items-center justify-between mb-4 bg-white dark:bg-slate-800 p-2 rounded shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("span",{className:"font-semibold text-sm text-slate-700 dark:text-slate-200",children:R.splitColumn||"Total"}),e.jsxs("div",{className:"flex items-center gap-1",children:[N===d.length-1&&e.jsx("button",{onClick:M=>T(N,M),className:`
                                                p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors
                                                ${R.selectedItemName?"text-blue-500":"text-slate-300 cursor-not-allowed"}
                                            `,title:R.selectedItemName?"Split further":"Select an item to split",disabled:!R.selectedItemName,children:e.jsx(Ut,{className:"w-4 h-4"})}),N>0&&e.jsx("button",{onClick:()=>A(N),className:"text-slate-400 hover:text-red-500",children:e.jsx(We,{className:"w-4 h-4"})})]})]}),e.jsx("div",{id:`list-${N}`,className:"flex-1 overflow-y-auto pr-2 space-y-2 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-slate-600",onScroll:C,children:R.items.map(M=>{const z=R.selectedItemName===M.name,I=Math.max(...R.items.map($=>$.value)),F=M.value/I*100;return e.jsxs("div",{id:`node-${N}-${M.name}`,onClick:()=>E(N,M),className:`
                                                relative p-3 rounded-md border cursor-pointer transition-all group
                                                ${z?"bg-blue-50 border-blue-500 dark:bg-blue-900/20 dark:border-blue-500 shadow-md":"bg-white border-slate-200 dark:bg-slate-800 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700"}
                                            `,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 relative z-10 gap-2",children:[e.jsx("span",{className:"font-medium text-sm truncate flex-1 min-w-0",title:M.name,children:M.name}),e.jsxs("span",{className:"text-xs font-mono text-slate-500 dark:text-slate-400 whitespace-nowrap",children:[M.value.toLocaleString()," (",Math.round(M.ratio*100),"%)"]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-blue-500/20 transition-all duration-500",style:{width:`${F}%`}})]},M.name)})})]},N)),e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none z-0",children:w.map((R,N)=>e.jsx("path",{d:R.d,fill:"none",stroke:"#3b82f6",strokeWidth:"2",strokeOpacity:"0.5"},N))})]})}),x&&e.jsxs("div",{className:"absolute z-50 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 w-64 max-h-80 overflow-y-auto flex flex-col",style:{left:x.x,top:x.y},children:[e.jsx("div",{className:"p-3 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 sticky top-0",children:e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Split by"})}),e.jsx("div",{className:"p-1",children:i.map(R=>e.jsx("button",{onClick:()=>P(R),className:"w-full text-left px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-md transition-colors",children:R},R))})]}),x&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>p(null)})]})},Dv=({datasetId:t,columns:r,initialFilters:n=[]})=>{const[i,o]=f.useState("count"),[d,c]=f.useState("count"),[h,u]=f.useState(0),x=()=>{u(p=>p+1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 flex gap-4 items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Analyze"}),e.jsxs("select",{value:i,onChange:p=>o(p.target.value),className:"block w-[180px] rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border dark:bg-slate-700 dark:border-slate-600 dark:text-white",children:[e.jsx("option",{value:"count",children:"Row Count"}),r.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),i!=="count"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Aggregation"}),e.jsxs("select",{value:d,onChange:p=>c(p.target.value),className:"block w-[120px] rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border dark:bg-slate-700 dark:border-slate-600 dark:text-white",children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"mean",children:"Average"}),e.jsx("option",{value:"min",children:"Min"}),e.jsx("option",{value:"max",children:"Max"})]})]}),e.jsx("button",{onClick:x,className:"p-2 border rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-slate-600 dark:text-slate-300",title:"Reset Tree",children:e.jsx(xt,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsx(Mv,{datasetId:t,measureCol:i,measureAgg:d,columns:r,initialFilters:n},h)})]})},Sa=async(t,r,n,i,o)=>{const d=document.getElementById(t);if(!d)return;const c=document.documentElement.classList.contains("dark"),h=c?"#1f2937":"#ffffff",u=c?"#f3f4f6":"#111827",x=c?"#9ca3af":"#4b5563",p=(g,y)=>{let _=0;return n&&(g.fillStyle=u,g.font="bold 16px sans-serif",g.textAlign="center",g.fillText(n,y/2,30),_=40),i&&(g.fillStyle=x,g.font="12px sans-serif",g.textAlign="center",g.fillText(i,y/2,50),_=60),o&&(g.fillStyle=u,g.font="10px monospace",g.textAlign="right",o.split(`
`).forEach((j,C)=>{g.fillText(j,y-10,20+C*12)})),_||20},b=d.querySelector(".js-plotly-plot");if(b){try{const g=await Ox.toImage(b,{format:"png",width:1200,height:800}),y=document.createElement("canvas"),_=y.getContext("2d"),w=new Image,j=1200,C=800,S=n?i?80:50:0;w.onload=()=>{if(y.width=j,y.height=C+S,_){_.fillStyle=h,_.fillRect(0,0,y.width,y.height),n&&(_.fillStyle=u,_.font="bold 24px sans-serif",_.textAlign="center",_.fillText(n,j/2,40),i&&(_.fillStyle=x,_.font="16px sans-serif",_.fillText(i,j/2,70))),o&&(_.fillStyle=u,_.font="14px monospace",_.textAlign="right",o.split(`
`).forEach((P,A)=>{_.fillText(P,j-20,30+A*18)})),_.drawImage(w,0,S);const T=document.createElement("a");T.download=`${r}.png`,T.href=y.toDataURL("image/png"),T.click()}},w.src=g}catch(g){console.error("Plotly download failed",g)}return}try{const g=await cx(d,{backgroundColor:h,scale:2,logging:!1,useCORS:!0}),y=document.createElement("canvas"),_=y.getContext("2d"),w=n?i?80:50:0;if(y.width=g.width,y.height=g.height+w*2,_){_.fillStyle=h,_.fillRect(0,0,y.width,y.height),_.save(),_.scale(2,2),p(_,g.width/2),_.restore(),_.drawImage(g,0,w*2);const j=document.createElement("a");j.download=`${r}.png`,j.href=y.toDataURL("image/png"),j.click()}}catch(g){console.error("Chart download failed",g)}},Av=()=>{const[t]=du(),[r,n]=f.useState([]),[i,o]=f.useState(()=>{const Q=t.get("dataset_id");return Q?Number(Q):null}),[d,c]=f.useState(null),[h,u]=f.useState(!1),[x,p]=f.useState(!1),[b,g]=f.useState(null),[y,_]=f.useState("dashboard"),[w,j]=f.useState(""),[C,S]=f.useState(""),[T,E]=f.useState([]),[P,A]=f.useState([]),[R,N]=f.useState([]),[M,z]=f.useState(!1),[I,F]=f.useState(null),[$,J]=f.useState(""),[ee,te]=f.useState(""),[Y,W]=f.useState(""),[U,q]=f.useState(""),[K,ce]=f.useState(!1),[V,ae]=f.useState(!1);f.useEffect(()=>{ie()},[]),f.useEffect(()=>{i?(c(null),E([]),A([]),j(""),F(null),J(""),te(""),W(""),q(""),_("dashboard"),le(i),se(i)):(c(null),N([]),E([]),A([]),j(""),F(null),J(""),te(""),W(""),q(""),_("dashboard"))},[i]),f.useEffect(()=>{let Q;return d&&d.status==="PENDING"&&(Q=setInterval(()=>{i&&(le(i,!0),se(i))},3e3)),()=>clearInterval(Q)},[d,i]);const ie=async()=>{try{const Q=await Dt.getUsable();n(Q),Q.length>0&&!i&&o(Number(Q[0].id))}catch(Q){console.error("Failed to load datasets",Q)}},se=async Q=>{try{const be=await ws.getHistory(Q);N(be)}catch(be){console.error("Failed to load history",be)}},le=async(Q,be=!1)=>{be||u(!0),g(null);try{const Le=await ws.getLatestReport(Q);c(Le)}catch(Le){Le.response&&Le.response.status===404?c(null):be||g("Failed to load report")}finally{be||u(!1)}},Se=async Q=>{u(!0);try{const be=await ws.getReport(Q);c(be)}catch{g("Failed to load report")}finally{u(!1)}},xe=async(Q,be)=>{const Le=Array.isArray(Q)?Q:T,Ie=Array.isArray(be)?be:P;if(i){p(!0);try{await ws.analyze(i,w||void 0,Le,Ie,C||void 0),le(i),se(i)}catch{g("Failed to start analysis")}finally{p(!1)}}},Ct=(Q,be,Le="==")=>{const Ie={column:Q,operator:Le,value:be},ct=[...P,Ie];A(ct),xe(void 0,ct)},Qt=Q=>{const be=[...P];be.splice(Q,1),A(be),xe(void 0,be)},dt=(Q,be)=>{const Le=be?`Are you sure you want to exclude '${Q}' from the analysis? This will trigger a new analysis.`:`Include '${Q}' back in the analysis? This will trigger a new analysis.`;if(confirm(Le)){let Ie=[...T];be?Ie.push(Q):Ie=Ie.filter(ct=>ct!==Q),E(Ie),xe(Ie)}};f.useEffect(()=>{d&&d.profile_data&&(d.profile_data.target_col&&j(d.profile_data.target_col),d.profile_data.excluded_columns?E(d.profile_data.excluded_columns):E([]))},[d]);const Te=w?R.find(Q=>Q.target_col===w&&Q.status==="COMPLETED"):null,Ot=()=>{var be;if(h&&!d)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Xe,{className:"w-8 h-8 animate-spin text-blue-500"})});if(b)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-500",children:[e.jsx(lt,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Error"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:b}),e.jsxs("button",{onClick:()=>i&&le(i),className:"mt-4 flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Retry"]})]});if(!d)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(ks,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{className:"mb-4",children:"No analysis found for this dataset."}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"w-64 space-y-2",children:[e.jsx("input",{type:"text",value:w,onChange:Le=>j(Le.target.value),placeholder:"Target Column (Optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:C,onChange:Le=>S(Le.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Auto-Detect Task"}),e.jsx("option",{value:"Classification",children:"Classification"}),e.jsx("option",{value:"Regression",children:"Regression"})]}),e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(Dn,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-full ml-2 w-64 p-2 bg-gray-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none",children:"Force a specific task type. Useful for ID columns (force Classification) or numeric categories (force Regression)."})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[Te&&e.jsxs("button",{onClick:()=>Se(Te.id),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Load Existing (",new Date(Te.created_at).toLocaleDateString(),")"]}),e.jsxs("button",{onClick:()=>xe(),disabled:x,className:`flex items-center px-4 py-2 ${Te?"bg-gray-600 hover:bg-gray-700":"bg-blue-600 hover:bg-blue-700"} text-white rounded-md disabled:opacity-50`,children:[x?e.jsx(Xe,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Wt,{className:"w-4 h-4 mr-2"}),Te?"Run New Analysis":"Run Analysis"]})]})]})]});if(d.status==="PENDING")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Xe,{className:"w-16 h-16 mb-4 animate-spin text-blue-500"}),e.jsx("p",{children:"Analysis in progress..."}),e.jsx("p",{className:"text-sm text-gray-400",children:"This may take a few moments."})]});if(d.status==="FAILED")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-500",children:[e.jsx(lt,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Analysis Failed"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:d.error_message}),e.jsxs("button",{onClick:()=>xe(),className:"mt-4 flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Retry"]})]});const Q=d.profile_data;return Q?e.jsxs("div",{className:"flex h-[calc(100vh-124px)] border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:[e.jsx(Gg,{activeTab:y,setActiveTab:_,profile:Q,filters:P,columns:Q.columns?Object.keys(Q.columns):[],excludedCols:T,onAddFilter:Ct,onRemoveFilter:Qt,onClearFilters:()=>{A([]),xe(void 0,[])},onToggleExclude:dt}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pt-4 bg-gray-50 dark:bg-gray-900/50",children:[y==="dashboard"&&e.jsx(Qg,{profile:Q}),y==="insights"&&e.jsx(Yg,{profile:Q}),y==="pca"&&e.jsx(Xg,{profile:Q,isPCA3D:V,setIsPCA3D:ae,downloadChart:Sa}),y==="geospatial"&&Q.geospatial&&e.jsx(v0,{profile:Q}),y==="target"&&Q.target_col&&Q.target_correlations&&e.jsx(_0,{profile:Q,downloadChart:Sa,history:R,loading:h,loadSpecificReport:Se,report:d}),y==="timeseries"&&Q.timeseries&&e.jsx(j0,{profile:Q,downloadChart:Sa}),y==="variables"&&e.jsx(w0,{profile:Q,setSelectedVariable:F,handleToggleExclude:dt}),y==="bivariate"&&e.jsx(N0,{profile:Q,downloadChart:Sa,scatterX:$,setScatterX:J,scatterY:ee,setScatterY:te,scatterZ:Y,setScatterZ:W,scatterColor:U,setScatterColor:q,is3D:K,setIs3D:ce}),y==="outliers"&&Q.outliers&&e.jsx(k0,{profile:Q}),y==="correlations"&&(Q.correlations||Q.correlations_with_target)&&e.jsx(C0,{profile:Q}),y==="causal"&&Q.causal_graph&&e.jsx(T0,{profile:Q}),y==="rules"&&Q.rule_tree&&e.jsx(Rv,{profile:Q}),y==="decomposition"&&i&&e.jsx(Dv,{datasetId:i,columns:(be=d==null?void 0:d.profile_data)!=null&&be.columns?Object.keys(d.profile_data.columns):[],initialFilters:P}),y==="sample"&&Q.sample_data&&e.jsx(S0,{profile:Q,excludedCols:T,handleToggleExclude:dt})]})]}):e.jsx("div",{children:"No profile data"})};return e.jsxs("div",{id:"eda-report-container",className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Exploratory Data Analysis"}),d&&d.created_at&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last analyzed: ",new Date(d.created_at).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2 no-print",children:e.jsxs("button",{onClick:()=>z(!0),className:"flex items-center px-3 py-1.5 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors ml-4",children:[e.jsx(ux,{className:"w-4 h-4 mr-2"}),"Jobs History"]})})]}),e.jsxs("div",{className:"flex items-center gap-4 no-print",children:[e.jsxs("select",{value:i||"",onChange:Q=>o(Number(Q.target.value)),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a dataset"}),r.map(Q=>e.jsx("option",{value:Q.id,children:Q.name},Q.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Target:"}),e.jsxs("select",{value:w,onChange:Q=>j(Q.target.value),disabled:!d||!d.profile_data,className:"block w-40 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border disabled:opacity-50",children:[e.jsx("option",{value:"",children:"None"}),d&&d.profile_data&&Object.keys(d.profile_data.columns).map(Q=>e.jsx("option",{value:Q,children:Q},Q))]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("select",{value:C,onChange:Q=>S(Q.target.value),disabled:!d||!d.profile_data,className:"block w-32 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border disabled:opacity-50",title:"Force Task Type",children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"Classification",children:"Classif."}),e.jsx("option",{value:"Regression",children:"Regress."})]}),e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(Dn,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute right-0 top-full mt-2 w-64 p-2 bg-gray-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none",children:"Force a specific task type. Useful for ID columns (force Classification) or numeric categories (force Regression)."})]})]})]}),e.jsx("button",{onClick:()=>i&&xe(),disabled:!i||x,className:"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100",title:"Refresh Analysis",children:e.jsx(xt,{className:`w-5 h-5 ${x?"animate-spin":""}`})}),Te&&d&&d.id!==Te.id&&e.jsxs("button",{onClick:()=>Se(Te.id),className:"flex items-center px-3 py-1.5 text-xs bg-green-100 text-green-700 border border-green-200 rounded-md hover:bg-green-200 transition-colors",title:`Load existing analysis from ${new Date(Te.created_at).toLocaleString()}`,children:[e.jsx(xt,{className:"w-3 h-3 mr-1"}),"Load Existing"]})]})]}),R.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto pb-2 no-print",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium whitespace-nowrap",children:"Recent Targets:"}),Array.from(new Set(R.filter(Q=>Q.target_col&&Q.status==="COMPLETED").map(Q=>Q.target_col))).slice(0,5).map(Q=>{var be;return e.jsx("button",{onClick:()=>{const Le=R.find(Ie=>Ie.target_col===Q&&Ie.status==="COMPLETED");Le&&Se(Le.id)},className:`px-2 py-1 text-xs rounded-full border transition-colors ${((be=d==null?void 0:d.profile_data)==null?void 0:be.target_col)===Q?"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700 dark:hover:bg-gray-700"}`,children:Q},Q)})]}),Ot(),e.jsx(qg,{selectedVariable:I,onClose:()=>F(null),downloadChart:Sa,filters:P,setFilters:A,runAnalysis:xe,handleAddFilter:Ct}),e.jsx(Wg,{isOpen:M,onClose:()=>z(!1),history:R,onRefresh:()=>i&&se(i),onFetchReport:async Q=>await ws.getReport(Q),onSelect:Q=>{var be;c(Q),(be=Q.profile_data)!=null&&be.excluded_columns?E(Q.profile_data.excluded_columns):E([])}})]})};function Ov(){return e.jsx(Bf,{children:e.jsx(ff,{children:e.jsxs(ys,{path:"/",element:e.jsx(Jf,{}),children:[e.jsx(ys,{index:!0,element:e.jsx(sg,{})}),e.jsx(ys,{path:"jobs",element:e.jsx(Hg,{})}),e.jsx(ys,{path:"data",element:e.jsx(og,{})}),e.jsx(ys,{path:"eda",element:e.jsx(Av,{})}),e.jsx(ys,{path:"canvas",element:e.jsx(Fg,{})}),e.jsx(ys,{path:"registry",element:e.jsx(Bg,{})}),e.jsx(ys,{path:"deployments",element:e.jsx(Zg,{})})]})})})}const lr=t=>t&&typeof t=="object"?t:null,Iv=t=>{const r=lr(t),n=r==null?void 0:r.sample;if(!r||!Array.isArray(n)||n.length===0)return e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"No data available"});const i=lr(n[0])??{},o=Object.keys(i).slice(0,5),d=typeof r.name=="string"?r.name:"Dataset",c=Array.isArray(r.shape)?r.shape:null,h=c&&c.length>0?c[0]:void 0,u=c&&c.length>1?c[1]:void 0;return e.jsxs("div",{className:"overflow-x-auto rounded border border-border",children:[e.jsxs("div",{className:"text-xs font-semibold mb-1 flex justify-between p-2 bg-muted/50 border-b border-border",children:[e.jsx("span",{children:d}),e.jsxs("span",{className:"text-muted-foreground",children:[h??"?"," rows x ",u??"?"," cols"]})]}),e.jsxs("table",{className:"w-full text-[10px] border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-muted/30",children:o.map(x=>e.jsx("th",{className:"p-2 border-b border-r border-border text-left font-medium text-muted-foreground last:border-r-0",children:x},x))})}),e.jsx("tbody",{children:n.slice(0,5).map((x,p)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/20",children:o.map(b=>{var g;return e.jsx("td",{className:"p-2 border-r border-border truncate max-w-[80px] last:border-r-0",children:String(((g=lr(x))==null?void 0:g[b])??"")},b)})},p))})]})]})},zv=({config:t,onChange:r,nodeId:n})=>{var C;const{nodes:i,edges:o}=ye(),[d,c]=f.useState(!1),[h,u]=f.useState(null),[x,p]=f.useState("train");f.useEffect(()=>{const S=t.lastRunJobId;if(!S)return;const T=async()=>{try{const P=await $e.getJob(S);u(P),P.status!=="completed"&&P.status}catch(P){console.error("Failed to fetch job",P)}};T();const E=setInterval(()=>{T()},2e3);return()=>{clearInterval(E)}},[t.lastRunJobId]);const b=async()=>{if(n){c(!0);try{const S=ti(i,o),T=await $e.runPipeline({...S,target_node_id:n,job_type:"preview"});r({...t,lastRunJobId:T.job_id})}catch(S){console.error("Failed to run preview:",S),alert("Failed to start preview job.")}finally{c(!1)}}},g=((C=h==null?void 0:h.result)==null?void 0:C.metrics)??(h==null?void 0:h.result),y=lr(g),_=y?lr(y.data_summary):null,w=y==null?void 0:y.operation_mode,j=typeof w=="string"?w:void 0;return e.jsxs("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Connect this node to any data output to inspect the data state, schema, and applied transformations."}),e.jsxs("button",{onClick:()=>{b()},disabled:d,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-[#38bdf8] via-[#6366f1] to-[#a855f7] text-white px-3 py-1.5 rounded-md hover:opacity-90 disabled:opacity-50 transition-all text-xs font-medium shadow-md",children:[d?e.jsx(Ve,{size:14,className:"animate-spin"}):e.jsx(Wt,{size:14}),d?"Running...":"Run Preview"]}),t.lastRunJobId&&h&&h.status!=="completed"&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2 p-2 bg-muted/30 rounded border border-border",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`ml-auto font-medium px-1.5 py-0.5 rounded text-[10px] ${h.status==="failed"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:h.status})]}),(h==null?void 0:h.status)==="completed"&&g&&e.jsxs("div",{className:"space-y-4 border-t border-border pt-4 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"text-[10px] bg-blue-50 dark:bg-blue-950/30 text-blue-700 dark:text-blue-300 p-2 rounded border border-blue-100 dark:border-blue-900/50",children:[e.jsx("strong",{className:"block mb-0.5",children:"Operation Mode"}),j||"Unknown"]}),_&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex border-b border-border",children:["train","test","validation"].map(S=>_[S]?e.jsx("button",{className:`text-[10px] px-3 py-1.5 border-b-2 transition-colors ${x===S?"border-primary font-medium text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,onClick:()=>{p(S)},children:S.charAt(0).toUpperCase()+S.slice(1)},S):null)}),_[x]?Iv(_[x]):e.jsxs("div",{className:"text-xs text-muted-foreground p-4 text-center border border-dashed border-border rounded",children:["No ",x," data available"]})]}),Array.isArray(y==null?void 0:y.applied_transformations)&&y.applied_transformations.length>0&&e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("div",{className:"text-[10px] font-semibold mb-2 text-foreground",children:"Applied Steps"}),e.jsx("div",{className:"space-y-1.5",children:y.applied_transformations.map((S,T)=>{var E,P;return e.jsxs("div",{className:"text-[10px] flex items-center gap-2 text-muted-foreground p-1.5 bg-muted/30 rounded border border-border",children:[e.jsx("span",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center text-[8px] font-medium text-foreground",children:T+1}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-foreground",children:String(((E=lr(S))==null?void 0:E.transformer_name)??"")}),e.jsx("span",{className:"text-[9px] opacity-80",children:String(((P=lr(S))==null?void 0:P.transformer_type)??"")})]})]},T)})})]})]})]})},Fv=({data:t})=>{const[r,n]=f.useState(null);return f.useEffect(()=>{const i=t.lastRunJobId;if(!i)return;const o=async()=>{try{const c=await $e.getJob(i);n(c.status)}catch{n("error")}};o();const d=setInterval(()=>{o()},5e3);return()=>{clearInterval(d)}},[t.lastRunJobId]),e.jsx("div",{className:"text-xs flex items-center gap-2",children:t.lastRunJobId?r==="completed"?e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium flex items-center gap-1",children:[e.jsx(at,{size:12})," Ready"]}):r==="failed"?e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-medium flex items-center gap-1",children:[e.jsx(lt,{size:12})," Failed"]}):e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium flex items-center gap-1",children:[e.jsx(Ve,{size:12,className:"animate-spin"})," Running"]}):e.jsx("span",{className:"text-muted-foreground italic",children:"Not run yet"})})},Bv={type:"data_preview",label:"Data Preview",category:"Evaluation",description:"Inspect data state and transformations at this point.",icon:Mo,inputs:[{id:"in",label:"Input Data",type:"any"}],outputs:[],component:Fv,settings:zv,validate:()=>({isValid:!0}),getDefaultConfig:()=>({})},Me=t=>vp({queryKey:["dataset-schema",t],queryFn:()=>Xf(t),enabled:!!t,staleTime:1e3*60*5}),$v=({config:t,onChange:r})=>{const[n,i]=f.useState([]),[o,d]=f.useState(!1),[c,h]=f.useState(!1),{data:u,isLoading:x}=Me(t.datasetId),p=()=>{d(!0),Dt.getUsable().then(i).catch(console.error).finally(()=>{d(!1)})};f.useEffect(()=>{p()},[]);const b=y=>{const _=y.target.value,w=n.find(j=>String(j.id)===_);r({...t,datasetId:_,datasetName:w==null?void 0:w.name})},g=(y,_)=>{h(!1),p(),r({...t,datasetId:y,datasetName:_})};return c?e.jsx(cu,{onUploadComplete:g,onCancel:()=>{h(!1)}}):e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Dataset"}),e.jsxs("button",{onClick:()=>{h(!0)},className:"text-xs flex items-center gap-1 text-blue-600 hover:text-blue-700 font-medium",children:[e.jsx(Ut,{size:14}),"New Upload"]})]}),o?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Loading datasets..."}):e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.datasetId||"",onChange:b,children:[e.jsx("option",{value:"",children:"-- Select --"}),n.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),t.datasetId&&e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(hx,{size:14}),e.jsx("span",{children:"Dataset Schema"})]}),x?e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}):u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-md bg-muted/10 max-h-60 overflow-auto",children:e.jsxs("table",{className:"w-full text-xs text-left min-w-max",children:[e.jsx("thead",{className:"bg-muted/20 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-medium border-b bg-muted/20",children:"Column"}),e.jsx("th",{className:"p-2 font-medium border-b bg-muted/20",children:"Type"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Missing"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Unique"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Min"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Max"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Mean"})]})}),e.jsx("tbody",{children:Object.values(u.columns).map(y=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/20",children:[e.jsx("td",{className:"p-2 font-mono font-medium whitespace-nowrap",children:y.name}),e.jsx("td",{className:"p-2 text-muted-foreground whitespace-nowrap",children:y.dtype}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.missing_count}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.unique_count}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.min_value!==void 0?Number(y.min_value).toFixed(2):"-"}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.max_value!==void 0?Number(y.max_value).toFixed(2):"-"}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.mean_value!==void 0?Number(y.mean_value).toFixed(2):"-"})]},y.name))})]})}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1 text-center italic",children:"Expand node to see full details"})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"No schema available."})]})]})},Zv=({data:t})=>{const[r,n]=f.useState(void 0);f.useEffect(()=>{t.datasetId&&!t.datasetName&&r===void 0&&Dt.getById(t.datasetId).then(o=>{n(o.name)}).catch(()=>{n(t.datasetId)})},[t.datasetId,t.datasetName,r]);const i=t.datasetName||r||t.datasetId;return e.jsx("div",{className:"text-xs",children:t.datasetId?e.jsx("div",{className:"font-medium truncate max-w-[150px]",title:i,children:i||"Loading..."}):e.jsx("div",{className:"text-muted-foreground italic",children:"Select a dataset"})})},Hv={type:"dataset_node",label:"Dataset",category:"Data Source",description:"Load a dataset from the registry.",icon:ft,inputs:[],outputs:[{id:"data",label:"Data",type:"dataset"}],settings:$v,component:Zv,validate:t=>({isValid:!!t.datasetId,message:t.datasetId?void 0:"Dataset is required"}),getDefaultConfig:()=>({datasetId:""})},dh=(t,r,n,i=new Set)=>{var d;if(i.has(t.id))return;if(i.add(t.id),(d=t.data)!=null&&d.datasetId)return t.data.datasetId;const o=Nr(t,r,n);for(const c of o){const h=dh(c,r,n,i);if(h)return h}},Fe=t=>{const r=ye(d=>d.nodes),n=ye(d=>d.edges),i=r.find(d=>d.id===t);return i?Nr(i,r,n).map(d=>{const c=dh(d,r,n);return c&&!d.data.datasetId?{...d.data,datasetId:c}:d.data}):[]},da=(t,r={})=>{var d;const i=(d=Fe(t).find(c=>c.datasetId))==null?void 0:d.datasetId,o=ye(c=>c.executionResult);return f.useMemo(()=>!i||!(o!=null&&o.recommendations)?[]:o.recommendations.filter(c=>{var h,u;if(r.types||r.suggestedNodeTypes){const x=(h=r.types)==null?void 0:h.includes(c.type),p=(u=r.suggestedNodeTypes)==null?void 0:u.includes(c.suggested_node_type);if(!x&&!p)return!1}return!(r.scope==="column"&&(!c.target_columns||c.target_columns.length===0))}),[o,i,r.types,r.suggestedNodeTypes,r.scope])},Sr=({recommendations:t,onApply:r,className:n=""})=>!t||t.length===0?null:e.jsxs("div",{className:`bg-blue-50 border border-blue-100 rounded-md p-3 ${n}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-blue-800 font-medium text-sm",children:[e.jsx(Kn,{className:"w-4 h-4"}),e.jsx("span",{children:"Recommendations"})]}),e.jsx("div",{className:"space-y-2",children:t.map(i=>e.jsx("div",{className:"bg-white border border-blue-100 rounded p-2 text-sm shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-800 font-medium text-xs mb-1",children:i.type.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-gray-600 text-xs leading-relaxed",children:i.description}),i.reasoning&&e.jsxs("p",{className:"text-gray-400 text-[10px] mt-1 italic",children:["Why: ",i.reasoning]})]}),r&&e.jsx("button",{onClick:()=>r(i),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50",title:"Apply Recommendation",children:e.jsx(at,{className:"w-5 h-5"})})]})},i.rule_id))})]}),Uv=({config:t,onChange:r,nodeId:n})=>{var P;const o=(P=Fe(n||"").find(A=>A.datasetId))==null?void 0:P.datasetId,{data:d,isLoading:c}=Me(o),h=d?Object.values(d.columns).map(A=>A.name):[],u=ye(A=>A.executionResult),x=n?u==null?void 0:u.node_results[n]:null,p=x!=null&&x.metrics&&typeof x.metrics=="object"?x.metrics:null,b=f.useRef(null),[g,y]=f.useState(!1);f.useEffect(()=>{if(!b.current)return;const A=new ResizeObserver(R=>{for(const N of R)y(N.contentRect.width>450)});return A.observe(b.current),()=>{A.disconnect()}},[]);const _=da(n||"",{types:["cleaning","feature_selection"],suggestedNodeTypes:["DropMissingColumns"],scope:"column"}),w=A=>{var R;if((R=A.target_columns)!=null&&R.length){const N=Array.from(new Set([...t.columns,...A.target_columns]));r({...t,columns:N})}},[j,C]=f.useState(""),S=f.useMemo(()=>h.filter(A=>A.toLowerCase().includes(j.toLowerCase())),[h,j]),T=()=>{r({...t,columns:S})},E=()=>{const A=t.columns.filter(R=>!S.includes(R));r({...t,columns:A})};return e.jsxs("div",{ref:b,className:`flex flex-col h-full w-full bg-background ${g?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${g?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${g?"overflow-y-auto pr-2":"shrink-0"}`,children:[_.length>0&&e.jsx("div",{className:"shrink-0",children:e.jsx(Sr,{recommendations:_,onApply:w})}),e.jsxs("div",{className:"space-y-3 p-3 border rounded-md bg-muted/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Missing Value Threshold"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Drop columns with >",t.missing_threshold??0,"% missing values"]})]}),e.jsxs("span",{className:"text-sm font-mono font-bold text-primary bg-primary/10 px-2 py-1 rounded",children:[t.missing_threshold??0,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:t.missing_threshold??0,onChange:A=>r({...t,missing_threshold:parseInt(A.target.value)}),className:"w-full h-2 bg-secondary rounded-lg appearance-none cursor-pointer accent-primary"})]}),p&&p.dropped_columns_count!==void 0&&e.jsxs("div",{className:"p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Columns Dropped:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(p.dropped_columns_count)})]}),Array.isArray(p.dropped_columns)&&p.dropped_columns.length>0&&e.jsxs("div",{className:"pt-1 border-t mt-1",children:[e.jsx("span",{className:"text-muted-foreground block mb-1",children:"Dropped Names:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:p.dropped_columns.map(A=>{const R=String(A);return e.jsx("span",{className:"px-1.5 py-0.5 bg-background border rounded text-[10px] font-mono",children:R},R)})})]})]})]})]}),e.jsxs("div",{className:`flex flex-col border rounded-md bg-background shadow-sm overflow-hidden ${g?"min-h-0 flex-1":"h-96 shrink-0"}`,children:[e.jsxs("div",{className:"p-3 border-b bg-muted/5 space-y-3 shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Explicitly Drop Columns"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full pl-9 pr-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary focus:border-primary transition-all outline-none",value:j,onChange:A=>{C(A.target.value)}})}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:T,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:E,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-1",children:h.length>0?S.length>0?e.jsx("div",{className:"space-y-0.5",children:S.map(A=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-2 rounded cursor-pointer transition-colors select-none",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(A),onChange:R=>{const N=R.target.checked?[...t.columns,A]:t.columns.filter(M=>M!==A);r({...t,columns:N})},className:"rounded border-gray-300 text-primary focus:ring-primary w-4 h-4"}),e.jsx("span",{className:"truncate font-mono text-xs",title:A,children:A})]},A))}):e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-8",children:['No columns match "',j,'"']}):e.jsx("div",{className:"text-xs text-muted-foreground italic p-8 text-center",children:"No columns available"})})]})]})]})},Wv={type:"drop_missing_columns",label:"Drop Columns",category:"Preprocessing",description:"Remove specific columns or those with high missing values.",icon:Ys,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Data",type:"dataset"}],settings:Uv,validate:t=>({isValid:t.columns.length>0||t.missing_threshold!==void 0&&t.missing_threshold>0,message:t.columns.length===0&&(!t.missing_threshold||t.missing_threshold===0)?"Select columns or set a threshold":void 0}),getDefaultConfig:()=>({columns:[],missing_threshold:0})},Vv=({config:t,onChange:r,nodeId:n})=>{var N;const o=(N=Fe(n||"").find(M=>M.datasetId))==null?void 0:N.datasetId,{data:d,isLoading:c}=Me(o),h=d?Object.values(d.columns).map(M=>M.name):[],u=ye(M=>M.executionResult),x=n?u==null?void 0:u.node_results[n]:null,p=x!=null&&x.metrics&&typeof x.metrics=="object"?x.metrics:null,b=p!=null&&p.fill_values&&typeof p.fill_values=="object"?p.fill_values:null,g=p!=null&&p.missing_counts&&typeof p.missing_counts=="object"?p.missing_counts:null,y=f.useRef(null),[_,w]=f.useState(!1);f.useEffect(()=>{if(!y.current)return;const M=new ResizeObserver(z=>{for(const I of z)w(I.contentRect.width>450)});return M.observe(y.current),()=>{M.disconnect()}},[]);const j=da(n||"",{types:["imputation"],suggestedNodeTypes:["SimpleImputer","KNNImputer","IterativeImputer"],scope:"column"}),C=M=>{if(M.target_columns.length>0){const z=Array.from(new Set([...t.columns,...M.target_columns]));r({...t,columns:z})}},[S,T]=f.useState(""),E=f.useMemo(()=>h.filter(M=>M.toLowerCase().includes(S.toLowerCase())),[h,S]),P=()=>{r({...t,columns:E})},A=()=>{const M=t.columns.filter(z=>!E.includes(z));r({...t,columns:M})},R=()=>p?e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs",children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-2",children:"Execution Feedback"}),b&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Imputed Values:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 max-h-32 overflow-y-auto",children:Object.entries(b).map(([M,z])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:M,children:[M,":"]}),e.jsx("span",{className:"font-mono",children:typeof z=="number"?z.toFixed(4):String(z)})]},M))})]}),g&&e.jsxs("div",{className:"space-y-1 mt-2",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Missing Values Filled:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 max-h-32 overflow-y-auto",children:Object.entries(g).map(([M,z])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:M,children:[M,":"]}),e.jsx("span",{className:"font-mono",children:String(z)})]},M))}),p.total_missing!==void 0&&e.jsxs("div",{className:"text-[10px] text-muted-foreground mt-1 pt-1 border-t",children:["Total Filled: ",e.jsx("span",{className:"font-mono font-medium",children:String(p.total_missing)})]})]}),!b&&!g&&(x==null?void 0:x.status)==="success"&&e.jsx("div",{className:"text-green-600",children:"Imputation completed successfully."})]}):null;return e.jsxs("div",{ref:y,className:`flex flex-col h-full w-full bg-background ${_?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${_?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${_?"overflow-y-auto pr-2":"shrink-0"}`,children:[j.length>0&&e.jsx("div",{className:"shrink-0",children:e.jsx(Sr,{recommendations:j,onApply:C})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Imputation Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method||"simple",onChange:M=>r({...t,method:M.target.value}),children:[e.jsx("option",{value:"simple",children:"Simple Imputer (Univariate)"}),e.jsx("option",{value:"knn",children:"KNN Imputer (Multivariate)"}),e.jsx("option",{value:"iterative",children:"Iterative Imputer (MICE)"})]})]}),(t.method==="simple"||!t.method)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Strategy"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.strategy,onChange:M=>r({...t,strategy:M.target.value}),children:[e.jsx("option",{value:"mean",children:"Mean (Average)"}),e.jsx("option",{value:"median",children:"Median (Middle Value)"}),e.jsx("option",{value:"most_frequent",children:"Most Frequent (Mode)"}),e.jsx("option",{value:"constant",children:"Constant Value"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:[t.strategy==="mean"&&"Replaces missing values with the mean of the column. (Numeric only)",t.strategy==="median"&&"Replaces missing values with the median. (Robust to outliers)",t.strategy==="most_frequent"&&"Replaces missing with the most common value. (Categorical/Numeric)",t.strategy==="constant"&&"Replaces missing values with a specific value."]})]}),t.strategy==="constant"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fill Value"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded bg-background text-sm",value:t.fill_value||"",onChange:M=>r({...t,fill_value:M.target.value}),placeholder:"Enter value..."})]})]}),t.method==="knn"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Number of Neighbors"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded bg-background text-sm",value:t.n_neighbors||5,onChange:M=>r({...t,n_neighbors:parseInt(M.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Weights"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.weights||"uniform",onChange:M=>r({...t,weights:M.target.value}),children:[e.jsx("option",{value:"uniform",children:"Uniform"}),e.jsx("option",{value:"distance",children:"Distance"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Uniform: All points in each neighborhood are weighted equally. Distance: Weight points by the inverse of their distance."})]})]}),t.method==="iterative"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Max Iterations"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded bg-background text-sm",value:t.max_iter||10,onChange:M=>r({...t,max_iter:parseInt(M.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Estimator"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.estimator||"bayesian_ridge",onChange:M=>r({...t,estimator:M.target.value}),children:[e.jsx("option",{value:"bayesian_ridge",children:"Bayesian Ridge"}),e.jsx("option",{value:"decision_tree",children:"Decision Tree"}),e.jsx("option",{value:"extra_trees",children:"Extra Trees"}),e.jsx("option",{value:"knn",children:"KNN"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"The estimator to use for the imputation steps."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Random State"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.random_state??0,onChange:M=>r({...t,random_state:parseInt(M.target.value)})})]})]}),_&&e.jsx(R,{})]}),e.jsxs("div",{className:`flex flex-col h-full min-h-[200px] border rounded-md overflow-hidden ${_?"":"shrink-0"}`,children:[e.jsxs("div",{className:"p-2 border-b bg-muted/30 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Target Columns (",t.columns.length,")"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:P,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"All"}),e.jsx("button",{onClick:A,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"None"})]})]}),e.jsx("input",{type:"text",placeholder:"Search columns...",className:"w-full text-xs p-1.5 border rounded bg-background",value:S,onChange:M=>{T(M.target.value)}})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:E.length>0?E.map(M=>e.jsxs("label",{className:"flex items-center justify-between gap-2 text-sm hover:bg-accent/50 p-1.5 rounded cursor-pointer select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(M),onChange:z=>{const I=z.target.checked?[...t.columns,M]:t.columns.filter(F=>F!==M);r({...t,columns:I})},className:"rounded border-gray-300 text-primary focus:ring-primary shrink-0"}),e.jsx("span",{className:"truncate",title:M,children:M})]}),g&&g[M]!==void 0&&e.jsx("span",{className:"text-[10px] text-muted-foreground font-mono shrink-0 bg-muted px-1.5 py-0.5 rounded",title:`${String(g[M])} missing values filled`,children:String(g[M])})]},M)):e.jsx("div",{className:"p-4 text-center text-xs text-muted-foreground",children:h.length===0?"No columns available":"No matches found"})})]}),!_&&e.jsx(R,{})]})]})},qv={type:"imputation_node",label:"Imputation",category:"Preprocessing",description:"Fill missing values using Simple, KNN, or Iterative strategies.",icon:mx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:Vv,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column"}:t.method==="simple"&&t.strategy==="constant"&&(t.fill_value===void 0||t.fill_value==="")?{isValid:!1,message:"Fill value is required for Constant strategy"}:{isValid:!0},getDefaultConfig:()=>({columns:[],method:"simple",strategy:"mean",fill_value:0,n_neighbors:5,weights:"uniform",max_iter:10,estimator:"bayesian_ridge",random_state:0})},Gv=({config:t,onChange:r,nodeId:n})=>{var T;const o=(T=Fe(n||"").find(E=>E.datasetId))==null?void 0:T.datasetId,{data:d,isLoading:c}=Me(o),h=ye(E=>E.executionResult),u=n?h==null?void 0:h.node_results[n]:null,x=f.useRef(null),[p,b]=f.useState(!1),[g,y]=f.useState("");f.useEffect(()=>{if(!x.current)return;const E=new ResizeObserver(P=>{for(const A of P)b(A.contentRect.width>450)});return E.observe(x.current),()=>{E.disconnect()}},[]);const _=d?Object.values(d.columns).filter(E=>["int","float","number"].some(P=>E.dtype.toLowerCase().includes(P))).map(E=>E.name):[],w=_.filter(E=>E.toLowerCase().includes(g.toLowerCase())),j=()=>{r({...t,columns:w})},C=()=>{const E=t.columns.filter(P=>!w.includes(P));r({...t,columns:E})},S=()=>{if(!u||!u.metrics)return null;const E=u.metrics,P=E.columns;if(!P)return null;const A=()=>{switch(t.method){case"standard":return"Target:   0,   1";case"minmax":return`Target: ${t.feature_range_min??0} to ${t.feature_range_max??1}`;case"robust":return"Target: Median  0, IQR  1";case"maxabs":return"Target: MaxAbs = 1";default:return""}};return e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Scaling Statistics"}),e.jsx("div",{className:"text-[10px] text-primary/80 bg-primary/5 px-1.5 py-0.5 rounded border border-primary/10",title:"Values close to these targets indicate successful scaling.",children:A()})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto bg-background p-2 rounded border space-y-1",children:P.map((R,N)=>{let M="";if(t.method==="standard"){const z=E.mean?E.mean[N]:void 0,I=E.scale?E.scale[N]:void 0;typeof z=="number"&&(M=`=${z.toFixed(2)}, =${typeof I=="number"?I.toFixed(2):"-"}`)}else if(t.method==="minmax"){const z=E.data_min?E.data_min[N]:void 0,I=E.data_max?E.data_max[N]:void 0;typeof z=="number"&&(M=`Min=${z.toFixed(2)}, Max=${typeof I=="number"?I.toFixed(2):"-"}`)}else if(t.method==="robust"){const z=E.center?E.center[N]:void 0,I=E.scale?E.scale[N]:void 0;typeof z=="number"&&(M=`Med=${z.toFixed(2)}, IQR=${typeof I=="number"?I.toFixed(2):"-"}`)}else if(t.method==="maxabs"){const z=E.max_abs?E.max_abs[N]:void 0;typeof z=="number"&&(M=`MaxAbs=${z.toFixed(2)}`)}return e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[100px] font-medium",title:R,children:R}),e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground",children:M})]},R)})})]})};return e.jsxs("div",{ref:x,className:`flex flex-col h-full w-full bg-background ${p?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsx("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."})}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${p?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${p?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Scaling Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method,onChange:E=>r({...t,method:E.target.value}),children:[e.jsx("option",{value:"standard",children:"Standard Scaler (Z-Score)"}),e.jsx("option",{value:"minmax",children:"MinMax Scaler (0-1)"}),e.jsx("option",{value:"maxabs",children:"MaxAbs Scaler"}),e.jsx("option",{value:"robust",children:"Robust Scaler (Outlier Safe)"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:[t.method==="standard"&&"Centers data around 0 with unit variance.",t.method==="minmax"&&"Scales data to a fixed range [0, 1].",t.method==="maxabs"&&"Scales data by its maximum absolute value.",t.method==="robust"&&"Scales data using statistics that are robust to outliers."]})]}),t.method==="standard"&&e.jsxs("div",{className:"space-y-2 border-t pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_mean??!0,onChange:E=>r({...t,with_mean:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Center Data (with_mean)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_std??!0,onChange:E=>r({...t,with_std:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Scale Variance (with_std)"})]})]}),t.method==="minmax"&&e.jsxs("div",{className:"space-y-2 border-t pt-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Feature Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Min (0)",value:t.feature_range_min??0,onChange:E=>r({...t,feature_range_min:parseFloat(E.target.value)})}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Max (1)",value:t.feature_range_max??1,onChange:E=>r({...t,feature_range_max:parseFloat(E.target.value)})})]})]}),t.method==="robust"&&e.jsxs("div",{className:"space-y-2 border-t pt-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Quantile Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Min (25.0)",value:t.quantile_range_min??25,onChange:E=>r({...t,quantile_range_min:parseFloat(E.target.value)})}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Max (75.0)",value:t.quantile_range_max??75,onChange:E=>r({...t,quantile_range_max:parseFloat(E.target.value)})})]}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_centering??!0,onChange:E=>r({...t,with_centering:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Center Data (Median)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_scaling??!0,onChange:E=>r({...t,with_scaling:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Scale Data (IQR)"})]})]})]}),p&&e.jsx(S,{})]}),e.jsxs("div",{className:`flex flex-col h-full min-h-[200px] border rounded-md overflow-hidden ${p?"":"shrink-0"}`,children:[e.jsxs("div",{className:"p-2 border-b bg-muted/30 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Numeric Columns (",t.columns.length,")"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:j,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"All"}),e.jsx("button",{onClick:C,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"None"})]})]}),e.jsx("input",{type:"text",placeholder:"Search columns...",className:"w-full text-xs p-1.5 border rounded bg-background",value:g,onChange:E=>{y(E.target.value)}})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:w.length>0?w.map(E=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1.5 rounded cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(E),onChange:P=>{const A=P.target.checked?[...t.columns,E]:t.columns.filter(R=>R!==E);r({...t,columns:A})},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:E,children:E})]},E)):e.jsx("div",{className:"text-xs text-muted-foreground italic p-4 text-center",children:c?"Loading schema...":_.length===0?"No numeric columns found":"No matches found"})})]}),!p&&e.jsx(S,{})]})]})},Kv={type:"scale_numeric_features",label:"Scaling",category:"Preprocessing",description:"Scale numeric features to a standard range.",icon:xx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Scaled Data",type:"dataset"}],settings:Gv,validate:t=>({isValid:t.columns.length>0,message:t.columns.length===0?"Select at least one column":void 0}),getDefaultConfig:()=>({columns:[],method:"standard"})},ch={getAllNodes:async()=>(await Ae.get("/ml/registry")).data};function uh(){const[t,r]=f.useState(null),[n,i]=f.useState({width:0,height:0}),o=f.useCallback(d=>{if(d.length===0)return;const{width:c,height:h}=d[0].contentRect;i({width:c,height:h})},[]);return f.useEffect(()=>{if(!t)return;const d=new ResizeObserver(o);return d.observe(t),()=>{d.disconnect()}},[t,o]),[r,n]}const Jv=({text:t})=>e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(Dn,{className:"w-3 h-3 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg z-50",children:[t,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]}),Qv=({isOpen:t,onClose:r,modelType:n,onSelect:i})=>{const[o,d]=f.useState(n),[c,h]=f.useState([]),[u,x]=f.useState(!1),[p,b]=f.useState(null);f.useEffect(()=>{t&&d(n)},[t,n]);const g=f.useCallback(()=>{o&&(x(!0),b(null),$e.getTuningHistory(o).then(y=>{h(y)}).catch(y=>{console.error("Failed to fetch jobs",y),b("Failed to load history.")}).finally(()=>{x(!1)}))},[o]);return f.useEffect(()=>{t&&g()},[t,g]),t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex justify-center items-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[85vh] bg-white dark:bg-gray-800 shadow-2xl rounded-xl flex flex-col border border-gray-200 dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(Ve,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Best Parameters History"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Select parameters for:"}),e.jsxs("select",{value:o,onChange:y=>{d(y.target.value)},className:"text-xs border border-gray-200 dark:border-gray-700 rounded px-2 py-0.5 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:ring-1 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"random_forest_classifier",children:"Random Forest Classifier"}),e.jsx("option",{value:"logistic_regression",children:"Logistic Regression"}),e.jsx("option",{value:"ridge_regression",children:"Ridge Regression"}),e.jsx("option",{value:"random_forest_regressor",children:"Random Forest Regressor"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:"Refresh",children:e.jsx(xt,{className:`w-4 h-4 ${u?"animate-spin":""}`})}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",children:e.jsx(We,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/30 dark:bg-gray-900/30",children:u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx(Xe,{className:"w-8 h-8 animate-spin mb-2 text-blue-500"}),e.jsx("p",{className:"text-sm",children:"Loading history..."})]}):p?e.jsxs("div",{className:"text-center py-12 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-900/20",children:[e.jsx(lt,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:p}),e.jsx("button",{onClick:g,className:"mt-2 text-xs underline hover:text-red-600",children:"Try Again"})]}):c.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-700",children:[e.jsx(ft,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No completed optimization jobs found."}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Run an optimization job to see results here."})]}):c.map(y=>{var _;return e.jsx("div",{className:"group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:shadow-md hover:border-blue-200 dark:hover:border-blue-800 transition-all",children:e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-600 dark:text-gray-300",children:["#",y.job_id.slice(0,8)]}),e.jsx("span",{className:"text-xs text-gray-400",children:y.end_time?new Date(y.end_time).toLocaleString():"Unknown Date"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[typeof((_=y.result)==null?void 0:_.best_score)=="number"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Score:"}),e.jsx("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:y.result.best_score.toFixed(4)})]}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1",children:[e.jsx(Ma,{className:"w-3 h-3"})," Model Ready"]})]})]}),e.jsxs("button",{onClick:()=>{var w;(w=y.result)!=null&&w.best_params&&(i({params:y.result.best_params,modelType:o}),r())},className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md transition-colors flex items-center gap-1 shadow-sm shadow-blue-500/20",children:[e.jsx(Ma,{className:"w-3 h-3"}),"Apply"]})]})},y.job_id)})})]})]}):null},Yv=({value:t,type:r,onChange:n,step:i,min:o,max:d})=>{const[c,h]=f.useState("");f.useEffect(()=>{h(t===null?"None":(t==null?void 0:t.toString())??"")},[t]);const u=()=>{const x=c.trim();if(x.toLowerCase()==="none"){n(null);return}if(r==="number"){if(x==="")return;const p=Number(x);isNaN(p)?h(t===null?"None":(t==null?void 0:t.toString())??""):n(p)}else r==="boolean"?x.toLowerCase()==="true"?n(!0):x.toLowerCase()==="false"?n(!1):h((t==null?void 0:t.toString())??""):n(x)};return e.jsx("input",{type:"text",value:c,onChange:x=>{h(x.target.value)},onBlur:u,placeholder:t===null?"None":"",className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",...r==="number"?{step:i,min:o,max:d}:{}})},Xv=({config:t,onChange:r,nodeId:n})=>{const[i,o]=f.useState([]),[d,c]=f.useState(!1),[h,u]=f.useState(!1),[x,p]=f.useState(()=>!sessionStorage.getItem("hide_info_model_training")),{toggleDrawer:b,setTab:g}=na(),y=Fe(n||""),_=ye(U=>U.nodes),w=ye(U=>U.edges),C=(U=>{var ce,V,ae,ie;const q=new Set,K=[U];for(;K.length>0;){const se=K.shift();if(!se||q.has(se))continue;q.add(se);const le=_.find(xe=>xe.id===se);if(!le)continue;if(se!==U){if((ce=le.data)!=null&&ce.datasetId)return le.data.datasetId;if((V=le.data)!=null&&V.dataset_id)return le.data.dataset_id;if((ae=le.data)!=null&&ae.config){const xe=le.data.config;if(xe.datasetId)return xe.datasetId;if(xe.dataset_id)return xe.dataset_id}if((ie=le.data)!=null&&ie.params){const xe=le.data.params;if(xe.datasetId)return xe.datasetId;if(xe.dataset_id)return xe.dataset_id}}const Se=Nr(le,_,w);for(const xe of Se)K.push(xe.id)}})(n||""),{data:S}=Me(C),T=S?Object.values(S.columns):[],[E,{width:P}]=uh(),A=P>450,[R,N]=f.useState("model"),[M,z]=f.useState(!1),[I,F]=f.useState([]),[$,J]=f.useState(!1);f.useEffect(()=>{(async()=>{J(!0);try{const K=(await ch.getAllNodes()).filter(ce=>ce.category==="Model");F(K)}catch(q){console.error("Failed to fetch models:",q),F([{id:"random_forest_classifier",name:"Random Forest Classifier",category:"Model",description:"",params:{}},{id:"logistic_regression",name:"Logistic Regression",category:"Model",description:"",params:{}},{id:"ridge_regression",name:"Ridge Regression",category:"Model",description:"",params:{}},{id:"random_forest_regressor",name:"Random Forest Regressor",category:"Model",description:"",params:{}}])}finally{J(!1)}})()},[]);const ee=f.useRef(!1);f.useEffect(()=>{t.model_type&&(u(!0),$e.getHyperparameters(t.model_type).then(U=>{const q=U;if(o(q),ee.current){const K={};q.forEach(ce=>{K[ce.name]=ce.default}),r({...t,hyperparameters:K}),ee.current=!1}}).catch(console.error).finally(()=>{u(!1)}))},[t.model_type]),f.useEffect(()=>{var q;const U=(q=y.find(K=>K.target_column))==null?void 0:q.target_column;U&&t.target_column!==U&&(t.target_column||r({...t,target_column:U}))},[y,t.target_column,r]);const te=async()=>{if(n)try{const U=ti(_,w);await $e.runPipeline({...U,target_node_id:n,job_type:"basic_training"}),alert("Training job submitted successfully!"),g("basic_training"),b(!0)}catch(U){console.error("Failed to submit training job:",U),alert("Failed to submit training job. Check console for details.")}},Y=e.jsx("div",{className:"space-y-5 animate-in fade-in duration-300",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Model Configuration"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Model Type"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:t.model_type,onChange:U=>{Object.keys(t.hyperparameters).length>0&&(ee.current=!0),r({...t,model_type:U.target.value,hyperparameters:{}})},className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition-all",disabled:$,children:I.map(U=>e.jsx("option",{value:U.id,children:U.name},U.id))}),e.jsx(Ze,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Target Column"}),T.length===0&&e.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded text-xs text-yellow-700 dark:text-yellow-400 flex items-center gap-2",children:[e.jsx(wr,{className:"w-3 h-3"}),e.jsx("span",{children:"Connect a dataset node to see available columns"})]}),e.jsxs("div",{className:"relative",children:[T.length>0?e.jsxs("select",{value:t.target_column,onChange:U=>r({...t,target_column:U.target.value}),className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",children:[e.jsx("option",{value:"",children:"Select target..."}),T.map(U=>e.jsx("option",{value:U.name,children:U.name},U.name))]}):e.jsx("input",{type:"text",value:t.target_column,onChange:U=>r({...t,target_column:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",placeholder:"e.g., target"}),T.length>0&&e.jsx(Ze,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700"}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>{z(!M)},className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qn,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Cross Validation"})]}),e.jsx(Vt,{className:`w-4 h-4 text-gray-400 transition-transform ${M?"rotate-90":""}`})]}),M&&e.jsxs("div",{className:"p-3 space-y-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"cv_enabled",checked:t.cv_enabled!==!1,onChange:U=>r({...t,cv_enabled:U.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"cv_enabled",className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable Cross-Validation"})]}),t.cv_enabled!==!1&&e.jsxs("div",{className:"space-y-3 pl-6 border-l-2 border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Folds"}),e.jsx("input",{type:"number",value:t.cv_folds??5,onChange:U=>r({...t,cv_folds:Number(U.target.value)}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",min:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Method"}),e.jsxs("select",{value:t.cv_type??"k_fold",onChange:U=>r({...t,cv_type:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"k_fold",children:"K-Fold"}),e.jsx("option",{value:"stratified_k_fold",children:"Stratified"}),e.jsx("option",{value:"time_series_split",children:"Time Series"}),e.jsx("option",{value:"shuffle_split",children:"Shuffle Split"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"cv_shuffle",checked:t.cv_shuffle!==!1,onChange:U=>r({...t,cv_shuffle:U.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"cv_shuffle",className:"text-xs text-gray-600 dark:text-gray-400",children:"Shuffle Data"})]})]})]})]})]})}),W=()=>{const U=Object.keys(t.hyperparameters).length>0,q=K=>{if(K){const ce={};i.forEach(V=>{ce[V.name]=V.default}),Object.keys(t.hyperparameters).length===0&&r({...t,hyperparameters:ce})}else r({...t,hyperparameters:{}})};return e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Ro,{className:"w-4 h-4 text-blue-500"}),"Hyperparameters"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:`text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2 cursor-pointer select-none ${h?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:U,onChange:K=>{q(K.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:h}),"Customize"]})})]}),U?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:()=>{c(!0)},className:"text-xs flex items-center gap-1.5 px-2 py-1 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition-colors",children:[e.jsx(wt,{className:"w-3 h-3"}),"Load Best"]})}),h?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Xe,{className:"w-5 h-5 animate-spin text-blue-500"})}):i.map(K=>{var ce;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:K.label}),K.description&&e.jsx(Jv,{text:K.description})]}),K.type==="select"?e.jsx("select",{value:t.hyperparameters[K.name]??K.default,onChange:V=>r({...t,hyperparameters:{...t.hyperparameters,[K.name]:V.target.value}}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",children:(ce=K.options)==null?void 0:ce.map(V=>e.jsx("option",{value:String(V.value),children:V.label},String(V.value)))}):e.jsx(Yv,{type:K.type,value:t.hyperparameters[K.name]??K.default,onChange:V=>r({...t,hyperparameters:{...t.hyperparameters,[K.name]:V}}),step:K.step,min:K.min,max:K.max})]},K.name)}),i.length===0&&!h&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic text-center py-4",children:"No parameters available."})]}):e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-dashed border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Using default hyperparameters."}),e.jsxs("button",{onClick:()=>{c(!0)},className:"mt-3 text-xs flex items-center gap-1.5 px-3 py-1.5 mx-auto bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded-md border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/40 transition-colors shadow-sm",children:[e.jsx(wt,{className:"w-3 h-3"}),"Load Best Params"]})]})]})};return e.jsxs("div",{className:"flex flex-col h-full",ref:E,children:[x&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded text-xs text-blue-700 dark:text-blue-300 flex justify-between items-start gap-2",children:[e.jsx("span",{children:"Train a model using fixed parameters or defaults."}),e.jsx("button",{onClick:()=>{p(!1),sessionStorage.setItem("hide_info_model_training","true")},className:"text-blue-400 hover:text-blue-600 dark:hover:text-blue-200",children:e.jsx(We,{className:"w-3 h-3"})})]}),e.jsx(Qv,{isOpen:d,onClose:()=>{c(!1)},modelType:t.model_type,onSelect:U=>{const q=U;q.modelType&&q.modelType!==t.model_type?r({...t,model_type:q.modelType,hyperparameters:q.params}):r({...t,hyperparameters:q.params})}}),!A&&e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${R==="model"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{N("model")},children:"Configuration"}),e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${R==="params"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{N("params")},children:"Hyperparameters"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-1 pb-4 custom-scrollbar",children:A?e.jsxs("div",{className:"grid grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"overflow-y-auto pr-2",children:Y}),e.jsx("div",{className:"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-800",children:e.jsx(W,{})})]}):e.jsxs(e.Fragment,{children:[R==="model"&&Y,R==="params"&&e.jsx(W,{})]})}),e.jsx("div",{className:"pt-4 mt-auto border-t border-gray-100 dark:border-gray-700 flex flex-col gap-3 items-center",children:e.jsxs("button",{onClick:()=>{te()},className:"w-full max-w-xs flex items-center justify-center gap-2 px-6 py-2.5 text-white rounded-lg shadow-lg transition-all hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0",style:{background:"var(--main-gradient)"},children:[e.jsx(Wt,{className:"w-4 h-4 fill-current"}),e.jsx("span",{className:"text-sm font-semibold",children:"Start Training"})]})})]})},e_={type:"basic_training",label:"Basic Training",category:"Modeling",description:"Train a model with fixed or default parameters.",icon:px,inputs:[{id:"in",label:"Training Data",type:"dataset"}],outputs:[{id:"model",label:"Trained Model",type:"model"}],settings:Xv,validate:t=>t.target_column?{isValid:!0}:{isValid:!1,message:"Target column is required."},getDefaultConfig:()=>({target_column:"",model_type:"random_forest_classifier",hyperparameters:{},cv_enabled:!0,cv_folds:5,cv_type:"k_fold",cv_shuffle:!0,cv_random_state:42})},t_=({text:t})=>e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(Dn,{className:"w-3 h-3 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg z-50",children:[t,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]}),s_=({def:t,value:r,onChange:n})=>{const[i,o]=f.useState(""),[d,c]=f.useState(null);f.useEffect(()=>{o(Array.isArray(r)?r.map(x=>x===null?"None":x).join(", "):"")},[r]);const h=x=>{if(!x.trim())return[];const p=x.split(",").map(g=>g.trim()).filter(g=>g!==""),b=[];for(const g of p){if(g.toLowerCase()==="none"){b.push(null);continue}if(t.type==="number"){const y=Number(g);if(isNaN(y))throw new Error(`"${g}" is not a valid number`);b.push(y)}else if(t.type==="boolean"){const y=g.toLowerCase();if(y==="true")b.push(!0);else if(y==="false")b.push(!1);else throw new Error(`"${g}" must be true or false`)}else b.push(g)}return b},u=()=>{try{const x=h(i);c(null),JSON.stringify(x)!==JSON.stringify(r)&&n(x)}catch(x){c(x.message)}};return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 flex items-center gap-1",children:[t.label,t.description&&e.jsx(t_,{text:t.description})]}),e.jsx("span",{className:"text-[10px] text-gray-400 uppercase",children:t.type})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:`w-full border rounded px-2 py-1.5 text-sm font-mono bg-white dark:bg-gray-900 dark:text-gray-100 outline-none transition-all ${d?"border-red-500 focus:ring-2 focus:ring-red-500/20":"border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500"}`,placeholder:t.type==="select"?"e.g. lbfgs, liblinear":"e.g. 10, 50, 100",value:i,onChange:x=>{o(x.target.value),c(null)},onBlur:u}),t.type==="select"&&t.options&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.options.map(x=>e.jsx("button",{onClick:()=>{const p=h(i),g=p.includes(x.value)?p.filter(y=>y!==x.value):[...p,x.value];n(g)},className:`text-[10px] px-1.5 py-0.5 rounded border transition-colors ${r.includes(x.value)?"bg-purple-100 border-purple-200 text-purple-700 dark:bg-purple-900/30 dark:border-purple-800 dark:text-purple-300":"bg-gray-50 border-gray-200 text-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:x.label},String(x.value)))})]}),d&&e.jsxs("p",{className:"text-[10px] text-red-500 flex items-center gap-1",children:[e.jsx(lt,{className:"w-3 h-3"}),d]})]})},r_=({isOpen:t,onClose:r,modelType:n})=>{const[i,o]=f.useState(n),[d,c]=f.useState([]),[h,u]=f.useState(!1),[x,p]=f.useState(null);f.useEffect(()=>{t&&o(n)},[t,n]);const b=f.useCallback(()=>{i&&(u(!0),p(null),$e.getTuningHistory(i).then(g=>{c(g)}).catch(g=>{console.error("Failed to fetch jobs",g),p("Failed to load history.")}).finally(()=>{u(!1)}))},[i]);return f.useEffect(()=>{t&&b()},[t,b]),t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex justify-center items-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[85vh] bg-white dark:bg-gray-800 shadow-2xl rounded-xl flex flex-col border border-gray-200 dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(Ve,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Best Parameters History"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"View parameters for:"}),e.jsxs("select",{value:i,onChange:g=>{o(g.target.value)},className:"text-xs border border-gray-200 dark:border-gray-700 rounded px-2 py-0.5 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:ring-1 focus:ring-purple-500 outline-none",children:[e.jsx("option",{value:"random_forest_classifier",children:"Random Forest Classifier"}),e.jsx("option",{value:"logistic_regression",children:"Logistic Regression"}),e.jsx("option",{value:"ridge_regression",children:"Ridge Regression"}),e.jsx("option",{value:"random_forest_regressor",children:"Random Forest Regressor"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:b,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:"Refresh",children:e.jsx(xt,{className:`w-4 h-4 ${h?"animate-spin":""}`})}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",children:e.jsx(We,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/30 dark:bg-gray-900/30",children:h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx(Xe,{className:"w-8 h-8 animate-spin mb-2 text-purple-500"}),e.jsx("p",{className:"text-sm",children:"Loading history..."})]}):x?e.jsxs("div",{className:"text-center py-12 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-900/20",children:[e.jsx(lt,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:x}),e.jsx("button",{onClick:b,className:"mt-2 text-xs underline hover:text-red-600",children:"Try Again"})]}):d.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-700",children:[e.jsx(ft,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No completed optimization jobs found."}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Run an optimization job to see results here."})]}):d.map(g=>{var y;return e.jsx("div",{className:"group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:shadow-md hover:border-purple-200 dark:hover:border-purple-800 transition-all",children:e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-600 dark:text-gray-300",children:["#",g.job_id.slice(0,8)]}),e.jsx("span",{className:"text-xs text-gray-400",children:g.end_time?new Date(g.end_time).toLocaleString():"Unknown Date"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[typeof((y=g.result)==null?void 0:y.best_score)=="number"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Score:"}),e.jsx("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:g.result.best_score.toFixed(4)})]}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1",children:[e.jsx(Ma,{className:"w-3 h-3"})," Model Ready"]})]})]})})},g.job_id)})})]})]}):null},a_=({config:t,onChange:r,nodeId:n})=>{const[i,o]=f.useState([]),[d,c]=f.useState(!1),[h,u]=f.useState(!1),[x,p]=f.useState("config"),[b,g]=f.useState(!1),[y,_]=f.useState(()=>!sessionStorage.getItem("hide_info_model_optimizer")),[w,{width:j}]=uh(),C=j>450,{toggleDrawer:S,setTab:T}=na(),E=Fe(n||""),P=ye(U=>U.nodes),A=ye(U=>U.edges),N=(U=>{var ce,V,ae,ie;const q=new Set,K=[U];for(;K.length>0;){const se=K.shift();if(q.has(se))continue;q.add(se);const le=P.find(xe=>xe.id===se);if(!le)continue;if(se!==U){if((ce=le.data)!=null&&ce.datasetId)return le.data.datasetId;if((V=le.data)!=null&&V.dataset_id)return le.data.dataset_id;const xe=le.data;if((ae=xe.config)!=null&&ae.datasetId)return xe.config.datasetId;if((ie=xe.config)!=null&&ie.dataset_id)return xe.config.dataset_id}const Se=Nr(le,P,A);for(const xe of Se)K.push(xe.id)}})(n||""),{data:M}=Me(N),z=M?Object.values(M.columns):[],[I,F]=f.useState([]),[$,J]=f.useState(!1);f.useEffect(()=>{(async()=>{J(!0);try{const K=(await ch.getAllNodes()).filter(ce=>ce.category==="Model");F(K)}catch(q){console.error("Failed to fetch models:",q),F([{id:"random_forest_classifier",name:"Random Forest Classifier",category:"Model",description:"",params:{}},{id:"logistic_regression",name:"Logistic Regression",category:"Model",description:"",params:{}},{id:"ridge_regression",name:"Ridge Regression",category:"Model",description:"",params:{}},{id:"random_forest_regressor",name:"Random Forest Regressor",category:"Model",description:"",params:{}}])}finally{J(!1)}})()},[]),f.useEffect(()=>{var q;const U=(q=E.find(K=>K.target_column))==null?void 0:q.target_column;U&&t.target_column!==U&&r({...t,target_column:U})},[E,t.target_column]);const ee=f.useRef(null);f.useEffect(()=>{(async()=>{const q=t.model_type;if(!q)return;const K=q!==ee.current;if(!(!K&&i.length>0)){c(!0);try{const ce=await $e.getHyperparameters(q);if(o(ce),K){const V=await $e.getDefaultSearchSpace(q);r({...t,search_space:V||{}}),ee.current=q}}catch(ce){console.error("Failed to load model hyperparameters:",ce)}finally{c(!1)}}})()},[t.model_type]);const te=async()=>{if(n)try{const U=ti(P,A);await $e.runPipeline({...U,target_node_id:n,job_type:"advanced_tuning"}),alert("Tuning job submitted successfully!"),T("advanced_tuning"),S(!0)}catch(U){console.error("Failed to submit tuning job:",U),alert("Failed to submit tuning job.")}},Y=e.jsx("div",{className:"space-y-5 animate-in fade-in duration-300",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Model Configuration"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Model Type"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:t.model_type,onChange:U=>{r({...t,model_type:U.target.value,search_space:{}})},className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition-all",disabled:$,children:I.map(U=>e.jsx("option",{value:U.id,children:U.name},U.id))}),e.jsx(Ze,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Target Column"}),z.length===0&&e.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded text-xs text-yellow-700 dark:text-yellow-400 flex items-center gap-2",children:[e.jsx(wr,{className:"w-3 h-3"}),e.jsx("span",{children:"Connect a dataset node to see available columns"})]}),e.jsxs("div",{className:"relative",children:[z.length>0?e.jsxs("select",{value:t.target_column,onChange:U=>r({...t,target_column:U.target.value}),className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition-all",children:[e.jsx("option",{value:"",children:"Select target..."}),z.map(U=>e.jsx("option",{value:U.name,children:U.name},U.name))]}):e.jsx("input",{type:"text",value:t.target_column,onChange:U=>r({...t,target_column:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",placeholder:"e.g., target"}),z.length>0&&e.jsx(Ze,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Tuning Strategy"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Search Method"}),e.jsxs("select",{value:t.search_strategy??"random",onChange:U=>r({...t,search_strategy:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"random",children:"Random Search"}),e.jsx("option",{value:"grid",children:"Grid Search"}),e.jsx("option",{value:"halving_grid",children:"Successive Halving (Grid)"}),e.jsx("option",{value:"halving_random",children:"Successive Halving (Randomized)"}),e.jsx("option",{value:"optuna",children:"Optuna Search"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Metric"}),e.jsxs("select",{value:t.metric,onChange:U=>r({...t,metric:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"accuracy",children:"Accuracy"}),e.jsx("option",{value:"f1",children:"F1 Score"}),e.jsx("option",{value:"roc_auc",children:"ROC AUC"}),e.jsx("option",{value:"mse",children:"MSE"}),e.jsx("option",{value:"r2",children:"R2 Score"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Trials"}),e.jsx("input",{type:"number",value:t.n_trials,onChange:U=>r({...t,n_trials:Number(U.target.value)}),disabled:["grid","halving_grid"].includes(t.search_strategy),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 disabled:opacity-50",min:1})]})]})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>{g(!b)},className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qn,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Cross Validation"})]}),e.jsx(Vt,{className:`w-4 h-4 text-gray-400 transition-transform ${b?"rotate-90":""}`})]}),b&&e.jsxs("div",{className:"p-3 space-y-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"cv_enabled",checked:t.cv_enabled!==!1,onChange:U=>r({...t,cv_enabled:U.target.checked}),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("label",{htmlFor:"cv_enabled",className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable Cross-Validation"})]}),t.cv_enabled!==!1&&e.jsxs("div",{className:"space-y-3 pl-6 border-l-2 border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Folds"}),e.jsx("input",{type:"number",value:t.cv_folds??5,onChange:U=>r({...t,cv_folds:Number(U.target.value)}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",min:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Method"}),e.jsxs("select",{value:t.cv_type??"k_fold",onChange:U=>r({...t,cv_type:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"k_fold",children:"K-Fold"}),e.jsx("option",{value:"stratified_k_fold",children:"Stratified"}),e.jsx("option",{value:"time_series_split",children:"Time Series"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"cv_shuffle",checked:t.cv_shuffle!==!1,onChange:U=>r({...t,cv_shuffle:U.target.checked}),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("label",{htmlFor:"cv_shuffle",className:"text-xs text-gray-600 dark:text-gray-400",children:"Shuffle Data"})]})]})]})]})]})}),W=e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h4",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Ro,{className:"w-4 h-4 text-purple-500"}),"Hyperparameters"]})}),d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Xe,{className:"w-6 h-6 animate-spin text-purple-500"})}):e.jsxs("div",{className:"space-y-3",children:[i.map(U=>{var q;return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:e.jsx(s_,{def:U,value:((q=t.search_space)==null?void 0:q[U.name])||[],onChange:K=>{r({...t,search_space:{...t.search_space,[U.name]:K}})}})},`${t.model_type}-${U.name}`)}),i.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No hyperparameters available for this model."})]})]});return e.jsxs("div",{className:"flex flex-col h-full",ref:w,children:[y&&e.jsxs("div",{className:"mb-4 p-2 bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800 rounded text-xs text-purple-700 dark:text-purple-300 flex justify-between items-start gap-2",children:[e.jsx("span",{children:"Automatically explore configurations to find the best performing model."}),e.jsx("button",{onClick:()=>{_(!1),sessionStorage.setItem("hide_info_model_optimizer","true")},className:"text-purple-400 hover:text-purple-600 dark:hover:text-purple-200",children:e.jsx(We,{className:"w-3 h-3"})})]}),!C&&e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${x==="config"?"border-purple-500 text-purple-600 dark:text-purple-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{p("config")},children:"Configuration"}),e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${x==="search_space"?"border-purple-500 text-purple-600 dark:text-purple-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{p("search_space")},children:"Search Space"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-1 pb-4 custom-scrollbar",children:C?e.jsxs("div",{className:"grid grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"overflow-y-auto pr-2",children:Y}),e.jsx("div",{className:"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-800",children:W})]}):e.jsxs(e.Fragment,{children:[x==="config"&&Y,x==="search_space"&&W]})}),e.jsxs("div",{className:"pt-4 mt-auto border-t border-gray-100 dark:border-gray-700 flex flex-col gap-3 items-center",children:[e.jsxs("button",{onClick:()=>{te()},className:"w-full max-w-xs flex items-center justify-center gap-2 px-6 py-2.5 text-white rounded-lg shadow-lg transition-all hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0",style:{background:"var(--main-gradient)"},children:[e.jsx(Wt,{className:"w-4 h-4 fill-current"}),e.jsx("span",{className:"text-sm font-semibold",children:"Start Train-Optimization"})]}),e.jsxs("button",{onClick:()=>{u(!0)},className:"text-xs text-gray-500 hover:text-purple-600 dark:text-gray-400 dark:hover:text-purple-400 flex items-center gap-1.5 transition-colors px-3 py-1 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(Ve,{className:"w-3.5 h-3.5"}),"View Best Parameters History"]})]}),e.jsx(r_,{isOpen:h,onClose:()=>{u(!1)},modelType:t.model_type})]})},n_={type:"advanced_tuning",label:"Advanced Tuning and Training",category:"Modeling",description:"Automatically optimize model performance.",icon:fx,inputs:[{id:"in",label:"Training Data",type:"dataset"}],outputs:[{id:"model",label:"Best Model",type:"model"}],settings:a_,validate:t=>t.target_column?{isValid:!0}:{isValid:!1,message:"Target column is required."},getDefaultConfig:()=>({target_column:"",model_type:"random_forest_classifier",n_trials:10,metric:"accuracy",search_strategy:"random",cv_enabled:!0,cv_folds:5,cv_type:"k_fold",cv_shuffle:!0,cv_random_state:42,random_state:42,search_space:{}})},i_=({config:t,onChange:r,nodeId:n})=>{var E;const i=Fe(n||""),o=ye(P=>P.nodes),d=ye(P=>P.edges),c=ye(P=>P.executionResult),u=(P=>{var N;const A=new Set,R=[P];for(;R.length>0;){const M=R.shift();if(!M||A.has(M))continue;A.add(M);const z=o.find(F=>F.id===M);if(!z)continue;if(M!==P&&((N=z.data)!=null&&N.datasetId))return z.data.datasetId;const I=Nr(z,o,d);for(const F of I)R.push(F.id)}})(n||""),x=(E=i.find(P=>P.target_column))==null?void 0:E.target_column;f.useEffect(()=>{const P={};u&&t.datasetId!==u&&(P.datasetId=u),x&&t.target_column!==x&&(P.target_column=x),Object.keys(P).length>0&&r({...t,...P})},[u,x,t.datasetId,t.target_column,r]);const{data:p,isLoading:b}=Me(u||t.datasetId),g=p?Object.values(p.columns).map(P=>P.name):[],y=f.useRef(null),[_,w]=f.useState(!1);f.useEffect(()=>{if(!y.current)return;const P=new ResizeObserver(A=>{for(const R of A)w(R.contentRect.width>450)});return P.observe(y.current),()=>{P.disconnect()}},[]);const j=()=>{const P=t.problem_type||"auto";return P==="classification"?[{value:"f_classif",label:"ANOVA F-value"},{value:"mutual_info_classif",label:"Mutual Information"},{value:"chi2",label:"Chi-squared"}]:P==="regression"?[{value:"f_regression",label:"F-value"},{value:"mutual_info_regression",label:"Mutual Information"},{value:"r_regression",label:"Pearson Correlation"}]:[{value:"f_classif",label:"ANOVA F-value (Classif)"},{value:"f_regression",label:"F-value (Reg)"},{value:"mutual_info_classif",label:"Mutual Info (Classif)"},{value:"mutual_info_regression",label:"Mutual Info (Reg)"}]},C=["select_k_best","select_percentile","select_fpr","select_fdr","select_fwe","generic_univariate_select"].includes(t.method),S=["select_from_model","rfe"].includes(t.method),T=()=>{const P=c==null?void 0:c.node_results[n||""];if(!P)return null;const A=P.metrics||{},R=A.dropped_columns,N=A.feature_scores,M=A.p_values,z=A.feature_importances,I=A.variances,F=A.ranking;return e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs space-y-3",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Execution Feedback"}),P.error&&e.jsx("div",{className:"p-2 bg-destructive/10 text-destructive rounded border border-destructive/20",children:P.error}),R&&R.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1 flex justify-between items-center",children:e.jsxs("span",{children:["Dropped Columns (",R.length,")"]})}),e.jsx("div",{className:"max-h-40 overflow-y-auto bg-background p-2 rounded border space-y-1",children:R.map($=>{const J=N==null?void 0:N[$],ee=M==null?void 0:M[$],te=z==null?void 0:z[$],Y=I==null?void 0:I[$],W=F==null?void 0:F[$];return e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[120px] font-medium text-destructive",title:$,children:$}),e.jsxs("div",{className:"flex flex-col items-end text-[10px] text-muted-foreground",children:[J!==void 0&&e.jsxs("span",{children:["Score: ",J.toFixed(4)]}),ee!==void 0&&e.jsxs("span",{children:["p-val: ",ee.toExponential(2)]}),te!==void 0&&e.jsxs("span",{children:["Imp: ",te.toFixed(4)]}),Y!==void 0&&e.jsxs("span",{children:["Var: ",Y.toFixed(4)]}),W!==void 0&&e.jsxs("span",{children:["Rank: ",W]})]})]},$)})})]}):P.status==="success"&&e.jsxs("div",{className:"text-green-600 text-[10px] space-y-1",children:[e.jsx("div",{children:"No columns were dropped."}),t.method==="variance_threshold"&&e.jsxs("div",{className:"text-muted-foreground italic",children:["All features have variance > ",t.threshold??0,". Try increasing the threshold."]}),t.method==="select_k_best"&&e.jsxs("div",{className:"text-muted-foreground italic",children:["K (",t.k??10,") is likely larger than or equal to the number of features. Try reducing K."]}),t.method==="correlation_threshold"&&e.jsxs("div",{className:"text-muted-foreground italic",children:["No feature pairs found with correlation > ",t.threshold??.95,"."]})]}),(N||z)&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1",children:"Top 5 Features"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-background p-2 rounded border space-y-1",children:Object.entries(N||z||{}).sort(([,$],[,J])=>J-$).slice(0,5).map(([$,J])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"truncate max-w-[120px]",title:$,children:$}),e.jsx("span",{className:"font-mono text-[10px]",children:J.toFixed(4)})]},$))})]})]})};return e.jsxs("div",{ref:y,className:`flex flex-col h-full w-full bg-background ${_?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!u&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to configure."}),b&&!!u&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${_?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${_?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Selection Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method,onChange:P=>r({...t,method:P.target.value}),children:[e.jsxs("optgroup",{label:"Simple",children:[e.jsx("option",{value:"variance_threshold",children:"Variance Threshold"}),e.jsx("option",{value:"correlation_threshold",children:"Correlation Threshold"})]}),e.jsxs("optgroup",{label:"Univariate",children:[e.jsx("option",{value:"select_k_best",children:"Select K Best"}),e.jsx("option",{value:"select_percentile",children:"Select Percentile"}),e.jsx("option",{value:"select_fpr",children:"False Positive Rate (FPR)"}),e.jsx("option",{value:"select_fdr",children:"False Discovery Rate (FDR)"}),e.jsx("option",{value:"select_fwe",children:"Family-wise Error (FWE)"}),e.jsx("option",{value:"generic_univariate_select",children:"Generic Univariate"})]}),e.jsxs("optgroup",{label:"Model Based",children:[e.jsx("option",{value:"select_from_model",children:"Select From Model"}),e.jsx("option",{value:"rfe",children:"Recursive Feature Elimination (RFE)"})]})]})]}),t.method!=="variance_threshold"&&t.method!=="correlation_threshold"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Column"}),x?e.jsxs("div",{className:"p-2 bg-muted rounded text-sm text-muted-foreground border",children:[x," ",e.jsx("span",{className:"text-xs italic",children:"(Auto-detected)"})]}):e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column??"",onChange:P=>r({...t,target_column:P.target.value}),children:[e.jsx("option",{value:"",children:"Select Target..."}),g.map(P=>e.jsx("option",{value:P,children:P},P))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for supervised selection methods."})]}),(C||S)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Problem Type"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.problem_type??"auto",onChange:P=>r({...t,problem_type:P.target.value}),children:[e.jsx("option",{value:"auto",children:"Auto-detect"}),e.jsx("option",{value:"classification",children:"Classification"}),e.jsx("option",{value:"regression",children:"Regression"})]})]}),_&&e.jsx(T,{})]}),e.jsxs("div",{className:`space-y-4 ${_?"overflow-y-auto pl-2 border-l":"shrink-0 border-t pt-4"}`,children:[e.jsx("h4",{className:"text-xs font-semibold uppercase text-muted-foreground mb-2",children:"Parameters"}),t.method==="variance_threshold"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Threshold"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 border rounded bg-background text-sm",value:t.threshold??0,onChange:P=>r({...t,threshold:parseFloat(P.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Features with variance lower than this will be removed."})]}),t.method==="correlation_threshold"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Threshold"}),e.jsx("input",{type:"number",step:"0.01",max:"1",min:"0",className:"w-full p-2 border rounded bg-background text-sm",value:t.threshold??.95,onChange:P=>r({...t,threshold:parseFloat(P.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.correlation_method??"pearson",onChange:P=>r({...t,correlation_method:P.target.value}),children:[e.jsx("option",{value:"pearson",children:"Pearson"}),e.jsx("option",{value:"spearman",children:"Spearman"}),e.jsx("option",{value:"kendall",children:"Kendall"})]})]})]}),C&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Scoring Function"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.score_func??"",onChange:P=>r({...t,score_func:P.target.value}),children:[e.jsx("option",{value:"",children:"Auto (Default)"}),j().map(P=>e.jsx("option",{value:P.value,children:P.label},P.value))]})]}),(t.method==="select_k_best"||t.method==="rfe")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"K (Number of Features)"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.k??10,onChange:P=>r({...t,k:parseInt(P.target.value)})})]}),t.method==="select_percentile"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Percentile"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.percentile??10,onChange:P=>r({...t,percentile:parseInt(P.target.value)})})]}),["select_fpr","select_fdr","select_fwe"].includes(t.method)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Alpha (Significance)"}),e.jsx("input",{type:"number",step:"0.001",className:"w-full p-2 border rounded bg-background text-sm",value:t.alpha??.05,onChange:P=>r({...t,alpha:parseFloat(P.target.value)})})]}),t.method==="generic_univariate_select"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Mode"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.mode??"k_best",onChange:P=>r({...t,mode:P.target.value}),children:[e.jsx("option",{value:"k_best",children:"K Best"}),e.jsx("option",{value:"percentile",children:"Percentile"}),e.jsx("option",{value:"fpr",children:"FPR"}),e.jsx("option",{value:"fdr",children:"FDR"}),e.jsx("option",{value:"fwe",children:"FWE"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Parameter"}),e.jsx("input",{type:"number",step:"0.001",className:"w-full p-2 border rounded bg-background text-sm",value:t.param??1e-5,onChange:P=>r({...t,param:parseFloat(P.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value for the selected mode (e.g., k, percentile, or alpha)."})]})]}),S&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Estimator"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.estimator??"auto",onChange:P=>r({...t,estimator:P.target.value}),children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"RandomForest",children:"Random Forest"}),e.jsx("option",{value:"LogisticRegression",children:"Logistic Regression"}),e.jsx("option",{value:"LinearRegression",children:"Linear Regression"})]})]}),t.method==="select_from_model"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Threshold"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"e.g., median, mean, 1.25*mean",value:t.threshold??"median",onChange:P=>r({...t,threshold:P.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'String (e.g. "median") or float.'})]}),t.method==="rfe"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Step"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded bg-background text-sm",value:t.step??1,onChange:P=>r({...t,step:parseInt(P.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Features to remove at each iteration."})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2 border-t",children:[e.jsx("input",{type:"checkbox",id:"drop_columns",className:"rounded border-gray-300",checked:t.drop_columns!==!1,onChange:P=>r({...t,drop_columns:P.target.checked})}),e.jsx("label",{htmlFor:"drop_columns",className:"text-sm font-medium",children:"Drop Columns"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If unchecked, columns will be identified but not removed from the dataset."}),!_&&e.jsx(T,{})]})]})]})},o_={type:"feature_selection",label:"Feature Selection",category:"Preprocessing",description:"Select the most important features.",icon:Lc,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Selected",type:"dataset"}],settings:i_,validate:t=>t.method!=="variance_threshold"&&!t.target_column?{isValid:!1,message:"Target column is required for this method."}:{isValid:!0},getDefaultConfig:()=>({method:"select_k_best",k:10})},l_=({config:t,onChange:r,nodeId:n})=>{var _,w;const i=Fe(n||""),o=(_=i.find(j=>j.datasetId))==null?void 0:_.datasetId,d=(w=i.find(j=>j.target_column))==null?void 0:w.target_column;pt.useEffect(()=>{const j={};o&&t.datasetId!==o&&(j.datasetId=o),d&&t.target_column!==d&&(j.target_column=d),Object.keys(j).length>0&&r({...t,...j})},[o,d,t.datasetId,t.target_column,r]);const{data:c,isLoading:h}=Me(o||t.datasetId),u=c?Object.values(c.columns).map(j=>j.name):[],x=t.validation_size||0,p=1-t.test_size-x,b=pt.useRef(null),[g,y]=pt.useState(!1);return pt.useEffect(()=>{if(!b.current)return;const j=new ResizeObserver(C=>{for(const S of C)y(S.contentRect.width>450)});return j.observe(b.current),()=>{j.disconnect()}},[]),e.jsxs("div",{ref:b,className:`flex flex-col h-full w-full bg-background ${g?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!o&&!t.datasetId&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),h&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${g?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${g?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Test Size (0.0 - 1.0)"}),e.jsx("input",{type:"number",step:"0.05",min:"0.05",max:"0.95",className:"w-full p-2 border rounded bg-background text-sm",value:t.test_size,onChange:j=>r({...t,test_size:parseFloat(j.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Validation Size (0.0 - 1.0)"}),e.jsx("input",{type:"number",step:"0.05",min:"0.00",max:"0.95",className:"w-full p-2 border rounded bg-background text-sm",value:x,onChange:j=>r({...t,validation_size:parseFloat(j.target.value)})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(p*100),"% Training, ",Math.round(x*100),"% Validation, ",Math.round(t.test_size*100),"% Testing"]}),p<=0&&e.jsx("p",{className:"text-xs text-red-500 font-medium",children:"Error: Total split size exceeds 100%"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Random State"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.random_state,onChange:j=>r({...t,random_state:parseInt(j.target.value)})})]})]}),e.jsxs("div",{className:`space-y-4 ${g?"overflow-y-auto pl-2 border-l":"shrink-0 pt-4 border-t"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"shuffle",checked:t.shuffle,onChange:j=>r({...t,shuffle:j.target.checked})}),e.jsx("label",{htmlFor:"shuffle",className:"text-sm font-medium",children:"Shuffle Data"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"stratify",checked:t.stratify,onChange:j=>r({...t,stratify:j.target.checked})}),e.jsx("label",{htmlFor:"stratify",className:"text-sm font-medium",children:"Stratify by Target"})]}),e.jsxs("div",{className:"space-y-2 pl-6 border-l-2 border-muted",children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Column"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column??"",onChange:j=>r({...t,target_column:j.target.value}),disabled:!t.stratify,children:[e.jsx("option",{value:"",children:"-- Select Target --"}),u.map(j=>e.jsx("option",{value:j,children:j},j))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for stratification. If input is already separated (X, y), this is ignored."})]})]})]})]})},d_={type:"TrainTestSplitter",label:"Train-Test Split",category:"Preprocessing",description:"Split data into training and testing sets.",icon:Ao,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"train",label:"Train",type:"dataset"},{id:"validation",label:"Validation",type:"dataset"},{id:"test",label:"Test",type:"dataset"}],settings:l_,validate:t=>{if(t.test_size<=0||t.test_size>=1)return{isValid:!1,message:"Test size must be between 0 and 1."};const r=t.validation_size||0;return r<0||r>=1?{isValid:!1,message:"Validation size must be between 0 and 1."}:t.test_size+r>=1?{isValid:!1,message:"Sum of Test and Validation sizes must be less than 1."}:{isValid:!0}},getDefaultConfig:()=>({test_size:.2,validation_size:0,random_state:42,stratify:!1,shuffle:!0})},c_=({config:t,onChange:r,nodeId:n})=>{const i=ye(x=>x.nodes),o=ye(x=>x.edges),c=(x=>{var g;const p=new Set,b=[x];for(;b.length>0;){const y=b.shift();if(!y||p.has(y))continue;p.add(y);const _=i.find(j=>j.id===y);if(!_)continue;if(y!==x&&((g=_.data)!=null&&g.datasetId))return _.data.datasetId;const w=Nr(_,i,o);for(const j of w)b.push(j.id)}})(n||"");pt.useEffect(()=>{c&&t.datasetId!==c&&r({...t,datasetId:c})},[c,t.datasetId,r]);const{data:h}=Me(c||t.datasetId),u=h?Object.values(h.columns).map(x=>x.name):[];return e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Column"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column,onChange:x=>r({...t,target_column:x.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Target --"}),u.map(x=>e.jsx("option",{value:x,children:x},x))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This column will be separated as the target (y), and all other columns will be features (X)."})]})})},u_={type:"feature_target_split",label:"Feature-Target Split",category:"Preprocessing",description:"Separate features (X) from target (y).",icon:Ao,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"X",label:"Features (X)",type:"dataset"},{id:"y",label:"Target (y)",type:"dataset"}],settings:c_,validate:t=>t.target_column?{isValid:!0}:{isValid:!1,message:"Target column is required."},getDefaultConfig:()=>({target_column:""})},h_=({config:t,onChange:r,nodeId:n})=>{var x;const o=(x=Fe(n||"").find(p=>p.datasetId))==null?void 0:x.datasetId,{isLoading:d}=Me(o),c=ye(p=>p.executionResult),h=n?c==null?void 0:c.node_results[n]:null,u=h!=null&&h.metrics&&typeof h.metrics=="object"?h.metrics:null;return e.jsxs("div",{className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),d&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx("input",{type:"checkbox",checked:t.drop_if_any_missing,onChange:p=>r({...t,drop_if_any_missing:p.target.checked}),className:"rounded border-gray-300"}),"Drop rows with ANY missing values"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If checked, any row containing at least one missing value will be removed."})]}),e.jsxs("div",{className:`space-y-2 ${t.drop_if_any_missing?"opacity-50 pointer-events-none":""}`,children:[e.jsx("label",{className:"block text-sm font-medium",children:"Missing Value Threshold (%)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:t.missing_threshold||0,onChange:p=>r({...t,missing_threshold:parseInt(p.target.value)}),className:"flex-1"}),e.jsxs("span",{className:"text-sm w-12 text-right",children:[t.missing_threshold||0,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Drop rows that have more than this percentage of missing values."})]}),u&&u.DropMissingRows_rows_removed!==void 0&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Removed:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(u.DropMissingRows_rows_removed)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Remaining:"}),e.jsx("span",{className:"font-medium",children:String(u.DropMissingRows_rows_remaining)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Rows:"}),e.jsx("span",{className:"font-medium",children:String(u.DropMissingRows_rows_total)})]})]})]})]})},m_={type:"drop_missing_rows",label:"Drop Rows",category:"Preprocessing",description:"Drop rows based on missing values.",icon:gx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:h_,validate:t=>({isValid:!0}),getDefaultConfig:()=>({drop_if_any_missing:!1,missing_threshold:50})},x_=({config:t,onChange:r,nodeId:n})=>{var j;const o=(j=Fe(n||"").find(C=>C.datasetId))==null?void 0:j.datasetId,{data:d,isLoading:c}=Me(o),h=d?Object.values(d.columns).map(C=>C.name):[],u=ye(C=>C.executionResult),x=n?u==null?void 0:u.node_results[n]:null,p=x!=null&&x.metrics&&typeof x.metrics=="object"?x.metrics:null,[b,g]=f.useState(""),y=f.useMemo(()=>h.filter(C=>C.toLowerCase().includes(b.toLowerCase())),[h,b]),_=()=>{r({...t,subset:y})},w=()=>{const C=t.subset.filter(S=>!y.includes(S));r({...t,subset:C})};return e.jsxs("div",{className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Keep Strategy"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.keep,onChange:C=>r({...t,keep:C.target.value}),children:[e.jsx("option",{value:"first",children:"Keep First Occurrence"}),e.jsx("option",{value:"last",children:"Keep Last Occurrence"}),e.jsx("option",{value:"none",children:"Drop All Duplicates"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Determines which duplicates (if any) to keep."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Subset Columns (Optional)"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subset.length," selected"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Only consider these columns for identifying duplicates. If empty, all columns are used."}),e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full px-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary outline-none",value:b,onChange:C=>{g(C.target.value)}}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:_,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:w,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),h.length>0?e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto border rounded p-2 bg-background",children:[y.map(C=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary focus:ring-primary",checked:t.subset.includes(C),onChange:S=>{const T=S.target.checked?[...t.subset,C]:t.subset.filter(E=>E!==C);r({...t,subset:T})}}),C]},C)),y.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:['No columns match "',b,'"']})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic border rounded p-4 text-center",children:"No columns available"})]}),p&&p.Deduplicate_rows_removed!==void 0&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Duplicates Removed:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(p.Deduplicate_rows_removed)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Remaining:"}),e.jsx("span",{className:"font-medium",children:String(p.Deduplicate_rows_remaining)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Rows:"}),e.jsx("span",{className:"font-medium",children:String(p.Deduplicate_rows_total)})]})]})]})]})},p_={type:"deduplicate",label:"Deduplicate",category:"Preprocessing",description:"Remove duplicate rows.",icon:bx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Unique Data",type:"dataset"}],settings:x_,validate:t=>({isValid:!0}),getDefaultConfig:()=>({subset:[],keep:"first"})},f_=[{value:"float",label:"Float (Decimal)"},{value:"int",label:"Integer"},{value:"string",label:"String (Text)"},{value:"category",label:"Category"},{value:"bool",label:"Boolean"},{value:"datetime",label:"Datetime"}],g_=({config:t,onChange:r,nodeId:n})=>{var S;const o=(S=Fe(n||"").find(T=>T.datasetId))==null?void 0:S.datasetId,{data:d,isLoading:c}=Me(o),h=d?Object.values(d.columns).map(T=>T.name):[],u=ye(T=>T.executionResult),x=n?u==null?void 0:u.node_results[n]:null,p=x!=null&&x.metrics&&typeof x.metrics=="object"?x.metrics:null,b=f.useRef(null),[g,y]=f.useState(!1);f.useEffect(()=>{if(!b.current)return;const T=new ResizeObserver(E=>{for(const P of E)y(P.contentRect.width>450)});return T.observe(b.current),()=>{T.disconnect()}},[]);const _=()=>{if(h.length===0)return;const T=h.find(E=>!t.column_types[E])||h[0];r({...t,column_types:{...t.column_types,[T]:"float"}})},w=T=>{const E={...t.column_types};Reflect.deleteProperty(E,T),r({...t,column_types:E})},j=(T,E)=>{if(T===E)return;const P=t.column_types[T],A={...t.column_types};Reflect.deleteProperty(A,T),A[E]=P,r({...t,column_types:A})},C=(T,E)=>{r({...t,column_types:{...t.column_types,[T]:E}})};return e.jsxs("div",{ref:b,className:"p-4 space-y-4 h-full overflow-y-auto",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Casting Rules"}),e.jsx("button",{onClick:_,disabled:!o||h.length===0,className:"p-1.5 bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 transition-colors",title:"Add Casting Rule",children:e.jsx(Ut,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:`space-y-2 ${g?"grid grid-cols-2 gap-2 space-y-0":""}`,children:[Object.entries(t.column_types).map(([T,E])=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-muted/10 group",children:[e.jsxs("div",{className:"flex-1 space-y-2 min-w-0",children:[e.jsx("select",{className:"w-full p-1.5 text-sm border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:T,onChange:P=>{j(T,P.target.value)},children:h.map(P=>e.jsx("option",{value:P,disabled:P!==T&&!!t.column_types[P],children:P},P))}),e.jsx("select",{className:"w-full p-1.5 text-sm border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:E,onChange:P=>{C(T,P.target.value)},children:f_.map(P=>e.jsx("option",{value:P.value,children:P.label},P.value))})]}),e.jsx("button",{onClick:()=>{w(T)},className:"p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded transition-colors",title:"Remove Rule",children:e.jsx(Ys,{className:"w-4 h-4"})})]},T)),Object.keys(t.column_types).length===0&&e.jsx("div",{className:`text-xs text-muted-foreground italic border border-dashed rounded p-8 text-center ${g?"col-span-2":""}`,children:"No casting rules defined. Click + to add one."})]})]}),p&&(p.cast_errors!==void 0||p.casted_columns_count!==void 0)&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[p.casted_columns_count!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Columns Casted:"}),e.jsx("span",{className:"font-medium",children:String(p.casted_columns_count)})]}),p.cast_errors!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Errors Encountered:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(p.cast_errors)})]})]})]})]})},b_={type:"casting",label:"Cast Types",category:"Preprocessing",description:"Cast columns to specific data types.",icon:yx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Casted Data",type:"dataset"}],settings:g_,validate:t=>({isValid:!0}),getDefaultConfig:()=>({column_types:{}})},y_=({config:t,onChange:r,nodeId:n})=>{var j;const o=(j=Fe(n||"").find(C=>C.datasetId))==null?void 0:j.datasetId,{data:d,isLoading:c}=Me(o),h=d?Object.values(d.columns).map(C=>C.name):[],u=ye(C=>C.executionResult),x=n?u==null?void 0:u.node_results[n]:null,p=x!=null&&x.metrics&&typeof x.metrics=="object"?x.metrics:null,[b,g]=f.useState(""),y=f.useMemo(()=>h.filter(C=>C.toLowerCase().includes(b.toLowerCase())),[h,b]),_=()=>{r({...t,columns:y})},w=()=>{const C=t.columns.filter(S=>!y.includes(S));r({...t,columns:C})};return e.jsxs("div",{className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Indicator Suffix"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.flag_suffix,onChange:C=>r({...t,flag_suffix:C.target.value}),placeholder:"_was_missing"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Suffix added to the new indicator columns (e.g., "Age_was_missing").'})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Target Columns (Optional)"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Create indicators for these columns. If empty, all columns with missing values are used."}),e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full px-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary outline-none",value:b,onChange:C=>{g(C.target.value)}}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:_,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:w,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),h.length>0?e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto border rounded p-2 bg-background",children:[y.map(C=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary focus:ring-primary",checked:t.columns.includes(C),onChange:S=>{const T=S.target.checked?[...t.columns,C]:t.columns.filter(E=>E!==C);r({...t,columns:T})}}),C]},C)),y.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:['No columns match "',b,'"']})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic border rounded p-4 text-center",children:"No columns available"})]}),(()=>{const C=p==null?void 0:p.missing_indicators_created,S=Array.isArray(p==null?void 0:p.missing_indicators_columns)?p==null?void 0:p.missing_indicators_columns:[];return C===void 0?null:e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Indicators Created:"}),e.jsx("span",{className:"font-medium text-primary",children:String(C)})]}),S.length>0&&e.jsxs("div",{className:"pt-1 border-t mt-1",children:[e.jsx("span",{className:"text-muted-foreground block mb-1",children:"New Columns:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:S.map(T=>{const E=String(T);return e.jsx("span",{className:"px-1.5 py-0.5 bg-background border rounded text-[10px] font-mono",children:E},E)})})]})]})]})})()]})},v_={type:"MissingIndicator",label:"Missing Indicator",category:"Preprocessing",description:"Create binary indicators for missing values.",icon:vx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Augmented Data",type:"dataset"}],settings:y_,validate:t=>({isValid:!0}),getDefaultConfig:()=>({columns:[],flag_suffix:"_was_missing"})},__=({config:t,onChange:r,nodeId:n})=>{var R;const o=(R=Fe(n||"").find(N=>N.datasetId))==null?void 0:R.datasetId,{data:d,isLoading:c}=Me(o),[h,u]=f.useState(""),x=f.useRef(null),[p,b]=f.useState(!1),g=ye(N=>N.executionResult),y=n?g==null?void 0:g.node_results[n]:null,_=y!=null&&y.metrics&&typeof y.metrics=="object"?y.metrics:null,w=_!=null&&_.categories_count&&typeof _.categories_count=="object"?_.categories_count:null,j=_!=null&&_.classes_count&&typeof _.classes_count=="object"?_.classes_count:null,S=((g==null?void 0:g.recommendations)||[]).filter(N=>N.suggested_node_type==="encoding"||N.type.includes("encoding")||N.type.includes("cardinality"));f.useEffect(()=>{if(!x.current)return;const N=new ResizeObserver(M=>{for(const z of M)b(z.contentRect.width>400)});return N.observe(x.current),()=>{N.disconnect()}},[]);const T=d?Object.values(d.columns).filter(N=>["object","string","category","bool"].some(M=>N.dtype.toLowerCase().includes(M))).map(N=>N.name):[],E=T.filter(N=>N.toLowerCase().includes(h.toLowerCase())),P=()=>{r({...t,columns:[...T]})},A=()=>{r({...t,columns:[]})};return e.jsxs("div",{ref:x,className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{className:`grid gap-4 ${p?"grid-cols-2":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Encoding Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.method,onChange:N=>r({...t,method:N.target.value}),children:[e.jsx("option",{value:"onehot",children:"One-Hot Encoding"}),e.jsx("option",{value:"dummy",children:"Dummy Encoding"}),e.jsx("option",{value:"label",children:"Label Encoding"}),e.jsx("option",{value:"ordinal",children:"Ordinal Encoding"}),e.jsx("option",{value:"target",children:"Target Encoding"}),e.jsx("option",{value:"hash",children:"Hash Encoding"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.method==="onehot"&&"Creates binary columns for each category.",t.method==="dummy"&&"Like One-Hot but drops first category to avoid collinearity.",t.method==="label"&&"Assigns a unique integer to each category.",t.method==="ordinal"&&"Encodes categories as ordered integers.",t.method==="target"&&"Encodes categories based on target mean.",t.method==="hash"&&"Maps categories to a fixed number of features."]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.drop_original!==!1,onChange:N=>r({...t,drop_original:N.target.checked}),className:"rounded border-gray-300"}),"Drop Original Column"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground ml-5",children:"If unchecked, keeps the original column alongside encoded features."})]})]}),e.jsxs("div",{className:"space-y-2",children:[(t.method==="onehot"||t.method==="dummy")&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.method==="dummy"?!0:t.drop_first||!1,disabled:t.method==="dummy",onChange:N=>r({...t,drop_first:N.target.checked}),className:"rounded border-gray-300"}),"Drop First Category"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium",children:"Handle Unknown"}),e.jsxs("select",{className:"w-full p-1 text-sm border rounded",value:t.handle_unknown||"ignore",onChange:N=>r({...t,handle_unknown:N.target.value}),title:"How to handle categories seen in test data but not in training data.",children:[e.jsx("option",{value:"ignore",children:"Ignore (Zeros)"}),e.jsx("option",{value:"error",children:"Raise Error"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:'"Ignore" produces all-zeros for unknown categories.'})]})]}),t.method==="target"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Target Column"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column||"",onChange:N=>r({...t,target_column:N.target.value}),children:[e.jsx("option",{value:"",children:"Select a target column..."}),d&&Object.values(d.columns).map(N=>e.jsxs("option",{value:N.name,children:[N.name," (",N.dtype,")"]},N.name))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The column to use for calculating target statistics."})]}),t.method==="hash"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Number of Features"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded",value:t.n_features||8,onChange:N=>r({...t,n_features:parseInt(N.target.value)})})]}),t.method==="ordinal"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Unknown Value"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded",value:t.unknown_value??-1,onChange:N=>r({...t,unknown_value:parseInt(N.target.value)}),title:"Integer to assign for unknown categories."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value assigned to unknown categories (default: -1)."})]}),t.method==="label"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Missing/Unknown Code"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded",value:t.missing_code??-1,onChange:N=>r({...t,missing_code:parseInt(N.target.value)}),title:"Integer to assign for missing or unknown categories."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value assigned to missing/unknown categories (default: -1)."})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Columns to Encode"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full px-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary outline-none",value:h,onChange:N=>{u(N.target.value)}}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:P,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:A,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),T.length>0?e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto border rounded p-2 bg-background",children:[E.map(N=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary focus:ring-primary",checked:t.columns.includes(N),onChange:M=>{const z=M.target.checked?[...t.columns,N]:t.columns.filter(I=>I!==N);r({...t,columns:z})}}),N]},N)),E.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:['No columns match "',h,'"']})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic border rounded p-4 text-center",children:"No categorical columns found"})]}),S.length>0&&e.jsx(Sr,{recommendations:S}),_&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[_.encoded_columns_count!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Columns Encoded:"}),e.jsx("span",{className:"font-medium",children:String(_.encoded_columns_count)})]}),_.new_features_count!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"New Features Created:"}),e.jsx("span",{className:"font-medium text-primary",children:String(_.new_features_count)})]}),w&&e.jsxs("div",{className:"mt-2 border-t pt-2",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Categories Found:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:Object.entries(w).map(([N,M])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:N,children:[N,":"]}),e.jsx("span",{className:"font-mono",children:String(M)})]},N))})]}),j&&e.jsxs("div",{className:"mt-2 border-t pt-2",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Classes Found:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:Object.entries(j).map(([N,M])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:N,children:[N,":"]}),e.jsx("span",{className:"font-mono",children:String(M)})]},N))})]})]})]})]})},j_={type:"encoding",label:"Encoding",category:"Preprocessing",description:"Encode categorical variables.",icon:Do,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Encoded Data",type:"dataset"}],settings:__,validate:t=>t.columns.length===0?{isValid:!1,error:"Select at least one column"}:{isValid:!0},getDefaultConfig:()=>({method:"onehot",columns:[],drop_first:!1,handle_unknown:"ignore",n_features:8,unknown_value:-1,missing_code:-1})},w_=({config:t,onChange:r,nodeId:n})=>{const i=ye(R=>R.nodes),o=ye(R=>R.edges),c=(R=>{var z;const N=new Set,M=[R];for(;M.length>0;){const I=M.shift();if(!I||N.has(I))continue;N.add(I);const F=i.find(J=>J.id===I);if(!F)continue;if(I!==R&&((z=F.data)!=null&&z.datasetId))return F.data.datasetId;const $=Nr(F,i,o);for(const J of $)M.push(J.id)}})(n||""),{data:h,isLoading:u}=Me(c),x=da(n||"",{types:["outlier_removal","cleaning"],suggestedNodeTypes:["OutlierRemoval","outlier"],scope:"column"}),p=ye(R=>R.executionResult),b=n?p==null?void 0:p.node_results[n]:null,g=f.useRef(null),[y,_]=f.useState(!1),[w,j]=f.useState("");f.useEffect(()=>{if(!g.current)return;const R=new ResizeObserver(N=>{for(const M of N)_(M.contentRect.width>450)});return R.observe(g.current),()=>{R.disconnect()}},[]);const C=h?Object.values(h.columns).filter(R=>["int","float","number"].some(N=>R.dtype.toLowerCase().includes(N))).map(R=>R.name):[],S=C.filter(R=>R.toLowerCase().includes(w.toLowerCase())),T=()=>{r({...t,columns:S})},E=()=>{const R=t.columns.filter(N=>!S.includes(N));r({...t,columns:R})},P=()=>{if(!b||!b.metrics)return null;const R=b.metrics,N=R.rows_removed,M=R.rows_remaining,z=R.rows_total??(N??0)+(M??0),I=R.bounds,F=R.stats,$=R.contamination,J=R.warnings,ee=R.values_clipped;if(N===void 0&&!I&&!F&&$===void 0&&!J&&ee===void 0)return null;const te=()=>{switch(t.method){case"iqr":return"Removes statistical outliers (IQR)";case"zscore":return"Removes deviations > 3";case"winsorize":return"Clips extreme values";case"elliptic_envelope":return"Detects multivariate anomalies";default:return""}};return e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Execution Feedback"}),e.jsx("div",{className:"text-[10px] text-primary/80 bg-primary/5 px-1.5 py-0.5 rounded border border-primary/10",title:"Goal of the selected method",children:te()})]}),J&&J.length>0&&e.jsxs("div",{className:"p-2 bg-yellow-50 text-yellow-800 rounded border border-yellow-200",children:[e.jsx("div",{className:"font-medium mb-1",children:"Warnings"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:J.map((Y,W)=>e.jsx("li",{className:"truncate",title:Y,children:Y},W))})]}),t.method==="winsorize"?e.jsxs("div",{className:"flex justify-between items-center p-2 bg-background rounded border",children:[e.jsx("span",{className:"text-muted-foreground",children:"Values Clipped"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-mono font-medium text-blue-600",children:ee??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground block",children:"(Replaced with bounds)"})]})]}):e.jsxs("div",{className:"flex justify-between items-center p-2 bg-background rounded border",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Removed"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"font-mono font-medium text-destructive",children:N??0}),z>0&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",((N??0)/z*100).toFixed(1),"%)"]})]}),M!==void 0&&e.jsxs("span",{className:"text-[10px] text-muted-foreground block",children:[M," remaining"]})]})]}),$!==void 0&&e.jsxs("div",{className:"flex justify-between items-center p-2 bg-background rounded border",children:[e.jsx("span",{className:"text-muted-foreground",children:"Contamination"}),e.jsxs("span",{className:"font-mono font-medium",children:[($*100).toFixed(1),"%"]})]}),I&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1",children:"Calculated Bounds"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-background p-2 rounded border space-y-1",children:Object.entries(I).map(([Y,W])=>e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[100px] font-medium",title:Y,children:Y}),e.jsxs("span",{className:"font-mono text-[10px] text-muted-foreground",children:["[",W.lower.toFixed(2),", ",W.upper.toFixed(2),"]"]})]},Y))})]}),F&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1",children:"Z-Score Stats"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-background p-2 rounded border space-y-1",children:Object.entries(F).map(([Y,W])=>e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[100px] font-medium",title:Y,children:Y}),e.jsxs("span",{className:"font-mono text-[10px] text-muted-foreground",children:["=",W.mean.toFixed(2),", =",W.std.toFixed(2)]})]},Y))})]})]})},A=()=>{const R=[];if(b&&b.metrics){const M=b.metrics,z=M.rows_removed,F=M.rows_total??M[`${t.method==="elliptic_envelope"?"EllipticEnvelope":t.method==="zscore"?"ZScore":t.method==="winsorize"?"Winsorize":"IQR"}_rows_total`];if(z!==void 0&&F!==void 0&&F>0){const $=z/F;$>.2?R.push({rule_id:"high_data_loss",type:"warning",description:"High data loss (>20%).",reasoning:"Consider relaxing parameters (e.g., higher IQR multiplier or Z-Score threshold) or using Winsorization to clip values instead of removing rows.",suggested_node_type:"OutlierRemoval",suggested_params:{},confidence:1,target_columns:[]}):$===0&&t.method!=="winsorize"&&R.push({rule_id:"no_outliers",type:"info",description:"No outliers detected.",reasoning:"If you suspect outliers, try tightening the parameters (e.g., lower IQR multiplier).",suggested_node_type:"OutlierRemoval",suggested_params:{},confidence:1,target_columns:[]})}t.method==="elliptic_envelope"&&R.push({rule_id:"elliptic_stochastic",type:"info",description:"Stochastic Method",reasoning:"Elliptic Envelope is stochastic. Results may vary slightly between runs.",suggested_node_type:"OutlierRemoval",suggested_params:{},confidence:1,target_columns:[]})}const N=[...x,...R];return N.length===0?null:e.jsx("div",{className:"mt-4",children:e.jsx(Sr,{recommendations:N})})};return e.jsxs("div",{ref:g,className:`flex flex-col h-full w-full bg-background ${y?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsx("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:!c&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."})}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${y?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${y?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method,onChange:R=>r({...t,method:R.target.value}),children:[e.jsx("option",{value:"iqr",children:"IQR (Interquartile Range)"}),e.jsx("option",{value:"zscore",children:"Z-Score (Standard Deviation)"}),e.jsx("option",{value:"winsorize",children:"Winsorize (Clip Values)"}),e.jsx("option",{value:"elliptic_envelope",children:"Elliptic Envelope (Multivariate)"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:[t.method==="iqr"&&"Removes rows with values outside Q1/Q3  multiplier * IQR.",t.method==="zscore"&&"Removes rows with values more than N standard deviations from mean.",t.method==="winsorize"&&"Clips values to specified percentiles instead of removing rows.",t.method==="elliptic_envelope"&&"Fits a robust covariance estimate to detect outliers."]})]}),t.method==="iqr"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Multiplier"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full p-2 border rounded bg-background text-sm",value:t.multiplier??1.5,onChange:R=>r({...t,multiplier:parseFloat(R.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usually 1.5 for outliers, 3.0 for extreme outliers."})]}),t.method==="zscore"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Threshold (Sigma)"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full p-2 border rounded bg-background text-sm",value:t.threshold??3,onChange:R=>r({...t,threshold:parseFloat(R.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of standard deviations to tolerate."})]}),t.method==="winsorize"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Percentiles"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-muted-foreground",children:"Lower"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.lower_percentile??5,onChange:R=>r({...t,lower_percentile:parseFloat(R.target.value)})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-muted-foreground",children:"Upper"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.upper_percentile??95,onChange:R=>r({...t,upper_percentile:parseFloat(R.target.value)})})]})]})]}),t.method==="elliptic_envelope"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Contamination"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"0.5",className:"w-full p-2 border rounded bg-background text-sm",value:t.contamination??.01,onChange:R=>r({...t,contamination:parseFloat(R.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Expected proportion of outliers in the dataset."})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx(A,{})]})]}),e.jsxs("div",{className:`flex flex-col h-full min-h-[200px] border rounded-md overflow-hidden ${y?"":"shrink-0"}`,children:[e.jsxs("div",{className:"p-2 border-b bg-muted/30 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Numeric Columns (",t.columns.length,")"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:T,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"All"}),e.jsx("button",{onClick:E,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"None"})]})]}),e.jsx("input",{type:"text",placeholder:"Search columns...",className:"w-full text-xs p-1.5 border rounded bg-background",value:w,onChange:R=>{j(R.target.value)}})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:S.length>0?S.map(R=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1.5 rounded cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(R),onChange:N=>{const M=N.target.checked?[...t.columns,R]:t.columns.filter(z=>z!==R);r({...t,columns:M})},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:R,children:R})]},R)):e.jsx("div",{className:"text-xs text-muted-foreground italic p-4 text-center",children:u?"Loading schema...":C.length===0?"No numeric columns found":"No matches found"})})]}),!y&&e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx(A,{})]})]})]})},N_={type:"outlier",label:"Outlier Removal",category:"Preprocessing",description:"Detect and remove or clip outliers.",icon:_x,inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Cleaned"}],settings:w_,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:{isValid:!0},getDefaultConfig:()=>({method:"iqr",columns:[],multiplier:1.5,threshold:3,lower_percentile:5,upper_percentile:95,contamination:.01})},Ki={power:{label:"Power Transforms",methods:[{value:"yeo-johnson",label:"Yeo-Johnson"},{value:"box-cox",label:"Box-Cox (>0 only)"}]},simple:{label:"Simple Math",methods:[{value:"log",label:"Log (log1p)"},{value:"square_root",label:"Square Root"},{value:"cube_root",label:"Cube Root"},{value:"reciprocal",label:"Reciprocal (1/x)"},{value:"square",label:"Square (x)"},{value:"exponential",label:"Exponential (e)"}]}},k_=t=>["yeo-johnson","box-cox"].includes(t)?"power":"simple",C_=({allColumns:t,selectedColumns:r,onChange:n})=>{const[i,o]=f.useState(""),d=f.useMemo(()=>t.filter(x=>x.toLowerCase().includes(i.toLowerCase())),[t,i]),c=()=>{const x=Array.from(new Set([...r,...d]));n(x)},h=()=>{const x=r.filter(p=>!d.includes(p));n(x)},u=x=>{r.includes(x)?n(r.filter(p=>p!==x)):n([...r,x])};return e.jsxs("div",{className:"space-y-2 border rounded p-2 bg-background",children:[e.jsx("div",{className:"flex gap-2 items-center",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ts,{className:"absolute left-2 top-1.5 w-3 h-3 text-muted-foreground"}),e.jsx("input",{className:"w-full pl-7 pr-2 py-1 text-xs border rounded bg-background",placeholder:"Search columns...",value:i,onChange:x=>{o(x.target.value)}})]})}),e.jsxs("div",{className:"flex gap-2 text-xs border-b pb-2",children:[e.jsx("button",{onClick:c,className:"text-primary hover:underline font-medium",children:"Select All"}),e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsx("button",{onClick:h,className:"text-muted-foreground hover:underline",children:"None"}),e.jsxs("span",{className:"ml-auto text-muted-foreground",children:[r.length," selected"]})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 pt-1",children:d.length===0?e.jsxs("div",{className:"text-xs text-muted-foreground p-2 text-center",children:['No columns match "',i,'"']}):d.map(x=>e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer hover:bg-accent/50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.includes(x),onChange:()=>{u(x)},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:x,children:x})]},x))})]})},S_=({config:t,onChange:r,nodeId:n})=>{var E;const i=f.useMemo(()=>t||{transformations:[]},[t]),o=f.useMemo(()=>Array.isArray(i.transformations)?i.transformations:[],[i.transformations]),[d,c]=f.useState([]),h=f.useRef(null),[u,x]=f.useState(!1);f.useEffect(()=>{if(!h.current)return;const P=new ResizeObserver(A=>{for(const R of A)x(R.contentRect.width>450)});return P.observe(h.current),()=>{P.disconnect()}},[]);const b=(E=Fe(n||"").find(P=>P.datasetId))==null?void 0:E.datasetId,{data:g}=Me(b),y=f.useMemo(()=>g!=null&&g.columns?Object.values(g.columns).filter(P=>["int","float","number"].some(A=>P.dtype.toLowerCase().includes(A))).map(P=>P.name):[],[g]),_=()=>{const P=o.length;c(A=>[...A,P]),r({transformations:[...o,{columns:[],method:"log",params:{}}]})},w=(P,A)=>{const R=[...o];R[P]={...R[P],...A},r({transformations:R})},j=P=>{const A=[...o];A.splice(P,1),r({transformations:A}),c(R=>R.filter(N=>N!==P).map(N=>N>P?N-1:N))},C=P=>{c(A=>A.includes(P)?A.filter(R=>R!==P):[...A,P])},S=(P,A)=>{const R=Ki[A].methods[0].value;w(P,{method:R})},T=da(n||"",{types:["transformation","preprocessing"],suggestedNodeTypes:["TransformationNode"],scope:"column"});return e.jsxs("div",{ref:h,className:"p-4 space-y-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium",children:"Transformation Rules"}),e.jsxs("button",{onClick:_,className:"flex items-center gap-1 text-xs bg-primary text-primary-foreground px-2 py-1 rounded hover:bg-primary/90",children:[e.jsx(Ut,{size:12})," Add Rule"]})]}),e.jsxs("div",{className:"space-y-4",children:[o.map((P,A)=>{var z,I,F;const R=k_(P.method),N=d.includes(A),M=((z=Ki[R].methods.find($=>$.value===P.method))==null?void 0:z.label)||P.method;return e.jsxs("div",{className:"border rounded bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>{C(A)},children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[N?e.jsx(Ze,{size:16,className:"text-muted-foreground flex-shrink-0"}):e.jsx(Vt,{size:16,className:"text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:M}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:P.columns.length===0?"No columns selected":`${P.columns.length} columns`})]})]}),e.jsx("button",{onClick:$=>{$.stopPropagation(),j(A)},className:"text-destructive hover:bg-destructive/10 p-1.5 rounded flex-shrink-0",title:"Remove rule",children:e.jsx(Ys,{size:14})})]}),N&&e.jsxs("div",{className:`p-3 border-t bg-accent/5 animate-in slide-in-from-top-2 duration-200 ${u?"grid grid-cols-2 gap-4":"space-y-3"}`,children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Method"}),e.jsxs("select",{className:"w-full p-1.5 border rounded text-xs bg-background font-medium",value:R,onChange:$=>{S(A,$.target.value)},onClick:$=>{$.stopPropagation()},children:[e.jsx("option",{value:"simple",children:"Simple Math"}),e.jsx("option",{value:"power",children:"Power Transform"})]}),e.jsx("select",{className:"w-full p-1.5 border rounded text-xs bg-background",value:P.method,onChange:$=>{w(A,{method:$.target.value})},onClick:$=>{$.stopPropagation()},children:Ki[R].methods.map($=>e.jsx("option",{value:$.value,children:$.label},$.value))})]}),(P.method==="yeo-johnson"||P.method==="box-cox")&&e.jsxs("div",{className:"flex items-center gap-2 pt-1",onClick:$=>{$.stopPropagation()},children:[e.jsx("input",{type:"checkbox",id:`std-${A}`,checked:((I=P.params)==null?void 0:I.standardize)!==!1,onChange:$=>{w(A,{params:{...P.params,standardize:$.target.checked}})}}),e.jsx("label",{htmlFor:`std-${A}`,className:"text-xs text-muted-foreground",children:"Standardize result"})]}),P.method==="exponential"&&e.jsxs("div",{className:"flex flex-col gap-1 pt-1",onClick:$=>{$.stopPropagation()},children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Clip Threshold:"}),e.jsx("input",{type:"number",className:"w-full p-1 border rounded text-xs",value:((F=P.params)==null?void 0:F.clip_threshold)||700,onChange:$=>{w(A,{params:{...P.params,clip_threshold:parseFloat($.target.value)}})}})]})]}),e.jsxs("div",{className:"space-y-1 min-w-0",onClick:$=>{$.stopPropagation()},children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Target Columns"}),e.jsx(C_,{allColumns:y,selectedColumns:P.columns,onChange:$=>{w(A,{columns:$})}})]})]})]},A)}),o.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-8 border border-dashed rounded bg-muted/20",children:["No transformation rules defined.",e.jsx("br",{}),'Click "Add Rule" to start.']})]}),e.jsx(Sr,{recommendations:T||[],onApply:P=>{var M;const A=P,R=A.suggested_params.method||((M=A.params)==null?void 0:M.method)||"log",N=A.target_columns||[];if(N.length>0){const z=o.length;c(I=>[...I,z]),r({transformations:[...o,{columns:N,method:R,params:{}}]})}}})]})},P_={type:"TransformationNode",label:"Transformation",description:"Apply mathematical transformations to features.",icon:Mc,category:"Preprocessing",inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Transformed"}],validate:t=>{if(t.transformations.length===0)return{isValid:!1,message:"Add at least one transformation rule."};for(const r of t.transformations)if(r.columns.length===0)return{isValid:!1,message:"Each rule must have at least one column selected."};return{isValid:!0}},settings:S_,getDefaultConfig:()=>({transformations:[]})},T_=({value:t,onChange:r})=>{const[n,i]=f.useState((t==null?void 0:t.join(", "))||""),o=f.useRef(t);f.useEffect(()=>{JSON.stringify(t)!==JSON.stringify(o.current)&&(i((t==null?void 0:t.join(", "))||""),o.current=t)},[t]);const d=()=>{const c=n.split(",").map(h=>parseFloat(h.trim())).filter(h=>!isNaN(h)).sort((h,u)=>h-u);r(c)};return e.jsx("input",{type:"text",className:"w-full p-1 text-xs border rounded bg-background text-foreground",placeholder:"0, 10, 20, 100...",value:n,onChange:c=>{i(c.target.value)},onBlur:d})},L_=({config:t,onChange:r,nodeId:n})=>{var C;const o=(C=Fe(n||"").find(S=>S.datasetId))==null?void 0:C.datasetId,{data:d,isLoading:c}=Me(o),h=f.useRef(null),[u,x]=f.useState(!1),[p,b]=f.useState("");f.useEffect(()=>{if(!h.current)return;const S=new ResizeObserver(T=>{for(const E of T)x(E.contentRect.width>450)});return S.observe(h.current),()=>{S.disconnect()}},[]);const g=d?Object.values(d.columns).filter(S=>["int","float","number"].some(T=>S.dtype.toLowerCase().includes(T))).map(S=>S.name):[],y=g.filter(S=>S.toLowerCase().includes(p.toLowerCase())),_=()=>{r({...t,columns:y})},w=()=>{const S=t.columns.filter(T=>!y.includes(T));r({...t,columns:S})},j=S=>{t.columns.includes(S)?r({...t,columns:t.columns.filter(T=>T!==S)}):r({...t,columns:[...t.columns,S]})};return e.jsxs("div",{ref:h,className:"p-4 space-y-4 h-full overflow-y-auto",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),e.jsxs("div",{className:`grid gap-4 ${u?"grid-cols-2":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Binning Strategy"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.strategy,onChange:S=>r({...t,strategy:S.target.value}),children:[e.jsx("option",{value:"equal_width",children:"Equal Width (Uniform)"}),e.jsx("option",{value:"equal_frequency",children:"Equal Frequency (Quantile)"}),e.jsx("option",{value:"kmeans",children:"K-Means Clustering"}),e.jsx("option",{value:"custom",children:"Custom Edges"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[t.strategy==="equal_width"&&"Bins have equal width ranges.",t.strategy==="equal_frequency"&&"Bins have equal number of records.",t.strategy==="kmeans"&&"Bins based on K-Means clustering centers.",t.strategy==="custom"&&"Define specific bin edges for each column."]})]}),t.strategy!=="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Number of Bins"}),e.jsx("input",{type:"number",min:2,max:100,className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.n_bins,onChange:S=>r({...t,n_bins:parseInt(S.target.value)||5})})]}),t.strategy==="custom"&&e.jsxs("div",{className:"space-y-2 border rounded p-2 bg-muted/10",children:[e.jsx("label",{className:"block text-xs font-medium",children:"Custom Edges"}),t.columns.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Select columns first."}):e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:t.columns.map(S=>{var T;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-medium",children:S}),e.jsx(T_,{value:(T=t.custom_bins)==null?void 0:T[S],onChange:E=>r({...t,custom_bins:{...t.custom_bins,[S]:E}})})]},S)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Label Format"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.label_format,onChange:S=>r({...t,label_format:S.target.value}),children:[e.jsx("option",{value:"ordinal",children:"Ordinal (0, 1, 2...)"}),e.jsx("option",{value:"range",children:"Range Intervals ([0-10], [10-20]...)"}),e.jsx("option",{value:"bin_index",children:"Bin Index"})]})]}),t.label_format==="range"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Precision (Decimals)"}),e.jsx("input",{type:"number",min:0,max:10,className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.precision??3,onChange:S=>r({...t,precision:parseInt(S.target.value)||0})}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Number of decimal places to show in interval labels (e.g. 2 gives [0.00, 10.00])."})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"drop_original",checked:t.drop_original,onChange:S=>r({...t,drop_original:S.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("label",{htmlFor:"drop_original",className:"text-sm",children:"Drop Original Columns"})]}),!t.drop_original&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Output Suffix"}),e.jsx("input",{type:"text",className:"w-full p-1.5 border rounded text-xs",placeholder:"_binned",value:t.output_suffix||"",onChange:S=>r({...t,output_suffix:S.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-2 flex flex-col h-full min-h-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Target Columns"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{className:"w-full px-2 py-1 text-xs border rounded bg-background text-foreground",placeholder:"Search columns...",value:p,onChange:S=>{b(S.target.value)}})}),e.jsxs("div",{className:"flex gap-2 text-xs border-b pb-1",children:[e.jsx("button",{onClick:_,className:"text-primary hover:underline",children:"Select All"}),e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsx("button",{onClick:w,className:"text-muted-foreground hover:underline",children:"None"}),e.jsxs("span",{className:"ml-auto text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsx("div",{className:"flex-1 border rounded bg-background overflow-y-auto p-2 max-h-[300px]",children:c?e.jsx("div",{className:"text-xs text-muted-foreground p-2",children:"Loading columns..."}):y.length===0?e.jsx("div",{className:"text-xs text-muted-foreground p-2 text-center",children:g.length===0?"No numeric columns found.":`No columns match "${p}"`}):e.jsx("div",{className:"space-y-1",children:y.map(S=>e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer hover:bg-accent/50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(S),onChange:()=>{j(S)},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:S,children:S})]},S))})})]})]})]})},E_={type:"BinningNode",label:"Binning / Discretization",description:"Convert continuous variables into discrete bins.",icon:Qn,category:"Preprocessing",inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Binned"}],validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column to bin."}:t.n_bins<2?{isValid:!1,message:"Number of bins must be at least 2."}:{isValid:!0},settings:L_,getDefaultConfig:()=>({columns:[],strategy:"equal_width",n_bins:5,label_format:"ordinal",output_suffix:"_binned",drop_original:!1})},R_=({nodeId:t})=>{var o;const r=ye(d=>d.executionResult),n=t?(o=r==null?void 0:r.node_results)==null?void 0:o[t]:void 0;if(!n)return null;const i=d=>e.jsx("div",{className:"space-y-1",children:Object.entries(d).map(([c,h])=>typeof h=="object"&&h!==null?e.jsxs("div",{className:"mt-1",children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[c.replace(/_/g," "),":"]}),e.jsx("div",{className:"pl-2 border-l-2 border-gray-200 dark:border-gray-700 ml-1",children:i(h)})]},c):e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 capitalize",children:[c.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-gray-100",children:String(h)})]},c))});return e.jsxs("div",{className:"mt-6 p-4 border rounded-md bg-gray-50 dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-gray-900 dark:text-gray-100",children:"Last Run Results"}),e.jsxs("div",{className:"text-xs space-y-1 text-gray-600 dark:text-gray-300",children:[n.metrics&&e.jsx("div",{className:"mt-2",children:i(n.metrics)}),n.error&&e.jsxs("div",{className:"mt-2 text-red-500 break-words",children:["Error: ",n.error]}),!n.metrics&&!n.error&&e.jsx("div",{className:"italic text-gray-500",children:"No metrics available"})]})]})},M_=({config:t,onChange:r,nodeId:n})=>{var C;const i=f.useRef(null),[o,d]=f.useState(!1),[c,h]=f.useState(!0),u=Fe(n||""),x=Array.isArray(u)?u.filter(Boolean):[],p=(C=x.find(S=>typeof S.datasetId=="string"))==null?void 0:C.datasetId,{data:b}=Me(p),g=x.find(S=>{const T=S.config;if(!T||typeof T!="object")return!1;const E=T.target_column;return typeof E=="string"&&E.trim().length>0}),y=g?g.config.target_column??void 0:void 0;f.useEffect(()=>{if(!t.target_column){if(g&&y)r({...t,target_column:y});else if(b!=null&&b.columns){const S=Object.values(b.columns).find(T=>T.name.toLowerCase()==="target"||T.name.toLowerCase()==="class"||T.column_type==="target");S&&r({...t,target_column:S.name})}}},[b,g,y,t.target_column,t,r]),f.useEffect(()=>{if(!i.current)return;const S=new ResizeObserver(T=>{for(const E of T)d(E.contentRect.width>400)});return S.observe(i.current),()=>{S.disconnect()}},[]);const _=da(n||"",{types:["resampling"],suggestedNodeTypes:["ResamplingNode"]}),w=S=>{S.suggested_params&&r({...t,...S.suggested_params})},j=(S,T)=>{const E={...t,[S]:T};S==="type"&&(T==="oversampling"?E.method="smote":E.method="random_under_sampling"),r(E)};return e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Resampling Type"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.type,onChange:S=>{j("type",S.target.value)},children:[e.jsx("option",{value:"oversampling",children:"Oversampling (Minority)"}),e.jsx("option",{value:"undersampling",children:"Undersampling (Majority)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Method"}),e.jsx("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.method,onChange:S=>{j("method",S.target.value)},children:t.type==="oversampling"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"smote",children:"SMOTE"}),e.jsx("option",{value:"adasyn",children:"ADASYN"}),e.jsx("option",{value:"borderline_smote",children:"Borderline SMOTE"}),e.jsx("option",{value:"svm_smote",children:"SVM SMOTE"}),e.jsx("option",{value:"kmeans_smote",children:"KMeans SMOTE"}),e.jsx("option",{value:"smote_tomek",children:"SMOTE + Tomek"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"random_under_sampling",children:"Random Under Sampling"}),e.jsx("option",{value:"nearmiss",children:"NearMiss"}),e.jsx("option",{value:"tomek_links",children:"Tomek Links"}),e.jsx("option",{value:"edited_nearest_neighbours",children:"Edited Nearest Neighbours"})]})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.type==="oversampling"?"Generate synthetic samples for the minority class.":"Remove samples from the majority class."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Target Column"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"e.g., target",value:t.target_column,onChange:S=>{j("target_column",S.target.value)},list:"target-column-suggestions"}),(b==null?void 0:b.columns)&&e.jsx("datalist",{id:"target-column-suggestions",children:Object.values(b.columns).map(S=>e.jsx("option",{value:S.name},S.name))})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:g?"Auto-detected from upstream node.":"The column containing the class labels."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Sampling Strategy"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.sampling_strategy,onChange:S=>{j("sampling_strategy",S.target.value)},children:[e.jsx("option",{value:"auto",children:"Auto (Resample all classes but majority)"}),e.jsx("option",{value:"minority",children:"Minority (Resample only minority class)"}),e.jsx("option",{value:"not minority",children:"Not Minority (Resample all but minority)"}),e.jsx("option",{value:"not majority",children:"Not Majority (Resample all but majority)"}),e.jsx("option",{value:"all",children:"All (Resample all classes)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Defines which classes to resample."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Random State"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.random_state,onChange:S=>{j("random_state",parseInt(S.target.value))}})]})]}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[t.type==="oversampling"&&e.jsxs(e.Fragment,{children:[["smote","adasyn","borderline_smote","svm_smote","kmeans_smote"].includes(t.method)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"k Neighbors"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.k_neighbors??5,onChange:S=>{j("k_neighbors",parseInt(S.target.value))}})]}),["borderline_smote","svm_smote"].includes(t.method)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"m Neighbors"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.m_neighbors??10,onChange:S=>{j("m_neighbors",parseInt(S.target.value))}})]}),t.method==="borderline_smote"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Kind"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.kind??"borderline-1",onChange:S=>{j("kind",S.target.value)},children:[e.jsx("option",{value:"borderline-1",children:"Borderline-1"}),e.jsx("option",{value:"borderline-2",children:"Borderline-2"})]})]}),t.method==="svm_smote"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Out Step"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.out_step??.5,onChange:S=>{j("out_step",parseFloat(S.target.value))}})]}),t.method==="kmeans_smote"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cluster Balance Threshold"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.cluster_balance_threshold??.1,onChange:S=>{j("cluster_balance_threshold",parseFloat(S.target.value))}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Density Exponent"}),e.jsx("input",{type:"text",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.density_exponent??"auto",onChange:S=>{j("density_exponent",S.target.value)}})]})]})]}),t.type==="undersampling"&&t.method==="random_under_sampling"&&e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md bg-gray-50 dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:"Replacement"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sample with replacement"})]}),e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500",checked:t.replacement??!1,onChange:S=>{j("replacement",S.target.checked)}})]}),t.type==="undersampling"&&t.method==="nearmiss"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Version"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.version??1,onChange:S=>{j("version",parseInt(S.target.value))},children:[e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"})]})]}),t.type==="undersampling"&&t.method==="edited_nearest_neighbours"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"n Neighbors"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.n_neighbors??3,onChange:S=>{j("n_neighbors",parseInt(S.target.value))}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Selection Kind"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.kind_sel??"all",onChange:S=>{j("kind_sel",S.target.value)},children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"mode",children:"Mode"})]})]})]}),_.length>0&&e.jsxs("div",{className:"mt-0 border rounded-md overflow-hidden border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>{h(!c)},children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:["Recommendations (",_.length,")"]}),c?e.jsx(Gs,{size:16}):e.jsx(Ze,{size:16})]}),c&&e.jsx("div",{className:"p-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700",children:e.jsx(Sr,{recommendations:_,onApply:w})})]}),n&&e.jsx(R_,{nodeId:n})]})]})})},D_=t=>t.target_column?t.type==="oversampling"&&["smote","adasyn","borderline_smote","svm_smote","kmeans_smote"].includes(t.method)&&(t.k_neighbors??5)<1?{isValid:!1,message:"k_neighbors must be at least 1."}:{isValid:!0}:{isValid:!1,message:"Target column is required for resampling."},A_={type:"ResamplingNode",label:"Resampling",category:"Preprocessing",description:"Balance dataset classes using oversampling or undersampling techniques.",icon:Ve,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Balanced Data",type:"dataset"}],settings:M_,validate:D_,getDefaultConfig:()=>({type:"oversampling",method:"smote",target_column:"",sampling_strategy:"auto",random_state:42,k_neighbors:5,replacement:!1,version:1,n_neighbors:3,kind_sel:"all"})},O_=[{value:"arithmetic",label:"Arithmetic",icon:Oo},{value:"datetime_extract",label:"Date Extraction",icon:yr},{value:"ratio",label:"Ratio",icon:jx},{value:"similarity",label:"Similarity",icon:wx},{value:"group_agg",label:"Group Agg",icon:Mc}],I_=["add","subtract","multiply","divide"],z_=["year","month","day","weekday","hour","quarter","is_weekend"],F_=["ratio","token_sort_ratio","token_set_ratio"],B_=["mean","sum","count","min","max","std","median"],gs=({columns:t,selected:r,onChange:n,label:i,single:o})=>{const[d,c]=f.useState(""),h=t.filter(x=>x.toLowerCase().includes(d.toLowerCase())),u=x=>{o?n([x]):r.includes(x)?n(r.filter(p=>p!==x)):n([...r,x])};return e.jsxs("div",{className:"space-y-1.5",children:[i&&e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:i}),e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(Ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:d,onChange:x=>{c(x.target.value)}})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto p-1 space-y-0.5",children:h.length>0?h.map(x=>{const p=r.includes(x);return e.jsxs("div",{onClick:()=>{u(x)},className:`
                    flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                    ${p?"bg-primary/10 text-primary font-medium":"hover:bg-accent text-foreground"}
                  `,children:[e.jsx("div",{className:`
                    w-3 h-3 rounded border flex items-center justify-center
                    ${p?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/40"}
                  `,children:p&&e.jsx(Ma,{size:8,strokeWidth:4})}),e.jsx("span",{className:"truncate",children:x})]},x)}):e.jsx("div",{className:"p-2 text-xs text-muted-foreground text-center italic",children:"No columns found"})})]})]})},$_=({config:t,onChange:r,nodeId:n})=>{var R;const o=(R=Fe(n||"").find(N=>N.datasetId))==null?void 0:R.datasetId,{data:d}=Me(o),c=ye(N=>N.executionResult),h=n?c==null?void 0:c.node_results[n]:null,u=h!=null&&h.metrics&&typeof h.metrics=="object"?h.metrics:null,x=u&&Array.isArray(u.generated_features)?u.generated_features.map(N=>String(N)):[],[p,b]=f.useState(!1),g=d?Object.values(d.columns).map(N=>N.name):[],y=d?Object.values(d.columns).filter(N=>["int","float","number"].some(M=>N.dtype.toLowerCase().includes(M))).map(N=>N.name):[],_=d?Object.values(d.columns).filter(N=>["date","time"].some(M=>N.dtype.toLowerCase().includes(M))).map(N=>N.name):[],w=d?Object.values(d.columns).filter(N=>["string","object","text"].some(M=>N.dtype.toLowerCase().includes(M))).map(N=>N.name):[],j=da(n||"",{types:["feature_generation"],suggestedNodeTypes:["FeatureGenerationNode"],scope:"column"}),C=N=>{},S=N=>{const M={operation_type:N,method:N==="arithmetic"?"add":N==="similarity"?"ratio":N==="group_agg"?"mean":"year",input_columns:[],output_column:"",datetime_features:N==="datetime_extract"?["year"]:void 0,isExpanded:!0};r({operations:[...t.operations||[],M]})},T=(N,M)=>{const z=[...t.operations||[]];z[N]={...z[N],...M},r({operations:z})},E=(N,M)=>{M.stopPropagation();const z=[...t.operations||[]];z.splice(N,1),r({operations:z})},P=N=>{const M=[...t.operations||[]];M[N]={...M[N],isExpanded:!M[N].isExpanded},r({operations:M})},A=(N,M)=>`${N.operation_type}_${M}`;return e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-20 border-r bg-muted/10 flex flex-col items-center py-4 gap-2 overflow-y-auto shrink-0",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground mb-2 uppercase tracking-wider",children:"Add"}),O_.map(N=>e.jsxs("button",{onClick:()=>{S(N.value)},className:"flex flex-col items-center justify-center gap-1 p-1.5 rounded-md border bg-card hover:bg-accent hover:border-primary/50 transition-all group w-16 h-14 shadow-sm",title:N.label,children:[e.jsx(N.icon,{size:18,className:"text-muted-foreground group-hover:text-primary"}),e.jsx("span",{className:"text-[9px] font-medium text-muted-foreground group-hover:text-foreground text-center leading-tight line-clamp-2",children:N.label.replace(" ",`
`)})]},N.value))]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-background",children:[j.length>0&&e.jsxs("div",{className:"border-b bg-muted/10",children:[e.jsxs("button",{onClick:()=>{b(!p)},className:"w-full flex items-center justify-between px-4 py-2 text-xs font-medium text-muted-foreground hover:text-primary hover:bg-muted/20 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kn,{size:14,className:j.length>0?"text-yellow-500":""}),e.jsxs("span",{children:["Recommendations (",j.length,")"]})]}),p?e.jsx(Ze,{size:14}):e.jsx(Vt,{size:14})]}),p&&e.jsx("div",{className:"p-4 bg-muted/5 border-t",children:e.jsx(Sr,{recommendations:j,onApply:C,className:"mb-0"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[(t.operations||[]).map((N,M)=>{var z,I,F;return e.jsxs("div",{className:"border rounded-lg bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-muted/30 border-b cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{P(M)},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[N.isExpanded?e.jsx(Ze,{size:14,className:"text-muted-foreground"}):e.jsx(Vt,{size:14,className:"text-muted-foreground"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:N.operation_type==="datetime_extract"?"Date":N.operation_type.replace("_"," ")}),["arithmetic","similarity","group_agg"].includes(N.operation_type)&&e.jsx("select",{className:"text-sm border-none bg-transparent font-semibold focus:ring-0 cursor-pointer hover:text-primary",value:N.method,onClick:$=>{$.stopPropagation()},onChange:$=>{T(M,{method:$.target.value})},children:(N.operation_type==="arithmetic"?I_:N.operation_type==="similarity"?F_:N.operation_type==="group_agg"?B_:[]).map($=>e.jsx("option",{value:$,children:$.replace("_"," ")},$))})]}),e.jsx("button",{onClick:$=>{E(M,$)},className:"text-muted-foreground hover:text-destructive transition-colors p-1 rounded-full hover:bg-destructive/10",children:e.jsx(Ys,{size:14})})]}),N.isExpanded&&e.jsxs("div",{className:"p-3 space-y-4",children:[N.operation_type==="arithmetic"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20",children:N.method==="divide"?"Performs row-by-row division (Col A / Col B) for each record.":"Performs row-by-row arithmetic between two columns."}),e.jsx(gs,{label:"Column A (Left Operand)",columns:y,selected:N.input_columns.slice(0,1),onChange:$=>{T(M,{input_columns:$})},single:!0}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px bg-border flex-1"}),e.jsx("span",{className:"text-lg font-bold text-muted-foreground bg-muted/20 w-8 h-8 rounded flex items-center justify-center",children:N.method==="add"?"+":N.method==="subtract"?"-":N.method==="multiply"?"":""}),e.jsx("div",{className:"h-px bg-border flex-1"})]}),e.jsx(gs,{label:"Column B (Right Operand)",columns:y,selected:((z=N.secondary_columns)==null?void 0:z.slice(0,1))||[],onChange:$=>{T(M,{secondary_columns:$})},single:!0})]}),N.operation_type==="ratio"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20",children:["Calculates aggregate ratio: ",e.jsx("strong",{children:"Sum(Numerator) / Sum(Denominator)"}),"."]}),e.jsx(gs,{label:"Numerator (Sum)",columns:y,selected:N.input_columns,onChange:$=>{T(M,{input_columns:$})}}),e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-dashed"})}),e.jsx("span",{className:"relative bg-card px-2 text-xs text-muted-foreground font-medium",children:"Divided By"})]}),e.jsx(gs,{label:"Denominator (Sum)",columns:y,selected:N.secondary_columns||[],onChange:$=>{T(M,{secondary_columns:$})}})]}),N.operation_type==="similarity"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20 space-y-1",children:[e.jsx("p",{children:"Calculates string similarity score (0-100) between two text columns."}),e.jsxs("ul",{className:"list-disc pl-3 space-y-0.5 opacity-80",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Ratio:"}),' Strict character matching (Levenshtein). "apple banana" != "banana apple".']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Token Sort:"}),' Sorts words alphabetically then compares. "apple banana" == "banana apple".']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Token Set:"})," Compares intersection of words. Handles duplicates/subsets well."]})]})]}),e.jsx(gs,{label:"String A",columns:w,selected:N.input_columns.slice(0,1),onChange:$=>T(M,{input_columns:$}),single:!0}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px bg-border flex-1"}),e.jsx("span",{className:"text-xs font-bold text-muted-foreground bg-muted/20 px-2 py-1 rounded",children:"vs"}),e.jsx("div",{className:"h-px bg-border flex-1"})]}),e.jsx(gs,{label:"String B",columns:w,selected:((I=N.secondary_columns)==null?void 0:I.slice(0,1))||[],onChange:$=>T(M,{secondary_columns:$}),single:!0})]}),N.operation_type==="group_agg"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20",children:"Calculates aggregate statistics (e.g., Mean Salary) grouped by a categorical column (e.g., Department) and assigns it back to each row."}),e.jsx(gs,{label:"Group By (Categorical)",columns:w.length>0?w:g,selected:N.input_columns.slice(0,1),onChange:$=>T(M,{input_columns:$}),single:!0}),e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-dashed"})}),e.jsx("span",{className:"relative bg-card px-2 text-xs text-muted-foreground font-medium",children:"Target Column"})]}),e.jsx(gs,{label:"Target (Numeric)",columns:y,selected:((F=N.secondary_columns)==null?void 0:F.slice(0,1))||[],onChange:$=>T(M,{secondary_columns:$}),single:!0})]}),N.operation_type==="datetime_extract"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(gs,{label:"Date Column",columns:_.length>0?_:g,selected:N.input_columns.slice(0,1),onChange:$=>T(M,{input_columns:$}),single:!0}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Features to Extract"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:z_.map($=>e.jsxs("label",{className:"flex items-center gap-2 text-xs p-1.5 border rounded hover:bg-accent cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted-foreground/40 text-primary focus:ring-0",checked:(N.datetime_features||[]).includes($),onChange:J=>{const ee=N.datetime_features||[],te=J.target.checked?[...ee,$]:ee.filter(Y=>Y!==$);T(M,{datetime_features:te})}}),e.jsx("span",{className:"capitalize",children:$.replace("_"," ")})]},$))})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wider mb-1 block",children:"Output Column Name"}),e.jsx("input",{type:"text",className:"w-full text-xs border rounded px-2 py-1.5 bg-background focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:A(N,M),value:N.output_column||"",onChange:$=>{T(M,{output_column:$.target.value})}})]})]})]},M)}),(!t.operations||t.operations.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 border-2 border-dashed rounded-lg bg-muted/5 text-muted-foreground",children:[e.jsx(Oo,{size:32,className:"mb-2 opacity-20"}),e.jsx("p",{className:"text-xs font-medium",children:"No operations added"}),e.jsx("p",{className:"text-[10px] opacity-70",children:"Select a type above to start"})]}),u&&e.jsxs("div",{className:"border rounded-lg bg-muted/10 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm font-semibold text-primary",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsx("div",{className:"space-y-2 text-xs",children:x.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"New Features Created:"}),e.jsx("span",{className:"font-medium text-primary bg-primary/10 px-2 py-0.5 rounded-full",children:x.length})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase tracking-wider font-semibold mb-1.5 block",children:"Generated Columns"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:x.map(N=>e.jsx("span",{className:"px-2 py-1 bg-background border rounded text-[10px] font-mono text-foreground shadow-sm",children:N},N))})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground italic",children:[e.jsx(Kt,{size:12}),e.jsx("span",{children:"No features generated in last run."})]})})]})]})]})]})},Z_={type:"FeatureGenerationNode",label:"Feature Generation",description:"Create new features via math, stats, or date extraction.",icon:Oo,category:"Preprocessing",inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Enhanced"}],validate:t=>{var r,n,i,o;if(!((r=t.operations)!=null&&r.length))return{isValid:!1,message:"Add at least one operation."};for(const d of t.operations){if(d.operation_type==="arithmetic"&&(d.input_columns.length===0||!((n=d.secondary_columns)!=null&&n.length)&&!((i=d.constants)!=null&&i.length)))return{isValid:!1,message:"Arithmetic requires two operands."};if(d.operation_type==="datetime_extract"&&d.input_columns.length===0)return{isValid:!1,message:"Select a date column."};if(d.operation_type==="group_agg"&&(d.input_columns.length===0||!((o=d.secondary_columns)!=null&&o.length)))return{isValid:!1,message:"Select both Group By and Target columns."}}return{isValid:!0}},settings:$_,getDefaultConfig:()=>({operations:[]})},H_=({columns:t,selected:r,onChange:n,label:i})=>{const[o,d]=f.useState(""),c=t.filter(u=>u.toLowerCase().includes(o.toLowerCase())),h=u=>{r.includes(u)?n(r.filter(x=>x!==u)):n([...r,u])};return e.jsxs("div",{className:"space-y-1.5",children:[i&&e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:i}),e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(Ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:o,onChange:u=>{d(u.target.value)}})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto p-1 space-y-0.5",children:c.length>0?c.map(u=>{const x=r.includes(u);return e.jsxs("div",{onClick:()=>{h(u)},className:`
                    flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                    ${x?"bg-primary/10 text-primary font-medium":"hover:bg-accent text-foreground"}
                  `,children:[e.jsx("div",{className:`
                    w-3 h-3 rounded border flex items-center justify-center
                    ${x?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/40"}
                  `,children:x&&e.jsx("div",{className:"w-1.5 h-1.5 bg-current rounded-sm"})}),e.jsx("span",{className:"truncate",children:u})]},u)}):e.jsx("div",{className:"p-2 text-xs text-muted-foreground text-center",children:"No columns found"})})]}),e.jsxs("div",{className:"text-[10px] text-muted-foreground text-right",children:[r.length," selected"]})]})},U_={type:"PolynomialFeaturesNode",label:"Polynomial Features",description:"Generate polynomial and interaction features.",category:"Preprocessing",icon:pd,inputs:[{id:"in",label:"Input Dataset",type:"dataset"}],outputs:[{id:"out",label:"Transformed Data",type:"dataset"}],getDefaultConfig:()=>({columns:[],degree:2,interaction_only:!1,include_bias:!1,output_prefix:"poly",include_input_features:!1,isExpanded:!0}),settings:({config:t,onChange:r,nodeId:n})=>{var x;const o=(x=Fe(n||"").find(p=>p.datasetId))==null?void 0:x.datasetId,{data:d}=Me(o),c=d?Object.values(d.columns).filter(p=>["int","float","number","double","long"].some(b=>p.dtype.toLowerCase().includes(b))).map(p=>p.name):[],h=p=>{r({...t,...p})},u=()=>{h({isExpanded:!t.isExpanded})};return e.jsx("div",{className:"space-y-2 min-w-[280px]",children:e.jsxs("div",{className:"border rounded-md bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer hover:bg-accent/50 transition-colors",onClick:u,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pd,{size:14,className:"text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Configuration"})]}),t.isExpanded?e.jsx(Ze,{size:14}):e.jsx(Vt,{size:14})]}),t.isExpanded&&e.jsxs("div",{className:"p-3 space-y-4 border-t",children:[e.jsx(H_,{label:"Input Columns (Numeric)",columns:c,selected:t.columns||[],onChange:p=>h({columns:p})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:["Degree",e.jsxs("div",{className:"group relative",children:[e.jsx(Kt,{size:10,className:"cursor-help"}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 hidden group-hover:block w-48 p-2 bg-popover text-popover-foreground text-[10px] rounded border shadow-lg z-50",children:"The degree of the polynomial features. Default = 2."})]})]}),e.jsx("input",{type:"number",min:2,max:5,className:"w-full px-2 py-1.5 text-xs border rounded bg-background",value:t.degree||2,onChange:p=>h({degree:parseInt(p.target.value)||2})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Output Prefix"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1.5 text-xs border rounded bg-background",value:t.output_prefix||"poly",onChange:p=>h({output_prefix:p.target.value})})]}),e.jsxs("div",{className:"space-y-2 pt-1",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted",checked:t.interaction_only||!1,onChange:p=>h({interaction_only:p.target.checked})}),e.jsx("span",{className:"text-xs",children:"Interaction Only"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground pl-5",children:"If true, only interaction features are produced: features that are products of at most degree distinct input features."}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted",checked:t.include_bias||!1,onChange:p=>h({include_bias:p.target.checked})}),e.jsx("span",{className:"text-xs",children:"Include Bias"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted",checked:t.include_input_features||!1,onChange:p=>h({include_input_features:p.target.checked})}),e.jsx("span",{className:"text-xs",children:"Include Input Features"})]})]})]})]})]})})},validate:t=>!t.columns||t.columns.length===0?{isValid:!1,message:"Select at least one input column."}:t.degree<2?{isValid:!1,message:"Degree must be at least 2."}:{isValid:!0}},W_=({columns:t,selected:r,onChange:n})=>{const[i,o]=f.useState(""),d=t.filter(h=>h.toLowerCase().includes(i.toLowerCase())),c=h=>{r.includes(h)?n(r.filter(u=>u!==h)):n([...r,h])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(Ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:h=>{o(h.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:d.length>0?d.map(h=>{const u=r.includes(h);return e.jsxs("div",{onClick:()=>{c(h)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:h})]},h)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},V_=({operation:t,onChange:r,onDelete:n})=>e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("select",{className:"text-xs font-medium bg-transparent border-none focus:ring-0 p-0 text-gray-900 dark:text-gray-100",value:t.op,onChange:i=>{const o=i.target.value;let d="both";o==="case"&&(d="lower"),o==="remove_special"&&(d="keep_alphanumeric"),o==="regex"&&(d="custom"),r({...t,op:o,mode:d})},children:[e.jsx("option",{value:"trim",children:"Trim Whitespace"}),e.jsx("option",{value:"case",children:"Change Case"}),e.jsx("option",{value:"remove_special",children:"Remove Special Chars"}),e.jsx("option",{value:"regex",children:"Regex Replace"})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(Ys,{size:14})})]}),e.jsxs("div",{className:"space-y-2",children:[t.op==="trim"&&e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"both",children:"Both Ends"}),e.jsx("option",{value:"leading",children:"Leading Only"}),e.jsx("option",{value:"trailing",children:"Trailing Only"})]}),t.op==="case"&&e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"lower",children:"Lower Case"}),e.jsx("option",{value:"upper",children:"Upper Case"}),e.jsx("option",{value:"title",children:"Title Case"}),e.jsx("option",{value:"sentence",children:"Sentence Case"})]}),t.op==="remove_special"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"keep_alphanumeric",children:"Keep Alphanumeric"}),e.jsx("option",{value:"keep_alphanumeric_space",children:"Keep Alphanumeric & Space"}),e.jsx("option",{value:"letters_only",children:"Letters Only"}),e.jsx("option",{value:"digits_only",children:"Digits Only"})]}),e.jsx("input",{type:"text",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",placeholder:"Replacement (optional)",value:t.replacement||"",onChange:i=>r({...t,replacement:i.target.value})})]}),t.op==="regex"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"custom",children:"Custom Pattern"}),e.jsx("option",{value:"collapse_whitespace",children:"Collapse Whitespace"}),e.jsx("option",{value:"extract_digits",children:"Extract Digits"}),e.jsx("option",{value:"normalize_slash_dates",children:"Normalize Dates (MM/DD/YYYY)"})]}),t.mode==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"text",className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5 font-mono",placeholder:"Regex Pattern",value:t.pattern||"",onChange:i=>r({...t,pattern:i.target.value})}),e.jsx("button",{className:"p-1.5 bg-gray-100 dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Generate regex from literal text",onClick:()=>{const i=prompt("Enter the exact text you want to match (it will be escaped):");if(i){const o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r({...t,pattern:o})}},children:e.jsx(kx,{size:14})})]}),e.jsx("input",{type:"text",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",placeholder:"Replacement",value:t.repl||"",onChange:i=>r({...t,repl:i.target.value})})]})]})]})]}),q_=({config:t,onChange:r,nodeId:n})=>{var w;const i=f.useRef(null),[o,d]=f.useState(!1),[c,h]=f.useState(!0),x=(w=Fe(n||"").find(j=>j.datasetId))==null?void 0:w.datasetId,{data:p}=Me(x),b=p?Object.values(p.columns).filter(j=>{const C=String(j.dtype).toLowerCase();return C.includes("object")||C.includes("string")||C.includes("category")||C.includes("text")}).map(j=>j.name):[];f.useEffect(()=>{if(!i.current)return;const j=new ResizeObserver(C=>{for(const S of C)d(S.contentRect.width>400)});return j.observe(i.current),()=>{j.disconnect()}},[]);const g=()=>{r({...t,operations:[...t.operations,{op:"trim",mode:"both"}]})},y=(j,C)=>{const S=[...t.operations];S[j]=C,r({...t,operations:S})},_=j=>{const C=t.operations.filter((S,T)=>T!==j);r({...t,operations:C})};return e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsx("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:["Target Columns (",t.columns.length,")"]}),e.jsx(W_,{columns:b,selected:t.columns,onChange:j=>r({...t,columns:j})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only text/categorical columns are shown."})]})}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{h(!c)},className:"w-full flex items-center gap-2 p-3 text-left hover:bg-blue-100/50 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(Kt,{className:"text-blue-600 dark:text-blue-400 shrink-0",size:16}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 dark:text-blue-200 flex-1",children:"About Text Cleaning"}),c?e.jsx(Gs,{size:14,className:"text-blue-600 dark:text-blue-400"}):e.jsx(Ze,{size:14,className:"text-blue-600 dark:text-blue-400"})]}),c&&e.jsx("div",{className:"px-3 pb-3 text-xs text-blue-800 dark:text-blue-200 pl-9",children:e.jsx("p",{children:"Clean and standardize text columns by trimming whitespace, changing case, removing special characters, or applying custom regex patterns."})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cleaning Operations"}),e.jsxs("button",{onClick:g,className:"flex items-center gap-1 text-xs font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(Ut,{size:14}),"Add Step"]})]}),e.jsx("div",{className:"space-y-3",children:t.operations.length===0?e.jsxs("div",{className:"text-center p-6 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"No operations added."}),e.jsx("button",{onClick:g,className:"mt-2 text-xs text-blue-600 hover:underline",children:"Add your first cleaning step"})]}):t.operations.map((j,C)=>e.jsx(V_,{operation:j,onChange:S=>{y(C,S)},onDelete:()=>{_(C)}},C))})]})]})})},G_={type:"TextCleaning",label:"Text Cleaning",category:"Preprocessing",description:"Clean and standardize text columns.",icon:Nx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:q_,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:t.operations.length===0?{isValid:!1,message:"Add at least one operation."}:{isValid:!0},getDefaultConfig:()=>({columns:[],operations:[{op:"trim",mode:"both"}]})},K_=({columns:t,selected:r,onChange:n})=>{const[i,o]=f.useState(""),d=t.filter(h=>h.toLowerCase().includes(i.toLowerCase())),c=h=>{r.includes(h)?n(r.filter(u=>u!==h)):n([...r,h])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(Ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:h=>{o(h.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:d.length>0?d.map(h=>{const u=r.includes(h);return e.jsxs("div",{onClick:()=>{c(h)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:h})]},h)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},oc=({value:t,type:r,onChange:n,placeholder:i})=>{const o=c=>{let h=t;c==="number"&&(h=Number(t)||0),c==="boolean"&&(h=!!t),c==="string"&&(h=String(t)),c==="null"&&(h=null),c==="nan"&&(h="NaN"),n(h,c)},d=c=>{let h=c.target.value;r==="number"&&(h=parseFloat(h)),n(h,r)};return e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{className:"w-20 text-[10px] rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 px-1",value:r,onChange:c=>{o(c.target.value)},children:[e.jsx("option",{value:"string",children:"Text"}),e.jsx("option",{value:"number",children:"Num"}),e.jsx("option",{value:"boolean",children:"Bool"}),e.jsx("option",{value:"null",children:"Null"})]}),r==="string"&&e.jsx("input",{type:"text",className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1",value:t||"",onChange:d,placeholder:i}),r==="number"&&e.jsx("input",{type:"number",className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1",value:t||"",onChange:d,placeholder:i}),r==="boolean"&&e.jsxs("select",{className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1",value:String(t),onChange:c=>n(c.target.value==="true","boolean"),children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]}),(r==="null"||r==="nan")&&e.jsx("div",{className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-500 italic flex items-center",children:r==="null"?"None / Null":"NaN"})]})},J_=({item:t,onChange:r,onDelete:n})=>e.jsxs("div",{className:"p-2 border rounded-md bg-gray-50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-semibold tracking-wider",children:"Find"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-red-500 transition-colors p-1",children:e.jsx(Ys,{size:14})})]}),e.jsx(oc,{value:t.old,type:t.oldType,onChange:(i,o)=>r({...t,old:i,oldType:o}),placeholder:"Value to find"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-gray-400",children:e.jsx(Cx,{size:14,className:"rotate-90"})}),e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-semibold tracking-wider",children:"Replace With"})]}),e.jsx(oc,{value:t.new,type:t.newType,onChange:(i,o)=>r({...t,new:i,newType:o}),placeholder:"New value"})]}),Q_=({config:t,onChange:r,nodeId:n})=>{var p;const o=(p=Fe(n||"").find(b=>b==null?void 0:b.datasetId))==null?void 0:p.datasetId,{data:d}=Me(o),c=d?Object.values(d.columns).map(b=>b.name):[],h=()=>{r({...t,replacements:[...t.replacements,{old:"",new:"",oldType:"string",newType:"string"}]})},u=(b,g)=>{const y=[...t.replacements];y[b]=g,r({...t,replacements:y})},x=b=>{const g=t.replacements.filter((y,_)=>_!==b);r({...t,replacements:g})};return e.jsxs("div",{className:"space-y-4 p-1",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Target Columns"}),e.jsx(K_,{columns:c,selected:t.columns,onChange:b=>r({...t,columns:b})}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Select columns to apply replacements to. If empty, applies to all compatible columns."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Replacements"}),e.jsxs("button",{onClick:h,className:"text-xs flex items-center gap-1 text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Ut,{size:12})," Add"]})]}),e.jsxs("div",{className:"space-y-3",children:[t.replacements.map((b,g)=>e.jsx(J_,{item:b,onChange:y=>{u(g,y)},onDelete:()=>{x(g)}},g)),t.replacements.length===0&&e.jsx("div",{className:"text-center py-4 text-xs text-gray-500 border border-dashed rounded",children:"No replacements defined."})]})]})]})},Y_={type:"value_replacement",label:"Replace Values",category:"Preprocessing",description:"Replace specific values in columns (e.g. -999 to NaN).",icon:Sx,inputs:[{id:"in",label:"Input Dataset",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Dataset",type:"dataset"}],settings:Q_,validate:t=>{var r;return(r=t.replacements)!=null&&r.length?{isValid:!0}:{isValid:!0,message:"No replacements defined (pass-through)."}},getDefaultConfig:()=>({columns:[],replacements:[]})},X_=({columns:t,selected:r,onChange:n})=>{const[i,o]=f.useState(""),d=t.filter(h=>h.toLowerCase().includes(i.toLowerCase())),c=h=>{r.includes(h)?n(r.filter(u=>u!==h)):n([...r,h])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(Ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:h=>{o(h.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:d.length>0?d.map(h=>{const u=r.includes(h);return e.jsxs("div",{onClick:()=>{c(h)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:h})]},h)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},ej=({pairs:t,onChange:r})=>{const[n,i]=f.useState(""),[o,d]=f.useState(""),c=()=>{n&&o&&(r({...t,[n]:o}),i(""),d(""))},h=u=>{const x={...t};Reflect.deleteProperty(x,u),r(x)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Alias (Old)"}),e.jsx("input",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:"e.g. NY",value:n,onChange:u=>{i(u.target.value)}})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Canonical (New)"}),e.jsx("input",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:"e.g. New York",value:o,onChange:u=>{d(u.target.value)}})]}),e.jsx("button",{onClick:c,disabled:!n||!o,className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ut,{size:16})})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto border rounded-md p-2 bg-gray-50 dark:bg-gray-800/50",children:Object.entries(t).length===0?e.jsx("div",{className:"text-center text-xs text-gray-500 py-2",children:"No custom aliases defined."}):Object.entries(t).map(([u,x])=>e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("span",{className:"font-medium text-red-600 truncate max-w-[80px]",children:u}),e.jsx(Dc,{size:12,className:"text-gray-400 shrink-0"}),e.jsx("span",{className:"font-medium text-green-600 truncate max-w-[80px]",children:x})]}),e.jsx("button",{onClick:()=>{h(u)},className:"text-gray-400 hover:text-red-500",children:e.jsx(Ys,{size:14})})]},u))})]})},tj=({config:t,onChange:r,nodeId:n})=>{var g;const i=f.useRef(null),[o,d]=f.useState(!1),[c,h]=f.useState(!0),x=(g=Fe(n||"").find(y=>y.datasetId))==null?void 0:g.datasetId,{data:p}=Me(x),b=p?Object.values(p.columns).filter(y=>{const _=String(y.dtype).toLowerCase();return _.includes("object")||_.includes("string")||_.includes("category")||_.includes("text")}).map(y=>y.name):[];return f.useEffect(()=>{if(!i.current)return;const y=new ResizeObserver(_=>{for(const w of _)d(w.contentRect.width>400)});return y.observe(i.current),()=>{y.disconnect()}},[]),e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsx("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:["Target Columns (",t.columns.length,")"]}),e.jsx(X_,{columns:b,selected:t.columns,onChange:y=>r({...t,columns:y})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only text/categorical columns are shown."})]})}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{h(!c)},className:"w-full flex items-center gap-2 p-3 text-left hover:bg-blue-100/50 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(Kt,{className:"text-blue-600 dark:text-blue-400 shrink-0",size:16}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 dark:text-blue-200 flex-1",children:"About Alias Replacement"}),c?e.jsx(Gs,{size:14,className:"text-blue-600 dark:text-blue-400"}):e.jsx(Ze,{size:14,className:"text-blue-600 dark:text-blue-400"})]}),c&&e.jsx("div",{className:"px-3 pb-3 text-xs text-blue-800 dark:text-blue-200 pl-9",children:e.jsx("p",{children:"Standardize data by mapping multiple variations (aliases) to a single canonical value. Useful for country codes, boolean strings, or custom synonyms."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Replacement Mode"}),e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2",value:t.mode,onChange:y=>r({...t,mode:y.target.value}),children:[e.jsx("option",{value:"custom",children:"Custom Mapping"}),e.jsx("option",{value:"canonicalize_country_codes",children:"Canonicalize Country Codes"}),e.jsx("option",{value:"normalize_boolean",children:"Normalize Booleans (yes/no -> True/False)"}),e.jsx("option",{value:"punctuation",children:"Remove Punctuation"})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 mt-1",children:[t.mode==="custom"&&"Define your own alias mappings below.",t.mode==="canonicalize_country_codes"&&"Standardizes country codes (e.g. 'USA', 'U.S.A.' -> 'US').",t.mode==="normalize_boolean"&&"Converts 'yes', 'y', '1' to True and 'no', 'n', '0' to False.",t.mode==="punctuation"&&"Removes common punctuation characters from text."]})]}),t.mode==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Custom Aliases"}),e.jsx(ej,{pairs:t.custom_pairs,onChange:y=>r({...t,custom_pairs:y})})]})]})]})})},sj={type:"AliasReplacement",label:"Alias Replacement",category:"Preprocessing",description:"Standardize values by mapping aliases to canonical forms.",icon:Dc,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Standardized Data",type:"dataset"}],settings:tj,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:t.mode==="custom"&&Object.keys(t.custom_pairs).length===0?{isValid:!1,message:"Add at least one alias pair for custom mode."}:{isValid:!0},getDefaultConfig:()=>({columns:[],mode:"custom",custom_pairs:{}})},rj=({columns:t,selected:r,onChange:n})=>{const[i,o]=f.useState(""),d=t.filter(h=>h.toLowerCase().includes(i.toLowerCase())),c=h=>{r.includes(h)?n(r.filter(u=>u!==h)):n([...r,h])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(Ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:h=>{o(h.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:d.length>0?d.map(h=>{const u=r.includes(h);return e.jsxs("div",{onClick:()=>{c(h)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:h})]},h)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},aj=({config:t,onChange:r,nodeId:n})=>{var g;const i=f.useRef(null),[o,d]=f.useState(!1),[c,h]=f.useState(!0),x=(g=Fe(n||"").find(y=>y.datasetId))==null?void 0:g.datasetId,{data:p}=Me(x),b=p?Object.values(p.columns).filter(y=>["int","float","number"].some(_=>y.dtype.toLowerCase().includes(_))).map(y=>String(y.name)):[];return f.useEffect(()=>{if(!i.current)return;const y=new ResizeObserver(_=>{for(const w of _)d(w.contentRect.width>400)});return y.observe(i.current),()=>{y.disconnect()}},[]),e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsx("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:["Target Columns (",t.columns.length,")"]}),e.jsx(rj,{columns:b,selected:t.columns,onChange:y=>r({...t,columns:y})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only numeric columns are shown."})]})}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{h(!c)},className:"w-full flex items-center gap-2 p-3 text-left hover:bg-blue-100/50 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(Kt,{className:"text-blue-600 dark:text-blue-400 shrink-0",size:16}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 dark:text-blue-200 flex-1",children:"About Invalid Value Replacement"}),c?e.jsx(Gs,{size:14,className:"text-blue-600 dark:text-blue-400"}):e.jsx(Ze,{size:14,className:"text-blue-600 dark:text-blue-400"})]}),c&&e.jsx("div",{className:"px-3 pb-3 text-xs text-blue-800 dark:text-blue-200 pl-9",children:e.jsx("p",{children:"Use this node to handle data quality issues by replacing invalid numeric values (like negative ages or out-of-bounds sensor readings) with NaN (Missing)."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Replacement Mode"}),e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2",value:t.mode,onChange:y=>r({...t,mode:y.target.value}),children:[e.jsx("option",{value:"negative_to_nan",children:"Negative to NaN"}),e.jsx("option",{value:"zero_to_nan",children:"Zero to NaN"}),e.jsx("option",{value:"percentage_bounds",children:"Percentage Bounds (0-100)"}),e.jsx("option",{value:"age_bounds",children:"Age Bounds (0-120)"}),e.jsx("option",{value:"custom_range",children:"Custom Range"})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 mt-1",children:[t.mode==="negative_to_nan"&&"Replaces all negative values (< 0) with NaN.",t.mode==="zero_to_nan"&&"Replaces all zero values (== 0) with NaN.",t.mode==="percentage_bounds"&&"Replaces values outside 0-100 range with NaN.",t.mode==="age_bounds"&&"Replaces values outside 0-120 range with NaN.",t.mode==="custom_range"&&"Replaces values outside the specified Min/Max range with NaN."]})]}),(t.mode==="custom_range"||t.mode==="percentage_bounds"||t.mode==="age_bounds")&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Min Value"}),e.jsx("input",{type:"number",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:t.mode==="percentage_bounds"?"0":"Min",value:t.min_value??"",onChange:y=>r({...t,min_value:y.target.value?parseFloat(y.target.value):void 0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Max Value"}),e.jsx("input",{type:"number",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:t.mode==="percentage_bounds"?"100":"Max",value:t.max_value??"",onChange:y=>r({...t,max_value:y.target.value?parseFloat(y.target.value):void 0})})]}),e.jsx("p",{className:"col-span-2 text-[10px] text-gray-500",children:"Values outside this range will be replaced with NaN."})]})]})]})})},nj={type:"InvalidValueReplacement",label:"Invalid Value Replacement",category:"Preprocessing",description:"Replace invalid or out-of-range values with NaN.",icon:wr,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:aj,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:t.mode==="custom_range"&&t.min_value===void 0&&t.max_value===void 0?{isValid:!1,message:"Specify at least a min or max value for custom range."}:{isValid:!0},getDefaultConfig:()=>({columns:[],mode:"negative_to_nan"})},ij=()=>{Ce.register(Bv),Ce.register(Hv),Ce.register(Wv),Ce.register(qv),Ce.register(Kv),Ce.register(N_),Ce.register(P_),Ce.register(E_),Ce.register(A_),Ce.register(Z_),Ce.register(U_),Ce.register(G_),Ce.register(Y_),Ce.register(sj),Ce.register(nj),Ce.register(j_),Ce.register(o_),Ce.register(d_),Ce.register(u_),Ce.register(m_),Ce.register(p_),Ce.register(b_),Ce.register(v_),Ce.register(e_),Ce.register(n_)};ij();const oj=new ip,lc=document.getElementById("root");lc&&Yi.createRoot(lc).render(e.jsx(pt.StrictMode,{children:e.jsx(lp,{client:oj,children:e.jsx(Ov,{})})}));
