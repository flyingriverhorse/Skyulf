var qh=Object.defineProperty;var wd=t=>{throw TypeError(t)};var Gh=(t,r,a)=>r in t?qh(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var Qi=(t,r,a)=>Gh(t,typeof r!="symbol"?r+"":r,a),Yi=(t,r,a)=>r.has(t)||wd("Cannot "+a);var z=(t,r,a)=>(Yi(t,r,"read from private field"),a?a.call(t):r.get(t)),de=(t,r,a)=>r.has(t)?wd("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,a),ne=(t,r,a,i)=>(Yi(t,r,"write to private field"),i?i.call(t,a):r.set(t,a),a),we=(t,r,a)=>(Yi(t,r,"access private method"),a);var Sn=(t,r,a,i)=>({set _(o){ne(t,r,o,a)},get _(){return z(t,r,i)}});import{j as e,R as ht,B as ps,C as Ct,X as St,Y as Tt,T as pt,h as Mt,P as Ac,k as Dc,l as ni,L as en,u as Kh,S as Nd,m as Oa,n as za,o as Bo,p as Ic,q as $o,r as Jh,s as Qh,t as Yh,v as Xh,w as ex,x as tx,y as sx,z as rx}from"./vendor-charts-CsNOLdW_.js";import{a as ii,r as f,b as ft,R as Zo,c as ax}from"./vendor-react-CTqLuYwO.js";import{L as Uo,A as tt,B as gs,T as nx,G as Fa,D as bt,a as lo,R as oi,S as ix,M as ox,b as qs,P as Yt,c as kd,C as rt,E as Oc,d as Zt,e as lx,f as Qt,g as ca,X as et,U as zc,F as dx,h as xt,i as Cr,j as cx,k as Fc,l as Bc,m as ux,n as De,o as Pt,p as Ba,q as Ye,r as Un,s as Sr,t as Ho,u as or,v as $c,w as Zc,x as ts,y as mx,z as Hn,H as hx,I as xx,J as px,K as fx,N as gx,O as Wo,Q as Ms,V as bx,W as _t,Y as Uc,Z as yx,_ as vx,$ as jx,a0 as Hc,a1 as Xe,a2 as Vo,a3 as na,a4 as co,a5 as Cd,a6 as _x,a7 as wx,a8 as tn,a9 as Nx,aa as Wc,ab as gt,ac as sn,ad as Jt,ae as Vc,af as kx,ag as li,ah as ia,ai as qo,aj as qc,ak as Wn,al as Cx,am as di,an as Vn,ao as Sx,ap as Tx,aq as Px,ar as Lx,as as Ex,at as Rx,au as Mx,av as Ax,aw as Dx,ax as Ix,ay as Ox,az as Gc,aA as Go,aB as zx,aC as Fx,aD as Sd,aE as Bx,aF as $x,aG as Zx,aH as Ux,aI as Kc}from"./vendor-utils-BuEg954V.js";import{c as Hx,a as Wx,b as Vx,d as qx,u as Ko,H as qn,P as ar,g as Gx,B as Td,E as Kx,R as Jx,i as Jo,e as Qo,C as Yo,f as Jc,h as Qc,M as Gn,j as Er}from"./vendor-flow-pwp61Wq7.js";import{P as Qx,a as Yx}from"./vendor-plotly-D7n5k6Pc.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}})();var uo={},Pd=ii;uo.createRoot=Pd.createRoot,uo.hydrateRoot=Pd.hydrateRoot;var rn=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Xx={setTimeout:(t,r)=>setTimeout(t,r),clearTimeout:t=>clearTimeout(t),setInterval:(t,r)=>setInterval(t,r),clearInterval:t=>clearInterval(t)},Gs,Fo,Nc,ep=(Nc=class{constructor(){de(this,Gs,Xx);de(this,Fo,!1)}setTimeoutProvider(t){ne(this,Gs,t)}setTimeout(t,r){return z(this,Gs).setTimeout(t,r)}clearTimeout(t){z(this,Gs).clearTimeout(t)}setInterval(t,r){return z(this,Gs).setInterval(t,r)}clearInterval(t){z(this,Gs).clearInterval(t)}},Gs=new WeakMap,Fo=new WeakMap,Nc),pr=new ep;function tp(t){setTimeout(t,0)}var Tr=typeof window>"u"||"Deno"in globalThis;function kt(){}function sp(t,r){return typeof t=="function"?t(r):t}function mo(t){return typeof t=="number"&&t>=0&&t!==1/0}function Yc(t,r){return Math.max(t+(r||0)-Date.now(),0)}function rr(t,r){return typeof t=="function"?t(r):t}function Bt(t,r){return typeof t=="function"?t(r):t}function Ld(t,r){const{type:a="all",exact:i,fetchStatus:o,predicate:l,queryKey:c,stale:m}=t;if(c){if(i){if(r.queryHash!==Xo(c,r.options))return!1}else if(!Za(r.queryKey,c))return!1}if(a!=="all"){const u=r.isActive();if(a==="active"&&!u||a==="inactive"&&u)return!1}return!(typeof m=="boolean"&&r.isStale()!==m||o&&o!==r.state.fetchStatus||l&&!l(r))}function Ed(t,r){const{exact:a,status:i,predicate:o,mutationKey:l}=t;if(l){if(!r.options.mutationKey)return!1;if(a){if($a(r.options.mutationKey)!==$a(l))return!1}else if(!Za(r.options.mutationKey,l))return!1}return!(i&&r.state.status!==i||o&&!o(r))}function Xo(t,r){return((r==null?void 0:r.queryKeyHashFn)||$a)(t)}function $a(t){return JSON.stringify(t,(r,a)=>xo(a)?Object.keys(a).sort().reduce((i,o)=>(i[o]=a[o],i),{}):a)}function Za(t,r){return t===r?!0:typeof t!=typeof r?!1:t&&r&&typeof t=="object"&&typeof r=="object"?Object.keys(r).every(a=>Za(t[a],r[a])):!1}var rp=Object.prototype.hasOwnProperty;function Xc(t,r){if(t===r)return t;const a=Rd(t)&&Rd(r);if(!a&&!(xo(t)&&xo(r)))return r;const o=(a?t:Object.keys(t)).length,l=a?r:Object.keys(r),c=l.length,m=a?new Array(c):{};let u=0;for(let h=0;h<c;h++){const p=a?h:l[h],g=t[p],b=r[p];if(g===b){m[p]=g,(a?h<o:rp.call(t,p))&&u++;continue}if(g===null||b===null||typeof g!="object"||typeof b!="object"){m[p]=b;continue}const y=Xc(g,b);m[p]=y,y===g&&u++}return o===c&&u===o?t:m}function ho(t,r){if(!r||Object.keys(t).length!==Object.keys(r).length)return!1;for(const a in t)if(t[a]!==r[a])return!1;return!0}function Rd(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function xo(t){if(!Md(t))return!1;const r=t.constructor;if(r===void 0)return!0;const a=r.prototype;return!(!Md(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Md(t){return Object.prototype.toString.call(t)==="[object Object]"}function ap(t){return new Promise(r=>{pr.setTimeout(r,t)})}function po(t,r,a){return typeof a.structuralSharing=="function"?a.structuralSharing(t,r):a.structuralSharing!==!1?Xc(t,r):r}function np(t,r,a=0){const i=[...t,r];return a&&i.length>a?i.slice(1):i}function ip(t,r,a=0){const i=[r,...t];return a&&i.length>a?i.slice(0,-1):i}var el=Symbol();function eu(t,r){return!t.queryFn&&(r!=null&&r.initialPromise)?()=>r.initialPromise:!t.queryFn||t.queryFn===el?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function op(t,r){return typeof t=="function"?t(...r):!!t}var gr,Ks,qr,kc,lp=(kc=class extends rn{constructor(){super();de(this,gr);de(this,Ks);de(this,qr);ne(this,qr,r=>{if(!Tr&&window.addEventListener){const a=()=>r();return window.addEventListener("visibilitychange",a,!1),()=>{window.removeEventListener("visibilitychange",a)}}})}onSubscribe(){z(this,Ks)||this.setEventListener(z(this,qr))}onUnsubscribe(){var r;this.hasListeners()||((r=z(this,Ks))==null||r.call(this),ne(this,Ks,void 0))}setEventListener(r){var a;ne(this,qr,r),(a=z(this,Ks))==null||a.call(this),ne(this,Ks,r(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(r){z(this,gr)!==r&&(ne(this,gr,r),this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(a=>{a(r)})}isFocused(){var r;return typeof z(this,gr)=="boolean"?z(this,gr):((r=globalThis.document)==null?void 0:r.visibilityState)!=="hidden"}},gr=new WeakMap,Ks=new WeakMap,qr=new WeakMap,kc),tl=new lp;function fo(){let t,r;const a=new Promise((o,l)=>{t=o,r=l});a.status="pending",a.catch(()=>{});function i(o){Object.assign(a,o),delete a.resolve,delete a.reject}return a.resolve=o=>{i({status:"fulfilled",value:o}),t(o)},a.reject=o=>{i({status:"rejected",reason:o}),r(o)},a}var dp=tp;function cp(){let t=[],r=0,a=m=>{m()},i=m=>{m()},o=dp;const l=m=>{r?t.push(m):o(()=>{a(m)})},c=()=>{const m=t;t=[],m.length&&o(()=>{i(()=>{m.forEach(u=>{a(u)})})})};return{batch:m=>{let u;r++;try{u=m()}finally{r--,r||c()}return u},batchCalls:m=>(...u)=>{l(()=>{m(...u)})},schedule:l,setNotifyFunction:m=>{a=m},setBatchNotifyFunction:m=>{i=m},setScheduler:m=>{o=m}}}var mt=cp(),Gr,Js,Kr,Cc,up=(Cc=class extends rn{constructor(){super();de(this,Gr,!0);de(this,Js);de(this,Kr);ne(this,Kr,r=>{if(!Tr&&window.addEventListener){const a=()=>r(!0),i=()=>r(!1);return window.addEventListener("online",a,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",i)}}})}onSubscribe(){z(this,Js)||this.setEventListener(z(this,Kr))}onUnsubscribe(){var r;this.hasListeners()||((r=z(this,Js))==null||r.call(this),ne(this,Js,void 0))}setEventListener(r){var a;ne(this,Kr,r),(a=z(this,Js))==null||a.call(this),ne(this,Js,r(this.setOnline.bind(this)))}setOnline(r){z(this,Gr)!==r&&(ne(this,Gr,r),this.listeners.forEach(i=>{i(r)}))}isOnline(){return z(this,Gr)}},Gr=new WeakMap,Js=new WeakMap,Kr=new WeakMap,Cc),Kn=new up;function mp(t){return Math.min(1e3*2**t,3e4)}function tu(t){return(t??"online")==="online"?Kn.isOnline():!0}var go=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function su(t){let r=!1,a=0,i;const o=fo(),l=()=>o.status!=="pending",c=w=>{var N;if(!l()){const k=new go(w);b(k),(N=t.onCancel)==null||N.call(t,k)}},m=()=>{r=!0},u=()=>{r=!1},h=()=>tl.isFocused()&&(t.networkMode==="always"||Kn.isOnline())&&t.canRun(),p=()=>tu(t.networkMode)&&t.canRun(),g=w=>{l()||(i==null||i(),o.resolve(w))},b=w=>{l()||(i==null||i(),o.reject(w))},y=()=>new Promise(w=>{var N;i=k=>{(l()||h())&&w(k)},(N=t.onPause)==null||N.call(t)}).then(()=>{var w;i=void 0,l()||(w=t.onContinue)==null||w.call(t)}),j=()=>{if(l())return;let w;const N=a===0?t.initialPromise:void 0;try{w=N??t.fn()}catch(k){w=Promise.reject(k)}Promise.resolve(w).then(g).catch(k=>{var D;if(l())return;const S=t.retry??(Tr?0:3),P=t.retryDelay??mp,E=typeof P=="function"?P(a,k):P,T=S===!0||typeof S=="number"&&a<S||typeof S=="function"&&S(a,k);if(r||!T){b(k);return}a++,(D=t.onFail)==null||D.call(t,a,k),ap(E).then(()=>h()?void 0:y()).then(()=>{r?b(k):j()})})};return{promise:o,status:()=>o.status,cancel:c,continue:()=>(i==null||i(),o),cancelRetry:m,continueRetry:u,canStart:p,start:()=>(p()?j():y().then(j),o)}}var br,Sc,ru=(Sc=class{constructor(){de(this,br)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),mo(this.gcTime)&&ne(this,br,pr.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Tr?1/0:5*60*1e3))}clearGcTimeout(){z(this,br)&&(pr.clearTimeout(z(this,br)),ne(this,br,void 0))}},br=new WeakMap,Sc),yr,Jr,Ft,vr,lt,Ka,jr,Gt,Ss,Tc,hp=(Tc=class extends ru{constructor(r){super();de(this,Gt);de(this,yr);de(this,Jr);de(this,Ft);de(this,vr);de(this,lt);de(this,Ka);de(this,jr);ne(this,jr,!1),ne(this,Ka,r.defaultOptions),this.setOptions(r.options),this.observers=[],ne(this,vr,r.client),ne(this,Ft,z(this,vr).getQueryCache()),this.queryKey=r.queryKey,this.queryHash=r.queryHash,ne(this,yr,Dd(this.options)),this.state=r.state??z(this,yr),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var r;return(r=z(this,lt))==null?void 0:r.promise}setOptions(r){if(this.options={...z(this,Ka),...r},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const a=Dd(this.options);a.data!==void 0&&(this.setState(Ad(a.data,a.dataUpdatedAt)),ne(this,yr,a))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&z(this,Ft).remove(this)}setData(r,a){const i=po(this.state.data,r,this.options);return we(this,Gt,Ss).call(this,{data:i,type:"success",dataUpdatedAt:a==null?void 0:a.updatedAt,manual:a==null?void 0:a.manual}),i}setState(r,a){we(this,Gt,Ss).call(this,{type:"setState",state:r,setStateOptions:a})}cancel(r){var i,o;const a=(i=z(this,lt))==null?void 0:i.promise;return(o=z(this,lt))==null||o.cancel(r),a?a.then(kt).catch(kt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(z(this,yr))}isActive(){return this.observers.some(r=>Bt(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===el||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(r=>rr(r.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(r=0){return this.state.data===void 0?!0:r==="static"?!1:this.state.isInvalidated?!0:!Yc(this.state.dataUpdatedAt,r)}onFocus(){var a;const r=this.observers.find(i=>i.shouldFetchOnWindowFocus());r==null||r.refetch({cancelRefetch:!1}),(a=z(this,lt))==null||a.continue()}onOnline(){var a;const r=this.observers.find(i=>i.shouldFetchOnReconnect());r==null||r.refetch({cancelRefetch:!1}),(a=z(this,lt))==null||a.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),z(this,Ft).notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(a=>a!==r),this.observers.length||(z(this,lt)&&(z(this,jr)?z(this,lt).cancel({revert:!0}):z(this,lt).cancelRetry()),this.scheduleGc()),z(this,Ft).notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||we(this,Gt,Ss).call(this,{type:"invalidate"})}async fetch(r,a){var u,h,p,g,b,y,j,w,N,k,S,P;if(this.state.fetchStatus!=="idle"&&((u=z(this,lt))==null?void 0:u.status())!=="rejected"){if(this.state.data!==void 0&&(a!=null&&a.cancelRefetch))this.cancel({silent:!0});else if(z(this,lt))return z(this,lt).continueRetry(),z(this,lt).promise}if(r&&this.setOptions(r),!this.options.queryFn){const E=this.observers.find(T=>T.options.queryFn);E&&this.setOptions(E.options)}const i=new AbortController,o=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(ne(this,jr,!0),i.signal)})},l=()=>{const E=eu(this.options,a),D=(()=>{const R={client:z(this,vr),queryKey:this.queryKey,meta:this.meta};return o(R),R})();return ne(this,jr,!1),this.options.persister?this.options.persister(E,D,this):E(D)},m=(()=>{const E={fetchOptions:a,options:this.options,queryKey:this.queryKey,client:z(this,vr),state:this.state,fetchFn:l};return o(E),E})();(h=this.options.behavior)==null||h.onFetch(m,this),ne(this,Jr,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((p=m.fetchOptions)==null?void 0:p.meta))&&we(this,Gt,Ss).call(this,{type:"fetch",meta:(g=m.fetchOptions)==null?void 0:g.meta}),ne(this,lt,su({initialPromise:a==null?void 0:a.initialPromise,fn:m.fetchFn,onCancel:E=>{E instanceof go&&E.revert&&this.setState({...z(this,Jr),fetchStatus:"idle"}),i.abort()},onFail:(E,T)=>{we(this,Gt,Ss).call(this,{type:"failed",failureCount:E,error:T})},onPause:()=>{we(this,Gt,Ss).call(this,{type:"pause"})},onContinue:()=>{we(this,Gt,Ss).call(this,{type:"continue"})},retry:m.options.retry,retryDelay:m.options.retryDelay,networkMode:m.options.networkMode,canRun:()=>!0}));try{const E=await z(this,lt).start();if(E===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(E),(y=(b=z(this,Ft).config).onSuccess)==null||y.call(b,E,this),(w=(j=z(this,Ft).config).onSettled)==null||w.call(j,E,this.state.error,this),E}catch(E){if(E instanceof go){if(E.silent)return z(this,lt).promise;if(E.revert){if(this.state.data===void 0)throw E;return this.state.data}}throw we(this,Gt,Ss).call(this,{type:"error",error:E}),(k=(N=z(this,Ft).config).onError)==null||k.call(N,E,this),(P=(S=z(this,Ft).config).onSettled)==null||P.call(S,this.state.data,E,this),E}finally{this.scheduleGc()}}},yr=new WeakMap,Jr=new WeakMap,Ft=new WeakMap,vr=new WeakMap,lt=new WeakMap,Ka=new WeakMap,jr=new WeakMap,Gt=new WeakSet,Ss=function(r){const a=i=>{switch(r.type){case"failed":return{...i,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...au(i.data,this.options),fetchMeta:r.meta??null};case"success":const o={...i,...Ad(r.data,r.dataUpdatedAt),dataUpdateCount:i.dataUpdateCount+1,...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return ne(this,Jr,r.manual?o:void 0),o;case"error":const l=r.error;return{...i,error:l,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...r.state}}};this.state=a(this.state),mt.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),z(this,Ft).notify({query:this,type:"updated",action:r})})},Tc);function au(t,r){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:tu(r.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Ad(t,r){return{data:t,dataUpdatedAt:r??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Dd(t){const r=typeof t.initialData=="function"?t.initialData():t.initialData,a=r!==void 0,i=a?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:r,dataUpdateCount:0,dataUpdatedAt:a?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}var Nt,Ne,Ja,vt,_r,Qr,Ps,Qs,Qa,Yr,Xr,wr,Nr,Ys,ea,Pe,Ia,bo,yo,vo,jo,_o,wo,No,nu,Pc,xp=(Pc=class extends rn{constructor(r,a){super();de(this,Pe);de(this,Nt);de(this,Ne);de(this,Ja);de(this,vt);de(this,_r);de(this,Qr);de(this,Ps);de(this,Qs);de(this,Qa);de(this,Yr);de(this,Xr);de(this,wr);de(this,Nr);de(this,Ys);de(this,ea,new Set);this.options=a,ne(this,Nt,r),ne(this,Qs,null),ne(this,Ps,fo()),this.bindMethods(),this.setOptions(a)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(z(this,Ne).addObserver(this),Id(z(this,Ne),this.options)?we(this,Pe,Ia).call(this):this.updateResult(),we(this,Pe,jo).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ko(z(this,Ne),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ko(z(this,Ne),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,we(this,Pe,_o).call(this),we(this,Pe,wo).call(this),z(this,Ne).removeObserver(this)}setOptions(r){const a=this.options,i=z(this,Ne);if(this.options=z(this,Nt).defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Bt(this.options.enabled,z(this,Ne))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");we(this,Pe,No).call(this),z(this,Ne).setOptions(this.options),a._defaulted&&!ho(this.options,a)&&z(this,Nt).getQueryCache().notify({type:"observerOptionsUpdated",query:z(this,Ne),observer:this});const o=this.hasListeners();o&&Od(z(this,Ne),i,this.options,a)&&we(this,Pe,Ia).call(this),this.updateResult(),o&&(z(this,Ne)!==i||Bt(this.options.enabled,z(this,Ne))!==Bt(a.enabled,z(this,Ne))||rr(this.options.staleTime,z(this,Ne))!==rr(a.staleTime,z(this,Ne)))&&we(this,Pe,bo).call(this);const l=we(this,Pe,yo).call(this);o&&(z(this,Ne)!==i||Bt(this.options.enabled,z(this,Ne))!==Bt(a.enabled,z(this,Ne))||l!==z(this,Ys))&&we(this,Pe,vo).call(this,l)}getOptimisticResult(r){const a=z(this,Nt).getQueryCache().build(z(this,Nt),r),i=this.createResult(a,r);return fp(this,i)&&(ne(this,vt,i),ne(this,Qr,this.options),ne(this,_r,z(this,Ne).state)),i}getCurrentResult(){return z(this,vt)}trackResult(r,a){return new Proxy(r,{get:(i,o)=>(this.trackProp(o),a==null||a(o),o==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&z(this,Ps).status==="pending"&&z(this,Ps).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(i,o))})}trackProp(r){z(this,ea).add(r)}getCurrentQuery(){return z(this,Ne)}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const a=z(this,Nt).defaultQueryOptions(r),i=z(this,Nt).getQueryCache().build(z(this,Nt),a);return i.fetch().then(()=>this.createResult(i,a))}fetch(r){return we(this,Pe,Ia).call(this,{...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),z(this,vt)))}createResult(r,a){var M;const i=z(this,Ne),o=this.options,l=z(this,vt),c=z(this,_r),m=z(this,Qr),h=r!==i?r.state:z(this,Ja),{state:p}=r;let g={...p},b=!1,y;if(a._optimisticResults){const I=this.hasListeners(),O=!I&&Id(r,a),F=I&&Od(r,i,a,o);(O||F)&&(g={...g,...au(p.data,r.options)}),a._optimisticResults==="isRestoring"&&(g.fetchStatus="idle")}let{error:j,errorUpdatedAt:w,status:N}=g;y=g.data;let k=!1;if(a.placeholderData!==void 0&&y===void 0&&N==="pending"){let I;l!=null&&l.isPlaceholderData&&a.placeholderData===(m==null?void 0:m.placeholderData)?(I=l.data,k=!0):I=typeof a.placeholderData=="function"?a.placeholderData((M=z(this,Xr))==null?void 0:M.state.data,z(this,Xr)):a.placeholderData,I!==void 0&&(N="success",y=po(l==null?void 0:l.data,I,a),b=!0)}if(a.select&&y!==void 0&&!k)if(l&&y===(c==null?void 0:c.data)&&a.select===z(this,Qa))y=z(this,Yr);else try{ne(this,Qa,a.select),y=a.select(y),y=po(l==null?void 0:l.data,y,a),ne(this,Yr,y),ne(this,Qs,null)}catch(I){ne(this,Qs,I)}z(this,Qs)&&(j=z(this,Qs),y=z(this,Yr),w=Date.now(),N="error");const S=g.fetchStatus==="fetching",P=N==="pending",E=N==="error",T=P&&S,D=y!==void 0,_={status:N,fetchStatus:g.fetchStatus,isPending:P,isSuccess:N==="success",isError:E,isInitialLoading:T,isLoading:T,data:y,dataUpdatedAt:g.dataUpdatedAt,error:j,errorUpdatedAt:w,failureCount:g.fetchFailureCount,failureReason:g.fetchFailureReason,errorUpdateCount:g.errorUpdateCount,isFetched:g.dataUpdateCount>0||g.errorUpdateCount>0,isFetchedAfterMount:g.dataUpdateCount>h.dataUpdateCount||g.errorUpdateCount>h.errorUpdateCount,isFetching:S,isRefetching:S&&!P,isLoadingError:E&&!D,isPaused:g.fetchStatus==="paused",isPlaceholderData:b,isRefetchError:E&&D,isStale:sl(r,a),refetch:this.refetch,promise:z(this,Ps),isEnabled:Bt(a.enabled,r)!==!1};if(this.options.experimental_prefetchInRender){const I=B=>{_.status==="error"?B.reject(_.error):_.data!==void 0&&B.resolve(_.data)},O=()=>{const B=ne(this,Ps,_.promise=fo());I(B)},F=z(this,Ps);switch(F.status){case"pending":r.queryHash===i.queryHash&&I(F);break;case"fulfilled":(_.status==="error"||_.data!==F.value)&&O();break;case"rejected":(_.status!=="error"||_.error!==F.reason)&&O();break}}return _}updateResult(){const r=z(this,vt),a=this.createResult(z(this,Ne),this.options);if(ne(this,_r,z(this,Ne).state),ne(this,Qr,this.options),z(this,_r).data!==void 0&&ne(this,Xr,z(this,Ne)),ho(a,r))return;ne(this,vt,a);const i=()=>{if(!r)return!0;const{notifyOnChangeProps:o}=this.options,l=typeof o=="function"?o():o;if(l==="all"||!l&&!z(this,ea).size)return!0;const c=new Set(l??z(this,ea));return this.options.throwOnError&&c.add("error"),Object.keys(z(this,vt)).some(m=>{const u=m;return z(this,vt)[u]!==r[u]&&c.has(u)})};we(this,Pe,nu).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&we(this,Pe,jo).call(this)}},Nt=new WeakMap,Ne=new WeakMap,Ja=new WeakMap,vt=new WeakMap,_r=new WeakMap,Qr=new WeakMap,Ps=new WeakMap,Qs=new WeakMap,Qa=new WeakMap,Yr=new WeakMap,Xr=new WeakMap,wr=new WeakMap,Nr=new WeakMap,Ys=new WeakMap,ea=new WeakMap,Pe=new WeakSet,Ia=function(r){we(this,Pe,No).call(this);let a=z(this,Ne).fetch(this.options,r);return r!=null&&r.throwOnError||(a=a.catch(kt)),a},bo=function(){we(this,Pe,_o).call(this);const r=rr(this.options.staleTime,z(this,Ne));if(Tr||z(this,vt).isStale||!mo(r))return;const i=Yc(z(this,vt).dataUpdatedAt,r)+1;ne(this,wr,pr.setTimeout(()=>{z(this,vt).isStale||this.updateResult()},i))},yo=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(z(this,Ne)):this.options.refetchInterval)??!1},vo=function(r){we(this,Pe,wo).call(this),ne(this,Ys,r),!(Tr||Bt(this.options.enabled,z(this,Ne))===!1||!mo(z(this,Ys))||z(this,Ys)===0)&&ne(this,Nr,pr.setInterval(()=>{(this.options.refetchIntervalInBackground||tl.isFocused())&&we(this,Pe,Ia).call(this)},z(this,Ys)))},jo=function(){we(this,Pe,bo).call(this),we(this,Pe,vo).call(this,we(this,Pe,yo).call(this))},_o=function(){z(this,wr)&&(pr.clearTimeout(z(this,wr)),ne(this,wr,void 0))},wo=function(){z(this,Nr)&&(pr.clearInterval(z(this,Nr)),ne(this,Nr,void 0))},No=function(){const r=z(this,Nt).getQueryCache().build(z(this,Nt),this.options);if(r===z(this,Ne))return;const a=z(this,Ne);ne(this,Ne,r),ne(this,Ja,r.state),this.hasListeners()&&(a==null||a.removeObserver(this),r.addObserver(this))},nu=function(r){mt.batch(()=>{r.listeners&&this.listeners.forEach(a=>{a(z(this,vt))}),z(this,Nt).getQueryCache().notify({query:z(this,Ne),type:"observerResultsUpdated"})})},Pc);function pp(t,r){return Bt(r.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&r.retryOnMount===!1)}function Id(t,r){return pp(t,r)||t.state.data!==void 0&&ko(t,r,r.refetchOnMount)}function ko(t,r,a){if(Bt(r.enabled,t)!==!1&&rr(r.staleTime,t)!=="static"){const i=typeof a=="function"?a(t):a;return i==="always"||i!==!1&&sl(t,r)}return!1}function Od(t,r,a,i){return(t!==r||Bt(i.enabled,t)===!1)&&(!a.suspense||t.state.status!=="error")&&sl(t,a)}function sl(t,r){return Bt(r.enabled,t)!==!1&&t.isStaleByTime(rr(r.staleTime,t))}function fp(t,r){return!ho(t.getCurrentResult(),r)}function zd(t){return{onFetch:(r,a)=>{var p,g,b,y,j;const i=r.options,o=(b=(g=(p=r.fetchOptions)==null?void 0:p.meta)==null?void 0:g.fetchMore)==null?void 0:b.direction,l=((y=r.state.data)==null?void 0:y.pages)||[],c=((j=r.state.data)==null?void 0:j.pageParams)||[];let m={pages:[],pageParams:[]},u=0;const h=async()=>{let w=!1;const N=P=>{Object.defineProperty(P,"signal",{enumerable:!0,get:()=>(r.signal.aborted?w=!0:r.signal.addEventListener("abort",()=>{w=!0}),r.signal)})},k=eu(r.options,r.fetchOptions),S=async(P,E,T)=>{if(w)return Promise.reject();if(E==null&&P.pages.length)return Promise.resolve(P);const R=(()=>{const O={client:r.client,queryKey:r.queryKey,pageParam:E,direction:T?"backward":"forward",meta:r.options.meta};return N(O),O})(),_=await k(R),{maxPages:M}=r.options,I=T?ip:np;return{pages:I(P.pages,_,M),pageParams:I(P.pageParams,E,M)}};if(o&&l.length){const P=o==="backward",E=P?gp:Fd,T={pages:l,pageParams:c},D=E(i,T);m=await S(T,D,P)}else{const P=t??l.length;do{const E=u===0?c[0]??i.initialPageParam:Fd(i,m);if(u>0&&E==null)break;m=await S(m,E),u++}while(u<P)}return m};r.options.persister?r.fetchFn=()=>{var w,N;return(N=(w=r.options).persister)==null?void 0:N.call(w,h,{client:r.client,queryKey:r.queryKey,meta:r.options.meta,signal:r.signal},a)}:r.fetchFn=h}}}function Fd(t,{pages:r,pageParams:a}){const i=r.length-1;return r.length>0?t.getNextPageParam(r[i],r,a[i],a):void 0}function gp(t,{pages:r,pageParams:a}){var i;return r.length>0?(i=t.getPreviousPageParam)==null?void 0:i.call(t,r[0],r,a[0],a):void 0}var Ya,cs,jt,kr,us,Vs,Lc,bp=(Lc=class extends ru{constructor(r){super();de(this,us);de(this,Ya);de(this,cs);de(this,jt);de(this,kr);ne(this,Ya,r.client),this.mutationId=r.mutationId,ne(this,jt,r.mutationCache),ne(this,cs,[]),this.state=r.state||yp(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){z(this,cs).includes(r)||(z(this,cs).push(r),this.clearGcTimeout(),z(this,jt).notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){ne(this,cs,z(this,cs).filter(a=>a!==r)),this.scheduleGc(),z(this,jt).notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){z(this,cs).length||(this.state.status==="pending"?this.scheduleGc():z(this,jt).remove(this))}continue(){var r;return((r=z(this,kr))==null?void 0:r.continue())??this.execute(this.state.variables)}async execute(r){var c,m,u,h,p,g,b,y,j,w,N,k,S,P,E,T,D,R,_,M;const a=()=>{we(this,us,Vs).call(this,{type:"continue"})},i={client:z(this,Ya),meta:this.options.meta,mutationKey:this.options.mutationKey};ne(this,kr,su({fn:()=>this.options.mutationFn?this.options.mutationFn(r,i):Promise.reject(new Error("No mutationFn found")),onFail:(I,O)=>{we(this,us,Vs).call(this,{type:"failed",failureCount:I,error:O})},onPause:()=>{we(this,us,Vs).call(this,{type:"pause"})},onContinue:a,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>z(this,jt).canRun(this)}));const o=this.state.status==="pending",l=!z(this,kr).canStart();try{if(o)a();else{we(this,us,Vs).call(this,{type:"pending",variables:r,isPaused:l}),await((m=(c=z(this,jt).config).onMutate)==null?void 0:m.call(c,r,this,i));const O=await((h=(u=this.options).onMutate)==null?void 0:h.call(u,r,i));O!==this.state.context&&we(this,us,Vs).call(this,{type:"pending",context:O,variables:r,isPaused:l})}const I=await z(this,kr).start();return await((g=(p=z(this,jt).config).onSuccess)==null?void 0:g.call(p,I,r,this.state.context,this,i)),await((y=(b=this.options).onSuccess)==null?void 0:y.call(b,I,r,this.state.context,i)),await((w=(j=z(this,jt).config).onSettled)==null?void 0:w.call(j,I,null,this.state.variables,this.state.context,this,i)),await((k=(N=this.options).onSettled)==null?void 0:k.call(N,I,null,r,this.state.context,i)),we(this,us,Vs).call(this,{type:"success",data:I}),I}catch(I){try{throw await((P=(S=z(this,jt).config).onError)==null?void 0:P.call(S,I,r,this.state.context,this,i)),await((T=(E=this.options).onError)==null?void 0:T.call(E,I,r,this.state.context,i)),await((R=(D=z(this,jt).config).onSettled)==null?void 0:R.call(D,void 0,I,this.state.variables,this.state.context,this,i)),await((M=(_=this.options).onSettled)==null?void 0:M.call(_,void 0,I,r,this.state.context,i)),I}finally{we(this,us,Vs).call(this,{type:"error",error:I})}}finally{z(this,jt).runNext(this)}}},Ya=new WeakMap,cs=new WeakMap,jt=new WeakMap,kr=new WeakMap,us=new WeakSet,Vs=function(r){const a=i=>{switch(r.type){case"failed":return{...i,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...i,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:r.error,failureCount:i.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=a(this.state),mt.batch(()=>{z(this,cs).forEach(i=>{i.onMutationUpdate(r)}),z(this,jt).notify({mutation:this,type:"updated",action:r})})},Lc);function yp(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ls,Kt,Xa,Ec,vp=(Ec=class extends rn{constructor(r={}){super();de(this,Ls);de(this,Kt);de(this,Xa);this.config=r,ne(this,Ls,new Set),ne(this,Kt,new Map),ne(this,Xa,0)}build(r,a,i){const o=new bp({client:r,mutationCache:this,mutationId:++Sn(this,Xa)._,options:r.defaultMutationOptions(a),state:i});return this.add(o),o}add(r){z(this,Ls).add(r);const a=Tn(r);if(typeof a=="string"){const i=z(this,Kt).get(a);i?i.push(r):z(this,Kt).set(a,[r])}this.notify({type:"added",mutation:r})}remove(r){if(z(this,Ls).delete(r)){const a=Tn(r);if(typeof a=="string"){const i=z(this,Kt).get(a);if(i)if(i.length>1){const o=i.indexOf(r);o!==-1&&i.splice(o,1)}else i[0]===r&&z(this,Kt).delete(a)}}this.notify({type:"removed",mutation:r})}canRun(r){const a=Tn(r);if(typeof a=="string"){const i=z(this,Kt).get(a),o=i==null?void 0:i.find(l=>l.state.status==="pending");return!o||o===r}else return!0}runNext(r){var i;const a=Tn(r);if(typeof a=="string"){const o=(i=z(this,Kt).get(a))==null?void 0:i.find(l=>l!==r&&l.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}else return Promise.resolve()}clear(){mt.batch(()=>{z(this,Ls).forEach(r=>{this.notify({type:"removed",mutation:r})}),z(this,Ls).clear(),z(this,Kt).clear()})}getAll(){return Array.from(z(this,Ls))}find(r){const a={exact:!0,...r};return this.getAll().find(i=>Ed(a,i))}findAll(r={}){return this.getAll().filter(a=>Ed(r,a))}notify(r){mt.batch(()=>{this.listeners.forEach(a=>{a(r)})})}resumePausedMutations(){const r=this.getAll().filter(a=>a.state.isPaused);return mt.batch(()=>Promise.all(r.map(a=>a.continue().catch(kt))))}},Ls=new WeakMap,Kt=new WeakMap,Xa=new WeakMap,Ec);function Tn(t){var r;return(r=t.options.scope)==null?void 0:r.id}var ms,Rc,jp=(Rc=class extends rn{constructor(r={}){super();de(this,ms);this.config=r,ne(this,ms,new Map)}build(r,a,i){const o=a.queryKey,l=a.queryHash??Xo(o,a);let c=this.get(l);return c||(c=new hp({client:r,queryKey:o,queryHash:l,options:r.defaultQueryOptions(a),state:i,defaultOptions:r.getQueryDefaults(o)}),this.add(c)),c}add(r){z(this,ms).has(r.queryHash)||(z(this,ms).set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const a=z(this,ms).get(r.queryHash);a&&(r.destroy(),a===r&&z(this,ms).delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){mt.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return z(this,ms).get(r)}getAll(){return[...z(this,ms).values()]}find(r){const a={exact:!0,...r};return this.getAll().find(i=>Ld(a,i))}findAll(r={}){const a=this.getAll();return Object.keys(r).length>0?a.filter(i=>Ld(r,i)):a}notify(r){mt.batch(()=>{this.listeners.forEach(a=>{a(r)})})}onFocus(){mt.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){mt.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},ms=new WeakMap,Rc),Ue,Xs,er,ta,sa,tr,ra,aa,Mc,_p=(Mc=class{constructor(t={}){de(this,Ue);de(this,Xs);de(this,er);de(this,ta);de(this,sa);de(this,tr);de(this,ra);de(this,aa);ne(this,Ue,t.queryCache||new jp),ne(this,Xs,t.mutationCache||new vp),ne(this,er,t.defaultOptions||{}),ne(this,ta,new Map),ne(this,sa,new Map),ne(this,tr,0)}mount(){Sn(this,tr)._++,z(this,tr)===1&&(ne(this,ra,tl.subscribe(async t=>{t&&(await this.resumePausedMutations(),z(this,Ue).onFocus())})),ne(this,aa,Kn.subscribe(async t=>{t&&(await this.resumePausedMutations(),z(this,Ue).onOnline())})))}unmount(){var t,r;Sn(this,tr)._--,z(this,tr)===0&&((t=z(this,ra))==null||t.call(this),ne(this,ra,void 0),(r=z(this,aa))==null||r.call(this),ne(this,aa,void 0))}isFetching(t){return z(this,Ue).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return z(this,Xs).findAll({...t,status:"pending"}).length}getQueryData(t){var a;const r=this.defaultQueryOptions({queryKey:t});return(a=z(this,Ue).get(r.queryHash))==null?void 0:a.state.data}ensureQueryData(t){const r=this.defaultQueryOptions(t),a=z(this,Ue).build(this,r),i=a.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&a.isStaleByTime(rr(r.staleTime,a))&&this.prefetchQuery(r),Promise.resolve(i))}getQueriesData(t){return z(this,Ue).findAll(t).map(({queryKey:r,state:a})=>{const i=a.data;return[r,i]})}setQueryData(t,r,a){const i=this.defaultQueryOptions({queryKey:t}),o=z(this,Ue).get(i.queryHash),l=o==null?void 0:o.state.data,c=sp(r,l);if(c!==void 0)return z(this,Ue).build(this,i).setData(c,{...a,manual:!0})}setQueriesData(t,r,a){return mt.batch(()=>z(this,Ue).findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,r,a)]))}getQueryState(t){var a;const r=this.defaultQueryOptions({queryKey:t});return(a=z(this,Ue).get(r.queryHash))==null?void 0:a.state}removeQueries(t){const r=z(this,Ue);mt.batch(()=>{r.findAll(t).forEach(a=>{r.remove(a)})})}resetQueries(t,r){const a=z(this,Ue);return mt.batch(()=>(a.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},r)))}cancelQueries(t,r={}){const a={revert:!0,...r},i=mt.batch(()=>z(this,Ue).findAll(t).map(o=>o.cancel(a)));return Promise.all(i).then(kt).catch(kt)}invalidateQueries(t,r={}){return mt.batch(()=>(z(this,Ue).findAll(t).forEach(a=>{a.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},r)))}refetchQueries(t,r={}){const a={...r,cancelRefetch:r.cancelRefetch??!0},i=mt.batch(()=>z(this,Ue).findAll(t).filter(o=>!o.isDisabled()&&!o.isStatic()).map(o=>{let l=o.fetch(void 0,a);return a.throwOnError||(l=l.catch(kt)),o.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(i).then(kt)}fetchQuery(t){const r=this.defaultQueryOptions(t);r.retry===void 0&&(r.retry=!1);const a=z(this,Ue).build(this,r);return a.isStaleByTime(rr(r.staleTime,a))?a.fetch(r):Promise.resolve(a.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(kt).catch(kt)}fetchInfiniteQuery(t){return t.behavior=zd(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(kt).catch(kt)}ensureInfiniteQueryData(t){return t.behavior=zd(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return Kn.isOnline()?z(this,Xs).resumePausedMutations():Promise.resolve()}getQueryCache(){return z(this,Ue)}getMutationCache(){return z(this,Xs)}getDefaultOptions(){return z(this,er)}setDefaultOptions(t){ne(this,er,t)}setQueryDefaults(t,r){z(this,ta).set($a(t),{queryKey:t,defaultOptions:r})}getQueryDefaults(t){const r=[...z(this,ta).values()],a={};return r.forEach(i=>{Za(t,i.queryKey)&&Object.assign(a,i.defaultOptions)}),a}setMutationDefaults(t,r){z(this,sa).set($a(t),{mutationKey:t,defaultOptions:r})}getMutationDefaults(t){const r=[...z(this,sa).values()],a={};return r.forEach(i=>{Za(t,i.mutationKey)&&Object.assign(a,i.defaultOptions)}),a}defaultQueryOptions(t){if(t._defaulted)return t;const r={...z(this,er).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return r.queryHash||(r.queryHash=Xo(r.queryKey,r)),r.refetchOnReconnect===void 0&&(r.refetchOnReconnect=r.networkMode!=="always"),r.throwOnError===void 0&&(r.throwOnError=!!r.suspense),!r.networkMode&&r.persister&&(r.networkMode="offlineFirst"),r.queryFn===el&&(r.enabled=!1),r}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...z(this,er).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){z(this,Ue).clear(),z(this,Xs).clear()}},Ue=new WeakMap,Xs=new WeakMap,er=new WeakMap,ta=new WeakMap,sa=new WeakMap,tr=new WeakMap,ra=new WeakMap,aa=new WeakMap,Mc),iu=f.createContext(void 0),wp=t=>{const r=f.useContext(iu);if(!r)throw new Error("No QueryClient set, use QueryClientProvider to set one");return r},Np=({client:t,children:r})=>(f.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(iu.Provider,{value:t,children:r})),ou=f.createContext(!1),kp=()=>f.useContext(ou);ou.Provider;function Cp(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Sp=f.createContext(Cp()),Tp=()=>f.useContext(Sp),Pp=(t,r)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(r.isReset()||(t.retryOnMount=!1))},Lp=t=>{f.useEffect(()=>{t.clearReset()},[t])},Ep=({result:t,errorResetBoundary:r,throwOnError:a,query:i,suspense:o})=>t.isError&&!r.isReset()&&!t.isFetching&&i&&(o&&t.data===void 0||op(a,[t.error,i])),Rp=t=>{if(t.suspense){const a=o=>o==="static"?o:Math.max(o??1e3,1e3),i=t.staleTime;t.staleTime=typeof i=="function"?(...o)=>a(i(...o)):a(i),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Mp=(t,r)=>t.isLoading&&t.isFetching&&!r,Ap=(t,r)=>(t==null?void 0:t.suspense)&&r.isPending,Bd=(t,r,a)=>r.fetchOptimistic(t).catch(()=>{a.clearReset()});function Dp(t,r,a){var g,b,y,j,w;const i=kp(),o=Tp(),l=wp(),c=l.defaultQueryOptions(t);(b=(g=l.getDefaultOptions().queries)==null?void 0:g._experimental_beforeQuery)==null||b.call(g,c),c._optimisticResults=i?"isRestoring":"optimistic",Rp(c),Pp(c,o),Lp(o);const m=!l.getQueryCache().get(c.queryHash),[u]=f.useState(()=>new r(l,c)),h=u.getOptimisticResult(c),p=!i&&t.subscribed!==!1;if(f.useSyncExternalStore(f.useCallback(N=>{const k=p?u.subscribe(mt.batchCalls(N)):kt;return u.updateResult(),k},[u,p]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),f.useEffect(()=>{u.setOptions(c)},[c,u]),Ap(c,h))throw Bd(c,u,o);if(Ep({result:h,errorResetBoundary:o,throwOnError:c.throwOnError,query:l.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw h.error;if((j=(y=l.getDefaultOptions().queries)==null?void 0:y._experimental_afterQuery)==null||j.call(y,c,h),c.experimental_prefetchInRender&&!Tr&&Mp(h,i)){const N=m?Bd(c,u,o):(w=l.getQueryCache().get(c.queryHash))==null?void 0:w.promise;N==null||N.catch(kt).finally(()=>{u.updateResult()})}return c.notifyOnChangeProps?h:u.trackResult(h)}function Ip(t,r){return Dp(t,xp)}/**
 * react-router v7.10.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var $d="popstate";function Op(t={}){function r(i,o){let{pathname:l,search:c,hash:m}=i.location;return Co("",{pathname:l,search:c,hash:m},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function a(i,o){return typeof o=="string"?o:Ua(o)}return Fp(r,a,null,t)}function Be(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function Ut(t,r){if(!t){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function zp(){return Math.random().toString(36).substring(2,10)}function Zd(t,r){return{usr:t.state,key:t.key,idx:r}}function Co(t,r,a=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof r=="string"?ua(r):r,state:a,key:r&&r.key||i||zp()}}function Ua({pathname:t="/",search:r="",hash:a=""}){return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function ua(t){let r={};if(t){let a=t.indexOf("#");a>=0&&(r.hash=t.substring(a),t=t.substring(0,a));let i=t.indexOf("?");i>=0&&(r.search=t.substring(i),t=t.substring(0,i)),t&&(r.pathname=t)}return r}function Fp(t,r,a,i={}){let{window:o=document.defaultView,v5Compat:l=!1}=i,c=o.history,m="POP",u=null,h=p();h==null&&(h=0,c.replaceState({...c.state,idx:h},""));function p(){return(c.state||{idx:null}).idx}function g(){m="POP";let N=p(),k=N==null?null:N-h;h=N,u&&u({action:m,location:w.location,delta:k})}function b(N,k){m="PUSH";let S=Co(w.location,N,k);h=p()+1;let P=Zd(S,h),E=w.createHref(S);try{c.pushState(P,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;o.location.assign(E)}l&&u&&u({action:m,location:w.location,delta:1})}function y(N,k){m="REPLACE";let S=Co(w.location,N,k);h=p();let P=Zd(S,h),E=w.createHref(S);c.replaceState(P,"",E),l&&u&&u({action:m,location:w.location,delta:0})}function j(N){return Bp(N)}let w={get action(){return m},get location(){return t(o,c)},listen(N){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener($d,g),u=N,()=>{o.removeEventListener($d,g),u=null}},createHref(N){return r(o,N)},createURL:j,encodeLocation(N){let k=j(N);return{pathname:k.pathname,search:k.search,hash:k.hash}},push:b,replace:y,go(N){return c.go(N)}};return w}function Bp(t,r=!1){let a="http://localhost";typeof window<"u"&&(a=window.location.origin!=="null"?window.location.origin:window.location.href),Be(a,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:Ua(t);return i=i.replace(/ $/,"%20"),!r&&i.startsWith("//")&&(i=a+i),new URL(i,a)}function lu(t,r,a="/"){return $p(t,r,a,!1)}function $p(t,r,a,i){let o=typeof r=="string"?ua(r):r,l=As(o.pathname||"/",a);if(l==null)return null;let c=du(t);Zp(c);let m=null;for(let u=0;m==null&&u<c.length;++u){let h=Xp(l);m=Qp(c[u],h,i)}return m}function du(t,r=[],a=[],i="",o=!1){let l=(c,m,u=o,h)=>{let p={relativePath:h===void 0?c.path||"":h,caseSensitive:c.caseSensitive===!0,childrenIndex:m,route:c};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(i)&&u)return;Be(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length)}let g=Rs([i,p.relativePath]),b=a.concat(p);c.children&&c.children.length>0&&(Be(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),du(c.children,r,b,g,u)),!(c.path==null&&!c.index)&&r.push({path:g,score:Kp(g,c.index),routesMeta:b})};return t.forEach((c,m)=>{var u;if(c.path===""||!((u=c.path)!=null&&u.includes("?")))l(c,m);else for(let h of cu(c.path))l(c,m,!0,h)}),r}function cu(t){let r=t.split("/");if(r.length===0)return[];let[a,...i]=r,o=a.endsWith("?"),l=a.replace(/\?$/,"");if(i.length===0)return o?[l,""]:[l];let c=cu(i.join("/")),m=[];return m.push(...c.map(u=>u===""?l:[l,u].join("/"))),o&&m.push(...c),m.map(u=>t.startsWith("/")&&u===""?"/":u)}function Zp(t){t.sort((r,a)=>r.score!==a.score?a.score-r.score:Jp(r.routesMeta.map(i=>i.childrenIndex),a.routesMeta.map(i=>i.childrenIndex)))}var Up=/^:[\w-]+$/,Hp=3,Wp=2,Vp=1,qp=10,Gp=-2,Ud=t=>t==="*";function Kp(t,r){let a=t.split("/"),i=a.length;return a.some(Ud)&&(i+=Gp),r&&(i+=Wp),a.filter(o=>!Ud(o)).reduce((o,l)=>o+(Up.test(l)?Hp:l===""?Vp:qp),i)}function Jp(t,r){return t.length===r.length&&t.slice(0,-1).every((i,o)=>i===r[o])?t[t.length-1]-r[r.length-1]:0}function Qp(t,r,a=!1){let{routesMeta:i}=t,o={},l="/",c=[];for(let m=0;m<i.length;++m){let u=i[m],h=m===i.length-1,p=l==="/"?r:r.slice(l.length)||"/",g=Jn({path:u.relativePath,caseSensitive:u.caseSensitive,end:h},p),b=u.route;if(!g&&h&&a&&!i[i.length-1].route.index&&(g=Jn({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},p)),!g)return null;Object.assign(o,g.params),c.push({params:o,pathname:Rs([l,g.pathname]),pathnameBase:a0(Rs([l,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(l=Rs([l,g.pathnameBase]))}return c}function Jn(t,r){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[a,i]=Yp(t.path,t.caseSensitive,t.end),o=r.match(a);if(!o)return null;let l=o[0],c=l.replace(/(.)\/+$/,"$1"),m=o.slice(1);return{params:i.reduce((h,{paramName:p,isOptional:g},b)=>{if(p==="*"){let j=m[b]||"";c=l.slice(0,l.length-j.length).replace(/(.)\/+$/,"$1")}const y=m[b];return g&&!y?h[p]=void 0:h[p]=(y||"").replace(/%2F/g,"/"),h},{}),pathname:l,pathnameBase:c,pattern:t}}function Yp(t,r=!1,a=!0){Ut(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],o="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,m,u)=>(i.push({paramName:m,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),o+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?o+="\\/*$":t!==""&&t!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,r?void 0:"i"),i]}function Xp(t){try{return t.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return Ut(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${r}).`),t}}function As(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let a=r.endsWith("/")?r.length-1:r.length,i=t.charAt(a);return i&&i!=="/"?null:t.slice(a)||"/"}var e0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,t0=t=>e0.test(t);function s0(t,r="/"){let{pathname:a,search:i="",hash:o=""}=typeof t=="string"?ua(t):t,l;if(a)if(t0(a))l=a;else{if(a.includes("//")){let c=a;a=a.replace(/\/\/+/g,"/"),Ut(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${a}`)}a.startsWith("/")?l=Hd(a.substring(1),"/"):l=Hd(a,r)}else l=r;return{pathname:l,search:n0(i),hash:i0(o)}}function Hd(t,r){let a=r.replace(/\/+$/,"").split("/");return t.split("/").forEach(o=>{o===".."?a.length>1&&a.pop():o!=="."&&a.push(o)}),a.length>1?a.join("/"):"/"}function Xi(t,r,a,i){return`Cannot include a '${t}' character in a manually specified \`to.${r}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function r0(t){return t.filter((r,a)=>a===0||r.route.path&&r.route.path.length>0)}function uu(t){let r=r0(t);return r.map((a,i)=>i===r.length-1?a.pathname:a.pathnameBase)}function mu(t,r,a,i=!1){let o;typeof t=="string"?o=ua(t):(o={...t},Be(!o.pathname||!o.pathname.includes("?"),Xi("?","pathname","search",o)),Be(!o.pathname||!o.pathname.includes("#"),Xi("#","pathname","hash",o)),Be(!o.search||!o.search.includes("#"),Xi("#","search","hash",o)));let l=t===""||o.pathname==="",c=l?"/":o.pathname,m;if(c==null)m=a;else{let g=r.length-1;if(!i&&c.startsWith("..")){let b=c.split("/");for(;b[0]==="..";)b.shift(),g-=1;o.pathname=b.join("/")}m=g>=0?r[g]:"/"}let u=s0(o,m),h=c&&c!=="/"&&c.endsWith("/"),p=(l||c===".")&&a.endsWith("/");return!u.pathname.endsWith("/")&&(h||p)&&(u.pathname+="/"),u}var Rs=t=>t.join("/").replace(/\/\/+/g,"/"),a0=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),n0=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,i0=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function o0(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function l0(t){return t.map(r=>r.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var hu=["POST","PUT","PATCH","DELETE"];new Set(hu);var d0=["GET",...hu];new Set(d0);var ma=f.createContext(null);ma.displayName="DataRouter";var ci=f.createContext(null);ci.displayName="DataRouterState";f.createContext(!1);var xu=f.createContext({isTransitioning:!1});xu.displayName="ViewTransition";var c0=f.createContext(new Map);c0.displayName="Fetchers";var u0=f.createContext(null);u0.displayName="Await";var ss=f.createContext(null);ss.displayName="Navigation";var an=f.createContext(null);an.displayName="Location";var ys=f.createContext({outlet:null,matches:[],isDataRoute:!1});ys.displayName="Route";var rl=f.createContext(null);rl.displayName="RouteError";function m0(t,{relative:r}={}){Be(nn(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:i}=f.useContext(ss),{hash:o,pathname:l,search:c}=on(t,{relative:r}),m=l;return a!=="/"&&(m=l==="/"?a:Rs([a,l])),i.createHref({pathname:m,search:c,hash:o})}function nn(){return f.useContext(an)!=null}function Os(){return Be(nn(),"useLocation() may be used only in the context of a <Router> component."),f.useContext(an).location}var pu="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function fu(t){f.useContext(ss).static||f.useLayoutEffect(t)}function ui(){let{isDataRoute:t}=f.useContext(ys);return t?S0():h0()}function h0(){Be(nn(),"useNavigate() may be used only in the context of a <Router> component.");let t=f.useContext(ma),{basename:r,navigator:a}=f.useContext(ss),{matches:i}=f.useContext(ys),{pathname:o}=Os(),l=JSON.stringify(uu(i)),c=f.useRef(!1);return fu(()=>{c.current=!0}),f.useCallback((u,h={})=>{if(Ut(c.current,pu),!c.current)return;if(typeof u=="number"){a.go(u);return}let p=mu(u,JSON.parse(l),o,h.relative==="path");t==null&&r!=="/"&&(p.pathname=p.pathname==="/"?r:Rs([r,p.pathname])),(h.replace?a.replace:a.push)(p,h.state,h)},[r,a,l,o,t])}var x0=f.createContext(null);function p0(t){let r=f.useContext(ys).outlet;return f.useMemo(()=>r&&f.createElement(x0.Provider,{value:t},r),[r,t])}function on(t,{relative:r}={}){let{matches:a}=f.useContext(ys),{pathname:i}=Os(),o=JSON.stringify(uu(a));return f.useMemo(()=>mu(t,JSON.parse(o),i,r==="path"),[t,o,i,r])}function f0(t,r){return gu(t,r)}function gu(t,r,a,i,o){var S;Be(nn(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=f.useContext(ss),{matches:c}=f.useContext(ys),m=c[c.length-1],u=m?m.params:{},h=m?m.pathname:"/",p=m?m.pathnameBase:"/",g=m&&m.route;{let P=g&&g.path||"";bu(h,!g||P.endsWith("*")||P.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${P}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${P}"> to <Route path="${P==="/"?"*":`${P}/*`}">.`)}let b=Os(),y;if(r){let P=typeof r=="string"?ua(r):r;Be(p==="/"||((S=P.pathname)==null?void 0:S.startsWith(p)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${P.pathname}" was given in the \`location\` prop.`),y=P}else y=b;let j=y.pathname||"/",w=j;if(p!=="/"){let P=p.replace(/^\//,"").split("/");w="/"+j.replace(/^\//,"").split("/").slice(P.length).join("/")}let N=lu(t,{pathname:w});Ut(g||N!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),Ut(N==null||N[N.length-1].route.element!==void 0||N[N.length-1].route.Component!==void 0||N[N.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let k=j0(N&&N.map(P=>Object.assign({},P,{params:Object.assign({},u,P.params),pathname:Rs([p,l.encodeLocation?l.encodeLocation(P.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?p:Rs([p,l.encodeLocation?l.encodeLocation(P.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:P.pathnameBase])})),c,a,i,o);return r&&k?f.createElement(an.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...y},navigationType:"POP"}},k):k}function g0(){let t=C0(),r=o0(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),a=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i},l={padding:"2px 4px",backgroundColor:i},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=f.createElement(f.Fragment,null,f.createElement("p",null," Hey developer "),f.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",f.createElement("code",{style:l},"ErrorBoundary")," or"," ",f.createElement("code",{style:l},"errorElement")," prop on your route.")),f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},r),a?f.createElement("pre",{style:o},a):null,c)}var b0=f.createElement(g0,null),y0=class extends f.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){this.props.onError?this.props.onError(t,r):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?f.createElement(ys.Provider,{value:this.props.routeContext},f.createElement(rl.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function v0({routeContext:t,match:r,children:a}){let i=f.useContext(ma);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),f.createElement(ys.Provider,{value:t},a)}function j0(t,r=[],a=null,i=null,o=null){if(t==null){if(!a)return null;if(a.errors)t=a.matches;else if(r.length===0&&!a.initialized&&a.matches.length>0)t=a.matches;else return null}let l=t,c=a==null?void 0:a.errors;if(c!=null){let p=l.findIndex(g=>g.route.id&&(c==null?void 0:c[g.route.id])!==void 0);Be(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,p+1))}let m=!1,u=-1;if(a)for(let p=0;p<l.length;p++){let g=l[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(u=p),g.route.id){let{loaderData:b,errors:y}=a,j=g.route.loader&&!b.hasOwnProperty(g.route.id)&&(!y||y[g.route.id]===void 0);if(g.route.lazy||j){m=!0,u>=0?l=l.slice(0,u+1):l=[l[0]];break}}}let h=a&&i?(p,g)=>{var b,y;i(p,{location:a.location,params:((y=(b=a.matches)==null?void 0:b[0])==null?void 0:y.params)??{},unstable_pattern:l0(a.matches),errorInfo:g})}:void 0;return l.reduceRight((p,g,b)=>{let y,j=!1,w=null,N=null;a&&(y=c&&g.route.id?c[g.route.id]:void 0,w=g.route.errorElement||b0,m&&(u<0&&b===0?(bu("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),j=!0,N=null):u===b&&(j=!0,N=g.route.hydrateFallbackElement||null)));let k=r.concat(l.slice(0,b+1)),S=()=>{let P;return y?P=w:j?P=N:g.route.Component?P=f.createElement(g.route.Component,null):g.route.element?P=g.route.element:P=p,f.createElement(v0,{match:g,routeContext:{outlet:p,matches:k,isDataRoute:a!=null},children:P})};return a&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?f.createElement(y0,{location:a.location,revalidation:a.revalidation,component:w,error:y,children:S(),routeContext:{outlet:null,matches:k,isDataRoute:!0},onError:h}):S()},null)}function al(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _0(t){let r=f.useContext(ma);return Be(r,al(t)),r}function w0(t){let r=f.useContext(ci);return Be(r,al(t)),r}function N0(t){let r=f.useContext(ys);return Be(r,al(t)),r}function nl(t){let r=N0(t),a=r.matches[r.matches.length-1];return Be(a.route.id,`${t} can only be used on routes that contain a unique "id"`),a.route.id}function k0(){return nl("useRouteId")}function C0(){var i;let t=f.useContext(rl),r=w0("useRouteError"),a=nl("useRouteError");return t!==void 0?t:(i=r.errors)==null?void 0:i[a]}function S0(){let{router:t}=_0("useNavigate"),r=nl("useNavigate"),a=f.useRef(!1);return fu(()=>{a.current=!0}),f.useCallback(async(o,l={})=>{Ut(a.current,pu),a.current&&(typeof o=="number"?await t.navigate(o):await t.navigate(o,{fromRouteId:r,...l}))},[t,r])}var Wd={};function bu(t,r,a){!r&&!Wd[t]&&(Wd[t]=!0,Ut(!1,a))}f.memo(T0);function T0({routes:t,future:r,state:a,unstable_onError:i}){return gu(t,void 0,a,i,r)}function P0(t){return p0(t.context)}function ds(t){Be(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function L0({basename:t="/",children:r=null,location:a,navigationType:i="POP",navigator:o,static:l=!1,unstable_useTransitions:c}){Be(!nn(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let m=t.replace(/^\/*/,"/"),u=f.useMemo(()=>({basename:m,navigator:o,static:l,unstable_useTransitions:c,future:{}}),[m,o,l,c]);typeof a=="string"&&(a=ua(a));let{pathname:h="/",search:p="",hash:g="",state:b=null,key:y="default"}=a,j=f.useMemo(()=>{let w=As(h,m);return w==null?null:{location:{pathname:w,search:p,hash:g,state:b,key:y},navigationType:i}},[m,h,p,g,b,y,i]);return Ut(j!=null,`<Router basename="${m}"> is not able to match the URL "${h}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),j==null?null:f.createElement(ss.Provider,{value:u},f.createElement(an.Provider,{children:r,value:j}))}function E0({children:t,location:r}){return f0(So(t),r)}function So(t,r=[]){let a=[];return f.Children.forEach(t,(i,o)=>{if(!f.isValidElement(i))return;let l=[...r,o];if(i.type===f.Fragment){a.push.apply(a,So(i.props.children,l));return}Be(i.type===ds,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Be(!i.props.index||!i.props.children,"An index route cannot have child routes.");let c={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(c.children=So(i.props.children,l)),a.push(c)}),a}var Bn="get",$n="application/x-www-form-urlencoded";function mi(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function R0(t){return mi(t)&&t.tagName.toLowerCase()==="button"}function M0(t){return mi(t)&&t.tagName.toLowerCase()==="form"}function A0(t){return mi(t)&&t.tagName.toLowerCase()==="input"}function D0(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function I0(t,r){return t.button===0&&(!r||r==="_self")&&!D0(t)}function To(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((r,a)=>{let i=t[a];return r.concat(Array.isArray(i)?i.map(o=>[a,o]):[[a,i]])},[]))}function O0(t,r){let a=To(t);return r&&r.forEach((i,o)=>{a.has(o)||r.getAll(o).forEach(l=>{a.append(o,l)})}),a}var Pn=null;function z0(){if(Pn===null)try{new FormData(document.createElement("form"),0),Pn=!1}catch{Pn=!0}return Pn}var F0=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function eo(t){return t!=null&&!F0.has(t)?(Ut(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${$n}"`),null):t}function B0(t,r){let a,i,o,l,c;if(M0(t)){let m=t.getAttribute("action");i=m?As(m,r):null,a=t.getAttribute("method")||Bn,o=eo(t.getAttribute("enctype"))||$n,l=new FormData(t)}else if(R0(t)||A0(t)&&(t.type==="submit"||t.type==="image")){let m=t.form;if(m==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=t.getAttribute("formaction")||m.getAttribute("action");if(i=u?As(u,r):null,a=t.getAttribute("formmethod")||m.getAttribute("method")||Bn,o=eo(t.getAttribute("formenctype"))||eo(m.getAttribute("enctype"))||$n,l=new FormData(m,t),!z0()){let{name:h,type:p,value:g}=t;if(p==="image"){let b=h?`${h}.`:"";l.append(`${b}x`,"0"),l.append(`${b}y`,"0")}else h&&l.append(h,g)}}else{if(mi(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=Bn,i=null,o=$n,c=t}return l&&o==="text/plain"&&(c=l,l=void 0),{action:i,method:a.toLowerCase(),encType:o,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function il(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function $0(t,r,a){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return i.pathname==="/"?i.pathname=`_root.${a}`:r&&As(i.pathname,r)==="/"?i.pathname=`${r.replace(/\/$/,"")}/_root.${a}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${a}`,i}async function Z0(t,r){if(t.id in r)return r[t.id];try{let a=await import(t.module);return r[t.id]=a,a}catch(a){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function U0(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function H0(t,r,a){let i=await Promise.all(t.map(async o=>{let l=r.routes[o.route.id];if(l){let c=await Z0(l,a);return c.links?c.links():[]}return[]}));return G0(i.flat(1).filter(U0).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function Vd(t,r,a,i,o,l){let c=(u,h)=>a[h]?u.route.id!==a[h].route.id:!0,m=(u,h)=>{var p;return a[h].pathname!==u.pathname||((p=a[h].route.path)==null?void 0:p.endsWith("*"))&&a[h].params["*"]!==u.params["*"]};return l==="assets"?r.filter((u,h)=>c(u,h)||m(u,h)):l==="data"?r.filter((u,h)=>{var g;let p=i.routes[u.route.id];if(!p||!p.hasLoader)return!1;if(c(u,h)||m(u,h))return!0;if(u.route.shouldRevalidate){let b=u.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:((g=a[0])==null?void 0:g.params)||{},nextUrl:new URL(t,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof b=="boolean")return b}return!0}):[]}function W0(t,r,{includeHydrateFallback:a}={}){return V0(t.map(i=>{let o=r.routes[i.route.id];if(!o)return[];let l=[o.module];return o.clientActionModule&&(l=l.concat(o.clientActionModule)),o.clientLoaderModule&&(l=l.concat(o.clientLoaderModule)),a&&o.hydrateFallbackModule&&(l=l.concat(o.hydrateFallbackModule)),o.imports&&(l=l.concat(o.imports)),l}).flat(1))}function V0(t){return[...new Set(t)]}function q0(t){let r={},a=Object.keys(t).sort();for(let i of a)r[i]=t[i];return r}function G0(t,r){let a=new Set;return new Set(r),t.reduce((i,o)=>{let l=JSON.stringify(q0(o));return a.has(l)||(a.add(l),i.push({key:l,link:o})),i},[])}function yu(){let t=f.useContext(ma);return il(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function K0(){let t=f.useContext(ci);return il(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var ol=f.createContext(void 0);ol.displayName="FrameworkContext";function vu(){let t=f.useContext(ol);return il(t,"You must render this element inside a <HydratedRouter> element"),t}function J0(t,r){let a=f.useContext(ol),[i,o]=f.useState(!1),[l,c]=f.useState(!1),{onFocus:m,onBlur:u,onMouseEnter:h,onMouseLeave:p,onTouchStart:g}=r,b=f.useRef(null);f.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let w=k=>{k.forEach(S=>{c(S.isIntersecting)})},N=new IntersectionObserver(w,{threshold:.5});return b.current&&N.observe(b.current),()=>{N.disconnect()}}},[t]),f.useEffect(()=>{if(i){let w=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(w)}}},[i]);let y=()=>{o(!0)},j=()=>{o(!1),c(!1)};return a?t!=="intent"?[l,b,{}]:[l,b,{onFocus:Ea(m,y),onBlur:Ea(u,j),onMouseEnter:Ea(h,y),onMouseLeave:Ea(p,j),onTouchStart:Ea(g,y)}]:[!1,b,{}]}function Ea(t,r){return a=>{t&&t(a),a.defaultPrevented||r(a)}}function Q0({page:t,...r}){let{router:a}=yu(),i=f.useMemo(()=>lu(a.routes,t,a.basename),[a.routes,t,a.basename]);return i?f.createElement(X0,{page:t,matches:i,...r}):null}function Y0(t){let{manifest:r,routeModules:a}=vu(),[i,o]=f.useState([]);return f.useEffect(()=>{let l=!1;return H0(t,r,a).then(c=>{l||o(c)}),()=>{l=!0}},[t,r,a]),i}function X0({page:t,matches:r,...a}){let i=Os(),{manifest:o,routeModules:l}=vu(),{basename:c}=yu(),{loaderData:m,matches:u}=K0(),h=f.useMemo(()=>Vd(t,r,u,o,i,"data"),[t,r,u,o,i]),p=f.useMemo(()=>Vd(t,r,u,o,i,"assets"),[t,r,u,o,i]),g=f.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let j=new Set,w=!1;if(r.forEach(k=>{var P;let S=o.routes[k.route.id];!S||!S.hasLoader||(!h.some(E=>E.route.id===k.route.id)&&k.route.id in m&&((P=l[k.route.id])!=null&&P.shouldRevalidate)||S.hasClientLoader?w=!0:j.add(k.route.id))}),j.size===0)return[];let N=$0(t,c,"data");return w&&j.size>0&&N.searchParams.set("_routes",r.filter(k=>j.has(k.route.id)).map(k=>k.route.id).join(",")),[N.pathname+N.search]},[c,m,i,o,h,r,t,l]),b=f.useMemo(()=>W0(p,o),[p,o]),y=Y0(p);return f.createElement(f.Fragment,null,g.map(j=>f.createElement("link",{key:j,rel:"prefetch",as:"fetch",href:j,...a})),b.map(j=>f.createElement("link",{key:j,rel:"modulepreload",href:j,...a})),y.map(({key:j,link:w})=>f.createElement("link",{key:j,nonce:a.nonce,...w})))}function ef(...t){return r=>{t.forEach(a=>{typeof a=="function"?a(r):a!=null&&(a.current=r)})}}var ju=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ju&&(window.__reactRouterVersion="7.10.1")}catch{}function tf({basename:t,children:r,unstable_useTransitions:a,window:i}){let o=f.useRef();o.current==null&&(o.current=Op({window:i,v5Compat:!0}));let l=o.current,[c,m]=f.useState({action:l.action,location:l.location}),u=f.useCallback(h=>{a===!1?m(h):f.startTransition(()=>m(h))},[a]);return f.useLayoutEffect(()=>l.listen(u),[l,u]),f.createElement(L0,{basename:t,children:r,location:c.location,navigationType:c.action,navigator:l,unstable_useTransitions:a===!0})}var _u=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oa=f.forwardRef(function({onClick:r,discover:a="render",prefetch:i="none",relative:o,reloadDocument:l,replace:c,state:m,target:u,to:h,preventScrollReset:p,viewTransition:g,...b},y){let{basename:j,unstable_useTransitions:w}=f.useContext(ss),N=typeof h=="string"&&_u.test(h),k,S=!1;if(typeof h=="string"&&N&&(k=h,ju))try{let I=new URL(window.location.href),O=h.startsWith("//")?new URL(I.protocol+h):new URL(h),F=As(O.pathname,j);O.origin===I.origin&&F!=null?h=F+O.search+O.hash:S=!0}catch{Ut(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let P=m0(h,{relative:o}),[E,T,D]=J0(i,b),R=nf(h,{replace:c,state:m,target:u,preventScrollReset:p,relative:o,viewTransition:g,unstable_useTransitions:w});function _(I){r&&r(I),I.defaultPrevented||R(I)}let M=f.createElement("a",{...b,...D,href:k||P,onClick:S||l?r:_,ref:ef(y,T),target:u,"data-discover":!N&&a==="render"?"true":void 0});return E&&!N?f.createElement(f.Fragment,null,M,f.createElement(Q0,{page:P})):M});oa.displayName="Link";var sf=f.forwardRef(function({"aria-current":r="page",caseSensitive:a=!1,className:i="",end:o=!1,style:l,to:c,viewTransition:m,children:u,...h},p){let g=on(c,{relative:h.relative}),b=Os(),y=f.useContext(ci),{navigator:j,basename:w}=f.useContext(ss),N=y!=null&&uf(g)&&m===!0,k=j.encodeLocation?j.encodeLocation(g).pathname:g.pathname,S=b.pathname,P=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;a||(S=S.toLowerCase(),P=P?P.toLowerCase():null,k=k.toLowerCase()),P&&w&&(P=As(P,w)||P);const E=k!=="/"&&k.endsWith("/")?k.length-1:k.length;let T=S===k||!o&&S.startsWith(k)&&S.charAt(E)==="/",D=P!=null&&(P===k||!o&&P.startsWith(k)&&P.charAt(k.length)==="/"),R={isActive:T,isPending:D,isTransitioning:N},_=T?r:void 0,M;typeof i=="function"?M=i(R):M=[i,T?"active":null,D?"pending":null,N?"transitioning":null].filter(Boolean).join(" ");let I=typeof l=="function"?l(R):l;return f.createElement(oa,{...h,"aria-current":_,className:M,ref:p,style:I,to:c,viewTransition:m},typeof u=="function"?u(R):u)});sf.displayName="NavLink";var rf=f.forwardRef(({discover:t="render",fetcherKey:r,navigate:a,reloadDocument:i,replace:o,state:l,method:c=Bn,action:m,onSubmit:u,relative:h,preventScrollReset:p,viewTransition:g,...b},y)=>{let{unstable_useTransitions:j}=f.useContext(ss),w=df(),N=cf(m,{relative:h}),k=c.toLowerCase()==="get"?"get":"post",S=typeof m=="string"&&_u.test(m),P=E=>{if(u&&u(E),E.defaultPrevented)return;E.preventDefault();let T=E.nativeEvent.submitter,D=(T==null?void 0:T.getAttribute("formmethod"))||c,R=()=>w(T||E.currentTarget,{fetcherKey:r,method:D,navigate:a,replace:o,state:l,relative:h,preventScrollReset:p,viewTransition:g});j&&a!==!1?f.startTransition(()=>R()):R()};return f.createElement("form",{ref:y,method:k,action:N,onSubmit:i?u:P,...b,"data-discover":!S&&t==="render"?"true":void 0})});rf.displayName="Form";function af(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function wu(t){let r=f.useContext(ma);return Be(r,af(t)),r}function nf(t,{target:r,replace:a,state:i,preventScrollReset:o,relative:l,viewTransition:c,unstable_useTransitions:m}={}){let u=ui(),h=Os(),p=on(t,{relative:l});return f.useCallback(g=>{if(I0(g,r)){g.preventDefault();let b=a!==void 0?a:Ua(h)===Ua(p),y=()=>u(t,{replace:b,state:i,preventScrollReset:o,relative:l,viewTransition:c});m?f.startTransition(()=>y()):y()}},[h,u,p,a,i,r,t,o,l,c,m])}function Nu(t){Ut(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let r=f.useRef(To(t)),a=f.useRef(!1),i=Os(),o=f.useMemo(()=>O0(i.search,a.current?null:r.current),[i.search]),l=ui(),c=f.useCallback((m,u)=>{const h=To(typeof m=="function"?m(new URLSearchParams(o)):m);a.current=!0,l("?"+h,u)},[l,o]);return[o,c]}var of=0,lf=()=>`__${String(++of)}__`;function df(){let{router:t}=wu("useSubmit"),{basename:r}=f.useContext(ss),a=k0(),i=t.fetch,o=t.navigate;return f.useCallback(async(l,c={})=>{let{action:m,method:u,encType:h,formData:p,body:g}=B0(l,r);if(c.navigate===!1){let b=c.fetcherKey||lf();await i(b,a,c.action||m,{preventScrollReset:c.preventScrollReset,formData:p,body:g,formMethod:c.method||u,formEncType:c.encType||h,flushSync:c.flushSync})}else await o(c.action||m,{preventScrollReset:c.preventScrollReset,formData:p,body:g,formMethod:c.method||u,formEncType:c.encType||h,replace:c.replace,state:c.state,fromRouteId:a,flushSync:c.flushSync,viewTransition:c.viewTransition})},[i,o,r,a])}function cf(t,{relative:r}={}){let{basename:a}=f.useContext(ss),i=f.useContext(ys);Be(i,"useFormAction must be used inside a RouteContext");let[o]=i.matches.slice(-1),l={...on(t||".",{relative:r})},c=Os();if(t==null){l.search=c.search;let m=new URLSearchParams(l.search),u=m.getAll("index");if(u.some(p=>p==="")){m.delete("index"),u.filter(g=>g).forEach(g=>m.append("index",g));let p=m.toString();l.search=p?`?${p}`:""}}return(!t||t===".")&&o.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(l.pathname=l.pathname==="/"?a:Rs([a,l.pathname])),Ua(l)}function uf(t,{relative:r}={}){let a=f.useContext(xu);Be(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=wu("useViewTransitionState"),o=on(t,{relative:r});if(!a.isTransitioning)return!1;let l=As(a.currentLocation.pathname,i)||a.currentLocation.pathname,c=As(a.nextLocation.pathname,i)||a.nextLocation.pathname;return Jn(o.pathname,c)!=null||Jn(o.pathname,l)!=null}const mf=()=>{const t=Os(),[r,a]=f.useState(!1);f.useEffect(()=>{document.documentElement.classList.contains("dark")?a(!0):window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.documentElement.classList.add("dark"),a(!0))},[]);const i=()=>{const c=!r;a(c),c?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},o=c=>t.pathname===c,l=t.pathname==="/canvas"||t.pathname==="/eda";return e.jsxs("div",{className:"flex h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-200",children:[e.jsxs("aside",{className:`${l?"w-16":"w-64"} bg-slate-900 dark:bg-slate-950 text-white flex flex-col shrink-0 transition-all duration-200`,children:[e.jsxs("div",{className:`${l?"p-4":"p-6"} border-b border-slate-800 dark:border-slate-900 flex items-center ${l?"justify-center":"gap-3"}`,children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center font-bold text-lg shrink-0 shadow-lg shadow-blue-900/20",children:"S"}),!l&&e.jsx("h1",{className:"text-xl font-bold tracking-tight whitespace-nowrap bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent",children:"Skyulf ML"})]}),e.jsxs("nav",{className:"flex-1 p-2 space-y-2",children:[e.jsx(Zs,{to:"/",active:o("/"),icon:e.jsx(Uo,{size:20}),collapsed:l,children:"Dashboard"}),e.jsx(Zs,{to:"/jobs",active:o("/jobs"),icon:e.jsx(tt,{size:20}),collapsed:l,children:"Jobs"}),e.jsx(Zs,{to:"/eda",active:o("/eda"),icon:e.jsx(gs,{size:20}),collapsed:l,children:"EDA"}),e.jsx(Zs,{to:"/drift",active:o("/drift"),icon:e.jsx(nx,{size:20}),collapsed:l,children:"Data Drift"}),e.jsx(Zs,{to:"/canvas",active:o("/canvas"),icon:e.jsx(Fa,{size:20}),collapsed:l,children:"ML Canvas"}),e.jsx(Zs,{to:"/data",active:o("/data"),icon:e.jsx(bt,{size:20}),collapsed:l,children:"Data Sources"}),e.jsx(Zs,{to:"/registry",active:o("/registry"),icon:e.jsx(lo,{size:20}),collapsed:l,children:"Model Registry"}),e.jsx(Zs,{to:"/deployments",active:o("/deployments"),icon:e.jsx(oi,{size:20}),collapsed:l,children:"Deployments"})]}),e.jsx("div",{className:`${l?"p-2":"p-4"} border-t border-slate-800 space-y-4`,children:e.jsxs("button",{onClick:i,className:`flex items-center ${l?"justify-center":"gap-3"} w-full ${l?"px-2":"px-4"} py-2 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-colors`,title:r?"Light Mode":"Dark Mode",children:[r?e.jsx(ix,{size:20}):e.jsx(ox,{size:20}),!l&&(r?"Light Mode":"Dark Mode")]})})]}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsx(P0,{})})]})},Zs=({to:t,children:r,active:a,icon:i,collapsed:o})=>e.jsxs(oa,{to:t,className:`flex items-center ${o?"justify-center":"gap-3"} ${o?"px-2":"px-4"} py-3 rounded-md text-sm font-medium transition-colors ${a?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-800"}`,title:o?r:void 0,children:[i,!o&&r]}),hf="/api",Oe=qs.create({baseURL:hf,headers:{"Content-Type":"application/json"}}),xf=async t=>(await Oe.post("/pipeline/preview",t)).data,pf=async t=>(await Oe.get(`/pipeline/datasets/${t}/schema`)).data,ff=async(t,r)=>(await Oe.post(`/pipeline/save/${t}`,r)).data,gf=async t=>{const r=await Oe.get(`/pipeline/load/${t}`);return r.data?r.data:null},Ge={runPipeline:async t=>(await Oe.post("/pipeline/run",t)).data,getJob:async t=>(await Oe.get(`/pipeline/jobs/${t}`)).data,cancelJob:async t=>{await Oe.post(`/pipeline/jobs/${t}/cancel`)},getJobs:async(t=10,r=0,a)=>{const i={limit:t,skip:r};return a&&(i.job_type=a),(await Oe.get("/pipeline/jobs",{params:i})).data},getEDAJobs:async(t=50)=>(await Oe.get("/eda/jobs/all",{params:{limit:t}})).data.map(a=>({job_id:String(a.id),pipeline_id:"eda",node_id:"eda",dataset_id:String(a.dataset_id),dataset_name:a.dataset_name,job_type:"eda",status:a.status.toLowerCase(),start_time:a.created_at,end_time:a.updated_at||a.created_at,error:a.error,result:null,created_at:a.created_at,target_column:a.target_col})),getIngestionJobs:async(t=50,r=0)=>(await qs.get("/data/api/sources",{params:{limit:t,skip:r}})).data.sources.map(i=>({job_id:String(i.id),pipeline_id:"ingestion",node_id:"ingestion",dataset_id:String(i.id),dataset_name:i.name,job_type:"ingestion",status:i.test_status==="success"?"succeeded":i.test_status==="failed"?"failed":"completed",start_time:i.created_at,end_time:i.updated_at,error:null,result:null,created_at:i.created_at,model_type:i.type})),getHyperparameters:async t=>(await Oe.get(`/pipeline/hyperparameters/${t}`)).data,getDefaultSearchSpace:async t=>(await Oe.get(`/pipeline/hyperparameters/${t}/defaults`)).data,getLatestTuningJob:async t=>(await Oe.get(`/pipeline/jobs/tuning/latest/${t}`)).data,getBestTuningJob:async t=>(await Oe.get(`/pipeline/jobs/tuning/best/${t}`)).data,getTuningHistory:async t=>(await Oe.get(`/pipeline/jobs/tuning/history/${t}`)).data},Ln=["#10B981","#EF4444","#F59E0B","#3B82F6"],qd=t=>typeof t=="object"&&t!==null,bf=()=>{const[t,r]=f.useState(null),[a,i]=f.useState([]),[o,l]=f.useState(!0),[c,m]=f.useState({statusDist:[],dailyActivity:[]});return f.useEffect(()=>{(async()=>{try{const[h,p]=await Promise.all([Oe.get("/pipeline/stats"),Ge.getJobs(50,0)]);r(h.data);const g=p.map(N=>({id:N.job_id,status:N.status,model_type:N.model_type||"Unknown",created_at:N.start_time||N.created_at||new Date().toISOString(),metrics:(()=>{const k=N.metrics??(qd(N.result)?N.result.metrics:void 0);return qd(k)?k:void 0})()}));i(g);const b=g.reduce((N,k)=>(N[k.status]=(N[k.status]||0)+1,N),{}),y=Object.entries(b).map(([N,k])=>({name:N,value:k})),w=[...Array(7)].map((N,k)=>{const S=new Date;return S.setDate(S.getDate()-k),S.toISOString().split("T")[0]}).reverse().map(N=>({date:new Date(N).toLocaleDateString("en-US",{month:"short",day:"numeric"}),count:g.filter(k=>k.created_at.startsWith(N)).length}));m({statusDist:y,dailyActivity:w})}catch(h){console.error("Failed to fetch dashboard data:",h)}finally{l(!1)}})()},[]),e.jsxs("div",{className:"p-8 space-y-8 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Dashboard"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Overview of your ML pipeline activities"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(oa,{to:"/canvas",className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md shadow-sm transition-all",children:[e.jsx(Yt,{size:18}),"New Experiment"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(En,{title:"Total Jobs",value:(t==null?void 0:t.total_jobs)??"-",icon:e.jsx(tt,{className:"text-indigo-500"}),subtext:`${(t==null?void 0:t.training_jobs)??0} Training, ${(t==null?void 0:t.tuning_jobs)??0} Tuning`}),e.jsx(En,{title:"Active Deployments",value:(t==null?void 0:t.active_deployments)??"-",icon:e.jsx(kd,{className:"text-green-500"}),color:"text-green-600 dark:text-green-400"}),e.jsx(En,{title:"Data Sources",value:(t==null?void 0:t.data_sources)??"-",icon:e.jsx(bt,{className:"text-blue-500"})}),e.jsx(En,{title:"Success Rate",value:a.length>0?`${Math.round(a.filter(u=>u.status==="succeeded"||u.status==="completed").length/a.length*100)}%`:"-",icon:e.jsx(rt,{className:"text-emerald-500"}),subtext:"Last 50 jobs"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6 text-slate-900 dark:text-slate-100",children:"Weekly Activity"}),e.jsx("div",{className:"h-64",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:c.dailyActivity,children:[e.jsx(Ct,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),e.jsx(St,{dataKey:"date",stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(Tt,{stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1,allowDecimals:!1}),e.jsx(pt,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#f8fafc"},cursor:{fill:"#f1f5f9"}}),e.jsx(Mt,{dataKey:"count",fill:"#6366f1",radius:[4,4,0,0],barSize:30})]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6 text-slate-900 dark:text-slate-100",children:"Job Status Distribution"}),e.jsx("div",{className:"h-64",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(Ac,{children:[e.jsx(Dc,{data:c.statusDist,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:c.statusDist.map((u,h)=>e.jsx(ni,{fill:u.name==="succeeded"?Ln[0]:u.name==="failed"?Ln[1]:u.name==="running"?Ln[3]:Ln[2]},`cell-${h}`))}),e.jsx(pt,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#f8fafc"}}),e.jsx(en,{verticalAlign:"bottom",height:36,iconType:"circle"})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Recent Jobs"}),e.jsxs(oa,{to:"/jobs",className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1",children:["View All ",e.jsx(Oc,{size:14})]})]}),o?e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Loading..."}):a.length===0?e.jsx("div",{className:"p-8 text-center text-slate-500",children:"No recent jobs found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Job ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Model"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Time"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:a.slice(0,5).map(u=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(yf,{status:u.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-slate-100",children:e.jsx("span",{className:"font-mono text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded",children:u.id.substring(0,8)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:u.model_type}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:[new Date(u.created_at).toLocaleDateString()," ",e.jsx("span",{className:"text-xs opacity-70",children:new Date(u.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},u.id))})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-900 dark:text-slate-100",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Rn,{to:"/data",icon:e.jsx(bt,{size:18,className:"text-blue-500"}),title:"Manage Data Sources",desc:"Upload or connect new data"}),e.jsx(Rn,{to:"/canvas",icon:e.jsx(Zt,{size:18,className:"text-indigo-500"}),title:"Run Pipeline",desc:"Create and execute ML workflows"}),e.jsx(Rn,{to:"/deployments",icon:e.jsx(kd,{size:18,className:"text-green-500"}),title:"View Deployments",desc:"Monitor active model endpoints"}),e.jsx(Rn,{to:"/settings",icon:e.jsx(lx,{size:18,className:"text-slate-500"}),title:"Settings",desc:"Configure system preferences"})]})]})]})]})},En=({title:t,value:r,icon:a,subtext:i,color:o="text-slate-900 dark:text-slate-100"})=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:t}),e.jsx("div",{className:`mt-2 text-3xl font-bold ${o}`,children:r})]}),a&&e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-full",children:a})]}),i&&e.jsxs("div",{className:"mt-2 text-xs text-slate-400 dark:text-slate-500 flex items-center gap-1",children:[e.jsx(tt,{size:12})," ",i]})]}),yf=({status:t})=>{const r={succeeded:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",completed:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",failed:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",running:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"},a={succeeded:e.jsx(rt,{size:14}),completed:e.jsx(rt,{size:14}),failed:e.jsx(ca,{size:14}),running:e.jsx(tt,{size:14,className:"animate-pulse"}),pending:e.jsx(Qt,{size:14})},i=t.toLowerCase(),o=r[i]||"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400",l=a[i]||e.jsx(Qt,{size:14});return e.jsxs("span",{className:`px-2.5 py-1 inline-flex items-center gap-1.5 text-xs font-medium rounded-full ${o}`,children:[l,t.charAt(0).toUpperCase()+t.slice(1)]})},Rn=({to:t,icon:r,title:a,desc:i})=>e.jsxs(oa,{to:t,className:"flex items-center gap-4 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors border border-transparent hover:border-slate-200 dark:hover:border-slate-600 group",children:[e.jsx("div",{className:"bg-white dark:bg-slate-700 p-2 rounded-md shadow-sm group-hover:scale-110 transition-transform",children:r}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm",children:a}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:i})]}),e.jsx(Oc,{size:14,className:"ml-auto text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity"})]}),Ra="/data/api",Mn="/api/ingestion",$t={getAll:async()=>{const t=await fetch(`${Ra}/sources`);if(!t.ok)throw new Error("Failed to fetch datasets");return(await t.json()).sources||[]},getUsable:async()=>{const t=await fetch(`${Ra}/sources/usable`);if(!t.ok)throw new Error("Failed to fetch usable datasets");return(await t.json()).sources||[]},upload:async t=>{const r=new FormData;r.append("file",t);const a=await fetch(`${Mn}/upload`,{method:"POST",body:r});if(!a.ok){const i=await a.json();throw new Error(i.detail||"Failed to upload file")}return await a.json()},createSource:async t=>{const r=await fetch(`${Mn}/database`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const a=await r.json();throw new Error(a.detail||"Failed to create data source")}return await r.json()},getIngestionStatus:async t=>{const r=await fetch(`${Mn}/${encodeURIComponent(t)}/status`);if(!r.ok)throw new Error("Failed to fetch ingestion status");return await r.json()},cancelIngestion:async t=>{const r=await fetch(`${Mn}/${encodeURIComponent(t)}/cancel`,{method:"POST"});if(!r.ok){const a=await r.json();throw new Error(a.detail||"Failed to cancel ingestion")}},getById:async t=>{const r=await fetch(`${Ra}/sources/${encodeURIComponent(t)}`);if(!r.ok)throw new Error("Failed to fetch dataset");return(await r.json()).source},getSample:async(t,r=1)=>{const a=new URLSearchParams({limit:r.toString()}),i=await fetch(`${Ra}/sources/${encodeURIComponent(t)}/sample?${a.toString()}`);if(!i.ok)throw new Error("Failed to fetch dataset sample");return(await i.json()).data},getProfile:async t=>{const r=await fetch(`/api/pipeline/datasets/${encodeURIComponent(t)}/schema`);if(!r.ok)throw new Error("Failed to fetch dataset profile");const a=await r.json(),i=Object.values(a.columns).map(c=>{const m=c;return{name:m.name,dtype:m.dtype,missing_count:m.missing_count||0,missing_percentage:(m.missing_ratio||0)*100,distinct_count:m.unique_count||0,numeric_summary:m.column_type==="numeric"?{mean:m.mean_value,std:m.std_value,minimum:m.min_value,maximum:m.max_value}:void 0}}),o=a.row_count*a.column_count,l=i.reduce((c,m)=>c+m.missing_count,0);return{metrics:{row_count:a.row_count,column_count:a.column_count,missing_cells:l,missing_percentage:o>0?Number((l/o*100).toFixed(2)):0},columns:i}},delete:async t=>{if(!(await fetch(`${Ra}/sources/${encodeURIComponent(t)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete dataset")}},ku=({onUploadComplete:t,onCancel:r})=>{const[a,i]=f.useState(!1),[o,l]=f.useState(!1),[c,m]=f.useState(null),[u,h]=f.useState(0),p=f.useCallback(j=>{j.preventDefault(),j.stopPropagation(),j.type==="dragenter"||j.type==="dragover"?i(!0):j.type==="dragleave"&&i(!1)},[]),g=f.useCallback(j=>{j.preventDefault(),j.stopPropagation(),i(!1),j.dataTransfer.files&&j.dataTransfer.files[0]&&y(j.dataTransfer.files[0])},[]),b=j=>{j.preventDefault(),j.target.files&&j.target.files[0]&&y(j.target.files[0])},y=async j=>{l(!0),m(null),h(0);try{const w=await $t.upload(j);t(w.job_id,j.name)}catch(w){console.error("Upload failed:",w),m(w.message||"Failed to upload file. Please try again.")}finally{l(!1)}};return e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50 dark:bg-slate-900 dark:border-slate-700 relative",children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full text-slate-500 dark:text-slate-400",children:e.jsx(et,{size:16})}),e.jsxs("h3",{className:"font-medium mb-4 flex items-center gap-2 text-slate-900 dark:text-slate-100",children:[e.jsx(zc,{size:18,className:"text-blue-600 dark:text-blue-400"}),"Upload New Dataset"]}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-slate-300 dark:border-slate-700 hover:border-slate-400 dark:hover:border-slate-600"}`,onDragEnter:p,onDragLeave:p,onDragOver:p,onDrop:g,children:o?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${u}%`}})}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["Uploading... ",u,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(dx,{className:"w-10 h-10 text-slate-400 dark:text-slate-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-2",children:["Drag and drop your file here, or"," ",e.jsxs("label",{className:"text-blue-600 dark:text-blue-400 hover:underline cursor-pointer font-medium",children:["browse",e.jsx("input",{type:"file",className:"hidden",accept:".csv,.xlsx,.parquet,.json",onChange:b})]})]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Supports CSV, Excel, Parquet, JSON"})]})}),c&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 text-sm rounded-md flex items-start gap-2",children:[e.jsx(xt,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("span",{children:c})]})]})},Cu=(t,r=2)=>{if(!+t)return"0 Bytes";const a=1024,i=r<0?0:r,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(t)/Math.log(a));return`${parseFloat((t/Math.pow(a,l)).toFixed(i))} ${o[l]}`},vf=({dataset:t,isOpen:r,onClose:a})=>{const[i,o]=f.useState([]),[l,c]=f.useState(null),[m,u]=f.useState(!1),[h,p]=f.useState(null),[g,b]=f.useState("sample"),[y,j]=f.useState(100);f.useEffect(()=>{r&&t?w(100):(o([]),c(null),p(null),b("sample"),j(100))},[r,t]);const w=async T=>{if(t){u(!0),p(null);try{const[D,R]=await Promise.all([$t.getSample(t.id,T),$t.getProfile(t.id)]);o(D),c(R)}catch(D){console.error("Failed to fetch data:",D),p("Failed to load dataset preview.")}finally{u(!1)}}},N=()=>{const T=y+500;j(T),w(T)};if(!r||!t)return null;const k=i.length>0?Object.keys(i[0]):[],S=(l==null?void 0:l.metrics.row_count)??t.rows??0,P=(l==null?void 0:l.metrics.column_count)??t.columns??0,E=t.size_bytes??0;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col border border-slate-200 dark:border-slate-700 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-blue-600 dark:text-blue-400",children:e.jsx(bt,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500 dark:text-slate-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Cr,{size:14})," ",t.format||"CSV"]}),e.jsx("span",{children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(cx,{size:14})," ",S.toLocaleString()," rows"]}),e.jsx("span",{children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fc,{size:14})," ",P," columns"]}),e.jsx("span",{children:""}),e.jsx("span",{children:Cu(E)})]})]})]}),e.jsx("button",{onClick:a,className:"p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(et,{size:20})})]}),e.jsxs("div",{className:"flex border-b border-slate-200 dark:border-slate-700 px-6",children:[e.jsx("button",{onClick:()=>{b("sample")},className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${g==="sample"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400":"border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}`,children:"Data Sample"}),e.jsx("button",{onClick:()=>{b("stats")},className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${g==="stats"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400":"border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}`,children:"Statistics"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:m?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-500",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{children:"Loading preview data..."})]}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-900/20",children:[e.jsx("p",{children:h}),e.jsx("button",{onClick:()=>{w(y)},className:"mt-4 px-4 py-2 bg-white dark:bg-slate-800 border border-red-200 dark:border-red-800 rounded-md text-sm font-medium hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:"Retry"})]}):g==="sample"?i.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500",children:"No data available to preview."}):k.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500",children:"Data loaded but no columns found."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10",children:e.jsx("tr",{children:k.map(T=>e.jsx("th",{className:"px-4 py-3 font-semibold whitespace-nowrap bg-slate-50 dark:bg-slate-800",children:T},T))})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900",children:i.map((T,D)=>e.jsx("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:k.map(R=>e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-700 dark:text-slate-300",children:String(T[R]??"")},`${D}-${R}`))},D))})]})})}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 border border-blue-200 dark:border-blue-800 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",children:"Load More (+500 rows)"}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Showing first ",i.length," rows"]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(An,{label:"Total Rows",value:l==null?void 0:l.metrics.row_count.toLocaleString()}),e.jsx(An,{label:"Total Columns",value:l==null?void 0:l.metrics.column_count}),e.jsx(An,{label:"Missing Cells",value:l==null?void 0:l.metrics.missing_cells.toLocaleString()}),e.jsx(An,{label:"Missing %",value:`${l==null?void 0:l.metrics.missing_percentage}%`})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Column"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Missing"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Unique"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Min"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Max"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Mean"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Std Dev"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900",children:l==null?void 0:l.columns.map(T=>{var D,R,_,M;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-slate-900 dark:text-slate-100",children:T.name}),e.jsx("td",{className:"px-4 py-3 font-mono text-xs text-slate-500",children:T.dtype}),e.jsxs("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300",children:[T.missing_count," ",e.jsxs("span",{className:"text-xs text-slate-400",children:["(",T.missing_percentage,"%)"]})]}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300",children:T.distinct_count}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((D=T.numeric_summary)==null?void 0:D.minimum.toFixed(2))??"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((R=T.numeric_summary)==null?void 0:R.maximum.toFixed(2))??"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((_=T.numeric_summary)==null?void 0:_.mean.toFixed(2))??"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-600 dark:text-slate-300 font-mono text-xs",children:((M=T.numeric_summary)==null?void 0:M.std.toFixed(2))??"-"})]},T.name)})})]})})]})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 flex justify-end rounded-b-xl",children:e.jsx("button",{onClick:a,className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Close"})})]})})},An=({label:t,value:r})=>e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:t}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-1",children:r??"-"})]}),jf=({isOpen:t,onClose:r,onSuccess:a})=>{const[i,o]=f.useState("database"),[l,c]=f.useState(""),[m,u]=f.useState(""),[h,p]=f.useState(""),[g,b]=f.useState(""),[y,j]=f.useState("GET"),[w,N]=f.useState(""),[k,S]=f.useState(!1),[P,E]=f.useState(!1),[T,D]=f.useState(null);if(!t)return null;const R=async _=>{var M,I,O;_.preventDefault(),E(!0),D(null);try{const F={};if(i==="database")F.connection_string=m,F.query=h;else if(i==="s3"){F.path=w;const G=_.target,ee=(M=G.elements.namedItem("aws_access_key_id"))==null?void 0:M.value,te=(I=G.elements.namedItem("aws_secret_access_key"))==null?void 0:I.value,W=(O=G.elements.namedItem("region_name"))==null?void 0:O.value;ee&&te&&(F.storage_options={aws_access_key_id:ee,aws_secret_access_key:te,region:W||void 0})}else F.url=g,F.method=y;const B={name:l,type:i,config:F,description:`Imported from ${i}`},q=await $t.createSource(B);a(q.job_id),r()}catch(F){D(F.message||"Failed to create source")}finally{E(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[90vh] border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700 shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-900 dark:text-slate-100",children:"Add Data Source"}),e.jsx("button",{onClick:r,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:e.jsx(et,{size:20})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>{o("database")},className:`flex-1 py-2 px-4 rounded-md flex items-center justify-center gap-2 border ${i==="database"?"bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900/20 dark:border-blue-400 dark:text-blue-400":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400"}`,children:[e.jsx(bt,{size:16})," Database"]}),e.jsxs("button",{onClick:()=>{o("s3")},className:`flex-1 py-2 px-4 rounded-md flex items-center justify-center gap-2 border ${i==="s3"?"bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900/20 dark:border-blue-400 dark:text-blue-400":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400"}`,children:[e.jsx(Bc,{size:16})," S3"]}),e.jsxs("button",{onClick:()=>{o("api")},className:`flex-1 py-2 px-4 rounded-md flex items-center justify-center gap-2 border ${i==="api"?"bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900/20 dark:border-blue-400 dark:text-blue-400":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400"}`,children:[e.jsx(ux,{size:16})," API"]})]}),e.jsxs("form",{onSubmit:_=>{R(_)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:l,onChange:_=>{c(_.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"My Dataset"})]}),i==="database"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Connection String"}),e.jsx("input",{type:"text",required:!0,value:m,onChange:_=>{u(_.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"postgresql://user:pass@localhost:5432/db"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"SQL Query"}),e.jsx("textarea",{required:!0,value:h,onChange:_=>{p(_.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 h-24",placeholder:"SELECT * FROM users"})]})]}),i==="s3"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S3 Path"}),e.jsx("input",{type:"text",required:!0,value:w,onChange:_=>{N(_.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"s3://my-bucket/path/to/data.parquet"})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-md overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>S(!k),className:"w-full flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Credentials (Optional)"})}),k?e.jsx(De,{size:16,className:"text-slate-500"}):e.jsx(Pt,{size:16,className:"text-slate-500"})]}),k&&e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"If your bucket is private, provide credentials here. They will be stored securely. Leave blank if using backend's IAM role."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Access Key ID"}),e.jsx("input",{type:"text",name:"aws_access_key_id",className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100",placeholder:"AKIA..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Secret Access Key"}),e.jsx("input",{type:"password",name:"aws_secret_access_key",className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100",placeholder:"Secret..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Region"}),e.jsx("input",{type:"text",name:"region_name",className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100",placeholder:"us-east-1"})]})]})]})]})]}),i==="api"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"API URL"}),e.jsx("input",{type:"url",required:!0,value:g,onChange:_=>{b(_.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"https://api.example.com/data"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Method"}),e.jsxs("select",{value:y,onChange:_=>{j(_.target.value)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"})]})]})]}),T&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm rounded-md",children:T}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:P,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md flex items-center gap-2 disabled:opacity-50",children:P?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(Ba,{size:16})," Create Source"]})})]})]})]})]})})},_f=({isOpen:t,onClose:r,datasets:a,onRefresh:i})=>{const[o,l]=f.useState(null);if(!t)return null;const c=async u=>{if(window.confirm("Are you sure you want to cancel this ingestion job?")){l(u);try{await $t.cancelIngestion(u),i&&i()}catch(h){console.error("Failed to cancel ingestion:",h),alert("Failed to cancel ingestion")}finally{l(null)}}},m=a.map(u=>{var h,p,g,b,y,j;return{id:u.id,name:u.name,status:((p=(h=u.source_metadata)==null?void 0:h.ingestion_status)==null?void 0:p.status)||"completed",created_at:u.created_at,message:((b=(g=u.source_metadata)==null?void 0:g.ingestion_status)==null?void 0:b.error)||(((j=(y=u.source_metadata)==null?void 0:y.ingestion_status)==null?void 0:j.status)==="cancelled"?"Ingestion cancelled":"Ingestion completed successfully")}}).sort((u,h)=>new Date(h.created_at).getTime()-new Date(u.created_at).getTime());return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col border border-slate-200 dark:border-slate-700 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Data Ingestion Jobs"}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-slate-500 dark:hover:text-slate-300",children:e.jsx(et,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:m.length===0?e.jsx("div",{className:"text-center text-slate-500 py-8",children:"No ingestion jobs found."}):e.jsx("div",{className:"space-y-4",children:m.map(u=>e.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50",children:[e.jsx("div",{className:"mt-1",children:u.status==="processing"||u.status==="pending"?e.jsx(Ye,{className:"text-blue-500 animate-spin",size:20}):u.status==="failed"?e.jsx(ca,{className:"text-red-500",size:20}):u.status==="cancelled"?e.jsx(Un,{className:"text-slate-500",size:20}):e.jsx(rt,{className:"text-green-500",size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-medium text-slate-900 dark:text-slate-100",children:u.name}),e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(Qt,{size:12}),new Date(u.created_at).toLocaleString()]})]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Status: ",e.jsx("span",{className:"capitalize",children:u.status})]}),(u.status==="failed"||u.status==="cancelled")&&e.jsx("p",{className:`text-sm mt-1 p-2 rounded ${u.status==="failed"?"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/10":"text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-800"}`,children:u.message})]}),(u.status==="processing"||u.status==="pending")&&e.jsx("button",{onClick:()=>{c(u.id)},disabled:o===u.id,className:"p-2 text-slate-400 hover:text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-md transition-colors disabled:opacity-50",title:"Cancel Ingestion",children:o===u.id?e.jsx(Ye,{className:"animate-spin",size:20}):e.jsx(Un,{size:20})})]},u.id))})})]})})},wf=()=>{const t=ui(),[r,a]=f.useState([]),[i,o]=f.useState(!0),[l,c]=f.useState(!1),[m,u]=f.useState(!1),[h,p]=f.useState(!1),[g,b]=f.useState(null),[y,j]=f.useState(null),[w,N]=f.useState(null),[k,S]=f.useState("completed"),P=r.filter(O=>{var B,q;const F=((q=(B=O.source_metadata)==null?void 0:B.ingestion_status)==null?void 0:q.status)||"completed";return k==="all"?!0:F===k}),E=async()=>{r.length===0&&o(!0);try{const O=await $t.getAll();a(O)}catch(O){console.error("Failed to fetch datasets:",O)}finally{o(!1)}};f.useEffect(()=>{E()},[]),f.useEffect(()=>{const O=setInterval(()=>{r.some(B=>{var q,G,ee,te;return((G=(q=B.source_metadata)==null?void 0:q.ingestion_status)==null?void 0:G.status)==="pending"||((te=(ee=B.source_metadata)==null?void 0:ee.ingestion_status)==null?void 0:te.status)==="processing"})&&E()},5e3);return()=>{clearInterval(O)}},[r]);const T=async O=>{if(window.confirm("Are you sure you want to delete this dataset?")){b(O);try{await $t.delete(O),a(r.filter(F=>F.id!==O))}catch(F){console.error("Failed to delete dataset:",F),alert("Failed to delete dataset")}finally{b(null)}}},D=async O=>{if(window.confirm("Are you sure you want to cancel this ingestion job?")){j(O);try{await $t.cancelIngestion(O),E()}catch(F){console.error("Failed to cancel ingestion:",F),alert("Failed to cancel ingestion")}finally{j(null)}}},R=O=>{t(`/canvas?source_id=${O}`)},_=()=>{c(!1),E()},M=()=>{u(!1),E()},I=O=>{var B,q;const F=(q=(B=O.source_metadata)==null?void 0:B.ingestion_status)==null?void 0:q.status;return!F||F==="completed"?null:F==="failed"?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",children:"Failed"}):F==="cancelled"?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400",children:"Cancelled"}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",children:[e.jsx(Ye,{size:12,className:"animate-spin"}),F==="processing"?"Processing...":"Pending..."]})};return e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsx(vf,{dataset:w,isOpen:!!w,onClose:()=>{N(null)}}),e.jsx(jf,{isOpen:m,onClose:()=>{u(!1)},onSuccess:M}),e.jsx(_f,{isOpen:h,onClose:()=>{p(!1)},datasets:r,onRefresh:E}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Data Sources"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Manage your uploaded datasets and use them in experiments."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{p(!0)},className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-slate-700 dark:text-slate-200",children:[e.jsx(Sr,{size:18}),"Ingestion Jobs"]}),e.jsxs("button",{onClick:()=>{u(!0)},className:"flex items-center gap-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-300 dark:border-slate-600 px-4 py-2 rounded-md shadow-sm transition-all hover:bg-slate-50 dark:hover:bg-slate-700",children:[e.jsx(bt,{size:18}),"Add Source"]}),e.jsxs("button",{onClick:()=>{c(!l)},className:"flex items-center gap-2 text-white px-4 py-2 rounded-md shadow-sm transition-all hover:opacity-90",style:{background:"var(--main-gradient)"},children:[e.jsx(Yt,{size:18}),l?"Cancel Upload":"Upload File"]})]})]}),l&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm animate-in fade-in slide-in-from-top-4",children:e.jsx(ku,{onUploadComplete:_,onCancel:()=>{c(!1)}})}),e.jsx("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide",children:["all","completed","failed","cancelled"].map(O=>e.jsx("button",{onClick:()=>{S(O)},className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors whitespace-nowrap ${k===O?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-slate-800 text-slate-600 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:O.charAt(0).toUpperCase()+O.slice(1)},O))}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-4 font-semibold",children:"Dataset Name"}),e.jsx("th",{className:"px-3 py-4 font-semibold",children:"Type"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Format"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Size"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Created"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900",children:i&&r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500 dark:text-slate-400",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"}),"Loading datasets..."]})})}):P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-500 dark:text-slate-400",children:r.length===0?e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-12 h-12 mx-auto text-slate-300 dark:text-slate-600 mb-3"}),e.jsx("p",{className:"text-lg font-medium text-slate-900 dark:text-slate-100",children:"No datasets found"}),e.jsx("p",{className:"text-sm",children:"Upload a dataset to get started with your analysis."})]}):e.jsx("p",{className:"text-lg font-medium text-slate-900 dark:text-slate-100",children:"No datasets match the selected filter"})})}):P.map(O=>{var F,B,q,G,ee,te,W;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"px-3 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded text-blue-600 dark:text-blue-400",children:e.jsx(Cr,{size:18})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[O.name,I(O)]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono mt-0.5",title:"Dataset ID",children:O.source_id||O.id})]})]})}),e.jsx("td",{className:"px-3 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${O.type==="s3"?"bg-orange-50 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-800":O.type==="file"?"bg-slate-100 text-slate-700 border-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700":"bg-indigo-50 text-indigo-700 border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-400 dark:border-indigo-800"}`,children:O.type==="file"?"Upload":O.type.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200 uppercase border border-slate-200 dark:border-slate-700",children:O.format||"CSV"})}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:Cu(O.size_bytes||0)}),e.jsxs("span",{className:"text-xs text-slate-400 dark:text-slate-500",children:[((F=O.rows)==null?void 0:F.toLocaleString())||"-"," rows  ",O.columns||"-"," cols"]})]})}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Sr,{size:14,className:"text-slate-400 dark:text-slate-500"}),new Date(O.created_at).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[((q=(B=O.source_metadata)==null?void 0:B.ingestion_status)==null?void 0:q.status)==="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{N(O)},className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors",title:"Preview Dataset",children:e.jsx(Ho,{size:16})}),e.jsxs("button",{onClick:()=>{R(O.id)},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors",title:"Use in Canvas",children:[e.jsx(Zt,{size:16}),"Canvas"]}),e.jsxs("button",{onClick:()=>{t(`/eda?dataset_id=${O.id}`)},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-md transition-colors",title:"Analyze with EDA",children:[e.jsx(gs,{size:16}),"EDA"]})]}),(((ee=(G=O.source_metadata)==null?void 0:G.ingestion_status)==null?void 0:ee.status)==="pending"||((W=(te=O.source_metadata)==null?void 0:te.ingestion_status)==null?void 0:W.status)==="processing")&&e.jsx("button",{onClick:()=>{D(O.id)},disabled:y===O.id,className:"p-2 text-slate-400 hover:text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-md transition-colors disabled:opacity-50",title:"Cancel Ingestion",children:y===O.id?e.jsx("div",{className:"w-4 h-4 border-2 border-orange-600 border-t-transparent rounded-full animate-spin"}):e.jsx(ca,{size:16})}),e.jsx("button",{onClick:()=>{T(O.id)},disabled:g===O.id,className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors disabled:opacity-50",title:"Delete Dataset",children:g===O.id?e.jsx("div",{className:"w-4 h-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(or,{size:16})})]})})]},O.id)})})]})})})]})},xr=class xr{constructor(){Qi(this,"nodes",new Map)}static getInstance(){return xr.instance||(xr.instance=new xr),xr.instance}register(r){this.nodes.has(r.type)&&console.warn(`Node type "${r.type}" is already registered. Overwriting.`),this.nodes.set(r.type,r)}get(r){return this.nodes.get(r)}getAll(){return Array.from(this.nodes.values())}getByCategory(){const r={};return this.nodes.forEach(a=>{r[a.category]||(r[a.category]=[]),r[a.category].push(a)}),r}};Qi(xr,"instance");let Po=xr;const Te=Po.getInstance(),Su={},{useDebugValue:Nf}=ft,{useSyncExternalStoreWithSelector:kf}=Kh;let Gd=!1;const Cf=t=>t;function Sf(t,r=Cf,a){(Su?"production":void 0)!=="production"&&a&&!Gd&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Gd=!0);const i=kf(t.subscribe,t.getState,t.getServerState||t.getInitialState,r,a);return Nf(i),i}const Kd=t=>{(Su?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const r=typeof t=="function"?Hx(t):t,a=(i,o)=>Sf(r,i,o);return Object.assign(a,r),a},ll=t=>t?Kd(t):Kd,ut=[];for(let t=0;t<256;++t)ut.push((t+256).toString(16).slice(1));function Tf(t,r=0){return(ut[t[r+0]]+ut[t[r+1]]+ut[t[r+2]]+ut[t[r+3]]+"-"+ut[t[r+4]]+ut[t[r+5]]+"-"+ut[t[r+6]]+ut[t[r+7]]+"-"+ut[t[r+8]]+ut[t[r+9]]+"-"+ut[t[r+10]]+ut[t[r+11]]+ut[t[r+12]]+ut[t[r+13]]+ut[t[r+14]]+ut[t[r+15]]).toLowerCase()}let to;const Pf=new Uint8Array(16);function Lf(){if(!to){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");to=crypto.getRandomValues.bind(crypto)}return to(Pf)}const Ef=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Jd={randomUUID:Ef};function Rf(t,r,a){var o;t=t||{};const i=t.random??((o=t.rng)==null?void 0:o.call(t))??Lf();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Tf(i)}function Tu(t,r,a){return Jd.randomUUID&&!t?Jd.randomUUID():Rf(t)}const je=ll((t,r)=>({nodes:[],edges:[],executionResult:null,setExecutionResult:a=>t({executionResult:a}),setGraph:(a,i)=>t({nodes:a,edges:i}),onNodesChange:a=>{t({nodes:qx(a,r().nodes)})},onEdgesChange:a=>{t({edges:Vx(a,r().edges)})},onConnect:a=>{const i=r().nodes,o=r().edges,l=i.find(m=>m.id===a.source),c=i.find(m=>m.id===a.target);if(l&&c&&l.data.definitionType==="feature_target_split"){let u=c.data.definitionType==="TrainTestSplitter";if(!u){const h=[l.id],p=new Set;for(;h.length>0;){const g=h.shift();if(p.has(g))continue;p.add(g);const b=i.find(j=>j.id===g);if((b==null?void 0:b.data.definitionType)==="TrainTestSplitter"){u=!0;break}const y=o.filter(j=>j.target===g);for(const j of y)h.push(j.source)}}u||alert(`Warning: You are using an X/Y Split without a prior Train-Test Split.

Any processing or modeling done on this data will use 100% of the dataset (Data Leakage).

Recommended: Add a "Train-Test Split" node BEFORE the "Feature-Target Split" node.`)}t({edges:Wx(a,r().edges)})},addNode:(a,i,o={})=>{const l=Te.get(a);if(!l)return console.error(`Node type ${a} not found in registry`),"";const c=`${a}-${Tu()}`,m={id:c,type:"custom",position:i,data:{definitionType:a,catalogType:a,...l.getDefaultConfig(),...o}};return t({nodes:[...r().nodes,m]}),c},updateNodeData:(a,i)=>{t({nodes:r().nodes.map(o=>o.id===a?{...o,data:{...o.data,...i}}:o)})},validateGraph:async()=>{const{nodes:a,edges:i}=r();if(a.length===0)return!1;for(const o of a){const l=Te.get(o.data.definitionType);if(l){const c=l.validate(o.data);if(!c.isValid)return console.warn(`Node ${o.id} validation failed: ${c.message}`),!1}}for(const o of a){const l=Te.get(o.data.definitionType);if(l&&l.inputs.length>0&&!i.some(m=>m.target===o.id))return console.warn(`Node ${o.id} (${l.label}) is disconnected.`),!1}return!0}})),ha=ll(t=>({activeView:"canvas",setView:r=>t({activeView:r}),isSidebarOpen:!0,setSidebarOpen:r=>t({isSidebarOpen:r}),isPropertiesPanelExpanded:!1,setPropertiesPanelExpanded:r=>t({isPropertiesPanelExpanded:r}),isResultsPanelExpanded:!0,setResultsPanelExpanded:r=>t({isResultsPanelExpanded:r})})),Mf=()=>{const t=Te.getAll(),r=je(h=>h.addNode),{isSidebarOpen:a,setSidebarOpen:i}=ha(),[o,l]=f.useState(""),c=(h,p)=>{h.dataTransfer.setData("application/reactflow",p),h.dataTransfer.effectAllowed="move"};if(!a)return e.jsx("div",{className:"absolute left-4 top-4 z-50",children:e.jsx("button",{onClick:()=>i(!0),className:"p-2 bg-background border shadow-md rounded-md text-muted-foreground hover:text-foreground transition-colors",title:"Expand Components",children:e.jsx($c,{className:"w-5 h-5"})})});const m=t.filter(h=>h.label.toLowerCase().includes(o.toLowerCase())||h.category.toLowerCase().includes(o.toLowerCase())),u=["Data Source","Preprocessing","Modeling","Evaluation","Utility"];return e.jsxs("aside",{className:"w-64 shrink-0 border-r bg-background flex flex-col h-full shadow-sm z-10 transition-all duration-300",children:[e.jsxs("div",{className:"p-4 border-b space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold tracking-tight",children:"Components"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Drag and drop to canvas"})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-1 hover:bg-accent rounded-md text-muted-foreground hover:text-foreground transition-colors",title:"Collapse Sidebar",children:e.jsx(Zc,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{placeholder:"Search nodes...",className:"w-full pl-9 pr-3 py-2 text-sm border rounded-md bg-muted/50 focus:bg-background focus:outline-none focus:ring-1 focus:ring-primary transition-colors",value:o,onChange:h=>{l(h.target.value)}})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 scrollbar-thin",children:u.map(h=>{const p=m.filter(g=>g.category===h);return p.length===0?null:e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold text-muted-foreground mb-2 uppercase tracking-wider px-1",children:h}),e.jsx("div",{className:"space-y-2",children:p.map(g=>e.jsxs("div",{className:"group flex items-center p-3 border rounded-lg bg-card hover:border-primary/50 hover:shadow-sm cursor-grab active:cursor-grabbing transition-all",draggable:!0,onDragStart:b=>{c(b,g.type)},onClick:()=>r(g.type,{x:100,y:100}),children:[e.jsx("div",{className:"p-2 bg-primary/5 group-hover:bg-primary/10 rounded-md mr-3 transition-colors",children:g.icon&&e.jsx(g.icon,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:g.label}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:g.description})]})]},g.type))})]},h)})})]})};function Af(t,r){if(Object.is(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;if(t instanceof Map&&r instanceof Map){if(t.size!==r.size)return!1;for(const[i,o]of t)if(!Object.is(o,r.get(i)))return!1;return!0}if(t instanceof Set&&r instanceof Set){if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i))return!1;return!0}const a=Object.keys(t);if(a.length!==Object.keys(r).length)return!1;for(const i of a)if(!Object.prototype.hasOwnProperty.call(r,i)||!Object.is(t[i],r[i]))return!1;return!0}const{useRef:Df}=ft;function If(t){const r=Df();return a=>{const i=t(a);return Af(r.current,i)?r.current:r.current=i}}const Of=f.memo(({id:t,data:r,selected:a})=>{var h;const i=r.definitionType,o=Te.get(i),{deleteElements:l}=Ko(),c=je(p=>p.executionResult),m=(h=c==null?void 0:c.node_results)==null?void 0:h[t],u=p=>{p.stopPropagation(),l({nodes:[{id:t}]})};return o?e.jsxs("div",{className:`
      min-w-[200px] bg-card border-2 rounded-lg shadow-sm transition-all
      ${a?"border-primary ring-2 ring-primary/20":"border-border hover:border-primary/50"}
    `,children:[e.jsxs("div",{className:"flex items-center p-3 border-b bg-muted/30 rounded-t-lg relative group",children:[e.jsx("div",{className:"p-1.5 bg-primary/10 rounded mr-3",children:o.icon&&e.jsx(o.icon,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-bold",children:o.label}),m&&e.jsx("div",{className:`flex items-center gap-1 px-1.5 py-0.5 rounded-full text-[10px] font-medium border ${m.status==="success"?"bg-green-50 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-900":"bg-red-50 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-900"}`,children:m.status==="success"?e.jsx(mx,{size:10}):e.jsx(ca,{size:10})})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:o.category})]}),e.jsx("button",{onClick:u,className:"p-1 rounded-md hover:bg-destructive/10 hover:text-destructive text-muted-foreground/50 transition-all opacity-0 group-hover:opacity-100 ml-2",title:"Remove Node",children:e.jsx(et,{size:14})})]}),e.jsx("div",{className:"p-3",children:o.component?e.jsx(o.component,{data:r}):e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"No configuration needed"})}),o.inputs.map((p,g)=>e.jsx(qn,{type:"target",position:ar.Left,id:p.id,className:"!w-3 !h-3 !bg-muted-foreground hover:!bg-primary transition-colors",style:{top:`${(g+1)*100/(o.inputs.length+1)}%`},children:e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[10px] text-muted-foreground pointer-events-none whitespace-nowrap",children:p.label})},`input-${p.id}`)),o.outputs.map((p,g)=>e.jsx(qn,{type:"source",position:ar.Right,id:p.id,className:"!w-3 !h-3 !bg-muted-foreground hover:!bg-primary transition-colors",style:{top:`${(g+1)*100/(o.outputs.length+1)}%`},children:e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[10px] text-muted-foreground pointer-events-none whitespace-nowrap",children:p.label})},`output-${p.id}`))]}):e.jsxs("div",{className:"p-4 border-2 border-destructive bg-destructive/10 rounded-md min-w-[150px]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(xt,{size:16}),e.jsx("span",{className:"text-sm font-bold",children:"Unknown Node"})]}),e.jsxs("div",{className:"text-xs mt-1",children:["Type: ",i]})]})}),zf=({id:t,sourceX:r,sourceY:a,targetX:i,targetY:o,sourcePosition:l,targetPosition:c,style:m={},markerEnd:u})=>{const{deleteElements:h}=Ko(),[p,g,b]=Gx({sourceX:r,sourceY:a,sourcePosition:l,targetX:i,targetY:o,targetPosition:c,borderRadius:24}),y=j=>{j.stopPropagation(),h({edges:[{id:t}]})};return e.jsxs(e.Fragment,{children:[e.jsx(Td,{path:p,style:{strokeWidth:20,stroke:"transparent",cursor:"pointer"}}),e.jsx(Td,{path:p,markerEnd:u,style:{...m,strokeWidth:2},className:"react-flow__edge-path"}),e.jsx(Kx,{children:e.jsx("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${g}px,${b}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan",children:e.jsx("button",{className:"w-5 h-5 bg-background border border-border text-muted-foreground rounded-full flex items-center justify-center hover:bg-destructive hover:text-destructive-foreground transition-colors shadow-sm",onClick:y,title:"Remove Connection",children:e.jsx(et,{size:10})})})})]})},Ff={custom:Of},Bf={custom:zf},$f=()=>{const t=f.useRef(null),{screenToFlowPosition:r}=Ko(),{nodes:a,edges:i,onNodesChange:o,onEdgesChange:l,onConnect:c,addNode:m,executionResult:u}=je(If(b=>({nodes:b.nodes,edges:b.edges,onNodesChange:b.onNodesChange,onEdgesChange:b.onEdgesChange,onConnect:b.onConnect,addNode:b.addNode,executionResult:b.executionResult}))),{isResultsPanelExpanded:h}=ha(),p=f.useCallback(b=>{b.preventDefault(),b.dataTransfer.dropEffect="move"},[]),g=f.useCallback(b=>{b.preventDefault();const y=b.dataTransfer.getData("application/reactflow");if(typeof y>"u"||!y)return;const j=r({x:b.clientX,y:b.clientY});m(y,j)},[r,m]);return e.jsx("div",{className:"w-full h-full outline-none",ref:t,tabIndex:0,children:e.jsxs(Jo,{nodes:a,edges:i,onNodesChange:o,onEdgesChange:l,onConnect:c,nodeTypes:Ff,onDragOver:p,onDrop:g,fitView:!0,proOptions:{hideAttribution:!0},defaultEdgeOptions:{type:"custom",style:{stroke:"url(#edge-gradient)",strokeWidth:3,strokeDasharray:"8 6",filter:"url(#glow)"},animated:!0},edgeTypes:Bf,deleteKeyCode:["Backspace","Delete"],children:[e.jsx("svg",{style:{position:"absolute",top:0,left:0,width:0,height:0,pointerEvents:"none"},children:e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"edge-gradient",children:[e.jsx("stop",{offset:"0%",stopColor:"#38bdf8"}),e.jsx("stop",{offset:"50%",stopColor:"#6366f1"}),e.jsx("stop",{offset:"100%",stopColor:"#a855f7"})]}),e.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]})}),e.jsx(Qo,{}),e.jsx(Yo,{position:"bottom-left",style:u&&!h?{marginBottom:"40px",transition:"margin-bottom 0.3s ease-in-out"}:{transition:"margin-bottom 0.3s ease-in-out"}})]})})},Zf=()=>e.jsx(Jx,{children:e.jsx($f,{})}),Uf=()=>{const t=je(c=>c.nodes),{isSidebarOpen:r,isPropertiesPanelExpanded:a,setPropertiesPanelExpanded:i}=ha(),o=t.find(c=>c.selected);ft.useEffect(()=>{o||i(!1)},[o,i]);const l=r?"w-[calc(100vw-300px)]":"w-[calc(100vw-50px)]";return e.jsx("aside",{className:`border-l bg-background shrink-0 transition-all duration-300 ease-in-out overflow-hidden ${o?a?`${l} opacity-100`:"w-80 opacity-100":"w-0 opacity-0"}`,children:o&&e.jsx(Hf,{selectedNode:o,isExpanded:a,toggleExpand:()=>i(!a)})})},Hf=({selectedNode:t,isExpanded:r,toggleExpand:a})=>{const i=je(h=>h.updateNodeData),o=je(h=>h.onNodesChange),l=()=>{o([{id:t.id,type:"select",selected:!1}])},c=t.data.definitionType,m=Te.get(c);if(!m)return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-destructive flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Error: Node definition '",c,"' not found."]})});const u=m.settings;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-primary/10 rounded-md",children:e.jsx(Hn,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-sm",children:String(t.data.label||m.label)}),e.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",t.id]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:a,className:"p-1.5 hover:bg-accent rounded-md text-muted-foreground hover:text-foreground transition-colors",children:r?e.jsx(hx,{className:"w-4 h-4"}):e.jsx(xx,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l,className:"p-1.5 hover:bg-accent rounded-md text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(et,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"space-y-6",children:e.jsx(u,{config:t.data,onChange:h=>i(t.id,h),nodeId:t.id})})})]})},Wf=3e3,Us=50,xa=ll((t,r)=>{let a=null;return{jobs:[],isLoading:!1,isDrawerOpen:!1,activeTab:"basic_training",hasMore:!0,skip:0,fetchJobs:async()=>{t({isLoading:!0,skip:0});try{const i=await Ge.getJobs(Us,0);t({jobs:i,isLoading:!1,hasMore:i.length===Us})}catch(i){console.error("Failed to fetch jobs:",i),t({isLoading:!1})}},loadMoreJobs:async()=>{const{skip:i,jobs:o,isLoading:l,hasMore:c}=r();if(l||!c)return;const m=i+Us;t({isLoading:!0});try{const u=await Ge.getJobs(Us,m);t({jobs:[...o,...u],isLoading:!1,skip:m,hasMore:u.length===Us})}catch(u){console.error("Failed to load more jobs:",u),t({isLoading:!1})}},submitJob:async i=>{try{const o=await Ge.runPipeline(i);return await r().fetchJobs(),r().startPolling(),o.job_id}catch(o){throw console.error("Failed to submit job:",o),o}},cancelJob:async i=>{try{await Ge.cancelJob(i),await r().fetchJobs()}catch(o){throw console.error("Failed to cancel job:",o),o}},toggleDrawer:i=>{const o=r().isDrawerOpen,l=i!==void 0?i:!o;t({isDrawerOpen:l}),l?(r().fetchJobs(),r().startPolling()):r().jobs.some(m=>m.status==="running"||m.status==="queued")||r().stopPolling()},setTab:i=>t({activeTab:i}),startPolling:()=>{a||(a=setInterval(()=>{(async()=>{try{const i=await Ge.getJobs(Us,0);t(l=>l.jobs.length<=Us?{jobs:i}:{jobs:[...i,...l.jobs.slice(Us)]}),!i.some(l=>l.status==="running"||l.status==="queued")&&!r().isDrawerOpen&&r().stopPolling()}catch(i){console.error("Polling error:",i)}})()},Wf))},stopPolling:()=>{a&&(clearInterval(a),a=null)}}});var hs=(t=>(t.DATA_LOADER="data_loader",t.FEATURE_ENGINEERING="feature_engineering",t.BASIC_TRAINING="basic_training",t.ADVANCED_TUNING="advanced_tuning",t))(hs||{});const hi=(t,r)=>{const a=[],i=new Set,o=[],l=t.find(m=>m.data.definitionType==="dataset_node"),c=l==null?void 0:l.data.datasetId;for(l&&o.push(l.id);o.length>0;){const m=o.shift();if(!m||i.has(m))continue;i.add(m);const u=t.find(j=>j.id===m);if(!u)continue;let h="unknown",p={};const b=r.filter(j=>j.target===m).map(j=>j.source);if(u.data.definitionType==="dataset_node")h=hs.DATA_LOADER,p={dataset_id:u.data.datasetId};else if(u.data.definitionType==="imputation_node"){const j=u.data.method||"simple";j==="knn"?(h="KNNImputer",p={columns:u.data.columns,n_neighbors:u.data.n_neighbors,weights:u.data.weights}):j==="iterative"?(h="IterativeImputer",p={columns:u.data.columns,max_iter:u.data.max_iter,estimator:u.data.estimator,random_state:0}):(h="SimpleImputer",p={columns:u.data.columns,strategy:u.data.strategy,fill_value:u.data.fill_value})}else if(u.data.definitionType==="simple_imputer")h="SimpleImputer",p=u.data||{};else if(u.data.definitionType==="drop_missing_columns"||u.data.definitionType==="DropMissingColumns")h="DropMissingColumns",p={columns:u.data.columns||[],missing_threshold:u.data.missing_threshold};else if(u.data.definitionType==="drop_missing_rows"||u.data.definitionType==="DropMissingRows")h="DropMissingRows",p={missing_threshold:u.data.missing_threshold,drop_if_any_missing:u.data.drop_if_any_missing};else if(u.data.definitionType==="deduplicate"||u.data.definitionType==="Deduplicate")h="Deduplicate",p={subset:u.data.subset,keep:u.data.keep};else if(u.data.definitionType==="casting"||u.data.definitionType==="Casting")h="Casting",p={column_types:u.data.column_types};else if(u.data.definitionType==="MissingIndicator"||u.data.definitionType==="missing_indicator")h="MissingIndicator",p={columns:u.data.columns,flag_suffix:u.data.flag_suffix};else if(u.data.definitionType==="scale_numeric_features"){const j=u.data&&typeof u.data=="object"?u.data:{},w=j.method||"standard";w==="minmax"?h="MinMaxScaler":w==="maxabs"?h="MaxAbsScaler":w==="robust"?h="RobustScaler":h="StandardScaler",p=j}else if(u.data.definitionType==="encoding"){const j=u.data.method;j==="onehot"?h="OneHotEncoder":j==="dummy"?(h="DummyEncoder",p={...u.data,drop_first:!0}):j==="label"?h="LabelEncoder":j==="ordinal"?h="OrdinalEncoder":j==="target"?h="TargetEncoder":j==="hash"?h="HashEncoder":h="OneHotEncoder",h!=="DummyEncoder"&&(p=u.data)}else if(u.data.definitionType==="TrainTestSplitter")h="TrainTestSplitter",p=u.data||{};else if(u.data.definitionType==="label_encoding")h="LabelEncoder",p=u.data||{};else if(u.data.definitionType==="feature_target_split")h="feature_target_split",p=u.data||{};else if(u.data.definitionType==="feature_selection")h="feature_selection",p=u.data||{};else if(u.data.definitionType==="outlier"){const j=u.data.method||"iqr";j==="iqr"?h="IQR":j==="zscore"?h="ZScore":j==="winsorize"?h="Winsorize":j==="elliptic_envelope"?h="EllipticEnvelope":h="IQR",p=u.data}else if(u.data.definitionType==="TransformationNode"){h="GeneralTransformation";const j=u.data.transformations||[],w=[];for(const N of j){const k=N;if(k.columns&&Array.isArray(k.columns))for(const S of k.columns)w.push({column:S,method:k.method,...k.params})}p={transformations:w}}else u.data.definitionType==="BinningNode"?(h="GeneralBinning",p={columns:u.data.columns,strategy:u.data.strategy,n_bins:u.data.n_bins,label_format:u.data.label_format,output_suffix:u.data.output_suffix,drop_original:u.data.drop_original,custom_bins:u.data.custom_bins,custom_labels:u.data.custom_labels}):u.data.definitionType==="ResamplingNode"?((u.data.type||"oversampling")==="oversampling"?h="Oversampling":h="Undersampling",p=u.data):u.data.definitionType==="FeatureGenerationNode"?(h="FeatureMath",p={operations:u.data.operations}):u.data.definitionType==="PolynomialFeaturesNode"?(h="PolynomialFeatures",p={columns:u.data.columns,degree:u.data.degree,interaction_only:u.data.interaction_only,include_bias:u.data.include_bias,output_prefix:u.data.output_prefix,include_input_features:u.data.include_input_features}):u.data.definitionType==="TextCleaning"?(h="TextCleaning",p=u.data):u.data.definitionType==="ValueReplacement"?(h="ValueReplacement",p=u.data):u.data.definitionType==="AliasReplacement"?(h="AliasReplacement",p=u.data):u.data.definitionType==="InvalidValueReplacement"?(h="InvalidValueReplacement",p=u.data):u.data.definitionType==="model_training"||u.data.definitionType===hs.BASIC_TRAINING?(h=hs.BASIC_TRAINING,p={target_column:u.data.target_column,model_type:u.data.model_type,hyperparameters:u.data.hyperparameters,cv_enabled:u.data.cv_enabled,cv_folds:u.data.cv_folds,cv_type:u.data.cv_type,cv_shuffle:u.data.cv_shuffle,cv_random_state:u.data.cv_random_state}):u.data.definitionType==="hyperparameter_tuning"||u.data.definitionType===hs.ADVANCED_TUNING?(h=hs.ADVANCED_TUNING,p={target_column:u.data.target_column,algorithm:u.data.model_type,tuning_config:{strategy:u.data.search_strategy,metric:u.data.metric,n_trials:u.data.n_trials,search_space:u.data.search_space,cv_enabled:u.data.cv_enabled,cv_folds:u.data.cv_folds,cv_type:u.data.cv_type,cv_shuffle:u.data.cv_shuffle,cv_random_state:u.data.cv_random_state,random_state:u.data.random_state}}):u.data.definitionType==="data_preview"?(h="data_preview",p={}):(console.warn(`Unknown node type: ${u.data.definitionType}`),h="Unknown",p=u.data&&typeof u.data=="object"?u.data:{});a.push({node_id:u.id,step_type:h,params:p,inputs:b}),r.filter(j=>j.source===m).forEach(j=>o.push(j.target))}return{pipeline_id:`preview_${Tu()}`,nodes:a,metadata:{dataset_source_id:c}}},Vf=()=>{const t=je(w=>w.nodes),r=je(w=>w.edges),a=je(w=>w.setExecutionResult),i=je(w=>w.setGraph),{toggleDrawer:o}=xa(),[l,c]=f.useState(!1),[m,u]=f.useState(!1),[h,p]=f.useState(!1),g=()=>({nodes:t.map(w=>({id:w.id,type:w.type,position:w.position,data:{...w.data,catalogType:w.data.catalogType||w.data.definitionType}})),edges:r.map(w=>({id:w.id,source:w.source,target:w.target,sourceHandle:w.sourceHandle,targetHandle:w.targetHandle,type:w.type,data:w.data}))}),b=async()=>{const w=t.find(k=>k.data.definitionType==="dataset_node"),N=w==null?void 0:w.data.datasetId;if(!N){alert("No dataset node found! Cannot save pipeline without a dataset context.");return}u(!0);try{await ff(N,{name:"My Pipeline",description:"Saved from Canvas",graph:g()}),alert("Pipeline saved successfully!")}catch(k){console.error("Save failed:",k),alert("Failed to save pipeline.")}finally{u(!1)}},y=async()=>{const w=t.find(k=>k.data.definitionType==="dataset_node"),N=w==null?void 0:w.data.datasetId;if(!N){alert("No dataset node found! Cannot load pipeline without a dataset context.");return}if(confirm("Loading a pipeline will overwrite your current work. Continue?")){p(!0);try{const k=await gf(N);if(k){const S=Array.isArray(k.graph.nodes)?k.graph.nodes:[],P=Array.isArray(k.graph.edges)?k.graph.edges:[];i(S,P),alert("Pipeline loaded successfully!")}else alert("No saved pipeline found for this dataset.")}catch(k){console.error("Load failed:",k),alert("Failed to load pipeline.")}finally{p(!1)}}},j=async()=>{const w=t.find(k=>k.data.definitionType==="dataset_node");if(!(w==null?void 0:w.data.datasetId)){alert("No dataset node found!");return}c(!0),a(null);try{const k=hi(t,r),S=await xf(k);a(S)}catch(k){console.error("Pipeline failed:",k),alert("Pipeline execution failed. Check console for details.")}finally{c(!1)}};return e.jsxs("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[e.jsxs("button",{onClick:()=>o(),className:"flex items-center gap-2 px-4 py-2 bg-background border rounded-md shadow-sm hover:bg-accent transition-colors",children:[e.jsx(px,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Jobs"})]}),e.jsxs("button",{onClick:()=>{y()},disabled:h||l,className:"flex items-center gap-2 px-4 py-2 bg-background border rounded-md shadow-sm hover:bg-accent transition-colors disabled:opacity-50",children:[h?e.jsx(Ye,{className:"w-4 h-4 animate-spin"}):e.jsx(fx,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:h?"Loading...":"Load"})]}),e.jsxs("button",{onClick:()=>{b()},disabled:m||l,className:"flex items-center gap-2 px-4 py-2 bg-background border rounded-md shadow-sm hover:bg-accent transition-colors disabled:opacity-50",children:[m?e.jsx(Ye,{className:"w-4 h-4 animate-spin"}):e.jsx(gx,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:m?"Saving...":"Save"})]}),e.jsxs("button",{onClick:()=>{j()},disabled:l,className:"flex items-center gap-2 px-4 py-2 text-white rounded-md shadow-sm transition-all disabled:opacity-50",style:{background:"var(--main-gradient)"},children:[l?e.jsx(Ye,{className:"w-4 h-4 animate-spin"}):e.jsx(Zt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:l?"Running...":"Run Preview"})]})]})},qf=()=>{var y;const t=je(j=>j.executionResult),{isResultsPanelExpanded:r,setResultsPanelExpanded:a}=ha(),[i,o]=f.useState(null),l=f.useMemo(()=>{const j=t==null?void 0:t.preview_data;return j?Array.isArray(j)?{Result:j}:typeof j=="object"?j:{}:{}},[t]),c=Object.keys(l);if(ft.useEffect(()=>{c.length>0&&(!i||!c.includes(i))&&(c.includes("train")?o("train"):c.includes("X")?o("X"):o(c[0]))},[c,i]),!t)return null;const m=i&&l[i]?l[i]:[],u=m.length>0?Object.keys(m[0]??{}):[],h=t.node_results?Object.keys(t.node_results):[],p=t.node_results||{},g=Object.keys(p).find(j=>{const w=p[j];return(w==null?void 0:w.status)==="failed"}),b=g?(y=p[g])==null?void 0:y.error:null;return e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-background border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] transition-all duration-300 z-20 flex flex-col ${r?"h-96":"h-10"}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-muted/10 cursor-pointer hover:bg-muted/20 border-b select-none",onClick:()=>a(!r),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wo,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-sm",children:"Preview Results"}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:[m.length," rows shown"]}),t.status==="failed"&&e.jsx("span",{className:"text-xs text-red-600 font-bold ml-2",children:"(Failed)"})]}),e.jsx("button",{className:"p-1 hover:bg-muted rounded",children:r?e.jsx(De,{className:"w-4 h-4"}):e.jsx(Ms,{className:"w-4 h-4"})})]}),r&&e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[t.status==="failed"&&e.jsxs("div",{className:"p-4 bg-red-50 border-b text-red-800 text-sm overflow-auto max-h-32",children:[e.jsx("div",{className:"font-bold mb-1",children:"Pipeline Execution Failed"}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:b||"Unknown error occurred during execution."})]}),c.length>1&&e.jsxs("div",{className:"flex items-center gap-1 px-2 pt-2 border-b bg-muted/5",children:[e.jsx(bx,{className:"w-3 h-3 text-muted-foreground mr-1"}),c.map(j=>e.jsx("button",{onClick:()=>{o(j)},className:`px-3 py-1 text-xs font-medium rounded-t-md border-t border-l border-r transition-colors ${i===j?"bg-background text-primary border-b-background translate-y-[1px]":"bg-muted/30 text-muted-foreground hover:bg-muted/50 border-transparent"}`,children:j},j))]}),h.length>0&&t.status!=="failed"&&e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-950/20 border-b dark:border-blue-900/30 flex gap-2 overflow-x-auto",children:h.map((j,w)=>e.jsx("div",{className:"text-xs text-blue-800 dark:text-blue-200 bg-blue-100 dark:bg-blue-900/40 px-2 py-1 rounded border border-blue-200 dark:border-blue-800 whitespace-nowrap",children:j},w))}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsxs("table",{className:"w-full text-sm text-left border-collapse",children:[e.jsx("thead",{className:"text-xs text-muted-foreground uppercase bg-muted sticky top-0 z-10 shadow-sm",children:e.jsx("tr",{children:u.map(j=>e.jsx("th",{className:"px-4 py-2 font-medium border-b whitespace-nowrap",children:j},j))})}),e.jsx("tbody",{children:m.map((j,w)=>e.jsx("tr",{className:"border-b hover:bg-muted/10",children:u.map(N=>e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-mono text-xs",children:j[N]!==null?String(j[N]):e.jsx("span",{className:"text-muted-foreground italic",children:"null"})},`${w}-${N}`))},w))})]}),m.length===0&&e.jsxs("div",{className:"flex items-center justify-center h-32 text-muted-foreground text-sm",children:["No preview data available ",i?`for ${i}`:""]})]})]})]})},Gf=()=>{const{activeView:t,setView:r}=ha();return e.jsx("div",{className:"h-14 border-b bg-card px-4 flex items-center justify-center shrink-0 relative",children:e.jsxs("div",{className:"flex items-center gap-1 bg-secondary/50 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>r("canvas"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${t==="canvas"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"}`,children:[e.jsx(Fa,{className:"w-4 h-4"}),"Canvas"]}),e.jsxs("button",{onClick:()=>r("experiments"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${t==="experiments"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"}`,children:[e.jsx(gs,{className:"w-4 h-4"}),"Experiments"]}),e.jsxs("button",{onClick:()=>r("inference"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${t==="inference"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"}`,children:[e.jsx(oi,{className:"w-4 h-4"}),"Inference"]})]})})},Kf=()=>{const{isDrawerOpen:t,toggleDrawer:r,jobs:a,isLoading:i,activeTab:o,setTab:l,fetchJobs:c,hasMore:m,loadMoreJobs:u}=xa(),[h,p]=f.useState(null);if(!t)return null;const g=a.filter(b=>b.job_type===o);return e.jsxs("div",{className:"fixed inset-0 z-50 flex justify-center items-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>r(!1)}),e.jsx("div",{className:"relative w-[900px] h-[85vh] bg-white dark:bg-gray-800 shadow-2xl rounded-lg flex flex-col border border-gray-200 dark:border-gray-700 overflow-hidden transition-all",children:h?e.jsx(Jf,{job:h,onBack:()=>{p(null)},onClose:()=>r(!1)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Job History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(),className:`p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 ${i?"animate-spin":""}`,title:"Refresh",children:e.jsx(_t,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(!1),className:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",children:e.jsx(et,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{className:`flex-1 py-3 text-sm font-medium border-b-2 transition-colors ${o==="advanced_tuning"?"border-purple-500 text-purple-600 dark:text-purple-400 bg-purple-50/50 dark:bg-purple-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>l("advanced_tuning"),children:"Model Optimization"}),e.jsx("button",{className:`flex-1 py-3 text-sm font-medium border-b-2 transition-colors ${o==="basic_training"?"border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>l("basic_training"),children:"Standard Training"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-2 bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Dataset / Model"}),e.jsx("div",{className:"col-span-3",children:"Job ID"}),e.jsx("div",{className:"col-span-2",children:"Started"}),e.jsx("div",{className:"col-span-1",children:"Duration"}),e.jsx("div",{className:"col-span-1",children:"Ready"}),e.jsx("div",{className:"col-span-1",children:"Result"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 bg-gray-50/30 dark:bg-gray-900/30",children:g.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-400 dark:text-gray-500 text-sm",children:["No ",o==="advanced_tuning"?"optimization":"training"," jobs found."]}):e.jsxs(e.Fragment,{children:[g.map(b=>e.jsx(Qf,{job:b,onClick:()=>{p(b)}},b.job_id)),m&&e.jsx("div",{className:"flex justify-center pt-2 pb-4",children:e.jsxs("button",{onClick:()=>u(),disabled:i,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50 flex items-center gap-1",children:[i?e.jsx(_t,{className:"w-3 h-3 animate-spin"}):e.jsx(De,{className:"w-3 h-3"}),"Load More History"]})})]})})]})})]})},Jf=({job:t,onBack:r,onClose:a})=>{const{cancelJob:i}=xa(),[o,l]=f.useState(t),[c,m]=f.useState("overview"),[u,h]=f.useState(!1),p=f.useRef(null);f.useEffect(()=>{let b;const y=async()=>{try{const j=await Ge.getJob(t.job_id);l(j)}catch(j){console.error("Failed to fetch job details",j)}};return y(),(o.status==="running"||o.status==="queued")&&(b=setInterval(()=>{y()},2e3)),()=>{b&&clearInterval(b)}},[t.job_id,o.status]),f.useEffect(()=>{c==="logs"&&p.current&&p.current.scrollIntoView({behavior:"smooth"})},[o.logs,c]);const g=async()=>{if(confirm("Are you sure you want to stop this job?")){h(!0);try{await i(o.job_id)}catch{alert("Failed to cancel job")}finally{h(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-500",children:e.jsx(Uc,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsxs("h2",{className:"font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:["Job Details",e.jsx("span",{className:"text-xs font-normal text-gray-500 font-mono bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded",children:o.job_id.slice(0,8)})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(o.status==="running"||o.status==="queued")&&e.jsxs("button",{onClick:()=>{g()},disabled:u,className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/40 rounded text-xs font-medium transition-colors border border-red-200 dark:border-red-800",children:[e.jsx(yx,{className:"w-3 h-3 fill-current"}),u?"Stopping...":"Stop Job"]}),e.jsx("button",{onClick:a,className:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",children:e.jsx(et,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 px-4",children:[e.jsxs("button",{className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors flex items-center gap-2 ${c==="overview"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>{m("overview")},children:[e.jsx(Uo,{className:"w-4 h-4"}),"Overview"]}),e.jsxs("button",{className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors flex items-center gap-2 ${c==="logs"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,onClick:()=>{m("logs")},children:[e.jsx(Cr,{className:"w-4 h-4"}),"Live Logs",o.status==="running"&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c==="overview"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Status"}),e.jsx("div",{className:"font-medium capitalize flex items-center gap-2 text-gray-800 dark:text-gray-200",children:o.status})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Dataset"}),e.jsxs("div",{className:"font-medium text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(bt,{className:"w-3 h-3 text-gray-400"}),o.dataset_name||o.dataset_id||"Unknown"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Duration"}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200 font-mono",children:o.start_time&&o.end_time?`${Math.round((new Date(o.end_time).getTime()-new Date(o.start_time).getTime())/1e3)}s`:"-"})]})]}),o.error&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 rounded-lg",children:[e.jsxs("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300 mb-2 flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"Error Log"]}),e.jsx("pre",{className:"text-xs text-red-700 dark:text-red-400 whitespace-pre-wrap font-mono",children:o.error})]}),o.result&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(vx,{className:"w-4 h-4"}),"Execution Results"]}),o.status==="completed"&&e.jsxs("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1 border border-green-200 dark:border-green-800 font-medium",children:[e.jsx(rt,{className:"w-3 h-3"})," Model Ready"]})]}),o.job_type==="basic_training"&&!!o.result.metrics&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:Object.entries(o.result.metrics).map(([b,y])=>e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 capitalize",children:b.replace(/_/g," ")}),e.jsx("div",{className:"font-mono font-medium text-blue-600 dark:text-blue-400",children:typeof y=="number"?y.toFixed(4):String(y)})]},b))}),o.job_type==="advanced_tuning"&&e.jsxs("div",{className:"space-y-4",children:[o.graph&&e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Tuning Configuration"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-xs",children:(()=>{var j,w,N;const b=(w=(j=o.graph)==null?void 0:j.nodes)==null?void 0:w.find(k=>k.node_id===o.node_id),y=(N=b==null?void 0:b.params)==null?void 0:N.tuning_config;return y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Strategy:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300 capitalize",children:y.strategy})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Metric:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.metric})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Trials:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.n_trials})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"CV Enabled:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.cv_enabled?"Yes":"No"})]}),y.cv_enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Folds:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.cv_folds})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Shuffle:"}),e.jsx("span",{className:"ml-2 font-mono text-gray-700 dark:text-gray-300",children:y.cv_shuffle?"Yes":"No"})]})]})]}):e.jsx("div",{className:"text-gray-400 col-span-2",children:"No configuration found"})})()})]}),o.result.best_score!==void 0&&e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg w-fit",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Best Score"}),e.jsx("div",{className:"font-mono font-bold text-lg text-purple-600 dark:text-purple-400",children:Number(o.result.best_score).toFixed(4)})]}),!!o.result.metrics&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Evaluation Metrics"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:Object.entries(o.result.metrics).filter(([b])=>!["best_score","best_params","trials"].includes(b)).map(([b,y])=>e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 capitalize",children:b.replace(/_/g," ")}),e.jsx("div",{className:"font-mono font-medium text-blue-600 dark:text-blue-400",children:typeof y=="number"?y.toFixed(4):String(y)})]},b))})]}),!!o.result.best_params&&e.jsxs("div",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg font-mono text-xs overflow-x-auto",children:[e.jsx("div",{className:"text-gray-500 mb-2",children:"# Best Hyperparameters"}),e.jsx("pre",{children:JSON.stringify(o.result.best_params,null,2)})]})]})]})]}):e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 min-h-[400px] font-mono text-xs text-gray-300 overflow-x-auto",children:[o.logs&&o.logs.length>0?o.logs.map((b,y)=>e.jsx("div",{className:"mb-1 border-b border-gray-800 pb-1 last:border-0",children:b},y)):e.jsx("div",{className:"text-gray-500 italic",children:"No logs available yet..."}),e.jsx("div",{ref:p})]})})]})},Qf=({job:t,onClick:r})=>{const a=c=>{switch(c){case"completed":case"succeeded":return e.jsx(rt,{className:"w-4 h-4 text-green-500 dark:text-green-400"});case"failed":return e.jsx(xt,{className:"w-4 h-4 text-red-500 dark:text-red-400"});case"running":return e.jsx(_t,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 animate-spin"});default:return e.jsx(Qt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})}},i=c=>{switch(c){case"completed":return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50";case"failed":return"bg-red-50/30 dark:bg-red-900/10 border-red-100 dark:border-red-900/30 hover:bg-red-50/50 dark:hover:bg-red-900/20";case"running":return"bg-blue-50/30 dark:bg-blue-900/10 border-blue-100 dark:border-blue-900/30 hover:bg-blue-50/50 dark:hover:bg-blue-900/20";default:return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}},o=c=>c?new Date(c).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",l=(c,m)=>{if(!c||!m)return"-";const u=new Date(m).getTime()-new Date(c).getTime(),h=Math.floor(u/1e3);return h<60?`${h}s`:`${Math.floor(h/60)}m ${h%60}s`};return e.jsxs("div",{onClick:r,className:`grid grid-cols-12 gap-4 p-3 rounded-lg border text-sm items-center transition-colors cursor-pointer ${i(t.status)}`,children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[a(t.status),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300 capitalize truncate",children:t.status})]}),e.jsxs("div",{className:"col-span-2 flex flex-col justify-center text-xs text-gray-600 dark:text-gray-400 truncate",children:[e.jsxs("div",{className:"flex items-center gap-1",title:t.dataset_name||t.dataset_id,children:[e.jsx(bt,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:t.dataset_name||t.dataset_id||"-"})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5 text-[10px] text-gray-500",children:[e.jsx("span",{className:"font-medium truncate",children:t.model_type||"Unknown Model"}),t.job_type==="advanced_tuning"&&t.search_strategy&&e.jsxs("span",{className:"text-gray-400 truncate",children:["(",t.search_strategy,")"]})]})]}),e.jsx("div",{className:"col-span-3 font-mono text-xs text-gray-500 dark:text-gray-400 break-all",title:t.job_id,children:t.job_id}),e.jsx("div",{className:"col-span-2 text-gray-600 dark:text-gray-400 text-xs",children:o(t.start_time)}),e.jsx("div",{className:"col-span-1 text-gray-600 dark:text-gray-400 text-xs font-mono",children:l(t.start_time,t.end_time)}),e.jsx("div",{className:"col-span-1",children:t.status==="completed"&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1 border border-green-200 dark:border-green-800 w-fit",children:e.jsx(rt,{className:"w-3 h-3"})})}),e.jsx("div",{className:"col-span-1",children:t.error?e.jsx("span",{className:"text-red-600 dark:text-red-400 text-xs truncate block",title:t.error,children:"Error"}):t.status==="completed"&&t.result?t.job_type==="basic_training"&&t.result.metrics?e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(t.result.metrics).slice(0,1).map(([c,m])=>e.jsxs("span",{className:"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-600 truncate max-w-full",children:[c,": ",Number(m).toFixed(3)]},c))}):t.job_type==="advanced_tuning"?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.result.best_score!==void 0&&e.jsxs("span",{className:"text-[10px] bg-purple-50 dark:bg-purple-900/20 px-1.5 py-0.5 rounded text-purple-700 dark:text-purple-300 border border-purple-200 dark:border-purple-800 truncate",children:["Score: ",Number(t.result.best_score).toFixed(4)]}),!t.result.best_score&&!!t.result.best_params&&e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 truncate",children:"Params found"})]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})})]})},sr={deployModel:async t=>(await Oe.post(`/deployment/deploy/${t}`)).data,getActive:async()=>{try{return(await Oe.get("/deployment/active")).data}catch(t){const r=t;if(r.response&&r.response.status===404)return null;throw t}},getHistory:async(t=50,r=0)=>(await Oe.get("/deployment/history",{params:{limit:t,skip:r}})).data,deactivate:async()=>{await Oe.post("/deployment/deactivate")},predict:async t=>(await Oe.post("/deployment/predict",{data:t})).data},Yf=()=>{var be,Se,Ve,as;const{jobs:t,fetchJobs:r,hasMore:a,loadMoreJobs:i,isLoading:o}=xa(),[l,c]=f.useState([]),[m,u]=f.useState("all"),[h,p]=f.useState([]),[g,b]=f.useState("all"),[y,j]=f.useState(null),[w,N]=f.useState(!1),[k,S]=f.useState(!0),[P,E]=f.useState(!0),[T,D]=f.useState(!0),[R,_]=f.useState(!0),[M,I]=f.useState(!0),[O,F]=f.useState(!0),[B,q]=f.useState("charts"),[G,ee]=f.useState(null),[te,W]=f.useState(!1),[me,se]=f.useState(null),[ie,ge]=f.useState(null),[U,V]=f.useState(null);f.useEffect(()=>{r(),Y()},[r]),f.useEffect(()=>{var $,X,oe;if((X=($=G==null?void 0:G.splits.train)==null?void 0:$.y_proba)!=null&&X.classes&&G.splits.train.y_proba.classes.length>0){const re=G.splits.train.y_proba,he=((oe=re.labels)==null?void 0:oe[0])??re.classes[0];V(String(he))}},[G]);const Y=async()=>{try{const $=await Oe.get("/pipeline/datasets/list");p($.data)}catch($){console.error("Failed to fetch datasets",$)}},Q=async($,X)=>{if($.stopPropagation(),!!confirm("Are you sure you want to deploy this model to production?"))try{await sr.deployModel(X),alert("Model deployed successfully!")}catch(oe){alert("Failed to deploy model"),console.error(oe)}},ce=async($,X)=>{const oe=document.getElementById($);if(!oe)return;const he=document.documentElement.classList.contains("dark")?"#1f2937":"#ffffff";try{const Re=await Vo(oe,{backgroundColor:he}),dt=document.createElement("a");dt.download=`${X}.png`,dt.href=Re.toDataURL("image/png"),dt.click()}catch(Re){console.error("Failed to download image",Re)}},pe=async $=>{var X,oe;W(!0),ee(null),se(null),ge($);try{const re=await Oe.get(`/pipeline/jobs/${$}/evaluation`);ee(re.data)}catch(re){console.error("Failed to fetch evaluation data",re),se(((oe=(X=re.response)==null?void 0:X.data)==null?void 0:oe.detail)||"Failed to fetch evaluation data")}finally{W(!1)}},$e=($,X,oe)=>{const re=oe&&oe.length>0?[...oe]:Array.from(new Set([...$,...X])).sort((Re,dt)=>String(Re).localeCompare(String(dt))),he=re.map(Re=>re.map(dt=>$.reduce((at,Et,Ke)=>{const nt=X[Ke];return String(Et)===String(Re)&&String(nt)===String(dt)?at+1:at},0)));return{classes:re,matrix:he}},We=($,X,oe)=>{const re=String(oe),Re=((X.labels&&X.labels.length===X.classes.length?X.labels:void 0)??X.classes).findIndex(it=>String(it)===re);if(Re===-1)return null;const at=X.values.map(it=>it[Re]).map((it,Fs)=>({score:it,actual:String($[Fs])===re?1:0}));at.sort((it,Fs)=>Fs.score-it.score);const Et=[];let Ke=0,nt=0;const Ht=at.filter(it=>it.actual===1).length,Wt=at.length-Ht;if(Ht===0||Wt===0)return null;Et.push({fpr:0,tpr:0});for(let it=0;it<at.length;it++)at[it].actual===1?Ke++:nt++,Et.push({fpr:nt/Wt,tpr:Ke/Ht});return Et};f.useEffect(()=>{B==="evaluation"&&(!ie&&l.length>0||ie&&!l.includes(ie)&&l.length>0?pe(l[0]):l.length===0&&(ee(null),ge(null)))},[B,l,ie]);const Le=t.filter($=>{const X=m==="all"||$.job_type===m,oe=g==="all"||$.dataset_id===g,re=$.status==="completed";return X&&oe&&re}),xe=t.filter($=>l.includes($.job_id)),Me=$=>{c(X=>X.includes($)?X.filter(oe=>oe!==$):[...X,$])},Ze=xe.map($=>{var oe;const X=$.metrics||((oe=$.result)==null?void 0:oe.metrics)||{};return{name:$.job_id,...X}}),Dt=Array.from(new Set(xe.flatMap($=>{var oe;const X=$.metrics||((oe=$.result)==null?void 0:oe.metrics)||{};return Object.keys(X).filter(re=>{const he=X[re];return typeof he=="number"&&!isNaN(he)})}))).filter($=>!($.startsWith("train_")&&!k||$.startsWith("test_")&&!P||$.startsWith("val_")&&!T)),zs=($,X)=>{if(!$||!X)return"-";const oe=new Date(X).getTime()-new Date($).getTime(),re=Math.floor(oe/1e3);return re<60?`${re}s`:`${Math.floor(re/60)}m ${re%60}s`},rs=$=>$==="best_score"?{type:"val",base:"best_score"}:$.startsWith("train_")?{type:"train",base:$.replace("train_","")}:$.startsWith("test_")?{type:"test",base:$.replace("test_","")}:$.startsWith("val_")?{type:"val",base:$.replace("val_","")}:{type:"other",base:$},Ee=new Map;Dt.forEach($=>{var oe;const{base:X}=rs($);Ee.has(X)||Ee.set(X,[]),(oe=Ee.get(X))==null||oe.push($)}),Ee.forEach(($,X)=>{Ee.set(X,$.sort())});const Lt=Array.from(Ee.keys()).sort(),K=y&&Lt.includes(y)?y:Lt[0]||null;return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Experiments & Comparison"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Compare metrics and parameters across multiple runs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5",value:g,onChange:$=>{b($.target.value)},children:[e.jsx("option",{value:"all",children:"All Datasets"}),h.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))]}),e.jsxs("select",{className:"bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5",value:m,onChange:$=>{u($.target.value)},children:[e.jsx("option",{value:"all",children:"All Experiments"}),e.jsx("option",{value:"advanced_tuning",children:"Model Optimization"}),e.jsx("option",{value:"basic_training",children:"Standard Training"})]})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:`${w?"w-12":"w-80"} border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex flex-col relative`,children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center h-[41px]",children:[!w&&e.jsxs("span",{className:"text-xs font-medium text-gray-500 uppercase truncate",children:["Select Runs (",l.length,")"]}),e.jsx("button",{onClick:()=>N(!w),className:`p-1.5 rounded-lg transition-all duration-200 ${w?"mx-auto text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100":"ml-auto text-gray-600 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700"}`,title:w?"Expand Sidebar":"Collapse Sidebar",children:w?e.jsx(Pt,{className:"w-4 h-4"}):e.jsx(jx,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:[Le.map($=>{var X,oe;return e.jsx("div",{onClick:()=>{Me($.job_id)},className:`border-b border-gray-100 dark:border-gray-700 cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-700 ${l.includes($.job_id)?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"} ${w?"p-2 flex justify-center":"p-3"}`,title:w?`#${$.version} - ${$.job_id}`:void 0,children:w?e.jsx("div",{className:`w-2 h-2 rounded-full ${$.status==="completed"?"bg-green-500":$.status==="failed"?"bg-red-500":"bg-gray-400"}`}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:"font-mono text-xs font-semibold text-gray-700 dark:text-gray-300 break-all",children:["#",$.version," - ",$.job_id]}),e.jsx("div",{className:"flex items-center gap-2",children:$.status==="completed"&&($.job_type==="basic_training"||$.job_type==="advanced_tuning")&&e.jsx("button",{onClick:re=>{Q(re,$.job_id)},className:"p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded text-blue-600 dark:text-blue-400",title:"Deploy to Test",children:e.jsx(oi,{className:"w-3 h-3"})})})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[$.model_type,"  ",$.dataset_name||"Unknown Dataset",$.job_type==="advanced_tuning"&&($.search_strategy||((X=$.config.tuning)==null?void 0:X.strategy))&&e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",$.search_strategy||((oe=$.config.tuning)==null?void 0:oe.strategy),")"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] text-gray-400",children:[e.jsx("span",{children:new Date($.start_time||$.created_at).toLocaleString()}),e.jsx("span",{className:"font-mono bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded text-gray-600 dark:text-gray-300",children:zs($.start_time,$.end_time)})]})]})},$.job_id)}),a&&e.jsx("div",{className:"p-3 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/30",children:e.jsxs("button",{onClick:()=>i(),disabled:o,className:`w-full py-2 text-xs font-medium rounded-lg border shadow-sm transition-all duration-200 flex items-center justify-center gap-2 ${w?"bg-transparent border-transparent text-blue-600 dark:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-800":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-200 hover:border-blue-400 dark:hover:border-blue-500 hover:text-blue-600 dark:hover:text-blue-400"} disabled:opacity-50 disabled:cursor-not-allowed`,title:"Load More Runs",children:[o?e.jsx(_t,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(De,{className:"w-3.5 h-3.5"}),!w&&"Load More Runs"]})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:xe.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx(Hc,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"Select runs from the sidebar to compare them."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${B==="charts"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{q("charts")},children:"Visual Comparison"}),e.jsx("button",{className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${B==="table"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{q("table")},children:"Detailed Metrics & Params"}),e.jsx("button",{className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${B==="evaluation"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{q("evaluation")},children:"Model Evaluation"})]}),B==="charts"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Metrics Comparison"}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:$=>{S($.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Train"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:$=>{E($.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Test"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:$=>{D($.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Validation"})]})]})]}),Lt.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 border-b border-gray-200 dark:border-gray-700 pb-2",children:Lt.map($=>e.jsx("button",{onClick:()=>{j($)},className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${K===$?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:$.toUpperCase()},$))}),K&&Ee.has(K)&&e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"h-[300px] w-full",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:Ze,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ct,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),e.jsx(St,{dataKey:"name",stroke:"#6B7280",fontSize:12}),e.jsx(Tt,{stroke:"#6B7280",fontSize:12}),e.jsx(pt,{shared:!1,cursor:{fill:"rgba(107, 114, 128, 0.1)"},contentStyle:{backgroundColor:"#1F2937",borderColor:"#374151",color:"#F3F4F6"},itemStyle:{color:"#F3F4F6"}}),e.jsx(en,{}),(be=Ee.get(K))==null?void 0:be.map($=>{const{type:X}=rs($);let oe="#8884d8";return X==="train"&&(oe="#3b82f6"),X==="test"&&(oe="#22c55e"),X==="val"&&(oe="#f97316"),X==="other"&&(oe="#a855f7"),e.jsx(Mt,{dataKey:$,fill:oe,name:`${X} (${K})`},$)})]})})})})]}),B==="table"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden animate-in fade-in duration-300",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Detailed Comparison"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-900/50 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Parameter / Metric"}),xe.map($=>e.jsx("th",{className:"px-4 py-2 font-mono break-all min-w-[100px]",children:$.job_id},$.job_id))]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsxs("tr",{className:"bg-white dark:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-2 font-medium text-gray-900 dark:text-gray-100",children:"Model Type"}),xe.map($=>e.jsx("td",{className:"px-4 py-2 text-gray-500 dark:text-gray-400",children:$.model_type},$.job_id))]}),e.jsx("tr",{className:"bg-gray-50/50 dark:bg-gray-900/20 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors",onClick:()=>{_(!R)},children:e.jsxs("td",{className:"px-4 py-2 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",colSpan:xe.length+1,children:[R?e.jsx(De,{className:"w-3 h-3"}):e.jsx(Pt,{className:"w-3 h-3"}),"Key Metrics"]})}),R&&Dt.map($=>e.jsxs("tr",{className:"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-1.5 text-gray-500 dark:text-gray-400 pl-8",children:$}),xe.map(X=>{var he;const re=(X.metrics||((he=X.result)==null?void 0:he.metrics)||{})[$];return e.jsx("td",{className:"px-4 py-1.5 font-mono text-gray-600 dark:text-gray-300",children:typeof re=="number"?re.toFixed(4):"-"},X.job_id)})]},$)),e.jsx("tr",{className:"bg-gray-50/50 dark:bg-gray-900/20 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors",onClick:()=>{I(!M)},children:e.jsxs("td",{className:"px-4 py-2 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",colSpan:xe.length+1,children:[M?e.jsx(De,{className:"w-3 h-3"}):e.jsx(Pt,{className:"w-3 h-3"}),"Hyperparameters"]})}),M&&Array.from(new Set(xe.flatMap($=>Object.keys($.hyperparameters||{})))).map($=>e.jsxs("tr",{className:"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-1.5 text-gray-500 dark:text-gray-400 pl-8",children:$}),xe.map(X=>{var oe,re,he;return e.jsx("td",{className:"px-4 py-1.5 font-mono text-gray-600 dark:text-gray-300",children:typeof((oe=X.hyperparameters)==null?void 0:oe[$])=="object"?JSON.stringify((re=X.hyperparameters)==null?void 0:re[$]):String(((he=X.hyperparameters)==null?void 0:he[$])??"-")},X.job_id)})]},$)),xe.some($=>$.job_type==="advanced_tuning")&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:"bg-gray-50/50 dark:bg-gray-900/20 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors",onClick:()=>{F(!O)},children:e.jsxs("td",{className:"px-4 py-2 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",colSpan:xe.length+1,children:[O?e.jsx(De,{className:"w-3 h-3"}):e.jsx(Pt,{className:"w-3 h-3"}),"Tuning Configuration"]})}),O&&e.jsx(e.Fragment,{children:["Strategy","Metric","Trials","CV Enabled","Folds","Shuffle"].map($=>e.jsxs("tr",{className:"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-1.5 text-gray-500 dark:text-gray-400 pl-8",children:$}),xe.map(X=>{var Re,dt,at;if(X.job_type!=="advanced_tuning")return e.jsx("td",{className:"px-4 py-1.5 text-gray-400",children:"-"},X.job_id);const oe=(dt=(Re=X.graph)==null?void 0:Re.nodes)==null?void 0:dt.find(Et=>Et.node_id===X.node_id),re=(at=oe==null?void 0:oe.params)==null?void 0:at.tuning_config;if(!re)return e.jsx("td",{className:"px-4 py-1.5 text-gray-400",children:"-"},X.job_id);let he="-";return $==="Strategy"&&(he=re.strategy),$==="Metric"&&(he=re.metric),$==="Trials"&&(he=re.n_trials),$==="CV Enabled"&&(he=re.cv_enabled?"Yes":"No"),$==="Folds"&&(he=re.cv_enabled?re.cv_folds:"-"),$==="Shuffle"&&(he=re.cv_enabled?re.cv_shuffle?"Yes":"No":"-"),e.jsx("td",{className:"px-4 py-1.5 font-mono text-gray-600 dark:text-gray-300 capitalize",children:he},X.job_id)})]},$))})]})]})]})})]}),B==="evaluation"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[l.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:l.map($=>e.jsx("button",{onClick:()=>{pe($)},className:`px-3 py-1 text-xs font-mono rounded border whitespace-nowrap ${ie===$?"bg-blue-100 border-blue-300 text-blue-700 dark:bg-blue-900/30 dark:border-blue-700 dark:text-blue-300":"bg-white border-gray-200 text-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400"}`,children:$},$))}),te?e.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-400",children:[e.jsx(tt,{className:"w-6 h-6 animate-spin mr-2"}),"Loading evaluation data..."]}):me?e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-red-500 p-4 text-center",children:[e.jsx("p",{className:"font-medium",children:"Error loading evaluation data"}),e.jsx("p",{className:"text-sm mt-2 opacity-80",children:me})]}):G?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:$=>{S($.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Train"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:$=>{E($.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Test"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:$=>{D($.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Validation"})]})]}),G.problem_type==="classification"&&((Se=G.splits.train)==null?void 0:Se.y_proba)&&(()=>{const $=G.splits.train.y_proba;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Target Class (ROC):"}),e.jsx("select",{className:"bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-1.5",value:U||"",onChange:X=>{V(X.target.value)},children:$.classes.map((X,oe)=>{var he;const re=((he=$.labels)==null?void 0:he[oe])??X;return e.jsx("option",{value:String(re),children:String(re)},String(X))})})]})})()]}),G.problem_type==="classification"&&((as=(Ve=G.splits.train)==null?void 0:Ve.y_proba)==null?void 0:as.labels)&&(()=>{const $=G.splits.train.y_proba;return e.jsxs("div",{className:"w-full text-xs text-gray-500 dark:text-gray-400",children:["Mapping: ",$.classes.map((X,oe)=>{var re;return`${String(X)}${String(((re=$.labels)==null?void 0:re[oe])??X)}`}).join(", ")]})})()]}),e.jsx("div",{className:"flex flex-col gap-6",children:Object.entries(G.splits).filter(([$])=>!($==="train"&&!k||$==="test"&&!P||$==="validation"&&!T)).map(([$,X])=>{const oe=X.y_true.map((re,he)=>({x:re,y:X.y_pred[he]}));return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 capitalize",children:[$," Set"]}),G.problem_type==="regression"?e.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[e.jsxs("div",{className:"h-[300px] relative group",id:`${$}-actual-pred`,children:[e.jsx("div",{className:"absolute top-0 right-0 z-10 opacity-0 group-hover:opacity-100 transition-opacity","data-html2canvas-ignore":"true",children:e.jsx("button",{onClick:()=>void ce(`${$}-actual-pred`,`${$}_actual_vs_predicted`),className:"p-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-sm text-gray-500 hover:text-blue-600",title:"Download Graph",children:e.jsx(Xe,{className:"w-3.5 h-3.5"})})}),e.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 text-center",children:"Actual vs Predicted"}),e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(Nd,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(Ct,{strokeDasharray:"3 3",opacity:.2}),e.jsx(St,{type:"number",dataKey:"x",name:"Actual",unit:"",label:{value:"Actual Values",position:"bottom",offset:0,fontSize:12},tick:{fontSize:11}}),e.jsx(Tt,{type:"number",dataKey:"y",name:"Predicted",unit:"",label:{value:"Predicted Values",angle:-90,position:"insideLeft",style:{textAnchor:"middle"},fontSize:12},tick:{fontSize:11}}),e.jsx(pt,{cursor:{strokeDasharray:"3 3"},content:({active:re,payload:he})=>{if(re&&he&&he.length){const Re=he[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 border border-gray-200 dark:border-gray-700 shadow-sm rounded text-xs",children:[e.jsxs("p",{className:"font-medium",children:["Actual: ",Re.x.toFixed(4)]}),e.jsxs("p",{className:"font-medium",children:["Predicted: ",Re.y.toFixed(4)]}),e.jsxs("p",{className:"text-gray-500",children:["Error: ",(Re.y-Re.x).toFixed(4)]})]})}return null}}),e.jsx(Oa,{dataKey:"x",stroke:"#ccc",strokeDasharray:"3 3",dot:!1,activeDot:!1,legendType:"none",isAnimationActive:!1}),e.jsx(za,{name:"Predictions",data:oe,fill:"#8884d8",fillOpacity:.6})]})})]}),e.jsxs("div",{className:"h-[300px] relative group",id:`${$}-residuals`,children:[e.jsx("div",{className:"absolute top-0 right-0 z-10 opacity-0 group-hover:opacity-100 transition-opacity","data-html2canvas-ignore":"true",children:e.jsx("button",{onClick:()=>void ce(`${$}-residuals`,`${$}_residuals`),className:"p-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-sm text-gray-500 hover:text-blue-600",title:"Download Graph",children:e.jsx(Xe,{className:"w-3.5 h-3.5"})})}),e.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 text-center",children:"Residuals vs Predicted"}),e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(Nd,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(Ct,{strokeDasharray:"3 3",opacity:.2}),e.jsx(St,{type:"number",dataKey:"y",name:"Predicted",unit:"",label:{value:"Predicted Values",position:"bottom",offset:0,fontSize:12},tick:{fontSize:11}}),e.jsx(Tt,{type:"number",dataKey:"residual",name:"Residual",unit:"",label:{value:"Residuals (Actual - Predicted)",angle:-90,position:"insideLeft",style:{textAnchor:"middle"},fontSize:12},tick:{fontSize:11}}),e.jsx(pt,{cursor:{strokeDasharray:"3 3"},content:({active:re,payload:he})=>{if(re&&he&&he.length){const Re=he[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 border border-gray-200 dark:border-gray-700 shadow-sm rounded text-xs",children:[e.jsxs("p",{className:"font-medium",children:["Predicted: ",Re.y.toFixed(4)]}),e.jsxs("p",{className:"font-medium",children:["Residual: ",Re.residual.toFixed(4)]})]})}return null}}),e.jsx(Bo,{y:0,stroke:"#ccc",strokeDasharray:"3 3"}),e.jsx(za,{name:"Residuals",data:oe.map(re=>{const he=re;return{...he,residual:he.x-he.y}}),fill:"#82ca9d",fillOpacity:.6})]})})]})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"h-[300px] flex flex-col items-center justify-center relative group",id:`${$}-confusion-matrix`,children:[e.jsx("div",{className:"absolute top-0 right-0 z-10 opacity-0 group-hover:opacity-100 transition-opacity","data-html2canvas-ignore":"true",children:e.jsx("button",{onClick:()=>void ce(`${$}-confusion-matrix`,`${$}_confusion_matrix`),className:"p-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-sm text-gray-500 hover:text-blue-600",title:"Download Graph",children:e.jsx(Xe,{className:"w-3.5 h-3.5"})})}),(()=>{const re=X.y_proba,he=re==null?void 0:re.classes;let Re=X.y_true,dt=X.y_pred;if(re!=null&&re.labels&&re.labels.length===re.classes.length){const Ke=new Map;re.labels.forEach((nt,Ht)=>{Ke.set(String(nt),re.classes[Ht])}),Re=X.y_true.map(nt=>Ke.get(String(nt))??nt),dt=X.y_pred.map(nt=>Ke.get(String(nt))??nt)}const{classes:at,matrix:Et}=$e(Re,dt,he);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-8"})," ",e.jsxs("div",{className:"flex ml-2",children:[" ",at.map(Ke=>e.jsxs("div",{className:"w-16 text-center text-xs font-medium text-gray-500 dark:text-gray-400 pb-2",children:["Pred ",String(Ke)]},String(Ke)))]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex flex-col justify-center mr-2",children:at.map(Ke=>e.jsxs("div",{className:"h-16 flex items-center justify-end text-xs font-medium text-gray-500 dark:text-gray-400 pr-2",children:["True ",String(Ke)]},String(Ke)))}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700",children:Et.map((Ke,nt)=>e.jsx("div",{className:"flex",children:Ke.map((Ht,Wt)=>{const it=Math.max(...Et.flat()),Fs=it>0?Ht/it:0;return e.jsx("div",{className:"w-16 h-16 flex items-center justify-center text-sm font-mono border border-gray-100 dark:border-gray-800",style:{backgroundColor:`rgba(59, 130, 246, ${Fs*.8+.1})`,color:Fs>.5?"white":"inherit"},title:`True: ${at[nt]}, Pred: ${at[Wt]}, Count: ${Ht}`,children:Ht},Wt)})},nt))})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-400",children:"Confusion Matrix"})]})})()]}),X.y_proba&&e.jsxs("div",{className:"h-[300px] w-full relative group",id:`${$}-roc`,children:[e.jsx("div",{className:"absolute top-0 right-0 z-10 opacity-0 group-hover:opacity-100 transition-opacity","data-html2canvas-ignore":"true",children:e.jsx("button",{onClick:()=>void ce(`${$}-roc`,`${$}_roc_curve`),className:"p-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-sm text-gray-500 hover:text-blue-600",title:"Download Graph",children:e.jsx(Xe,{className:"w-3.5 h-3.5"})})}),e.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 text-center",children:"ROC Curve"}),(()=>{if(!U)return e.jsx("div",{className:"text-center text-xs text-gray-400",children:"Select a class"});const re=We(X.y_true,X.y_proba,U);return re?e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(Ic,{data:re,margin:{top:5,right:20,bottom:20,left:20},children:[e.jsx(Ct,{strokeDasharray:"3 3",opacity:.1}),e.jsx(St,{type:"number",dataKey:"fpr",domain:[0,1],label:{value:"False Positive Rate",position:"bottom",offset:0,fontSize:12}}),e.jsx(Tt,{type:"number",dataKey:"tpr",domain:[0,1],label:{value:"True Positive Rate",angle:-90,position:"left",fontSize:12}}),e.jsx(pt,{}),e.jsx(Oa,{type:"monotone",dataKey:"tpr",stroke:"#8884d8",dot:!1,strokeWidth:2}),e.jsx(Oa,{dataKey:"fpr",stroke:"#ccc",strokeDasharray:"3 3",dot:!1})]})}):e.jsx("div",{className:"text-center text-xs text-gray-400",children:"ROC not available (multiclass or missing proba)"})})()]})]})]},$)})})]}):e.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-400 italic text-center",children:[e.jsx("p",{children:"Select a completed job to view evaluation details."}),e.jsx("p",{className:"text-xs mt-2 opacity-70",children:"(Note: Only jobs run after this update have evaluation artifacts)"})]})]})]})})]})]})},Xf=()=>{const[t,r]=f.useState(null),[a,i]=f.useState(`[
  {
    "feature1": 0.5,
    "feature2": 1.2
  }
]`),[o,l]=f.useState(null),[c,m]=f.useState(!1),[u,h]=f.useState(null),[p,g]=f.useState(null);f.useEffect(()=>{b()},[]);const b=async()=>{try{const w=await sr.getActive();if(r(w),w){let N={},k=!1;if(w.input_schema&&w.input_schema.length>0&&(w.input_schema.forEach(S=>{N[S.name]=0}),k=!0,g(`Schema loaded from artifacts (${w.input_schema.length} features)`)),w.job_id)try{const S=await Ge.getJob(w.job_id);if(S.dataset_id){const P=await $t.getSample(S.dataset_id,1);if(P.length>0){const E=P[0];if(k)Object.keys(N).forEach(T=>{T in E&&(N[T]=E[T])});else{const T=S.target_column,D=S.dropped_columns||[],R={...E};typeof T=="string"&&T in R&&Reflect.deleteProperty(R,T),D.forEach(M=>{typeof M=="string"&&M in R&&Reflect.deleteProperty(R,M)}),N=R;const _=[];T&&_.push(`Target: ${T}`),D.length>0&&_.push(`Dropped: ${D.length} cols`),_.length>0&&g(`Auto-filtered from dataset: ${_.join(", ")}`)}}}}catch(S){console.warn("Failed to fetch dataset sample",S)}Object.keys(N).length>0&&i(JSON.stringify([N],null,2))}}catch{r(null)}},y=async()=>{if(confirm("Are you sure you want to undeploy the current model?"))try{await sr.deactivate(),r(null),l(null)}catch(w){console.error("Failed to deactivate",w)}},j=async()=>{m(!0),h(null),l(null);try{const w=JSON.parse(a);if(!Array.isArray(w))throw new Error("Input must be a JSON array of objects");const N=await sr.predict(w);l(N.predictions)}catch(w){h(w.message||"Prediction failed")}finally{m(!1)}};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 p-6 overflow-hidden",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 shrink-0",children:"Model Inference"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 flex-1 min-h-0",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Input Data (JSON)"}),p&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 px-2 py-1 rounded border border-amber-200 dark:border-amber-800",children:p}),e.jsx("span",{className:"text-[10px] text-gray-400 mt-1",children:"Please verify fields before running"})]})]}),e.jsx("textarea",{className:"flex-1 w-full p-4 font-mono text-sm bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none",value:a,onChange:w=>{i(w.target.value)},placeholder:'[{"col1": 1, "col2": "A"}]'}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>{j()},disabled:!t||c,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${!t||c?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-800 dark:text-gray-600":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm"}`,children:c?"Running...":e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"w-4 h-4"})," Run Prediction"]})})})]}),e.jsxs("div",{className:"flex flex-col gap-6 h-full min-h-0",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 shrink-0",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-100 mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"w-5 h-5 text-blue-500"}),"Active Deployment"]}),t&&e.jsxs("button",{onClick:()=>{y()},className:"flex items-center gap-1 text-xs px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400 dark:hover:bg-red-900/50 transition-colors",title:"Undeploy Model",children:[e.jsx(co,{className:"w-3 h-3"}),"Undeploy"]})]}),t?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Model Type"}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:t.model_type})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Job ID"}),e.jsx("div",{className:"font-mono text-sm text-gray-800 dark:text-gray-200 break-all",children:t.job_id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Deployed At"}),e.jsx("div",{className:"text-sm text-gray-800 dark:text-gray-200",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 font-medium text-sm",children:[e.jsx(rt,{className:"w-4 h-4"})," Active"]})]})]}):e.jsxs("div",{className:"text-gray-500 dark:text-gray-400 italic flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"No model is currently deployed. Go to Experiments page to deploy one."]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col flex-1 min-h-0",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100 mb-4",children:"Prediction Results"}),e.jsx("div",{className:"flex-1 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4 overflow-auto",children:u?e.jsxs("div",{className:"text-red-600 dark:text-red-400 flex items-start gap-2",children:[e.jsx(xt,{className:"w-5 h-5 shrink-0 mt-0.5"}),e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm",children:u})]}):o?e.jsx("div",{className:"space-y-2",children:o.map((w,N)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-gray-800 rounded border border-gray-100 dark:border-gray-700",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-8",children:["#",N+1]}),e.jsx("span",{className:"font-mono font-medium text-blue-600 dark:text-blue-400",children:typeof w=="object"?JSON.stringify(w):String(w)})]},N))}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm italic",children:"Run a prediction to see results here..."})})]})]})]})]})},eg=()=>{const{activeView:t,isPropertiesPanelExpanded:r}=ha();return e.jsxs("div",{className:"flex h-full w-full bg-background overflow-hidden flex-col",children:[e.jsx(Kf,{}),e.jsx(Gf,{}),t==="canvas"?e.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[e.jsx(Mf,{}),e.jsxs("main",{className:"flex-1 h-full relative flex flex-col transition-all duration-300 ease-in-out",children:[!r&&e.jsx(Vf,{}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Zf,{}),e.jsx(qf,{})]})]}),e.jsx(Uf,{})]}):t==="experiments"?e.jsx(Yf,{}):e.jsx(Xf,{})]})},tg=()=>{const t=je(l=>l.addNode),r=je(l=>l.nodes),[a,i]=Nu(),o=f.useRef(!1);return f.useEffect(()=>{const l=a.get("source_id");if(l){if(o.current)return;if(r.some(u=>{var h;return u.type==="dataset_node"&&((h=u.data)==null?void 0:h.datasetId)===l})){const u=new URLSearchParams(a);u.delete("source_id"),i(u,{replace:!0});return}o.current=!0,t("dataset_node",{x:100,y:100},{datasetId:l});const m=new URLSearchParams(a);m.delete("source_id"),i(m,{replace:!0})}},[a,t,r,i]),e.jsx(eg,{})},sg=()=>{const t=ui(),[r,a]=f.useState(null),[i,o]=f.useState([]),[l,c]=f.useState(!1),[m,u]=f.useState(null),[h,p]=f.useState(null),[g,b]=f.useState(null),[y,j]=f.useState(null),[w,N]=f.useState(null),[k,S]=f.useState(!1),[P,E]=f.useState(0),[T,D]=f.useState(!0),R=10,[_,M]=f.useState(""),[I,O]=f.useState(""),[F,B]=f.useState(()=>{try{const U=localStorage.getItem("skyulf_manual_deployments");return U?JSON.parse(U):{}}catch{return{}}}),q=U=>{B(V=>{const Y={...V,[U]:!V[U]};return localStorage.setItem("skyulf_manual_deployments",JSON.stringify(Y)),Y})},G=async U=>{j(U),S(!0),N(null);try{const V=await fetch(`/api/registry/artifacts/${U}`);if(V.ok){const Y=await V.json();N(Y)}else{const Y=await V.json();N({storage_type:"error",base_uri:"",files:[`Failed to load artifacts: ${Y.detail||"Unknown error"}`]})}}catch{N({storage_type:"error",base_uri:"",files:["Error loading artifacts"]})}finally{S(!1)}},ee=async()=>{try{const U=await fetch("/api/registry/stats");if(U.ok){const V=await U.json();a(V)}}catch(U){console.error("Failed to fetch stats",U)}},te=async(U,V=!1)=>{if(!l)try{c(!0);const Y=U*R,Q=new URLSearchParams({skip:Y.toString(),limit:R.toString()}),ce=await fetch(`/api/registry/models?${Q.toString()}`);if(!ce.ok)throw new Error("Failed to fetch models");const pe=await ce.json();return pe.length<R?D(!1):D(!0),o($e=>V?pe:[...$e,...pe]),pe}catch(Y){return u(Y.message),null}finally{c(!1)}};f.useEffect(()=>{ee(),te(0,!0)},[]),f.useEffect(()=>{const U=Y=>{const Q=Y.target;Q.scrollTop+Q.clientHeight>=Q.scrollHeight-100&&!l&&T&&E(ce=>ce+1)},V=document.querySelector("main");return V?(V.addEventListener("scroll",U),()=>{V.removeEventListener("scroll",U)}):(window.addEventListener("scroll",U),()=>{window.removeEventListener("scroll",U)})},[l,T]),f.useEffect(()=>{P>0&&te(P,!1)},[P]);const W=async U=>{if(confirm("Are you sure you want to deploy this model version? This will replace the currently active deployment."))try{b(U);const V=await fetch(`/api/deployment/deploy/${U}`,{method:"POST"});if(!V.ok){const Q=await V.json();throw new Error(Q.detail||"Deployment failed")}E(0);const Y=await te(0,!0);if(h&&Y){const Q=Y.find(ce=>ce.model_type===h.model_type&&ce.dataset_id===h.dataset_id);Q&&p(Q)}confirm("Model deployed successfully! Do you want to go to the inference page?")&&t("/deployments")}catch(V){alert(`Error deploying model: ${V.message}`)}finally{b(null)}},me=U=>{switch(U.toLowerCase()){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"running":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-slate-700 dark:text-slate-300"}},se=U=>{const V=U.score||U.accuracy||U.f1_score||U.rmse||U.mse;if(V!==void 0)return typeof V=="number"?V.toFixed(4):String(V);const Y=Object.keys(U);if(Y.length>0){const Q=U[Y[0]];return`${Y[0]}: ${typeof Q=="number"?Q.toFixed(4):Q}`}return"-"},ie=U=>U.toLowerCase()==="tuning"?"Advanced Training":U.toLowerCase()==="training"?"Standard Training":U.charAt(0).toUpperCase()+U.slice(1),ge=i.filter(U=>{const V=(U.dataset_name||"").toLowerCase().includes(_.toLowerCase())||(U.dataset_id||"").toLowerCase().includes(_.toLowerCase()),Y=U.model_type.toLowerCase().includes(I.toLowerCase());return V&&Y});return l&&!r&&i.length===0?e.jsxs("div",{className:"p-8 flex justify-center items-center h-full text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"}),"Loading registry..."]}):m?e.jsxs("div",{className:"p-8 text-center text-red-600 dark:text-red-400",children:["Error: ",m]}):e.jsxs("div",{className:"p-8 min-h-screen bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 transition-colors duration-200",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900 dark:text-white",children:"Model Registry"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage versions, track metrics, and deploy your best models."})]}),e.jsx("button",{onClick:()=>{E(0),te(0,!0),ee()},className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors shadow-sm",children:"Refresh"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(so,{title:"Total Versions",value:(r==null?void 0:r.total_versions)||0,icon:e.jsx(na,{className:"text-blue-500"})}),e.jsx(so,{title:"Active Deployments",value:(r==null?void 0:r.active_deployments)||0,icon:e.jsx(rg,{className:"text-green-500"}),valueColor:"text-green-600 dark:text-green-400"}),e.jsx(so,{title:"Model Types",value:i.length,icon:e.jsx(lo,{className:"text-purple-500"}),valueColor:"text-purple-600 dark:text-purple-400"})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Filter by Model Type"}),e.jsx("input",{type:"text",placeholder:"e.g. RandomForest",value:I,onChange:U=>{O(U.target.value)},className:"w-full px-4 py-2 rounded-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Filter by Dataset"}),e.jsx("input",{type:"text",placeholder:"e.g. Iris Dataset",value:_,onChange:U=>{M(U.target.value)},className:"w-full px-4 py-2 rounded-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/50",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(lo,{size:20,className:"text-slate-400"}),"Registered Models"]}),e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Showing ",ge.length," of ",i.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Model Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Dataset"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Latest Version"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Source"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Deployments"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:ge.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-slate-500 dark:text-slate-400",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(na,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"No models found matching your filters."})]})})}):ge.map(U=>{const V=U.latest_version;if(!V)return null;const Y=`${U.model_type}-${U.dataset_id}`,Q=U.deployment_count>0,ce=F[Y]||!1,pe=Q||ce;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-white",children:U.model_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:U.dataset_name}),U.dataset_type&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-600 uppercase",children:U.dataset_type})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:e.jsxs("span",{className:"font-mono bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-xs",children:["v",V.version]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:ie(V.source)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:new Date(V.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${me(V.status)}`,children:V.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",onClick:$e=>{$e.stopPropagation()},children:[e.jsx("input",{type:"checkbox",checked:pe,onChange:()=>{q(Y)},disabled:Q,className:`w-4 h-4 rounded border-gray-300 focus:ring-green-500 ${Q?"text-green-600 opacity-50 cursor-not-allowed":"text-blue-600 cursor-pointer"}`}),pe?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400 font-medium bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded-full text-xs",children:[e.jsx(rt,{size:12})," ",Q?"Active":"Manual"]}):e.jsx("span",{className:"text-slate-400 dark:text-slate-600 text-xs",children:"None"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("button",{onClick:()=>{p(U)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 flex items-center justify-end gap-1 ml-auto",children:["View Versions ",e.jsx(Pt,{size:16})]})})]},Y)})})]})})]}),l&&i.length>0&&e.jsxs("div",{className:"py-4 flex justify-center text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),"Loading more models..."]}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:()=>{p(null)},children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden border border-slate-200 dark:border-slate-700",onClick:U=>{U.stopPropagation()},children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:h.model_type}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Version History"})]}),e.jsx("button",{onClick:()=>{p(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(et,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Version"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Metrics"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:h.versions.map(U=>e.jsxs("tr",{className:`hover:bg-slate-50 dark:hover:bg-slate-700/30 ${U.is_deployed?"bg-green-50/50 dark:bg-green-900/10":""}`,children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-mono",children:["v",U.version]}),U.is_deployed&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-1.5 py-0.5 rounded border border-green-200 dark:border-green-800",children:"Deployed"})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:new Date(U.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300 font-mono",children:se(U.metrics)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${me(U.status)}`,children:U.status})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>{G(U.job_id)},className:"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",title:"View Artifacts",children:e.jsx(Cd,{size:16})}),U.status==="completed"&&!U.is_deployed&&e.jsxs("button",{onClick:()=>{W(U.job_id)},disabled:g===U.job_id,className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 disabled:opacity-50 flex items-center gap-1",children:[g===U.job_id?e.jsx("span",{className:"animate-spin h-3 w-3 border-b-2 border-current rounded-full"}):e.jsx(Zt,{size:14}),"Deploy"]}),U.is_deployed&&e.jsxs("span",{className:"text-green-600 dark:text-green-400 text-xs flex items-center gap-1",children:[e.jsx(rt,{size:14})," Active"]})]})})]},U.job_id))})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex justify-end",children:e.jsx("button",{onClick:()=>{p(null)},className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md text-sm font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Close"})})]})}),y&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:()=>{j(null)},children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden border border-slate-200 dark:border-slate-700",onClick:U=>{U.stopPropagation()},children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Cd,{size:20,className:"text-blue-500"}),"Artifacts"]}),e.jsx("button",{onClick:()=>{j(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(et,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:k?e.jsxs("div",{className:"flex justify-center py-8 text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),"Loading artifacts..."]}):!w||w.files.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No artifacts found."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[w.storage_type==="s3"?e.jsx(Bc,{size:20,className:"text-blue-600 dark:text-blue-400 flex-shrink-0"}):e.jsx(_x,{size:20,className:"text-slate-600 dark:text-slate-400 flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-blue-700 dark:text-blue-300",children:w.storage_type==="s3"?"S3 Bucket Storage":"Local Storage"}),e.jsx("span",{className:"text-xs font-mono text-slate-600 dark:text-slate-400 truncate",title:w.base_uri,children:w.base_uri})]})]}),e.jsx("ul",{className:"space-y-2",children:w.files.map((U,V)=>e.jsxs("li",{className:"flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-700/30 border border-slate-100 dark:border-slate-700",children:[e.jsx(Cr,{size:18,className:"text-slate-400"}),e.jsx("span",{className:"text-sm font-mono text-slate-700 dark:text-slate-300 break-all",children:U})]},V))})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex justify-end",children:e.jsx("button",{onClick:()=>{j(null)},className:"px-4 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md text-sm font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Close"})})]})})]})},so=({title:t,value:r,icon:a,valueColor:i="text-slate-900 dark:text-white"})=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:t}),e.jsx("div",{className:`mt-2 text-3xl font-bold ${i}`,children:r})]}),e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:a})]}),rg=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),e.jsx("path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),e.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),e.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]}),ag=()=>{const[t,r]=f.useState(null),[a,i]=f.useState([]),[o,l]=f.useState(!1),[c,m]=f.useState(null),u=async()=>{l(!0),m(null);try{const[g,b]=await Promise.all([sr.getActive(),sr.getHistory(50,0)]);r(g),i(b)}catch(g){console.error("Failed to load deployments",g),m("Failed to load deployment data.")}finally{l(!1)}};f.useEffect(()=>{u()},[]);const h=async()=>{if(confirm("Are you sure you want to deactivate the current deployment?"))try{await sr.deactivate(),await u()}catch(g){console.error("Failed to deactivate",g),alert("Failed to deactivate deployment.")}},p=async g=>{if(confirm(`Are you sure you want to redeploy job ${g}?`))try{await sr.deployModel(g),await u()}catch(b){console.error("Failed to redeploy",b),alert("Failed to redeploy model.")}};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-100",children:"Model Deployments"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage active models and view deployment history"})]}),e.jsx("button",{onClick:()=>{u()},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:"Refresh",children:e.jsx(_t,{className:`w-5 h-5 ${o?"animate-spin":""}`})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[c&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg border border-red-200 dark:border-red-800 flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5"}),c]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(oi,{className:"w-5 h-5 text-green-500"}),"Active Deployment"]}),t?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-green-200 dark:border-green-900 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(na,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:t.model_type}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(rt,{className:"w-3 h-3"})," Active"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono",children:["Job ID: ",t.job_id]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Deployed: ",new Date(t.created_at).toLocaleString()]})]})]}),e.jsxs("button",{onClick:()=>{h()},className:"flex items-center gap-2 px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-400 rounded-lg transition-colors text-sm font-medium",children:[e.jsx(co,{className:"w-4 h-4"}),"Deactivate"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 text-xs font-mono text-gray-500 dark:text-gray-400 break-all",children:["Artifact URI: ",t.artifact_uri]})]}):e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-dashed border-gray-300 dark:border-gray-700 p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(co,{className:"w-6 h-6 text-gray-400"})}),e.jsx("h3",{className:"text-gray-900 dark:text-gray-100 font-medium",children:"No Active Model"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Deploy a model from the Experiments page to see it here."})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5 text-blue-500"}),"Deployment History"]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50 text-gray-500 dark:text-gray-400 font-medium border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Model Type"}),e.jsx("th",{className:"px-6 py-3",children:"Job ID"}),e.jsx("th",{className:"px-6 py-3",children:"Deployed At"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500 dark:text-gray-400",children:"No deployment history found."})}):a.map(g=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:g.is_active?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400"}),"Inactive"]})}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 dark:text-gray-100",children:g.model_type}),e.jsxs("td",{className:"px-6 py-4 font-mono text-xs text-gray-500 dark:text-gray-400",children:[g.job_id.slice(0,8),"..."]}),e.jsx("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:new Date(g.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:!g.is_active&&e.jsx("button",{onClick:()=>{p(g.job_id)},className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium text-xs",children:"Redeploy"})})]},g.id))})]})})})]})]})]})},ng=()=>{const[t,r]=f.useState("training"),[a,i]=f.useState([]),[o,l]=f.useState(!0),[c,m]=f.useState(""),[u,h]=f.useState(0),[p,g]=f.useState(!0),b=20,[y,j]=f.useState({training:{data:[],skip:0,hasMore:!0},tuning:{data:[],skip:0,hasMore:!0},eda:{data:[],skip:0,hasMore:!0},ingestion:{data:[],skip:0,hasMore:!0}}),w=async(P=!1)=>{P&&(l(!0),i([]),h(0),g(!0));try{const E=P?0:u;let T=[];t==="training"||t==="tuning"?T=await Ge.getJobs(b,E,t):t==="eda"?T=await Ge.getEDAJobs(b):t==="ingestion"&&(T=await Ge.getIngestionJobs(b,E)),T.sort((R,_)=>new Date(_.created_at).getTime()-new Date(R.created_at).getTime());const D=T.length>=b;D||g(!1),P?(i(T),j(R=>({...R,[t]:{data:T,skip:E+b,hasMore:D}}))):i(R=>{const _=[...R,...T];return j(M=>({...M,[t]:{data:_,skip:E+b,hasMore:D}})),_}),h(E+b)}catch(E){console.error("Failed to fetch jobs:",E)}finally{l(!1)}};f.useEffect(()=>{const P=y[t];P.data.length>0?(i(P.data),h(P.skip),g(P.hasMore),l(!1)):w(!0)},[t]);const N=()=>{w(!1)},k=a.filter(P=>{if(c){const E=c.toLowerCase();return P.job_id.toLowerCase().includes(E)||P.model_type&&P.model_type.toLowerCase().includes(E)||P.dataset_name&&P.dataset_name.toLowerCase().includes(E)}return!0}),S=(P,E)=>{if(!P||!E)return"-";const T=new Date(P).getTime(),R=new Date(E).getTime()-T;if(R<1e3)return"< 1s";const _=Math.floor(R/1e3);if(_<60)return`${_}s`;const M=Math.floor(_/60);return M<60?`${M}m ${_%60}s`:`${Math.floor(M/60)}h ${M%60}m`};return e.jsxs("div",{className:"p-8 space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Jobs"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Monitor and manage all your pipeline activities"})]}),e.jsxs("button",{onClick:()=>w(),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-slate-700 dark:text-slate-300",children:[e.jsx(_t,{size:16}),"Refresh"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto w-full md:w-auto pb-2 md:pb-0",children:[e.jsx(Dn,{active:t==="training",onClick:()=>r("training"),icon:e.jsx(wx,{size:16}),label:"Basic Training"}),e.jsx(Dn,{active:t==="tuning",onClick:()=>r("tuning"),icon:e.jsx(tt,{size:16}),label:"Advanced Tuning"}),e.jsx(Dn,{active:t==="eda",onClick:()=>r("eda"),icon:e.jsx(gs,{size:16}),label:"EDA"}),e.jsx(Dn,{active:t==="ingestion",onClick:()=>r("ingestion"),icon:e.jsx(bt,{size:16}),label:"Ingestion"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search jobs...",value:c,onChange:P=>m(P.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:text-slate-100"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[o?e.jsxs("div",{className:"p-12 text-center text-slate-500",children:[e.jsx(_t,{className:"animate-spin mx-auto mb-4",size:24}),"Loading jobs..."]}):k.length===0?e.jsx("div",{className:"p-12 text-center text-slate-500",children:"No jobs found matching your criteria."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Job ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Created At"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:k.map(P=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(ig,{status:P.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-slate-100",children:e.jsx("span",{className:"font-mono text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded",children:P.job_id.substring(0,8)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400 capitalize",children:P.job_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:P.model_type||P.dataset_name||P.target_column||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400 font-mono",children:S(P.start_time,P.end_time)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400",children:[new Date(P.created_at).toLocaleDateString()," ",e.jsx("span",{className:"text-xs opacity-70",children:new Date(P.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},P.job_id))})]})}),!o&&p&&k.length>0&&e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex justify-center",children:e.jsx("button",{onClick:N,className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1 px-4 py-2 rounded-md hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors",children:"Load More"})})]})]})},Dn=({active:t,onClick:r,icon:a,label:i})=>e.jsxs("button",{onClick:r,className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${t?"bg-indigo-600 text-white shadow-sm":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[a,i]}),ig=({status:t})=>{const r={succeeded:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",completed:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",failed:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",running:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",queued:"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400"},a={succeeded:e.jsx(rt,{size:14}),completed:e.jsx(rt,{size:14}),failed:e.jsx(ca,{size:14}),running:e.jsx(tt,{size:14,className:"animate-pulse"}),pending:e.jsx(Qt,{size:14}),queued:e.jsx(Qt,{size:14})},i=t.toLowerCase(),o=r[i]||"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-400",l=a[i]||e.jsx(Qt,{size:14});return e.jsxs("span",{className:`px-2.5 py-1 inline-flex items-center gap-1.5 text-xs font-medium rounded-full ${o}`,children:[l,t.charAt(0).toUpperCase()+t.slice(1)]})},Hr="/api/eda",Es={analyze:async(t,r,a,i,o)=>(await qs.post(`${Hr}/${t}/analyze`,{target_col:r,exclude_cols:a,filters:i,task_type:o})).data,getLatestReport:async t=>(await qs.get(`${Hr}/${t}/latest`)).data,getReport:async t=>(await qs.get(`${Hr}/reports/${t}`)).data,cancelJob:async t=>(await qs.post(`${Hr}/reports/${t}/cancel`)).data,getHistory:async t=>(await qs.get(`${Hr}/${t}/history`)).data,getDecomposition:async(t,r,a,i,o)=>(await qs.post(`${Hr}/${t}/decomposition`,{measure_col:r,measure_agg:a,split_col:i,filters:o})).data},og=({isOpen:t,onClose:r,history:a,onSelect:i,onFetchReport:o,onRefresh:l})=>{var N,k,S,P,E,T,D,R;const[c,m]=f.useState(null),[u,h]=f.useState(!1),[p,g]=f.useState(null);if(!t)return null;const b=()=>{m(null),r()},y=async(_,M)=>{if(_.stopPropagation(),confirm("Are you sure you want to cancel this analysis?")){g(M);try{await Es.cancelJob(M),l&&l()}catch(I){console.error("Failed to cancel job",I),alert("Failed to cancel job")}finally{g(null)}}},j=async _=>{h(!0);try{const M=await o(_.id);m(M)}catch(M){console.error("Failed to load report details",M)}finally{h(!1)}},w=_=>{switch(_){case"Numeric":return e.jsx(Wc,{className:"w-4 h-4 text-blue-500"});case"Categorical":return e.jsx(Nx,{className:"w-4 h-4 text-purple-500"});case"DateTime":return e.jsx(Sr,{className:"w-4 h-4 text-green-500"});default:return e.jsx(Cr,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full flex flex-col transition-all duration-300 ${c?"max-w-5xl h-[90vh]":"max-w-2xl max-h-[80vh]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c?e.jsx("button",{onClick:()=>m(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(Uc,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})}):e.jsx(Qt,{className:"w-5 h-5 text-blue-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:c?`Analysis #${c.id} Details`:"Analysis History"})]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",children:e.jsx(et,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c?u?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Ye,{className:"w-12 h-12 mb-4 animate-spin text-blue-500"}),e.jsx("p",{children:"Loading analysis details..."})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs uppercase font-medium",children:"Rows"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:((k=(N=c.profile_data)==null?void 0:N.row_count)==null?void 0:k.toLocaleString())||"-"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(Fc,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs uppercase font-medium",children:"Columns"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:((P=(S=c.profile_data)==null?void 0:S.column_count)==null?void 0:P.toLocaleString())||"-"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(Cr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs uppercase font-medium",children:"Missing Cells"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[(T=(E=c.profile_data)==null?void 0:E.missing_cells_percentage)==null?void 0:T.toFixed(1),"%"]})]})]}),((D=c.profile_data)==null?void 0:D.excluded_columns)&&c.profile_data.excluded_columns.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(tn,{className:"w-4 h-4 text-gray-500"}),"Excluded Columns (",c.profile_data.excluded_columns.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.profile_data.excluded_columns.map(_=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded text-sm line-through",children:_},_))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Variables Overview"}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50 text-gray-500 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Missing"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Distinct"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:((R=c.profile_data)==null?void 0:R.columns)&&Object.values(c.profile_data.columns).map(_=>{var M;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 dark:text-white",children:_.name}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w(_.dtype),e.jsx("span",{children:_.dtype})]})}),e.jsx("td",{className:"px-4 py-3",children:_.missing_percentage>0?e.jsxs("span",{className:"text-amber-600",children:[_.missing_percentage.toFixed(1),"%"]}):e.jsx("span",{className:"text-green-600",children:"0%"})}),e.jsx("td",{className:"px-4 py-3 text-gray-500 dark:text-gray-400",children:((M=_.categorical_stats)==null?void 0:M.unique_count)||"-"})]},_.name)})})]})})]})]}):a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(Qt,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No history available for this dataset."})]}):e.jsx("div",{className:"space-y-3",children:a.map(_=>e.jsxs("div",{onClick:()=>j(_),className:"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${_.status==="COMPLETED"?"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":_.status==="FAILED"?"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400":_.status==="CANCELLED"?"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400":"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:_.status==="COMPLETED"?e.jsx(rt,{className:"w-5 h-5"}):_.status==="FAILED"?e.jsx(xt,{className:"w-5 h-5"}):_.status==="CANCELLED"?e.jsx(Un,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5 animate-spin"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 flex items-center gap-2",children:["Analysis #",_.id,e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${_.status==="COMPLETED"?"bg-green-50 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800":_.status==="FAILED"?"bg-red-50 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800":_.status==="CANCELLED"?"bg-gray-50 text-gray-700 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700":"bg-yellow-50 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800"}`,children:_.status})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(_.created_at).toLocaleString()}),_.target_col&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(Zt,{className:"w-3 h-3"})," Target: ",_.target_col,_.task_type&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-[10px]",children:_.task_type})]})]})]}),e.jsx("div",{className:"text-right flex items-center gap-4",children:(_.status==="PENDING"||_.status==="STARTED"||_.status==="RUNNING")&&e.jsx("button",{onClick:M=>y(M,_.id),disabled:p===_.id,className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full transition-colors",title:"Cancel Analysis",children:p===_.id?e.jsx(Ye,{className:"w-4 h-4 animate-spin"}):e.jsx(Un,{className:"w-4 h-4"})})})]},_.id))})}),e.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-xl flex justify-between items-center",children:c?e.jsxs("button",{onClick:()=>{i(c),b()},className:"ml-auto flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors shadow-sm",children:[e.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Load this Report"]}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center w-full",children:"Select a previous analysis to view details."})})]})})};function Ts(t,r,{checkForDefaultPrevented:a=!0}={}){return function(o){if(t==null||t(o),a===!1||!o.defaultPrevented)return r==null?void 0:r(o)}}function Qd(t,r){if(typeof t=="function")return t(r);t!=null&&(t.current=r)}function dl(...t){return r=>{let a=!1;const i=t.map(o=>{const l=Qd(o,r);return!a&&typeof l=="function"&&(a=!0),l});if(a)return()=>{for(let o=0;o<i.length;o++){const l=i[o];typeof l=="function"?l():Qd(t[o],null)}}}}function Rr(...t){return f.useCallback(dl(...t),t)}function Pu(t,r=[]){let a=[];function i(l,c){const m=f.createContext(c),u=a.length;a=[...a,c];const h=g=>{var k;const{scope:b,children:y,...j}=g,w=((k=b==null?void 0:b[t])==null?void 0:k[u])||m,N=f.useMemo(()=>j,Object.values(j));return e.jsx(w.Provider,{value:N,children:y})};h.displayName=l+"Provider";function p(g,b){var w;const y=((w=b==null?void 0:b[t])==null?void 0:w[u])||m,j=f.useContext(y);if(j)return j;if(c!==void 0)return c;throw new Error(`\`${g}\` must be used within \`${l}\``)}return[h,p]}const o=()=>{const l=a.map(c=>f.createContext(c));return function(m){const u=(m==null?void 0:m[t])||l;return f.useMemo(()=>({[`__scope${t}`]:{...m,[t]:u}}),[m,u])}};return o.scopeName=t,[i,lg(o,...r)]}function lg(...t){const r=t[0];if(t.length===1)return r;const a=()=>{const i=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(l){const c=i.reduce((m,{useScope:u,scopeName:h})=>{const g=u(l)[`__scope${h}`];return{...m,...g}},{});return f.useMemo(()=>({[`__scope${r.scopeName}`]:c}),[c])}};return a.scopeName=r.scopeName,a}function dg(t){const r=cg(t),a=f.forwardRef((i,o)=>{const{children:l,...c}=i,m=f.Children.toArray(l),u=m.find(mg);if(u){const h=u.props.children,p=m.map(g=>g===u?f.Children.count(h)>1?f.Children.only(null):f.isValidElement(h)?h.props.children:null:g);return e.jsx(r,{...c,ref:o,children:f.isValidElement(h)?f.cloneElement(h,void 0,p):null})}return e.jsx(r,{...c,ref:o,children:l})});return a.displayName=`${t}.Slot`,a}function cg(t){const r=f.forwardRef((a,i)=>{const{children:o,...l}=a;if(f.isValidElement(o)){const c=xg(o),m=hg(l,o.props);return o.type!==f.Fragment&&(m.ref=i?dl(i,c):c),f.cloneElement(o,m)}return f.Children.count(o)>1?f.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var ug=Symbol("radix.slottable");function mg(t){return f.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===ug}function hg(t,r){const a={...r};for(const i in r){const o=t[i],l=r[i];/^on[A-Z]/.test(i)?o&&l?a[i]=(...m)=>{const u=l(...m);return o(...m),u}:o&&(a[i]=o):i==="style"?a[i]={...o,...l}:i==="className"&&(a[i]=[o,l].filter(Boolean).join(" "))}return{...t,...a}}function xg(t){var i,o;let r=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,a=r&&"isReactWarning"in r&&r.isReactWarning;return a?t.ref:(r=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,a=r&&"isReactWarning"in r&&r.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}var pg=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Mr=pg.reduce((t,r)=>{const a=dg(`Primitive.${r}`),i=f.forwardRef((o,l)=>{const{asChild:c,...m}=o,u=c?a:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(u,{...m,ref:l})});return i.displayName=`Primitive.${r}`,{...t,[r]:i}},{});function fg(t,r){t&&ii.flushSync(()=>t.dispatchEvent(r))}function xi(t){const r=f.useRef(t);return f.useEffect(()=>{r.current=t}),f.useMemo(()=>(...a)=>{var i;return(i=r.current)==null?void 0:i.call(r,...a)},[])}function gg(t,r=globalThis==null?void 0:globalThis.document){const a=xi(t);f.useEffect(()=>{const i=o=>{o.key==="Escape"&&a(o)};return r.addEventListener("keydown",i,{capture:!0}),()=>r.removeEventListener("keydown",i,{capture:!0})},[a,r])}var bg="DismissableLayer",Lo="dismissableLayer.update",yg="dismissableLayer.pointerDownOutside",vg="dismissableLayer.focusOutside",Yd,Lu=f.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Eu=f.forwardRef((t,r)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:l,onInteractOutside:c,onDismiss:m,...u}=t,h=f.useContext(Lu),[p,g]=f.useState(null),b=(p==null?void 0:p.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,y]=f.useState({}),j=Rr(r,R=>g(R)),w=Array.from(h.layers),[N]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),k=w.indexOf(N),S=p?w.indexOf(p):-1,P=h.layersWithOutsidePointerEventsDisabled.size>0,E=S>=k,T=wg(R=>{const _=R.target,M=[...h.branches].some(I=>I.contains(_));!E||M||(o==null||o(R),c==null||c(R),R.defaultPrevented||m==null||m())},b),D=Ng(R=>{const _=R.target;[...h.branches].some(I=>I.contains(_))||(l==null||l(R),c==null||c(R),R.defaultPrevented||m==null||m())},b);return gg(R=>{S===h.layers.size-1&&(i==null||i(R),!R.defaultPrevented&&m&&(R.preventDefault(),m()))},b),f.useEffect(()=>{if(p)return a&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(Yd=b.body.style.pointerEvents,b.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(p)),h.layers.add(p),Xd(),()=>{a&&h.layersWithOutsidePointerEventsDisabled.size===1&&(b.body.style.pointerEvents=Yd)}},[p,b,a,h]),f.useEffect(()=>()=>{p&&(h.layers.delete(p),h.layersWithOutsidePointerEventsDisabled.delete(p),Xd())},[p,h]),f.useEffect(()=>{const R=()=>y({});return document.addEventListener(Lo,R),()=>document.removeEventListener(Lo,R)},[]),e.jsx(Mr.div,{...u,ref:j,style:{pointerEvents:P?E?"auto":"none":void 0,...t.style},onFocusCapture:Ts(t.onFocusCapture,D.onFocusCapture),onBlurCapture:Ts(t.onBlurCapture,D.onBlurCapture),onPointerDownCapture:Ts(t.onPointerDownCapture,T.onPointerDownCapture)})});Eu.displayName=bg;var jg="DismissableLayerBranch",_g=f.forwardRef((t,r)=>{const a=f.useContext(Lu),i=f.useRef(null),o=Rr(r,i);return f.useEffect(()=>{const l=i.current;if(l)return a.branches.add(l),()=>{a.branches.delete(l)}},[a.branches]),e.jsx(Mr.div,{...t,ref:o})});_g.displayName=jg;function wg(t,r=globalThis==null?void 0:globalThis.document){const a=xi(t),i=f.useRef(!1),o=f.useRef(()=>{});return f.useEffect(()=>{const l=m=>{if(m.target&&!i.current){let u=function(){Ru(yg,a,h,{discrete:!0})};const h={originalEvent:m};m.pointerType==="touch"?(r.removeEventListener("click",o.current),o.current=u,r.addEventListener("click",o.current,{once:!0})):u()}else r.removeEventListener("click",o.current);i.current=!1},c=window.setTimeout(()=>{r.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(c),r.removeEventListener("pointerdown",l),r.removeEventListener("click",o.current)}},[r,a]),{onPointerDownCapture:()=>i.current=!0}}function Ng(t,r=globalThis==null?void 0:globalThis.document){const a=xi(t),i=f.useRef(!1);return f.useEffect(()=>{const o=l=>{l.target&&!i.current&&Ru(vg,a,{originalEvent:l},{discrete:!1})};return r.addEventListener("focusin",o),()=>r.removeEventListener("focusin",o)},[r,a]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function Xd(){const t=new CustomEvent(Lo);document.dispatchEvent(t)}function Ru(t,r,a,{discrete:i}){const o=a.originalEvent.target,l=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:a});r&&o.addEventListener(t,r,{once:!0}),i?fg(o,l):o.dispatchEvent(l)}var Pr=globalThis!=null&&globalThis.document?f.useLayoutEffect:()=>{},kg=Zo[" useId ".trim().toString()]||(()=>{}),Cg=0;function Sg(t){const[r,a]=f.useState(kg());return Pr(()=>{a(i=>i??String(Cg++))},[t]),r?`radix-${r}`:""}const Tg=["top","right","bottom","left"],nr=Math.min,Rt=Math.max,Qn=Math.round,In=Math.floor,fs=t=>({x:t,y:t}),Pg={left:"right",right:"left",bottom:"top",top:"bottom"},Lg={start:"end",end:"start"};function Eo(t,r,a){return Rt(t,nr(r,a))}function Ds(t,r){return typeof t=="function"?t(r):t}function Is(t){return t.split("-")[0]}function pa(t){return t.split("-")[1]}function cl(t){return t==="x"?"y":"x"}function ul(t){return t==="y"?"height":"width"}const Eg=new Set(["top","bottom"]);function xs(t){return Eg.has(Is(t))?"y":"x"}function ml(t){return cl(xs(t))}function Rg(t,r,a){a===void 0&&(a=!1);const i=pa(t),o=ml(t),l=ul(o);let c=o==="x"?i===(a?"end":"start")?"right":"left":i==="start"?"bottom":"top";return r.reference[l]>r.floating[l]&&(c=Yn(c)),[c,Yn(c)]}function Mg(t){const r=Yn(t);return[Ro(t),r,Ro(r)]}function Ro(t){return t.replace(/start|end/g,r=>Lg[r])}const ec=["left","right"],tc=["right","left"],Ag=["top","bottom"],Dg=["bottom","top"];function Ig(t,r,a){switch(t){case"top":case"bottom":return a?r?tc:ec:r?ec:tc;case"left":case"right":return r?Ag:Dg;default:return[]}}function Og(t,r,a,i){const o=pa(t);let l=Ig(Is(t),a==="start",i);return o&&(l=l.map(c=>c+"-"+o),r&&(l=l.concat(l.map(Ro)))),l}function Yn(t){return t.replace(/left|right|bottom|top/g,r=>Pg[r])}function zg(t){return{top:0,right:0,bottom:0,left:0,...t}}function Mu(t){return typeof t!="number"?zg(t):{top:t,right:t,bottom:t,left:t}}function Xn(t){const{x:r,y:a,width:i,height:o}=t;return{width:i,height:o,top:a,left:r,right:r+i,bottom:a+o,x:r,y:a}}function sc(t,r,a){let{reference:i,floating:o}=t;const l=xs(r),c=ml(r),m=ul(c),u=Is(r),h=l==="y",p=i.x+i.width/2-o.width/2,g=i.y+i.height/2-o.height/2,b=i[m]/2-o[m]/2;let y;switch(u){case"top":y={x:p,y:i.y-o.height};break;case"bottom":y={x:p,y:i.y+i.height};break;case"right":y={x:i.x+i.width,y:g};break;case"left":y={x:i.x-o.width,y:g};break;default:y={x:i.x,y:i.y}}switch(pa(r)){case"start":y[c]-=b*(a&&h?-1:1);break;case"end":y[c]+=b*(a&&h?-1:1);break}return y}const Fg=async(t,r,a)=>{const{placement:i="bottom",strategy:o="absolute",middleware:l=[],platform:c}=a,m=l.filter(Boolean),u=await(c.isRTL==null?void 0:c.isRTL(r));let h=await c.getElementRects({reference:t,floating:r,strategy:o}),{x:p,y:g}=sc(h,i,u),b=i,y={},j=0;for(let w=0;w<m.length;w++){const{name:N,fn:k}=m[w],{x:S,y:P,data:E,reset:T}=await k({x:p,y:g,initialPlacement:i,placement:b,strategy:o,middlewareData:y,rects:h,platform:c,elements:{reference:t,floating:r}});p=S??p,g=P??g,y={...y,[N]:{...y[N],...E}},T&&j<=50&&(j++,typeof T=="object"&&(T.placement&&(b=T.placement),T.rects&&(h=T.rects===!0?await c.getElementRects({reference:t,floating:r,strategy:o}):T.rects),{x:p,y:g}=sc(h,b,u)),w=-1)}return{x:p,y:g,placement:b,strategy:o,middlewareData:y}};async function Ha(t,r){var a;r===void 0&&(r={});const{x:i,y:o,platform:l,rects:c,elements:m,strategy:u}=t,{boundary:h="clippingAncestors",rootBoundary:p="viewport",elementContext:g="floating",altBoundary:b=!1,padding:y=0}=Ds(r,t),j=Mu(y),N=m[b?g==="floating"?"reference":"floating":g],k=Xn(await l.getClippingRect({element:(a=await(l.isElement==null?void 0:l.isElement(N)))==null||a?N:N.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(m.floating)),boundary:h,rootBoundary:p,strategy:u})),S=g==="floating"?{x:i,y:o,width:c.floating.width,height:c.floating.height}:c.reference,P=await(l.getOffsetParent==null?void 0:l.getOffsetParent(m.floating)),E=await(l.isElement==null?void 0:l.isElement(P))?await(l.getScale==null?void 0:l.getScale(P))||{x:1,y:1}:{x:1,y:1},T=Xn(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:m,rect:S,offsetParent:P,strategy:u}):S);return{top:(k.top-T.top+j.top)/E.y,bottom:(T.bottom-k.bottom+j.bottom)/E.y,left:(k.left-T.left+j.left)/E.x,right:(T.right-k.right+j.right)/E.x}}const Bg=t=>({name:"arrow",options:t,async fn(r){const{x:a,y:i,placement:o,rects:l,platform:c,elements:m,middlewareData:u}=r,{element:h,padding:p=0}=Ds(t,r)||{};if(h==null)return{};const g=Mu(p),b={x:a,y:i},y=ml(o),j=ul(y),w=await c.getDimensions(h),N=y==="y",k=N?"top":"left",S=N?"bottom":"right",P=N?"clientHeight":"clientWidth",E=l.reference[j]+l.reference[y]-b[y]-l.floating[j],T=b[y]-l.reference[y],D=await(c.getOffsetParent==null?void 0:c.getOffsetParent(h));let R=D?D[P]:0;(!R||!await(c.isElement==null?void 0:c.isElement(D)))&&(R=m.floating[P]||l.floating[j]);const _=E/2-T/2,M=R/2-w[j]/2-1,I=nr(g[k],M),O=nr(g[S],M),F=I,B=R-w[j]-O,q=R/2-w[j]/2+_,G=Eo(F,q,B),ee=!u.arrow&&pa(o)!=null&&q!==G&&l.reference[j]/2-(q<F?I:O)-w[j]/2<0,te=ee?q<F?q-F:q-B:0;return{[y]:b[y]+te,data:{[y]:G,centerOffset:q-G-te,...ee&&{alignmentOffset:te}},reset:ee}}}),$g=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(r){var a,i;const{placement:o,middlewareData:l,rects:c,initialPlacement:m,platform:u,elements:h}=r,{mainAxis:p=!0,crossAxis:g=!0,fallbackPlacements:b,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:j="none",flipAlignment:w=!0,...N}=Ds(t,r);if((a=l.arrow)!=null&&a.alignmentOffset)return{};const k=Is(o),S=xs(m),P=Is(m)===m,E=await(u.isRTL==null?void 0:u.isRTL(h.floating)),T=b||(P||!w?[Yn(m)]:Mg(m)),D=j!=="none";!b&&D&&T.push(...Og(m,w,j,E));const R=[m,...T],_=await Ha(r,N),M=[];let I=((i=l.flip)==null?void 0:i.overflows)||[];if(p&&M.push(_[k]),g){const q=Rg(o,c,E);M.push(_[q[0]],_[q[1]])}if(I=[...I,{placement:o,overflows:M}],!M.every(q=>q<=0)){var O,F;const q=(((O=l.flip)==null?void 0:O.index)||0)+1,G=R[q];if(G&&(!(g==="alignment"?S!==xs(G):!1)||I.every(W=>xs(W.placement)===S?W.overflows[0]>0:!0)))return{data:{index:q,overflows:I},reset:{placement:G}};let ee=(F=I.filter(te=>te.overflows[0]<=0).sort((te,W)=>te.overflows[1]-W.overflows[1])[0])==null?void 0:F.placement;if(!ee)switch(y){case"bestFit":{var B;const te=(B=I.filter(W=>{if(D){const me=xs(W.placement);return me===S||me==="y"}return!0}).map(W=>[W.placement,W.overflows.filter(me=>me>0).reduce((me,se)=>me+se,0)]).sort((W,me)=>W[1]-me[1])[0])==null?void 0:B[0];te&&(ee=te);break}case"initialPlacement":ee=m;break}if(o!==ee)return{reset:{placement:ee}}}return{}}}};function rc(t,r){return{top:t.top-r.height,right:t.right-r.width,bottom:t.bottom-r.height,left:t.left-r.width}}function ac(t){return Tg.some(r=>t[r]>=0)}const Zg=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(r){const{rects:a}=r,{strategy:i="referenceHidden",...o}=Ds(t,r);switch(i){case"referenceHidden":{const l=await Ha(r,{...o,elementContext:"reference"}),c=rc(l,a.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:ac(c)}}}case"escaped":{const l=await Ha(r,{...o,altBoundary:!0}),c=rc(l,a.floating);return{data:{escapedOffsets:c,escaped:ac(c)}}}default:return{}}}}},Au=new Set(["left","top"]);async function Ug(t,r){const{placement:a,platform:i,elements:o}=t,l=await(i.isRTL==null?void 0:i.isRTL(o.floating)),c=Is(a),m=pa(a),u=xs(a)==="y",h=Au.has(c)?-1:1,p=l&&u?-1:1,g=Ds(r,t);let{mainAxis:b,crossAxis:y,alignmentAxis:j}=typeof g=="number"?{mainAxis:g,crossAxis:0,alignmentAxis:null}:{mainAxis:g.mainAxis||0,crossAxis:g.crossAxis||0,alignmentAxis:g.alignmentAxis};return m&&typeof j=="number"&&(y=m==="end"?j*-1:j),u?{x:y*p,y:b*h}:{x:b*h,y:y*p}}const Hg=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(r){var a,i;const{x:o,y:l,placement:c,middlewareData:m}=r,u=await Ug(r,t);return c===((a=m.offset)==null?void 0:a.placement)&&(i=m.arrow)!=null&&i.alignmentOffset?{}:{x:o+u.x,y:l+u.y,data:{...u,placement:c}}}}},Wg=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(r){const{x:a,y:i,placement:o}=r,{mainAxis:l=!0,crossAxis:c=!1,limiter:m={fn:N=>{let{x:k,y:S}=N;return{x:k,y:S}}},...u}=Ds(t,r),h={x:a,y:i},p=await Ha(r,u),g=xs(Is(o)),b=cl(g);let y=h[b],j=h[g];if(l){const N=b==="y"?"top":"left",k=b==="y"?"bottom":"right",S=y+p[N],P=y-p[k];y=Eo(S,y,P)}if(c){const N=g==="y"?"top":"left",k=g==="y"?"bottom":"right",S=j+p[N],P=j-p[k];j=Eo(S,j,P)}const w=m.fn({...r,[b]:y,[g]:j});return{...w,data:{x:w.x-a,y:w.y-i,enabled:{[b]:l,[g]:c}}}}}},Vg=function(t){return t===void 0&&(t={}),{options:t,fn(r){const{x:a,y:i,placement:o,rects:l,middlewareData:c}=r,{offset:m=0,mainAxis:u=!0,crossAxis:h=!0}=Ds(t,r),p={x:a,y:i},g=xs(o),b=cl(g);let y=p[b],j=p[g];const w=Ds(m,r),N=typeof w=="number"?{mainAxis:w,crossAxis:0}:{mainAxis:0,crossAxis:0,...w};if(u){const P=b==="y"?"height":"width",E=l.reference[b]-l.floating[P]+N.mainAxis,T=l.reference[b]+l.reference[P]-N.mainAxis;y<E?y=E:y>T&&(y=T)}if(h){var k,S;const P=b==="y"?"width":"height",E=Au.has(Is(o)),T=l.reference[g]-l.floating[P]+(E&&((k=c.offset)==null?void 0:k[g])||0)+(E?0:N.crossAxis),D=l.reference[g]+l.reference[P]+(E?0:((S=c.offset)==null?void 0:S[g])||0)-(E?N.crossAxis:0);j<T?j=T:j>D&&(j=D)}return{[b]:y,[g]:j}}}},qg=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(r){var a,i;const{placement:o,rects:l,platform:c,elements:m}=r,{apply:u=()=>{},...h}=Ds(t,r),p=await Ha(r,h),g=Is(o),b=pa(o),y=xs(o)==="y",{width:j,height:w}=l.floating;let N,k;g==="top"||g==="bottom"?(N=g,k=b===(await(c.isRTL==null?void 0:c.isRTL(m.floating))?"start":"end")?"left":"right"):(k=g,N=b==="end"?"top":"bottom");const S=w-p.top-p.bottom,P=j-p.left-p.right,E=nr(w-p[N],S),T=nr(j-p[k],P),D=!r.middlewareData.shift;let R=E,_=T;if((a=r.middlewareData.shift)!=null&&a.enabled.x&&(_=P),(i=r.middlewareData.shift)!=null&&i.enabled.y&&(R=S),D&&!b){const I=Rt(p.left,0),O=Rt(p.right,0),F=Rt(p.top,0),B=Rt(p.bottom,0);y?_=j-2*(I!==0||O!==0?I+O:Rt(p.left,p.right)):R=w-2*(F!==0||B!==0?F+B:Rt(p.top,p.bottom))}await u({...r,availableWidth:_,availableHeight:R});const M=await c.getDimensions(m.floating);return j!==M.width||w!==M.height?{reset:{rects:!0}}:{}}}};function pi(){return typeof window<"u"}function fa(t){return Du(t)?(t.nodeName||"").toLowerCase():"#document"}function At(t){var r;return(t==null||(r=t.ownerDocument)==null?void 0:r.defaultView)||window}function vs(t){var r;return(r=(Du(t)?t.ownerDocument:t.document)||window.document)==null?void 0:r.documentElement}function Du(t){return pi()?t instanceof Node||t instanceof At(t).Node:!1}function Xt(t){return pi()?t instanceof Element||t instanceof At(t).Element:!1}function bs(t){return pi()?t instanceof HTMLElement||t instanceof At(t).HTMLElement:!1}function nc(t){return!pi()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof At(t).ShadowRoot}const Gg=new Set(["inline","contents"]);function ln(t){const{overflow:r,overflowX:a,overflowY:i,display:o}=es(t);return/auto|scroll|overlay|hidden|clip/.test(r+i+a)&&!Gg.has(o)}const Kg=new Set(["table","td","th"]);function Jg(t){return Kg.has(fa(t))}const Qg=[":popover-open",":modal"];function fi(t){return Qg.some(r=>{try{return t.matches(r)}catch{return!1}})}const Yg=["transform","translate","scale","rotate","perspective"],Xg=["transform","translate","scale","rotate","perspective","filter"],eb=["paint","layout","strict","content"];function hl(t){const r=xl(),a=Xt(t)?es(t):t;return Yg.some(i=>a[i]?a[i]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!r&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!r&&(a.filter?a.filter!=="none":!1)||Xg.some(i=>(a.willChange||"").includes(i))||eb.some(i=>(a.contain||"").includes(i))}function tb(t){let r=ir(t);for(;bs(r)&&!la(r);){if(hl(r))return r;if(fi(r))return null;r=ir(r)}return null}function xl(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const sb=new Set(["html","body","#document"]);function la(t){return sb.has(fa(t))}function es(t){return At(t).getComputedStyle(t)}function gi(t){return Xt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function ir(t){if(fa(t)==="html")return t;const r=t.assignedSlot||t.parentNode||nc(t)&&t.host||vs(t);return nc(r)?r.host:r}function Iu(t){const r=ir(t);return la(r)?t.ownerDocument?t.ownerDocument.body:t.body:bs(r)&&ln(r)?r:Iu(r)}function Wa(t,r,a){var i;r===void 0&&(r=[]),a===void 0&&(a=!0);const o=Iu(t),l=o===((i=t.ownerDocument)==null?void 0:i.body),c=At(o);if(l){const m=Mo(c);return r.concat(c,c.visualViewport||[],ln(o)?o:[],m&&a?Wa(m):[])}return r.concat(o,Wa(o,[],a))}function Mo(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Ou(t){const r=es(t);let a=parseFloat(r.width)||0,i=parseFloat(r.height)||0;const o=bs(t),l=o?t.offsetWidth:a,c=o?t.offsetHeight:i,m=Qn(a)!==l||Qn(i)!==c;return m&&(a=l,i=c),{width:a,height:i,$:m}}function pl(t){return Xt(t)?t:t.contextElement}function Wr(t){const r=pl(t);if(!bs(r))return fs(1);const a=r.getBoundingClientRect(),{width:i,height:o,$:l}=Ou(r);let c=(l?Qn(a.width):a.width)/i,m=(l?Qn(a.height):a.height)/o;return(!c||!Number.isFinite(c))&&(c=1),(!m||!Number.isFinite(m))&&(m=1),{x:c,y:m}}const rb=fs(0);function zu(t){const r=At(t);return!xl()||!r.visualViewport?rb:{x:r.visualViewport.offsetLeft,y:r.visualViewport.offsetTop}}function ab(t,r,a){return r===void 0&&(r=!1),!a||r&&a!==At(t)?!1:r}function Lr(t,r,a,i){r===void 0&&(r=!1),a===void 0&&(a=!1);const o=t.getBoundingClientRect(),l=pl(t);let c=fs(1);r&&(i?Xt(i)&&(c=Wr(i)):c=Wr(t));const m=ab(l,a,i)?zu(l):fs(0);let u=(o.left+m.x)/c.x,h=(o.top+m.y)/c.y,p=o.width/c.x,g=o.height/c.y;if(l){const b=At(l),y=i&&Xt(i)?At(i):i;let j=b,w=Mo(j);for(;w&&i&&y!==j;){const N=Wr(w),k=w.getBoundingClientRect(),S=es(w),P=k.left+(w.clientLeft+parseFloat(S.paddingLeft))*N.x,E=k.top+(w.clientTop+parseFloat(S.paddingTop))*N.y;u*=N.x,h*=N.y,p*=N.x,g*=N.y,u+=P,h+=E,j=At(w),w=Mo(j)}}return Xn({width:p,height:g,x:u,y:h})}function bi(t,r){const a=gi(t).scrollLeft;return r?r.left+a:Lr(vs(t)).left+a}function Fu(t,r){const a=t.getBoundingClientRect(),i=a.left+r.scrollLeft-bi(t,a),o=a.top+r.scrollTop;return{x:i,y:o}}function nb(t){let{elements:r,rect:a,offsetParent:i,strategy:o}=t;const l=o==="fixed",c=vs(i),m=r?fi(r.floating):!1;if(i===c||m&&l)return a;let u={scrollLeft:0,scrollTop:0},h=fs(1);const p=fs(0),g=bs(i);if((g||!g&&!l)&&((fa(i)!=="body"||ln(c))&&(u=gi(i)),bs(i))){const y=Lr(i);h=Wr(i),p.x=y.x+i.clientLeft,p.y=y.y+i.clientTop}const b=c&&!g&&!l?Fu(c,u):fs(0);return{width:a.width*h.x,height:a.height*h.y,x:a.x*h.x-u.scrollLeft*h.x+p.x+b.x,y:a.y*h.y-u.scrollTop*h.y+p.y+b.y}}function ib(t){return Array.from(t.getClientRects())}function ob(t){const r=vs(t),a=gi(t),i=t.ownerDocument.body,o=Rt(r.scrollWidth,r.clientWidth,i.scrollWidth,i.clientWidth),l=Rt(r.scrollHeight,r.clientHeight,i.scrollHeight,i.clientHeight);let c=-a.scrollLeft+bi(t);const m=-a.scrollTop;return es(i).direction==="rtl"&&(c+=Rt(r.clientWidth,i.clientWidth)-o),{width:o,height:l,x:c,y:m}}const ic=25;function lb(t,r){const a=At(t),i=vs(t),o=a.visualViewport;let l=i.clientWidth,c=i.clientHeight,m=0,u=0;if(o){l=o.width,c=o.height;const p=xl();(!p||p&&r==="fixed")&&(m=o.offsetLeft,u=o.offsetTop)}const h=bi(i);if(h<=0){const p=i.ownerDocument,g=p.body,b=getComputedStyle(g),y=p.compatMode==="CSS1Compat"&&parseFloat(b.marginLeft)+parseFloat(b.marginRight)||0,j=Math.abs(i.clientWidth-g.clientWidth-y);j<=ic&&(l-=j)}else h<=ic&&(l+=h);return{width:l,height:c,x:m,y:u}}const db=new Set(["absolute","fixed"]);function cb(t,r){const a=Lr(t,!0,r==="fixed"),i=a.top+t.clientTop,o=a.left+t.clientLeft,l=bs(t)?Wr(t):fs(1),c=t.clientWidth*l.x,m=t.clientHeight*l.y,u=o*l.x,h=i*l.y;return{width:c,height:m,x:u,y:h}}function oc(t,r,a){let i;if(r==="viewport")i=lb(t,a);else if(r==="document")i=ob(vs(t));else if(Xt(r))i=cb(r,a);else{const o=zu(t);i={x:r.x-o.x,y:r.y-o.y,width:r.width,height:r.height}}return Xn(i)}function Bu(t,r){const a=ir(t);return a===r||!Xt(a)||la(a)?!1:es(a).position==="fixed"||Bu(a,r)}function ub(t,r){const a=r.get(t);if(a)return a;let i=Wa(t,[],!1).filter(m=>Xt(m)&&fa(m)!=="body"),o=null;const l=es(t).position==="fixed";let c=l?ir(t):t;for(;Xt(c)&&!la(c);){const m=es(c),u=hl(c);!u&&m.position==="fixed"&&(o=null),(l?!u&&!o:!u&&m.position==="static"&&!!o&&db.has(o.position)||ln(c)&&!u&&Bu(t,c))?i=i.filter(p=>p!==c):o=m,c=ir(c)}return r.set(t,i),i}function mb(t){let{element:r,boundary:a,rootBoundary:i,strategy:o}=t;const c=[...a==="clippingAncestors"?fi(r)?[]:ub(r,this._c):[].concat(a),i],m=c[0],u=c.reduce((h,p)=>{const g=oc(r,p,o);return h.top=Rt(g.top,h.top),h.right=nr(g.right,h.right),h.bottom=nr(g.bottom,h.bottom),h.left=Rt(g.left,h.left),h},oc(r,m,o));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function hb(t){const{width:r,height:a}=Ou(t);return{width:r,height:a}}function xb(t,r,a){const i=bs(r),o=vs(r),l=a==="fixed",c=Lr(t,!0,l,r);let m={scrollLeft:0,scrollTop:0};const u=fs(0);function h(){u.x=bi(o)}if(i||!i&&!l)if((fa(r)!=="body"||ln(o))&&(m=gi(r)),i){const y=Lr(r,!0,l,r);u.x=y.x+r.clientLeft,u.y=y.y+r.clientTop}else o&&h();l&&!i&&o&&h();const p=o&&!i&&!l?Fu(o,m):fs(0),g=c.left+m.scrollLeft-u.x-p.x,b=c.top+m.scrollTop-u.y-p.y;return{x:g,y:b,width:c.width,height:c.height}}function ro(t){return es(t).position==="static"}function lc(t,r){if(!bs(t)||es(t).position==="fixed")return null;if(r)return r(t);let a=t.offsetParent;return vs(t)===a&&(a=a.ownerDocument.body),a}function $u(t,r){const a=At(t);if(fi(t))return a;if(!bs(t)){let o=ir(t);for(;o&&!la(o);){if(Xt(o)&&!ro(o))return o;o=ir(o)}return a}let i=lc(t,r);for(;i&&Jg(i)&&ro(i);)i=lc(i,r);return i&&la(i)&&ro(i)&&!hl(i)?a:i||tb(t)||a}const pb=async function(t){const r=this.getOffsetParent||$u,a=this.getDimensions,i=await a(t.floating);return{reference:xb(t.reference,await r(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function fb(t){return es(t).direction==="rtl"}const gb={convertOffsetParentRelativeRectToViewportRelativeRect:nb,getDocumentElement:vs,getClippingRect:mb,getOffsetParent:$u,getElementRects:pb,getClientRects:ib,getDimensions:hb,getScale:Wr,isElement:Xt,isRTL:fb};function Zu(t,r){return t.x===r.x&&t.y===r.y&&t.width===r.width&&t.height===r.height}function bb(t,r){let a=null,i;const o=vs(t);function l(){var m;clearTimeout(i),(m=a)==null||m.disconnect(),a=null}function c(m,u){m===void 0&&(m=!1),u===void 0&&(u=1),l();const h=t.getBoundingClientRect(),{left:p,top:g,width:b,height:y}=h;if(m||r(),!b||!y)return;const j=In(g),w=In(o.clientWidth-(p+b)),N=In(o.clientHeight-(g+y)),k=In(p),P={rootMargin:-j+"px "+-w+"px "+-N+"px "+-k+"px",threshold:Rt(0,nr(1,u))||1};let E=!0;function T(D){const R=D[0].intersectionRatio;if(R!==u){if(!E)return c();R?c(!1,R):i=setTimeout(()=>{c(!1,1e-7)},1e3)}R===1&&!Zu(h,t.getBoundingClientRect())&&c(),E=!1}try{a=new IntersectionObserver(T,{...P,root:o.ownerDocument})}catch{a=new IntersectionObserver(T,P)}a.observe(t)}return c(!0),l}function yb(t,r,a,i){i===void 0&&(i={});const{ancestorScroll:o=!0,ancestorResize:l=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:m=typeof IntersectionObserver=="function",animationFrame:u=!1}=i,h=pl(t),p=o||l?[...h?Wa(h):[],...Wa(r)]:[];p.forEach(k=>{o&&k.addEventListener("scroll",a,{passive:!0}),l&&k.addEventListener("resize",a)});const g=h&&m?bb(h,a):null;let b=-1,y=null;c&&(y=new ResizeObserver(k=>{let[S]=k;S&&S.target===h&&y&&(y.unobserve(r),cancelAnimationFrame(b),b=requestAnimationFrame(()=>{var P;(P=y)==null||P.observe(r)})),a()}),h&&!u&&y.observe(h),y.observe(r));let j,w=u?Lr(t):null;u&&N();function N(){const k=Lr(t);w&&!Zu(w,k)&&a(),w=k,j=requestAnimationFrame(N)}return a(),()=>{var k;p.forEach(S=>{o&&S.removeEventListener("scroll",a),l&&S.removeEventListener("resize",a)}),g==null||g(),(k=y)==null||k.disconnect(),y=null,u&&cancelAnimationFrame(j)}}const vb=Hg,jb=Wg,_b=$g,wb=qg,Nb=Zg,dc=Bg,kb=Vg,Cb=(t,r,a)=>{const i=new Map,o={platform:gb,...a},l={...o.platform,_c:i};return Fg(t,r,{...o,platform:l})};var Sb=typeof document<"u",Tb=function(){},Zn=Sb?f.useLayoutEffect:Tb;function ei(t,r){if(t===r)return!0;if(typeof t!=typeof r)return!1;if(typeof t=="function"&&t.toString()===r.toString())return!0;let a,i,o;if(t&&r&&typeof t=="object"){if(Array.isArray(t)){if(a=t.length,a!==r.length)return!1;for(i=a;i--!==0;)if(!ei(t[i],r[i]))return!1;return!0}if(o=Object.keys(t),a=o.length,a!==Object.keys(r).length)return!1;for(i=a;i--!==0;)if(!{}.hasOwnProperty.call(r,o[i]))return!1;for(i=a;i--!==0;){const l=o[i];if(!(l==="_owner"&&t.$$typeof)&&!ei(t[l],r[l]))return!1}return!0}return t!==t&&r!==r}function Uu(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function cc(t,r){const a=Uu(t);return Math.round(r*a)/a}function ao(t){const r=f.useRef(t);return Zn(()=>{r.current=t}),r}function Pb(t){t===void 0&&(t={});const{placement:r="bottom",strategy:a="absolute",middleware:i=[],platform:o,elements:{reference:l,floating:c}={},transform:m=!0,whileElementsMounted:u,open:h}=t,[p,g]=f.useState({x:0,y:0,strategy:a,placement:r,middlewareData:{},isPositioned:!1}),[b,y]=f.useState(i);ei(b,i)||y(i);const[j,w]=f.useState(null),[N,k]=f.useState(null),S=f.useCallback(W=>{W!==D.current&&(D.current=W,w(W))},[]),P=f.useCallback(W=>{W!==R.current&&(R.current=W,k(W))},[]),E=l||j,T=c||N,D=f.useRef(null),R=f.useRef(null),_=f.useRef(p),M=u!=null,I=ao(u),O=ao(o),F=ao(h),B=f.useCallback(()=>{if(!D.current||!R.current)return;const W={placement:r,strategy:a,middleware:b};O.current&&(W.platform=O.current),Cb(D.current,R.current,W).then(me=>{const se={...me,isPositioned:F.current!==!1};q.current&&!ei(_.current,se)&&(_.current=se,ii.flushSync(()=>{g(se)}))})},[b,r,a,O,F]);Zn(()=>{h===!1&&_.current.isPositioned&&(_.current.isPositioned=!1,g(W=>({...W,isPositioned:!1})))},[h]);const q=f.useRef(!1);Zn(()=>(q.current=!0,()=>{q.current=!1}),[]),Zn(()=>{if(E&&(D.current=E),T&&(R.current=T),E&&T){if(I.current)return I.current(E,T,B);B()}},[E,T,B,I,M]);const G=f.useMemo(()=>({reference:D,floating:R,setReference:S,setFloating:P}),[S,P]),ee=f.useMemo(()=>({reference:E,floating:T}),[E,T]),te=f.useMemo(()=>{const W={position:a,left:0,top:0};if(!ee.floating)return W;const me=cc(ee.floating,p.x),se=cc(ee.floating,p.y);return m?{...W,transform:"translate("+me+"px, "+se+"px)",...Uu(ee.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:me,top:se}},[a,m,ee.floating,p.x,p.y]);return f.useMemo(()=>({...p,update:B,refs:G,elements:ee,floatingStyles:te}),[p,B,G,ee,te])}const Lb=t=>{function r(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:t,fn(a){const{element:i,padding:o}=typeof t=="function"?t(a):t;return i&&r(i)?i.current!=null?dc({element:i.current,padding:o}).fn(a):{}:i?dc({element:i,padding:o}).fn(a):{}}}},Eb=(t,r)=>({...vb(t),options:[t,r]}),Rb=(t,r)=>({...jb(t),options:[t,r]}),Mb=(t,r)=>({...kb(t),options:[t,r]}),Ab=(t,r)=>({..._b(t),options:[t,r]}),Db=(t,r)=>({...wb(t),options:[t,r]}),Ib=(t,r)=>({...Nb(t),options:[t,r]}),Ob=(t,r)=>({...Lb(t),options:[t,r]});var zb="Arrow",Hu=f.forwardRef((t,r)=>{const{children:a,width:i=10,height:o=5,...l}=t;return e.jsx(Mr.svg,{...l,ref:r,width:i,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?a:e.jsx("polygon",{points:"0,0 30,0 15,10"})})});Hu.displayName=zb;var Fb=Hu;function Bb(t){const[r,a]=f.useState(void 0);return Pr(()=>{if(t){a({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const l=o[0];let c,m;if("borderBoxSize"in l){const u=l.borderBoxSize,h=Array.isArray(u)?u[0]:u;c=h.inlineSize,m=h.blockSize}else c=t.offsetWidth,m=t.offsetHeight;a({width:c,height:m})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else a(void 0)},[t]),r}var fl="Popper",[Wu,Vu]=Pu(fl),[$b,qu]=Wu(fl),Gu=t=>{const{__scopePopper:r,children:a}=t,[i,o]=f.useState(null);return e.jsx($b,{scope:r,anchor:i,onAnchorChange:o,children:a})};Gu.displayName=fl;var Ku="PopperAnchor",Ju=f.forwardRef((t,r)=>{const{__scopePopper:a,virtualRef:i,...o}=t,l=qu(Ku,a),c=f.useRef(null),m=Rr(r,c),u=f.useRef(null);return f.useEffect(()=>{const h=u.current;u.current=(i==null?void 0:i.current)||c.current,h!==u.current&&l.onAnchorChange(u.current)}),i?null:e.jsx(Mr.div,{...o,ref:m})});Ju.displayName=Ku;var gl="PopperContent",[Zb,Ub]=Wu(gl),Qu=f.forwardRef((t,r)=>{var ce,pe,$e,We,Le,xe;const{__scopePopper:a,side:i="bottom",sideOffset:o=0,align:l="center",alignOffset:c=0,arrowPadding:m=0,avoidCollisions:u=!0,collisionBoundary:h=[],collisionPadding:p=0,sticky:g="partial",hideWhenDetached:b=!1,updatePositionStrategy:y="optimized",onPlaced:j,...w}=t,N=qu(gl,a),[k,S]=f.useState(null),P=Rr(r,Me=>S(Me)),[E,T]=f.useState(null),D=Bb(E),R=(D==null?void 0:D.width)??0,_=(D==null?void 0:D.height)??0,M=i+(l!=="center"?"-"+l:""),I=typeof p=="number"?p:{top:0,right:0,bottom:0,left:0,...p},O=Array.isArray(h)?h:[h],F=O.length>0,B={padding:I,boundary:O.filter(Wb),altBoundary:F},{refs:q,floatingStyles:G,placement:ee,isPositioned:te,middlewareData:W}=Pb({strategy:"fixed",placement:M,whileElementsMounted:(...Me)=>yb(...Me,{animationFrame:y==="always"}),elements:{reference:N.anchor},middleware:[Eb({mainAxis:o+_,alignmentAxis:c}),u&&Rb({mainAxis:!0,crossAxis:!1,limiter:g==="partial"?Mb():void 0,...B}),u&&Ab({...B}),Db({...B,apply:({elements:Me,rects:Ze,availableWidth:Dt,availableHeight:zs})=>{const{width:rs,height:Ee}=Ze.reference,Lt=Me.floating.style;Lt.setProperty("--radix-popper-available-width",`${Dt}px`),Lt.setProperty("--radix-popper-available-height",`${zs}px`),Lt.setProperty("--radix-popper-anchor-width",`${rs}px`),Lt.setProperty("--radix-popper-anchor-height",`${Ee}px`)}}),E&&Ob({element:E,padding:m}),Vb({arrowWidth:R,arrowHeight:_}),b&&Ib({strategy:"referenceHidden",...B})]}),[me,se]=em(ee),ie=xi(j);Pr(()=>{te&&(ie==null||ie())},[te,ie]);const ge=(ce=W.arrow)==null?void 0:ce.x,U=(pe=W.arrow)==null?void 0:pe.y,V=(($e=W.arrow)==null?void 0:$e.centerOffset)!==0,[Y,Q]=f.useState();return Pr(()=>{k&&Q(window.getComputedStyle(k).zIndex)},[k]),e.jsx("div",{ref:q.setFloating,"data-radix-popper-content-wrapper":"",style:{...G,transform:te?G.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Y,"--radix-popper-transform-origin":[(We=W.transformOrigin)==null?void 0:We.x,(Le=W.transformOrigin)==null?void 0:Le.y].join(" "),...((xe=W.hide)==null?void 0:xe.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:e.jsx(Zb,{scope:a,placedSide:me,onArrowChange:T,arrowX:ge,arrowY:U,shouldHideArrow:V,children:e.jsx(Mr.div,{"data-side":me,"data-align":se,...w,ref:P,style:{...w.style,animation:te?void 0:"none"}})})})});Qu.displayName=gl;var Yu="PopperArrow",Hb={top:"bottom",right:"left",bottom:"top",left:"right"},Xu=f.forwardRef(function(r,a){const{__scopePopper:i,...o}=r,l=Ub(Yu,i),c=Hb[l.placedSide];return e.jsx("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[c]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0},children:e.jsx(Fb,{...o,ref:a,style:{...o.style,display:"block"}})})});Xu.displayName=Yu;function Wb(t){return t!==null}var Vb=t=>({name:"transformOrigin",options:t,fn(r){var N,k,S;const{placement:a,rects:i,middlewareData:o}=r,c=((N=o.arrow)==null?void 0:N.centerOffset)!==0,m=c?0:t.arrowWidth,u=c?0:t.arrowHeight,[h,p]=em(a),g={start:"0%",center:"50%",end:"100%"}[p],b=(((k=o.arrow)==null?void 0:k.x)??0)+m/2,y=(((S=o.arrow)==null?void 0:S.y)??0)+u/2;let j="",w="";return h==="bottom"?(j=c?g:`${b}px`,w=`${-u}px`):h==="top"?(j=c?g:`${b}px`,w=`${i.floating.height+u}px`):h==="right"?(j=`${-u}px`,w=c?g:`${y}px`):h==="left"&&(j=`${i.floating.width+u}px`,w=c?g:`${y}px`),{data:{x:j,y:w}}}});function em(t){const[r,a="center"]=t.split("-");return[r,a]}var qb=Gu,Gb=Ju,Kb=Qu,Jb=Xu;function Qb(t,r){return f.useReducer((a,i)=>r[a][i]??a,t)}var tm=t=>{const{present:r,children:a}=t,i=Yb(r),o=typeof a=="function"?a({present:i.isPresent}):f.Children.only(a),l=Rr(i.ref,Xb(o));return typeof a=="function"||i.isPresent?f.cloneElement(o,{ref:l}):null};tm.displayName="Presence";function Yb(t){const[r,a]=f.useState(),i=f.useRef(null),o=f.useRef(t),l=f.useRef("none"),c=t?"mounted":"unmounted",[m,u]=Qb(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return f.useEffect(()=>{const h=On(i.current);l.current=m==="mounted"?h:"none"},[m]),Pr(()=>{const h=i.current,p=o.current;if(p!==t){const b=l.current,y=On(h);t?u("MOUNT"):y==="none"||(h==null?void 0:h.display)==="none"?u("UNMOUNT"):u(p&&b!==y?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,u]),Pr(()=>{if(r){let h;const p=r.ownerDocument.defaultView??window,g=y=>{const w=On(i.current).includes(CSS.escape(y.animationName));if(y.target===r&&w&&(u("ANIMATION_END"),!o.current)){const N=r.style.animationFillMode;r.style.animationFillMode="forwards",h=p.setTimeout(()=>{r.style.animationFillMode==="forwards"&&(r.style.animationFillMode=N)})}},b=y=>{y.target===r&&(l.current=On(i.current))};return r.addEventListener("animationstart",b),r.addEventListener("animationcancel",g),r.addEventListener("animationend",g),()=>{p.clearTimeout(h),r.removeEventListener("animationstart",b),r.removeEventListener("animationcancel",g),r.removeEventListener("animationend",g)}}else u("ANIMATION_END")},[r,u]),{isPresent:["mounted","unmountSuspended"].includes(m),ref:f.useCallback(h=>{i.current=h?getComputedStyle(h):null,a(h)},[])}}function On(t){return(t==null?void 0:t.animationName)||"none"}function Xb(t){var i,o;let r=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,a=r&&"isReactWarning"in r&&r.isReactWarning;return a?t.ref:(r=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,a=r&&"isReactWarning"in r&&r.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}var ey=Symbol("radix.slottable");function ty(t){const r=({children:a})=>e.jsx(e.Fragment,{children:a});return r.displayName=`${t}.Slottable`,r.__radixId=ey,r}var sy=Zo[" useInsertionEffect ".trim().toString()]||Pr;function ry({prop:t,defaultProp:r,onChange:a=()=>{},caller:i}){const[o,l,c]=ay({defaultProp:r,onChange:a}),m=t!==void 0,u=m?t:o;{const p=f.useRef(t!==void 0);f.useEffect(()=>{const g=p.current;g!==m&&console.warn(`${i} is changing from ${g?"controlled":"uncontrolled"} to ${m?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=m},[m,i])}const h=f.useCallback(p=>{var g;if(m){const b=ny(p)?p(t):p;b!==t&&((g=c.current)==null||g.call(c,b))}else l(p)},[m,t,l,c]);return[u,h]}function ay({defaultProp:t,onChange:r}){const[a,i]=f.useState(t),o=f.useRef(a),l=f.useRef(r);return sy(()=>{l.current=r},[r]),f.useEffect(()=>{var c;o.current!==a&&((c=l.current)==null||c.call(l,a),o.current=a)},[a,o]),[a,i,l]}function ny(t){return typeof t=="function"}var iy=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),oy="VisuallyHidden",sm=f.forwardRef((t,r)=>e.jsx(Mr.span,{...t,ref:r,style:{...iy,...t.style}}));sm.displayName=oy;var ly=sm,[yi]=Pu("Tooltip",[Vu]),vi=Vu(),rm="TooltipProvider",dy=700,Ao="tooltip.open",[cy,bl]=yi(rm),am=t=>{const{__scopeTooltip:r,delayDuration:a=dy,skipDelayDuration:i=300,disableHoverableContent:o=!1,children:l}=t,c=f.useRef(!0),m=f.useRef(!1),u=f.useRef(0);return f.useEffect(()=>{const h=u.current;return()=>window.clearTimeout(h)},[]),e.jsx(cy,{scope:r,isOpenDelayedRef:c,delayDuration:a,onOpen:f.useCallback(()=>{window.clearTimeout(u.current),c.current=!1},[]),onClose:f.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>c.current=!0,i)},[i]),isPointerInTransitRef:m,onPointerInTransitChange:f.useCallback(h=>{m.current=h},[]),disableHoverableContent:o,children:l})};am.displayName=rm;var Va="Tooltip",[uy,ji]=yi(Va),nm=t=>{const{__scopeTooltip:r,children:a,open:i,defaultOpen:o,onOpenChange:l,disableHoverableContent:c,delayDuration:m}=t,u=bl(Va,t.__scopeTooltip),h=vi(r),[p,g]=f.useState(null),b=Sg(),y=f.useRef(0),j=c??u.disableHoverableContent,w=m??u.delayDuration,N=f.useRef(!1),[k,S]=ry({prop:i,defaultProp:o??!1,onChange:R=>{R?(u.onOpen(),document.dispatchEvent(new CustomEvent(Ao))):u.onClose(),l==null||l(R)},caller:Va}),P=f.useMemo(()=>k?N.current?"delayed-open":"instant-open":"closed",[k]),E=f.useCallback(()=>{window.clearTimeout(y.current),y.current=0,N.current=!1,S(!0)},[S]),T=f.useCallback(()=>{window.clearTimeout(y.current),y.current=0,S(!1)},[S]),D=f.useCallback(()=>{window.clearTimeout(y.current),y.current=window.setTimeout(()=>{N.current=!0,S(!0),y.current=0},w)},[w,S]);return f.useEffect(()=>()=>{y.current&&(window.clearTimeout(y.current),y.current=0)},[]),e.jsx(qb,{...h,children:e.jsx(uy,{scope:r,contentId:b,open:k,stateAttribute:P,trigger:p,onTriggerChange:g,onTriggerEnter:f.useCallback(()=>{u.isOpenDelayedRef.current?D():E()},[u.isOpenDelayedRef,D,E]),onTriggerLeave:f.useCallback(()=>{j?T():(window.clearTimeout(y.current),y.current=0)},[T,j]),onOpen:E,onClose:T,disableHoverableContent:j,children:a})})};nm.displayName=Va;var Do="TooltipTrigger",im=f.forwardRef((t,r)=>{const{__scopeTooltip:a,...i}=t,o=ji(Do,a),l=bl(Do,a),c=vi(a),m=f.useRef(null),u=Rr(r,m,o.onTriggerChange),h=f.useRef(!1),p=f.useRef(!1),g=f.useCallback(()=>h.current=!1,[]);return f.useEffect(()=>()=>document.removeEventListener("pointerup",g),[g]),e.jsx(Gb,{asChild:!0,...c,children:e.jsx(Mr.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...i,ref:u,onPointerMove:Ts(t.onPointerMove,b=>{b.pointerType!=="touch"&&!p.current&&!l.isPointerInTransitRef.current&&(o.onTriggerEnter(),p.current=!0)}),onPointerLeave:Ts(t.onPointerLeave,()=>{o.onTriggerLeave(),p.current=!1}),onPointerDown:Ts(t.onPointerDown,()=>{o.open&&o.onClose(),h.current=!0,document.addEventListener("pointerup",g,{once:!0})}),onFocus:Ts(t.onFocus,()=>{h.current||o.onOpen()}),onBlur:Ts(t.onBlur,o.onClose),onClick:Ts(t.onClick,o.onClose)})})});im.displayName=Do;var my="TooltipPortal",[Z_,hy]=yi(my,{forceMount:void 0}),da="TooltipContent",om=f.forwardRef((t,r)=>{const a=hy(da,t.__scopeTooltip),{forceMount:i=a.forceMount,side:o="top",...l}=t,c=ji(da,t.__scopeTooltip);return e.jsx(tm,{present:i||c.open,children:c.disableHoverableContent?e.jsx(lm,{side:o,...l,ref:r}):e.jsx(xy,{side:o,...l,ref:r})})}),xy=f.forwardRef((t,r)=>{const a=ji(da,t.__scopeTooltip),i=bl(da,t.__scopeTooltip),o=f.useRef(null),l=Rr(r,o),[c,m]=f.useState(null),{trigger:u,onClose:h}=a,p=o.current,{onPointerInTransitChange:g}=i,b=f.useCallback(()=>{m(null),g(!1)},[g]),y=f.useCallback((j,w)=>{const N=j.currentTarget,k={x:j.clientX,y:j.clientY},S=yy(k,N.getBoundingClientRect()),P=vy(k,S),E=jy(w.getBoundingClientRect()),T=wy([...P,...E]);m(T),g(!0)},[g]);return f.useEffect(()=>()=>b(),[b]),f.useEffect(()=>{if(u&&p){const j=N=>y(N,p),w=N=>y(N,u);return u.addEventListener("pointerleave",j),p.addEventListener("pointerleave",w),()=>{u.removeEventListener("pointerleave",j),p.removeEventListener("pointerleave",w)}}},[u,p,y,b]),f.useEffect(()=>{if(c){const j=w=>{const N=w.target,k={x:w.clientX,y:w.clientY},S=(u==null?void 0:u.contains(N))||(p==null?void 0:p.contains(N)),P=!_y(k,c);S?b():P&&(b(),h())};return document.addEventListener("pointermove",j),()=>document.removeEventListener("pointermove",j)}},[u,p,c,h,b]),e.jsx(lm,{...t,ref:l})}),[py,fy]=yi(Va,{isInside:!1}),gy=ty("TooltipContent"),lm=f.forwardRef((t,r)=>{const{__scopeTooltip:a,children:i,"aria-label":o,onEscapeKeyDown:l,onPointerDownOutside:c,...m}=t,u=ji(da,a),h=vi(a),{onClose:p}=u;return f.useEffect(()=>(document.addEventListener(Ao,p),()=>document.removeEventListener(Ao,p)),[p]),f.useEffect(()=>{if(u.trigger){const g=b=>{const y=b.target;y!=null&&y.contains(u.trigger)&&p()};return window.addEventListener("scroll",g,{capture:!0}),()=>window.removeEventListener("scroll",g,{capture:!0})}},[u.trigger,p]),e.jsx(Eu,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:g=>g.preventDefault(),onDismiss:p,children:e.jsxs(Kb,{"data-state":u.stateAttribute,...h,...m,ref:r,style:{...m.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(gy,{children:i}),e.jsx(py,{scope:a,isInside:!0,children:e.jsx(ly,{id:u.contentId,role:"tooltip",children:o||i})})]})})});om.displayName=da;var dm="TooltipArrow",by=f.forwardRef((t,r)=>{const{__scopeTooltip:a,...i}=t,o=vi(a);return fy(dm,a).isInside?null:e.jsx(Jb,{...o,...i,ref:r})});by.displayName=dm;function yy(t,r){const a=Math.abs(r.top-t.y),i=Math.abs(r.bottom-t.y),o=Math.abs(r.right-t.x),l=Math.abs(r.left-t.x);switch(Math.min(a,i,o,l)){case l:return"left";case o:return"right";case a:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function vy(t,r,a=5){const i=[];switch(r){case"top":i.push({x:t.x-a,y:t.y+a},{x:t.x+a,y:t.y+a});break;case"bottom":i.push({x:t.x-a,y:t.y-a},{x:t.x+a,y:t.y-a});break;case"left":i.push({x:t.x+a,y:t.y-a},{x:t.x+a,y:t.y+a});break;case"right":i.push({x:t.x-a,y:t.y-a},{x:t.x-a,y:t.y+a});break}return i}function jy(t){const{top:r,right:a,bottom:i,left:o}=t;return[{x:o,y:r},{x:a,y:r},{x:a,y:i},{x:o,y:i}]}function _y(t,r){const{x:a,y:i}=t;let o=!1;for(let l=0,c=r.length-1;l<r.length;c=l++){const m=r[l],u=r[c],h=m.x,p=m.y,g=u.x,b=u.y;p>i!=b>i&&a<(g-h)*(i-p)/(b-p)+h&&(o=!o)}return o}function wy(t){const r=t.slice();return r.sort((a,i)=>a.x<i.x?-1:a.x>i.x?1:a.y<i.y?-1:a.y>i.y?1:0),Ny(r)}function Ny(t){if(t.length<=1)return t.slice();const r=[];for(let i=0;i<t.length;i++){const o=t[i];for(;r.length>=2;){const l=r[r.length-1],c=r[r.length-2];if((l.x-c.x)*(o.y-c.y)>=(l.y-c.y)*(o.x-c.x))r.pop();else break}r.push(o)}r.pop();const a=[];for(let i=t.length-1;i>=0;i--){const o=t[i];for(;a.length>=2;){const l=a[a.length-1],c=a[a.length-2];if((l.x-c.x)*(o.y-c.y)>=(l.y-c.y)*(o.x-c.x))a.pop();else break}a.push(o)}return a.pop(),r.length===1&&a.length===1&&r[0].x===a[0].x&&r[0].y===a[0].y?r:r.concat(a)}var ky=am,Cy=nm,Sy=im,cm=om;const yl="-",Ty=t=>{const r=Ly(t),{conflictingClassGroups:a,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:c=>{const m=c.split(yl);return m[0]===""&&m.length!==1&&m.shift(),um(m,r)||Py(c)},getConflictingClassGroupIds:(c,m)=>{const u=a[c]||[];return m&&i[c]?[...u,...i[c]]:u}}},um=(t,r)=>{var c;if(t.length===0)return r.classGroupId;const a=t[0],i=r.nextPart.get(a),o=i?um(t.slice(1),i):void 0;if(o)return o;if(r.validators.length===0)return;const l=t.join(yl);return(c=r.validators.find(({validator:m})=>m(l)))==null?void 0:c.classGroupId},uc=/^\[(.+)\]$/,Py=t=>{if(uc.test(t)){const r=uc.exec(t)[1],a=r==null?void 0:r.substring(0,r.indexOf(":"));if(a)return"arbitrary.."+a}},Ly=t=>{const{theme:r,prefix:a}=t,i={nextPart:new Map,validators:[]};return Ry(Object.entries(t.classGroups),a).forEach(([l,c])=>{Io(c,i,l,r)}),i},Io=(t,r,a,i)=>{t.forEach(o=>{if(typeof o=="string"){const l=o===""?r:mc(r,o);l.classGroupId=a;return}if(typeof o=="function"){if(Ey(o)){Io(o(i),r,a,i);return}r.validators.push({validator:o,classGroupId:a});return}Object.entries(o).forEach(([l,c])=>{Io(c,mc(r,l),a,i)})})},mc=(t,r)=>{let a=t;return r.split(yl).forEach(i=>{a.nextPart.has(i)||a.nextPart.set(i,{nextPart:new Map,validators:[]}),a=a.nextPart.get(i)}),a},Ey=t=>t.isThemeGetter,Ry=(t,r)=>r?t.map(([a,i])=>{const o=i.map(l=>typeof l=="string"?r+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([c,m])=>[r+c,m])):l);return[a,o]}):t,My=t=>{if(t<1)return{get:()=>{},set:()=>{}};let r=0,a=new Map,i=new Map;const o=(l,c)=>{a.set(l,c),r++,r>t&&(r=0,i=a,a=new Map)};return{get(l){let c=a.get(l);if(c!==void 0)return c;if((c=i.get(l))!==void 0)return o(l,c),c},set(l,c){a.has(l)?a.set(l,c):o(l,c)}}},mm="!",Ay=t=>{const{separator:r,experimentalParseClassName:a}=t,i=r.length===1,o=r[0],l=r.length,c=m=>{const u=[];let h=0,p=0,g;for(let N=0;N<m.length;N++){let k=m[N];if(h===0){if(k===o&&(i||m.slice(N,N+l)===r)){u.push(m.slice(p,N)),p=N+l;continue}if(k==="/"){g=N;continue}}k==="["?h++:k==="]"&&h--}const b=u.length===0?m:m.substring(p),y=b.startsWith(mm),j=y?b.substring(1):b,w=g&&g>p?g-p:void 0;return{modifiers:u,hasImportantModifier:y,baseClassName:j,maybePostfixModifierPosition:w}};return a?m=>a({className:m,parseClassName:c}):c},Dy=t=>{if(t.length<=1)return t;const r=[];let a=[];return t.forEach(i=>{i[0]==="["?(r.push(...a.sort(),i),a=[]):a.push(i)}),r.push(...a.sort()),r},Iy=t=>({cache:My(t.cacheSize),parseClassName:Ay(t),...Ty(t)}),Oy=/\s+/,zy=(t,r)=>{const{parseClassName:a,getClassGroupId:i,getConflictingClassGroupIds:o}=r,l=[],c=t.trim().split(Oy);let m="";for(let u=c.length-1;u>=0;u-=1){const h=c[u],{modifiers:p,hasImportantModifier:g,baseClassName:b,maybePostfixModifierPosition:y}=a(h);let j=!!y,w=i(j?b.substring(0,y):b);if(!w){if(!j){m=h+(m.length>0?" "+m:m);continue}if(w=i(b),!w){m=h+(m.length>0?" "+m:m);continue}j=!1}const N=Dy(p).join(":"),k=g?N+mm:N,S=k+w;if(l.includes(S))continue;l.push(S);const P=o(w,j);for(let E=0;E<P.length;++E){const T=P[E];l.push(k+T)}m=h+(m.length>0?" "+m:m)}return m};function Fy(){let t=0,r,a,i="";for(;t<arguments.length;)(r=arguments[t++])&&(a=hm(r))&&(i&&(i+=" "),i+=a);return i}const hm=t=>{if(typeof t=="string")return t;let r,a="";for(let i=0;i<t.length;i++)t[i]&&(r=hm(t[i]))&&(a&&(a+=" "),a+=r);return a};function By(t,...r){let a,i,o,l=c;function c(u){const h=r.reduce((p,g)=>g(p),t());return a=Iy(h),i=a.cache.get,o=a.cache.set,l=m,m(u)}function m(u){const h=i(u);if(h)return h;const p=zy(u,a);return o(u,p),p}return function(){return l(Fy.apply(null,arguments))}}const Ie=t=>{const r=a=>a[t]||[];return r.isThemeGetter=!0,r},xm=/^\[(?:([a-z-]+):)?(.+)\]$/i,$y=/^\d+\/\d+$/,Zy=new Set(["px","full","screen"]),Uy=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Hy=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Wy=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Vy=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qy=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ks=t=>Vr(t)||Zy.has(t)||$y.test(t),Hs=t=>ga(t,"length",tv),Vr=t=>!!t&&!Number.isNaN(Number(t)),no=t=>ga(t,"number",Vr),Ma=t=>!!t&&Number.isInteger(Number(t)),Gy=t=>t.endsWith("%")&&Vr(t.slice(0,-1)),ye=t=>xm.test(t),Ws=t=>Uy.test(t),Ky=new Set(["length","size","percentage"]),Jy=t=>ga(t,Ky,pm),Qy=t=>ga(t,"position",pm),Yy=new Set(["image","url"]),Xy=t=>ga(t,Yy,rv),ev=t=>ga(t,"",sv),Aa=()=>!0,ga=(t,r,a)=>{const i=xm.exec(t);return i?i[1]?typeof r=="string"?i[1]===r:r.has(i[1]):a(i[2]):!1},tv=t=>Hy.test(t)&&!Wy.test(t),pm=()=>!1,sv=t=>Vy.test(t),rv=t=>qy.test(t),av=()=>{const t=Ie("colors"),r=Ie("spacing"),a=Ie("blur"),i=Ie("brightness"),o=Ie("borderColor"),l=Ie("borderRadius"),c=Ie("borderSpacing"),m=Ie("borderWidth"),u=Ie("contrast"),h=Ie("grayscale"),p=Ie("hueRotate"),g=Ie("invert"),b=Ie("gap"),y=Ie("gradientColorStops"),j=Ie("gradientColorStopPositions"),w=Ie("inset"),N=Ie("margin"),k=Ie("opacity"),S=Ie("padding"),P=Ie("saturate"),E=Ie("scale"),T=Ie("sepia"),D=Ie("skew"),R=Ie("space"),_=Ie("translate"),M=()=>["auto","contain","none"],I=()=>["auto","hidden","clip","visible","scroll"],O=()=>["auto",ye,r],F=()=>[ye,r],B=()=>["",ks,Hs],q=()=>["auto",Vr,ye],G=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ee=()=>["solid","dashed","dotted","double","none"],te=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],W=()=>["start","end","center","between","around","evenly","stretch"],me=()=>["","0",ye],se=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ie=()=>[Vr,ye];return{cacheSize:500,separator:":",theme:{colors:[Aa],spacing:[ks,Hs],blur:["none","",Ws,ye],brightness:ie(),borderColor:[t],borderRadius:["none","","full",Ws,ye],borderSpacing:F(),borderWidth:B(),contrast:ie(),grayscale:me(),hueRotate:ie(),invert:me(),gap:F(),gradientColorStops:[t],gradientColorStopPositions:[Gy,Hs],inset:O(),margin:O(),opacity:ie(),padding:F(),saturate:ie(),scale:ie(),sepia:me(),skew:ie(),space:F(),translate:F()},classGroups:{aspect:[{aspect:["auto","square","video",ye]}],container:["container"],columns:[{columns:[Ws]}],"break-after":[{"break-after":se()}],"break-before":[{"break-before":se()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...G(),ye]}],overflow:[{overflow:I()}],"overflow-x":[{"overflow-x":I()}],"overflow-y":[{"overflow-y":I()}],overscroll:[{overscroll:M()}],"overscroll-x":[{"overscroll-x":M()}],"overscroll-y":[{"overscroll-y":M()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[w]}],"inset-x":[{"inset-x":[w]}],"inset-y":[{"inset-y":[w]}],start:[{start:[w]}],end:[{end:[w]}],top:[{top:[w]}],right:[{right:[w]}],bottom:[{bottom:[w]}],left:[{left:[w]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ma,ye]}],basis:[{basis:O()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ye]}],grow:[{grow:me()}],shrink:[{shrink:me()}],order:[{order:["first","last","none",Ma,ye]}],"grid-cols":[{"grid-cols":[Aa]}],"col-start-end":[{col:["auto",{span:["full",Ma,ye]},ye]}],"col-start":[{"col-start":q()}],"col-end":[{"col-end":q()}],"grid-rows":[{"grid-rows":[Aa]}],"row-start-end":[{row:["auto",{span:[Ma,ye]},ye]}],"row-start":[{"row-start":q()}],"row-end":[{"row-end":q()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ye]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ye]}],gap:[{gap:[b]}],"gap-x":[{"gap-x":[b]}],"gap-y":[{"gap-y":[b]}],"justify-content":[{justify:["normal",...W()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...W(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...W(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[S]}],px:[{px:[S]}],py:[{py:[S]}],ps:[{ps:[S]}],pe:[{pe:[S]}],pt:[{pt:[S]}],pr:[{pr:[S]}],pb:[{pb:[S]}],pl:[{pl:[S]}],m:[{m:[N]}],mx:[{mx:[N]}],my:[{my:[N]}],ms:[{ms:[N]}],me:[{me:[N]}],mt:[{mt:[N]}],mr:[{mr:[N]}],mb:[{mb:[N]}],ml:[{ml:[N]}],"space-x":[{"space-x":[R]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[R]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ye,r]}],"min-w":[{"min-w":[ye,r,"min","max","fit"]}],"max-w":[{"max-w":[ye,r,"none","full","min","max","fit","prose",{screen:[Ws]},Ws]}],h:[{h:[ye,r,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ye,r,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ye,r,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ye,r,"auto","min","max","fit"]}],"font-size":[{text:["base",Ws,Hs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",no]}],"font-family":[{font:[Aa]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ye]}],"line-clamp":[{"line-clamp":["none",Vr,no]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ks,ye]}],"list-image":[{"list-image":["none",ye]}],"list-style-type":[{list:["none","disc","decimal",ye]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[k]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[k]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ee(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ks,Hs]}],"underline-offset":[{"underline-offset":["auto",ks,ye]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:F()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ye]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ye]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[k]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...G(),Qy]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Jy]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Xy]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[j]}],"gradient-via-pos":[{via:[j]}],"gradient-to-pos":[{to:[j]}],"gradient-from":[{from:[y]}],"gradient-via":[{via:[y]}],"gradient-to":[{to:[y]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[m]}],"border-w-x":[{"border-x":[m]}],"border-w-y":[{"border-y":[m]}],"border-w-s":[{"border-s":[m]}],"border-w-e":[{"border-e":[m]}],"border-w-t":[{"border-t":[m]}],"border-w-r":[{"border-r":[m]}],"border-w-b":[{"border-b":[m]}],"border-w-l":[{"border-l":[m]}],"border-opacity":[{"border-opacity":[k]}],"border-style":[{border:[...ee(),"hidden"]}],"divide-x":[{"divide-x":[m]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[m]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[k]}],"divide-style":[{divide:ee()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...ee()]}],"outline-offset":[{"outline-offset":[ks,ye]}],"outline-w":[{outline:[ks,Hs]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[k]}],"ring-offset-w":[{"ring-offset":[ks,Hs]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Ws,ev]}],"shadow-color":[{shadow:[Aa]}],opacity:[{opacity:[k]}],"mix-blend":[{"mix-blend":[...te(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":te()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[i]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",Ws,ye]}],grayscale:[{grayscale:[h]}],"hue-rotate":[{"hue-rotate":[p]}],invert:[{invert:[g]}],saturate:[{saturate:[P]}],sepia:[{sepia:[T]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[h]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[p]}],"backdrop-invert":[{"backdrop-invert":[g]}],"backdrop-opacity":[{"backdrop-opacity":[k]}],"backdrop-saturate":[{"backdrop-saturate":[P]}],"backdrop-sepia":[{"backdrop-sepia":[T]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[c]}],"border-spacing-x":[{"border-spacing-x":[c]}],"border-spacing-y":[{"border-spacing-y":[c]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ye]}],duration:[{duration:ie()}],ease:[{ease:["linear","in","out","in-out",ye]}],delay:[{delay:ie()}],animate:[{animate:["none","spin","ping","pulse","bounce",ye]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[E]}],"scale-x":[{"scale-x":[E]}],"scale-y":[{"scale-y":[E]}],rotate:[{rotate:[Ma,ye]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[D]}],"skew-y":[{"skew-y":[D]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ye]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ye]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":F()}],"scroll-mx":[{"scroll-mx":F()}],"scroll-my":[{"scroll-my":F()}],"scroll-ms":[{"scroll-ms":F()}],"scroll-me":[{"scroll-me":F()}],"scroll-mt":[{"scroll-mt":F()}],"scroll-mr":[{"scroll-mr":F()}],"scroll-mb":[{"scroll-mb":F()}],"scroll-ml":[{"scroll-ml":F()}],"scroll-p":[{"scroll-p":F()}],"scroll-px":[{"scroll-px":F()}],"scroll-py":[{"scroll-py":F()}],"scroll-ps":[{"scroll-ps":F()}],"scroll-pe":[{"scroll-pe":F()}],"scroll-pt":[{"scroll-pt":F()}],"scroll-pr":[{"scroll-pr":F()}],"scroll-pb":[{"scroll-pb":F()}],"scroll-pl":[{"scroll-pl":F()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ye]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[ks,Hs,no]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},fm=By(av);function nv(...t){return fm($o(t))}const vl=ky,ti=Cy,si=Sy,qa=f.forwardRef(({className:t,sideOffset:r=4,...a},i)=>e.jsx(cm,{ref:i,sideOffset:r,className:nv("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 bg-gray-900 text-white",t),...a}));qa.displayName=cm.displayName;const st=({text:t,align:r="center",size:a="md"})=>e.jsx(vl,{children:e.jsxs(ti,{delayDuration:300,children:[e.jsx(si,{asChild:!0,children:e.jsx(gt,{className:`${a==="sm"?"w-3 h-3":"w-4 h-4"} text-muted-foreground cursor-help opacity-70 hover:opacity-100 transition-opacity`})}),e.jsx(qa,{side:"top",align:r==="end"?"end":"center",className:"max-w-xs text-xs",children:e.jsx("p",{children:t})})]})}),gm=({profile:t,onBarClick:r})=>{var o;if(!t)return null;let a=[];const i=t.dtype;if(i==="Numeric"&&t.histogram)a=t.histogram.map(l=>({name:`${Number(l.start).toFixed(2)}`,fullName:`${Number(l.start).toFixed(2)} - ${Number(l.end).toFixed(2)}`,count:l.count,rawBin:l}));else if(i==="Text"&&t.histogram)a=t.histogram.map(l=>({name:`${Number(l.start).toFixed(0)}`,fullName:`${Number(l.start).toFixed(0)} - ${Number(l.end).toFixed(0)} chars`,count:l.count,rawBin:l}));else if(i==="DateTime"&&t.histogram)a=t.histogram.map(l=>({name:new Date(l.start).toLocaleDateString(void 0,{month:"short",year:"2-digit"}),fullName:`${new Date(l.start).toLocaleDateString()} - ${new Date(l.end).toLocaleDateString()}`,count:l.count,rawBin:l}));else if(i==="Categorical"&&((o=t.categorical_stats)!=null&&o.top_k))a=t.categorical_stats.top_k.map(l=>({name:String(l.value).substring(0,15)+(String(l.value).length>15?"...":""),fullName:String(l.value),count:l.count,value:l.value}));else return e.jsx("div",{className:"text-gray-500 text-sm italic p-4 text-center",children:"No distribution data available for this type"});return a.length===0?e.jsx("div",{className:"text-gray-500 text-sm italic p-4 text-center",children:"No data points"}):e.jsxs("div",{className:"h-64 w-full relative",children:[t.normality_test&&e.jsxs("div",{className:"absolute top-0 right-0 bg-white/90 dark:bg-gray-800/90 p-2 rounded border border-gray-200 dark:border-gray-700 text-xs z-10 shadow-sm",children:[e.jsxs("div",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:["Normality Test (",t.normality_test.test_name,")",e.jsx(st,{text:"Normality tests are performed on a sample of up to 5,000 rows. Shapiro-Wilk is used for smaller datasets (<5,000), and Kolmogorov-Smirnov for larger ones. For very large datasets, rely on Skewness and Kurtosis.",align:"right"})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-gray-500",children:"p-value:"}),e.jsx("span",{className:`font-mono ${t.normality_test.is_normal?"text-green-600":"text-red-500"}`,children:t.normality_test.p_value.toExponential(2)})]}),e.jsx("div",{className:"mt-1 text-[10px] text-gray-400",children:t.normality_test.is_normal?"Likely Normal Distribution":"Likely Not Normal"})]}),e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:a,margin:{top:5,right:30,left:20,bottom:30},children:[e.jsx(Ct,{strokeDasharray:"3 3",vertical:!1,stroke:"#e5e7eb"}),e.jsx(St,{dataKey:"name",tick:{fontSize:11,fill:"#6b7280"},interval:"preserveStartEnd",angle:-45,textAnchor:"end"}),e.jsx(Tt,{tick:{fontSize:11,fill:"#6b7280"}}),e.jsx(pt,{content:({active:l,payload:c})=>{if(l&&c&&c.length){const m=c[0].payload;return e.jsxs("div",{className:"bg-gray-800 text-white text-xs p-2 rounded shadow-lg",children:[e.jsx("p",{className:"font-semibold mb-1",children:m.fullName}),e.jsxs("p",{children:["Count: ",m.count]}),r&&e.jsx("p",{className:"text-blue-300 mt-1 italic",children:"Click to filter"})]})}return null}}),e.jsx(Mt,{dataKey:"count",radius:[4,4,0,0],onClick:l=>r&&r(l),className:r?"cursor-pointer hover:opacity-80":"",children:a.map((l,c)=>e.jsx(ni,{fill:i==="Numeric"?"#3b82f6":"#8b5cf6"},`cell-${c}`))})]})})]})},iv=({selectedVariable:t,onClose:r,downloadChart:a,filters:i,setFilters:o,runAnalysis:l,handleAddFilter:c})=>{var m,u,h,p,g,b,y,j,w;return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto flex flex-col animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[t.name,e.jsx("span",{className:`text-sm font-normal px-2 py-0.5 rounded-full ${t.dtype==="Numeric"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":t.dtype==="Categorical"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,children:t.dtype})]})}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",children:e.jsx(et,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mr-2",children:"Distribution"}),e.jsx(st,{text:"Click on any bar to filter the entire dataset by that range or category."})]}),e.jsx("button",{onClick:()=>{let N;t.normality_test&&(N=`Normality Test (${t.normality_test.test_name})
p-value: ${t.normality_test.p_value.toExponential(2)}
${t.normality_test.is_normal?"Likely Normal":"Likely Not Normal"}`),a("distribution-chart",`distribution-${t.name}`,`Distribution: ${t.name}`,void 0,N)},className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(Xe,{className:"w-3 h-3"})})]}),e.jsx("div",{id:"distribution-chart",children:e.jsx(gm,{profile:t,onBarClick:N=>{if((t.dtype==="Numeric"||t.dtype==="DateTime")&&N.rawBin){const k=[...i,{column:t.name,operator:">=",value:N.rawBin.start},{column:t.name,operator:"<",value:N.rawBin.end}];o(k),l(void 0,k),r()}else t.dtype==="Categorical"&&(c(t.name,N.value,"=="),r())}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2",children:"General Statistics"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-sm",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Missing"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[t.missing_count," (",t.missing_percentage.toFixed(2),"%)"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2",children:[t.dtype," Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.numeric_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Mean"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(m=t.numeric_stats.mean)==null?void 0:m.toFixed(4)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Median"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(u=t.numeric_stats.median)==null?void 0:u.toFixed(4)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Std Dev"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(h=t.numeric_stats.std)==null?void 0:h.toFixed(4)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Min"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.numeric_stats.min})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Max"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.numeric_stats.max})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Zeros"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.numeric_stats.zeros_count})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Skewness"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(p=t.numeric_stats.skewness)==null?void 0:p.toFixed(4)}),e.jsx("span",{className:"block text-[10px] text-gray-500 mt-1",children:Math.abs(t.numeric_stats.skewness)<.5?"Symmetric (Normal-like)":Math.abs(t.numeric_stats.skewness)<1?"Moderately Skewed":"Highly Skewed"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Kurtosis"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(g=t.numeric_stats.kurtosis)==null?void 0:g.toFixed(4)}),e.jsx("span",{className:"block text-[10px] text-gray-500 mt-1",children:Math.abs(t.numeric_stats.kurtosis)<.5?"Mesokurtic (Normal-like)":t.numeric_stats.kurtosis>0?"Leptokurtic (Heavy Tails)":"Platykurtic (Light Tails)"})]}),t.vif!==void 0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"VIF"}),e.jsx(st,{text:"Variance Inflation Factor measures multicollinearity. VIF > 5 indicates high correlation with other variables."})]}),e.jsx("span",{className:`font-medium ${t.vif>5?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:t.vif.toFixed(2)}),e.jsx("span",{className:"block text-[10px] text-gray-500 mt-1",children:t.vif>10?"Severe Multicollinearity":t.vif>5?"High Multicollinearity":"Low Multicollinearity"})]}),t.normality_test&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:["Normality (",t.normality_test.test_name,")"]}),e.jsx(st,{text:"Normality tests are performed on a sample of up to 5,000 rows. Shapiro-Wilk is used for smaller datasets (<5,000), and Kolmogorov-Smirnov for larger ones. For very large datasets, rely on Skewness and Kurtosis."})]}),e.jsx("span",{className:`font-medium ${t.normality_test.is_normal?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:t.normality_test.is_normal?"Normal":"Not Normal"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"P-Value"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.normality_test.p_value.toFixed(4)})]})]})]}),t.categorical_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Unique Values"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.categorical_stats.unique_count})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Rare Labels"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.categorical_stats.rare_labels_count})]})]}),t.text_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Avg Length"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(b=t.text_stats.avg_length)==null?void 0:b.toFixed(2)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Min Length"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.text_stats.min_length})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Max Length"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.text_stats.max_length})]}),t.text_stats.sentiment_distribution&&e.jsxs("div",{className:"col-span-2 bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase mb-2",children:"Sentiment Distribution"}),e.jsxs("div",{className:"flex h-4 rounded-full overflow-hidden",children:[e.jsx("div",{className:"bg-green-500 h-full",style:{width:`${(t.text_stats.sentiment_distribution.positive||0)*100}%`},title:`Positive: ${(t.text_stats.sentiment_distribution.positive||0).toFixed(2)}`}),e.jsx("div",{className:"bg-gray-400 h-full",style:{width:`${(t.text_stats.sentiment_distribution.neutral||0)*100}%`},title:`Neutral: ${(t.text_stats.sentiment_distribution.neutral||0).toFixed(2)}`}),e.jsx("div",{className:"bg-red-500 h-full",style:{width:`${(t.text_stats.sentiment_distribution.negative||0)*100}%`},title:`Negative: ${(t.text_stats.sentiment_distribution.negative||0).toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between text-xs mt-1 text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Pos: ",((t.text_stats.sentiment_distribution.positive||0)*100).toFixed(1),"%"]}),e.jsxs("span",{children:["Neu: ",((t.text_stats.sentiment_distribution.neutral||0)*100).toFixed(1),"%"]}),e.jsxs("span",{children:["Neg: ",((t.text_stats.sentiment_distribution.negative||0)*100).toFixed(1),"%"]})]})]})]}),t.date_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Min Date"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.date_stats.min_date})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Max Date"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.date_stats.max_date})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs uppercase",children:"Duration (Days)"})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:(y=t.date_stats.duration_days)==null?void 0:y.toFixed(1)})]})]})]})]})]}),((j=t.categorical_stats)==null?void 0:j.top_k)&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 uppercase tracking-wider",children:"Top Categories"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:t.categorical_stats.top_k.map((N,k)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 text-sm",children:[e.jsx("span",{className:"truncate font-medium text-gray-700 dark:text-gray-300",title:N.value,children:N.value}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-900 px-2 py-0.5 rounded-full text-xs",children:N.count})]},k))})]}),((w=t.text_stats)==null?void 0:w.common_words)&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 uppercase tracking-wider",children:"Most Common Words"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.text_stats.common_words.map((N,k)=>e.jsxs("div",{className:"flex items-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 text-sm",children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400 mr-2",children:N.word}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:["(",N.count,")"]})]},k))})]})]})]})}):null},ov=({activeTab:t,setActiveTab:r,profile:a,filters:i,columns:o,excludedCols:l,excludedDirty:c,analyzing:m,onAddFilter:u,onRemoveFilter:h,onClearFilters:p,onToggleExclude:g,onApplyExcluded:b})=>{const[y,j]=f.useState(!0),[w,N]=f.useState(!1),[k,S]=f.useState(!1),[P,E]=f.useState(!1),[T,D]=f.useState(""),[R,_]=f.useState("=="),[M,I]=f.useState(""),[O,F]=f.useState(!1),B=()=>{T&&M&&(u(T,isNaN(Number(M))?M:Number(M),R),E(!1),D(""),I(""))},q=[{title:"Overview",items:[{id:"dashboard",label:"Dashboard",icon:Uo,show:!0},{id:"sample",label:"Sample Data",icon:Wo,show:!!a.sample_data},{id:"insights",label:"Smart Insights",icon:sn,show:!0}]},{title:"Univariate Analysis",items:[{id:"variables",label:"Variables",icon:gs,show:!0},{id:"outliers",label:"Outliers",icon:Jt,show:!!a.outliers},{id:"target",label:"Target Analysis",icon:Vc,show:!!(a.target_col&&a.target_correlations)}]},{title:"Multivariate Analysis",items:[{id:"correlations",label:"Correlations",icon:kx,show:!!(a.correlations||a.correlations_with_target)},{id:"bivariate",label:"Bivariate",icon:li,show:!0},{id:"pca",label:"PCA & Clusters",icon:ia,show:!!a.pca_data||!!a.clustering}]},{title:"Structure & Causal",items:[{id:"causal",label:"Causal Graph",icon:ia,show:!!a.causal_graph},{id:"rules",label:"Decision Tree",icon:Fa,show:!!a.rule_tree},{id:"decomposition",label:"Decomposition",icon:qo,show:!0}]},{title:"Specialized",items:[{id:"timeseries",label:"Time Series",icon:Sr,show:!!a.timeseries},{id:"geospatial",label:"Geospatial",icon:qc,show:!!a.geospatial}]}];return e.jsxs("div",{className:`${k?"w-14":"w-60"} bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0 h-full overflow-y-auto flex flex-col transition-all duration-300`,children:[!k&&e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 space-y-3 bg-gray-50/50 dark:bg-gray-900/20",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between w-full mb-2",children:[e.jsxs("button",{onClick:()=>j(!y),className:"flex items-center text-xs font-semibold text-gray-500 uppercase tracking-wider hover:text-gray-700",children:[e.jsxs("span",{children:["Active Filters (",i.length,")"]}),y?e.jsx(Ms,{className:"w-3 h-3 ml-1"}):e.jsx(De,{className:"w-3 h-3 ml-1"})]}),i.length>0&&e.jsx("button",{onClick:p,className:"text-[10px] text-red-500 hover:text-red-700 hover:underline",children:"Clear All"})]}),y&&e.jsxs("div",{className:"space-y-2",children:[i.map((G,ee)=>e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded px-2 py-1 text-xs",children:[e.jsxs("div",{className:"truncate max-w-[140px]",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:G.column}),e.jsx("span",{className:"mx-1 text-gray-500",children:G.operator}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:String(G.value)})]}),e.jsx("button",{onClick:()=>h(ee),className:"text-gray-400 hover:text-red-500",children:e.jsx(et,{className:"w-3 h-3"})})]},ee)),P?e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded border border-gray-200 dark:border-gray-700 space-y-2 shadow-sm",children:[e.jsxs("select",{value:T,onChange:G=>D(G.target.value),className:"w-full text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",children:[e.jsx("option",{value:"",disabled:!0,children:"Column"}),o.map(G=>e.jsx("option",{value:G,children:G},G))]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{value:R,onChange:G=>_(G.target.value),className:"w-1/3 text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",children:[e.jsx("option",{value:"==",children:"=="}),e.jsx("option",{value:"!=",children:"!="}),e.jsx("option",{value:">",children:">"}),e.jsx("option",{value:"<",children:"<"}),e.jsx("option",{value:">=",children:">="}),e.jsx("option",{value:"<=",children:"<="})]}),e.jsx("input",{type:"text",value:M,onChange:G=>I(G.target.value),placeholder:"Value",className:"w-2/3 text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",onKeyDown:G=>G.key==="Enter"&&B()})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>E(!1),className:"text-xs text-gray-500 hover:text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:B,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700",children:"Add"})]})]}):e.jsxs("button",{onClick:()=>E(!0),className:"w-full flex items-center justify-center px-2 py-1 text-xs border border-dashed border-gray-300 dark:border-gray-600 rounded text-gray-500 hover:text-blue-600 hover:border-blue-300 transition-colors",children:[e.jsx(Yt,{className:"w-3 h-3 mr-1"})," Add Filter"]})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>N(!w),className:"flex items-center justify-between w-full text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 hover:text-gray-700",children:[e.jsxs("span",{children:["Excluded (",l.length,")"]}),w?e.jsx(Ms,{className:"w-3 h-3"}):e.jsx(De,{className:"w-3 h-3"})]}),w&&e.jsxs("div",{className:"space-y-2",children:[l.map((G,ee)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 text-xs",children:[e.jsx("span",{className:"font-medium text-gray-500 line-through truncate max-w-[140px]",children:G}),e.jsx("button",{onClick:()=>g(G,!1),className:"text-gray-400 hover:text-green-500",title:"Include back",children:e.jsx(Yt,{className:"w-3 h-3"})})]},ee)),e.jsx("button",{onClick:b,disabled:!c||m,className:`w-full flex items-center justify-center px-2 py-1 text-xs rounded border transition-colors ${c&&!m?"bg-blue-600 text-white border-blue-700 hover:bg-blue-700":"bg-gray-100 dark:bg-gray-800 text-gray-400 border-gray-200 dark:border-gray-700 cursor-not-allowed"}`,title:c?"Apply excluded columns to re-run analysis":"No pending exclusion changes",children:"Apply changes"}),O?e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded border border-gray-200 dark:border-gray-700 space-y-2 shadow-sm",children:[e.jsxs("select",{className:"w-full text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 p-1",onChange:G=>{G.target.value&&(g(G.target.value,!0),F(!1))},defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Column"}),o.filter(G=>!l.includes(G)).map(G=>e.jsx("option",{value:G,children:G},G))]}),e.jsx("button",{onClick:()=>F(!1),className:"w-full text-xs text-gray-500 hover:text-gray-700 text-center",children:"Cancel"})]}):e.jsxs("button",{onClick:()=>F(!0),className:"w-full flex items-center justify-center px-2 py-1 text-xs border border-dashed border-gray-300 dark:border-gray-600 rounded text-gray-500 hover:text-red-600 hover:border-red-300 transition-colors",children:[e.jsx(tn,{className:"w-3 h-3 mr-1"})," Exclude Column"]})]})]})]}),e.jsxs("div",{className:`flex-1 overflow-y-auto ${k?"p-2":"p-3"}`,children:[e.jsxs("div",{className:`flex items-center ${k?"justify-center":"justify-between"} mb-3`,children:[!k&&e.jsx("h2",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Analysis Modules"}),e.jsx("button",{onClick:()=>S(!k),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-gray-500",title:k?"Expand Sidebar":"Collapse Sidebar",children:k?e.jsx($c,{className:"w-4 h-4"}):e.jsx(Zc,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-6",children:q.map((G,ee)=>{const te=G.items.filter(W=>W.show);return te.length===0?null:e.jsxs("div",{children:[!k&&e.jsx("h3",{className:"px-2 text-xs font-medium text-gray-500 mb-2",children:G.title}),e.jsx("div",{className:"space-y-1",children:te.map(W=>e.jsxs("button",{onClick:()=>r(W.id),title:k?W.label:void 0,className:`w-full flex items-center ${k?"justify-center py-2":"px-2 py-2"} text-sm font-medium rounded-md transition-colors ${t===W.id?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(W.icon,{className:`${k?"h-5 w-5":"mr-3 h-4 w-4"} ${t===W.id?"text-blue-500":"text-gray-400"}`}),!k&&W.label,!k&&t===W.id&&e.jsx(Pt,{className:"ml-auto h-4 w-4 text-blue-400"})]},W.id))})]},ee)})})]})]})},lv=({profile:t})=>t?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Rows"}),e.jsx("div",{className:"text-2xl font-bold",children:t.row_count.toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Columns"}),e.jsx("div",{className:"text-2xl font-bold",children:t.column_count})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Missing Cells"}),e.jsxs("div",{className:"text-2xl font-bold",children:[t.missing_cells_percentage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Duplicates"}),e.jsx("div",{className:"text-2xl font-bold",children:t.duplicate_rows})]}),t.vif&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"High VIF Features"}),e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:Object.values(t.vif).filter(r=>r>5).length})]})]}):null,dv=({alerts:t})=>{const[r,a]=f.useState(!0);return!t||t.length===0?null:e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>a(!r),children:[e.jsxs("h3",{className:"font-medium text-amber-800 dark:text-amber-200 flex items-center",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Data Quality Alerts (",t.length,")"]}),r?e.jsx(Ms,{className:"w-4 h-4 text-amber-800 dark:text-amber-200"}):e.jsx(De,{className:"w-4 h-4 text-amber-800 dark:text-amber-200"})]}),r&&e.jsx("div",{className:"max-h-40 overflow-y-auto pr-2 mt-2 animate-in slide-in-from-top-2 duration-200",children:e.jsx("ul",{className:"space-y-1",children:t.map((i,o)=>e.jsxs("li",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-start",children:[e.jsx("span",{className:"mr-2",children:""}),e.jsxs("span",{children:[i.column&&e.jsxs("span",{className:"font-semibold",children:[i.column,": "]}),i.message]})]},o))})})]})},hc=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],cv=({profile:t,onToggleExclude:r,excludedCols:a=[]})=>{const i=f.useMemo(()=>{if(!(t!=null&&t.columns))return[];const l={};return Object.values(t.columns).forEach(c=>{l[c.dtype]=(l[c.dtype]||0)+1}),Object.entries(l).map(([c,m])=>({name:c,value:m}))},[t]),o=f.useMemo(()=>t!=null&&t.columns?Object.values(t.columns).filter(l=>l.missing_percentage>0).sort((l,c)=>c.missing_percentage-l.missing_percentage).slice(0,20).map(l=>({name:l.name,value:l.missing_percentage})):[],[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(lv,{profile:t}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(bt,{className:"w-5 h-5 mr-2 text-blue-500"}),"Column Types"]}),e.jsx("div",{className:"h-64",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(Ac,{children:[e.jsx(Dc,{data:i,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,fill:"#8884d8",paddingAngle:5,dataKey:"value",children:i.map((l,c)=>e.jsx(ni,{fill:hc[c%hc.length]},`cell-${c}`))}),e.jsx(pt,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(en,{verticalAlign:"bottom",height:36})]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Jt,{className:"w-5 h-5 mr-2 text-amber-500"}),"Top Missing Values"]}),o.length>0?e.jsx("div",{className:"h-64 overflow-y-auto pr-2 space-y-3",children:o.map((l,c)=>{const m=a.includes(l.name);return e.jsxs("div",{className:"flex items-center gap-3 text-sm group",children:[e.jsx("div",{className:"w-32 truncate text-gray-600 dark:text-gray-300 font-medium",title:l.name,children:l.name}),e.jsx("div",{className:"flex-1 h-2 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${l.value}%`,backgroundColor:`hsl(10, 80%, ${60-c*2}%)`}})}),e.jsxs("div",{className:"w-12 text-right text-gray-500 text-xs",children:[l.value.toFixed(1),"%"]}),r&&e.jsx("button",{onClick:()=>r(l.name,!m),className:`p-1.5 rounded-md transition-colors opacity-0 group-hover:opacity-100 focus:opacity-100 ${m?"bg-red-100 text-red-600 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400 opacity-100":"text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 dark:hover:text-gray-300"}`,title:m?"Include Column":"Exclude Column",children:m?e.jsx(tn,{className:"w-4 h-4"}):e.jsx(Ho,{className:"w-4 h-4"})})]},c)})}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(Cr,{className:"w-12 h-12 mb-2 opacity-20"}),e.jsx("p",{children:"No missing values found!"})]})]})]}),e.jsx(dv,{alerts:t.alerts})]})},uv=({profile:t})=>e.jsx("div",{className:"mt-4 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(sn,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Smart Recommendations"]}),t.recommendations&&t.recommendations.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.recommendations.map((r,a)=>e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800 px-2 py-1 rounded border border-blue-100 dark:border-blue-800",children:r.action}),r.column&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:r.column})]}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white text-sm mb-1",children:r.reason}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r.suggestion})]},a))}):e.jsx("p",{className:"text-gray-500 italic",children:"No specific recommendations found. Your data looks clean!"})]})}),bm=({data:t,xKey:r,yKey:a,zKey:i,labelKey:o,xLabel:l,yLabel:c,zLabel:m,height:u=600})=>{const h=[];if(o){const p={};t.forEach(g=>{const b=g[o]||"Other";p[b]||(p[b]=[]),p[b].push(g)}),Object.keys(p).forEach(g=>{const b=p[g];h.push({x:b.map(y=>y[r]),y:b.map(y=>y[a]),z:b.map(y=>y[i]),mode:"markers",type:"scatter3d",name:g,marker:{size:3,opacity:.8},hovertemplate:`<b>${g}</b><br>${l||r}: %{x}<br>${c||a}: %{y}<br>${m||i}: %{z}<extra></extra>`})})}else h.push({x:t.map(p=>p[r]),y:t.map(p=>p[a]),z:t.map(p=>p[i]),mode:"markers",type:"scatter3d",name:"Data Points",marker:{size:3,color:"#8884d8",opacity:.8},hovertemplate:`${l||r}: %{x}<br>${c||a}: %{y}<br>${m||i}: %{z}<extra></extra>`});return e.jsx("div",{style:{height:u,width:"100%"},children:e.jsx(Qx,{data:h,layout:{autosize:!0,height:u,margin:{l:0,r:0,b:0,t:0},scene:{xaxis:{title:{text:l||r}},yaxis:{title:{text:c||a}},zaxis:{title:{text:m||i}}},showlegend:!0,legend:{x:0,y:1}},useResizeHandler:!0,style:{width:"100%",height:"100%"},config:{displayModeBar:!0}})})};Jh.register(Qh,Yh,Xh,ex,tx);const ym=({data:t,xKey:r,yKey:a,labelKey:i,xLabel:o,yLabel:l,height:c=500})=>{const m=[];if(i){const h={};t.forEach(g=>{const b=g[i]||"Other";h[b]||(h[b]=[]),h[b].push({x:g[r],y:g[a],raw:g})});const p=["#8884d8","#82ca9d","#ffc658","#ff7300","#0088fe","#00C49F","#FFBB28","#FF8042"];Object.keys(h).forEach((g,b)=>{m.push({label:g,data:h[g],backgroundColor:p[b%p.length],pointRadius:3,pointHoverRadius:5})})}else m.push({label:"Data Points",data:t.map(h=>({x:h[r],y:h[a],raw:h})),backgroundColor:"#8884d8",pointRadius:3,pointHoverRadius:5});const u={responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!!o,text:o,color:"#6b7280",font:{weight:"bold"}},grid:{color:"rgba(0, 0, 0, 0.2)",lineWidth:1},ticks:{color:"#6b7280"}},y:{title:{display:!!l,text:l,color:"#6b7280",font:{weight:"bold"}},grid:{color:"rgba(0, 0, 0, 0.2)",lineWidth:1},ticks:{color:"#6b7280"}}},plugins:{tooltip:{callbacks:{label:h=>{const p=h.raw;let g=h.dataset.label||"";return g&&(g+=": "),g+=`(${p.x}, ${p.y})`,g}}},legend:{display:!!i&&m.length<20}}};return e.jsx("div",{style:{height:c,width:"100%"},children:e.jsx(sx,{options:u,data:{datasets:m}})})},mv=({profile:t,downloadChart:r})=>{const a=t.clustering;return a?e.jsxs("div",{className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(ia,{className:"w-5 h-5 mr-2 text-rose-500"}),"Post-Hoc Clustering (Segmentation)",e.jsx(st,{text:"Automatically groups data points into distinct clusters (segments) based on similarity. Useful for finding natural groups like 'High Spenders' or 'At Risk' users."})]}),e.jsx("button",{onClick:()=>r("clustering-chart","clustering-analysis","Clustering Segmentation",`${a.n_clusters} Clusters Found`),className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download Chart",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/10 rounded-lg border border-purple-100 dark:border-purple-800",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Algorithm Summary"}),e.jsxs("div",{className:"space-y-1 text-sm text-purple-700 dark:text-purple-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Method:"}),e.jsx("span",{className:"font-medium",children:a.method})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Metric (Inertia):"}),e.jsx("span",{className:"font-medium",children:a.inertia.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Clusters:"}),e.jsx("span",{className:"font-medium",children:a.n_clusters})]})]})]})}),e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mt-4",children:"Cluster Profiles (Centroids)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a.clusters.map(i=>e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx("span",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:hv(i.cluster_id)}}),"Cluster ",i.cluster_id]}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-gray-600 dark:text-gray-300",children:[i.percentage.toFixed(1),"% (",i.size,")"]})]}),e.jsxs("div",{className:"space-y-1",children:[Object.entries(i.center).slice(0,5).map(([o,l])=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 truncate w-24",title:o,children:o}),e.jsx("span",{className:"font-mono text-gray-700 dark:text-gray-200",children:l.toFixed(2)})]},o)),Object.keys(i.center).length>5&&e.jsxs("div",{className:"text-xs text-center text-gray-400 italic pt-1",children:["+ ",Object.keys(i.center).length-5," more features"]})]})]},i.cluster_id))})]})})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg text-sm border border-blue-100 dark:border-blue-800",children:[e.jsx(gt,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:"These clusters are found using unsupervised learning (K-Means) on numeric features. The plot shows a 2D projection (PCA) of the clusters. Use this to identify distinct groups of data points that behave similarly."})]})]}):e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm flex flex-col items-center justify-center text-gray-500 min-h-[300px]",children:[e.jsx(ia,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"Clustering analysis not available."}),e.jsx("p",{className:"text-sm mt-2",children:"Requires at least 2 numeric columns."})]})},hv=t=>{const r=["#8884d8","#82ca9d","#ffc658","#ff7300","#0088fe","#00C49F","#FFBB28","#FF8042"];return r[t%r.length]},xv=({profile:t,isPCA3D:r,setIsPCA3D:a,downloadChart:i})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(li,{className:"w-5 h-5 mr-2 text-purple-500"}),"Multivariate Structure (PCA)",e.jsx(st,{text:"Reduces data to 2D or 3D. Points closer together are similar. Colors show clusters or target values."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i("pca-chart","pca-analysis","Multivariate Structure (PCA)",r?"3D Projection":"2D Projection"),className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download Chart",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>a(!r),className:`p-2 rounded-md border transition-colors flex items-center gap-2 text-sm ${r?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"}`,children:[e.jsx(na,{className:"w-4 h-4"}),r?"Switch to 2D":"Switch to 3D"]})]})]}),e.jsx("div",{id:"pca-chart",children:t.pca_data?r?e.jsx(bm,{data:t.pca_data,xKey:"x",yKey:"y",zKey:"z",labelKey:"label",xLabel:"PC1",yLabel:"PC2",zLabel:"PC3"}):e.jsx(ym,{data:t.pca_data,xKey:"x",yKey:"y",labelKey:"label",xLabel:"Principal Component 1 (PC1)",yLabel:"Principal Component 2 (PC2)"}):e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 dark:bg-gray-900 rounded text-gray-400 text-sm text-center p-4",children:"Not enough numeric data for PCA."})}),e.jsxs("div",{className:"mt-6 flex items-start gap-2 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-100 dark:border-blue-800",children:[e.jsx(gt,{className:"w-4 h-4 text-blue-500 mt-0.5 shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"About this visualization"}),e.jsxs("p",{children:["This chart shows a ",r?"3D":"2D"," projection of your data using Principal Component Analysis (PCA). Points that are close together share similar characteristics across all numeric features."]}),e.jsxs("p",{className:"mt-1 text-xs opacity-80",children:["* For performance, this visualization uses a random sample of up to ",e.jsx("strong",{children:"5,000 points"}),"."]})]})]}),t.pca_components&&t.pca_components.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Principal Component Composition"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.pca_components.slice(0,r?3:2).map(o=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded-md border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:o.component}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 px-2 py-0.5 rounded-full",children:[(o.explained_variance_ratio*100).toFixed(1),"% Var"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wider mb-1",children:"Top Loadings"}),Object.entries(o.top_features||{}).map(([l,c],m)=>e.jsxs("div",{className:"flex justify-between text-xs items-center group",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 truncate mr-2 flex-1",title:l,children:l}),e.jsxs("span",{className:`font-mono text-[10px] ${Number(c)>0?"text-green-600 dark:text-green-400":"text-red-500 dark:text-red-400"}`,children:[Number(c)>0?"+":"",Number(c).toFixed(3)]})]},m))]})]},o.component))})]})]}),e.jsx(mv,{profile:t,downloadChart:i})]});function vm(t,r){const a=f.useRef(r);f.useEffect(function(){r!==a.current&&t.attributionControl!=null&&(a.current!=null&&t.attributionControl.removeAttribution(a.current),r!=null&&t.attributionControl.addAttribution(r)),a.current=r},[t,r])}function pv(t,r,a){r.center!==a.center&&t.setLatLng(r.center),r.radius!=null&&r.radius!==a.radius&&t.setRadius(r.radius)}const fv=1;function gv(t){return Object.freeze({__version:fv,map:t})}function bv(t,r){return Object.freeze({...t,...r})}const jm=f.createContext(null),_m=jm.Provider;function jl(){const t=f.useContext(jm);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function yv(t){function r(a,i){const{instance:o,context:l}=t(a).current;return f.useImperativeHandle(i,()=>o),a.children==null?null:ft.createElement(_m,{value:l},a.children)}return f.forwardRef(r)}function vv(t){function r(a,i){const[o,l]=f.useState(!1),{instance:c}=t(a,l).current;f.useImperativeHandle(i,()=>c),f.useEffect(function(){o&&c.update()},[c,o,a.children]);const m=c._contentNode;return m?ii.createPortal(a.children,m):null}return f.forwardRef(r)}function jv(t){function r(a,i){const{instance:o}=t(a).current;return f.useImperativeHandle(i,()=>o),null}return f.forwardRef(r)}function _l(t,r){const a=f.useRef();f.useEffect(function(){return r!=null&&t.instance.on(r),a.current=r,function(){a.current!=null&&t.instance.off(a.current),a.current=null}},[t,r])}function _i(t,r){const a=t.pane??r.pane;return a?{...t,pane:a}:t}function _v(t,r){return function(i,o){const l=jl(),c=t(_i(i,l),l);return vm(l.map,i.attribution),_l(c.current,i.eventHandlers),r(c.current,l,i,o),c}}var Oo={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,r){(function(a,i){i(r)})(ax,function(a){var i="1.9.4";function o(s){var n,d,x,v;for(d=1,x=arguments.length;d<x;d++){v=arguments[d];for(n in v)s[n]=v[n]}return s}var l=Object.create||function(){function s(){}return function(n){return s.prototype=n,new s}}();function c(s,n){var d=Array.prototype.slice;if(s.bind)return s.bind.apply(s,d.call(arguments,1));var x=d.call(arguments,2);return function(){return s.apply(n,x.length?x.concat(d.call(arguments)):arguments)}}var m=0;function u(s){return"_leaflet_id"in s||(s._leaflet_id=++m),s._leaflet_id}function h(s,n,d){var x,v,C,A;return A=function(){x=!1,v&&(C.apply(d,v),v=!1)},C=function(){x?v=arguments:(s.apply(d,arguments),setTimeout(A,n),x=!0)},C}function p(s,n,d){var x=n[1],v=n[0],C=x-v;return s===x&&d?s:((s-v)%C+C)%C+v}function g(){return!1}function b(s,n){if(n===!1)return s;var d=Math.pow(10,n===void 0?6:n);return Math.round(s*d)/d}function y(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}function j(s){return y(s).split(/\s+/)}function w(s,n){Object.prototype.hasOwnProperty.call(s,"options")||(s.options=s.options?l(s.options):{});for(var d in n)s.options[d]=n[d];return s.options}function N(s,n,d){var x=[];for(var v in s)x.push(encodeURIComponent(d?v.toUpperCase():v)+"="+encodeURIComponent(s[v]));return(!n||n.indexOf("?")===-1?"?":"&")+x.join("&")}var k=/\{ *([\w_ -]+) *\}/g;function S(s,n){return s.replace(k,function(d,x){var v=n[x];if(v===void 0)throw new Error("No value provided for variable "+d);return typeof v=="function"&&(v=v(n)),v})}var P=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"};function E(s,n){for(var d=0;d<s.length;d++)if(s[d]===n)return d;return-1}var T="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function D(s){return window["webkit"+s]||window["moz"+s]||window["ms"+s]}var R=0;function _(s){var n=+new Date,d=Math.max(0,16-(n-R));return R=n+d,window.setTimeout(s,d)}var M=window.requestAnimationFrame||D("RequestAnimationFrame")||_,I=window.cancelAnimationFrame||D("CancelAnimationFrame")||D("CancelRequestAnimationFrame")||function(s){window.clearTimeout(s)};function O(s,n,d){if(d&&M===_)s.call(n);else return M.call(window,c(s,n))}function F(s){s&&I.call(window,s)}var B={__proto__:null,extend:o,create:l,bind:c,get lastId(){return m},stamp:u,throttle:h,wrapNum:p,falseFn:g,formatNum:b,trim:y,splitWords:j,setOptions:w,getParamString:N,template:S,isArray:P,indexOf:E,emptyImageUrl:T,requestFn:M,cancelFn:I,requestAnimFrame:O,cancelAnimFrame:F};function q(){}q.extend=function(s){var n=function(){w(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},d=n.__super__=this.prototype,x=l(d);x.constructor=n,n.prototype=x;for(var v in this)Object.prototype.hasOwnProperty.call(this,v)&&v!=="prototype"&&v!=="__super__"&&(n[v]=this[v]);return s.statics&&o(n,s.statics),s.includes&&(G(s.includes),o.apply(null,[x].concat(s.includes))),o(x,s),delete x.statics,delete x.includes,x.options&&(x.options=d.options?l(d.options):{},o(x.options,s.options)),x._initHooks=[],x.callInitHooks=function(){if(!this._initHooksCalled){d.callInitHooks&&d.callInitHooks.call(this),this._initHooksCalled=!0;for(var C=0,A=x._initHooks.length;C<A;C++)x._initHooks[C].call(this)}},n},q.include=function(s){var n=this.prototype.options;return o(this.prototype,s),s.options&&(this.prototype.options=n,this.mergeOptions(s.options)),this},q.mergeOptions=function(s){return o(this.prototype.options,s),this},q.addInitHook=function(s){var n=Array.prototype.slice.call(arguments,1),d=typeof s=="function"?s:function(){this[s].apply(this,n)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(d),this};function G(s){if(!(typeof L>"u"||!L||!L.Mixin)){s=P(s)?s:[s];for(var n=0;n<s.length;n++)s[n]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var ee={on:function(s,n,d){if(typeof s=="object")for(var x in s)this._on(x,s[x],n);else{s=j(s);for(var v=0,C=s.length;v<C;v++)this._on(s[v],n,d)}return this},off:function(s,n,d){if(!arguments.length)delete this._events;else if(typeof s=="object")for(var x in s)this._off(x,s[x],n);else{s=j(s);for(var v=arguments.length===1,C=0,A=s.length;C<A;C++)v?this._off(s[C]):this._off(s[C],n,d)}return this},_on:function(s,n,d,x){if(typeof n!="function"){console.warn("wrong listener type: "+typeof n);return}if(this._listens(s,n,d)===!1){d===this&&(d=void 0);var v={fn:n,ctx:d};x&&(v.once=!0),this._events=this._events||{},this._events[s]=this._events[s]||[],this._events[s].push(v)}},_off:function(s,n,d){var x,v,C;if(this._events&&(x=this._events[s],!!x)){if(arguments.length===1){if(this._firingCount)for(v=0,C=x.length;v<C;v++)x[v].fn=g;delete this._events[s];return}if(typeof n!="function"){console.warn("wrong listener type: "+typeof n);return}var A=this._listens(s,n,d);if(A!==!1){var Z=x[A];this._firingCount&&(Z.fn=g,this._events[s]=x=x.slice()),x.splice(A,1)}}},fire:function(s,n,d){if(!this.listens(s,d))return this;var x=o({},n,{type:s,target:this,sourceTarget:n&&n.sourceTarget||this});if(this._events){var v=this._events[s];if(v){this._firingCount=this._firingCount+1||1;for(var C=0,A=v.length;C<A;C++){var Z=v[C],H=Z.fn;Z.once&&this.off(s,H,Z.ctx),H.call(Z.ctx||this,x)}this._firingCount--}}return d&&this._propagateEvent(x),this},listens:function(s,n,d,x){typeof s!="string"&&console.warn('"string" type argument expected');var v=n;typeof n!="function"&&(x=!!n,v=void 0,d=void 0);var C=this._events&&this._events[s];if(C&&C.length&&this._listens(s,v,d)!==!1)return!0;if(x){for(var A in this._eventParents)if(this._eventParents[A].listens(s,n,d,x))return!0}return!1},_listens:function(s,n,d){if(!this._events)return!1;var x=this._events[s]||[];if(!n)return!!x.length;d===this&&(d=void 0);for(var v=0,C=x.length;v<C;v++)if(x[v].fn===n&&x[v].ctx===d)return v;return!1},once:function(s,n,d){if(typeof s=="object")for(var x in s)this._on(x,s[x],n,!0);else{s=j(s);for(var v=0,C=s.length;v<C;v++)this._on(s[v],n,d,!0)}return this},addEventParent:function(s){return this._eventParents=this._eventParents||{},this._eventParents[u(s)]=s,this},removeEventParent:function(s){return this._eventParents&&delete this._eventParents[u(s)],this},_propagateEvent:function(s){for(var n in this._eventParents)this._eventParents[n].fire(s.type,o({layer:s.target,propagatedFrom:s.target},s),!0)}};ee.addEventListener=ee.on,ee.removeEventListener=ee.clearAllEventListeners=ee.off,ee.addOneTimeEventListener=ee.once,ee.fireEvent=ee.fire,ee.hasEventListeners=ee.listens;var te=q.extend(ee);function W(s,n,d){this.x=d?Math.round(s):s,this.y=d?Math.round(n):n}var me=Math.trunc||function(s){return s>0?Math.floor(s):Math.ceil(s)};W.prototype={clone:function(){return new W(this.x,this.y)},add:function(s){return this.clone()._add(se(s))},_add:function(s){return this.x+=s.x,this.y+=s.y,this},subtract:function(s){return this.clone()._subtract(se(s))},_subtract:function(s){return this.x-=s.x,this.y-=s.y,this},divideBy:function(s){return this.clone()._divideBy(s)},_divideBy:function(s){return this.x/=s,this.y/=s,this},multiplyBy:function(s){return this.clone()._multiplyBy(s)},_multiplyBy:function(s){return this.x*=s,this.y*=s,this},scaleBy:function(s){return new W(this.x*s.x,this.y*s.y)},unscaleBy:function(s){return new W(this.x/s.x,this.y/s.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=me(this.x),this.y=me(this.y),this},distanceTo:function(s){s=se(s);var n=s.x-this.x,d=s.y-this.y;return Math.sqrt(n*n+d*d)},equals:function(s){return s=se(s),s.x===this.x&&s.y===this.y},contains:function(s){return s=se(s),Math.abs(s.x)<=Math.abs(this.x)&&Math.abs(s.y)<=Math.abs(this.y)},toString:function(){return"Point("+b(this.x)+", "+b(this.y)+")"}};function se(s,n,d){return s instanceof W?s:P(s)?new W(s[0],s[1]):s==null?s:typeof s=="object"&&"x"in s&&"y"in s?new W(s.x,s.y):new W(s,n,d)}function ie(s,n){if(s)for(var d=n?[s,n]:s,x=0,v=d.length;x<v;x++)this.extend(d[x])}ie.prototype={extend:function(s){var n,d;if(!s)return this;if(s instanceof W||typeof s[0]=="number"||"x"in s)n=d=se(s);else if(s=ge(s),n=s.min,d=s.max,!n||!d)return this;return!this.min&&!this.max?(this.min=n.clone(),this.max=d.clone()):(this.min.x=Math.min(n.x,this.min.x),this.max.x=Math.max(d.x,this.max.x),this.min.y=Math.min(n.y,this.min.y),this.max.y=Math.max(d.y,this.max.y)),this},getCenter:function(s){return se((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,s)},getBottomLeft:function(){return se(this.min.x,this.max.y)},getTopRight:function(){return se(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(s){var n,d;return typeof s[0]=="number"||s instanceof W?s=se(s):s=ge(s),s instanceof ie?(n=s.min,d=s.max):n=d=s,n.x>=this.min.x&&d.x<=this.max.x&&n.y>=this.min.y&&d.y<=this.max.y},intersects:function(s){s=ge(s);var n=this.min,d=this.max,x=s.min,v=s.max,C=v.x>=n.x&&x.x<=d.x,A=v.y>=n.y&&x.y<=d.y;return C&&A},overlaps:function(s){s=ge(s);var n=this.min,d=this.max,x=s.min,v=s.max,C=v.x>n.x&&x.x<d.x,A=v.y>n.y&&x.y<d.y;return C&&A},isValid:function(){return!!(this.min&&this.max)},pad:function(s){var n=this.min,d=this.max,x=Math.abs(n.x-d.x)*s,v=Math.abs(n.y-d.y)*s;return ge(se(n.x-x,n.y-v),se(d.x+x,d.y+v))},equals:function(s){return s?(s=ge(s),this.min.equals(s.getTopLeft())&&this.max.equals(s.getBottomRight())):!1}};function ge(s,n){return!s||s instanceof ie?s:new ie(s,n)}function U(s,n){if(s)for(var d=n?[s,n]:s,x=0,v=d.length;x<v;x++)this.extend(d[x])}U.prototype={extend:function(s){var n=this._southWest,d=this._northEast,x,v;if(s instanceof Y)x=s,v=s;else if(s instanceof U){if(x=s._southWest,v=s._northEast,!x||!v)return this}else return s?this.extend(Q(s)||V(s)):this;return!n&&!d?(this._southWest=new Y(x.lat,x.lng),this._northEast=new Y(v.lat,v.lng)):(n.lat=Math.min(x.lat,n.lat),n.lng=Math.min(x.lng,n.lng),d.lat=Math.max(v.lat,d.lat),d.lng=Math.max(v.lng,d.lng)),this},pad:function(s){var n=this._southWest,d=this._northEast,x=Math.abs(n.lat-d.lat)*s,v=Math.abs(n.lng-d.lng)*s;return new U(new Y(n.lat-x,n.lng-v),new Y(d.lat+x,d.lng+v))},getCenter:function(){return new Y((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Y(this.getNorth(),this.getWest())},getSouthEast:function(){return new Y(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(s){typeof s[0]=="number"||s instanceof Y||"lat"in s?s=Q(s):s=V(s);var n=this._southWest,d=this._northEast,x,v;return s instanceof U?(x=s.getSouthWest(),v=s.getNorthEast()):x=v=s,x.lat>=n.lat&&v.lat<=d.lat&&x.lng>=n.lng&&v.lng<=d.lng},intersects:function(s){s=V(s);var n=this._southWest,d=this._northEast,x=s.getSouthWest(),v=s.getNorthEast(),C=v.lat>=n.lat&&x.lat<=d.lat,A=v.lng>=n.lng&&x.lng<=d.lng;return C&&A},overlaps:function(s){s=V(s);var n=this._southWest,d=this._northEast,x=s.getSouthWest(),v=s.getNorthEast(),C=v.lat>n.lat&&x.lat<d.lat,A=v.lng>n.lng&&x.lng<d.lng;return C&&A},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(s,n){return s?(s=V(s),this._southWest.equals(s.getSouthWest(),n)&&this._northEast.equals(s.getNorthEast(),n)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function V(s,n){return s instanceof U?s:new U(s,n)}function Y(s,n,d){if(isNaN(s)||isNaN(n))throw new Error("Invalid LatLng object: ("+s+", "+n+")");this.lat=+s,this.lng=+n,d!==void 0&&(this.alt=+d)}Y.prototype={equals:function(s,n){if(!s)return!1;s=Q(s);var d=Math.max(Math.abs(this.lat-s.lat),Math.abs(this.lng-s.lng));return d<=(n===void 0?1e-9:n)},toString:function(s){return"LatLng("+b(this.lat,s)+", "+b(this.lng,s)+")"},distanceTo:function(s){return pe.distance(this,Q(s))},wrap:function(){return pe.wrapLatLng(this)},toBounds:function(s){var n=180*s/40075017,d=n/Math.cos(Math.PI/180*this.lat);return V([this.lat-n,this.lng-d],[this.lat+n,this.lng+d])},clone:function(){return new Y(this.lat,this.lng,this.alt)}};function Q(s,n,d){return s instanceof Y?s:P(s)&&typeof s[0]!="object"?s.length===3?new Y(s[0],s[1],s[2]):s.length===2?new Y(s[0],s[1]):null:s==null?s:typeof s=="object"&&"lat"in s?new Y(s.lat,"lng"in s?s.lng:s.lon,s.alt):n===void 0?null:new Y(s,n,d)}var ce={latLngToPoint:function(s,n){var d=this.projection.project(s),x=this.scale(n);return this.transformation._transform(d,x)},pointToLatLng:function(s,n){var d=this.scale(n),x=this.transformation.untransform(s,d);return this.projection.unproject(x)},project:function(s){return this.projection.project(s)},unproject:function(s){return this.projection.unproject(s)},scale:function(s){return 256*Math.pow(2,s)},zoom:function(s){return Math.log(s/256)/Math.LN2},getProjectedBounds:function(s){if(this.infinite)return null;var n=this.projection.bounds,d=this.scale(s),x=this.transformation.transform(n.min,d),v=this.transformation.transform(n.max,d);return new ie(x,v)},infinite:!1,wrapLatLng:function(s){var n=this.wrapLng?p(s.lng,this.wrapLng,!0):s.lng,d=this.wrapLat?p(s.lat,this.wrapLat,!0):s.lat,x=s.alt;return new Y(d,n,x)},wrapLatLngBounds:function(s){var n=s.getCenter(),d=this.wrapLatLng(n),x=n.lat-d.lat,v=n.lng-d.lng;if(x===0&&v===0)return s;var C=s.getSouthWest(),A=s.getNorthEast(),Z=new Y(C.lat-x,C.lng-v),H=new Y(A.lat-x,A.lng-v);return new U(Z,H)}},pe=o({},ce,{wrapLng:[-180,180],R:6371e3,distance:function(s,n){var d=Math.PI/180,x=s.lat*d,v=n.lat*d,C=Math.sin((n.lat-s.lat)*d/2),A=Math.sin((n.lng-s.lng)*d/2),Z=C*C+Math.cos(x)*Math.cos(v)*A*A,H=2*Math.atan2(Math.sqrt(Z),Math.sqrt(1-Z));return this.R*H}}),$e=6378137,We={R:$e,MAX_LATITUDE:85.0511287798,project:function(s){var n=Math.PI/180,d=this.MAX_LATITUDE,x=Math.max(Math.min(d,s.lat),-d),v=Math.sin(x*n);return new W(this.R*s.lng*n,this.R*Math.log((1+v)/(1-v))/2)},unproject:function(s){var n=180/Math.PI;return new Y((2*Math.atan(Math.exp(s.y/this.R))-Math.PI/2)*n,s.x*n/this.R)},bounds:function(){var s=$e*Math.PI;return new ie([-s,-s],[s,s])}()};function Le(s,n,d,x){if(P(s)){this._a=s[0],this._b=s[1],this._c=s[2],this._d=s[3];return}this._a=s,this._b=n,this._c=d,this._d=x}Le.prototype={transform:function(s,n){return this._transform(s.clone(),n)},_transform:function(s,n){return n=n||1,s.x=n*(this._a*s.x+this._b),s.y=n*(this._c*s.y+this._d),s},untransform:function(s,n){return n=n||1,new W((s.x/n-this._b)/this._a,(s.y/n-this._d)/this._c)}};function xe(s,n,d,x){return new Le(s,n,d,x)}var Me=o({},pe,{code:"EPSG:3857",projection:We,transformation:function(){var s=.5/(Math.PI*We.R);return xe(s,.5,-s,.5)}()}),Ze=o({},Me,{code:"EPSG:900913"});function Dt(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function zs(s,n){var d="",x,v,C,A,Z,H;for(x=0,C=s.length;x<C;x++){for(Z=s[x],v=0,A=Z.length;v<A;v++)H=Z[v],d+=(v?"L":"M")+H.x+" "+H.y;d+=n?le.svg?"z":"x":""}return d||"M0 0"}var rs=document.documentElement.style,Ee="ActiveXObject"in window,Lt=Ee&&!document.addEventListener,K="msLaunchUri"in navigator&&!("documentMode"in document),be=ns("webkit"),Se=ns("android"),Ve=ns("android 2")||ns("android 3"),as=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),$=Se&&ns("Google")&&as<537&&!("AudioNode"in window),X=!!window.opera,oe=!K&&ns("chrome"),re=ns("gecko")&&!be&&!X&&!Ee,he=!oe&&ns("safari"),Re=ns("phantom"),dt="OTransition"in rs,at=navigator.platform.indexOf("Win")===0,Et=Ee&&"transition"in rs,Ke="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ve,nt="MozPerspective"in rs,Ht=!window.L_DISABLE_3D&&(Et||Ke||nt)&&!dt&&!Re,Wt=typeof orientation<"u"||ns("mobile"),it=Wt&&be,Fs=Wt&&Ke,kl=!window.PointerEvent&&window.MSPointerEvent,Cl=!!(window.PointerEvent||kl),Sl="ontouchstart"in window||!!window.TouchEvent,Rm=!window.L_NO_TOUCH&&(Sl||Cl),Mm=Wt&&X,Am=Wt&&re,Dm=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Im=function(){var s=!1;try{var n=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("testPassiveEventSupport",g,n),window.removeEventListener("testPassiveEventSupport",g,n)}catch{}return s}(),Om=function(){return!!document.createElement("canvas").getContext}(),Ni=!!(document.createElementNS&&Dt("svg").createSVGRect),zm=!!Ni&&function(){var s=document.createElement("div");return s.innerHTML="<svg/>",(s.firstChild&&s.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Fm=!Ni&&function(){try{var s=document.createElement("div");s.innerHTML='<v:shape adj="1"/>';var n=s.firstChild;return n.style.behavior="url(#default#VML)",n&&typeof n.adj=="object"}catch{return!1}}(),Bm=navigator.platform.indexOf("Mac")===0,$m=navigator.platform.indexOf("Linux")===0;function ns(s){return navigator.userAgent.toLowerCase().indexOf(s)>=0}var le={ie:Ee,ielt9:Lt,edge:K,webkit:be,android:Se,android23:Ve,androidStock:$,opera:X,chrome:oe,gecko:re,safari:he,phantom:Re,opera12:dt,win:at,ie3d:Et,webkit3d:Ke,gecko3d:nt,any3d:Ht,mobile:Wt,mobileWebkit:it,mobileWebkit3d:Fs,msPointer:kl,pointer:Cl,touch:Rm,touchNative:Sl,mobileOpera:Mm,mobileGecko:Am,retina:Dm,passiveEvents:Im,canvas:Om,svg:Ni,vml:Fm,inlineSvg:zm,mac:Bm,linux:$m},Tl=le.msPointer?"MSPointerDown":"pointerdown",Pl=le.msPointer?"MSPointerMove":"pointermove",Ll=le.msPointer?"MSPointerUp":"pointerup",El=le.msPointer?"MSPointerCancel":"pointercancel",ki={touchstart:Tl,touchmove:Pl,touchend:Ll,touchcancel:El},Rl={touchstart:qm,touchmove:dn,touchend:dn,touchcancel:dn},Dr={},Ml=!1;function Zm(s,n,d){return n==="touchstart"&&Vm(),Rl[n]?(d=Rl[n].bind(this,d),s.addEventListener(ki[n],d,!1),d):(console.warn("wrong event specified:",n),g)}function Um(s,n,d){if(!ki[n]){console.warn("wrong event specified:",n);return}s.removeEventListener(ki[n],d,!1)}function Hm(s){Dr[s.pointerId]=s}function Wm(s){Dr[s.pointerId]&&(Dr[s.pointerId]=s)}function Al(s){delete Dr[s.pointerId]}function Vm(){Ml||(document.addEventListener(Tl,Hm,!0),document.addEventListener(Pl,Wm,!0),document.addEventListener(Ll,Al,!0),document.addEventListener(El,Al,!0),Ml=!0)}function dn(s,n){if(n.pointerType!==(n.MSPOINTER_TYPE_MOUSE||"mouse")){n.touches=[];for(var d in Dr)n.touches.push(Dr[d]);n.changedTouches=[n],s(n)}}function qm(s,n){n.MSPOINTER_TYPE_TOUCH&&n.pointerType===n.MSPOINTER_TYPE_TOUCH&&ct(n),dn(s,n)}function Gm(s){var n={},d,x;for(x in s)d=s[x],n[x]=d&&d.bind?d.bind(s):d;return s=n,n.type="dblclick",n.detail=2,n.isTrusted=!1,n._simulated=!0,n}var Km=200;function Jm(s,n){s.addEventListener("dblclick",n);var d=0,x;function v(C){if(C.detail!==1){x=C.detail;return}if(!(C.pointerType==="mouse"||C.sourceCapabilities&&!C.sourceCapabilities.firesTouchEvents)){var A=Fl(C);if(!(A.some(function(H){return H instanceof HTMLLabelElement&&H.attributes.for})&&!A.some(function(H){return H instanceof HTMLInputElement||H instanceof HTMLSelectElement}))){var Z=Date.now();Z-d<=Km?(x++,x===2&&n(Gm(C))):x=1,d=Z}}}return s.addEventListener("click",v),{dblclick:n,simDblclick:v}}function Qm(s,n){s.removeEventListener("dblclick",n.dblclick),s.removeEventListener("click",n.simDblclick)}var Ci=mn(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ya=mn(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Dl=ya==="webkitTransition"||ya==="OTransition"?ya+"End":"transitionend";function Il(s){return typeof s=="string"?document.getElementById(s):s}function va(s,n){var d=s.style[n]||s.currentStyle&&s.currentStyle[n];if((!d||d==="auto")&&document.defaultView){var x=document.defaultView.getComputedStyle(s,null);d=x?x[n]:null}return d==="auto"?null:d}function Ce(s,n,d){var x=document.createElement(s);return x.className=n||"",d&&d.appendChild(x),x}function Fe(s){var n=s.parentNode;n&&n.removeChild(s)}function cn(s){for(;s.firstChild;)s.removeChild(s.firstChild)}function Ir(s){var n=s.parentNode;n&&n.lastChild!==s&&n.appendChild(s)}function Or(s){var n=s.parentNode;n&&n.firstChild!==s&&n.insertBefore(s,n.firstChild)}function Si(s,n){if(s.classList!==void 0)return s.classList.contains(n);var d=un(s);return d.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(d)}function ve(s,n){if(s.classList!==void 0)for(var d=j(n),x=0,v=d.length;x<v;x++)s.classList.add(d[x]);else if(!Si(s,n)){var C=un(s);Ti(s,(C?C+" ":"")+n)}}function qe(s,n){s.classList!==void 0?s.classList.remove(n):Ti(s,y((" "+un(s)+" ").replace(" "+n+" "," ")))}function Ti(s,n){s.className.baseVal===void 0?s.className=n:s.className.baseVal=n}function un(s){return s.correspondingElement&&(s=s.correspondingElement),s.className.baseVal===void 0?s.className:s.className.baseVal}function It(s,n){"opacity"in s.style?s.style.opacity=n:"filter"in s.style&&Ym(s,n)}function Ym(s,n){var d=!1,x="DXImageTransform.Microsoft.Alpha";try{d=s.filters.item(x)}catch{if(n===1)return}n=Math.round(n*100),d?(d.Enabled=n!==100,d.Opacity=n):s.style.filter+=" progid:"+x+"(opacity="+n+")"}function mn(s){for(var n=document.documentElement.style,d=0;d<s.length;d++)if(s[d]in n)return s[d];return!1}function lr(s,n,d){var x=n||new W(0,0);s.style[Ci]=(le.ie3d?"translate("+x.x+"px,"+x.y+"px)":"translate3d("+x.x+"px,"+x.y+"px,0)")+(d?" scale("+d+")":"")}function Je(s,n){s._leaflet_pos=n,le.any3d?lr(s,n):(s.style.left=n.x+"px",s.style.top=n.y+"px")}function dr(s){return s._leaflet_pos||new W(0,0)}var ja,_a,Pi;if("onselectstart"in document)ja=function(){fe(window,"selectstart",ct)},_a=function(){Ae(window,"selectstart",ct)};else{var wa=mn(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ja=function(){if(wa){var s=document.documentElement.style;Pi=s[wa],s[wa]="none"}},_a=function(){wa&&(document.documentElement.style[wa]=Pi,Pi=void 0)}}function Li(){fe(window,"dragstart",ct)}function Ei(){Ae(window,"dragstart",ct)}var hn,Ri;function Mi(s){for(;s.tabIndex===-1;)s=s.parentNode;s.style&&(xn(),hn=s,Ri=s.style.outlineStyle,s.style.outlineStyle="none",fe(window,"keydown",xn))}function xn(){hn&&(hn.style.outlineStyle=Ri,hn=void 0,Ri=void 0,Ae(window,"keydown",xn))}function Ol(s){do s=s.parentNode;while((!s.offsetWidth||!s.offsetHeight)&&s!==document.body);return s}function Ai(s){var n=s.getBoundingClientRect();return{x:n.width/s.offsetWidth||1,y:n.height/s.offsetHeight||1,boundingClientRect:n}}var Xm={__proto__:null,TRANSFORM:Ci,TRANSITION:ya,TRANSITION_END:Dl,get:Il,getStyle:va,create:Ce,remove:Fe,empty:cn,toFront:Ir,toBack:Or,hasClass:Si,addClass:ve,removeClass:qe,setClass:Ti,getClass:un,setOpacity:It,testProp:mn,setTransform:lr,setPosition:Je,getPosition:dr,get disableTextSelection(){return ja},get enableTextSelection(){return _a},disableImageDrag:Li,enableImageDrag:Ei,preventOutline:Mi,restoreOutline:xn,getSizedParentNode:Ol,getScale:Ai};function fe(s,n,d,x){if(n&&typeof n=="object")for(var v in n)Ii(s,v,n[v],d);else{n=j(n);for(var C=0,A=n.length;C<A;C++)Ii(s,n[C],d,x)}return this}var is="_leaflet_events";function Ae(s,n,d,x){if(arguments.length===1)zl(s),delete s[is];else if(n&&typeof n=="object")for(var v in n)Oi(s,v,n[v],d);else if(n=j(n),arguments.length===2)zl(s,function(Z){return E(n,Z)!==-1});else for(var C=0,A=n.length;C<A;C++)Oi(s,n[C],d,x);return this}function zl(s,n){for(var d in s[is]){var x=d.split(/\d/)[0];(!n||n(x))&&Oi(s,x,null,null,d)}}var Di={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ii(s,n,d,x){var v=n+u(d)+(x?"_"+u(x):"");if(s[is]&&s[is][v])return this;var C=function(Z){return d.call(x||s,Z||window.event)},A=C;!le.touchNative&&le.pointer&&n.indexOf("touch")===0?C=Zm(s,n,C):le.touch&&n==="dblclick"?C=Jm(s,C):"addEventListener"in s?n==="touchstart"||n==="touchmove"||n==="wheel"||n==="mousewheel"?s.addEventListener(Di[n]||n,C,le.passiveEvents?{passive:!1}:!1):n==="mouseenter"||n==="mouseleave"?(C=function(Z){Z=Z||window.event,Fi(s,Z)&&A(Z)},s.addEventListener(Di[n],C,!1)):s.addEventListener(n,A,!1):s.attachEvent("on"+n,C),s[is]=s[is]||{},s[is][v]=C}function Oi(s,n,d,x,v){v=v||n+u(d)+(x?"_"+u(x):"");var C=s[is]&&s[is][v];if(!C)return this;!le.touchNative&&le.pointer&&n.indexOf("touch")===0?Um(s,n,C):le.touch&&n==="dblclick"?Qm(s,C):"removeEventListener"in s?s.removeEventListener(Di[n]||n,C,!1):s.detachEvent("on"+n,C),s[is][v]=null}function cr(s){return s.stopPropagation?s.stopPropagation():s.originalEvent?s.originalEvent._stopped=!0:s.cancelBubble=!0,this}function zi(s){return Ii(s,"wheel",cr),this}function Na(s){return fe(s,"mousedown touchstart dblclick contextmenu",cr),s._leaflet_disable_click=!0,this}function ct(s){return s.preventDefault?s.preventDefault():s.returnValue=!1,this}function ur(s){return ct(s),cr(s),this}function Fl(s){if(s.composedPath)return s.composedPath();for(var n=[],d=s.target;d;)n.push(d),d=d.parentNode;return n}function Bl(s,n){if(!n)return new W(s.clientX,s.clientY);var d=Ai(n),x=d.boundingClientRect;return new W((s.clientX-x.left)/d.x-n.clientLeft,(s.clientY-x.top)/d.y-n.clientTop)}var eh=le.linux&&le.chrome?window.devicePixelRatio:le.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function $l(s){return le.edge?s.wheelDeltaY/2:s.deltaY&&s.deltaMode===0?-s.deltaY/eh:s.deltaY&&s.deltaMode===1?-s.deltaY*20:s.deltaY&&s.deltaMode===2?-s.deltaY*60:s.deltaX||s.deltaZ?0:s.wheelDelta?(s.wheelDeltaY||s.wheelDelta)/2:s.detail&&Math.abs(s.detail)<32765?-s.detail*20:s.detail?s.detail/-32765*60:0}function Fi(s,n){var d=n.relatedTarget;if(!d)return!0;try{for(;d&&d!==s;)d=d.parentNode}catch{return!1}return d!==s}var th={__proto__:null,on:fe,off:Ae,stopPropagation:cr,disableScrollPropagation:zi,disableClickPropagation:Na,preventDefault:ct,stop:ur,getPropagationPath:Fl,getMousePosition:Bl,getWheelDelta:$l,isExternalTarget:Fi,addListener:fe,removeListener:Ae},Zl=te.extend({run:function(s,n,d,x){this.stop(),this._el=s,this._inProgress=!0,this._duration=d||.25,this._easeOutPower=1/Math.max(x||.5,.2),this._startPos=dr(s),this._offset=n.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=O(this._animate,this),this._step()},_step:function(s){var n=+new Date-this._startTime,d=this._duration*1e3;n<d?this._runFrame(this._easeOut(n/d),s):(this._runFrame(1),this._complete())},_runFrame:function(s,n){var d=this._startPos.add(this._offset.multiplyBy(s));n&&d._round(),Je(this._el,d),this.fire("step")},_complete:function(){F(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(s){return 1-Math.pow(1-s,this._easeOutPower)}}),ke=te.extend({options:{crs:Me,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(s,n){n=w(this,n),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(s),this._initLayout(),this._onResize=c(this._onResize,this),this._initEvents(),n.maxBounds&&this.setMaxBounds(n.maxBounds),n.zoom!==void 0&&(this._zoom=this._limitZoom(n.zoom)),n.center&&n.zoom!==void 0&&this.setView(Q(n.center),n.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ya&&le.any3d&&!le.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),fe(this._proxy,Dl,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(s,n,d){if(n=n===void 0?this._zoom:this._limitZoom(n),s=this._limitCenter(Q(s),n,this.options.maxBounds),d=d||{},this._stop(),this._loaded&&!d.reset&&d!==!0){d.animate!==void 0&&(d.zoom=o({animate:d.animate},d.zoom),d.pan=o({animate:d.animate,duration:d.duration},d.pan));var x=this._zoom!==n?this._tryAnimatedZoom&&this._tryAnimatedZoom(s,n,d.zoom):this._tryAnimatedPan(s,d.pan);if(x)return clearTimeout(this._sizeTimer),this}return this._resetView(s,n,d.pan&&d.pan.noMoveStart),this},setZoom:function(s,n){return this._loaded?this.setView(this.getCenter(),s,{zoom:n}):(this._zoom=s,this)},zoomIn:function(s,n){return s=s||(le.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+s,n)},zoomOut:function(s,n){return s=s||(le.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-s,n)},setZoomAround:function(s,n,d){var x=this.getZoomScale(n),v=this.getSize().divideBy(2),C=s instanceof W?s:this.latLngToContainerPoint(s),A=C.subtract(v).multiplyBy(1-1/x),Z=this.containerPointToLatLng(v.add(A));return this.setView(Z,n,{zoom:d})},_getBoundsCenterZoom:function(s,n){n=n||{},s=s.getBounds?s.getBounds():V(s);var d=se(n.paddingTopLeft||n.padding||[0,0]),x=se(n.paddingBottomRight||n.padding||[0,0]),v=this.getBoundsZoom(s,!1,d.add(x));if(v=typeof n.maxZoom=="number"?Math.min(n.maxZoom,v):v,v===1/0)return{center:s.getCenter(),zoom:v};var C=x.subtract(d).divideBy(2),A=this.project(s.getSouthWest(),v),Z=this.project(s.getNorthEast(),v),H=this.unproject(A.add(Z).divideBy(2).add(C),v);return{center:H,zoom:v}},fitBounds:function(s,n){if(s=V(s),!s.isValid())throw new Error("Bounds are not valid.");var d=this._getBoundsCenterZoom(s,n);return this.setView(d.center,d.zoom,n)},fitWorld:function(s){return this.fitBounds([[-90,-180],[90,180]],s)},panTo:function(s,n){return this.setView(s,this._zoom,{pan:n})},panBy:function(s,n){if(s=se(s).round(),n=n||{},!s.x&&!s.y)return this.fire("moveend");if(n.animate!==!0&&!this.getSize().contains(s))return this._resetView(this.unproject(this.project(this.getCenter()).add(s)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Zl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),n.noMoveStart||this.fire("movestart"),n.animate!==!1){ve(this._mapPane,"leaflet-pan-anim");var d=this._getMapPanePos().subtract(s).round();this._panAnim.run(this._mapPane,d,n.duration||.25,n.easeLinearity)}else this._rawPanBy(s),this.fire("move").fire("moveend");return this},flyTo:function(s,n,d){if(d=d||{},d.animate===!1||!le.any3d)return this.setView(s,n,d);this._stop();var x=this.project(this.getCenter()),v=this.project(s),C=this.getSize(),A=this._zoom;s=Q(s),n=n===void 0?A:n;var Z=Math.max(C.x,C.y),H=Z*this.getZoomScale(A,n),J=v.distanceTo(x)||1,ae=1.42,ue=ae*ae;function _e(Qe){var Cn=Qe?-1:1,Uh=Qe?H:Z,Hh=H*H-Z*Z+Cn*ue*ue*J*J,Wh=2*Uh*ue*J,Ji=Hh/Wh,_d=Math.sqrt(Ji*Ji+1)-Ji,Vh=_d<1e-9?-18:Math.log(_d);return Vh}function yt(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function ot(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}function zt(Qe){return yt(Qe)/ot(Qe)}var wt=_e(0);function Ur(Qe){return Z*(ot(wt)/ot(wt+ae*Qe))}function Fh(Qe){return Z*(ot(wt)*zt(wt+ae*Qe)-yt(wt))/ue}function Bh(Qe){return 1-Math.pow(1-Qe,1.5)}var $h=Date.now(),vd=(_e(1)-wt)/ae,Zh=d.duration?1e3*d.duration:1e3*vd*.8;function jd(){var Qe=(Date.now()-$h)/Zh,Cn=Bh(Qe)*vd;Qe<=1?(this._flyToFrame=O(jd,this),this._move(this.unproject(x.add(v.subtract(x).multiplyBy(Fh(Cn)/J)),A),this.getScaleZoom(Z/Ur(Cn),A),{flyTo:!0})):this._move(s,n)._moveEnd(!0)}return this._moveStart(!0,d.noMoveStart),jd.call(this),this},flyToBounds:function(s,n){var d=this._getBoundsCenterZoom(s,n);return this.flyTo(d.center,d.zoom,n)},setMaxBounds:function(s){return s=V(s),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),s.isValid()?(this.options.maxBounds=s,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(s){var n=this.options.minZoom;return this.options.minZoom=s,this._loaded&&n!==s&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(s):this},setMaxZoom:function(s){var n=this.options.maxZoom;return this.options.maxZoom=s,this._loaded&&n!==s&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(s):this},panInsideBounds:function(s,n){this._enforcingBounds=!0;var d=this.getCenter(),x=this._limitCenter(d,this._zoom,V(s));return d.equals(x)||this.panTo(x,n),this._enforcingBounds=!1,this},panInside:function(s,n){n=n||{};var d=se(n.paddingTopLeft||n.padding||[0,0]),x=se(n.paddingBottomRight||n.padding||[0,0]),v=this.project(this.getCenter()),C=this.project(s),A=this.getPixelBounds(),Z=ge([A.min.add(d),A.max.subtract(x)]),H=Z.getSize();if(!Z.contains(C)){this._enforcingBounds=!0;var J=C.subtract(Z.getCenter()),ae=Z.extend(C).getSize().subtract(H);v.x+=J.x<0?-ae.x:ae.x,v.y+=J.y<0?-ae.y:ae.y,this.panTo(this.unproject(v),n),this._enforcingBounds=!1}return this},invalidateSize:function(s){if(!this._loaded)return this;s=o({animate:!1,pan:!0},s===!0?{animate:!0}:s);var n=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var d=this.getSize(),x=n.divideBy(2).round(),v=d.divideBy(2).round(),C=x.subtract(v);return!C.x&&!C.y?this:(s.animate&&s.pan?this.panBy(C):(s.pan&&this._rawPanBy(C),this.fire("move"),s.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(c(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:n,newSize:d}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(s){if(s=this._locateOptions=o({timeout:1e4,watch:!1},s),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var n=c(this._handleGeolocationResponse,this),d=c(this._handleGeolocationError,this);return s.watch?this._locationWatchId=navigator.geolocation.watchPosition(n,d,s):navigator.geolocation.getCurrentPosition(n,d,s),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(s){if(this._container._leaflet_id){var n=s.code,d=s.message||(n===1?"permission denied":n===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:n,message:"Geolocation error: "+d+"."})}},_handleGeolocationResponse:function(s){if(this._container._leaflet_id){var n=s.coords.latitude,d=s.coords.longitude,x=new Y(n,d),v=x.toBounds(s.coords.accuracy*2),C=this._locateOptions;if(C.setView){var A=this.getBoundsZoom(v);this.setView(x,C.maxZoom?Math.min(A,C.maxZoom):A)}var Z={latlng:x,bounds:v,timestamp:s.timestamp};for(var H in s.coords)typeof s.coords[H]=="number"&&(Z[H]=s.coords[H]);this.fire("locationfound",Z)}},addHandler:function(s,n){if(!n)return this;var d=this[s]=new n(this);return this._handlers.push(d),this.options[s]&&d.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Fe(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(F(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var s;for(s in this._layers)this._layers[s].remove();for(s in this._panes)Fe(this._panes[s]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(s,n){var d="leaflet-pane"+(s?" leaflet-"+s.replace("Pane","")+"-pane":""),x=Ce("div",d,n||this._mapPane);return s&&(this._panes[s]=x),x},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var s=this.getPixelBounds(),n=this.unproject(s.getBottomLeft()),d=this.unproject(s.getTopRight());return new U(n,d)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(s,n,d){s=V(s),d=se(d||[0,0]);var x=this.getZoom()||0,v=this.getMinZoom(),C=this.getMaxZoom(),A=s.getNorthWest(),Z=s.getSouthEast(),H=this.getSize().subtract(d),J=ge(this.project(Z,x),this.project(A,x)).getSize(),ae=le.any3d?this.options.zoomSnap:1,ue=H.x/J.x,_e=H.y/J.y,yt=n?Math.max(ue,_e):Math.min(ue,_e);return x=this.getScaleZoom(yt,x),ae&&(x=Math.round(x/(ae/100))*(ae/100),x=n?Math.ceil(x/ae)*ae:Math.floor(x/ae)*ae),Math.max(v,Math.min(C,x))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new W(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(s,n){var d=this._getTopLeftPoint(s,n);return new ie(d,d.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(s){return this.options.crs.getProjectedBounds(s===void 0?this.getZoom():s)},getPane:function(s){return typeof s=="string"?this._panes[s]:s},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(s,n){var d=this.options.crs;return n=n===void 0?this._zoom:n,d.scale(s)/d.scale(n)},getScaleZoom:function(s,n){var d=this.options.crs;n=n===void 0?this._zoom:n;var x=d.zoom(s*d.scale(n));return isNaN(x)?1/0:x},project:function(s,n){return n=n===void 0?this._zoom:n,this.options.crs.latLngToPoint(Q(s),n)},unproject:function(s,n){return n=n===void 0?this._zoom:n,this.options.crs.pointToLatLng(se(s),n)},layerPointToLatLng:function(s){var n=se(s).add(this.getPixelOrigin());return this.unproject(n)},latLngToLayerPoint:function(s){var n=this.project(Q(s))._round();return n._subtract(this.getPixelOrigin())},wrapLatLng:function(s){return this.options.crs.wrapLatLng(Q(s))},wrapLatLngBounds:function(s){return this.options.crs.wrapLatLngBounds(V(s))},distance:function(s,n){return this.options.crs.distance(Q(s),Q(n))},containerPointToLayerPoint:function(s){return se(s).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(s){return se(s).add(this._getMapPanePos())},containerPointToLatLng:function(s){var n=this.containerPointToLayerPoint(se(s));return this.layerPointToLatLng(n)},latLngToContainerPoint:function(s){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Q(s)))},mouseEventToContainerPoint:function(s){return Bl(s,this._container)},mouseEventToLayerPoint:function(s){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(s))},mouseEventToLatLng:function(s){return this.layerPointToLatLng(this.mouseEventToLayerPoint(s))},_initContainer:function(s){var n=this._container=Il(s);if(n){if(n._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");fe(n,"scroll",this._onScroll,this),this._containerId=u(n)},_initLayout:function(){var s=this._container;this._fadeAnimated=this.options.fadeAnimation&&le.any3d,ve(s,"leaflet-container"+(le.touch?" leaflet-touch":"")+(le.retina?" leaflet-retina":"")+(le.ielt9?" leaflet-oldie":"")+(le.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var n=va(s,"position");n!=="absolute"&&n!=="relative"&&n!=="fixed"&&n!=="sticky"&&(s.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var s=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Je(this._mapPane,new W(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ve(s.markerPane,"leaflet-zoom-hide"),ve(s.shadowPane,"leaflet-zoom-hide"))},_resetView:function(s,n,d){Je(this._mapPane,new W(0,0));var x=!this._loaded;this._loaded=!0,n=this._limitZoom(n),this.fire("viewprereset");var v=this._zoom!==n;this._moveStart(v,d)._move(s,n)._moveEnd(v),this.fire("viewreset"),x&&this.fire("load")},_moveStart:function(s,n){return s&&this.fire("zoomstart"),n||this.fire("movestart"),this},_move:function(s,n,d,x){n===void 0&&(n=this._zoom);var v=this._zoom!==n;return this._zoom=n,this._lastCenter=s,this._pixelOrigin=this._getNewPixelOrigin(s),x?d&&d.pinch&&this.fire("zoom",d):((v||d&&d.pinch)&&this.fire("zoom",d),this.fire("move",d)),this},_moveEnd:function(s){return s&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return F(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(s){Je(this._mapPane,this._getMapPanePos().subtract(s))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(s){this._targets={},this._targets[u(this._container)]=this;var n=s?Ae:fe;n(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&n(window,"resize",this._onResize,this),le.any3d&&this.options.transform3DLimit&&(s?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){F(this._resizeRequest),this._resizeRequest=O(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var s=this._getMapPanePos();Math.max(Math.abs(s.x),Math.abs(s.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(s,n){for(var d=[],x,v=n==="mouseout"||n==="mouseover",C=s.target||s.srcElement,A=!1;C;){if(x=this._targets[u(C)],x&&(n==="click"||n==="preclick")&&this._draggableMoved(x)){A=!0;break}if(x&&x.listens(n,!0)&&(v&&!Fi(C,s)||(d.push(x),v))||C===this._container)break;C=C.parentNode}return!d.length&&!A&&!v&&this.listens(n,!0)&&(d=[this]),d},_isClickDisabled:function(s){for(;s&&s!==this._container;){if(s._leaflet_disable_click)return!0;s=s.parentNode}},_handleDOMEvent:function(s){var n=s.target||s.srcElement;if(!(!this._loaded||n._leaflet_disable_events||s.type==="click"&&this._isClickDisabled(n))){var d=s.type;d==="mousedown"&&Mi(n),this._fireDOMEvent(s,d)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(s,n,d){if(s.type==="click"){var x=o({},s);x.type="preclick",this._fireDOMEvent(x,x.type,d)}var v=this._findEventTargets(s,n);if(d){for(var C=[],A=0;A<d.length;A++)d[A].listens(n,!0)&&C.push(d[A]);v=C.concat(v)}if(v.length){n==="contextmenu"&&ct(s);var Z=v[0],H={originalEvent:s};if(s.type!=="keypress"&&s.type!=="keydown"&&s.type!=="keyup"){var J=Z.getLatLng&&(!Z._radius||Z._radius<=10);H.containerPoint=J?this.latLngToContainerPoint(Z.getLatLng()):this.mouseEventToContainerPoint(s),H.layerPoint=this.containerPointToLayerPoint(H.containerPoint),H.latlng=J?Z.getLatLng():this.layerPointToLatLng(H.layerPoint)}for(A=0;A<v.length;A++)if(v[A].fire(n,H,!0),H.originalEvent._stopped||v[A].options.bubblingMouseEvents===!1&&E(this._mouseEvents,n)!==-1)return}},_draggableMoved:function(s){return s=s.dragging&&s.dragging.enabled()?s:this,s.dragging&&s.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var s=0,n=this._handlers.length;s<n;s++)this._handlers[s].disable()},whenReady:function(s,n){return this._loaded?s.call(n||this,{target:this}):this.on("load",s,n),this},_getMapPanePos:function(){return dr(this._mapPane)||new W(0,0)},_moved:function(){var s=this._getMapPanePos();return s&&!s.equals([0,0])},_getTopLeftPoint:function(s,n){var d=s&&n!==void 0?this._getNewPixelOrigin(s,n):this.getPixelOrigin();return d.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(s,n){var d=this.getSize()._divideBy(2);return this.project(s,n)._subtract(d)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(s,n,d){var x=this._getNewPixelOrigin(d,n);return this.project(s,n)._subtract(x)},_latLngBoundsToNewLayerBounds:function(s,n,d){var x=this._getNewPixelOrigin(d,n);return ge([this.project(s.getSouthWest(),n)._subtract(x),this.project(s.getNorthWest(),n)._subtract(x),this.project(s.getSouthEast(),n)._subtract(x),this.project(s.getNorthEast(),n)._subtract(x)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(s){return this.latLngToLayerPoint(s).subtract(this._getCenterLayerPoint())},_limitCenter:function(s,n,d){if(!d)return s;var x=this.project(s,n),v=this.getSize().divideBy(2),C=new ie(x.subtract(v),x.add(v)),A=this._getBoundsOffset(C,d,n);return Math.abs(A.x)<=1&&Math.abs(A.y)<=1?s:this.unproject(x.add(A),n)},_limitOffset:function(s,n){if(!n)return s;var d=this.getPixelBounds(),x=new ie(d.min.add(s),d.max.add(s));return s.add(this._getBoundsOffset(x,n))},_getBoundsOffset:function(s,n,d){var x=ge(this.project(n.getNorthEast(),d),this.project(n.getSouthWest(),d)),v=x.min.subtract(s.min),C=x.max.subtract(s.max),A=this._rebound(v.x,-C.x),Z=this._rebound(v.y,-C.y);return new W(A,Z)},_rebound:function(s,n){return s+n>0?Math.round(s-n)/2:Math.max(0,Math.ceil(s))-Math.max(0,Math.floor(n))},_limitZoom:function(s){var n=this.getMinZoom(),d=this.getMaxZoom(),x=le.any3d?this.options.zoomSnap:1;return x&&(s=Math.round(s/x)*x),Math.max(n,Math.min(d,s))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){qe(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(s,n){var d=this._getCenterOffset(s)._trunc();return(n&&n.animate)!==!0&&!this.getSize().contains(d)?!1:(this.panBy(d,n),!0)},_createAnimProxy:function(){var s=this._proxy=Ce("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(s),this.on("zoomanim",function(n){var d=Ci,x=this._proxy.style[d];lr(this._proxy,this.project(n.center,n.zoom),this.getZoomScale(n.zoom,1)),x===this._proxy.style[d]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Fe(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var s=this.getCenter(),n=this.getZoom();lr(this._proxy,this.project(s,n),this.getZoomScale(n,1))},_catchTransitionEnd:function(s){this._animatingZoom&&s.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(s,n,d){if(this._animatingZoom)return!0;if(d=d||{},!this._zoomAnimated||d.animate===!1||this._nothingToAnimate()||Math.abs(n-this._zoom)>this.options.zoomAnimationThreshold)return!1;var x=this.getZoomScale(n),v=this._getCenterOffset(s)._divideBy(1-1/x);return d.animate!==!0&&!this.getSize().contains(v)?!1:(O(function(){this._moveStart(!0,d.noMoveStart||!1)._animateZoom(s,n,!0)},this),!0)},_animateZoom:function(s,n,d,x){this._mapPane&&(d&&(this._animatingZoom=!0,this._animateToCenter=s,this._animateToZoom=n,ve(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:s,zoom:n,noUpdate:x}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(c(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&qe(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function sh(s,n){return new ke(s,n)}var Vt=q.extend({options:{position:"topright"},initialize:function(s){w(this,s)},getPosition:function(){return this.options.position},setPosition:function(s){var n=this._map;return n&&n.removeControl(this),this.options.position=s,n&&n.addControl(this),this},getContainer:function(){return this._container},addTo:function(s){this.remove(),this._map=s;var n=this._container=this.onAdd(s),d=this.getPosition(),x=s._controlCorners[d];return ve(n,"leaflet-control"),d.indexOf("bottom")!==-1?x.insertBefore(n,x.firstChild):x.appendChild(n),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Fe(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(s){this._map&&s&&s.screenX>0&&s.screenY>0&&this._map.getContainer().focus()}}),ka=function(s){return new Vt(s)};ke.include({addControl:function(s){return s.addTo(this),this},removeControl:function(s){return s.remove(),this},_initControlPos:function(){var s=this._controlCorners={},n="leaflet-",d=this._controlContainer=Ce("div",n+"control-container",this._container);function x(v,C){var A=n+v+" "+n+C;s[v+C]=Ce("div",A,d)}x("top","left"),x("top","right"),x("bottom","left"),x("bottom","right")},_clearControlPos:function(){for(var s in this._controlCorners)Fe(this._controlCorners[s]);Fe(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ul=Vt.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(s,n,d,x){return d<x?-1:x<d?1:0}},initialize:function(s,n,d){w(this,d),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var x in s)this._addLayer(s[x],x);for(x in n)this._addLayer(n[x],x,!0)},onAdd:function(s){this._initLayout(),this._update(),this._map=s,s.on("zoomend",this._checkDisabledLayers,this);for(var n=0;n<this._layers.length;n++)this._layers[n].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(s){return Vt.prototype.addTo.call(this,s),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var s=0;s<this._layers.length;s++)this._layers[s].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(s,n){return this._addLayer(s,n),this._map?this._update():this},addOverlay:function(s,n){return this._addLayer(s,n,!0),this._map?this._update():this},removeLayer:function(s){s.off("add remove",this._onLayerChange,this);var n=this._getLayer(u(s));return n&&this._layers.splice(this._layers.indexOf(n),1),this._map?this._update():this},expand:function(){ve(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var s=this._map.getSize().y-(this._container.offsetTop+50);return s<this._section.clientHeight?(ve(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=s+"px"):qe(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return qe(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var s="leaflet-control-layers",n=this._container=Ce("div",s),d=this.options.collapsed;n.setAttribute("aria-haspopup",!0),Na(n),zi(n);var x=this._section=Ce("section",s+"-list");d&&(this._map.on("click",this.collapse,this),fe(n,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var v=this._layersLink=Ce("a",s+"-toggle",n);v.href="#",v.title="Layers",v.setAttribute("role","button"),fe(v,{keydown:function(C){C.keyCode===13&&this._expandSafely()},click:function(C){ct(C),this._expandSafely()}},this),d||this.expand(),this._baseLayersList=Ce("div",s+"-base",x),this._separator=Ce("div",s+"-separator",x),this._overlaysList=Ce("div",s+"-overlays",x),n.appendChild(x)},_getLayer:function(s){for(var n=0;n<this._layers.length;n++)if(this._layers[n]&&u(this._layers[n].layer)===s)return this._layers[n]},_addLayer:function(s,n,d){this._map&&s.on("add remove",this._onLayerChange,this),this._layers.push({layer:s,name:n,overlay:d}),this.options.sortLayers&&this._layers.sort(c(function(x,v){return this.options.sortFunction(x.layer,v.layer,x.name,v.name)},this)),this.options.autoZIndex&&s.setZIndex&&(this._lastZIndex++,s.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;cn(this._baseLayersList),cn(this._overlaysList),this._layerControlInputs=[];var s,n,d,x,v=0;for(d=0;d<this._layers.length;d++)x=this._layers[d],this._addItem(x),n=n||x.overlay,s=s||!x.overlay,v+=x.overlay?0:1;return this.options.hideSingleBase&&(s=s&&v>1,this._baseLayersList.style.display=s?"":"none"),this._separator.style.display=n&&s?"":"none",this},_onLayerChange:function(s){this._handlingClick||this._update();var n=this._getLayer(u(s.target)),d=n.overlay?s.type==="add"?"overlayadd":"overlayremove":s.type==="add"?"baselayerchange":null;d&&this._map.fire(d,n)},_createRadioElement:function(s,n){var d='<input type="radio" class="leaflet-control-layers-selector" name="'+s+'"'+(n?' checked="checked"':"")+"/>",x=document.createElement("div");return x.innerHTML=d,x.firstChild},_addItem:function(s){var n=document.createElement("label"),d=this._map.hasLayer(s.layer),x;s.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="leaflet-control-layers-selector",x.defaultChecked=d):x=this._createRadioElement("leaflet-base-layers_"+u(this),d),this._layerControlInputs.push(x),x.layerId=u(s.layer),fe(x,"click",this._onInputClick,this);var v=document.createElement("span");v.innerHTML=" "+s.name;var C=document.createElement("span");n.appendChild(C),C.appendChild(x),C.appendChild(v);var A=s.overlay?this._overlaysList:this._baseLayersList;return A.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var s=this._layerControlInputs,n,d,x=[],v=[];this._handlingClick=!0;for(var C=s.length-1;C>=0;C--)n=s[C],d=this._getLayer(n.layerId).layer,n.checked?x.push(d):n.checked||v.push(d);for(C=0;C<v.length;C++)this._map.hasLayer(v[C])&&this._map.removeLayer(v[C]);for(C=0;C<x.length;C++)this._map.hasLayer(x[C])||this._map.addLayer(x[C]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var s=this._layerControlInputs,n,d,x=this._map.getZoom(),v=s.length-1;v>=0;v--)n=s[v],d=this._getLayer(n.layerId).layer,n.disabled=d.options.minZoom!==void 0&&x<d.options.minZoom||d.options.maxZoom!==void 0&&x>d.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var s=this._section;this._preventClick=!0,fe(s,"click",ct),this.expand();var n=this;setTimeout(function(){Ae(s,"click",ct),n._preventClick=!1})}}),rh=function(s,n,d){return new Ul(s,n,d)},Bi=Vt.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(s){var n="leaflet-control-zoom",d=Ce("div",n+" leaflet-bar"),x=this.options;return this._zoomInButton=this._createButton(x.zoomInText,x.zoomInTitle,n+"-in",d,this._zoomIn),this._zoomOutButton=this._createButton(x.zoomOutText,x.zoomOutTitle,n+"-out",d,this._zoomOut),this._updateDisabled(),s.on("zoomend zoomlevelschange",this._updateDisabled,this),d},onRemove:function(s){s.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(s){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(s.shiftKey?3:1))},_zoomOut:function(s){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(s.shiftKey?3:1))},_createButton:function(s,n,d,x,v){var C=Ce("a",d,x);return C.innerHTML=s,C.href="#",C.title=n,C.setAttribute("role","button"),C.setAttribute("aria-label",n),Na(C),fe(C,"click",ur),fe(C,"click",v,this),fe(C,"click",this._refocusOnMap,this),C},_updateDisabled:function(){var s=this._map,n="leaflet-disabled";qe(this._zoomInButton,n),qe(this._zoomOutButton,n),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||s._zoom===s.getMinZoom())&&(ve(this._zoomOutButton,n),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||s._zoom===s.getMaxZoom())&&(ve(this._zoomInButton,n),this._zoomInButton.setAttribute("aria-disabled","true"))}});ke.mergeOptions({zoomControl:!0}),ke.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Bi,this.addControl(this.zoomControl))});var ah=function(s){return new Bi(s)},Hl=Vt.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(s){var n="leaflet-control-scale",d=Ce("div",n),x=this.options;return this._addScales(x,n+"-line",d),s.on(x.updateWhenIdle?"moveend":"move",this._update,this),s.whenReady(this._update,this),d},onRemove:function(s){s.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(s,n,d){s.metric&&(this._mScale=Ce("div",n,d)),s.imperial&&(this._iScale=Ce("div",n,d))},_update:function(){var s=this._map,n=s.getSize().y/2,d=s.distance(s.containerPointToLatLng([0,n]),s.containerPointToLatLng([this.options.maxWidth,n]));this._updateScales(d)},_updateScales:function(s){this.options.metric&&s&&this._updateMetric(s),this.options.imperial&&s&&this._updateImperial(s)},_updateMetric:function(s){var n=this._getRoundNum(s),d=n<1e3?n+" m":n/1e3+" km";this._updateScale(this._mScale,d,n/s)},_updateImperial:function(s){var n=s*3.2808399,d,x,v;n>5280?(d=n/5280,x=this._getRoundNum(d),this._updateScale(this._iScale,x+" mi",x/d)):(v=this._getRoundNum(n),this._updateScale(this._iScale,v+" ft",v/n))},_updateScale:function(s,n,d){s.style.width=Math.round(this.options.maxWidth*d)+"px",s.innerHTML=n},_getRoundNum:function(s){var n=Math.pow(10,(Math.floor(s)+"").length-1),d=s/n;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,n*d}}),nh=function(s){return new Hl(s)},ih='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',$i=Vt.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(le.inlineSvg?ih+" ":"")+"Leaflet</a>"},initialize:function(s){w(this,s),this._attributions={}},onAdd:function(s){s.attributionControl=this,this._container=Ce("div","leaflet-control-attribution"),Na(this._container);for(var n in s._layers)s._layers[n].getAttribution&&this.addAttribution(s._layers[n].getAttribution());return this._update(),s.on("layeradd",this._addAttribution,this),this._container},onRemove:function(s){s.off("layeradd",this._addAttribution,this)},_addAttribution:function(s){s.layer.getAttribution&&(this.addAttribution(s.layer.getAttribution()),s.layer.once("remove",function(){this.removeAttribution(s.layer.getAttribution())},this))},setPrefix:function(s){return this.options.prefix=s,this._update(),this},addAttribution:function(s){return s?(this._attributions[s]||(this._attributions[s]=0),this._attributions[s]++,this._update(),this):this},removeAttribution:function(s){return s?(this._attributions[s]&&(this._attributions[s]--,this._update()),this):this},_update:function(){if(this._map){var s=[];for(var n in this._attributions)this._attributions[n]&&s.push(n);var d=[];this.options.prefix&&d.push(this.options.prefix),s.length&&d.push(s.join(", ")),this._container.innerHTML=d.join(' <span aria-hidden="true">|</span> ')}}});ke.mergeOptions({attributionControl:!0}),ke.addInitHook(function(){this.options.attributionControl&&new $i().addTo(this)});var oh=function(s){return new $i(s)};Vt.Layers=Ul,Vt.Zoom=Bi,Vt.Scale=Hl,Vt.Attribution=$i,ka.layers=rh,ka.zoom=ah,ka.scale=nh,ka.attribution=oh;var os=q.extend({initialize:function(s){this._map=s},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});os.addTo=function(s,n){return s.addHandler(n,this),this};var lh={Events:ee},Wl=le.touch?"touchstart mousedown":"mousedown",Bs=te.extend({options:{clickTolerance:3},initialize:function(s,n,d,x){w(this,x),this._element=s,this._dragStartTarget=n||s,this._preventOutline=d},enable:function(){this._enabled||(fe(this._dragStartTarget,Wl,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Bs._dragging===this&&this.finishDrag(!0),Ae(this._dragStartTarget,Wl,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(s){if(this._enabled&&(this._moved=!1,!Si(this._element,"leaflet-zoom-anim"))){if(s.touches&&s.touches.length!==1){Bs._dragging===this&&this.finishDrag();return}if(!(Bs._dragging||s.shiftKey||s.which!==1&&s.button!==1&&!s.touches)&&(Bs._dragging=this,this._preventOutline&&Mi(this._element),Li(),ja(),!this._moving)){this.fire("down");var n=s.touches?s.touches[0]:s,d=Ol(this._element);this._startPoint=new W(n.clientX,n.clientY),this._startPos=dr(this._element),this._parentScale=Ai(d);var x=s.type==="mousedown";fe(document,x?"mousemove":"touchmove",this._onMove,this),fe(document,x?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(s){if(this._enabled){if(s.touches&&s.touches.length>1){this._moved=!0;return}var n=s.touches&&s.touches.length===1?s.touches[0]:s,d=new W(n.clientX,n.clientY)._subtract(this._startPoint);!d.x&&!d.y||Math.abs(d.x)+Math.abs(d.y)<this.options.clickTolerance||(d.x/=this._parentScale.x,d.y/=this._parentScale.y,ct(s),this._moved||(this.fire("dragstart"),this._moved=!0,ve(document.body,"leaflet-dragging"),this._lastTarget=s.target||s.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ve(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(d),this._moving=!0,this._lastEvent=s,this._updatePosition())}},_updatePosition:function(){var s={originalEvent:this._lastEvent};this.fire("predrag",s),Je(this._element,this._newPos),this.fire("drag",s)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(s){qe(document.body,"leaflet-dragging"),this._lastTarget&&(qe(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ae(document,"mousemove touchmove",this._onMove,this),Ae(document,"mouseup touchend touchcancel",this._onUp,this),Ei(),_a();var n=this._moved&&this._moving;this._moving=!1,Bs._dragging=!1,n&&this.fire("dragend",{noInertia:s,distance:this._newPos.distanceTo(this._startPos)})}});function Vl(s,n,d){var x,v=[1,4,2,8],C,A,Z,H,J,ae,ue,_e;for(C=0,ae=s.length;C<ae;C++)s[C]._code=mr(s[C],n);for(Z=0;Z<4;Z++){for(ue=v[Z],x=[],C=0,ae=s.length,A=ae-1;C<ae;A=C++)H=s[C],J=s[A],H._code&ue?J._code&ue||(_e=pn(J,H,ue,n,d),_e._code=mr(_e,n),x.push(_e)):(J._code&ue&&(_e=pn(J,H,ue,n,d),_e._code=mr(_e,n),x.push(_e)),x.push(H));s=x}return s}function ql(s,n){var d,x,v,C,A,Z,H,J,ae;if(!s||s.length===0)throw new Error("latlngs not passed");Ot(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var ue=Q([0,0]),_e=V(s),yt=_e.getNorthWest().distanceTo(_e.getSouthWest())*_e.getNorthEast().distanceTo(_e.getNorthWest());yt<1700&&(ue=Zi(s));var ot=s.length,zt=[];for(d=0;d<ot;d++){var wt=Q(s[d]);zt.push(n.project(Q([wt.lat-ue.lat,wt.lng-ue.lng])))}for(Z=H=J=0,d=0,x=ot-1;d<ot;x=d++)v=zt[d],C=zt[x],A=v.y*C.x-C.y*v.x,H+=(v.x+C.x)*A,J+=(v.y+C.y)*A,Z+=A*3;Z===0?ae=zt[0]:ae=[H/Z,J/Z];var Ur=n.unproject(se(ae));return Q([Ur.lat+ue.lat,Ur.lng+ue.lng])}function Zi(s){for(var n=0,d=0,x=0,v=0;v<s.length;v++){var C=Q(s[v]);n+=C.lat,d+=C.lng,x++}return Q([n/x,d/x])}var dh={__proto__:null,clipPolygon:Vl,polygonCenter:ql,centroid:Zi};function Gl(s,n){if(!n||!s.length)return s.slice();var d=n*n;return s=mh(s,d),s=uh(s,d),s}function Kl(s,n,d){return Math.sqrt(Ca(s,n,d,!0))}function ch(s,n,d){return Ca(s,n,d)}function uh(s,n){var d=s.length,x=typeof Uint8Array<"u"?Uint8Array:Array,v=new x(d);v[0]=v[d-1]=1,Ui(s,v,n,0,d-1);var C,A=[];for(C=0;C<d;C++)v[C]&&A.push(s[C]);return A}function Ui(s,n,d,x,v){var C=0,A,Z,H;for(Z=x+1;Z<=v-1;Z++)H=Ca(s[Z],s[x],s[v],!0),H>C&&(A=Z,C=H);C>d&&(n[A]=1,Ui(s,n,d,x,A),Ui(s,n,d,A,v))}function mh(s,n){for(var d=[s[0]],x=1,v=0,C=s.length;x<C;x++)hh(s[x],s[v])>n&&(d.push(s[x]),v=x);return v<C-1&&d.push(s[C-1]),d}var Jl;function Ql(s,n,d,x,v){var C=x?Jl:mr(s,d),A=mr(n,d),Z,H,J;for(Jl=A;;){if(!(C|A))return[s,n];if(C&A)return!1;Z=C||A,H=pn(s,n,Z,d,v),J=mr(H,d),Z===C?(s=H,C=J):(n=H,A=J)}}function pn(s,n,d,x,v){var C=n.x-s.x,A=n.y-s.y,Z=x.min,H=x.max,J,ae;return d&8?(J=s.x+C*(H.y-s.y)/A,ae=H.y):d&4?(J=s.x+C*(Z.y-s.y)/A,ae=Z.y):d&2?(J=H.x,ae=s.y+A*(H.x-s.x)/C):d&1&&(J=Z.x,ae=s.y+A*(Z.x-s.x)/C),new W(J,ae,v)}function mr(s,n){var d=0;return s.x<n.min.x?d|=1:s.x>n.max.x&&(d|=2),s.y<n.min.y?d|=4:s.y>n.max.y&&(d|=8),d}function hh(s,n){var d=n.x-s.x,x=n.y-s.y;return d*d+x*x}function Ca(s,n,d,x){var v=n.x,C=n.y,A=d.x-v,Z=d.y-C,H=A*A+Z*Z,J;return H>0&&(J=((s.x-v)*A+(s.y-C)*Z)/H,J>1?(v=d.x,C=d.y):J>0&&(v+=A*J,C+=Z*J)),A=s.x-v,Z=s.y-C,x?A*A+Z*Z:new W(v,C)}function Ot(s){return!P(s[0])||typeof s[0][0]!="object"&&typeof s[0][0]<"u"}function Yl(s){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ot(s)}function Xl(s,n){var d,x,v,C,A,Z,H,J;if(!s||s.length===0)throw new Error("latlngs not passed");Ot(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var ae=Q([0,0]),ue=V(s),_e=ue.getNorthWest().distanceTo(ue.getSouthWest())*ue.getNorthEast().distanceTo(ue.getNorthWest());_e<1700&&(ae=Zi(s));var yt=s.length,ot=[];for(d=0;d<yt;d++){var zt=Q(s[d]);ot.push(n.project(Q([zt.lat-ae.lat,zt.lng-ae.lng])))}for(d=0,x=0;d<yt-1;d++)x+=ot[d].distanceTo(ot[d+1])/2;if(x===0)J=ot[0];else for(d=0,C=0;d<yt-1;d++)if(A=ot[d],Z=ot[d+1],v=A.distanceTo(Z),C+=v,C>x){H=(C-x)/v,J=[Z.x-H*(Z.x-A.x),Z.y-H*(Z.y-A.y)];break}var wt=n.unproject(se(J));return Q([wt.lat+ae.lat,wt.lng+ae.lng])}var xh={__proto__:null,simplify:Gl,pointToSegmentDistance:Kl,closestPointOnSegment:ch,clipSegment:Ql,_getEdgeIntersection:pn,_getBitCode:mr,_sqClosestPointOnSegment:Ca,isFlat:Ot,_flat:Yl,polylineCenter:Xl},Hi={project:function(s){return new W(s.lng,s.lat)},unproject:function(s){return new Y(s.y,s.x)},bounds:new ie([-180,-90],[180,90])},Wi={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ie([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(s){var n=Math.PI/180,d=this.R,x=s.lat*n,v=this.R_MINOR/d,C=Math.sqrt(1-v*v),A=C*Math.sin(x),Z=Math.tan(Math.PI/4-x/2)/Math.pow((1-A)/(1+A),C/2);return x=-d*Math.log(Math.max(Z,1e-10)),new W(s.lng*n*d,x)},unproject:function(s){for(var n=180/Math.PI,d=this.R,x=this.R_MINOR/d,v=Math.sqrt(1-x*x),C=Math.exp(-s.y/d),A=Math.PI/2-2*Math.atan(C),Z=0,H=.1,J;Z<15&&Math.abs(H)>1e-7;Z++)J=v*Math.sin(A),J=Math.pow((1-J)/(1+J),v/2),H=Math.PI/2-2*Math.atan(C*J)-A,A+=H;return new Y(A*n,s.x*n/d)}},ph={__proto__:null,LonLat:Hi,Mercator:Wi,SphericalMercator:We},fh=o({},pe,{code:"EPSG:3395",projection:Wi,transformation:function(){var s=.5/(Math.PI*Wi.R);return xe(s,.5,-s,.5)}()}),ed=o({},pe,{code:"EPSG:4326",projection:Hi,transformation:xe(1/180,1,-1/180,.5)}),gh=o({},ce,{projection:Hi,transformation:xe(1,0,-1,0),scale:function(s){return Math.pow(2,s)},zoom:function(s){return Math.log(s)/Math.LN2},distance:function(s,n){var d=n.lng-s.lng,x=n.lat-s.lat;return Math.sqrt(d*d+x*x)},infinite:!0});ce.Earth=pe,ce.EPSG3395=fh,ce.EPSG3857=Me,ce.EPSG900913=Ze,ce.EPSG4326=ed,ce.Simple=gh;var qt=te.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(s){return s.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(s){return s&&s.removeLayer(this),this},getPane:function(s){return this._map.getPane(s?this.options[s]||s:this.options.pane)},addInteractiveTarget:function(s){return this._map._targets[u(s)]=this,this},removeInteractiveTarget:function(s){return delete this._map._targets[u(s)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(s){var n=s.target;if(n.hasLayer(this)){if(this._map=n,this._zoomAnimated=n._zoomAnimated,this.getEvents){var d=this.getEvents();n.on(d,this),this.once("remove",function(){n.off(d,this)},this)}this.onAdd(n),this.fire("add"),n.fire("layeradd",{layer:this})}}});ke.include({addLayer:function(s){if(!s._layerAdd)throw new Error("The provided object is not a Layer.");var n=u(s);return this._layers[n]?this:(this._layers[n]=s,s._mapToAdd=this,s.beforeAdd&&s.beforeAdd(this),this.whenReady(s._layerAdd,s),this)},removeLayer:function(s){var n=u(s);return this._layers[n]?(this._loaded&&s.onRemove(this),delete this._layers[n],this._loaded&&(this.fire("layerremove",{layer:s}),s.fire("remove")),s._map=s._mapToAdd=null,this):this},hasLayer:function(s){return u(s)in this._layers},eachLayer:function(s,n){for(var d in this._layers)s.call(n,this._layers[d]);return this},_addLayers:function(s){s=s?P(s)?s:[s]:[];for(var n=0,d=s.length;n<d;n++)this.addLayer(s[n])},_addZoomLimit:function(s){(!isNaN(s.options.maxZoom)||!isNaN(s.options.minZoom))&&(this._zoomBoundLayers[u(s)]=s,this._updateZoomLevels())},_removeZoomLimit:function(s){var n=u(s);this._zoomBoundLayers[n]&&(delete this._zoomBoundLayers[n],this._updateZoomLevels())},_updateZoomLevels:function(){var s=1/0,n=-1/0,d=this._getZoomSpan();for(var x in this._zoomBoundLayers){var v=this._zoomBoundLayers[x].options;s=v.minZoom===void 0?s:Math.min(s,v.minZoom),n=v.maxZoom===void 0?n:Math.max(n,v.maxZoom)}this._layersMaxZoom=n===-1/0?void 0:n,this._layersMinZoom=s===1/0?void 0:s,d!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var zr=qt.extend({initialize:function(s,n){w(this,n),this._layers={};var d,x;if(s)for(d=0,x=s.length;d<x;d++)this.addLayer(s[d])},addLayer:function(s){var n=this.getLayerId(s);return this._layers[n]=s,this._map&&this._map.addLayer(s),this},removeLayer:function(s){var n=s in this._layers?s:this.getLayerId(s);return this._map&&this._layers[n]&&this._map.removeLayer(this._layers[n]),delete this._layers[n],this},hasLayer:function(s){var n=typeof s=="number"?s:this.getLayerId(s);return n in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(s){var n=Array.prototype.slice.call(arguments,1),d,x;for(d in this._layers)x=this._layers[d],x[s]&&x[s].apply(x,n);return this},onAdd:function(s){this.eachLayer(s.addLayer,s)},onRemove:function(s){this.eachLayer(s.removeLayer,s)},eachLayer:function(s,n){for(var d in this._layers)s.call(n,this._layers[d]);return this},getLayer:function(s){return this._layers[s]},getLayers:function(){var s=[];return this.eachLayer(s.push,s),s},setZIndex:function(s){return this.invoke("setZIndex",s)},getLayerId:function(s){return u(s)}}),bh=function(s,n){return new zr(s,n)},js=zr.extend({addLayer:function(s){return this.hasLayer(s)?this:(s.addEventParent(this),zr.prototype.addLayer.call(this,s),this.fire("layeradd",{layer:s}))},removeLayer:function(s){return this.hasLayer(s)?(s in this._layers&&(s=this._layers[s]),s.removeEventParent(this),zr.prototype.removeLayer.call(this,s),this.fire("layerremove",{layer:s})):this},setStyle:function(s){return this.invoke("setStyle",s)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var s=new U;for(var n in this._layers){var d=this._layers[n];s.extend(d.getBounds?d.getBounds():d.getLatLng())}return s}}),yh=function(s,n){return new js(s,n)},Fr=q.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(s){w(this,s)},createIcon:function(s){return this._createIcon("icon",s)},createShadow:function(s){return this._createIcon("shadow",s)},_createIcon:function(s,n){var d=this._getIconUrl(s);if(!d){if(s==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var x=this._createImg(d,n&&n.tagName==="IMG"?n:null);return this._setIconStyles(x,s),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),x},_setIconStyles:function(s,n){var d=this.options,x=d[n+"Size"];typeof x=="number"&&(x=[x,x]);var v=se(x),C=se(n==="shadow"&&d.shadowAnchor||d.iconAnchor||v&&v.divideBy(2,!0));s.className="leaflet-marker-"+n+" "+(d.className||""),C&&(s.style.marginLeft=-C.x+"px",s.style.marginTop=-C.y+"px"),v&&(s.style.width=v.x+"px",s.style.height=v.y+"px")},_createImg:function(s,n){return n=n||document.createElement("img"),n.src=s,n},_getIconUrl:function(s){return le.retina&&this.options[s+"RetinaUrl"]||this.options[s+"Url"]}});function vh(s){return new Fr(s)}var Sa=Fr.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(s){return typeof Sa.imagePath!="string"&&(Sa.imagePath=this._detectIconPath()),(this.options.imagePath||Sa.imagePath)+Fr.prototype._getIconUrl.call(this,s)},_stripUrl:function(s){var n=function(d,x,v){var C=x.exec(d);return C&&C[v]};return s=n(s,/^url\((['"])?(.+)\1\)$/,2),s&&n(s,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var s=Ce("div","leaflet-default-icon-path",document.body),n=va(s,"background-image")||va(s,"backgroundImage");if(document.body.removeChild(s),n=this._stripUrl(n),n)return n;var d=document.querySelector('link[href$="leaflet.css"]');return d?d.href.substring(0,d.href.length-11-1):""}}),td=os.extend({initialize:function(s){this._marker=s},addHooks:function(){var s=this._marker._icon;this._draggable||(this._draggable=new Bs(s,s,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ve(s,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&qe(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(s){var n=this._marker,d=n._map,x=this._marker.options.autoPanSpeed,v=this._marker.options.autoPanPadding,C=dr(n._icon),A=d.getPixelBounds(),Z=d.getPixelOrigin(),H=ge(A.min._subtract(Z).add(v),A.max._subtract(Z).subtract(v));if(!H.contains(C)){var J=se((Math.max(H.max.x,C.x)-H.max.x)/(A.max.x-H.max.x)-(Math.min(H.min.x,C.x)-H.min.x)/(A.min.x-H.min.x),(Math.max(H.max.y,C.y)-H.max.y)/(A.max.y-H.max.y)-(Math.min(H.min.y,C.y)-H.min.y)/(A.min.y-H.min.y)).multiplyBy(x);d.panBy(J,{animate:!1}),this._draggable._newPos._add(J),this._draggable._startPos._add(J),Je(n._icon,this._draggable._newPos),this._onDrag(s),this._panRequest=O(this._adjustPan.bind(this,s))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(s){this._marker.options.autoPan&&(F(this._panRequest),this._panRequest=O(this._adjustPan.bind(this,s)))},_onDrag:function(s){var n=this._marker,d=n._shadow,x=dr(n._icon),v=n._map.layerPointToLatLng(x);d&&Je(d,x),n._latlng=v,s.latlng=v,s.oldLatLng=this._oldLatLng,n.fire("move",s).fire("drag",s)},_onDragEnd:function(s){F(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",s)}}),fn=qt.extend({options:{icon:new Sa,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(s,n){w(this,n),this._latlng=Q(s)},onAdd:function(s){this._zoomAnimated=this._zoomAnimated&&s.options.markerZoomAnimation,this._zoomAnimated&&s.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(s){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&s.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(s){var n=this._latlng;return this._latlng=Q(s),this.update(),this.fire("move",{oldLatLng:n,latlng:this._latlng})},setZIndexOffset:function(s){return this.options.zIndexOffset=s,this.update()},getIcon:function(){return this.options.icon},setIcon:function(s){return this.options.icon=s,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var s=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(s)}return this},_initIcon:function(){var s=this.options,n="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),d=s.icon.createIcon(this._icon),x=!1;d!==this._icon&&(this._icon&&this._removeIcon(),x=!0,s.title&&(d.title=s.title),d.tagName==="IMG"&&(d.alt=s.alt||"")),ve(d,n),s.keyboard&&(d.tabIndex="0",d.setAttribute("role","button")),this._icon=d,s.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&fe(d,"focus",this._panOnFocus,this);var v=s.icon.createShadow(this._shadow),C=!1;v!==this._shadow&&(this._removeShadow(),C=!0),v&&(ve(v,n),v.alt=""),this._shadow=v,s.opacity<1&&this._updateOpacity(),x&&this.getPane().appendChild(this._icon),this._initInteraction(),v&&C&&this.getPane(s.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ae(this._icon,"focus",this._panOnFocus,this),Fe(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Fe(this._shadow),this._shadow=null},_setPos:function(s){this._icon&&Je(this._icon,s),this._shadow&&Je(this._shadow,s),this._zIndex=s.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(s){this._icon&&(this._icon.style.zIndex=this._zIndex+s)},_animateZoom:function(s){var n=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center).round();this._setPos(n)},_initInteraction:function(){if(this.options.interactive&&(ve(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),td)){var s=this.options.draggable;this.dragging&&(s=this.dragging.enabled(),this.dragging.disable()),this.dragging=new td(this),s&&this.dragging.enable()}},setOpacity:function(s){return this.options.opacity=s,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var s=this.options.opacity;this._icon&&It(this._icon,s),this._shadow&&It(this._shadow,s)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var s=this._map;if(s){var n=this.options.icon.options,d=n.iconSize?se(n.iconSize):se(0,0),x=n.iconAnchor?se(n.iconAnchor):se(0,0);s.panInside(this._latlng,{paddingTopLeft:x,paddingBottomRight:d.subtract(x)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function jh(s,n){return new fn(s,n)}var $s=qt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(s){this._renderer=s.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(s){return w(this,s),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&s&&Object.prototype.hasOwnProperty.call(s,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),gn=$s.extend({options:{fill:!0,radius:10},initialize:function(s,n){w(this,n),this._latlng=Q(s),this._radius=this.options.radius},setLatLng:function(s){var n=this._latlng;return this._latlng=Q(s),this.redraw(),this.fire("move",{oldLatLng:n,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(s){return this.options.radius=this._radius=s,this.redraw()},getRadius:function(){return this._radius},setStyle:function(s){var n=s&&s.radius||this._radius;return $s.prototype.setStyle.call(this,s),this.setRadius(n),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var s=this._radius,n=this._radiusY||s,d=this._clickTolerance(),x=[s+d,n+d];this._pxBounds=new ie(this._point.subtract(x),this._point.add(x))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(s){return s.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function _h(s,n){return new gn(s,n)}var Vi=gn.extend({initialize:function(s,n,d){if(typeof n=="number"&&(n=o({},d,{radius:n})),w(this,n),this._latlng=Q(s),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(s){return this._mRadius=s,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var s=[this._radius,this._radiusY||this._radius];return new U(this._map.layerPointToLatLng(this._point.subtract(s)),this._map.layerPointToLatLng(this._point.add(s)))},setStyle:$s.prototype.setStyle,_project:function(){var s=this._latlng.lng,n=this._latlng.lat,d=this._map,x=d.options.crs;if(x.distance===pe.distance){var v=Math.PI/180,C=this._mRadius/pe.R/v,A=d.project([n+C,s]),Z=d.project([n-C,s]),H=A.add(Z).divideBy(2),J=d.unproject(H).lat,ae=Math.acos((Math.cos(C*v)-Math.sin(n*v)*Math.sin(J*v))/(Math.cos(n*v)*Math.cos(J*v)))/v;(isNaN(ae)||ae===0)&&(ae=C/Math.cos(Math.PI/180*n)),this._point=H.subtract(d.getPixelOrigin()),this._radius=isNaN(ae)?0:H.x-d.project([J,s-ae]).x,this._radiusY=H.y-A.y}else{var ue=x.unproject(x.project(this._latlng).subtract([this._mRadius,0]));this._point=d.latLngToLayerPoint(this._latlng),this._radius=this._point.x-d.latLngToLayerPoint(ue).x}this._updateBounds()}});function wh(s,n,d){return new Vi(s,n,d)}var _s=$s.extend({options:{smoothFactor:1,noClip:!1},initialize:function(s,n){w(this,n),this._setLatLngs(s)},getLatLngs:function(){return this._latlngs},setLatLngs:function(s){return this._setLatLngs(s),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(s){for(var n=1/0,d=null,x=Ca,v,C,A=0,Z=this._parts.length;A<Z;A++)for(var H=this._parts[A],J=1,ae=H.length;J<ae;J++){v=H[J-1],C=H[J];var ue=x(s,v,C,!0);ue<n&&(n=ue,d=x(s,v,C))}return d&&(d.distance=Math.sqrt(n)),d},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Xl(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(s,n){return n=n||this._defaultShape(),s=Q(s),n.push(s),this._bounds.extend(s),this.redraw()},_setLatLngs:function(s){this._bounds=new U,this._latlngs=this._convertLatLngs(s)},_defaultShape:function(){return Ot(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(s){for(var n=[],d=Ot(s),x=0,v=s.length;x<v;x++)d?(n[x]=Q(s[x]),this._bounds.extend(n[x])):n[x]=this._convertLatLngs(s[x]);return n},_project:function(){var s=new ie;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,s),this._bounds.isValid()&&s.isValid()&&(this._rawPxBounds=s,this._updateBounds())},_updateBounds:function(){var s=this._clickTolerance(),n=new W(s,s);this._rawPxBounds&&(this._pxBounds=new ie([this._rawPxBounds.min.subtract(n),this._rawPxBounds.max.add(n)]))},_projectLatlngs:function(s,n,d){var x=s[0]instanceof Y,v=s.length,C,A;if(x){for(A=[],C=0;C<v;C++)A[C]=this._map.latLngToLayerPoint(s[C]),d.extend(A[C]);n.push(A)}else for(C=0;C<v;C++)this._projectLatlngs(s[C],n,d)},_clipPoints:function(){var s=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}var n=this._parts,d,x,v,C,A,Z,H;for(d=0,v=0,C=this._rings.length;d<C;d++)for(H=this._rings[d],x=0,A=H.length;x<A-1;x++)Z=Ql(H[x],H[x+1],s,x,!0),Z&&(n[v]=n[v]||[],n[v].push(Z[0]),(Z[1]!==H[x+1]||x===A-2)&&(n[v].push(Z[1]),v++))}},_simplifyPoints:function(){for(var s=this._parts,n=this.options.smoothFactor,d=0,x=s.length;d<x;d++)s[d]=Gl(s[d],n)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(s,n){var d,x,v,C,A,Z,H=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(d=0,C=this._parts.length;d<C;d++)for(Z=this._parts[d],x=0,A=Z.length,v=A-1;x<A;v=x++)if(!(!n&&x===0)&&Kl(s,Z[v],Z[x])<=H)return!0;return!1}});function Nh(s,n){return new _s(s,n)}_s._flat=Yl;var Br=_s.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ql(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(s){var n=_s.prototype._convertLatLngs.call(this,s),d=n.length;return d>=2&&n[0]instanceof Y&&n[0].equals(n[d-1])&&n.pop(),n},_setLatLngs:function(s){_s.prototype._setLatLngs.call(this,s),Ot(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ot(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var s=this._renderer._bounds,n=this.options.weight,d=new W(n,n);if(s=new ie(s.min.subtract(d),s.max.add(d)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}for(var x=0,v=this._rings.length,C;x<v;x++)C=Vl(this._rings[x],s,!0),C.length&&this._parts.push(C)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(s){var n=!1,d,x,v,C,A,Z,H,J;if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(C=0,H=this._parts.length;C<H;C++)for(d=this._parts[C],A=0,J=d.length,Z=J-1;A<J;Z=A++)x=d[A],v=d[Z],x.y>s.y!=v.y>s.y&&s.x<(v.x-x.x)*(s.y-x.y)/(v.y-x.y)+x.x&&(n=!n);return n||_s.prototype._containsPoint.call(this,s,!0)}});function kh(s,n){return new Br(s,n)}var ws=js.extend({initialize:function(s,n){w(this,n),this._layers={},s&&this.addData(s)},addData:function(s){var n=P(s)?s:s.features,d,x,v;if(n){for(d=0,x=n.length;d<x;d++)v=n[d],(v.geometries||v.geometry||v.features||v.coordinates)&&this.addData(v);return this}var C=this.options;if(C.filter&&!C.filter(s))return this;var A=bn(s,C);return A?(A.feature=jn(s),A.defaultOptions=A.options,this.resetStyle(A),C.onEachFeature&&C.onEachFeature(s,A),this.addLayer(A)):this},resetStyle:function(s){return s===void 0?this.eachLayer(this.resetStyle,this):(s.options=o({},s.defaultOptions),this._setLayerStyle(s,this.options.style),this)},setStyle:function(s){return this.eachLayer(function(n){this._setLayerStyle(n,s)},this)},_setLayerStyle:function(s,n){s.setStyle&&(typeof n=="function"&&(n=n(s.feature)),s.setStyle(n))}});function bn(s,n){var d=s.type==="Feature"?s.geometry:s,x=d?d.coordinates:null,v=[],C=n&&n.pointToLayer,A=n&&n.coordsToLatLng||qi,Z,H,J,ae;if(!x&&!d)return null;switch(d.type){case"Point":return Z=A(x),sd(C,s,Z,n);case"MultiPoint":for(J=0,ae=x.length;J<ae;J++)Z=A(x[J]),v.push(sd(C,s,Z,n));return new js(v);case"LineString":case"MultiLineString":return H=yn(x,d.type==="LineString"?0:1,A),new _s(H,n);case"Polygon":case"MultiPolygon":return H=yn(x,d.type==="Polygon"?1:2,A),new Br(H,n);case"GeometryCollection":for(J=0,ae=d.geometries.length;J<ae;J++){var ue=bn({geometry:d.geometries[J],type:"Feature",properties:s.properties},n);ue&&v.push(ue)}return new js(v);case"FeatureCollection":for(J=0,ae=d.features.length;J<ae;J++){var _e=bn(d.features[J],n);_e&&v.push(_e)}return new js(v);default:throw new Error("Invalid GeoJSON object.")}}function sd(s,n,d,x){return s?s(n,d):new fn(d,x&&x.markersInheritOptions&&x)}function qi(s){return new Y(s[1],s[0],s[2])}function yn(s,n,d){for(var x=[],v=0,C=s.length,A;v<C;v++)A=n?yn(s[v],n-1,d):(d||qi)(s[v]),x.push(A);return x}function Gi(s,n){return s=Q(s),s.alt!==void 0?[b(s.lng,n),b(s.lat,n),b(s.alt,n)]:[b(s.lng,n),b(s.lat,n)]}function vn(s,n,d,x){for(var v=[],C=0,A=s.length;C<A;C++)v.push(n?vn(s[C],Ot(s[C])?0:n-1,d,x):Gi(s[C],x));return!n&&d&&v.length>0&&v.push(v[0].slice()),v}function $r(s,n){return s.feature?o({},s.feature,{geometry:n}):jn(n)}function jn(s){return s.type==="Feature"||s.type==="FeatureCollection"?s:{type:"Feature",properties:{},geometry:s}}var Ki={toGeoJSON:function(s){return $r(this,{type:"Point",coordinates:Gi(this.getLatLng(),s)})}};fn.include(Ki),Vi.include(Ki),gn.include(Ki),_s.include({toGeoJSON:function(s){var n=!Ot(this._latlngs),d=vn(this._latlngs,n?1:0,!1,s);return $r(this,{type:(n?"Multi":"")+"LineString",coordinates:d})}}),Br.include({toGeoJSON:function(s){var n=!Ot(this._latlngs),d=n&&!Ot(this._latlngs[0]),x=vn(this._latlngs,d?2:n?1:0,!0,s);return n||(x=[x]),$r(this,{type:(d?"Multi":"")+"Polygon",coordinates:x})}}),zr.include({toMultiPoint:function(s){var n=[];return this.eachLayer(function(d){n.push(d.toGeoJSON(s).geometry.coordinates)}),$r(this,{type:"MultiPoint",coordinates:n})},toGeoJSON:function(s){var n=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(n==="MultiPoint")return this.toMultiPoint(s);var d=n==="GeometryCollection",x=[];return this.eachLayer(function(v){if(v.toGeoJSON){var C=v.toGeoJSON(s);if(d)x.push(C.geometry);else{var A=jn(C);A.type==="FeatureCollection"?x.push.apply(x,A.features):x.push(A)}}}),d?$r(this,{geometries:x,type:"GeometryCollection"}):{type:"FeatureCollection",features:x}}});function rd(s,n){return new ws(s,n)}var Ch=rd,_n=qt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(s,n,d){this._url=s,this._bounds=V(n),w(this,d)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ve(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Fe(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(s){return this.options.opacity=s,this._image&&this._updateOpacity(),this},setStyle:function(s){return s.opacity&&this.setOpacity(s.opacity),this},bringToFront:function(){return this._map&&Ir(this._image),this},bringToBack:function(){return this._map&&Or(this._image),this},setUrl:function(s){return this._url=s,this._image&&(this._image.src=s),this},setBounds:function(s){return this._bounds=V(s),this._map&&this._reset(),this},getEvents:function(){var s={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var s=this._url.tagName==="IMG",n=this._image=s?this._url:Ce("img");if(ve(n,"leaflet-image-layer"),this._zoomAnimated&&ve(n,"leaflet-zoom-animated"),this.options.className&&ve(n,this.options.className),n.onselectstart=g,n.onmousemove=g,n.onload=c(this.fire,this,"load"),n.onerror=c(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(n.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),s){this._url=n.src;return}n.src=this._url,n.alt=this.options.alt},_animateZoom:function(s){var n=this._map.getZoomScale(s.zoom),d=this._map._latLngBoundsToNewLayerBounds(this._bounds,s.zoom,s.center).min;lr(this._image,d,n)},_reset:function(){var s=this._image,n=new ie(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),d=n.getSize();Je(s,n.min),s.style.width=d.x+"px",s.style.height=d.y+"px"},_updateOpacity:function(){It(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var s=this.options.errorOverlayUrl;s&&this._url!==s&&(this._url=s,this._image.src=s)},getCenter:function(){return this._bounds.getCenter()}}),Sh=function(s,n,d){return new _n(s,n,d)},ad=_n.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var s=this._url.tagName==="VIDEO",n=this._image=s?this._url:Ce("video");if(ve(n,"leaflet-image-layer"),this._zoomAnimated&&ve(n,"leaflet-zoom-animated"),this.options.className&&ve(n,this.options.className),n.onselectstart=g,n.onmousemove=g,n.onloadeddata=c(this.fire,this,"load"),s){for(var d=n.getElementsByTagName("source"),x=[],v=0;v<d.length;v++)x.push(d[v].src);this._url=d.length>0?x:[n.src];return}P(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(n.style,"objectFit")&&(n.style.objectFit="fill"),n.autoplay=!!this.options.autoplay,n.loop=!!this.options.loop,n.muted=!!this.options.muted,n.playsInline=!!this.options.playsInline;for(var C=0;C<this._url.length;C++){var A=Ce("source");A.src=this._url[C],n.appendChild(A)}}});function Th(s,n,d){return new ad(s,n,d)}var nd=_n.extend({_initImage:function(){var s=this._image=this._url;ve(s,"leaflet-image-layer"),this._zoomAnimated&&ve(s,"leaflet-zoom-animated"),this.options.className&&ve(s,this.options.className),s.onselectstart=g,s.onmousemove=g}});function Ph(s,n,d){return new nd(s,n,d)}var ls=qt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(s,n){s&&(s instanceof Y||P(s))?(this._latlng=Q(s),w(this,n)):(w(this,s),this._source=n),this.options.content&&(this._content=this.options.content)},openOn:function(s){return s=arguments.length?s:this._source._map,s.hasLayer(this)||s.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(s){return this._map?this.close():(arguments.length?this._source=s:s=this._source,this._prepareOpen(),this.openOn(s._map)),this},onAdd:function(s){this._zoomAnimated=s._zoomAnimated,this._container||this._initLayout(),s._fadeAnimated&&It(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),s._fadeAnimated&&It(this._container,1),this.bringToFront(),this.options.interactive&&(ve(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(s){s._fadeAnimated?(It(this._container,0),this._removeTimeout=setTimeout(c(Fe,void 0,this._container),200)):Fe(this._container),this.options.interactive&&(qe(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(s){return this._latlng=Q(s),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(s){return this._content=s,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var s={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ir(this._container),this},bringToBack:function(){return this._map&&Or(this._container),this},_prepareOpen:function(s){var n=this._source;if(!n._map)return!1;if(n instanceof js){n=null;var d=this._source._layers;for(var x in d)if(d[x]._map){n=d[x];break}if(!n)return!1;this._source=n}if(!s)if(n.getCenter)s=n.getCenter();else if(n.getLatLng)s=n.getLatLng();else if(n.getBounds)s=n.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(s),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var s=this._contentNode,n=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof n=="string")s.innerHTML=n;else{for(;s.hasChildNodes();)s.removeChild(s.firstChild);s.appendChild(n)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var s=this._map.latLngToLayerPoint(this._latlng),n=se(this.options.offset),d=this._getAnchor();this._zoomAnimated?Je(this._container,s.add(d)):n=n.add(s).add(d);var x=this._containerBottom=-n.y,v=this._containerLeft=-Math.round(this._containerWidth/2)+n.x;this._container.style.bottom=x+"px",this._container.style.left=v+"px"}},_getAnchor:function(){return[0,0]}});ke.include({_initOverlay:function(s,n,d,x){var v=n;return v instanceof s||(v=new s(x).setContent(n)),d&&v.setLatLng(d),v}}),qt.include({_initOverlay:function(s,n,d,x){var v=d;return v instanceof s?(w(v,x),v._source=this):(v=n&&!x?n:new s(x,this),v.setContent(d)),v}});var wn=ls.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(s){return s=arguments.length?s:this._source._map,!s.hasLayer(this)&&s._popup&&s._popup.options.autoClose&&s.removeLayer(s._popup),s._popup=this,ls.prototype.openOn.call(this,s)},onAdd:function(s){ls.prototype.onAdd.call(this,s),s.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof $s||this._source.on("preclick",cr))},onRemove:function(s){ls.prototype.onRemove.call(this,s),s.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof $s||this._source.off("preclick",cr))},getEvents:function(){var s=ls.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(s.preclick=this.close),this.options.keepInView&&(s.moveend=this._adjustPan),s},_initLayout:function(){var s="leaflet-popup",n=this._container=Ce("div",s+" "+(this.options.className||"")+" leaflet-zoom-animated"),d=this._wrapper=Ce("div",s+"-content-wrapper",n);if(this._contentNode=Ce("div",s+"-content",d),Na(n),zi(this._contentNode),fe(n,"contextmenu",cr),this._tipContainer=Ce("div",s+"-tip-container",n),this._tip=Ce("div",s+"-tip",this._tipContainer),this.options.closeButton){var x=this._closeButton=Ce("a",s+"-close-button",n);x.setAttribute("role","button"),x.setAttribute("aria-label","Close popup"),x.href="#close",x.innerHTML='<span aria-hidden="true">&#215;</span>',fe(x,"click",function(v){ct(v),this.close()},this)}},_updateLayout:function(){var s=this._contentNode,n=s.style;n.width="",n.whiteSpace="nowrap";var d=s.offsetWidth;d=Math.min(d,this.options.maxWidth),d=Math.max(d,this.options.minWidth),n.width=d+1+"px",n.whiteSpace="",n.height="";var x=s.offsetHeight,v=this.options.maxHeight,C="leaflet-popup-scrolled";v&&x>v?(n.height=v+"px",ve(s,C)):qe(s,C),this._containerWidth=this._container.offsetWidth},_animateZoom:function(s){var n=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center),d=this._getAnchor();Je(this._container,n.add(d))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var s=this._map,n=parseInt(va(this._container,"marginBottom"),10)||0,d=this._container.offsetHeight+n,x=this._containerWidth,v=new W(this._containerLeft,-d-this._containerBottom);v._add(dr(this._container));var C=s.layerPointToContainerPoint(v),A=se(this.options.autoPanPadding),Z=se(this.options.autoPanPaddingTopLeft||A),H=se(this.options.autoPanPaddingBottomRight||A),J=s.getSize(),ae=0,ue=0;C.x+x+H.x>J.x&&(ae=C.x+x-J.x+H.x),C.x-ae-Z.x<0&&(ae=C.x-Z.x),C.y+d+H.y>J.y&&(ue=C.y+d-J.y+H.y),C.y-ue-Z.y<0&&(ue=C.y-Z.y),(ae||ue)&&(this.options.keepInView&&(this._autopanning=!0),s.fire("autopanstart").panBy([ae,ue]))}},_getAnchor:function(){return se(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Lh=function(s,n){return new wn(s,n)};ke.mergeOptions({closePopupOnClick:!0}),ke.include({openPopup:function(s,n,d){return this._initOverlay(wn,s,n,d).openOn(this),this},closePopup:function(s){return s=arguments.length?s:this._popup,s&&s.close(),this}}),qt.include({bindPopup:function(s,n){return this._popup=this._initOverlay(wn,this._popup,s,n),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(s){return this._popup&&(this instanceof js||(this._popup._source=this),this._popup._prepareOpen(s||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(s){return this._popup&&this._popup.setContent(s),this},getPopup:function(){return this._popup},_openPopup:function(s){if(!(!this._popup||!this._map)){ur(s);var n=s.layer||s.target;if(this._popup._source===n&&!(n instanceof $s)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(s.latlng);return}this._popup._source=n,this.openPopup(s.latlng)}},_movePopup:function(s){this._popup.setLatLng(s.latlng)},_onKeyPress:function(s){s.originalEvent.keyCode===13&&this._openPopup(s)}});var Nn=ls.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(s){ls.prototype.onAdd.call(this,s),this.setOpacity(this.options.opacity),s.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(s){ls.prototype.onRemove.call(this,s),s.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var s=ls.prototype.getEvents.call(this);return this.options.permanent||(s.preclick=this.close),s},_initLayout:function(){var s="leaflet-tooltip",n=s+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ce("div",n),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+u(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(s){var n,d,x=this._map,v=this._container,C=x.latLngToContainerPoint(x.getCenter()),A=x.layerPointToContainerPoint(s),Z=this.options.direction,H=v.offsetWidth,J=v.offsetHeight,ae=se(this.options.offset),ue=this._getAnchor();Z==="top"?(n=H/2,d=J):Z==="bottom"?(n=H/2,d=0):Z==="center"?(n=H/2,d=J/2):Z==="right"?(n=0,d=J/2):Z==="left"?(n=H,d=J/2):A.x<C.x?(Z="right",n=0,d=J/2):(Z="left",n=H+(ae.x+ue.x)*2,d=J/2),s=s.subtract(se(n,d,!0)).add(ae).add(ue),qe(v,"leaflet-tooltip-right"),qe(v,"leaflet-tooltip-left"),qe(v,"leaflet-tooltip-top"),qe(v,"leaflet-tooltip-bottom"),ve(v,"leaflet-tooltip-"+Z),Je(v,s)},_updatePosition:function(){var s=this._map.latLngToLayerPoint(this._latlng);this._setPosition(s)},setOpacity:function(s){this.options.opacity=s,this._container&&It(this._container,s)},_animateZoom:function(s){var n=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center);this._setPosition(n)},_getAnchor:function(){return se(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Eh=function(s,n){return new Nn(s,n)};ke.include({openTooltip:function(s,n,d){return this._initOverlay(Nn,s,n,d).openOn(this),this},closeTooltip:function(s){return s.close(),this}}),qt.include({bindTooltip:function(s,n){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Nn,this._tooltip,s,n),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(s){if(!(!s&&this._tooltipHandlersAdded)){var n=s?"off":"on",d={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?d.add=this._openTooltip:(d.mouseover=this._openTooltip,d.mouseout=this.closeTooltip,d.click=this._openTooltip,this._map?this._addFocusListeners():d.add=this._addFocusListeners),this._tooltip.options.sticky&&(d.mousemove=this._moveTooltip),this[n](d),this._tooltipHandlersAdded=!s}},openTooltip:function(s){return this._tooltip&&(this instanceof js||(this._tooltip._source=this),this._tooltip._prepareOpen(s)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(s){return this._tooltip&&this._tooltip.setContent(s),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(s){var n=typeof s.getElement=="function"&&s.getElement();n&&(fe(n,"focus",function(){this._tooltip._source=s,this.openTooltip()},this),fe(n,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(s){var n=typeof s.getElement=="function"&&s.getElement();n&&n.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(s){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var n=this;this._map.once("moveend",function(){n._openOnceFlag=!1,n._openTooltip(s)});return}this._tooltip._source=s.layer||s.target,this.openTooltip(this._tooltip.options.sticky?s.latlng:void 0)}},_moveTooltip:function(s){var n=s.latlng,d,x;this._tooltip.options.sticky&&s.originalEvent&&(d=this._map.mouseEventToContainerPoint(s.originalEvent),x=this._map.containerPointToLayerPoint(d),n=this._map.layerPointToLatLng(x)),this._tooltip.setLatLng(n)}});var id=Fr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(s){var n=s&&s.tagName==="DIV"?s:document.createElement("div"),d=this.options;if(d.html instanceof Element?(cn(n),n.appendChild(d.html)):n.innerHTML=d.html!==!1?d.html:"",d.bgPos){var x=se(d.bgPos);n.style.backgroundPosition=-x.x+"px "+-x.y+"px"}return this._setIconStyles(n,"icon"),n},createShadow:function(){return null}});function Rh(s){return new id(s)}Fr.Default=Sa;var Ta=qt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:le.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(s){w(this,s)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(s){s._addZoomLimit(this)},onRemove:function(s){this._removeAllTiles(),Fe(this._container),s._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ir(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Or(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(s){return this.options.opacity=s,this._updateOpacity(),this},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var s=this._clampZoom(this._map.getZoom());s!==this._tileZoom&&(this._tileZoom=s,this._updateLevels()),this._update()}return this},getEvents:function(){var s={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=h(this._onMoveEnd,this.options.updateInterval,this)),s.move=this._onMove),this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof W?s:new W(s,s)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(s){for(var n=this.getPane().children,d=-s(-1/0,1/0),x=0,v=n.length,C;x<v;x++)C=n[x].style.zIndex,n[x]!==this._container&&C&&(d=s(d,+C));isFinite(d)&&(this.options.zIndex=d+s(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!le.ielt9){It(this._container,this.options.opacity);var s=+new Date,n=!1,d=!1;for(var x in this._tiles){var v=this._tiles[x];if(!(!v.current||!v.loaded)){var C=Math.min(1,(s-v.loaded)/200);It(v.el,C),C<1?n=!0:(v.active?d=!0:this._onOpaqueTile(v),v.active=!0)}}d&&!this._noPrune&&this._pruneTiles(),n&&(F(this._fadeFrame),this._fadeFrame=O(this._updateOpacity,this))}},_onOpaqueTile:g,_initContainer:function(){this._container||(this._container=Ce("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var s=this._tileZoom,n=this.options.maxZoom;if(s!==void 0){for(var d in this._levels)d=Number(d),this._levels[d].el.children.length||d===s?(this._levels[d].el.style.zIndex=n-Math.abs(s-d),this._onUpdateLevel(d)):(Fe(this._levels[d].el),this._removeTilesAtZoom(d),this._onRemoveLevel(d),delete this._levels[d]);var x=this._levels[s],v=this._map;return x||(x=this._levels[s]={},x.el=Ce("div","leaflet-tile-container leaflet-zoom-animated",this._container),x.el.style.zIndex=n,x.origin=v.project(v.unproject(v.getPixelOrigin()),s).round(),x.zoom=s,this._setZoomTransform(x,v.getCenter(),v.getZoom()),g(x.el.offsetWidth),this._onCreateLevel(x)),this._level=x,x}},_onUpdateLevel:g,_onRemoveLevel:g,_onCreateLevel:g,_pruneTiles:function(){if(this._map){var s,n,d=this._map.getZoom();if(d>this.options.maxZoom||d<this.options.minZoom){this._removeAllTiles();return}for(s in this._tiles)n=this._tiles[s],n.retain=n.current;for(s in this._tiles)if(n=this._tiles[s],n.current&&!n.active){var x=n.coords;this._retainParent(x.x,x.y,x.z,x.z-5)||this._retainChildren(x.x,x.y,x.z,x.z+2)}for(s in this._tiles)this._tiles[s].retain||this._removeTile(s)}},_removeTilesAtZoom:function(s){for(var n in this._tiles)this._tiles[n].coords.z===s&&this._removeTile(n)},_removeAllTiles:function(){for(var s in this._tiles)this._removeTile(s)},_invalidateAll:function(){for(var s in this._levels)Fe(this._levels[s].el),this._onRemoveLevel(Number(s)),delete this._levels[s];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(s,n,d,x){var v=Math.floor(s/2),C=Math.floor(n/2),A=d-1,Z=new W(+v,+C);Z.z=+A;var H=this._tileCoordsToKey(Z),J=this._tiles[H];return J&&J.active?(J.retain=!0,!0):(J&&J.loaded&&(J.retain=!0),A>x?this._retainParent(v,C,A,x):!1)},_retainChildren:function(s,n,d,x){for(var v=2*s;v<2*s+2;v++)for(var C=2*n;C<2*n+2;C++){var A=new W(v,C);A.z=d+1;var Z=this._tileCoordsToKey(A),H=this._tiles[Z];if(H&&H.active){H.retain=!0;continue}else H&&H.loaded&&(H.retain=!0);d+1<x&&this._retainChildren(v,C,d+1,x)}},_resetView:function(s){var n=s&&(s.pinch||s.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),n,n)},_animateZoom:function(s){this._setView(s.center,s.zoom,!0,s.noUpdate)},_clampZoom:function(s){var n=this.options;return n.minNativeZoom!==void 0&&s<n.minNativeZoom?n.minNativeZoom:n.maxNativeZoom!==void 0&&n.maxNativeZoom<s?n.maxNativeZoom:s},_setView:function(s,n,d,x){var v=Math.round(n);this.options.maxZoom!==void 0&&v>this.options.maxZoom||this.options.minZoom!==void 0&&v<this.options.minZoom?v=void 0:v=this._clampZoom(v);var C=this.options.updateWhenZooming&&v!==this._tileZoom;(!x||C)&&(this._tileZoom=v,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),v!==void 0&&this._update(s),d||this._pruneTiles(),this._noPrune=!!d),this._setZoomTransforms(s,n)},_setZoomTransforms:function(s,n){for(var d in this._levels)this._setZoomTransform(this._levels[d],s,n)},_setZoomTransform:function(s,n,d){var x=this._map.getZoomScale(d,s.zoom),v=s.origin.multiplyBy(x).subtract(this._map._getNewPixelOrigin(n,d)).round();le.any3d?lr(s.el,v,x):Je(s.el,v)},_resetGrid:function(){var s=this._map,n=s.options.crs,d=this._tileSize=this.getTileSize(),x=this._tileZoom,v=this._map.getPixelWorldBounds(this._tileZoom);v&&(this._globalTileRange=this._pxBoundsToTileRange(v)),this._wrapX=n.wrapLng&&!this.options.noWrap&&[Math.floor(s.project([0,n.wrapLng[0]],x).x/d.x),Math.ceil(s.project([0,n.wrapLng[1]],x).x/d.y)],this._wrapY=n.wrapLat&&!this.options.noWrap&&[Math.floor(s.project([n.wrapLat[0],0],x).y/d.x),Math.ceil(s.project([n.wrapLat[1],0],x).y/d.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(s){var n=this._map,d=n._animatingZoom?Math.max(n._animateToZoom,n.getZoom()):n.getZoom(),x=n.getZoomScale(d,this._tileZoom),v=n.project(s,this._tileZoom).floor(),C=n.getSize().divideBy(x*2);return new ie(v.subtract(C),v.add(C))},_update:function(s){var n=this._map;if(n){var d=this._clampZoom(n.getZoom());if(s===void 0&&(s=n.getCenter()),this._tileZoom!==void 0){var x=this._getTiledPixelBounds(s),v=this._pxBoundsToTileRange(x),C=v.getCenter(),A=[],Z=this.options.keepBuffer,H=new ie(v.getBottomLeft().subtract([Z,-Z]),v.getTopRight().add([Z,-Z]));if(!(isFinite(v.min.x)&&isFinite(v.min.y)&&isFinite(v.max.x)&&isFinite(v.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var J in this._tiles){var ae=this._tiles[J].coords;(ae.z!==this._tileZoom||!H.contains(new W(ae.x,ae.y)))&&(this._tiles[J].current=!1)}if(Math.abs(d-this._tileZoom)>1){this._setView(s,d);return}for(var ue=v.min.y;ue<=v.max.y;ue++)for(var _e=v.min.x;_e<=v.max.x;_e++){var yt=new W(_e,ue);if(yt.z=this._tileZoom,!!this._isValidTile(yt)){var ot=this._tiles[this._tileCoordsToKey(yt)];ot?ot.current=!0:A.push(yt)}}if(A.sort(function(wt,Ur){return wt.distanceTo(C)-Ur.distanceTo(C)}),A.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var zt=document.createDocumentFragment();for(_e=0;_e<A.length;_e++)this._addTile(A[_e],zt);this._level.el.appendChild(zt)}}}},_isValidTile:function(s){var n=this._map.options.crs;if(!n.infinite){var d=this._globalTileRange;if(!n.wrapLng&&(s.x<d.min.x||s.x>d.max.x)||!n.wrapLat&&(s.y<d.min.y||s.y>d.max.y))return!1}if(!this.options.bounds)return!0;var x=this._tileCoordsToBounds(s);return V(this.options.bounds).overlaps(x)},_keyToBounds:function(s){return this._tileCoordsToBounds(this._keyToTileCoords(s))},_tileCoordsToNwSe:function(s){var n=this._map,d=this.getTileSize(),x=s.scaleBy(d),v=x.add(d),C=n.unproject(x,s.z),A=n.unproject(v,s.z);return[C,A]},_tileCoordsToBounds:function(s){var n=this._tileCoordsToNwSe(s),d=new U(n[0],n[1]);return this.options.noWrap||(d=this._map.wrapLatLngBounds(d)),d},_tileCoordsToKey:function(s){return s.x+":"+s.y+":"+s.z},_keyToTileCoords:function(s){var n=s.split(":"),d=new W(+n[0],+n[1]);return d.z=+n[2],d},_removeTile:function(s){var n=this._tiles[s];n&&(Fe(n.el),delete this._tiles[s],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(s)}))},_initTile:function(s){ve(s,"leaflet-tile");var n=this.getTileSize();s.style.width=n.x+"px",s.style.height=n.y+"px",s.onselectstart=g,s.onmousemove=g,le.ielt9&&this.options.opacity<1&&It(s,this.options.opacity)},_addTile:function(s,n){var d=this._getTilePos(s),x=this._tileCoordsToKey(s),v=this.createTile(this._wrapCoords(s),c(this._tileReady,this,s));this._initTile(v),this.createTile.length<2&&O(c(this._tileReady,this,s,null,v)),Je(v,d),this._tiles[x]={el:v,coords:s,current:!0},n.appendChild(v),this.fire("tileloadstart",{tile:v,coords:s})},_tileReady:function(s,n,d){n&&this.fire("tileerror",{error:n,tile:d,coords:s});var x=this._tileCoordsToKey(s);d=this._tiles[x],d&&(d.loaded=+new Date,this._map._fadeAnimated?(It(d.el,0),F(this._fadeFrame),this._fadeFrame=O(this._updateOpacity,this)):(d.active=!0,this._pruneTiles()),n||(ve(d.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:d.el,coords:s})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),le.ielt9||!this._map._fadeAnimated?O(this._pruneTiles,this):setTimeout(c(this._pruneTiles,this),250)))},_getTilePos:function(s){return s.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(s){var n=new W(this._wrapX?p(s.x,this._wrapX):s.x,this._wrapY?p(s.y,this._wrapY):s.y);return n.z=s.z,n},_pxBoundsToTileRange:function(s){var n=this.getTileSize();return new ie(s.min.unscaleBy(n).floor(),s.max.unscaleBy(n).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var s in this._tiles)if(!this._tiles[s].loaded)return!1;return!0}});function Mh(s){return new Ta(s)}var Zr=Ta.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(s,n){this._url=s,n=w(this,n),n.detectRetina&&le.retina&&n.maxZoom>0?(n.tileSize=Math.floor(n.tileSize/2),n.zoomReverse?(n.zoomOffset--,n.minZoom=Math.min(n.maxZoom,n.minZoom+1)):(n.zoomOffset++,n.maxZoom=Math.max(n.minZoom,n.maxZoom-1)),n.minZoom=Math.max(0,n.minZoom)):n.zoomReverse?n.minZoom=Math.min(n.maxZoom,n.minZoom):n.maxZoom=Math.max(n.minZoom,n.maxZoom),typeof n.subdomains=="string"&&(n.subdomains=n.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(s,n){return this._url===s&&n===void 0&&(n=!0),this._url=s,n||this.redraw(),this},createTile:function(s,n){var d=document.createElement("img");return fe(d,"load",c(this._tileOnLoad,this,n,d)),fe(d,"error",c(this._tileOnError,this,n,d)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(d.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(d.referrerPolicy=this.options.referrerPolicy),d.alt="",d.src=this.getTileUrl(s),d},getTileUrl:function(s){var n={r:le.retina?"@2x":"",s:this._getSubdomain(s),x:s.x,y:s.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var d=this._globalTileRange.max.y-s.y;this.options.tms&&(n.y=d),n["-y"]=d}return S(this._url,o(n,this.options))},_tileOnLoad:function(s,n){le.ielt9?setTimeout(c(s,this,null,n),0):s(null,n)},_tileOnError:function(s,n,d){var x=this.options.errorTileUrl;x&&n.getAttribute("src")!==x&&(n.src=x),s(d,n)},_onTileRemove:function(s){s.tile.onload=null},_getZoomForUrl:function(){var s=this._tileZoom,n=this.options.maxZoom,d=this.options.zoomReverse,x=this.options.zoomOffset;return d&&(s=n-s),s+x},_getSubdomain:function(s){var n=Math.abs(s.x+s.y)%this.options.subdomains.length;return this.options.subdomains[n]},_abortLoading:function(){var s,n;for(s in this._tiles)if(this._tiles[s].coords.z!==this._tileZoom&&(n=this._tiles[s].el,n.onload=g,n.onerror=g,!n.complete)){n.src=T;var d=this._tiles[s].coords;Fe(n),delete this._tiles[s],this.fire("tileabort",{tile:n,coords:d})}},_removeTile:function(s){var n=this._tiles[s];if(n)return n.el.setAttribute("src",T),Ta.prototype._removeTile.call(this,s)},_tileReady:function(s,n,d){if(!(!this._map||d&&d.getAttribute("src")===T))return Ta.prototype._tileReady.call(this,s,n,d)}});function od(s,n){return new Zr(s,n)}var ld=Zr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(s,n){this._url=s;var d=o({},this.defaultWmsParams);for(var x in n)x in this.options||(d[x]=n[x]);n=w(this,n);var v=n.detectRetina&&le.retina?2:1,C=this.getTileSize();d.width=C.x*v,d.height=C.y*v,this.wmsParams=d},onAdd:function(s){this._crs=this.options.crs||s.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var n=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[n]=this._crs.code,Zr.prototype.onAdd.call(this,s)},getTileUrl:function(s){var n=this._tileCoordsToNwSe(s),d=this._crs,x=ge(d.project(n[0]),d.project(n[1])),v=x.min,C=x.max,A=(this._wmsVersion>=1.3&&this._crs===ed?[v.y,v.x,C.y,C.x]:[v.x,v.y,C.x,C.y]).join(","),Z=Zr.prototype.getTileUrl.call(this,s);return Z+N(this.wmsParams,Z,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+A},setParams:function(s,n){return o(this.wmsParams,s),n||this.redraw(),this}});function Ah(s,n){return new ld(s,n)}Zr.WMS=ld,od.wms=Ah;var Ns=qt.extend({options:{padding:.1},initialize:function(s){w(this,s),u(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ve(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var s={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(s.zoomanim=this._onAnimZoom),s},_onAnimZoom:function(s){this._updateTransform(s.center,s.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(s,n){var d=this._map.getZoomScale(n,this._zoom),x=this._map.getSize().multiplyBy(.5+this.options.padding),v=this._map.project(this._center,n),C=x.multiplyBy(-d).add(v).subtract(this._map._getNewPixelOrigin(s,n));le.any3d?lr(this._container,C,d):Je(this._container,C)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var s in this._layers)this._layers[s]._reset()},_onZoomEnd:function(){for(var s in this._layers)this._layers[s]._project()},_updatePaths:function(){for(var s in this._layers)this._layers[s]._update()},_update:function(){var s=this.options.padding,n=this._map.getSize(),d=this._map.containerPointToLayerPoint(n.multiplyBy(-s)).round();this._bounds=new ie(d,d.add(n.multiplyBy(1+s*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),dd=Ns.extend({options:{tolerance:0},getEvents:function(){var s=Ns.prototype.getEvents.call(this);return s.viewprereset=this._onViewPreReset,s},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ns.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var s=this._container=document.createElement("canvas");fe(s,"mousemove",this._onMouseMove,this),fe(s,"click dblclick mousedown mouseup contextmenu",this._onClick,this),fe(s,"mouseout",this._handleMouseOut,this),s._leaflet_disable_events=!0,this._ctx=s.getContext("2d")},_destroyContainer:function(){F(this._redrawRequest),delete this._ctx,Fe(this._container),Ae(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var s;this._redrawBounds=null;for(var n in this._layers)s=this._layers[n],s._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ns.prototype._update.call(this);var s=this._bounds,n=this._container,d=s.getSize(),x=le.retina?2:1;Je(n,s.min),n.width=x*d.x,n.height=x*d.y,n.style.width=d.x+"px",n.style.height=d.y+"px",le.retina&&this._ctx.scale(2,2),this._ctx.translate(-s.min.x,-s.min.y),this.fire("update")}},_reset:function(){Ns.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(s){this._updateDashArray(s),this._layers[u(s)]=s;var n=s._order={layer:s,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=n),this._drawLast=n,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(s){this._requestRedraw(s)},_removePath:function(s){var n=s._order,d=n.next,x=n.prev;d?d.prev=x:this._drawLast=x,x?x.next=d:this._drawFirst=d,delete s._order,delete this._layers[u(s)],this._requestRedraw(s)},_updatePath:function(s){this._extendRedrawBounds(s),s._project(),s._update(),this._requestRedraw(s)},_updateStyle:function(s){this._updateDashArray(s),this._requestRedraw(s)},_updateDashArray:function(s){if(typeof s.options.dashArray=="string"){var n=s.options.dashArray.split(/[, ]+/),d=[],x,v;for(v=0;v<n.length;v++){if(x=Number(n[v]),isNaN(x))return;d.push(x)}s.options._dashArray=d}else s.options._dashArray=s.options.dashArray},_requestRedraw:function(s){this._map&&(this._extendRedrawBounds(s),this._redrawRequest=this._redrawRequest||O(this._redraw,this))},_extendRedrawBounds:function(s){if(s._pxBounds){var n=(s.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ie,this._redrawBounds.extend(s._pxBounds.min.subtract([n,n])),this._redrawBounds.extend(s._pxBounds.max.add([n,n]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var s=this._redrawBounds;if(s){var n=s.getSize();this._ctx.clearRect(s.min.x,s.min.y,n.x,n.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var s,n=this._redrawBounds;if(this._ctx.save(),n){var d=n.getSize();this._ctx.beginPath(),this._ctx.rect(n.min.x,n.min.y,d.x,d.y),this._ctx.clip()}this._drawing=!0;for(var x=this._drawFirst;x;x=x.next)s=x.layer,(!n||s._pxBounds&&s._pxBounds.intersects(n))&&s._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(s,n){if(this._drawing){var d,x,v,C,A=s._parts,Z=A.length,H=this._ctx;if(Z){for(H.beginPath(),d=0;d<Z;d++){for(x=0,v=A[d].length;x<v;x++)C=A[d][x],H[x?"lineTo":"moveTo"](C.x,C.y);n&&H.closePath()}this._fillStroke(H,s)}}},_updateCircle:function(s){if(!(!this._drawing||s._empty())){var n=s._point,d=this._ctx,x=Math.max(Math.round(s._radius),1),v=(Math.max(Math.round(s._radiusY),1)||x)/x;v!==1&&(d.save(),d.scale(1,v)),d.beginPath(),d.arc(n.x,n.y/v,x,0,Math.PI*2,!1),v!==1&&d.restore(),this._fillStroke(d,s)}},_fillStroke:function(s,n){var d=n.options;d.fill&&(s.globalAlpha=d.fillOpacity,s.fillStyle=d.fillColor||d.color,s.fill(d.fillRule||"evenodd")),d.stroke&&d.weight!==0&&(s.setLineDash&&s.setLineDash(n.options&&n.options._dashArray||[]),s.globalAlpha=d.opacity,s.lineWidth=d.weight,s.strokeStyle=d.color,s.lineCap=d.lineCap,s.lineJoin=d.lineJoin,s.stroke())},_onClick:function(s){for(var n=this._map.mouseEventToLayerPoint(s),d,x,v=this._drawFirst;v;v=v.next)d=v.layer,d.options.interactive&&d._containsPoint(n)&&(!(s.type==="click"||s.type==="preclick")||!this._map._draggableMoved(d))&&(x=d);this._fireEvent(x?[x]:!1,s)},_onMouseMove:function(s){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var n=this._map.mouseEventToLayerPoint(s);this._handleMouseHover(s,n)}},_handleMouseOut:function(s){var n=this._hoveredLayer;n&&(qe(this._container,"leaflet-interactive"),this._fireEvent([n],s,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(s,n){if(!this._mouseHoverThrottled){for(var d,x,v=this._drawFirst;v;v=v.next)d=v.layer,d.options.interactive&&d._containsPoint(n)&&(x=d);x!==this._hoveredLayer&&(this._handleMouseOut(s),x&&(ve(this._container,"leaflet-interactive"),this._fireEvent([x],s,"mouseover"),this._hoveredLayer=x)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,s),this._mouseHoverThrottled=!0,setTimeout(c(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(s,n,d){this._map._fireDOMEvent(n,d||n.type,s)},_bringToFront:function(s){var n=s._order;if(n){var d=n.next,x=n.prev;if(d)d.prev=x;else return;x?x.next=d:d&&(this._drawFirst=d),n.prev=this._drawLast,this._drawLast.next=n,n.next=null,this._drawLast=n,this._requestRedraw(s)}},_bringToBack:function(s){var n=s._order;if(n){var d=n.next,x=n.prev;if(x)x.next=d;else return;d?d.prev=x:x&&(this._drawLast=x),n.prev=null,n.next=this._drawFirst,this._drawFirst.prev=n,this._drawFirst=n,this._requestRedraw(s)}}});function cd(s){return le.canvas?new dd(s):null}var Pa=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(s){return document.createElement("<lvml:"+s+' class="lvml">')}}catch{}return function(s){return document.createElement("<"+s+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Dh={_initContainer:function(){this._container=Ce("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ns.prototype._update.call(this),this.fire("update"))},_initPath:function(s){var n=s._container=Pa("shape");ve(n,"leaflet-vml-shape "+(this.options.className||"")),n.coordsize="1 1",s._path=Pa("path"),n.appendChild(s._path),this._updateStyle(s),this._layers[u(s)]=s},_addPath:function(s){var n=s._container;this._container.appendChild(n),s.options.interactive&&s.addInteractiveTarget(n)},_removePath:function(s){var n=s._container;Fe(n),s.removeInteractiveTarget(n),delete this._layers[u(s)]},_updateStyle:function(s){var n=s._stroke,d=s._fill,x=s.options,v=s._container;v.stroked=!!x.stroke,v.filled=!!x.fill,x.stroke?(n||(n=s._stroke=Pa("stroke")),v.appendChild(n),n.weight=x.weight+"px",n.color=x.color,n.opacity=x.opacity,x.dashArray?n.dashStyle=P(x.dashArray)?x.dashArray.join(" "):x.dashArray.replace(/( *, *)/g," "):n.dashStyle="",n.endcap=x.lineCap.replace("butt","flat"),n.joinstyle=x.lineJoin):n&&(v.removeChild(n),s._stroke=null),x.fill?(d||(d=s._fill=Pa("fill")),v.appendChild(d),d.color=x.fillColor||x.color,d.opacity=x.fillOpacity):d&&(v.removeChild(d),s._fill=null)},_updateCircle:function(s){var n=s._point.round(),d=Math.round(s._radius),x=Math.round(s._radiusY||d);this._setPath(s,s._empty()?"M0 0":"AL "+n.x+","+n.y+" "+d+","+x+" 0,"+65535*360)},_setPath:function(s,n){s._path.v=n},_bringToFront:function(s){Ir(s._container)},_bringToBack:function(s){Or(s._container)}},kn=le.vml?Pa:Dt,La=Ns.extend({_initContainer:function(){this._container=kn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=kn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Fe(this._container),Ae(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ns.prototype._update.call(this);var s=this._bounds,n=s.getSize(),d=this._container;(!this._svgSize||!this._svgSize.equals(n))&&(this._svgSize=n,d.setAttribute("width",n.x),d.setAttribute("height",n.y)),Je(d,s.min),d.setAttribute("viewBox",[s.min.x,s.min.y,n.x,n.y].join(" ")),this.fire("update")}},_initPath:function(s){var n=s._path=kn("path");s.options.className&&ve(n,s.options.className),s.options.interactive&&ve(n,"leaflet-interactive"),this._updateStyle(s),this._layers[u(s)]=s},_addPath:function(s){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(s._path),s.addInteractiveTarget(s._path)},_removePath:function(s){Fe(s._path),s.removeInteractiveTarget(s._path),delete this._layers[u(s)]},_updatePath:function(s){s._project(),s._update()},_updateStyle:function(s){var n=s._path,d=s.options;n&&(d.stroke?(n.setAttribute("stroke",d.color),n.setAttribute("stroke-opacity",d.opacity),n.setAttribute("stroke-width",d.weight),n.setAttribute("stroke-linecap",d.lineCap),n.setAttribute("stroke-linejoin",d.lineJoin),d.dashArray?n.setAttribute("stroke-dasharray",d.dashArray):n.removeAttribute("stroke-dasharray"),d.dashOffset?n.setAttribute("stroke-dashoffset",d.dashOffset):n.removeAttribute("stroke-dashoffset")):n.setAttribute("stroke","none"),d.fill?(n.setAttribute("fill",d.fillColor||d.color),n.setAttribute("fill-opacity",d.fillOpacity),n.setAttribute("fill-rule",d.fillRule||"evenodd")):n.setAttribute("fill","none"))},_updatePoly:function(s,n){this._setPath(s,zs(s._parts,n))},_updateCircle:function(s){var n=s._point,d=Math.max(Math.round(s._radius),1),x=Math.max(Math.round(s._radiusY),1)||d,v="a"+d+","+x+" 0 1,0 ",C=s._empty()?"M0 0":"M"+(n.x-d)+","+n.y+v+d*2+",0 "+v+-d*2+",0 ";this._setPath(s,C)},_setPath:function(s,n){s._path.setAttribute("d",n)},_bringToFront:function(s){Ir(s._path)},_bringToBack:function(s){Or(s._path)}});le.vml&&La.include(Dh);function ud(s){return le.svg||le.vml?new La(s):null}ke.include({getRenderer:function(s){var n=s.options.renderer||this._getPaneRenderer(s.options.pane)||this.options.renderer||this._renderer;return n||(n=this._renderer=this._createRenderer()),this.hasLayer(n)||this.addLayer(n),n},_getPaneRenderer:function(s){if(s==="overlayPane"||s===void 0)return!1;var n=this._paneRenderers[s];return n===void 0&&(n=this._createRenderer({pane:s}),this._paneRenderers[s]=n),n},_createRenderer:function(s){return this.options.preferCanvas&&cd(s)||ud(s)}});var md=Br.extend({initialize:function(s,n){Br.prototype.initialize.call(this,this._boundsToLatLngs(s),n)},setBounds:function(s){return this.setLatLngs(this._boundsToLatLngs(s))},_boundsToLatLngs:function(s){return s=V(s),[s.getSouthWest(),s.getNorthWest(),s.getNorthEast(),s.getSouthEast()]}});function Ih(s,n){return new md(s,n)}La.create=kn,La.pointsToPath=zs,ws.geometryToLayer=bn,ws.coordsToLatLng=qi,ws.coordsToLatLngs=yn,ws.latLngToCoords=Gi,ws.latLngsToCoords=vn,ws.getFeature=$r,ws.asFeature=jn,ke.mergeOptions({boxZoom:!0});var hd=os.extend({initialize:function(s){this._map=s,this._container=s._container,this._pane=s._panes.overlayPane,this._resetStateTimeout=0,s.on("unload",this._destroy,this)},addHooks:function(){fe(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ae(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Fe(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(s){if(!s.shiftKey||s.which!==1&&s.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ja(),Li(),this._startPoint=this._map.mouseEventToContainerPoint(s),fe(document,{contextmenu:ur,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(s){this._moved||(this._moved=!0,this._box=Ce("div","leaflet-zoom-box",this._container),ve(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(s);var n=new ie(this._point,this._startPoint),d=n.getSize();Je(this._box,n.min),this._box.style.width=d.x+"px",this._box.style.height=d.y+"px"},_finish:function(){this._moved&&(Fe(this._box),qe(this._container,"leaflet-crosshair")),_a(),Ei(),Ae(document,{contextmenu:ur,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(s){if(!(s.which!==1&&s.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(c(this._resetState,this),0);var n=new U(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(n).fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(s){s.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ke.addInitHook("addHandler","boxZoom",hd),ke.mergeOptions({doubleClickZoom:!0});var xd=os.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(s){var n=this._map,d=n.getZoom(),x=n.options.zoomDelta,v=s.originalEvent.shiftKey?d-x:d+x;n.options.doubleClickZoom==="center"?n.setZoom(v):n.setZoomAround(s.containerPoint,v)}});ke.addInitHook("addHandler","doubleClickZoom",xd),ke.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var pd=os.extend({addHooks:function(){if(!this._draggable){var s=this._map;this._draggable=new Bs(s._mapPane,s._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),s.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),s.on("zoomend",this._onZoomEnd,this),s.whenReady(this._onZoomEnd,this))}ve(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){qe(this._map._container,"leaflet-grab"),qe(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var s=this._map;if(s._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var n=V(this._map.options.maxBounds);this._offsetLimit=ge(this._map.latLngToContainerPoint(n.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(n.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;s.fire("movestart").fire("dragstart"),s.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(s){if(this._map.options.inertia){var n=this._lastTime=+new Date,d=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(d),this._times.push(n),this._prunePositions(n)}this._map.fire("move",s).fire("drag",s)},_prunePositions:function(s){for(;this._positions.length>1&&s-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var s=this._map.getSize().divideBy(2),n=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=n.subtract(s).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(s,n){return s-(s-n)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var s=this._draggable._newPos.subtract(this._draggable._startPos),n=this._offsetLimit;s.x<n.min.x&&(s.x=this._viscousLimit(s.x,n.min.x)),s.y<n.min.y&&(s.y=this._viscousLimit(s.y,n.min.y)),s.x>n.max.x&&(s.x=this._viscousLimit(s.x,n.max.x)),s.y>n.max.y&&(s.y=this._viscousLimit(s.y,n.max.y)),this._draggable._newPos=this._draggable._startPos.add(s)}},_onPreDragWrap:function(){var s=this._worldWidth,n=Math.round(s/2),d=this._initialWorldOffset,x=this._draggable._newPos.x,v=(x-n+d)%s+n-d,C=(x+n+d)%s-n-d,A=Math.abs(v+d)<Math.abs(C+d)?v:C;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=A},_onDragEnd:function(s){var n=this._map,d=n.options,x=!d.inertia||s.noInertia||this._times.length<2;if(n.fire("dragend",s),x)n.fire("moveend");else{this._prunePositions(+new Date);var v=this._lastPos.subtract(this._positions[0]),C=(this._lastTime-this._times[0])/1e3,A=d.easeLinearity,Z=v.multiplyBy(A/C),H=Z.distanceTo([0,0]),J=Math.min(d.inertiaMaxSpeed,H),ae=Z.multiplyBy(J/H),ue=J/(d.inertiaDeceleration*A),_e=ae.multiplyBy(-ue/2).round();!_e.x&&!_e.y?n.fire("moveend"):(_e=n._limitOffset(_e,n.options.maxBounds),O(function(){n.panBy(_e,{duration:ue,easeLinearity:A,noMoveStart:!0,animate:!0})}))}}});ke.addInitHook("addHandler","dragging",pd),ke.mergeOptions({keyboard:!0,keyboardPanDelta:80});var fd=os.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(s){this._map=s,this._setPanDelta(s.options.keyboardPanDelta),this._setZoomDelta(s.options.zoomDelta)},addHooks:function(){var s=this._map._container;s.tabIndex<=0&&(s.tabIndex="0"),fe(s,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ae(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var s=document.body,n=document.documentElement,d=s.scrollTop||n.scrollTop,x=s.scrollLeft||n.scrollLeft;this._map._container.focus(),window.scrollTo(x,d)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(s){var n=this._panKeys={},d=this.keyCodes,x,v;for(x=0,v=d.left.length;x<v;x++)n[d.left[x]]=[-1*s,0];for(x=0,v=d.right.length;x<v;x++)n[d.right[x]]=[s,0];for(x=0,v=d.down.length;x<v;x++)n[d.down[x]]=[0,s];for(x=0,v=d.up.length;x<v;x++)n[d.up[x]]=[0,-1*s]},_setZoomDelta:function(s){var n=this._zoomKeys={},d=this.keyCodes,x,v;for(x=0,v=d.zoomIn.length;x<v;x++)n[d.zoomIn[x]]=s;for(x=0,v=d.zoomOut.length;x<v;x++)n[d.zoomOut[x]]=-s},_addHooks:function(){fe(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ae(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){var n=s.keyCode,d=this._map,x;if(n in this._panKeys){if(!d._panAnim||!d._panAnim._inProgress)if(x=this._panKeys[n],s.shiftKey&&(x=se(x).multiplyBy(3)),d.options.maxBounds&&(x=d._limitOffset(se(x),d.options.maxBounds)),d.options.worldCopyJump){var v=d.wrapLatLng(d.unproject(d.project(d.getCenter()).add(x)));d.panTo(v)}else d.panBy(x)}else if(n in this._zoomKeys)d.setZoom(d.getZoom()+(s.shiftKey?3:1)*this._zoomKeys[n]);else if(n===27&&d._popup&&d._popup.options.closeOnEscapeKey)d.closePopup();else return;ur(s)}}});ke.addInitHook("addHandler","keyboard",fd),ke.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var gd=os.extend({addHooks:function(){fe(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ae(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(s){var n=$l(s),d=this._map.options.wheelDebounceTime;this._delta+=n,this._lastMousePos=this._map.mouseEventToContainerPoint(s),this._startTime||(this._startTime=+new Date);var x=Math.max(d-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(c(this._performZoom,this),x),ur(s)},_performZoom:function(){var s=this._map,n=s.getZoom(),d=this._map.options.zoomSnap||0;s._stop();var x=this._delta/(this._map.options.wheelPxPerZoomLevel*4),v=4*Math.log(2/(1+Math.exp(-Math.abs(x))))/Math.LN2,C=d?Math.ceil(v/d)*d:v,A=s._limitZoom(n+(this._delta>0?C:-C))-n;this._delta=0,this._startTime=null,A&&(s.options.scrollWheelZoom==="center"?s.setZoom(n+A):s.setZoomAround(this._lastMousePos,n+A))}});ke.addInitHook("addHandler","scrollWheelZoom",gd);var Oh=600;ke.mergeOptions({tapHold:le.touchNative&&le.safari&&le.mobile,tapTolerance:15});var bd=os.extend({addHooks:function(){fe(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ae(this._map._container,"touchstart",this._onDown,this)},_onDown:function(s){if(clearTimeout(this._holdTimeout),s.touches.length===1){var n=s.touches[0];this._startPos=this._newPos=new W(n.clientX,n.clientY),this._holdTimeout=setTimeout(c(function(){this._cancel(),this._isTapValid()&&(fe(document,"touchend",ct),fe(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",n))},this),Oh),fe(document,"touchend touchcancel contextmenu",this._cancel,this),fe(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function s(){Ae(document,"touchend",ct),Ae(document,"touchend touchcancel",s)},_cancel:function(){clearTimeout(this._holdTimeout),Ae(document,"touchend touchcancel contextmenu",this._cancel,this),Ae(document,"touchmove",this._onMove,this)},_onMove:function(s){var n=s.touches[0];this._newPos=new W(n.clientX,n.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(s,n){var d=new MouseEvent(s,{bubbles:!0,cancelable:!0,view:window,screenX:n.screenX,screenY:n.screenY,clientX:n.clientX,clientY:n.clientY});d._simulated=!0,n.target.dispatchEvent(d)}});ke.addInitHook("addHandler","tapHold",bd),ke.mergeOptions({touchZoom:le.touch,bounceAtZoomLimits:!0});var yd=os.extend({addHooks:function(){ve(this._map._container,"leaflet-touch-zoom"),fe(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){qe(this._map._container,"leaflet-touch-zoom"),Ae(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(s){var n=this._map;if(!(!s.touches||s.touches.length!==2||n._animatingZoom||this._zooming)){var d=n.mouseEventToContainerPoint(s.touches[0]),x=n.mouseEventToContainerPoint(s.touches[1]);this._centerPoint=n.getSize()._divideBy(2),this._startLatLng=n.containerPointToLatLng(this._centerPoint),n.options.touchZoom!=="center"&&(this._pinchStartLatLng=n.containerPointToLatLng(d.add(x)._divideBy(2))),this._startDist=d.distanceTo(x),this._startZoom=n.getZoom(),this._moved=!1,this._zooming=!0,n._stop(),fe(document,"touchmove",this._onTouchMove,this),fe(document,"touchend touchcancel",this._onTouchEnd,this),ct(s)}},_onTouchMove:function(s){if(!(!s.touches||s.touches.length!==2||!this._zooming)){var n=this._map,d=n.mouseEventToContainerPoint(s.touches[0]),x=n.mouseEventToContainerPoint(s.touches[1]),v=d.distanceTo(x)/this._startDist;if(this._zoom=n.getScaleZoom(v,this._startZoom),!n.options.bounceAtZoomLimits&&(this._zoom<n.getMinZoom()&&v<1||this._zoom>n.getMaxZoom()&&v>1)&&(this._zoom=n._limitZoom(this._zoom)),n.options.touchZoom==="center"){if(this._center=this._startLatLng,v===1)return}else{var C=d._add(x)._divideBy(2)._subtract(this._centerPoint);if(v===1&&C.x===0&&C.y===0)return;this._center=n.unproject(n.project(this._pinchStartLatLng,this._zoom).subtract(C),this._zoom)}this._moved||(n._moveStart(!0,!1),this._moved=!0),F(this._animRequest);var A=c(n._move,n,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=O(A,this,!0),ct(s)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,F(this._animRequest),Ae(document,"touchmove",this._onTouchMove,this),Ae(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ke.addInitHook("addHandler","touchZoom",yd),ke.BoxZoom=hd,ke.DoubleClickZoom=xd,ke.Drag=pd,ke.Keyboard=fd,ke.ScrollWheelZoom=gd,ke.TapHold=bd,ke.TouchZoom=yd,a.Bounds=ie,a.Browser=le,a.CRS=ce,a.Canvas=dd,a.Circle=Vi,a.CircleMarker=gn,a.Class=q,a.Control=Vt,a.DivIcon=id,a.DivOverlay=ls,a.DomEvent=th,a.DomUtil=Xm,a.Draggable=Bs,a.Evented=te,a.FeatureGroup=js,a.GeoJSON=ws,a.GridLayer=Ta,a.Handler=os,a.Icon=Fr,a.ImageOverlay=_n,a.LatLng=Y,a.LatLngBounds=U,a.Layer=qt,a.LayerGroup=zr,a.LineUtil=xh,a.Map=ke,a.Marker=fn,a.Mixin=lh,a.Path=$s,a.Point=W,a.PolyUtil=dh,a.Polygon=Br,a.Polyline=_s,a.Popup=wn,a.PosAnimation=Zl,a.Projection=ph,a.Rectangle=md,a.Renderer=Ns,a.SVG=La,a.SVGOverlay=nd,a.TileLayer=Zr,a.Tooltip=Nn,a.Transformation=Le,a.Util=B,a.VideoOverlay=ad,a.bind=c,a.bounds=ge,a.canvas=cd,a.circle=wh,a.circleMarker=_h,a.control=ka,a.divIcon=Rh,a.extend=o,a.featureGroup=yh,a.geoJSON=rd,a.geoJson=Ch,a.gridLayer=Mh,a.icon=vh,a.imageOverlay=Sh,a.latLng=Q,a.latLngBounds=V,a.layerGroup=bh,a.map=sh,a.marker=jh,a.point=se,a.polygon=kh,a.polyline=Nh,a.popup=Lh,a.rectangle=Ih,a.setOptions=w,a.stamp=u,a.svg=ud,a.svgOverlay=Ph,a.tileLayer=od,a.tooltip=Eh,a.transformation=xe,a.version=i,a.videoOverlay=Th;var zh=window.L;a.noConflict=function(){return window.L=zh,this},window.L=a})})(Oo,Oo.exports);var wi=Oo.exports;function wl(t,r,a){return Object.freeze({instance:t,context:r,container:a})}function Nl(t,r){return r==null?function(i,o){const l=f.useRef();return l.current||(l.current=t(i,o)),l}:function(i,o){const l=f.useRef();l.current||(l.current=t(i,o));const c=f.useRef(i),{instance:m}=l.current;return f.useEffect(function(){c.current!==i&&(r(m,i,c.current),c.current=i)},[m,i,o]),l}}function wm(t,r){f.useEffect(function(){return(r.layerContainer??r.map).addLayer(t.instance),function(){var l;(l=r.layerContainer)==null||l.removeLayer(t.instance),r.map.removeLayer(t.instance)}},[r,t])}function wv(t){return function(a){const i=jl(),o=t(_i(a,i),i);return vm(i.map,a.attribution),_l(o.current,a.eventHandlers),wm(o.current,i),o}}function Nv(t,r){const a=f.useRef();f.useEffect(function(){if(r.pathOptions!==a.current){const o=r.pathOptions??{};t.instance.setStyle(o),a.current=o}},[t,r])}function kv(t){return function(a){const i=jl(),o=t(_i(a,i),i);return _l(o.current,a.eventHandlers),wm(o.current,i),Nv(o.current,a),o}}function Cv(t,r){const a=Nl(t),i=_v(a,r);return vv(i)}function Sv(t,r){const a=Nl(t,r),i=kv(a);return yv(i)}function Tv(t,r){const a=Nl(t,r),i=wv(a);return jv(i)}function Pv(t,r,a){const{opacity:i,zIndex:o}=r;i!=null&&i!==a.opacity&&t.setOpacity(i),o!=null&&o!==a.zIndex&&t.setZIndex(o)}const Lv=Sv(function({center:r,children:a,...i},o){const l=new wi.CircleMarker(r,i);return wl(l,bv(o,{overlayContainer:l}))},pv);function zo(){return zo=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},zo.apply(this,arguments)}function Ev({bounds:t,boundsOptions:r,center:a,children:i,className:o,id:l,placeholder:c,style:m,whenReady:u,zoom:h,...p},g){const[b]=f.useState({className:o,id:l,style:m}),[y,j]=f.useState(null);f.useImperativeHandle(g,()=>(y==null?void 0:y.map)??null,[y]);const w=f.useCallback(k=>{if(k!==null&&y===null){const S=new wi.Map(k,p);a!=null&&h!=null?S.setView(a,h):t!=null&&S.fitBounds(t,r),u!=null&&S.whenReady(u),j(gv(S))}},[]);f.useEffect(()=>()=>{y==null||y.map.remove()},[y]);const N=y?ft.createElement(_m,{value:y},i):c??null;return ft.createElement("div",zo({},b,{ref:w}),N)}const Rv=f.forwardRef(Ev),Mv=Cv(function(r,a){const i=new wi.Popup(r,a.overlayContainer);return wl(i,a)},function(r,a,{position:i},o){f.useEffect(function(){const{instance:c}=r;function m(h){h.popup===c&&(c.update(),o(!0))}function u(h){h.popup===c&&o(!1)}return a.map.on({popupopen:m,popupclose:u}),a.overlayContainer==null?(i!=null&&c.setLatLng(i),c.openOn(a.map)):a.overlayContainer.bindPopup(c),function(){var p;a.map.off({popupopen:m,popupclose:u}),(p=a.overlayContainer)==null||p.unbindPopup(),a.map.removeLayer(c)}},[r,a,o,i])}),Av=Tv(function({url:r,...a},i){const o=new wi.TileLayer(r,_i(a,i));return wl(o,i)},function(r,a,i){Pv(r,a,i);const{url:o}=a;o!=null&&o!==i.url&&r.setUrl(o)}),ri=["#8884d8","#82ca9d","#ffc658","#ff7300","#0088fe","#00C49F","#FFBB28","#FF8042","#a4de6c","#d0ed57"],Dv=({profile:t})=>e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(qc,{className:"w-5 h-5 mr-2 text-blue-500"}),"Geospatial Analysis",e.jsx(st,{text:"Visualizes data points on a map based on detected Latitude/Longitude columns. Colors indicate target values."})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Detected columns: ",e.jsx("span",{className:"font-mono bg-gray-100 dark:bg-gray-900 px-1 rounded",children:t.geospatial.lat_col}),", ",e.jsx("span",{className:"font-mono bg-gray-100 dark:bg-gray-900 px-1 rounded",children:t.geospatial.lon_col})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 h-96 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 relative z-0",children:(()=>{const r=[[t.geospatial.min_lat,t.geospatial.min_lon],[t.geospatial.max_lat,t.geospatial.max_lon]],a=Array.from(new Set(t.geospatial.sample_points.map(l=>l.label))).filter(Boolean),i=a.length>20,o=l=>{if(!l||i)return"#3b82f6";const c=a.indexOf(l);return ri[c%ri.length]};return e.jsxs(Rv,{bounds:r,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,children:[e.jsx(Av,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),t.geospatial.sample_points.map((l,c)=>e.jsx(Lv,{center:[l.lat,l.lon],radius:5,pathOptions:{color:o(l.label),fillColor:o(l.label),fillOpacity:.7,weight:1},children:e.jsx(Mv,{children:e.jsxs("div",{className:"text-xs",children:[e.jsx("strong",{children:"Lat:"})," ",l.lat.toFixed(4),e.jsx("br",{}),e.jsx("strong",{children:"Lon:"})," ",l.lon.toFixed(4),e.jsx("br",{}),l.label&&e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[t.target_col,":"]})," ",l.label]})]})})},c))]})})()}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-3",children:"Spatial Bounds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-gray-400",children:"Latitude Range"}),e.jsxs("span",{className:"font-mono",children:[t.geospatial.min_lat.toFixed(4)," to ",t.geospatial.max_lat.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-gray-400",children:"Longitude Range"}),e.jsxs("span",{className:"font-mono",children:[t.geospatial.min_lon.toFixed(4)," to ",t.geospatial.max_lon.toFixed(4)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-3",children:"Centroid"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsxs("span",{className:"font-mono text-sm",children:[t.geospatial.centroid_lat.toFixed(4),", ",t.geospatial.centroid_lon.toFixed(4)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-100 dark:border-blue-800",children:[e.jsx(gt,{className:"w-4 h-4 text-blue-500 mt-0.5 shrink-0"}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:e.jsxs("p",{children:["This scatter plot shows the spatial distribution of your data.",t.target_col&&" Points are colored by the target variable."]})})]})]})]})]}),Iv=({profile:t,downloadChart:r,history:a,loading:i,loadSpecificReport:o,report:l})=>{var m;const c=async()=>{if(!(t!=null&&t.target_interactions))return;const u=t.target_interactions,h=400,p=800,g=40,b=2,y=Math.ceil(u.length/b),j=b*p+(b+1)*g,w=y*(h+g)+100,N=document.createElement("canvas");N.width=j,N.height=w;const k=N.getContext("2d");if(!k)return;const S=document.documentElement.classList.contains("dark"),P=S?"#1f2937":"#ffffff",E=S?"#ffffff":"#111827",T=S?"#9ca3af":"#4b5563";k.fillStyle=P,k.fillRect(0,0,N.width,N.height),k.fillStyle=E,k.font="bold 24px sans-serif",k.textAlign="center",k.fillText("Detailed Interactions (Box Plots)",j/2,50);for(let R=0;R<u.length;R++){const _=u[R],M=`interaction-chart-${R}`,I=document.getElementById(M);if(!I)continue;const O=I.querySelector("svg");if(!O)continue;const F=Math.floor(R/b),B=R%b,q=g+B*(p+g),G=100+F*(h+g);k.fillStyle=T,k.font="bold 16px sans-serif",k.textAlign="left",k.fillText(`${_.feature} vs ${t.target_col}`,q+40,G),_.p_value!==void 0&&(k.font="14px sans-serif",k.fillStyle=_.p_value<.05?"#059669":T,k.fillText(`ANOVA p: ${Number(_.p_value).toExponential(2)}`,q+40,G+20));const te=new XMLSerializer().serializeToString(O),W=new Image,me=new Blob([te],{type:"image/svg+xml;charset=utf-8"}),se=URL.createObjectURL(me);await new Promise(ie=>{W.onload=()=>{k.drawImage(W,q,G+30,p,h-50),URL.revokeObjectURL(se),ie()},W.src=se})}const D=document.createElement("a");D.download="all-interactions.png",D.href=N.toDataURL("image/png"),D.click()};return e.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(gs,{className:"w-5 h-5 mr-2 text-blue-500"}),"Target Analysis: ",e.jsx("span",{className:"ml-2 text-blue-600",children:t.target_col}),e.jsx(st,{text:"Analyzes relationships between the target variable and other features. Shows top correlations and key drivers."})]}),e.jsx("button",{onClick:()=>r("target-analysis-chart","target-analysis",`Target Analysis: ${t.target_col}`,"Top Associated Features"),className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download Chart",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Top Associated Features"}),e.jsx("div",{className:"h-64 w-full",id:"target-analysis-chart",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:Object.entries(t.target_correlations).slice(0,10).map(([u,h])=>({name:u,value:h})),layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(Ct,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(St,{type:"number",domain:[0,1]}),e.jsx(Tt,{type:"category",dataKey:"name",width:120,tick:{fontSize:12}}),e.jsx(pt,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},itemStyle:{color:"#fff"},formatter:u=>[u.toFixed(3),"Association"]}),e.jsx(Bo,{x:0,stroke:"#9ca3af"}),e.jsx(Mt,{dataKey:"value",fill:"#3b82f6",radius:[0,4,4,0],barSize:20})]})})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Key Insights"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 text-blue-500",children:""}),e.jsxs("span",{children:["Target is ",e.jsx("strong",{children:(m=t.columns[t.target_col])==null?void 0:m.dtype})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 text-blue-500",children:""}),e.jsxs("span",{children:["Strongest predictor: ",e.jsx("strong",{children:Object.keys(t.target_correlations)[0]||"None"}),Object.values(t.target_correlations)[0]!==void 0&&e.jsxs(e.Fragment,{children:[" (",Object.values(t.target_correlations)[0].toFixed(2),")"]})]})]})]})]})]})]}),t.target_interactions&&t.target_interactions.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(li,{className:"w-5 h-5 mr-2 text-purple-500"}),"Detailed Interactions (Box Plots)",e.jsx(st,{text:"Shows distribution of values across categories. The box represents the middle 50% of data (Q1 to Q3). The line inside is the median."})]}),e.jsx("button",{onClick:c,className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download All Charts",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:[e.jsx("span",{className:"font-semibold",children:"ANOVA Analysis:"})," A p-value < 0.05 (highlighted in green) indicates that the feature varies significantly across the target categories, making it a strong predictor."]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.target_interactions.map((u,h)=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-100 dark:border-gray-800 relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-100",children:e.jsx("button",{onClick:()=>r(`interaction-chart-${h}`,`interaction-${u.feature}`,`${u.feature} vs ${t.target_col}`,u.p_value!==void 0?`ANOVA p: ${Number(u.p_value).toExponential(2)}`:void 0),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(Xe,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[u.feature," vs ",t.target_col]}),u.p_value!==void 0&&u.p_value!==null&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full inline-block mt-1 ${u.p_value<.05?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400"}`,children:["ANOVA p: ",Number(u.p_value).toExponential(2)]})]}),e.jsx("div",{className:"h-64 w-full",id:`interaction-chart-${h}`,children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(rx,{data:u.data.map(p=>({...p,boxBottom:p.stats.q1,boxHeight:p.stats.q3-p.stats.q1})),margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Ct,{strokeDasharray:"3 3",vertical:!1}),e.jsx(St,{dataKey:"name",tick:{fontSize:11}}),e.jsx(Tt,{domain:["auto","auto"],tick:{fontSize:11}}),e.jsx(pt,{cursor:{fill:"transparent"},content:({active:p,payload:g})=>{if(p&&g&&g.length){const b=g[0].payload;return e.jsxs("div",{className:"bg-gray-800 text-white text-xs p-2 rounded shadow-lg z-50",children:[e.jsx("p",{className:"font-semibold mb-1",children:b.name}),e.jsxs("p",{children:["Max: ",b.stats.max.toFixed(2)]}),e.jsxs("p",{children:["Q3: ",b.stats.q3.toFixed(2)]}),e.jsxs("p",{children:["Median: ",b.stats.median.toFixed(2)]}),e.jsxs("p",{children:["Q1: ",b.stats.q1.toFixed(2)]}),e.jsxs("p",{children:["Min: ",b.stats.min.toFixed(2)]})]})}return null}}),e.jsx(Mt,{dataKey:"boxBottom",stackId:"a",fill:"transparent",legendType:"none"}),e.jsx(Mt,{dataKey:"boxHeight",stackId:"a",fill:"#8884d8",fillOpacity:.6,name:"IQR (Q1-Q3)"}),e.jsx(za,{name:"Median",dataKey:"stats.median",fill:"#ff7300",shape:"square"}),e.jsx(za,{name:"Max",dataKey:"stats.max",fill:"#82ca9d",shape:"cross"}),e.jsx(za,{name:"Min",dataKey:"stats.min",fill:"#82ca9d",shape:"cross"})]})})}),e.jsx("p",{className:"text-xs text-center text-gray-400 mt-2",children:"* Box: Q1-Q3. Orange square: Median. Green crosses: Min/Max."})]},h))})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm h-fit sticky top-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qt,{className:"w-4 h-4 mr-2"}),"Analysis History"]}),i&&e.jsx(Ye,{className:"w-3 h-3 animate-spin text-blue-500"})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:a.length===0?e.jsx("p",{className:"text-xs text-gray-500 italic",children:"No previous analyses found."}):a.slice(0,10).map(u=>e.jsxs("button",{onClick:()=>!i&&o(u.id),disabled:i,className:`w-full text-left p-3 rounded-md text-sm border transition-colors ${l&&l.id===u.id?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300":"bg-gray-50 border-gray-100 text-gray-600 hover:bg-gray-100 dark:bg-gray-900 dark:border-gray-800 dark:text-gray-400 dark:hover:bg-gray-800"} ${i?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"font-medium truncate",children:u.target_col?`Target: ${u.target_col}`:"General Analysis"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:new Date(u.created_at).toLocaleString()}),e.jsx("div",{className:`text-xs mt-1 inline-block px-1.5 py-0.5 rounded ${u.status==="COMPLETED"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":u.status==="FAILED"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:u.status})]},u.id))})]})})]})},Ov=({profile:t,downloadChart:r})=>{var a,i;return e.jsxs("div",{className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Sr,{className:"w-5 h-5 mr-2 text-blue-500"}),"Trend Analysis (",t.timeseries.date_col,")",e.jsx(st,{text:"Shows how values change over time. Look for long-term trends (up/down) or sudden shifts."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.timeseries.stationarity_test&&e.jsxs("div",{className:`text-xs px-3 py-1 rounded-full border flex items-center gap-1 ${t.timeseries.stationarity_test.is_stationary?"bg-green-50 border-green-200 text-green-700 dark:bg-green-900/20 dark:border-green-800 dark:text-green-300":"bg-yellow-50 border-yellow-200 text-yellow-700 dark:bg-yellow-900/20 dark:border-yellow-800 dark:text-yellow-300"}`,children:[e.jsx(st,{text:"Augmented Dickey-Fuller Test. Stationary (p<0.05) means the data has constant mean/variance over time. Non-Stationary (p>=0.05) means it has a trend or seasonality."}),e.jsx("span",{className:"font-semibold",children:"ADF Test:"})," ",t.timeseries.stationarity_test.is_stationary?"Stationary":"Non-Stationary",e.jsxs("span",{className:"opacity-75 ml-1",children:["(p=",t.timeseries.stationarity_test.p_value.toFixed(3),")"]})]}),e.jsx("button",{onClick:()=>r("trend-chart","trend-analysis","Trend Analysis",`Date Column: ${t.timeseries.date_col}`,t.timeseries.stationarity_test?`ADF Test: ${t.timeseries.stationarity_test.is_stationary?"Stationary":"Non-Stationary"} (p=${t.timeseries.stationarity_test.p_value.toFixed(3)})`:void 0),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"h-80 w-full",id:"trend-chart",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(Ic,{data:t.timeseries.trend,children:[e.jsx(Ct,{strokeDasharray:"3 3",vertical:!1}),e.jsx(St,{dataKey:"date",tick:{fontSize:12},minTickGap:30}),e.jsx(Tt,{}),e.jsx(pt,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},labelStyle:{color:"#9ca3af"}}),e.jsx(en,{}),Object.keys(((a=t.timeseries.trend[0])==null?void 0:a.values)||{}).map((o,l)=>e.jsx(Oa,{type:"monotone",dataKey:`values.${o}`,name:o,stroke:ri[l%ri.length],dot:!1,strokeWidth:2},o)),(!((i=t.timeseries.trend[0])!=null&&i.values)||Object.keys(t.timeseries.trend[0].values).length===0)&&e.jsx(Oa,{type:"monotone",dataKey:"count",stroke:"#3b82f6",dot:!1})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm relative group",children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-100 z-10",children:e.jsx("button",{onClick:()=>r("day-seasonality-chart","day-seasonality","Day of Week Seasonality"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(Xe,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Day of Week Seasonality"}),e.jsx(st,{text:"Average values for each day. Helps identify weekly patterns (e.g., lower on weekends)."})]}),e.jsx("div",{className:"h-64 w-full",id:"day-seasonality-chart",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:t.timeseries.seasonality.day_of_week,children:[e.jsx(Ct,{strokeDasharray:"3 3",vertical:!1}),e.jsx(St,{dataKey:"day",tick:{fontSize:12}}),e.jsx(Tt,{}),e.jsx(pt,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},cursor:{fill:"transparent"}}),e.jsx(Mt,{dataKey:"count",fill:"#8884d8",radius:[4,4,0,0]})]})})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm relative group",children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-100 z-10",children:e.jsx("button",{onClick:()=>r("month-seasonality-chart","month-seasonality","Monthly Seasonality"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(Xe,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Monthly Seasonality"}),e.jsx(st,{text:"Average values for each month. Helps identify yearly patterns or seasonal effects."})]}),e.jsx("div",{className:"h-64 w-full",id:"month-seasonality-chart",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:t.timeseries.seasonality.month_of_year,children:[e.jsx(Ct,{strokeDasharray:"3 3",vertical:!1}),e.jsx(St,{dataKey:"month",tick:{fontSize:12}}),e.jsx(Tt,{}),e.jsx(pt,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},cursor:{fill:"transparent"}}),e.jsx(Mt,{dataKey:"count",fill:"#82ca9d",radius:[4,4,0,0]})]})})})]}),t.timeseries.autocorrelation&&t.timeseries.autocorrelation.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Autocorrelation (Lag Analysis)"}),e.jsxs("div",{className:"group relative ml-2",children:[e.jsx(gt,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-64 p-2 bg-gray-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none text-center",children:["Shows how much the current value depends on past values (lags). High bars indicate repeating patterns or seasonality.",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-800"})]})]})]}),e.jsx("button",{onClick:()=>r("autocorrelation-chart","autocorrelation","Autocorrelation (Lag Analysis)"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Chart",children:e.jsx(Xe,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"h-80 w-full pb-6",id:"autocorrelation-chart",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:t.timeseries.autocorrelation,margin:{bottom:20},children:[e.jsx(Ct,{strokeDasharray:"3 3",vertical:!1}),e.jsx(St,{dataKey:"lag",tick:{fontSize:12},label:{value:"Lag (Days)",position:"insideBottom",offset:-15,fontSize:12}}),e.jsx(Tt,{domain:[-1,1]}),e.jsx(pt,{contentStyle:{backgroundColor:"#1f2937",border:"none",color:"#fff"},cursor:{fill:"transparent"},formatter:o=>[o.toFixed(3),"Correlation"]}),e.jsx(Bo,{y:0,stroke:"#9ca3af"}),e.jsx(Mt,{dataKey:"corr",fill:"#f59e0b",radius:[2,2,0,0]})]})})})]})]})};var zv=Symbol.for("react.lazy"),ai=Zo[" use ".trim().toString()];function Fv(t){return typeof t=="object"&&t!==null&&"then"in t}function Nm(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===zv&&"_payload"in t&&Fv(t._payload)}function Bv(t){const r=Zv(t),a=f.forwardRef((i,o)=>{let{children:l,...c}=i;Nm(l)&&typeof ai=="function"&&(l=ai(l._payload));const m=f.Children.toArray(l),u=m.find(Hv);if(u){const h=u.props.children,p=m.map(g=>g===u?f.Children.count(h)>1?f.Children.only(null):f.isValidElement(h)?h.props.children:null:g);return e.jsx(r,{...c,ref:o,children:f.isValidElement(h)?f.cloneElement(h,void 0,p):null})}return e.jsx(r,{...c,ref:o,children:l})});return a.displayName=`${t}.Slot`,a}var $v=Bv("Slot");function Zv(t){const r=f.forwardRef((a,i)=>{let{children:o,...l}=a;if(Nm(o)&&typeof ai=="function"&&(o=ai(o._payload)),f.isValidElement(o)){const c=Vv(o),m=Wv(l,o.props);return o.type!==f.Fragment&&(m.ref=i?dl(i,c):c),f.cloneElement(o,m)}return f.Children.count(o)>1?f.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var Uv=Symbol("radix.slottable");function Hv(t){return f.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Uv}function Wv(t,r){const a={...r};for(const i in r){const o=t[i],l=r[i];/^on[A-Z]/.test(i)?o&&l?a[i]=(...m)=>{const u=l(...m);return o(...m),u}:o&&(a[i]=o):i==="style"?a[i]={...o,...l}:i==="className"&&(a[i]=[o,l].filter(Boolean).join(" "))}return{...t,...a}}function Vv(t){var i,o;let r=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,a=r&&"isReactWarning"in r&&r.isReactWarning;return a?t.ref:(r=(o=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:o.get,a=r&&"isReactWarning"in r&&r.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}const xc=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,pc=$o,km=(t,r)=>a=>{var i;if((r==null?void 0:r.variants)==null)return pc(t,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:o,defaultVariants:l}=r,c=Object.keys(o).map(h=>{const p=a==null?void 0:a[h],g=l==null?void 0:l[h];if(p===null)return null;const b=xc(p)||xc(g);return o[h][b]}),m=a&&Object.entries(a).reduce((h,p)=>{let[g,b]=p;return b===void 0||(h[g]=b),h},{}),u=r==null||(i=r.compoundVariants)===null||i===void 0?void 0:i.reduce((h,p)=>{let{class:g,className:b,...y}=p;return Object.entries(y).every(j=>{let[w,N]=j;return Array.isArray(N)?N.includes({...l,...m}[w]):{...l,...m}[w]===N})?[...h,g,b]:h},[]);return pc(t,c,u,a==null?void 0:a.class,a==null?void 0:a.className)},qv=km("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ga=f.forwardRef(({className:t,variant:r,size:a,asChild:i=!1,...o},l)=>{const c=i?$v:"button";return e.jsx(c,{className:qv({variant:r,size:a,className:t}),ref:l,...o})});Ga.displayName="Button";function Cm(...t){return fm($o(t))}const Gv=km("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function hr({className:t,variant:r,...a}){return e.jsx("div",{className:Cm(Gv({variant:r}),t),...a})}const fc=({profile:t,isExpanded:r,onToggleExpand:a,onToggleExclude:i,isExcluded:o,handleAddFilter:l})=>{var b,y,j,w,N,k,S,P,E,T,D,R,_,M,I,O;const c=f.useRef(null);let m=[];t.histogram?m=t.histogram.map(F=>({name:String(F.start),count:F.count})):(b=t.categorical_stats)!=null&&b.top_k&&(m=t.categorical_stats.top_k.slice(0,10).map(F=>({name:F.value,count:F.count}))),m.length===0&&t.dtype==="Numeric"&&t.numeric_stats;const u=async()=>{if(c.current)try{const B=(await Vo(c.current)).toDataURL("image/png"),q=document.createElement("a");q.href=B,q.download=`${t.name}_distribution.png`,document.body.appendChild(q),q.click(),document.body.removeChild(q)}catch(F){console.error("Failed to download chart",F)}},h=F=>{if(t.dtype==="Categorical"||t.dtype==="Boolean"){const B=F.value!==void 0?F.value:F.name;l(t.name,B,"==")}else t.dtype==="Numeric"&&F.rawBin&&l(t.name,F.rawBin.start,">=")},p=F=>{switch(F){case"Numeric":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"Categorical":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300";case"Boolean":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";case"DateTime":return"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-300";case"Text":return"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},g=()=>{var F,B,q,G,ee;return e.jsxs("div",{className:"flex items-center justify-between w-full pr-4",children:[e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground mr-auto",children:[t.numeric_stats?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Mean: ",e.jsx("span",{className:"font-mono text-foreground",children:(F=t.numeric_stats.mean)==null?void 0:F.toFixed(2)})]}),e.jsxs("span",{children:["Std: ",e.jsx("span",{className:"font-mono text-foreground",children:(B=t.numeric_stats.std)==null?void 0:B.toFixed(2)})]}),e.jsxs("span",{children:["Min: ",e.jsx("span",{className:"font-mono text-foreground",children:(q=t.numeric_stats.min)==null?void 0:q.toFixed(2)})]}),e.jsxs("span",{children:["Max: ",e.jsx("span",{className:"font-mono text-foreground",children:(G=t.numeric_stats.max)==null?void 0:G.toFixed(2)})]})]}):t.categorical_stats?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Unique: ",e.jsx("span",{className:"font-mono text-foreground",children:t.categorical_stats.unique_count})]}),((ee=t.categorical_stats.top_k)==null?void 0:ee[0])&&e.jsxs("span",{children:["Top: ",e.jsx("span",{className:"font-mono text-foreground",children:String(t.categorical_stats.top_k[0].value).slice(0,20)})]})]}):null,t.normality_test&&t.normality_test.is_normal&&e.jsx(hr,{variant:"outline",className:"text-[10px] h-4 text-purple-600 border-purple-200 bg-purple-50",children:"Normal Dist"}),t.normality_test&&!t.normality_test.is_normal&&e.jsx(hr,{variant:"outline",className:"text-[10px] h-4 text-amber-600 border-amber-200 bg-amber-50",children:"Not Normal"})]}),m.length>0&&e.jsx("div",{className:"h-8 w-24 hidden sm:block opacity-70",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsx(ps,{data:m,children:e.jsx(Mt,{dataKey:"count",fill:t.dtype==="Numeric"?"#3b82f6":t.dtype==="Categorical"?"#8b5cf6":"#10b981",radius:[1,1,0,0]})})})})]})};return e.jsxs("div",{className:`border rounded-lg mb-2 transition-all ${r?"border-primary/50 shadow-md bg-card/50":"border-border bg-card"}`,children:[e.jsxs("div",{className:"flex items-center p-3 hover:bg-accent/50 cursor-pointer rounded-t-lg",onClick:a,children:[e.jsx("div",{className:"mr-2 text-muted-foreground",children:r?e.jsx(De,{size:18}):e.jsx(Pt,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:t.name}),e.jsx(hr,{variant:"outline",className:`text-[10px] h-5 px-1 ${p(t.dtype)}`,children:t.dtype}),t.is_unique&&e.jsx(hr,{variant:"secondary",className:"text-[10px] h-5",children:"ID"}),t.is_constant&&e.jsx(hr,{variant:"destructive",className:"text-[10px] h-5",children:"Constant"})]}),!r&&g()]}),e.jsxs("div",{className:"flex items-center gap-4 px-2",children:[e.jsxs("div",{className:"flex flex-col items-end w-24",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground",children:t.missing_percentage>0?`${t.missing_percentage.toFixed(1)}% Missing`:"100% Present"}),e.jsx(st,{text:"Green bar indicates the percentage of valid (non-null) data. Full green means no missing values.",align:"end",size:"sm"})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${t.missing_percentage>0?"bg-amber-400":"bg-green-500"}`,style:{width:`${Math.max(100-t.missing_percentage,0)}%`}})})]}),e.jsx("div",{className:"h-8 w-[1px] bg-border mx-2"}),e.jsx(Ga,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground",onClick:F=>{F.stopPropagation(),i(t.name,!o)},children:o?e.jsx(tn,{size:16}):e.jsx(Ho,{size:16})})]})]}),r&&e.jsx("div",{className:"p-4 border-t border-border bg-card/30 animate-in slide-in-from-top-2 duration-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Statistics"}),e.jsxs("div",{className:"bg-background rounded-md border p-3 text-sm space-y-2 font-mono",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Missing"}),e.jsxs("span",{children:[t.missing_count," (",t.missing_percentage.toFixed(2),"%)"]})]}),t.numeric_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mean"}),e.jsx("span",{children:(y=t.numeric_stats.mean)==null?void 0:y.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Std Dev"}),e.jsx("span",{children:(j=t.numeric_stats.std)==null?void 0:j.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Variance"}),e.jsx("span",{children:((w=t.numeric_stats.variance)==null?void 0:w.toFixed(4))||Math.pow(t.numeric_stats.std||0,2).toFixed(4)})]}),e.jsx("div",{className:"my-2 border-t border-dashed"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Min"}),e.jsx("span",{children:(N=t.numeric_stats.min)==null?void 0:N.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"25% (Q1)"}),e.jsx("span",{children:(k=t.numeric_stats.q25)==null?void 0:k.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Median"}),e.jsx("span",{children:(S=t.numeric_stats.median)==null?void 0:S.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"75% (Q3)"}),e.jsx("span",{children:(P=t.numeric_stats.q75)==null?void 0:P.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Max"}),e.jsx("span",{children:(E=t.numeric_stats.max)==null?void 0:E.toFixed(4)})]}),e.jsx("div",{className:"my-2 border-t border-dashed"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Skewness"}),e.jsx("span",{children:(T=t.numeric_stats.skewness)==null?void 0:T.toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Kurtosis"}),e.jsx("span",{children:(D=t.numeric_stats.kurtosis)==null?void 0:D.toFixed(4)})]})]}),t.text_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Length"}),e.jsxs("span",{children:[(R=t.text_stats.avg_length)==null?void 0:R.toFixed(1)," chars"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Min Length"}),e.jsx("span",{children:t.text_stats.min_length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Max Length"}),e.jsx("span",{children:t.text_stats.max_length})]}),t.text_stats.sentiment_distribution&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-t border-dashed"}),e.jsx("div",{className:"text-xs font-semibold mb-1",children:"Sentiment"}),e.jsxs("div",{className:"flex h-3 rounded-full overflow-hidden w-full bg-secondary",children:[e.jsx("div",{className:"bg-green-500 h-full",style:{width:`${(t.text_stats.sentiment_distribution.positive||0)*100}%`},title:`Positive: ${((t.text_stats.sentiment_distribution.positive||0)*100).toFixed(1)}%`}),e.jsx("div",{className:"bg-gray-400 h-full",style:{width:`${(t.text_stats.sentiment_distribution.neutral||0)*100}%`},title:`Neutral: ${((t.text_stats.sentiment_distribution.neutral||0)*100).toFixed(1)}%`}),e.jsx("div",{className:"bg-red-500 h-full",style:{width:`${(t.text_stats.sentiment_distribution.negative||0)*100}%`},title:`Negative: ${((t.text_stats.sentiment_distribution.negative||0)*100).toFixed(1)}%`})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground mt-1 px-1",children:[e.jsxs("span",{children:["Pos: ",((t.text_stats.sentiment_distribution.positive||0)*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Neu: ",((t.text_stats.sentiment_distribution.neutral||0)*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Neg: ",((t.text_stats.sentiment_distribution.negative||0)*100).toFixed(0),"%"]})]})]}),t.text_stats.common_words&&t.text_stats.common_words.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-t border-dashed"}),e.jsx("div",{className:"text-xs font-semibold mb-1",children:"Common Words"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.text_stats.common_words.slice(0,10).map((F,B)=>e.jsxs(hr,{variant:"secondary",className:"text-[10px] h-4",children:[F.word||F.value," (",F.count,")"]},B))})]})]}),t.categorical_stats&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Unique"}),e.jsx("span",{children:t.categorical_stats.unique_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mode"}),e.jsx("span",{className:"truncate max-w-[100px]",title:String((M=(_=t.categorical_stats.top_k)==null?void 0:_[0])==null?void 0:M.value),children:String(((O=(I=t.categorical_stats.top_k)==null?void 0:I[0])==null?void 0:O.value)||"-")})]}),t.categorical_stats.top_k&&t.categorical_stats.top_k.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-t border-dashed"}),e.jsx("div",{className:"text-xs font-semibold mb-1",children:"Top Categories"}),e.jsx("div",{className:"space-y-1",children:t.categorical_stats.top_k.slice(0,5).map((F,B)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"truncate max-w-[120px]",title:String(F.value),children:String(F.value)}),e.jsx("span",{className:"text-muted-foreground",children:F.count})]},B))})]})]})]})]}),e.jsxs("div",{className:"md:col-span-2 flex flex-col h-full min-h-[300px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Distribution"}),e.jsx(Ga,{size:"icon",variant:"outline",className:"h-8 w-8",title:"Download Chart",onClick:u,children:e.jsx(Xe,{size:16})})]}),e.jsx("div",{className:"flex-1 bg-background rounded-md border p-4",ref:c,children:e.jsx(gm,{profile:t,onBarClick:h})})]})]})})]})},Sm=f.forwardRef(({className:t,type:r,...a},i)=>e.jsx("input",{type:r,className:Cm("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:i,...a}));Sm.displayName="Input";const Kv=({profile:t,handleToggleExclude:r,handleAddFilter:a})=>{const[i,o]=f.useState(""),[l,c]=f.useState(new Set),m=g=>{const b=new Set(l);b.has(g)?b.delete(g):b.add(g),c(b)},u=()=>{c(new Set(Object.keys(t.columns)))},h=()=>{c(new Set)},p=Object.values(t.columns).filter(g=>g.name.toLowerCase().includes(i.toLowerCase()));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 bg-card p-2 rounded-lg border",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(ts,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Sm,{placeholder:"Search variables...",className:"pl-8 h-9",value:i,onChange:g=>o(g.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ga,{variant:"outline",size:"sm",onClick:u,className:"h-9 text-xs",children:"Expand All"}),e.jsx(Ga,{variant:"outline",size:"sm",onClick:h,className:"h-9 text-xs",children:"Collapse All"})]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground px-2",children:["Showing ",p.length," of ",Object.keys(t.columns).length," variables"]})]}),e.jsxs("div",{className:"space-y-2",children:[p.map(g=>e.jsx(fc,{profile:g,isExpanded:l.has(g.name),onToggleExpand:()=>m(g.name),onToggleExclude:r,isExcluded:!1,handleAddFilter:a},g.name)),t.excluded_columns&&t.excluded_columns.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2 text-muted-foreground",children:["Excluded Variables ",e.jsx(hr,{variant:"secondary",children:t.excluded_columns.length})]}),t.excluded_columns.map(g=>e.jsx(fc,{profile:{name:g,dtype:"Excluded",missing_percentage:0},isExpanded:l.has(g),onToggleExpand:()=>m(g),onToggleExclude:r,isExcluded:!0,handleAddFilter:a},g))]})]})]})},Jv=({profile:t,downloadChart:r,scatterX:a,setScatterX:i,scatterY:o,setScatterY:l,scatterZ:c,setScatterZ:m,scatterColor:u,setScatterColor:h,is3D:p,setIs3D:g})=>e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(li,{className:"w-5 h-5 mr-2 text-blue-500"}),"Bivariate Analysis (Scatter Plot)",e.jsx(st,{text:"Visualize the relationship between two numeric variables."})]}),e.jsx("button",{onClick:()=>r("bivariate-chart","bivariate-analysis","Bivariate Analysis",`${a} vs ${o}`),className:"p-2 rounded-md border bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300",title:"Download Chart",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-4 mb-6 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"X Axis"}),e.jsxs("select",{value:a,onChange:b=>i(b.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"Select Variable"}),Object.values(t.columns).filter(b=>b.dtype==="Numeric").map(b=>e.jsx("option",{value:b.name,children:b.name},b.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Y Axis"}),e.jsxs("select",{value:o,onChange:b=>l(b.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"Select Variable"}),Object.values(t.columns).filter(b=>b.dtype==="Numeric").map(b=>e.jsx("option",{value:b.name,children:b.name},b.name))]})]}),p&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Z Axis"}),e.jsxs("select",{value:c,onChange:b=>m(b.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"Select Variable"}),Object.values(t.columns).filter(b=>b.dtype==="Numeric").map(b=>e.jsx("option",{value:b.name,children:b.name},b.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Color By"}),e.jsxs("select",{value:u,onChange:b=>h(b.target.value),className:"block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"None"}),Object.values(t.columns).map(b=>e.jsx("option",{value:b.name,children:b.name},b.name))]})]}),e.jsx("button",{onClick:()=>g(!p),className:`p-2 rounded-md border transition-colors ${p?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"}`,title:"Toggle 3D View",children:e.jsx(na,{className:"w-5 h-5"})})]}),e.jsx("div",{id:"bivariate-chart",children:a&&o?p&&c?e.jsx(bm,{data:t.sample_data,xKey:a,yKey:o,zKey:c,labelKey:u||void 0,xLabel:a,yLabel:o,zLabel:c}):e.jsx(ym,{data:t.sample_data,xKey:a,yKey:o,labelKey:u||void 0,xLabel:a,yLabel:o}):e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 dark:bg-gray-900 rounded text-gray-400 text-sm",children:"Select X and Y variables to generate scatter plot."})})]}),Qv=({profile:t})=>e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Jt,{className:"w-5 h-5 mr-2 text-red-500"}),"Outlier Analysis (",t.outliers.method,")",e.jsx(st,{text:"Detects anomalous rows using Isolation Forest. Lower scores indicate higher anomaly."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400 block mb-1",children:"Total Outliers"}),e.jsx("span",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:t.outliers.total_outliers})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400 block mb-1",children:"Percentage"}),e.jsxs("span",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:[t.outliers.outlier_percentage.toFixed(2),"%"]})]})]}),e.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white mb-3",children:"Top Anomalous Rows"}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Row Index"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Anomaly Score"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Why is this an outlier?"}),t.outliers.top_outliers[0]&&Object.keys(t.outliers.top_outliers[0].values).slice(0,5).map(r=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:r},r))]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.outliers.top_outliers.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-gray-500",children:r.index}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-red-600",children:r.score.toFixed(4)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.explanation?e.jsx("div",{className:"space-y-1",children:r.explanation.map((a,i)=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:[a.feature,":"]})," ",e.jsx("span",{className:"text-red-600 dark:text-red-400",children:a.value.toFixed(2)})," ",e.jsxs("span",{className:"text-gray-400",children:["(Median: ",a.median.toFixed(2),", Diff: ",a.diff_pct.toFixed(0),"%)"]})]},i))}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No explanation available"})}),Object.entries(r.values).slice(0,5).map(([a,i])=>e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-300",children:typeof i=="number"?i.toFixed(2):String(i)},a))]},r.index))})]})})]}),gc=({data:t})=>{if(!t||!t.columns)return e.jsx("div",{children:"No correlation data available"});const r=20,a=t.columns.slice(0,r),i=t.values.slice(0,r).map(c=>c.slice(0,r)),o=t.columns.length>r,l=c=>{if(c===null)return"rgba(243, 244, 246, 1)";const m=Math.max(.4,Math.abs(c));return c>0?`rgba(239, 68, 68, ${m})`:`rgba(59, 130, 246, ${m})`};return e.jsxs("div",{className:"overflow-x-auto p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[o&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 text-sm rounded-md",children:["Showing top ",r," columns. Full heatmap is too large to render."]}),e.jsx("div",{className:"inline-block min-w-full",children:e.jsxs("div",{className:"grid gap-1",style:{gridTemplateColumns:`100px repeat(${a.length}, minmax(50px, 1fr))`},children:[e.jsx("div",{className:"p-2"}),a.map((c,m)=>e.jsx("div",{className:"p-2 text-xs font-medium truncate text-center",title:c,children:c.length>8?c.substring(0,8)+"...":c},m)),a.map((c,m)=>e.jsxs(ft.Fragment,{children:[e.jsx("div",{className:"p-2 text-xs font-medium truncate text-right pr-4",title:c,children:c}),i[m].map((u,h)=>e.jsx("div",{className:"h-10 w-full flex items-center justify-center text-[10px] text-gray-900 dark:text-gray-100 rounded-sm cursor-help transition-opacity hover:opacity-80",style:{backgroundColor:l(u)},title:`${c} vs ${a[h]}: ${u!==null?u.toFixed(3):"N/A"}`,children:u!==null?u.toFixed(2):""},h))]},m))]})})]})},Yv=({profile:t})=>{const r=(a,i,o)=>{if(!a)return;const l=20,c=a.columns.slice(0,l),m=a.values.slice(0,l).map(P=>P.slice(0,l)),u=60,h=document.createElement("canvas"),p=h.getContext("2d");if(!p)return;p.font="12px sans-serif";let g=0;c.forEach(P=>{const E=p.measureText(P).width;E>g&&(g=E)});const b=g+40,y=g*.7+60,j=60,w=b+c.length*u+50,N=y+c.length*u+j+50;h.width=w,h.height=N,p.fillStyle="#ffffff",p.fillRect(0,0,w,N),p.fillStyle="#111827",p.font="bold 24px sans-serif",p.textAlign="center",p.fillText(i,w/2,40);const k=P=>{if(P===null)return"#f3f4f6";const E=Math.max(.2,Math.abs(P));return P>0?`rgba(239, 68, 68, ${E})`:`rgba(59, 130, 246, ${E})`};p.font="12px sans-serif",p.textBaseline="middle",m.forEach((P,E)=>{p.fillStyle="#374151",p.textAlign="right",p.fillText(c[E],b-10,y+j+E*u+u/2),P.forEach((T,D)=>{const R=b+D*u,_=y+j+E*u;p.fillStyle=k(T),p.fillRect(R,_,u-2,u-2),T!==null&&(p.fillStyle=Math.abs(T)>.5?"#ffffff":"#000000",p.textAlign="center",p.fillText(T.toFixed(2),R+u/2,_+u/2))})}),p.save(),c.forEach((P,E)=>{const T=b+E*u+u/2,D=y+j-10;p.translate(T,D),p.rotate(-Math.PI/4),p.fillStyle="#374151",p.textAlign="left",p.fillText(P,0,0),p.rotate(Math.PI/4),p.translate(-T,-D)}),p.restore();const S=document.createElement("a");S.download=o,S.href=h.toDataURL("image/png"),S.click()};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(gs,{className:"w-5 h-5 mr-2 text-blue-500"}),"Feature Correlations (Multicollinearity)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{text:"Correlation between features only. Use this to detect redundant variables (multicollinearity)."}),e.jsx("button",{onClick:()=>r(t.correlations,"Feature Correlations","feature-correlations.png"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Matrix",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),e.jsx(gc,{data:t.correlations})]}),t.correlations_with_target&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(gs,{className:"w-5 h-5 mr-2 text-green-500"}),"Target Correlations (Feature Selection)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{text:"Correlation including the target variable. Use this to identify the most predictive features."}),e.jsx("button",{onClick:()=>r(t.correlations_with_target,"Target Correlations","target-correlations.png"),className:"p-1.5 rounded-md bg-white border border-gray-200 text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 shadow-sm",title:"Download Matrix",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),e.jsx(gc,{data:t.correlations_with_target})]})]})},Xv=({profile:t,excludedCols:r,handleToggleExclude:a})=>{const i=Object.keys(t.sample_data[0]||{}).filter(o=>!r.includes(o)&&!o.endsWith("_encoded"));return e.jsxs("div",{className:"mt-4 overflow-x-auto bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsx("tr",{children:i.map(o=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider group",children:e.jsxs("div",{className:"flex items-center gap-2",children:[o,e.jsx("button",{onClick:l=>{l.stopPropagation(),a(o,!0)},className:"p-1 rounded transition-colors opacity-0 group-hover:opacity-100 hover:bg-red-100 text-gray-400 hover:text-red-500 dark:hover:bg-red-900/30",title:"Exclude from analysis",children:e.jsx(tn,{className:"w-3 h-3"})})]})},o))})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.sample_data.slice(0,50).map((o,l)=>e.jsx("tr",{children:i.map((c,m)=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:o[c]!==null?String(o[c]):e.jsx("span",{className:"italic text-gray-400",children:"null"})},m))},l))})]}),t.sample_data.length>50&&e.jsxs("div",{className:"p-4 text-center text-sm text-gray-500 border-t border-gray-200 dark:border-gray-700",children:["Showing first 50 rows of ",t.sample_data.length," sample rows."]})]})},io=150,bc=40,ej=({graph:t})=>{const[r,a,i]=Jc([]),[o,l,c]=Qc([]),m=f.useCallback((u,h)=>{try{const p=new Wn.graphlib.Graph;return p.setDefaultEdgeLabel(()=>({})),p.setGraph({rankdir:"LR",nodesep:80,ranksep:200}),u.forEach(b=>{p.setNode(b.id,{width:io,height:bc})}),h.forEach(b=>{p.setEdge(b.source,b.target)}),Wn.layout(p),{nodes:u.map(b=>{const y=p.node(b.id);return y?{...b,targetPosition:ar.Left,sourcePosition:ar.Right,position:{x:y.x-io/2,y:y.y-bc/2}}:{...b,position:{x:Math.random()*500,y:Math.random()*500}}}),edges:h}}catch(p){return console.error("Dagre layout failed:",p),{nodes:u.map((b,y)=>({...b,position:{x:y%3*250,y:Math.floor(y/3)*100}})),edges:h}}},[]);return f.useEffect(()=>{if(!t||!t.nodes||t.nodes.length===0)return;const u=b=>b.replace(/[^a-zA-Z0-9-_]/g,"_"),h=t.nodes.map(b=>({id:u(b.id),data:{label:b.label},position:{x:0,y:0},className:"dark:bg-gray-800 dark:text-white dark:border-gray-600 bg-white text-gray-900 border-gray-300",style:{borderRadius:"5px",padding:"10px",width:io,textAlign:"center",borderWidth:"1px",borderStyle:"solid"}})),p=t.edges.map((b,y)=>({id:`e${y}`,source:u(b.source),target:u(b.target),animated:!0,type:"default",label:b.type==="directed"?"causes":b.type==="bidirected"?"confounded":"related",style:{stroke:b.type==="directed"?"#333":"#999",strokeDasharray:b.type==="directed"?"0":"5 5"},markerEnd:b.type==="directed"?{type:Gn.ArrowClosed}:void 0,markerStart:b.type==="bidirected"?{type:Gn.ArrowClosed}:void 0})),g=m(h,p);a(g.nodes),l(g.edges)},[t,m,a,l]),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{style:{width:"100%",height:"500px"},className:"border rounded-lg bg-gray-50 dark:bg-gray-900 relative",children:e.jsxs(Jo,{nodes:r,edges:o,onNodesChange:i,onEdgesChange:c,fitView:!0,className:"dark:bg-gray-900",children:[e.jsx(Qo,{className:"dark:bg-gray-900"}),e.jsx(Yo,{className:"dark:bg-gray-800 dark:text-white dark:border-gray-700"})]})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic flex items-center gap-1",children:[e.jsx(gt,{className:"w-3 h-3"}),"To ensure fast performance, this graph displays the ",e.jsx("strong",{children:"Target"})," and the top ",e.jsx("strong",{children:"14 features"})," most correlated with it."]})]})},tj=({profile:t})=>{const r=t.causal_graph;return r?e.jsx("div",{className:"space-y-6 mt-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ia,{className:"w-5 h-5 mr-2 text-purple-500"}),"Causal Discovery (PC Algorithm)",e.jsx(st,{text:"Inferred causal structure using the Peter-Clark algorithm. Arrows (A->B) suggest A causes B. Lines (A-B) suggest correlation without clear direction. Bidirected arrows (A<->B) suggest a hidden common cause."})]}),e.jsxs("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded border border-yellow-200 dark:border-yellow-800",children:[e.jsx("strong",{children:"Disclaimer:"})," This graph is inferred purely from observational data. Correlation does not imply causation. Use this as a hypothesis generation tool, not absolute truth."]}),e.jsx(ej,{graph:r})]})}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(ia,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No causal graph available. This might be because there are fewer than 2 numeric columns or the analysis failed."})]})},yc=220,vc=100,sj=({data:t})=>{const r=t.is_leaf,a=t.value.reduce((l,c)=>l+c,0),i=Math.max(...t.value),o=a>0?i/a*100:0;return e.jsxs("div",{className:`px-4 py-3 shadow-md rounded-md border-2 ${r?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-blue-500 bg-white dark:bg-gray-800"} min-w-[200px]`,children:[e.jsx(qn,{type:"target",position:ar.Left,className:"w-3 h-3 !bg-gray-400"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"font-bold text-sm text-gray-900 dark:text-white border-b pb-1 mb-1",children:r?e.jsxs("span",{className:"flex items-center gap-2 text-green-700 dark:text-green-400",children:[e.jsx(rt,{className:"w-4 h-4"}),"Prediction: ",t.class_name]}):e.jsxs("span",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-400",children:[e.jsx(Cx,{className:"w-4 h-4"}),t.feature," ",t.threshold!==void 0?`<= ${t.threshold.toFixed(2)}`:""]})}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs(vl,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(ti,{children:[e.jsx(si,{asChild:!0,children:e.jsx("span",{className:"cursor-help border-b border-dotted border-gray-400",children:"Samples:"})}),e.jsx(qa,{children:e.jsx("p",{children:"The number of data points that fall into this rule bucket."})})]}),e.jsx("span",{className:"font-mono",children:t.samples})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(ti,{children:[e.jsx(si,{asChild:!0,children:e.jsx("span",{className:"cursor-help border-b border-dotted border-gray-400",children:"Purity:"})}),e.jsx(qa,{children:e.jsx("p",{className:"max-w-xs",children:"The percentage of samples in this node that belong to the majority class. Higher purity means a clearer separation."})})]}),e.jsxs("span",{className:`font-mono ${o>80?"text-green-600 font-bold":""}`,children:[o.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 rounded-full mt-1 overflow-hidden flex",children:t.value.map((l,c)=>e.jsx("div",{style:{width:`${l/a*100}%`,backgroundColor:`hsl(${c*137.5}, 70%, 50%)`},title:`Class ${c}: ${l}`},c))})]})]}),e.jsx(qn,{type:"source",position:ar.Right,className:"w-3 h-3 !bg-gray-400"})]})},rj={decision:sj},aj=({tree:t})=>{const[r,a,i]=Jc([]),[o,l,c]=Qc([]),m=f.useCallback((u,h)=>{try{const p=new Wn.graphlib.Graph;return p.setDefaultEdgeLabel(()=>({})),p.setGraph({rankdir:"LR",nodesep:50,ranksep:150}),u.forEach(b=>{p.setNode(b.id,{width:yc,height:vc})}),h.forEach(b=>{p.setEdge(b.source,b.target)}),Wn.layout(p),{nodes:u.map(b=>{const y=p.node(b.id);return{...b,targetPosition:ar.Left,sourcePosition:ar.Right,position:{x:y?y.x-yc/2:0,y:y?y.y-vc/2:0}}}),edges:h}}catch(p){return console.error("Dagre layout failed:",p),{nodes:u,edges:h}}},[]);return f.useEffect(()=>{if(!t||!t.nodes||t.nodes.length===0)return;const u=t.nodes.map(g=>({id:g.id.toString(),type:"decision",data:{...g},position:{x:0,y:0}})),h=[];t.nodes.forEach(g=>{g.children&&g.children.length>0&&(g.children[0]!==void 0&&h.push({id:`e${g.id}-${g.children[0]}`,source:g.id.toString(),target:g.children[0].toString(),label:"True",type:"smoothstep",style:{stroke:"#22c55e",strokeWidth:2},labelStyle:{fill:"#22c55e",fontWeight:700},markerEnd:{type:Gn.ArrowClosed,color:"#22c55e"}}),g.children[1]!==void 0&&h.push({id:`e${g.id}-${g.children[1]}`,source:g.id.toString(),target:g.children[1].toString(),label:"False",type:"smoothstep",style:{stroke:"#ef4444",strokeWidth:2},labelStyle:{fill:"#ef4444",fontWeight:700},markerEnd:{type:Gn.ArrowClosed,color:"#ef4444"}}))});const p=m(u,h);a(p.nodes),l(p.edges)},[t,m,a,l]),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{style:{width:"100%",height:"600px"},className:"border rounded-lg bg-gray-50 dark:bg-gray-900 relative",children:e.jsxs(Jo,{nodes:r,edges:o,onNodesChange:i,onEdgesChange:c,nodeTypes:rj,fitView:!0,className:"dark:bg-gray-900",children:[e.jsx(Qo,{className:"dark:bg-gray-900",gap:16,size:1}),e.jsx(Yo,{className:"dark:bg-gray-800 dark:text-white dark:border-gray-700"})]})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic flex items-center gap-1",children:[e.jsx(gt,{className:"w-3 h-3"}),"This tree is a ",e.jsx("strong",{children:"surrogate (explanatory) model"})," trained on your data to surface readable rules. Do not treat it as a production-grade predictor. Green paths mean the condition is met (True); red paths mean it is not (False)."]})]})},nj=({profile:t})=>{const r=t==null?void 0:t.rule_tree;return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Fa,{className:"w-5 h-5 text-blue-600"}),"Decision Tree Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["This is a ",e.jsx("strong",{children:"surrogate model"}),": a simple decision tree trained on your dataset to approximate the relationship between features and the target. Use it for interpretation (human-readable rules), not as a causal claim or a production model."]})]}),r.accuracy&&e.jsx(vl,{children:e.jsxs(ti,{children:[e.jsx(si,{asChild:!0,children:e.jsxs("div",{className:"text-sm bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full border border-blue-200 dark:border-blue-800 cursor-help",children:["Tree Fidelity: ",e.jsxs("strong",{children:[(r.accuracy*100).toFixed(1),"%"]})]})}),e.jsx(qa,{children:e.jsxs("p",{className:"max-w-xs",children:[e.jsx("strong",{children:"Tree Fidelity:"})," How closely this surrogate tree matches the patterns in your data (higher is better). If fidelity is low, treat extracted rules as exploratory."]})})]})})]}),e.jsx(aj,{tree:r})]}),r.feature_importances&&r.feature_importances.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(di,{className:"w-5 h-5 text-blue-600"}),"Feature Importance (Surrogate Model)"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Importances reflect what the ",e.jsx("strong",{children:"surrogate tree"})," used to split the data. They may differ from a more complex models importances."]}),e.jsx("div",{className:"h-80 w-full",children:e.jsx(ht,{width:"100%",height:"100%",children:e.jsxs(ps,{data:r.feature_importances.slice(0,10),layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(Ct,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#e5e7eb"}),e.jsx(St,{type:"number",domain:[0,"auto"],hide:!0}),e.jsx(Tt,{dataKey:"feature",type:"category",width:150,tick:{fontSize:12,fill:"#6b7280"},interval:0}),e.jsx(pt,{formatter:a=>[(a*100).toFixed(1)+"%","Importance"],contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:"8px",border:"1px solid #e5e7eb",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},cursor:{fill:"transparent"}}),e.jsx(Mt,{dataKey:"importance",radius:[0,4,4,0],barSize:20,children:r.feature_importances.slice(0,10).map((a,i)=>e.jsx(ni,{fill:`hsl(217, 91%, ${60-i*3}%)`},`cell-${i}`))})]})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:"Showing top 10 features driving the decision rules."})]}),r.rules&&r.rules.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-900 dark:text-white mb-4",children:"Segmentation-Decision Tree (Surrogate Model)"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:r.rules.map((a,i)=>e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded border border-gray-100 dark:border-gray-700 text-sm font-mono text-gray-700 dark:text-gray-300",children:a},i))})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-8",children:[e.jsx(Fa,{className:"w-12 h-12 mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Decision Tree Not Available"}),e.jsx("p",{className:"text-center max-w-md mb-4",children:"No tree was generated. This usually happens if the dataset is too small, or if a target column was not selected for analysis."}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600 bg-amber-50 dark:bg-amber-900/20 dark:text-amber-400 px-4 py-2 rounded-md",children:[e.jsx(xt,{className:"w-4 h-4"}),e.jsxs("span",{children:["Ensure you have selected a ",e.jsx("strong",{children:"Target Column"})," and re-run the analysis."]})]})]})},zn={},ij=({datasetId:t,measureCol:r,measureAgg:a,columns:i,initialFilters:o})=>{const[l,c]=f.useState([]),[m,u]=f.useState(!1),[h,p]=f.useState(null),[g,b]=f.useState([null]),y=f.useRef(null),j=f.useRef(null),[w,N]=f.useState([]);f.useEffect(()=>{y.current&&y.current.scrollTo({left:y.current.scrollWidth,behavior:"smooth"})},[l.length]);const k=()=>{if(!j.current)return;const R=[],_=j.current.getBoundingClientRect();l.forEach((M,I)=>{if(I>=l.length-1)return;const O=M.selectedItemName;if(!O)return;const F=`node-${I}-${O}`,B=document.getElementById(F);if(B){const q=B.getBoundingClientRect(),G=q.right-_.left,ee=q.top+q.height/2-_.top;let te,W;const me=l[I+1];if(me.selectedItemName){const se=`node-${I+1}-${me.selectedItemName}`,ie=document.getElementById(se);if(ie){const ge=ie.getBoundingClientRect();te=ge.left-_.left,W=ge.top+ge.height/2-_.top}else return}else{const se=`list-${I+1}`,ie=document.getElementById(se);if(ie){const ge=ie.getBoundingClientRect();te=ge.left-_.left,W=ge.top+ge.height/2-_.top}else return}if(te!==void 0&&W!==void 0){const se=(G+te)/2,ie=`M ${G} ${ee} C ${se} ${ee}, ${se} ${W}, ${te} ${W}`;R.push({d:ie})}}}),N(R)};ft.useLayoutEffect(()=>{k()},[l,h]),f.useEffect(()=>{if(l.length>0){const R=`${t}-${r}-${a}`;zn[R]={levels:l,splitPath:g}}},[l,g,t,r,a]),f.useEffect(()=>{const R=`${t}-${r}-${a}`;zn[R]?(c(zn[R].levels),b(zn[R].splitPath)):S()},[t,r,a]);const S=async()=>{u(!0);try{const _={id:"root",splitColumn:null,items:await Es.getDecomposition(t,r==="count"?null:r,a,"",o),selectedItemName:null,filters:o};c([_]),b([null])}catch(R){console.error(R)}finally{u(!1)}},P=(R,_)=>{var B,q,G,ee,te;const M=l[R];if(!M.selectedItemName)return;const I=M.items.find(W=>W.name===M.selectedItemName);if(!I)return;const O=_.currentTarget.getBoundingClientRect(),F=(B=y.current)==null?void 0:B.getBoundingClientRect();if(F){let W=O.right-F.left+10,me=O.top-F.top;const se=((G=(q=y.current)==null?void 0:q.parentElement)==null?void 0:G.clientWidth)||window.innerWidth;W+260>se&&(W=O.left-F.left-270);const ie=((te=(ee=y.current)==null?void 0:ee.parentElement)==null?void 0:te.clientHeight)||window.innerHeight;me+300>ie&&(me=ie-310),p({levelIndex:R,item:I,x:W,y:me})}},E=async(R,_)=>{const M=[...l];M[R].selectedItemName=_.name;const I=g[R+1];if(I){u(!0);try{const O=M[R],F=[...O.filters];O.splitColumn&&F.push({column:O.splitColumn,operator:"==",value:_.name});const B=await Es.getDecomposition(t,r==="count"?null:r,a,I,F),q={id:`level-${R+1}`,splitColumn:I,items:B,selectedItemName:null,filters:F},G=[...M.slice(0,R+1),q];c(G),b(g.slice(0,R+2))}catch(O){console.error(O)}finally{u(!1)}}else c(M)},T=async R=>{if(!h)return;const{levelIndex:_,item:M}=h;p(null),u(!0);try{const I=l[_],O=[...I.filters];I.splitColumn&&O.push({column:I.splitColumn,operator:"==",value:M.name});const F=await Es.getDecomposition(t,r==="count"?null:r,a,R,O),B={id:`level-${_+1}`,splitColumn:R,items:F,selectedItemName:null,filters:O},q=[...l.slice(0,_+1),B];c(q);const G=[...g.slice(0,_+1),R];b(G)}catch(I){console.error(I)}finally{u(!1)}},D=R=>{c(l.slice(0,R)),b(g.slice(0,R))};return e.jsxs("div",{className:"relative w-full h-[600px] bg-slate-50 dark:bg-slate-900 overflow-hidden flex flex-col",children:[m&&e.jsx("div",{className:"absolute top-2 right-2 z-50",children:e.jsx(Ye,{className:"w-5 h-5 animate-spin text-blue-500"})}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden",ref:y,children:e.jsxs("div",{className:"flex h-full p-8 min-w-max gap-12 relative",ref:j,children:[l.map((R,_)=>e.jsxs("div",{className:"flex flex-col w-[200px] h-full relative z-10",children:[e.jsxs("div",{id:`header-${_}`,className:"flex items-center justify-between mb-4 bg-white dark:bg-slate-800 p-2 rounded shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("span",{className:"font-semibold text-sm text-slate-700 dark:text-slate-200",children:R.splitColumn||"Total"}),e.jsxs("div",{className:"flex items-center gap-1",children:[_===l.length-1&&e.jsx("button",{onClick:M=>P(_,M),className:`
                                                p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors
                                                ${R.selectedItemName?"text-blue-500":"text-slate-300 cursor-not-allowed"}
                                            `,title:R.selectedItemName?"Split further":"Select an item to split",disabled:!R.selectedItemName,children:e.jsx(Yt,{className:"w-4 h-4"})}),_>0&&e.jsx("button",{onClick:()=>D(_),className:"text-slate-400 hover:text-red-500",children:e.jsx(et,{className:"w-4 h-4"})})]})]}),e.jsx("div",{id:`list-${_}`,className:"flex-1 overflow-y-auto pr-2 space-y-2 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-slate-600",onScroll:k,children:R.items.map(M=>{const I=R.selectedItemName===M.name,O=Math.max(...R.items.map(B=>B.value)),F=M.value/O*100;return e.jsxs("div",{id:`node-${_}-${M.name}`,onClick:()=>E(_,M),className:`
                                                relative p-3 rounded-md border cursor-pointer transition-all group
                                                ${I?"bg-blue-50 border-blue-500 dark:bg-blue-900/20 dark:border-blue-500 shadow-md":"bg-white border-slate-200 dark:bg-slate-800 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700"}
                                            `,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 relative z-10 gap-2",children:[e.jsx("span",{className:"font-medium text-sm truncate flex-1 min-w-0",title:M.name,children:M.name}),e.jsxs("span",{className:"text-xs font-mono text-slate-500 dark:text-slate-400 whitespace-nowrap",children:[M.value.toLocaleString()," (",Math.round(M.ratio*100),"%)"]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-blue-500/20 transition-all duration-500",style:{width:`${F}%`}})]},M.name)})})]},_)),e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none z-0",children:w.map((R,_)=>e.jsx("path",{d:R.d,fill:"none",stroke:"#3b82f6",strokeWidth:"2",strokeOpacity:"0.5"},_))})]})}),h&&e.jsxs("div",{className:"absolute z-50 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 w-64 max-h-80 overflow-y-auto flex flex-col",style:{left:h.x,top:h.y},children:[e.jsx("div",{className:"p-3 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 sticky top-0",children:e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Split by"})}),e.jsx("div",{className:"p-1",children:i.map(R=>e.jsx("button",{onClick:()=>T(R),className:"w-full text-left px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-md transition-colors",children:R},R))})]}),h&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>p(null)})]})},oj=({datasetId:t,columns:r,initialFilters:a=[]})=>{const[i,o]=f.useState("count"),[l,c]=f.useState("count"),[m,u]=f.useState(0),h=()=>{u(p=>p+1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 flex gap-4 items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Analyze"}),e.jsxs("select",{value:i,onChange:p=>o(p.target.value),className:"block w-[180px] rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border dark:bg-slate-700 dark:border-slate-600 dark:text-white",children:[e.jsx("option",{value:"count",children:"Row Count"}),r.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),i!=="count"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Aggregation"}),e.jsxs("select",{value:l,onChange:p=>c(p.target.value),className:"block w-[120px] rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border dark:bg-slate-700 dark:border-slate-600 dark:text-white",children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"mean",children:"Average"}),e.jsx("option",{value:"min",children:"Min"}),e.jsx("option",{value:"max",children:"Max"})]})]}),e.jsx("button",{onClick:h,className:"p-2 border rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-slate-600 dark:text-slate-300",title:"Reset Tree",children:e.jsx(_t,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsx(ij,{datasetId:t,measureCol:i,measureAgg:l,columns:r,initialFilters:a},m)})]})},Da=async(t,r,a,i,o)=>{const l=document.getElementById(t);if(!l)return;const c=document.documentElement.classList.contains("dark"),m=c?"#1f2937":"#ffffff",u=c?"#f3f4f6":"#111827",h=c?"#9ca3af":"#4b5563",p=(b,y)=>{let j=0;return a&&(b.fillStyle=u,b.font="bold 16px sans-serif",b.textAlign="center",b.fillText(a,y/2,30),j=40),i&&(b.fillStyle=h,b.font="12px sans-serif",b.textAlign="center",b.fillText(i,y/2,50),j=60),o&&(b.fillStyle=u,b.font="10px monospace",b.textAlign="right",o.split(`
`).forEach((N,k)=>{b.fillText(N,y-10,20+k*12)})),j||20},g=l.querySelector(".js-plotly-plot");if(g){try{const b=await Yx.toImage(g,{format:"png",width:1200,height:800}),y=document.createElement("canvas"),j=y.getContext("2d"),w=new Image,N=1200,k=800,S=a?i?80:50:0;w.onload=()=>{if(y.width=N,y.height=k+S,j){j.fillStyle=m,j.fillRect(0,0,y.width,y.height),a&&(j.fillStyle=u,j.font="bold 24px sans-serif",j.textAlign="center",j.fillText(a,N/2,40),i&&(j.fillStyle=h,j.font="16px sans-serif",j.fillText(i,N/2,70))),o&&(j.fillStyle=u,j.font="14px monospace",j.textAlign="right",o.split(`
`).forEach((T,D)=>{j.fillText(T,N-20,30+D*18)})),j.drawImage(w,0,S);const P=document.createElement("a");P.download=`${r}.png`,P.href=y.toDataURL("image/png"),P.click()}},w.src=b}catch(b){console.error("Plotly download failed",b)}return}try{const b=await Vo(l,{backgroundColor:m,scale:2,logging:!1,useCORS:!0}),y=document.createElement("canvas"),j=y.getContext("2d"),w=a?i?80:50:0;if(y.width=b.width,y.height=b.height+w*2,j){j.fillStyle=m,j.fillRect(0,0,y.width,y.height),j.save(),j.scale(2,2),p(j,b.width/2),j.restore(),j.drawImage(b,0,w*2);const N=document.createElement("a");N.download=`${r}.png`,N.href=y.toDataURL("image/png"),N.click()}}catch(b){console.error("Chart download failed",b)}},lj=()=>{const[t]=Nu(),[r,a]=f.useState([]),[i,o]=f.useState(()=>{const K=t.get("dataset_id");return K?Number(K):null}),[l,c]=f.useState(null),[m,u]=f.useState(!1),[h,p]=f.useState(!1),[g,b]=f.useState(null),[y,j]=f.useState("dashboard"),[w,N]=f.useState(""),[k,S]=f.useState(""),[P,E]=f.useState([]),[T,D]=f.useState([]),[R,_]=f.useState([]),[M,I]=f.useState([]),[O,F]=f.useState(!1),[B,q]=f.useState(null),[G,ee]=f.useState(""),[te,W]=f.useState(""),[me,se]=f.useState(""),[ie,ge]=f.useState(""),[U,V]=f.useState(!1),[Y,Q]=f.useState(!1),ce=f.useMemo(()=>{const K=l==null?void 0:l.profile_data;if(!K)return null;const be=new Set(P),Se={};return K.columns&&Object.entries(K.columns).forEach(([Ve,as])=>{be.has(Ve)||(Se[Ve]=as)}),{...K,columns:Se,excluded_columns:P}},[l==null?void 0:l.profile_data,P]);f.useEffect(()=>{pe()},[]),f.useEffect(()=>{i?(c(null),E([]),D([]),_([]),N(""),q(null),ee(""),W(""),se(""),ge(""),j("dashboard"),We(i),$e(i)):(c(null),I([]),E([]),D([]),_([]),N(""),q(null),ee(""),W(""),se(""),ge(""),j("dashboard"))},[i]),f.useEffect(()=>{let K;return l&&l.status==="PENDING"&&(K=setInterval(()=>{i&&(We(i,!0),$e(i))},3e3)),()=>clearInterval(K)},[l,i]);const pe=async()=>{try{const K=await $t.getUsable();a(K),K.length>0&&!i&&o(Number(K[0].id))}catch(K){console.error("Failed to load datasets",K)}},$e=async K=>{try{const be=await Es.getHistory(K);I(be)}catch(be){console.error("Failed to load history",be)}},We=async(K,be=!1)=>{be||u(!0),b(null);try{const Se=await Es.getLatestReport(K);c(Se)}catch(Se){Se.response&&Se.response.status===404?c(null):be||b("Failed to load report")}finally{be||u(!1)}},Le=async K=>{u(!0);try{const be=await Es.getReport(K);c(be)}catch{b("Failed to load report")}finally{u(!1)}},xe=async(K,be)=>{const Se=Array.isArray(K)?K:T,Ve=Array.isArray(be)?be:R;if(i){p(!0);try{await Es.analyze(i,w||void 0,Se,Ve,k||void 0),We(i),$e(i)}catch{b("Failed to start analysis")}finally{p(!1)}}},Me=(K,be,Se="==")=>{const Ve={column:K,operator:Se,value:be},as=[...R,Ve];_(as),xe(void 0,as)},Ze=K=>{const be=[...R];be.splice(K,1),_(be),xe(void 0,be)},Dt=(K,be)=>{E(Se=>be?Se.includes(K)?Se:[...Se,K]:Se.filter(Ve=>Ve!==K))},zs=()=>{D(P),xe(P)};f.useEffect(()=>{if(l&&l.profile_data){l.profile_data.target_col&&N(l.profile_data.target_col);const K=Array.isArray(l.profile_data.excluded_columns)?l.profile_data.excluded_columns:[];D(K),E(K)}},[l==null?void 0:l.id]);const rs=(()=>{if(T.length!==P.length)return!0;const K=new Set(T);for(const be of P)if(!K.has(be))return!0;return!1})(),Ee=w?M.find(K=>K.target_col===w&&K.status==="COMPLETED"):null,Lt=()=>{var Se;if(m&&!l)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ye,{className:"w-8 h-8 animate-spin text-blue-500"})});if(g)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-500",children:[e.jsx(xt,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Error"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:g}),e.jsxs("button",{onClick:()=>i&&We(i),className:"mt-4 flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:[e.jsx(_t,{className:"w-4 h-4 mr-2"}),"Retry"]})]});if(!l)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(gs,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{className:"mb-4",children:"No analysis found for this dataset."}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"w-64 space-y-2",children:[e.jsx("input",{type:"text",value:w,onChange:Ve=>N(Ve.target.value),placeholder:"Target Column (Optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:k,onChange:Ve=>S(Ve.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Auto-Detect Task"}),e.jsx("option",{value:"Classification",children:"Classification"}),e.jsx("option",{value:"Regression",children:"Regression"})]}),e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(Vn,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-full ml-2 w-64 p-2 bg-gray-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none",children:"Force a specific task type. Useful for ID columns (force Classification) or numeric categories (force Regression)."})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[Ee&&e.jsxs("button",{onClick:()=>Le(Ee.id),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[e.jsx(_t,{className:"w-4 h-4 mr-2"}),"Load Existing (",new Date(Ee.created_at).toLocaleDateString(),")"]}),e.jsxs("button",{onClick:()=>xe(),disabled:h,className:`flex items-center px-4 py-2 ${Ee?"bg-gray-600 hover:bg-gray-700":"bg-blue-600 hover:bg-blue-700"} text-white rounded-md disabled:opacity-50`,children:[h?e.jsx(Ye,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Zt,{className:"w-4 h-4 mr-2"}),Ee?"Run New Analysis":"Run Analysis"]})]})]})]});if(l.status==="PENDING")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Ye,{className:"w-16 h-16 mb-4 animate-spin text-blue-500"}),e.jsx("p",{children:"Analysis in progress..."}),e.jsx("p",{className:"text-sm text-gray-400",children:"This may take a few moments."})]});if(l.status==="FAILED")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-500",children:[e.jsx(xt,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Analysis Failed"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:l.error_message}),e.jsxs("button",{onClick:()=>xe(),className:"mt-4 flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:[e.jsx(_t,{className:"w-4 h-4 mr-2"}),"Retry"]})]});const K=ce;if(!K)return e.jsx("div",{children:"No profile data"});const be=(Se=l==null?void 0:l.profile_data)!=null&&Se.columns?Object.keys(l.profile_data.columns):[];return e.jsxs("div",{className:"flex h-full w-full overflow-hidden bg-white dark:bg-gray-900",children:[e.jsx(ov,{activeTab:y,setActiveTab:j,profile:K,filters:R,columns:be,excludedCols:P,excludedDirty:rs,analyzing:h,onAddFilter:Me,onRemoveFilter:Ze,onClearFilters:()=>{_([]),xe(void 0,[])},onToggleExclude:Dt,onApplyExcluded:zs}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pt-4 bg-gray-50 dark:bg-gray-900/50",children:[y==="dashboard"&&e.jsx(cv,{profile:K,onToggleExclude:Dt,excludedCols:P}),y==="insights"&&e.jsx(uv,{profile:K}),y==="pca"&&e.jsx(xv,{profile:K,isPCA3D:Y,setIsPCA3D:Q,downloadChart:Da}),y==="geospatial"&&K.geospatial&&e.jsx(Dv,{profile:K}),y==="target"&&K.target_col&&K.target_correlations&&e.jsx(Iv,{profile:K,downloadChart:Da,history:M,loading:m,loadSpecificReport:Le,report:l}),y==="timeseries"&&K.timeseries&&e.jsx(Ov,{profile:K,downloadChart:Da}),y==="variables"&&e.jsx(Kv,{profile:K,setSelectedVariable:q,handleToggleExclude:Dt,handleAddFilter:Me}),y==="bivariate"&&e.jsx(Jv,{profile:K,downloadChart:Da,scatterX:G,setScatterX:ee,scatterY:te,setScatterY:W,scatterZ:me,setScatterZ:se,scatterColor:ie,setScatterColor:ge,is3D:U,setIs3D:V}),y==="outliers"&&K.outliers&&e.jsx(Qv,{profile:K}),y==="correlations"&&(K.correlations||K.correlations_with_target)&&e.jsx(Yv,{profile:K}),y==="causal"&&K.causal_graph&&e.jsx(tj,{profile:K}),y==="rules"&&K.rule_tree&&e.jsx(nj,{profile:K}),y==="decomposition"&&i&&e.jsx(oj,{datasetId:i,columns:be,initialFilters:R}),y==="sample"&&K.sample_data&&e.jsx(Xv,{profile:K,excludedCols:P,handleToggleExclude:Dt})]})]})};return e.jsxs("div",{className:"flex flex-col h-full w-full overflow-hidden bg-white dark:bg-slate-950",children:[e.jsxs("header",{className:"flex-none h-16 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-gray-800 px-4 flex items-center justify-between gap-4 z-20 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white leading-tight",children:"Exploratory Analysis"}),l&&l.created_at&&e.jsxs("p",{className:"text-[10px] text-gray-500",children:["Last analyzed: ",new Date(l.created_at).toLocaleString()]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-200 dark:bg-gray-700 mx-2"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[10px] font-medium text-gray-400 uppercase tracking-wider",children:"Dataset"}),e.jsxs("select",{value:i||"",onChange:K=>o(Number(K.target.value)),className:"block w-48 text-sm font-medium bg-transparent border-none p-0 focus:ring-0 text-gray-900 dark:text-white cursor-pointer hover:text-blue-600",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a dataset"}),r.map(K=>e.jsx("option",{value:K.id,children:K.name},K.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 dark:bg-gray-800/50 p-1.5 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-col px-2",children:[e.jsx("label",{className:"text-[10px] font-medium text-gray-400 uppercase tracking-wider",children:"Target Column"}),e.jsxs("select",{value:w,onChange:K=>N(K.target.value),disabled:!l||!l.profile_data,className:"block w-36 text-sm bg-transparent border-none p-0 focus:ring-0 text-gray-700 dark:text-gray-200 cursor-pointer disabled:opacity-50",children:[e.jsx("option",{value:"",children:"None"}),l&&l.profile_data&&Object.keys(l.profile_data.columns).filter(K=>!P.includes(K)).map(K=>e.jsx("option",{value:K,children:K},K))]})]}),e.jsx("div",{className:"w-px h-8 bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex flex-col px-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{className:"text-[10px] font-medium text-gray-400 uppercase tracking-wider",children:"Task Type"}),e.jsxs("div",{className:"group relative",children:[e.jsx(Vn,{className:"w-3 h-3 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute bottom-full mb-2 w-56 p-2 bg-slate-800 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none left-1/2 -translate-x-1/2",children:"Force Classification or Regression."})]})]}),e.jsxs("select",{value:k,onChange:K=>S(K.target.value),disabled:!l||!l.profile_data,className:"block w-28 text-sm bg-transparent border-none p-0 focus:ring-0 text-gray-700 dark:text-gray-200 cursor-pointer disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"Classification",children:"Classification"}),e.jsx("option",{value:"Regression",children:"Regression"})]})]}),e.jsxs("button",{onClick:()=>i&&xe(),disabled:!i||h,className:`ml-2 px-3 py-1.5 rounded text-sm font-medium transition-colors flex items-center shadow-sm ${Ee?"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-gray-50":"bg-blue-600 text-white hover:bg-blue-700 border border-transparent"}`,children:[h?e.jsx(Ye,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Zt,{className:"w-4 h-4 mr-2"}),Ee?"Re-Run":"Analyze"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[Ee&&l&&l.id!==Ee.id&&e.jsxs("button",{onClick:()=>Le(Ee.id),className:"flex items-center px-3 py-1.5 text-xs bg-green-50 text-green-700 border border-green-200 rounded-md hover:bg-green-100 transition-colors",title:`Load existing from ${new Date(Ee.created_at).toLocaleString()}`,children:[e.jsx(_t,{className:"w-3 h-3 mr-1"}),"Load Saved"]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-50 dark:bg-gray-800 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(Sx,{className:"w-4 h-4 mr-2"}),"History"]})]})]}),M.length>0&&e.jsxs("div",{className:"flex-none bg-white dark:bg-slate-950 border-b border-gray-100 dark:border-gray-800 px-4 py-1.5 flex items-center gap-3 overflow-x-auto z-10 shadow-[0_2px_3px_-1px_rgba(0,0,0,0.02)]",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-wider whitespace-nowrap",children:"Recent Targets:"}),e.jsx("div",{className:"flex gap-2",children:Array.from(new Set(M.filter(K=>K.target_col&&K.status==="COMPLETED").map(K=>K.target_col))).slice(0,8).map(K=>{var be;return e.jsxs("button",{onClick:()=>{const Se=M.find(Ve=>Ve.target_col===K&&Ve.status==="COMPLETED");Se&&Le(Se.id)},className:`px-2 py-0.5 text-xs rounded-full border transition-colors flex items-center ${((be=l==null?void 0:l.profile_data)==null?void 0:be.target_col)===K?"bg-blue-50 text-blue-600 border-blue-200 font-medium":"bg-white text-gray-500 border-gray-200 hover:border-gray-300 hover:text-gray-700"}`,children:[e.jsx(Vc,{className:"w-3 h-3 mr-1"}),K]},K)})})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative",children:Lt()}),e.jsx(iv,{selectedVariable:B,onClose:()=>q(null),downloadChart:Da,filters:R,setFilters:_,runAnalysis:xe,handleAddFilter:Me}),e.jsx(og,{isOpen:O,onClose:()=>F(!1),history:M,onRefresh:()=>i&&$e(i),onFetchReport:async K=>await Es.getReport(K),onSelect:K=>{var Se;c(K);const be=Array.isArray((Se=K.profile_data)==null?void 0:Se.excluded_columns)?K.profile_data.excluded_columns:[];D(be),E(be)}})]})},jc={getJobs:async()=>(await Oe.get("/monitoring/jobs")).data,calculateDrift:async(t,r,a)=>{const i=new FormData;return i.append("job_id",t),i.append("file",r),a&&i.append("dataset_name",a),(await Oe.post("/monitoring/drift/calculate",i,{headers:{"Content-Type":"multipart/form-data"}})).data}},Fn=({label:t,tooltip:r,icon:a})=>e.jsxs("div",{className:"group relative flex items-center gap-1 cursor-help",children:[e.jsx("span",{className:"border-b border-dotted border-gray-400",children:t}),a&&e.jsx("span",{className:"text-gray-400",children:a}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-64 p-2 bg-slate-900 text-white text-xs rounded shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 text-center pointer-events-none",children:[r,e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 -mb-1 border-4 border-transparent border-b-slate-900"})]})]}),dj=()=>{const[t,r]=f.useState([]),[a,i]=f.useState([]),[o,l]=f.useState(""),[c,m]=f.useState(null),[u,h]=f.useState(!1),[p,g]=f.useState(null),[b,y]=f.useState(null),[j,w]=f.useState(!1),[N,k]=f.useState(""),[S,P]=f.useState({}),E=f.useCallback(async()=>{w(!0);try{const _=await jc.getJobs();r(_),i(_)}catch(_){console.error("Failed to fetch jobs",_)}finally{w(!1)}},[]);f.useEffect(()=>{E()},[E]),f.useEffect(()=>{if(N){const _=N.toLowerCase();i(t.filter(M=>M.dataset_name.toLowerCase().includes(_)||M.job_id.toLowerCase().includes(_)))}else i(t)},[N,t]);const T=_=>{_.target.files&&_.target.files[0]&&m(_.target.files[0])},D=async()=>{var _,M;if(!o||!c){y("Please select a Reference Job and upload Current Data.");return}h(!0),y(null),P({});try{const I=t.find(F=>F.job_id===o),O=await jc.calculateDrift(o,c,I==null?void 0:I.dataset_name);g(O)}catch(I){y(((M=(_=I.response)==null?void 0:_.data)==null?void 0:M.detail)||"Failed to calculate drift.")}finally{h(!1)}},R=_=>{P(M=>({...M,[_]:!M[_]}))};return e.jsxs("div",{className:"p-6 w-full text-slate-900 dark:text-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Data Drift Analysis"}),e.jsx("button",{onClick:E,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-600 dark:text-gray-300 transition-colors",title:"Refresh Jobs",children:e.jsx(_t,{size:20,className:j?"animate-spin":""})})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow mb-6 border dark:border-slate-700",children:e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col h-[400px]",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded-full",children:"STEP 1"}),"Select Reference Model (Training Job)"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ts,{className:"absolute left-3 top-2.5 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search by Dataset Name or Job ID...",value:N,onChange:_=>k(_.target.value),className:"w-full pl-9 pr-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white shadow-sm"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto border rounded-lg dark:border-slate-600 bg-gray-50 dark:bg-slate-900 shadow-inner",children:a.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 text-sm flex flex-col items-center gap-2",children:[e.jsx(bt,{size:32,className:"text-gray-300"}),e.jsx("p",{children:"No training jobs found."}),e.jsx("p",{className:"text-xs",children:"Run a training pipeline to generate reference data."})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:a.map(_=>e.jsxs("div",{onClick:()=>l(_.job_id),className:`p-4 cursor-pointer transition-all hover:bg-blue-50 dark:hover:bg-slate-800/50 ${o===_.job_id?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 pl-3":"border-l-4 border-transparent pl-4"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-200 text-base",children:_.dataset_name}),e.jsx("span",{className:"px-2 py-0.5 bg-gray-200 dark:bg-slate-700 text-gray-600 dark:text-gray-300 text-[10px] rounded-full uppercase tracking-wider font-bold",children:"Training"})]}),_.created_at&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 dark:text-gray-400 bg-white dark:bg-slate-800 px-2 py-1 rounded border dark:border-slate-700",children:[e.jsx(Sr,{size:12}),_.created_at]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-gray-400",children:"ID:"})," ",_.job_id]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono flex items-center gap-1 truncate",title:_.filename,children:[e.jsx("span",{className:"font-semibold text-gray-400",children:"File:"})," ",_.filename]})]})]},_.job_id))})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded-full",children:"STEP 2"}),"Upload Production Data & Analyze"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-8 flex flex-col items-center justify-center bg-gray-50 dark:bg-slate-900/50 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors h-[160px]",children:[e.jsx(zc,{size:32,className:"text-gray-400 mb-3"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm font-medium transition-colors shadow-sm",children:"Select Production File"}),e.jsx("input",{type:"file",className:"hidden",onChange:T,accept:".csv,.parquet"})]}),e.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400 font-medium",children:c?c.name:"No file selected"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Supports CSV and Parquet"})]}),e.jsx("div",{className:"flex flex-col justify-center",children:e.jsx("button",{onClick:D,disabled:u||!o||!c,className:"w-full h-[160px] bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed flex flex-col items-center justify-center gap-3 font-medium shadow-lg shadow-blue-500/20 transition-all",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"animate-spin",size:32}),e.jsx("span",{className:"text-lg",children:"Calculating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Jt,{size:32}),e.jsx("span",{className:"text-lg",children:"Run Analysis"}),e.jsx("span",{className:"text-xs opacity-80 font-normal",children:"Compare Reference vs Current"})]})})})]}),b&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-200 rounded-lg flex items-start gap-3 border border-red-200 dark:border-red-800 animate-in fade-in slide-in-from-top-2",children:[e.jsx(Jt,{size:20,className:"shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm font-medium",children:b})]})]})]})}),p&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow border dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Drift Report"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Reference Rows: ",p.reference_rows," | Current Rows: ",p.current_rows]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full ${p.drifted_columns_count>0?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200":"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200"}`,children:[p.drifted_columns_count>0?e.jsx(Jt,{size:20}):e.jsx(rt,{size:20}),e.jsxs("span",{className:"font-medium",children:[p.drifted_columns_count," columns drifted"]})]})}),(p.missing_columns.length>0||p.new_columns.length>0)&&e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.missing_columns.length>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded border border-red-200 dark:border-red-800",children:[e.jsxs("h3",{className:"font-semibold text-red-800 dark:text-red-200 mb-2 flex items-center gap-2",children:[e.jsx(Jt,{size:16})," Missing Columns"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-700 dark:text-red-300",children:p.missing_columns.map(_=>e.jsx("li",{children:_},_))})]}),p.new_columns.length>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded border border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2 flex items-center gap-2",children:[e.jsx(Jt,{size:16})," New Columns"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-700 dark:text-blue-300",children:p.new_columns.map(_=>e.jsx("li",{children:_},_))})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Column"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e.jsx(Fn,{label:"Wasserstein",tooltip:"Measures distance between distributions. Lower is better. < 0.1 usually means stable.",icon:e.jsx(gt,{className:"w-3 h-3 text-slate-400"})})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e.jsx(Fn,{label:"PSI",tooltip:"Population Stability Index. < 0.1: Stable, < 0.2: Minor Drift, > 0.2: Significant Drift.",icon:e.jsx(gt,{className:"w-3 h-3 text-slate-400"})})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e.jsx(Fn,{label:"KL Div",tooltip:"Kullback-Leibler Divergence. Measures how one probability distribution diverts from a second.",icon:e.jsx(gt,{className:"w-3 h-3 text-slate-400"})})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e.jsx(Fn,{label:"KS P-Value",tooltip:"Kolmogorov-Smirnov Test. p-value < 0.05 indicates the distributions are significantly different.",icon:e.jsx(gt,{className:"w-3 h-3 text-slate-400"})})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-slate-700",children:Object.values(p.column_drifts).map(_=>{const M=_.metrics.find(q=>q.metric==="wasserstein_distance"),I=_.metrics.find(q=>q.metric==="psi"),O=_.metrics.find(q=>q.metric==="kl_divergence"),F=_.metrics.find(q=>q.metric==="ks_test_p_value"),B=S[_.column];return e.jsxs(ft.Fragment,{children:[e.jsxs("tr",{className:_.drift_detected?"bg-red-50 dark:bg-red-900/10":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium",children:_.column}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:_.drift_detected?e.jsxs("span",{className:"text-red-600 dark:text-red-400 flex items-center gap-1",children:[e.jsx(ca,{size:16})," Drifted"]}):e.jsxs("span",{className:"text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(rt,{size:16})," Stable"]})}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap ${M!=null&&M.has_drift?"text-red-600 dark:text-red-400 font-bold":""}`,children:M==null?void 0:M.value.toFixed(4)}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap ${I!=null&&I.has_drift?"text-red-600 dark:text-red-400 font-bold":""}`,children:I==null?void 0:I.value.toFixed(4)}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap ${O!=null&&O.has_drift?"text-red-600 dark:text-red-400 font-bold":""}`,children:O==null?void 0:O.value.toFixed(4)}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap ${F!=null&&F.has_drift?"text-red-600 dark:text-red-400 font-bold":""}`,children:F==null?void 0:F.value.toFixed(4)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>R(_.column),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 flex items-center gap-1 text-sm",children:[B?e.jsx(Ms,{size:16}):e.jsx(De,{size:16}),B?"Hide":"Details"]})})]}),B&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-4 bg-gray-50 dark:bg-slate-900/50",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[_.suggestions&&_.suggestions.length>0&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(sn,{size:16,className:"mt-0.5 shrink-0 text-yellow-600 dark:text-yellow-400"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-yellow-800 dark:text-yellow-200",children:_.suggestions.map((q,G)=>e.jsx("li",{children:q},G))})]})}),_.distribution&&e.jsxs("div",{className:"h-[350px] w-full bg-white dark:bg-slate-800 p-6 rounded border dark:border-slate-700 shadow-sm",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-6 flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(gs,{size:16})," Distribution Comparison"]}),e.jsx(ht,{width:"100%",height:"85%",children:e.jsxs(ps,{data:_.distribution.bins,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ct,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-slate-700",vertical:!1}),e.jsx(St,{dataKey:q=>`${q.bin_start.toFixed(2)}`,className:"text-xs",tick:{fill:"#64748b"},tickLine:!1,axisLine:{stroke:"#cbd5e1"}}),e.jsx(Tt,{className:"text-xs",tick:{fill:"#64748b"},tickLine:!1,axisLine:!1}),e.jsx(pt,{cursor:{fill:"rgba(0,0,0,0.05)"},contentStyle:{backgroundColor:"#1e293b",borderColor:"#334155",color:"#f8fafc",borderRadius:"6px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},itemStyle:{color:"#f8fafc"},labelStyle:{color:"#94a3b8",marginBottom:"0.5rem"}}),e.jsx(en,{verticalAlign:"top",height:36,iconType:"circle"}),e.jsx(Mt,{dataKey:"reference_count",name:"Reference (Training)",fill:"#94a3b8",radius:[4,4,0,0],barSize:30}),e.jsx(Mt,{dataKey:"current_count",name:"Current (Production)",fill:"#3b82f6",radius:[4,4,0,0],barSize:30})]})})]})]})})})]},_.column)})})]})})]})]})};function cj(){return e.jsx(tf,{children:e.jsx(E0,{children:e.jsxs(ds,{path:"/",element:e.jsx(mf,{}),children:[e.jsx(ds,{index:!0,element:e.jsx(bf,{})}),e.jsx(ds,{path:"jobs",element:e.jsx(ng,{})}),e.jsx(ds,{path:"data",element:e.jsx(wf,{})}),e.jsx(ds,{path:"eda",element:e.jsx(lj,{})}),e.jsx(ds,{path:"drift",element:e.jsx(dj,{})}),e.jsx(ds,{path:"canvas",element:e.jsx(tg,{})}),e.jsx(ds,{path:"registry",element:e.jsx(sg,{})}),e.jsx(ds,{path:"deployments",element:e.jsx(ag,{})})]})})})}const fr=t=>t&&typeof t=="object"?t:null,uj=t=>{const r=fr(t),a=r==null?void 0:r.sample;if(!r||!Array.isArray(a)||a.length===0)return e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"No data available"});const i=fr(a[0])??{},o=Object.keys(i).slice(0,5),l=typeof r.name=="string"?r.name:"Dataset",c=Array.isArray(r.shape)?r.shape:null,m=c&&c.length>0?c[0]:void 0,u=c&&c.length>1?c[1]:void 0;return e.jsxs("div",{className:"overflow-x-auto rounded border border-border",children:[e.jsxs("div",{className:"text-xs font-semibold mb-1 flex justify-between p-2 bg-muted/50 border-b border-border",children:[e.jsx("span",{children:l}),e.jsxs("span",{className:"text-muted-foreground",children:[m??"?"," rows x ",u??"?"," cols"]})]}),e.jsxs("table",{className:"w-full text-[10px] border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-muted/30",children:o.map(h=>e.jsx("th",{className:"p-2 border-b border-r border-border text-left font-medium text-muted-foreground last:border-r-0",children:h},h))})}),e.jsx("tbody",{children:a.slice(0,5).map((h,p)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/20",children:o.map(g=>{var b;return e.jsx("td",{className:"p-2 border-r border-border truncate max-w-[80px] last:border-r-0",children:String(((b=fr(h))==null?void 0:b[g])??"")},g)})},p))})]})]})},mj=({config:t,onChange:r,nodeId:a})=>{var k;const{nodes:i,edges:o}=je(),[l,c]=f.useState(!1),[m,u]=f.useState(null),[h,p]=f.useState("train");f.useEffect(()=>{const S=t.lastRunJobId;if(!S)return;const P=async()=>{try{const T=await Ge.getJob(S);u(T),T.status!=="completed"&&T.status}catch(T){console.error("Failed to fetch job",T)}};P();const E=setInterval(()=>{P()},2e3);return()=>{clearInterval(E)}},[t.lastRunJobId]);const g=async()=>{if(a){c(!0);try{const S=hi(i,o),P=await Ge.runPipeline({...S,target_node_id:a,job_type:"preview"});r({...t,lastRunJobId:P.job_id})}catch(S){console.error("Failed to run preview:",S),alert("Failed to start preview job.")}finally{c(!1)}}},b=((k=m==null?void 0:m.result)==null?void 0:k.metrics)??(m==null?void 0:m.result),y=fr(b),j=y?fr(y.data_summary):null,w=y==null?void 0:y.operation_mode,N=typeof w=="string"?w:void 0;return e.jsxs("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Connect this node to any data output to inspect the data state, schema, and applied transformations."}),e.jsxs("button",{onClick:()=>{g()},disabled:l,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-[#38bdf8] via-[#6366f1] to-[#a855f7] text-white px-3 py-1.5 rounded-md hover:opacity-90 disabled:opacity-50 transition-all text-xs font-medium shadow-md",children:[l?e.jsx(tt,{size:14,className:"animate-spin"}):e.jsx(Zt,{size:14}),l?"Running...":"Run Preview"]}),t.lastRunJobId&&m&&m.status!=="completed"&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2 p-2 bg-muted/30 rounded border border-border",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`ml-auto font-medium px-1.5 py-0.5 rounded text-[10px] ${m.status==="failed"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:m.status})]}),(m==null?void 0:m.status)==="completed"&&b&&e.jsxs("div",{className:"space-y-4 border-t border-border pt-4 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"text-[10px] bg-blue-50 dark:bg-blue-950/30 text-blue-700 dark:text-blue-300 p-2 rounded border border-blue-100 dark:border-blue-900/50",children:[e.jsx("strong",{className:"block mb-0.5",children:"Operation Mode"}),N||"Unknown"]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex border-b border-border",children:["train","test","validation"].map(S=>j[S]?e.jsx("button",{className:`text-[10px] px-3 py-1.5 border-b-2 transition-colors ${h===S?"border-primary font-medium text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,onClick:()=>{p(S)},children:S.charAt(0).toUpperCase()+S.slice(1)},S):null)}),j[h]?uj(j[h]):e.jsxs("div",{className:"text-xs text-muted-foreground p-4 text-center border border-dashed border-border rounded",children:["No ",h," data available"]})]}),Array.isArray(y==null?void 0:y.applied_transformations)&&y.applied_transformations.length>0&&e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("div",{className:"text-[10px] font-semibold mb-2 text-foreground",children:"Applied Steps"}),e.jsx("div",{className:"space-y-1.5",children:y.applied_transformations.map((S,P)=>{var E,T;return e.jsxs("div",{className:"text-[10px] flex items-center gap-2 text-muted-foreground p-1.5 bg-muted/30 rounded border border-border",children:[e.jsx("span",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center text-[8px] font-medium text-foreground",children:P+1}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-foreground",children:String(((E=fr(S))==null?void 0:E.transformer_name)??"")}),e.jsx("span",{className:"text-[9px] opacity-80",children:String(((T=fr(S))==null?void 0:T.transformer_type)??"")})]})]},P)})})]})]})]})},hj=({data:t})=>{const[r,a]=f.useState(null);return f.useEffect(()=>{const i=t.lastRunJobId;if(!i)return;const o=async()=>{try{const c=await Ge.getJob(i);a(c.status)}catch{a("error")}};o();const l=setInterval(()=>{o()},5e3);return()=>{clearInterval(l)}},[t.lastRunJobId]),e.jsx("div",{className:"text-xs flex items-center gap-2",children:t.lastRunJobId?r==="completed"?e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium flex items-center gap-1",children:[e.jsx(rt,{size:12})," Ready"]}):r==="failed"?e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-medium flex items-center gap-1",children:[e.jsx(xt,{size:12})," Failed"]}):e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium flex items-center gap-1",children:[e.jsx(tt,{size:12,className:"animate-spin"})," Running"]}):e.jsx("span",{className:"text-muted-foreground italic",children:"Not run yet"})})},xj={type:"data_preview",label:"Data Preview",category:"Evaluation",description:"Inspect data state and transformations at this point.",icon:Wo,inputs:[{id:"in",label:"Input Data",type:"any"}],outputs:[],component:hj,settings:mj,validate:()=>({isValid:!0}),getDefaultConfig:()=>({})},ze=t=>Ip({queryKey:["dataset-schema",t],queryFn:()=>pf(t),enabled:!!t,staleTime:1e3*60*5}),pj=({config:t,onChange:r})=>{const[a,i]=f.useState([]),[o,l]=f.useState(!1),[c,m]=f.useState(!1),{data:u,isLoading:h}=ze(t.datasetId),p=()=>{l(!0),$t.getUsable().then(i).catch(console.error).finally(()=>{l(!1)})};f.useEffect(()=>{p()},[]);const g=y=>{const j=y.target.value,w=a.find(N=>String(N.id)===j);r({...t,datasetId:j,datasetName:w==null?void 0:w.name})},b=(y,j)=>{m(!1),p(),r({...t,datasetId:y,datasetName:j})};return c?e.jsx(ku,{onUploadComplete:b,onCancel:()=>{m(!1)}}):e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Dataset"}),e.jsxs("button",{onClick:()=>{m(!0)},className:"text-xs flex items-center gap-1 text-blue-600 hover:text-blue-700 font-medium",children:[e.jsx(Yt,{size:14}),"New Upload"]})]}),o?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Loading datasets..."}):e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.datasetId||"",onChange:g,children:[e.jsx("option",{value:"",children:"-- Select --"}),a.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),t.datasetId&&e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(Tx,{size:14}),e.jsx("span",{children:"Dataset Schema"})]}),h?e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}):u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-md bg-muted/10 max-h-60 overflow-auto",children:e.jsxs("table",{className:"w-full text-xs text-left min-w-max",children:[e.jsx("thead",{className:"bg-muted/20 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-medium border-b bg-muted/20",children:"Column"}),e.jsx("th",{className:"p-2 font-medium border-b bg-muted/20",children:"Type"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Missing"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Unique"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Min"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Max"}),e.jsx("th",{className:"p-2 font-medium border-b text-right bg-muted/20",children:"Mean"})]})}),e.jsx("tbody",{children:Object.values(u.columns).map(y=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/20",children:[e.jsx("td",{className:"p-2 font-mono font-medium whitespace-nowrap",children:y.name}),e.jsx("td",{className:"p-2 text-muted-foreground whitespace-nowrap",children:y.dtype}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.missing_count}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.unique_count}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.min_value!==void 0?Number(y.min_value).toFixed(2):"-"}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.max_value!==void 0?Number(y.max_value).toFixed(2):"-"}),e.jsx("td",{className:"p-2 text-right text-muted-foreground",children:y.mean_value!==void 0?Number(y.mean_value).toFixed(2):"-"})]},y.name))})]})}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1 text-center italic",children:"Expand node to see full details"})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"No schema available."})]})]})},fj=({data:t})=>{const[r,a]=f.useState(void 0);f.useEffect(()=>{t.datasetId&&!t.datasetName&&r===void 0&&$t.getById(t.datasetId).then(o=>{a(o.name)}).catch(()=>{a(t.datasetId)})},[t.datasetId,t.datasetName,r]);const i=t.datasetName||r||t.datasetId;return e.jsx("div",{className:"text-xs",children:t.datasetId?e.jsx("div",{className:"font-medium truncate max-w-[150px]",title:i,children:i||"Loading..."}):e.jsx("div",{className:"text-muted-foreground italic",children:"Select a dataset"})})},gj={type:"dataset_node",label:"Dataset",category:"Data Source",description:"Load a dataset from the registry.",icon:bt,inputs:[],outputs:[{id:"data",label:"Data",type:"dataset"}],settings:pj,component:fj,validate:t=>({isValid:!!t.datasetId,message:t.datasetId?void 0:"Dataset is required"}),getDefaultConfig:()=>({datasetId:""})},Tm=(t,r,a,i=new Set)=>{var l;if(i.has(t.id))return;if(i.add(t.id),(l=t.data)!=null&&l.datasetId)return t.data.datasetId;const o=Er(t,r,a);for(const c of o){const m=Tm(c,r,a,i);if(m)return m}},He=t=>{const r=je(l=>l.nodes),a=je(l=>l.edges),i=r.find(l=>l.id===t);return i?Er(i,r,a).map(l=>{const c=Tm(l,r,a);return c&&!l.data.datasetId?{...l.data,datasetId:c}:l.data}):[]},ba=(t,r={})=>{var l;const i=(l=He(t).find(c=>c.datasetId))==null?void 0:l.datasetId,o=je(c=>c.executionResult);return f.useMemo(()=>!i||!(o!=null&&o.recommendations)?[]:o.recommendations.filter(c=>{var m,u;if(r.types||r.suggestedNodeTypes){const h=(m=r.types)==null?void 0:m.includes(c.type),p=(u=r.suggestedNodeTypes)==null?void 0:u.includes(c.suggested_node_type);if(!h&&!p)return!1}return!(r.scope==="column"&&(!c.target_columns||c.target_columns.length===0))}),[o,i,r.types,r.suggestedNodeTypes,r.scope])},Ar=({recommendations:t,onApply:r,className:a=""})=>!t||t.length===0?null:e.jsxs("div",{className:`bg-blue-50 border border-blue-100 rounded-md p-3 ${a}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-blue-800 font-medium text-sm",children:[e.jsx(sn,{className:"w-4 h-4"}),e.jsx("span",{children:"Recommendations"})]}),e.jsx("div",{className:"space-y-2",children:t.map(i=>e.jsx("div",{className:"bg-white border border-blue-100 rounded p-2 text-sm shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-800 font-medium text-xs mb-1",children:i.type.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-gray-600 text-xs leading-relaxed",children:i.description}),i.reasoning&&e.jsxs("p",{className:"text-gray-400 text-[10px] mt-1 italic",children:["Why: ",i.reasoning]})]}),r&&e.jsx("button",{onClick:()=>r(i),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50",title:"Apply Recommendation",children:e.jsx(rt,{className:"w-5 h-5"})})]})},i.rule_id))})]}),bj=({config:t,onChange:r,nodeId:a})=>{var T;const o=(T=He(a||"").find(D=>D.datasetId))==null?void 0:T.datasetId,{data:l,isLoading:c}=ze(o),m=l?Object.values(l.columns).map(D=>D.name):[],u=je(D=>D.executionResult),h=a?u==null?void 0:u.node_results[a]:null,p=h!=null&&h.metrics&&typeof h.metrics=="object"?h.metrics:null,g=f.useRef(null),[b,y]=f.useState(!1);f.useEffect(()=>{if(!g.current)return;const D=new ResizeObserver(R=>{for(const _ of R)y(_.contentRect.width>450)});return D.observe(g.current),()=>{D.disconnect()}},[]);const j=ba(a||"",{types:["cleaning","feature_selection"],suggestedNodeTypes:["DropMissingColumns"],scope:"column"}),w=D=>{var R;if((R=D.target_columns)!=null&&R.length){const _=Array.from(new Set([...t.columns,...D.target_columns]));r({...t,columns:_})}},[N,k]=f.useState(""),S=f.useMemo(()=>m.filter(D=>D.toLowerCase().includes(N.toLowerCase())),[m,N]),P=()=>{r({...t,columns:S})},E=()=>{const D=t.columns.filter(R=>!S.includes(R));r({...t,columns:D})};return e.jsxs("div",{ref:g,className:`flex flex-col h-full w-full bg-background ${b?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${b?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${b?"overflow-y-auto pr-2":"shrink-0"}`,children:[j.length>0&&e.jsx("div",{className:"shrink-0",children:e.jsx(Ar,{recommendations:j,onApply:w})}),e.jsxs("div",{className:"space-y-3 p-3 border rounded-md bg-muted/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Missing Value Threshold"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Drop columns with >",t.missing_threshold??0,"% missing values"]})]}),e.jsxs("span",{className:"text-sm font-mono font-bold text-primary bg-primary/10 px-2 py-1 rounded",children:[t.missing_threshold??0,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:t.missing_threshold??0,onChange:D=>r({...t,missing_threshold:parseInt(D.target.value)}),className:"w-full h-2 bg-secondary rounded-lg appearance-none cursor-pointer accent-primary"})]}),p&&p.dropped_columns_count!==void 0&&e.jsxs("div",{className:"p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Columns Dropped:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(p.dropped_columns_count)})]}),Array.isArray(p.dropped_columns)&&p.dropped_columns.length>0&&e.jsxs("div",{className:"pt-1 border-t mt-1",children:[e.jsx("span",{className:"text-muted-foreground block mb-1",children:"Dropped Names:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:p.dropped_columns.map(D=>{const R=String(D);return e.jsx("span",{className:"px-1.5 py-0.5 bg-background border rounded text-[10px] font-mono",children:R},R)})})]})]})]})]}),e.jsxs("div",{className:`flex flex-col border rounded-md bg-background shadow-sm overflow-hidden ${b?"min-h-0 flex-1":"h-96 shrink-0"}`,children:[e.jsxs("div",{className:"p-3 border-b bg-muted/5 space-y-3 shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Explicitly Drop Columns"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full pl-9 pr-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary focus:border-primary transition-all outline-none",value:N,onChange:D=>{k(D.target.value)}})}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:P,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:E,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-1",children:m.length>0?S.length>0?e.jsx("div",{className:"space-y-0.5",children:S.map(D=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-2 rounded cursor-pointer transition-colors select-none",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(D),onChange:R=>{const _=R.target.checked?[...t.columns,D]:t.columns.filter(M=>M!==D);r({...t,columns:_})},className:"rounded border-gray-300 text-primary focus:ring-primary w-4 h-4"}),e.jsx("span",{className:"truncate font-mono text-xs",title:D,children:D})]},D))}):e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-8",children:['No columns match "',N,'"']}):e.jsx("div",{className:"text-xs text-muted-foreground italic p-8 text-center",children:"No columns available"})})]})]})]})},yj={type:"drop_missing_columns",label:"Drop Columns",category:"Preprocessing",description:"Remove specific columns or those with high missing values.",icon:or,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Data",type:"dataset"}],settings:bj,validate:t=>({isValid:t.columns.length>0||t.missing_threshold!==void 0&&t.missing_threshold>0,message:t.columns.length===0&&(!t.missing_threshold||t.missing_threshold===0)?"Select columns or set a threshold":void 0}),getDefaultConfig:()=>({columns:[],missing_threshold:0})},vj=({config:t,onChange:r,nodeId:a})=>{var _;const o=(_=He(a||"").find(M=>M.datasetId))==null?void 0:_.datasetId,{data:l,isLoading:c}=ze(o),m=l?Object.values(l.columns).map(M=>M.name):[],u=je(M=>M.executionResult),h=a?u==null?void 0:u.node_results[a]:null,p=h!=null&&h.metrics&&typeof h.metrics=="object"?h.metrics:null,g=p!=null&&p.fill_values&&typeof p.fill_values=="object"?p.fill_values:null,b=p!=null&&p.missing_counts&&typeof p.missing_counts=="object"?p.missing_counts:null,y=f.useRef(null),[j,w]=f.useState(!1);f.useEffect(()=>{if(!y.current)return;const M=new ResizeObserver(I=>{for(const O of I)w(O.contentRect.width>450)});return M.observe(y.current),()=>{M.disconnect()}},[]);const N=ba(a||"",{types:["imputation"],suggestedNodeTypes:["SimpleImputer","KNNImputer","IterativeImputer"],scope:"column"}),k=M=>{if(M.target_columns.length>0){const I=Array.from(new Set([...t.columns,...M.target_columns]));r({...t,columns:I})}},[S,P]=f.useState(""),E=f.useMemo(()=>m.filter(M=>M.toLowerCase().includes(S.toLowerCase())),[m,S]),T=()=>{r({...t,columns:E})},D=()=>{const M=t.columns.filter(I=>!E.includes(I));r({...t,columns:M})},R=()=>p?e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs",children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-2",children:"Execution Feedback"}),g&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Imputed Values:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 max-h-32 overflow-y-auto",children:Object.entries(g).map(([M,I])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:M,children:[M,":"]}),e.jsx("span",{className:"font-mono",children:typeof I=="number"?I.toFixed(4):String(I)})]},M))})]}),b&&e.jsxs("div",{className:"space-y-1 mt-2",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Missing Values Filled:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 max-h-32 overflow-y-auto",children:Object.entries(b).map(([M,I])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:M,children:[M,":"]}),e.jsx("span",{className:"font-mono",children:String(I)})]},M))}),p.total_missing!==void 0&&e.jsxs("div",{className:"text-[10px] text-muted-foreground mt-1 pt-1 border-t",children:["Total Filled: ",e.jsx("span",{className:"font-mono font-medium",children:String(p.total_missing)})]})]}),!g&&!b&&(h==null?void 0:h.status)==="success"&&e.jsx("div",{className:"text-green-600",children:"Imputation completed successfully."})]}):null;return e.jsxs("div",{ref:y,className:`flex flex-col h-full w-full bg-background ${j?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${j?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${j?"overflow-y-auto pr-2":"shrink-0"}`,children:[N.length>0&&e.jsx("div",{className:"shrink-0",children:e.jsx(Ar,{recommendations:N,onApply:k})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Imputation Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method||"simple",onChange:M=>r({...t,method:M.target.value}),children:[e.jsx("option",{value:"simple",children:"Simple Imputer (Univariate)"}),e.jsx("option",{value:"knn",children:"KNN Imputer (Multivariate)"}),e.jsx("option",{value:"iterative",children:"Iterative Imputer (MICE)"})]})]}),(t.method==="simple"||!t.method)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Strategy"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.strategy,onChange:M=>r({...t,strategy:M.target.value}),children:[e.jsx("option",{value:"mean",children:"Mean (Average)"}),e.jsx("option",{value:"median",children:"Median (Middle Value)"}),e.jsx("option",{value:"most_frequent",children:"Most Frequent (Mode)"}),e.jsx("option",{value:"constant",children:"Constant Value"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:[t.strategy==="mean"&&"Replaces missing values with the mean of the column. (Numeric only)",t.strategy==="median"&&"Replaces missing values with the median. (Robust to outliers)",t.strategy==="most_frequent"&&"Replaces missing with the most common value. (Categorical/Numeric)",t.strategy==="constant"&&"Replaces missing values with a specific value."]})]}),t.strategy==="constant"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fill Value"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded bg-background text-sm",value:t.fill_value||"",onChange:M=>r({...t,fill_value:M.target.value}),placeholder:"Enter value..."})]})]}),t.method==="knn"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Number of Neighbors"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded bg-background text-sm",value:t.n_neighbors||5,onChange:M=>r({...t,n_neighbors:parseInt(M.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Weights"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.weights||"uniform",onChange:M=>r({...t,weights:M.target.value}),children:[e.jsx("option",{value:"uniform",children:"Uniform"}),e.jsx("option",{value:"distance",children:"Distance"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Uniform: All points in each neighborhood are weighted equally. Distance: Weight points by the inverse of their distance."})]})]}),t.method==="iterative"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Max Iterations"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded bg-background text-sm",value:t.max_iter||10,onChange:M=>r({...t,max_iter:parseInt(M.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Estimator"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.estimator||"bayesian_ridge",onChange:M=>r({...t,estimator:M.target.value}),children:[e.jsx("option",{value:"bayesian_ridge",children:"Bayesian Ridge"}),e.jsx("option",{value:"decision_tree",children:"Decision Tree"}),e.jsx("option",{value:"extra_trees",children:"Extra Trees"}),e.jsx("option",{value:"knn",children:"KNN"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"The estimator to use for the imputation steps."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Random State"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.random_state??0,onChange:M=>r({...t,random_state:parseInt(M.target.value)})})]})]}),j&&e.jsx(R,{})]}),e.jsxs("div",{className:`flex flex-col h-full min-h-[200px] border rounded-md overflow-hidden ${j?"":"shrink-0"}`,children:[e.jsxs("div",{className:"p-2 border-b bg-muted/30 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Target Columns (",t.columns.length,")"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:T,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"All"}),e.jsx("button",{onClick:D,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"None"})]})]}),e.jsx("input",{type:"text",placeholder:"Search columns...",className:"w-full text-xs p-1.5 border rounded bg-background",value:S,onChange:M=>{P(M.target.value)}})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:E.length>0?E.map(M=>e.jsxs("label",{className:"flex items-center justify-between gap-2 text-sm hover:bg-accent/50 p-1.5 rounded cursor-pointer select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(M),onChange:I=>{const O=I.target.checked?[...t.columns,M]:t.columns.filter(F=>F!==M);r({...t,columns:O})},className:"rounded border-gray-300 text-primary focus:ring-primary shrink-0"}),e.jsx("span",{className:"truncate",title:M,children:M})]}),b&&b[M]!==void 0&&e.jsx("span",{className:"text-[10px] text-muted-foreground font-mono shrink-0 bg-muted px-1.5 py-0.5 rounded",title:`${String(b[M])} missing values filled`,children:String(b[M])})]},M)):e.jsx("div",{className:"p-4 text-center text-xs text-muted-foreground",children:m.length===0?"No columns available":"No matches found"})})]}),!j&&e.jsx(R,{})]})]})},jj={type:"imputation_node",label:"Imputation",category:"Preprocessing",description:"Fill missing values using Simple, KNN, or Iterative strategies.",icon:Px,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:vj,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column"}:t.method==="simple"&&t.strategy==="constant"&&(t.fill_value===void 0||t.fill_value==="")?{isValid:!1,message:"Fill value is required for Constant strategy"}:{isValid:!0},getDefaultConfig:()=>({columns:[],method:"simple",strategy:"mean",fill_value:0,n_neighbors:5,weights:"uniform",max_iter:10,estimator:"bayesian_ridge",random_state:0})},_j=({config:t,onChange:r,nodeId:a})=>{var P;const o=(P=He(a||"").find(E=>E.datasetId))==null?void 0:P.datasetId,{data:l,isLoading:c}=ze(o),m=je(E=>E.executionResult),u=a?m==null?void 0:m.node_results[a]:null,h=f.useRef(null),[p,g]=f.useState(!1),[b,y]=f.useState("");f.useEffect(()=>{if(!h.current)return;const E=new ResizeObserver(T=>{for(const D of T)g(D.contentRect.width>450)});return E.observe(h.current),()=>{E.disconnect()}},[]);const j=l?Object.values(l.columns).filter(E=>["int","float","number"].some(T=>E.dtype.toLowerCase().includes(T))).map(E=>E.name):[],w=j.filter(E=>E.toLowerCase().includes(b.toLowerCase())),N=()=>{r({...t,columns:w})},k=()=>{const E=t.columns.filter(T=>!w.includes(T));r({...t,columns:E})},S=()=>{if(!u||!u.metrics)return null;const E=u.metrics,T=E.columns;if(!T)return null;const D=()=>{switch(t.method){case"standard":return"Target:   0,   1";case"minmax":return`Target: ${t.feature_range_min??0} to ${t.feature_range_max??1}`;case"robust":return"Target: Median  0, IQR  1";case"maxabs":return"Target: MaxAbs = 1";default:return""}};return e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Scaling Statistics"}),e.jsx("div",{className:"text-[10px] text-primary/80 bg-primary/5 px-1.5 py-0.5 rounded border border-primary/10",title:"Values close to these targets indicate successful scaling.",children:D()})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto bg-background p-2 rounded border space-y-1",children:T.map((R,_)=>{let M="";if(t.method==="standard"){const I=E.mean?E.mean[_]:void 0,O=E.scale?E.scale[_]:void 0;typeof I=="number"&&(M=`=${I.toFixed(2)}, =${typeof O=="number"?O.toFixed(2):"-"}`)}else if(t.method==="minmax"){const I=E.data_min?E.data_min[_]:void 0,O=E.data_max?E.data_max[_]:void 0;typeof I=="number"&&(M=`Min=${I.toFixed(2)}, Max=${typeof O=="number"?O.toFixed(2):"-"}`)}else if(t.method==="robust"){const I=E.center?E.center[_]:void 0,O=E.scale?E.scale[_]:void 0;typeof I=="number"&&(M=`Med=${I.toFixed(2)}, IQR=${typeof O=="number"?O.toFixed(2):"-"}`)}else if(t.method==="maxabs"){const I=E.max_abs?E.max_abs[_]:void 0;typeof I=="number"&&(M=`MaxAbs=${I.toFixed(2)}`)}return e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[100px] font-medium",title:R,children:R}),e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground",children:M})]},R)})})]})};return e.jsxs("div",{ref:h,className:`flex flex-col h-full w-full bg-background ${p?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsx("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."})}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${p?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${p?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Scaling Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method,onChange:E=>r({...t,method:E.target.value}),children:[e.jsx("option",{value:"standard",children:"Standard Scaler (Z-Score)"}),e.jsx("option",{value:"minmax",children:"MinMax Scaler (0-1)"}),e.jsx("option",{value:"maxabs",children:"MaxAbs Scaler"}),e.jsx("option",{value:"robust",children:"Robust Scaler (Outlier Safe)"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:[t.method==="standard"&&"Centers data around 0 with unit variance.",t.method==="minmax"&&"Scales data to a fixed range [0, 1].",t.method==="maxabs"&&"Scales data by its maximum absolute value.",t.method==="robust"&&"Scales data using statistics that are robust to outliers."]})]}),t.method==="standard"&&e.jsxs("div",{className:"space-y-2 border-t pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_mean??!0,onChange:E=>r({...t,with_mean:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Center Data (with_mean)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_std??!0,onChange:E=>r({...t,with_std:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Scale Variance (with_std)"})]})]}),t.method==="minmax"&&e.jsxs("div",{className:"space-y-2 border-t pt-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Feature Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Min (0)",value:t.feature_range_min??0,onChange:E=>r({...t,feature_range_min:parseFloat(E.target.value)})}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Max (1)",value:t.feature_range_max??1,onChange:E=>r({...t,feature_range_max:parseFloat(E.target.value)})})]})]}),t.method==="robust"&&e.jsxs("div",{className:"space-y-2 border-t pt-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Quantile Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Min (25.0)",value:t.quantile_range_min??25,onChange:E=>r({...t,quantile_range_min:parseFloat(E.target.value)})}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"Max (75.0)",value:t.quantile_range_max??75,onChange:E=>r({...t,quantile_range_max:parseFloat(E.target.value)})})]}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_centering??!0,onChange:E=>r({...t,with_centering:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Center Data (Median)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.with_scaling??!0,onChange:E=>r({...t,with_scaling:E.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Scale Data (IQR)"})]})]})]}),p&&e.jsx(S,{})]}),e.jsxs("div",{className:`flex flex-col h-full min-h-[200px] border rounded-md overflow-hidden ${p?"":"shrink-0"}`,children:[e.jsxs("div",{className:"p-2 border-b bg-muted/30 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Numeric Columns (",t.columns.length,")"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:N,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"All"}),e.jsx("button",{onClick:k,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"None"})]})]}),e.jsx("input",{type:"text",placeholder:"Search columns...",className:"w-full text-xs p-1.5 border rounded bg-background",value:b,onChange:E=>{y(E.target.value)}})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:w.length>0?w.map(E=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1.5 rounded cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(E),onChange:T=>{const D=T.target.checked?[...t.columns,E]:t.columns.filter(R=>R!==E);r({...t,columns:D})},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:E,children:E})]},E)):e.jsx("div",{className:"text-xs text-muted-foreground italic p-4 text-center",children:c?"Loading schema...":j.length===0?"No numeric columns found":"No matches found"})})]}),!p&&e.jsx(S,{})]})]})},wj={type:"scale_numeric_features",label:"Scaling",category:"Preprocessing",description:"Scale numeric features to a standard range.",icon:Lx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Scaled Data",type:"dataset"}],settings:_j,validate:t=>({isValid:t.columns.length>0,message:t.columns.length===0?"Select at least one column":void 0}),getDefaultConfig:()=>({columns:[],method:"standard"})},Pm={getAllNodes:async()=>(await Oe.get("/ml/registry")).data};function Lm(){const[t,r]=f.useState(null),[a,i]=f.useState({width:0,height:0}),o=f.useCallback(l=>{if(l.length===0)return;const{width:c,height:m}=l[0].contentRect;i({width:c,height:m})},[]);return f.useEffect(()=>{if(!t)return;const l=new ResizeObserver(o);return l.observe(t),()=>{l.disconnect()}},[t,o]),[r,a]}const Nj=({text:t})=>e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(Vn,{className:"w-3 h-3 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg z-50",children:[t,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]}),kj=({isOpen:t,onClose:r,modelType:a,onSelect:i,availableModels:o=[]})=>{const[l,c]=f.useState(a),[m,u]=f.useState([]),[h,p]=f.useState(!1),[g,b]=f.useState(null);f.useEffect(()=>{t&&c(a)},[t,a]);const y=f.useCallback(()=>{l&&(p(!0),b(null),Ge.getTuningHistory(l).then(j=>{u(j)}).catch(j=>{console.error("Failed to fetch jobs",j),b("Failed to load history.")}).finally(()=>{p(!1)}))},[l]);return f.useEffect(()=>{t&&y()},[t,y]),t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex justify-center items-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[85vh] bg-white dark:bg-gray-800 shadow-2xl rounded-xl flex flex-col border border-gray-200 dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(tt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Best Parameters History"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Select parameters for:"}),e.jsx("select",{value:l,onChange:j=>{c(j.target.value)},className:"text-xs border border-gray-200 dark:border-gray-700 rounded px-2 py-0.5 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:ring-1 focus:ring-blue-500 outline-none",children:o.length>0?o.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"random_forest_classifier",children:"Random Forest Classifier"}),e.jsx("option",{value:"logistic_regression",children:"Logistic Regression"}),e.jsx("option",{value:"ridge_regression",children:"Ridge Regression"}),e.jsx("option",{value:"random_forest_regressor",children:"Random Forest Regressor"})]})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:y,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:"Refresh",children:e.jsx(_t,{className:`w-4 h-4 ${h?"animate-spin":""}`})}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",children:e.jsx(et,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/30 dark:bg-gray-900/30",children:h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx(Ye,{className:"w-8 h-8 animate-spin mb-2 text-blue-500"}),e.jsx("p",{className:"text-sm",children:"Loading history..."})]}):g?e.jsxs("div",{className:"text-center py-12 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-900/20",children:[e.jsx(xt,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:g}),e.jsx("button",{onClick:y,className:"mt-2 text-xs underline hover:text-red-600",children:"Try Again"})]}):m.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-700",children:[e.jsx(bt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No completed optimization jobs found."}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Run an optimization job to see results here."})]}):m.map(j=>{var w;return e.jsx("div",{className:"group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:shadow-md hover:border-blue-200 dark:hover:border-blue-800 transition-all",children:e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-600 dark:text-gray-300",children:["#",j.job_id.slice(0,8)]}),e.jsx("span",{className:"text-xs text-gray-400",children:j.end_time?new Date(j.end_time).toLocaleString():"Unknown Date"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[typeof((w=j.result)==null?void 0:w.best_score)=="number"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Score:"}),e.jsx("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:j.result.best_score.toFixed(4)})]}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1",children:[e.jsx(Ba,{className:"w-3 h-3"})," Model Ready"]})]})]}),e.jsxs("button",{onClick:()=>{var N;(N=j.result)!=null&&N.best_params&&(i({params:j.result.best_params,modelType:l}),r())},className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md transition-colors flex items-center gap-1 shadow-sm shadow-blue-500/20",children:[e.jsx(Ba,{className:"w-3 h-3"}),"Apply"]})]})},j.job_id)})})]})]}):null},Cj=({value:t,type:r,onChange:a,step:i,min:o,max:l})=>{const[c,m]=f.useState("");f.useEffect(()=>{m(t===null?"None":(t==null?void 0:t.toString())??"")},[t]);const u=()=>{const h=c.trim();if(h.toLowerCase()==="none"){a(null);return}if(r==="number"){if(h==="")return;const p=Number(h);isNaN(p)?m(t===null?"None":(t==null?void 0:t.toString())??""):a(p)}else r==="boolean"?h.toLowerCase()==="true"?a(!0):h.toLowerCase()==="false"?a(!1):m((t==null?void 0:t.toString())??""):a(h)};return e.jsx("input",{type:"text",value:c,onChange:h=>{m(h.target.value)},onBlur:u,placeholder:t===null?"None":"",className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",...r==="number"?{step:i,min:o,max:l}:{}})},Sj=({config:t,onChange:r,nodeId:a})=>{var U;const[i,o]=f.useState([]),[l,c]=f.useState(!1),[m,u]=f.useState(!1),[h,p]=f.useState(()=>!sessionStorage.getItem("hide_info_model_training")),{toggleDrawer:g,setTab:b}=xa(),y=He(a||""),j=je(V=>V.nodes),w=je(V=>V.edges),k=(V=>{var ce,pe,$e,We;const Y=new Set,Q=[V];for(;Q.length>0;){const Le=Q.shift();if(!Le||Y.has(Le))continue;Y.add(Le);const xe=j.find(Ze=>Ze.id===Le);if(!xe)continue;if(Le!==V){if((ce=xe.data)!=null&&ce.datasetId)return xe.data.datasetId;if((pe=xe.data)!=null&&pe.dataset_id)return xe.data.dataset_id;if(($e=xe.data)!=null&&$e.config){const Ze=xe.data.config;if(Ze.datasetId)return Ze.datasetId;if(Ze.dataset_id)return Ze.dataset_id}if((We=xe.data)!=null&&We.params){const Ze=xe.data.params;if(Ze.datasetId)return Ze.datasetId;if(Ze.dataset_id)return Ze.dataset_id}}const Me=Er(xe,j,w);for(const Ze of Me)Q.push(Ze.id)}})(a||""),{data:S}=ze(k),P=S?Object.values(S.columns):[],[E,{width:T}]=Lm(),D=T>450,[R,_]=f.useState("model"),[M,I]=f.useState(!1),[O,F]=f.useState([]),[B,q]=f.useState(!1),[G,ee]=f.useState(!0),te=O.find(V=>V.id===t.model_type),W=(U=te==null?void 0:te.tags)==null?void 0:U.includes("requires_scaling");f.useEffect(()=>{(async()=>{q(!0);try{const Q=(await Pm.getAllNodes()).filter(ce=>ce.category==="Model"||ce.category==="Modeling");F(Q)}catch(Y){console.error("Failed to fetch models:",Y),F([{id:"random_forest_classifier",name:"Random Forest Classifier",category:"Modeling",description:"",params:{}},{id:"logistic_regression",name:"Logistic Regression",category:"Modeling",description:"",params:{}},{id:"ridge_regression",name:"Ridge Regression",category:"Modeling",description:"",params:{}},{id:"random_forest_regressor",name:"Random Forest Regressor",category:"Modeling",description:"",params:{}}])}finally{q(!1)}})()},[]);const me=f.useRef(!1);f.useEffect(()=>{t.model_type&&(u(!0),Ge.getHyperparameters(t.model_type).then(V=>{const Y=V;if(o(Y),me.current){const Q={};Y.forEach(ce=>{Q[ce.name]=ce.default}),r({...t,hyperparameters:Q}),me.current=!1}}).catch(console.error).finally(()=>{u(!1)}))},[t.model_type]),f.useEffect(()=>{var Y;const V=(Y=y.find(Q=>Q.target_column))==null?void 0:Y.target_column;V&&t.target_column!==V&&(t.target_column||r({...t,target_column:V}))},[y,t.target_column,r]);const se=async()=>{if(a)try{const V=hi(j,w);await Ge.runPipeline({...V,target_node_id:a,job_type:hs.BASIC_TRAINING}),alert("Training job submitted successfully!"),b("basic_training"),g(!0)}catch(V){console.error("Failed to submit training job:",V),alert("Failed to submit training job. Check console for details.")}},ie=e.jsx("div",{className:"space-y-5 animate-in fade-in duration-300",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Model Configuration"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Model Type"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:t.model_type,onChange:V=>{Object.keys(t.hyperparameters).length>0&&(me.current=!0),r({...t,model_type:V.target.value,hyperparameters:{}})},className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition-all",disabled:B,children:O.map(V=>e.jsx("option",{value:V.id,children:V.name},V.id))}),e.jsx(De,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]}),W&&e.jsxs("div",{className:"mt-2 text-xs border border-blue-200 dark:border-blue-800 rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 overflow-hidden transition-all",children:[e.jsxs("button",{onClick:()=>ee(!G),className:"w-full flex items-center justify-between p-2 hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsx("span",{children:"Scale Your Data"})]}),e.jsx(De,{className:`w-3 h-3 transition-transform ${G?"rotate-180":""}`})]}),G&&e.jsx("div",{className:"p-2 pt-0 opacity-90 animate-in slide-in-from-top-1 pl-7",children:'This model performs best with scaled features. Consider adding a "Feature Scaling" node.'})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Target Column"}),P.length===0&&e.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded text-xs text-yellow-700 dark:text-yellow-400 flex items-center gap-2",children:[e.jsx(Jt,{className:"w-3 h-3"}),e.jsx("span",{children:"Connect a dataset node to see available columns"})]}),e.jsxs("div",{className:"relative",children:[P.length>0?e.jsxs("select",{value:t.target_column,onChange:V=>r({...t,target_column:V.target.value}),className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",children:[e.jsx("option",{value:"",children:"Select target..."}),P.map(V=>e.jsx("option",{value:V.name,children:V.name},V.name))]}):e.jsx("input",{type:"text",value:t.target_column,onChange:V=>r({...t,target_column:V.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",placeholder:"e.g., target"}),P.length>0&&e.jsx(De,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700"}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>{I(!M)},className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(di,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Cross Validation"})]}),e.jsx(Pt,{className:`w-4 h-4 text-gray-400 transition-transform ${M?"rotate-90":""}`})]}),M&&e.jsxs("div",{className:"p-3 space-y-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"cv_enabled",checked:t.cv_enabled!==!1,onChange:V=>r({...t,cv_enabled:V.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"cv_enabled",className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable Cross-Validation"})]}),t.cv_enabled!==!1&&e.jsxs("div",{className:"space-y-3 pl-6 border-l-2 border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Folds"}),e.jsx("input",{type:"number",value:t.cv_folds??5,onChange:V=>r({...t,cv_folds:Number(V.target.value)}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",min:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Method"}),e.jsxs("select",{value:t.cv_type??"k_fold",onChange:V=>r({...t,cv_type:V.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"k_fold",children:"K-Fold"}),e.jsx("option",{value:"stratified_k_fold",children:"Stratified"}),e.jsx("option",{value:"time_series_split",children:"Time Series"}),e.jsx("option",{value:"shuffle_split",children:"Shuffle Split"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"cv_shuffle",checked:t.cv_shuffle!==!1,onChange:V=>r({...t,cv_shuffle:V.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"cv_shuffle",className:"text-xs text-gray-600 dark:text-gray-400",children:"Shuffle Data"})]})]})]})]})]})}),ge=()=>{const V=Object.keys(t.hyperparameters).length>0,Y=Q=>{if(Q){const ce={};i.forEach(pe=>{ce[pe.name]=pe.default}),Object.keys(t.hyperparameters).length===0&&r({...t,hyperparameters:ce})}else r({...t,hyperparameters:{}})};return e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Hn,{className:"w-4 h-4 text-blue-500"}),"Hyperparameters"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:`text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2 cursor-pointer select-none ${m?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:V,onChange:Q=>{Y(Q.target.checked)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:m}),"Customize"]})})]}),V?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:()=>{c(!0)},className:"text-xs flex items-center gap-1.5 px-2 py-1 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition-colors",children:[e.jsx(Xe,{className:"w-3 h-3"}),"Load Best"]})}),m?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Ye,{className:"w-5 h-5 animate-spin text-blue-500"})}):i.map(Q=>{var ce;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:Q.label}),Q.description&&e.jsx(Nj,{text:Q.description})]}),Q.type==="select"?e.jsx("select",{value:t.hyperparameters[Q.name]??Q.default,onChange:pe=>r({...t,hyperparameters:{...t.hyperparameters,[Q.name]:pe.target.value}}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",children:(ce=Q.options)==null?void 0:ce.map(pe=>e.jsx("option",{value:String(pe.value),children:pe.label},String(pe.value)))}):e.jsx(Cj,{type:Q.type,value:t.hyperparameters[Q.name]??Q.default,onChange:pe=>r({...t,hyperparameters:{...t.hyperparameters,[Q.name]:pe}}),step:Q.step,min:Q.min,max:Q.max})]},Q.name)}),i.length===0&&!m&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic text-center py-4",children:"No parameters available."})]}):e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-dashed border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Using default hyperparameters."}),e.jsxs("button",{onClick:()=>{c(!0)},className:"mt-3 text-xs flex items-center gap-1.5 px-3 py-1.5 mx-auto bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded-md border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/40 transition-colors shadow-sm",children:[e.jsx(Xe,{className:"w-3 h-3"}),"Load Best Params"]})]})]})};return e.jsxs("div",{className:"flex flex-col h-full",ref:E,children:[h&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded text-xs text-blue-700 dark:text-blue-300 flex justify-between items-start gap-2",children:[e.jsx("span",{children:"Train a model using fixed parameters or defaults."}),e.jsx("button",{onClick:()=>{p(!1),sessionStorage.setItem("hide_info_model_training","true")},className:"text-blue-400 hover:text-blue-600 dark:hover:text-blue-200",children:e.jsx(et,{className:"w-3 h-3"})})]}),e.jsx(kj,{isOpen:l,onClose:()=>{c(!1)},modelType:t.model_type,availableModels:O,onSelect:V=>{const Y=V;Y.modelType&&Y.modelType!==t.model_type?r({...t,model_type:Y.modelType,hyperparameters:Y.params}):r({...t,hyperparameters:Y.params})}}),!D&&e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${R==="model"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{_("model")},children:"Configuration"}),e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${R==="params"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{_("params")},children:"Hyperparameters"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-1 pb-4 custom-scrollbar",children:D?e.jsxs("div",{className:"grid grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"overflow-y-auto pr-2",children:ie}),e.jsx("div",{className:"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-800",children:e.jsx(ge,{})})]}):e.jsxs(e.Fragment,{children:[R==="model"&&ie,R==="params"&&e.jsx(ge,{})]})}),e.jsx("div",{className:"pt-4 mt-auto border-t border-gray-100 dark:border-gray-700 flex flex-col gap-3 items-center",children:e.jsxs("button",{onClick:()=>{se()},className:"w-full max-w-xs flex items-center justify-center gap-2 px-6 py-2.5 text-white rounded-lg shadow-lg transition-all hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0",style:{background:"var(--main-gradient)"},children:[e.jsx(Zt,{className:"w-4 h-4 fill-current"}),e.jsx("span",{className:"text-sm font-semibold",children:"Start Training"})]})})]})},Em=({type:t,label:r,description:a,icon:i,settings:o,defaultConfig:l={},validate:c,category:m="Modeling",inputs:u=[{id:"in",label:"Training Data",type:"dataset"}],outputs:h=[{id:"model",label:"Model",type:"model"}]})=>({type:t,label:r,category:m,description:a,icon:i,inputs:u,outputs:h,settings:o,validate:c||(p=>p.target_column?{isValid:!0}:{isValid:!1,message:"Target column is required."}),getDefaultConfig:()=>({target_column:"",model_type:"random_forest_classifier",...l})}),Tj=Em({type:hs.BASIC_TRAINING,label:"Basic Training",description:"Train a model with fixed or default parameters.",icon:Ex,settings:Sj,defaultConfig:{hyperparameters:{},cv_enabled:!0,cv_folds:5,cv_type:"k_fold",cv_shuffle:!0,cv_random_state:42},outputs:[{id:"model",label:"Trained Model",type:"model"}]}),Pj=({text:t})=>e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(Vn,{className:"w-3 h-3 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg z-50",children:[t,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]}),Lj=({def:t,value:r,onChange:a})=>{const[i,o]=f.useState(""),[l,c]=f.useState(null);f.useEffect(()=>{o(Array.isArray(r)?r.map(h=>h===null?"None":h).join(", "):"")},[r]);const m=h=>{if(!h.trim())return[];const p=h.split(",").map(b=>b.trim()).filter(b=>b!==""),g=[];for(const b of p){if(b.toLowerCase()==="none"){g.push(null);continue}if(t.type==="number"){const y=Number(b);if(isNaN(y))throw new Error(`"${b}" is not a valid number`);g.push(y)}else if(t.type==="boolean"){const y=b.toLowerCase();if(y==="true")g.push(!0);else if(y==="false")g.push(!1);else throw new Error(`"${b}" must be true or false`)}else g.push(b)}return g},u=()=>{try{const h=m(i);c(null),JSON.stringify(h)!==JSON.stringify(r)&&a(h)}catch(h){c(h.message)}};return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 flex items-center gap-1",children:[t.label,t.description&&e.jsx(Pj,{text:t.description})]}),e.jsx("span",{className:"text-[10px] text-gray-400 uppercase",children:t.type})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:`w-full border rounded px-2 py-1.5 text-sm font-mono bg-white dark:bg-gray-900 dark:text-gray-100 outline-none transition-all ${l?"border-red-500 focus:ring-2 focus:ring-red-500/20":"border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500"}`,placeholder:t.type==="select"?"e.g. lbfgs, liblinear":"e.g. 10, 50, 100",value:i,onChange:h=>{o(h.target.value),c(null)},onBlur:u}),t.type==="select"&&t.options&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.options.map(h=>e.jsx("button",{onClick:()=>{const p=m(i),b=p.includes(h.value)?p.filter(y=>y!==h.value):[...p,h.value];a(b)},className:`text-[10px] px-1.5 py-0.5 rounded border transition-colors ${r.includes(h.value)?"bg-purple-100 border-purple-200 text-purple-700 dark:bg-purple-900/30 dark:border-purple-800 dark:text-purple-300":"bg-gray-50 border-gray-200 text-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:h.label},String(h.value)))})]}),l&&e.jsxs("p",{className:"text-[10px] text-red-500 flex items-center gap-1",children:[e.jsx(xt,{className:"w-3 h-3"}),l]})]})},Ej=({isOpen:t,onClose:r,modelType:a,availableModels:i=[]})=>{const[o,l]=f.useState(a),[c,m]=f.useState([]),[u,h]=f.useState(!1),[p,g]=f.useState(null);f.useEffect(()=>{t&&l(a)},[t,a]);const b=f.useCallback(()=>{o&&(h(!0),g(null),Ge.getTuningHistory(o).then(y=>{m(y)}).catch(y=>{console.error("Failed to fetch jobs",y),g("Failed to load history.")}).finally(()=>{h(!1)}))},[o]);return f.useEffect(()=>{t&&b()},[t,b]),t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex justify-center items-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[85vh] bg-white dark:bg-gray-800 shadow-2xl rounded-xl flex flex-col border border-gray-200 dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(tt,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Best Parameters History"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"View parameters for:"}),e.jsx("select",{value:o,onChange:y=>{l(y.target.value)},className:"text-xs border border-gray-200 dark:border-gray-700 rounded px-2 py-0.5 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:ring-1 focus:ring-purple-500 outline-none",children:i.length>0?i.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"random_forest_classifier",children:"Random Forest Classifier"}),e.jsx("option",{value:"logistic_regression",children:"Logistic Regression"}),e.jsx("option",{value:"ridge_regression",children:"Ridge Regression"}),e.jsx("option",{value:"random_forest_regressor",children:"Random Forest Regressor"})]})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:b,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:"Refresh",children:e.jsx(_t,{className:`w-4 h-4 ${u?"animate-spin":""}`})}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",children:e.jsx(et,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/30 dark:bg-gray-900/30",children:u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx(Ye,{className:"w-8 h-8 animate-spin mb-2 text-purple-500"}),e.jsx("p",{className:"text-sm",children:"Loading history..."})]}):p?e.jsxs("div",{className:"text-center py-12 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-900/20",children:[e.jsx(xt,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:p}),e.jsx("button",{onClick:b,className:"mt-2 text-xs underline hover:text-red-600",children:"Try Again"})]}):c.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-700",children:[e.jsx(bt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No completed optimization jobs found."}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Run an optimization job to see results here."})]}):c.map(y=>{var j;return e.jsx("div",{className:"group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:shadow-md hover:border-purple-200 dark:hover:border-purple-800 transition-all",children:e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-600 dark:text-gray-300",children:["#",y.job_id.slice(0,8)]}),e.jsx("span",{className:"text-xs text-gray-400",children:y.end_time?new Date(y.end_time).toLocaleString():"Unknown Date"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[typeof((j=y.result)==null?void 0:j.best_score)=="number"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Score:"}),e.jsx("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:y.result.best_score.toFixed(4)})]}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full flex items-center gap-1",children:[e.jsx(Ba,{className:"w-3 h-3"})," Model Ready"]})]})]})})},y.job_id)})})]})]}):null},Rj=({config:t,onChange:r,nodeId:a})=>{var ge;const[i,o]=f.useState([]),[l,c]=f.useState(!1),[m,u]=f.useState(!1),[h,p]=f.useState("config"),[g,b]=f.useState(!1),[y,j]=f.useState(()=>!sessionStorage.getItem("hide_info_model_optimizer")),[w,{width:N}]=Lm(),k=N>450,{toggleDrawer:S,setTab:P}=xa(),E=He(a||""),T=je(U=>U.nodes),D=je(U=>U.edges),_=(U=>{var Q,ce,pe,$e;const V=new Set,Y=[U];for(;Y.length>0;){const We=Y.shift();if(V.has(We))continue;V.add(We);const Le=T.find(Me=>Me.id===We);if(!Le)continue;if(We!==U){if((Q=Le.data)!=null&&Q.datasetId)return Le.data.datasetId;if((ce=Le.data)!=null&&ce.dataset_id)return Le.data.dataset_id;const Me=Le.data;if((pe=Me.config)!=null&&pe.datasetId)return Me.config.datasetId;if(($e=Me.config)!=null&&$e.dataset_id)return Me.config.dataset_id}const xe=Er(Le,T,D);for(const Me of xe)Y.push(Me.id)}})(a||""),{data:M}=ze(_),I=M?Object.values(M.columns):[],[O,F]=f.useState([]),[B,q]=f.useState(!1),[G,ee]=f.useState(!0),te=O.find(U=>U.id===t.model_type);f.useEffect(()=>{(async()=>{q(!0);try{const Y=(await Pm.getAllNodes()).filter(Q=>Q.category==="Model"||Q.category==="Modeling");F(Y)}catch(V){console.error("Failed to fetch models:",V),F([{id:"random_forest_classifier",name:"Random Forest Classifier",category:"Modeling",description:"",params:{}},{id:"logistic_regression",name:"Logistic Regression",category:"Modeling",description:"",params:{}},{id:"ridge_regression",name:"Ridge Regression",category:"Modeling",description:"",params:{}},{id:"random_forest_regressor",name:"Random Forest Regressor",category:"Modeling",description:"",params:{}}])}finally{q(!1)}})()},[]),f.useEffect(()=>{var V;const U=(V=E.find(Y=>Y.target_column))==null?void 0:V.target_column;U&&t.target_column!==U&&r({...t,target_column:U})},[E,t.target_column]);const W=f.useRef(null);f.useEffect(()=>{(async()=>{const V=t.model_type;if(!V)return;const Y=V!==W.current;if(!(!Y&&i.length>0)){c(!0);try{const Q=await Ge.getHyperparameters(V);if(o(Q),Y){const ce=await Ge.getDefaultSearchSpace(V);r({...t,search_space:ce||{}}),W.current=V}}catch(Q){console.error("Failed to load model hyperparameters:",Q)}finally{c(!1)}}})()},[t.model_type]);const me=async()=>{if(a)try{const U=hi(T,D);await Ge.runPipeline({...U,target_node_id:a,job_type:hs.ADVANCED_TUNING}),alert("Tuning job submitted successfully!"),P("advanced_tuning"),S(!0)}catch(U){console.error("Failed to submit tuning job:",U),alert("Failed to submit tuning job.")}},se=e.jsx("div",{className:"space-y-5 animate-in fade-in duration-300",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Model Configuration"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Model Type"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:t.model_type,onChange:U=>{r({...t,model_type:U.target.value,search_space:{}})},className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition-all",disabled:B,children:O.map(U=>e.jsx("option",{value:U.id,children:U.name},U.id))}),e.jsx(De,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]})]}),((ge=te==null?void 0:te.tags)==null?void 0:ge.includes("requires_scaling"))&&e.jsxs("div",{className:"mt-2 text-xs border border-blue-200 dark:border-blue-800 rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 overflow-hidden transition-all",children:[e.jsxs("button",{onClick:()=>ee(!G),className:"w-full flex items-center justify-between p-2 hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[e.jsx(Hn,{className:"w-3 h-3"}),e.jsx("span",{children:"Scale Your Data"})]}),e.jsx(De,{className:`w-3 h-3 transition-transform ${G?"rotate-180":""}`})]}),G&&e.jsx("div",{className:"p-2 pt-0 opacity-90 animate-in slide-in-from-top-1 pl-7",children:e.jsxs("p",{className:"opacity-90",children:["This model performs best with scaled features. Consider adding a",e.jsx("span",{className:"font-mono mx-1 bg-white dark:bg-black px-1 rounded border border-blue-200 dark:border-blue-800",children:"Scaler"}),"node before this step."]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Target Column"}),I.length===0&&e.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded text-xs text-yellow-700 dark:text-yellow-400 flex items-center gap-2",children:[e.jsx(Jt,{className:"w-3 h-3"}),e.jsx("span",{children:"Connect a dataset node to see available columns"})]}),e.jsxs("div",{className:"relative",children:[I.length>0?e.jsxs("select",{value:t.target_column,onChange:U=>r({...t,target_column:U.target.value}),className:"w-full appearance-none border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition-all",children:[e.jsx("option",{value:"",children:"Select target..."}),I.map(U=>e.jsx("option",{value:U.name,children:U.name},U.name))]}):e.jsx("input",{type:"text",value:t.target_column,onChange:U=>r({...t,target_column:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",placeholder:"e.g., target"}),I.length>0&&e.jsx(De,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400 pointer-events-none"})]})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Tuning Strategy"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Search Method"}),e.jsxs("select",{value:t.search_strategy??"random",onChange:U=>r({...t,search_strategy:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"random",children:"Random Search"}),e.jsx("option",{value:"grid",children:"Grid Search"}),e.jsx("option",{value:"halving_grid",children:"Successive Halving (Grid)"}),e.jsx("option",{value:"halving_random",children:"Successive Halving (Randomized)"}),e.jsx("option",{value:"optuna",children:"Optuna Search"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Metric"}),e.jsxs("select",{value:t.metric,onChange:U=>r({...t,metric:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"accuracy",children:"Accuracy"}),e.jsx("option",{value:"f1",children:"F1 Score"}),e.jsx("option",{value:"roc_auc",children:"ROC AUC"}),e.jsx("option",{value:"mse",children:"MSE"}),e.jsx("option",{value:"rmse",children:"RMSE"}),e.jsx("option",{value:"mae",children:"MAE"}),e.jsx("option",{value:"r2",children:"R2 Score"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Trials"}),e.jsx("input",{type:"number",value:t.n_trials,onChange:U=>r({...t,n_trials:Number(U.target.value)}),disabled:["grid","halving_grid"].includes(t.search_strategy),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 text-sm bg-white dark:bg-gray-800 dark:text-gray-100 disabled:opacity-50",min:1})]})]})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>{b(!g)},className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(di,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Cross Validation"})]}),e.jsx(Pt,{className:`w-4 h-4 text-gray-400 transition-transform ${g?"rotate-90":""}`})]}),g&&e.jsxs("div",{className:"p-3 space-y-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"cv_enabled",checked:t.cv_enabled!==!1,onChange:U=>r({...t,cv_enabled:U.target.checked}),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("label",{htmlFor:"cv_enabled",className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable Cross-Validation"})]}),t.cv_enabled!==!1&&e.jsxs("div",{className:"space-y-3 pl-6 border-l-2 border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Folds"}),e.jsx("input",{type:"number",value:t.cv_folds??5,onChange:U=>r({...t,cv_folds:Number(U.target.value)}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",min:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Method"}),e.jsxs("select",{value:t.cv_type??"k_fold",onChange:U=>r({...t,cv_type:U.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded p-1.5 text-sm bg-white dark:bg-gray-800 dark:text-gray-100",children:[e.jsx("option",{value:"k_fold",children:"K-Fold"}),e.jsx("option",{value:"stratified_k_fold",children:"Stratified"}),e.jsx("option",{value:"time_series_split",children:"Time Series"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"cv_shuffle",checked:t.cv_shuffle!==!1,onChange:U=>r({...t,cv_shuffle:U.target.checked}),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("label",{htmlFor:"cv_shuffle",className:"text-xs text-gray-600 dark:text-gray-400",children:"Shuffle Data"})]})]})]})]})]})}),ie=e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h4",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Hn,{className:"w-4 h-4 text-purple-500"}),"Hyperparameters"]})}),l?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Ye,{className:"w-6 h-6 animate-spin text-purple-500"})}):e.jsxs("div",{className:"space-y-3",children:[i.map(U=>{var V;return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:e.jsx(Lj,{def:U,value:((V=t.search_space)==null?void 0:V[U.name])||[],onChange:Y=>{r({...t,search_space:{...t.search_space,[U.name]:Y}})}})},`${t.model_type}-${U.name}`)}),i.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No hyperparameters available for this model."})]})]});return e.jsxs("div",{className:"flex flex-col h-full",ref:w,children:[y&&e.jsxs("div",{className:"mb-4 p-2 bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800 rounded text-xs text-purple-700 dark:text-purple-300 flex justify-between items-start gap-2",children:[e.jsx("span",{children:"Automatically explore configurations to find the best performing model."}),e.jsx("button",{onClick:()=>{j(!1),sessionStorage.setItem("hide_info_model_optimizer","true")},className:"text-purple-400 hover:text-purple-600 dark:hover:text-purple-200",children:e.jsx(et,{className:"w-3 h-3"})})]}),!k&&e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${h==="config"?"border-purple-500 text-purple-600 dark:text-purple-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{p("config")},children:"Configuration"}),e.jsx("button",{className:`flex-1 py-2.5 text-xs font-medium text-center border-b-2 transition-colors ${h==="search_space"?"border-purple-500 text-purple-600 dark:text-purple-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,onClick:()=>{p("search_space")},children:"Search Space"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-1 pb-4 custom-scrollbar",children:k?e.jsxs("div",{className:"grid grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"overflow-y-auto pr-2",children:se}),e.jsx("div",{className:"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-800",children:ie})]}):e.jsxs(e.Fragment,{children:[h==="config"&&se,h==="search_space"&&ie]})}),e.jsxs("div",{className:"pt-4 mt-auto border-t border-gray-100 dark:border-gray-700 flex flex-col gap-3 items-center",children:[e.jsxs("button",{onClick:()=>{me()},className:"w-full max-w-xs flex items-center justify-center gap-2 px-6 py-2.5 text-white rounded-lg shadow-lg transition-all hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0",style:{background:"var(--main-gradient)"},children:[e.jsx(Zt,{className:"w-4 h-4 fill-current"}),e.jsx("span",{className:"text-sm font-semibold",children:"Start Train-Optimization"})]}),e.jsxs("button",{onClick:()=>{u(!0)},className:"text-xs text-gray-500 hover:text-purple-600 dark:text-gray-400 dark:hover:text-purple-400 flex items-center gap-1.5 transition-colors px-3 py-1 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(tt,{className:"w-3.5 h-3.5"}),"View Best Parameters History"]})]}),e.jsx(Ej,{isOpen:m,onClose:()=>{u(!1)},modelType:t.model_type,availableModels:O})]})},Mj=Em({type:hs.ADVANCED_TUNING,label:"Advanced Tuning and Training",description:"Automatically optimize model performance.",icon:Rx,settings:Rj,defaultConfig:{n_trials:10,metric:"accuracy",search_strategy:"random",cv_enabled:!0,cv_folds:5,cv_type:"k_fold",cv_shuffle:!0,cv_random_state:42,random_state:42,search_space:{}},outputs:[{id:"model",label:"Best Model",type:"model"}]}),Aj=({config:t,onChange:r,nodeId:a})=>{var E;const i=He(a||""),o=je(T=>T.nodes),l=je(T=>T.edges),c=je(T=>T.executionResult),u=(T=>{var _;const D=new Set,R=[T];for(;R.length>0;){const M=R.shift();if(!M||D.has(M))continue;D.add(M);const I=o.find(F=>F.id===M);if(!I)continue;if(M!==T&&((_=I.data)!=null&&_.datasetId))return I.data.datasetId;const O=Er(I,o,l);for(const F of O)R.push(F.id)}})(a||""),h=(E=i.find(T=>T.target_column))==null?void 0:E.target_column;f.useEffect(()=>{const T={};u&&t.datasetId!==u&&(T.datasetId=u),h&&t.target_column!==h&&(T.target_column=h),Object.keys(T).length>0&&r({...t,...T})},[u,h,t.datasetId,t.target_column,r]);const{data:p,isLoading:g}=ze(u||t.datasetId),b=p?Object.values(p.columns).map(T=>T.name):[],y=f.useRef(null),[j,w]=f.useState(!1);f.useEffect(()=>{if(!y.current)return;const T=new ResizeObserver(D=>{for(const R of D)w(R.contentRect.width>450)});return T.observe(y.current),()=>{T.disconnect()}},[]);const N=()=>{const T=t.problem_type||"auto";return T==="classification"?[{value:"f_classif",label:"ANOVA F-value"},{value:"mutual_info_classif",label:"Mutual Information"},{value:"chi2",label:"Chi-squared"}]:T==="regression"?[{value:"f_regression",label:"F-value"},{value:"mutual_info_regression",label:"Mutual Information"},{value:"r_regression",label:"Pearson Correlation"}]:[{value:"f_classif",label:"ANOVA F-value (Classif)"},{value:"f_regression",label:"F-value (Reg)"},{value:"mutual_info_classif",label:"Mutual Info (Classif)"},{value:"mutual_info_regression",label:"Mutual Info (Reg)"}]},k=["select_k_best","select_percentile","select_fpr","select_fdr","select_fwe","generic_univariate_select"].includes(t.method),S=["select_from_model","rfe"].includes(t.method),P=()=>{const T=c==null?void 0:c.node_results[a||""];if(!T)return null;const D=T.metrics||{},R=D.dropped_columns,_=D.feature_scores,M=D.p_values,I=D.feature_importances,O=D.variances,F=D.ranking;return e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs space-y-3",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Execution Feedback"}),T.error&&e.jsx("div",{className:"p-2 bg-destructive/10 text-destructive rounded border border-destructive/20",children:T.error}),R&&R.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1 flex justify-between items-center",children:e.jsxs("span",{children:["Dropped Columns (",R.length,")"]})}),e.jsx("div",{className:"max-h-40 overflow-y-auto bg-background p-2 rounded border space-y-1",children:R.map(B=>{const q=_==null?void 0:_[B],G=M==null?void 0:M[B],ee=I==null?void 0:I[B],te=O==null?void 0:O[B],W=F==null?void 0:F[B];return e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[120px] font-medium text-destructive",title:B,children:B}),e.jsxs("div",{className:"flex flex-col items-end text-[10px] text-muted-foreground",children:[q!==void 0&&e.jsxs("span",{children:["Score: ",q.toFixed(4)]}),G!==void 0&&e.jsxs("span",{children:["p-val: ",G.toExponential(2)]}),ee!==void 0&&e.jsxs("span",{children:["Imp: ",ee.toFixed(4)]}),te!==void 0&&e.jsxs("span",{children:["Var: ",te.toFixed(4)]}),W!==void 0&&e.jsxs("span",{children:["Rank: ",W]})]})]},B)})})]}):T.status==="success"&&e.jsxs("div",{className:"text-green-600 text-[10px] space-y-1",children:[e.jsx("div",{children:"No columns were dropped."}),t.method==="variance_threshold"&&e.jsxs("div",{className:"text-muted-foreground italic",children:["All features have variance > ",t.threshold??0,". Try increasing the threshold."]}),t.method==="select_k_best"&&e.jsxs("div",{className:"text-muted-foreground italic",children:["K (",t.k??10,") is likely larger than or equal to the number of features. Try reducing K."]}),t.method==="correlation_threshold"&&e.jsxs("div",{className:"text-muted-foreground italic",children:["No feature pairs found with correlation > ",t.threshold??.95,"."]})]}),(_||I)&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1",children:"Top 5 Features"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-background p-2 rounded border space-y-1",children:Object.entries(_||I||{}).sort(([,B],[,q])=>q-B).slice(0,5).map(([B,q])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"truncate max-w-[120px]",title:B,children:B}),e.jsx("span",{className:"font-mono text-[10px]",children:q.toFixed(4)})]},B))})]})]})};return e.jsxs("div",{ref:y,className:`flex flex-col h-full w-full bg-background ${j?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!u&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to configure."}),g&&!!u&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${j?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${j?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Selection Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method,onChange:T=>r({...t,method:T.target.value}),children:[e.jsxs("optgroup",{label:"Simple",children:[e.jsx("option",{value:"variance_threshold",children:"Variance Threshold"}),e.jsx("option",{value:"correlation_threshold",children:"Correlation Threshold"})]}),e.jsxs("optgroup",{label:"Univariate",children:[e.jsx("option",{value:"select_k_best",children:"Select K Best"}),e.jsx("option",{value:"select_percentile",children:"Select Percentile"}),e.jsx("option",{value:"select_fpr",children:"False Positive Rate (FPR)"}),e.jsx("option",{value:"select_fdr",children:"False Discovery Rate (FDR)"}),e.jsx("option",{value:"select_fwe",children:"Family-wise Error (FWE)"}),e.jsx("option",{value:"generic_univariate_select",children:"Generic Univariate"})]}),e.jsxs("optgroup",{label:"Model Based",children:[e.jsx("option",{value:"select_from_model",children:"Select From Model"}),e.jsx("option",{value:"rfe",children:"Recursive Feature Elimination (RFE)"})]})]})]}),t.method!=="variance_threshold"&&t.method!=="correlation_threshold"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Column"}),h?e.jsxs("div",{className:"p-2 bg-muted rounded text-sm text-muted-foreground border",children:[h," ",e.jsx("span",{className:"text-xs italic",children:"(Auto-detected)"})]}):e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column??"",onChange:T=>r({...t,target_column:T.target.value}),children:[e.jsx("option",{value:"",children:"Select Target..."}),b.map(T=>e.jsx("option",{value:T,children:T},T))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for supervised selection methods."})]}),(k||S)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Problem Type"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.problem_type??"auto",onChange:T=>r({...t,problem_type:T.target.value}),children:[e.jsx("option",{value:"auto",children:"Auto-detect"}),e.jsx("option",{value:"classification",children:"Classification"}),e.jsx("option",{value:"regression",children:"Regression"})]})]}),j&&e.jsx(P,{})]}),e.jsxs("div",{className:`space-y-4 ${j?"overflow-y-auto pl-2 border-l":"shrink-0 border-t pt-4"}`,children:[e.jsx("h4",{className:"text-xs font-semibold uppercase text-muted-foreground mb-2",children:"Parameters"}),t.method==="variance_threshold"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Threshold"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 border rounded bg-background text-sm",value:t.threshold??0,onChange:T=>r({...t,threshold:parseFloat(T.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Features with variance lower than this will be removed."})]}),t.method==="correlation_threshold"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Threshold"}),e.jsx("input",{type:"number",step:"0.01",max:"1",min:"0",className:"w-full p-2 border rounded bg-background text-sm",value:t.threshold??.95,onChange:T=>r({...t,threshold:parseFloat(T.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.correlation_method??"pearson",onChange:T=>r({...t,correlation_method:T.target.value}),children:[e.jsx("option",{value:"pearson",children:"Pearson"}),e.jsx("option",{value:"spearman",children:"Spearman"}),e.jsx("option",{value:"kendall",children:"Kendall"})]})]})]}),k&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Scoring Function"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.score_func??"",onChange:T=>r({...t,score_func:T.target.value}),children:[e.jsx("option",{value:"",children:"Auto (Default)"}),N().map(T=>e.jsx("option",{value:T.value,children:T.label},T.value))]})]}),(t.method==="select_k_best"||t.method==="rfe")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"K (Number of Features)"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.k??10,onChange:T=>r({...t,k:parseInt(T.target.value)})})]}),t.method==="select_percentile"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Percentile"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.percentile??10,onChange:T=>r({...t,percentile:parseInt(T.target.value)})})]}),["select_fpr","select_fdr","select_fwe"].includes(t.method)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Alpha (Significance)"}),e.jsx("input",{type:"number",step:"0.001",className:"w-full p-2 border rounded bg-background text-sm",value:t.alpha??.05,onChange:T=>r({...t,alpha:parseFloat(T.target.value)})})]}),t.method==="generic_univariate_select"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Mode"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.mode??"k_best",onChange:T=>r({...t,mode:T.target.value}),children:[e.jsx("option",{value:"k_best",children:"K Best"}),e.jsx("option",{value:"percentile",children:"Percentile"}),e.jsx("option",{value:"fpr",children:"FPR"}),e.jsx("option",{value:"fdr",children:"FDR"}),e.jsx("option",{value:"fwe",children:"FWE"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Parameter"}),e.jsx("input",{type:"number",step:"0.001",className:"w-full p-2 border rounded bg-background text-sm",value:t.param??1e-5,onChange:T=>r({...t,param:parseFloat(T.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value for the selected mode (e.g., k, percentile, or alpha)."})]})]}),S&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Estimator"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.estimator??"auto",onChange:T=>r({...t,estimator:T.target.value}),children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"RandomForest",children:"Random Forest"}),e.jsx("option",{value:"LogisticRegression",children:"Logistic Regression"}),e.jsx("option",{value:"LinearRegression",children:"Linear Regression"})]})]}),t.method==="select_from_model"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Threshold"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded bg-background text-sm",placeholder:"e.g., median, mean, 1.25*mean",value:t.threshold??"median",onChange:T=>r({...t,threshold:T.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'String (e.g. "median") or float.'})]}),t.method==="rfe"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Step"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded bg-background text-sm",value:t.step??1,onChange:T=>r({...t,step:parseInt(T.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Features to remove at each iteration."})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2 border-t",children:[e.jsx("input",{type:"checkbox",id:"drop_columns",className:"rounded border-gray-300",checked:t.drop_columns!==!1,onChange:T=>r({...t,drop_columns:T.target.checked})}),e.jsx("label",{htmlFor:"drop_columns",className:"text-sm font-medium",children:"Drop Columns"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If unchecked, columns will be identified but not removed from the dataset."}),!j&&e.jsx(P,{})]})]})]})},Dj={type:"feature_selection",label:"Feature Selection",category:"Preprocessing",description:"Select the most important features.",icon:Hc,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Selected",type:"dataset"}],settings:Aj,validate:t=>t.method!=="variance_threshold"&&!t.target_column?{isValid:!1,message:"Target column is required for this method."}:{isValid:!0},getDefaultConfig:()=>({method:"select_k_best",k:10})},Ij=({config:t,onChange:r,nodeId:a})=>{var j,w;const i=He(a||""),o=(j=i.find(N=>N.datasetId))==null?void 0:j.datasetId,l=(w=i.find(N=>N.target_column))==null?void 0:w.target_column;ft.useEffect(()=>{const N={};o&&t.datasetId!==o&&(N.datasetId=o),l&&t.target_column!==l&&(N.target_column=l),Object.keys(N).length>0&&r({...t,...N})},[o,l,t.datasetId,t.target_column,r]);const{data:c,isLoading:m}=ze(o||t.datasetId),u=c?Object.values(c.columns).map(N=>N.name):[],h=t.validation_size||0,p=1-t.test_size-h,g=ft.useRef(null),[b,y]=ft.useState(!1);return ft.useEffect(()=>{if(!g.current)return;const N=new ResizeObserver(k=>{for(const S of k)y(S.contentRect.width>450)});return N.observe(g.current),()=>{N.disconnect()}},[]),e.jsxs("div",{ref:g,className:`flex flex-col h-full w-full bg-background ${b?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:[!o&&!t.datasetId&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),m&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."})]}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${b?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${b?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Test Size (0.0 - 1.0)"}),e.jsx("input",{type:"number",step:"0.05",min:"0.05",max:"0.95",className:"w-full p-2 border rounded bg-background text-sm",value:t.test_size,onChange:N=>r({...t,test_size:parseFloat(N.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Validation Size (0.0 - 1.0)"}),e.jsx("input",{type:"number",step:"0.05",min:"0.00",max:"0.95",className:"w-full p-2 border rounded bg-background text-sm",value:h,onChange:N=>r({...t,validation_size:parseFloat(N.target.value)})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(p*100),"% Training, ",Math.round(h*100),"% Validation, ",Math.round(t.test_size*100),"% Testing"]}),p<=0&&e.jsx("p",{className:"text-xs text-red-500 font-medium",children:"Error: Total split size exceeds 100%"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Random State"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.random_state,onChange:N=>r({...t,random_state:parseInt(N.target.value)})})]})]}),e.jsxs("div",{className:`space-y-4 ${b?"overflow-y-auto pl-2 border-l":"shrink-0 pt-4 border-t"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"shuffle",checked:t.shuffle,onChange:N=>r({...t,shuffle:N.target.checked})}),e.jsx("label",{htmlFor:"shuffle",className:"text-sm font-medium",children:"Shuffle Data"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"stratify",checked:t.stratify,onChange:N=>r({...t,stratify:N.target.checked})}),e.jsx("label",{htmlFor:"stratify",className:"text-sm font-medium",children:"Stratify by Target"})]}),e.jsxs("div",{className:"space-y-2 pl-6 border-l-2 border-muted",children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Column"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column??"",onChange:N=>r({...t,target_column:N.target.value}),disabled:!t.stratify,children:[e.jsx("option",{value:"",children:"-- Select Target --"}),u.map(N=>e.jsx("option",{value:N,children:N},N))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for stratification. If input is already separated (X, y), this is ignored."})]})]})]})]})},Oj={type:"TrainTestSplitter",label:"Train-Test Split",category:"Preprocessing",description:"Split data into training and testing sets.",icon:qo,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"train",label:"Train",type:"dataset"},{id:"validation",label:"Validation",type:"dataset"},{id:"test",label:"Test",type:"dataset"}],settings:Ij,validate:t=>{if(t.test_size<=0||t.test_size>=1)return{isValid:!1,message:"Test size must be between 0 and 1."};const r=t.validation_size||0;return r<0||r>=1?{isValid:!1,message:"Validation size must be between 0 and 1."}:t.test_size+r>=1?{isValid:!1,message:"Sum of Test and Validation sizes must be less than 1."}:{isValid:!0}},getDefaultConfig:()=>({test_size:.2,validation_size:0,random_state:42,stratify:!1,shuffle:!0})},zj=({config:t,onChange:r,nodeId:a})=>{const i=je(h=>h.nodes),o=je(h=>h.edges),c=(h=>{var b;const p=new Set,g=[h];for(;g.length>0;){const y=g.shift();if(!y||p.has(y))continue;p.add(y);const j=i.find(N=>N.id===y);if(!j)continue;if(y!==h&&((b=j.data)!=null&&b.datasetId))return j.data.datasetId;const w=Er(j,i,o);for(const N of w)g.push(N.id)}})(a||"");ft.useEffect(()=>{c&&t.datasetId!==c&&r({...t,datasetId:c})},[c,t.datasetId,r]);const{data:m}=ze(c||t.datasetId),u=m?Object.values(m.columns).map(h=>h.name):[];return e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Column"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column,onChange:h=>r({...t,target_column:h.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Target --"}),u.map(h=>e.jsx("option",{value:h,children:h},h))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This column will be separated as the target (y), and all other columns will be features (X)."})]})})},Fj={type:"feature_target_split",label:"Feature-Target Split",category:"Preprocessing",description:"Separate features (X) from target (y).",icon:qo,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"X",label:"Features (X)",type:"dataset"},{id:"y",label:"Target (y)",type:"dataset"}],settings:zj,validate:t=>t.target_column?{isValid:!0}:{isValid:!1,message:"Target column is required."},getDefaultConfig:()=>({target_column:""})},Bj=({config:t,onChange:r,nodeId:a})=>{var h;const o=(h=He(a||"").find(p=>p.datasetId))==null?void 0:h.datasetId,{isLoading:l}=ze(o),c=je(p=>p.executionResult),m=a?c==null?void 0:c.node_results[a]:null,u=m!=null&&m.metrics&&typeof m.metrics=="object"?m.metrics:null;return e.jsxs("div",{className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),l&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx("input",{type:"checkbox",checked:t.drop_if_any_missing,onChange:p=>r({...t,drop_if_any_missing:p.target.checked}),className:"rounded border-gray-300"}),"Drop rows with ANY missing values"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If checked, any row containing at least one missing value will be removed."})]}),e.jsxs("div",{className:`space-y-2 ${t.drop_if_any_missing?"opacity-50 pointer-events-none":""}`,children:[e.jsx("label",{className:"block text-sm font-medium",children:"Missing Value Threshold (%)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:t.missing_threshold||0,onChange:p=>r({...t,missing_threshold:parseInt(p.target.value)}),className:"flex-1"}),e.jsxs("span",{className:"text-sm w-12 text-right",children:[t.missing_threshold||0,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Drop rows that have more than this percentage of missing values."})]}),u&&u.DropMissingRows_rows_removed!==void 0&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Removed:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(u.DropMissingRows_rows_removed)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Remaining:"}),e.jsx("span",{className:"font-medium",children:String(u.DropMissingRows_rows_remaining)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Rows:"}),e.jsx("span",{className:"font-medium",children:String(u.DropMissingRows_rows_total)})]})]})]})]})},$j={type:"drop_missing_rows",label:"Drop Rows",category:"Preprocessing",description:"Drop rows based on missing values.",icon:Mx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:Bj,validate:t=>({isValid:!0}),getDefaultConfig:()=>({drop_if_any_missing:!1,missing_threshold:50})},Zj=({config:t,onChange:r,nodeId:a})=>{var N;const o=(N=He(a||"").find(k=>k.datasetId))==null?void 0:N.datasetId,{data:l,isLoading:c}=ze(o),m=l?Object.values(l.columns).map(k=>k.name):[],u=je(k=>k.executionResult),h=a?u==null?void 0:u.node_results[a]:null,p=h!=null&&h.metrics&&typeof h.metrics=="object"?h.metrics:null,[g,b]=f.useState(""),y=f.useMemo(()=>m.filter(k=>k.toLowerCase().includes(g.toLowerCase())),[m,g]),j=()=>{r({...t,subset:y})},w=()=>{const k=t.subset.filter(S=>!y.includes(S));r({...t,subset:k})};return e.jsxs("div",{className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Keep Strategy"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.keep,onChange:k=>r({...t,keep:k.target.value}),children:[e.jsx("option",{value:"first",children:"Keep First Occurrence"}),e.jsx("option",{value:"last",children:"Keep Last Occurrence"}),e.jsx("option",{value:"none",children:"Drop All Duplicates"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Determines which duplicates (if any) to keep."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Subset Columns (Optional)"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.subset.length," selected"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Only consider these columns for identifying duplicates. If empty, all columns are used."}),e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full px-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary outline-none",value:g,onChange:k=>{b(k.target.value)}}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:j,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:w,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),m.length>0?e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto border rounded p-2 bg-background",children:[y.map(k=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary focus:ring-primary",checked:t.subset.includes(k),onChange:S=>{const P=S.target.checked?[...t.subset,k]:t.subset.filter(E=>E!==k);r({...t,subset:P})}}),k]},k)),y.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:['No columns match "',g,'"']})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic border rounded p-4 text-center",children:"No columns available"})]}),p&&p.Deduplicate_rows_removed!==void 0&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Duplicates Removed:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(p.Deduplicate_rows_removed)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Remaining:"}),e.jsx("span",{className:"font-medium",children:String(p.Deduplicate_rows_remaining)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Rows:"}),e.jsx("span",{className:"font-medium",children:String(p.Deduplicate_rows_total)})]})]})]})]})},Uj={type:"deduplicate",label:"Deduplicate",category:"Preprocessing",description:"Remove duplicate rows.",icon:Ax,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Unique Data",type:"dataset"}],settings:Zj,validate:t=>({isValid:!0}),getDefaultConfig:()=>({subset:[],keep:"first"})},Hj=[{value:"float",label:"Float (Decimal)"},{value:"int",label:"Integer"},{value:"string",label:"String (Text)"},{value:"category",label:"Category"},{value:"bool",label:"Boolean"},{value:"datetime",label:"Datetime"}],Wj=({config:t,onChange:r,nodeId:a})=>{var S;const o=(S=He(a||"").find(P=>P.datasetId))==null?void 0:S.datasetId,{data:l,isLoading:c}=ze(o),m=l?Object.values(l.columns).map(P=>P.name):[],u=je(P=>P.executionResult),h=a?u==null?void 0:u.node_results[a]:null,p=h!=null&&h.metrics&&typeof h.metrics=="object"?h.metrics:null,g=f.useRef(null),[b,y]=f.useState(!1);f.useEffect(()=>{if(!g.current)return;const P=new ResizeObserver(E=>{for(const T of E)y(T.contentRect.width>450)});return P.observe(g.current),()=>{P.disconnect()}},[]);const j=()=>{if(m.length===0)return;const P=m.find(E=>!t.column_types[E])||m[0];r({...t,column_types:{...t.column_types,[P]:"float"}})},w=P=>{const E={...t.column_types};Reflect.deleteProperty(E,P),r({...t,column_types:E})},N=(P,E)=>{if(P===E)return;const T=t.column_types[P],D={...t.column_types};Reflect.deleteProperty(D,P),D[E]=T,r({...t,column_types:D})},k=(P,E)=>{r({...t,column_types:{...t.column_types,[P]:E}})};return e.jsxs("div",{ref:g,className:"p-4 space-y-4 h-full overflow-y-auto",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Casting Rules"}),e.jsx("button",{onClick:j,disabled:!o||m.length===0,className:"p-1.5 bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 transition-colors",title:"Add Casting Rule",children:e.jsx(Yt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:`space-y-2 ${b?"grid grid-cols-2 gap-2 space-y-0":""}`,children:[Object.entries(t.column_types).map(([P,E])=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-muted/10 group",children:[e.jsxs("div",{className:"flex-1 space-y-2 min-w-0",children:[e.jsx("select",{className:"w-full p-1.5 text-sm border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:P,onChange:T=>{N(P,T.target.value)},children:m.map(T=>e.jsx("option",{value:T,disabled:T!==P&&!!t.column_types[T],children:T},T))}),e.jsx("select",{className:"w-full p-1.5 text-sm border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:E,onChange:T=>{k(P,T.target.value)},children:Hj.map(T=>e.jsx("option",{value:T.value,children:T.label},T.value))})]}),e.jsx("button",{onClick:()=>{w(P)},className:"p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded transition-colors",title:"Remove Rule",children:e.jsx(or,{className:"w-4 h-4"})})]},P)),Object.keys(t.column_types).length===0&&e.jsx("div",{className:`text-xs text-muted-foreground italic border border-dashed rounded p-8 text-center ${b?"col-span-2":""}`,children:"No casting rules defined. Click + to add one."})]})]}),p&&(p.cast_errors!==void 0||p.casted_columns_count!==void 0)&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[p.casted_columns_count!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Columns Casted:"}),e.jsx("span",{className:"font-medium",children:String(p.casted_columns_count)})]}),p.cast_errors!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Errors Encountered:"}),e.jsx("span",{className:"font-medium text-destructive",children:String(p.cast_errors)})]})]})]})]})},Vj={type:"casting",label:"Cast Types",category:"Preprocessing",description:"Cast columns to specific data types.",icon:Dx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Casted Data",type:"dataset"}],settings:Wj,validate:t=>({isValid:!0}),getDefaultConfig:()=>({column_types:{}})},qj=({config:t,onChange:r,nodeId:a})=>{var N;const o=(N=He(a||"").find(k=>k.datasetId))==null?void 0:N.datasetId,{data:l,isLoading:c}=ze(o),m=l?Object.values(l.columns).map(k=>k.name):[],u=je(k=>k.executionResult),h=a?u==null?void 0:u.node_results[a]:null,p=h!=null&&h.metrics&&typeof h.metrics=="object"?h.metrics:null,[g,b]=f.useState(""),y=f.useMemo(()=>m.filter(k=>k.toLowerCase().includes(g.toLowerCase())),[m,g]),j=()=>{r({...t,columns:y})},w=()=>{const k=t.columns.filter(S=>!y.includes(S));r({...t,columns:k})};return e.jsxs("div",{className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Indicator Suffix"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.flag_suffix,onChange:k=>r({...t,flag_suffix:k.target.value}),placeholder:"_was_missing"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Suffix added to the new indicator columns (e.g., "Age_was_missing").'})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Target Columns (Optional)"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Create indicators for these columns. If empty, all columns with missing values are used."}),e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full px-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary outline-none",value:g,onChange:k=>{b(k.target.value)}}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:j,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:w,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),m.length>0?e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto border rounded p-2 bg-background",children:[y.map(k=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary focus:ring-primary",checked:t.columns.includes(k),onChange:S=>{const P=S.target.checked?[...t.columns,k]:t.columns.filter(E=>E!==k);r({...t,columns:P})}}),k]},k)),y.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:['No columns match "',g,'"']})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic border rounded p-4 text-center",children:"No columns available"})]}),(()=>{const k=p==null?void 0:p.missing_indicators_created,S=Array.isArray(p==null?void 0:p.missing_indicators_columns)?p==null?void 0:p.missing_indicators_columns:[];return k===void 0?null:e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Indicators Created:"}),e.jsx("span",{className:"font-medium text-primary",children:String(k)})]}),S.length>0&&e.jsxs("div",{className:"pt-1 border-t mt-1",children:[e.jsx("span",{className:"text-muted-foreground block mb-1",children:"New Columns:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:S.map(P=>{const E=String(P);return e.jsx("span",{className:"px-1.5 py-0.5 bg-background border rounded text-[10px] font-mono",children:E},E)})})]})]})]})})()]})},Gj={type:"MissingIndicator",label:"Missing Indicator",category:"Preprocessing",description:"Create binary indicators for missing values.",icon:Ix,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Augmented Data",type:"dataset"}],settings:qj,validate:t=>({isValid:!0}),getDefaultConfig:()=>({columns:[],flag_suffix:"_was_missing"})},Kj=({config:t,onChange:r,nodeId:a})=>{var R;const o=(R=He(a||"").find(_=>_.datasetId))==null?void 0:R.datasetId,{data:l,isLoading:c}=ze(o),[m,u]=f.useState(""),h=f.useRef(null),[p,g]=f.useState(!1),b=je(_=>_.executionResult),y=a?b==null?void 0:b.node_results[a]:null,j=y!=null&&y.metrics&&typeof y.metrics=="object"?y.metrics:null,w=j!=null&&j.categories_count&&typeof j.categories_count=="object"?j.categories_count:null,N=j!=null&&j.classes_count&&typeof j.classes_count=="object"?j.classes_count:null,S=((b==null?void 0:b.recommendations)||[]).filter(_=>_.suggested_node_type==="encoding"||_.type.includes("encoding")||_.type.includes("cardinality"));f.useEffect(()=>{if(!h.current)return;const _=new ResizeObserver(M=>{for(const I of M)g(I.contentRect.width>400)});return _.observe(h.current),()=>{_.disconnect()}},[]);const P=l?Object.values(l.columns).filter(_=>["object","string","category","bool"].some(M=>_.dtype.toLowerCase().includes(M))).map(_=>_.name):[],E=P.filter(_=>_.toLowerCase().includes(m.toLowerCase())),T=()=>{r({...t,columns:[...P]})},D=()=>{r({...t,columns:[]})};return e.jsxs("div",{ref:h,className:"p-4 space-y-4",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),c&&!!o&&e.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Loading schema..."}),e.jsxs("div",{className:`grid gap-4 ${p?"grid-cols-2":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Encoding Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.method,onChange:_=>r({...t,method:_.target.value}),children:[e.jsx("option",{value:"onehot",children:"One-Hot Encoding"}),e.jsx("option",{value:"dummy",children:"Dummy Encoding"}),e.jsx("option",{value:"label",children:"Label Encoding"}),e.jsx("option",{value:"ordinal",children:"Ordinal Encoding"}),e.jsx("option",{value:"target",children:"Target Encoding"}),e.jsx("option",{value:"hash",children:"Hash Encoding"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.method==="onehot"&&"Creates binary columns for each category.",t.method==="dummy"&&"Like One-Hot but drops first category to avoid collinearity.",t.method==="label"&&"Assigns a unique integer to each category.",t.method==="ordinal"&&"Encodes categories as ordered integers.",t.method==="target"&&"Encodes categories based on target mean.",t.method==="hash"&&"Maps categories to a fixed number of features."]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.drop_original!==!1,onChange:_=>r({...t,drop_original:_.target.checked}),className:"rounded border-gray-300"}),"Drop Original Column"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground ml-5",children:"If unchecked, keeps the original column alongside encoded features."})]})]}),e.jsxs("div",{className:"space-y-2",children:[(t.method==="onehot"||t.method==="dummy")&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.method==="dummy"?!0:t.drop_first||!1,disabled:t.method==="dummy",onChange:_=>r({...t,drop_first:_.target.checked}),className:"rounded border-gray-300"}),"Drop First Category"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium",children:"Handle Unknown"}),e.jsxs("select",{className:"w-full p-1 text-sm border rounded",value:t.handle_unknown||"ignore",onChange:_=>r({...t,handle_unknown:_.target.value}),title:"How to handle categories seen in test data but not in training data.",children:[e.jsx("option",{value:"ignore",children:"Ignore (Zeros)"}),e.jsx("option",{value:"error",children:"Raise Error"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:'"Ignore" produces all-zeros for unknown categories.'})]})]}),t.method==="target"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Target Column"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.target_column||"",onChange:_=>r({...t,target_column:_.target.value}),children:[e.jsx("option",{value:"",children:"Select a target column..."}),l&&Object.values(l.columns).map(_=>e.jsxs("option",{value:_.name,children:[_.name," (",_.dtype,")"]},_.name))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The column to use for calculating target statistics."})]}),t.method==="hash"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Number of Features"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded",value:t.n_features||8,onChange:_=>r({...t,n_features:parseInt(_.target.value)})})]}),t.method==="ordinal"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Unknown Value"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded",value:t.unknown_value??-1,onChange:_=>r({...t,unknown_value:parseInt(_.target.value)}),title:"Integer to assign for unknown categories."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value assigned to unknown categories (default: -1)."})]}),t.method==="label"&&e.jsxs("div",{className:"space-y-2 p-3 bg-muted/20 rounded border h-full",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Missing/Unknown Code"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded",value:t.missing_code??-1,onChange:_=>r({...t,missing_code:parseInt(_.target.value)}),title:"Integer to assign for missing or unknown categories."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value assigned to missing/unknown categories (default: -1)."})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Columns to Encode"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search columns...",className:"block w-full px-3 py-1.5 text-sm bg-background border rounded-md shadow-sm focus:ring-1 focus:ring-primary outline-none",value:m,onChange:_=>{u(_.target.value)}}),e.jsxs("div",{className:"flex gap-2 text-xs justify-end",children:[e.jsx("button",{onClick:T,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Select All"}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("button",{onClick:D,className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Deselect All"})]})]}),P.length>0?e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto border rounded p-2 bg-background",children:[E.map(_=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary focus:ring-primary",checked:t.columns.includes(_),onChange:M=>{const I=M.target.checked?[...t.columns,_]:t.columns.filter(O=>O!==_);r({...t,columns:I})}}),_]},_)),E.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:['No columns match "',m,'"']})]}):e.jsx("div",{className:"text-xs text-muted-foreground italic border rounded p-4 text-center",children:"No categorical columns found"})]}),S.length>0&&e.jsx(Ar,{recommendations:S}),j&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-semibold text-primary",children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[j.encoded_columns_count!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Columns Encoded:"}),e.jsx("span",{className:"font-medium",children:String(j.encoded_columns_count)})]}),j.new_features_count!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"New Features Created:"}),e.jsx("span",{className:"font-medium text-primary",children:String(j.new_features_count)})]}),w&&e.jsxs("div",{className:"mt-2 border-t pt-2",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Categories Found:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:Object.entries(w).map(([_,M])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:_,children:[_,":"]}),e.jsx("span",{className:"font-mono",children:String(M)})]},_))})]}),N&&e.jsxs("div",{className:"mt-2 border-t pt-2",children:[e.jsx("span",{className:"text-muted-foreground block mb-1 font-medium",children:"Classes Found:"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:Object.entries(N).map(([_,M])=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"truncate max-w-[100px]",title:_,children:[_,":"]}),e.jsx("span",{className:"font-mono",children:String(M)})]},_))})]})]})]})]})},Jj={type:"encoding",label:"Encoding",category:"Preprocessing",description:"Encode categorical variables.",icon:Wc,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Encoded Data",type:"dataset"}],settings:Kj,validate:t=>t.columns.length===0?{isValid:!1,error:"Select at least one column"}:{isValid:!0},getDefaultConfig:()=>({method:"onehot",columns:[],drop_first:!1,handle_unknown:"ignore",n_features:8,unknown_value:-1,missing_code:-1})},Qj=({config:t,onChange:r,nodeId:a})=>{const i=je(R=>R.nodes),o=je(R=>R.edges),c=(R=>{var I;const _=new Set,M=[R];for(;M.length>0;){const O=M.shift();if(!O||_.has(O))continue;_.add(O);const F=i.find(q=>q.id===O);if(!F)continue;if(O!==R&&((I=F.data)!=null&&I.datasetId))return F.data.datasetId;const B=Er(F,i,o);for(const q of B)M.push(q.id)}})(a||""),{data:m,isLoading:u}=ze(c),h=ba(a||"",{types:["outlier_removal","cleaning"],suggestedNodeTypes:["OutlierRemoval","outlier"],scope:"column"}),p=je(R=>R.executionResult),g=a?p==null?void 0:p.node_results[a]:null,b=f.useRef(null),[y,j]=f.useState(!1),[w,N]=f.useState("");f.useEffect(()=>{if(!b.current)return;const R=new ResizeObserver(_=>{for(const M of _)j(M.contentRect.width>450)});return R.observe(b.current),()=>{R.disconnect()}},[]);const k=m?Object.values(m.columns).filter(R=>["int","float","number"].some(_=>R.dtype.toLowerCase().includes(_))).map(R=>R.name):[],S=k.filter(R=>R.toLowerCase().includes(w.toLowerCase())),P=()=>{r({...t,columns:S})},E=()=>{const R=t.columns.filter(_=>!S.includes(_));r({...t,columns:R})},T=()=>{if(!g||!g.metrics)return null;const R=g.metrics,_=R.rows_removed,M=R.rows_remaining,I=R.rows_total??(_??0)+(M??0),O=R.bounds,F=R.stats,B=R.contamination,q=R.warnings,G=R.values_clipped;if(_===void 0&&!O&&!F&&B===void 0&&!q&&G===void 0)return null;const ee=()=>{switch(t.method){case"iqr":return"Removes statistical outliers (IQR)";case"zscore":return"Removes deviations > 3";case"winsorize":return"Clips extreme values";case"elliptic_envelope":return"Detects multivariate anomalies";default:return""}};return e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border text-xs space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Execution Feedback"}),e.jsx("div",{className:"text-[10px] text-primary/80 bg-primary/5 px-1.5 py-0.5 rounded border border-primary/10",title:"Goal of the selected method",children:ee()})]}),q&&q.length>0&&e.jsxs("div",{className:"p-2 bg-yellow-50 text-yellow-800 rounded border border-yellow-200",children:[e.jsx("div",{className:"font-medium mb-1",children:"Warnings"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:q.map((te,W)=>e.jsx("li",{className:"truncate",title:te,children:te},W))})]}),t.method==="winsorize"?e.jsxs("div",{className:"flex justify-between items-center p-2 bg-background rounded border",children:[e.jsx("span",{className:"text-muted-foreground",children:"Values Clipped"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-mono font-medium text-blue-600",children:G??0}),e.jsx("span",{className:"text-[10px] text-muted-foreground block",children:"(Replaced with bounds)"})]})]}):e.jsxs("div",{className:"flex justify-between items-center p-2 bg-background rounded border",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rows Removed"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:"font-mono font-medium text-destructive",children:_??0}),I>0&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",((_??0)/I*100).toFixed(1),"%)"]})]}),M!==void 0&&e.jsxs("span",{className:"text-[10px] text-muted-foreground block",children:[M," remaining"]})]})]}),B!==void 0&&e.jsxs("div",{className:"flex justify-between items-center p-2 bg-background rounded border",children:[e.jsx("span",{className:"text-muted-foreground",children:"Contamination"}),e.jsxs("span",{className:"font-mono font-medium",children:[(B*100).toFixed(1),"%"]})]}),O&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1",children:"Calculated Bounds"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-background p-2 rounded border space-y-1",children:Object.entries(O).map(([te,W])=>e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[100px] font-medium",title:te,children:te}),e.jsxs("span",{className:"font-mono text-[10px] text-muted-foreground",children:["[",W.lower.toFixed(2),", ",W.upper.toFixed(2),"]"]})]},te))})]}),F&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-muted-foreground mb-1",children:"Z-Score Stats"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-background p-2 rounded border space-y-1",children:Object.entries(F).map(([te,W])=>e.jsxs("div",{className:"flex justify-between items-center border-b border-border/50 last:border-0 pb-1 last:pb-0",children:[e.jsx("span",{className:"truncate max-w-[100px] font-medium",title:te,children:te}),e.jsxs("span",{className:"font-mono text-[10px] text-muted-foreground",children:["=",W.mean.toFixed(2),", =",W.std.toFixed(2)]})]},te))})]})]})},D=()=>{const R=[];if(g&&g.metrics){const M=g.metrics,I=M.rows_removed,F=M.rows_total??M[`${t.method==="elliptic_envelope"?"EllipticEnvelope":t.method==="zscore"?"ZScore":t.method==="winsorize"?"Winsorize":"IQR"}_rows_total`];if(I!==void 0&&F!==void 0&&F>0){const B=I/F;B>.2?R.push({rule_id:"high_data_loss",type:"warning",description:"High data loss (>20%).",reasoning:"Consider relaxing parameters (e.g., higher IQR multiplier or Z-Score threshold) or using Winsorization to clip values instead of removing rows.",suggested_node_type:"OutlierRemoval",suggested_params:{},confidence:1,target_columns:[]}):B===0&&t.method!=="winsorize"&&R.push({rule_id:"no_outliers",type:"info",description:"No outliers detected.",reasoning:"If you suspect outliers, try tightening the parameters (e.g., lower IQR multiplier).",suggested_node_type:"OutlierRemoval",suggested_params:{},confidence:1,target_columns:[]})}t.method==="elliptic_envelope"&&R.push({rule_id:"elliptic_stochastic",type:"info",description:"Stochastic Method",reasoning:"Elliptic Envelope is stochastic. Results may vary slightly between runs.",suggested_node_type:"OutlierRemoval",suggested_params:{},confidence:1,target_columns:[]})}const _=[...h,...R];return _.length===0?null:e.jsx("div",{className:"mt-4",children:e.jsx(Ar,{recommendations:_})})};return e.jsxs("div",{ref:b,className:`flex flex-col h-full w-full bg-background ${y?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsx("div",{className:"shrink-0 p-4 pb-0 space-y-2",children:!c&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."})}),e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${y?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${y?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Method"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background text-sm",value:t.method,onChange:R=>r({...t,method:R.target.value}),children:[e.jsx("option",{value:"iqr",children:"IQR (Interquartile Range)"}),e.jsx("option",{value:"zscore",children:"Z-Score (Standard Deviation)"}),e.jsx("option",{value:"winsorize",children:"Winsorize (Clip Values)"}),e.jsx("option",{value:"elliptic_envelope",children:"Elliptic Envelope (Multivariate)"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:[t.method==="iqr"&&"Removes rows with values outside Q1/Q3  multiplier * IQR.",t.method==="zscore"&&"Removes rows with values more than N standard deviations from mean.",t.method==="winsorize"&&"Clips values to specified percentiles instead of removing rows.",t.method==="elliptic_envelope"&&"Fits a robust covariance estimate to detect outliers."]})]}),t.method==="iqr"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Multiplier"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full p-2 border rounded bg-background text-sm",value:t.multiplier??1.5,onChange:R=>r({...t,multiplier:parseFloat(R.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usually 1.5 for outliers, 3.0 for extreme outliers."})]}),t.method==="zscore"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Threshold (Sigma)"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full p-2 border rounded bg-background text-sm",value:t.threshold??3,onChange:R=>r({...t,threshold:parseFloat(R.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of standard deviations to tolerate."})]}),t.method==="winsorize"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Percentiles"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-muted-foreground",children:"Lower"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.lower_percentile??5,onChange:R=>r({...t,lower_percentile:parseFloat(R.target.value)})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-muted-foreground",children:"Upper"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded bg-background text-sm",value:t.upper_percentile??95,onChange:R=>r({...t,upper_percentile:parseFloat(R.target.value)})})]})]})]}),t.method==="elliptic_envelope"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Contamination"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"0.5",className:"w-full p-2 border rounded bg-background text-sm",value:t.contamination??.01,onChange:R=>r({...t,contamination:parseFloat(R.target.value)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Expected proportion of outliers in the dataset."})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx(D,{})]})]}),e.jsxs("div",{className:`flex flex-col h-full min-h-[200px] border rounded-md overflow-hidden ${y?"":"shrink-0"}`,children:[e.jsxs("div",{className:"p-2 border-b bg-muted/30 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Numeric Columns (",t.columns.length,")"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:P,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"All"}),e.jsx("button",{onClick:E,className:"text-[10px] px-2 py-1 hover:bg-accent rounded",children:"None"})]})]}),e.jsx("input",{type:"text",placeholder:"Search columns...",className:"w-full text-xs p-1.5 border rounded bg-background",value:w,onChange:R=>{N(R.target.value)}})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:S.length>0?S.map(R=>e.jsxs("label",{className:"flex items-center gap-2 text-sm hover:bg-accent/50 p-1.5 rounded cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(R),onChange:_=>{const M=_.target.checked?[...t.columns,R]:t.columns.filter(I=>I!==R);r({...t,columns:M})},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:R,children:R})]},R)):e.jsx("div",{className:"text-xs text-muted-foreground italic p-4 text-center",children:u?"Loading schema...":k.length===0?"No numeric columns found":"No matches found"})})]}),!y&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx(D,{})]})]})]})},Yj={type:"outlier",label:"Outlier Removal",category:"Preprocessing",description:"Detect and remove or clip outliers.",icon:Ox,inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Cleaned"}],settings:Qj,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:{isValid:!0},getDefaultConfig:()=>({method:"iqr",columns:[],multiplier:1.5,threshold:3,lower_percentile:5,upper_percentile:95,contamination:.01})},oo={power:{label:"Power Transforms",methods:[{value:"yeo-johnson",label:"Yeo-Johnson"},{value:"box-cox",label:"Box-Cox (>0 only)"}]},simple:{label:"Simple Math",methods:[{value:"log",label:"Log (log1p)"},{value:"square_root",label:"Square Root"},{value:"cube_root",label:"Cube Root"},{value:"reciprocal",label:"Reciprocal (1/x)"},{value:"square",label:"Square (x)"},{value:"exponential",label:"Exponential (e)"}]}},Xj=t=>["yeo-johnson","box-cox"].includes(t)?"power":"simple",e_=({allColumns:t,selectedColumns:r,onChange:a})=>{const[i,o]=f.useState(""),l=f.useMemo(()=>t.filter(h=>h.toLowerCase().includes(i.toLowerCase())),[t,i]),c=()=>{const h=Array.from(new Set([...r,...l]));a(h)},m=()=>{const h=r.filter(p=>!l.includes(p));a(h)},u=h=>{r.includes(h)?a(r.filter(p=>p!==h)):a([...r,h])};return e.jsxs("div",{className:"space-y-2 border rounded p-2 bg-background",children:[e.jsx("div",{className:"flex gap-2 items-center",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-2 top-1.5 w-3 h-3 text-muted-foreground"}),e.jsx("input",{className:"w-full pl-7 pr-2 py-1 text-xs border rounded bg-background",placeholder:"Search columns...",value:i,onChange:h=>{o(h.target.value)}})]})}),e.jsxs("div",{className:"flex gap-2 text-xs border-b pb-2",children:[e.jsx("button",{onClick:c,className:"text-primary hover:underline font-medium",children:"Select All"}),e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsx("button",{onClick:m,className:"text-muted-foreground hover:underline",children:"None"}),e.jsxs("span",{className:"ml-auto text-muted-foreground",children:[r.length," selected"]})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 pt-1",children:l.length===0?e.jsxs("div",{className:"text-xs text-muted-foreground p-2 text-center",children:['No columns match "',i,'"']}):l.map(h=>e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer hover:bg-accent/50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.includes(h),onChange:()=>{u(h)},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:h,children:h})]},h))})]})},t_=({config:t,onChange:r,nodeId:a})=>{var E;const i=f.useMemo(()=>t||{transformations:[]},[t]),o=f.useMemo(()=>Array.isArray(i.transformations)?i.transformations:[],[i.transformations]),[l,c]=f.useState([]),m=f.useRef(null),[u,h]=f.useState(!1);f.useEffect(()=>{if(!m.current)return;const T=new ResizeObserver(D=>{for(const R of D)h(R.contentRect.width>450)});return T.observe(m.current),()=>{T.disconnect()}},[]);const g=(E=He(a||"").find(T=>T.datasetId))==null?void 0:E.datasetId,{data:b}=ze(g),y=f.useMemo(()=>b!=null&&b.columns?Object.values(b.columns).filter(T=>["int","float","number"].some(D=>T.dtype.toLowerCase().includes(D))).map(T=>T.name):[],[b]),j=()=>{const T=o.length;c(D=>[...D,T]),r({transformations:[...o,{columns:[],method:"log",params:{}}]})},w=(T,D)=>{const R=[...o];R[T]={...R[T],...D},r({transformations:R})},N=T=>{const D=[...o];D.splice(T,1),r({transformations:D}),c(R=>R.filter(_=>_!==T).map(_=>_>T?_-1:_))},k=T=>{c(D=>D.includes(T)?D.filter(R=>R!==T):[...D,T])},S=(T,D)=>{const R=oo[D].methods[0].value;w(T,{method:R})},P=ba(a||"",{types:["transformation","preprocessing"],suggestedNodeTypes:["TransformationNode"],scope:"column"});return e.jsxs("div",{ref:m,className:"p-4 space-y-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium",children:"Transformation Rules"}),e.jsxs("button",{onClick:j,className:"flex items-center gap-1 text-xs bg-primary text-primary-foreground px-2 py-1 rounded hover:bg-primary/90",children:[e.jsx(Yt,{size:12})," Add Rule"]})]}),e.jsxs("div",{className:"space-y-4",children:[o.map((T,D)=>{var I,O,F;const R=Xj(T.method),_=l.includes(D),M=((I=oo[R].methods.find(B=>B.value===T.method))==null?void 0:I.label)||T.method;return e.jsxs("div",{className:"border rounded bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>{k(D)},children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[_?e.jsx(De,{size:16,className:"text-muted-foreground flex-shrink-0"}):e.jsx(Pt,{size:16,className:"text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:M}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:T.columns.length===0?"No columns selected":`${T.columns.length} columns`})]})]}),e.jsx("button",{onClick:B=>{B.stopPropagation(),N(D)},className:"text-destructive hover:bg-destructive/10 p-1.5 rounded flex-shrink-0",title:"Remove rule",children:e.jsx(or,{size:14})})]}),_&&e.jsxs("div",{className:`p-3 border-t bg-accent/5 animate-in slide-in-from-top-2 duration-200 ${u?"grid grid-cols-2 gap-4":"space-y-3"}`,children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Method"}),e.jsxs("select",{className:"w-full p-1.5 border rounded text-xs bg-background font-medium",value:R,onChange:B=>{S(D,B.target.value)},onClick:B=>{B.stopPropagation()},children:[e.jsx("option",{value:"simple",children:"Simple Math"}),e.jsx("option",{value:"power",children:"Power Transform"})]}),e.jsx("select",{className:"w-full p-1.5 border rounded text-xs bg-background",value:T.method,onChange:B=>{w(D,{method:B.target.value})},onClick:B=>{B.stopPropagation()},children:oo[R].methods.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))})]}),(T.method==="yeo-johnson"||T.method==="box-cox")&&e.jsxs("div",{className:"flex items-center gap-2 pt-1",onClick:B=>{B.stopPropagation()},children:[e.jsx("input",{type:"checkbox",id:`std-${D}`,checked:((O=T.params)==null?void 0:O.standardize)!==!1,onChange:B=>{w(D,{params:{...T.params,standardize:B.target.checked}})}}),e.jsx("label",{htmlFor:`std-${D}`,className:"text-xs text-muted-foreground",children:"Standardize result"})]}),T.method==="exponential"&&e.jsxs("div",{className:"flex flex-col gap-1 pt-1",onClick:B=>{B.stopPropagation()},children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Clip Threshold:"}),e.jsx("input",{type:"number",className:"w-full p-1 border rounded text-xs",value:((F=T.params)==null?void 0:F.clip_threshold)||700,onChange:B=>{w(D,{params:{...T.params,clip_threshold:parseFloat(B.target.value)}})}})]})]}),e.jsxs("div",{className:"space-y-1 min-w-0",onClick:B=>{B.stopPropagation()},children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Target Columns"}),e.jsx(e_,{allColumns:y,selectedColumns:T.columns,onChange:B=>{w(D,{columns:B})}})]})]})]},D)}),o.length===0&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-8 border border-dashed rounded bg-muted/20",children:["No transformation rules defined.",e.jsx("br",{}),'Click "Add Rule" to start.']})]}),e.jsx(Ar,{recommendations:P||[],onApply:T=>{var M;const D=T,R=D.suggested_params.method||((M=D.params)==null?void 0:M.method)||"log",_=D.target_columns||[];if(_.length>0){const I=o.length;c(O=>[...O,I]),r({transformations:[...o,{columns:_,method:R,params:{}}]})}}})]})},s_={type:"TransformationNode",label:"Transformation",description:"Apply mathematical transformations to features.",icon:Gc,category:"Preprocessing",inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Transformed"}],validate:t=>{if(t.transformations.length===0)return{isValid:!1,message:"Add at least one transformation rule."};for(const r of t.transformations)if(r.columns.length===0)return{isValid:!1,message:"Each rule must have at least one column selected."};return{isValid:!0}},settings:t_,getDefaultConfig:()=>({transformations:[]})},r_=({value:t,onChange:r})=>{const[a,i]=f.useState((t==null?void 0:t.join(", "))||""),o=f.useRef(t);f.useEffect(()=>{JSON.stringify(t)!==JSON.stringify(o.current)&&(i((t==null?void 0:t.join(", "))||""),o.current=t)},[t]);const l=()=>{const c=a.split(",").map(m=>parseFloat(m.trim())).filter(m=>!isNaN(m)).sort((m,u)=>m-u);r(c)};return e.jsx("input",{type:"text",className:"w-full p-1 text-xs border rounded bg-background text-foreground",placeholder:"0, 10, 20, 100...",value:a,onChange:c=>{i(c.target.value)},onBlur:l})},a_=({config:t,onChange:r,nodeId:a})=>{var k;const o=(k=He(a||"").find(S=>S.datasetId))==null?void 0:k.datasetId,{data:l,isLoading:c}=ze(o),m=f.useRef(null),[u,h]=f.useState(!1),[p,g]=f.useState("");f.useEffect(()=>{if(!m.current)return;const S=new ResizeObserver(P=>{for(const E of P)h(E.contentRect.width>450)});return S.observe(m.current),()=>{S.disconnect()}},[]);const b=l?Object.values(l.columns).filter(S=>["int","float","number"].some(P=>S.dtype.toLowerCase().includes(P))).map(S=>S.name):[],y=b.filter(S=>S.toLowerCase().includes(p.toLowerCase())),j=()=>{r({...t,columns:y})},w=()=>{const S=t.columns.filter(P=>!y.includes(P));r({...t,columns:S})},N=S=>{t.columns.includes(S)?r({...t,columns:t.columns.filter(P=>P!==S)}):r({...t,columns:[...t.columns,S]})};return e.jsxs("div",{ref:m,className:"p-4 space-y-4 h-full overflow-y-auto",children:[!o&&e.jsx("div",{className:"p-2 bg-yellow-50 text-yellow-800 text-xs rounded border border-yellow-200",children:"Connect a dataset node to see available columns."}),e.jsxs("div",{className:`grid gap-4 ${u?"grid-cols-2":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Binning Strategy"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.strategy,onChange:S=>r({...t,strategy:S.target.value}),children:[e.jsx("option",{value:"equal_width",children:"Equal Width (Uniform)"}),e.jsx("option",{value:"equal_frequency",children:"Equal Frequency (Quantile)"}),e.jsx("option",{value:"kmeans",children:"K-Means Clustering"}),e.jsx("option",{value:"custom",children:"Custom Edges"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[t.strategy==="equal_width"&&"Bins have equal width ranges.",t.strategy==="equal_frequency"&&"Bins have equal number of records.",t.strategy==="kmeans"&&"Bins based on K-Means clustering centers.",t.strategy==="custom"&&"Define specific bin edges for each column."]})]}),t.strategy!=="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Number of Bins"}),e.jsx("input",{type:"number",min:2,max:100,className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.n_bins,onChange:S=>r({...t,n_bins:parseInt(S.target.value)||5})})]}),t.strategy==="custom"&&e.jsxs("div",{className:"space-y-2 border rounded p-2 bg-muted/10",children:[e.jsx("label",{className:"block text-xs font-medium",children:"Custom Edges"}),t.columns.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Select columns first."}):e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:t.columns.map(S=>{var P;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-medium",children:S}),e.jsx(r_,{value:(P=t.custom_bins)==null?void 0:P[S],onChange:E=>r({...t,custom_bins:{...t.custom_bins,[S]:E}})})]},S)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Label Format"}),e.jsxs("select",{className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.label_format,onChange:S=>r({...t,label_format:S.target.value}),children:[e.jsx("option",{value:"ordinal",children:"Ordinal (0, 1, 2...)"}),e.jsx("option",{value:"range",children:"Range Intervals ([0-10], [10-20]...)"}),e.jsx("option",{value:"bin_index",children:"Bin Index"})]})]}),t.label_format==="range"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Precision (Decimals)"}),e.jsx("input",{type:"number",min:0,max:10,className:"w-full p-2 border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:t.precision??3,onChange:S=>r({...t,precision:parseInt(S.target.value)||0})}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Number of decimal places to show in interval labels (e.g. 2 gives [0.00, 10.00])."})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"drop_original",checked:t.drop_original,onChange:S=>r({...t,drop_original:S.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("label",{htmlFor:"drop_original",className:"text-sm",children:"Drop Original Columns"})]}),!t.drop_original&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Output Suffix"}),e.jsx("input",{type:"text",className:"w-full p-1.5 border rounded text-xs",placeholder:"_binned",value:t.output_suffix||"",onChange:S=>r({...t,output_suffix:S.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-2 flex flex-col h-full min-h-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Target Columns"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{className:"w-full px-2 py-1 text-xs border rounded bg-background text-foreground",placeholder:"Search columns...",value:p,onChange:S=>{g(S.target.value)}})}),e.jsxs("div",{className:"flex gap-2 text-xs border-b pb-1",children:[e.jsx("button",{onClick:j,className:"text-primary hover:underline",children:"Select All"}),e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsx("button",{onClick:w,className:"text-muted-foreground hover:underline",children:"None"}),e.jsxs("span",{className:"ml-auto text-muted-foreground",children:[t.columns.length," selected"]})]}),e.jsx("div",{className:"flex-1 border rounded bg-background overflow-y-auto p-2 max-h-[300px]",children:c?e.jsx("div",{className:"text-xs text-muted-foreground p-2",children:"Loading columns..."}):y.length===0?e.jsx("div",{className:"text-xs text-muted-foreground p-2 text-center",children:b.length===0?"No numeric columns found.":`No columns match "${p}"`}):e.jsx("div",{className:"space-y-1",children:y.map(S=>e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer hover:bg-accent/50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.columns.includes(S),onChange:()=>{N(S)},className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"truncate",title:S,children:S})]},S))})})]})]})]})},n_={type:"BinningNode",label:"Binning / Discretization",description:"Convert continuous variables into discrete bins.",icon:di,category:"Preprocessing",inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Binned"}],validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column to bin."}:t.n_bins<2?{isValid:!1,message:"Number of bins must be at least 2."}:{isValid:!0},settings:a_,getDefaultConfig:()=>({columns:[],strategy:"equal_width",n_bins:5,label_format:"ordinal",output_suffix:"_binned",drop_original:!1})},i_=({nodeId:t})=>{var o;const r=je(l=>l.executionResult),a=t?(o=r==null?void 0:r.node_results)==null?void 0:o[t]:void 0;if(!a)return null;const i=l=>e.jsx("div",{className:"space-y-1",children:Object.entries(l).map(([c,m])=>typeof m=="object"&&m!==null?e.jsxs("div",{className:"mt-1",children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[c.replace(/_/g," "),":"]}),e.jsx("div",{className:"pl-2 border-l-2 border-gray-200 dark:border-gray-700 ml-1",children:i(m)})]},c):e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 capitalize",children:[c.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-gray-100",children:String(m)})]},c))});return e.jsxs("div",{className:"mt-6 p-4 border rounded-md bg-gray-50 dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-gray-900 dark:text-gray-100",children:"Last Run Results"}),e.jsxs("div",{className:"text-xs space-y-1 text-gray-600 dark:text-gray-300",children:[a.metrics&&e.jsx("div",{className:"mt-2",children:i(a.metrics)}),a.error&&e.jsxs("div",{className:"mt-2 text-red-500 break-words",children:["Error: ",a.error]}),!a.metrics&&!a.error&&e.jsx("div",{className:"italic text-gray-500",children:"No metrics available"})]})]})},o_=({config:t,onChange:r,nodeId:a})=>{var k;const i=f.useRef(null),[o,l]=f.useState(!1),[c,m]=f.useState(!0),u=He(a||""),h=Array.isArray(u)?u.filter(Boolean):[],p=(k=h.find(S=>typeof S.datasetId=="string"))==null?void 0:k.datasetId,{data:g}=ze(p),b=h.find(S=>{const P=S.config;if(!P||typeof P!="object")return!1;const E=P.target_column;return typeof E=="string"&&E.trim().length>0}),y=b?b.config.target_column??void 0:void 0;f.useEffect(()=>{if(!t.target_column){if(b&&y)r({...t,target_column:y});else if(g!=null&&g.columns){const S=Object.values(g.columns).find(P=>P.name.toLowerCase()==="target"||P.name.toLowerCase()==="class"||P.column_type==="target");S&&r({...t,target_column:S.name})}}},[g,b,y,t.target_column,t,r]),f.useEffect(()=>{if(!i.current)return;const S=new ResizeObserver(P=>{for(const E of P)l(E.contentRect.width>400)});return S.observe(i.current),()=>{S.disconnect()}},[]);const j=ba(a||"",{types:["resampling"],suggestedNodeTypes:["ResamplingNode"]}),w=S=>{S.suggested_params&&r({...t,...S.suggested_params})},N=(S,P)=>{const E={...t,[S]:P};S==="type"&&(P==="oversampling"?E.method="smote":E.method="random_under_sampling"),r(E)};return e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Resampling Type"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.type,onChange:S=>{N("type",S.target.value)},children:[e.jsx("option",{value:"oversampling",children:"Oversampling (Minority)"}),e.jsx("option",{value:"undersampling",children:"Undersampling (Majority)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Method"}),e.jsx("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.method,onChange:S=>{N("method",S.target.value)},children:t.type==="oversampling"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"smote",children:"SMOTE"}),e.jsx("option",{value:"adasyn",children:"ADASYN"}),e.jsx("option",{value:"borderline_smote",children:"Borderline SMOTE"}),e.jsx("option",{value:"svm_smote",children:"SVM SMOTE"}),e.jsx("option",{value:"kmeans_smote",children:"KMeans SMOTE"}),e.jsx("option",{value:"smote_tomek",children:"SMOTE + Tomek"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"random_under_sampling",children:"Random Under Sampling"}),e.jsx("option",{value:"nearmiss",children:"NearMiss"}),e.jsx("option",{value:"tomek_links",children:"Tomek Links"}),e.jsx("option",{value:"edited_nearest_neighbours",children:"Edited Nearest Neighbours"})]})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.type==="oversampling"?"Generate synthetic samples for the minority class.":"Remove samples from the majority class."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Target Column"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"e.g., target",value:t.target_column,onChange:S=>{N("target_column",S.target.value)},list:"target-column-suggestions"}),(g==null?void 0:g.columns)&&e.jsx("datalist",{id:"target-column-suggestions",children:Object.values(g.columns).map(S=>e.jsx("option",{value:S.name},S.name))})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:b?"Auto-detected from upstream node.":"The column containing the class labels."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Sampling Strategy"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.sampling_strategy,onChange:S=>{N("sampling_strategy",S.target.value)},children:[e.jsx("option",{value:"auto",children:"Auto (Resample all classes but majority)"}),e.jsx("option",{value:"minority",children:"Minority (Resample only minority class)"}),e.jsx("option",{value:"not minority",children:"Not Minority (Resample all but minority)"}),e.jsx("option",{value:"not majority",children:"Not Majority (Resample all but majority)"}),e.jsx("option",{value:"all",children:"All (Resample all classes)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Defines which classes to resample."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Random State"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.random_state,onChange:S=>{N("random_state",parseInt(S.target.value))}})]})]}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[t.type==="oversampling"&&e.jsxs(e.Fragment,{children:[["smote","adasyn","borderline_smote","svm_smote","kmeans_smote"].includes(t.method)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"k Neighbors"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.k_neighbors??5,onChange:S=>{N("k_neighbors",parseInt(S.target.value))}})]}),["borderline_smote","svm_smote"].includes(t.method)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"m Neighbors"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.m_neighbors??10,onChange:S=>{N("m_neighbors",parseInt(S.target.value))}})]}),t.method==="borderline_smote"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Kind"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.kind??"borderline-1",onChange:S=>{N("kind",S.target.value)},children:[e.jsx("option",{value:"borderline-1",children:"Borderline-1"}),e.jsx("option",{value:"borderline-2",children:"Borderline-2"})]})]}),t.method==="svm_smote"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Out Step"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.out_step??.5,onChange:S=>{N("out_step",parseFloat(S.target.value))}})]}),t.method==="kmeans_smote"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cluster Balance Threshold"}),e.jsx("input",{type:"number",step:"0.1",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.cluster_balance_threshold??.1,onChange:S=>{N("cluster_balance_threshold",parseFloat(S.target.value))}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Density Exponent"}),e.jsx("input",{type:"text",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.density_exponent??"auto",onChange:S=>{N("density_exponent",S.target.value)}})]})]})]}),t.type==="undersampling"&&t.method==="random_under_sampling"&&e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md bg-gray-50 dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:"Replacement"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sample with replacement"})]}),e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500",checked:t.replacement??!1,onChange:S=>{N("replacement",S.target.checked)}})]}),t.type==="undersampling"&&t.method==="nearmiss"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Version"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.version??1,onChange:S=>{N("version",parseInt(S.target.value))},children:[e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"})]})]}),t.type==="undersampling"&&t.method==="edited_nearest_neighbours"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"n Neighbors"}),e.jsx("input",{type:"number",className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.n_neighbors??3,onChange:S=>{N("n_neighbors",parseInt(S.target.value))}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Selection Kind"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2 text-sm text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:t.kind_sel??"all",onChange:S=>{N("kind_sel",S.target.value)},children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"mode",children:"Mode"})]})]})]}),j.length>0&&e.jsxs("div",{className:"mt-0 border rounded-md overflow-hidden border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>{m(!c)},children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:["Recommendations (",j.length,")"]}),c?e.jsx(Ms,{size:16}):e.jsx(De,{size:16})]}),c&&e.jsx("div",{className:"p-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700",children:e.jsx(Ar,{recommendations:j,onApply:w})})]}),a&&e.jsx(i_,{nodeId:a})]})]})})},l_=t=>t.target_column?t.type==="oversampling"&&["smote","adasyn","borderline_smote","svm_smote","kmeans_smote"].includes(t.method)&&(t.k_neighbors??5)<1?{isValid:!1,message:"k_neighbors must be at least 1."}:{isValid:!0}:{isValid:!1,message:"Target column is required for resampling."},d_={type:"ResamplingNode",label:"Resampling",category:"Preprocessing",description:"Balance dataset classes using oversampling or undersampling techniques.",icon:tt,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Balanced Data",type:"dataset"}],settings:o_,validate:l_,getDefaultConfig:()=>({type:"oversampling",method:"smote",target_column:"",sampling_strategy:"auto",random_state:42,k_neighbors:5,replacement:!1,version:1,n_neighbors:3,kind_sel:"all"})},c_=[{value:"arithmetic",label:"Arithmetic",icon:Go},{value:"datetime_extract",label:"Date Extraction",icon:Sr},{value:"ratio",label:"Ratio",icon:zx},{value:"similarity",label:"Similarity",icon:Fx},{value:"group_agg",label:"Group Agg",icon:Gc}],u_=["add","subtract","multiply","divide"],m_=["year","month","day","weekday","hour","quarter","is_weekend"],h_=["ratio","token_sort_ratio","token_set_ratio"],x_=["mean","sum","count","min","max","std","median"],Cs=({columns:t,selected:r,onChange:a,label:i,single:o})=>{const[l,c]=f.useState(""),m=t.filter(h=>h.toLowerCase().includes(l.toLowerCase())),u=h=>{o?a([h]):r.includes(h)?a(r.filter(p=>p!==h)):a([...r,h])};return e.jsxs("div",{className:"space-y-1.5",children:[i&&e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:i}),e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:l,onChange:h=>{c(h.target.value)}})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto p-1 space-y-0.5",children:m.length>0?m.map(h=>{const p=r.includes(h);return e.jsxs("div",{onClick:()=>{u(h)},className:`
                    flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                    ${p?"bg-primary/10 text-primary font-medium":"hover:bg-accent text-foreground"}
                  `,children:[e.jsx("div",{className:`
                    w-3 h-3 rounded border flex items-center justify-center
                    ${p?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/40"}
                  `,children:p&&e.jsx(Ba,{size:8,strokeWidth:4})}),e.jsx("span",{className:"truncate",children:h})]},h)}):e.jsx("div",{className:"p-2 text-xs text-muted-foreground text-center italic",children:"No columns found"})})]})]})},p_=({config:t,onChange:r,nodeId:a})=>{var R;const o=(R=He(a||"").find(_=>_.datasetId))==null?void 0:R.datasetId,{data:l}=ze(o),c=je(_=>_.executionResult),m=a?c==null?void 0:c.node_results[a]:null,u=m!=null&&m.metrics&&typeof m.metrics=="object"?m.metrics:null,h=u&&Array.isArray(u.generated_features)?u.generated_features.map(_=>String(_)):[],[p,g]=f.useState(!1),b=l?Object.values(l.columns).map(_=>_.name):[],y=l?Object.values(l.columns).filter(_=>["int","float","number"].some(M=>_.dtype.toLowerCase().includes(M))).map(_=>_.name):[],j=l?Object.values(l.columns).filter(_=>["date","time"].some(M=>_.dtype.toLowerCase().includes(M))).map(_=>_.name):[],w=l?Object.values(l.columns).filter(_=>["string","object","text"].some(M=>_.dtype.toLowerCase().includes(M))).map(_=>_.name):[],N=ba(a||"",{types:["feature_generation"],suggestedNodeTypes:["FeatureGenerationNode"],scope:"column"}),k=_=>{},S=_=>{const M={operation_type:_,method:_==="arithmetic"?"add":_==="similarity"?"ratio":_==="group_agg"?"mean":"year",input_columns:[],output_column:"",datetime_features:_==="datetime_extract"?["year"]:void 0,isExpanded:!0};r({operations:[...t.operations||[],M]})},P=(_,M)=>{const I=[...t.operations||[]];I[_]={...I[_],...M},r({operations:I})},E=(_,M)=>{M.stopPropagation();const I=[...t.operations||[]];I.splice(_,1),r({operations:I})},T=_=>{const M=[...t.operations||[]];M[_]={...M[_],isExpanded:!M[_].isExpanded},r({operations:M})},D=(_,M)=>`${_.operation_type}_${M}`;return e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-20 border-r bg-muted/10 flex flex-col items-center py-4 gap-2 overflow-y-auto shrink-0",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground mb-2 uppercase tracking-wider",children:"Add"}),c_.map(_=>e.jsxs("button",{onClick:()=>{S(_.value)},className:"flex flex-col items-center justify-center gap-1 p-1.5 rounded-md border bg-card hover:bg-accent hover:border-primary/50 transition-all group w-16 h-14 shadow-sm",title:_.label,children:[e.jsx(_.icon,{size:18,className:"text-muted-foreground group-hover:text-primary"}),e.jsx("span",{className:"text-[9px] font-medium text-muted-foreground group-hover:text-foreground text-center leading-tight line-clamp-2",children:_.label.replace(" ",`
`)})]},_.value))]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-background",children:[N.length>0&&e.jsxs("div",{className:"border-b bg-muted/10",children:[e.jsxs("button",{onClick:()=>{g(!p)},className:"w-full flex items-center justify-between px-4 py-2 text-xs font-medium text-muted-foreground hover:text-primary hover:bg-muted/20 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(sn,{size:14,className:N.length>0?"text-yellow-500":""}),e.jsxs("span",{children:["Recommendations (",N.length,")"]})]}),p?e.jsx(De,{size:14}):e.jsx(Pt,{size:14})]}),p&&e.jsx("div",{className:"p-4 bg-muted/5 border-t",children:e.jsx(Ar,{recommendations:N,onApply:k,className:"mb-0"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[(t.operations||[]).map((_,M)=>{var I,O,F;return e.jsxs("div",{className:"border rounded-lg bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-muted/30 border-b cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{T(M)},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_.isExpanded?e.jsx(De,{size:14,className:"text-muted-foreground"}):e.jsx(Pt,{size:14,className:"text-muted-foreground"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:_.operation_type==="datetime_extract"?"Date":_.operation_type.replace("_"," ")}),["arithmetic","similarity","group_agg"].includes(_.operation_type)&&e.jsx("select",{className:"text-sm border-none bg-transparent font-semibold focus:ring-0 cursor-pointer hover:text-primary",value:_.method,onClick:B=>{B.stopPropagation()},onChange:B=>{P(M,{method:B.target.value})},children:(_.operation_type==="arithmetic"?u_:_.operation_type==="similarity"?h_:_.operation_type==="group_agg"?x_:[]).map(B=>e.jsx("option",{value:B,children:B.replace("_"," ")},B))})]}),e.jsx("button",{onClick:B=>{E(M,B)},className:"text-muted-foreground hover:text-destructive transition-colors p-1 rounded-full hover:bg-destructive/10",children:e.jsx(or,{size:14})})]}),_.isExpanded&&e.jsxs("div",{className:"p-3 space-y-4",children:[_.operation_type==="arithmetic"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20",children:_.method==="divide"?"Performs row-by-row division (Col A / Col B) for each record.":"Performs row-by-row arithmetic between two columns."}),e.jsx(Cs,{label:"Column A (Left Operand)",columns:y,selected:_.input_columns.slice(0,1),onChange:B=>{P(M,{input_columns:B})},single:!0}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px bg-border flex-1"}),e.jsx("span",{className:"text-lg font-bold text-muted-foreground bg-muted/20 w-8 h-8 rounded flex items-center justify-center",children:_.method==="add"?"+":_.method==="subtract"?"-":_.method==="multiply"?"":""}),e.jsx("div",{className:"h-px bg-border flex-1"})]}),e.jsx(Cs,{label:"Column B (Right Operand)",columns:y,selected:((I=_.secondary_columns)==null?void 0:I.slice(0,1))||[],onChange:B=>{P(M,{secondary_columns:B})},single:!0})]}),_.operation_type==="ratio"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20",children:["Calculates aggregate ratio: ",e.jsx("strong",{children:"Sum(Numerator) / Sum(Denominator)"}),"."]}),e.jsx(Cs,{label:"Numerator (Sum)",columns:y,selected:_.input_columns,onChange:B=>{P(M,{input_columns:B})}}),e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-dashed"})}),e.jsx("span",{className:"relative bg-card px-2 text-xs text-muted-foreground font-medium",children:"Divided By"})]}),e.jsx(Cs,{label:"Denominator (Sum)",columns:y,selected:_.secondary_columns||[],onChange:B=>{P(M,{secondary_columns:B})}})]}),_.operation_type==="similarity"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20 space-y-1",children:[e.jsx("p",{children:"Calculates string similarity score (0-100) between two text columns."}),e.jsxs("ul",{className:"list-disc pl-3 space-y-0.5 opacity-80",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Ratio:"}),' Strict character matching (Levenshtein). "apple banana" != "banana apple".']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Token Sort:"}),' Sorts words alphabetically then compares. "apple banana" == "banana apple".']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Token Set:"})," Compares intersection of words. Handles duplicates/subsets well."]})]})]}),e.jsx(Cs,{label:"String A",columns:w,selected:_.input_columns.slice(0,1),onChange:B=>P(M,{input_columns:B}),single:!0}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px bg-border flex-1"}),e.jsx("span",{className:"text-xs font-bold text-muted-foreground bg-muted/20 px-2 py-1 rounded",children:"vs"}),e.jsx("div",{className:"h-px bg-border flex-1"})]}),e.jsx(Cs,{label:"String B",columns:w,selected:((O=_.secondary_columns)==null?void 0:O.slice(0,1))||[],onChange:B=>P(M,{secondary_columns:B}),single:!0})]}),_.operation_type==="group_agg"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground bg-muted/20 p-1.5 rounded border border-muted/20",children:"Calculates aggregate statistics (e.g., Mean Salary) grouped by a categorical column (e.g., Department) and assigns it back to each row."}),e.jsx(Cs,{label:"Group By (Categorical)",columns:w.length>0?w:b,selected:_.input_columns.slice(0,1),onChange:B=>P(M,{input_columns:B}),single:!0}),e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-dashed"})}),e.jsx("span",{className:"relative bg-card px-2 text-xs text-muted-foreground font-medium",children:"Target Column"})]}),e.jsx(Cs,{label:"Target (Numeric)",columns:y,selected:((F=_.secondary_columns)==null?void 0:F.slice(0,1))||[],onChange:B=>P(M,{secondary_columns:B}),single:!0})]}),_.operation_type==="datetime_extract"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(Cs,{label:"Date Column",columns:j.length>0?j:b,selected:_.input_columns.slice(0,1),onChange:B=>P(M,{input_columns:B}),single:!0}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Features to Extract"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:m_.map(B=>e.jsxs("label",{className:"flex items-center gap-2 text-xs p-1.5 border rounded hover:bg-accent cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted-foreground/40 text-primary focus:ring-0",checked:(_.datetime_features||[]).includes(B),onChange:q=>{const G=_.datetime_features||[],ee=q.target.checked?[...G,B]:G.filter(te=>te!==B);P(M,{datetime_features:ee})}}),e.jsx("span",{className:"capitalize",children:B.replace("_"," ")})]},B))})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wider mb-1 block",children:"Output Column Name"}),e.jsx("input",{type:"text",className:"w-full text-xs border rounded px-2 py-1.5 bg-background focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:D(_,M),value:_.output_column||"",onChange:B=>{P(M,{output_column:B.target.value})}})]})]})]},M)}),(!t.operations||t.operations.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 border-2 border-dashed rounded-lg bg-muted/5 text-muted-foreground",children:[e.jsx(Go,{size:32,className:"mb-2 opacity-20"}),e.jsx("p",{className:"text-xs font-medium",children:"No operations added"}),e.jsx("p",{className:"text-[10px] opacity-70",children:"Select a type above to start"})]}),u&&e.jsxs("div",{className:"border rounded-lg bg-muted/10 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm font-semibold text-primary",children:[e.jsx(tt,{size:14}),e.jsx("span",{children:"Last Run Results"})]}),e.jsx("div",{className:"space-y-2 text-xs",children:h.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"New Features Created:"}),e.jsx("span",{className:"font-medium text-primary bg-primary/10 px-2 py-0.5 rounded-full",children:h.length})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase tracking-wider font-semibold mb-1.5 block",children:"Generated Columns"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:h.map(_=>e.jsx("span",{className:"px-2 py-1 bg-background border rounded text-[10px] font-mono text-foreground shadow-sm",children:_},_))})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground italic",children:[e.jsx(gt,{size:12}),e.jsx("span",{children:"No features generated in last run."})]})})]})]})]})]})},f_={type:"FeatureGenerationNode",label:"Feature Generation",description:"Create new features via math, stats, or date extraction.",icon:Go,category:"Preprocessing",inputs:[{id:"in",type:"dataset",label:"Dataset"}],outputs:[{id:"out",type:"dataset",label:"Enhanced"}],validate:t=>{var r,a,i,o;if(!((r=t.operations)!=null&&r.length))return{isValid:!1,message:"Add at least one operation."};for(const l of t.operations){if(l.operation_type==="arithmetic"&&(l.input_columns.length===0||!((a=l.secondary_columns)!=null&&a.length)&&!((i=l.constants)!=null&&i.length)))return{isValid:!1,message:"Arithmetic requires two operands."};if(l.operation_type==="datetime_extract"&&l.input_columns.length===0)return{isValid:!1,message:"Select a date column."};if(l.operation_type==="group_agg"&&(l.input_columns.length===0||!((o=l.secondary_columns)!=null&&o.length)))return{isValid:!1,message:"Select both Group By and Target columns."}}return{isValid:!0}},settings:p_,getDefaultConfig:()=>({operations:[]})},g_=({columns:t,selected:r,onChange:a,label:i})=>{const[o,l]=f.useState(""),c=t.filter(u=>u.toLowerCase().includes(o.toLowerCase())),m=u=>{r.includes(u)?a(r.filter(h=>h!==u)):a([...r,u])};return e.jsxs("div",{className:"space-y-1.5",children:[i&&e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:i}),e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:o,onChange:u=>{l(u.target.value)}})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto p-1 space-y-0.5",children:c.length>0?c.map(u=>{const h=r.includes(u);return e.jsxs("div",{onClick:()=>{m(u)},className:`
                    flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                    ${h?"bg-primary/10 text-primary font-medium":"hover:bg-accent text-foreground"}
                  `,children:[e.jsx("div",{className:`
                    w-3 h-3 rounded border flex items-center justify-center
                    ${h?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/40"}
                  `,children:h&&e.jsx("div",{className:"w-1.5 h-1.5 bg-current rounded-sm"})}),e.jsx("span",{className:"truncate",children:u})]},u)}):e.jsx("div",{className:"p-2 text-xs text-muted-foreground text-center",children:"No columns found"})})]}),e.jsxs("div",{className:"text-[10px] text-muted-foreground text-right",children:[r.length," selected"]})]})},b_={type:"PolynomialFeaturesNode",label:"Polynomial Features",description:"Generate polynomial and interaction features.",category:"Preprocessing",icon:Sd,inputs:[{id:"in",label:"Input Dataset",type:"dataset"}],outputs:[{id:"out",label:"Transformed Data",type:"dataset"}],getDefaultConfig:()=>({columns:[],degree:2,interaction_only:!1,include_bias:!1,output_prefix:"poly",include_input_features:!1,isExpanded:!0}),settings:({config:t,onChange:r,nodeId:a})=>{var h;const o=(h=He(a||"").find(p=>p.datasetId))==null?void 0:h.datasetId,{data:l}=ze(o),c=l?Object.values(l.columns).filter(p=>["int","float","number","double","long"].some(g=>p.dtype.toLowerCase().includes(g))).map(p=>p.name):[],m=p=>{r({...t,...p})},u=()=>{m({isExpanded:!t.isExpanded})};return e.jsx("div",{className:"space-y-2 min-w-[280px]",children:e.jsxs("div",{className:"border rounded-md bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer hover:bg-accent/50 transition-colors",onClick:u,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Sd,{size:14,className:"text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Configuration"})]}),t.isExpanded?e.jsx(De,{size:14}):e.jsx(Pt,{size:14})]}),t.isExpanded&&e.jsxs("div",{className:"p-3 space-y-4 border-t",children:[e.jsx(g_,{label:"Input Columns (Numeric)",columns:c,selected:t.columns||[],onChange:p=>m({columns:p})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:["Degree",e.jsxs("div",{className:"group relative",children:[e.jsx(gt,{size:10,className:"cursor-help"}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 hidden group-hover:block w-48 p-2 bg-popover text-popover-foreground text-[10px] rounded border shadow-lg z-50",children:"The degree of the polynomial features. Default = 2."})]})]}),e.jsx("input",{type:"number",min:2,max:5,className:"w-full px-2 py-1.5 text-xs border rounded bg-background",value:t.degree||2,onChange:p=>m({degree:parseInt(p.target.value)||2})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Output Prefix"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1.5 text-xs border rounded bg-background",value:t.output_prefix||"poly",onChange:p=>m({output_prefix:p.target.value})})]}),e.jsxs("div",{className:"space-y-2 pt-1",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted",checked:t.interaction_only||!1,onChange:p=>m({interaction_only:p.target.checked})}),e.jsx("span",{className:"text-xs",children:"Interaction Only"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground pl-5",children:"If true, only interaction features are produced: features that are products of at most degree distinct input features."}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted",checked:t.include_bias||!1,onChange:p=>m({include_bias:p.target.checked})}),e.jsx("span",{className:"text-xs",children:"Include Bias"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"rounded border-muted",checked:t.include_input_features||!1,onChange:p=>m({include_input_features:p.target.checked})}),e.jsx("span",{className:"text-xs",children:"Include Input Features"})]})]})]})]})]})})},validate:t=>!t.columns||t.columns.length===0?{isValid:!1,message:"Select at least one input column."}:t.degree<2?{isValid:!1,message:"Degree must be at least 2."}:{isValid:!0}},y_=({columns:t,selected:r,onChange:a})=>{const[i,o]=f.useState(""),l=t.filter(m=>m.toLowerCase().includes(i.toLowerCase())),c=m=>{r.includes(m)?a(r.filter(u=>u!==m)):a([...r,m])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:m=>{o(m.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:l.length>0?l.map(m=>{const u=r.includes(m);return e.jsxs("div",{onClick:()=>{c(m)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:m})]},m)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},v_=({operation:t,onChange:r,onDelete:a})=>e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("select",{className:"text-xs font-medium bg-transparent border-none focus:ring-0 p-0 text-gray-900 dark:text-gray-100",value:t.op,onChange:i=>{const o=i.target.value;let l="both";o==="case"&&(l="lower"),o==="remove_special"&&(l="keep_alphanumeric"),o==="regex"&&(l="custom"),r({...t,op:o,mode:l})},children:[e.jsx("option",{value:"trim",children:"Trim Whitespace"}),e.jsx("option",{value:"case",children:"Change Case"}),e.jsx("option",{value:"remove_special",children:"Remove Special Chars"}),e.jsx("option",{value:"regex",children:"Regex Replace"})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(or,{size:14})})]}),e.jsxs("div",{className:"space-y-2",children:[t.op==="trim"&&e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"both",children:"Both Ends"}),e.jsx("option",{value:"leading",children:"Leading Only"}),e.jsx("option",{value:"trailing",children:"Trailing Only"})]}),t.op==="case"&&e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"lower",children:"Lower Case"}),e.jsx("option",{value:"upper",children:"Upper Case"}),e.jsx("option",{value:"title",children:"Title Case"}),e.jsx("option",{value:"sentence",children:"Sentence Case"})]}),t.op==="remove_special"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"keep_alphanumeric",children:"Keep Alphanumeric"}),e.jsx("option",{value:"keep_alphanumeric_space",children:"Keep Alphanumeric & Space"}),e.jsx("option",{value:"letters_only",children:"Letters Only"}),e.jsx("option",{value:"digits_only",children:"Digits Only"})]}),e.jsx("input",{type:"text",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",placeholder:"Replacement (optional)",value:t.replacement||"",onChange:i=>r({...t,replacement:i.target.value})})]}),t.op==="regex"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",value:t.mode,onChange:i=>r({...t,mode:i.target.value}),children:[e.jsx("option",{value:"custom",children:"Custom Pattern"}),e.jsx("option",{value:"collapse_whitespace",children:"Collapse Whitespace"}),e.jsx("option",{value:"extract_digits",children:"Extract Digits"}),e.jsx("option",{value:"normalize_slash_dates",children:"Normalize Dates (MM/DD/YYYY)"})]}),t.mode==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"text",className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5 font-mono",placeholder:"Regex Pattern",value:t.pattern||"",onChange:i=>r({...t,pattern:i.target.value})}),e.jsx("button",{className:"p-1.5 bg-gray-100 dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Generate regex from literal text",onClick:()=>{const i=prompt("Enter the exact text you want to match (it will be escaped):");if(i){const o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r({...t,pattern:o})}},children:e.jsx($x,{size:14})})]}),e.jsx("input",{type:"text",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-1.5",placeholder:"Replacement",value:t.repl||"",onChange:i=>r({...t,repl:i.target.value})})]})]})]})]}),j_=({config:t,onChange:r,nodeId:a})=>{var w;const i=f.useRef(null),[o,l]=f.useState(!1),[c,m]=f.useState(!0),h=(w=He(a||"").find(N=>N.datasetId))==null?void 0:w.datasetId,{data:p}=ze(h),g=p?Object.values(p.columns).filter(N=>{const k=String(N.dtype).toLowerCase();return k.includes("object")||k.includes("string")||k.includes("category")||k.includes("text")}).map(N=>N.name):[];f.useEffect(()=>{if(!i.current)return;const N=new ResizeObserver(k=>{for(const S of k)l(S.contentRect.width>400)});return N.observe(i.current),()=>{N.disconnect()}},[]);const b=()=>{r({...t,operations:[...t.operations,{op:"trim",mode:"both"}]})},y=(N,k)=>{const S=[...t.operations];S[N]=k,r({...t,operations:S})},j=N=>{const k=t.operations.filter((S,P)=>P!==N);r({...t,operations:k})};return e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsx("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:["Target Columns (",t.columns.length,")"]}),e.jsx(y_,{columns:g,selected:t.columns,onChange:N=>r({...t,columns:N})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only text/categorical columns are shown."})]})}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{m(!c)},className:"w-full flex items-center gap-2 p-3 text-left hover:bg-blue-100/50 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(gt,{className:"text-blue-600 dark:text-blue-400 shrink-0",size:16}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 dark:text-blue-200 flex-1",children:"About Text Cleaning"}),c?e.jsx(Ms,{size:14,className:"text-blue-600 dark:text-blue-400"}):e.jsx(De,{size:14,className:"text-blue-600 dark:text-blue-400"})]}),c&&e.jsx("div",{className:"px-3 pb-3 text-xs text-blue-800 dark:text-blue-200 pl-9",children:e.jsx("p",{children:"Clean and standardize text columns by trimming whitespace, changing case, removing special characters, or applying custom regex patterns."})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cleaning Operations"}),e.jsxs("button",{onClick:b,className:"flex items-center gap-1 text-xs font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(Yt,{size:14}),"Add Step"]})]}),e.jsx("div",{className:"space-y-3",children:t.operations.length===0?e.jsxs("div",{className:"text-center p-6 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"No operations added."}),e.jsx("button",{onClick:b,className:"mt-2 text-xs text-blue-600 hover:underline",children:"Add your first cleaning step"})]}):t.operations.map((N,k)=>e.jsx(v_,{operation:N,onChange:S=>{y(k,S)},onDelete:()=>{j(k)}},k))})]})]})})},__={type:"TextCleaning",label:"Text Cleaning",category:"Preprocessing",description:"Clean and standardize text columns.",icon:Bx,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:j_,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:t.operations.length===0?{isValid:!1,message:"Add at least one operation."}:{isValid:!0},getDefaultConfig:()=>({columns:[],operations:[{op:"trim",mode:"both"}]})},w_=({columns:t,selected:r,onChange:a})=>{const[i,o]=f.useState(""),l=t.filter(m=>m.toLowerCase().includes(i.toLowerCase())),c=m=>{r.includes(m)?a(r.filter(u=>u!==m)):a([...r,m])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:m=>{o(m.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:l.length>0?l.map(m=>{const u=r.includes(m);return e.jsxs("div",{onClick:()=>{c(m)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:m})]},m)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},_c=({value:t,type:r,onChange:a,placeholder:i})=>{const o=c=>{let m=t;c==="number"&&(m=Number(t)||0),c==="boolean"&&(m=!!t),c==="string"&&(m=String(t)),c==="null"&&(m=null),c==="nan"&&(m="NaN"),a(m,c)},l=c=>{let m=c.target.value;r==="number"&&(m=parseFloat(m)),a(m,r)};return e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{className:"w-20 text-[10px] rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 px-1",value:r,onChange:c=>{o(c.target.value)},children:[e.jsx("option",{value:"string",children:"Text"}),e.jsx("option",{value:"number",children:"Num"}),e.jsx("option",{value:"boolean",children:"Bool"}),e.jsx("option",{value:"null",children:"Null"})]}),r==="string"&&e.jsx("input",{type:"text",className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1",value:t||"",onChange:l,placeholder:i}),r==="number"&&e.jsx("input",{type:"number",className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1",value:t||"",onChange:l,placeholder:i}),r==="boolean"&&e.jsxs("select",{className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1",value:String(t),onChange:c=>a(c.target.value==="true","boolean"),children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]}),(r==="null"||r==="nan")&&e.jsx("div",{className:"flex-1 min-w-0 text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-500 italic flex items-center",children:r==="null"?"None / Null":"NaN"})]})},N_=({item:t,onChange:r,onDelete:a})=>e.jsxs("div",{className:"p-2 border rounded-md bg-gray-50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-semibold tracking-wider",children:"Find"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-red-500 transition-colors p-1",children:e.jsx(or,{size:14})})]}),e.jsx(_c,{value:t.old,type:t.oldType,onChange:(i,o)=>r({...t,old:i,oldType:o}),placeholder:"Value to find"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-gray-400",children:e.jsx(Zx,{size:14,className:"rotate-90"})}),e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-semibold tracking-wider",children:"Replace With"})]}),e.jsx(_c,{value:t.new,type:t.newType,onChange:(i,o)=>r({...t,new:i,newType:o}),placeholder:"New value"})]}),k_=({config:t,onChange:r,nodeId:a})=>{var p;const o=(p=He(a||"").find(g=>g==null?void 0:g.datasetId))==null?void 0:p.datasetId,{data:l}=ze(o),c=l?Object.values(l.columns).map(g=>g.name):[],m=()=>{r({...t,replacements:[...t.replacements,{old:"",new:"",oldType:"string",newType:"string"}]})},u=(g,b)=>{const y=[...t.replacements];y[g]=b,r({...t,replacements:y})},h=g=>{const b=t.replacements.filter((y,j)=>j!==g);r({...t,replacements:b})};return e.jsxs("div",{className:"space-y-4 p-1",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Target Columns"}),e.jsx(w_,{columns:c,selected:t.columns,onChange:g=>r({...t,columns:g})}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Select columns to apply replacements to. If empty, applies to all compatible columns."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Replacements"}),e.jsxs("button",{onClick:m,className:"text-xs flex items-center gap-1 text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Yt,{size:12})," Add"]})]}),e.jsxs("div",{className:"space-y-3",children:[t.replacements.map((g,b)=>e.jsx(N_,{item:g,onChange:y=>{u(b,y)},onDelete:()=>{h(b)}},b)),t.replacements.length===0&&e.jsx("div",{className:"text-center py-4 text-xs text-gray-500 border border-dashed rounded",children:"No replacements defined."})]})]})]})},C_={type:"value_replacement",label:"Replace Values",category:"Preprocessing",description:"Replace specific values in columns (e.g. -999 to NaN).",icon:Ux,inputs:[{id:"in",label:"Input Dataset",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Dataset",type:"dataset"}],settings:k_,validate:t=>{var r;return(r=t.replacements)!=null&&r.length?{isValid:!0}:{isValid:!0,message:"No replacements defined (pass-through)."}},getDefaultConfig:()=>({columns:[],replacements:[]})},S_=({columns:t,selected:r,onChange:a})=>{const[i,o]=f.useState(""),l=t.filter(m=>m.toLowerCase().includes(i.toLowerCase())),c=m=>{r.includes(m)?a(r.filter(u=>u!==m)):a([...r,m])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:m=>{o(m.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:l.length>0?l.map(m=>{const u=r.includes(m);return e.jsxs("div",{onClick:()=>{c(m)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:m})]},m)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},T_=({pairs:t,onChange:r})=>{const[a,i]=f.useState(""),[o,l]=f.useState(""),c=()=>{a&&o&&(r({...t,[a]:o}),i(""),l(""))},m=u=>{const h={...t};Reflect.deleteProperty(h,u),r(h)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Alias (Old)"}),e.jsx("input",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:"e.g. NY",value:a,onChange:u=>{i(u.target.value)}})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Canonical (New)"}),e.jsx("input",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:"e.g. New York",value:o,onChange:u=>{l(u.target.value)}})]}),e.jsx("button",{onClick:c,disabled:!a||!o,className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Yt,{size:16})})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto border rounded-md p-2 bg-gray-50 dark:bg-gray-800/50",children:Object.entries(t).length===0?e.jsx("div",{className:"text-center text-xs text-gray-500 py-2",children:"No custom aliases defined."}):Object.entries(t).map(([u,h])=>e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("span",{className:"font-medium text-red-600 truncate max-w-[80px]",children:u}),e.jsx(Kc,{size:12,className:"text-gray-400 shrink-0"}),e.jsx("span",{className:"font-medium text-green-600 truncate max-w-[80px]",children:h})]}),e.jsx("button",{onClick:()=>{m(u)},className:"text-gray-400 hover:text-red-500",children:e.jsx(or,{size:14})})]},u))})]})},P_=({config:t,onChange:r,nodeId:a})=>{var b;const i=f.useRef(null),[o,l]=f.useState(!1),[c,m]=f.useState(!0),h=(b=He(a||"").find(y=>y.datasetId))==null?void 0:b.datasetId,{data:p}=ze(h),g=p?Object.values(p.columns).filter(y=>{const j=String(y.dtype).toLowerCase();return j.includes("object")||j.includes("string")||j.includes("category")||j.includes("text")}).map(y=>y.name):[];return f.useEffect(()=>{if(!i.current)return;const y=new ResizeObserver(j=>{for(const w of j)l(w.contentRect.width>400)});return y.observe(i.current),()=>{y.disconnect()}},[]),e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsx("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:["Target Columns (",t.columns.length,")"]}),e.jsx(S_,{columns:g,selected:t.columns,onChange:y=>r({...t,columns:y})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only text/categorical columns are shown."})]})}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{m(!c)},className:"w-full flex items-center gap-2 p-3 text-left hover:bg-blue-100/50 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(gt,{className:"text-blue-600 dark:text-blue-400 shrink-0",size:16}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 dark:text-blue-200 flex-1",children:"About Alias Replacement"}),c?e.jsx(Ms,{size:14,className:"text-blue-600 dark:text-blue-400"}):e.jsx(De,{size:14,className:"text-blue-600 dark:text-blue-400"})]}),c&&e.jsx("div",{className:"px-3 pb-3 text-xs text-blue-800 dark:text-blue-200 pl-9",children:e.jsx("p",{children:"Standardize data by mapping multiple variations (aliases) to a single canonical value. Useful for country codes, boolean strings, or custom synonyms."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Replacement Mode"}),e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2",value:t.mode,onChange:y=>r({...t,mode:y.target.value}),children:[e.jsx("option",{value:"custom",children:"Custom Mapping"}),e.jsx("option",{value:"canonicalize_country_codes",children:"Canonicalize Country Codes"}),e.jsx("option",{value:"normalize_boolean",children:"Normalize Booleans (yes/no -> True/False)"}),e.jsx("option",{value:"punctuation",children:"Remove Punctuation"})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 mt-1",children:[t.mode==="custom"&&"Define your own alias mappings below.",t.mode==="canonicalize_country_codes"&&"Standardizes country codes (e.g. 'USA', 'U.S.A.' -> 'US').",t.mode==="normalize_boolean"&&"Converts 'yes', 'y', '1' to True and 'no', 'n', '0' to False.",t.mode==="punctuation"&&"Removes common punctuation characters from text."]})]}),t.mode==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Custom Aliases"}),e.jsx(T_,{pairs:t.custom_pairs,onChange:y=>r({...t,custom_pairs:y})})]})]})]})})},L_={type:"AliasReplacement",label:"Alias Replacement",category:"Preprocessing",description:"Standardize values by mapping aliases to canonical forms.",icon:Kc,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Standardized Data",type:"dataset"}],settings:P_,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:t.mode==="custom"&&Object.keys(t.custom_pairs).length===0?{isValid:!1,message:"Add at least one alias pair for custom mode."}:{isValid:!0},getDefaultConfig:()=>({columns:[],mode:"custom",custom_pairs:{}})},E_=({columns:t,selected:r,onChange:a})=>{const[i,o]=f.useState(""),l=t.filter(m=>m.toLowerCase().includes(i.toLowerCase())),c=m=>{r.includes(m)?a(r.filter(u=>u!==m)):a([...r,m])};return e.jsxs("div",{className:"border rounded bg-background overflow-hidden flex flex-col max-h-40",children:[e.jsxs("div",{className:"flex items-center px-2 py-1.5 border-b bg-muted/20",children:[e.jsx(ts,{size:12,className:"text-muted-foreground mr-1.5"}),e.jsx("input",{className:"flex-1 bg-transparent text-xs outline-none placeholder:text-muted-foreground/70",placeholder:"Search columns...",value:i,onChange:m=>{o(m.target.value)}})]}),e.jsx("div",{className:"overflow-y-auto p-1 space-y-0.5",children:l.length>0?l.map(m=>{const u=r.includes(m);return e.jsxs("div",{onClick:()=>{c(m)},className:`
                  flex items-center gap-2 px-2 py-1.5 rounded text-xs cursor-pointer transition-colors
                  ${u?"bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"}
                `,children:[e.jsx("div",{className:`
                  w-3 h-3 rounded border flex items-center justify-center
                  ${u?"border-blue-500 bg-blue-500 text-white":"border-gray-400 dark:border-gray-600"}
                `,children:u&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:"truncate",children:m})]},m)}):e.jsx("div",{className:"p-2 text-xs text-gray-500 text-center italic",children:"No columns found"})})]})},R_=({config:t,onChange:r,nodeId:a})=>{var b;const i=f.useRef(null),[o,l]=f.useState(!1),[c,m]=f.useState(!0),h=(b=He(a||"").find(y=>y.datasetId))==null?void 0:b.datasetId,{data:p}=ze(h),g=p?Object.values(p.columns).filter(y=>["int","float","number"].some(j=>y.dtype.toLowerCase().includes(j))).map(y=>String(y.name)):[];return f.useEffect(()=>{if(!i.current)return;const y=new ResizeObserver(j=>{for(const w of j)l(w.contentRect.width>400)});return y.observe(i.current),()=>{y.disconnect()}},[]),e.jsx("div",{ref:i,className:`flex flex-col h-full w-full bg-white dark:bg-gray-900 ${o?"overflow-hidden":"overflow-y-auto"}`,children:e.jsxs("div",{className:`flex-1 min-h-0 p-4 gap-4 ${o?"grid grid-cols-2":"flex flex-col"}`,children:[e.jsx("div",{className:`space-y-4 ${o?"overflow-y-auto pr-2":"shrink-0"}`,children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:["Target Columns (",t.columns.length,")"]}),e.jsx(E_,{columns:g,selected:t.columns,onChange:y=>r({...t,columns:y})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only numeric columns are shown."})]})}),e.jsxs("div",{className:`space-y-4 ${o?"overflow-y-auto pl-2 border-l border-gray-100 dark:border-gray-700":"shrink-0 pt-4 border-t border-gray-100 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{m(!c)},className:"w-full flex items-center gap-2 p-3 text-left hover:bg-blue-100/50 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(gt,{className:"text-blue-600 dark:text-blue-400 shrink-0",size:16}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 dark:text-blue-200 flex-1",children:"About Invalid Value Replacement"}),c?e.jsx(Ms,{size:14,className:"text-blue-600 dark:text-blue-400"}):e.jsx(De,{size:14,className:"text-blue-600 dark:text-blue-400"})]}),c&&e.jsx("div",{className:"px-3 pb-3 text-xs text-blue-800 dark:text-blue-200 pl-9",children:e.jsx("p",{children:"Use this node to handle data quality issues by replacing invalid numeric values (like negative ages or out-of-bounds sensor readings) with NaN (Missing)."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Replacement Mode"}),e.jsxs("select",{className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 p-2",value:t.mode,onChange:y=>r({...t,mode:y.target.value}),children:[e.jsx("option",{value:"negative_to_nan",children:"Negative to NaN"}),e.jsx("option",{value:"zero_to_nan",children:"Zero to NaN"}),e.jsx("option",{value:"percentage_bounds",children:"Percentage Bounds (0-100)"}),e.jsx("option",{value:"age_bounds",children:"Age Bounds (0-120)"}),e.jsx("option",{value:"custom_range",children:"Custom Range"})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 mt-1",children:[t.mode==="negative_to_nan"&&"Replaces all negative values (< 0) with NaN.",t.mode==="zero_to_nan"&&"Replaces all zero values (== 0) with NaN.",t.mode==="percentage_bounds"&&"Replaces values outside 0-100 range with NaN.",t.mode==="age_bounds"&&"Replaces values outside 0-120 range with NaN.",t.mode==="custom_range"&&"Replaces values outside the specified Min/Max range with NaN."]})]}),(t.mode==="custom_range"||t.mode==="percentage_bounds"||t.mode==="age_bounds")&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Min Value"}),e.jsx("input",{type:"number",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:t.mode==="percentage_bounds"?"0":"Min",value:t.min_value??"",onChange:y=>r({...t,min_value:y.target.value?parseFloat(y.target.value):void 0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-semibold",children:"Max Value"}),e.jsx("input",{type:"number",className:"w-full text-xs rounded border border-gray-300 dark:border-gray-600 px-2 py-1.5",placeholder:t.mode==="percentage_bounds"?"100":"Max",value:t.max_value??"",onChange:y=>r({...t,max_value:y.target.value?parseFloat(y.target.value):void 0})})]}),e.jsx("p",{className:"col-span-2 text-[10px] text-gray-500",children:"Values outside this range will be replaced with NaN."})]})]})]})})},M_={type:"InvalidValueReplacement",label:"Invalid Value Replacement",category:"Preprocessing",description:"Replace invalid or out-of-range values with NaN.",icon:Jt,inputs:[{id:"in",label:"Data",type:"dataset"}],outputs:[{id:"out",label:"Cleaned Data",type:"dataset"}],settings:R_,validate:t=>t.columns.length===0?{isValid:!1,message:"Select at least one column."}:t.mode==="custom_range"&&t.min_value===void 0&&t.max_value===void 0?{isValid:!1,message:"Specify at least a min or max value for custom range."}:{isValid:!0},getDefaultConfig:()=>({columns:[],mode:"negative_to_nan"})},A_=()=>{Te.register(xj),Te.register(gj),Te.register(yj),Te.register(jj),Te.register(wj),Te.register(Yj),Te.register(s_),Te.register(n_),Te.register(d_),Te.register(f_),Te.register(b_),Te.register(__),Te.register(C_),Te.register(L_),Te.register(M_),Te.register(Jj),Te.register(Dj),Te.register(Oj),Te.register(Fj),Te.register($j),Te.register(Uj),Te.register(Vj),Te.register(Gj),Te.register(Tj),Te.register(Mj)};A_();const D_=new _p,wc=document.getElementById("root");wc&&uo.createRoot(wc).render(e.jsx(ft.StrictMode,{children:e.jsx(Np,{client:D_,children:e.jsx(cj,{})})}));
