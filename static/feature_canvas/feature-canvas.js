var VS=on=>{throw TypeError(on)};var T_=(on,Mn,An)=>Mn.has(on)||VS("Cannot "+An);var re=(on,Mn,An)=>(T_(on,Mn,"read from private field"),An?An.call(on):Mn.get(on)),Ke=(on,Mn,An)=>Mn.has(on)?VS("Cannot add the same private member more than once"):Mn instanceof WeakSet?Mn.add(on):Mn.set(on,An),Re=(on,Mn,An,bo)=>(T_(on,Mn,"write to private field"),bo?bo.call(on,An):Mn.set(on,An),An),ft=(on,Mn,An)=>(T_(on,Mn,"access private method"),An);var Sf=(on,Mn,An,bo)=>({set _(dt){Re(on,Mn,dt,An)},get _(){return re(on,Mn,bo)}});(function(){"use strict";var Wa,sg,tC,Uo,Ya,ul,nC,dl,Ka,ml,sC,Ho,rC,qo,fl,ur,Vo,qn,qc,Wo,Sr,Aa,aC,As,wt,Vc,gs,Yo,hl,ua,Ga,Wc,pl,gl,Ko,Go,Xa,_l,Rt,Ou,P_,L_,z_,R_,D_,I_,F_,WS,oC,Yc,Br,_s,Xo,Ur,xo,iC,da,Er,Kc,lC,ma,Qa,Os,fa,ha,Ef,B_,cC,Hr,uC,pn,Za,Ja,yl,vl,eo,xl,bl,dC;function on(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Mn={exports:{}},An={},bo={exports:{}},dt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U_;function YS(){if(U_)return dt;U_=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function h(D){return D===null||typeof D!="object"?null:(D=m&&D[m]||D["@@iterator"],typeof D=="function"?D:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,y={};function v(D,V,te){this.props=D,this.context=V,this.refs=y,this.updater=te||_}v.prototype.isReactComponent={},v.prototype.setState=function(D,V){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,V,"setState")},v.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function w(){}w.prototype=v.prototype;function k(D,V,te){this.props=D,this.context=V,this.refs=y,this.updater=te||_}var j=k.prototype=new w;j.constructor=k,x(j,v.prototype),j.isPureReactComponent=!0;var b=Array.isArray,S=Object.prototype.hasOwnProperty,E={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function O(D,V,te){var G,K={},X=null,Q=null;if(V!=null)for(G in V.ref!==void 0&&(Q=V.ref),V.key!==void 0&&(X=""+V.key),V)S.call(V,G)&&!M.hasOwnProperty(G)&&(K[G]=V[G]);var J=arguments.length-2;if(J===1)K.children=te;else if(1<J){for(var Z=Array(J),ee=0;ee<J;ee++)Z[ee]=arguments[ee+2];K.children=Z}if(D&&D.defaultProps)for(G in J=D.defaultProps,J)K[G]===void 0&&(K[G]=J[G]);return{$$typeof:e,type:D,key:X,ref:Q,props:K,_owner:E.current}}function $(D,V){return{$$typeof:e,type:D.type,key:V,ref:D.ref,props:D.props,_owner:D._owner}}function P(D){return typeof D=="object"&&D!==null&&D.$$typeof===e}function A(D){var V={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(te){return V[te]})}var R=/\/+/g;function F(D,V){return typeof D=="object"&&D!==null&&D.key!=null?A(""+D.key):V.toString(36)}function z(D,V,te,G,K){var X=typeof D;(X==="undefined"||X==="boolean")&&(D=null);var Q=!1;if(D===null)Q=!0;else switch(X){case"string":case"number":Q=!0;break;case"object":switch(D.$$typeof){case e:case t:Q=!0}}if(Q)return Q=D,K=K(Q),D=G===""?"."+F(Q,0):G,b(K)?(te="",D!=null&&(te=D.replace(R,"$&/")+"/"),z(K,V,te,"",function(ee){return ee})):K!=null&&(P(K)&&(K=$(K,te+(!K.key||Q&&Q.key===K.key?"":(""+K.key).replace(R,"$&/")+"/")+D)),V.push(K)),1;if(Q=0,G=G===""?".":G+":",b(D))for(var J=0;J<D.length;J++){X=D[J];var Z=G+F(X,J);Q+=z(X,V,te,Z,K)}else if(Z=h(D),typeof Z=="function")for(D=Z.call(D),J=0;!(X=D.next()).done;)X=X.value,Z=G+F(X,J++),Q+=z(X,V,te,Z,K);else if(X==="object")throw V=String(D),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.");return Q}function I(D,V,te){if(D==null)return D;var G=[],K=0;return z(D,G,"","",function(X){return V.call(te,X,K++)}),G}function U(D){if(D._status===-1){var V=D._result;V=V(),V.then(function(te){(D._status===0||D._status===-1)&&(D._status=1,D._result=te)},function(te){(D._status===0||D._status===-1)&&(D._status=2,D._result=te)}),D._status===-1&&(D._status=0,D._result=V)}if(D._status===1)return D._result.default;throw D._result}var q={current:null},H={transition:null},W={ReactCurrentDispatcher:q,ReactCurrentBatchConfig:H,ReactCurrentOwner:E};function B(){throw Error("act(...) is not supported in production builds of React.")}return dt.Children={map:I,forEach:function(D,V,te){I(D,function(){V.apply(this,arguments)},te)},count:function(D){var V=0;return I(D,function(){V++}),V},toArray:function(D){return I(D,function(V){return V})||[]},only:function(D){if(!P(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},dt.Component=v,dt.Fragment=n,dt.Profiler=r,dt.PureComponent=k,dt.StrictMode=s,dt.Suspense=d,dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W,dt.act=B,dt.cloneElement=function(D,V,te){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var G=x({},D.props),K=D.key,X=D.ref,Q=D._owner;if(V!=null){if(V.ref!==void 0&&(X=V.ref,Q=E.current),V.key!==void 0&&(K=""+V.key),D.type&&D.type.defaultProps)var J=D.type.defaultProps;for(Z in V)S.call(V,Z)&&!M.hasOwnProperty(Z)&&(G[Z]=V[Z]===void 0&&J!==void 0?J[Z]:V[Z])}var Z=arguments.length-2;if(Z===1)G.children=te;else if(1<Z){J=Array(Z);for(var ee=0;ee<Z;ee++)J[ee]=arguments[ee+2];G.children=J}return{$$typeof:e,type:D.type,key:K,ref:X,props:G,_owner:Q}},dt.createContext=function(D){return D={$$typeof:l,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:i,_context:D},D.Consumer=D},dt.createElement=O,dt.createFactory=function(D){var V=O.bind(null,D);return V.type=D,V},dt.createRef=function(){return{current:null}},dt.forwardRef=function(D){return{$$typeof:u,render:D}},dt.isValidElement=P,dt.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:U}},dt.memo=function(D,V){return{$$typeof:f,type:D,compare:V===void 0?null:V}},dt.startTransition=function(D){var V=H.transition;H.transition={};try{D()}finally{H.transition=V}},dt.unstable_act=B,dt.useCallback=function(D,V){return q.current.useCallback(D,V)},dt.useContext=function(D){return q.current.useContext(D)},dt.useDebugValue=function(){},dt.useDeferredValue=function(D){return q.current.useDeferredValue(D)},dt.useEffect=function(D,V){return q.current.useEffect(D,V)},dt.useId=function(){return q.current.useId()},dt.useImperativeHandle=function(D,V,te){return q.current.useImperativeHandle(D,V,te)},dt.useInsertionEffect=function(D,V){return q.current.useInsertionEffect(D,V)},dt.useLayoutEffect=function(D,V){return q.current.useLayoutEffect(D,V)},dt.useMemo=function(D,V){return q.current.useMemo(D,V)},dt.useReducer=function(D,V,te){return q.current.useReducer(D,V,te)},dt.useRef=function(D){return q.current.useRef(D)},dt.useState=function(D){return q.current.useState(D)},dt.useSyncExternalStore=function(D,V,te){return q.current.useSyncExternalStore(D,V,te)},dt.useTransition=function(){return q.current.useTransition()},dt.version="18.3.1",dt}bo.exports=YS();var N=bo.exports;const ve=on(N);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H_;function KS(){if(H_)return An;H_=1;var e=N,t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(u,d,f){var p,m={},h=null,_=null;f!==void 0&&(h=""+f),d.key!==void 0&&(h=""+d.key),d.ref!==void 0&&(_=d.ref);for(p in d)s.call(d,p)&&!i.hasOwnProperty(p)&&(m[p]=d[p]);if(u&&u.defaultProps)for(p in d=u.defaultProps,d)m[p]===void 0&&(m[p]=d[p]);return{$$typeof:t,type:u,key:h,ref:_,props:m,_owner:r.current}}return An.Fragment=n,An.jsx=l,An.jsxs=l,An}Mn.exports=KS();var a=Mn.exports,kf={},q_={exports:{}},Ss={},Mf={exports:{}},Af={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V_;function GS(){return V_||(V_=1,function(e){function t(H,W){var B=H.length;H.push(W);e:for(;0<B;){var D=B-1>>>1,V=H[D];if(0<r(V,W))H[D]=W,H[B]=V,B=D;else break e}}function n(H){return H.length===0?null:H[0]}function s(H){if(H.length===0)return null;var W=H[0],B=H.pop();if(B!==W){H[0]=B;e:for(var D=0,V=H.length,te=V>>>1;D<te;){var G=2*(D+1)-1,K=H[G],X=G+1,Q=H[X];if(0>r(K,B))X<V&&0>r(Q,K)?(H[D]=Q,H[X]=B,D=X):(H[D]=K,H[G]=B,D=G);else if(X<V&&0>r(Q,B))H[D]=Q,H[X]=B,D=X;else break e}}return W}function r(H,W){var B=H.sortIndex-W.sortIndex;return B!==0?B:H.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var l=Date,u=l.now();e.unstable_now=function(){return l.now()-u}}var d=[],f=[],p=1,m=null,h=3,_=!1,x=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j(H){for(var W=n(f);W!==null;){if(W.callback===null)s(f);else if(W.startTime<=H)s(f),W.sortIndex=W.expirationTime,t(d,W);else break;W=n(f)}}function b(H){if(y=!1,j(H),!x)if(n(d)!==null)x=!0,U(S);else{var W=n(f);W!==null&&q(b,W.startTime-H)}}function S(H,W){x=!1,y&&(y=!1,w(O),O=-1),_=!0;var B=h;try{for(j(W),m=n(d);m!==null&&(!(m.expirationTime>W)||H&&!A());){var D=m.callback;if(typeof D=="function"){m.callback=null,h=m.priorityLevel;var V=D(m.expirationTime<=W);W=e.unstable_now(),typeof V=="function"?m.callback=V:m===n(d)&&s(d),j(W)}else s(d);m=n(d)}if(m!==null)var te=!0;else{var G=n(f);G!==null&&q(b,G.startTime-W),te=!1}return te}finally{m=null,h=B,_=!1}}var E=!1,M=null,O=-1,$=5,P=-1;function A(){return!(e.unstable_now()-P<$)}function R(){if(M!==null){var H=e.unstable_now();P=H;var W=!0;try{W=M(!0,H)}finally{W?F():(E=!1,M=null)}}else E=!1}var F;if(typeof k=="function")F=function(){k(R)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,I=z.port2;z.port1.onmessage=R,F=function(){I.postMessage(null)}}else F=function(){v(R,0)};function U(H){M=H,E||(E=!0,F())}function q(H,W){O=v(function(){H(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_continueExecution=function(){x||_||(x=!0,U(S))},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(H){switch(h){case 1:case 2:case 3:var W=3;break;default:W=h}var B=h;h=W;try{return H()}finally{h=B}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(H,W){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var B=h;h=H;try{return W()}finally{h=B}},e.unstable_scheduleCallback=function(H,W,B){var D=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?D+B:D):B=D,H){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=B+V,H={id:p++,callback:W,priorityLevel:H,startTime:B,expirationTime:V,sortIndex:-1},B>D?(H.sortIndex=B,t(f,H),n(d)===null&&H===n(f)&&(y?(w(O),O=-1):y=!0,q(b,B-D))):(H.sortIndex=V,t(d,H),x||_||(x=!0,U(S))),H},e.unstable_shouldYield=A,e.unstable_wrapCallback=function(H){var W=h;return function(){var B=h;h=W;try{return H.apply(this,arguments)}finally{h=B}}}}(Af)),Af}var W_;function XS(){return W_||(W_=1,Mf.exports=GS()),Mf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y_;function QS(){if(Y_)return Ss;Y_=1;var e=N,t=XS();function n(o){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+o,g=1;g<arguments.length;g++)c+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function i(o,c){l(o,c),l(o+"Capture",c)}function l(o,c){for(r[o]=c,o=0;o<c.length;o++)s.add(c[o])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function h(o){return d.call(m,o)?!0:d.call(p,o)?!1:f.test(o)?m[o]=!0:(p[o]=!0,!1)}function _(o,c,g,C){if(g!==null&&g.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return C?!1:g!==null?!g.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function x(o,c,g,C){if(c===null||typeof c>"u"||_(o,c,g,C))return!0;if(C)return!1;if(g!==null)switch(g.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function y(o,c,g,C,T,L,Y){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=C,this.attributeNamespace=T,this.mustUseProperty=g,this.propertyName=o,this.type=c,this.sanitizeURL=L,this.removeEmptyString=Y}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){v[o]=new y(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var c=o[0];v[c]=new y(c,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){v[o]=new y(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){v[o]=new y(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){v[o]=new y(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){v[o]=new y(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){v[o]=new y(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){v[o]=new y(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){v[o]=new y(o,5,!1,o.toLowerCase(),null,!1,!1)});var w=/[\-:]([a-z])/g;function k(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var c=o.replace(w,k);v[c]=new y(c,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var c=o.replace(w,k);v[c]=new y(c,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var c=o.replace(w,k);v[c]=new y(c,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){v[o]=new y(o,1,!1,o.toLowerCase(),null,!1,!1)}),v.xlinkHref=new y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){v[o]=new y(o,1,!1,o.toLowerCase(),null,!0,!0)});function j(o,c,g,C){var T=v.hasOwnProperty(c)?v[c]:null;(T!==null?T.type!==0:C||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(x(c,g,T,C)&&(g=null),C||T===null?h(c)&&(g===null?o.removeAttribute(c):o.setAttribute(c,""+g)):T.mustUseProperty?o[T.propertyName]=g===null?T.type===3?!1:"":g:(c=T.attributeName,C=T.attributeNamespace,g===null?o.removeAttribute(c):(T=T.type,g=T===3||T===4&&g===!0?"":""+g,C?o.setAttributeNS(C,c,g):o.setAttribute(c,g))))}var b=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),E=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),$=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),A=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),q=Symbol.for("react.offscreen"),H=Symbol.iterator;function W(o){return o===null||typeof o!="object"?null:(o=H&&o[H]||o["@@iterator"],typeof o=="function"?o:null)}var B=Object.assign,D;function V(o){if(D===void 0)try{throw Error()}catch(g){var c=g.stack.trim().match(/\n( *(at )?)/);D=c&&c[1]||""}return`
`+D+o}var te=!1;function G(o,c){if(!o||te)return"";te=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(he){var C=he}Reflect.construct(o,[],c)}else{try{c.call()}catch(he){C=he}o.call(c.prototype)}else{try{throw Error()}catch(he){C=he}o()}}catch(he){if(he&&C&&typeof he.stack=="string"){for(var T=he.stack.split(`
`),L=C.stack.split(`
`),Y=T.length-1,se=L.length-1;1<=Y&&0<=se&&T[Y]!==L[se];)se--;for(;1<=Y&&0<=se;Y--,se--)if(T[Y]!==L[se]){if(Y!==1||se!==1)do if(Y--,se--,0>se||T[Y]!==L[se]){var ae=`
`+T[Y].replace(" at new "," at ");return o.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",o.displayName)),ae}while(1<=Y&&0<=se);break}}}finally{te=!1,Error.prepareStackTrace=g}return(o=o?o.displayName||o.name:"")?V(o):""}function K(o){switch(o.tag){case 5:return V(o.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return o=G(o.type,!1),o;case 11:return o=G(o.type.render,!1),o;case 1:return o=G(o.type,!0),o;default:return""}}function X(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case M:return"Fragment";case E:return"Portal";case $:return"Profiler";case O:return"StrictMode";case F:return"Suspense";case z:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case A:return(o.displayName||"Context")+".Consumer";case P:return(o._context.displayName||"Context")+".Provider";case R:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case I:return c=o.displayName||null,c!==null?c:X(o.type)||"Memo";case U:c=o._payload,o=o._init;try{return X(o(c))}catch{}}return null}function Q(o){var c=o.type;switch(o.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=c.render,o=o.displayName||o.name||"",c.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return X(c);case 8:return c===O?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function J(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Z(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function ee(o){var c=Z(o)?"checked":"value",g=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),C=""+o[c];if(!o.hasOwnProperty(c)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var T=g.get,L=g.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return T.call(this)},set:function(Y){C=""+Y,L.call(this,Y)}}),Object.defineProperty(o,c,{enumerable:g.enumerable}),{getValue:function(){return C},setValue:function(Y){C=""+Y},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function de(o){o._valueTracker||(o._valueTracker=ee(o))}function _e(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var g=c.getValue(),C="";return o&&(C=Z(o)?o.checked?"true":"false":o.value),o=C,o!==g?(c.setValue(o),!0):!1}function ge(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function be(o,c){var g=c.checked;return B({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:g??o._wrapperState.initialChecked})}function ze(o,c){var g=c.defaultValue==null?"":c.defaultValue,C=c.checked!=null?c.checked:c.defaultChecked;g=J(c.value!=null?c.value:g),o._wrapperState={initialChecked:C,initialValue:g,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function Ee(o,c){c=c.checked,c!=null&&j(o,"checked",c,!1)}function ie(o,c){Ee(o,c);var g=J(c.value),C=c.type;if(g!=null)C==="number"?(g===0&&o.value===""||o.value!=g)&&(o.value=""+g):o.value!==""+g&&(o.value=""+g);else if(C==="submit"||C==="reset"){o.removeAttribute("value");return}c.hasOwnProperty("value")?Ce(o,c.type,g):c.hasOwnProperty("defaultValue")&&Ce(o,c.type,J(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(o.defaultChecked=!!c.defaultChecked)}function pe(o,c,g){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var C=c.type;if(!(C!=="submit"&&C!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+o._wrapperState.initialValue,g||c===o.value||(o.value=c),o.defaultValue=c}g=o.name,g!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,g!==""&&(o.name=g)}function Ce(o,c,g){(c!=="number"||ge(o.ownerDocument)!==o)&&(g==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+g&&(o.defaultValue=""+g))}var Te=Array.isArray;function De(o,c,g,C){if(o=o.options,c){c={};for(var T=0;T<g.length;T++)c["$"+g[T]]=!0;for(g=0;g<o.length;g++)T=c.hasOwnProperty("$"+o[g].value),o[g].selected!==T&&(o[g].selected=T),T&&C&&(o[g].defaultSelected=!0)}else{for(g=""+J(g),c=null,T=0;T<o.length;T++){if(o[T].value===g){o[T].selected=!0,C&&(o[T].defaultSelected=!0);return}c!==null||o[T].disabled||(c=o[T])}c!==null&&(c.selected=!0)}}function ce(o,c){if(c.dangerouslySetInnerHTML!=null)throw Error(n(91));return B({},c,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Oe(o,c){var g=c.value;if(g==null){if(g=c.children,c=c.defaultValue,g!=null){if(c!=null)throw Error(n(92));if(Te(g)){if(1<g.length)throw Error(n(93));g=g[0]}c=g}c==null&&(c=""),g=c}o._wrapperState={initialValue:J(g)}}function qe(o,c){var g=J(c.value),C=J(c.defaultValue);g!=null&&(g=""+g,g!==o.value&&(o.value=g),c.defaultValue==null&&o.defaultValue!==g&&(o.defaultValue=g)),C!=null&&(o.defaultValue=""+C)}function Qe(o){var c=o.textContent;c===o._wrapperState.initialValue&&c!==""&&c!==null&&(o.value=c)}function Ye(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function at(o,c){return o==null||o==="http://www.w3.org/1999/xhtml"?Ye(c):o==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var et,ot=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,g,C,T){MSApp.execUnsafeLocalFunction(function(){return o(c,g,C,T)})}:o}(function(o,c){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=c;else{for(et=et||document.createElement("div"),et.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=et.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;c.firstChild;)o.appendChild(c.firstChild)}});function Nt(o,c){if(c){var g=o.firstChild;if(g&&g===o.lastChild&&g.nodeType===3){g.nodeValue=c;return}}o.textContent=c}var Tt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tt=["Webkit","ms","Moz","O"];Object.keys(Tt).forEach(function(o){tt.forEach(function(c){c=c+o.charAt(0).toUpperCase()+o.substring(1),Tt[c]=Tt[o]})});function Ft(o,c,g){return c==null||typeof c=="boolean"||c===""?"":g||typeof c!="number"||c===0||Tt.hasOwnProperty(o)&&Tt[o]?(""+c).trim():c+"px"}function Wt(o,c){o=o.style;for(var g in c)if(c.hasOwnProperty(g)){var C=g.indexOf("--")===0,T=Ft(g,c[g],C);g==="float"&&(g="cssFloat"),C?o.setProperty(g,T):o[g]=T}}var Pt=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bn(o,c){if(c){if(Pt[o]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(n(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(n(61))}if(c.style!=null&&typeof c.style!="object")throw Error(n(62))}}function gn(o,c){if(o.indexOf("-")===-1)return typeof c.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jt=null;function cn(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var un=null,Lt=null,ut=null;function wn(o){if(o=yi(o)){if(typeof un!="function")throw Error(n(280));var c=o.stateNode;c&&(c=Ol(c),un(o.stateNode,o.type,c))}}function ht(o){Lt?ut?ut.push(o):ut=[o]:Lt=o}function Bt(){if(Lt){var o=Lt,c=ut;if(ut=Lt=null,wn(o),c)for(o=0;o<c.length;o++)wn(c[o])}}function mt(o,c){return o(c)}function Vn(){}var _n=!1;function ls(o,c,g){if(_n)return o(c,g);_n=!0;try{return mt(o,c,g)}finally{_n=!1,(Lt!==null||ut!==null)&&(Vn(),Bt())}}function xt(o,c){var g=o.stateNode;if(g===null)return null;var C=Ol(g);if(C===null)return null;g=C[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(o=o.type,C=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!C;break e;default:o=!1}if(o)return null;if(g&&typeof g!="function")throw Error(n(231,c,typeof g));return g}var pt=!1;if(u)try{var yn={};Object.defineProperty(yn,"passive",{get:function(){pt=!0}}),window.addEventListener("test",yn,yn),window.removeEventListener("test",yn,yn)}catch{pt=!1}function ys(o,c,g,C,T,L,Y,se,ae){var he=Array.prototype.slice.call(arguments,3);try{c.apply(g,he)}catch(je){this.onError(je)}}var dn=!1,Xt=null,tn=!1,Nn=null,Wn={onError:function(o){dn=!0,Xt=o}};function Yn(o,c,g,C,T,L,Y,se,ae){dn=!1,Xt=null,ys.apply(Wn,arguments)}function vt(o,c,g,C,T,L,Y,se,ae){if(Yn.apply(this,arguments),dn){if(dn){var he=Xt;dn=!1,Xt=null}else throw Error(n(198));tn||(tn=!0,Nn=he)}}function Yt(o){var c=o,g=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,c.flags&4098&&(g=c.return),o=c.return;while(o)}return c.tag===3?g:null}function Jn(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function $n(o){if(Yt(o)!==o)throw Error(n(188))}function Xs(o){var c=o.alternate;if(!c){if(c=Yt(o),c===null)throw Error(n(188));return c!==o?null:o}for(var g=o,C=c;;){var T=g.return;if(T===null)break;var L=T.alternate;if(L===null){if(C=T.return,C!==null){g=C;continue}break}if(T.child===L.child){for(L=T.child;L;){if(L===g)return $n(T),o;if(L===C)return $n(T),c;L=L.sibling}throw Error(n(188))}if(g.return!==C.return)g=T,C=L;else{for(var Y=!1,se=T.child;se;){if(se===g){Y=!0,g=T,C=L;break}if(se===C){Y=!0,C=T,g=L;break}se=se.sibling}if(!Y){for(se=L.child;se;){if(se===g){Y=!0,g=L,C=T;break}if(se===C){Y=!0,C=L,g=T;break}se=se.sibling}if(!Y)throw Error(n(189))}}if(g.alternate!==C)throw Error(n(190))}if(g.tag!==3)throw Error(n(188));return g.stateNode.current===g?o:c}function vs(o){return o=Xs(o),o!==null?cs(o):null}function cs(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var c=cs(o);if(c!==null)return c;o=o.sibling}return null}var $s=t.unstable_scheduleCallback,Kt=t.unstable_cancelCallback,Ts=t.unstable_shouldYield,Ut=t.unstable_requestPaint,$e=t.unstable_now,Dt=t.unstable_getCurrentPriorityLevel,Ps=t.unstable_ImmediatePriority,es=t.unstable_UserBlockingPriority,ue=t.unstable_NormalPriority,we=t.unstable_LowPriority,Fe=t.unstable_IdlePriority,gt=null,ke=null;function kt(o){if(ke&&typeof ke.onCommitFiberRoot=="function")try{ke.onCommitFiberRoot(gt,o,void 0,(o.current.flags&128)===128)}catch{}}var nt=Math.clz32?Math.clz32:Mt,nn=Math.log,vn=Math.LN2;function Mt(o){return o>>>=0,o===0?32:31-(nn(o)/vn|0)|0}var Zt=64,ts=4194304;function Tn(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function Pn(o,c){var g=o.pendingLanes;if(g===0)return 0;var C=0,T=o.suspendedLanes,L=o.pingedLanes,Y=g&268435455;if(Y!==0){var se=Y&~T;se!==0?C=Tn(se):(L&=Y,L!==0&&(C=Tn(L)))}else Y=g&~T,Y!==0?C=Tn(Y):L!==0&&(C=Tn(L));if(C===0)return 0;if(c!==0&&c!==C&&!(c&T)&&(T=C&-C,L=c&-c,T>=L||T===16&&(L&4194240)!==0))return c;if(C&4&&(C|=g&16),c=o.entangledLanes,c!==0)for(o=o.entanglements,c&=C;0<c;)g=31-nt(c),T=1<<g,C|=o[g],c&=~T;return C}function xs(o,c){switch(o){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jn(o,c){for(var g=o.suspendedLanes,C=o.pingedLanes,T=o.expirationTimes,L=o.pendingLanes;0<L;){var Y=31-nt(L),se=1<<Y,ae=T[Y];ae===-1?(!(se&g)||se&C)&&(T[Y]=xs(se,c)):ae<=c&&(o.expiredLanes|=se),L&=~se}}function Ln(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function bs(){var o=Zt;return Zt<<=1,!(Zt&4194240)&&(Zt=64),o}function ws(o){for(var c=[],g=0;31>g;g++)c.push(o);return c}function Ls(o,c,g){o.pendingLanes|=c,c!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,c=31-nt(c),o[c]=g}function qr(o,c){var g=o.pendingLanes&~c;o.pendingLanes=c,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=c,o.mutableReadLanes&=c,o.entangledLanes&=c,c=o.entanglements;var C=o.eventTimes;for(o=o.expirationTimes;0<g;){var T=31-nt(g),L=1<<T;c[T]=0,C[T]=-1,o[T]=-1,g&=~L}}function Vr(o,c){var g=o.entangledLanes|=c;for(o=o.entanglements;g;){var C=31-nt(g),T=1<<C;T&c|o[C]&c&&(o[C]|=c),g&=~T}}var St=0;function wl(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var dr,Qo,pa,Zo,Nl,Jo=!1,ga=[],Qs=null,Zs=null,Js=null,ne=new Map,ye=new Map,fe=[],Pe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ae(o,c){switch(o){case"focusin":case"focusout":Qs=null;break;case"dragenter":case"dragleave":Zs=null;break;case"mouseover":case"mouseout":Js=null;break;case"pointerover":case"pointerout":ne.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":ye.delete(c.pointerId)}}function xe(o,c,g,C,T,L){return o===null||o.nativeEvent!==L?(o={blockedOn:c,domEventName:g,eventSystemFlags:C,nativeEvent:L,targetContainers:[T]},c!==null&&(c=yi(c),c!==null&&Qo(c)),o):(o.eventSystemFlags|=C,c=o.targetContainers,T!==null&&c.indexOf(T)===-1&&c.push(T),o)}function st(o,c,g,C,T){switch(c){case"focusin":return Qs=xe(Qs,o,c,g,C,T),!0;case"dragenter":return Zs=xe(Zs,o,c,g,C,T),!0;case"mouseover":return Js=xe(Js,o,c,g,C,T),!0;case"pointerover":var L=T.pointerId;return ne.set(L,xe(ne.get(L)||null,o,c,g,C,T)),!0;case"gotpointercapture":return L=T.pointerId,ye.set(L,xe(ye.get(L)||null,o,c,g,C,T)),!0}return!1}function Ve(o){var c=wa(o.target);if(c!==null){var g=Yt(c);if(g!==null){if(c=g.tag,c===13){if(c=Jn(g),c!==null){o.blockedOn=c,Nl(o.priority,function(){pa(g)});return}}else if(c===3&&g.stateNode.current.memoizedState.isDehydrated){o.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}o.blockedOn=null}function ct(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var g=Ns(o.domEventName,o.eventSystemFlags,c[0],o.nativeEvent);if(g===null){g=o.nativeEvent;var C=new g.constructor(g.type,g);jt=C,g.target.dispatchEvent(C),jt=null}else return c=yi(g),c!==null&&Qo(c),o.blockedOn=g,!1;c.shift()}return!0}function it(o,c,g){ct(o)&&g.delete(c)}function rt(){Jo=!1,Qs!==null&&ct(Qs)&&(Qs=null),Zs!==null&&ct(Zs)&&(Zs=null),Js!==null&&ct(Js)&&(Js=null),ne.forEach(it),ye.forEach(it)}function _t(o,c){o.blockedOn===c&&(o.blockedOn=null,Jo||(Jo=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,rt)))}function sn(o){function c(T){return _t(T,o)}if(0<ga.length){_t(ga[0],o);for(var g=1;g<ga.length;g++){var C=ga[g];C.blockedOn===o&&(C.blockedOn=null)}}for(Qs!==null&&_t(Qs,o),Zs!==null&&_t(Zs,o),Js!==null&&_t(Js,o),ne.forEach(c),ye.forEach(c),g=0;g<fe.length;g++)C=fe[g],C.blockedOn===o&&(C.blockedOn=null);for(;0<fe.length&&(g=fe[0],g.blockedOn===null);)Ve(g),g.blockedOn===null&&fe.shift()}var It=b.ReactCurrentBatchConfig,Bn=!0;function Wr(o,c,g,C){var T=St,L=It.transition;It.transition=null;try{St=1,zs(o,c,g,C)}finally{St=T,It.transition=L}}function kr(o,c,g,C){var T=St,L=It.transition;It.transition=null;try{St=4,zs(o,c,g,C)}finally{St=T,It.transition=L}}function zs(o,c,g,C){if(Bn){var T=Ns(o,c,g,C);if(T===null)lu(o,c,C,us,g),Ae(o,C);else if(st(T,o,c,g,C))C.stopPropagation();else if(Ae(o,C),c&4&&-1<Pe.indexOf(o)){for(;T!==null;){var L=yi(T);if(L!==null&&dr(L),L=Ns(o,c,g,C),L===null&&lu(o,c,C,us,g),L===T)break;T=L}T!==null&&C.stopPropagation()}else lu(o,c,C,null,g)}}var us=null;function Ns(o,c,g,C){if(us=null,o=cn(C),o=wa(o),o!==null)if(c=Yt(o),c===null)o=null;else if(g=c.tag,g===13){if(o=Jn(c),o!==null)return o;o=null}else if(g===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null);return us=o,null}function Cn(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Dt()){case Ps:return 1;case es:return 4;case ue:case we:return 16;case Fe:return 536870912;default:return 16}default:return 16}}var zn=null,_a=null,Yr=null;function ei(){if(Yr)return Yr;var o,c=_a,g=c.length,C,T="value"in zn?zn.value:zn.textContent,L=T.length;for(o=0;o<g&&c[o]===T[o];o++);var Y=g-o;for(C=1;C<=Y&&c[g-C]===T[L-C];C++);return Yr=T.slice(o,1<C?1-C:void 0)}function ya(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function Kr(){return!0}function to(){return!1}function ns(o){function c(g,C,T,L,Y){this._reactName=g,this._targetInst=T,this.type=C,this.nativeEvent=L,this.target=Y,this.currentTarget=null;for(var se in o)o.hasOwnProperty(se)&&(g=o[se],this[se]=g?g(L):L[se]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Kr:to,this.isPropagationStopped=to,this}return B(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=Kr)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=Kr)},persist:function(){},isPersistent:Kr}),c}var mr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},va=ns(mr),mn=B({},mr,{view:0,detail:0}),ti=ns(mn),ni,si,Mr,Jt=B({},mn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jl,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Mr&&(Mr&&o.type==="mousemove"?(ni=o.screenX-Mr.screenX,si=o.screenY-Mr.screenY):si=ni=0,Mr=o),ni)},movementY:function(o){return"movementY"in o?o.movementY:si}}),ss=ns(Jt),er=B({},Jt,{dataTransfer:0}),Gc=ns(er),ri=B({},mn,{relatedTarget:0}),xa=ns(ri),no=B({},mr,{animationName:0,elapsedTime:0,pseudoElement:0}),ai=ns(no),oi=B({},mr,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),ii=ns(oi),rg=B({},mr,{data:0}),dm=ns(rg),ag={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mm={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},og={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ig(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=og[o])?!!c[o]:!1}function jl(){return ig}var fm=B({},mn,{key:function(o){if(o.key){var c=ag[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=ya(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?mm[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jl,charCode:function(o){return o.type==="keypress"?ya(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?ya(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),lg=ns(fm),cg=B({},Jt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xc=ns(cg),hm=B({},mn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jl}),so=ns(hm),pm=B({},mr,{propertyName:0,elapsedTime:0,pseudoElement:0}),ug=ns(pm),gm=B({},Jt,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),_m=ns(gm),dg=[9,13,27,32],Cl=u&&"CompositionEvent"in window,ro=null;u&&"documentMode"in document&&(ro=document.documentMode);var mg=u&&"TextEvent"in window&&!ro,Qc=u&&(!Cl||ro&&8<ro&&11>=ro),fg=" ",ym=!1;function vm(o,c){switch(o){case"keyup":return dg.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xm(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Rs=!1;function Zc(o,c){switch(o){case"compositionend":return xm(c);case"keypress":return c.which!==32?null:(ym=!0,fg);case"textInput":return o=c.data,o===fg&&ym?null:o;default:return null}}function Jc(o,c){if(Rs)return o==="compositionend"||!Cl&&vm(o,c)?(o=ei(),Yr=_a=zn=null,Rs=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Qc&&c.locale!=="ko"?null:c.data;default:return null}}var li={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ci(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!li[o.type]:c==="textarea"}function ba(o,c,g,C){ht(C),c=Ml(c,"onChange"),0<c.length&&(g=new va("onChange","change",null,g,C),o.push({event:g,listeners:c}))}var tr=null,ui=null;function Sn(o){zm(o,0)}function Qt(o){var c=lo(o);if(_e(c))return o}function At(o,c){if(o==="change")return c}var nr=!1;if(u){var Sl;if(u){var rn="oninput"in document;if(!rn){var bm=document.createElement("div");bm.setAttribute("oninput","return;"),rn=typeof bm.oninput=="function"}Sl=rn}else Sl=!1;nr=Sl&&(!document.documentMode||9<document.documentMode)}function wm(){tr&&(tr.detachEvent("onpropertychange",Nm),ui=tr=null)}function Nm(o){if(o.propertyName==="value"&&Qt(ui)){var c=[];ba(c,ui,o,cn(o)),ls(Sn,c)}}function hg(o,c,g){o==="focusin"?(wm(),tr=c,ui=g,tr.attachEvent("onpropertychange",Nm)):o==="focusout"&&wm()}function pg(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Qt(ui)}function gg(o,c){if(o==="click")return Qt(c)}function _g(o,c){if(o==="input"||o==="change")return Qt(c)}function yg(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var sr=typeof Object.is=="function"?Object.is:yg;function di(o,c){if(sr(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var g=Object.keys(o),C=Object.keys(c);if(g.length!==C.length)return!1;for(C=0;C<g.length;C++){var T=g[C];if(!d.call(c,T)||!sr(o[T],c[T]))return!1}return!0}function jm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Cm(o,c){var g=jm(o);o=0;for(var C;g;){if(g.nodeType===3){if(C=o+g.textContent.length,o<=c&&C>=c)return{node:g,offset:c-o};o=C}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=jm(g)}}function Sm(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?Sm(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function Em(){for(var o=window,c=ge();c instanceof o.HTMLIFrameElement;){try{var g=typeof c.contentWindow.location.href=="string"}catch{g=!1}if(g)o=c.contentWindow;else break;c=ge(o.document)}return c}function eu(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}function vg(o){var c=Em(),g=o.focusedElem,C=o.selectionRange;if(c!==g&&g&&g.ownerDocument&&Sm(g.ownerDocument.documentElement,g)){if(C!==null&&eu(g)){if(c=C.start,o=C.end,o===void 0&&(o=c),"selectionStart"in g)g.selectionStart=c,g.selectionEnd=Math.min(o,g.value.length);else if(o=(c=g.ownerDocument||document)&&c.defaultView||window,o.getSelection){o=o.getSelection();var T=g.textContent.length,L=Math.min(C.start,T);C=C.end===void 0?L:Math.min(C.end,T),!o.extend&&L>C&&(T=C,C=L,L=T),T=Cm(g,L);var Y=Cm(g,C);T&&Y&&(o.rangeCount!==1||o.anchorNode!==T.node||o.anchorOffset!==T.offset||o.focusNode!==Y.node||o.focusOffset!==Y.offset)&&(c=c.createRange(),c.setStart(T.node,T.offset),o.removeAllRanges(),L>C?(o.addRange(c),o.extend(Y.node,Y.offset)):(c.setEnd(Y.node,Y.offset),o.addRange(c)))}}for(c=[],o=g;o=o.parentNode;)o.nodeType===1&&c.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<c.length;g++)o=c[g],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var xg=u&&"documentMode"in document&&11>=document.documentMode,mi=null,km=null,rr=null,tu=!1;function Mm(o,c,g){var C=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;tu||mi==null||mi!==ge(C)||(C=mi,"selectionStart"in C&&eu(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),rr&&di(rr,C)||(rr=C,C=Ml(km,"onSelect"),0<C.length&&(c=new va("onSelect","select",null,c,g),o.push({event:c,listeners:C}),c.target=mi)))}function El(o,c){var g={};return g[o.toLowerCase()]=c.toLowerCase(),g["Webkit"+o]="webkit"+c,g["Moz"+o]="moz"+c,g}var ao={animationend:El("Animation","AnimationEnd"),animationiteration:El("Animation","AnimationIteration"),animationstart:El("Animation","AnimationStart"),transitionend:El("Transition","TransitionEnd")},fi={},nu={};u&&(nu=document.createElement("div").style,"AnimationEvent"in window||(delete ao.animationend.animation,delete ao.animationiteration.animation,delete ao.animationstart.animation),"TransitionEvent"in window||delete ao.transitionend.transition);function kl(o){if(fi[o])return fi[o];if(!ao[o])return o;var c=ao[o],g;for(g in c)if(c.hasOwnProperty(g)&&g in nu)return fi[o]=c[g];return o}var Am=kl("animationend"),su=kl("animationiteration"),Om=kl("animationstart"),$m=kl("transitionend"),Tm=new Map,Pm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gr(o,c){Tm.set(o,c),i(c,[o])}for(var ru=0;ru<Pm.length;ru++){var au=Pm[ru],bg=au.toLowerCase(),wg=au[0].toUpperCase()+au.slice(1);Gr(bg,"on"+wg)}Gr(Am,"onAnimationEnd"),Gr(su,"onAnimationIteration"),Gr(Om,"onAnimationStart"),Gr("dblclick","onDoubleClick"),Gr("focusin","onFocus"),Gr("focusout","onBlur"),Gr($m,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ng=new Set("cancel close invalid load scroll toggle".split(" ").concat(hi));function Lm(o,c,g){var C=o.type||"unknown-event";o.currentTarget=g,vt(C,c,void 0,o),o.currentTarget=null}function zm(o,c){c=(c&4)!==0;for(var g=0;g<o.length;g++){var C=o[g],T=C.event;C=C.listeners;e:{var L=void 0;if(c)for(var Y=C.length-1;0<=Y;Y--){var se=C[Y],ae=se.instance,he=se.currentTarget;if(se=se.listener,ae!==L&&T.isPropagationStopped())break e;Lm(T,se,he),L=ae}else for(Y=0;Y<C.length;Y++){if(se=C[Y],ae=se.instance,he=se.currentTarget,se=se.listener,ae!==L&&T.isPropagationStopped())break e;Lm(T,se,he),L=ae}}}if(tn)throw o=Nn,tn=!1,Nn=null,o}function Gt(o,c){var g=c[pu];g===void 0&&(g=c[pu]=new Set);var C=o+"__bubble";g.has(C)||(jg(c,o,2,!1),g.add(C))}function ou(o,c,g){var C=0;c&&(C|=4),jg(g,o,C,c)}var iu="_reactListening"+Math.random().toString(36).slice(2);function pi(o){if(!o[iu]){o[iu]=!0,s.forEach(function(g){g!=="selectionchange"&&(Ng.has(g)||ou(g,!1,o),ou(g,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[iu]||(c[iu]=!0,ou("selectionchange",!1,c))}}function jg(o,c,g,C){switch(Cn(c)){case 1:var T=Wr;break;case 4:T=kr;break;default:T=zs}g=T.bind(null,c,g,o),T=void 0,!pt||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(T=!0),C?T!==void 0?o.addEventListener(c,g,{capture:!0,passive:T}):o.addEventListener(c,g,!0):T!==void 0?o.addEventListener(c,g,{passive:T}):o.addEventListener(c,g,!1)}function lu(o,c,g,C,T){var L=C;if(!(c&1)&&!(c&2)&&C!==null)e:for(;;){if(C===null)return;var Y=C.tag;if(Y===3||Y===4){var se=C.stateNode.containerInfo;if(se===T||se.nodeType===8&&se.parentNode===T)break;if(Y===4)for(Y=C.return;Y!==null;){var ae=Y.tag;if((ae===3||ae===4)&&(ae=Y.stateNode.containerInfo,ae===T||ae.nodeType===8&&ae.parentNode===T))return;Y=Y.return}for(;se!==null;){if(Y=wa(se),Y===null)return;if(ae=Y.tag,ae===5||ae===6){C=L=Y;continue e}se=se.parentNode}}C=C.return}ls(function(){var he=L,je=cn(g),Se=[];e:{var Ne=Tm.get(o);if(Ne!==void 0){var Ie=va,Ue=o;switch(o){case"keypress":if(ya(g)===0)break e;case"keydown":case"keyup":Ie=lg;break;case"focusin":Ue="focus",Ie=xa;break;case"focusout":Ue="blur",Ie=xa;break;case"beforeblur":case"afterblur":Ie=xa;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ie=ss;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ie=Gc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ie=so;break;case Am:case su:case Om:Ie=ai;break;case $m:Ie=ug;break;case"scroll":Ie=ti;break;case"wheel":Ie=_m;break;case"copy":case"cut":case"paste":Ie=ii;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ie=Xc}var He=(c&4)!==0,kn=!He&&o==="scroll",le=He?Ne!==null?Ne+"Capture":null:Ne;He=[];for(var oe=he,me;oe!==null;){me=oe;var Me=me.stateNode;if(me.tag===5&&Me!==null&&(me=Me,le!==null&&(Me=xt(oe,le),Me!=null&&He.push(gi(oe,Me,me)))),kn)break;oe=oe.return}0<He.length&&(Ne=new Ie(Ne,Ue,null,g,je),Se.push({event:Ne,listeners:He}))}}if(!(c&7)){e:{if(Ne=o==="mouseover"||o==="pointerover",Ie=o==="mouseout"||o==="pointerout",Ne&&g!==jt&&(Ue=g.relatedTarget||g.fromElement)&&(wa(Ue)||Ue[Qr]))break e;if((Ie||Ne)&&(Ne=je.window===je?je:(Ne=je.ownerDocument)?Ne.defaultView||Ne.parentWindow:window,Ie?(Ue=g.relatedTarget||g.toElement,Ie=he,Ue=Ue?wa(Ue):null,Ue!==null&&(kn=Yt(Ue),Ue!==kn||Ue.tag!==5&&Ue.tag!==6)&&(Ue=null)):(Ie=null,Ue=he),Ie!==Ue)){if(He=ss,Me="onMouseLeave",le="onMouseEnter",oe="mouse",(o==="pointerout"||o==="pointerover")&&(He=Xc,Me="onPointerLeave",le="onPointerEnter",oe="pointer"),kn=Ie==null?Ne:lo(Ie),me=Ue==null?Ne:lo(Ue),Ne=new He(Me,oe+"leave",Ie,g,je),Ne.target=kn,Ne.relatedTarget=me,Me=null,wa(je)===he&&(He=new He(le,oe+"enter",Ue,g,je),He.target=me,He.relatedTarget=kn,Me=He),kn=Me,Ie&&Ue)t:{for(He=Ie,le=Ue,oe=0,me=He;me;me=oo(me))oe++;for(me=0,Me=le;Me;Me=oo(Me))me++;for(;0<oe-me;)He=oo(He),oe--;for(;0<me-oe;)le=oo(le),me--;for(;oe--;){if(He===le||le!==null&&He===le.alternate)break t;He=oo(He),le=oo(le)}He=null}else He=null;Ie!==null&&Rm(Se,Ne,Ie,He,!1),Ue!==null&&kn!==null&&Rm(Se,kn,Ue,He,!0)}}e:{if(Ne=he?lo(he):window,Ie=Ne.nodeName&&Ne.nodeName.toLowerCase(),Ie==="select"||Ie==="input"&&Ne.type==="file")var We=At;else if(ci(Ne))if(nr)We=_g;else{We=pg;var Ze=hg}else(Ie=Ne.nodeName)&&Ie.toLowerCase()==="input"&&(Ne.type==="checkbox"||Ne.type==="radio")&&(We=gg);if(We&&(We=We(o,he))){ba(Se,We,g,je);break e}Ze&&Ze(o,Ne,he),o==="focusout"&&(Ze=Ne._wrapperState)&&Ze.controlled&&Ne.type==="number"&&Ce(Ne,"number",Ne.value)}switch(Ze=he?lo(he):window,o){case"focusin":(ci(Ze)||Ze.contentEditable==="true")&&(mi=Ze,km=he,rr=null);break;case"focusout":rr=km=mi=null;break;case"mousedown":tu=!0;break;case"contextmenu":case"mouseup":case"dragend":tu=!1,Mm(Se,g,je);break;case"selectionchange":if(xg)break;case"keydown":case"keyup":Mm(Se,g,je)}var Je;if(Cl)e:{switch(o){case"compositionstart":var lt="onCompositionStart";break e;case"compositionend":lt="onCompositionEnd";break e;case"compositionupdate":lt="onCompositionUpdate";break e}lt=void 0}else Rs?vm(o,g)&&(lt="onCompositionEnd"):o==="keydown"&&g.keyCode===229&&(lt="onCompositionStart");lt&&(Qc&&g.locale!=="ko"&&(Rs||lt!=="onCompositionStart"?lt==="onCompositionEnd"&&Rs&&(Je=ei()):(zn=je,_a="value"in zn?zn.value:zn.textContent,Rs=!0)),Ze=Ml(he,lt),0<Ze.length&&(lt=new dm(lt,o,null,g,je),Se.push({event:lt,listeners:Ze}),Je?lt.data=Je:(Je=xm(g),Je!==null&&(lt.data=Je)))),(Je=mg?Zc(o,g):Jc(o,g))&&(he=Ml(he,"onBeforeInput"),0<he.length&&(je=new dm("onBeforeInput","beforeinput",null,g,je),Se.push({event:je,listeners:he}),je.data=Je))}zm(Se,c)})}function gi(o,c,g){return{instance:o,listener:c,currentTarget:g}}function Ml(o,c){for(var g=c+"Capture",C=[];o!==null;){var T=o,L=T.stateNode;T.tag===5&&L!==null&&(T=L,L=xt(o,g),L!=null&&C.unshift(gi(o,L,T)),L=xt(o,c),L!=null&&C.push(gi(o,L,T))),o=o.return}return C}function oo(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Rm(o,c,g,C,T){for(var L=c._reactName,Y=[];g!==null&&g!==C;){var se=g,ae=se.alternate,he=se.stateNode;if(ae!==null&&ae===C)break;se.tag===5&&he!==null&&(se=he,T?(ae=xt(g,L),ae!=null&&Y.unshift(gi(g,ae,se))):T||(ae=xt(g,L),ae!=null&&Y.push(gi(g,ae,se)))),g=g.return}Y.length!==0&&o.push({event:c,listeners:Y})}var Cg=/\r\n?/g,Sg=/\u0000|\uFFFD/g;function Dm(o){return(typeof o=="string"?o:""+o).replace(Cg,`
`).replace(Sg,"")}function cu(o,c,g){if(c=Dm(c),Dm(o)!==c&&g)throw Error(n(425))}function Al(){}var uu=null,du=null;function mu(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var fu=typeof setTimeout=="function"?setTimeout:void 0,Eg=typeof clearTimeout=="function"?clearTimeout:void 0,Im=typeof Promise=="function"?Promise:void 0,mC=typeof queueMicrotask=="function"?queueMicrotask:typeof Im<"u"?function(o){return Im.resolve(null).then(o).catch(kg)}:fu;function kg(o){setTimeout(function(){throw o})}function hu(o,c){var g=c,C=0;do{var T=g.nextSibling;if(o.removeChild(g),T&&T.nodeType===8)if(g=T.data,g==="/$"){if(C===0){o.removeChild(T),sn(c);return}C--}else g!=="$"&&g!=="$?"&&g!=="$!"||C++;g=T}while(g);sn(c)}function Xr(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return o}function Fm(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var g=o.data;if(g==="$"||g==="$!"||g==="$?"){if(c===0)return o;c--}else g==="/$"&&c++}o=o.previousSibling}return null}var io=Math.random().toString(36).slice(2),fr="__reactFiber$"+io,_i="__reactProps$"+io,Qr="__reactContainer$"+io,pu="__reactEvents$"+io,Mg="__reactListeners$"+io,Ag="__reactHandles$"+io;function wa(o){var c=o[fr];if(c)return c;for(var g=o.parentNode;g;){if(c=g[Qr]||g[fr]){if(g=c.alternate,c.child!==null||g!==null&&g.child!==null)for(o=Fm(o);o!==null;){if(g=o[fr])return g;o=Fm(o)}return c}o=g,g=o.parentNode}return null}function yi(o){return o=o[fr]||o[Qr],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function lo(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function Ol(o){return o[_i]||null}var gu=[],Ds=-1;function bt(o){return{current:o}}function qt(o){0>Ds||(o.current=gu[Ds],gu[Ds]=null,Ds--)}function Ht(o,c){Ds++,gu[Ds]=o.current,o.current=c}var Ar={},En=bt(Ar),Is=bt(!1),vi=Ar;function $l(o,c){var g=o.type.contextTypes;if(!g)return Ar;var C=o.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===c)return C.__reactInternalMemoizedMaskedChildContext;var T={},L;for(L in g)T[L]=c[L];return C&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=c,o.__reactInternalMemoizedMaskedChildContext=T),T}function Fs(o){return o=o.childContextTypes,o!=null}function Bm(){qt(Is),qt(En)}function fC(o,c,g){if(En.current!==Ar)throw Error(n(168));Ht(En,c),Ht(Is,g)}function hC(o,c,g){var C=o.stateNode;if(c=c.childContextTypes,typeof C.getChildContext!="function")return g;C=C.getChildContext();for(var T in C)if(!(T in c))throw Error(n(108,Q(o)||"Unknown",T));return B({},g,C)}function Um(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Ar,vi=En.current,Ht(En,o),Ht(Is,Is.current),!0}function pC(o,c,g){var C=o.stateNode;if(!C)throw Error(n(169));g?(o=hC(o,c,vi),C.__reactInternalMemoizedMergedChildContext=o,qt(Is),qt(En),Ht(En,o)):qt(Is),Ht(Is,g)}var Na=null,Hm=!1,Og=!1;function gC(o){Na===null?Na=[o]:Na.push(o)}function XB(o){Hm=!0,gC(o)}function co(){if(!Og&&Na!==null){Og=!0;var o=0,c=St;try{var g=Na;for(St=1;o<g.length;o++){var C=g[o];do C=C(!0);while(C!==null)}Na=null,Hm=!1}catch(T){throw Na!==null&&(Na=Na.slice(o+1)),$s(Ps,co),T}finally{St=c,Og=!1}}return null}var Tl=[],Pl=0,qm=null,Vm=0,hr=[],pr=0,xi=null,ja=1,Ca="";function bi(o,c){Tl[Pl++]=Vm,Tl[Pl++]=qm,qm=o,Vm=c}function _C(o,c,g){hr[pr++]=ja,hr[pr++]=Ca,hr[pr++]=xi,xi=o;var C=ja;o=Ca;var T=32-nt(C)-1;C&=~(1<<T),g+=1;var L=32-nt(c)+T;if(30<L){var Y=T-T%5;L=(C&(1<<Y)-1).toString(32),C>>=Y,T-=Y,ja=1<<32-nt(c)+T|g<<T|C,Ca=L+o}else ja=1<<L|g<<T|C,Ca=o}function $g(o){o.return!==null&&(bi(o,1),_C(o,1,0))}function Tg(o){for(;o===qm;)qm=Tl[--Pl],Tl[Pl]=null,Vm=Tl[--Pl],Tl[Pl]=null;for(;o===xi;)xi=hr[--pr],hr[pr]=null,Ca=hr[--pr],hr[pr]=null,ja=hr[--pr],hr[pr]=null}var ar=null,or=null,an=!1,Or=null;function yC(o,c){var g=vr(5,null,null,0);g.elementType="DELETED",g.stateNode=c,g.return=o,c=o.deletions,c===null?(o.deletions=[g],o.flags|=16):c.push(g)}function vC(o,c){switch(o.tag){case 5:var g=o.type;return c=c.nodeType!==1||g.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(o.stateNode=c,ar=o,or=Xr(c.firstChild),!0):!1;case 6:return c=o.pendingProps===""||c.nodeType!==3?null:c,c!==null?(o.stateNode=c,ar=o,or=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(g=xi!==null?{id:ja,overflow:Ca}:null,o.memoizedState={dehydrated:c,treeContext:g,retryLane:1073741824},g=vr(18,null,null,0),g.stateNode=c,g.return=o,o.child=g,ar=o,or=null,!0):!1;default:return!1}}function Pg(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Lg(o){if(an){var c=or;if(c){var g=c;if(!vC(o,c)){if(Pg(o))throw Error(n(418));c=Xr(g.nextSibling);var C=ar;c&&vC(o,c)?yC(C,g):(o.flags=o.flags&-4097|2,an=!1,ar=o)}}else{if(Pg(o))throw Error(n(418));o.flags=o.flags&-4097|2,an=!1,ar=o}}}function xC(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;ar=o}function Wm(o){if(o!==ar)return!1;if(!an)return xC(o),an=!0,!1;var c;if((c=o.tag!==3)&&!(c=o.tag!==5)&&(c=o.type,c=c!=="head"&&c!=="body"&&!mu(o.type,o.memoizedProps)),c&&(c=or)){if(Pg(o))throw bC(),Error(n(418));for(;c;)yC(o,c),c=Xr(c.nextSibling)}if(xC(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8){var g=o.data;if(g==="/$"){if(c===0){or=Xr(o.nextSibling);break e}c--}else g!=="$"&&g!=="$!"&&g!=="$?"||c++}o=o.nextSibling}or=null}}else or=ar?Xr(o.stateNode.nextSibling):null;return!0}function bC(){for(var o=or;o;)o=Xr(o.nextSibling)}function Ll(){or=ar=null,an=!1}function zg(o){Or===null?Or=[o]:Or.push(o)}var QB=b.ReactCurrentBatchConfig;function _u(o,c,g){if(o=g.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(n(309));var C=g.stateNode}if(!C)throw Error(n(147,o));var T=C,L=""+o;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===L?c.ref:(c=function(Y){var se=T.refs;Y===null?delete se[L]:se[L]=Y},c._stringRef=L,c)}if(typeof o!="string")throw Error(n(284));if(!g._owner)throw Error(n(290,o))}return o}function Ym(o,c){throw o=Object.prototype.toString.call(c),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o))}function wC(o){var c=o._init;return c(o._payload)}function NC(o){function c(le,oe){if(o){var me=le.deletions;me===null?(le.deletions=[oe],le.flags|=16):me.push(oe)}}function g(le,oe){if(!o)return null;for(;oe!==null;)c(le,oe),oe=oe.sibling;return null}function C(le,oe){for(le=new Map;oe!==null;)oe.key!==null?le.set(oe.key,oe):le.set(oe.index,oe),oe=oe.sibling;return le}function T(le,oe){return le=yo(le,oe),le.index=0,le.sibling=null,le}function L(le,oe,me){return le.index=me,o?(me=le.alternate,me!==null?(me=me.index,me<oe?(le.flags|=2,oe):me):(le.flags|=2,oe)):(le.flags|=1048576,oe)}function Y(le){return o&&le.alternate===null&&(le.flags|=2),le}function se(le,oe,me,Me){return oe===null||oe.tag!==6?(oe=E_(me,le.mode,Me),oe.return=le,oe):(oe=T(oe,me),oe.return=le,oe)}function ae(le,oe,me,Me){var We=me.type;return We===M?je(le,oe,me.props.children,Me,me.key):oe!==null&&(oe.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===U&&wC(We)===oe.type)?(Me=T(oe,me.props),Me.ref=_u(le,oe,me),Me.return=le,Me):(Me=yf(me.type,me.key,me.props,null,le.mode,Me),Me.ref=_u(le,oe,me),Me.return=le,Me)}function he(le,oe,me,Me){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==me.containerInfo||oe.stateNode.implementation!==me.implementation?(oe=k_(me,le.mode,Me),oe.return=le,oe):(oe=T(oe,me.children||[]),oe.return=le,oe)}function je(le,oe,me,Me,We){return oe===null||oe.tag!==7?(oe=Mi(me,le.mode,Me,We),oe.return=le,oe):(oe=T(oe,me),oe.return=le,oe)}function Se(le,oe,me){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return oe=E_(""+oe,le.mode,me),oe.return=le,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case S:return me=yf(oe.type,oe.key,oe.props,null,le.mode,me),me.ref=_u(le,null,oe),me.return=le,me;case E:return oe=k_(oe,le.mode,me),oe.return=le,oe;case U:var Me=oe._init;return Se(le,Me(oe._payload),me)}if(Te(oe)||W(oe))return oe=Mi(oe,le.mode,me,null),oe.return=le,oe;Ym(le,oe)}return null}function Ne(le,oe,me,Me){var We=oe!==null?oe.key:null;if(typeof me=="string"&&me!==""||typeof me=="number")return We!==null?null:se(le,oe,""+me,Me);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case S:return me.key===We?ae(le,oe,me,Me):null;case E:return me.key===We?he(le,oe,me,Me):null;case U:return We=me._init,Ne(le,oe,We(me._payload),Me)}if(Te(me)||W(me))return We!==null?null:je(le,oe,me,Me,null);Ym(le,me)}return null}function Ie(le,oe,me,Me,We){if(typeof Me=="string"&&Me!==""||typeof Me=="number")return le=le.get(me)||null,se(oe,le,""+Me,We);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case S:return le=le.get(Me.key===null?me:Me.key)||null,ae(oe,le,Me,We);case E:return le=le.get(Me.key===null?me:Me.key)||null,he(oe,le,Me,We);case U:var Ze=Me._init;return Ie(le,oe,me,Ze(Me._payload),We)}if(Te(Me)||W(Me))return le=le.get(me)||null,je(oe,le,Me,We,null);Ym(oe,Me)}return null}function Ue(le,oe,me,Me){for(var We=null,Ze=null,Je=oe,lt=oe=0,Xn=null;Je!==null&&lt<me.length;lt++){Je.index>lt?(Xn=Je,Je=null):Xn=Je.sibling;var zt=Ne(le,Je,me[lt],Me);if(zt===null){Je===null&&(Je=Xn);break}o&&Je&&zt.alternate===null&&c(le,Je),oe=L(zt,oe,lt),Ze===null?We=zt:Ze.sibling=zt,Ze=zt,Je=Xn}if(lt===me.length)return g(le,Je),an&&bi(le,lt),We;if(Je===null){for(;lt<me.length;lt++)Je=Se(le,me[lt],Me),Je!==null&&(oe=L(Je,oe,lt),Ze===null?We=Je:Ze.sibling=Je,Ze=Je);return an&&bi(le,lt),We}for(Je=C(le,Je);lt<me.length;lt++)Xn=Ie(Je,le,lt,me[lt],Me),Xn!==null&&(o&&Xn.alternate!==null&&Je.delete(Xn.key===null?lt:Xn.key),oe=L(Xn,oe,lt),Ze===null?We=Xn:Ze.sibling=Xn,Ze=Xn);return o&&Je.forEach(function(vo){return c(le,vo)}),an&&bi(le,lt),We}function He(le,oe,me,Me){var We=W(me);if(typeof We!="function")throw Error(n(150));if(me=We.call(me),me==null)throw Error(n(151));for(var Ze=We=null,Je=oe,lt=oe=0,Xn=null,zt=me.next();Je!==null&&!zt.done;lt++,zt=me.next()){Je.index>lt?(Xn=Je,Je=null):Xn=Je.sibling;var vo=Ne(le,Je,zt.value,Me);if(vo===null){Je===null&&(Je=Xn);break}o&&Je&&vo.alternate===null&&c(le,Je),oe=L(vo,oe,lt),Ze===null?We=vo:Ze.sibling=vo,Ze=vo,Je=Xn}if(zt.done)return g(le,Je),an&&bi(le,lt),We;if(Je===null){for(;!zt.done;lt++,zt=me.next())zt=Se(le,zt.value,Me),zt!==null&&(oe=L(zt,oe,lt),Ze===null?We=zt:Ze.sibling=zt,Ze=zt);return an&&bi(le,lt),We}for(Je=C(le,Je);!zt.done;lt++,zt=me.next())zt=Ie(Je,le,lt,zt.value,Me),zt!==null&&(o&&zt.alternate!==null&&Je.delete(zt.key===null?lt:zt.key),oe=L(zt,oe,lt),Ze===null?We=zt:Ze.sibling=zt,Ze=zt);return o&&Je.forEach(function(A8){return c(le,A8)}),an&&bi(le,lt),We}function kn(le,oe,me,Me){if(typeof me=="object"&&me!==null&&me.type===M&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case S:e:{for(var We=me.key,Ze=oe;Ze!==null;){if(Ze.key===We){if(We=me.type,We===M){if(Ze.tag===7){g(le,Ze.sibling),oe=T(Ze,me.props.children),oe.return=le,le=oe;break e}}else if(Ze.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===U&&wC(We)===Ze.type){g(le,Ze.sibling),oe=T(Ze,me.props),oe.ref=_u(le,Ze,me),oe.return=le,le=oe;break e}g(le,Ze);break}else c(le,Ze);Ze=Ze.sibling}me.type===M?(oe=Mi(me.props.children,le.mode,Me,me.key),oe.return=le,le=oe):(Me=yf(me.type,me.key,me.props,null,le.mode,Me),Me.ref=_u(le,oe,me),Me.return=le,le=Me)}return Y(le);case E:e:{for(Ze=me.key;oe!==null;){if(oe.key===Ze)if(oe.tag===4&&oe.stateNode.containerInfo===me.containerInfo&&oe.stateNode.implementation===me.implementation){g(le,oe.sibling),oe=T(oe,me.children||[]),oe.return=le,le=oe;break e}else{g(le,oe);break}else c(le,oe);oe=oe.sibling}oe=k_(me,le.mode,Me),oe.return=le,le=oe}return Y(le);case U:return Ze=me._init,kn(le,oe,Ze(me._payload),Me)}if(Te(me))return Ue(le,oe,me,Me);if(W(me))return He(le,oe,me,Me);Ym(le,me)}return typeof me=="string"&&me!==""||typeof me=="number"?(me=""+me,oe!==null&&oe.tag===6?(g(le,oe.sibling),oe=T(oe,me),oe.return=le,le=oe):(g(le,oe),oe=E_(me,le.mode,Me),oe.return=le,le=oe),Y(le)):g(le,oe)}return kn}var zl=NC(!0),jC=NC(!1),Km=bt(null),Gm=null,Rl=null,Rg=null;function Dg(){Rg=Rl=Gm=null}function Ig(o){var c=Km.current;qt(Km),o._currentValue=c}function Fg(o,c,g){for(;o!==null;){var C=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,C!==null&&(C.childLanes|=c)):C!==null&&(C.childLanes&c)!==c&&(C.childLanes|=c),o===g)break;o=o.return}}function Dl(o,c){Gm=o,Rg=Rl=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&c&&(Bs=!0),o.firstContext=null)}function gr(o){var c=o._currentValue;if(Rg!==o)if(o={context:o,memoizedValue:c,next:null},Rl===null){if(Gm===null)throw Error(n(308));Rl=o,Gm.dependencies={lanes:0,firstContext:o}}else Rl=Rl.next=o;return c}var wi=null;function Bg(o){wi===null?wi=[o]:wi.push(o)}function CC(o,c,g,C){var T=c.interleaved;return T===null?(g.next=g,Bg(c)):(g.next=T.next,T.next=g),c.interleaved=g,Sa(o,C)}function Sa(o,c){o.lanes|=c;var g=o.alternate;for(g!==null&&(g.lanes|=c),g=o,o=o.return;o!==null;)o.childLanes|=c,g=o.alternate,g!==null&&(g.childLanes|=c),g=o,o=o.return;return g.tag===3?g.stateNode:null}var uo=!1;function Ug(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function SC(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Ea(o,c){return{eventTime:o,lane:c,tag:0,payload:null,callback:null,next:null}}function mo(o,c,g){var C=o.updateQueue;if(C===null)return null;if(C=C.shared,Ot&2){var T=C.pending;return T===null?c.next=c:(c.next=T.next,T.next=c),C.pending=c,Sa(o,g)}return T=C.interleaved,T===null?(c.next=c,Bg(C)):(c.next=T.next,T.next=c),C.interleaved=c,Sa(o,g)}function Xm(o,c,g){if(c=c.updateQueue,c!==null&&(c=c.shared,(g&4194240)!==0)){var C=c.lanes;C&=o.pendingLanes,g|=C,c.lanes=g,Vr(o,g)}}function EC(o,c){var g=o.updateQueue,C=o.alternate;if(C!==null&&(C=C.updateQueue,g===C)){var T=null,L=null;if(g=g.firstBaseUpdate,g!==null){do{var Y={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};L===null?T=L=Y:L=L.next=Y,g=g.next}while(g!==null);L===null?T=L=c:L=L.next=c}else T=L=c;g={baseState:C.baseState,firstBaseUpdate:T,lastBaseUpdate:L,shared:C.shared,effects:C.effects},o.updateQueue=g;return}o=g.lastBaseUpdate,o===null?g.firstBaseUpdate=c:o.next=c,g.lastBaseUpdate=c}function Qm(o,c,g,C){var T=o.updateQueue;uo=!1;var L=T.firstBaseUpdate,Y=T.lastBaseUpdate,se=T.shared.pending;if(se!==null){T.shared.pending=null;var ae=se,he=ae.next;ae.next=null,Y===null?L=he:Y.next=he,Y=ae;var je=o.alternate;je!==null&&(je=je.updateQueue,se=je.lastBaseUpdate,se!==Y&&(se===null?je.firstBaseUpdate=he:se.next=he,je.lastBaseUpdate=ae))}if(L!==null){var Se=T.baseState;Y=0,je=he=ae=null,se=L;do{var Ne=se.lane,Ie=se.eventTime;if((C&Ne)===Ne){je!==null&&(je=je.next={eventTime:Ie,lane:0,tag:se.tag,payload:se.payload,callback:se.callback,next:null});e:{var Ue=o,He=se;switch(Ne=c,Ie=g,He.tag){case 1:if(Ue=He.payload,typeof Ue=="function"){Se=Ue.call(Ie,Se,Ne);break e}Se=Ue;break e;case 3:Ue.flags=Ue.flags&-65537|128;case 0:if(Ue=He.payload,Ne=typeof Ue=="function"?Ue.call(Ie,Se,Ne):Ue,Ne==null)break e;Se=B({},Se,Ne);break e;case 2:uo=!0}}se.callback!==null&&se.lane!==0&&(o.flags|=64,Ne=T.effects,Ne===null?T.effects=[se]:Ne.push(se))}else Ie={eventTime:Ie,lane:Ne,tag:se.tag,payload:se.payload,callback:se.callback,next:null},je===null?(he=je=Ie,ae=Se):je=je.next=Ie,Y|=Ne;if(se=se.next,se===null){if(se=T.shared.pending,se===null)break;Ne=se,se=Ne.next,Ne.next=null,T.lastBaseUpdate=Ne,T.shared.pending=null}}while(!0);if(je===null&&(ae=Se),T.baseState=ae,T.firstBaseUpdate=he,T.lastBaseUpdate=je,c=T.shared.interleaved,c!==null){T=c;do Y|=T.lane,T=T.next;while(T!==c)}else L===null&&(T.shared.lanes=0);Ci|=Y,o.lanes=Y,o.memoizedState=Se}}function kC(o,c,g){if(o=c.effects,c.effects=null,o!==null)for(c=0;c<o.length;c++){var C=o[c],T=C.callback;if(T!==null){if(C.callback=null,C=g,typeof T!="function")throw Error(n(191,T));T.call(C)}}}var yu={},Zr=bt(yu),vu=bt(yu),xu=bt(yu);function Ni(o){if(o===yu)throw Error(n(174));return o}function Hg(o,c){switch(Ht(xu,c),Ht(vu,o),Ht(Zr,yu),o=c.nodeType,o){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:at(null,"");break;default:o=o===8?c.parentNode:c,c=o.namespaceURI||null,o=o.tagName,c=at(c,o)}qt(Zr),Ht(Zr,c)}function Il(){qt(Zr),qt(vu),qt(xu)}function MC(o){Ni(xu.current);var c=Ni(Zr.current),g=at(c,o.type);c!==g&&(Ht(vu,o),Ht(Zr,g))}function qg(o){vu.current===o&&(qt(Zr),qt(vu))}var fn=bt(0);function Zm(o){for(var c=o;c!==null;){if(c.tag===13){var g=c.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||g.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if(c.flags&128)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Vg=[];function Wg(){for(var o=0;o<Vg.length;o++)Vg[o]._workInProgressVersionPrimary=null;Vg.length=0}var Jm=b.ReactCurrentDispatcher,Yg=b.ReactCurrentBatchConfig,ji=0,hn=null,Un=null,Kn=null,ef=!1,bu=!1,wu=0,ZB=0;function ds(){throw Error(n(321))}function Kg(o,c){if(c===null)return!1;for(var g=0;g<c.length&&g<o.length;g++)if(!sr(o[g],c[g]))return!1;return!0}function Gg(o,c,g,C,T,L){if(ji=L,hn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,Jm.current=o===null||o.memoizedState===null?n8:s8,o=g(C,T),bu){L=0;do{if(bu=!1,wu=0,25<=L)throw Error(n(301));L+=1,Kn=Un=null,c.updateQueue=null,Jm.current=r8,o=g(C,T)}while(bu)}if(Jm.current=sf,c=Un!==null&&Un.next!==null,ji=0,Kn=Un=hn=null,ef=!1,c)throw Error(n(300));return o}function Xg(){var o=wu!==0;return wu=0,o}function Jr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kn===null?hn.memoizedState=Kn=o:Kn=Kn.next=o,Kn}function _r(){if(Un===null){var o=hn.alternate;o=o!==null?o.memoizedState:null}else o=Un.next;var c=Kn===null?hn.memoizedState:Kn.next;if(c!==null)Kn=c,Un=o;else{if(o===null)throw Error(n(310));Un=o,o={memoizedState:Un.memoizedState,baseState:Un.baseState,baseQueue:Un.baseQueue,queue:Un.queue,next:null},Kn===null?hn.memoizedState=Kn=o:Kn=Kn.next=o}return Kn}function Nu(o,c){return typeof c=="function"?c(o):c}function Qg(o){var c=_r(),g=c.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=o;var C=Un,T=C.baseQueue,L=g.pending;if(L!==null){if(T!==null){var Y=T.next;T.next=L.next,L.next=Y}C.baseQueue=T=L,g.pending=null}if(T!==null){L=T.next,C=C.baseState;var se=Y=null,ae=null,he=L;do{var je=he.lane;if((ji&je)===je)ae!==null&&(ae=ae.next={lane:0,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null}),C=he.hasEagerState?he.eagerState:o(C,he.action);else{var Se={lane:je,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null};ae===null?(se=ae=Se,Y=C):ae=ae.next=Se,hn.lanes|=je,Ci|=je}he=he.next}while(he!==null&&he!==L);ae===null?Y=C:ae.next=se,sr(C,c.memoizedState)||(Bs=!0),c.memoizedState=C,c.baseState=Y,c.baseQueue=ae,g.lastRenderedState=C}if(o=g.interleaved,o!==null){T=o;do L=T.lane,hn.lanes|=L,Ci|=L,T=T.next;while(T!==o)}else T===null&&(g.lanes=0);return[c.memoizedState,g.dispatch]}function Zg(o){var c=_r(),g=c.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=o;var C=g.dispatch,T=g.pending,L=c.memoizedState;if(T!==null){g.pending=null;var Y=T=T.next;do L=o(L,Y.action),Y=Y.next;while(Y!==T);sr(L,c.memoizedState)||(Bs=!0),c.memoizedState=L,c.baseQueue===null&&(c.baseState=L),g.lastRenderedState=L}return[L,C]}function AC(){}function OC(o,c){var g=hn,C=_r(),T=c(),L=!sr(C.memoizedState,T);if(L&&(C.memoizedState=T,Bs=!0),C=C.queue,Jg(PC.bind(null,g,C,o),[o]),C.getSnapshot!==c||L||Kn!==null&&Kn.memoizedState.tag&1){if(g.flags|=2048,ju(9,TC.bind(null,g,C,T,c),void 0,null),Gn===null)throw Error(n(349));ji&30||$C(g,c,T)}return T}function $C(o,c,g){o.flags|=16384,o={getSnapshot:c,value:g},c=hn.updateQueue,c===null?(c={lastEffect:null,stores:null},hn.updateQueue=c,c.stores=[o]):(g=c.stores,g===null?c.stores=[o]:g.push(o))}function TC(o,c,g,C){c.value=g,c.getSnapshot=C,LC(c)&&zC(o)}function PC(o,c,g){return g(function(){LC(c)&&zC(o)})}function LC(o){var c=o.getSnapshot;o=o.value;try{var g=c();return!sr(o,g)}catch{return!0}}function zC(o){var c=Sa(o,1);c!==null&&Lr(c,o,1,-1)}function RC(o){var c=Jr();return typeof o=="function"&&(o=o()),c.memoizedState=c.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Nu,lastRenderedState:o},c.queue=o,o=o.dispatch=t8.bind(null,hn,o),[c.memoizedState,o]}function ju(o,c,g,C){return o={tag:o,create:c,destroy:g,deps:C,next:null},c=hn.updateQueue,c===null?(c={lastEffect:null,stores:null},hn.updateQueue=c,c.lastEffect=o.next=o):(g=c.lastEffect,g===null?c.lastEffect=o.next=o:(C=g.next,g.next=o,o.next=C,c.lastEffect=o)),o}function DC(){return _r().memoizedState}function tf(o,c,g,C){var T=Jr();hn.flags|=o,T.memoizedState=ju(1|c,g,void 0,C===void 0?null:C)}function nf(o,c,g,C){var T=_r();C=C===void 0?null:C;var L=void 0;if(Un!==null){var Y=Un.memoizedState;if(L=Y.destroy,C!==null&&Kg(C,Y.deps)){T.memoizedState=ju(c,g,L,C);return}}hn.flags|=o,T.memoizedState=ju(1|c,g,L,C)}function IC(o,c){return tf(8390656,8,o,c)}function Jg(o,c){return nf(2048,8,o,c)}function FC(o,c){return nf(4,2,o,c)}function BC(o,c){return nf(4,4,o,c)}function UC(o,c){if(typeof c=="function")return o=o(),c(o),function(){c(null)};if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function HC(o,c,g){return g=g!=null?g.concat([o]):null,nf(4,4,UC.bind(null,c,o),g)}function e_(){}function qC(o,c){var g=_r();c=c===void 0?null:c;var C=g.memoizedState;return C!==null&&c!==null&&Kg(c,C[1])?C[0]:(g.memoizedState=[o,c],o)}function VC(o,c){var g=_r();c=c===void 0?null:c;var C=g.memoizedState;return C!==null&&c!==null&&Kg(c,C[1])?C[0]:(o=o(),g.memoizedState=[o,c],o)}function WC(o,c,g){return ji&21?(sr(g,c)||(g=bs(),hn.lanes|=g,Ci|=g,o.baseState=!0),c):(o.baseState&&(o.baseState=!1,Bs=!0),o.memoizedState=g)}function JB(o,c){var g=St;St=g!==0&&4>g?g:4,o(!0);var C=Yg.transition;Yg.transition={};try{o(!1),c()}finally{St=g,Yg.transition=C}}function YC(){return _r().memoizedState}function e8(o,c,g){var C=go(o);if(g={lane:C,action:g,hasEagerState:!1,eagerState:null,next:null},KC(o))GC(c,g);else if(g=CC(o,c,g,C),g!==null){var T=Cs();Lr(g,o,C,T),XC(g,c,C)}}function t8(o,c,g){var C=go(o),T={lane:C,action:g,hasEagerState:!1,eagerState:null,next:null};if(KC(o))GC(c,T);else{var L=o.alternate;if(o.lanes===0&&(L===null||L.lanes===0)&&(L=c.lastRenderedReducer,L!==null))try{var Y=c.lastRenderedState,se=L(Y,g);if(T.hasEagerState=!0,T.eagerState=se,sr(se,Y)){var ae=c.interleaved;ae===null?(T.next=T,Bg(c)):(T.next=ae.next,ae.next=T),c.interleaved=T;return}}catch{}finally{}g=CC(o,c,T,C),g!==null&&(T=Cs(),Lr(g,o,C,T),XC(g,c,C))}}function KC(o){var c=o.alternate;return o===hn||c!==null&&c===hn}function GC(o,c){bu=ef=!0;var g=o.pending;g===null?c.next=c:(c.next=g.next,g.next=c),o.pending=c}function XC(o,c,g){if(g&4194240){var C=c.lanes;C&=o.pendingLanes,g|=C,c.lanes=g,Vr(o,g)}}var sf={readContext:gr,useCallback:ds,useContext:ds,useEffect:ds,useImperativeHandle:ds,useInsertionEffect:ds,useLayoutEffect:ds,useMemo:ds,useReducer:ds,useRef:ds,useState:ds,useDebugValue:ds,useDeferredValue:ds,useTransition:ds,useMutableSource:ds,useSyncExternalStore:ds,useId:ds,unstable_isNewReconciler:!1},n8={readContext:gr,useCallback:function(o,c){return Jr().memoizedState=[o,c===void 0?null:c],o},useContext:gr,useEffect:IC,useImperativeHandle:function(o,c,g){return g=g!=null?g.concat([o]):null,tf(4194308,4,UC.bind(null,c,o),g)},useLayoutEffect:function(o,c){return tf(4194308,4,o,c)},useInsertionEffect:function(o,c){return tf(4,2,o,c)},useMemo:function(o,c){var g=Jr();return c=c===void 0?null:c,o=o(),g.memoizedState=[o,c],o},useReducer:function(o,c,g){var C=Jr();return c=g!==void 0?g(c):c,C.memoizedState=C.baseState=c,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:c},C.queue=o,o=o.dispatch=e8.bind(null,hn,o),[C.memoizedState,o]},useRef:function(o){var c=Jr();return o={current:o},c.memoizedState=o},useState:RC,useDebugValue:e_,useDeferredValue:function(o){return Jr().memoizedState=o},useTransition:function(){var o=RC(!1),c=o[0];return o=JB.bind(null,o[1]),Jr().memoizedState=o,[c,o]},useMutableSource:function(){},useSyncExternalStore:function(o,c,g){var C=hn,T=Jr();if(an){if(g===void 0)throw Error(n(407));g=g()}else{if(g=c(),Gn===null)throw Error(n(349));ji&30||$C(C,c,g)}T.memoizedState=g;var L={value:g,getSnapshot:c};return T.queue=L,IC(PC.bind(null,C,L,o),[o]),C.flags|=2048,ju(9,TC.bind(null,C,L,g,c),void 0,null),g},useId:function(){var o=Jr(),c=Gn.identifierPrefix;if(an){var g=Ca,C=ja;g=(C&~(1<<32-nt(C)-1)).toString(32)+g,c=":"+c+"R"+g,g=wu++,0<g&&(c+="H"+g.toString(32)),c+=":"}else g=ZB++,c=":"+c+"r"+g.toString(32)+":";return o.memoizedState=c},unstable_isNewReconciler:!1},s8={readContext:gr,useCallback:qC,useContext:gr,useEffect:Jg,useImperativeHandle:HC,useInsertionEffect:FC,useLayoutEffect:BC,useMemo:VC,useReducer:Qg,useRef:DC,useState:function(){return Qg(Nu)},useDebugValue:e_,useDeferredValue:function(o){var c=_r();return WC(c,Un.memoizedState,o)},useTransition:function(){var o=Qg(Nu)[0],c=_r().memoizedState;return[o,c]},useMutableSource:AC,useSyncExternalStore:OC,useId:YC,unstable_isNewReconciler:!1},r8={readContext:gr,useCallback:qC,useContext:gr,useEffect:Jg,useImperativeHandle:HC,useInsertionEffect:FC,useLayoutEffect:BC,useMemo:VC,useReducer:Zg,useRef:DC,useState:function(){return Zg(Nu)},useDebugValue:e_,useDeferredValue:function(o){var c=_r();return Un===null?c.memoizedState=o:WC(c,Un.memoizedState,o)},useTransition:function(){var o=Zg(Nu)[0],c=_r().memoizedState;return[o,c]},useMutableSource:AC,useSyncExternalStore:OC,useId:YC,unstable_isNewReconciler:!1};function $r(o,c){if(o&&o.defaultProps){c=B({},c),o=o.defaultProps;for(var g in o)c[g]===void 0&&(c[g]=o[g]);return c}return c}function t_(o,c,g,C){c=o.memoizedState,g=g(C,c),g=g==null?c:B({},c,g),o.memoizedState=g,o.lanes===0&&(o.updateQueue.baseState=g)}var rf={isMounted:function(o){return(o=o._reactInternals)?Yt(o)===o:!1},enqueueSetState:function(o,c,g){o=o._reactInternals;var C=Cs(),T=go(o),L=Ea(C,T);L.payload=c,g!=null&&(L.callback=g),c=mo(o,L,T),c!==null&&(Lr(c,o,T,C),Xm(c,o,T))},enqueueReplaceState:function(o,c,g){o=o._reactInternals;var C=Cs(),T=go(o),L=Ea(C,T);L.tag=1,L.payload=c,g!=null&&(L.callback=g),c=mo(o,L,T),c!==null&&(Lr(c,o,T,C),Xm(c,o,T))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var g=Cs(),C=go(o),T=Ea(g,C);T.tag=2,c!=null&&(T.callback=c),c=mo(o,T,C),c!==null&&(Lr(c,o,C,g),Xm(c,o,C))}};function QC(o,c,g,C,T,L,Y){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(C,L,Y):c.prototype&&c.prototype.isPureReactComponent?!di(g,C)||!di(T,L):!0}function ZC(o,c,g){var C=!1,T=Ar,L=c.contextType;return typeof L=="object"&&L!==null?L=gr(L):(T=Fs(c)?vi:En.current,C=c.contextTypes,L=(C=C!=null)?$l(o,T):Ar),c=new c(g,L),o.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=rf,o.stateNode=c,c._reactInternals=o,C&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=T,o.__reactInternalMemoizedMaskedChildContext=L),c}function JC(o,c,g,C){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(g,C),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(g,C),c.state!==o&&rf.enqueueReplaceState(c,c.state,null)}function n_(o,c,g,C){var T=o.stateNode;T.props=g,T.state=o.memoizedState,T.refs={},Ug(o);var L=c.contextType;typeof L=="object"&&L!==null?T.context=gr(L):(L=Fs(c)?vi:En.current,T.context=$l(o,L)),T.state=o.memoizedState,L=c.getDerivedStateFromProps,typeof L=="function"&&(t_(o,c,L,g),T.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(c=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),c!==T.state&&rf.enqueueReplaceState(T,T.state,null),Qm(o,g,T,C),T.state=o.memoizedState),typeof T.componentDidMount=="function"&&(o.flags|=4194308)}function Fl(o,c){try{var g="",C=c;do g+=K(C),C=C.return;while(C);var T=g}catch(L){T=`
Error generating stack: `+L.message+`
`+L.stack}return{value:o,source:c,stack:T,digest:null}}function s_(o,c,g){return{value:o,source:null,stack:g??null,digest:c??null}}function r_(o,c){try{console.error(c.value)}catch(g){setTimeout(function(){throw g})}}var a8=typeof WeakMap=="function"?WeakMap:Map;function eS(o,c,g){g=Ea(-1,g),g.tag=3,g.payload={element:null};var C=c.value;return g.callback=function(){mf||(mf=!0,v_=C),r_(o,c)},g}function tS(o,c,g){g=Ea(-1,g),g.tag=3;var C=o.type.getDerivedStateFromError;if(typeof C=="function"){var T=c.value;g.payload=function(){return C(T)},g.callback=function(){r_(o,c)}}var L=o.stateNode;return L!==null&&typeof L.componentDidCatch=="function"&&(g.callback=function(){r_(o,c),typeof C!="function"&&(ho===null?ho=new Set([this]):ho.add(this));var Y=c.stack;this.componentDidCatch(c.value,{componentStack:Y!==null?Y:""})}),g}function nS(o,c,g){var C=o.pingCache;if(C===null){C=o.pingCache=new a8;var T=new Set;C.set(c,T)}else T=C.get(c),T===void 0&&(T=new Set,C.set(c,T));T.has(g)||(T.add(g),o=v8.bind(null,o,c,g),c.then(o,o))}function sS(o){do{var c;if((c=o.tag===13)&&(c=o.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return o;o=o.return}while(o!==null);return null}function rS(o,c,g,C,T){return o.mode&1?(o.flags|=65536,o.lanes=T,o):(o===c?o.flags|=65536:(o.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(c=Ea(-1,1),c.tag=2,mo(g,c,1))),g.lanes|=1),o)}var o8=b.ReactCurrentOwner,Bs=!1;function js(o,c,g,C){c.child=o===null?jC(c,null,g,C):zl(c,o.child,g,C)}function aS(o,c,g,C,T){g=g.render;var L=c.ref;return Dl(c,T),C=Gg(o,c,g,C,L,T),g=Xg(),o!==null&&!Bs?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~T,ka(o,c,T)):(an&&g&&$g(c),c.flags|=1,js(o,c,C,T),c.child)}function oS(o,c,g,C,T){if(o===null){var L=g.type;return typeof L=="function"&&!S_(L)&&L.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(c.tag=15,c.type=L,iS(o,c,L,C,T)):(o=yf(g.type,null,C,c,c.mode,T),o.ref=c.ref,o.return=c,c.child=o)}if(L=o.child,!(o.lanes&T)){var Y=L.memoizedProps;if(g=g.compare,g=g!==null?g:di,g(Y,C)&&o.ref===c.ref)return ka(o,c,T)}return c.flags|=1,o=yo(L,C),o.ref=c.ref,o.return=c,c.child=o}function iS(o,c,g,C,T){if(o!==null){var L=o.memoizedProps;if(di(L,C)&&o.ref===c.ref)if(Bs=!1,c.pendingProps=C=L,(o.lanes&T)!==0)o.flags&131072&&(Bs=!0);else return c.lanes=o.lanes,ka(o,c,T)}return a_(o,c,g,C,T)}function lS(o,c,g){var C=c.pendingProps,T=C.children,L=o!==null?o.memoizedState:null;if(C.mode==="hidden")if(!(c.mode&1))c.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ht(Ul,ir),ir|=g;else{if(!(g&1073741824))return o=L!==null?L.baseLanes|g:g,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:o,cachePool:null,transitions:null},c.updateQueue=null,Ht(Ul,ir),ir|=o,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=L!==null?L.baseLanes:g,Ht(Ul,ir),ir|=C}else L!==null?(C=L.baseLanes|g,c.memoizedState=null):C=g,Ht(Ul,ir),ir|=C;return js(o,c,T,g),c.child}function cS(o,c){var g=c.ref;(o===null&&g!==null||o!==null&&o.ref!==g)&&(c.flags|=512,c.flags|=2097152)}function a_(o,c,g,C,T){var L=Fs(g)?vi:En.current;return L=$l(c,L),Dl(c,T),g=Gg(o,c,g,C,L,T),C=Xg(),o!==null&&!Bs?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~T,ka(o,c,T)):(an&&C&&$g(c),c.flags|=1,js(o,c,g,T),c.child)}function uS(o,c,g,C,T){if(Fs(g)){var L=!0;Um(c)}else L=!1;if(Dl(c,T),c.stateNode===null)of(o,c),ZC(c,g,C),n_(c,g,C,T),C=!0;else if(o===null){var Y=c.stateNode,se=c.memoizedProps;Y.props=se;var ae=Y.context,he=g.contextType;typeof he=="object"&&he!==null?he=gr(he):(he=Fs(g)?vi:En.current,he=$l(c,he));var je=g.getDerivedStateFromProps,Se=typeof je=="function"||typeof Y.getSnapshotBeforeUpdate=="function";Se||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(se!==C||ae!==he)&&JC(c,Y,C,he),uo=!1;var Ne=c.memoizedState;Y.state=Ne,Qm(c,C,Y,T),ae=c.memoizedState,se!==C||Ne!==ae||Is.current||uo?(typeof je=="function"&&(t_(c,g,je,C),ae=c.memoizedState),(se=uo||QC(c,g,se,C,Ne,ae,he))?(Se||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount()),typeof Y.componentDidMount=="function"&&(c.flags|=4194308)):(typeof Y.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=C,c.memoizedState=ae),Y.props=C,Y.state=ae,Y.context=he,C=se):(typeof Y.componentDidMount=="function"&&(c.flags|=4194308),C=!1)}else{Y=c.stateNode,SC(o,c),se=c.memoizedProps,he=c.type===c.elementType?se:$r(c.type,se),Y.props=he,Se=c.pendingProps,Ne=Y.context,ae=g.contextType,typeof ae=="object"&&ae!==null?ae=gr(ae):(ae=Fs(g)?vi:En.current,ae=$l(c,ae));var Ie=g.getDerivedStateFromProps;(je=typeof Ie=="function"||typeof Y.getSnapshotBeforeUpdate=="function")||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(se!==Se||Ne!==ae)&&JC(c,Y,C,ae),uo=!1,Ne=c.memoizedState,Y.state=Ne,Qm(c,C,Y,T);var Ue=c.memoizedState;se!==Se||Ne!==Ue||Is.current||uo?(typeof Ie=="function"&&(t_(c,g,Ie,C),Ue=c.memoizedState),(he=uo||QC(c,g,he,C,Ne,Ue,ae)||!1)?(je||typeof Y.UNSAFE_componentWillUpdate!="function"&&typeof Y.componentWillUpdate!="function"||(typeof Y.componentWillUpdate=="function"&&Y.componentWillUpdate(C,Ue,ae),typeof Y.UNSAFE_componentWillUpdate=="function"&&Y.UNSAFE_componentWillUpdate(C,Ue,ae)),typeof Y.componentDidUpdate=="function"&&(c.flags|=4),typeof Y.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof Y.componentDidUpdate!="function"||se===o.memoizedProps&&Ne===o.memoizedState||(c.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||se===o.memoizedProps&&Ne===o.memoizedState||(c.flags|=1024),c.memoizedProps=C,c.memoizedState=Ue),Y.props=C,Y.state=Ue,Y.context=ae,C=he):(typeof Y.componentDidUpdate!="function"||se===o.memoizedProps&&Ne===o.memoizedState||(c.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||se===o.memoizedProps&&Ne===o.memoizedState||(c.flags|=1024),C=!1)}return o_(o,c,g,C,L,T)}function o_(o,c,g,C,T,L){cS(o,c);var Y=(c.flags&128)!==0;if(!C&&!Y)return T&&pC(c,g,!1),ka(o,c,L);C=c.stateNode,o8.current=c;var se=Y&&typeof g.getDerivedStateFromError!="function"?null:C.render();return c.flags|=1,o!==null&&Y?(c.child=zl(c,o.child,null,L),c.child=zl(c,null,se,L)):js(o,c,se,L),c.memoizedState=C.state,T&&pC(c,g,!0),c.child}function dS(o){var c=o.stateNode;c.pendingContext?fC(o,c.pendingContext,c.pendingContext!==c.context):c.context&&fC(o,c.context,!1),Hg(o,c.containerInfo)}function mS(o,c,g,C,T){return Ll(),zg(T),c.flags|=256,js(o,c,g,C),c.child}var i_={dehydrated:null,treeContext:null,retryLane:0};function l_(o){return{baseLanes:o,cachePool:null,transitions:null}}function fS(o,c,g){var C=c.pendingProps,T=fn.current,L=!1,Y=(c.flags&128)!==0,se;if((se=Y)||(se=o!==null&&o.memoizedState===null?!1:(T&2)!==0),se?(L=!0,c.flags&=-129):(o===null||o.memoizedState!==null)&&(T|=1),Ht(fn,T&1),o===null)return Lg(c),o=c.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(c.mode&1?o.data==="$!"?c.lanes=8:c.lanes=1073741824:c.lanes=1,null):(Y=C.children,o=C.fallback,L?(C=c.mode,L=c.child,Y={mode:"hidden",children:Y},!(C&1)&&L!==null?(L.childLanes=0,L.pendingProps=Y):L=vf(Y,C,0,null),o=Mi(o,C,g,null),L.return=c,o.return=c,L.sibling=o,c.child=L,c.child.memoizedState=l_(g),c.memoizedState=i_,o):c_(c,Y));if(T=o.memoizedState,T!==null&&(se=T.dehydrated,se!==null))return i8(o,c,Y,C,se,T,g);if(L){L=C.fallback,Y=c.mode,T=o.child,se=T.sibling;var ae={mode:"hidden",children:C.children};return!(Y&1)&&c.child!==T?(C=c.child,C.childLanes=0,C.pendingProps=ae,c.deletions=null):(C=yo(T,ae),C.subtreeFlags=T.subtreeFlags&14680064),se!==null?L=yo(se,L):(L=Mi(L,Y,g,null),L.flags|=2),L.return=c,C.return=c,C.sibling=L,c.child=C,C=L,L=c.child,Y=o.child.memoizedState,Y=Y===null?l_(g):{baseLanes:Y.baseLanes|g,cachePool:null,transitions:Y.transitions},L.memoizedState=Y,L.childLanes=o.childLanes&~g,c.memoizedState=i_,C}return L=o.child,o=L.sibling,C=yo(L,{mode:"visible",children:C.children}),!(c.mode&1)&&(C.lanes=g),C.return=c,C.sibling=null,o!==null&&(g=c.deletions,g===null?(c.deletions=[o],c.flags|=16):g.push(o)),c.child=C,c.memoizedState=null,C}function c_(o,c){return c=vf({mode:"visible",children:c},o.mode,0,null),c.return=o,o.child=c}function af(o,c,g,C){return C!==null&&zg(C),zl(c,o.child,null,g),o=c_(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function i8(o,c,g,C,T,L,Y){if(g)return c.flags&256?(c.flags&=-257,C=s_(Error(n(422))),af(o,c,Y,C)):c.memoizedState!==null?(c.child=o.child,c.flags|=128,null):(L=C.fallback,T=c.mode,C=vf({mode:"visible",children:C.children},T,0,null),L=Mi(L,T,Y,null),L.flags|=2,C.return=c,L.return=c,C.sibling=L,c.child=C,c.mode&1&&zl(c,o.child,null,Y),c.child.memoizedState=l_(Y),c.memoizedState=i_,L);if(!(c.mode&1))return af(o,c,Y,null);if(T.data==="$!"){if(C=T.nextSibling&&T.nextSibling.dataset,C)var se=C.dgst;return C=se,L=Error(n(419)),C=s_(L,C,void 0),af(o,c,Y,C)}if(se=(Y&o.childLanes)!==0,Bs||se){if(C=Gn,C!==null){switch(Y&-Y){case 4:T=2;break;case 16:T=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:T=32;break;case 536870912:T=268435456;break;default:T=0}T=T&(C.suspendedLanes|Y)?0:T,T!==0&&T!==L.retryLane&&(L.retryLane=T,Sa(o,T),Lr(C,o,T,-1))}return C_(),C=s_(Error(n(421))),af(o,c,Y,C)}return T.data==="$?"?(c.flags|=128,c.child=o.child,c=x8.bind(null,o),T._reactRetry=c,null):(o=L.treeContext,or=Xr(T.nextSibling),ar=c,an=!0,Or=null,o!==null&&(hr[pr++]=ja,hr[pr++]=Ca,hr[pr++]=xi,ja=o.id,Ca=o.overflow,xi=c),c=c_(c,C.children),c.flags|=4096,c)}function hS(o,c,g){o.lanes|=c;var C=o.alternate;C!==null&&(C.lanes|=c),Fg(o.return,c,g)}function u_(o,c,g,C,T){var L=o.memoizedState;L===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:C,tail:g,tailMode:T}:(L.isBackwards=c,L.rendering=null,L.renderingStartTime=0,L.last=C,L.tail=g,L.tailMode=T)}function pS(o,c,g){var C=c.pendingProps,T=C.revealOrder,L=C.tail;if(js(o,c,C.children,g),C=fn.current,C&2)C=C&1|2,c.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&hS(o,g,c);else if(o.tag===19)hS(o,g,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}C&=1}if(Ht(fn,C),!(c.mode&1))c.memoizedState=null;else switch(T){case"forwards":for(g=c.child,T=null;g!==null;)o=g.alternate,o!==null&&Zm(o)===null&&(T=g),g=g.sibling;g=T,g===null?(T=c.child,c.child=null):(T=g.sibling,g.sibling=null),u_(c,!1,T,g,L);break;case"backwards":for(g=null,T=c.child,c.child=null;T!==null;){if(o=T.alternate,o!==null&&Zm(o)===null){c.child=T;break}o=T.sibling,T.sibling=g,g=T,T=o}u_(c,!0,g,null,L);break;case"together":u_(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function of(o,c){!(c.mode&1)&&o!==null&&(o.alternate=null,c.alternate=null,c.flags|=2)}function ka(o,c,g){if(o!==null&&(c.dependencies=o.dependencies),Ci|=c.lanes,!(g&c.childLanes))return null;if(o!==null&&c.child!==o.child)throw Error(n(153));if(c.child!==null){for(o=c.child,g=yo(o,o.pendingProps),c.child=g,g.return=c;o.sibling!==null;)o=o.sibling,g=g.sibling=yo(o,o.pendingProps),g.return=c;g.sibling=null}return c.child}function l8(o,c,g){switch(c.tag){case 3:dS(c),Ll();break;case 5:MC(c);break;case 1:Fs(c.type)&&Um(c);break;case 4:Hg(c,c.stateNode.containerInfo);break;case 10:var C=c.type._context,T=c.memoizedProps.value;Ht(Km,C._currentValue),C._currentValue=T;break;case 13:if(C=c.memoizedState,C!==null)return C.dehydrated!==null?(Ht(fn,fn.current&1),c.flags|=128,null):g&c.child.childLanes?fS(o,c,g):(Ht(fn,fn.current&1),o=ka(o,c,g),o!==null?o.sibling:null);Ht(fn,fn.current&1);break;case 19:if(C=(g&c.childLanes)!==0,o.flags&128){if(C)return pS(o,c,g);c.flags|=128}if(T=c.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),Ht(fn,fn.current),C)break;return null;case 22:case 23:return c.lanes=0,lS(o,c,g)}return ka(o,c,g)}var gS,d_,_S,yS;gS=function(o,c){for(var g=c.child;g!==null;){if(g.tag===5||g.tag===6)o.appendChild(g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===c)break;for(;g.sibling===null;){if(g.return===null||g.return===c)return;g=g.return}g.sibling.return=g.return,g=g.sibling}},d_=function(){},_S=function(o,c,g,C){var T=o.memoizedProps;if(T!==C){o=c.stateNode,Ni(Zr.current);var L=null;switch(g){case"input":T=be(o,T),C=be(o,C),L=[];break;case"select":T=B({},T,{value:void 0}),C=B({},C,{value:void 0}),L=[];break;case"textarea":T=ce(o,T),C=ce(o,C),L=[];break;default:typeof T.onClick!="function"&&typeof C.onClick=="function"&&(o.onclick=Al)}bn(g,C);var Y;g=null;for(he in T)if(!C.hasOwnProperty(he)&&T.hasOwnProperty(he)&&T[he]!=null)if(he==="style"){var se=T[he];for(Y in se)se.hasOwnProperty(Y)&&(g||(g={}),g[Y]="")}else he!=="dangerouslySetInnerHTML"&&he!=="children"&&he!=="suppressContentEditableWarning"&&he!=="suppressHydrationWarning"&&he!=="autoFocus"&&(r.hasOwnProperty(he)?L||(L=[]):(L=L||[]).push(he,null));for(he in C){var ae=C[he];if(se=T!=null?T[he]:void 0,C.hasOwnProperty(he)&&ae!==se&&(ae!=null||se!=null))if(he==="style")if(se){for(Y in se)!se.hasOwnProperty(Y)||ae&&ae.hasOwnProperty(Y)||(g||(g={}),g[Y]="");for(Y in ae)ae.hasOwnProperty(Y)&&se[Y]!==ae[Y]&&(g||(g={}),g[Y]=ae[Y])}else g||(L||(L=[]),L.push(he,g)),g=ae;else he==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,se=se?se.__html:void 0,ae!=null&&se!==ae&&(L=L||[]).push(he,ae)):he==="children"?typeof ae!="string"&&typeof ae!="number"||(L=L||[]).push(he,""+ae):he!=="suppressContentEditableWarning"&&he!=="suppressHydrationWarning"&&(r.hasOwnProperty(he)?(ae!=null&&he==="onScroll"&&Gt("scroll",o),L||se===ae||(L=[])):(L=L||[]).push(he,ae))}g&&(L=L||[]).push("style",g);var he=L;(c.updateQueue=he)&&(c.flags|=4)}},yS=function(o,c,g,C){g!==C&&(c.flags|=4)};function Cu(o,c){if(!an)switch(o.tailMode){case"hidden":c=o.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?o.tail=null:g.sibling=null;break;case"collapsed":g=o.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:C.sibling=null}}function ms(o){var c=o.alternate!==null&&o.alternate.child===o.child,g=0,C=0;if(c)for(var T=o.child;T!==null;)g|=T.lanes|T.childLanes,C|=T.subtreeFlags&14680064,C|=T.flags&14680064,T.return=o,T=T.sibling;else for(T=o.child;T!==null;)g|=T.lanes|T.childLanes,C|=T.subtreeFlags,C|=T.flags,T.return=o,T=T.sibling;return o.subtreeFlags|=C,o.childLanes=g,c}function c8(o,c,g){var C=c.pendingProps;switch(Tg(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ms(c),null;case 1:return Fs(c.type)&&Bm(),ms(c),null;case 3:return C=c.stateNode,Il(),qt(Is),qt(En),Wg(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(o===null||o.child===null)&&(Wm(c)?c.flags|=4:o===null||o.memoizedState.isDehydrated&&!(c.flags&256)||(c.flags|=1024,Or!==null&&(w_(Or),Or=null))),d_(o,c),ms(c),null;case 5:qg(c);var T=Ni(xu.current);if(g=c.type,o!==null&&c.stateNode!=null)_S(o,c,g,C,T),o.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!C){if(c.stateNode===null)throw Error(n(166));return ms(c),null}if(o=Ni(Zr.current),Wm(c)){C=c.stateNode,g=c.type;var L=c.memoizedProps;switch(C[fr]=c,C[_i]=L,o=(c.mode&1)!==0,g){case"dialog":Gt("cancel",C),Gt("close",C);break;case"iframe":case"object":case"embed":Gt("load",C);break;case"video":case"audio":for(T=0;T<hi.length;T++)Gt(hi[T],C);break;case"source":Gt("error",C);break;case"img":case"image":case"link":Gt("error",C),Gt("load",C);break;case"details":Gt("toggle",C);break;case"input":ze(C,L),Gt("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!L.multiple},Gt("invalid",C);break;case"textarea":Oe(C,L),Gt("invalid",C)}bn(g,L),T=null;for(var Y in L)if(L.hasOwnProperty(Y)){var se=L[Y];Y==="children"?typeof se=="string"?C.textContent!==se&&(L.suppressHydrationWarning!==!0&&cu(C.textContent,se,o),T=["children",se]):typeof se=="number"&&C.textContent!==""+se&&(L.suppressHydrationWarning!==!0&&cu(C.textContent,se,o),T=["children",""+se]):r.hasOwnProperty(Y)&&se!=null&&Y==="onScroll"&&Gt("scroll",C)}switch(g){case"input":de(C),pe(C,L,!0);break;case"textarea":de(C),Qe(C);break;case"select":case"option":break;default:typeof L.onClick=="function"&&(C.onclick=Al)}C=T,c.updateQueue=C,C!==null&&(c.flags|=4)}else{Y=T.nodeType===9?T:T.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=Ye(g)),o==="http://www.w3.org/1999/xhtml"?g==="script"?(o=Y.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof C.is=="string"?o=Y.createElement(g,{is:C.is}):(o=Y.createElement(g),g==="select"&&(Y=o,C.multiple?Y.multiple=!0:C.size&&(Y.size=C.size))):o=Y.createElementNS(o,g),o[fr]=c,o[_i]=C,gS(o,c,!1,!1),c.stateNode=o;e:{switch(Y=gn(g,C),g){case"dialog":Gt("cancel",o),Gt("close",o),T=C;break;case"iframe":case"object":case"embed":Gt("load",o),T=C;break;case"video":case"audio":for(T=0;T<hi.length;T++)Gt(hi[T],o);T=C;break;case"source":Gt("error",o),T=C;break;case"img":case"image":case"link":Gt("error",o),Gt("load",o),T=C;break;case"details":Gt("toggle",o),T=C;break;case"input":ze(o,C),T=be(o,C),Gt("invalid",o);break;case"option":T=C;break;case"select":o._wrapperState={wasMultiple:!!C.multiple},T=B({},C,{value:void 0}),Gt("invalid",o);break;case"textarea":Oe(o,C),T=ce(o,C),Gt("invalid",o);break;default:T=C}bn(g,T),se=T;for(L in se)if(se.hasOwnProperty(L)){var ae=se[L];L==="style"?Wt(o,ae):L==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ae!=null&&ot(o,ae)):L==="children"?typeof ae=="string"?(g!=="textarea"||ae!=="")&&Nt(o,ae):typeof ae=="number"&&Nt(o,""+ae):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(r.hasOwnProperty(L)?ae!=null&&L==="onScroll"&&Gt("scroll",o):ae!=null&&j(o,L,ae,Y))}switch(g){case"input":de(o),pe(o,C,!1);break;case"textarea":de(o),Qe(o);break;case"option":C.value!=null&&o.setAttribute("value",""+J(C.value));break;case"select":o.multiple=!!C.multiple,L=C.value,L!=null?De(o,!!C.multiple,L,!1):C.defaultValue!=null&&De(o,!!C.multiple,C.defaultValue,!0);break;default:typeof T.onClick=="function"&&(o.onclick=Al)}switch(g){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}}C&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return ms(c),null;case 6:if(o&&c.stateNode!=null)yS(o,c,o.memoizedProps,C);else{if(typeof C!="string"&&c.stateNode===null)throw Error(n(166));if(g=Ni(xu.current),Ni(Zr.current),Wm(c)){if(C=c.stateNode,g=c.memoizedProps,C[fr]=c,(L=C.nodeValue!==g)&&(o=ar,o!==null))switch(o.tag){case 3:cu(C.nodeValue,g,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&cu(C.nodeValue,g,(o.mode&1)!==0)}L&&(c.flags|=4)}else C=(g.nodeType===9?g:g.ownerDocument).createTextNode(C),C[fr]=c,c.stateNode=C}return ms(c),null;case 13:if(qt(fn),C=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(an&&or!==null&&c.mode&1&&!(c.flags&128))bC(),Ll(),c.flags|=98560,L=!1;else if(L=Wm(c),C!==null&&C.dehydrated!==null){if(o===null){if(!L)throw Error(n(318));if(L=c.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(n(317));L[fr]=c}else Ll(),!(c.flags&128)&&(c.memoizedState=null),c.flags|=4;ms(c),L=!1}else Or!==null&&(w_(Or),Or=null),L=!0;if(!L)return c.flags&65536?c:null}return c.flags&128?(c.lanes=g,c):(C=C!==null,C!==(o!==null&&o.memoizedState!==null)&&C&&(c.child.flags|=8192,c.mode&1&&(o===null||fn.current&1?Hn===0&&(Hn=3):C_())),c.updateQueue!==null&&(c.flags|=4),ms(c),null);case 4:return Il(),d_(o,c),o===null&&pi(c.stateNode.containerInfo),ms(c),null;case 10:return Ig(c.type._context),ms(c),null;case 17:return Fs(c.type)&&Bm(),ms(c),null;case 19:if(qt(fn),L=c.memoizedState,L===null)return ms(c),null;if(C=(c.flags&128)!==0,Y=L.rendering,Y===null)if(C)Cu(L,!1);else{if(Hn!==0||o!==null&&o.flags&128)for(o=c.child;o!==null;){if(Y=Zm(o),Y!==null){for(c.flags|=128,Cu(L,!1),C=Y.updateQueue,C!==null&&(c.updateQueue=C,c.flags|=4),c.subtreeFlags=0,C=g,g=c.child;g!==null;)L=g,o=C,L.flags&=14680066,Y=L.alternate,Y===null?(L.childLanes=0,L.lanes=o,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=Y.childLanes,L.lanes=Y.lanes,L.child=Y.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=Y.memoizedProps,L.memoizedState=Y.memoizedState,L.updateQueue=Y.updateQueue,L.type=Y.type,o=Y.dependencies,L.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),g=g.sibling;return Ht(fn,fn.current&1|2),c.child}o=o.sibling}L.tail!==null&&$e()>Hl&&(c.flags|=128,C=!0,Cu(L,!1),c.lanes=4194304)}else{if(!C)if(o=Zm(Y),o!==null){if(c.flags|=128,C=!0,g=o.updateQueue,g!==null&&(c.updateQueue=g,c.flags|=4),Cu(L,!0),L.tail===null&&L.tailMode==="hidden"&&!Y.alternate&&!an)return ms(c),null}else 2*$e()-L.renderingStartTime>Hl&&g!==1073741824&&(c.flags|=128,C=!0,Cu(L,!1),c.lanes=4194304);L.isBackwards?(Y.sibling=c.child,c.child=Y):(g=L.last,g!==null?g.sibling=Y:c.child=Y,L.last=Y)}return L.tail!==null?(c=L.tail,L.rendering=c,L.tail=c.sibling,L.renderingStartTime=$e(),c.sibling=null,g=fn.current,Ht(fn,C?g&1|2:g&1),c):(ms(c),null);case 22:case 23:return j_(),C=c.memoizedState!==null,o!==null&&o.memoizedState!==null!==C&&(c.flags|=8192),C&&c.mode&1?ir&1073741824&&(ms(c),c.subtreeFlags&6&&(c.flags|=8192)):ms(c),null;case 24:return null;case 25:return null}throw Error(n(156,c.tag))}function u8(o,c){switch(Tg(c),c.tag){case 1:return Fs(c.type)&&Bm(),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return Il(),qt(Is),qt(En),Wg(),o=c.flags,o&65536&&!(o&128)?(c.flags=o&-65537|128,c):null;case 5:return qg(c),null;case 13:if(qt(fn),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(n(340));Ll()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return qt(fn),null;case 4:return Il(),null;case 10:return Ig(c.type._context),null;case 22:case 23:return j_(),null;case 24:return null;default:return null}}var lf=!1,fs=!1,d8=typeof WeakSet=="function"?WeakSet:Set,Be=null;function Bl(o,c){var g=o.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(C){xn(o,c,C)}else g.current=null}function m_(o,c,g){try{g()}catch(C){xn(o,c,C)}}var vS=!1;function m8(o,c){if(uu=Bn,o=Em(),eu(o)){if("selectionStart"in o)var g={start:o.selectionStart,end:o.selectionEnd};else e:{g=(g=o.ownerDocument)&&g.defaultView||window;var C=g.getSelection&&g.getSelection();if(C&&C.rangeCount!==0){g=C.anchorNode;var T=C.anchorOffset,L=C.focusNode;C=C.focusOffset;try{g.nodeType,L.nodeType}catch{g=null;break e}var Y=0,se=-1,ae=-1,he=0,je=0,Se=o,Ne=null;t:for(;;){for(var Ie;Se!==g||T!==0&&Se.nodeType!==3||(se=Y+T),Se!==L||C!==0&&Se.nodeType!==3||(ae=Y+C),Se.nodeType===3&&(Y+=Se.nodeValue.length),(Ie=Se.firstChild)!==null;)Ne=Se,Se=Ie;for(;;){if(Se===o)break t;if(Ne===g&&++he===T&&(se=Y),Ne===L&&++je===C&&(ae=Y),(Ie=Se.nextSibling)!==null)break;Se=Ne,Ne=Se.parentNode}Se=Ie}g=se===-1||ae===-1?null:{start:se,end:ae}}else g=null}g=g||{start:0,end:0}}else g=null;for(du={focusedElem:o,selectionRange:g},Bn=!1,Be=c;Be!==null;)if(c=Be,o=c.child,(c.subtreeFlags&1028)!==0&&o!==null)o.return=c,Be=o;else for(;Be!==null;){c=Be;try{var Ue=c.alternate;if(c.flags&1024)switch(c.tag){case 0:case 11:case 15:break;case 1:if(Ue!==null){var He=Ue.memoizedProps,kn=Ue.memoizedState,le=c.stateNode,oe=le.getSnapshotBeforeUpdate(c.elementType===c.type?He:$r(c.type,He),kn);le.__reactInternalSnapshotBeforeUpdate=oe}break;case 3:var me=c.stateNode.containerInfo;me.nodeType===1?me.textContent="":me.nodeType===9&&me.documentElement&&me.removeChild(me.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Me){xn(c,c.return,Me)}if(o=c.sibling,o!==null){o.return=c.return,Be=o;break}Be=c.return}return Ue=vS,vS=!1,Ue}function Su(o,c,g){var C=c.updateQueue;if(C=C!==null?C.lastEffect:null,C!==null){var T=C=C.next;do{if((T.tag&o)===o){var L=T.destroy;T.destroy=void 0,L!==void 0&&m_(c,g,L)}T=T.next}while(T!==C)}}function cf(o,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var g=c=c.next;do{if((g.tag&o)===o){var C=g.create;g.destroy=C()}g=g.next}while(g!==c)}}function f_(o){var c=o.ref;if(c!==null){var g=o.stateNode;switch(o.tag){case 5:o=g;break;default:o=g}typeof c=="function"?c(o):c.current=o}}function xS(o){var c=o.alternate;c!==null&&(o.alternate=null,xS(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&(delete c[fr],delete c[_i],delete c[pu],delete c[Mg],delete c[Ag])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function bS(o){return o.tag===5||o.tag===3||o.tag===4}function wS(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||bS(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function h_(o,c,g){var C=o.tag;if(C===5||C===6)o=o.stateNode,c?g.nodeType===8?g.parentNode.insertBefore(o,c):g.insertBefore(o,c):(g.nodeType===8?(c=g.parentNode,c.insertBefore(o,g)):(c=g,c.appendChild(o)),g=g._reactRootContainer,g!=null||c.onclick!==null||(c.onclick=Al));else if(C!==4&&(o=o.child,o!==null))for(h_(o,c,g),o=o.sibling;o!==null;)h_(o,c,g),o=o.sibling}function p_(o,c,g){var C=o.tag;if(C===5||C===6)o=o.stateNode,c?g.insertBefore(o,c):g.appendChild(o);else if(C!==4&&(o=o.child,o!==null))for(p_(o,c,g),o=o.sibling;o!==null;)p_(o,c,g),o=o.sibling}var rs=null,Tr=!1;function fo(o,c,g){for(g=g.child;g!==null;)NS(o,c,g),g=g.sibling}function NS(o,c,g){if(ke&&typeof ke.onCommitFiberUnmount=="function")try{ke.onCommitFiberUnmount(gt,g)}catch{}switch(g.tag){case 5:fs||Bl(g,c);case 6:var C=rs,T=Tr;rs=null,fo(o,c,g),rs=C,Tr=T,rs!==null&&(Tr?(o=rs,g=g.stateNode,o.nodeType===8?o.parentNode.removeChild(g):o.removeChild(g)):rs.removeChild(g.stateNode));break;case 18:rs!==null&&(Tr?(o=rs,g=g.stateNode,o.nodeType===8?hu(o.parentNode,g):o.nodeType===1&&hu(o,g),sn(o)):hu(rs,g.stateNode));break;case 4:C=rs,T=Tr,rs=g.stateNode.containerInfo,Tr=!0,fo(o,c,g),rs=C,Tr=T;break;case 0:case 11:case 14:case 15:if(!fs&&(C=g.updateQueue,C!==null&&(C=C.lastEffect,C!==null))){T=C=C.next;do{var L=T,Y=L.destroy;L=L.tag,Y!==void 0&&(L&2||L&4)&&m_(g,c,Y),T=T.next}while(T!==C)}fo(o,c,g);break;case 1:if(!fs&&(Bl(g,c),C=g.stateNode,typeof C.componentWillUnmount=="function"))try{C.props=g.memoizedProps,C.state=g.memoizedState,C.componentWillUnmount()}catch(se){xn(g,c,se)}fo(o,c,g);break;case 21:fo(o,c,g);break;case 22:g.mode&1?(fs=(C=fs)||g.memoizedState!==null,fo(o,c,g),fs=C):fo(o,c,g);break;default:fo(o,c,g)}}function jS(o){var c=o.updateQueue;if(c!==null){o.updateQueue=null;var g=o.stateNode;g===null&&(g=o.stateNode=new d8),c.forEach(function(C){var T=b8.bind(null,o,C);g.has(C)||(g.add(C),C.then(T,T))})}}function Pr(o,c){var g=c.deletions;if(g!==null)for(var C=0;C<g.length;C++){var T=g[C];try{var L=o,Y=c,se=Y;e:for(;se!==null;){switch(se.tag){case 5:rs=se.stateNode,Tr=!1;break e;case 3:rs=se.stateNode.containerInfo,Tr=!0;break e;case 4:rs=se.stateNode.containerInfo,Tr=!0;break e}se=se.return}if(rs===null)throw Error(n(160));NS(L,Y,T),rs=null,Tr=!1;var ae=T.alternate;ae!==null&&(ae.return=null),T.return=null}catch(he){xn(T,c,he)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)CS(c,o),c=c.sibling}function CS(o,c){var g=o.alternate,C=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(Pr(c,o),ea(o),C&4){try{Su(3,o,o.return),cf(3,o)}catch(He){xn(o,o.return,He)}try{Su(5,o,o.return)}catch(He){xn(o,o.return,He)}}break;case 1:Pr(c,o),ea(o),C&512&&g!==null&&Bl(g,g.return);break;case 5:if(Pr(c,o),ea(o),C&512&&g!==null&&Bl(g,g.return),o.flags&32){var T=o.stateNode;try{Nt(T,"")}catch(He){xn(o,o.return,He)}}if(C&4&&(T=o.stateNode,T!=null)){var L=o.memoizedProps,Y=g!==null?g.memoizedProps:L,se=o.type,ae=o.updateQueue;if(o.updateQueue=null,ae!==null)try{se==="input"&&L.type==="radio"&&L.name!=null&&Ee(T,L),gn(se,Y);var he=gn(se,L);for(Y=0;Y<ae.length;Y+=2){var je=ae[Y],Se=ae[Y+1];je==="style"?Wt(T,Se):je==="dangerouslySetInnerHTML"?ot(T,Se):je==="children"?Nt(T,Se):j(T,je,Se,he)}switch(se){case"input":ie(T,L);break;case"textarea":qe(T,L);break;case"select":var Ne=T._wrapperState.wasMultiple;T._wrapperState.wasMultiple=!!L.multiple;var Ie=L.value;Ie!=null?De(T,!!L.multiple,Ie,!1):Ne!==!!L.multiple&&(L.defaultValue!=null?De(T,!!L.multiple,L.defaultValue,!0):De(T,!!L.multiple,L.multiple?[]:"",!1))}T[_i]=L}catch(He){xn(o,o.return,He)}}break;case 6:if(Pr(c,o),ea(o),C&4){if(o.stateNode===null)throw Error(n(162));T=o.stateNode,L=o.memoizedProps;try{T.nodeValue=L}catch(He){xn(o,o.return,He)}}break;case 3:if(Pr(c,o),ea(o),C&4&&g!==null&&g.memoizedState.isDehydrated)try{sn(c.containerInfo)}catch(He){xn(o,o.return,He)}break;case 4:Pr(c,o),ea(o);break;case 13:Pr(c,o),ea(o),T=o.child,T.flags&8192&&(L=T.memoizedState!==null,T.stateNode.isHidden=L,!L||T.alternate!==null&&T.alternate.memoizedState!==null||(y_=$e())),C&4&&jS(o);break;case 22:if(je=g!==null&&g.memoizedState!==null,o.mode&1?(fs=(he=fs)||je,Pr(c,o),fs=he):Pr(c,o),ea(o),C&8192){if(he=o.memoizedState!==null,(o.stateNode.isHidden=he)&&!je&&o.mode&1)for(Be=o,je=o.child;je!==null;){for(Se=Be=je;Be!==null;){switch(Ne=Be,Ie=Ne.child,Ne.tag){case 0:case 11:case 14:case 15:Su(4,Ne,Ne.return);break;case 1:Bl(Ne,Ne.return);var Ue=Ne.stateNode;if(typeof Ue.componentWillUnmount=="function"){C=Ne,g=Ne.return;try{c=C,Ue.props=c.memoizedProps,Ue.state=c.memoizedState,Ue.componentWillUnmount()}catch(He){xn(C,g,He)}}break;case 5:Bl(Ne,Ne.return);break;case 22:if(Ne.memoizedState!==null){kS(Se);continue}}Ie!==null?(Ie.return=Ne,Be=Ie):kS(Se)}je=je.sibling}e:for(je=null,Se=o;;){if(Se.tag===5){if(je===null){je=Se;try{T=Se.stateNode,he?(L=T.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none"):(se=Se.stateNode,ae=Se.memoizedProps.style,Y=ae!=null&&ae.hasOwnProperty("display")?ae.display:null,se.style.display=Ft("display",Y))}catch(He){xn(o,o.return,He)}}}else if(Se.tag===6){if(je===null)try{Se.stateNode.nodeValue=he?"":Se.memoizedProps}catch(He){xn(o,o.return,He)}}else if((Se.tag!==22&&Se.tag!==23||Se.memoizedState===null||Se===o)&&Se.child!==null){Se.child.return=Se,Se=Se.child;continue}if(Se===o)break e;for(;Se.sibling===null;){if(Se.return===null||Se.return===o)break e;je===Se&&(je=null),Se=Se.return}je===Se&&(je=null),Se.sibling.return=Se.return,Se=Se.sibling}}break;case 19:Pr(c,o),ea(o),C&4&&jS(o);break;case 21:break;default:Pr(c,o),ea(o)}}function ea(o){var c=o.flags;if(c&2){try{e:{for(var g=o.return;g!==null;){if(bS(g)){var C=g;break e}g=g.return}throw Error(n(160))}switch(C.tag){case 5:var T=C.stateNode;C.flags&32&&(Nt(T,""),C.flags&=-33);var L=wS(o);p_(o,L,T);break;case 3:case 4:var Y=C.stateNode.containerInfo,se=wS(o);h_(o,se,Y);break;default:throw Error(n(161))}}catch(ae){xn(o,o.return,ae)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function f8(o,c,g){Be=o,SS(o)}function SS(o,c,g){for(var C=(o.mode&1)!==0;Be!==null;){var T=Be,L=T.child;if(T.tag===22&&C){var Y=T.memoizedState!==null||lf;if(!Y){var se=T.alternate,ae=se!==null&&se.memoizedState!==null||fs;se=lf;var he=fs;if(lf=Y,(fs=ae)&&!he)for(Be=T;Be!==null;)Y=Be,ae=Y.child,Y.tag===22&&Y.memoizedState!==null?MS(T):ae!==null?(ae.return=Y,Be=ae):MS(T);for(;L!==null;)Be=L,SS(L),L=L.sibling;Be=T,lf=se,fs=he}ES(o)}else T.subtreeFlags&8772&&L!==null?(L.return=T,Be=L):ES(o)}}function ES(o){for(;Be!==null;){var c=Be;if(c.flags&8772){var g=c.alternate;try{if(c.flags&8772)switch(c.tag){case 0:case 11:case 15:fs||cf(5,c);break;case 1:var C=c.stateNode;if(c.flags&4&&!fs)if(g===null)C.componentDidMount();else{var T=c.elementType===c.type?g.memoizedProps:$r(c.type,g.memoizedProps);C.componentDidUpdate(T,g.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var L=c.updateQueue;L!==null&&kC(c,L,C);break;case 3:var Y=c.updateQueue;if(Y!==null){if(g=null,c.child!==null)switch(c.child.tag){case 5:g=c.child.stateNode;break;case 1:g=c.child.stateNode}kC(c,Y,g)}break;case 5:var se=c.stateNode;if(g===null&&c.flags&4){g=se;var ae=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":ae.autoFocus&&g.focus();break;case"img":ae.src&&(g.src=ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var he=c.alternate;if(he!==null){var je=he.memoizedState;if(je!==null){var Se=je.dehydrated;Se!==null&&sn(Se)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}fs||c.flags&512&&f_(c)}catch(Ne){xn(c,c.return,Ne)}}if(c===o){Be=null;break}if(g=c.sibling,g!==null){g.return=c.return,Be=g;break}Be=c.return}}function kS(o){for(;Be!==null;){var c=Be;if(c===o){Be=null;break}var g=c.sibling;if(g!==null){g.return=c.return,Be=g;break}Be=c.return}}function MS(o){for(;Be!==null;){var c=Be;try{switch(c.tag){case 0:case 11:case 15:var g=c.return;try{cf(4,c)}catch(ae){xn(c,g,ae)}break;case 1:var C=c.stateNode;if(typeof C.componentDidMount=="function"){var T=c.return;try{C.componentDidMount()}catch(ae){xn(c,T,ae)}}var L=c.return;try{f_(c)}catch(ae){xn(c,L,ae)}break;case 5:var Y=c.return;try{f_(c)}catch(ae){xn(c,Y,ae)}}}catch(ae){xn(c,c.return,ae)}if(c===o){Be=null;break}var se=c.sibling;if(se!==null){se.return=c.return,Be=se;break}Be=c.return}}var h8=Math.ceil,uf=b.ReactCurrentDispatcher,g_=b.ReactCurrentOwner,yr=b.ReactCurrentBatchConfig,Ot=0,Gn=null,Rn=null,as=0,ir=0,Ul=bt(0),Hn=0,Eu=null,Ci=0,df=0,__=0,ku=null,Us=null,y_=0,Hl=1/0,Ma=null,mf=!1,v_=null,ho=null,ff=!1,po=null,hf=0,Mu=0,x_=null,pf=-1,gf=0;function Cs(){return Ot&6?$e():pf!==-1?pf:pf=$e()}function go(o){return o.mode&1?Ot&2&&as!==0?as&-as:QB.transition!==null?(gf===0&&(gf=bs()),gf):(o=St,o!==0||(o=window.event,o=o===void 0?16:Cn(o.type)),o):1}function Lr(o,c,g,C){if(50<Mu)throw Mu=0,x_=null,Error(n(185));Ls(o,g,C),(!(Ot&2)||o!==Gn)&&(o===Gn&&(!(Ot&2)&&(df|=g),Hn===4&&_o(o,as)),Hs(o,C),g===1&&Ot===0&&!(c.mode&1)&&(Hl=$e()+500,Hm&&co()))}function Hs(o,c){var g=o.callbackNode;jn(o,c);var C=Pn(o,o===Gn?as:0);if(C===0)g!==null&&Kt(g),o.callbackNode=null,o.callbackPriority=0;else if(c=C&-C,o.callbackPriority!==c){if(g!=null&&Kt(g),c===1)o.tag===0?XB(OS.bind(null,o)):gC(OS.bind(null,o)),mC(function(){!(Ot&6)&&co()}),g=null;else{switch(wl(C)){case 1:g=Ps;break;case 4:g=es;break;case 16:g=ue;break;case 536870912:g=Fe;break;default:g=ue}g=IS(g,AS.bind(null,o))}o.callbackPriority=c,o.callbackNode=g}}function AS(o,c){if(pf=-1,gf=0,Ot&6)throw Error(n(327));var g=o.callbackNode;if(ql()&&o.callbackNode!==g)return null;var C=Pn(o,o===Gn?as:0);if(C===0)return null;if(C&30||C&o.expiredLanes||c)c=_f(o,C);else{c=C;var T=Ot;Ot|=2;var L=TS();(Gn!==o||as!==c)&&(Ma=null,Hl=$e()+500,Ei(o,c));do try{_8();break}catch(se){$S(o,se)}while(!0);Dg(),uf.current=L,Ot=T,Rn!==null?c=0:(Gn=null,as=0,c=Hn)}if(c!==0){if(c===2&&(T=Ln(o),T!==0&&(C=T,c=b_(o,T))),c===1)throw g=Eu,Ei(o,0),_o(o,C),Hs(o,$e()),g;if(c===6)_o(o,C);else{if(T=o.current.alternate,!(C&30)&&!p8(T)&&(c=_f(o,C),c===2&&(L=Ln(o),L!==0&&(C=L,c=b_(o,L))),c===1))throw g=Eu,Ei(o,0),_o(o,C),Hs(o,$e()),g;switch(o.finishedWork=T,o.finishedLanes=C,c){case 0:case 1:throw Error(n(345));case 2:ki(o,Us,Ma);break;case 3:if(_o(o,C),(C&130023424)===C&&(c=y_+500-$e(),10<c)){if(Pn(o,0)!==0)break;if(T=o.suspendedLanes,(T&C)!==C){Cs(),o.pingedLanes|=o.suspendedLanes&T;break}o.timeoutHandle=fu(ki.bind(null,o,Us,Ma),c);break}ki(o,Us,Ma);break;case 4:if(_o(o,C),(C&4194240)===C)break;for(c=o.eventTimes,T=-1;0<C;){var Y=31-nt(C);L=1<<Y,Y=c[Y],Y>T&&(T=Y),C&=~L}if(C=T,C=$e()-C,C=(120>C?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*h8(C/1960))-C,10<C){o.timeoutHandle=fu(ki.bind(null,o,Us,Ma),C);break}ki(o,Us,Ma);break;case 5:ki(o,Us,Ma);break;default:throw Error(n(329))}}}return Hs(o,$e()),o.callbackNode===g?AS.bind(null,o):null}function b_(o,c){var g=ku;return o.current.memoizedState.isDehydrated&&(Ei(o,c).flags|=256),o=_f(o,c),o!==2&&(c=Us,Us=g,c!==null&&w_(c)),o}function w_(o){Us===null?Us=o:Us.push.apply(Us,o)}function p8(o){for(var c=o;;){if(c.flags&16384){var g=c.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var C=0;C<g.length;C++){var T=g[C],L=T.getSnapshot;T=T.value;try{if(!sr(L(),T))return!1}catch{return!1}}}if(g=c.child,c.subtreeFlags&16384&&g!==null)g.return=c,c=g;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function _o(o,c){for(c&=~__,c&=~df,o.suspendedLanes|=c,o.pingedLanes&=~c,o=o.expirationTimes;0<c;){var g=31-nt(c),C=1<<g;o[g]=-1,c&=~C}}function OS(o){if(Ot&6)throw Error(n(327));ql();var c=Pn(o,0);if(!(c&1))return Hs(o,$e()),null;var g=_f(o,c);if(o.tag!==0&&g===2){var C=Ln(o);C!==0&&(c=C,g=b_(o,C))}if(g===1)throw g=Eu,Ei(o,0),_o(o,c),Hs(o,$e()),g;if(g===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=c,ki(o,Us,Ma),Hs(o,$e()),null}function N_(o,c){var g=Ot;Ot|=1;try{return o(c)}finally{Ot=g,Ot===0&&(Hl=$e()+500,Hm&&co())}}function Si(o){po!==null&&po.tag===0&&!(Ot&6)&&ql();var c=Ot;Ot|=1;var g=yr.transition,C=St;try{if(yr.transition=null,St=1,o)return o()}finally{St=C,yr.transition=g,Ot=c,!(Ot&6)&&co()}}function j_(){ir=Ul.current,qt(Ul)}function Ei(o,c){o.finishedWork=null,o.finishedLanes=0;var g=o.timeoutHandle;if(g!==-1&&(o.timeoutHandle=-1,Eg(g)),Rn!==null)for(g=Rn.return;g!==null;){var C=g;switch(Tg(C),C.tag){case 1:C=C.type.childContextTypes,C!=null&&Bm();break;case 3:Il(),qt(Is),qt(En),Wg();break;case 5:qg(C);break;case 4:Il();break;case 13:qt(fn);break;case 19:qt(fn);break;case 10:Ig(C.type._context);break;case 22:case 23:j_()}g=g.return}if(Gn=o,Rn=o=yo(o.current,null),as=ir=c,Hn=0,Eu=null,__=df=Ci=0,Us=ku=null,wi!==null){for(c=0;c<wi.length;c++)if(g=wi[c],C=g.interleaved,C!==null){g.interleaved=null;var T=C.next,L=g.pending;if(L!==null){var Y=L.next;L.next=T,C.next=Y}g.pending=C}wi=null}return o}function $S(o,c){do{var g=Rn;try{if(Dg(),Jm.current=sf,ef){for(var C=hn.memoizedState;C!==null;){var T=C.queue;T!==null&&(T.pending=null),C=C.next}ef=!1}if(ji=0,Kn=Un=hn=null,bu=!1,wu=0,g_.current=null,g===null||g.return===null){Hn=1,Eu=c,Rn=null;break}e:{var L=o,Y=g.return,se=g,ae=c;if(c=as,se.flags|=32768,ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var he=ae,je=se,Se=je.tag;if(!(je.mode&1)&&(Se===0||Se===11||Se===15)){var Ne=je.alternate;Ne?(je.updateQueue=Ne.updateQueue,je.memoizedState=Ne.memoizedState,je.lanes=Ne.lanes):(je.updateQueue=null,je.memoizedState=null)}var Ie=sS(Y);if(Ie!==null){Ie.flags&=-257,rS(Ie,Y,se,L,c),Ie.mode&1&&nS(L,he,c),c=Ie,ae=he;var Ue=c.updateQueue;if(Ue===null){var He=new Set;He.add(ae),c.updateQueue=He}else Ue.add(ae);break e}else{if(!(c&1)){nS(L,he,c),C_();break e}ae=Error(n(426))}}else if(an&&se.mode&1){var kn=sS(Y);if(kn!==null){!(kn.flags&65536)&&(kn.flags|=256),rS(kn,Y,se,L,c),zg(Fl(ae,se));break e}}L=ae=Fl(ae,se),Hn!==4&&(Hn=2),ku===null?ku=[L]:ku.push(L),L=Y;do{switch(L.tag){case 3:L.flags|=65536,c&=-c,L.lanes|=c;var le=eS(L,ae,c);EC(L,le);break e;case 1:se=ae;var oe=L.type,me=L.stateNode;if(!(L.flags&128)&&(typeof oe.getDerivedStateFromError=="function"||me!==null&&typeof me.componentDidCatch=="function"&&(ho===null||!ho.has(me)))){L.flags|=65536,c&=-c,L.lanes|=c;var Me=tS(L,se,c);EC(L,Me);break e}}L=L.return}while(L!==null)}LS(g)}catch(We){c=We,Rn===g&&g!==null&&(Rn=g=g.return);continue}break}while(!0)}function TS(){var o=uf.current;return uf.current=sf,o===null?sf:o}function C_(){(Hn===0||Hn===3||Hn===2)&&(Hn=4),Gn===null||!(Ci&268435455)&&!(df&268435455)||_o(Gn,as)}function _f(o,c){var g=Ot;Ot|=2;var C=TS();(Gn!==o||as!==c)&&(Ma=null,Ei(o,c));do try{g8();break}catch(T){$S(o,T)}while(!0);if(Dg(),Ot=g,uf.current=C,Rn!==null)throw Error(n(261));return Gn=null,as=0,Hn}function g8(){for(;Rn!==null;)PS(Rn)}function _8(){for(;Rn!==null&&!Ts();)PS(Rn)}function PS(o){var c=DS(o.alternate,o,ir);o.memoizedProps=o.pendingProps,c===null?LS(o):Rn=c,g_.current=null}function LS(o){var c=o;do{var g=c.alternate;if(o=c.return,c.flags&32768){if(g=u8(g,c),g!==null){g.flags&=32767,Rn=g;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Hn=6,Rn=null;return}}else if(g=c8(g,c,ir),g!==null){Rn=g;return}if(c=c.sibling,c!==null){Rn=c;return}Rn=c=o}while(c!==null);Hn===0&&(Hn=5)}function ki(o,c,g){var C=St,T=yr.transition;try{yr.transition=null,St=1,y8(o,c,g,C)}finally{yr.transition=T,St=C}return null}function y8(o,c,g,C){do ql();while(po!==null);if(Ot&6)throw Error(n(327));g=o.finishedWork;var T=o.finishedLanes;if(g===null)return null;if(o.finishedWork=null,o.finishedLanes=0,g===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var L=g.lanes|g.childLanes;if(qr(o,L),o===Gn&&(Rn=Gn=null,as=0),!(g.subtreeFlags&2064)&&!(g.flags&2064)||ff||(ff=!0,IS(ue,function(){return ql(),null})),L=(g.flags&15990)!==0,g.subtreeFlags&15990||L){L=yr.transition,yr.transition=null;var Y=St;St=1;var se=Ot;Ot|=4,g_.current=null,m8(o,g),CS(g,o),vg(du),Bn=!!uu,du=uu=null,o.current=g,f8(g),Ut(),Ot=se,St=Y,yr.transition=L}else o.current=g;if(ff&&(ff=!1,po=o,hf=T),L=o.pendingLanes,L===0&&(ho=null),kt(g.stateNode),Hs(o,$e()),c!==null)for(C=o.onRecoverableError,g=0;g<c.length;g++)T=c[g],C(T.value,{componentStack:T.stack,digest:T.digest});if(mf)throw mf=!1,o=v_,v_=null,o;return hf&1&&o.tag!==0&&ql(),L=o.pendingLanes,L&1?o===x_?Mu++:(Mu=0,x_=o):Mu=0,co(),null}function ql(){if(po!==null){var o=wl(hf),c=yr.transition,g=St;try{if(yr.transition=null,St=16>o?16:o,po===null)var C=!1;else{if(o=po,po=null,hf=0,Ot&6)throw Error(n(331));var T=Ot;for(Ot|=4,Be=o.current;Be!==null;){var L=Be,Y=L.child;if(Be.flags&16){var se=L.deletions;if(se!==null){for(var ae=0;ae<se.length;ae++){var he=se[ae];for(Be=he;Be!==null;){var je=Be;switch(je.tag){case 0:case 11:case 15:Su(8,je,L)}var Se=je.child;if(Se!==null)Se.return=je,Be=Se;else for(;Be!==null;){je=Be;var Ne=je.sibling,Ie=je.return;if(xS(je),je===he){Be=null;break}if(Ne!==null){Ne.return=Ie,Be=Ne;break}Be=Ie}}}var Ue=L.alternate;if(Ue!==null){var He=Ue.child;if(He!==null){Ue.child=null;do{var kn=He.sibling;He.sibling=null,He=kn}while(He!==null)}}Be=L}}if(L.subtreeFlags&2064&&Y!==null)Y.return=L,Be=Y;else e:for(;Be!==null;){if(L=Be,L.flags&2048)switch(L.tag){case 0:case 11:case 15:Su(9,L,L.return)}var le=L.sibling;if(le!==null){le.return=L.return,Be=le;break e}Be=L.return}}var oe=o.current;for(Be=oe;Be!==null;){Y=Be;var me=Y.child;if(Y.subtreeFlags&2064&&me!==null)me.return=Y,Be=me;else e:for(Y=oe;Be!==null;){if(se=Be,se.flags&2048)try{switch(se.tag){case 0:case 11:case 15:cf(9,se)}}catch(We){xn(se,se.return,We)}if(se===Y){Be=null;break e}var Me=se.sibling;if(Me!==null){Me.return=se.return,Be=Me;break e}Be=se.return}}if(Ot=T,co(),ke&&typeof ke.onPostCommitFiberRoot=="function")try{ke.onPostCommitFiberRoot(gt,o)}catch{}C=!0}return C}finally{St=g,yr.transition=c}}return!1}function zS(o,c,g){c=Fl(g,c),c=eS(o,c,1),o=mo(o,c,1),c=Cs(),o!==null&&(Ls(o,1,c),Hs(o,c))}function xn(o,c,g){if(o.tag===3)zS(o,o,g);else for(;c!==null;){if(c.tag===3){zS(c,o,g);break}else if(c.tag===1){var C=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(ho===null||!ho.has(C))){o=Fl(g,o),o=tS(c,o,1),c=mo(c,o,1),o=Cs(),c!==null&&(Ls(c,1,o),Hs(c,o));break}}c=c.return}}function v8(o,c,g){var C=o.pingCache;C!==null&&C.delete(c),c=Cs(),o.pingedLanes|=o.suspendedLanes&g,Gn===o&&(as&g)===g&&(Hn===4||Hn===3&&(as&130023424)===as&&500>$e()-y_?Ei(o,0):__|=g),Hs(o,c)}function RS(o,c){c===0&&(o.mode&1?(c=ts,ts<<=1,!(ts&130023424)&&(ts=4194304)):c=1);var g=Cs();o=Sa(o,c),o!==null&&(Ls(o,c,g),Hs(o,g))}function x8(o){var c=o.memoizedState,g=0;c!==null&&(g=c.retryLane),RS(o,g)}function b8(o,c){var g=0;switch(o.tag){case 13:var C=o.stateNode,T=o.memoizedState;T!==null&&(g=T.retryLane);break;case 19:C=o.stateNode;break;default:throw Error(n(314))}C!==null&&C.delete(c),RS(o,g)}var DS;DS=function(o,c,g){if(o!==null)if(o.memoizedProps!==c.pendingProps||Is.current)Bs=!0;else{if(!(o.lanes&g)&&!(c.flags&128))return Bs=!1,l8(o,c,g);Bs=!!(o.flags&131072)}else Bs=!1,an&&c.flags&1048576&&_C(c,Vm,c.index);switch(c.lanes=0,c.tag){case 2:var C=c.type;of(o,c),o=c.pendingProps;var T=$l(c,En.current);Dl(c,g),T=Gg(null,c,C,o,T,g);var L=Xg();return c.flags|=1,typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,Fs(C)?(L=!0,Um(c)):L=!1,c.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,Ug(c),T.updater=rf,c.stateNode=T,T._reactInternals=c,n_(c,C,o,g),c=o_(null,c,C,!0,L,g)):(c.tag=0,an&&L&&$g(c),js(null,c,T,g),c=c.child),c;case 16:C=c.elementType;e:{switch(of(o,c),o=c.pendingProps,T=C._init,C=T(C._payload),c.type=C,T=c.tag=N8(C),o=$r(C,o),T){case 0:c=a_(null,c,C,o,g);break e;case 1:c=uS(null,c,C,o,g);break e;case 11:c=aS(null,c,C,o,g);break e;case 14:c=oS(null,c,C,$r(C.type,o),g);break e}throw Error(n(306,C,""))}return c;case 0:return C=c.type,T=c.pendingProps,T=c.elementType===C?T:$r(C,T),a_(o,c,C,T,g);case 1:return C=c.type,T=c.pendingProps,T=c.elementType===C?T:$r(C,T),uS(o,c,C,T,g);case 3:e:{if(dS(c),o===null)throw Error(n(387));C=c.pendingProps,L=c.memoizedState,T=L.element,SC(o,c),Qm(c,C,null,g);var Y=c.memoizedState;if(C=Y.element,L.isDehydrated)if(L={element:C,isDehydrated:!1,cache:Y.cache,pendingSuspenseBoundaries:Y.pendingSuspenseBoundaries,transitions:Y.transitions},c.updateQueue.baseState=L,c.memoizedState=L,c.flags&256){T=Fl(Error(n(423)),c),c=mS(o,c,C,g,T);break e}else if(C!==T){T=Fl(Error(n(424)),c),c=mS(o,c,C,g,T);break e}else for(or=Xr(c.stateNode.containerInfo.firstChild),ar=c,an=!0,Or=null,g=jC(c,null,C,g),c.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(Ll(),C===T){c=ka(o,c,g);break e}js(o,c,C,g)}c=c.child}return c;case 5:return MC(c),o===null&&Lg(c),C=c.type,T=c.pendingProps,L=o!==null?o.memoizedProps:null,Y=T.children,mu(C,T)?Y=null:L!==null&&mu(C,L)&&(c.flags|=32),cS(o,c),js(o,c,Y,g),c.child;case 6:return o===null&&Lg(c),null;case 13:return fS(o,c,g);case 4:return Hg(c,c.stateNode.containerInfo),C=c.pendingProps,o===null?c.child=zl(c,null,C,g):js(o,c,C,g),c.child;case 11:return C=c.type,T=c.pendingProps,T=c.elementType===C?T:$r(C,T),aS(o,c,C,T,g);case 7:return js(o,c,c.pendingProps,g),c.child;case 8:return js(o,c,c.pendingProps.children,g),c.child;case 12:return js(o,c,c.pendingProps.children,g),c.child;case 10:e:{if(C=c.type._context,T=c.pendingProps,L=c.memoizedProps,Y=T.value,Ht(Km,C._currentValue),C._currentValue=Y,L!==null)if(sr(L.value,Y)){if(L.children===T.children&&!Is.current){c=ka(o,c,g);break e}}else for(L=c.child,L!==null&&(L.return=c);L!==null;){var se=L.dependencies;if(se!==null){Y=L.child;for(var ae=se.firstContext;ae!==null;){if(ae.context===C){if(L.tag===1){ae=Ea(-1,g&-g),ae.tag=2;var he=L.updateQueue;if(he!==null){he=he.shared;var je=he.pending;je===null?ae.next=ae:(ae.next=je.next,je.next=ae),he.pending=ae}}L.lanes|=g,ae=L.alternate,ae!==null&&(ae.lanes|=g),Fg(L.return,g,c),se.lanes|=g;break}ae=ae.next}}else if(L.tag===10)Y=L.type===c.type?null:L.child;else if(L.tag===18){if(Y=L.return,Y===null)throw Error(n(341));Y.lanes|=g,se=Y.alternate,se!==null&&(se.lanes|=g),Fg(Y,g,c),Y=L.sibling}else Y=L.child;if(Y!==null)Y.return=L;else for(Y=L;Y!==null;){if(Y===c){Y=null;break}if(L=Y.sibling,L!==null){L.return=Y.return,Y=L;break}Y=Y.return}L=Y}js(o,c,T.children,g),c=c.child}return c;case 9:return T=c.type,C=c.pendingProps.children,Dl(c,g),T=gr(T),C=C(T),c.flags|=1,js(o,c,C,g),c.child;case 14:return C=c.type,T=$r(C,c.pendingProps),T=$r(C.type,T),oS(o,c,C,T,g);case 15:return iS(o,c,c.type,c.pendingProps,g);case 17:return C=c.type,T=c.pendingProps,T=c.elementType===C?T:$r(C,T),of(o,c),c.tag=1,Fs(C)?(o=!0,Um(c)):o=!1,Dl(c,g),ZC(c,C,T),n_(c,C,T,g),o_(null,c,C,!0,o,g);case 19:return pS(o,c,g);case 22:return lS(o,c,g)}throw Error(n(156,c.tag))};function IS(o,c){return $s(o,c)}function w8(o,c,g,C){this.tag=o,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vr(o,c,g,C){return new w8(o,c,g,C)}function S_(o){return o=o.prototype,!(!o||!o.isReactComponent)}function N8(o){if(typeof o=="function")return S_(o)?1:0;if(o!=null){if(o=o.$$typeof,o===R)return 11;if(o===I)return 14}return 2}function yo(o,c){var g=o.alternate;return g===null?(g=vr(o.tag,c,o.key,o.mode),g.elementType=o.elementType,g.type=o.type,g.stateNode=o.stateNode,g.alternate=o,o.alternate=g):(g.pendingProps=c,g.type=o.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=o.flags&14680064,g.childLanes=o.childLanes,g.lanes=o.lanes,g.child=o.child,g.memoizedProps=o.memoizedProps,g.memoizedState=o.memoizedState,g.updateQueue=o.updateQueue,c=o.dependencies,g.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},g.sibling=o.sibling,g.index=o.index,g.ref=o.ref,g}function yf(o,c,g,C,T,L){var Y=2;if(C=o,typeof o=="function")S_(o)&&(Y=1);else if(typeof o=="string")Y=5;else e:switch(o){case M:return Mi(g.children,T,L,c);case O:Y=8,T|=8;break;case $:return o=vr(12,g,c,T|2),o.elementType=$,o.lanes=L,o;case F:return o=vr(13,g,c,T),o.elementType=F,o.lanes=L,o;case z:return o=vr(19,g,c,T),o.elementType=z,o.lanes=L,o;case q:return vf(g,T,L,c);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case P:Y=10;break e;case A:Y=9;break e;case R:Y=11;break e;case I:Y=14;break e;case U:Y=16,C=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return c=vr(Y,g,c,T),c.elementType=o,c.type=C,c.lanes=L,c}function Mi(o,c,g,C){return o=vr(7,o,C,c),o.lanes=g,o}function vf(o,c,g,C){return o=vr(22,o,C,c),o.elementType=q,o.lanes=g,o.stateNode={isHidden:!1},o}function E_(o,c,g){return o=vr(6,o,null,c),o.lanes=g,o}function k_(o,c,g){return c=vr(4,o.children!==null?o.children:[],o.key,c),c.lanes=g,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}function j8(o,c,g,C,T){this.tag=c,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ws(0),this.expirationTimes=ws(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ws(0),this.identifierPrefix=C,this.onRecoverableError=T,this.mutableSourceEagerHydrationData=null}function M_(o,c,g,C,T,L,Y,se,ae){return o=new j8(o,c,g,se,ae),c===1?(c=1,L===!0&&(c|=8)):c=0,L=vr(3,null,null,c),o.current=L,L.stateNode=o,L.memoizedState={element:C,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ug(L),o}function C8(o,c,g){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:C==null?null:""+C,children:o,containerInfo:c,implementation:g}}function FS(o){if(!o)return Ar;o=o._reactInternals;e:{if(Yt(o)!==o||o.tag!==1)throw Error(n(170));var c=o;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(Fs(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(n(171))}if(o.tag===1){var g=o.type;if(Fs(g))return hC(o,g,c)}return c}function BS(o,c,g,C,T,L,Y,se,ae){return o=M_(g,C,!0,o,T,L,Y,se,ae),o.context=FS(null),g=o.current,C=Cs(),T=go(g),L=Ea(C,T),L.callback=c??null,mo(g,L,T),o.current.lanes=T,Ls(o,T,C),Hs(o,C),o}function xf(o,c,g,C){var T=c.current,L=Cs(),Y=go(T);return g=FS(g),c.context===null?c.context=g:c.pendingContext=g,c=Ea(L,Y),c.payload={element:o},C=C===void 0?null:C,C!==null&&(c.callback=C),o=mo(T,c,Y),o!==null&&(Lr(o,T,Y,L),Xm(o,T,Y)),Y}function bf(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function US(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var g=o.retryLane;o.retryLane=g!==0&&g<c?g:c}}function A_(o,c){US(o,c),(o=o.alternate)&&US(o,c)}function S8(){return null}var HS=typeof reportError=="function"?reportError:function(o){console.error(o)};function O_(o){this._internalRoot=o}wf.prototype.render=O_.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(n(409));xf(o,c,null,null)},wf.prototype.unmount=O_.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;Si(function(){xf(null,o,null,null)}),c[Qr]=null}};function wf(o){this._internalRoot=o}wf.prototype.unstable_scheduleHydration=function(o){if(o){var c=Zo();o={blockedOn:null,target:o,priority:c};for(var g=0;g<fe.length&&c!==0&&c<fe[g].priority;g++);fe.splice(g,0,o),g===0&&Ve(o)}};function $_(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function Nf(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function qS(){}function E8(o,c,g,C,T){if(T){if(typeof C=="function"){var L=C;C=function(){var he=bf(Y);L.call(he)}}var Y=BS(c,C,o,0,null,!1,!1,"",qS);return o._reactRootContainer=Y,o[Qr]=Y.current,pi(o.nodeType===8?o.parentNode:o),Si(),Y}for(;T=o.lastChild;)o.removeChild(T);if(typeof C=="function"){var se=C;C=function(){var he=bf(ae);se.call(he)}}var ae=M_(o,0,!1,null,null,!1,!1,"",qS);return o._reactRootContainer=ae,o[Qr]=ae.current,pi(o.nodeType===8?o.parentNode:o),Si(function(){xf(c,ae,g,C)}),ae}function jf(o,c,g,C,T){var L=g._reactRootContainer;if(L){var Y=L;if(typeof T=="function"){var se=T;T=function(){var ae=bf(Y);se.call(ae)}}xf(c,Y,o,T)}else Y=E8(g,c,o,T,C);return bf(Y)}dr=function(o){switch(o.tag){case 3:var c=o.stateNode;if(c.current.memoizedState.isDehydrated){var g=Tn(c.pendingLanes);g!==0&&(Vr(c,g|1),Hs(c,$e()),!(Ot&6)&&(Hl=$e()+500,co()))}break;case 13:Si(function(){var C=Sa(o,1);if(C!==null){var T=Cs();Lr(C,o,1,T)}}),A_(o,1)}},Qo=function(o){if(o.tag===13){var c=Sa(o,134217728);if(c!==null){var g=Cs();Lr(c,o,134217728,g)}A_(o,134217728)}},pa=function(o){if(o.tag===13){var c=go(o),g=Sa(o,c);if(g!==null){var C=Cs();Lr(g,o,c,C)}A_(o,c)}},Zo=function(){return St},Nl=function(o,c){var g=St;try{return St=o,c()}finally{St=g}},un=function(o,c,g){switch(c){case"input":if(ie(o,g),c=g.name,g.type==="radio"&&c!=null){for(g=o;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<g.length;c++){var C=g[c];if(C!==o&&C.form===o.form){var T=Ol(C);if(!T)throw Error(n(90));_e(C),ie(C,T)}}}break;case"textarea":qe(o,g);break;case"select":c=g.value,c!=null&&De(o,!!g.multiple,c,!1)}},mt=N_,Vn=Si;var k8={usingClientEntryPoint:!1,Events:[yi,lo,Ol,ht,Bt,N_]},Au={findFiberByHostInstance:wa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},M8={bundleType:Au.bundleType,version:Au.version,rendererPackageName:Au.rendererPackageName,rendererConfig:Au.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=vs(o),o===null?null:o.stateNode},findFiberByHostInstance:Au.findFiberByHostInstance||S8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cf.isDisabled&&Cf.supportsFiber)try{gt=Cf.inject(M8),ke=Cf}catch{}}return Ss.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k8,Ss.createPortal=function(o,c){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$_(c))throw Error(n(200));return C8(o,c,null,g)},Ss.createRoot=function(o,c){if(!$_(o))throw Error(n(299));var g=!1,C="",T=HS;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(C=c.identifierPrefix),c.onRecoverableError!==void 0&&(T=c.onRecoverableError)),c=M_(o,1,!1,null,null,g,!1,C,T),o[Qr]=c.current,pi(o.nodeType===8?o.parentNode:o),new O_(c)},Ss.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=vs(c),o=o===null?null:o.stateNode,o},Ss.flushSync=function(o){return Si(o)},Ss.hydrate=function(o,c,g){if(!Nf(c))throw Error(n(200));return jf(null,o,c,!0,g)},Ss.hydrateRoot=function(o,c,g){if(!$_(o))throw Error(n(405));var C=g!=null&&g.hydratedSources||null,T=!1,L="",Y=HS;if(g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(L=g.identifierPrefix),g.onRecoverableError!==void 0&&(Y=g.onRecoverableError)),c=BS(c,null,o,1,g??null,T,!1,L,Y),o[Qr]=c.current,pi(o),C)for(o=0;o<C.length;o++)g=C[o],T=g._getVersion,T=T(g._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[g,T]:c.mutableSourceEagerHydrationData.push(g,T);return new wf(c)},Ss.render=function(o,c,g){if(!Nf(c))throw Error(n(200));return jf(null,o,c,!1,g)},Ss.unmountComponentAtNode=function(o){if(!Nf(o))throw Error(n(40));return o._reactRootContainer?(Si(function(){jf(null,null,o,!1,function(){o._reactRootContainer=null,o[Qr]=null})}),!0):!1},Ss.unstable_batchedUpdates=N_,Ss.unstable_renderSubtreeIntoContainer=function(o,c,g,C){if(!Nf(g))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return jf(o,c,g,!1,C)},Ss.version="18.3.1-next-f1338f8080-20240426",Ss}function K_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(K_)}catch(e){console.error(e)}}K_(),q_.exports=QS();var G_=q_.exports,X_=G_;kf.createRoot=X_.createRoot,kf.hydrateRoot=X_.hydrateRoot;var Ai=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ZS={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},JS=(tC=class{constructor(){Ke(this,Wa,ZS);Ke(this,sg,!1)}setTimeoutProvider(e){Re(this,Wa,e)}setTimeout(e,t){return re(this,Wa).setTimeout(e,t)}clearTimeout(e){re(this,Wa).clearTimeout(e)}setInterval(e,t){return re(this,Wa).setInterval(e,t)}clearInterval(e){re(this,Wa).clearInterval(e)}},Wa=new WeakMap,sg=new WeakMap,tC),wo=new JS;function e1(e){setTimeout(e,0)}var No=typeof window>"u"||"Deno"in globalThis;function hs(){}function t1(e,t){return typeof e=="function"?e(t):e}function Of(e){return typeof e=="number"&&e>=0&&e!==1/0}function Q_(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Oa(e,t){return typeof e=="function"?e(t):e}function lr(e,t){return typeof e=="function"?e(t):e}function Z_(e,t){const{type:n="all",exact:s,fetchStatus:r,predicate:i,queryKey:l,stale:u}=e;if(l){if(s){if(t.queryHash!==$f(l,t.options))return!1}else if(!Vl(t.queryKey,l))return!1}if(n!=="all"){const d=t.isActive();if(n==="active"&&!d||n==="inactive"&&d)return!1}return!(typeof u=="boolean"&&t.isStale()!==u||r&&r!==t.state.fetchStatus||i&&!i(t))}function J_(e,t){const{exact:n,status:s,predicate:r,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(n){if(jo(t.options.mutationKey)!==jo(i))return!1}else if(!Vl(t.options.mutationKey,i))return!1}return!(s&&t.state.status!==s||r&&!r(t))}function $f(e,t){return((t==null?void 0:t.queryKeyHashFn)||jo)(e)}function jo(e){return JSON.stringify(e,(t,n)=>Tf(n)?Object.keys(n).sort().reduce((s,r)=>(s[r]=n[r],s),{}):n)}function Vl(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Vl(e[n],t[n])):!1}var n1=Object.prototype.hasOwnProperty;function ey(e,t){if(e===t)return e;const n=ty(e)&&ty(t);if(!n&&!(Tf(e)&&Tf(t)))return t;const r=(n?e:Object.keys(e)).length,i=n?t:Object.keys(t),l=i.length,u=n?new Array(l):{};let d=0;for(let f=0;f<l;f++){const p=n?f:i[f],m=e[p],h=t[p];if(m===h){u[p]=m,(n?f<r:n1.call(e,p))&&d++;continue}if(m===null||h===null||typeof m!="object"||typeof h!="object"){u[p]=h;continue}const _=ey(m,h);u[p]=_,_===m&&d++}return r===l&&d===r?e:u}function $u(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function ty(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Tf(e){if(!ny(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!ny(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function ny(e){return Object.prototype.toString.call(e)==="[object Object]"}function s1(e){return new Promise(t=>{wo.setTimeout(t,e)})}function Pf(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?ey(e,t):t}function r1(e,t,n=0){const s=[...e,t];return n&&s.length>n?s.slice(1):s}function a1(e,t,n=0){const s=[t,...e];return n&&s.length>n?s.slice(0,-1):s}var Lf=Symbol();function sy(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===Lf?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function ry(e,t){return typeof e=="function"?e(...t):!!e}var o1=(nC=class extends Ai{constructor(){super();Ke(this,Uo);Ke(this,Ya);Ke(this,ul);Re(this,ul,t=>{if(!No&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){re(this,Ya)||this.setEventListener(re(this,ul))}onUnsubscribe(){var t;this.hasListeners()||((t=re(this,Ya))==null||t.call(this),Re(this,Ya,void 0))}setEventListener(t){var n;Re(this,ul,t),(n=re(this,Ya))==null||n.call(this),Re(this,Ya,t(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(t){re(this,Uo)!==t&&(Re(this,Uo,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof re(this,Uo)=="boolean"?re(this,Uo):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Uo=new WeakMap,Ya=new WeakMap,ul=new WeakMap,nC),zf=new o1;function Rf(){let e,t;const n=new Promise((r,i)=>{e=r,t=i});n.status="pending",n.catch(()=>{});function s(r){Object.assign(n,r),delete n.resolve,delete n.reject}return n.resolve=r=>{s({status:"fulfilled",value:r}),e(r)},n.reject=r=>{s({status:"rejected",reason:r}),t(r)},n}var i1=e1;function l1(){let e=[],t=0,n=u=>{u()},s=u=>{u()},r=i1;const i=u=>{t?e.push(u):r(()=>{n(u)})},l=()=>{const u=e;e=[],u.length&&r(()=>{s(()=>{u.forEach(d=>{n(d)})})})};return{batch:u=>{let d;t++;try{d=u()}finally{t--,t||l()}return d},batchCalls:u=>(...d)=>{i(()=>{u(...d)})},schedule:i,setNotifyFunction:u=>{n=u},setBatchNotifyFunction:u=>{s=u},setScheduler:u=>{r=u}}}var Dn=l1(),c1=(sC=class extends Ai{constructor(){super();Ke(this,dl,!0);Ke(this,Ka);Ke(this,ml);Re(this,ml,t=>{if(!No&&window.addEventListener){const n=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",s)}}})}onSubscribe(){re(this,Ka)||this.setEventListener(re(this,ml))}onUnsubscribe(){var t;this.hasListeners()||((t=re(this,Ka))==null||t.call(this),Re(this,Ka,void 0))}setEventListener(t){var n;Re(this,ml,t),(n=re(this,Ka))==null||n.call(this),Re(this,Ka,t(this.setOnline.bind(this)))}setOnline(t){re(this,dl)!==t&&(Re(this,dl,t),this.listeners.forEach(s=>{s(t)}))}isOnline(){return re(this,dl)}},dl=new WeakMap,Ka=new WeakMap,ml=new WeakMap,sC),Tu=new c1;function u1(e){return Math.min(1e3*2**e,3e4)}function ay(e){return(e??"online")==="online"?Tu.isOnline():!0}var Df=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function oy(e){let t=!1,n=0,s;const r=Rf(),i=()=>r.status!=="pending",l=y=>{var v;if(!i()){const w=new Df(y);h(w),(v=e.onCancel)==null||v.call(e,w)}},u=()=>{t=!0},d=()=>{t=!1},f=()=>zf.isFocused()&&(e.networkMode==="always"||Tu.isOnline())&&e.canRun(),p=()=>ay(e.networkMode)&&e.canRun(),m=y=>{i()||(s==null||s(),r.resolve(y))},h=y=>{i()||(s==null||s(),r.reject(y))},_=()=>new Promise(y=>{var v;s=w=>{(i()||f())&&y(w)},(v=e.onPause)==null||v.call(e)}).then(()=>{var y;s=void 0,i()||(y=e.onContinue)==null||y.call(e)}),x=()=>{if(i())return;let y;const v=n===0?e.initialPromise:void 0;try{y=v??e.fn()}catch(w){y=Promise.reject(w)}Promise.resolve(y).then(m).catch(w=>{var E;if(i())return;const k=e.retry??(No?0:3),j=e.retryDelay??u1,b=typeof j=="function"?j(n,w):j,S=k===!0||typeof k=="number"&&n<k||typeof k=="function"&&k(n,w);if(t||!S){h(w);return}n++,(E=e.onFail)==null||E.call(e,n,w),s1(b).then(()=>f()?void 0:_()).then(()=>{t?h(w):x()})})};return{promise:r,status:()=>r.status,cancel:l,continue:()=>(s==null||s(),r),cancelRetry:u,continueRetry:d,canStart:p,start:()=>(p()?x():_().then(x),r)}}var iy=(rC=class{constructor(){Ke(this,Ho)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Of(this.gcTime)&&Re(this,Ho,wo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(No?1/0:5*60*1e3))}clearGcTimeout(){re(this,Ho)&&(wo.clearTimeout(re(this,Ho)),Re(this,Ho,void 0))}},Ho=new WeakMap,rC),d1={NODE_ENV:"production"},m1=(aC=class extends iy{constructor(t){super();Ke(this,Sr);Ke(this,qo);Ke(this,fl);Ke(this,ur);Ke(this,Vo);Ke(this,qn);Ke(this,qc);Ke(this,Wo);Re(this,Wo,!1),Re(this,qc,t.defaultOptions),this.setOptions(t.options),this.observers=[],Re(this,Vo,t.client),Re(this,ur,re(this,Vo).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Re(this,qo,cy(this.options)),this.state=t.state??re(this,qo),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=re(this,qn))==null?void 0:t.promise}setOptions(t){if(this.options={...re(this,qc),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=cy(this.options);n.data!==void 0&&(this.setData(n.data,{updatedAt:n.dataUpdatedAt,manual:!0}),Re(this,qo,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&re(this,ur).remove(this)}setData(t,n){const s=Pf(this.state.data,t,this.options);return ft(this,Sr,Aa).call(this,{data:s,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),s}setState(t,n){ft(this,Sr,Aa).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var s,r;const n=(s=re(this,qn))==null?void 0:s.promise;return(r=re(this,qn))==null||r.cancel(t),n?n.then(hs).catch(hs):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(re(this,qo))}isActive(){return this.observers.some(t=>lr(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Lf||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Oa(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Q_(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=re(this,qn))==null||n.continue()}onOnline(){var n;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=re(this,qn))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),re(this,ur).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(re(this,qn)&&(re(this,Wo)?re(this,qn).cancel({revert:!0}):re(this,qn).cancelRetry()),this.scheduleGc()),re(this,ur).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ft(this,Sr,Aa).call(this,{type:"invalidate"})}async fetch(t,n){var d,f,p,m,h,_,x,y,v,w,k,j;if(this.state.fetchStatus!=="idle"&&((d=re(this,qn))==null?void 0:d.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(re(this,qn))return re(this,qn).continueRetry(),re(this,qn).promise}if(t&&this.setOptions(t),!this.options.queryFn){const b=this.observers.find(S=>S.options.queryFn);b&&this.setOptions(b.options)}const s=new AbortController,r=b=>{Object.defineProperty(b,"signal",{enumerable:!0,get:()=>(Re(this,Wo,!0),s.signal)})},i=()=>{const b=sy(this.options,n),E=(()=>{const M={client:re(this,Vo),queryKey:this.queryKey,meta:this.meta};return r(M),M})();return Re(this,Wo,!1),this.options.persister?this.options.persister(b,E,this):b(E)},u=(()=>{const b={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:re(this,Vo),state:this.state,fetchFn:i};return r(b),b})();(f=this.options.behavior)==null||f.onFetch(u,this),Re(this,fl,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((p=u.fetchOptions)==null?void 0:p.meta))&&ft(this,Sr,Aa).call(this,{type:"fetch",meta:(m=u.fetchOptions)==null?void 0:m.meta}),Re(this,qn,oy({initialPromise:n==null?void 0:n.initialPromise,fn:u.fetchFn,onCancel:b=>{b instanceof Df&&b.revert&&this.setState({...re(this,fl),fetchStatus:"idle"}),s.abort()},onFail:(b,S)=>{ft(this,Sr,Aa).call(this,{type:"failed",failureCount:b,error:S})},onPause:()=>{ft(this,Sr,Aa).call(this,{type:"pause"})},onContinue:()=>{ft(this,Sr,Aa).call(this,{type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0}));try{const b=await re(this,qn).start();if(b===void 0)throw d1.NODE_ENV,new Error(`${this.queryHash} data is undefined`);return this.setData(b),(_=(h=re(this,ur).config).onSuccess)==null||_.call(h,b,this),(y=(x=re(this,ur).config).onSettled)==null||y.call(x,b,this.state.error,this),b}catch(b){if(b instanceof Df){if(b.silent)return re(this,qn).promise;if(b.revert){if(this.state.data===void 0)throw b;return this.state.data}}throw ft(this,Sr,Aa).call(this,{type:"error",error:b}),(w=(v=re(this,ur).config).onError)==null||w.call(v,b,this),(j=(k=re(this,ur).config).onSettled)==null||j.call(k,this.state.data,b,this),b}finally{this.scheduleGc()}}},qo=new WeakMap,fl=new WeakMap,ur=new WeakMap,Vo=new WeakMap,qn=new WeakMap,qc=new WeakMap,Wo=new WeakMap,Sr=new WeakSet,Aa=function(t){const n=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...ly(s.data,this.options),fetchMeta:t.meta??null};case"success":const r={...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Re(this,fl,t.manual?r:void 0),r;case"error":const i=t.error;return{...s,error:i,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=n(this.state),Dn.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),re(this,ur).notify({query:this,type:"updated",action:t})})},aC);function ly(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ay(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function cy(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,s=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var f1=(oC=class extends Ai{constructor(t,n){super();Ke(this,Rt);Ke(this,As);Ke(this,wt);Ke(this,Vc);Ke(this,gs);Ke(this,Yo);Ke(this,hl);Ke(this,ua);Ke(this,Ga);Ke(this,Wc);Ke(this,pl);Ke(this,gl);Ke(this,Ko);Ke(this,Go);Ke(this,Xa);Ke(this,_l,new Set);this.options=n,Re(this,As,t),Re(this,Ga,null),Re(this,ua,Rf()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(re(this,wt).addObserver(this),uy(re(this,wt),this.options)?ft(this,Rt,Ou).call(this):this.updateResult(),ft(this,Rt,R_).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return If(re(this,wt),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return If(re(this,wt),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ft(this,Rt,D_).call(this),ft(this,Rt,I_).call(this),re(this,wt).removeObserver(this)}setOptions(t){const n=this.options,s=re(this,wt);if(this.options=re(this,As).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof lr(this.options.enabled,re(this,wt))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ft(this,Rt,F_).call(this),re(this,wt).setOptions(this.options),n._defaulted&&!$u(this.options,n)&&re(this,As).getQueryCache().notify({type:"observerOptionsUpdated",query:re(this,wt),observer:this});const r=this.hasListeners();r&&dy(re(this,wt),s,this.options,n)&&ft(this,Rt,Ou).call(this),this.updateResult(),r&&(re(this,wt)!==s||lr(this.options.enabled,re(this,wt))!==lr(n.enabled,re(this,wt))||Oa(this.options.staleTime,re(this,wt))!==Oa(n.staleTime,re(this,wt)))&&ft(this,Rt,P_).call(this);const i=ft(this,Rt,L_).call(this);r&&(re(this,wt)!==s||lr(this.options.enabled,re(this,wt))!==lr(n.enabled,re(this,wt))||i!==re(this,Xa))&&ft(this,Rt,z_).call(this,i)}getOptimisticResult(t){const n=re(this,As).getQueryCache().build(re(this,As),t),s=this.createResult(n,t);return p1(this,s)&&(Re(this,gs,s),Re(this,hl,this.options),Re(this,Yo,re(this,wt).state)),s}getCurrentResult(){return re(this,gs)}trackResult(t,n){return new Proxy(t,{get:(s,r)=>(this.trackProp(r),n==null||n(r),r==="promise"&&!this.options.experimental_prefetchInRender&&re(this,ua).status==="pending"&&re(this,ua).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(s,r))})}trackProp(t){re(this,_l).add(t)}getCurrentQuery(){return re(this,wt)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=re(this,As).defaultQueryOptions(t),s=re(this,As).getQueryCache().build(re(this,As),n);return s.fetch().then(()=>this.createResult(s,n))}fetch(t){return ft(this,Rt,Ou).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),re(this,gs)))}createResult(t,n){var $;const s=re(this,wt),r=this.options,i=re(this,gs),l=re(this,Yo),u=re(this,hl),f=t!==s?t.state:re(this,Vc),{state:p}=t;let m={...p},h=!1,_;if(n._optimisticResults){const P=this.hasListeners(),A=!P&&uy(t,n),R=P&&dy(t,s,n,r);(A||R)&&(m={...m,...ly(p.data,t.options)}),n._optimisticResults==="isRestoring"&&(m.fetchStatus="idle")}let{error:x,errorUpdatedAt:y,status:v}=m;_=m.data;let w=!1;if(n.placeholderData!==void 0&&_===void 0&&v==="pending"){let P;i!=null&&i.isPlaceholderData&&n.placeholderData===(u==null?void 0:u.placeholderData)?(P=i.data,w=!0):P=typeof n.placeholderData=="function"?n.placeholderData(($=re(this,gl))==null?void 0:$.state.data,re(this,gl)):n.placeholderData,P!==void 0&&(v="success",_=Pf(i==null?void 0:i.data,P,n),h=!0)}if(n.select&&_!==void 0&&!w)if(i&&_===(l==null?void 0:l.data)&&n.select===re(this,Wc))_=re(this,pl);else try{Re(this,Wc,n.select),_=n.select(_),_=Pf(i==null?void 0:i.data,_,n),Re(this,pl,_),Re(this,Ga,null)}catch(P){Re(this,Ga,P)}re(this,Ga)&&(x=re(this,Ga),_=re(this,pl),y=Date.now(),v="error");const k=m.fetchStatus==="fetching",j=v==="pending",b=v==="error",S=j&&k,E=_!==void 0,O={status:v,fetchStatus:m.fetchStatus,isPending:j,isSuccess:v==="success",isError:b,isInitialLoading:S,isLoading:S,data:_,dataUpdatedAt:m.dataUpdatedAt,error:x,errorUpdatedAt:y,failureCount:m.fetchFailureCount,failureReason:m.fetchFailureReason,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>f.dataUpdateCount||m.errorUpdateCount>f.errorUpdateCount,isFetching:k,isRefetching:k&&!j,isLoadingError:b&&!E,isPaused:m.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:b&&E,isStale:Ff(t,n),refetch:this.refetch,promise:re(this,ua),isEnabled:lr(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const P=F=>{O.status==="error"?F.reject(O.error):O.data!==void 0&&F.resolve(O.data)},A=()=>{const F=Re(this,ua,O.promise=Rf());P(F)},R=re(this,ua);switch(R.status){case"pending":t.queryHash===s.queryHash&&P(R);break;case"fulfilled":(O.status==="error"||O.data!==R.value)&&A();break;case"rejected":(O.status!=="error"||O.error!==R.reason)&&A();break}}return O}updateResult(){const t=re(this,gs),n=this.createResult(re(this,wt),this.options);if(Re(this,Yo,re(this,wt).state),Re(this,hl,this.options),re(this,Yo).data!==void 0&&Re(this,gl,re(this,wt)),$u(n,t))return;Re(this,gs,n);const s=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!re(this,_l).size)return!0;const l=new Set(i??re(this,_l));return this.options.throwOnError&&l.add("error"),Object.keys(re(this,gs)).some(u=>{const d=u;return re(this,gs)[d]!==t[d]&&l.has(d)})};ft(this,Rt,WS).call(this,{listeners:s()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ft(this,Rt,R_).call(this)}},As=new WeakMap,wt=new WeakMap,Vc=new WeakMap,gs=new WeakMap,Yo=new WeakMap,hl=new WeakMap,ua=new WeakMap,Ga=new WeakMap,Wc=new WeakMap,pl=new WeakMap,gl=new WeakMap,Ko=new WeakMap,Go=new WeakMap,Xa=new WeakMap,_l=new WeakMap,Rt=new WeakSet,Ou=function(t){ft(this,Rt,F_).call(this);let n=re(this,wt).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(hs)),n},P_=function(){ft(this,Rt,D_).call(this);const t=Oa(this.options.staleTime,re(this,wt));if(No||re(this,gs).isStale||!Of(t))return;const s=Q_(re(this,gs).dataUpdatedAt,t)+1;Re(this,Ko,wo.setTimeout(()=>{re(this,gs).isStale||this.updateResult()},s))},L_=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(re(this,wt)):this.options.refetchInterval)??!1},z_=function(t){ft(this,Rt,I_).call(this),Re(this,Xa,t),!(No||lr(this.options.enabled,re(this,wt))===!1||!Of(re(this,Xa))||re(this,Xa)===0)&&Re(this,Go,wo.setInterval(()=>{(this.options.refetchIntervalInBackground||zf.isFocused())&&ft(this,Rt,Ou).call(this)},re(this,Xa)))},R_=function(){ft(this,Rt,P_).call(this),ft(this,Rt,z_).call(this,ft(this,Rt,L_).call(this))},D_=function(){re(this,Ko)&&(wo.clearTimeout(re(this,Ko)),Re(this,Ko,void 0))},I_=function(){re(this,Go)&&(wo.clearInterval(re(this,Go)),Re(this,Go,void 0))},F_=function(){const t=re(this,As).getQueryCache().build(re(this,As),this.options);if(t===re(this,wt))return;const n=re(this,wt);Re(this,wt,t),Re(this,Vc,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},WS=function(t){Dn.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(re(this,gs))}),re(this,As).getQueryCache().notify({query:re(this,wt),type:"observerResultsUpdated"})})},oC);function h1(e,t){return lr(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function uy(e,t){return h1(e,t)||e.state.data!==void 0&&If(e,t,t.refetchOnMount)}function If(e,t,n){if(lr(t.enabled,e)!==!1&&Oa(t.staleTime,e)!=="static"){const s=typeof n=="function"?n(e):n;return s==="always"||s!==!1&&Ff(e,t)}return!1}function dy(e,t,n,s){return(e!==t||lr(s.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&Ff(e,n)}function Ff(e,t){return lr(t.enabled,e)!==!1&&e.isStaleByTime(Oa(t.staleTime,e))}function p1(e,t){return!$u(e.getCurrentResult(),t)}function my(e){return{onFetch:(t,n)=>{var p,m,h,_,x;const s=t.options,r=(h=(m=(p=t.fetchOptions)==null?void 0:p.meta)==null?void 0:m.fetchMore)==null?void 0:h.direction,i=((_=t.state.data)==null?void 0:_.pages)||[],l=((x=t.state.data)==null?void 0:x.pageParams)||[];let u={pages:[],pageParams:[]},d=0;const f=async()=>{let y=!1;const v=j=>{Object.defineProperty(j,"signal",{enumerable:!0,get:()=>(t.signal.aborted?y=!0:t.signal.addEventListener("abort",()=>{y=!0}),t.signal)})},w=sy(t.options,t.fetchOptions),k=async(j,b,S)=>{if(y)return Promise.reject();if(b==null&&j.pages.length)return Promise.resolve(j);const M=(()=>{const A={client:t.client,queryKey:t.queryKey,pageParam:b,direction:S?"backward":"forward",meta:t.options.meta};return v(A),A})(),O=await w(M),{maxPages:$}=t.options,P=S?a1:r1;return{pages:P(j.pages,O,$),pageParams:P(j.pageParams,b,$)}};if(r&&i.length){const j=r==="backward",b=j?g1:fy,S={pages:i,pageParams:l},E=b(s,S);u=await k(S,E,j)}else{const j=e??i.length;do{const b=d===0?l[0]??s.initialPageParam:fy(s,u);if(d>0&&b==null)break;u=await k(u,b),d++}while(d<j)}return u};t.options.persister?t.fetchFn=()=>{var y,v;return(v=(y=t.options).persister)==null?void 0:v.call(y,f,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=f}}}function fy(e,{pages:t,pageParams:n}){const s=t.length-1;return t.length>0?e.getNextPageParam(t[s],t,n[s],n):void 0}function g1(e,{pages:t,pageParams:n}){var s;return t.length>0?(s=e.getPreviousPageParam)==null?void 0:s.call(e,t[0],t,n[0],n):void 0}var _1=(iC=class extends iy{constructor(t){super();Ke(this,Ur);Ke(this,Yc);Ke(this,Br);Ke(this,_s);Ke(this,Xo);Re(this,Yc,t.client),this.mutationId=t.mutationId,Re(this,_s,t.mutationCache),Re(this,Br,[]),this.state=t.state||hy(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){re(this,Br).includes(t)||(re(this,Br).push(t),this.clearGcTimeout(),re(this,_s).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Re(this,Br,re(this,Br).filter(n=>n!==t)),this.scheduleGc(),re(this,_s).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){re(this,Br).length||(this.state.status==="pending"?this.scheduleGc():re(this,_s).remove(this))}continue(){var t;return((t=re(this,Xo))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var l,u,d,f,p,m,h,_,x,y,v,w,k,j,b,S,E,M,O,$;const n=()=>{ft(this,Ur,xo).call(this,{type:"continue"})},s={client:re(this,Yc),meta:this.options.meta,mutationKey:this.options.mutationKey};Re(this,Xo,oy({fn:()=>this.options.mutationFn?this.options.mutationFn(t,s):Promise.reject(new Error("No mutationFn found")),onFail:(P,A)=>{ft(this,Ur,xo).call(this,{type:"failed",failureCount:P,error:A})},onPause:()=>{ft(this,Ur,xo).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>re(this,_s).canRun(this)}));const r=this.state.status==="pending",i=!re(this,Xo).canStart();try{if(r)n();else{ft(this,Ur,xo).call(this,{type:"pending",variables:t,isPaused:i}),await((u=(l=re(this,_s).config).onMutate)==null?void 0:u.call(l,t,this,s));const A=await((f=(d=this.options).onMutate)==null?void 0:f.call(d,t,s));A!==this.state.context&&ft(this,Ur,xo).call(this,{type:"pending",context:A,variables:t,isPaused:i})}const P=await re(this,Xo).start();return await((m=(p=re(this,_s).config).onSuccess)==null?void 0:m.call(p,P,t,this.state.context,this,s)),await((_=(h=this.options).onSuccess)==null?void 0:_.call(h,P,t,this.state.context,s)),await((y=(x=re(this,_s).config).onSettled)==null?void 0:y.call(x,P,null,this.state.variables,this.state.context,this,s)),await((w=(v=this.options).onSettled)==null?void 0:w.call(v,P,null,t,this.state.context,s)),ft(this,Ur,xo).call(this,{type:"success",data:P}),P}catch(P){try{throw await((j=(k=re(this,_s).config).onError)==null?void 0:j.call(k,P,t,this.state.context,this,s)),await((S=(b=this.options).onError)==null?void 0:S.call(b,P,t,this.state.context,s)),await((M=(E=re(this,_s).config).onSettled)==null?void 0:M.call(E,void 0,P,this.state.variables,this.state.context,this,s)),await(($=(O=this.options).onSettled)==null?void 0:$.call(O,void 0,P,t,this.state.context,s)),P}finally{ft(this,Ur,xo).call(this,{type:"error",error:P})}}finally{re(this,_s).runNext(this)}}},Yc=new WeakMap,Br=new WeakMap,_s=new WeakMap,Xo=new WeakMap,Ur=new WeakSet,xo=function(t){const n=s=>{switch(t.type){case"failed":return{...s,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Dn.batch(()=>{re(this,Br).forEach(s=>{s.onMutationUpdate(t)}),re(this,_s).notify({mutation:this,type:"updated",action:t})})},iC);function hy(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var y1=(lC=class extends Ai{constructor(t={}){super();Ke(this,da);Ke(this,Er);Ke(this,Kc);this.config=t,Re(this,da,new Set),Re(this,Er,new Map),Re(this,Kc,0)}build(t,n,s){const r=new _1({client:t,mutationCache:this,mutationId:++Sf(this,Kc)._,options:t.defaultMutationOptions(n),state:s});return this.add(r),r}add(t){re(this,da).add(t);const n=Pu(t);if(typeof n=="string"){const s=re(this,Er).get(n);s?s.push(t):re(this,Er).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(re(this,da).delete(t)){const n=Pu(t);if(typeof n=="string"){const s=re(this,Er).get(n);if(s)if(s.length>1){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}else s[0]===t&&re(this,Er).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=Pu(t);if(typeof n=="string"){const s=re(this,Er).get(n),r=s==null?void 0:s.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){var s;const n=Pu(t);if(typeof n=="string"){const r=(s=re(this,Er).get(n))==null?void 0:s.find(i=>i!==t&&i.state.isPaused);return(r==null?void 0:r.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Dn.batch(()=>{re(this,da).forEach(t=>{this.notify({type:"removed",mutation:t})}),re(this,da).clear(),re(this,Er).clear()})}getAll(){return Array.from(re(this,da))}find(t){const n={exact:!0,...t};return this.getAll().find(s=>J_(n,s))}findAll(t={}){return this.getAll().filter(n=>J_(t,n))}notify(t){Dn.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return Dn.batch(()=>Promise.all(t.map(n=>n.continue().catch(hs))))}},da=new WeakMap,Er=new WeakMap,Kc=new WeakMap,lC);function Pu(e){var t;return(t=e.options.scope)==null?void 0:t.id}var v1=(cC=class extends Ai{constructor(t,n){super();Ke(this,ha);Ke(this,ma);Ke(this,Qa);Ke(this,Os);Ke(this,fa);Re(this,ma,t),this.setOptions(n),this.bindMethods(),ft(this,ha,Ef).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const n=this.options;this.options=re(this,ma).defaultMutationOptions(t),$u(this.options,n)||re(this,ma).getMutationCache().notify({type:"observerOptionsUpdated",mutation:re(this,Os),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&jo(n.mutationKey)!==jo(this.options.mutationKey)?this.reset():((s=re(this,Os))==null?void 0:s.state.status)==="pending"&&re(this,Os).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=re(this,Os))==null||t.removeObserver(this)}onMutationUpdate(t){ft(this,ha,Ef).call(this),ft(this,ha,B_).call(this,t)}getCurrentResult(){return re(this,Qa)}reset(){var t;(t=re(this,Os))==null||t.removeObserver(this),Re(this,Os,void 0),ft(this,ha,Ef).call(this),ft(this,ha,B_).call(this)}mutate(t,n){var s;return Re(this,fa,n),(s=re(this,Os))==null||s.removeObserver(this),Re(this,Os,re(this,ma).getMutationCache().build(re(this,ma),this.options)),re(this,Os).addObserver(this),re(this,Os).execute(t)}},ma=new WeakMap,Qa=new WeakMap,Os=new WeakMap,fa=new WeakMap,ha=new WeakSet,Ef=function(){var n;const t=((n=re(this,Os))==null?void 0:n.state)??hy();Re(this,Qa,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},B_=function(t){Dn.batch(()=>{var n,s,r,i,l,u,d,f;if(re(this,fa)&&this.hasListeners()){const p=re(this,Qa).variables,m=re(this,Qa).context,h={client:re(this,ma),meta:this.options.meta,mutationKey:this.options.mutationKey};(t==null?void 0:t.type)==="success"?((s=(n=re(this,fa)).onSuccess)==null||s.call(n,t.data,p,m,h),(i=(r=re(this,fa)).onSettled)==null||i.call(r,t.data,null,p,m,h)):(t==null?void 0:t.type)==="error"&&((u=(l=re(this,fa)).onError)==null||u.call(l,t.error,p,m,h),(f=(d=re(this,fa)).onSettled)==null||f.call(d,void 0,t.error,p,m,h))}this.listeners.forEach(p=>{p(re(this,Qa))})})},cC),x1=(uC=class extends Ai{constructor(t={}){super();Ke(this,Hr);this.config=t,Re(this,Hr,new Map)}build(t,n,s){const r=n.queryKey,i=n.queryHash??$f(r,n);let l=this.get(i);return l||(l=new m1({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(n),state:s,defaultOptions:t.getQueryDefaults(r)}),this.add(l)),l}add(t){re(this,Hr).has(t.queryHash)||(re(this,Hr).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=re(this,Hr).get(t.queryHash);n&&(t.destroy(),n===t&&re(this,Hr).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Dn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return re(this,Hr).get(t)}getAll(){return[...re(this,Hr).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(s=>Z_(n,s))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(s=>Z_(t,s)):n}notify(t){Dn.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){Dn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Dn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Hr=new WeakMap,uC),b1=(dC=class{constructor(e={}){Ke(this,pn);Ke(this,Za);Ke(this,Ja);Ke(this,yl);Ke(this,vl);Ke(this,eo);Ke(this,xl);Ke(this,bl);Re(this,pn,e.queryCache||new x1),Re(this,Za,e.mutationCache||new y1),Re(this,Ja,e.defaultOptions||{}),Re(this,yl,new Map),Re(this,vl,new Map),Re(this,eo,0)}mount(){Sf(this,eo)._++,re(this,eo)===1&&(Re(this,xl,zf.subscribe(async e=>{e&&(await this.resumePausedMutations(),re(this,pn).onFocus())})),Re(this,bl,Tu.subscribe(async e=>{e&&(await this.resumePausedMutations(),re(this,pn).onOnline())})))}unmount(){var e,t;Sf(this,eo)._--,re(this,eo)===0&&((e=re(this,xl))==null||e.call(this),Re(this,xl,void 0),(t=re(this,bl))==null||t.call(this),Re(this,bl,void 0))}isFetching(e){return re(this,pn).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return re(this,Za).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=re(this,pn).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=re(this,pn).build(this,t),s=n.state.data;return s===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Oa(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return re(this,pn).findAll(e).map(({queryKey:t,state:n})=>{const s=n.data;return[t,s]})}setQueryData(e,t,n){const s=this.defaultQueryOptions({queryKey:e}),r=re(this,pn).get(s.queryHash),i=r==null?void 0:r.state.data,l=t1(t,i);if(l!==void 0)return re(this,pn).build(this,s).setData(l,{...n,manual:!0})}setQueriesData(e,t,n){return Dn.batch(()=>re(this,pn).findAll(e).map(({queryKey:s})=>[s,this.setQueryData(s,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=re(this,pn).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=re(this,pn);Dn.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=re(this,pn);return Dn.batch(()=>(n.findAll(e).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},s=Dn.batch(()=>re(this,pn).findAll(e).map(r=>r.cancel(n)));return Promise.all(s).then(hs).catch(hs)}invalidateQueries(e,t={}){return Dn.batch(()=>(re(this,pn).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},s=Dn.batch(()=>re(this,pn).findAll(e).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let i=r.fetch(void 0,n);return n.throwOnError||(i=i.catch(hs)),r.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(s).then(hs)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=re(this,pn).build(this,t);return n.isStaleByTime(Oa(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(hs).catch(hs)}fetchInfiniteQuery(e){return e.behavior=my(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(hs).catch(hs)}ensureInfiniteQueryData(e){return e.behavior=my(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Tu.isOnline()?re(this,Za).resumePausedMutations():Promise.resolve()}getQueryCache(){return re(this,pn)}getMutationCache(){return re(this,Za)}getDefaultOptions(){return re(this,Ja)}setDefaultOptions(e){Re(this,Ja,e)}setQueryDefaults(e,t){re(this,yl).set(jo(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...re(this,yl).values()],n={};return t.forEach(s=>{Vl(e,s.queryKey)&&Object.assign(n,s.defaultOptions)}),n}setMutationDefaults(e,t){re(this,vl).set(jo(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...re(this,vl).values()],n={};return t.forEach(s=>{Vl(e,s.mutationKey)&&Object.assign(n,s.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...re(this,Ja).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=$f(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Lf&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...re(this,Ja).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){re(this,pn).clear(),re(this,Za).clear()}},pn=new WeakMap,Za=new WeakMap,Ja=new WeakMap,yl=new WeakMap,vl=new WeakMap,eo=new WeakMap,xl=new WeakMap,bl=new WeakMap,dC),py=N.createContext(void 0),$a=e=>{const t=N.useContext(py);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},w1=({client:e,children:t})=>(N.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),a.jsx(py.Provider,{value:e,children:t})),gy=N.createContext(!1),N1=()=>N.useContext(gy);gy.Provider;function j1(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var C1=N.createContext(j1()),S1=()=>N.useContext(C1),E1=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},k1=e=>{N.useEffect(()=>{e.clearReset()},[e])},M1=({result:e,errorResetBoundary:t,throwOnError:n,query:s,suspense:r})=>e.isError&&!t.isReset()&&!e.isFetching&&s&&(r&&e.data===void 0||ry(n,[e.error,s])),A1=e=>{if(e.suspense){const n=r=>r==="static"?r:Math.max(r??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...r)=>n(s(...r)):n(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},O1=(e,t)=>e.isLoading&&e.isFetching&&!t,$1=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,_y=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function T1(e,t,n){var m,h,_,x,y;const s=N1(),r=S1(),i=$a(),l=i.defaultQueryOptions(e);(h=(m=i.getDefaultOptions().queries)==null?void 0:m._experimental_beforeQuery)==null||h.call(m,l),l._optimisticResults=s?"isRestoring":"optimistic",A1(l),E1(l,r),k1(r);const u=!i.getQueryCache().get(l.queryHash),[d]=N.useState(()=>new t(i,l)),f=d.getOptimisticResult(l),p=!s&&e.subscribed!==!1;if(N.useSyncExternalStore(N.useCallback(v=>{const w=p?d.subscribe(Dn.batchCalls(v)):hs;return d.updateResult(),w},[d,p]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),N.useEffect(()=>{d.setOptions(l)},[l,d]),$1(l,f))throw _y(l,d,r);if(M1({result:f,errorResetBoundary:r,throwOnError:l.throwOnError,query:i.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;if((x=(_=i.getDefaultOptions().queries)==null?void 0:_._experimental_afterQuery)==null||x.call(_,l,f),l.experimental_prefetchInRender&&!No&&O1(f,s)){const v=u?_y(l,d,r):(y=i.getQueryCache().get(l.queryHash))==null?void 0:y.promise;v==null||v.catch(hs).finally(()=>{d.updateResult()})}return l.notifyOnChangeProps?f:d.trackResult(f)}function Es(e,t){return T1(e,f1)}function Oi(e,t){const n=$a(),[s]=N.useState(()=>new v1(n,e));N.useEffect(()=>{s.setOptions(e)},[s,e]);const r=N.useSyncExternalStore(N.useCallback(l=>s.subscribe(Dn.batchCalls(l)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),i=N.useCallback((l,u)=>{s.mutate(l,u).catch(hs)},[s]);if(r.error&&ry(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:i,mutateAsync:r.mutate}}function P1(e){let t;const n=new Set,s=(f,p)=>{const m=typeof f=="function"?f(t):f;if(m!==t){const h=t;t=p?m:Object.assign({},t,m),n.forEach(_=>_(t,h))}},r=()=>t,i=(f,p=r,m=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let h=p(t);function _(){const x=p(t);if(!m(h,x)){const y=h;f(h=x,y)}}return n.add(_),()=>n.delete(_)},d={setState:s,getState:r,subscribe:(f,p,m)=>p||m?i(f,p,m):(n.add(f),()=>n.delete(f)),destroy:()=>n.clear()};return t=e(s,r,d),d}const yy=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?N.useEffect:N.useLayoutEffect;function L1(e){const t=typeof e=="function"?P1(e):e,n=(s=t.getState,r=Object.is)=>{const[,i]=N.useReducer(v=>v+1,0),l=t.getState(),u=N.useRef(l),d=N.useRef(s),f=N.useRef(r),p=N.useRef(!1),m=N.useRef();m.current===void 0&&(m.current=s(l));let h,_=!1;(u.current!==l||d.current!==s||f.current!==r||p.current)&&(h=s(l),_=!r(m.current,h)),yy(()=>{_&&(m.current=h),u.current=l,d.current=s,f.current=r,p.current=!1});const x=N.useRef(l);yy(()=>{const v=()=>{try{const k=t.getState(),j=d.current(k);f.current(m.current,j)||(u.current=k,m.current=j,i())}catch{p.current=!0,i()}},w=t.subscribe(v);return t.getState()!==x.current&&v(),w},[]);const y=_?h:m.current;return N.useDebugValue(y),y};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[n,t];return{next(){const r=s.length<=0;return{value:s.shift(),done:r}}}},n}function z1(){const e=N.createContext(void 0);return{Provider:({initialStore:r,createStore:i,children:l})=>{const u=N.useRef();return u.current||(r&&(console.warn("Provider initialStore is deprecated and will be removed in the next version."),i||(i=()=>r)),u.current=i()),N.createElement(e.Provider,{value:u.current},l)},useStore:(r,i=Object.is)=>{const l=N.useContext(e);if(!l)throw new Error("Seems like you have not used zustand provider as an ancestor.");return l(r,i)},useStoreApi:()=>{const r=N.useContext(e);if(!r)throw new Error("Seems like you have not used zustand provider as an ancestor.");return N.useMemo(()=>({getState:r.getState,setState:r.setState,subscribe:r.subscribe,destroy:r.destroy}),[r])}}}var R1={value:()=>{}};function Lu(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new zu(n)}function zu(e){this._=e}function D1(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",r=n.indexOf(".");if(r>=0&&(s=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}zu.prototype=Lu.prototype={constructor:zu,on:function(e,t){var n=this._,s=D1(e+"",n),r,i=-1,l=s.length;if(arguments.length<2){for(;++i<l;)if((r=(e=s[i]).type)&&(r=I1(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<l;)if(r=(e=s[i]).type)n[r]=vy(n[r],e.name,t);else if(t==null)for(r in n)n[r]=vy(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new zu(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),s=0,r,i;s<r;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],s=0,r=i.length;s<r;++s)i[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)}};function I1(e,t){for(var n=0,s=e.length,r;n<s;++n)if((r=e[n]).name===t)return r.value}function vy(e,t,n){for(var s=0,r=e.length;s<r;++s)if(e[s].name===t){e[s]=R1,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var Bf="http://www.w3.org/1999/xhtml";const xy={svg:"http://www.w3.org/2000/svg",xhtml:Bf,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ru(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),xy.hasOwnProperty(t)?{space:xy[t],local:e}:e}function F1(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Bf&&t.documentElement.namespaceURI===Bf?t.createElement(e):t.createElementNS(n,e)}}function B1(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function by(e){var t=Ru(e);return(t.local?B1:F1)(t)}function U1(){}function Uf(e){return e==null?U1:function(){return this.querySelector(e)}}function H1(e){typeof e!="function"&&(e=Uf(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],l=i.length,u=s[r]=new Array(l),d,f,p=0;p<l;++p)(d=i[p])&&(f=e.call(d,d.__data__,p,i))&&("__data__"in d&&(f.__data__=d.__data__),u[p]=f);return new qs(s,this._parents)}function q1(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function V1(){return[]}function wy(e){return e==null?V1:function(){return this.querySelectorAll(e)}}function W1(e){return function(){return q1(e.apply(this,arguments))}}function Y1(e){typeof e=="function"?e=W1(e):e=wy(e);for(var t=this._groups,n=t.length,s=[],r=[],i=0;i<n;++i)for(var l=t[i],u=l.length,d,f=0;f<u;++f)(d=l[f])&&(s.push(e.call(d,d.__data__,f,l)),r.push(d));return new qs(s,r)}function Ny(e){return function(){return this.matches(e)}}function jy(e){return function(t){return t.matches(e)}}var K1=Array.prototype.find;function G1(e){return function(){return K1.call(this.children,e)}}function X1(){return this.firstElementChild}function Q1(e){return this.select(e==null?X1:G1(typeof e=="function"?e:jy(e)))}var Z1=Array.prototype.filter;function J1(){return Array.from(this.children)}function eE(e){return function(){return Z1.call(this.children,e)}}function tE(e){return this.selectAll(e==null?J1:eE(typeof e=="function"?e:jy(e)))}function nE(e){typeof e!="function"&&(e=Ny(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],l=i.length,u=s[r]=[],d,f=0;f<l;++f)(d=i[f])&&e.call(d,d.__data__,f,i)&&u.push(d);return new qs(s,this._parents)}function Cy(e){return new Array(e.length)}function sE(){return new qs(this._enter||this._groups.map(Cy),this._parents)}function Du(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Du.prototype={constructor:Du,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function rE(e){return function(){return e}}function aE(e,t,n,s,r,i){for(var l=0,u,d=t.length,f=i.length;l<f;++l)(u=t[l])?(u.__data__=i[l],s[l]=u):n[l]=new Du(e,i[l]);for(;l<d;++l)(u=t[l])&&(r[l]=u)}function oE(e,t,n,s,r,i,l){var u,d,f=new Map,p=t.length,m=i.length,h=new Array(p),_;for(u=0;u<p;++u)(d=t[u])&&(h[u]=_=l.call(d,d.__data__,u,t)+"",f.has(_)?r[u]=d:f.set(_,d));for(u=0;u<m;++u)_=l.call(e,i[u],u,i)+"",(d=f.get(_))?(s[u]=d,d.__data__=i[u],f.delete(_)):n[u]=new Du(e,i[u]);for(u=0;u<p;++u)(d=t[u])&&f.get(h[u])===d&&(r[u]=d)}function iE(e){return e.__data__}function lE(e,t){if(!arguments.length)return Array.from(this,iE);var n=t?oE:aE,s=this._parents,r=this._groups;typeof e!="function"&&(e=rE(e));for(var i=r.length,l=new Array(i),u=new Array(i),d=new Array(i),f=0;f<i;++f){var p=s[f],m=r[f],h=m.length,_=cE(e.call(p,p&&p.__data__,f,s)),x=_.length,y=u[f]=new Array(x),v=l[f]=new Array(x),w=d[f]=new Array(h);n(p,m,y,v,w,_,t);for(var k=0,j=0,b,S;k<x;++k)if(b=y[k]){for(k>=j&&(j=k+1);!(S=v[j])&&++j<x;);b._next=S||null}}return l=new qs(l,s),l._enter=u,l._exit=d,l}function cE(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function uE(){return new qs(this._exit||this._groups.map(Cy),this._parents)}function dE(e,t,n){var s=this.enter(),r=this,i=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?i.remove():n(i),s&&r?s.merge(r).order():r}function mE(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,r=n.length,i=s.length,l=Math.min(r,i),u=new Array(r),d=0;d<l;++d)for(var f=n[d],p=s[d],m=f.length,h=u[d]=new Array(m),_,x=0;x<m;++x)(_=f[x]||p[x])&&(h[x]=_);for(;d<r;++d)u[d]=n[d];return new qs(u,this._parents)}function fE(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],r=s.length-1,i=s[r],l;--r>=0;)(l=s[r])&&(i&&l.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(l,i),i=l);return this}function hE(e){e||(e=pE);function t(m,h){return m&&h?e(m.__data__,h.__data__):!m-!h}for(var n=this._groups,s=n.length,r=new Array(s),i=0;i<s;++i){for(var l=n[i],u=l.length,d=r[i]=new Array(u),f,p=0;p<u;++p)(f=l[p])&&(d[p]=f);d.sort(t)}return new qs(r,this._parents).order()}function pE(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function gE(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function _E(){return Array.from(this)}function yE(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length;r<i;++r){var l=s[r];if(l)return l}return null}function vE(){let e=0;for(const t of this)++e;return e}function xE(){return!this.node()}function bE(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var r=t[n],i=0,l=r.length,u;i<l;++i)(u=r[i])&&e.call(u,u.__data__,i,r);return this}function wE(e){return function(){this.removeAttribute(e)}}function NE(e){return function(){this.removeAttributeNS(e.space,e.local)}}function jE(e,t){return function(){this.setAttribute(e,t)}}function CE(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function SE(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function EE(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function kE(e,t){var n=Ru(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?NE:wE:typeof t=="function"?n.local?EE:SE:n.local?CE:jE)(n,t))}function Sy(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ME(e){return function(){this.style.removeProperty(e)}}function AE(e,t,n){return function(){this.style.setProperty(e,t,n)}}function OE(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function $E(e,t,n){return arguments.length>1?this.each((t==null?ME:typeof t=="function"?OE:AE)(e,t,n??"")):$i(this.node(),e)}function $i(e,t){return e.style.getPropertyValue(t)||Sy(e).getComputedStyle(e,null).getPropertyValue(t)}function TE(e){return function(){delete this[e]}}function PE(e,t){return function(){this[e]=t}}function LE(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function zE(e,t){return arguments.length>1?this.each((t==null?TE:typeof t=="function"?LE:PE)(e,t)):this.node()[e]}function Ey(e){return e.trim().split(/^|\s+/)}function Hf(e){return e.classList||new ky(e)}function ky(e){this._node=e,this._names=Ey(e.getAttribute("class")||"")}ky.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function My(e,t){for(var n=Hf(e),s=-1,r=t.length;++s<r;)n.add(t[s])}function Ay(e,t){for(var n=Hf(e),s=-1,r=t.length;++s<r;)n.remove(t[s])}function RE(e){return function(){My(this,e)}}function DE(e){return function(){Ay(this,e)}}function IE(e,t){return function(){(t.apply(this,arguments)?My:Ay)(this,e)}}function FE(e,t){var n=Ey(e+"");if(arguments.length<2){for(var s=Hf(this.node()),r=-1,i=n.length;++r<i;)if(!s.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?IE:t?RE:DE)(n,t))}function BE(){this.textContent=""}function UE(e){return function(){this.textContent=e}}function HE(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function qE(e){return arguments.length?this.each(e==null?BE:(typeof e=="function"?HE:UE)(e)):this.node().textContent}function VE(){this.innerHTML=""}function WE(e){return function(){this.innerHTML=e}}function YE(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function KE(e){return arguments.length?this.each(e==null?VE:(typeof e=="function"?YE:WE)(e)):this.node().innerHTML}function GE(){this.nextSibling&&this.parentNode.appendChild(this)}function XE(){return this.each(GE)}function QE(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ZE(){return this.each(QE)}function JE(e){var t=typeof e=="function"?e:by(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function ek(){return null}function tk(e,t){var n=typeof e=="function"?e:by(e),s=t==null?ek:typeof t=="function"?t:Uf(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function nk(){var e=this.parentNode;e&&e.removeChild(this)}function sk(){return this.each(nk)}function rk(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ak(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ok(e){return this.select(e?ak:rk)}function ik(e){return arguments.length?this.property("__data__",e):this.node().__data__}function lk(e){return function(t){e.call(this,t,this.__data__)}}function ck(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function uk(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++s]=i;++s?t.length=s:delete this.__on}}}function dk(e,t,n){return function(){var s=this.__on,r,i=lk(t);if(s){for(var l=0,u=s.length;l<u;++l)if((r=s[l]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},s?s.push(r):this.__on=[r]}}function mk(e,t,n){var s=ck(e+""),r,i=s.length,l;if(arguments.length<2){var u=this.node().__on;if(u){for(var d=0,f=u.length,p;d<f;++d)for(r=0,p=u[d];r<i;++r)if((l=s[r]).type===p.type&&l.name===p.name)return p.value}return}for(u=t?dk:uk,r=0;r<i;++r)this.each(u(s[r],t,n));return this}function Oy(e,t,n){var s=Sy(e),r=s.CustomEvent;typeof r=="function"?r=new r(t,n):(r=s.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function fk(e,t){return function(){return Oy(this,e,t)}}function hk(e,t){return function(){return Oy(this,e,t.apply(this,arguments))}}function pk(e,t){return this.each((typeof t=="function"?hk:fk)(e,t))}function*gk(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length,l;r<i;++r)(l=s[r])&&(yield l)}var $y=[null];function qs(e,t){this._groups=e,this._parents=t}function Wl(){return new qs([[document.documentElement]],$y)}function _k(){return this}qs.prototype=Wl.prototype={constructor:qs,select:H1,selectAll:Y1,selectChild:Q1,selectChildren:tE,filter:nE,data:lE,enter:sE,exit:uE,join:dE,merge:mE,selection:_k,order:fE,sort:hE,call:gE,nodes:_E,node:yE,size:vE,empty:xE,each:bE,attr:kE,style:$E,property:zE,classed:FE,text:qE,html:KE,raise:XE,lower:ZE,append:JE,insert:tk,remove:sk,clone:ok,datum:ik,on:mk,dispatch:pk,[Symbol.iterator]:gk};function ps(e){return typeof e=="string"?new qs([[document.querySelector(e)]],[document.documentElement]):new qs([[e]],$y)}function yk(e){let t;for(;t=e.sourceEvent;)e=t;return e}function cr(e,t){if(e=yk(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const vk={passive:!1},Yl={capture:!0,passive:!1};function qf(e){e.stopImmediatePropagation()}function Ti(e){e.preventDefault(),e.stopImmediatePropagation()}function Ty(e){var t=e.document.documentElement,n=ps(e).on("dragstart.drag",Ti,Yl);"onselectstart"in t?n.on("selectstart.drag",Ti,Yl):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Py(e,t){var n=e.document.documentElement,s=ps(e).on("dragstart.drag",null);t&&(s.on("click.drag",Ti,Yl),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Iu=e=>()=>e;function Vf(e,{sourceEvent:t,subject:n,target:s,identifier:r,active:i,x:l,y:u,dx:d,dy:f,dispatch:p}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:l,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:d,enumerable:!0,configurable:!0},dy:{value:f,enumerable:!0,configurable:!0},_:{value:p}})}Vf.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function xk(e){return!e.ctrlKey&&!e.button}function bk(){return this.parentNode}function wk(e,t){return t??{x:e.x,y:e.y}}function Nk(){return navigator.maxTouchPoints||"ontouchstart"in this}function Wf(){var e=xk,t=bk,n=wk,s=Nk,r={},i=Lu("start","drag","end"),l=0,u,d,f,p,m=0;function h(b){b.on("mousedown.drag",_).filter(s).on("touchstart.drag",v).on("touchmove.drag",w,vk).on("touchend.drag touchcancel.drag",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(b,S){if(!(p||!e.call(this,b,S))){var E=j(this,t.call(this,b,S),b,S,"mouse");E&&(ps(b.view).on("mousemove.drag",x,Yl).on("mouseup.drag",y,Yl),Ty(b.view),qf(b),f=!1,u=b.clientX,d=b.clientY,E("start",b))}}function x(b){if(Ti(b),!f){var S=b.clientX-u,E=b.clientY-d;f=S*S+E*E>m}r.mouse("drag",b)}function y(b){ps(b.view).on("mousemove.drag mouseup.drag",null),Py(b.view,f),Ti(b),r.mouse("end",b)}function v(b,S){if(e.call(this,b,S)){var E=b.changedTouches,M=t.call(this,b,S),O=E.length,$,P;for($=0;$<O;++$)(P=j(this,M,b,S,E[$].identifier,E[$]))&&(qf(b),P("start",b,E[$]))}}function w(b){var S=b.changedTouches,E=S.length,M,O;for(M=0;M<E;++M)(O=r[S[M].identifier])&&(Ti(b),O("drag",b,S[M]))}function k(b){var S=b.changedTouches,E=S.length,M,O;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),M=0;M<E;++M)(O=r[S[M].identifier])&&(qf(b),O("end",b,S[M]))}function j(b,S,E,M,O,$){var P=i.copy(),A=cr($||E,S),R,F,z;if((z=n.call(b,new Vf("beforestart",{sourceEvent:E,target:h,identifier:O,active:l,x:A[0],y:A[1],dx:0,dy:0,dispatch:P}),M))!=null)return R=z.x-A[0]||0,F=z.y-A[1]||0,function I(U,q,H){var W=A,B;switch(U){case"start":r[O]=I,B=l++;break;case"end":delete r[O],--l;case"drag":A=cr(H||q,S),B=l;break}P.call(U,b,new Vf(U,{sourceEvent:q,subject:z,target:h,identifier:O,active:B,x:A[0]+R,y:A[1]+F,dx:A[0]-W[0],dy:A[1]-W[1],dispatch:P}),M)}}return h.filter=function(b){return arguments.length?(e=typeof b=="function"?b:Iu(!!b),h):e},h.container=function(b){return arguments.length?(t=typeof b=="function"?b:Iu(b),h):t},h.subject=function(b){return arguments.length?(n=typeof b=="function"?b:Iu(b),h):n},h.touchable=function(b){return arguments.length?(s=typeof b=="function"?b:Iu(!!b),h):s},h.on=function(){var b=i.on.apply(i,arguments);return b===i?h:b},h.clickDistance=function(b){return arguments.length?(m=(b=+b)*b,h):Math.sqrt(m)},h}function Yf(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ly(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function Kl(){}var Gl=.7,Fu=1/Gl,Pi="\\s*([+-]?\\d+)\\s*",Xl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jk=/^#([0-9a-f]{3,8})$/,Ck=new RegExp(`^rgb\\(${Pi},${Pi},${Pi}\\)$`),Sk=new RegExp(`^rgb\\(${zr},${zr},${zr}\\)$`),Ek=new RegExp(`^rgba\\(${Pi},${Pi},${Pi},${Xl}\\)$`),kk=new RegExp(`^rgba\\(${zr},${zr},${zr},${Xl}\\)$`),Mk=new RegExp(`^hsl\\(${Xl},${zr},${zr}\\)$`),Ak=new RegExp(`^hsla\\(${Xl},${zr},${zr},${Xl}\\)$`),zy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Yf(Kl,Co,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Ry,formatHex:Ry,formatHex8:Ok,formatHsl:$k,formatRgb:Dy,toString:Dy});function Ry(){return this.rgb().formatHex()}function Ok(){return this.rgb().formatHex8()}function $k(){return Hy(this).formatHsl()}function Dy(){return this.rgb().formatRgb()}function Co(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=jk.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Iy(t):n===3?new ks(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Bu(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Bu(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ck.exec(e))?new ks(t[1],t[2],t[3],1):(t=Sk.exec(e))?new ks(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ek.exec(e))?Bu(t[1],t[2],t[3],t[4]):(t=kk.exec(e))?Bu(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Mk.exec(e))?Uy(t[1],t[2]/100,t[3]/100,1):(t=Ak.exec(e))?Uy(t[1],t[2]/100,t[3]/100,t[4]):zy.hasOwnProperty(e)?Iy(zy[e]):e==="transparent"?new ks(NaN,NaN,NaN,0):null}function Iy(e){return new ks(e>>16&255,e>>8&255,e&255,1)}function Bu(e,t,n,s){return s<=0&&(e=t=n=NaN),new ks(e,t,n,s)}function Tk(e){return e instanceof Kl||(e=Co(e)),e?(e=e.rgb(),new ks(e.r,e.g,e.b,e.opacity)):new ks}function Kf(e,t,n,s){return arguments.length===1?Tk(e):new ks(e,t,n,s??1)}function ks(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}Yf(ks,Kf,Ly(Kl,{brighter(e){return e=e==null?Fu:Math.pow(Fu,e),new ks(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Gl:Math.pow(Gl,e),new ks(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ks(So(this.r),So(this.g),So(this.b),Uu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Fy,formatHex:Fy,formatHex8:Pk,formatRgb:By,toString:By}));function Fy(){return`#${Eo(this.r)}${Eo(this.g)}${Eo(this.b)}`}function Pk(){return`#${Eo(this.r)}${Eo(this.g)}${Eo(this.b)}${Eo((isNaN(this.opacity)?1:this.opacity)*255)}`}function By(){const e=Uu(this.opacity);return`${e===1?"rgb(":"rgba("}${So(this.r)}, ${So(this.g)}, ${So(this.b)}${e===1?")":`, ${e})`}`}function Uu(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function So(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Eo(e){return e=So(e),(e<16?"0":"")+e.toString(16)}function Uy(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new xr(e,t,n,s)}function Hy(e){if(e instanceof xr)return new xr(e.h,e.s,e.l,e.opacity);if(e instanceof Kl||(e=Co(e)),!e)return new xr;if(e instanceof xr)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,r=Math.min(t,n,s),i=Math.max(t,n,s),l=NaN,u=i-r,d=(i+r)/2;return u?(t===i?l=(n-s)/u+(n<s)*6:n===i?l=(s-t)/u+2:l=(t-n)/u+4,u/=d<.5?i+r:2-i-r,l*=60):u=d>0&&d<1?0:l,new xr(l,u,d,e.opacity)}function Lk(e,t,n,s){return arguments.length===1?Hy(e):new xr(e,t,n,s??1)}function xr(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}Yf(xr,Lk,Ly(Kl,{brighter(e){return e=e==null?Fu:Math.pow(Fu,e),new xr(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Gl:Math.pow(Gl,e),new xr(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,r=2*n-s;return new ks(Gf(e>=240?e-240:e+120,r,s),Gf(e,r,s),Gf(e<120?e+240:e-120,r,s),this.opacity)},clamp(){return new xr(qy(this.h),Hu(this.s),Hu(this.l),Uu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Uu(this.opacity);return`${e===1?"hsl(":"hsla("}${qy(this.h)}, ${Hu(this.s)*100}%, ${Hu(this.l)*100}%${e===1?")":`, ${e})`}`}}));function qy(e){return e=(e||0)%360,e<0?e+360:e}function Hu(e){return Math.max(0,Math.min(1,e||0))}function Gf(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Xf=e=>()=>e;function zk(e,t){return function(n){return e+n*t}}function Rk(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function Dk(e){return(e=+e)==1?Vy:function(t,n){return n-t?Rk(t,n,e):Xf(isNaN(t)?n:t)}}function Vy(e,t){var n=t-e;return n?zk(e,n):Xf(isNaN(e)?t:e)}const qu=function e(t){var n=Dk(t);function s(r,i){var l=n((r=Kf(r)).r,(i=Kf(i)).r),u=n(r.g,i.g),d=n(r.b,i.b),f=Vy(r.opacity,i.opacity);return function(p){return r.r=l(p),r.g=u(p),r.b=d(p),r.opacity=f(p),r+""}}return s.gamma=e,s}(1);function Ik(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),r;return function(i){for(r=0;r<n;++r)s[r]=e[r]*(1-i)+t[r]*i;return s}}function Fk(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Bk(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,r=new Array(s),i=new Array(n),l;for(l=0;l<s;++l)r[l]=Ql(e[l],t[l]);for(;l<n;++l)i[l]=t[l];return function(u){for(l=0;l<s;++l)i[l]=r[l](u);return i}}function Uk(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function Rr(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Hk(e,t){var n={},s={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ql(e[r],t[r]):s[r]=t[r];return function(i){for(r in n)s[r]=n[r](i);return s}}var Qf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Zf=new RegExp(Qf.source,"g");function qk(e){return function(){return e}}function Vk(e){return function(t){return e(t)+""}}function Wy(e,t){var n=Qf.lastIndex=Zf.lastIndex=0,s,r,i,l=-1,u=[],d=[];for(e=e+"",t=t+"";(s=Qf.exec(e))&&(r=Zf.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),u[l]?u[l]+=i:u[++l]=i),(s=s[0])===(r=r[0])?u[l]?u[l]+=r:u[++l]=r:(u[++l]=null,d.push({i:l,x:Rr(s,r)})),n=Zf.lastIndex;return n<t.length&&(i=t.slice(n),u[l]?u[l]+=i:u[++l]=i),u.length<2?d[0]?Vk(d[0].x):qk(t):(t=d.length,function(f){for(var p=0,m;p<t;++p)u[(m=d[p]).i]=m.x(f);return u.join("")})}function Ql(e,t){var n=typeof t,s;return t==null||n==="boolean"?Xf(t):(n==="number"?Rr:n==="string"?(s=Co(t))?(t=s,qu):Wy:t instanceof Co?qu:t instanceof Date?Uk:Fk(t)?Ik:Array.isArray(t)?Bk:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Hk:Rr)(e,t)}var Yy=180/Math.PI,Jf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ky(e,t,n,s,r,i){var l,u,d;return(l=Math.sqrt(e*e+t*t))&&(e/=l,t/=l),(d=e*n+t*s)&&(n-=e*d,s-=t*d),(u=Math.sqrt(n*n+s*s))&&(n/=u,s/=u,d/=u),e*s<t*n&&(e=-e,t=-t,d=-d,l=-l),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Yy,skewX:Math.atan(d)*Yy,scaleX:l,scaleY:u}}var Vu;function Wk(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Jf:Ky(t.a,t.b,t.c,t.d,t.e,t.f)}function Yk(e){return e==null||(Vu||(Vu=document.createElementNS("http://www.w3.org/2000/svg","g")),Vu.setAttribute("transform",e),!(e=Vu.transform.baseVal.consolidate()))?Jf:(e=e.matrix,Ky(e.a,e.b,e.c,e.d,e.e,e.f))}function Gy(e,t,n,s){function r(f){return f.length?f.pop()+" ":""}function i(f,p,m,h,_,x){if(f!==m||p!==h){var y=_.push("translate(",null,t,null,n);x.push({i:y-4,x:Rr(f,m)},{i:y-2,x:Rr(p,h)})}else(m||h)&&_.push("translate("+m+t+h+n)}function l(f,p,m,h){f!==p?(f-p>180?p+=360:p-f>180&&(f+=360),h.push({i:m.push(r(m)+"rotate(",null,s)-2,x:Rr(f,p)})):p&&m.push(r(m)+"rotate("+p+s)}function u(f,p,m,h){f!==p?h.push({i:m.push(r(m)+"skewX(",null,s)-2,x:Rr(f,p)}):p&&m.push(r(m)+"skewX("+p+s)}function d(f,p,m,h,_,x){if(f!==m||p!==h){var y=_.push(r(_)+"scale(",null,",",null,")");x.push({i:y-4,x:Rr(f,m)},{i:y-2,x:Rr(p,h)})}else(m!==1||h!==1)&&_.push(r(_)+"scale("+m+","+h+")")}return function(f,p){var m=[],h=[];return f=e(f),p=e(p),i(f.translateX,f.translateY,p.translateX,p.translateY,m,h),l(f.rotate,p.rotate,m,h),u(f.skewX,p.skewX,m,h),d(f.scaleX,f.scaleY,p.scaleX,p.scaleY,m,h),f=p=null,function(_){for(var x=-1,y=h.length,v;++x<y;)m[(v=h[x]).i]=v.x(_);return m.join("")}}}var Kk=Gy(Wk,"px, ","px)","deg)"),Gk=Gy(Yk,", ",")",")"),Xk=1e-12;function Xy(e){return((e=Math.exp(e))+1/e)/2}function Qk(e){return((e=Math.exp(e))-1/e)/2}function Zk(e){return((e=Math.exp(2*e))-1)/(e+1)}const Wu=function e(t,n,s){function r(i,l){var u=i[0],d=i[1],f=i[2],p=l[0],m=l[1],h=l[2],_=p-u,x=m-d,y=_*_+x*x,v,w;if(y<Xk)w=Math.log(h/f)/t,v=function(M){return[u+M*_,d+M*x,f*Math.exp(t*M*w)]};else{var k=Math.sqrt(y),j=(h*h-f*f+s*y)/(2*f*n*k),b=(h*h-f*f-s*y)/(2*h*n*k),S=Math.log(Math.sqrt(j*j+1)-j),E=Math.log(Math.sqrt(b*b+1)-b);w=(E-S)/t,v=function(M){var O=M*w,$=Xy(S),P=f/(n*k)*($*Zk(t*O+S)-Qk(S));return[u+P*_,d+P*x,f*$/Xy(t*O+S)]}}return v.duration=w*1e3*t/Math.SQRT2,v}return r.rho=function(i){var l=Math.max(.001,+i),u=l*l,d=u*u;return e(l,u,d)},r}(Math.SQRT2,2,4);var Li=0,Zl=0,Jl=0,Qy=1e3,Yu,ec,Ku=0,ko=0,Gu=0,tc=typeof performance=="object"&&performance.now?performance:Date,Zy=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function eh(){return ko||(Zy(Jk),ko=tc.now()+Gu)}function Jk(){ko=0}function Xu(){this._call=this._time=this._next=null}Xu.prototype=Jy.prototype={constructor:Xu,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?eh():+n)+(t==null?0:+t),!this._next&&ec!==this&&(ec?ec._next=this:Yu=this,ec=this),this._call=e,this._time=n,th()},stop:function(){this._call&&(this._call=null,this._time=1/0,th())}};function Jy(e,t,n){var s=new Xu;return s.restart(e,t,n),s}function eM(){eh(),++Li;for(var e=Yu,t;e;)(t=ko-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Li}function ev(){ko=(Ku=tc.now())+Gu,Li=Zl=0;try{eM()}finally{Li=0,nM(),ko=0}}function tM(){var e=tc.now(),t=e-Ku;t>Qy&&(Gu-=t,Ku=e)}function nM(){for(var e,t=Yu,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Yu=n);ec=e,th(s)}function th(e){if(!Li){Zl&&(Zl=clearTimeout(Zl));var t=e-ko;t>24?(e<1/0&&(Zl=setTimeout(ev,e-tc.now()-Gu)),Jl&&(Jl=clearInterval(Jl))):(Jl||(Ku=tc.now(),Jl=setInterval(tM,Qy)),Li=1,Zy(ev))}}function tv(e,t,n){var s=new Xu;return t=t==null?0:+t,s.restart(r=>{s.stop(),e(r+t)},t,n),s}var sM=Lu("start","end","cancel","interrupt"),rM=[],nv=0,sv=1,nh=2,Qu=3,rv=4,sh=5,Zu=6;function Ju(e,t,n,s,r,i){var l=e.__transition;if(!l)e.__transition={};else if(n in l)return;aM(e,n,{name:t,index:s,group:r,on:sM,tween:rM,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:nv})}function rh(e,t){var n=br(e,t);if(n.state>nv)throw new Error("too late; already scheduled");return n}function Dr(e,t){var n=br(e,t);if(n.state>Qu)throw new Error("too late; already running");return n}function br(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function aM(e,t,n){var s=e.__transition,r;s[t]=n,n.timer=Jy(i,0,n.time);function i(f){n.state=sv,n.timer.restart(l,n.delay,n.time),n.delay<=f&&l(f-n.delay)}function l(f){var p,m,h,_;if(n.state!==sv)return d();for(p in s)if(_=s[p],_.name===n.name){if(_.state===Qu)return tv(l);_.state===rv?(_.state=Zu,_.timer.stop(),_.on.call("interrupt",e,e.__data__,_.index,_.group),delete s[p]):+p<t&&(_.state=Zu,_.timer.stop(),_.on.call("cancel",e,e.__data__,_.index,_.group),delete s[p])}if(tv(function(){n.state===Qu&&(n.state=rv,n.timer.restart(u,n.delay,n.time),u(f))}),n.state=nh,n.on.call("start",e,e.__data__,n.index,n.group),n.state===nh){for(n.state=Qu,r=new Array(h=n.tween.length),p=0,m=-1;p<h;++p)(_=n.tween[p].value.call(e,e.__data__,n.index,n.group))&&(r[++m]=_);r.length=m+1}}function u(f){for(var p=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(d),n.state=sh,1),m=-1,h=r.length;++m<h;)r[m].call(e,p);n.state===sh&&(n.on.call("end",e,e.__data__,n.index,n.group),d())}function d(){n.state=Zu,n.timer.stop(),delete s[t];for(var f in s)return;delete e.__transition}}function ed(e,t){var n=e.__transition,s,r,i=!0,l;if(n){t=t==null?null:t+"";for(l in n){if((s=n[l]).name!==t){i=!1;continue}r=s.state>nh&&s.state<sh,s.state=Zu,s.timer.stop(),s.on.call(r?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[l]}i&&delete e.__transition}}function oM(e){return this.each(function(){ed(this,e)})}function iM(e,t){var n,s;return function(){var r=Dr(this,e),i=r.tween;if(i!==n){s=n=i;for(var l=0,u=s.length;l<u;++l)if(s[l].name===t){s=s.slice(),s.splice(l,1);break}}r.tween=s}}function lM(e,t,n){var s,r;if(typeof n!="function")throw new Error;return function(){var i=Dr(this,e),l=i.tween;if(l!==s){r=(s=l).slice();for(var u={name:t,value:n},d=0,f=r.length;d<f;++d)if(r[d].name===t){r[d]=u;break}d===f&&r.push(u)}i.tween=r}}function cM(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=br(this.node(),n).tween,r=0,i=s.length,l;r<i;++r)if((l=s[r]).name===e)return l.value;return null}return this.each((t==null?iM:lM)(n,e,t))}function ah(e,t,n){var s=e._id;return e.each(function(){var r=Dr(this,s);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return br(r,s).value[t]}}function av(e,t){var n;return(typeof t=="number"?Rr:t instanceof Co?qu:(n=Co(t))?(t=n,qu):Wy)(e,t)}function uM(e){return function(){this.removeAttribute(e)}}function dM(e){return function(){this.removeAttributeNS(e.space,e.local)}}function mM(e,t,n){var s,r=n+"",i;return function(){var l=this.getAttribute(e);return l===r?null:l===s?i:i=t(s=l,n)}}function fM(e,t,n){var s,r=n+"",i;return function(){var l=this.getAttributeNS(e.space,e.local);return l===r?null:l===s?i:i=t(s=l,n)}}function hM(e,t,n){var s,r,i;return function(){var l,u=n(this),d;return u==null?void this.removeAttribute(e):(l=this.getAttribute(e),d=u+"",l===d?null:l===s&&d===r?i:(r=d,i=t(s=l,u)))}}function pM(e,t,n){var s,r,i;return function(){var l,u=n(this),d;return u==null?void this.removeAttributeNS(e.space,e.local):(l=this.getAttributeNS(e.space,e.local),d=u+"",l===d?null:l===s&&d===r?i:(r=d,i=t(s=l,u)))}}function gM(e,t){var n=Ru(e),s=n==="transform"?Gk:av;return this.attrTween(e,typeof t=="function"?(n.local?pM:hM)(n,s,ah(this,"attr."+e,t)):t==null?(n.local?dM:uM)(n):(n.local?fM:mM)(n,s,t))}function _M(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function yM(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function vM(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&yM(e,i)),n}return r._value=t,r}function xM(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&_M(e,i)),n}return r._value=t,r}function bM(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=Ru(e);return this.tween(n,(s.local?vM:xM)(s,t))}function wM(e,t){return function(){rh(this,e).delay=+t.apply(this,arguments)}}function NM(e,t){return t=+t,function(){rh(this,e).delay=t}}function jM(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?wM:NM)(t,e)):br(this.node(),t).delay}function CM(e,t){return function(){Dr(this,e).duration=+t.apply(this,arguments)}}function SM(e,t){return t=+t,function(){Dr(this,e).duration=t}}function EM(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?CM:SM)(t,e)):br(this.node(),t).duration}function kM(e,t){if(typeof t!="function")throw new Error;return function(){Dr(this,e).ease=t}}function MM(e){var t=this._id;return arguments.length?this.each(kM(t,e)):br(this.node(),t).ease}function AM(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Dr(this,e).ease=n}}function OM(e){if(typeof e!="function")throw new Error;return this.each(AM(this._id,e))}function $M(e){typeof e!="function"&&(e=Ny(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],l=i.length,u=s[r]=[],d,f=0;f<l;++f)(d=i[f])&&e.call(d,d.__data__,f,i)&&u.push(d);return new ta(s,this._parents,this._name,this._id)}function TM(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,r=n.length,i=Math.min(s,r),l=new Array(s),u=0;u<i;++u)for(var d=t[u],f=n[u],p=d.length,m=l[u]=new Array(p),h,_=0;_<p;++_)(h=d[_]||f[_])&&(m[_]=h);for(;u<s;++u)l[u]=t[u];return new ta(l,this._parents,this._name,this._id)}function PM(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function LM(e,t,n){var s,r,i=PM(t)?rh:Dr;return function(){var l=i(this,e),u=l.on;u!==s&&(r=(s=u).copy()).on(t,n),l.on=r}}function zM(e,t){var n=this._id;return arguments.length<2?br(this.node(),n).on.on(e):this.each(LM(n,e,t))}function RM(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function DM(){return this.on("end.remove",RM(this._id))}function IM(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Uf(e));for(var s=this._groups,r=s.length,i=new Array(r),l=0;l<r;++l)for(var u=s[l],d=u.length,f=i[l]=new Array(d),p,m,h=0;h<d;++h)(p=u[h])&&(m=e.call(p,p.__data__,h,u))&&("__data__"in p&&(m.__data__=p.__data__),f[h]=m,Ju(f[h],t,n,h,f,br(p,n)));return new ta(i,this._parents,t,n)}function FM(e){var t=this._name,n=this._id;typeof e!="function"&&(e=wy(e));for(var s=this._groups,r=s.length,i=[],l=[],u=0;u<r;++u)for(var d=s[u],f=d.length,p,m=0;m<f;++m)if(p=d[m]){for(var h=e.call(p,p.__data__,m,d),_,x=br(p,n),y=0,v=h.length;y<v;++y)(_=h[y])&&Ju(_,t,n,y,h,x);i.push(h),l.push(p)}return new ta(i,l,t,n)}var BM=Wl.prototype.constructor;function UM(){return new BM(this._groups,this._parents)}function HM(e,t){var n,s,r;return function(){var i=$i(this,e),l=(this.style.removeProperty(e),$i(this,e));return i===l?null:i===n&&l===s?r:r=t(n=i,s=l)}}function ov(e){return function(){this.style.removeProperty(e)}}function qM(e,t,n){var s,r=n+"",i;return function(){var l=$i(this,e);return l===r?null:l===s?i:i=t(s=l,n)}}function VM(e,t,n){var s,r,i;return function(){var l=$i(this,e),u=n(this),d=u+"";return u==null&&(d=u=(this.style.removeProperty(e),$i(this,e))),l===d?null:l===s&&d===r?i:(r=d,i=t(s=l,u))}}function WM(e,t){var n,s,r,i="style."+t,l="end."+i,u;return function(){var d=Dr(this,e),f=d.on,p=d.value[i]==null?u||(u=ov(t)):void 0;(f!==n||r!==p)&&(s=(n=f).copy()).on(l,r=p),d.on=s}}function YM(e,t,n){var s=(e+="")=="transform"?Kk:av;return t==null?this.styleTween(e,HM(e,s)).on("end.style."+e,ov(e)):typeof t=="function"?this.styleTween(e,VM(e,s,ah(this,"style."+e,t))).each(WM(this._id,e)):this.styleTween(e,qM(e,s,t),n).on("end.style."+e,null)}function KM(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function GM(e,t,n){var s,r;function i(){var l=t.apply(this,arguments);return l!==r&&(s=(r=l)&&KM(e,l,n)),s}return i._value=t,i}function XM(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,GM(e,t,n??""))}function QM(e){return function(){this.textContent=e}}function ZM(e){return function(){var t=e(this);this.textContent=t??""}}function JM(e){return this.tween("text",typeof e=="function"?ZM(ah(this,"text",e)):QM(e==null?"":e+""))}function eA(e){return function(t){this.textContent=e.call(this,t)}}function tA(e){var t,n;function s(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&eA(r)),t}return s._value=e,s}function nA(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,tA(e))}function sA(){for(var e=this._name,t=this._id,n=iv(),s=this._groups,r=s.length,i=0;i<r;++i)for(var l=s[i],u=l.length,d,f=0;f<u;++f)if(d=l[f]){var p=br(d,t);Ju(d,e,n,f,l,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new ta(s,this._parents,e,n)}function rA(){var e,t,n=this,s=n._id,r=n.size();return new Promise(function(i,l){var u={value:l},d={value:function(){--r===0&&i()}};n.each(function(){var f=Dr(this,s),p=f.on;p!==e&&(t=(e=p).copy(),t._.cancel.push(u),t._.interrupt.push(u),t._.end.push(d)),f.on=t}),r===0&&i()})}var aA=0;function ta(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function iv(){return++aA}var na=Wl.prototype;ta.prototype={constructor:ta,select:IM,selectAll:FM,selectChild:na.selectChild,selectChildren:na.selectChildren,filter:$M,merge:TM,selection:UM,transition:sA,call:na.call,nodes:na.nodes,node:na.node,size:na.size,empty:na.empty,each:na.each,on:zM,attr:gM,attrTween:bM,style:YM,styleTween:XM,text:JM,textTween:nA,remove:DM,tween:cM,delay:jM,duration:EM,ease:MM,easeVarying:OM,end:rA,[Symbol.iterator]:na[Symbol.iterator]};function oA(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var iA={time:null,delay:0,duration:250,ease:oA};function lA(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function cA(e){var t,n;e instanceof ta?(t=e._id,e=e._name):(t=iv(),(n=iA).time=eh(),e=e==null?null:e+"");for(var s=this._groups,r=s.length,i=0;i<r;++i)for(var l=s[i],u=l.length,d,f=0;f<u;++f)(d=l[f])&&Ju(d,e,t,f,l,n||lA(d,t));return new ta(s,this._parents,e,t)}Wl.prototype.interrupt=oM,Wl.prototype.transition=cA;const td=e=>()=>e;function uA(e,{sourceEvent:t,target:n,transform:s,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:r}})}function sa(e,t,n){this.k=e,this.x=t,this.y=n}sa.prototype={constructor:sa,scale:function(e){return e===1?this:new sa(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new sa(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ra=new sa(1,0,0);lv.prototype=sa.prototype;function lv(e){for(;!e.__zoom;)if(!(e=e.parentNode))return ra;return e.__zoom}function oh(e){e.stopImmediatePropagation()}function nc(e){e.preventDefault(),e.stopImmediatePropagation()}function dA(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function mA(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function cv(){return this.__zoom||ra}function fA(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function hA(){return navigator.maxTouchPoints||"ontouchstart"in this}function pA(e,t,n){var s=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],l=e.invertY(t[1][1])-n[1][1];return e.translate(r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r),l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l))}function ih(){var e=dA,t=mA,n=pA,s=fA,r=hA,i=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,d=Wu,f=Lu("start","zoom","end"),p,m,h,_=500,x=150,y=0,v=10;function w(z){z.property("__zoom",cv).on("wheel.zoom",O,{passive:!1}).on("mousedown.zoom",$).on("dblclick.zoom",P).filter(r).on("touchstart.zoom",A).on("touchmove.zoom",R).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(z,I,U,q){var H=z.selection?z.selection():z;H.property("__zoom",cv),z!==H?S(z,I,U,q):H.interrupt().each(function(){E(this,arguments).event(q).start().zoom(null,typeof I=="function"?I.apply(this,arguments):I).end()})},w.scaleBy=function(z,I,U,q){w.scaleTo(z,function(){var H=this.__zoom.k,W=typeof I=="function"?I.apply(this,arguments):I;return H*W},U,q)},w.scaleTo=function(z,I,U,q){w.transform(z,function(){var H=t.apply(this,arguments),W=this.__zoom,B=U==null?b(H):typeof U=="function"?U.apply(this,arguments):U,D=W.invert(B),V=typeof I=="function"?I.apply(this,arguments):I;return n(j(k(W,V),B,D),H,l)},U,q)},w.translateBy=function(z,I,U,q){w.transform(z,function(){return n(this.__zoom.translate(typeof I=="function"?I.apply(this,arguments):I,typeof U=="function"?U.apply(this,arguments):U),t.apply(this,arguments),l)},null,q)},w.translateTo=function(z,I,U,q,H){w.transform(z,function(){var W=t.apply(this,arguments),B=this.__zoom,D=q==null?b(W):typeof q=="function"?q.apply(this,arguments):q;return n(ra.translate(D[0],D[1]).scale(B.k).translate(typeof I=="function"?-I.apply(this,arguments):-I,typeof U=="function"?-U.apply(this,arguments):-U),W,l)},q,H)};function k(z,I){return I=Math.max(i[0],Math.min(i[1],I)),I===z.k?z:new sa(I,z.x,z.y)}function j(z,I,U){var q=I[0]-U[0]*z.k,H=I[1]-U[1]*z.k;return q===z.x&&H===z.y?z:new sa(z.k,q,H)}function b(z){return[(+z[0][0]+ +z[1][0])/2,(+z[0][1]+ +z[1][1])/2]}function S(z,I,U,q){z.on("start.zoom",function(){E(this,arguments).event(q).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(q).end()}).tween("zoom",function(){var H=this,W=arguments,B=E(H,W).event(q),D=t.apply(H,W),V=U==null?b(D):typeof U=="function"?U.apply(H,W):U,te=Math.max(D[1][0]-D[0][0],D[1][1]-D[0][1]),G=H.__zoom,K=typeof I=="function"?I.apply(H,W):I,X=d(G.invert(V).concat(te/G.k),K.invert(V).concat(te/K.k));return function(Q){if(Q===1)Q=K;else{var J=X(Q),Z=te/J[2];Q=new sa(Z,V[0]-J[0]*Z,V[1]-J[1]*Z)}B.zoom(null,Q)}})}function E(z,I,U){return!U&&z.__zooming||new M(z,I)}function M(z,I){this.that=z,this.args=I,this.active=0,this.sourceEvent=null,this.extent=t.apply(z,I),this.taps=0}M.prototype={event:function(z){return z&&(this.sourceEvent=z),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(z,I){return this.mouse&&z!=="mouse"&&(this.mouse[1]=I.invert(this.mouse[0])),this.touch0&&z!=="touch"&&(this.touch0[1]=I.invert(this.touch0[0])),this.touch1&&z!=="touch"&&(this.touch1[1]=I.invert(this.touch1[0])),this.that.__zoom=I,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(z){var I=ps(this.that).datum();f.call(z,this.that,new uA(z,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:f}),I)}};function O(z,...I){if(!e.apply(this,arguments))return;var U=E(this,I).event(z),q=this.__zoom,H=Math.max(i[0],Math.min(i[1],q.k*Math.pow(2,s.apply(this,arguments)))),W=cr(z);if(U.wheel)(U.mouse[0][0]!==W[0]||U.mouse[0][1]!==W[1])&&(U.mouse[1]=q.invert(U.mouse[0]=W)),clearTimeout(U.wheel);else{if(q.k===H)return;U.mouse=[W,q.invert(W)],ed(this),U.start()}nc(z),U.wheel=setTimeout(B,x),U.zoom("mouse",n(j(k(q,H),U.mouse[0],U.mouse[1]),U.extent,l));function B(){U.wheel=null,U.end()}}function $(z,...I){if(h||!e.apply(this,arguments))return;var U=z.currentTarget,q=E(this,I,!0).event(z),H=ps(z.view).on("mousemove.zoom",V,!0).on("mouseup.zoom",te,!0),W=cr(z,U),B=z.clientX,D=z.clientY;Ty(z.view),oh(z),q.mouse=[W,this.__zoom.invert(W)],ed(this),q.start();function V(G){if(nc(G),!q.moved){var K=G.clientX-B,X=G.clientY-D;q.moved=K*K+X*X>y}q.event(G).zoom("mouse",n(j(q.that.__zoom,q.mouse[0]=cr(G,U),q.mouse[1]),q.extent,l))}function te(G){H.on("mousemove.zoom mouseup.zoom",null),Py(G.view,q.moved),nc(G),q.event(G).end()}}function P(z,...I){if(e.apply(this,arguments)){var U=this.__zoom,q=cr(z.changedTouches?z.changedTouches[0]:z,this),H=U.invert(q),W=U.k*(z.shiftKey?.5:2),B=n(j(k(U,W),q,H),t.apply(this,I),l);nc(z),u>0?ps(this).transition().duration(u).call(S,B,q,z):ps(this).call(w.transform,B,q,z)}}function A(z,...I){if(e.apply(this,arguments)){var U=z.touches,q=U.length,H=E(this,I,z.changedTouches.length===q).event(z),W,B,D,V;for(oh(z),B=0;B<q;++B)D=U[B],V=cr(D,this),V=[V,this.__zoom.invert(V),D.identifier],H.touch0?!H.touch1&&H.touch0[2]!==V[2]&&(H.touch1=V,H.taps=0):(H.touch0=V,W=!0,H.taps=1+!!p);p&&(p=clearTimeout(p)),W&&(H.taps<2&&(m=V[0],p=setTimeout(function(){p=null},_)),ed(this),H.start())}}function R(z,...I){if(this.__zooming){var U=E(this,I).event(z),q=z.changedTouches,H=q.length,W,B,D,V;for(nc(z),W=0;W<H;++W)B=q[W],D=cr(B,this),U.touch0&&U.touch0[2]===B.identifier?U.touch0[0]=D:U.touch1&&U.touch1[2]===B.identifier&&(U.touch1[0]=D);if(B=U.that.__zoom,U.touch1){var te=U.touch0[0],G=U.touch0[1],K=U.touch1[0],X=U.touch1[1],Q=(Q=K[0]-te[0])*Q+(Q=K[1]-te[1])*Q,J=(J=X[0]-G[0])*J+(J=X[1]-G[1])*J;B=k(B,Math.sqrt(Q/J)),D=[(te[0]+K[0])/2,(te[1]+K[1])/2],V=[(G[0]+X[0])/2,(G[1]+X[1])/2]}else if(U.touch0)D=U.touch0[0],V=U.touch0[1];else return;U.zoom("touch",n(j(B,D,V),U.extent,l))}}function F(z,...I){if(this.__zooming){var U=E(this,I).event(z),q=z.changedTouches,H=q.length,W,B;for(oh(z),h&&clearTimeout(h),h=setTimeout(function(){h=null},_),W=0;W<H;++W)B=q[W],U.touch0&&U.touch0[2]===B.identifier?delete U.touch0:U.touch1&&U.touch1[2]===B.identifier&&delete U.touch1;if(U.touch1&&!U.touch0&&(U.touch0=U.touch1,delete U.touch1),U.touch0)U.touch0[1]=this.__zoom.invert(U.touch0[0]);else if(U.end(),U.taps===2&&(B=cr(B,this),Math.hypot(m[0]-B[0],m[1]-B[1])<v)){var D=ps(this).on("dblclick.zoom");D&&D.apply(this,arguments)}}}return w.wheelDelta=function(z){return arguments.length?(s=typeof z=="function"?z:td(+z),w):s},w.filter=function(z){return arguments.length?(e=typeof z=="function"?z:td(!!z),w):e},w.touchable=function(z){return arguments.length?(r=typeof z=="function"?z:td(!!z),w):r},w.extent=function(z){return arguments.length?(t=typeof z=="function"?z:td([[+z[0][0],+z[0][1]],[+z[1][0],+z[1][1]]]),w):t},w.scaleExtent=function(z){return arguments.length?(i[0]=+z[0],i[1]=+z[1],w):[i[0],i[1]]},w.translateExtent=function(z){return arguments.length?(l[0][0]=+z[0][0],l[1][0]=+z[1][0],l[0][1]=+z[0][1],l[1][1]=+z[1][1],w):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},w.constrain=function(z){return arguments.length?(n=z,w):n},w.duration=function(z){return arguments.length?(u=+z,w):u},w.interpolate=function(z){return arguments.length?(d=z,w):d},w.on=function(){var z=f.on.apply(f,arguments);return z===f?w:z},w.clickDistance=function(z){return arguments.length?(y=(z=+z)*z,w):Math.sqrt(y)},w.tapDistance=function(z){return arguments.length?(v=+z,w):v},w}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lh(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function uv(e,t){if(e){if(typeof e=="string")return lh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lh(e,t)}}function gA(e){if(Array.isArray(e))return e}function _A(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],r=!0,i=!1,l,u;try{for(n=n.call(e);!(r=(l=n.next()).done)&&(s.push(l.value),!(t&&s.length===t));r=!0);}catch(d){i=!0,u=d}finally{try{!r&&n.return!=null&&n.return()}finally{if(i)throw u}}return s}}function yA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yt(e,t){return gA(e)||_A(e,t)||uv(e,t)||yA()}var Mo;(function(e){e.Strict="strict",e.Loose="loose"})(Mo||(Mo={}));var zi;(function(e){e.Lines="lines",e.Dots="dots"})(zi||(zi={}));var Ri;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Ri||(Ri={}));var Ta;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ta||(Ta={}));var nd;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(nd||(nd={}));var Le;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Le||(Le={}));var ch=function(t){return{width:t.offsetWidth,height:t.offsetHeight}},Di=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(Math.max(t,n),s)},dv=function(t,n){return{x:Di(t.x,n[0][0],n[1][0]),y:Di(t.y,n[0][1],n[1][1])}},mv=function(t){var n,s;return((n=t.getRootNode)===null||n===void 0?void 0:n.call(t))||((s=window)===null||s===void 0?void 0:s.document)},vA=function(t,n){return{x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x2,n.x2),y2:Math.max(t.y2,n.y2)}},sd=function(t){var n=t.x,s=t.y,r=t.width,i=t.height;return{x:n,y:s,x2:n+r,y2:s+i}},xA=function(t){var n=t.x,s=t.y,r=t.x2,i=t.y2;return{x:n,y:s,width:r-n,height:i-s}},fv=function(t){return!isNaN(t)&&isFinite(t)},Qn=Symbol("internals");function hv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function sc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function pv(e,t){var n=e.find(function(f){return f.id===t.parentNode});if(n){var s=t.position.x+t.width-n.width,r=t.position.y+t.height-n.height;if(s>0||r>0||t.position.x<0||t.position.y<0){var i,l;if(n.style=sc({},n.style)||{},n.style.width=(i=n.style.width)!==null&&i!==void 0?i:n.width,n.style.height=(l=n.style.height)!==null&&l!==void 0?l:n.height,s>0&&(n.style.width+=s),r>0&&(n.style.height+=r),t.position.x<0){var u=Math.abs(t.position.x);n.position.x=n.position.x-u,n.style.width+=u,t.position.x=0}if(t.position.y<0){var d=Math.abs(t.position.y);n.position.y=n.position.y-d,n.style.height+=d,t.position.y=0}n.width=n.style.width,n.height=n.style.height}}}function gv(e,t){if(e.some(function(s){return s.type==="reset"}))return e.filter(function(s){return s.type==="reset"}).map(function(s){return s.item});var n=e.filter(function(s){return s.type==="add"}).map(function(s){return s.item});return t.reduce(function(s,r){var i=e.find(function(d){return d.id===r.id});if(i)switch(i.type){case"select":return s.push(sc(sc({},r),{},{selected:i.selected})),s;case"position":{var l=sc({},r);return typeof i.position<"u"&&(l.position=i.position),typeof i.positionAbsolute<"u"&&(l.positionAbsolute=i.positionAbsolute),typeof i.dragging<"u"&&(l.dragging=i.dragging),l.expandParent&&pv(s,l),s.push(l),s}case"dimensions":{var u=sc({},r);return typeof i.dimensions<"u"&&(u.width=i.dimensions.width,u.height=i.dimensions.height),u.expandParent&&pv(s,u),s.push(u),s}case"remove":return s}return s.push(r),s},n)}function _v(e,t){return gv(e,t)}function bA(e,t){return gv(e,t)}var Pa=function(t,n){return{id:t,type:"select",selected:n}};function Ii(e,t){return e.reduce(function(n,s){var r=t.includes(s.id);return!s.selected&&r?(s.selected=!0,n.push(Pa(s.id,!0))):s.selected&&!r&&(s.selected=!1,n.push(Pa(s.id,!1))),n},[])}function yv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function vv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var xv=function(t,n,s){var r=n.querySelectorAll(t);if(!r||!r.length)return null;var i=Array.from(r),l=n.getBoundingClientRect();return i.map(function(u){var d=u.getBoundingClientRect();return vv({id:u.getAttribute("data-handleid"),position:u.getAttribute("data-handlepos"),x:(d.left-l.left)/s,y:(d.top-l.top)/s},ch(u))})};function rc(e,t,n){return n===void 0?n:function(s){var r=t().nodeInternals.get(e);n(s,vv({},r))}}function bv(e){var t=e.id,n=e.store,s=n.getState(),r=s.addSelectedNodes,i=s.unselectNodesAndEdges,l=s.multiSelectionActive,u=s.nodeInternals,d=u.get(t);n.setState({nodesSelectionActive:!1}),d.selected?d.selected&&l&&i({nodes:[d]}):r([t])}function wv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function ac(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var wA=function(t){return"id"in t&&"source"in t&&"target"in t},NA=function(t){var n=t.source,s=t.sourceHandle,r=t.target,i=t.targetHandle;return"reactflow__edge-".concat(n).concat(s||"","-").concat(r).concat(i||"")},uh=function(t,n){if(typeof t>"u")return"";if(typeof t=="string")return t;var s=n?"".concat(n,"__"):"";return"".concat(s).concat(Object.keys(t).sort().map(function(r){return"".concat(r,"=").concat(t[r])}).join("&"))},jA=function(t,n){return n.some(function(s){return s.source===t.source&&s.target===t.target&&(s.sourceHandle===t.sourceHandle||!s.sourceHandle&&!t.sourceHandle)&&(s.targetHandle===t.targetHandle||!s.targetHandle&&!t.targetHandle)})},Nv=function(t,n){if(!t.source||!t.target)return n;var s;return wA(t)?s=ac({},t):s=ac(ac({},t),{},{id:NA(t)}),jA(s,n)?n:n.concat(s)},jv=function(t,n,s,r){var i=t.x,l=t.y,u=yt(n,3),d=u[0],f=u[1],p=u[2],m=yt(r,2),h=m[0],_=m[1],x={x:(i-d)/p,y:(l-f)/p};return s?{x:h*Math.round(x.x/h),y:_*Math.round(x.y/_)}:x},dh=function(t){if(t.length===0)return{x:0,y:0,width:0,height:0};var n=t.reduce(function(s,r){var i=r.positionAbsolute,l=r.position,u=r.width,d=r.height;return vA(s,sd({x:i?i.x:l.x,y:i?i.y:l.y,width:u||0,height:d||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return xA(n)},Cv=function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,1],r=yt(s,3),i=r[0],l=r[1],u=r[2],d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,p=sd({x:(n.x-i)/u,y:(n.y-l)/u,width:n.width/u,height:n.height/u}),m=[];return t.forEach(function(h){var _=h.positionAbsolute,x=h.width,y=h.height,v=h.selectable,w=v===void 0?!0:v;if(f&&!w)return!1;var k=sd(ac(ac({},_),{},{width:x||0,height:y||0})),j=Math.max(0,Math.min(p.x2,k.x2)-Math.max(p.x,k.x)),b=Math.max(0,Math.min(p.y2,k.y2)-Math.max(p.y,k.y)),S=Math.ceil(j*b),E=typeof x>"u"||typeof y>"u"||x===null||y===null,M=d&&S>0,O=(x||0)*(y||0),$=E||M||S>=O;$&&m.push(h)}),m},Sv=function(t,n){var s=t.map(function(r){return r.id});return n.filter(function(r){return s.includes(r.source)||s.includes(r.target)})},Ev=function(t,n,s,r,i){var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:.1,u=n/(t.width*(1+l)),d=s/(t.height*(1+l)),f=Math.min(u,d),p=Di(f,r,i),m=t.x+t.width/2,h=t.y+t.height/2,_=n/2-m*p,x=s/2-h*p;return[_,x,p]},Ao=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.transition().duration(n)};function kv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Fi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Mv(e,t,n,s){var r,i,l,u,d,f,p,m,h,_,x,y;if(!e.parentNode)return s;var v=t.get(e.parentNode);return Mv(v,t,n,{x:((r=s.x)!==null&&r!==void 0?r:0)+((i=(l=v.position)===null||l===void 0?void 0:l.x)!==null&&i!==void 0?i:0),y:((u=s.y)!==null&&u!==void 0?u:0)+((d=(f=v.position)===null||f===void 0?void 0:f.y)!==null&&d!==void 0?d:0),z:((p=(m=v[Qn])===null||m===void 0?void 0:m.z)!==null&&p!==void 0?p:0)>((h=s.z)!==null&&h!==void 0?h:0)?(_=(x=v[Qn])===null||x===void 0?void 0:x.z)!==null&&_!==void 0?_:0:(y=s.z)!==null&&y!==void 0?y:0})}function mh(e,t){var n=new Map,s={};return e.forEach(function(r){var i,l=fv(r.zIndex)?r.zIndex:r.selected?1e3:0,u=t.get(r.id),d=Fi(Fi({width:u==null?void 0:u.width,height:u==null?void 0:u.height},r),{},{positionAbsolute:{x:r.position.x,y:r.position.y}});r.parentNode&&(d.parentNode=r.parentNode,s[r.parentNode]=!0),Object.defineProperty(d,Qn,{enumerable:!1,value:{handleBounds:u==null||(i=u[Qn])===null||i===void 0?void 0:i.handleBounds,z:l}}),n.set(r.id,d)}),n.forEach(function(r){if(r.parentNode&&!n.has(r.parentNode))throw new Error("Parent node ".concat(r.parentNode," not found"));if(r.parentNode||s[r.id]){var i,l,u=Mv(r,n,s,Fi(Fi({},r.position),{},{z:(i=(l=r[Qn])===null||l===void 0?void 0:l.z)!==null&&i!==void 0?i:0})),d=u.x,f=u.y,p=u.z;r.positionAbsolute={x:d,y:f},r[Qn].z=p,s[r.id]&&(r[Qn].isParent=!0)}}),n}function Av(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e(),s=n.nodeInternals,r=n.width,i=n.height,l=n.minZoom,u=n.maxZoom,d=n.d3Zoom,f=n.d3Selection,p=n.fitViewOnInitDone,m=n.fitViewOnInit;if((t.initial&&!p&&m||!t.initial)&&d&&f){var h=Array.from(s.values()).filter(function(O){return t.includeHiddenNodes?O.width&&O.height:!O.hidden}),_=h.every(function(O){return O.width&&O.height});if(h.length>0&&_){var x,y,v,w=dh(h),k=Ev(w,r,i,(x=t.minZoom)!==null&&x!==void 0?x:l,(y=t.maxZoom)!==null&&y!==void 0?y:u,(v=t.padding)!==null&&v!==void 0?v:.1),j=yt(k,3),b=j[0],S=j[1],E=j[2],M=ra.translate(b,S).scale(E);return typeof t.duration=="number"&&t.duration>0?d.transform(Ao(f,t.duration),M):d.transform(f,M),!0}}return!1}function CA(e,t){return e.forEach(function(n){var s=t.get(n.id);if(s){var r;t.set(s.id,Fi(Fi({},s),{},(r={},Et(r,Qn,s[Qn]),Et(r,"selected",n.selected),r)))}}),new Map(t)}function SA(e,t){return t.map(function(n){var s=e.find(function(r){return r.id===n.id});return s&&(n.selected=s.selected),n})}function rd(e){var t=e.changedNodes,n=e.changedEdges,s=e.get,r=e.set,i=s(),l=i.nodeInternals,u=i.edges,d=i.onNodesChange,f=i.onEdgesChange,p=i.hasDefaultNodes,m=i.hasDefaultEdges;t!=null&&t.length&&(p&&r({nodeInternals:CA(t,l)}),d==null||d(t)),n!=null&&n.length&&(m&&r({edges:SA(n,u)}),f==null||f(n))}var fh=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ov={width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:fh,nodeExtent:fh,nodesSelectionActive:!1,userSelectionActive:!1,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionMode:Mo.Strict,domNode:null,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,multiSelectionActive:!1,reactFlowVersion:"10.3.17",connectionStartHandle:null,connectOnClick:!0};function $v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Ir(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$v(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$v(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var hh=z1(),Tv=hh.Provider,On=hh.useStore,os=hh.useStoreApi,Pv=function(){return L1(function(t,n){return Ir(Ir({},Ov),{},{setNodes:function(r){t({nodeInternals:mh(r,n().nodeInternals)})},setEdges:function(r){var i=n(),l=i.defaultEdgeOptions,u=l===void 0?{}:l;t({edges:r.map(function(d){return Ir(Ir({},u),d)})})},setDefaultNodesAndEdges:function(r,i){var l=typeof r<"u",u=typeof i<"u",d=l?mh(r,new Map):new Map,f=u?i:[];t({nodeInternals:d,edges:f,hasDefaultNodes:l,hasDefaultEdges:u})},updateNodeDimensions:function(r){var i=n(),l=i.onNodesChange,u=i.nodeInternals,d=i.fitViewOnInit,f=i.fitViewOnInitDone,p=i.fitViewOnInitOptions,m=i.domNode,h=m==null?void 0:m.querySelector(".react-flow__viewport");if(h){var _=window.getComputedStyle(h),x=new window.DOMMatrixReadOnly(_.transform),y=x.m22,v=r.reduce(function(k,j){var b=u.get(j.id);if(b){var S=ch(j.nodeElement),E=!!(S.width&&S.height&&(b.width!==S.width||b.height!==S.height||j.forceUpdate));E&&(u.set(b.id,Ir(Ir({},b),{},Et({},Qn,Ir(Ir({},b[Qn]),{},{handleBounds:{source:xv(".source",j.nodeElement,y),target:xv(".target",j.nodeElement,y)}})),S)),k.push({id:b.id,type:"dimensions",dimensions:S}))}return k},[]),w=f||d&&!f&&Av(n,Ir({initial:!0},p));t({nodeInternals:new Map(u),fitViewOnInitDone:w}),(v==null?void 0:v.length)>0&&(l==null||l(v))}},updateNodePositions:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,u=n(),d=u.onNodesChange,f=u.nodeInternals,p=u.hasDefaultNodes;if(p||d){var m=r.map(function(x){var y={id:x.id,type:"position",dragging:l};return i&&(y.positionAbsolute=x.positionAbsolute,y.position=x.position),y});if(m!=null&&m.length){if(p){var h=_v(m,Array.from(f.values())),_=mh(h,f);t({nodeInternals:_})}d==null||d(m)}}},addSelectedNodes:function(r){var i=n(),l=i.multiSelectionActive,u=i.nodeInternals,d=i.edges,f,p=null;l?f=r.map(function(m){return Pa(m,!0)}):(f=Ii(Array.from(u.values()),r),p=Ii(d,[])),rd({changedNodes:f,changedEdges:p,get:n,set:t})},addSelectedEdges:function(r){var i=n(),l=i.multiSelectionActive,u=i.edges,d=i.nodeInternals,f,p=null;l?f=r.map(function(m){return Pa(m,!0)}):(f=Ii(u,r),p=Ii(Array.from(d.values()),[])),rd({changedNodes:p,changedEdges:f,get:n,set:t})},unselectNodesAndEdges:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r.nodes,l=r.edges,u=n(),d=u.nodeInternals,f=u.edges,p=i||Array.from(d.values()),m=l||f,h=p.map(function(x){return x.selected=!1,Pa(x.id,!1)}),_=m.map(function(x){return Pa(x.id,!1)});rd({changedNodes:h,changedEdges:_,get:n,set:t})},setMinZoom:function(r){var i=n(),l=i.d3Zoom,u=i.maxZoom;l==null||l.scaleExtent([r,u]),t({minZoom:r})},setMaxZoom:function(r){var i=n(),l=i.d3Zoom,u=i.minZoom;l==null||l.scaleExtent([u,r]),t({maxZoom:r})},setTranslateExtent:function(r){var i=n(),l=i.d3Zoom;l==null||l.translateExtent(r),t({translateExtent:r})},resetSelectedElements:function(){var r=n(),i=r.nodeInternals,l=r.edges,u=Array.from(i.values()),d=u.filter(function(p){return p.selected}).map(function(p){return Pa(p.id,!1)}),f=l.filter(function(p){return p.selected}).map(function(p){return Pa(p.id,!1)});rd({changedNodes:d,changedEdges:f,get:n,set:t})},setNodeExtent:function(r){var i=n(),l=i.nodeInternals;l.forEach(function(u){u.positionAbsolute=dv(u.position,r)}),t({nodeExtent:r,nodeInternals:new Map(l)})},reset:function(){return t(Ir({},Ov))}})})};function $t(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,s;n<e.length;n++)(s=$t(e[n]))!==""&&(t+=(t&&" ")+s);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}function Vs(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let s=0;s<n.length;s++)if(!Object.prototype.hasOwnProperty.call(t,n[s])||!Object.is(e[n[s]],t[n[s]]))return!1;return!0}function EA(e){if(Array.isArray(e))return lh(e)}function kA(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function MA(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Oo(e){return EA(e)||kA(e)||uv(e)||MA()}var AA={zoomIn:function(){},zoomOut:function(){},zoomTo:function(t){},getZoom:function(){return 1},setViewport:function(t){},getViewport:function(){return{x:0,y:0,zoom:1}},fitView:function(){},setCenter:function(t,n){},fitBounds:function(t){},project:function(t){return t},viewportInitialized:!1},OA=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection}},$A=function(){var t=os(),n=On(OA,Vs),s=n.d3Zoom,r=n.d3Selection,i=N.useMemo(function(){return r&&s?{zoomIn:function(u){return s.scaleBy(Ao(r,u==null?void 0:u.duration),1.2)},zoomOut:function(u){return s.scaleBy(Ao(r,u==null?void 0:u.duration),1/1.2)},zoomTo:function(u,d){return s.scaleTo(Ao(r,d==null?void 0:d.duration),u)},getZoom:function(){return t.getState().transform[2]},setViewport:function(u,d){var f,p,m,h=yt(t.getState().transform,3),_=h[0],x=h[1],y=h[2],v=ra.translate((f=u.x)!==null&&f!==void 0?f:_,(p=u.y)!==null&&p!==void 0?p:x).scale((m=u.zoom)!==null&&m!==void 0?m:y);s.transform(Ao(r,d==null?void 0:d.duration),v)},getViewport:function(){var u=yt(t.getState().transform,3),d=u[0],f=u[1],p=u[2];return{x:d,y:f,zoom:p}},fitView:function(u){return Av(t.getState,u)},setCenter:function(u,d,f){var p=t.getState(),m=p.width,h=p.height,_=p.maxZoom,x=typeof(f==null?void 0:f.zoom)<"u"?f.zoom:_,y=m/2-u*x,v=h/2-d*x,w=ra.translate(y,v).scale(x);s.transform(Ao(r,f==null?void 0:f.duration),w)},fitBounds:function(u,d){var f,p=t.getState(),m=p.width,h=p.height,_=p.minZoom,x=p.maxZoom,y=Ev(u,m,h,_,x,(f=d==null?void 0:d.padding)!==null&&f!==void 0?f:.1),v=yt(y,3),w=v[0],k=v[1],j=v[2],b=ra.translate(w,k).scale(j);s.transform(Ao(r,d==null?void 0:d.duration),b)},project:function(u){var d=t.getState(),f=d.transform,p=d.snapToGrid,m=d.snapGrid;return jv(u,f,p,m)},viewportInitialized:!0}:AA},[s,r]);return i};function Lv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Bi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function ph(){var e=$A(),t=os(),n=N.useCallback(function(){var m=t.getState(),h=m.nodeInternals,_=Array.from(h.values());return _.map(function(x){return Bi({},x)})},[]),s=N.useCallback(function(m){var h=t.getState(),_=h.nodeInternals;return _.get(m)},[]),r=N.useCallback(function(){var m=t.getState(),h=m.edges,_=h===void 0?[]:h;return _.map(function(x){return Bi({},x)})},[]),i=N.useCallback(function(m){var h=t.getState(),_=h.edges,x=_===void 0?[]:_;return x.find(function(y){return y.id===m})},[]),l=N.useCallback(function(m){var h=t.getState(),_=h.nodeInternals,x=h.setNodes,y=h.hasDefaultNodes,v=h.onNodesChange,w=Array.from(_.values()),k=typeof m=="function"?m(w):m;if(y)x(k);else if(v){var j=k.length===0?w.map(function(b){return{type:"remove",id:b.id}}):k.map(function(b){return{item:b,type:"reset"}});v(j)}},[]),u=N.useCallback(function(m){var h=t.getState(),_=h.edges,x=_===void 0?[]:_,y=h.setEdges,v=h.hasDefaultEdges,w=h.onEdgesChange,k=typeof m=="function"?m(x):m;if(v)y(k);else if(w){var j=k.length===0?x.map(function(b){return{type:"remove",id:b.id}}):k.map(function(b){return{item:b,type:"reset"}});w(j)}},[]),d=N.useCallback(function(m){var h=Array.isArray(m)?m:[m],_=t.getState(),x=_.nodeInternals,y=_.setNodes,v=_.hasDefaultNodes,w=_.onNodesChange;if(v){var k=Array.from(x.values()),j=[].concat(k,Oo(h));y(j)}else if(w){var b=h.map(function(S){return{item:S,type:"add"}});w(b)}},[]),f=N.useCallback(function(m){var h=Array.isArray(m)?m:[m],_=t.getState(),x=_.edges,y=x===void 0?[]:x,v=_.setEdges,w=_.hasDefaultEdges,k=_.onEdgesChange;if(w)v([].concat(Oo(y),Oo(h)));else if(k){var j=h.map(function(b){return{item:b,type:"add"}});k(j)}},[]),p=N.useCallback(function(){var m=t.getState(),h=m.nodeInternals,_=m.edges,x=_===void 0?[]:_,y=m.transform,v=Array.from(h.values()),w=yt(y,3),k=w[0],j=w[1],b=w[2];return{nodes:v.map(function(S){return Bi({},S)}),edges:x.map(function(S){return Bi({},S)}),viewport:{x:k,y:j,zoom:b}}},[]);return N.useMemo(function(){return Bi(Bi({},e),{},{getNodes:n,getNode:s,getEdges:r,getEdge:i,setNodes:l,setEdges:u,addNodes:d,addEdges:f,toObject:p})},[e,n,s,r,i,l,u,d,f,p])}function TA(e,t){if(e==null)return{};var n={},s=Object.keys(e),r,i;for(i=0;i<s.length;i++)r=s[i],!(t.indexOf(r)>=0)&&(n[r]=e[r]);return n}function ad(e,t){if(e==null)return{};var n=TA(e,t),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function PA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},ve.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function LA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},ve.createElement("path",{d:"M0 0h32v4.2H0z"}))}function zA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},ve.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function RA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ve.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function DA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ve.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}var IA=["children","className"];function zv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function FA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var od=function(t){var n=t.children,s=t.className,r=ad(t,IA);return ve.createElement("button",FA({type:"button",className:$t(["react-flow__controls-button",s])},r),n)},BA=function(t){return t.nodesDraggable&&t.nodesConnectable&&t.elementsSelectable},Rv=function(t){var n=t.style,s=t.showZoom,r=s===void 0?!0:s,i=t.showFitView,l=i===void 0?!0:i,u=t.showInteractive,d=u===void 0?!0:u,f=t.fitViewOptions,p=t.onZoomIn,m=t.onZoomOut,h=t.onFitView,_=t.onInteractiveChange,x=t.className,y=t.children,v=os(),w=N.useState(!1),k=yt(w,2),j=k[0],b=k[1],S=On(BA),E=ph(),M=E.zoomIn,O=E.zoomOut,$=E.fitView;if(N.useEffect(function(){b(!0)},[]),!j)return null;var P=function(){M==null||M(),p==null||p()},A=function(){O==null||O(),m==null||m()},R=function(){$==null||$(f),h==null||h()},F=function(){v.setState({nodesDraggable:!S,nodesConnectable:!S,elementsSelectable:!S}),_==null||_(!S)};return ve.createElement("div",{className:$t(["react-flow__controls",x]),style:n},r&&ve.createElement(ve.Fragment,null,ve.createElement(od,{onClick:P,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in"},ve.createElement(PA,null)),ve.createElement(od,{onClick:A,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out"},ve.createElement(LA,null))),l&&ve.createElement(od,{className:"react-flow__controls-fitview",onClick:R,title:"fit view","aria-label":"fit view"},ve.createElement(zA,null)),d&&ve.createElement(od,{className:"react-flow__controls-interactive",onClick:F,title:"toggle interactivity","aria-label":"toggle interactivity"},S?ve.createElement(DA,null):ve.createElement(RA,null)),y)};Rv.displayName="Controls";var UA=N.memo(Rv),HA=function(t,n,s){return ve.createElement("path",{stroke:s,strokeWidth:n,d:"M".concat(t/2," 0 V").concat(t," M0 ").concat(t/2," H").concat(t)})},qA=function(t,n){return ve.createElement("circle",{cx:t,cy:t,r:t,fill:n})},id;function Dv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Iv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Dv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var VA=(id={},Et(id,zi.Dots,"#81818a"),Et(id,zi.Lines,"#eee"),id),WA=function(t){return t.transform},Fv=function(t){var n=t.variant,s=n===void 0?zi.Dots:n,r=t.gap,i=r===void 0?15:r,l=t.size,u=l===void 0?.4:l,d=t.color,f=t.style,p=t.className,m=N.useRef(null),h=N.useState(null),_=yt(h,2),x=_[0],y=_[1],v=On(WA),w=yt(v,3),k=w[0],j=w[1],b=w[2];N.useEffect(function(){var A=document.querySelectorAll(".react-flow__background"),R=Array.from(A).findIndex(function(F){return F===m.current});y("pattern-".concat(R))},[]);var S=i*b||1,E=k%S,M=j%S,O=s===zi.Lines,$=d||VA[s],P=O?HA(S,u,$):qA(u*b,$);return ve.createElement("svg",{className:$t(["react-flow__background","react-flow__container",p]),style:Iv(Iv({},f),{},{width:"100%",height:"100%"}),ref:m},x&&ve.createElement(ve.Fragment,null,ve.createElement("pattern",{id:x,x:E,y:M,width:S,height:S,patternUnits:"userSpaceOnUse"},P),ve.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#".concat(x,")")})))};Fv.displayName="Background";var YA=N.memo(Fv),KA=function(t){return t.updateNodeDimensions};function GA(){var e=os(),t=On(KA);return N.useCallback(function(n){var s,r=(s=e.getState().domNode)===null||s===void 0?void 0:s.querySelector('.react-flow__node[data-id="'.concat(n,'"]'));r&&requestAnimationFrame(function(){return t([{id:n,nodeElement:r,forceUpdate:!0}])})},[])}var XA=["paid-pro","paid-sponsor","paid-enterprise","paid-custom"];function QA(e){var t=e.proOptions,n=e.position,s=n===void 0?"bottom-right":n;if(t!=null&&t.account&&XA.includes(t==null?void 0:t.account)&&t!==null&&t!==void 0&&t.hideAttribution)return null;var r="".concat(s).split("-");return ve.createElement("div",{className:$t(["react-flow__attribution"].concat(Oo(r))),"data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev/pricing"},ve.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer"},"React Flow"))}var ZA=["x","y","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","children","className"];function Bv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function JA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Bv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var eO=function(t){var n=t.x,s=t.y,r=t.label,i=t.labelStyle,l=i===void 0?{}:i,u=t.labelShowBg,d=u===void 0?!0:u,f=t.labelBgStyle,p=f===void 0?{}:f,m=t.labelBgPadding,h=m===void 0?[2,4]:m,_=t.labelBgBorderRadius,x=_===void 0?2:_,y=t.children,v=t.className,w=ad(t,ZA),k=N.useRef(null),j=N.useState({x:0,y:0,width:0,height:0}),b=yt(j,2),S=b[0],E=b[1],M=$t(["react-flow__edge-textwrapper",v]);return N.useEffect(function(){if(k.current){var O=k.current.getBBox();E({x:O.x,y:O.y,width:O.width,height:O.height})}},[r]),typeof r>"u"||!r?null:ve.createElement("g",JA({transform:"translate(".concat(n-S.width/2," ").concat(s-S.height/2,")"),className:M},w),d&&ve.createElement("rect",{width:S.width+2*h[0],x:-h[0],y:-h[1],height:S.height+2*h[1],className:"react-flow__edge-textbg",style:p,rx:x,ry:x}),ve.createElement("text",{className:"react-flow__edge-text",y:S.height/2,dy:"0.3em",ref:k,style:l},r),y)},tO=N.memo(eO),ld=function(e){var t=e.path,n=e.centerX,s=e.centerY,r=e.label,i=e.labelStyle,l=e.labelShowBg,u=e.labelBgStyle,d=e.labelBgPadding,f=e.labelBgBorderRadius,p=e.style,m=e.markerEnd,h=e.markerStart,_=r?ve.createElement(tO,{x:n,y:s,label:r,labelStyle:i,labelShowBg:l,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f}):null;return ve.createElement(ve.Fragment,null,ve.createElement("path",{style:p,d:t,className:"react-flow__edge-path",markerEnd:m,markerStart:h}),_)};function cd(e){var t=e.pos,n=e.x1,s=e.y1,r=e.x2,i=e.y2,l,u;switch(t){case Le.Left:case Le.Right:l=.5*(n+r),u=s;break;case Le.Top:case Le.Bottom:l=n,u=.5*(s+i);break}return[l,u]}function Uv(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Le.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Le.Top:u,f=cd({pos:r,x1:t,y1:n,x2:i,y2:l}),p=yt(f,2),m=p[0],h=p[1],_=cd({pos:d,x1:i,y1:l,x2:t,y2:n}),x=yt(_,2),y=x[0],v=x[1];return"M".concat(t,",").concat(n," C").concat(m,",").concat(h," ").concat(y,",").concat(v," ").concat(i,",").concat(l)}function nO(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Le.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Le.Top:u,f=cd({pos:r,x1:t,y1:n,x2:i,y2:l}),p=yt(f,2),m=p[0],h=p[1],_=cd({pos:d,x1:i,y1:l,x2:t,y2:n}),x=yt(_,2),y=x[0],v=x[1],w=t*.125+m*.375+y*.375+i*.125,k=n*.125+h*.375+v*.375+l*.125,j=Math.abs(w-t),b=Math.abs(k-n);return[w,k,j,b]}var Hv=N.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.sourcePosition,l=i===void 0?Le.Bottom:i,u=e.targetPosition,d=u===void 0?Le.Top:u,f=e.label,p=e.labelStyle,m=e.labelShowBg,h=e.labelBgStyle,_=e.labelBgPadding,x=e.labelBgBorderRadius,y=e.style,v=e.markerEnd,w=e.markerStart,k={sourceX:t,sourceY:n,sourcePosition:l,targetX:s,targetY:r,targetPosition:d},j=Uv(k),b=nO(k),S=yt(b,2),E=S[0],M=S[1];return ve.createElement(ld,{path:j,centerX:E,centerY:M,label:f,labelStyle:p,labelShowBg:m,labelBgStyle:h,labelBgPadding:_,labelBgBorderRadius:x,style:y,markerEnd:v,markerStart:w})});function qv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function sO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Vv=[Le.Left,Le.Right],Wv=function(t){var n=t.sourceX,s=t.sourceY,r=t.targetX,i=t.targetY,l=t.sourcePosition,u=l===void 0?Le.Bottom:l,d=t.targetPosition,f=d===void 0?Le.Top:d,p=Vv.includes(u),m=Vv.includes(f),h=p&&!m||m&&!p;if(h){var _=p?Math.abs(r-n):0,x=n>r?n-_:n+_,y=p?0:Math.abs(i-s),v=s<i?s+y:s-y;return[x,v,_,y]}var w=Math.abs(r-n)/2,k=r<n?r+w:r-w,j=Math.abs(i-s)/2,b=i<s?i+j:i-j;return[k,b,w,j]};function oc(e,t,n){return n===void 0?n:function(s){var r=t().edges.find(function(i){return i.id===e});n(s,sO({},r))}}var gh=function(t,n,s){return"L ".concat(t,",").concat(n-s,"Q ").concat(t,",").concat(n," ").concat(t+s,",").concat(n)},_h=function(t,n,s){return"L ".concat(t+s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n-s)},yh=function(t,n,s){return"L ".concat(t,",").concat(n-s,"Q ").concat(t,",").concat(n," ").concat(t-s,",").concat(n)},vh=function(t,n,s){return"L ".concat(t-s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n-s)},xh=function(t,n,s){return"L ".concat(t+s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n+s)},bh=function(t,n,s){return"L ".concat(t,",").concat(n+s,"Q ").concat(t,",").concat(n," ").concat(t+s,",").concat(n)},wh=function(t,n,s){return"L ".concat(t,",").concat(n+s,"Q ").concat(t,",").concat(n," ").concat(t-s,",").concat(n)},Nh=function(t,n,s){return"L ".concat(t-s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n+s)};function jh(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Le.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Le.Top:u,f=e.borderRadius,p=f===void 0?5:f,m=e.centerX,h=e.centerY,_=Wv({sourceX:t,sourceY:n,targetX:i,targetY:l}),x=yt(_,4),y=x[0],v=x[1],w=x[2],k=x[3],j=Math.min(p,Math.abs(i-t)),b=Math.min(p,Math.abs(l-n)),S=Math.min(j,b,w,k),E=[Le.Left,Le.Right],M=typeof m<"u"?m:y,O=typeof h<"u"?h:v,$=null,P=null;return t<=i?($=n<=l?gh(t,O,S):bh(t,O,S),P=n<=l?Nh(i,O,S):vh(i,O,S)):($=n<l?yh(t,O,S):wh(t,O,S),P=n<l?xh(i,O,S):_h(i,O,S)),E.includes(r)&&E.includes(d)?t<=i?($=n<=l?Nh(M,n,S):vh(M,n,S),P=n<=l?gh(M,l,S):bh(M,l,S)):(r===Le.Right&&d===Le.Left||r===Le.Left&&d===Le.Right||r===Le.Left&&d===Le.Left)&&($=n<=l?xh(M,n,S):_h(M,n,S),P=n<=l?yh(M,l,S):wh(M,l,S)):E.includes(r)&&!E.includes(d)?(t<=i?$=n<=l?Nh(i,n,S):vh(i,n,S):$=n<=l?xh(i,n,S):_h(i,n,S),P=""):!E.includes(r)&&E.includes(d)&&(t<=i?$=n<=l?gh(t,l,S):bh(t,l,S):$=n<=l?yh(t,l,S):wh(t,l,S),P=""),"M ".concat(t,",").concat(n).concat($).concat(P,"L ").concat(i,",").concat(l)}var Ch=N.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.label,l=e.labelStyle,u=e.labelShowBg,d=e.labelBgStyle,f=e.labelBgPadding,p=e.labelBgBorderRadius,m=e.style,h=e.sourcePosition,_=h===void 0?Le.Bottom:h,x=e.targetPosition,y=x===void 0?Le.Top:x,v=e.markerEnd,w=e.markerStart,k=e.borderRadius,j=k===void 0?5:k,b=Wv({sourceX:t,sourceY:n,targetX:s,targetY:r,sourcePosition:_,targetPosition:y}),S=yt(b,2),E=S[0],M=S[1],O=jh({sourceX:t,sourceY:n,sourcePosition:_,targetX:s,targetY:r,targetPosition:y,borderRadius:j});return ve.createElement(ld,{path:O,centerX:E,centerY:M,label:i,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:m,markerEnd:v,markerStart:w})});function Yv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Kv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Yv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Gv=N.memo(function(e){return ve.createElement(Ch,Kv(Kv({},e),{},{borderRadius:0}))}),Xv=N.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.label,l=e.labelStyle,u=e.labelShowBg,d=e.labelBgStyle,f=e.labelBgPadding,p=e.labelBgBorderRadius,m=e.style,h=e.markerEnd,_=e.markerStart,x=Math.abs(r-n)/2,y=r<n?r+x:r-x,v=Math.abs(s-t)/2,w=s<t?s+v:s-v,k="M ".concat(t,",").concat(n,"L ").concat(s,",").concat(r);return ve.createElement(ld,{path:k,centerX:w,centerY:y,label:i,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:m,markerEnd:h,markerStart:_})});function ud(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function dd(e){var t=e.pos,n=e.x1,s=e.y1,r=e.x2,i=e.y2,l=e.c,u,d;switch(t){case Le.Left:u=n-ud(n-r,l),d=s;break;case Le.Right:u=n+ud(r-n,l),d=s;break;case Le.Top:u=n,d=s-ud(s-i,l);break;case Le.Bottom:u=n,d=s+ud(i-s,l);break}return[u,d]}function Qv(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Le.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Le.Top:u,f=e.curvature,p=f===void 0?.25:f,m=dd({pos:r,x1:t,y1:n,x2:i,y2:l,c:p}),h=yt(m,2),_=h[0],x=h[1],y=dd({pos:d,x1:i,y1:l,x2:t,y2:n,c:p}),v=yt(y,2),w=v[0],k=v[1];return"M".concat(t,",").concat(n," C").concat(_,",").concat(x," ").concat(w,",").concat(k," ").concat(i,",").concat(l)}function rO(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Le.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Le.Top:u,f=e.curvature,p=f===void 0?.25:f,m=dd({pos:r,x1:t,y1:n,x2:i,y2:l,c:p}),h=yt(m,2),_=h[0],x=h[1],y=dd({pos:d,x1:i,y1:l,x2:t,y2:n,c:p}),v=yt(y,2),w=v[0],k=v[1],j=t*.125+_*.375+w*.375+i*.125,b=n*.125+x*.375+k*.375+l*.125,S=Math.abs(j-t),E=Math.abs(b-n);return[j,b,S,E]}var Sh=N.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.sourcePosition,l=i===void 0?Le.Bottom:i,u=e.targetPosition,d=u===void 0?Le.Top:u,f=e.label,p=e.labelStyle,m=e.labelShowBg,h=e.labelBgStyle,_=e.labelBgPadding,x=e.labelBgBorderRadius,y=e.style,v=e.markerEnd,w=e.markerStart,k=e.curvature,j={sourceX:t,sourceY:n,sourcePosition:l,targetX:s,targetY:r,targetPosition:d,curvature:k},b=Qv(j),S=rO(j),E=yt(S,2),M=E[0],O=E[1];return ve.createElement(ld,{path:b,centerX:M,centerY:O,label:f,labelStyle:p,labelShowBg:m,labelBgStyle:h,labelBgPadding:_,labelBgBorderRadius:x,style:y,markerEnd:v,markerStart:w})}),Eh=N.createContext(null),aO=Eh.Provider;Eh.Consumer;function kh(e,t,n,s,r,i,l){var u=l.elementFromPoint(e.clientX,e.clientY),d=(u==null?void 0:u.classList.contains("target"))||!1,f=(u==null?void 0:u.classList.contains("source"))||!1,p={elementBelow:u,isValid:!1,connection:{source:null,target:null,sourceHandle:null,targetHandle:null},isHoveringHandle:!1};if(u&&(d||f)){p.isHoveringHandle=!0;var m=u.getAttribute("data-nodeid"),h=u.getAttribute("data-handleid"),_=n?{source:m,sourceHandle:h,target:s,targetHandle:r}:{source:s,sourceHandle:r,target:m,targetHandle:h};p.connection=_;var x=t===Mo.Strict?n&&f||!n&&d:!0;x&&(p.isValid=i(_))}return p}function Mh(e){e==null||e.classList.remove("react-flow__handle-valid"),e==null||e.classList.remove("react-flow__handle-connecting")}function Zv(e){var t=e.event,n=e.handleId,s=e.nodeId,r=e.onConnect,i=e.isTarget,l=e.getState,u=e.setState,d=e.isValidConnection,f=e.elementEdgeUpdaterType,p=e.onEdgeUpdateEnd,m=t.target.closest(".react-flow"),h=mv(t.target);if(!h)return;var _=h.elementFromPoint(t.clientX,t.clientY),x=_==null?void 0:_.classList.contains("target"),y=_==null?void 0:_.classList.contains("source");if(!m||!x&&!y&&!f)return;var v=l(),w=v.onConnectStart,k=v.connectionMode,j=f||(x?"target":"source"),b=m.getBoundingClientRect(),S;u({connectionPosition:{x:t.clientX-b.left,y:t.clientY-b.top},connectionNodeId:s,connectionHandleId:n,connectionHandleType:j}),w==null||w(t,{nodeId:s,handleId:n,handleType:j});function E(O){u({connectionPosition:{x:O.clientX-b.left,y:O.clientY-b.top}});var $=kh(O,k,i,s,n,d,h),P=$.connection,A=$.elementBelow,R=$.isValid,F=$.isHoveringHandle;if(!F)return Mh(S);P.source!==P.target&&A&&(Mh(S),S=A,A.classList.add("react-flow__handle-connecting"),A.classList.toggle("react-flow__handle-valid",R))}function M(O){var $=l(),P=$.onConnectStop,A=$.onConnectEnd,R=kh(O,k,i,s,n,d,h),F=R.connection,z=R.isValid;P==null||P(O),z&&(r==null||r(F)),A==null||A(O),f&&p&&p(O),Mh(S),u({connectionNodeId:null,connectionHandleId:null,connectionHandleType:null}),h.removeEventListener("mousemove",E),h.removeEventListener("mouseup",M)}h.addEventListener("mousemove",E),h.addEventListener("mouseup",M)}var oO=["type","position","isValidConnection","isConnectable","id","onConnect","children","className","onMouseDown"];function Jv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Ah(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jv(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var iO=function(){return!0},lO=function(t){return{connectionStartHandle:t.connectionStartHandle,connectOnClick:t.connectOnClick}},ex=N.forwardRef(function(e,t){var n=e.type,s=n===void 0?"source":n,r=e.position,i=r===void 0?Le.Top:r,l=e.isValidConnection,u=l===void 0?iO:l,d=e.isConnectable,f=d===void 0?!0:d,p=e.id,m=e.onConnect,h=e.children,_=e.className,x=e.onMouseDown,y=ad(e,oO),v=os(),w=N.useContext(Eh),k=On(lO,Vs),j=k.connectionStartHandle,b=k.connectOnClick,S=p||null,E=s==="target",M=function(A){var R=v.getState(),F=R.defaultEdgeOptions,z=R.onConnect,I=R.hasDefaultEdges,U=Ah(Ah({},F),A);if(I){var q=v.getState(),H=q.edges;v.setState({edges:Nv(U,H)})}z==null||z(U),m==null||m(U)},O=function(A){A.button===0&&Zv({event:A,handleId:S,nodeId:w,onConnect:M,isTarget:E,getState:v.getState,setState:v.setState,isValidConnection:u}),x==null||x(A)},$=function(A){var R=v.getState(),F=R.onClickConnectStart,z=R.onClickConnectStop,I=R.onClickConnectEnd,U=R.connectionMode;if(!j){F==null||F(A,{nodeId:w,handleId:S,handleType:s}),v.setState({connectionStartHandle:{nodeId:w,type:s,handleId:S}});return}var q=mv(A.target),H=kh(A,U,j.type==="target",j.nodeId,j.handleId||null,u,q),W=H.connection,B=H.isValid;z==null||z(A),B&&M(W),I==null||I(A),v.setState({connectionStartHandle:null})};return ve.createElement("div",Ah({"data-handleid":S,"data-nodeid":w,"data-handlepos":i,className:$t(["react-flow__handle","react-flow__handle-".concat(i),"nodrag",_,{source:!E,target:E,connectable:f,connecting:(j==null?void 0:j.nodeId)===w&&(j==null?void 0:j.handleId)===S&&(j==null?void 0:j.type)===s}]),onMouseDown:O,onClick:b?$:void 0,ref:t},y),h)});ex.displayName="Handle";var ic=N.memo(ex),tx=function(t){var n=t.data,s=t.isConnectable,r=t.targetPosition,i=r===void 0?Le.Top:r,l=t.sourcePosition,u=l===void 0?Le.Bottom:l;return ve.createElement(ve.Fragment,null,ve.createElement(ic,{type:"target",position:i,isConnectable:s}),n==null?void 0:n.label,ve.createElement(ic,{type:"source",position:u,isConnectable:s}))};tx.displayName="DefaultNode";var Oh=N.memo(tx),nx=function(t){var n=t.data,s=t.isConnectable,r=t.sourcePosition,i=r===void 0?Le.Bottom:r;return ve.createElement(ve.Fragment,null,n==null?void 0:n.label,ve.createElement(ic,{type:"source",position:i,isConnectable:s}))};nx.displayName="InputNode";var sx=N.memo(nx),rx=function(t){var n=t.data,s=t.isConnectable,r=t.targetPosition,i=r===void 0?Le.Top:r;return ve.createElement(ve.Fragment,null,ve.createElement(ic,{type:"target",position:i,isConnectable:s}),n==null?void 0:n.label)};rx.displayName="OutputNode";var ax=N.memo(rx),cO=function(t){return{selectedNodes:Array.from(t.nodeInternals.values()).filter(function(n){return n.selected}),selectedEdges:t.edges.filter(function(n){return n.selected})}},uO=function(t,n){var s=t.selectedNodes.map(function(u){return u.id}),r=n.selectedNodes.map(function(u){return u.id}),i=t.selectedEdges.map(function(u){return u.id}),l=n.selectedEdges.map(function(u){return u.id});return Vs(s,r)&&Vs(i,l)};function dO(e){var t=e.onSelectionChange,n=On(cO,uO),s=n.selectedNodes,r=n.selectedEdges;return N.useEffect(function(){t({nodes:s,edges:r})},[s,r]),null}var mO=N.memo(dO),fO=function(t){return{setNodes:t.setNodes,setEdges:t.setEdges,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset}};function La(e,t){N.useEffect(function(){typeof e<"u"&&t(e)},[e])}function Vt(e,t,n){N.useEffect(function(){typeof t<"u"&&n(Et({},e,t))},[t])}var hO=function(t){var n=t.nodes,s=t.edges,r=t.defaultNodes,i=t.defaultEdges,l=t.onConnect,u=t.onConnectStart,d=t.onConnectStop,f=t.onConnectEnd,p=t.onClickConnectStart,m=t.onClickConnectStop,h=t.onClickConnectEnd,_=t.nodesDraggable,x=t.nodesConnectable,y=t.minZoom,v=t.maxZoom,w=t.nodeExtent,k=t.onNodesChange,j=t.onEdgesChange,b=t.elementsSelectable,S=t.connectionMode,E=t.snapGrid,M=t.snapToGrid,O=t.translateExtent,$=t.connectOnClick,P=t.defaultEdgeOptions,A=t.fitView,R=t.fitViewOptions,F=t.onNodesDelete,z=t.onEdgesDelete,I=t.onNodeDrag,U=t.onNodeDragStart,q=t.onNodeDragStop,H=t.onSelectionDrag,W=t.onSelectionDragStart,B=t.onSelectionDragStop,D=On(fO,Vs),V=D.setNodes,te=D.setEdges,G=D.setDefaultNodesAndEdges,K=D.setMinZoom,X=D.setMaxZoom,Q=D.setTranslateExtent,J=D.setNodeExtent,Z=D.reset,ee=os();return N.useEffect(function(){return G(r,i),function(){Z()}},[]),Vt("defaultEdgeOptions",P,ee.setState),Vt("connectionMode",S,ee.setState),Vt("onConnect",l,ee.setState),Vt("onConnectStart",u,ee.setState),Vt("onConnectStop",d,ee.setState),Vt("onConnectEnd",f,ee.setState),Vt("onClickConnectStart",p,ee.setState),Vt("onClickConnectStop",m,ee.setState),Vt("onClickConnectEnd",h,ee.setState),Vt("nodesDraggable",_,ee.setState),Vt("nodesConnectable",x,ee.setState),Vt("elementsSelectable",b,ee.setState),Vt("snapToGrid",M,ee.setState),Vt("snapGrid",E,ee.setState),Vt("onNodesChange",k,ee.setState),Vt("onEdgesChange",j,ee.setState),Vt("connectOnClick",$,ee.setState),Vt("fitViewOnInit",A,ee.setState),Vt("fitViewOnInitOptions",R,ee.setState),Vt("onNodesDelete",F,ee.setState),Vt("onEdgesDelete",z,ee.setState),Vt("onNodeDrag",I,ee.setState),Vt("onNodeDragStart",U,ee.setState),Vt("onNodeDragStop",q,ee.setState),Vt("onSelectionDrag",H,ee.setState),Vt("onSelectionDragStart",W,ee.setState),Vt("onSelectionDragStop",B,ee.setState),La(n,V),La(s,te),La(r,V),La(i,te),La(y,K),La(v,X),La(O,Q),La(w,J),null},pO=".react-flow{height:100%;overflow:hidden;position:relative;width:100%}.react-flow__container{height:100%;left:0;position:absolute;top:0;width:100%}.react-flow__pane{z-index:1}.react-flow__viewport{pointer-events:none;transform-origin:0 0;z-index:2}.react-flow__renderer{z-index:4}.react-flow__selectionpane{z-index:5}.react-flow .react-flow__edges{overflow:visible;pointer-events:none}.react-flow .react-flow__connectionline{z-index:1001}.react-flow__edge{pointer-events:visibleStroke}.react-flow__edge.inactive{pointer-events:none}@-webkit-keyframes dashdraw{0%{stroke-dashoffset:10}}@keyframes dashdraw{0%{stroke-dashoffset:10}}.react-flow__edge-path{fill:none}.react-flow__edge-textwrapper{pointer-events:all}.react-flow__edge-text{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__connection{pointer-events:none}.react-flow__connection .animated{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__connection-path{fill:none}.react-flow__nodes{pointer-events:none;transform-origin:0 0}.react-flow__node{box-sizing:border-box;pointer-events:all;position:absolute;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__nodesselection{pointer-events:none;transform-origin:left top;z-index:3}.react-flow__nodesselection-rect{cursor:-webkit-grab;cursor:grab;pointer-events:all;position:absolute}.react-flow__handle{pointer-events:none;position:absolute}.react-flow__handle.connectable{pointer-events:all}.react-flow__handle-bottom{bottom:-4px;left:50%;top:auto;transform:translate(-50%)}.react-flow__handle-top{left:50%;top:-4px;transform:translate(-50%)}.react-flow__handle-left{left:-4px;top:50%;transform:translateY(-50%)}.react-flow__handle-right{right:-4px;top:50%;transform:translateY(-50%)}.react-flow__edgeupdater{cursor:move;pointer-events:all}.react-flow__controls{bottom:20px;left:15px;position:absolute;z-index:5}.react-flow__controls-button{border:none;height:24px;width:24px}.react-flow__controls-button svg{width:100%}.react-flow__minimap{bottom:20px;position:absolute;right:15px;z-index:5}.react-flow__attribution{background:hsla(0,0%,100%,.5);color:#999;font-size:10px;padding:2px 3px;position:absolute;z-index:1000}.react-flow__attribution a{color:#555;text-decoration:none}.react-flow__attribution.top{top:0}.react-flow__attribution.bottom{bottom:0}.react-flow__attribution.left{left:0}.react-flow__attribution.right{right:0}.react-flow__attribution.center{left:50%;transform:translateX(-50%)}",gO=pO,_O=".react-flow__edge.selected .react-flow__edge-path{stroke:#555}.react-flow__edge.animated path{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__edge.updating .react-flow__edge-path{stroke:#777}.react-flow__edge-path{stroke:#b1b1b7;stroke-width:1}.react-flow__edge-text{font-size:10px}.react-flow__edge-textbg{fill:#fff}.react-flow__connection-path{stroke:#b1b1b7;stroke-width:1}.react-flow__node{cursor:-webkit-grab;cursor:grab}.react-flow__node-default,.react-flow__node-group,.react-flow__node-input,.react-flow__node-output{background:#fff;border:1px solid #1a192b;border-radius:3px;color:#222;font-size:12px;padding:10px;text-align:center;width:150px}.react-flow__node-default.selected,.react-flow__node-group.selected,.react-flow__node-input.selected,.react-flow__node-output.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-default .react-flow__handle,.react-flow__node-group .react-flow__handle,.react-flow__node-input .react-flow__handle,.react-flow__node-output .react-flow__handle{background:#1a192b}.react-flow__node-default.selectable:hover,.react-flow__node-group.selectable:hover,.react-flow__node-input.selectable:hover,.react-flow__node-output.selectable:hover{box-shadow:0 1px 4px 1px rgba(0,0,0,.08)}.react-flow__node-default.selectable.selected,.react-flow__node-group.selectable.selected,.react-flow__node-input.selectable.selected,.react-flow__node-output.selectable.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-group{background:hsla(0,0%,94%,.25);border-color:#1a192b}.react-flow__nodesselection-rect,.react-flow__selection{background:rgba(0,89,220,.08);border:1px dotted rgba(0,89,220,.8)}.react-flow__handle{background:#555;border:1px solid #fff;border-radius:100%;height:6px;width:6px}.react-flow__handle.connectable{cursor:crosshair}.react-flow__minimap{background-color:#fff}.react-flow__controls{box-shadow:0 0 2px 1px rgba(0,0,0,.08)}.react-flow__controls-button{align-items:center;background:#fefefe;border-bottom:1px solid #eee;box-sizing:content-box;cursor:pointer;display:flex;height:16px;justify-content:center;padding:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:16px}.react-flow__controls-button svg{max-height:12px;max-width:12px}.react-flow__controls-button:hover{background:#f4f4f4}",yO=_O,vO=function(t,n,s){return s===Le.Left?t-n:s===Le.Right?t+n:t},xO=function(t,n,s){return s===Le.Top?t-n:s===Le.Bottom?t+n:t},ox=function(t){var n=t.className,s=t.position,r=t.centerX,i=t.centerY,l=t.radius,u=l===void 0?10:l;return ve.createElement("circle",{className:$t(["react-flow__edgeupdater",n]),cx:vO(r,u,s),cy:xO(i,u,s),r:u,stroke:"transparent",fill:"transparent"})},Ui=function(e){var t=function(s){var r=s.id,i=s.className,l=s.type,u=s.data,d=s.onClick,f=s.onEdgeDoubleClick,p=s.selected,m=s.animated,h=s.label,_=s.labelStyle,x=s.labelShowBg,y=s.labelBgStyle,v=s.labelBgPadding,w=s.labelBgBorderRadius,k=s.style,j=s.source,b=s.target,S=s.sourceX,E=s.sourceY,M=s.targetX,O=s.targetY,$=s.sourcePosition,P=s.targetPosition,A=s.elementsSelectable,R=s.hidden,F=s.sourceHandleId,z=s.targetHandleId,I=s.onContextMenu,U=s.onMouseEnter,q=s.onMouseMove,H=s.onMouseLeave,W=s.edgeUpdaterRadius,B=s.onEdgeUpdate,D=s.onEdgeUpdateStart,V=s.onEdgeUpdateEnd,te=s.markerEnd,G=s.markerStart,K=s.rfId,X=N.useState(!1),Q=yt(X,2),J=Q[0],Z=Q[1],ee=os(),de=function(et){var ot=ee.getState(),Nt=ot.edges,Tt=ot.addSelectedEdges,tt=Nt.find(function(Ft){return Ft.id===r});A&&(ee.setState({nodesSelectionActive:!1}),Tt([r])),d==null||d(et,tt)},_e=oc(r,ee.getState,f),ge=oc(r,ee.getState,I),be=oc(r,ee.getState,U),ze=oc(r,ee.getState,q),Ee=oc(r,ee.getState,H),ie=function(et,ot){var Nt=ot?b:j,Tt=(ot?z:F)||null,tt=ot?"target":"source",Ft=function(){return!0},Wt=ot,Pt=ee.getState().edges.find(function(jt){return jt.id===r});D==null||D(et,Pt,tt);var bn=V?function(jt){return V(jt,Pt,tt)}:void 0,gn=function(cn){return B==null?void 0:B(Pt,cn)};Zv({event:et,handleId:Tt,nodeId:Nt,onConnect:gn,isTarget:Wt,getState:ee.getState,setState:ee.setState,isValidConnection:Ft,elementEdgeUpdaterType:tt,onEdgeUpdateEnd:bn})},pe=function(et){return ie(et,!0)},Ce=function(et){return ie(et,!1)},Te=function(){return Z(!0)},De=function(){return Z(!1)},ce=N.useMemo(function(){return"url(#".concat(uh(G,K),")")},[G,K]),Oe=N.useMemo(function(){return"url(#".concat(uh(te,K),")")},[te,K]);if(R)return null;var qe=!A&&!d,Qe=typeof B<"u",Ye=$t(["react-flow__edge","react-flow__edge-".concat(l),i,{selected:p,animated:m,inactive:qe,updating:J}]);return ve.createElement("g",{className:Ye,onClick:de,onDoubleClick:_e,onContextMenu:ge,onMouseEnter:be,onMouseMove:ze,onMouseLeave:Ee},ve.createElement(e,{id:r,source:j,target:b,selected:p,animated:m,label:h,labelStyle:_,labelShowBg:x,labelBgStyle:y,labelBgPadding:v,labelBgBorderRadius:w,data:u,style:k,sourceX:S,sourceY:E,targetX:M,targetY:O,sourcePosition:$,targetPosition:P,sourceHandleId:F,targetHandleId:z,markerStart:ce,markerEnd:Oe,"data-testid":"rf__edge-".concat(r)}),Qe&&ve.createElement("g",{onMouseDown:pe,onMouseEnter:Te,onMouseOut:De},ve.createElement(ox,{position:$,centerX:S,centerY:E,radius:W})),Qe&&ve.createElement("g",{onMouseDown:Ce,onMouseEnter:Te,onMouseOut:De},ve.createElement(ox,{position:P,centerX:M,centerY:O,radius:W})))};return t.displayName="EdgeWrapper",N.memo(t)};function ix(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function lx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ix(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ix(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function bO(e){var t={default:Ui(e.default||Sh),straight:Ui(e.bezier||Xv),step:Ui(e.step||Gv),smoothstep:Ui(e.step||Ch),simplebezier:Ui(e.simplebezier||Hv)},n={},s=Object.keys(e).filter(function(r){return!["default","bezier"].includes(r)}).reduce(function(r,i){return r[i]=Ui(e[i]||Sh),r},n);return lx(lx({},t),s)}function cx(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,s=((n==null?void 0:n.x)||0)+t.x,r=((n==null?void 0:n.y)||0)+t.y,i=(n==null?void 0:n.width)||t.width,l=(n==null?void 0:n.height)||t.height;switch(e){case Le.Top:return{x:s+i/2,y:r};case Le.Right:return{x:s+i,y:r+l/2};case Le.Bottom:return{x:s+i/2,y:r+l};case Le.Left:return{x:s,y:r+l/2}}}function ux(e,t){if(!e)return null;var n=null;return e.length===1||!t?n=e[0]:t&&(n=e.find(function(s){return s.id===t})),typeof n>"u"?null:n}var wO=function(t,n,s,r,i,l){var u=cx(s,t,n),d=cx(l,r,i);return{sourceX:u.x,sourceY:u.y,targetX:d.x,targetY:d.y}};function NO(e){var t=e.sourcePos,n=e.targetPos,s=e.sourceWidth,r=e.sourceHeight,i=e.targetWidth,l=e.targetHeight,u=e.width,d=e.height,f=e.transform,p={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x+s,n.x+i),y2:Math.max(t.y+r,n.y+l)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);var m=sd({x:(0-f[0])/f[2],y:(0-f[1])/f[2],width:u/f[2],height:d/f[2]}),h=Math.max(0,Math.min(m.x2,p.x2)-Math.max(m.x,p.x)),_=Math.max(0,Math.min(m.y2,p.y2)-Math.max(m.y,p.y)),x=Math.ceil(h*_);return x>0}function dx(e,t){var n,s,r,i,l,u=e.get(t),d=(u==null||(n=u[Qn])===null||n===void 0?void 0:n.handleBounds)||null,f=!u||!d||!u.width||!u.height||typeof((s=u.positionAbsolute)===null||s===void 0?void 0:s.x)>"u"||typeof((r=u.positionAbsolute)===null||r===void 0?void 0:r.y)>"u";return[{x:(u==null||(i=u.positionAbsolute)===null||i===void 0?void 0:i.x)||0,y:(u==null||(l=u.positionAbsolute)===null||l===void 0?void 0:l.y)||0,width:(u==null?void 0:u.width)||0,height:(u==null?void 0:u.height)||0},d,!f]}var jO=typeof document<"u"?document:null,md=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:jO},n=N.useState(!1),s=yt(n,2),r=s[0],i=s[1],l=N.useRef(new Set([])),u=N.useMemo(function(){if(e!==null){var m=Array.isArray(e)?e:[e],h=m.filter(function(x){return typeof x=="string"}).map(function(x){return x.split("+")}),_=h.reduce(function(x,y){return x.concat.apply(x,Oo(y))},[]);return[h,_]}return[[],[]]},[e]),d=yt(u,2),f=d[0],p=d[1];return N.useEffect(function(){if(e!==null){var m,h,_=function(w){if(hx(w))return!1;var k=fx(w.code,p);l.current.add(w[k]),mx(f,l.current,!1)&&(w.preventDefault(),i(!0))},x=function(w){if(hx(w))return!1;var k=fx(w.code,p);mx(f,l.current,!0)?(i(!1),l.current.clear()):l.current.delete(w[k])},y=function(){l.current.clear(),i(!1)};return t==null||(m=t.target)===null||m===void 0||m.addEventListener("keydown",_),t==null||(h=t.target)===null||h===void 0||h.addEventListener("keyup",x),window.addEventListener("blur",y),function(){var v,w;t==null||(v=t.target)===null||v===void 0||v.removeEventListener("keydown",_),t==null||(w=t.target)===null||w===void 0||w.removeEventListener("keyup",x),window.removeEventListener("blur",y)}}},[e,i]),r};function mx(e,t,n){return e.filter(function(s){return n||s.length===t.size}).some(function(s){return s.every(function(r){return t.has(r)})})}function fx(e,t){return t.includes(e)?"code":"key"}function hx(e){var t,n=((t=e.composedPath)===null||t===void 0?void 0:t.call(e)[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n==null?void 0:n.nodeName)||(n==null?void 0:n.hasAttribute("contenteditable"))}var CO=function(t){return{onNodesChange:t.onNodesChange,onEdgesChange:t.onEdgesChange}},SO=function(e){var t=e.deleteKeyCode,n=e.multiSelectionKeyCode,s=os(),r=On(CO,Vs),i=r.onNodesChange,l=r.onEdgesChange,u=md(t),d=md(n);N.useEffect(function(){var f=s.getState(),p=f.nodeInternals,m=f.edges,h=f.hasDefaultNodes,_=f.hasDefaultEdges,x=f.onNodesDelete,y=f.onEdgesDelete,v=Array.from(p.values()),w=v.reduce(function(O,$){return(!$.selected&&$.parentNode&&O.find(function(P){return P.id===$.parentNode})||$.selected)&&O.push($),O},[]),k=m.filter(function(O){return O.selected});if(u&&(w||k)){var j=Sv(w,m),b=[].concat(Oo(k),Oo(j)),S=b.reduce(function(O,$){return O.includes($.id)||O.push($.id),O},[]);if((_||h)&&(_&&s.setState({edges:m.filter(function(O){return!S.includes(O.id)})}),h&&(w.forEach(function(O){p.delete(O.id)}),s.setState({nodeInternals:new Map(p)}))),S.length>0&&(y==null||y(b),l)){var E=S.map(function(O){return{id:O,type:"remove"}});l(E)}if(w.length>0&&(x==null||x(w),i)){var M=w.map(function(O){return{id:O.id,type:"remove"}});i(M)}s.setState({nodesSelectionActive:!1})}},[u,i,l]),N.useEffect(function(){s.setState({multiSelectionActive:d})},[d])};function EO(e){var t=os();N.useEffect(function(){var n,s=function(){if(e.current){var i=ch(e.current);t.setState({width:i.width||500,height:i.height||500})}};return s(),window.onresize=s,e.current&&(n=new ResizeObserver(function(){return s()}),n.observe(e.current)),function(){window.onresize=null,n&&e.current&&n.unobserve(e.current)}},[])}var kO=function(t,n){return t.x!==n.x||t.y!==n.y||t.zoom!==n.k},$h=function(t){return{x:t.x,y:t.y,zoom:t.k}},fd=function(t,n){return t.target.closest(".".concat(n))},MO=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection,d3ZoomHandler:t.d3ZoomHandler}},AO=function(t){var n=t.onMove,s=t.onMoveStart,r=t.onMoveEnd,i=t.zoomOnScroll,l=i===void 0?!0:i,u=t.zoomOnPinch,d=u===void 0?!0:u,f=t.panOnScroll,p=f===void 0?!1:f,m=t.panOnScrollSpeed,h=m===void 0?.5:m,_=t.panOnScrollMode,x=_===void 0?Ri.Free:_,y=t.zoomOnDoubleClick,v=y===void 0?!0:y,w=t.selectionKeyPressed,k=t.elementsSelectable,j=t.panOnDrag,b=j===void 0?!0:j,S=t.translateExtent,E=t.minZoom,M=t.maxZoom,O=t.defaultZoom,$=O===void 0?1:O,P=t.defaultPosition,A=P===void 0?[0,0]:P,R=t.zoomActivationKeyCode,F=t.preventScrolling,z=F===void 0?!0:F,I=t.children,U=t.noWheelClassName,q=t.noPanClassName,H=os(),W=N.useRef(!1),B=N.useRef(null),D=N.useRef({x:0,y:0,zoom:0}),V=On(MO,Vs),te=V.d3Zoom,G=V.d3Selection,K=V.d3ZoomHandler,X=md(R);return EO(B),N.useEffect(function(){if(B.current){var Q,J=ih().scaleExtent([E,M]).translateExtent(S),Z=ps(B.current).call(J),ee=Di(A[0],S[0][0],S[1][0]),de=Di(A[1],S[0][1],S[1][1]),_e=Di($,E,M),ge=ra.translate(ee,de).scale(_e);J.transform(Z,ge),H.setState({d3Zoom:J,d3Selection:Z,d3ZoomHandler:Z.on("wheel.zoom"),transform:[ee,de,_e],domNode:(Q=Z.node())===null||Q===void 0?void 0:Q.closest(".react-flow")})}},[]),N.useEffect(function(){G&&te&&(p&&!X?G.on("wheel",function(Q){if(fd(Q,U))return!1;Q.preventDefault(),Q.stopImmediatePropagation();var J=G.property("__zoom").k||1;if(Q.ctrlKey&&d){var Z=cr(Q),ee=-Q.deltaY*(Q.deltaMode===1?.05:Q.deltaMode?1:.002)*10,de=J*Math.pow(2,ee);te.scaleTo(G,de,Z);return}var _e=Q.deltaMode===1?20:1,ge=x===Ri.Vertical?0:Q.deltaX*_e,be=x===Ri.Horizontal?0:Q.deltaY*_e;te.translateBy(G,-(ge/J)*h,-(be/J)*h)}).on("wheel.zoom",null):typeof K<"u"&&G.on("wheel",function(Q){if(!z||fd(Q,U))return null;Q.preventDefault()}).on("wheel.zoom",K))},[p,x,G,te,K,X,d,z,U]),N.useEffect(function(){te&&(w&&!W.current?te.on("zoom",null):w||te.on("zoom",function(Q){if(H.setState({transform:[Q.transform.x,Q.transform.y,Q.transform.k]}),n){var J=$h(Q.transform);n(Q.sourceEvent,J)}}))},[w,te,n]),N.useEffect(function(){te&&te.on("start",function(Q){if(W.current=!0,s){var J=$h(Q.transform);D.current=J,s(Q.sourceEvent,J)}})},[te,s]),N.useEffect(function(){te&&te.on("end",function(Q){if(W.current=!1,r&&kO(D.current,Q.transform)){var J=$h(Q.transform);D.current=J,r(Q.sourceEvent,J)}})},[te,r]),N.useEffect(function(){te&&te.filter(function(Q){var J=X||l,Z=d&&Q.ctrlKey;return!b&&!J&&!p&&!v&&!d||w||!v&&Q.type==="dblclick"||fd(Q,U)&&Q.type==="wheel"||fd(Q,q)&&Q.type!=="wheel"||!d&&Q.ctrlKey&&Q.type==="wheel"||!J&&!p&&!Z&&Q.type==="wheel"||!b&&(Q.type==="mousedown"||Q.type==="touchstart")?!1:(!Q.ctrlKey||Q.type==="wheel")&&!Q.button})},[te,l,d,p,v,b,w,k,X]),ve.createElement("div",{className:"react-flow__renderer react-flow__container",ref:B},I)};function px(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function gx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?px(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):px(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function _x(e,t){return{x:e.clientX-t.left,y:e.clientY-t.top}}var OO=function(t){return{userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable}},yx={startX:0,startY:0,x:0,y:0,width:0,height:0,draw:!1},$O=N.memo(function(e){var t=e.selectionKeyPressed,n=os(),s=N.useRef(0),r=N.useRef(0),i=N.useRef(),l=N.useState(yx),u=yt(l,2),d=u[0],f=u[1],p=On(OO,Vs),m=p.userSelectionActive,h=p.elementsSelectable,_=m||t;if(!h||!_)return null;var x=function(){f(yx),n.setState({userSelectionActive:!1}),s.current=0,r.current=0},y=function(b){var S=b.target.closest(".react-flow");i.current=S.getBoundingClientRect();var E=_x(b,i.current);f({width:0,height:0,startX:E.x,startY:E.y,x:E.x,y:E.y,draw:!0}),n.setState({userSelectionActive:!0,nodesSelectionActive:!1})},v=function(b){var S,E;if(!(!t||!d.draw||!i.current)){var M=_x(b,i.current),O=(S=d.startX)!==null&&S!==void 0?S:0,$=(E=d.startY)!==null&&E!==void 0?E:0,P=gx(gx({},d),{},{x:M.x<O?M.x:O,y:M.y<$?M.y:$,width:Math.abs(M.x-O),height:Math.abs(M.y-$)}),A=n.getState(),R=A.nodeInternals,F=A.edges,z=A.transform,I=A.onNodesChange,U=A.onEdgesChange,q=Array.from(R.values()),H=Cv(R,P,z,!1,!0),W=Sv(H,F).map(function(te){return te.id}),B=H.map(function(te){return te.id});if(s.current!==B.length){s.current=B.length;var D=Ii(q,B);D.length&&(I==null||I(D))}if(r.current!==W.length){r.current=W.length;var V=Ii(F,W);V.length&&(U==null||U(V))}f(P)}},w=function(){n.setState({nodesSelectionActive:s.current>0}),x()},k=function(){n.setState({nodesSelectionActive:!1}),x()};return ve.createElement("div",{className:"react-flow__selectionpane react-flow__container",onMouseDown:y,onMouseMove:v,onMouseUp:w,onMouseLeave:k},d.draw&&ve.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:d.width,height:d.height,transform:"translate(".concat(d.x,"px, ").concat(d.y,"px)")}}))});function vx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function xx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vx(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function bx(e,t){if(!e.parentNode)return!1;var n=t.get(e.parentNode);return n?n.selected?!0:bx(n,t):!1}function wx(e,t,n){var s=e;do{var r;if((r=s)!==null&&r!==void 0&&r.matches(t))return!0;if(s===n.current)return!1;s=s.parentElement}while(s);return!1}function TO(e,t,n){return Array.from(e.values()).filter(function(s){return(s.selected||s.id===n)&&(!s.parentNode||!bx(s,e))}).map(function(s){var r,i,l,u;return{id:s.id,position:s.position||{x:0,y:0},positionAbsolute:s.positionAbsolute||{x:0,y:0},distance:{x:t.x-((r=(i=s.positionAbsolute)===null||i===void 0?void 0:i.x)!==null&&r!==void 0?r:0),y:t.y-((l=(u=s.positionAbsolute)===null||u===void 0?void 0:u.y)!==null&&l!==void 0?l:0)},delta:{x:0,y:0},extent:s.extent,parentNode:s.parentNode,width:s.width,height:s.height}})}function PO(e,t,n,s,r,i){var l=yt(s,2),u=l[0],d=l[1],f=e.extent||i,p={x:t.x-e.distance.x,y:t.y-e.distance.y};if(n&&(p.x=u*Math.round(p.x/u),p.y=d*Math.round(p.y/d)),e.extent==="parent")if(e.parentNode&&e.width&&e.height){var m=r.get(e.parentNode);f=m!=null&&m.positionAbsolute&&m!==null&&m!==void 0&&m.width&&m!==null&&m!==void 0&&m.height?[[m.positionAbsolute.x,m.positionAbsolute.y],[m.positionAbsolute.x+m.width-e.width,m.positionAbsolute.y+m.height-e.height]]:f}else f=i;else if(e.extent&&e.parentNode){var h,_,x,y,v=r.get(e.parentNode),w=(h=v==null||(_=v.positionAbsolute)===null||_===void 0?void 0:_.x)!==null&&h!==void 0?h:0,k=(x=v==null||(y=v.positionAbsolute)===null||y===void 0?void 0:y.y)!==null&&x!==void 0?x:0;f=[[e.extent[0][0]+w,e.extent[0][1]+k],[e.extent[1][0]+w,e.extent[1][1]+k]]}var j={x:0,y:0};if(e.parentNode){var b,S,E,M,O=r.get(e.parentNode);j={x:(b=O==null||(S=O.positionAbsolute)===null||S===void 0?void 0:S.x)!==null&&b!==void 0?b:0,y:(E=O==null||(M=O.positionAbsolute)===null||M===void 0?void 0:M.y)!==null&&E!==void 0?E:0}}return e.positionAbsolute=f?dv(p,f):p,e.position={x:e.positionAbsolute.x-j.x,y:e.positionAbsolute.y-j.y},e}function Th(e){var t=e.nodeId,n=e.dragItems,s=e.nodeInternals,r=n.map(function(i){var l=s.get(i.id);return xx(xx({},l),{},{position:i.position,positionAbsolute:i.positionAbsolute})});return[t?r.find(function(i){return i.id===t}):r[0],r]}function Ph(e){return function(t,n,s){return e==null?void 0:e(t,s)}}function Nx(e){var t=e.nodeRef,n=e.disabled,s=n===void 0?!1:n,r=e.noDragClassName,i=e.handleSelector,l=e.nodeId,u=e.isSelectable,d=e.selectNodesOnDrag,f=N.useState(!1),p=yt(f,2),m=p[0],h=p[1],_=os(),x=N.useRef(),y=N.useRef({x:null,y:null}),v=N.useCallback(function(w){var k=w.sourceEvent,j=_.getState(),b=j.transform,S=j.snapGrid,E=j.snapToGrid,M=k.touches?k.touches[0].clientX:k.clientX,O=k.touches?k.touches[0].clientY:k.clientY,$=jv({x:M,y:O},b,E,S);return $},[]);return N.useEffect(function(){if(t!=null&&t.current){var w=ps(t.current);if(s)w.on(".drag",null);else{var k=Wf().on("start",function(j){var b=_.getState(),S=b.nodeInternals,E=b.multiSelectionActive,M=b.unselectNodesAndEdges,O=b.onNodeDragStart,$=b.onSelectionDragStart,P=l?O:Ph($);if(!d&&!E&&l){var A;(A=S.get(l))!==null&&A!==void 0&&A.selected||M()}l&&u&&d&&bv({id:l,store:_});var R=v(j);if(y.current=R,x.current=TO(S,R,l),P&&x.current){var F=Th({nodeId:l,dragItems:x.current,nodeInternals:S}),z=yt(F,2),I=z[0],U=z[1];P(j.sourceEvent,I,U)}}).on("drag",function(j){var b=_.getState(),S=b.updateNodePositions,E=b.snapToGrid,M=b.snapGrid,O=b.nodeInternals,$=b.nodeExtent,P=b.onNodeDrag,A=b.onSelectionDrag,R=v(j);if((y.current.x!==R.x||y.current.y!==R.y)&&x.current){y.current=R,x.current=x.current.map(function(H){return PO(H,R,E,M,O,$)});var F=l?P:Ph(A);if(S(x.current,!0,!0),h(!0),F){var z=Th({nodeId:l,dragItems:x.current,nodeInternals:O}),I=yt(z,2),U=I[0],q=I[1];F(j.sourceEvent,U,q)}}j.on("end",function(H){if(h(!1),x.current){var W=_.getState(),B=W.updateNodePositions,D=W.nodeInternals,V=W.onNodeDragStop,te=W.onSelectionDragStop,G=l?V:Ph(te);if(B(x.current,!1,!1),G){var K=Th({nodeId:l,dragItems:x.current,nodeInternals:D}),X=yt(K,2),Q=X[0],J=X[1];G(H.sourceEvent,Q,J)}}})}).filter(function(j){var b=j.target,S=!j.button&&(!r||!wx(b,".".concat(r),t))&&(!i||wx(b,i,t));return S});return w.call(k),function(){w.on(".drag",null)}}}},[t,s,r,i,u,_,l,d,v]),m}function jx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function LO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jx(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var zO=function(t){return LO({transformString:"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")"),userSelectionActive:t.userSelectionActive},dh(Array.from(t.nodeInternals.values()).filter(function(n){return n.selected})))},RO=function(t){var n=Array.from(t.nodeInternals.values()).filter(function(s){return s.selected});return dh(n)};function DO(e){var t=e.onSelectionContextMenu,n=e.noPanClassName,s=os(),r=On(zO,Vs),i=r.transformString,l=r.userSelectionActive,u=On(RO,Vs),d=u.width,f=u.height,p=u.x,m=u.y,h=N.useRef(null);if(Nx({nodeRef:h}),l||!d||!f)return null;var _=t?function(x){var y=Array.from(s.getState().nodeInternals.values()).filter(function(v){return v.selected});t(x,y)}:void 0;return ve.createElement("div",{className:$t(["react-flow__nodesselection","react-flow__container",n]),style:{transform:i}},ve.createElement("div",{ref:h,className:"react-flow__nodesselection-rect",onContextMenu:_,style:{width:d,height:f,top:m,left:p}}))}var IO=N.memo(DO),FO=function(t){return t.nodesSelectionActive},Cx=function(t){var n=t.children,s=t.onPaneClick,r=t.onPaneContextMenu,i=t.onPaneScroll,l=t.deleteKeyCode,u=t.onMove,d=t.onMoveStart,f=t.onMoveEnd,p=t.selectionKeyCode,m=t.multiSelectionKeyCode,h=t.zoomActivationKeyCode,_=t.elementsSelectable,x=t.zoomOnScroll,y=t.zoomOnPinch,v=t.panOnScroll,w=t.panOnScrollSpeed,k=t.panOnScrollMode,j=t.zoomOnDoubleClick,b=t.panOnDrag,S=t.translateExtent,E=t.minZoom,M=t.maxZoom,O=t.defaultZoom,$=t.defaultPosition,P=t.preventScrolling,A=t.onSelectionContextMenu,R=t.noWheelClassName,F=t.noPanClassName,z=os(),I=On(FO),U=md(p);SO({deleteKeyCode:l,multiSelectionKeyCode:m});var q=function(D){s==null||s(D),z.getState().resetSelectedElements(),z.setState({nodesSelectionActive:!1})},H=r?function(B){return r(B)}:void 0,W=i?function(B){return i(B)}:void 0;return ve.createElement(AO,{onMove:u,onMoveStart:d,onMoveEnd:f,selectionKeyPressed:U,elementsSelectable:_,zoomOnScroll:x,zoomOnPinch:y,panOnScroll:v,panOnScrollSpeed:w,panOnScrollMode:k,zoomOnDoubleClick:j,panOnDrag:b,translateExtent:S,minZoom:E,maxZoom:M,defaultZoom:O,defaultPosition:$,zoomActivationKeyCode:h,preventScrolling:P,noWheelClassName:R,noPanClassName:F},n,ve.createElement($O,{selectionKeyPressed:U}),I&&ve.createElement(IO,{onSelectionContextMenu:A,noPanClassName:F}),ve.createElement("div",{className:"react-flow__pane react-flow__container",onClick:q,onContextMenu:H,onWheel:W}))};Cx.displayName="FlowRenderer";var BO=N.memo(Cx);function UO(e){var t=On(N.useCallback(function(n){return e?Cv(n.nodeInternals,{x:0,y:0,width:n.width,height:n.height},n.transform,!0):Array.from(n.nodeInternals.values())},[e]));return t}var HO=function(t){return{nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,updateNodeDimensions:t.updateNodeDimensions}},Sx=function(t){var n=On(HO,Vs),s=n.nodesDraggable,r=n.nodesConnectable,i=n.elementsSelectable,l=n.updateNodeDimensions,u=UO(t.onlyRenderVisibleElements),d=N.useRef(),f=N.useMemo(function(){if(typeof ResizeObserver>"u")return null;var p=new ResizeObserver(function(m){var h=m.map(function(_){return{id:_.target.getAttribute("data-id"),nodeElement:_.target,forceUpdate:!0}});l(h)});return d.current=p,p},[]);return N.useEffect(function(){return function(){var p;d==null||(p=d.current)===null||p===void 0||p.disconnect()}},[]),ve.createElement("div",{className:"react-flow__nodes react-flow__container"},u.map(function(p){var m,h,_,x,y,v,w,k=p.type||"default";t.nodeTypes[k]||(k="default");var j=t.nodeTypes[k]||t.nodeTypes.default,b=!!(p.draggable||s&&typeof p.draggable>"u"),S=!!(p.selectable||i&&typeof p.selectable>"u"),E=!!(p.connectable||r&&typeof p.connectable>"u");return ve.createElement(j,{key:p.id,id:p.id,className:p.className,style:p.style,type:k,data:p.data,sourcePosition:p.sourcePosition||Le.Bottom,targetPosition:p.targetPosition||Le.Top,hidden:p.hidden,xPos:(m=(h=p.positionAbsolute)===null||h===void 0?void 0:h.x)!==null&&m!==void 0?m:0,yPos:(_=(x=p.positionAbsolute)===null||x===void 0?void 0:x.y)!==null&&_!==void 0?_:0,selectNodesOnDrag:t.selectNodesOnDrag,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,selected:!!p.selected,isDraggable:b,isSelectable:S,isConnectable:E,resizeObserver:f,dragHandle:p.dragHandle,zIndex:(y=(v=p[Qn])===null||v===void 0?void 0:v.z)!==null&&y!==void 0?y:0,isParent:!!((w=p[Qn])!==null&&w!==void 0&&w.isParent),noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,initialized:!!p.width&&!!p.height})}))};Sx.displayName="NodeRenderer";var qO=N.memo(Sx),Hi;function Ex(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function kx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ex(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ex(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var VO=(Hi={},Et(Hi,Le.Left,Le.Right),Et(Hi,Le.Right,Le.Left),Et(Hi,Le.Top,Le.Bottom),Et(Hi,Le.Bottom,Le.Top),Hi),WO=function(e){var t,n,s,r,i,l=e.connectionNodeId,u=e.connectionHandleType,d=e.connectionLineStyle,f=e.connectionLineType,p=f===void 0?Ta.Bezier:f,m=e.isConnectable,h=e.CustomConnectionLineComponent,_=On(N.useCallback(function(W){return{fromNode:W.nodeInternals.get(l),handleId:W.connectionHandleId,toX:(W.connectionPosition.x-W.transform[0])/W.transform[2],toY:(W.connectionPosition.y-W.transform[1])/W.transform[2]}},[l]),Vs),x=_.fromNode,y=_.handleId,v=_.toX,w=_.toY,k=x==null||(t=x[Qn])===null||t===void 0?void 0:t.handleBounds;if(!x||!m||!(k!=null&&k[u]))return null;var j=k[u],b=y?j.find(function(W){return W.id===y}):j[0],S=b?b.x+b.width/2:((n=x==null?void 0:x.width)!==null&&n!==void 0?n:0)/2,E=b?b.y+b.height/2:(s=x==null?void 0:x.height)!==null&&s!==void 0?s:0,M=((x==null||(r=x.positionAbsolute)===null||r===void 0?void 0:r.x)||0)+S,O=((x==null||(i=x.positionAbsolute)===null||i===void 0?void 0:i.y)||0)+E,$=b==null?void 0:b.position;if(!$)return null;var P=VO[$],A,R,F,z,I,U;switch(u){case"source":A=M,R=O,F=$,z=v,I=w,U=P;break;case"target":A=v,R=w,F=P,z=M,I=O,U=$;break}if(h)return ve.createElement("g",{className:"react-flow__connection"},ve.createElement(h,{connectionLineType:p,connectionLineStyle:d,fromNode:x,fromHandle:b,fromX:M,fromY:O,toX:v,toY:w,fromPosition:$,toPosition:P,sourcePosition:F,targetPosition:U,sourceNode:x,sourceHandle:b,targetX:z,targetY:I,sourceX:A,sourceY:R}));var q="",H={sourceX:A,sourceY:R,sourcePosition:F,targetX:z,targetY:I,targetPosition:U};return p===Ta.Bezier?q=Qv(H):p===Ta.Step?q=jh(kx(kx({},H),{},{borderRadius:0})):p===Ta.SmoothStep?q=jh(H):p===Ta.SimpleBezier?q=Uv(H):q="M".concat(A,",").concat(R," ").concat(z,",").concat(I),ve.createElement("g",{className:"react-flow__connection"},ve.createElement("path",{d:q,className:"react-flow__connection-path",style:d}))};function Lh(e){"@babel/helpers - typeof";return Lh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lh(e)}var hd,YO=function(t){var n=t.color,s=n===void 0?"none":n,r=t.strokeWidth,i=r===void 0?1:r;return ve.createElement("polyline",{stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:i,fill:"none",points:"-5,-4 0,0 -5,4"})},KO=function(t){var n=t.color,s=n===void 0?"none":n,r=t.strokeWidth,i=r===void 0?1:r;return ve.createElement("polyline",{stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:i,fill:s,points:"-5,-4 0,0 -5,4 -5,-4"})},Mx=(hd={},Et(hd,nd.Arrow,YO),Et(hd,nd.ArrowClosed,KO),hd);function GO(e){var t=N.useMemo(function(){var n=Mx.hasOwnProperty(e);return n?Mx[e]:function(){return null}},[e]);return t}function Ax(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function XO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ax(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ax(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var QO=function(t){var n=t.id,s=t.type,r=t.color,i=t.width,l=i===void 0?12.5:i,u=t.height,d=u===void 0?12.5:u,f=t.markerUnits,p=f===void 0?"strokeWidth":f,m=t.strokeWidth,h=t.orient,_=h===void 0?"auto":h,x=GO(s);return ve.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:"".concat(l),markerHeight:"".concat(d),viewBox:"-10 -10 20 20",markerUnits:p,orient:_,refX:"0",refY:"0"},ve.createElement(x,{color:r,strokeWidth:m}))},ZO=function(t){var n=t.defaultColor,s=t.rfId;return function(r){var i=[];return r.edges.reduce(function(l,u){return[u.markerStart,u.markerEnd].forEach(function(d){if(d&&Lh(d)==="object"){var f=uh(d,s);i.includes(f)||(l.push(XO({id:f,color:d.color||n},d)),i.push(f))}}),l},[]).sort(function(l,u){return l.id.localeCompare(u.id)})}},Ox=function(t){var n=t.defaultColor,s=t.rfId,r=On(N.useCallback(ZO({defaultColor:n,rfId:s}),[n,s]),function(i,l){return!(i.length!==l.length||i.some(function(u,d){return u.id!==l[d].id}))});return ve.createElement("defs",null,r.map(function(i){return ve.createElement(QO,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})}))};Ox.displayName="MarkerDefinitions";var JO=N.memo(Ox),e2=[{level:0,isMaxLevel:!0,edges:[]}];function t2(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=-1,r=e.reduce(function(l,u){var d=fv(u.zIndex),f=d?u.zIndex:0;if(n){var p,m,h,_;f=d?u.zIndex:Math.max(((p=t.get(u.source))===null||p===void 0||(m=p[Qn])===null||m===void 0?void 0:m.z)||0,((h=t.get(u.target))===null||h===void 0||(_=h[Qn])===null||_===void 0?void 0:_.z)||0)}return l[f]?l[f].push(u):l[f]=[u],s=f>s?f:s,l},{}),i=Object.entries(r).map(function(l){var u=yt(l,2),d=u[0],f=u[1],p=+d;return{edges:f,level:p,isMaxLevel:p===s}});return i.length===0?e2:i}function n2(e,t,n){var s=On(N.useCallback(function(r){return e?r.edges.filter(function(i){var l=t.get(i.source),u=t.get(i.target);return(l==null?void 0:l.width)&&(l==null?void 0:l.height)&&(u==null?void 0:u.width)&&(u==null?void 0:u.height)&&NO({sourcePos:l.positionAbsolute||{x:0,y:0},targetPos:u.positionAbsolute||{x:0,y:0},sourceWidth:l.width,sourceHeight:l.height,targetWidth:u.width,targetHeight:u.height,width:r.width,height:r.height,transform:r.transform})}):r.edges},[e,t]));return t2(s,t,n)}var s2=function(t){return{connectionNodeId:t.connectionNodeId,connectionHandleType:t.connectionHandleType,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,width:t.width,height:t.height,connectionMode:t.connectionMode,nodeInternals:t.nodeInternals}},$x=function(t){var n=On(s2,Vs),s=n.connectionNodeId,r=n.connectionHandleType,i=n.nodesConnectable,l=n.elementsSelectable,u=n.width,d=n.height,f=n.connectionMode,p=n.nodeInternals,m=n2(t.onlyRenderVisibleElements,p,t.elevateEdgesOnSelect);if(!u)return null;var h=t.connectionLineType,_=t.defaultMarkerColor,x=t.connectionLineStyle,y=t.connectionLineComponent,v=t.connectionLineContainerStyle,w=s&&r;return ve.createElement(ve.Fragment,null,m.map(function(k){var j=k.level,b=k.edges,S=k.isMaxLevel;return ve.createElement("svg",{key:j,style:{zIndex:j},width:u,height:d,className:"react-flow__edges react-flow__container"},S&&ve.createElement(JO,{defaultColor:_,rfId:t.rfId}),ve.createElement("g",null,b.map(function(E){var M=dx(p,E.source),O=yt(M,3),$=O[0],P=O[1],A=O[2],R=dx(p,E.target),F=yt(R,3),z=F[0],I=F[1],U=F[2];if(!A||!U)return null;var q=E.type||"default";t.edgeTypes[q]||(console.warn('[React Flow]: Edge type "'.concat(q,'" not found. Using fallback type "default". Help: https://reactflow.dev/error#300')),q="default");var H=t.edgeTypes[q]||t.edgeTypes.default,W=f===Mo.Strict?I.target:I.target||I.source,B=ux(P.source,E.sourceHandle||null),D=ux(W,E.targetHandle||null),V=(B==null?void 0:B.position)||Le.Bottom,te=(D==null?void 0:D.position)||Le.Top;if(!B||!D)return null;var G=wO($,B,V,z,D,te),K=G.sourceX,X=G.sourceY,Q=G.targetX,J=G.targetY;return ve.createElement(H,{key:E.id,id:E.id,className:$t([E.className,t.noPanClassName]),type:q,data:E.data,selected:!!E.selected,animated:!!E.animated,hidden:!!E.hidden,label:E.label,labelStyle:E.labelStyle,labelShowBg:E.labelShowBg,labelBgStyle:E.labelBgStyle,labelBgPadding:E.labelBgPadding,labelBgBorderRadius:E.labelBgBorderRadius,style:E.style,source:E.source,target:E.target,sourceHandleId:E.sourceHandle,targetHandleId:E.targetHandle,markerEnd:E.markerEnd,markerStart:E.markerStart,sourceX:K,sourceY:X,targetX:Q,targetY:J,sourcePosition:V,targetPosition:te,elementsSelectable:l,onEdgeUpdate:t.onEdgeUpdate,onContextMenu:t.onEdgeContextMenu,onMouseEnter:t.onEdgeMouseEnter,onMouseMove:t.onEdgeMouseMove,onMouseLeave:t.onEdgeMouseLeave,onClick:t.onEdgeClick,edgeUpdaterRadius:t.edgeUpdaterRadius,onEdgeDoubleClick:t.onEdgeDoubleClick,onEdgeUpdateStart:t.onEdgeUpdateStart,onEdgeUpdateEnd:t.onEdgeUpdateEnd,rfId:t.rfId})})))}),w&&ve.createElement("svg",{style:v,width:u,height:d,className:"react-flow__edges react-flow__connectionline react-flow__container"},ve.createElement(WO,{connectionNodeId:s,connectionHandleType:r,connectionLineStyle:x,connectionLineType:h,isConnectable:i,CustomConnectionLineComponent:y})))};$x.displayName="EdgeRenderer";var r2=N.memo($x),a2=function(t){return"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")")};function o2(e){var t=e.children,n=On(a2);return ve.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:n}},t)}function i2(e){var t=ph(),n=N.useRef(!1);N.useEffect(function(){!n.current&&t.viewportInitialized&&e&&(setTimeout(function(){return e(t)},1),n.current=!0)},[e,t.viewportInitialized])}var Tx=function(t){var n=t.nodeTypes,s=t.edgeTypes,r=t.onMove,i=t.onMoveStart,l=t.onMoveEnd,u=t.onInit,d=t.onNodeClick,f=t.onEdgeClick,p=t.onNodeDoubleClick,m=t.onEdgeDoubleClick,h=t.onNodeMouseEnter,_=t.onNodeMouseMove,x=t.onNodeMouseLeave,y=t.onNodeContextMenu,v=t.onSelectionContextMenu,w=t.connectionLineType,k=t.connectionLineStyle,j=t.connectionLineComponent,b=t.connectionLineContainerStyle,S=t.selectionKeyCode,E=t.multiSelectionKeyCode,M=t.zoomActivationKeyCode,O=t.deleteKeyCode,$=t.onlyRenderVisibleElements,P=t.elementsSelectable,A=t.selectNodesOnDrag,R=t.translateExtent,F=t.minZoom,z=t.maxZoom,I=t.defaultZoom,U=t.defaultPosition,q=t.preventScrolling,H=t.defaultMarkerColor,W=t.zoomOnScroll,B=t.zoomOnPinch,D=t.panOnScroll,V=t.panOnScrollSpeed,te=t.panOnScrollMode,G=t.zoomOnDoubleClick,K=t.panOnDrag,X=t.onPaneClick,Q=t.onPaneScroll,J=t.onPaneContextMenu,Z=t.onEdgeUpdate,ee=t.onEdgeContextMenu,de=t.onEdgeMouseEnter,_e=t.onEdgeMouseMove,ge=t.onEdgeMouseLeave,be=t.edgeUpdaterRadius,ze=t.onEdgeUpdateStart,Ee=t.onEdgeUpdateEnd,ie=t.noDragClassName,pe=t.noWheelClassName,Ce=t.noPanClassName,Te=t.elevateEdgesOnSelect,De=t.id;return i2(u),ve.createElement(BO,{onPaneClick:X,onPaneContextMenu:J,onPaneScroll:Q,deleteKeyCode:O,selectionKeyCode:S,multiSelectionKeyCode:E,zoomActivationKeyCode:M,elementsSelectable:P,onMove:r,onMoveStart:i,onMoveEnd:l,zoomOnScroll:W,zoomOnPinch:B,zoomOnDoubleClick:G,panOnScroll:D,panOnScrollSpeed:V,panOnScrollMode:te,panOnDrag:K,translateExtent:R,minZoom:F,maxZoom:z,defaultZoom:I,defaultPosition:U,onSelectionContextMenu:v,preventScrolling:q,noDragClassName:ie,noWheelClassName:pe,noPanClassName:Ce},ve.createElement(o2,null,ve.createElement(r2,{edgeTypes:s,onEdgeClick:f,onEdgeDoubleClick:m,connectionLineType:w,connectionLineStyle:k,connectionLineComponent:j,connectionLineContainerStyle:b,onEdgeUpdate:Z,onlyRenderVisibleElements:$,onEdgeContextMenu:ee,onEdgeMouseEnter:de,onEdgeMouseMove:_e,onEdgeMouseLeave:ge,onEdgeUpdateStart:ze,onEdgeUpdateEnd:Ee,edgeUpdaterRadius:be,defaultMarkerColor:H,noPanClassName:Ce,elevateEdgesOnSelect:!!Te,rfId:De}),ve.createElement(qO,{nodeTypes:n,onNodeClick:d,onNodeDoubleClick:p,onNodeMouseEnter:h,onNodeMouseMove:_,onNodeMouseLeave:x,onNodeContextMenu:y,selectNodesOnDrag:A,onlyRenderVisibleElements:$,noPanClassName:Ce,noDragClassName:ie})))};Tx.displayName="GraphView";var l2=N.memo(Tx),Px=function(){return null};Px.displayName="GroupNode";function Lx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function zx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lx(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var lc=function(e){var t=function(s){var r=s.id,i=s.type,l=s.data,u=s.xPos,d=s.yPos,f=s.selected,p=s.onClick,m=s.onMouseEnter,h=s.onMouseMove,_=s.onMouseLeave,x=s.onContextMenu,y=s.onDoubleClick,v=s.style,w=s.className,k=s.isDraggable,j=s.isSelectable,b=s.isConnectable,S=s.selectNodesOnDrag,E=s.sourcePosition,M=s.targetPosition,O=s.hidden,$=s.resizeObserver,P=s.dragHandle,A=s.zIndex,R=s.isParent,F=s.noPanClassName,z=s.noDragClassName,I=s.initialized,U=os(),q=N.useRef(null),H=N.useRef(E),W=N.useRef(M),B=N.useRef(i),D=j||k||p||m||h||_,V=rc(r,U.getState,m),te=rc(r,U.getState,h),G=rc(r,U.getState,_),K=rc(r,U.getState,x),X=rc(r,U.getState,y),Q=function(ee){if(j&&(!S||!k)&&bv({id:r,store:U}),p){var de=U.getState().nodeInternals.get(r);p(ee,zx({},de))}};N.useEffect(function(){if(q.current&&!O){var Z=q.current;return $==null||$.observe(Z),function(){return $==null?void 0:$.unobserve(Z)}}},[O]),N.useEffect(function(){var Z=B.current!==i,ee=H.current!==E,de=W.current!==M;q.current&&(Z||ee||de)&&(Z&&(B.current=i),ee&&(H.current=E),de&&(W.current=M),U.getState().updateNodeDimensions([{id:r,nodeElement:q.current,forceUpdate:!0}]))},[r,i,E,M]);var J=Nx({nodeRef:q,disabled:O||!k,noDragClassName:z,handleSelector:P,nodeId:r,isSelectable:j,selectNodesOnDrag:S});return O?null:ve.createElement("div",{className:$t(["react-flow__node","react-flow__node-".concat(i),F,w,{selected:f,selectable:j,parent:R}]),ref:q,style:zx({zIndex:A,transform:"translate(".concat(u,"px,").concat(d,"px)"),pointerEvents:D?"all":"none",visibility:I?"visible":"hidden"},v),onMouseEnter:V,onMouseMove:te,onMouseLeave:G,onContextMenu:K,onClick:Q,onDoubleClick:X,"data-testid":"rf__node-".concat(r),"data-id":r},ve.createElement(aO,{value:r},ve.createElement(e,{id:r,data:l,type:i,xPos:u,yPos:d,selected:f,isConnectable:b,sourcePosition:E,targetPosition:M,dragging:J,dragHandle:P,zIndex:A})))};return t.displayName="NodeWrapper",N.memo(t)};function Rx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Dx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Rx(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function c2(e){var t={input:lc(e.input||sx),default:lc(e.default||Oh),output:lc(e.output||ax),group:lc(e.group||Px)},n={},s=Object.keys(e).filter(function(r){return!["input","default","output","group"].includes(r)}).reduce(function(r,i){return r[i]=lc(e[i]||Oh),r},n);return Dx(Dx({},t),s)}function Ix(e,t){N.useRef(null);var n=N.useMemo(function(){return t(e)},[e]);return n}function Fx(e){if(!(!e||typeof document>"u")){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");t.appendChild(n),n.appendChild(document.createTextNode(e))}}var Bx=function(t){var n=t.children,s=!0;try{os()}catch{s=!1}return s?ve.createElement(ve.Fragment,null,n):ve.createElement(Tv,{createStore:Pv},n)};Bx.displayName="ReactFlowWrapper";var u2=["nodes","edges","defaultNodes","defaultEdges","className","nodeTypes","edgeTypes","onNodeClick","onEdgeClick","onInit","onMove","onMoveStart","onMoveEnd","onConnect","onConnectStart","onConnectStop","onConnectEnd","onClickConnectStart","onClickConnectStop","onClickConnectEnd","onNodeMouseEnter","onNodeMouseMove","onNodeMouseLeave","onNodeContextMenu","onNodeDoubleClick","onNodeDragStart","onNodeDrag","onNodeDragStop","onNodesDelete","onEdgesDelete","onSelectionChange","onSelectionDragStart","onSelectionDrag","onSelectionDragStop","onSelectionContextMenu","connectionMode","connectionLineType","connectionLineStyle","connectionLineComponent","connectionLineContainerStyle","deleteKeyCode","selectionKeyCode","multiSelectionKeyCode","zoomActivationKeyCode","snapToGrid","snapGrid","onlyRenderVisibleElements","selectNodesOnDrag","nodesDraggable","nodesConnectable","elementsSelectable","minZoom","maxZoom","defaultZoom","defaultPosition","translateExtent","preventScrolling","nodeExtent","defaultMarkerColor","zoomOnScroll","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnScrollMode","zoomOnDoubleClick","panOnDrag","onPaneClick","onPaneScroll","onPaneContextMenu","children","onEdgeUpdate","onEdgeContextMenu","onEdgeDoubleClick","onEdgeMouseEnter","onEdgeMouseMove","onEdgeMouseLeave","onEdgeUpdateStart","onEdgeUpdateEnd","edgeUpdaterRadius","onNodesChange","onEdgesChange","noDragClassName","noWheelClassName","noPanClassName","fitView","fitViewOptions","connectOnClick","attributionPosition","proOptions","defaultEdgeOptions","elevateEdgesOnSelect"];function Ux(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Hx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ux(Object(n),!0).forEach(function(s){Et(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ux(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}Fx(gO),Fx(yO);var d2={input:sx,default:Oh,output:ax},m2={default:Sh,straight:Xv,step:Gv,smoothstep:Ch,simplebezier:Hv},f2=[15,15],h2=[0,0],qx=N.forwardRef(function(e,t){var n=e.nodes,s=e.edges,r=e.defaultNodes,i=e.defaultEdges,l=e.className,u=e.nodeTypes,d=u===void 0?d2:u,f=e.edgeTypes,p=f===void 0?m2:f,m=e.onNodeClick,h=e.onEdgeClick,_=e.onInit,x=e.onMove,y=e.onMoveStart,v=e.onMoveEnd,w=e.onConnect,k=e.onConnectStart,j=e.onConnectStop,b=e.onConnectEnd,S=e.onClickConnectStart,E=e.onClickConnectStop,M=e.onClickConnectEnd,O=e.onNodeMouseEnter,$=e.onNodeMouseMove,P=e.onNodeMouseLeave,A=e.onNodeContextMenu,R=e.onNodeDoubleClick,F=e.onNodeDragStart,z=e.onNodeDrag,I=e.onNodeDragStop,U=e.onNodesDelete,q=e.onEdgesDelete,H=e.onSelectionChange,W=e.onSelectionDragStart,B=e.onSelectionDrag,D=e.onSelectionDragStop,V=e.onSelectionContextMenu,te=e.connectionMode,G=te===void 0?Mo.Strict:te,K=e.connectionLineType,X=K===void 0?Ta.Bezier:K,Q=e.connectionLineStyle,J=e.connectionLineComponent,Z=e.connectionLineContainerStyle,ee=e.deleteKeyCode,de=ee===void 0?"Backspace":ee,_e=e.selectionKeyCode,ge=_e===void 0?"Shift":_e,be=e.multiSelectionKeyCode,ze=be===void 0?"Meta":be,Ee=e.zoomActivationKeyCode,ie=Ee===void 0?"Meta":Ee,pe=e.snapToGrid,Ce=pe===void 0?!1:pe,Te=e.snapGrid,De=Te===void 0?f2:Te,ce=e.onlyRenderVisibleElements,Oe=ce===void 0?!1:ce,qe=e.selectNodesOnDrag,Qe=qe===void 0?!0:qe,Ye=e.nodesDraggable,at=e.nodesConnectable,et=e.elementsSelectable,ot=e.minZoom,Nt=ot===void 0?.5:ot,Tt=e.maxZoom,tt=Tt===void 0?2:Tt,Ft=e.defaultZoom,Wt=Ft===void 0?1:Ft,Pt=e.defaultPosition,bn=Pt===void 0?h2:Pt,gn=e.translateExtent,jt=gn===void 0?fh:gn,cn=e.preventScrolling,un=cn===void 0?!0:cn,Lt=e.nodeExtent,ut=e.defaultMarkerColor,wn=ut===void 0?"#b1b1b7":ut,ht=e.zoomOnScroll,Bt=ht===void 0?!0:ht,mt=e.zoomOnPinch,Vn=mt===void 0?!0:mt,_n=e.panOnScroll,ls=_n===void 0?!1:_n,xt=e.panOnScrollSpeed,pt=xt===void 0?.5:xt,yn=e.panOnScrollMode,ys=yn===void 0?Ri.Free:yn,dn=e.zoomOnDoubleClick,Xt=dn===void 0?!0:dn,tn=e.panOnDrag,Nn=tn===void 0?!0:tn,Wn=e.onPaneClick,Yn=e.onPaneScroll,vt=e.onPaneContextMenu,Yt=e.children,Jn=e.onEdgeUpdate,$n=e.onEdgeContextMenu,Xs=e.onEdgeDoubleClick,vs=e.onEdgeMouseEnter,cs=e.onEdgeMouseMove,$s=e.onEdgeMouseLeave,Kt=e.onEdgeUpdateStart,Ts=e.onEdgeUpdateEnd,Ut=e.edgeUpdaterRadius,$e=Ut===void 0?10:Ut,Dt=e.onNodesChange,Ps=e.onEdgesChange,es=e.noDragClassName,ue=es===void 0?"nodrag":es,we=e.noWheelClassName,Fe=we===void 0?"nowheel":we,gt=e.noPanClassName,ke=gt===void 0?"nopan":gt,kt=e.fitView,nt=kt===void 0?!1:kt,nn=e.fitViewOptions,vn=e.connectOnClick,Mt=vn===void 0?!0:vn,Zt=e.attributionPosition,ts=e.proOptions,Tn=e.defaultEdgeOptions,Pn=e.elevateEdgesOnSelect,xs=Pn===void 0?!1:Pn,jn=ad(e,u2),Ln=Ix(d,c2),bs=Ix(p,bO);return ve.createElement("div",Hx(Hx({},jn),{},{ref:t,className:$t(["react-flow",l])}),ve.createElement(Bx,null,ve.createElement(l2,{onInit:_,onMove:x,onMoveStart:y,onMoveEnd:v,onNodeClick:m,onEdgeClick:h,onNodeMouseEnter:O,onNodeMouseMove:$,onNodeMouseLeave:P,onNodeContextMenu:A,onNodeDoubleClick:R,nodeTypes:Ln,edgeTypes:bs,connectionLineType:X,connectionLineStyle:Q,connectionLineComponent:J,connectionLineContainerStyle:Z,selectionKeyCode:ge,deleteKeyCode:de,multiSelectionKeyCode:ze,zoomActivationKeyCode:ie,onlyRenderVisibleElements:Oe,selectNodesOnDrag:Qe,translateExtent:jt,minZoom:Nt,maxZoom:tt,defaultZoom:Wt,defaultPosition:bn,preventScrolling:un,zoomOnScroll:Bt,zoomOnPinch:Vn,zoomOnDoubleClick:Xt,panOnScroll:ls,panOnScrollSpeed:pt,panOnScrollMode:ys,panOnDrag:Nn,onPaneClick:Wn,onPaneScroll:Yn,onPaneContextMenu:vt,onSelectionContextMenu:V,onEdgeUpdate:Jn,onEdgeContextMenu:$n,onEdgeDoubleClick:Xs,onEdgeMouseEnter:vs,onEdgeMouseMove:cs,onEdgeMouseLeave:$s,onEdgeUpdateStart:Kt,onEdgeUpdateEnd:Ts,edgeUpdaterRadius:$e,defaultMarkerColor:wn,noDragClassName:ue,noWheelClassName:Fe,noPanClassName:ke,elevateEdgesOnSelect:xs,id:jn==null?void 0:jn.id}),ve.createElement(hO,{nodes:n,edges:s,defaultNodes:r,defaultEdges:i,onConnect:w,onConnectStart:k,onConnectStop:j,onConnectEnd:b,onClickConnectStart:S,onClickConnectStop:E,onClickConnectEnd:M,nodesDraggable:Ye,nodesConnectable:at,elementsSelectable:et,minZoom:Nt,maxZoom:tt,nodeExtent:Lt,onNodesChange:Dt,onEdgesChange:Ps,snapToGrid:Ce,snapGrid:De,connectionMode:G,translateExtent:jt,connectOnClick:Mt,defaultEdgeOptions:Tn,fitView:nt,fitViewOptions:nn,onNodesDelete:U,onEdgesDelete:q,onNodeDragStart:F,onNodeDrag:z,onNodeDragStop:I,onSelectionDrag:B,onSelectionDragStart:W,onSelectionDragStop:D}),H&&ve.createElement(mO,{onSelectionChange:H}),Yt,ve.createElement(QA,{proOptions:ts,position:Zt})))});qx.displayName="ReactFlow";var Vx=function(t){var n=t.children;return ve.createElement(Tv,{createStore:Pv},n)};Vx.displayName="ReactFlowProvider";function Wx(e){return function(t){var n=N.useState(t),s=yt(n,2),r=s[0],i=s[1],l=N.useCallback(function(u){return i(function(d){return e(u,d)})},[]);return[r,i,l]}}var p2=Wx(_v),g2=Wx(bA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _2=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),y2=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,s)=>s?s.toUpperCase():n.toLowerCase()),Yx=e=>{const t=y2(e);return t.charAt(0).toUpperCase()+t.slice(1)},Kx=(...e)=>e.filter((t,n,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===n).join(" ").trim(),v2=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var x2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b2=N.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:l,...u},d)=>N.createElement("svg",{ref:d,...x2,width:t,height:t,stroke:e,strokeWidth:s?Number(n)*24/Number(t):n,className:Kx("lucide",r),...!i&&!v2(u)&&{"aria-hidden":"true"},...u},[...l.map(([f,p])=>N.createElement(f,p)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=(e,t)=>{const n=N.forwardRef(({className:s,...r},i)=>N.createElement(b2,{ref:i,iconNode:t,className:Kx(`lucide-${_2(Yx(e))}`,`lucide-${e}`,s),...r}));return n.displayName=Yx(e),n};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zh=In("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rh=In("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dh=In("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w2=In("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N2=In("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j2=In("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C2=In("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S2=In("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gx=In("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E2=In("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=In("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k2=In("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xx=In("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M2=In("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A2=In("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O2=In("sliders-horizontal",[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cc=In("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=In("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qi=In("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Fr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:s})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:s}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},uc=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Qx=["Enter"," ","Escape"],Zx={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Vi;(function(e){e.Strict="strict",e.Loose="loose"})(Vi||(Vi={}));var $o;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})($o||($o={}));var dc;(function(e){e.Partial="partial",e.Full="full"})(dc||(dc={}));const Jx={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ra;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ra||(Ra={}));var pd;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(pd||(pd={}));var Xe;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Xe||(Xe={}));const e0={[Xe.Left]:Xe.Right,[Xe.Right]:Xe.Left,[Xe.Top]:Xe.Bottom,[Xe.Bottom]:Xe.Top};function t0(e){return e===null?null:e?"valid":"invalid"}const n0=e=>"id"in e&&"source"in e&&"target"in e,$2=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Fh=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),mc=(e,t=[0,0])=>{const{width:n,height:s}=aa(e),r=e.origin??t,i=n*r[0],l=s*r[1];return{x:e.position.x-i,y:e.position.y-l}},T2=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,r)=>{const i=typeof r=="string";let l=!t.nodeLookup&&!i?r:void 0;t.nodeLookup&&(l=i?t.nodeLookup.get(r):Fh(r)?r:t.nodeLookup.get(r.id));const u=l?yd(l,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return gd(s,u)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return _d(n)},fc=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return e.forEach(r=>{(t.filter===void 0||t.filter(r))&&(n=gd(n,yd(r)),s=!0)}),s?_d(n):{x:0,y:0,width:0,height:0}},Bh=(e,t,[n,s,r]=[0,0,1],i=!1,l=!1)=>{const u={...gc(t,[n,s,r]),width:t.width/r,height:t.height/r},d=[];for(const f of e.values()){const{measured:p,selectable:m=!0,hidden:h=!1}=f;if(l&&!m||h)continue;const _=p.width??f.width??f.initialWidth??null,x=p.height??f.height??f.initialHeight??null,y=hc(u,Yi(f)),v=(_??0)*(x??0),w=i&&y>0;(!f.internals.handleBounds||w||y>=v||f.dragging)&&d.push(f)}return d},P2=(e,t)=>{const n=new Set;return e.forEach(s=>{n.add(s.id)}),t.filter(s=>n.has(s.source)||n.has(s.target))};function L2(e,t){const n=new Map,s=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!s||s.has(r.id))&&n.set(r.id,r)}),n}async function z2({nodes:e,width:t,height:n,panZoom:s,minZoom:r,maxZoom:i},l){if(e.size===0)return Promise.resolve(!0);const u=L2(e,l),d=fc(u),f=Hh(d,t,n,(l==null?void 0:l.minZoom)??r,(l==null?void 0:l.maxZoom)??i,(l==null?void 0:l.padding)??.1);return await s.setViewport(f,{duration:l==null?void 0:l.duration,ease:l==null?void 0:l.ease,interpolate:l==null?void 0:l.interpolate}),Promise.resolve(!0)}function s0({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:s=[0,0],nodeExtent:r,onError:i}){const l=n.get(e),u=l.parentId?n.get(l.parentId):void 0,{x:d,y:f}=u?u.internals.positionAbsolute:{x:0,y:0},p=l.origin??s;let m=l.extent||r;if(l.extent==="parent"&&!l.expandParent)if(!u)i==null||i("005",Fr.error005());else{const _=u.measured.width,x=u.measured.height;_&&x&&(m=[[d,f],[d+_,f+x]])}else u&&Gi(l.extent)&&(m=[[l.extent[0][0]+d,l.extent[0][1]+f],[l.extent[1][0]+d,l.extent[1][1]+f]]);const h=Gi(m)?To(t,m,l.measured):t;return(l.measured.width===void 0||l.measured.height===void 0)&&(i==null||i("015",Fr.error015())),{position:{x:h.x-d+(l.measured.width??0)*p[0],y:h.y-f+(l.measured.height??0)*p[1]},positionAbsolute:h}}async function R2({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:s,onBeforeDelete:r}){const i=new Set(e.map(h=>h.id)),l=[];for(const h of n){if(h.deletable===!1)continue;const _=i.has(h.id),x=!_&&h.parentId&&l.find(y=>y.id===h.parentId);(_||x)&&l.push(h)}const u=new Set(t.map(h=>h.id)),d=s.filter(h=>h.deletable!==!1),p=P2(l,d);for(const h of d)u.has(h.id)&&!p.find(x=>x.id===h.id)&&p.push(h);if(!r)return{edges:p,nodes:l};const m=await r({nodes:l,edges:p});return typeof m=="boolean"?m?{edges:p,nodes:l}:{edges:[],nodes:[]}:m}const Wi=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),To=(e={x:0,y:0},t,n)=>({x:Wi(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Wi(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function r0(e,t,n){const{width:s,height:r}=aa(n),{x:i,y:l}=n.internals.positionAbsolute;return To(e,[[i,l],[i+s,l+r]],t)}const a0=(e,t,n)=>e<t?Wi(Math.abs(e-t),1,t)/t:e>n?-Wi(Math.abs(e-n),1,t)/t:0,o0=(e,t,n=15,s=40)=>{const r=a0(e.x,s,t.width-s)*n,i=a0(e.y,s,t.height-s)*n;return[r,i]},gd=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Uh=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),_d=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),Yi=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=Fh(e)?e.internals.positionAbsolute:mc(e,t);return{x:n,y:s,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},yd=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=Fh(e)?e.internals.positionAbsolute:mc(e,t);return{x:n,y:s,x2:n+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:s+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},i0=(e,t)=>_d(gd(Uh(e),Uh(t))),hc=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},l0=e=>wr(e.width)&&wr(e.height)&&wr(e.x)&&wr(e.y),wr=e=>!isNaN(e)&&isFinite(e),D2=(e,t)=>{},pc=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),gc=({x:e,y:t},[n,s,r],i=!1,l=[1,1])=>{const u={x:(e-n)/r,y:(t-s)/r};return i?pc(u,l):u},vd=({x:e,y:t},[n,s,r])=>({x:e*r+n,y:t*r+s});function Ki(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function I2(e,t,n){if(typeof e=="string"||typeof e=="number"){const s=Ki(e,n),r=Ki(e,t);return{top:s,right:r,bottom:s,left:r,x:r*2,y:s*2}}if(typeof e=="object"){const s=Ki(e.top??e.y??0,n),r=Ki(e.bottom??e.y??0,n),i=Ki(e.left??e.x??0,t),l=Ki(e.right??e.x??0,t);return{top:s,right:l,bottom:r,left:i,x:i+l,y:s+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function F2(e,t,n,s,r,i){const{x:l,y:u}=vd(e,[t,n,s]),{x:d,y:f}=vd({x:e.x+e.width,y:e.y+e.height},[t,n,s]),p=r-d,m=i-f;return{left:Math.floor(l),top:Math.floor(u),right:Math.floor(p),bottom:Math.floor(m)}}const Hh=(e,t,n,s,r,i)=>{const l=I2(i,t,n),u=(t-l.x)/e.width,d=(n-l.y)/e.height,f=Math.min(u,d),p=Wi(f,s,r),m=e.x+e.width/2,h=e.y+e.height/2,_=t/2-m*p,x=n/2-h*p,y=F2(e,_,x,p,t,n),v={left:Math.min(y.left-l.left,0),top:Math.min(y.top-l.top,0),right:Math.min(y.right-l.right,0),bottom:Math.min(y.bottom-l.bottom,0)};return{x:_-v.left+v.right,y:x-v.top+v.bottom,zoom:p}},_c=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Gi(e){return e!=null&&e!=="parent"}function aa(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function c0(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function u0(e,t={width:0,height:0},n,s,r){const i={...e},l=s.get(n);if(l){const u=l.origin||r;i.x+=l.internals.positionAbsolute.x-(t.width??0)*u[0],i.y+=l.internals.positionAbsolute.y-(t.height??0)*u[1]}return i}function d0(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function B2(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}function U2(e){return{...Zx,...e||{}}}function yc(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:s,containerBounds:r}){const{x:i,y:l}=Nr(e),u=gc({x:i-((r==null?void 0:r.left)??0),y:l-((r==null?void 0:r.top)??0)},s),{x:d,y:f}=n?pc(u,t):u;return{xSnapped:d,ySnapped:f,...u}}const qh=e=>({width:e.offsetWidth,height:e.offsetHeight}),m0=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},H2=["INPUT","SELECT","TEXTAREA"];function f0(e){var s,r;const t=((r=(s=e.composedPath)==null?void 0:s.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:H2.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const h0=e=>"clientX"in e,Nr=(e,t)=>{var i,l;const n=h0(e),s=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,r=n?e.clientY:(l=e.touches)==null?void 0:l[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},p0=(e,t,n,s,r)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(l=>{const u=l.getBoundingClientRect();return{id:l.getAttribute("data-handleid"),type:e,nodeId:r,position:l.getAttribute("data-handlepos"),x:(u.left-n.left)/s,y:(u.top-n.top)/s,...qh(l)}})};function g0({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:r,sourceControlY:i,targetControlX:l,targetControlY:u}){const d=e*.125+r*.375+l*.375+n*.125,f=t*.125+i*.375+u*.375+s*.125,p=Math.abs(d-e),m=Math.abs(f-t);return[d,f,p,m]}function xd(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function _0({pos:e,x1:t,y1:n,x2:s,y2:r,c:i}){switch(e){case Xe.Left:return[t-xd(t-s,i),n];case Xe.Right:return[t+xd(s-t,i),n];case Xe.Top:return[t,n-xd(n-r,i)];case Xe.Bottom:return[t,n+xd(r-n,i)]}}function y0({sourceX:e,sourceY:t,sourcePosition:n=Xe.Bottom,targetX:s,targetY:r,targetPosition:i=Xe.Top,curvature:l=.25}){const[u,d]=_0({pos:n,x1:e,y1:t,x2:s,y2:r,c:l}),[f,p]=_0({pos:i,x1:s,y1:r,x2:e,y2:t,c:l}),[m,h,_,x]=g0({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:u,sourceControlY:d,targetControlX:f,targetControlY:p});return[`M${e},${t} C${u},${d} ${f},${p} ${s},${r}`,m,h,_,x]}function v0({sourceX:e,sourceY:t,targetX:n,targetY:s}){const r=Math.abs(n-e)/2,i=n<e?n+r:n-r,l=Math.abs(s-t)/2,u=s<t?s+l:s-l;return[i,u,r,l]}function q2({sourceNode:e,targetNode:t,selected:n=!1,zIndex:s,elevateOnSelect:r=!1}){if(s!==void 0)return s;const i=r&&n?1e3:0,l=Math.max(e.parentId||r&&e.selected?e.internals.z:0,t.parentId||r&&t.selected?t.internals.z:0);return i+l}function V2({sourceNode:e,targetNode:t,width:n,height:s,transform:r}){const i=gd(yd(e),yd(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const l={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:s/r[2]};return hc(l,_d(i))>0}const W2=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`xy-edge__${e}${t||""}-${n}${s||""}`,Y2=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),K2=(e,t)=>{if(!e.source||!e.target)return t;let n;return n0(e)?n={...e}:n={...e,id:W2(e)},Y2(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function x0({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[r,i,l,u]=v0({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,r,i,l,u]}const b0={[Xe.Left]:{x:-1,y:0},[Xe.Right]:{x:1,y:0},[Xe.Top]:{x:0,y:-1},[Xe.Bottom]:{x:0,y:1}},G2=({source:e,sourcePosition:t=Xe.Bottom,target:n})=>t===Xe.Left||t===Xe.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},w0=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function X2({source:e,sourcePosition:t=Xe.Bottom,target:n,targetPosition:s=Xe.Top,center:r,offset:i,stepPosition:l}){const u=b0[t],d=b0[s],f={x:e.x+u.x*i,y:e.y+u.y*i},p={x:n.x+d.x*i,y:n.y+d.y*i},m=G2({source:f,sourcePosition:t,target:p}),h=m.x!==0?"x":"y",_=m[h];let x=[],y,v;const w={x:0,y:0},k={x:0,y:0},[,,j,b]=v0({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(u[h]*d[h]===-1){h==="x"?(y=r.x??f.x+(p.x-f.x)*l,v=r.y??(f.y+p.y)/2):(y=r.x??(f.x+p.x)/2,v=r.y??f.y+(p.y-f.y)*l);const E=[{x:y,y:f.y},{x:y,y:p.y}],M=[{x:f.x,y:v},{x:p.x,y:v}];u[h]===_?x=h==="x"?E:M:x=h==="x"?M:E}else{const E=[{x:f.x,y:p.y}],M=[{x:p.x,y:f.y}];if(h==="x"?x=u.x===_?M:E:x=u.y===_?E:M,t===s){const R=Math.abs(e[h]-n[h]);if(R<=i){const F=Math.min(i-1,i-R);u[h]===_?w[h]=(f[h]>e[h]?-1:1)*F:k[h]=(p[h]>n[h]?-1:1)*F}}if(t!==s){const R=h==="x"?"y":"x",F=u[h]===d[R],z=f[R]>p[R],I=f[R]<p[R];(u[h]===1&&(!F&&z||F&&I)||u[h]!==1&&(!F&&I||F&&z))&&(x=h==="x"?E:M)}const O={x:f.x+w.x,y:f.y+w.y},$={x:p.x+k.x,y:p.y+k.y},P=Math.max(Math.abs(O.x-x[0].x),Math.abs($.x-x[0].x)),A=Math.max(Math.abs(O.y-x[0].y),Math.abs($.y-x[0].y));P>=A?(y=(O.x+$.x)/2,v=x[0].y):(y=x[0].x,v=(O.y+$.y)/2)}return[[e,{x:f.x+w.x,y:f.y+w.y},...x,{x:p.x+k.x,y:p.y+k.y},n],y,v,j,b]}function Q2(e,t,n,s){const r=Math.min(w0(e,t)/2,w0(t,n)/2,s),{x:i,y:l}=t;if(e.x===i&&i===n.x||e.y===l&&l===n.y)return`L${i} ${l}`;if(e.y===l){const f=e.x<n.x?-1:1,p=e.y<n.y?1:-1;return`L ${i+r*f},${l}Q ${i},${l} ${i},${l+r*p}`}const u=e.x<n.x?1:-1,d=e.y<n.y?-1:1;return`L ${i},${l+r*d}Q ${i},${l} ${i+r*u},${l}`}function Vh({sourceX:e,sourceY:t,sourcePosition:n=Xe.Bottom,targetX:s,targetY:r,targetPosition:i=Xe.Top,borderRadius:l=5,centerX:u,centerY:d,offset:f=20,stepPosition:p=.5}){const[m,h,_,x,y]=X2({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:r},targetPosition:i,center:{x:u,y:d},offset:f,stepPosition:p});return[m.reduce((w,k,j)=>{let b="";return j>0&&j<m.length-1?b=Q2(m[j-1],k,m[j+1],l):b=`${j===0?"M":"L"}${k.x} ${k.y}`,w+=b,w},""),h,_,x,y]}function N0(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Z2(e){var m;const{sourceNode:t,targetNode:n}=e;if(!N0(t)||!N0(n))return null;const s=t.internals.handleBounds||j0(t.handles),r=n.internals.handleBounds||j0(n.handles),i=C0((s==null?void 0:s.source)??[],e.sourceHandle),l=C0(e.connectionMode===Vi.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!i||!l)return(m=e.onError)==null||m.call(e,"008",Fr.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const u=(i==null?void 0:i.position)||Xe.Bottom,d=(l==null?void 0:l.position)||Xe.Top,f=vc(t,i,u),p=vc(n,l,d);return{sourceX:f.x,sourceY:f.y,targetX:p.x,targetY:p.y,sourcePosition:u,targetPosition:d}}function j0(e){if(!e)return null;const t=[],n=[];for(const s of e)s.width=s.width??1,s.height=s.height??1,s.type==="source"?t.push(s):s.type==="target"&&n.push(s);return{source:t,target:n}}function vc(e,t,n=Xe.Left,s=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:l,height:u}=t??aa(e);if(s)return{x:r+l/2,y:i+u/2};switch((t==null?void 0:t.position)??n){case Xe.Top:return{x:r+l/2,y:i};case Xe.Right:return{x:r+l,y:i+u/2};case Xe.Bottom:return{x:r+l/2,y:i+u};case Xe.Left:return{x:r,y:i+u/2}}}function C0(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Wh(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`:""}function J2(e,{id:t,defaultColor:n,defaultMarkerStart:s,defaultMarkerEnd:r}){const i=new Set;return e.reduce((l,u)=>([u.markerStart||s,u.markerEnd||r].forEach(d=>{if(d&&typeof d=="object"){const f=Wh(d,t);i.has(f)||(l.push({id:f,color:d.color||n,...d}),i.add(f))}}),l),[]).sort((l,u)=>l.id.localeCompare(u.id))}const S0=1e3,e$=10,Yh={nodeOrigin:[0,0],nodeExtent:uc,elevateNodesOnSelect:!0,defaults:{}},t$={...Yh,checkEquality:!0};function Kh(e,t){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}function n$(e,t,n){const s=Kh(Yh,n);for(const r of e.values())if(r.parentId)Xh(r,e,t,s);else{const i=mc(r,s.nodeOrigin),l=Gi(r.extent)?r.extent:s.nodeExtent,u=To(i,l,aa(r));r.internals.positionAbsolute=u}}function s$(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],s=[];for(const r of e.handles){const i={id:r.id,width:r.width??1,height:r.height??1,nodeId:e.id,x:r.x,y:r.y,position:r.position,type:r.type};r.type==="source"?n.push(i):r.type==="target"&&s.push(i)}return{source:n,target:s}}function Gh(e,t,n,s){var f,p;const r=Kh(t$,s);let i={i:-1},l=e.length>0;const u=new Map(t),d=r!=null&&r.elevateNodesOnSelect?S0:0;t.clear(),n.clear();for(const m of e){let h=u.get(m.id);if(r.checkEquality&&m===(h==null?void 0:h.internals.userNode))t.set(m.id,h);else{const _=mc(m,r.nodeOrigin),x=Gi(m.extent)?m.extent:r.nodeExtent,y=To(_,x,aa(m));h={...r.defaults,...m,measured:{width:(f=m.measured)==null?void 0:f.width,height:(p=m.measured)==null?void 0:p.height},internals:{positionAbsolute:y,handleBounds:s$(m,h),z:E0(m,d),userNode:m}},t.set(m.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(l=!1),m.parentId&&Xh(h,t,n,s,i)}return l}function r$(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Xh(e,t,n,s,r){const{elevateNodesOnSelect:i,nodeOrigin:l,nodeExtent:u}=Kh(Yh,s),d=e.parentId,f=t.get(d);if(!f){console.warn(`Parent node ${d} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}r$(e,n),r&&!f.parentId&&f.internals.rootParentIndex===void 0&&(f.internals.rootParentIndex=++r.i,f.internals.z=f.internals.z+r.i*e$),r&&f.internals.rootParentIndex!==void 0&&(r.i=f.internals.rootParentIndex);const p=i?S0:0,{x:m,y:h,z:_}=a$(e,f,l,u,p),{positionAbsolute:x}=e.internals,y=m!==x.x||h!==x.y;(y||_!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:y?{x:m,y:h}:x,z:_}})}function E0(e,t){return(wr(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function a$(e,t,n,s,r){const{x:i,y:l}=t.internals.positionAbsolute,u=aa(e),d=mc(e,n),f=Gi(e.extent)?To(d,e.extent,u):d;let p=To({x:i+f.x,y:l+f.y},s,u);e.extent==="parent"&&(p=r0(p,u,t));const m=E0(e,r),h=t.internals.z??0;return{x:p.x,y:p.y,z:h>=m?h+1:m}}function Qh(e,t,n,s=[0,0]){var l;const r=[],i=new Map;for(const u of e){const d=t.get(u.parentId);if(!d)continue;const f=((l=i.get(u.parentId))==null?void 0:l.expandedRect)??Yi(d),p=i0(f,u.rect);i.set(u.parentId,{expandedRect:p,parent:d})}return i.size>0&&i.forEach(({expandedRect:u,parent:d},f)=>{var j;const p=d.internals.positionAbsolute,m=aa(d),h=d.origin??s,_=u.x<p.x?Math.round(Math.abs(p.x-u.x)):0,x=u.y<p.y?Math.round(Math.abs(p.y-u.y)):0,y=Math.max(m.width,Math.round(u.width)),v=Math.max(m.height,Math.round(u.height)),w=(y-m.width)*h[0],k=(v-m.height)*h[1];(_>0||x>0||w||k)&&(r.push({id:f,type:"position",position:{x:d.position.x-_+w,y:d.position.y-x+k}}),(j=n.get(f))==null||j.forEach(b=>{e.some(S=>S.id===b.id)||r.push({id:b.id,type:"position",position:{x:b.position.x+_,y:b.position.y+x}})})),(m.width<u.width||m.height<u.height||_||x)&&r.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:y+(_?h[0]*_-w:0),height:v+(x?h[1]*x-k:0)}})}),r}function o$(e,t,n,s,r,i){const l=s==null?void 0:s.querySelector(".xyflow__viewport");let u=!1;if(!l)return{changes:[],updatedInternals:u};const d=[],f=window.getComputedStyle(l),{m22:p}=new window.DOMMatrixReadOnly(f.transform),m=[];for(const h of e.values()){const _=t.get(h.id);if(!_)continue;if(_.hidden){t.set(_.id,{..._,internals:{..._.internals,handleBounds:void 0}}),u=!0;continue}const x=qh(h.nodeElement),y=_.measured.width!==x.width||_.measured.height!==x.height;if(!!(x.width&&x.height&&(y||!_.internals.handleBounds||h.force))){const w=h.nodeElement.getBoundingClientRect(),k=Gi(_.extent)?_.extent:i;let{positionAbsolute:j}=_.internals;_.parentId&&_.extent==="parent"?j=r0(j,x,t.get(_.parentId)):k&&(j=To(j,k,x));const b={..._,measured:x,internals:{..._.internals,positionAbsolute:j,handleBounds:{source:p0("source",h.nodeElement,w,p,_.id),target:p0("target",h.nodeElement,w,p,_.id)}}};t.set(_.id,b),_.parentId&&Xh(b,t,n,{nodeOrigin:r}),u=!0,y&&(d.push({id:_.id,type:"dimensions",dimensions:x}),_.expandParent&&_.parentId&&m.push({id:_.id,parentId:_.parentId,rect:Yi(b,r)}))}}if(m.length>0){const h=Qh(m,t,n,r);d.push(...h)}return{changes:d,updatedInternals:u}}async function i$({delta:e,panZoom:t,transform:n,translateExtent:s,width:r,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const l=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,i]],s),u=!!l&&(l.x!==n[0]||l.y!==n[1]||l.k!==n[2]);return Promise.resolve(u)}function k0(e,t,n,s,r,i){let l=r;const u=s.get(l)||new Map;s.set(l,u.set(n,t)),l=`${r}-${e}`;const d=s.get(l)||new Map;if(s.set(l,d.set(n,t)),i){l=`${r}-${e}-${i}`;const f=s.get(l)||new Map;s.set(l,f.set(n,t))}}function M0(e,t,n){e.clear(),t.clear();for(const s of n){const{source:r,target:i,sourceHandle:l=null,targetHandle:u=null}=s,d={edgeId:s.id,source:r,target:i,sourceHandle:l,targetHandle:u},f=`${r}-${l}--${i}-${u}`,p=`${i}-${u}--${r}-${l}`;k0("source",d,p,e,r,l),k0("target",d,f,e,i,u),t.set(s.id,s)}}function A0(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:A0(n,t):!1}function O0(e,t,n){var r;let s=e;do{if((r=s==null?void 0:s.matches)!=null&&r.call(s,t))return!0;if(s===n)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function l$(e,t,n,s){const r=new Map;for(const[i,l]of e)if((l.selected||l.id===s)&&(!l.parentId||!A0(l,e))&&(l.draggable||t&&typeof l.draggable>"u")){const u=e.get(i);u&&r.set(i,{id:i,position:u.position||{x:0,y:0},distance:{x:n.x-u.internals.positionAbsolute.x,y:n.y-u.internals.positionAbsolute.y},extent:u.extent,parentId:u.parentId,origin:u.origin,expandParent:u.expandParent,internals:{positionAbsolute:u.internals.positionAbsolute||{x:0,y:0}},measured:{width:u.measured.width??0,height:u.measured.height??0}})}return r}function Zh({nodeId:e,dragItems:t,nodeLookup:n,dragging:s=!0}){var l,u,d;const r=[];for(const[f,p]of t){const m=(l=n.get(f))==null?void 0:l.internals.userNode;m&&r.push({...m,position:p.position,dragging:s})}if(!e)return[r[0],r];const i=(u=n.get(e))==null?void 0:u.internals.userNode;return[i?{...i,position:((d=t.get(e))==null?void 0:d.position)||i.position,dragging:s}:r[0],r]}function c$({dragItems:e,snapGrid:t,x:n,y:s}){const r=e.values().next().value;if(!r)return null;const i={x:n-r.distance.x,y:s-r.distance.y},l=pc(i,t);return{x:l.x-i.x,y:l.y-i.y}}function u$({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:s,onDragStop:r}){let i={x:null,y:null},l=0,u=new Map,d=!1,f={x:0,y:0},p=null,m=!1,h=null,_=!1,x=!1,y=null;function v({noDragClassName:k,handleSelector:j,domNode:b,isSelectable:S,nodeId:E,nodeClickDistance:M=0}){h=ps(b);function O({x:R,y:F}){const{nodeLookup:z,nodeExtent:I,snapGrid:U,snapToGrid:q,nodeOrigin:H,onNodeDrag:W,onSelectionDrag:B,onError:D,updateNodePositions:V}=t();i={x:R,y:F};let te=!1;const G=u.size>1,K=G&&I?Uh(fc(u)):null,X=G&&q?c$({dragItems:u,snapGrid:U,x:R,y:F}):null;for(const[Q,J]of u){if(!z.has(Q))continue;let Z={x:R-J.distance.x,y:F-J.distance.y};q&&(Z=X?{x:Math.round(Z.x+X.x),y:Math.round(Z.y+X.y)}:pc(Z,U));let ee=null;if(G&&I&&!J.extent&&K){const{positionAbsolute:ge}=J.internals,be=ge.x-K.x+I[0][0],ze=ge.x+J.measured.width-K.x2+I[1][0],Ee=ge.y-K.y+I[0][1],ie=ge.y+J.measured.height-K.y2+I[1][1];ee=[[be,Ee],[ze,ie]]}const{position:de,positionAbsolute:_e}=s0({nodeId:Q,nextPosition:Z,nodeLookup:z,nodeExtent:ee||I,nodeOrigin:H,onError:D});te=te||J.position.x!==de.x||J.position.y!==de.y,J.position=de,J.internals.positionAbsolute=_e}if(x=x||te,!!te&&(V(u,!0),y&&(s||W||!E&&B))){const[Q,J]=Zh({nodeId:E,dragItems:u,nodeLookup:z});s==null||s(y,u,Q,J),W==null||W(y,Q,J),E||B==null||B(y,J)}}async function $(){if(!p)return;const{transform:R,panBy:F,autoPanSpeed:z,autoPanOnNodeDrag:I}=t();if(!I){d=!1,cancelAnimationFrame(l);return}const[U,q]=o0(f,p,z);(U!==0||q!==0)&&(i.x=(i.x??0)-U/R[2],i.y=(i.y??0)-q/R[2],await F({x:U,y:q})&&O(i)),l=requestAnimationFrame($)}function P(R){var G;const{nodeLookup:F,multiSelectionActive:z,nodesDraggable:I,transform:U,snapGrid:q,snapToGrid:H,selectNodesOnDrag:W,onNodeDragStart:B,onSelectionDragStart:D,unselectNodesAndEdges:V}=t();m=!0,(!W||!S)&&!z&&E&&((G=F.get(E))!=null&&G.selected||V()),S&&W&&E&&(e==null||e(E));const te=yc(R.sourceEvent,{transform:U,snapGrid:q,snapToGrid:H,containerBounds:p});if(i=te,u=l$(F,I,te,E),u.size>0&&(n||B||!E&&D)){const[K,X]=Zh({nodeId:E,dragItems:u,nodeLookup:F});n==null||n(R.sourceEvent,u,K,X),B==null||B(R.sourceEvent,K,X),E||D==null||D(R.sourceEvent,X)}}const A=Wf().clickDistance(M).on("start",R=>{const{domNode:F,nodeDragThreshold:z,transform:I,snapGrid:U,snapToGrid:q}=t();p=(F==null?void 0:F.getBoundingClientRect())||null,_=!1,x=!1,y=R.sourceEvent,z===0&&P(R),i=yc(R.sourceEvent,{transform:I,snapGrid:U,snapToGrid:q,containerBounds:p}),f=Nr(R.sourceEvent,p)}).on("drag",R=>{const{autoPanOnNodeDrag:F,transform:z,snapGrid:I,snapToGrid:U,nodeDragThreshold:q,nodeLookup:H}=t(),W=yc(R.sourceEvent,{transform:z,snapGrid:I,snapToGrid:U,containerBounds:p});if(y=R.sourceEvent,(R.sourceEvent.type==="touchmove"&&R.sourceEvent.touches.length>1||E&&!H.has(E))&&(_=!0),!_){if(!d&&F&&m&&(d=!0,$()),!m){const B=Nr(R.sourceEvent,p),D=B.x-f.x,V=B.y-f.y;Math.sqrt(D*D+V*V)>q&&P(R)}(i.x!==W.xSnapped||i.y!==W.ySnapped)&&u&&m&&(f=Nr(R.sourceEvent,p),O(W))}}).on("end",R=>{if(!(!m||_)&&(d=!1,m=!1,cancelAnimationFrame(l),u.size>0)){const{nodeLookup:F,updateNodePositions:z,onNodeDragStop:I,onSelectionDragStop:U}=t();if(x&&(z(u,!1),x=!1),r||I||!E&&U){const[q,H]=Zh({nodeId:E,dragItems:u,nodeLookup:F,dragging:!1});r==null||r(R.sourceEvent,u,q,H),I==null||I(R.sourceEvent,q,H),E||U==null||U(R.sourceEvent,H)}}}).filter(R=>{const F=R.target;return!R.button&&(!k||!O0(F,`.${k}`,b))&&(!j||O0(F,j,b))});h.call(A)}function w(){h==null||h.on(".drag",null)}return{update:v,destroy:w}}function d$(e,t,n){const s=[],r={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())hc(r,Yi(i))>0&&s.push(i);return s}const m$=250;function f$(e,t,n,s){var u,d;let r=[],i=1/0;const l=d$(e,n,t+m$);for(const f of l){const p=[...((u=f.internals.handleBounds)==null?void 0:u.source)??[],...((d=f.internals.handleBounds)==null?void 0:d.target)??[]];for(const m of p){if(s.nodeId===m.nodeId&&s.type===m.type&&s.id===m.id)continue;const{x:h,y:_}=vc(f,m,m.position,!0),x=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(_-e.y,2));x>t||(x<i?(r=[{...m,x:h,y:_}],i=x):x===i&&r.push({...m,x:h,y:_}))}}if(!r.length)return null;if(r.length>1){const f=s.type==="source"?"target":"source";return r.find(p=>p.type===f)??r[0]}return r[0]}function $0(e,t,n,s,r,i=!1){var f,p,m;const l=s.get(e);if(!l)return null;const u=r==="strict"?(f=l.internals.handleBounds)==null?void 0:f[t]:[...((p=l.internals.handleBounds)==null?void 0:p.source)??[],...((m=l.internals.handleBounds)==null?void 0:m.target)??[]],d=(n?u==null?void 0:u.find(h=>h.id===n):u==null?void 0:u[0])??null;return d&&i?{...d,...vc(l,d,d.position,!0)}:d}function T0(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function h$(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const P0=()=>!0;function p$(e,{connectionMode:t,connectionRadius:n,handleId:s,nodeId:r,edgeUpdaterType:i,isTarget:l,domNode:u,nodeLookup:d,lib:f,autoPanOnConnect:p,flowId:m,panBy:h,cancelConnection:_,onConnectStart:x,onConnect:y,onConnectEnd:v,isValidConnection:w=P0,onReconnectEnd:k,updateConnection:j,getTransform:b,getFromHandle:S,autoPanSpeed:E,dragThreshold:M=1,handleDomNode:O}){const $=m0(e.target);let P=0,A;const{x:R,y:F}=Nr(e),z=T0(i,O),I=u==null?void 0:u.getBoundingClientRect();let U=!1;if(!I||!z)return;const q=$0(r,z,s,d,t);if(!q)return;let H=Nr(e,I),W=!1,B=null,D=!1,V=null;function te(){if(!p||!I)return;const[de,_e]=o0(H,I,E);h({x:de,y:_e}),P=requestAnimationFrame(te)}const G={...q,nodeId:r,type:z,position:q.position},K=d.get(r);let Q={inProgress:!0,isValid:null,from:vc(K,G,Xe.Left,!0),fromHandle:G,fromPosition:G.position,fromNode:K,to:H,toHandle:null,toPosition:e0[G.position],toNode:null,pointer:H};function J(){U=!0,j(Q),x==null||x(e,{nodeId:r,handleId:s,handleType:z})}M===0&&J();function Z(de){if(!U){const{x:ze,y:Ee}=Nr(de),ie=ze-R,pe=Ee-F;if(!(ie*ie+pe*pe>M*M))return;J()}if(!S()||!G){ee(de);return}const _e=b();H=Nr(de,I),A=f$(gc(H,_e,!1,[1,1]),n,d,G),W||(te(),W=!0);const ge=L0(de,{handle:A,connectionMode:t,fromNodeId:r,fromHandleId:s,fromType:l?"target":"source",isValidConnection:w,doc:$,lib:f,flowId:m,nodeLookup:d});V=ge.handleDomNode,B=ge.connection,D=h$(!!A,ge.isValid);const be={...Q,isValid:D,to:ge.toHandle&&D?vd({x:ge.toHandle.x,y:ge.toHandle.y},_e):H,toHandle:ge.toHandle,toPosition:D&&ge.toHandle?ge.toHandle.position:e0[G.position],toNode:ge.toHandle?d.get(ge.toHandle.nodeId):null,pointer:H};j(be),Q=be}function ee(de){if(!("touches"in de&&de.touches.length>0)){if(U){(A||V)&&B&&D&&(y==null||y(B));const{inProgress:_e,...ge}=Q,be={...ge,toPosition:Q.toHandle?Q.toPosition:null};v==null||v(de,be),i&&(k==null||k(de,be))}_(),cancelAnimationFrame(P),W=!1,D=!1,B=null,V=null,$.removeEventListener("mousemove",Z),$.removeEventListener("mouseup",ee),$.removeEventListener("touchmove",Z),$.removeEventListener("touchend",ee)}}$.addEventListener("mousemove",Z),$.addEventListener("mouseup",ee),$.addEventListener("touchmove",Z),$.addEventListener("touchend",ee)}function L0(e,{handle:t,connectionMode:n,fromNodeId:s,fromHandleId:r,fromType:i,doc:l,lib:u,flowId:d,isValidConnection:f=P0,nodeLookup:p}){const m=i==="target",h=t?l.querySelector(`.${u}-flow__handle[data-id="${d}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:_,y:x}=Nr(e),y=l.elementFromPoint(_,x),v=y!=null&&y.classList.contains(`${u}-flow__handle`)?y:h,w={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const k=T0(void 0,v),j=v.getAttribute("data-nodeid"),b=v.getAttribute("data-handleid"),S=v.classList.contains("connectable"),E=v.classList.contains("connectableend");if(!j||!k)return w;const M={source:m?j:s,sourceHandle:m?b:r,target:m?s:j,targetHandle:m?r:b};w.connection=M;const $=S&&E&&(n===Vi.Strict?m&&k==="source"||!m&&k==="target":j!==s||b!==r);w.isValid=$&&f(M),w.toHandle=$0(j,k,b,p,n,!0)}return w}const Jh={onPointerDown:p$,isValid:L0};function g$({domNode:e,panZoom:t,getTransform:n,getViewScale:s}){const r=ps(e);function i({translateExtent:u,width:d,height:f,zoomStep:p=1,pannable:m=!0,zoomable:h=!0,inversePan:_=!1}){const x=j=>{if(j.sourceEvent.type!=="wheel"||!t)return;const b=n(),S=j.sourceEvent.ctrlKey&&_c()?10:1,E=-j.sourceEvent.deltaY*(j.sourceEvent.deltaMode===1?.05:j.sourceEvent.deltaMode?1:.002)*p,M=b[2]*Math.pow(2,E*S);t.scaleTo(M)};let y=[0,0];const v=j=>{(j.sourceEvent.type==="mousedown"||j.sourceEvent.type==="touchstart")&&(y=[j.sourceEvent.clientX??j.sourceEvent.touches[0].clientX,j.sourceEvent.clientY??j.sourceEvent.touches[0].clientY])},w=j=>{const b=n();if(j.sourceEvent.type!=="mousemove"&&j.sourceEvent.type!=="touchmove"||!t)return;const S=[j.sourceEvent.clientX??j.sourceEvent.touches[0].clientX,j.sourceEvent.clientY??j.sourceEvent.touches[0].clientY],E=[S[0]-y[0],S[1]-y[1]];y=S;const M=s()*Math.max(b[2],Math.log(b[2]))*(_?-1:1),O={x:b[0]-E[0]*M,y:b[1]-E[1]*M},$=[[0,0],[d,f]];t.setViewportConstrained({x:O.x,y:O.y,zoom:b[2]},$,u)},k=ih().on("start",v).on("zoom",m?w:null).on("zoom.wheel",h?x:null);r.call(k,{})}function l(){r.on("zoom",null)}return{update:i,destroy:l,pointer:cr}}const bd=e=>({x:e.x,y:e.y,zoom:e.k}),ep=({x:e,y:t,zoom:n})=>ra.translate(e,t).scale(n),Xi=(e,t)=>e.target.closest(`.${t}`),z0=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),_$=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,tp=(e,t=0,n=_$,s=()=>{})=>{const r=typeof t=="number"&&t>0;return r||s(),r?e.transition().duration(t).ease(n).on("end",s):e},R0=e=>{const t=e.ctrlKey&&_c()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function y$({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:s,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:l,onPanZoomStart:u,onPanZoom:d,onPanZoomEnd:f}){return p=>{if(Xi(p,t))return p.ctrlKey&&p.preventDefault(),!1;p.preventDefault(),p.stopImmediatePropagation();const m=n.property("__zoom").k||1;if(p.ctrlKey&&l){const v=cr(p),w=R0(p),k=m*Math.pow(2,w);s.scaleTo(n,k,v,p);return}const h=p.deltaMode===1?20:1;let _=r===$o.Vertical?0:p.deltaX*h,x=r===$o.Horizontal?0:p.deltaY*h;!_c()&&p.shiftKey&&r!==$o.Vertical&&(_=p.deltaY*h,x=0),s.translateBy(n,-(_/m)*i,-(x/m)*i,{internal:!0});const y=bd(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(d==null||d(p,y),e.panScrollTimeout=setTimeout(()=>{f==null||f(p,y),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,u==null||u(p,y))}}function v$({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(s,r){const i=s.type==="wheel",l=!t&&i&&!s.ctrlKey,u=Xi(s,e);if(s.ctrlKey&&i&&u&&s.preventDefault(),l||u)return null;s.preventDefault(),n.call(this,s,r)}}function x$({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return s=>{var i,l,u;if((i=s.sourceEvent)!=null&&i.internal)return;const r=bd(s.transform);e.mouseButton=((l=s.sourceEvent)==null?void 0:l.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((u=s.sourceEvent)==null?void 0:u.type)==="mousedown"&&t(!0),n&&(n==null||n(s.sourceEvent,r))}}function b$({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:s,onPanZoom:r}){return i=>{var l,u;e.usedRightMouseButton=!!(n&&z0(t,e.mouseButton??0)),(l=i.sourceEvent)!=null&&l.sync||s([i.transform.x,i.transform.y,i.transform.k]),r&&!((u=i.sourceEvent)!=null&&u.internal)&&(r==null||r(i.sourceEvent,bd(i.transform)))}}function w$({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:s,onPanZoomEnd:r,onPaneContextMenu:i}){return l=>{var u;if(!((u=l.sourceEvent)!=null&&u.internal)&&(e.isZoomingOrPanning=!1,i&&z0(t,e.mouseButton??0)&&!e.usedRightMouseButton&&l.sourceEvent&&i(l.sourceEvent),e.usedRightMouseButton=!1,s(!1),r)){const d=bd(l.transform);e.prevViewport=d,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(l.sourceEvent,d)},n?150:0)}}}function N$({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:s,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:l,noWheelClassName:u,noPanClassName:d,lib:f,connectionInProgress:p}){return m=>{var v;const h=e||t,_=n&&m.ctrlKey,x=m.type==="wheel";if(m.button===1&&m.type==="mousedown"&&(Xi(m,`${f}-flow__node`)||Xi(m,`${f}-flow__edge`)))return!0;if(!s&&!h&&!r&&!i&&!n||l||p&&!x||Xi(m,u)&&x||Xi(m,d)&&(!x||r&&x&&!e)||!n&&m.ctrlKey&&x)return!1;if(!n&&m.type==="touchstart"&&((v=m.touches)==null?void 0:v.length)>1)return m.preventDefault(),!1;if(!h&&!r&&!_&&x||!s&&(m.type==="mousedown"||m.type==="touchstart")||Array.isArray(s)&&!s.includes(m.button)&&m.type==="mousedown")return!1;const y=Array.isArray(s)&&s.includes(m.button)||!m.button||m.button<=1;return(!m.ctrlKey||x)&&y}}function j$({domNode:e,minZoom:t,maxZoom:n,translateExtent:s,viewport:r,onPanZoom:i,onPanZoomStart:l,onPanZoomEnd:u,onDraggingChange:d}){const f={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},p=e.getBoundingClientRect(),m=ih().scaleExtent([t,n]).translateExtent(s),h=ps(e).call(m);k({x:r.x,y:r.y,zoom:Wi(r.zoom,t,n)},[[0,0],[p.width,p.height]],s);const _=h.on("wheel.zoom"),x=h.on("dblclick.zoom");m.wheelDelta(R0);function y(A,R){return h?new Promise(F=>{m==null||m.interpolate((R==null?void 0:R.interpolate)==="linear"?Ql:Wu).transform(tp(h,R==null?void 0:R.duration,R==null?void 0:R.ease,()=>F(!0)),A)}):Promise.resolve(!1)}function v({noWheelClassName:A,noPanClassName:R,onPaneContextMenu:F,userSelectionActive:z,panOnScroll:I,panOnDrag:U,panOnScrollMode:q,panOnScrollSpeed:H,preventScrolling:W,zoomOnPinch:B,zoomOnScroll:D,zoomOnDoubleClick:V,zoomActivationKeyPressed:te,lib:G,onTransformChange:K,connectionInProgress:X,paneClickDistance:Q,selectionOnDrag:J}){z&&!f.isZoomingOrPanning&&w();const Z=I&&!te&&!z;m.clickDistance(J?1/0:!wr(Q)||Q<0?0:Q);const ee=Z?y$({zoomPanValues:f,noWheelClassName:A,d3Selection:h,d3Zoom:m,panOnScrollMode:q,panOnScrollSpeed:H,zoomOnPinch:B,onPanZoomStart:l,onPanZoom:i,onPanZoomEnd:u}):v$({noWheelClassName:A,preventScrolling:W,d3ZoomHandler:_});if(h.on("wheel.zoom",ee,{passive:!1}),!z){const _e=x$({zoomPanValues:f,onDraggingChange:d,onPanZoomStart:l});m.on("start",_e);const ge=b$({zoomPanValues:f,panOnDrag:U,onPaneContextMenu:!!F,onPanZoom:i,onTransformChange:K});m.on("zoom",ge);const be=w$({zoomPanValues:f,panOnDrag:U,panOnScroll:I,onPaneContextMenu:F,onPanZoomEnd:u,onDraggingChange:d});m.on("end",be)}const de=N$({zoomActivationKeyPressed:te,panOnDrag:U,zoomOnScroll:D,panOnScroll:I,zoomOnDoubleClick:V,zoomOnPinch:B,userSelectionActive:z,noPanClassName:R,noWheelClassName:A,lib:G,connectionInProgress:X});m.filter(de),V?h.on("dblclick.zoom",x):h.on("dblclick.zoom",null)}function w(){m.on("zoom",null)}async function k(A,R,F){const z=ep(A),I=m==null?void 0:m.constrain()(z,R,F);return I&&await y(I),new Promise(U=>U(I))}async function j(A,R){const F=ep(A);return await y(F,R),new Promise(z=>z(F))}function b(A){if(h){const R=ep(A),F=h.property("__zoom");(F.k!==A.zoom||F.x!==A.x||F.y!==A.y)&&(m==null||m.transform(h,R,null,{sync:!0}))}}function S(){const A=h?lv(h.node()):{x:0,y:0,k:1};return{x:A.x,y:A.y,zoom:A.k}}function E(A,R){return h?new Promise(F=>{m==null||m.interpolate((R==null?void 0:R.interpolate)==="linear"?Ql:Wu).scaleTo(tp(h,R==null?void 0:R.duration,R==null?void 0:R.ease,()=>F(!0)),A)}):Promise.resolve(!1)}function M(A,R){return h?new Promise(F=>{m==null||m.interpolate((R==null?void 0:R.interpolate)==="linear"?Ql:Wu).scaleBy(tp(h,R==null?void 0:R.duration,R==null?void 0:R.ease,()=>F(!0)),A)}):Promise.resolve(!1)}function O(A){m==null||m.scaleExtent(A)}function $(A){m==null||m.translateExtent(A)}function P(A){const R=!wr(A)||A<0?0:A;m==null||m.clickDistance(R)}return{update:v,destroy:w,setViewport:j,setViewportConstrained:k,getViewport:S,scaleTo:E,scaleBy:M,setScaleExtent:O,setTranslateExtent:$,syncViewport:b,setClickDistance:P}}var Qi;(function(e){e.Line="line",e.Handle="handle"})(Qi||(Qi={}));function C$({width:e,prevWidth:t,height:n,prevHeight:s,affectsX:r,affectsY:i}){const l=e-t,u=n-s,d=[l>0?1:l<0?-1:0,u>0?1:u<0?-1:0];return l&&r&&(d[0]=d[0]*-1),u&&i&&(d[1]=d[1]*-1),d}function D0(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),s=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:s,affectsY:r}}function Da(e,t){return Math.max(0,t-e)}function Ia(e,t){return Math.max(0,e-t)}function wd(e,t,n){return Math.max(0,t-e,e-n)}function I0(e,t){return e?!t:t}function S$(e,t,n,s,r,i,l,u){let{affectsX:d,affectsY:f}=t;const{isHorizontal:p,isVertical:m}=t,h=p&&m,{xSnapped:_,ySnapped:x}=n,{minWidth:y,maxWidth:v,minHeight:w,maxHeight:k}=s,{x:j,y:b,width:S,height:E,aspectRatio:M}=e;let O=Math.floor(p?_-e.pointerX:0),$=Math.floor(m?x-e.pointerY:0);const P=S+(d?-O:O),A=E+(f?-$:$),R=-i[0]*S,F=-i[1]*E;let z=wd(P,y,v),I=wd(A,w,k);if(l){let H=0,W=0;d&&O<0?H=Da(j+O+R,l[0][0]):!d&&O>0&&(H=Ia(j+P+R,l[1][0])),f&&$<0?W=Da(b+$+F,l[0][1]):!f&&$>0&&(W=Ia(b+A+F,l[1][1])),z=Math.max(z,H),I=Math.max(I,W)}if(u){let H=0,W=0;d&&O>0?H=Ia(j+O,u[0][0]):!d&&O<0&&(H=Da(j+P,u[1][0])),f&&$>0?W=Ia(b+$,u[0][1]):!f&&$<0&&(W=Da(b+A,u[1][1])),z=Math.max(z,H),I=Math.max(I,W)}if(r){if(p){const H=wd(P/M,w,k)*M;if(z=Math.max(z,H),l){let W=0;!d&&!f||d&&!f&&h?W=Ia(b+F+P/M,l[1][1])*M:W=Da(b+F+(d?O:-O)/M,l[0][1])*M,z=Math.max(z,W)}if(u){let W=0;!d&&!f||d&&!f&&h?W=Da(b+P/M,u[1][1])*M:W=Ia(b+(d?O:-O)/M,u[0][1])*M,z=Math.max(z,W)}}if(m){const H=wd(A*M,y,v)/M;if(I=Math.max(I,H),l){let W=0;!d&&!f||f&&!d&&h?W=Ia(j+A*M+R,l[1][0])/M:W=Da(j+(f?$:-$)*M+R,l[0][0])/M,I=Math.max(I,W)}if(u){let W=0;!d&&!f||f&&!d&&h?W=Da(j+A*M,u[1][0])/M:W=Ia(j+(f?$:-$)*M,u[0][0])/M,I=Math.max(I,W)}}}$=$+($<0?I:-I),O=O+(O<0?z:-z),r&&(h?P>A*M?$=(I0(d,f)?-O:O)/M:O=(I0(d,f)?-$:$)*M:p?($=O/M,f=d):(O=$*M,d=f));const U=d?j+O:j,q=f?b+$:b;return{width:S+(d?-O:O),height:E+(f?-$:$),x:i[0]*O*(d?-1:1)+U,y:i[1]*$*(f?-1:1)+q}}const F0={width:0,height:0,x:0,y:0},E$={...F0,pointerX:0,pointerY:0,aspectRatio:1};function k$(e){return[[0,0],[e.measured.width,e.measured.height]]}function M$(e,t,n){const s=t.position.x+e.position.x,r=t.position.y+e.position.y,i=e.measured.width??0,l=e.measured.height??0,u=n[0]*i,d=n[1]*l;return[[s-u,r-d],[s+i-u,r+l-d]]}function A$({domNode:e,nodeId:t,getStoreItems:n,onChange:s,onEnd:r}){const i=ps(e);let l={controlDirection:D0("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function u({controlPosition:f,boundaries:p,keepAspectRatio:m,resizeDirection:h,onResizeStart:_,onResize:x,onResizeEnd:y,shouldResize:v}){let w={...F0},k={...E$};l={boundaries:p,resizeDirection:h,keepAspectRatio:m,controlDirection:D0(f)};let j,b=null,S=[],E,M,O,$=!1;const P=Wf().on("start",A=>{const{nodeLookup:R,transform:F,snapGrid:z,snapToGrid:I,nodeOrigin:U,paneDomNode:q}=n();if(j=R.get(t),!j)return;b=(q==null?void 0:q.getBoundingClientRect())??null;const{xSnapped:H,ySnapped:W}=yc(A.sourceEvent,{transform:F,snapGrid:z,snapToGrid:I,containerBounds:b});w={width:j.measured.width??0,height:j.measured.height??0,x:j.position.x??0,y:j.position.y??0},k={...w,pointerX:H,pointerY:W,aspectRatio:w.width/w.height},E=void 0,j.parentId&&(j.extent==="parent"||j.expandParent)&&(E=R.get(j.parentId),M=E&&j.extent==="parent"?k$(E):void 0),S=[],O=void 0;for(const[B,D]of R)if(D.parentId===t&&(S.push({id:B,position:{...D.position},extent:D.extent}),D.extent==="parent"||D.expandParent)){const V=M$(D,j,D.origin??U);O?O=[[Math.min(V[0][0],O[0][0]),Math.min(V[0][1],O[0][1])],[Math.max(V[1][0],O[1][0]),Math.max(V[1][1],O[1][1])]]:O=V}_==null||_(A,{...w})}).on("drag",A=>{const{transform:R,snapGrid:F,snapToGrid:z,nodeOrigin:I}=n(),U=yc(A.sourceEvent,{transform:R,snapGrid:F,snapToGrid:z,containerBounds:b}),q=[];if(!j)return;const{x:H,y:W,width:B,height:D}=w,V={},te=j.origin??I,{width:G,height:K,x:X,y:Q}=S$(k,l.controlDirection,U,l.boundaries,l.keepAspectRatio,te,M,O),J=G!==B,Z=K!==D,ee=X!==H&&J,de=Q!==W&&Z;if(!ee&&!de&&!J&&!Z)return;if((ee||de||te[0]===1||te[1]===1)&&(V.x=ee?X:w.x,V.y=de?Q:w.y,w.x=V.x,w.y=V.y,S.length>0)){const ze=X-H,Ee=Q-W;for(const ie of S)ie.position={x:ie.position.x-ze+te[0]*(G-B),y:ie.position.y-Ee+te[1]*(K-D)},q.push(ie)}if((J||Z)&&(V.width=J&&(!l.resizeDirection||l.resizeDirection==="horizontal")?G:w.width,V.height=Z&&(!l.resizeDirection||l.resizeDirection==="vertical")?K:w.height,w.width=V.width,w.height=V.height),E&&j.expandParent){const ze=te[0]*(V.width??0);V.x&&V.x<ze&&(w.x=ze,k.x=k.x-(V.x-ze));const Ee=te[1]*(V.height??0);V.y&&V.y<Ee&&(w.y=Ee,k.y=k.y-(V.y-Ee))}const _e=C$({width:w.width,prevWidth:B,height:w.height,prevHeight:D,affectsX:l.controlDirection.affectsX,affectsY:l.controlDirection.affectsY}),ge={...w,direction:_e};(v==null?void 0:v(A,ge))!==!1&&($=!0,x==null||x(A,ge),s(V,q))}).on("end",A=>{$&&(y==null||y(A,{...w}),r==null||r({...w}),$=!1)});i.call(P)}function d(){i.on(".drag",null)}return{update:u,destroy:d}}var B0={exports:{}},np={},sp={exports:{}},rp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U0;function O$(){if(U0)return rp;U0=1;var e=N;function t(m,h){return m===h&&(m!==0||1/m===1/h)||m!==m&&h!==h}var n=typeof Object.is=="function"?Object.is:t,s=e.useState,r=e.useEffect,i=e.useLayoutEffect,l=e.useDebugValue;function u(m,h){var _=h(),x=s({inst:{value:_,getSnapshot:h}}),y=x[0].inst,v=x[1];return i(function(){y.value=_,y.getSnapshot=h,d(y)&&v({inst:y})},[m,_,h]),r(function(){return d(y)&&v({inst:y}),m(function(){d(y)&&v({inst:y})})},[m]),l(_),_}function d(m){var h=m.getSnapshot;m=m.value;try{var _=h();return!n(m,_)}catch{return!0}}function f(m,h){return h()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:u;return rp.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:p,rp}var H0;function $$(){return H0||(H0=1,sp.exports=O$()),sp.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q0;function T$(){if(q0)return np;q0=1;var e=N,t=$$();function n(f,p){return f===p&&(f!==0||1/f===1/p)||f!==f&&p!==p}var s=typeof Object.is=="function"?Object.is:n,r=t.useSyncExternalStore,i=e.useRef,l=e.useEffect,u=e.useMemo,d=e.useDebugValue;return np.useSyncExternalStoreWithSelector=function(f,p,m,h,_){var x=i(null);if(x.current===null){var y={hasValue:!1,value:null};x.current=y}else y=x.current;x=u(function(){function w(E){if(!k){if(k=!0,j=E,E=h(E),_!==void 0&&y.hasValue){var M=y.value;if(_(M,E))return b=M}return b=E}if(M=b,s(j,E))return M;var O=h(E);return _!==void 0&&_(M,O)?(j=E,M):(j=E,b=O)}var k=!1,j,b,S=m===void 0?null:m;return[function(){return w(p())},S===null?void 0:function(){return w(S())}]},[p,m,h,_]);var v=r(f,x[0],x[1]);return l(function(){y.hasValue=!0,y.value=v},[v]),d(v),v},np}B0.exports=T$();var P$=B0.exports;const L$=on(P$),z$={},V0=e=>{let t;const n=new Set,s=(p,m)=>{const h=typeof p=="function"?p(t):p;if(!Object.is(h,t)){const _=t;t=m??(typeof h!="object"||h===null)?h:Object.assign({},t,h),n.forEach(x=>x(t,_))}},r=()=>t,d={setState:s,getState:r,getInitialState:()=>f,subscribe:p=>(n.add(p),()=>n.delete(p)),destroy:()=>{(z$?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},f=t=e(s,r,d);return d},R$=e=>e?V0(e):V0,{useDebugValue:D$}=ve,{useSyncExternalStoreWithSelector:I$}=L$,F$=e=>e;function W0(e,t=F$,n){const s=I$(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return D$(s),s}const Y0=(e,t)=>{const n=R$(e),s=(r,i=t)=>W0(n,r,i);return Object.assign(s,n),s},B$=(e,t)=>e?Y0(e,t):Y0;function ln(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,r]of e)if(!Object.is(r,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const Nd=N.createContext(null),U$=Nd.Provider,K0=Fr.error001();function Ct(e,t){const n=N.useContext(Nd);if(n===null)throw new Error(K0);return W0(n,e,t)}function en(){const e=N.useContext(Nd);if(e===null)throw new Error(K0);return N.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const G0={display:"none"},H$={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},X0="react-flow__node-desc",Q0="react-flow__edge-desc",q$="react-flow__aria-live",V$=e=>e.ariaLiveMessage,W$=e=>e.ariaLabelConfig;function Y$({rfId:e}){const t=Ct(V$);return a.jsx("div",{id:`${q$}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:H$,children:t})}function K$({rfId:e,disableKeyboardA11y:t}){const n=Ct(W$);return a.jsxs(a.Fragment,{children:[a.jsx("div",{id:`${X0}-${e}`,style:G0,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),a.jsx("div",{id:`${Q0}-${e}`,style:G0,children:n["edge.a11yDescription.default"]}),!t&&a.jsx(Y$,{rfId:e})]})}const jd=N.forwardRef(({position:e="top-left",children:t,className:n,style:s,...r},i)=>{const l=`${e}`.split("-");return a.jsx("div",{className:$t(["react-flow__panel",n,...l]),style:s,ref:i,...r,children:t})});jd.displayName="Panel";function G$({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:a.jsx(jd,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:a.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const X$=e=>{const t=[],n=[];for(const[,s]of e.nodeLookup)s.selected&&t.push(s.internals.userNode);for(const[,s]of e.edgeLookup)s.selected&&n.push(s);return{selectedNodes:t,selectedEdges:n}},Cd=e=>e.id;function Q$(e,t){return ln(e.selectedNodes.map(Cd),t.selectedNodes.map(Cd))&&ln(e.selectedEdges.map(Cd),t.selectedEdges.map(Cd))}function Z$({onSelectionChange:e}){const t=en(),{selectedNodes:n,selectedEdges:s}=Ct(X$,Q$);return N.useEffect(()=>{const r={nodes:n,edges:s};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(i=>i(r))},[n,s,e]),null}const J$=e=>!!e.onSelectionChangeHandlers;function eT({onSelectionChange:e}){const t=Ct(J$);return e||t?a.jsx(Z$,{onSelectionChange:e}):null}const Z0=[0,0],tT={x:0,y:0,zoom:1},J0=[...["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig"],"rfId"],nT=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),eb={translateExtent:uc,nodeOrigin:Z0,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function sT(e){const{setNodes:t,setEdges:n,setMinZoom:s,setMaxZoom:r,setTranslateExtent:i,setNodeExtent:l,reset:u,setDefaultNodesAndEdges:d}=Ct(nT,ln),f=en();N.useEffect(()=>(d(e.defaultNodes,e.defaultEdges),()=>{p.current=eb,u()}),[]);const p=N.useRef(eb);return N.useEffect(()=>{for(const m of J0){const h=e[m],_=p.current[m];h!==_&&(typeof e[m]>"u"||(m==="nodes"?t(h):m==="edges"?n(h):m==="minZoom"?s(h):m==="maxZoom"?r(h):m==="translateExtent"?i(h):m==="nodeExtent"?l(h):m==="ariaLabelConfig"?f.setState({ariaLabelConfig:U2(h)}):m==="fitView"?f.setState({fitViewQueued:h}):m==="fitViewOptions"?f.setState({fitViewOptions:h}):f.setState({[m]:h})))}p.current=e},J0.map(m=>e[m])),null}function tb(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function rT(e){var s;const[t,n]=N.useState(e==="system"?null:e);return N.useEffect(()=>{if(e!=="system"){n(e);return}const r=tb(),i=()=>n(r!=null&&r.matches?"dark":"light");return i(),r==null||r.addEventListener("change",i),()=>{r==null||r.removeEventListener("change",i)}},[e]),t!==null?t:(s=tb())!=null&&s.matches?"dark":"light"}const nb=typeof document<"u"?document:null;function xc(e=null,t={target:nb,actInsideInputWithModifier:!0}){const[n,s]=N.useState(!1),r=N.useRef(!1),i=N.useRef(new Set([])),[l,u]=N.useMemo(()=>{if(e!==null){const f=(Array.isArray(e)?e:[e]).filter(m=>typeof m=="string").map(m=>m.replace("+",`
`).replace(`

`,`
+`).split(`
`)),p=f.reduce((m,h)=>m.concat(...h),[]);return[f,p]}return[[],[]]},[e]);return N.useEffect(()=>{const d=(t==null?void 0:t.target)??nb,f=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const p=_=>{var v,w;if(r.current=_.ctrlKey||_.metaKey||_.shiftKey||_.altKey,(!r.current||r.current&&!f)&&f0(_))return!1;const y=rb(_.code,u);if(i.current.add(_[y]),sb(l,i.current,!1)){const k=((w=(v=_.composedPath)==null?void 0:v.call(_))==null?void 0:w[0])||_.target,j=(k==null?void 0:k.nodeName)==="BUTTON"||(k==null?void 0:k.nodeName)==="A";t.preventDefault!==!1&&(r.current||!j)&&_.preventDefault(),s(!0)}},m=_=>{const x=rb(_.code,u);sb(l,i.current,!0)?(s(!1),i.current.clear()):i.current.delete(_[x]),_.key==="Meta"&&i.current.clear(),r.current=!1},h=()=>{i.current.clear(),s(!1)};return d==null||d.addEventListener("keydown",p),d==null||d.addEventListener("keyup",m),window.addEventListener("blur",h),window.addEventListener("contextmenu",h),()=>{d==null||d.removeEventListener("keydown",p),d==null||d.removeEventListener("keyup",m),window.removeEventListener("blur",h),window.removeEventListener("contextmenu",h)}}},[e,s]),n}function sb(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(r=>t.has(r)))}function rb(e,t){return t.includes(e)?"code":"key"}const aT=()=>{const e=en();return N.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:s}=e.getState();return s?s.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[s,r,i],panZoom:l}=e.getState();return l?(await l.setViewport({x:t.x??s,y:t.y??r,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,s]=e.getState().transform;return{x:t,y:n,zoom:s}},setCenter:async(t,n,s)=>e.getState().setCenter(t,n,s),fitBounds:async(t,n)=>{const{width:s,height:r,minZoom:i,maxZoom:l,panZoom:u}=e.getState(),d=Hh(t,s,r,i,l,(n==null?void 0:n.padding)??.1);return u?(await u.setViewport(d,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:s,snapGrid:r,snapToGrid:i,domNode:l}=e.getState();if(!l)return t;const{x:u,y:d}=l.getBoundingClientRect(),f={x:t.x-u,y:t.y-d},p=n.snapGrid??r,m=n.snapToGrid??i;return gc(f,s,m,p)},flowToScreenPosition:t=>{const{transform:n,domNode:s}=e.getState();if(!s)return t;const{x:r,y:i}=s.getBoundingClientRect(),l=vd(t,n);return{x:l.x+r,y:l.y+i}}}),[])};function ab(e,t){const n=[],s=new Map,r=[];for(const i of e)if(i.type==="add"){r.push(i);continue}else if(i.type==="remove"||i.type==="replace")s.set(i.id,[i]);else{const l=s.get(i.id);l?l.push(i):s.set(i.id,[i])}for(const i of t){const l=s.get(i.id);if(!l){n.push(i);continue}if(l[0].type==="remove")continue;if(l[0].type==="replace"){n.push({...l[0].item});continue}const u={...i};for(const d of l)oT(d,u);n.push(u)}return r.length&&r.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function oT(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function iT(e,t){return ab(e,t)}function lT(e,t){return ab(e,t)}function Po(e,t){return{id:e,type:"select",selected:t}}function Zi(e,t=new Set,n=!1){const s=[];for(const[r,i]of e){const l=t.has(r);!(i.selected===void 0&&!l)&&i.selected!==l&&(n&&(i.selected=l),s.push(Po(i.id,l)))}return s}function ob({items:e=[],lookup:t}){var r;const n=[],s=new Map(e.map(i=>[i.id,i]));for(const[i,l]of e.entries()){const u=t.get(l.id),d=((r=u==null?void 0:u.internals)==null?void 0:r.userNode)??u;d!==void 0&&d!==l&&n.push({id:l.id,item:l,type:"replace"}),d===void 0&&n.push({item:l,type:"add",index:i})}for(const[i]of t)s.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function ib(e){return{id:e.id,type:"remove"}}const lb=e=>$2(e),cT=e=>n0(e);function cb(e){return N.forwardRef(e)}const uT=typeof window<"u"?N.useLayoutEffect:N.useEffect;function ub(e){const[t,n]=N.useState(BigInt(0)),[s]=N.useState(()=>dT(()=>n(r=>r+BigInt(1))));return uT(()=>{const r=s.get();r.length&&(e(r),s.reset())},[t]),s}function dT(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const db=N.createContext(null);function mT({children:e}){const t=en(),n=N.useCallback(u=>{const{nodes:d=[],setNodes:f,hasDefaultNodes:p,onNodesChange:m,nodeLookup:h,fitViewQueued:_}=t.getState();let x=d;for(const v of u)x=typeof v=="function"?v(x):v;const y=ob({items:x,lookup:h});p&&f(x),y.length>0?m==null||m(y):_&&window.requestAnimationFrame(()=>{const{fitViewQueued:v,nodes:w,setNodes:k}=t.getState();v&&k(w)})},[]),s=ub(n),r=N.useCallback(u=>{const{edges:d=[],setEdges:f,hasDefaultEdges:p,onEdgesChange:m,edgeLookup:h}=t.getState();let _=d;for(const x of u)_=typeof x=="function"?x(_):x;p?f(_):m&&m(ob({items:_,lookup:h}))},[]),i=ub(r),l=N.useMemo(()=>({nodeQueue:s,edgeQueue:i}),[]);return a.jsx(db.Provider,{value:l,children:e})}function fT(){const e=N.useContext(db);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const hT=e=>!!e.panZoom;function ap(){const e=aT(),t=en(),n=fT(),s=Ct(hT),r=N.useMemo(()=>{const i=m=>t.getState().nodeLookup.get(m),l=m=>{n.nodeQueue.push(m)},u=m=>{n.edgeQueue.push(m)},d=m=>{var w,k;const{nodeLookup:h,nodeOrigin:_}=t.getState(),x=lb(m)?m:h.get(m.id),y=x.parentId?u0(x.position,x.measured,x.parentId,h,_):x.position,v={...x,position:y,width:((w=x.measured)==null?void 0:w.width)??x.width,height:((k=x.measured)==null?void 0:k.height)??x.height};return Yi(v)},f=(m,h,_={replace:!1})=>{l(x=>x.map(y=>{if(y.id===m){const v=typeof h=="function"?h(y):h;return _.replace&&lb(v)?v:{...y,...v}}return y}))},p=(m,h,_={replace:!1})=>{u(x=>x.map(y=>{if(y.id===m){const v=typeof h=="function"?h(y):h;return _.replace&&cT(v)?v:{...y,...v}}return y}))};return{getNodes:()=>t.getState().nodes.map(m=>({...m})),getNode:m=>{var h;return(h=i(m))==null?void 0:h.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:m=[]}=t.getState();return m.map(h=>({...h}))},getEdge:m=>t.getState().edgeLookup.get(m),setNodes:l,setEdges:u,addNodes:m=>{const h=Array.isArray(m)?m:[m];n.nodeQueue.push(_=>[..._,...h])},addEdges:m=>{const h=Array.isArray(m)?m:[m];n.edgeQueue.push(_=>[..._,...h])},toObject:()=>{const{nodes:m=[],edges:h=[],transform:_}=t.getState(),[x,y,v]=_;return{nodes:m.map(w=>({...w})),edges:h.map(w=>({...w})),viewport:{x,y,zoom:v}}},deleteElements:async({nodes:m=[],edges:h=[]})=>{const{nodes:_,edges:x,onNodesDelete:y,onEdgesDelete:v,triggerNodeChanges:w,triggerEdgeChanges:k,onDelete:j,onBeforeDelete:b}=t.getState(),{nodes:S,edges:E}=await R2({nodesToRemove:m,edgesToRemove:h,nodes:_,edges:x,onBeforeDelete:b}),M=E.length>0,O=S.length>0;if(M){const $=E.map(ib);v==null||v(E),k($)}if(O){const $=S.map(ib);y==null||y(S),w($)}return(O||M)&&(j==null||j({nodes:S,edges:E})),{deletedNodes:S,deletedEdges:E}},getIntersectingNodes:(m,h=!0,_)=>{const x=l0(m),y=x?m:d(m),v=_!==void 0;return y?(_||t.getState().nodes).filter(w=>{const k=t.getState().nodeLookup.get(w.id);if(k&&!x&&(w.id===m.id||!k.internals.positionAbsolute))return!1;const j=Yi(v?w:k),b=hc(j,y);return h&&b>0||b>=j.width*j.height||b>=y.width*y.height}):[]},isNodeIntersecting:(m,h,_=!0)=>{const y=l0(m)?m:d(m);if(!y)return!1;const v=hc(y,h);return _&&v>0||v>=h.width*h.height||v>=y.width*y.height},updateNode:f,updateNodeData:(m,h,_={replace:!1})=>{f(m,x=>{const y=typeof h=="function"?h(x):h;return _.replace?{...x,data:y}:{...x,data:{...x.data,...y}}},_)},updateEdge:p,updateEdgeData:(m,h,_={replace:!1})=>{p(m,x=>{const y=typeof h=="function"?h(x):h;return _.replace?{...x,data:y}:{...x,data:{...x.data,...y}}},_)},getNodesBounds:m=>{const{nodeLookup:h,nodeOrigin:_}=t.getState();return T2(m,{nodeLookup:h,nodeOrigin:_})},getHandleConnections:({type:m,id:h,nodeId:_})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${_}-${m}${h?`-${h}`:""}`))==null?void 0:x.values())??[])},getNodeConnections:({type:m,handleId:h,nodeId:_})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${_}${m?h?`-${m}-${h}`:`-${m}`:""}`))==null?void 0:x.values())??[])},fitView:async m=>{const h=t.getState().fitViewResolver??B2();return t.setState({fitViewQueued:!0,fitViewOptions:m,fitViewResolver:h}),n.nodeQueue.push(_=>[..._]),h.promise}}},[]);return N.useMemo(()=>({...r,...e,viewportInitialized:s}),[s])}const mb=e=>e.selected,pT=typeof window<"u"?window:void 0;function gT({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=en(),{deleteElements:s}=ap(),r=xc(e,{actInsideInputWithModifier:!1}),i=xc(t,{target:pT});N.useEffect(()=>{if(r){const{edges:l,nodes:u}=n.getState();s({nodes:u.filter(mb),edges:l.filter(mb)}),n.setState({nodesSelectionActive:!1})}},[r]),N.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function _T(e){const t=en();N.useEffect(()=>{const n=()=>{var r,i,l,u;if(!e.current||!(((i=(r=e.current).checkVisibility)==null?void 0:i.call(r))??!0))return!1;const s=qh(e.current);(s.height===0||s.width===0)&&((u=(l=t.getState()).onError)==null||u.call(l,"004",Fr.error004())),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const s=new ResizeObserver(()=>n());return s.observe(e.current),()=>{window.removeEventListener("resize",n),s&&e.current&&s.unobserve(e.current)}}},[])}const Sd={position:"absolute",width:"100%",height:"100%",top:0,left:0},yT=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function vT({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:s=!1,panOnScrollSpeed:r=.5,panOnScrollMode:i=$o.Free,zoomOnDoubleClick:l=!0,panOnDrag:u=!0,defaultViewport:d,translateExtent:f,minZoom:p,maxZoom:m,zoomActivationKeyCode:h,preventScrolling:_=!0,children:x,noWheelClassName:y,noPanClassName:v,onViewportChange:w,isControlledViewport:k,paneClickDistance:j,selectionOnDrag:b}){const S=en(),E=N.useRef(null),{userSelectionActive:M,lib:O,connectionInProgress:$}=Ct(yT,ln),P=xc(h),A=N.useRef();_T(E);const R=N.useCallback(F=>{w==null||w({x:F[0],y:F[1],zoom:F[2]}),k||S.setState({transform:F})},[w,k]);return N.useEffect(()=>{if(E.current){A.current=j$({domNode:E.current,minZoom:p,maxZoom:m,translateExtent:f,viewport:d,onDraggingChange:U=>S.setState({paneDragging:U}),onPanZoomStart:(U,q)=>{const{onViewportChangeStart:H,onMoveStart:W}=S.getState();W==null||W(U,q),H==null||H(q)},onPanZoom:(U,q)=>{const{onViewportChange:H,onMove:W}=S.getState();W==null||W(U,q),H==null||H(q)},onPanZoomEnd:(U,q)=>{const{onViewportChangeEnd:H,onMoveEnd:W}=S.getState();W==null||W(U,q),H==null||H(q)}});const{x:F,y:z,zoom:I}=A.current.getViewport();return S.setState({panZoom:A.current,transform:[F,z,I],domNode:E.current.closest(".react-flow")}),()=>{var U;(U=A.current)==null||U.destroy()}}},[]),N.useEffect(()=>{var F;(F=A.current)==null||F.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:s,panOnScrollSpeed:r,panOnScrollMode:i,zoomOnDoubleClick:l,panOnDrag:u,zoomActivationKeyPressed:P,preventScrolling:_,noPanClassName:v,userSelectionActive:M,noWheelClassName:y,lib:O,onTransformChange:R,connectionInProgress:$,selectionOnDrag:b,paneClickDistance:j})},[e,t,n,s,r,i,l,u,P,_,v,M,y,O,R,$,b,j]),a.jsx("div",{className:"react-flow__renderer",ref:E,style:Sd,children:x})}const xT=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function bT(){const{userSelectionActive:e,userSelectionRect:t}=Ct(xT,ln);return e&&t?a.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const op=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},wT=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function NT({isSelecting:e,selectionKeyPressed:t,selectionMode:n=dc.Full,panOnDrag:s,paneClickDistance:r,selectionOnDrag:i,onSelectionStart:l,onSelectionEnd:u,onPaneClick:d,onPaneContextMenu:f,onPaneScroll:p,onPaneMouseEnter:m,onPaneMouseMove:h,onPaneMouseLeave:_,children:x}){const y=en(),{userSelectionActive:v,elementsSelectable:w,dragging:k,connectionInProgress:j}=Ct(wT,ln),b=w&&(e||v),S=N.useRef(null),E=N.useRef(),M=N.useRef(new Set),O=N.useRef(new Set),$=N.useRef(!1),P=H=>{if($.current||j){$.current=!1;return}d==null||d(H),y.getState().resetSelectedElements(),y.setState({nodesSelectionActive:!1})},A=H=>{if(Array.isArray(s)&&(s!=null&&s.includes(2))){H.preventDefault();return}f==null||f(H)},R=p?H=>p(H):void 0,F=H=>{$.current&&(H.stopPropagation(),$.current=!1)},z=H=>{var K,X;const{domNode:W}=y.getState();if(E.current=W==null?void 0:W.getBoundingClientRect(),!E.current)return;const B=H.target===S.current;if(!B&&!!H.target.closest(".nokey")||!e||!(i&&B||t)||H.button!==0||!H.isPrimary)return;(X=(K=H.target)==null?void 0:K.setPointerCapture)==null||X.call(K,H.pointerId),$.current=!1;const{x:te,y:G}=Nr(H.nativeEvent,E.current);y.setState({userSelectionRect:{width:0,height:0,startX:te,startY:G,x:te,y:G}}),B||(H.stopPropagation(),H.preventDefault())},I=H=>{const{userSelectionRect:W,transform:B,nodeLookup:D,edgeLookup:V,connectionLookup:te,triggerNodeChanges:G,triggerEdgeChanges:K,defaultEdgeOptions:X,resetSelectedElements:Q}=y.getState();if(!E.current||!W)return;const{x:J,y:Z}=Nr(H.nativeEvent,E.current),{startX:ee,startY:de}=W;if(!$.current){const Ee=t?0:r;if(Math.hypot(J-ee,Z-de)<=Ee)return;Q(),l==null||l(H)}$.current=!0;const _e={startX:ee,startY:de,x:J<ee?J:ee,y:Z<de?Z:de,width:Math.abs(J-ee),height:Math.abs(Z-de)},ge=M.current,be=O.current;M.current=new Set(Bh(D,_e,B,n===dc.Partial,!0).map(Ee=>Ee.id)),O.current=new Set;const ze=(X==null?void 0:X.selectable)??!0;for(const Ee of M.current){const ie=te.get(Ee);if(ie)for(const{edgeId:pe}of ie.values()){const Ce=V.get(pe);Ce&&(Ce.selectable??ze)&&O.current.add(pe)}}if(!d0(ge,M.current)){const Ee=Zi(D,M.current,!0);G(Ee)}if(!d0(be,O.current)){const Ee=Zi(V,O.current);K(Ee)}y.setState({userSelectionRect:_e,userSelectionActive:!0,nodesSelectionActive:!1})},U=H=>{var W,B;H.button===0&&((B=(W=H.target)==null?void 0:W.releasePointerCapture)==null||B.call(W,H.pointerId),!v&&H.target===S.current&&y.getState().userSelectionRect&&(P==null||P(H)),y.setState({userSelectionActive:!1,userSelectionRect:null}),$.current&&(u==null||u(H),y.setState({nodesSelectionActive:M.current.size>0})))},q=s===!0||Array.isArray(s)&&s.includes(0);return a.jsxs("div",{className:$t(["react-flow__pane",{draggable:q,dragging:k,selection:e}]),onClick:b?void 0:op(P,S),onContextMenu:op(A,S),onWheel:op(R,S),onPointerEnter:b?void 0:m,onPointerMove:b?I:h,onPointerUp:b?U:void 0,onPointerDownCapture:b?z:void 0,onClickCapture:b?F:void 0,onPointerLeave:_,ref:S,style:Sd,children:[x,a.jsx(bT,{})]})}function ip({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:l,nodeLookup:u,onError:d}=t.getState(),f=u.get(e);if(!f){d==null||d("012",Fr.error012(e));return}t.setState({nodesSelectionActive:!1}),f.selected?(n||f.selected&&l)&&(i({nodes:[f],edges:[]}),requestAnimationFrame(()=>{var p;return(p=s==null?void 0:s.current)==null?void 0:p.blur()})):r([e])}function fb({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:r,isSelectable:i,nodeClickDistance:l}){const u=en(),[d,f]=N.useState(!1),p=N.useRef();return N.useEffect(()=>{p.current=u$({getStoreItems:()=>u.getState(),onNodeMouseDown:m=>{ip({id:m,store:u,nodeRef:e})},onDragStart:()=>{f(!0)},onDragStop:()=>{f(!1)}})},[]),N.useEffect(()=>{var m,h;if(t)(m=p.current)==null||m.destroy();else if(e.current)return(h=p.current)==null||h.update({noDragClassName:n,handleSelector:s,domNode:e.current,isSelectable:i,nodeId:r,nodeClickDistance:l}),()=>{var _;(_=p.current)==null||_.destroy()}},[n,s,t,i,e,r]),d}const jT=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function hb(){const e=en();return N.useCallback(n=>{const{nodeExtent:s,snapToGrid:r,snapGrid:i,nodesDraggable:l,onError:u,updateNodePositions:d,nodeLookup:f,nodeOrigin:p}=e.getState(),m=new Map,h=jT(l),_=r?i[0]:5,x=r?i[1]:5,y=n.direction.x*_*n.factor,v=n.direction.y*x*n.factor;for(const[,w]of f){if(!h(w))continue;let k={x:w.internals.positionAbsolute.x+y,y:w.internals.positionAbsolute.y+v};r&&(k=pc(k,i));const{position:j,positionAbsolute:b}=s0({nodeId:w.id,nextPosition:k,nodeLookup:f,nodeExtent:s,nodeOrigin:p,onError:u});w.position=j,w.internals.positionAbsolute=b,m.set(w.id,w)}d(m)},[])}const lp=N.createContext(null),CT=lp.Provider;lp.Consumer;const pb=()=>N.useContext(lp),ST=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),ET=(e,t,n)=>s=>{const{connectionClickStartHandle:r,connectionMode:i,connection:l}=s,{fromHandle:u,toHandle:d,isValid:f}=l,p=(d==null?void 0:d.nodeId)===e&&(d==null?void 0:d.id)===t&&(d==null?void 0:d.type)===n;return{connectingFrom:(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.id)===t&&(u==null?void 0:u.type)===n,connectingTo:p,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===n,isPossibleEndHandle:i===Vi.Strict?(u==null?void 0:u.type)!==n:e!==(u==null?void 0:u.nodeId)||t!==(u==null?void 0:u.id),connectionInProcess:!!u,clickConnectionInProcess:!!r,valid:p&&f}};function kT({type:e="source",position:t=Xe.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:r=!0,isConnectableEnd:i=!0,id:l,onConnect:u,children:d,className:f,onMouseDown:p,onTouchStart:m,...h},_){var I,U;const x=l||null,y=e==="target",v=en(),w=pb(),{connectOnClick:k,noPanClassName:j,rfId:b}=Ct(ST,ln),{connectingFrom:S,connectingTo:E,clickConnecting:M,isPossibleEndHandle:O,connectionInProcess:$,clickConnectionInProcess:P,valid:A}=Ct(ET(w,x,e),ln);w||(U=(I=v.getState()).onError)==null||U.call(I,"010",Fr.error010());const R=q=>{const{defaultEdgeOptions:H,onConnect:W,hasDefaultEdges:B}=v.getState(),D={...H,...q};if(B){const{edges:V,setEdges:te}=v.getState();te(K2(D,V))}W==null||W(D),u==null||u(D)},F=q=>{if(!w)return;const H=h0(q.nativeEvent);if(r&&(H&&q.button===0||!H)){const W=v.getState();Jh.onPointerDown(q.nativeEvent,{handleDomNode:q.currentTarget,autoPanOnConnect:W.autoPanOnConnect,connectionMode:W.connectionMode,connectionRadius:W.connectionRadius,domNode:W.domNode,nodeLookup:W.nodeLookup,lib:W.lib,isTarget:y,handleId:x,nodeId:w,flowId:W.rfId,panBy:W.panBy,cancelConnection:W.cancelConnection,onConnectStart:W.onConnectStart,onConnectEnd:W.onConnectEnd,updateConnection:W.updateConnection,onConnect:R,isValidConnection:n||W.isValidConnection,getTransform:()=>v.getState().transform,getFromHandle:()=>v.getState().connection.fromHandle,autoPanSpeed:W.autoPanSpeed,dragThreshold:W.connectionDragThreshold})}H?p==null||p(q):m==null||m(q)},z=q=>{const{onClickConnectStart:H,onClickConnectEnd:W,connectionClickStartHandle:B,connectionMode:D,isValidConnection:V,lib:te,rfId:G,nodeLookup:K,connection:X}=v.getState();if(!w||!B&&!r)return;if(!B){H==null||H(q.nativeEvent,{nodeId:w,handleId:x,handleType:e}),v.setState({connectionClickStartHandle:{nodeId:w,type:e,id:x}});return}const Q=m0(q.target),J=n||V,{connection:Z,isValid:ee}=Jh.isValid(q.nativeEvent,{handle:{nodeId:w,id:x,type:e},connectionMode:D,fromNodeId:B.nodeId,fromHandleId:B.id||null,fromType:B.type,isValidConnection:J,flowId:G,doc:Q,lib:te,nodeLookup:K});ee&&Z&&R(Z);const de=structuredClone(X);delete de.inProgress,de.toPosition=de.toHandle?de.toHandle.position:null,W==null||W(q,de),v.setState({connectionClickStartHandle:null})};return a.jsx("div",{"data-handleid":x,"data-nodeid":w,"data-handlepos":t,"data-id":`${b}-${w}-${x}-${e}`,className:$t(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",j,f,{source:!y,target:y,connectable:s,connectablestart:r,connectableend:i,clickconnecting:M,connectingfrom:S,connectingto:E,valid:A,connectionindicator:s&&(!$||O)&&($||P?i:r)}]),onMouseDown:F,onTouchStart:F,onClick:k?z:void 0,ref:_,...h,children:d})}const Ed=N.memo(cb(kT));function MT({data:e,isConnectable:t,sourcePosition:n=Xe.Bottom}){return a.jsxs(a.Fragment,{children:[e==null?void 0:e.label,a.jsx(Ed,{type:"source",position:n,isConnectable:t})]})}function AT({data:e,isConnectable:t,targetPosition:n=Xe.Top,sourcePosition:s=Xe.Bottom}){return a.jsxs(a.Fragment,{children:[a.jsx(Ed,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,a.jsx(Ed,{type:"source",position:s,isConnectable:t})]})}function OT(){return null}function $T({data:e,isConnectable:t,targetPosition:n=Xe.Top}){return a.jsxs(a.Fragment,{children:[a.jsx(Ed,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const kd={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},gb={input:MT,default:AT,output:$T,group:OT};function TT(e){var t,n,s,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((s=e.style)==null?void 0:s.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const PT=e=>{const{width:t,height:n,x:s,y:r}=fc(e.nodeLookup,{filter:i=>!!i.selected});return{width:wr(t)?t:null,height:wr(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${s}px,${r}px)`}};function LT({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=en(),{width:r,height:i,transformString:l,userSelectionActive:u}=Ct(PT,ln),d=hb(),f=N.useRef(null);if(N.useEffect(()=>{var h;n||(h=f.current)==null||h.focus({preventScroll:!0})},[n]),fb({nodeRef:f}),u||!r||!i)return null;const p=e?h=>{const _=s.getState().nodes.filter(x=>x.selected);e(h,_)}:void 0,m=h=>{Object.prototype.hasOwnProperty.call(kd,h.key)&&(h.preventDefault(),d({direction:kd[h.key],factor:h.shiftKey?4:1}))};return a.jsx("div",{className:$t(["react-flow__nodesselection","react-flow__container",t]),style:{transform:l},children:a.jsx("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:n?void 0:-1,onKeyDown:n?void 0:m,style:{width:r,height:i}})})}const _b=typeof window<"u"?window:void 0,zT=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function yb({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:l,paneClickDistance:u,deleteKeyCode:d,selectionKeyCode:f,selectionOnDrag:p,selectionMode:m,onSelectionStart:h,onSelectionEnd:_,multiSelectionKeyCode:x,panActivationKeyCode:y,zoomActivationKeyCode:v,elementsSelectable:w,zoomOnScroll:k,zoomOnPinch:j,panOnScroll:b,panOnScrollSpeed:S,panOnScrollMode:E,zoomOnDoubleClick:M,panOnDrag:O,defaultViewport:$,translateExtent:P,minZoom:A,maxZoom:R,preventScrolling:F,onSelectionContextMenu:z,noWheelClassName:I,noPanClassName:U,disableKeyboardA11y:q,onViewportChange:H,isControlledViewport:W}){const{nodesSelectionActive:B,userSelectionActive:D}=Ct(zT),V=xc(f,{target:_b}),te=xc(y,{target:_b}),G=te||O,K=te||b,X=p&&G!==!0,Q=V||D||X;return gT({deleteKeyCode:d,multiSelectionKeyCode:x}),a.jsx(vT,{onPaneContextMenu:i,elementsSelectable:w,zoomOnScroll:k,zoomOnPinch:j,panOnScroll:K,panOnScrollSpeed:S,panOnScrollMode:E,zoomOnDoubleClick:M,panOnDrag:!V&&G,defaultViewport:$,translateExtent:P,minZoom:A,maxZoom:R,zoomActivationKeyCode:v,preventScrolling:F,noWheelClassName:I,noPanClassName:U,onViewportChange:H,isControlledViewport:W,paneClickDistance:u,selectionOnDrag:X,children:a.jsxs(NT,{onSelectionStart:h,onSelectionEnd:_,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:l,panOnDrag:G,isSelecting:!!Q,selectionMode:m,selectionKeyPressed:V,paneClickDistance:u,selectionOnDrag:X,children:[e,B&&a.jsx(LT,{onSelectionContextMenu:z,noPanClassName:U,disableKeyboardA11y:q})]})})}yb.displayName="FlowRenderer";const RT=N.memo(yb),DT=e=>t=>e?Bh(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function IT(e){return Ct(N.useCallback(DT(e),[e]),ln)}const FT=e=>e.updateNodeInternals;function BT(){const e=Ct(FT),[t]=N.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const s=new Map;n.forEach(r=>{const i=r.target.getAttribute("data-id");s.set(i,{id:i,nodeElement:r.target,force:!0})}),e(s)}));return N.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function UT({node:e,nodeType:t,hasDimensions:n,resizeObserver:s}){const r=en(),i=N.useRef(null),l=N.useRef(null),u=N.useRef(e.sourcePosition),d=N.useRef(e.targetPosition),f=N.useRef(t),p=n&&!!e.internals.handleBounds;return N.useEffect(()=>{i.current&&!e.hidden&&(!p||l.current!==i.current)&&(l.current&&(s==null||s.unobserve(l.current)),s==null||s.observe(i.current),l.current=i.current)},[p,e.hidden]),N.useEffect(()=>()=>{l.current&&(s==null||s.unobserve(l.current),l.current=null)},[]),N.useEffect(()=>{if(i.current){const m=f.current!==t,h=u.current!==e.sourcePosition,_=d.current!==e.targetPosition;(m||h||_)&&(f.current=t,u.current=e.sourcePosition,d.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function HT({id:e,onClick:t,onMouseEnter:n,onMouseMove:s,onMouseLeave:r,onContextMenu:i,onDoubleClick:l,nodesDraggable:u,elementsSelectable:d,nodesConnectable:f,nodesFocusable:p,resizeObserver:m,noDragClassName:h,noPanClassName:_,disableKeyboardA11y:x,rfId:y,nodeTypes:v,nodeClickDistance:w,onError:k}){const{node:j,internals:b,isParent:S}=Ct(J=>{const Z=J.nodeLookup.get(e),ee=J.parentLookup.has(e);return{node:Z,internals:Z.internals,isParent:ee}},ln);let E=j.type||"default",M=(v==null?void 0:v[E])||gb[E];M===void 0&&(k==null||k("003",Fr.error003(E)),E="default",M=(v==null?void 0:v.default)||gb.default);const O=!!(j.draggable||u&&typeof j.draggable>"u"),$=!!(j.selectable||d&&typeof j.selectable>"u"),P=!!(j.connectable||f&&typeof j.connectable>"u"),A=!!(j.focusable||p&&typeof j.focusable>"u"),R=en(),F=c0(j),z=UT({node:j,nodeType:E,hasDimensions:F,resizeObserver:m}),I=fb({nodeRef:z,disabled:j.hidden||!O,noDragClassName:h,handleSelector:j.dragHandle,nodeId:e,isSelectable:$,nodeClickDistance:w}),U=hb();if(j.hidden)return null;const q=aa(j),H=TT(j),W=$||O||t||n||s||r,B=n?J=>n(J,{...b.userNode}):void 0,D=s?J=>s(J,{...b.userNode}):void 0,V=r?J=>r(J,{...b.userNode}):void 0,te=i?J=>i(J,{...b.userNode}):void 0,G=l?J=>l(J,{...b.userNode}):void 0,K=J=>{const{selectNodesOnDrag:Z,nodeDragThreshold:ee}=R.getState();$&&(!Z||!O||ee>0)&&ip({id:e,store:R,nodeRef:z}),t&&t(J,{...b.userNode})},X=J=>{if(!(f0(J.nativeEvent)||x)){if(Qx.includes(J.key)&&$){const Z=J.key==="Escape";ip({id:e,store:R,unselect:Z,nodeRef:z})}else if(O&&j.selected&&Object.prototype.hasOwnProperty.call(kd,J.key)){J.preventDefault();const{ariaLabelConfig:Z}=R.getState();R.setState({ariaLiveMessage:Z["node.a11yDescription.ariaLiveMessage"]({direction:J.key.replace("Arrow","").toLowerCase(),x:~~b.positionAbsolute.x,y:~~b.positionAbsolute.y})}),U({direction:kd[J.key],factor:J.shiftKey?4:1})}}},Q=()=>{var be;if(x||!((be=z.current)!=null&&be.matches(":focus-visible")))return;const{transform:J,width:Z,height:ee,autoPanOnNodeFocus:de,setCenter:_e}=R.getState();if(!de)return;Bh(new Map([[e,j]]),{x:0,y:0,width:Z,height:ee},J,!0).length>0||_e(j.position.x+q.width/2,j.position.y+q.height/2,{zoom:J[2]})};return a.jsx("div",{className:$t(["react-flow__node",`react-flow__node-${E}`,{[_]:O},j.className,{selected:j.selected,selectable:$,parent:S,draggable:O,dragging:I}]),ref:z,style:{zIndex:b.z,transform:`translate(${b.positionAbsolute.x}px,${b.positionAbsolute.y}px)`,pointerEvents:W?"all":"none",visibility:F?"visible":"hidden",...j.style,...H},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:B,onMouseMove:D,onMouseLeave:V,onContextMenu:te,onClick:K,onDoubleClick:G,onKeyDown:A?X:void 0,tabIndex:A?0:void 0,onFocus:A?Q:void 0,role:j.ariaRole??(A?"group":void 0),"aria-roledescription":"node","aria-describedby":x?void 0:`${X0}-${y}`,"aria-label":j.ariaLabel,...j.domAttributes,children:a.jsx(CT,{value:e,children:a.jsx(M,{id:e,data:j.data,type:E,positionAbsoluteX:b.positionAbsolute.x,positionAbsoluteY:b.positionAbsolute.y,selected:j.selected??!1,selectable:$,draggable:O,deletable:j.deletable??!0,isConnectable:P,sourcePosition:j.sourcePosition,targetPosition:j.targetPosition,dragging:I,dragHandle:j.dragHandle,zIndex:b.z,parentId:j.parentId,...q})})})}var qT=N.memo(HT);const VT=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function vb(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,onError:i}=Ct(VT,ln),l=IT(e.onlyRenderVisibleElements),u=BT();return a.jsx("div",{className:"react-flow__nodes",style:Sd,children:l.map(d=>a.jsx(qT,{id:d,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:u,nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:i},d))})}vb.displayName="NodeRenderer";const WT=N.memo(vb);function YT(e){return Ct(N.useCallback(n=>{if(!e)return n.edges.map(r=>r.id);const s=[];if(n.width&&n.height)for(const r of n.edges){const i=n.nodeLookup.get(r.source),l=n.nodeLookup.get(r.target);i&&l&&V2({sourceNode:i,targetNode:l,width:n.width,height:n.height,transform:n.transform})&&s.push(r.id)}return s},[e]),ln)}const KT=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return a.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},GT=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return a.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},xb={[pd.Arrow]:KT,[pd.ArrowClosed]:GT};function XT(e){const t=en();return N.useMemo(()=>{var r,i;return Object.prototype.hasOwnProperty.call(xb,e)?xb[e]:((i=(r=t.getState()).onError)==null||i.call(r,"009",Fr.error009(e)),null)},[e])}const QT=({id:e,type:t,color:n,width:s=12.5,height:r=12.5,markerUnits:i="strokeWidth",strokeWidth:l,orient:u="auto-start-reverse"})=>{const d=XT(t);return d?a.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:u,refX:"0",refY:"0",children:a.jsx(d,{color:n,strokeWidth:l})}):null},bb=({defaultColor:e,rfId:t})=>{const n=Ct(i=>i.edges),s=Ct(i=>i.defaultEdgeOptions),r=N.useMemo(()=>J2(n,{id:t,defaultColor:e,defaultMarkerStart:s==null?void 0:s.markerStart,defaultMarkerEnd:s==null?void 0:s.markerEnd}),[n,s,t,e]);return r.length?a.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:a.jsx("defs",{children:r.map(i=>a.jsx(QT,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};bb.displayName="MarkerDefinitions";var ZT=N.memo(bb);function wb({x:e,y:t,label:n,labelStyle:s,labelShowBg:r=!0,labelBgStyle:i,labelBgPadding:l=[2,4],labelBgBorderRadius:u=2,children:d,className:f,...p}){const[m,h]=N.useState({x:1,y:0,width:0,height:0}),_=$t(["react-flow__edge-textwrapper",f]),x=N.useRef(null);return N.useEffect(()=>{if(x.current){const y=x.current.getBBox();h({x:y.x,y:y.y,width:y.width,height:y.height})}},[n]),n?a.jsxs("g",{transform:`translate(${e-m.width/2} ${t-m.height/2})`,className:_,visibility:m.width?"visible":"hidden",...p,children:[r&&a.jsx("rect",{width:m.width+2*l[0],x:-l[0],y:-l[1],height:m.height+2*l[1],className:"react-flow__edge-textbg",style:i,rx:u,ry:u}),a.jsx("text",{className:"react-flow__edge-text",y:m.height/2,dy:"0.3em",ref:x,style:s,children:n}),d]}):null}wb.displayName="EdgeText";const JT=N.memo(wb);function Md({path:e,labelX:t,labelY:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,interactionWidth:f=20,...p}){return a.jsxs(a.Fragment,{children:[a.jsx("path",{...p,d:e,fill:"none",className:$t(["react-flow__edge-path",p.className])}),f?a.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}):null,s&&wr(t)&&wr(n)?a.jsx(JT,{x:t,y:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d}):null]})}function Nb({pos:e,x1:t,y1:n,x2:s,y2:r}){return e===Xe.Left||e===Xe.Right?[.5*(t+s),n]:[t,.5*(n+r)]}function jb({sourceX:e,sourceY:t,sourcePosition:n=Xe.Bottom,targetX:s,targetY:r,targetPosition:i=Xe.Top}){const[l,u]=Nb({pos:n,x1:e,y1:t,x2:s,y2:r}),[d,f]=Nb({pos:i,x1:s,y1:r,x2:e,y2:t}),[p,m,h,_]=g0({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:l,sourceControlY:u,targetControlX:d,targetControlY:f});return[`M${e},${t} C${l},${u} ${d},${f} ${s},${r}`,p,m,h,_]}function Cb(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:l,targetPosition:u,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:_,style:x,markerEnd:y,markerStart:v,interactionWidth:w})=>{const[k,j,b]=jb({sourceX:n,sourceY:s,sourcePosition:l,targetX:r,targetY:i,targetPosition:u}),S=e.isInternal?void 0:t;return a.jsx(Md,{id:S,path:k,labelX:j,labelY:b,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:_,style:x,markerEnd:y,markerStart:v,interactionWidth:w})})}const eP=Cb({isInternal:!1}),Sb=Cb({isInternal:!0});eP.displayName="SimpleBezierEdge",Sb.displayName="SimpleBezierEdgeInternal";function Eb(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,style:h,sourcePosition:_=Xe.Bottom,targetPosition:x=Xe.Top,markerEnd:y,markerStart:v,pathOptions:w,interactionWidth:k})=>{const[j,b,S]=Vh({sourceX:n,sourceY:s,sourcePosition:_,targetX:r,targetY:i,targetPosition:x,borderRadius:w==null?void 0:w.borderRadius,offset:w==null?void 0:w.offset,stepPosition:w==null?void 0:w.stepPosition}),E=e.isInternal?void 0:t;return a.jsx(Md,{id:E,path:j,labelX:b,labelY:S,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,style:h,markerEnd:y,markerStart:v,interactionWidth:k})})}const kb=Eb({isInternal:!1}),Mb=Eb({isInternal:!0});kb.displayName="SmoothStepEdge",Mb.displayName="SmoothStepEdgeInternal";function Ab(e){return N.memo(({id:t,...n})=>{var r;const s=e.isInternal?void 0:t;return a.jsx(kb,{...n,id:s,pathOptions:N.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(r=n.pathOptions)==null?void 0:r.offset])})})}const tP=Ab({isInternal:!1}),Ob=Ab({isInternal:!0});tP.displayName="StepEdge",Ob.displayName="StepEdgeInternal";function $b(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,style:h,markerEnd:_,markerStart:x,interactionWidth:y})=>{const[v,w,k]=x0({sourceX:n,sourceY:s,targetX:r,targetY:i}),j=e.isInternal?void 0:t;return a.jsx(Md,{id:j,path:v,labelX:w,labelY:k,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,style:h,markerEnd:_,markerStart:x,interactionWidth:y})})}const nP=$b({isInternal:!1}),Tb=$b({isInternal:!0});nP.displayName="StraightEdge",Tb.displayName="StraightEdgeInternal";function Pb(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:l=Xe.Bottom,targetPosition:u=Xe.Top,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:_,style:x,markerEnd:y,markerStart:v,pathOptions:w,interactionWidth:k})=>{const[j,b,S]=y0({sourceX:n,sourceY:s,sourcePosition:l,targetX:r,targetY:i,targetPosition:u,curvature:w==null?void 0:w.curvature}),E=e.isInternal?void 0:t;return a.jsx(Md,{id:E,path:j,labelX:b,labelY:S,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:_,style:x,markerEnd:y,markerStart:v,interactionWidth:k})})}const sP=Pb({isInternal:!1}),Lb=Pb({isInternal:!0});sP.displayName="BezierEdge",Lb.displayName="BezierEdgeInternal";const zb={default:Lb,straight:Tb,step:Ob,smoothstep:Mb,simplebezier:Sb},Rb={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},rP=(e,t,n)=>n===Xe.Left?e-t:n===Xe.Right?e+t:e,aP=(e,t,n)=>n===Xe.Top?e-t:n===Xe.Bottom?e+t:e,Db="react-flow__edgeupdater";function Ib({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:r,onMouseEnter:i,onMouseOut:l,type:u}){return a.jsx("circle",{onMouseDown:r,onMouseEnter:i,onMouseOut:l,className:$t([Db,`${Db}-${u}`]),cx:rP(t,s,e),cy:aP(n,s,e),r:s,stroke:"transparent",fill:"transparent"})}function oP({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:s,sourceY:r,targetX:i,targetY:l,sourcePosition:u,targetPosition:d,onReconnect:f,onReconnectStart:p,onReconnectEnd:m,setReconnecting:h,setUpdateHover:_}){const x=en(),y=(b,S)=>{if(b.button!==0)return;const{autoPanOnConnect:E,domNode:M,isValidConnection:O,connectionMode:$,connectionRadius:P,lib:A,onConnectStart:R,onConnectEnd:F,cancelConnection:z,nodeLookup:I,rfId:U,panBy:q,updateConnection:H}=x.getState(),W=S.type==="target",B=(te,G)=>{h(!1),m==null||m(te,n,S.type,G)},D=te=>f==null?void 0:f(n,te),V=(te,G)=>{h(!0),p==null||p(b,n,S.type),R==null||R(te,G)};Jh.onPointerDown(b.nativeEvent,{autoPanOnConnect:E,connectionMode:$,connectionRadius:P,domNode:M,handleId:S.id,nodeId:S.nodeId,nodeLookup:I,isTarget:W,edgeUpdaterType:S.type,lib:A,flowId:U,cancelConnection:z,panBy:q,isValidConnection:O,onConnect:D,onConnectStart:V,onConnectEnd:F,onReconnectEnd:B,updateConnection:H,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,dragThreshold:x.getState().connectionDragThreshold,handleDomNode:b.currentTarget})},v=b=>y(b,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),w=b=>y(b,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),k=()=>_(!0),j=()=>_(!1);return a.jsxs(a.Fragment,{children:[(e===!0||e==="source")&&a.jsx(Ib,{position:u,centerX:s,centerY:r,radius:t,onMouseDown:v,onMouseEnter:k,onMouseOut:j,type:"source"}),(e===!0||e==="target")&&a.jsx(Ib,{position:d,centerX:i,centerY:l,radius:t,onMouseDown:w,onMouseEnter:k,onMouseOut:j,type:"target"})]})}function iP({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:s,onClick:r,onDoubleClick:i,onContextMenu:l,onMouseEnter:u,onMouseMove:d,onMouseLeave:f,reconnectRadius:p,onReconnect:m,onReconnectStart:h,onReconnectEnd:_,rfId:x,edgeTypes:y,noPanClassName:v,onError:w,disableKeyboardA11y:k}){let j=Ct(_e=>_e.edgeLookup.get(e));const b=Ct(_e=>_e.defaultEdgeOptions);j=b?{...b,...j}:j;let S=j.type||"default",E=(y==null?void 0:y[S])||zb[S];E===void 0&&(w==null||w("011",Fr.error011(S)),S="default",E=(y==null?void 0:y.default)||zb.default);const M=!!(j.focusable||t&&typeof j.focusable>"u"),O=typeof m<"u"&&(j.reconnectable||n&&typeof j.reconnectable>"u"),$=!!(j.selectable||s&&typeof j.selectable>"u"),P=N.useRef(null),[A,R]=N.useState(!1),[F,z]=N.useState(!1),I=en(),{zIndex:U,sourceX:q,sourceY:H,targetX:W,targetY:B,sourcePosition:D,targetPosition:V}=Ct(N.useCallback(_e=>{const ge=_e.nodeLookup.get(j.source),be=_e.nodeLookup.get(j.target);if(!ge||!be)return{zIndex:j.zIndex,...Rb};const ze=Z2({id:e,sourceNode:ge,targetNode:be,sourceHandle:j.sourceHandle||null,targetHandle:j.targetHandle||null,connectionMode:_e.connectionMode,onError:w});return{zIndex:q2({selected:j.selected,zIndex:j.zIndex,sourceNode:ge,targetNode:be,elevateOnSelect:_e.elevateEdgesOnSelect}),...ze||Rb}},[j.source,j.target,j.sourceHandle,j.targetHandle,j.selected,j.zIndex]),ln),te=N.useMemo(()=>j.markerStart?`url('#${Wh(j.markerStart,x)}')`:void 0,[j.markerStart,x]),G=N.useMemo(()=>j.markerEnd?`url('#${Wh(j.markerEnd,x)}')`:void 0,[j.markerEnd,x]);if(j.hidden||q===null||H===null||W===null||B===null)return null;const K=_e=>{var Ee;const{addSelectedEdges:ge,unselectNodesAndEdges:be,multiSelectionActive:ze}=I.getState();$&&(I.setState({nodesSelectionActive:!1}),j.selected&&ze?(be({nodes:[],edges:[j]}),(Ee=P.current)==null||Ee.blur()):ge([e])),r&&r(_e,j)},X=i?_e=>{i(_e,{...j})}:void 0,Q=l?_e=>{l(_e,{...j})}:void 0,J=u?_e=>{u(_e,{...j})}:void 0,Z=d?_e=>{d(_e,{...j})}:void 0,ee=f?_e=>{f(_e,{...j})}:void 0,de=_e=>{var ge;if(!k&&Qx.includes(_e.key)&&$){const{unselectNodesAndEdges:be,addSelectedEdges:ze}=I.getState();_e.key==="Escape"?((ge=P.current)==null||ge.blur(),be({edges:[j]})):ze([e])}};return a.jsx("svg",{style:{zIndex:U},children:a.jsxs("g",{className:$t(["react-flow__edge",`react-flow__edge-${S}`,j.className,v,{selected:j.selected,animated:j.animated,inactive:!$&&!r,updating:A,selectable:$}]),onClick:K,onDoubleClick:X,onContextMenu:Q,onMouseEnter:J,onMouseMove:Z,onMouseLeave:ee,onKeyDown:M?de:void 0,tabIndex:M?0:void 0,role:j.ariaRole??(M?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":j.ariaLabel===null?void 0:j.ariaLabel||`Edge from ${j.source} to ${j.target}`,"aria-describedby":M?`${Q0}-${x}`:void 0,ref:P,...j.domAttributes,children:[!F&&a.jsx(E,{id:e,source:j.source,target:j.target,type:j.type,selected:j.selected,animated:j.animated,selectable:$,deletable:j.deletable??!0,label:j.label,labelStyle:j.labelStyle,labelShowBg:j.labelShowBg,labelBgStyle:j.labelBgStyle,labelBgPadding:j.labelBgPadding,labelBgBorderRadius:j.labelBgBorderRadius,sourceX:q,sourceY:H,targetX:W,targetY:B,sourcePosition:D,targetPosition:V,data:j.data,style:j.style,sourceHandleId:j.sourceHandle,targetHandleId:j.targetHandle,markerStart:te,markerEnd:G,pathOptions:"pathOptions"in j?j.pathOptions:void 0,interactionWidth:j.interactionWidth}),O&&a.jsx(oP,{edge:j,isReconnectable:O,reconnectRadius:p,onReconnect:m,onReconnectStart:h,onReconnectEnd:_,sourceX:q,sourceY:H,targetX:W,targetY:B,sourcePosition:D,targetPosition:V,setUpdateHover:R,setReconnecting:z})]})})}var lP=N.memo(iP);const cP=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function Fb({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:s,noPanClassName:r,onReconnect:i,onEdgeContextMenu:l,onEdgeMouseEnter:u,onEdgeMouseMove:d,onEdgeMouseLeave:f,onEdgeClick:p,reconnectRadius:m,onEdgeDoubleClick:h,onReconnectStart:_,onReconnectEnd:x,disableKeyboardA11y:y}){const{edgesFocusable:v,edgesReconnectable:w,elementsSelectable:k,onError:j}=Ct(cP,ln),b=YT(t);return a.jsxs("div",{className:"react-flow__edges",children:[a.jsx(ZT,{defaultColor:e,rfId:n}),b.map(S=>a.jsx(lP,{id:S,edgesFocusable:v,edgesReconnectable:w,elementsSelectable:k,noPanClassName:r,onReconnect:i,onContextMenu:l,onMouseEnter:u,onMouseMove:d,onMouseLeave:f,onClick:p,reconnectRadius:m,onDoubleClick:h,onReconnectStart:_,onReconnectEnd:x,rfId:n,onError:j,edgeTypes:s,disableKeyboardA11y:y},S))]})}Fb.displayName="EdgeRenderer";const uP=N.memo(Fb),dP=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function mP({children:e}){const t=Ct(dP);return a.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function fP(e){const t=ap(),n=N.useRef(!1);N.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const hP=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function pP(e){const t=Ct(hP),n=en();return N.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function gP(e){return e.connection.inProgress?{...e.connection,to:gc(e.connection.to,e.transform)}:{...e.connection}}function _P(e){return gP}function yP(e){const t=_P();return Ct(t,ln)}const vP=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function xP({containerStyle:e,style:t,type:n,component:s}){const{nodesConnectable:r,width:i,height:l,isValid:u,inProgress:d}=Ct(vP,ln);return!(i&&r&&d)?null:a.jsx("svg",{style:e,width:i,height:l,className:"react-flow__connectionline react-flow__container",children:a.jsx("g",{className:$t(["react-flow__connection",t0(u)]),children:a.jsx(Bb,{style:t,type:n,CustomComponent:s,isValid:u})})})}const Bb=({style:e,type:t=Ra.Bezier,CustomComponent:n,isValid:s})=>{const{inProgress:r,from:i,fromNode:l,fromHandle:u,fromPosition:d,to:f,toNode:p,toHandle:m,toPosition:h,pointer:_}=yP();if(!r)return;if(n)return a.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:l,fromHandle:u,fromX:i.x,fromY:i.y,toX:f.x,toY:f.y,fromPosition:d,toPosition:h,connectionStatus:t0(s),toNode:p,toHandle:m,pointer:_});let x="";const y={sourceX:i.x,sourceY:i.y,sourcePosition:d,targetX:f.x,targetY:f.y,targetPosition:h};switch(t){case Ra.Bezier:[x]=y0(y);break;case Ra.SimpleBezier:[x]=jb(y);break;case Ra.Step:[x]=Vh({...y,borderRadius:0});break;case Ra.SmoothStep:[x]=Vh(y);break;default:[x]=x0(y)}return a.jsx("path",{d:x,fill:"none",className:"react-flow__connection-path",style:e})};Bb.displayName="ConnectionLine";const bP={};function Ub(e=bP){N.useRef(e),en(),N.useEffect(()=>{},[e])}function wP(){en(),N.useRef(!1),N.useEffect(()=>{},[])}function Hb({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:s,onEdgeClick:r,onNodeDoubleClick:i,onEdgeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:f,onNodeContextMenu:p,onSelectionContextMenu:m,onSelectionStart:h,onSelectionEnd:_,connectionLineType:x,connectionLineStyle:y,connectionLineComponent:v,connectionLineContainerStyle:w,selectionKeyCode:k,selectionOnDrag:j,selectionMode:b,multiSelectionKeyCode:S,panActivationKeyCode:E,zoomActivationKeyCode:M,deleteKeyCode:O,onlyRenderVisibleElements:$,elementsSelectable:P,defaultViewport:A,translateExtent:R,minZoom:F,maxZoom:z,preventScrolling:I,defaultMarkerColor:U,zoomOnScroll:q,zoomOnPinch:H,panOnScroll:W,panOnScrollSpeed:B,panOnScrollMode:D,zoomOnDoubleClick:V,panOnDrag:te,onPaneClick:G,onPaneMouseEnter:K,onPaneMouseMove:X,onPaneMouseLeave:Q,onPaneScroll:J,onPaneContextMenu:Z,paneClickDistance:ee,nodeClickDistance:de,onEdgeContextMenu:_e,onEdgeMouseEnter:ge,onEdgeMouseMove:be,onEdgeMouseLeave:ze,reconnectRadius:Ee,onReconnect:ie,onReconnectStart:pe,onReconnectEnd:Ce,noDragClassName:Te,noWheelClassName:De,noPanClassName:ce,disableKeyboardA11y:Oe,nodeExtent:qe,rfId:Qe,viewport:Ye,onViewportChange:at}){return Ub(e),Ub(t),wP(),fP(n),pP(Ye),a.jsx(RT,{onPaneClick:G,onPaneMouseEnter:K,onPaneMouseMove:X,onPaneMouseLeave:Q,onPaneContextMenu:Z,onPaneScroll:J,paneClickDistance:ee,deleteKeyCode:O,selectionKeyCode:k,selectionOnDrag:j,selectionMode:b,onSelectionStart:h,onSelectionEnd:_,multiSelectionKeyCode:S,panActivationKeyCode:E,zoomActivationKeyCode:M,elementsSelectable:P,zoomOnScroll:q,zoomOnPinch:H,zoomOnDoubleClick:V,panOnScroll:W,panOnScrollSpeed:B,panOnScrollMode:D,panOnDrag:te,defaultViewport:A,translateExtent:R,minZoom:F,maxZoom:z,onSelectionContextMenu:m,preventScrolling:I,noDragClassName:Te,noWheelClassName:De,noPanClassName:ce,disableKeyboardA11y:Oe,onViewportChange:at,isControlledViewport:!!Ye,children:a.jsxs(mP,{children:[a.jsx(uP,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:l,onReconnect:ie,onReconnectStart:pe,onReconnectEnd:Ce,onlyRenderVisibleElements:$,onEdgeContextMenu:_e,onEdgeMouseEnter:ge,onEdgeMouseMove:be,onEdgeMouseLeave:ze,reconnectRadius:Ee,defaultMarkerColor:U,noPanClassName:ce,disableKeyboardA11y:Oe,rfId:Qe}),a.jsx(xP,{style:y,type:x,component:v,containerStyle:w}),a.jsx("div",{className:"react-flow__edgelabel-renderer"}),a.jsx(WT,{nodeTypes:e,onNodeClick:s,onNodeDoubleClick:i,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:f,onNodeContextMenu:p,nodeClickDistance:de,onlyRenderVisibleElements:$,noPanClassName:ce,noDragClassName:Te,disableKeyboardA11y:Oe,nodeExtent:qe,rfId:Qe}),a.jsx("div",{className:"react-flow__viewport-portal"})]})})}Hb.displayName="GraphView";const NP=N.memo(Hb),qb=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:l,fitViewOptions:u,minZoom:d=.5,maxZoom:f=2,nodeOrigin:p,nodeExtent:m}={})=>{const h=new Map,_=new Map,x=new Map,y=new Map,v=s??t??[],w=n??e??[],k=p??[0,0],j=m??uc;M0(x,y,v);const b=Gh(w,h,_,{nodeOrigin:k,nodeExtent:j,elevateNodesOnSelect:!1});let S=[0,0,1];if(l&&r&&i){const E=fc(h,{filter:P=>!!((P.width||P.initialWidth)&&(P.height||P.initialHeight))}),{x:M,y:O,zoom:$}=Hh(E,r,i,d,f,(u==null?void 0:u.padding)??.1);S=[M,O,$]}return{rfId:"1",width:r??0,height:i??0,transform:S,nodes:w,nodesInitialized:b,nodeLookup:h,parentLookup:_,edges:v,edgeLookup:y,connectionLookup:x,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:s!==void 0,panZoom:null,minZoom:d,maxZoom:f,translateExtent:uc,nodeExtent:j,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Vi.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:k,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:l??!1,fitViewOptions:u,fitViewResolver:null,connection:{...Jx},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:D2,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Zx}},jP=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:l,fitViewOptions:u,minZoom:d,maxZoom:f,nodeOrigin:p,nodeExtent:m})=>B$((h,_)=>{async function x(){const{nodeLookup:y,panZoom:v,fitViewOptions:w,fitViewResolver:k,width:j,height:b,minZoom:S,maxZoom:E}=_();v&&(await z2({nodes:y,width:j,height:b,panZoom:v,minZoom:S,maxZoom:E},w),k==null||k.resolve(!0),h({fitViewResolver:null}))}return{...qb({nodes:e,edges:t,width:r,height:i,fitView:l,fitViewOptions:u,minZoom:d,maxZoom:f,nodeOrigin:p,nodeExtent:m,defaultNodes:n,defaultEdges:s}),setNodes:y=>{const{nodeLookup:v,parentLookup:w,nodeOrigin:k,elevateNodesOnSelect:j,fitViewQueued:b}=_(),S=Gh(y,v,w,{nodeOrigin:k,nodeExtent:m,elevateNodesOnSelect:j,checkEquality:!0});b&&S?(x(),h({nodes:y,nodesInitialized:S,fitViewQueued:!1,fitViewOptions:void 0})):h({nodes:y,nodesInitialized:S})},setEdges:y=>{const{connectionLookup:v,edgeLookup:w}=_();M0(v,w,y),h({edges:y})},setDefaultNodesAndEdges:(y,v)=>{if(y){const{setNodes:w}=_();w(y),h({hasDefaultNodes:!0})}if(v){const{setEdges:w}=_();w(v),h({hasDefaultEdges:!0})}},updateNodeInternals:y=>{const{triggerNodeChanges:v,nodeLookup:w,parentLookup:k,domNode:j,nodeOrigin:b,nodeExtent:S,debug:E,fitViewQueued:M}=_(),{changes:O,updatedInternals:$}=o$(y,w,k,j,b,S);$&&(n$(w,k,{nodeOrigin:b,nodeExtent:S}),M?(x(),h({fitViewQueued:!1,fitViewOptions:void 0})):h({}),(O==null?void 0:O.length)>0&&(E&&console.log("React Flow: trigger node changes",O),v==null||v(O)))},updateNodePositions:(y,v=!1)=>{const w=[],k=[],{nodeLookup:j,triggerNodeChanges:b}=_();for(const[S,E]of y){const M=j.get(S),O=!!(M!=null&&M.expandParent&&(M!=null&&M.parentId)&&(E!=null&&E.position)),$={id:S,type:"position",position:O?{x:Math.max(0,E.position.x),y:Math.max(0,E.position.y)}:E.position,dragging:v};O&&M.parentId&&w.push({id:S,parentId:M.parentId,rect:{...E.internals.positionAbsolute,width:E.measured.width??0,height:E.measured.height??0}}),k.push($)}if(w.length>0){const{parentLookup:S,nodeOrigin:E}=_(),M=Qh(w,j,S,E);k.push(...M)}b(k)},triggerNodeChanges:y=>{const{onNodesChange:v,setNodes:w,nodes:k,hasDefaultNodes:j,debug:b}=_();if(y!=null&&y.length){if(j){const S=iT(y,k);w(S)}b&&console.log("React Flow: trigger node changes",y),v==null||v(y)}},triggerEdgeChanges:y=>{const{onEdgesChange:v,setEdges:w,edges:k,hasDefaultEdges:j,debug:b}=_();if(y!=null&&y.length){if(j){const S=lT(y,k);w(S)}b&&console.log("React Flow: trigger edge changes",y),v==null||v(y)}},addSelectedNodes:y=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:k,triggerNodeChanges:j,triggerEdgeChanges:b}=_();if(v){const S=y.map(E=>Po(E,!0));j(S);return}j(Zi(k,new Set([...y]),!0)),b(Zi(w))},addSelectedEdges:y=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:k,triggerNodeChanges:j,triggerEdgeChanges:b}=_();if(v){const S=y.map(E=>Po(E,!0));b(S);return}b(Zi(w,new Set([...y]))),j(Zi(k,new Set,!0))},unselectNodesAndEdges:({nodes:y,edges:v}={})=>{const{edges:w,nodes:k,nodeLookup:j,triggerNodeChanges:b,triggerEdgeChanges:S}=_(),E=y||k,M=v||w,O=E.map(P=>{const A=j.get(P.id);return A&&(A.selected=!1),Po(P.id,!1)}),$=M.map(P=>Po(P.id,!1));b(O),S($)},setMinZoom:y=>{const{panZoom:v,maxZoom:w}=_();v==null||v.setScaleExtent([y,w]),h({minZoom:y})},setMaxZoom:y=>{const{panZoom:v,minZoom:w}=_();v==null||v.setScaleExtent([w,y]),h({maxZoom:y})},setTranslateExtent:y=>{var v;(v=_().panZoom)==null||v.setTranslateExtent(y),h({translateExtent:y})},resetSelectedElements:()=>{const{edges:y,nodes:v,triggerNodeChanges:w,triggerEdgeChanges:k,elementsSelectable:j}=_();if(!j)return;const b=v.reduce((E,M)=>M.selected?[...E,Po(M.id,!1)]:E,[]),S=y.reduce((E,M)=>M.selected?[...E,Po(M.id,!1)]:E,[]);w(b),k(S)},setNodeExtent:y=>{const{nodes:v,nodeLookup:w,parentLookup:k,nodeOrigin:j,elevateNodesOnSelect:b,nodeExtent:S}=_();y[0][0]===S[0][0]&&y[0][1]===S[0][1]&&y[1][0]===S[1][0]&&y[1][1]===S[1][1]||(Gh(v,w,k,{nodeOrigin:j,nodeExtent:y,elevateNodesOnSelect:b,checkEquality:!1}),h({nodeExtent:y}))},panBy:y=>{const{transform:v,width:w,height:k,panZoom:j,translateExtent:b}=_();return i$({delta:y,panZoom:j,transform:v,translateExtent:b,width:w,height:k})},setCenter:async(y,v,w)=>{const{width:k,height:j,maxZoom:b,panZoom:S}=_();if(!S)return Promise.resolve(!1);const E=typeof(w==null?void 0:w.zoom)<"u"?w.zoom:b;return await S.setViewport({x:k/2-y*E,y:j/2-v*E,zoom:E},{duration:w==null?void 0:w.duration,ease:w==null?void 0:w.ease,interpolate:w==null?void 0:w.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{h({connection:{...Jx}})},updateConnection:y=>{h({connection:y})},reset:()=>h({...qb()})}},Object.is);function CP({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:s,initialWidth:r,initialHeight:i,initialMinZoom:l,initialMaxZoom:u,initialFitViewOptions:d,fitView:f,nodeOrigin:p,nodeExtent:m,children:h}){const[_]=N.useState(()=>jP({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:f,minZoom:l,maxZoom:u,fitViewOptions:d,nodeOrigin:p,nodeExtent:m}));return a.jsx(U$,{value:_,children:a.jsx(mT,{children:h})})}function SP({children:e,nodes:t,edges:n,defaultNodes:s,defaultEdges:r,width:i,height:l,fitView:u,fitViewOptions:d,minZoom:f,maxZoom:p,nodeOrigin:m,nodeExtent:h}){return N.useContext(Nd)?a.jsx(a.Fragment,{children:e}):a.jsx(CP,{initialNodes:t,initialEdges:n,defaultNodes:s,defaultEdges:r,initialWidth:i,initialHeight:l,fitView:u,initialFitViewOptions:d,initialMinZoom:f,initialMaxZoom:p,nodeOrigin:m,nodeExtent:h,children:e})}const EP={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function kP({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:r,nodeTypes:i,edgeTypes:l,onNodeClick:u,onEdgeClick:d,onInit:f,onMove:p,onMoveStart:m,onMoveEnd:h,onConnect:_,onConnectStart:x,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:w,onNodeMouseEnter:k,onNodeMouseMove:j,onNodeMouseLeave:b,onNodeContextMenu:S,onNodeDoubleClick:E,onNodeDragStart:M,onNodeDrag:O,onNodeDragStop:$,onNodesDelete:P,onEdgesDelete:A,onDelete:R,onSelectionChange:F,onSelectionDragStart:z,onSelectionDrag:I,onSelectionDragStop:U,onSelectionContextMenu:q,onSelectionStart:H,onSelectionEnd:W,onBeforeDelete:B,connectionMode:D,connectionLineType:V=Ra.Bezier,connectionLineStyle:te,connectionLineComponent:G,connectionLineContainerStyle:K,deleteKeyCode:X="Backspace",selectionKeyCode:Q="Shift",selectionOnDrag:J=!1,selectionMode:Z=dc.Full,panActivationKeyCode:ee="Space",multiSelectionKeyCode:de=_c()?"Meta":"Control",zoomActivationKeyCode:_e=_c()?"Meta":"Control",snapToGrid:ge,snapGrid:be,onlyRenderVisibleElements:ze=!1,selectNodesOnDrag:Ee,nodesDraggable:ie,autoPanOnNodeFocus:pe,nodesConnectable:Ce,nodesFocusable:Te,nodeOrigin:De=Z0,edgesFocusable:ce,edgesReconnectable:Oe,elementsSelectable:qe=!0,defaultViewport:Qe=tT,minZoom:Ye=.5,maxZoom:at=2,translateExtent:et=uc,preventScrolling:ot=!0,nodeExtent:Nt,defaultMarkerColor:Tt="#b1b1b7",zoomOnScroll:tt=!0,zoomOnPinch:Ft=!0,panOnScroll:Wt=!1,panOnScrollSpeed:Pt=.5,panOnScrollMode:bn=$o.Free,zoomOnDoubleClick:gn=!0,panOnDrag:jt=!0,onPaneClick:cn,onPaneMouseEnter:un,onPaneMouseMove:Lt,onPaneMouseLeave:ut,onPaneScroll:wn,onPaneContextMenu:ht,paneClickDistance:Bt=1,nodeClickDistance:mt=0,children:Vn,onReconnect:_n,onReconnectStart:ls,onReconnectEnd:xt,onEdgeContextMenu:pt,onEdgeDoubleClick:yn,onEdgeMouseEnter:ys,onEdgeMouseMove:dn,onEdgeMouseLeave:Xt,reconnectRadius:tn=10,onNodesChange:Nn,onEdgesChange:Wn,noDragClassName:Yn="nodrag",noWheelClassName:vt="nowheel",noPanClassName:Yt="nopan",fitView:Jn,fitViewOptions:$n,connectOnClick:Xs,attributionPosition:vs,proOptions:cs,defaultEdgeOptions:$s,elevateNodesOnSelect:Kt,elevateEdgesOnSelect:Ts,disableKeyboardA11y:Ut=!1,autoPanOnConnect:$e,autoPanOnNodeDrag:Dt,autoPanSpeed:Ps,connectionRadius:es,isValidConnection:ue,onError:we,style:Fe,id:gt,nodeDragThreshold:ke,connectionDragThreshold:kt,viewport:nt,onViewportChange:nn,width:vn,height:Mt,colorMode:Zt="light",debug:ts,onScroll:Tn,ariaLabelConfig:Pn,...xs},jn){const Ln=gt||"1",bs=rT(Zt),ws=N.useCallback(Ls=>{Ls.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Tn==null||Tn(Ls)},[Tn]);return a.jsx("div",{"data-testid":"rf__wrapper",...xs,onScroll:ws,style:{...Fe,...EP},ref:jn,className:$t(["react-flow",r,bs]),id:gt,role:"application",children:a.jsxs(SP,{nodes:e,edges:t,width:vn,height:Mt,fitView:Jn,fitViewOptions:$n,minZoom:Ye,maxZoom:at,nodeOrigin:De,nodeExtent:Nt,children:[a.jsx(NP,{onInit:f,onNodeClick:u,onEdgeClick:d,onNodeMouseEnter:k,onNodeMouseMove:j,onNodeMouseLeave:b,onNodeContextMenu:S,onNodeDoubleClick:E,nodeTypes:i,edgeTypes:l,connectionLineType:V,connectionLineStyle:te,connectionLineComponent:G,connectionLineContainerStyle:K,selectionKeyCode:Q,selectionOnDrag:J,selectionMode:Z,deleteKeyCode:X,multiSelectionKeyCode:de,panActivationKeyCode:ee,zoomActivationKeyCode:_e,onlyRenderVisibleElements:ze,defaultViewport:Qe,translateExtent:et,minZoom:Ye,maxZoom:at,preventScrolling:ot,zoomOnScroll:tt,zoomOnPinch:Ft,zoomOnDoubleClick:gn,panOnScroll:Wt,panOnScrollSpeed:Pt,panOnScrollMode:bn,panOnDrag:jt,onPaneClick:cn,onPaneMouseEnter:un,onPaneMouseMove:Lt,onPaneMouseLeave:ut,onPaneScroll:wn,onPaneContextMenu:ht,paneClickDistance:Bt,nodeClickDistance:mt,onSelectionContextMenu:q,onSelectionStart:H,onSelectionEnd:W,onReconnect:_n,onReconnectStart:ls,onReconnectEnd:xt,onEdgeContextMenu:pt,onEdgeDoubleClick:yn,onEdgeMouseEnter:ys,onEdgeMouseMove:dn,onEdgeMouseLeave:Xt,reconnectRadius:tn,defaultMarkerColor:Tt,noDragClassName:Yn,noWheelClassName:vt,noPanClassName:Yt,rfId:Ln,disableKeyboardA11y:Ut,nodeExtent:Nt,viewport:nt,onViewportChange:nn}),a.jsx(sT,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:_,onConnectStart:x,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:w,nodesDraggable:ie,autoPanOnNodeFocus:pe,nodesConnectable:Ce,nodesFocusable:Te,edgesFocusable:ce,edgesReconnectable:Oe,elementsSelectable:qe,elevateNodesOnSelect:Kt,elevateEdgesOnSelect:Ts,minZoom:Ye,maxZoom:at,nodeExtent:Nt,onNodesChange:Nn,onEdgesChange:Wn,snapToGrid:ge,snapGrid:be,connectionMode:D,translateExtent:et,connectOnClick:Xs,defaultEdgeOptions:$s,fitView:Jn,fitViewOptions:$n,onNodesDelete:P,onEdgesDelete:A,onDelete:R,onNodeDragStart:M,onNodeDrag:O,onNodeDragStop:$,onSelectionDrag:I,onSelectionDragStart:z,onSelectionDragStop:U,onMove:p,onMoveStart:m,onMoveEnd:h,noPanClassName:Yt,nodeOrigin:De,rfId:Ln,autoPanOnConnect:$e,autoPanOnNodeDrag:Dt,autoPanSpeed:Ps,onError:we,connectionRadius:es,isValidConnection:ue,selectNodesOnDrag:Ee,nodeDragThreshold:ke,connectionDragThreshold:kt,onBeforeDelete:B,debug:ts,ariaLabelConfig:Pn}),a.jsx(eT,{onSelectionChange:F}),Vn,a.jsx(G$,{proOptions:cs,position:vs}),a.jsx(K$,{rfId:Ln,disableKeyboardA11y:Ut})]})})}cb(kP);function MP({dimensions:e,lineWidth:t,variant:n,className:s}){return a.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:$t(["react-flow__background-pattern",n,s])})}function AP({radius:e,className:t}){return a.jsx("circle",{cx:e,cy:e,r:e,className:$t(["react-flow__background-pattern","dots",t])})}var Fa;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Fa||(Fa={}));const OP={[Fa.Dots]:1,[Fa.Lines]:1,[Fa.Cross]:6},$P=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Vb({id:e,variant:t=Fa.Dots,gap:n=20,size:s,lineWidth:r=1,offset:i=0,color:l,bgColor:u,style:d,className:f,patternClassName:p}){const m=N.useRef(null),{transform:h,patternId:_}=Ct($P,ln),x=s||OP[t],y=t===Fa.Dots,v=t===Fa.Cross,w=Array.isArray(n)?n:[n,n],k=[w[0]*h[2]||1,w[1]*h[2]||1],j=x*h[2],b=Array.isArray(i)?i:[i,i],S=v?[j,j]:k,E=[b[0]*h[2]||1+S[0]/2,b[1]*h[2]||1+S[1]/2],M=`${_}${e||""}`;return a.jsxs("svg",{className:$t(["react-flow__background",f]),style:{...d,...Sd,"--xy-background-color-props":u,"--xy-background-pattern-color-props":l},ref:m,"data-testid":"rf__background",children:[a.jsx("pattern",{id:M,x:h[0]%k[0],y:h[1]%k[1],width:k[0],height:k[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:y?a.jsx(AP,{radius:j/2,className:p}):a.jsx(MP,{dimensions:S,lineWidth:r,variant:t,className:p})}),a.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${M})`})]})}Vb.displayName="Background",N.memo(Vb);function TP(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:a.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function PP(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:a.jsx("path",{d:"M0 0h32v4.2H0z"})})}function LP(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:a.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function zP(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:a.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function RP(){return a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:a.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Ad({children:e,className:t,...n}){return a.jsx("button",{type:"button",className:$t(["react-flow__controls-button",t]),...n,children:e})}const DP=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function Wb({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:r,onZoomIn:i,onZoomOut:l,onFitView:u,onInteractiveChange:d,className:f,children:p,position:m="bottom-left",orientation:h="vertical","aria-label":_}){const x=en(),{isInteractive:y,minZoomReached:v,maxZoomReached:w,ariaLabelConfig:k}=Ct(DP,ln),{zoomIn:j,zoomOut:b,fitView:S}=ap(),E=()=>{j(),i==null||i()},M=()=>{b(),l==null||l()},O=()=>{S(r),u==null||u()},$=()=>{x.setState({nodesDraggable:!y,nodesConnectable:!y,elementsSelectable:!y}),d==null||d(!y)},P=h==="horizontal"?"horizontal":"vertical";return a.jsxs(jd,{className:$t(["react-flow__controls",P,f]),position:m,style:e,"data-testid":"rf__controls","aria-label":_??k["controls.ariaLabel"],children:[t&&a.jsxs(a.Fragment,{children:[a.jsx(Ad,{onClick:E,className:"react-flow__controls-zoomin",title:k["controls.zoomIn.ariaLabel"],"aria-label":k["controls.zoomIn.ariaLabel"],disabled:w,children:a.jsx(TP,{})}),a.jsx(Ad,{onClick:M,className:"react-flow__controls-zoomout",title:k["controls.zoomOut.ariaLabel"],"aria-label":k["controls.zoomOut.ariaLabel"],disabled:v,children:a.jsx(PP,{})})]}),n&&a.jsx(Ad,{className:"react-flow__controls-fitview",onClick:O,title:k["controls.fitView.ariaLabel"],"aria-label":k["controls.fitView.ariaLabel"],children:a.jsx(LP,{})}),s&&a.jsx(Ad,{className:"react-flow__controls-interactive",onClick:$,title:k["controls.interactive.ariaLabel"],"aria-label":k["controls.interactive.ariaLabel"],children:y?a.jsx(RP,{}):a.jsx(zP,{})}),p]})}Wb.displayName="Controls",N.memo(Wb);function IP({id:e,x:t,y:n,width:s,height:r,style:i,color:l,strokeColor:u,strokeWidth:d,className:f,borderRadius:p,shapeRendering:m,selected:h,onClick:_}){const{background:x,backgroundColor:y}=i||{},v=l||x||y;return a.jsx("rect",{className:$t(["react-flow__minimap-node",{selected:h},f]),x:t,y:n,rx:p,ry:p,width:s,height:r,style:{fill:v,stroke:u,strokeWidth:d},shapeRendering:m,onClick:_?w=>_(w,e):void 0})}const FP=N.memo(IP),BP=e=>e.nodes.map(t=>t.id),cp=e=>e instanceof Function?e:()=>e;function UP({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:r,nodeComponent:i=FP,onClick:l}){const u=Ct(BP,ln),d=cp(t),f=cp(e),p=cp(n),m=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return a.jsx(a.Fragment,{children:u.map(h=>a.jsx(qP,{id:h,nodeColorFunc:d,nodeStrokeColorFunc:f,nodeClassNameFunc:p,nodeBorderRadius:s,nodeStrokeWidth:r,NodeComponent:i,onClick:l,shapeRendering:m},h))})}function HP({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:s,nodeBorderRadius:r,nodeStrokeWidth:i,shapeRendering:l,NodeComponent:u,onClick:d}){const{node:f,x:p,y:m,width:h,height:_}=Ct(x=>{const{internals:y}=x.nodeLookup.get(e),v=y.userNode,{x:w,y:k}=y.positionAbsolute,{width:j,height:b}=aa(v);return{node:v,x:w,y:k,width:j,height:b}},ln);return!f||f.hidden||!c0(f)?null:a.jsx(u,{x:p,y:m,width:h,height:_,style:f.style,selected:!!f.selected,className:s(f),color:t(f),borderRadius:r,strokeColor:n(f),strokeWidth:i,shapeRendering:l,onClick:d,id:f.id})}const qP=N.memo(HP);var VP=N.memo(UP);const WP=200,YP=150,KP=e=>!e.hidden,GP=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?i0(fc(e.nodeLookup,{filter:KP}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},XP="react-flow__minimap-desc";function Yb({style:e,className:t,nodeStrokeColor:n,nodeColor:s,nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:l,nodeComponent:u,bgColor:d,maskColor:f,maskStrokeColor:p,maskStrokeWidth:m,position:h="bottom-right",onClick:_,onNodeClick:x,pannable:y=!1,zoomable:v=!1,ariaLabel:w,inversePan:k,zoomStep:j=1,offsetScale:b=5}){const S=en(),E=N.useRef(null),{boundingRect:M,viewBB:O,rfId:$,panZoom:P,translateExtent:A,flowWidth:R,flowHeight:F,ariaLabelConfig:z}=Ct(GP,ln),I=(e==null?void 0:e.width)??WP,U=(e==null?void 0:e.height)??YP,q=M.width/I,H=M.height/U,W=Math.max(q,H),B=W*I,D=W*U,V=b*W,te=M.x-(B-M.width)/2-V,G=M.y-(D-M.height)/2-V,K=B+V*2,X=D+V*2,Q=`${XP}-${$}`,J=N.useRef(0),Z=N.useRef();J.current=W,N.useEffect(()=>{if(E.current&&P)return Z.current=g$({domNode:E.current,panZoom:P,getTransform:()=>S.getState().transform,getViewScale:()=>J.current}),()=>{var ge;(ge=Z.current)==null||ge.destroy()}},[P]),N.useEffect(()=>{var ge;(ge=Z.current)==null||ge.update({translateExtent:A,width:R,height:F,inversePan:k,pannable:y,zoomStep:j,zoomable:v})},[y,v,k,j,A,R,F]);const ee=_?ge=>{var Ee;const[be,ze]=((Ee=Z.current)==null?void 0:Ee.pointer(ge))||[0,0];_(ge,{x:be,y:ze})}:void 0,de=x?N.useCallback((ge,be)=>{const ze=S.getState().nodeLookup.get(be).internals.userNode;x(ge,ze)},[]):void 0,_e=w??z["minimap.ariaLabel"];return a.jsx(jd,{position:h,style:{...e,"--xy-minimap-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-background-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-stroke-color-props":typeof p=="string"?p:void 0,"--xy-minimap-mask-stroke-width-props":typeof m=="number"?m*W:void 0,"--xy-minimap-node-background-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof l=="number"?l:void 0},className:$t(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:a.jsxs("svg",{width:I,height:U,viewBox:`${te} ${G} ${K} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Q,ref:E,onClick:ee,children:[_e&&a.jsx("title",{id:Q,children:_e}),a.jsx(VP,{onClick:de,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:r,nodeStrokeWidth:l,nodeComponent:u}),a.jsx("path",{className:"react-flow__minimap-mask",d:`M${te-V},${G-V}h${K+V*2}v${X+V*2}h${-K-V*2}z
        M${O.x},${O.y}h${O.width}v${O.height}h${-O.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}Yb.displayName="MiniMap",N.memo(Yb);const QP=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,ZP={[Qi.Line]:"right",[Qi.Handle]:"bottom-right"};function JP({nodeId:e,position:t,variant:n=Qi.Handle,className:s,style:r=void 0,children:i,color:l,minWidth:u=10,minHeight:d=10,maxWidth:f=Number.MAX_VALUE,maxHeight:p=Number.MAX_VALUE,keepAspectRatio:m=!1,resizeDirection:h,autoScale:_=!0,shouldResize:x,onResizeStart:y,onResize:v,onResizeEnd:w}){const k=pb(),j=typeof e=="string"?e:k,b=en(),S=N.useRef(null),E=n===Qi.Handle,M=Ct(N.useCallback(QP(E&&_),[E,_]),ln),O=N.useRef(null),$=t??ZP[n];N.useEffect(()=>{if(!(!S.current||!j))return O.current||(O.current=A$({domNode:S.current,nodeId:j,getStoreItems:()=>{const{nodeLookup:A,transform:R,snapGrid:F,snapToGrid:z,nodeOrigin:I,domNode:U}=b.getState();return{nodeLookup:A,transform:R,snapGrid:F,snapToGrid:z,nodeOrigin:I,paneDomNode:U}},onChange:(A,R)=>{const{triggerNodeChanges:F,nodeLookup:z,parentLookup:I,nodeOrigin:U}=b.getState(),q=[],H={x:A.x,y:A.y},W=z.get(j);if(W&&W.expandParent&&W.parentId){const B=W.origin??U,D=A.width??W.measured.width??0,V=A.height??W.measured.height??0,te={id:W.id,parentId:W.parentId,rect:{width:D,height:V,...u0({x:A.x??W.position.x,y:A.y??W.position.y},{width:D,height:V},W.parentId,z,B)}},G=Qh([te],z,I,U);q.push(...G),H.x=A.x?Math.max(B[0]*D,A.x):void 0,H.y=A.y?Math.max(B[1]*V,A.y):void 0}if(H.x!==void 0&&H.y!==void 0){const B={id:j,type:"position",position:{...H}};q.push(B)}if(A.width!==void 0&&A.height!==void 0){const D={id:j,type:"dimensions",resizing:!0,setAttributes:h?h==="horizontal"?"width":"height":!0,dimensions:{width:A.width,height:A.height}};q.push(D)}for(const B of R){const D={...B,type:"position"};q.push(D)}F(q)},onEnd:({width:A,height:R})=>{const F={id:j,type:"dimensions",resizing:!1,dimensions:{width:A,height:R}};b.getState().triggerNodeChanges([F])}})),O.current.update({controlPosition:$,boundaries:{minWidth:u,minHeight:d,maxWidth:f,maxHeight:p},keepAspectRatio:m,resizeDirection:h,onResizeStart:y,onResize:v,onResizeEnd:w,shouldResize:x}),()=>{var A;(A=O.current)==null||A.destroy()}},[$,u,d,f,p,m,y,v,w,x]);const P=$.split("-");return a.jsx("div",{className:$t(["react-flow__resize-control","nodrag",...P,n,s]),ref:S,style:{...r,scale:M,...l&&{[E?"backgroundColor":"borderColor"]:l}},children:i})}N.memo(JP);const eL=(e,t,n)=>{var r;const s=new Array(t);for(let i=0;i<t;i++){const l=new Array(e);for(let u=0;u<e;u++){const d=!!(n&&(r=n[i])!=null&&r[u]),f=n?!d:!0;l[u]={x:u,y:i,walkable:f}}s[i]=l}return s},up=(e,t,n,s)=>n>=0&&n<e&&s>=0&&s<t,Kb=(e,t,n)=>{const s=eL(e,t,n),r=(l,u)=>s[u][l],i=(l,u)=>up(e,t,l,u)&&s[u][l].walkable;return{width:e,height:t,nodes:s,getNodeAt:r,isWalkableAt:i,setWalkableAt:(l,u,d)=>{up(e,t,l,u)&&(s[u][l].walkable=d)},getNeighbors:(l,u)=>{const d=l.x,f=l.y,p=[],m=i(d,f-1),h=i(d+1,f),_=i(d,f+1),x=i(d-1,f);m&&p.push(r(d,f-1)),h&&p.push(r(d+1,f)),_&&p.push(r(d,f+1)),x&&p.push(r(d-1,f));const y=i(d+1,f-1),v=i(d+1,f+1),w=i(d-1,f+1),k=i(d-1,f-1);return u==="Never"||(y&&p.push(r(d+1,f-1)),v&&p.push(r(d+1,f+1)),w&&p.push(r(d-1,f+1)),k&&p.push(r(d-1,f-1))),p},isInside:(l,u)=>up(e,t,l,u),clone:()=>{const l=s.map(u=>u.map(d=>d.walkable?0:1));return Kb(e,t,l)}}},dp=(e,t)=>{switch(t){case"top":return{x:e.x,y:e.y-1};case"bottom":return{x:e.x,y:e.y+1};case"left":return{x:e.x-1,y:e.y};case"right":return{x:e.x+1,y:e.y}}},Gb=(e,t,n)=>{let s=e.getNodeAt(t.x,t.y);for(;!s.walkable;){e.setWalkableAt(s.x,s.y,!0);const r=dp(s,n);s=e.getNodeAt(r.x,r.y)}},Od=(e,t,n,s)=>{const r=(e.x-t)/s+1,i=(e.y-n)/s+1;return{x:r,y:i}},Xb=(e,t,n,s)=>{const r=(e.x-1)*s+t,i=(e.y-1)*s+n;return{x:r,y:i}},$d=(e,t=10)=>Math.round(e/t)*t,Ji=(e,t=10)=>Math.floor(e/t)*t,Ba=(e,t=10)=>Math.ceil(e/t)*t,Qb=(e,t=0)=>{let n=Math.max(Math.round(e),t);return n=Number.isInteger(n)?n:t,n=n>=t?n:t,n},tL=(e,t,n,s,r=2)=>{const{xMin:i,yMin:l,width:u,height:d}=e,f=Ba(u,r)/r+1,p=Ba(d,r)/r+1,m=Kb(f,p);t.forEach(k=>{const j=Od(k.topLeft,i,l,r),b=Od(k.bottomRight,i,l,r);for(let S=j.x;S<b.x;S++)for(let E=j.y;E<b.y;E++)m.setWalkableAt(S,E,!1)});const h=Od({x:$d(n.x,r),y:$d(n.y,r)},i,l,r),_=Od({x:$d(s.x,r),y:$d(s.y,r)},i,l,r),x=m.getNodeAt(h.x,h.y);Gb(m,x,n.position);const y=m.getNodeAt(_.x,_.y);Gb(m,y,s.position);const v=dp(x,n.position),w=dp(y,s.position);return{grid:m,start:v,end:w}},nL=(e,t,n)=>{const s=[[e.x,e.y],...n,[t.x,t.y]];return sL(s)},sL=e=>{let t=e[0];const n=e[0];let s=`M${String(n[0])},${String(n[1])}M`;for(const i of e){const l=rL(t[0],t[1],i[0],i[1]);s+=` ${String(l[0])},${String(l[1])}`,s+=`Q${String(i[0])},${String(i[1])}`,t=i}const r=e[e.length-1];return s+=` ${String(r[0])},${String(r[1])}`,s},rL=(e,t,n,s)=>{const r=(e-n)/2+n,i=(t-s)/2+s;return[r,i]},aL=(e,t)=>e+t,oL=(e,t)=>{const n=Math.SQRT2-1;return e<t?n*e+t:n*t+e},iL=e=>{const t=[];let n=e;for(;n;)t.push([n.x,n.y]),n=n.parent;return t.reverse()},lL=e=>e==="Never"?aL:oL,cL=e=>{let t=0;for(let n=1;n<e.length;n++)(e[n].estimatedTotalCost??1/0)<(e[t].estimatedTotalCost??1/0)&&(t=n);return e.splice(t,1)[0]},uL=(e,t,n,s,r,i)=>{if(e.closed)return;const l=Math.abs(e.x-t.x),u=Math.abs(e.y-t.y),d=(t.costFromStart??0)+(l===0||u===0?1:Math.SQRT2);(!e.opened||d<(e.costFromStart??1/0))&&(e.costFromStart=d,e.heuristicCostToGoal=e.heuristicCostToGoal??i*r(Math.abs(e.x-n.x),Math.abs(e.y-n.y)),e.estimatedTotalCost=(e.costFromStart??0)+(e.heuristicCostToGoal??0),e.parent=t,e.opened||(e.opened=!0,s.push(e)))},dL=(e={})=>{const t=e.diagonalMovement??"Never",n=e.heuristic??lL(t),s=e.weight??1;return{findPath:(r,i,l,u,d)=>{const f=d.getNodeAt(r,i),p=d.getNodeAt(l,u),m=[];for(f.costFromStart=0,f.heuristicCostToGoal=0,f.estimatedTotalCost=0,f.opened=!0,m.push(f);m.length>0;){const h=cL(m);if(h.closed=!0,h===p)return iL(p);const _=d.getNeighbors(h,t);for(const x of _)uL(x,h,p,m,n,s)}return[]}}},mL=(e,t,n)=>{try{const s=dL({diagonalMovement:"Always"}).findPath(t.x,t.y,n.x,n.y,e);if(s.length===0)throw new Error("No path found");return s}catch(s){throw s instanceof Error?s:new Error(`Unknown error: ${String(s)}`)}},fL=(e,t=2,n=2)=>{let s=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;const u=e.map(y=>{var M,O;const v=Math.max(((M=y.measured)==null?void 0:M.width)??0,1),w=Math.max(((O=y.measured)==null?void 0:O.height)??0,1),k={x:y.position.x,y:y.position.y},j={x:k.x-t,y:k.y-t},b={x:k.x-t,y:k.y+w+t},S={x:k.x+v+t,y:k.y-t},E={x:k.x+v+t,y:k.y+w+t};return n>0&&(j.x=Ji(j.x,n),j.y=Ji(j.y,n),b.x=Ji(b.x,n),b.y=Ba(b.y,n),S.x=Ba(S.x,n),S.y=Ji(S.y,n),E.x=Ba(E.x,n),E.y=Ba(E.y,n)),j.y<l&&(l=j.y),j.x<i&&(i=j.x),E.y>r&&(r=E.y),E.x>s&&(s=E.x),{id:y.id,width:v,height:w,topLeft:j,bottomLeft:b,topRight:S,bottomRight:E}}),d=t*2;s=Ba(s+d,n),r=Ba(r+d,n),i=Ji(i-d,n),l=Ji(l-d,n);const f={x:i,y:l},p={x:i,y:r},m={x:s,y:l},h={x:s,y:r},_=Math.abs(f.x-m.x),x=Math.abs(f.y-p.y);return{nodeBoxes:u,graphBox:{topLeft:f,bottomLeft:p,topRight:m,bottomRight:h,width:_,height:x,xMax:s,yMax:r,xMin:i,yMin:l}}},hL=({options:e={},nodes:t=[],sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:l,targetPosition:u})=>{var d;try{const{drawEdge:f=nL,generatePath:p=mL}=e;let{gridRatio:m=10,nodePadding:h=10}=e;m=Qb(m),h=Qb(h);const{graphBox:_,nodeBoxes:x}=fL(t,h,m);(d=e.debug)!=null&&d.enabled&&e.debug.setGraphBox&&e.debug.setGraphBox({x:_.topLeft.x,y:_.topLeft.y,width:_.width,height:_.height});const y={x:n,y:s,position:l},v={x:r,y:i,position:u},{grid:w,start:k,end:j}=tL(_,x,y,v,m),b=p(w,k,j),S=b.map(F=>{const[z,I]=F,U=Xb({x:z,y:I},_.xMin,_.yMin,m);return[U.x,U.y]}),E=f(y,v,S),M=Math.floor(b.length/2),O=b[M],[$,P]=O,{x:A,y:R}=Xb({x:$,y:P},_.xMin,_.yMin,m);return{svgPathString:E,edgeCenterX:A,edgeCenterY:R}}catch(f){return f instanceof Error?f:new Error(`Unknown error: ${String(f)}`)}};N.createContext({enabled:!1,graphBox:null,setGraphBox:()=>{}});const pL=e=>Number.isFinite(e),Td=e=>Math.round(e*100)/100,gL=(e,t,n,s)=>{if(e===n&&t===s)return`M ${e},${t}`;const r=Math.abs(n-e),i=Math.abs(s-t),l=Math.sqrt(r*r+i*i),u=Math.max(80,Math.min(l*.4,280)),d=Number.isFinite(u)?u:120,f=n>=e?1:-1,p=Math.min(Math.abs(s-t)*.2,50),m=e+f*d,h=t+(s>t?p:-p),_=n-f*d,x=s-(s>t?p:-p);return`M ${e},${t} C ${m},${h} ${_},${x} ${n},${s}`},_L=({id:e,sourceX:t,sourceY:n,targetX:s,targetY:r,sourcePosition:i=Le.Bottom,targetPosition:l=Le.Top,markerEnd:u,style:d})=>{const{setEdges:f,getNodes:p}=ph(),[m,h]=N.useState(!1),_=N.useCallback(()=>{h(!0)},[]),x=N.useCallback(()=>{h(!1)},[]),y=N.useMemo(()=>[t,n,s,r].every(z=>pL(z))?{sourceX:Td(t),sourceY:Td(n),targetX:Td(s),targetY:Td(r)}:(console.error(` Edge ${e}: Invalid coordinates`,{sourceX:t,sourceY:n,targetX:s,targetY:r}),null),[t,n,s,r,e]),v=N.useMemo(()=>{if(!y)return null;const{sourceX:z,sourceY:I,targetX:U,targetY:q}=y;try{const D=p().map(te=>({...te,width:te.width&&te.width>0?te.width:320,height:te.height&&te.height>0?te.height:170})),V=hL({sourcePosition:i,targetPosition:l,sourceX:z,sourceY:I,targetX:U,targetY:q,nodes:D,options:{nodePadding:40,gridRatio:10}});if(V&&"svgPathString"in V){const{svgPathString:te,edgeCenterX:G,edgeCenterY:K}=V;return{path:te,labelX:G,labelY:K}}}catch{}const H=gL(z,I,U,q),W=(z+U)/2,B=(I+q)/2;return{path:H,labelX:W,labelY:B}},[y,i,l,p]),w=N.useMemo(()=>`animated-edge-gradient-${e}`,[e]);if(!y||!v)return null;const{sourceX:k,sourceY:j,targetX:b,targetY:S}=y,{path:E,labelX:M,labelY:O}=v,$=40,P=M-$/2,A=O-$/2,R=`animated-edge${m?" animated-edge--hovered":""}`,F=`canvas-edge-remove${m?" canvas-edge-remove--visible":""}`;return a.jsxs("g",{className:R,onMouseEnter:_,onMouseLeave:x,children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:w,gradientUnits:"userSpaceOnUse",x1:k,y1:j,x2:b,y2:S,children:[a.jsx("stop",{offset:"0%",stopColor:"#38bdf8",stopOpacity:.85}),a.jsx("stop",{offset:"50%",stopColor:"#6366f1",stopOpacity:.95}),a.jsx("stop",{offset:"100%",stopColor:"#a855f7",stopOpacity:.9})]}),a.jsxs("filter",{id:`edge-glow-${e}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"coloredBlur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("path",{d:E,fill:"none",stroke:"transparent",strokeWidth:40,style:{cursor:"pointer"},className:"animated-edge__interaction"}),a.jsx("path",{d:E,fill:"none",stroke:`url(#${w})`,strokeWidth:6,strokeOpacity:.2,strokeLinecap:"round",strokeLinejoin:"round",style:{filter:`url(#edge-glow-${e})`}}),a.jsx("path",{d:E,fill:"none",stroke:`url(#${w})`,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",markerEnd:u,className:"animated-edge__base",style:{...d,transition:"stroke-width 0.2s ease"}}),a.jsx("path",{d:E,fill:"none",stroke:`url(#${w})`,strokeWidth:m?3.5:3,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"16 12",className:"animated-edge__trail",style:{transition:"stroke-width 0.2s ease"}}),a.jsx("path",{d:E,fill:"none",stroke:"rgba(248, 250, 252, 0.4)",strokeWidth:1.5,strokeDasharray:"3 8",strokeLinecap:"round",strokeLinejoin:"round",className:"animated-edge__spark"}),a.jsx("foreignObject",{className:F,x:P,y:A,width:$,height:$,requiredExtensions:"http://www.w3.org/1999/xhtml",children:a.jsx("div",{className:"canvas-edge-remove__wrapper",children:a.jsx("button",{type:"button",className:"canvas-edge-remove__button",onClick:z=>{z.stopPropagation(),f(I=>I.filter(U=>U.id!==e))},"aria-label":"Remove connection",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(qi,{size:12})})})})]})},yL=({thresholdParameter:e,dropColumnParameter:t,renderParameterField:n,renderMultiSelectField:s})=>a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Missingness recommendations"})}),e&&n(e),s(t)]}),vL=({thresholdParameter:e,dropIfAnyParameter:t,renderParameterField:n})=>!e&&!t?null:a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Row missingness"})}),e&&n(e),t&&n(t)]}),Zb="first",xL=[{value:"first",label:"Keep first occurrence"},{value:"last",label:"Keep last occurrence"},{value:"none",label:"Drop all duplicates"}],bL=({sourceId:e,hasReachableSource:t,removeDuplicatesColumnsParameter:n,removeDuplicatesKeepParameter:s,renderMultiSelectField:r,removeDuplicatesKeepSelectId:i,removeDuplicatesKeep:l,onKeepChange:u})=>{if(!n&&!s)return null;const d=f=>{const p=f.target.value;u(p==="last"||p==="none"?p:"first")};return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Duplicate handling"})}),a.jsx("p",{className:"canvas-modal__note",children:"Choose comparison columns and decide whether to keep the first row, last row, or drop all duplicates."}),e?t?null:a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to inspect its columns."}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to load the available columns for duplicate checks."}),n&&a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Columns to compare"}),r(n)]}),s&&a.jsxs("div",{className:"canvas-modal__parameter-field",children:[a.jsx("label",{htmlFor:i,className:"canvas-modal__parameter-label",children:s.label??"Keep strategy"}),s.description&&a.jsx("p",{className:"canvas-modal__parameter-description",children:s.description}),a.jsx("div",{className:"canvas-modal__parameter-control",children:a.jsx("select",{id:i,value:l,onChange:d,children:xL.map(f=>a.jsx("option",{value:f.value,children:f.label},f.value))})})]})]})},Ge=e=>Array.isArray(e)?e.map(t=>String(t??"").trim()).filter(t=>t.length>0):[],wL=["float64","Int64","boolean","string","category","datetime64[ns]","object"],NL=({configState:e,setConfigState:t,availableColumns:n,columnTypeMap:s,columnSuggestions:r,selectedColumns:i,previewColumns:l,previewStatus:u,sourceId:d,hasReachableSource:f})=>{const p=N.useMemo(()=>{const b=e==null?void 0:e.column_overrides;if(!b||typeof b!="object"||Array.isArray(b))return{};const S={};return Object.entries(b).forEach(([E,M])=>{const O=String(E??"").trim();if(!O||typeof M!="string")return;const $=M.trim();$&&(S[O]=$)}),S},[e==null?void 0:e.column_overrides]),m=N.useMemo(()=>{const b=e==null?void 0:e.target_dtype;return typeof b=="string"?b.trim():""},[e==null?void 0:e.target_dtype]),h=N.useMemo(()=>{const b=new Set;return n.forEach(E=>b.add(E)),Object.keys(s).forEach(E=>b.add(E)),Object.keys(r).forEach(E=>b.add(E)),Object.keys(p).forEach(E=>b.add(E)),i.forEach(E=>b.add(E)),l.forEach(E=>{typeof E=="string"&&b.add(E)}),Array.from(b).sort((E,M)=>E.localeCompare(M)).map(E=>{const M=s[E]??"Unknown",O=r[E]??[],$=O.length?O[0]:null,P=Object.prototype.hasOwnProperty.call(p,E),A=P?p[E]:null,R=typeof A=="string"?A.trim():"",F=P?R:m,z=new Set;F&&z.add(F),O.forEach(B=>z.add(B)),M&&M!=="Unknown"&&z.add(M),m&&z.add(m),wL.forEach(B=>z.add(B));const I=F??"",U=!!($&&$!==I),q=!!($&&$===I),H=i.includes(E),W=Array.from(z).sort((B,D)=>B.localeCompare(D));return{column:E,originalType:M,recommended:$,currentTarget:F,suggestions:O,options:W,hasRecommendationGap:U,hasOverride:P,usesDefaultTarget:!P,isRecommendationApplied:q,isSelected:H}})},[n,m,p,r,s,l,i]),_=N.useMemo(()=>{const b=h.filter(M=>M.hasRecommendationGap),S=h.filter(M=>!M.hasRecommendationGap),E=[];return b.length&&E.push({key:"needs-attention",label:"Needs attention",rows:b}),S.length&&E.push({key:"all-columns",label:b.length?"Other columns":"All columns",rows:S}),E},[h]),x=N.useMemo(()=>h.filter(b=>b.hasRecommendationGap).length,[h]),y=N.useMemo(()=>x>0,[x]),v=N.useMemo(()=>h.filter(b=>b.isSelected).length,[h]),w=N.useCallback((b,S)=>{const E=b.trim();E&&t(M=>{const O=M.column_overrides&&typeof M.column_overrides=="object"&&!Array.isArray(M.column_overrides)?{...M.column_overrides}:{},$=typeof S=="string"?S.trim():"",P=new Set(Ge(M.columns)),A=new Set(Ge(M.skipped_columns)),R=A.delete(E);$?(O[E]=$,P.add(E)):delete O[E];const F={...M,columns:Array.from(P).sort((z,I)=>z.localeCompare(I)),column_overrides:O};return R&&(F.skipped_columns=Array.from(A).sort((z,I)=>z.localeCompare(I))),F})},[t]),k=N.useCallback(()=>{const b=Object.entries(r).filter(([,S])=>S.length>0);b.length&&t(S=>{const E=new Set(Ge(S.columns)),M=S.column_overrides&&typeof S.column_overrides=="object"&&!Array.isArray(S.column_overrides)?{...S.column_overrides}:{};return b.forEach(([O,$])=>{const P=O.trim();P&&(E.add(P),$.length&&(M[P]=$[0]))}),{...S,columns:Array.from(E).sort((O,$)=>O.localeCompare($)),column_overrides:M}})},[r,t]),j=N.useCallback((b,S)=>{S==="__default__"?w(b,null):w(b,S)},[w]);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Column dtype alignment"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:k,disabled:!y,children:"Apply recommendations"})})]}),!d&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to analyse current column dtypes and suggestions."}),d&&!f&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to load dtype insights."}),m?a.jsxs("p",{className:"canvas-modal__note",children:["Global target dtype: ",a.jsx("strong",{children:m}),". Columns inherit this unless an override is set."]}):a.jsx("p",{className:"canvas-modal__note",children:"Set a global target dtype or override individual columns below."}),h.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",h.length," column",h.length===1?"":"s","  ",v," mapped in node selection."]}),y?a.jsxs("p",{className:"canvas-modal__note",children:[x," column",x===1?"":"s"," need attention. Apply them in bulk or adjust individually."]}):h.length>0&&a.jsx("p",{className:"canvas-modal__note",children:"All recommendations are in sync. Fine-tune overrides per column as needed."}),u==="loading"&&!h.length&&a.jsx("p",{className:"canvas-modal__note",children:"Loading column type insights"}),h.length===0?a.jsx("p",{className:"canvas-modal__note",children:"Add columns or refresh the dataset preview to surface dtype intelligence."}):a.jsx("div",{className:"canvas-cast__body",children:_.map(b=>a.jsxs("div",{className:"canvas-cast__group",children:[b.label&&a.jsxs("div",{className:"canvas-cast__group-header",children:[a.jsx("h4",{children:b.label}),a.jsxs("span",{children:[b.rows.length," column",b.rows.length===1?"":"s"]})]}),a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Original dtype"}),a.jsx("th",{scope:"col",children:"Recommended"}),a.jsx("th",{scope:"col",children:"Target dtype"})]})}),a.jsx("tbody",{children:b.rows.map(S=>{const E=["canvas-cast__row"];S.hasRecommendationGap&&E.push("canvas-cast__row--attention"),S.hasOverride&&E.push("canvas-cast__row--override");const M=S.hasOverride?S.currentTarget||"":"__default__",O=S.isRecommendationApplied,$=S.suggestions.slice(1,4),P=S.hasOverride?S.currentTarget?`Override  ${S.currentTarget}`:"Override cleared (uses original dtype)":m?`Inheriting ${m}`:"Retains original dtype until a target is set";return a.jsxs("tr",{className:E.join(" "),children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:S.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[S.isSelected&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),S.hasOverride&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),!S.isSelected&&!S.hasOverride&&a.jsx("span",{className:"canvas-cast__muted",children:"Not yet in node"})]})]})}),a.jsx("td",{children:a.jsx("span",{className:"canvas-cast__muted",children:S.originalType})}),a.jsx("td",{children:S.recommended?a.jsxs("div",{className:"canvas-cast__recommendation",children:[a.jsx("span",{className:`canvas-cast__chip${S.hasRecommendationGap?" canvas-cast__chip--attention":""}${O?" canvas-cast__chip--applied":""}`,children:S.recommended}),a.jsx("span",{className:"canvas-cast__recommendation-note",children:O?"Aligned with target":"Not applied yet"}),$.length>0&&a.jsxs("span",{className:"canvas-cast__suggestions",children:["Other options: ",$.join(", ")]})]}):a.jsx("span",{className:"canvas-cast__muted",children:"No recommendation"})}),a.jsx("td",{children:a.jsxs("div",{className:"canvas-cast__target",children:[a.jsxs("select",{value:M,onChange:A=>j(S.column,A.target.value),children:[a.jsx("option",{value:"__default__",children:m?`Inherit global (${m})`:"No override (use original)"}),S.options.map(A=>a.jsx("option",{value:A,children:A},`${S.column}-${A}`))]}),a.jsx("span",{className:"canvas-cast__target-note",children:P})]})})]},`cast-row-${S.column}`)})})]})})]},`cast-group-${b.key}`))})]})};async function mp(){const e=await fetch("/ml-workflow/api/node-catalog");if(!e.ok)throw new Error("Failed to load node catalog");return e.json()}async function Jb(e=8){const t=await fetch(`/ml-workflow/api/datasets?limit=${encodeURIComponent(String(e))}`);if(!t.ok)throw new Error("Failed to load datasets");return t.json()}async function ew(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/label-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load label encoding recommendations");return l.json()}async function tw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/ordinal-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load ordinal encoding suggestions");return l.json()}async function nw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/target-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load target encoding recommendations");return l.json()}async function sw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/hash-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load hash encoding recommendations");return l.json()}async function rw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/one-hot-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load one-hot encoding recommendations");return l.json()}async function aw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/dummy-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load dummy encoding recommendations");return l.json()}async function fp(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/drop-columns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load column drop recommendations");return l.json()}async function ow(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i=typeof n=="number"&&Number.isFinite(n)?Math.min(5e3,Math.max(50,Math.round(n))):500,l={dataset_source_id:e,sample_size:i};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(l.graph={nodes:s.nodes,edges:s.edges}),r&&(l.target_node_id=r);const u=await fetch("/ml-workflow/api/recommendations/outliers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load outlier recommendations");return u.json()}async function iw(e,t={}){const{sampleSize:n=500,transformations:s,graph:r,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};Array.isArray(s)?s.length>0&&(l.transformations=JSON.stringify(s)):s&&typeof s=="object"&&Object.keys(s).length>0&&(l.transformations=JSON.stringify(s)),r&&Array.isArray(r.nodes)&&Array.isArray(r.edges)&&(l.graph={nodes:r.nodes,edges:r.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/skewness",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load skewness recommendations");return u.json()}async function lw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/scaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load scaling recommendations");return l.json()}async function cw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/binning",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load binning recommendations");return l.json()}async function uw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i=n==="all"?0:typeof n=="number"&&Number.isFinite(n)?Math.max(0,Math.round(n)):500,l={dataset_source_id:e,sample_size:i};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(l.graph={nodes:s.nodes,edges:s.edges}),r&&(l.target_node_id=r);const u=await fetch("/ml-workflow/api/analytics/binned-distribution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok){let d="Failed to load binned column distributions";try{const f=await u.clone().json(),p=typeof(f==null?void 0:f.detail)=="string"&&f.detail.trim()?f.detail.trim():typeof(f==null?void 0:f.error)=="string"&&f.error.trim()?f.error.trim():typeof(f==null?void 0:f.message)=="string"&&f.message.trim()?f.message.trim():null;p&&(d=p)}catch{try{const p=(await u.text()).trim();p&&(d=p)}catch{}}throw new Error(d)}return u.json()}async function dw(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i=n==="all"?0:typeof n=="number"&&Number.isFinite(n)?Math.max(0,Math.round(n)):500,l=new URLSearchParams({dataset_source_id:e,sample_size:String(i)});s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&l.set("graph",JSON.stringify({nodes:s.nodes,edges:s.edges})),r&&l.set("target_node_id",r);const u=await fetch(`/ml-workflow/api/analytics/quick-profile?${l.toString()}`);if(!u.ok){let d="Failed to generate dataset profile";try{const f=await u.clone().json(),p=typeof(f==null?void 0:f.detail)=="string"&&f.detail.trim()?f.detail.trim():typeof(f==null?void 0:f.error)=="string"&&f.error.trim()?f.error.trim():typeof(f==null?void 0:f.message)=="string"&&f.message.trim()?f.message.trim():null;p&&(d=p)}catch{try{const p=(await u.text()).trim();p&&(d=p)}catch{}}throw new Error(d)}return u.json()}async function jL(e,t={}){const{config:n,sampleSize:s,graph:r,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:s==="all"?0:typeof s=="number"&&Number.isFinite(s)?s:300};if(n&&typeof n=="object"){const d=(h,_)=>{const x=Number(h);return Number.isFinite(x)?x<0?0:x>100?100:x:_},f=h=>{if(!h||typeof h!="object")return{};const _={};return Object.entries(h).forEach(([x,y])=>{const v=String(x??"").trim();if(!v)return;let w=null,k=null;if(y&&typeof y=="object"){const j=y.lower??y.min??y.minimum??null,b=y.upper??y.max??y.maximum??null,S=Number(j);Number.isFinite(S)&&(w=S);const E=Number(b);Number.isFinite(E)&&(k=E)}if(!(w===null&&k===null)){if(w!==null&&k!==null&&w>k){const j=w;w=k,k=j}_[v]={lower:w,upper:k}}}),_},p=d(n.lower_percentile,5),m=d(n.upper_percentile,95);l.config={...n,method:n.method??"z_score",columns:Array.isArray(n.columns)?n.columns:[],z_threshold:typeof n.z_threshold=="number"&&Number.isFinite(n.z_threshold)?n.z_threshold:3,iqr_multiplier:typeof n.iqr_multiplier=="number"&&Number.isFinite(n.iqr_multiplier)?n.iqr_multiplier:1.5,lower_percentile:p,upper_percentile:m<=p?Math.min(p+1,100):m,manual_bounds:f(n.manual_bounds)}}r&&Array.isArray(r.nodes)&&Array.isArray(r.edges)&&(l.graph={nodes:r.nodes,edges:r.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/analytics/outliers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok){const d=await u.text();throw new Error(d||"Failed to load outlier diagnostics")}return u.json()}async function mw(e){const t=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}`);if(t.status===404)return null;if(!t.ok)throw new Error("Failed to load saved pipeline");return t.json()}async function fw(e,t){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to save pipeline");return n.json()}async function hw(e,t=10){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/history?limit=${encodeURIComponent(String(t))}`);if(n.status===404)return[];if(!n.ok)throw new Error("Failed to load pipeline history");return n.json()}async function pw(e,t={}){const{offset:n,limit:s,mode:r}=t,i=new URLSearchParams;typeof n=="number"&&Number.isFinite(n)&&i.set("offset",String(n)),typeof s=="number"&&Number.isFinite(s)&&i.set("limit",String(s)),r&&i.set("mode",r);const l=i.toString(),u=`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/preview/rows${l?`?${l}`:""}`,d=await fetch(u);if(!d.ok){const f=await d.text();throw new Error(f||"Failed to load preview rows")}return d.json()}async function gw(e){const t=await fetch("/ml-workflow/api/pipelines/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const n=await t.text();throw new Error(n||"Failed to load pipeline preview")}return t.json()}async function _w(e){const t={...e,sample_size:0},n=await fetch("/ml-workflow/api/pipelines/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const s=await n.text();throw new Error(s||"Failed to trigger full dataset execution")}return n.json()}async function yw(e,t){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/full-execution/${encodeURIComponent(t)}`);if(!n.ok){const s=await n.text();throw new Error(s||"Failed to fetch full execution status")}return n.json()}async function vw(e){const t=await fetch("/ml-workflow/api/training-jobs",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to launch training jobs.");const s=await t.text();throw new Error(s||"Failed to enqueue training job")}const n=await t.json();if(n&&Array.isArray(n==null?void 0:n.jobs)){const s=n.jobs,r=typeof n.total=="number"?n.total:s.length;return{jobs:s,total:r}}return n&&n.id?{jobs:[n],total:1}:{jobs:[],total:0}}async function xw(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/training-jobs/${encodeURIComponent(e)}/cancel`,{method:"POST",credentials:"include"});if(!t.ok){const n=await t.text();let s=n;try{const r=JSON.parse(n);r.detail&&(s=r.detail)}catch{}throw t.status===501?new Error(s||"Cancellation is not supported in this environment."):new Error(s||"Failed to cancel training job")}}async function bw(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/training-jobs/${encodeURIComponent(e)}`,{credentials:"include"});if(t.status===404)throw new Error("Training job not found");if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to view this training job.");const n=await t.text();throw new Error(n||"Failed to load training job")}return t.json()}async function bc(e={}){const t=new URLSearchParams;e.datasetSourceId&&t.set("dataset_source_id",e.datasetSourceId),e.pipelineId&&t.set("pipeline_id",e.pipelineId),e.nodeId&&t.set("node_id",e.nodeId),typeof e.limit=="number"&&Number.isFinite(e.limit)&&t.set("limit",String(e.limit));const n=t.toString(),s=await fetch(`/ml-workflow/api/training-jobs${n?`?${n}`:""}`,{credentials:"include"});if(!s.ok){if(s.status===401||s.status===403)throw new Error("Sign in to view training jobs.");const r=await s.text();throw new Error(r||"Failed to load training jobs")}return s.json()}async function ww(e,t){if(!e)throw new Error("jobId is required for evaluation");const n=await fetch(`/ml-workflow/api/training-jobs/${encodeURIComponent(e)}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t??{})});if(!n.ok){if(n.status===401||n.status===403)throw new Error("Sign in to evaluate this model.");const s=await n.text();throw new Error(s||"Failed to evaluate model")}return n.json()}async function Nw(e){const t=await fetch("/ml-workflow/api/hyperparameter-tuning-jobs",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to launch tuning jobs.");const s=await t.text();throw new Error(s||"Failed to enqueue tuning job")}const n=await t.json();if(n&&Array.isArray(n==null?void 0:n.jobs)){const s=n.jobs,r=typeof n.total=="number"?n.total:s.length;return{jobs:s,total:r}}return n&&n.id?{jobs:[n],total:1}:{jobs:[],total:0}}async function jw(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/hyperparameter-tuning-jobs/${encodeURIComponent(e)}/cancel`,{method:"POST",credentials:"include"});if(!t.ok){const n=await t.text();let s=n;try{const r=JSON.parse(n);r.detail&&(s=r.detail)}catch{}throw t.status===501?new Error(s||"Cancellation is not supported in this environment."):new Error(s||"Failed to cancel tuning job")}}async function CL(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/hyperparameter-tuning-jobs/${encodeURIComponent(e)}`,{credentials:"include"});if(t.status===404)throw new Error("Tuning job not found");if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to view this tuning job.");const n=await t.text();throw new Error(n||"Failed to load tuning job")}return t.json()}async function wc(e={}){const t=new URLSearchParams;e.datasetSourceId&&t.set("dataset_source_id",e.datasetSourceId),e.pipelineId&&t.set("pipeline_id",e.pipelineId),e.nodeId&&t.set("node_id",e.nodeId),typeof e.limit=="number"&&Number.isFinite(e.limit)&&t.set("limit",String(e.limit));const n=t.toString(),s=await fetch(`/ml-workflow/api/hyperparameter-tuning-jobs${n?`?${n}`:""}`,{credentials:"include"});if(!s.ok){if(s.status===401||s.status===403)throw new Error("Sign in to view tuning jobs.");const r=await s.text();throw new Error(r||"Failed to load tuning jobs")}return s.json()}async function Pd(e){const t=await fetch(`/ml-workflow/api/model-hyperparameters/${encodeURIComponent(e)}`);if(!t.ok){if(t.status===404)throw new Error(`Model type '${e}' not found`);const n=await t.text();throw new Error(n||"Failed to load model hyperparameters")}return t.json()}async function Cw(e,t={}){const n=new URLSearchParams;t.pipelineId&&n.set("pipeline_id",t.pipelineId),t.datasetSourceId&&n.set("dataset_source_id",t.datasetSourceId);const s=n.toString(),r=await fetch(`/ml-workflow/api/hyperparameter-tuning/best-params/${encodeURIComponent(e)}${s?`?${s}`:""}`,{credentials:"include"});if(!r.ok){if(r.status===404)throw new Error(`Model type '${e}' not found`);const i=await r.text();throw new Error(i||"Failed to fetch best hyperparameters")}return r.json()}const hp=e=>{if(Array.isArray(e))return e.map(t=>hp(t));if(e&&typeof e=="object"){const t=Object.keys(e).sort(),n={};return t.forEach(s=>{n[s]=hp(e[s])}),n}return e},SL=e=>Array.from(new Uint8Array(e)).map(t=>t.toString(16).padStart(2,"0")).join(""),EL=async e=>{if(!globalThis.crypto||!globalThis.crypto.subtle)throw new Error("Secure hashing is not available in this environment");const t=new TextEncoder,n=await globalThis.crypto.subtle.digest("SHA-256",t.encode(e));return SL(n)},kL=e=>{const t=e&&Array.isArray(e.nodes)?e.nodes:[],n=e&&Array.isArray(e.edges)?e.edges:[],s=t.map(i=>{let l=null;if(i&&i.data&&typeof i.data=="object"){const u=i.data.config;if(u!==void 0)try{l=JSON.parse(JSON.stringify(u))}catch{l=u}}return{id:i&&Object.prototype.hasOwnProperty.call(i,"id")?i.id??null:null,type:i&&Object.prototype.hasOwnProperty.call(i,"type")?i.type??null:null,catalogType:i&&i.data&&Object.prototype.hasOwnProperty.call(i.data,"catalogType")?i.data.catalogType??null:null,config:l}}).sort((i,l)=>{const u=typeof i.id=="string"?i.id:String(i.id??""),d=typeof l.id=="string"?l.id:String(l.id??"");return u.localeCompare(d)}),r=n.map(i=>({source:i&&Object.prototype.hasOwnProperty.call(i,"source")?i.source??null:null,target:i&&Object.prototype.hasOwnProperty.call(i,"target")?i.target??null:null,sourceHandle:i&&Object.prototype.hasOwnProperty.call(i,"sourceHandle")?i.sourceHandle??null:null,targetHandle:i&&Object.prototype.hasOwnProperty.call(i,"targetHandle")?i.targetHandle??null:null})).sort((i,l)=>{const u=String(i.source??"").localeCompare(String(l.source??""));return u!==0?u:String(i.target??"").localeCompare(String(l.target??""))});return{nodes:s,edges:r}};async function Lo(e,t){if(!e)throw new Error("datasetSourceId is required to compute pipeline ID");const n=kL(t),s=JSON.stringify(hp(n)),r=await EL(s);return`${e}_${r.slice(0,8)}`}const ML=Object.freeze(Object.defineProperty({__proto__:null,cancelHyperparameterTuningJob:jw,cancelTrainingJob:xw,createHyperparameterTuningJob:Nw,createTrainingJob:vw,evaluateTrainingJob:ww,fetchBestHyperparameters:Cw,fetchBinnedDistribution:uw,fetchBinningRecommendations:cw,fetchDatasets:Jb,fetchDropColumnRecommendations:fp,fetchDummyEncodingRecommendations:aw,fetchFullExecutionStatus:yw,fetchHashEncodingRecommendations:sw,fetchHyperparameterTuningJob:CL,fetchHyperparameterTuningJobs:wc,fetchLabelEncodingRecommendations:ew,fetchModelHyperparameters:Pd,fetchNodeCatalog:mp,fetchOneHotEncodingRecommendations:rw,fetchOrdinalEncodingRecommendations:tw,fetchOutlierDiagnostics:jL,fetchOutlierRecommendations:ow,fetchPipeline:mw,fetchPipelineHistory:hw,fetchPipelinePreview:gw,fetchPipelinePreviewRows:pw,fetchQuickProfile:dw,fetchScalingRecommendations:lw,fetchSkewnessRecommendations:iw,fetchTargetEncodingRecommendations:nw,fetchTrainingJob:bw,fetchTrainingJobs:bc,generatePipelineId:Lo,savePipeline:fw,triggerFullDatasetExecution:_w},Symbol.toStringTag,{value:"Module"})),Nc=100,AL=12,OL={limited_full_sample_for_large_dataset:"Preview limited because the dataset is large.",capped_sample_for_large_dataset:"Requested sample size capped for a large dataset.",switched_to_first_last_for_large_dataset:"Using first and last rows to summarize the large dataset.",default_offset:"Offset fallback applied; starting from the beginning.",normalized_negative_offset:"Negative offset normalized to zero.",default_limit:"Using the default preview window size.",normalized_non_positive_limit:"Requested preview size too small; using the minimum window.",capped_limit_for_sample:"Preview window capped to stay within safe limits."},Sw={succeeded:"Completed",deferred:"Deferred",queued:"Queued",running:"In progress",failed:"Failed",skipped:"Skipped",cancelled:"Cancelled"},$L={dataset_too_large:"Full dataset run is executing in the background for large datasets.",memory_error:"Full dataset execution failed because the server ran out of memory.",background_failure:"Background job ended unexpectedly. Check server logs for details.",pending_configuration:"Some nodes still need configuration. Open each highlighted node and save its settings before retrying the full dataset run."},TL={queued:"Queued",running:"Running",succeeded:"Completed",failed:"Failed",cancelled:"Cancelled"},PL=e=>{switch(e){case"succeeded":case"deferred":case"queued":case"running":case"failed":case"skipped":case"cancelled":return e;default:return"deferred"}},LL=e=>{if(!e)return"";const t=$L[e];if(t)return t;const n=e.replace(/_/g," ").trim();return n?n.charAt(0).toUpperCase()+n.slice(1):e},Ew=(e,t)=>{if(!e)return null;const n=e.job_status??null,s=PL(n??e.status??null),r=Sw[n??e.status??s]??Sw[s],i=typeof e.processed_rows=="number"&&e.processed_rows>=0?t(e.processed_rows):null,l=typeof e.total_rows=="number"&&e.total_rows>=0?t(e.total_rows):null;let u=`Full dataset run: ${r}`;s==="running"&&i&&l?u=`Full dataset run: In progress (${i}/${l})`:s==="running"&&i?u=`Full dataset run: In progress (${i} rows)`:s==="succeeded"&&i?u=`Full dataset run: Completed (${i} rows)`:s==="succeeded"&&l&&(u=`Full dataset run: Completed (${l} rows)`);const d=[],f=[],p=n?TL[n]??n:null;if(n==="running"?i&&l?d.push(`Processed ${i} of ${l} rows.`):i?d.push(`Processed ${i} rows.`):l&&d.push(`Processing ${l} rows.`):i?d.push(`Processed ${i} rows.`):l&&d.push(`Total rows ${l}.`),e.reason&&d.push(e.reason),p&&f.push({label:"Background job",value:p}),e.job_id&&f.push({label:"Background job ID",value:e.job_id}),l&&f.push({label:"Dataset rows",value:l}),i&&s!=="queued"&&s!=="skipped"&&f.push({label:"Processed rows",value:i}),typeof e.poll_after_seconds=="number"&&e.poll_after_seconds>0&&f.push({label:"Next status check",value:`${e.poll_after_seconds}s`}),e.last_updated)try{const _=new Date(e.last_updated).toLocaleString();f.push({label:"Last updated",value:_})}catch{f.push({label:"Last updated",value:String(e.last_updated)})}const m=Array.isArray(e.warnings)?e.warnings.map(LL).map(_=>_.trim()).filter(Boolean):[];let h=null;switch(s){case"queued":h=e.reason?e.reason:"Full dataset run queued in background.";break;case"running":h=e.reason?e.reason:"Full dataset run in progress.";break;case"succeeded":if(i){const _=e.processed_rows===1?"":"s";h=`Full dataset run processed ${i} row${_}.`}else l?h=`Full dataset run completed (${l} rows).`:h="Full dataset run completed.";break;case"failed":h=e.reason?`Full dataset run failed: ${e.reason}`:"Full dataset run failed.";break;case"cancelled":h="Full dataset run cancelled.";break;case"skipped":h=e.reason?`Full dataset run skipped: ${e.reason}`:"Full dataset run skipped.";break;case"deferred":h=e.reason?e.reason:"Full dataset run deferred to background processing.";break;default:h=null;break}return{label:u,tone:s,details:d,metadata:f,warnings:m,stepLabel:h,isActive:n==="queued"||n==="running"}},kw=e=>{if(!e)return"idle";const t=(e.job_status??e.status??"").toLowerCase();return t?t==="succeeded"?"success":t==="failed"||t==="skipped"||t==="cancelled"?"error":t==="running"||t==="queued"||t==="deferred"?"loading":"idle":"idle"},Mw=()=>({status:"idle",columns:[],rows:[],nextOffset:null,hasMore:!1,totalRows:null,samplingAdjustments:[],largeDataset:!1,error:null}),zL=e=>{if(!e)return"";if(e.startsWith("window_mode_fallback:")){const s=e.split(":",2)[1]??"";return s?`Preview mode "${s}" is not supported; falling back to head sampling.`:"Preview mode fallback applied."}const t=OL[e];if(t)return t;const n=e.replace(/_/g," ").trim();return n?n.charAt(0).toUpperCase()+n.slice(1):e},RL=({preview:e,columns:t,rows:n,tableNote:s,formatCellValue:r,formatMetricValue:i,formatMissingPercentage:l,formatNumericStat:u,formatModeStat:d,fullExecutionStepLabel:f,fullExecutionWarnings:p})=>{const m=e==null?void 0:e.metrics,h=Array.isArray(e==null?void 0:e.column_stats)?e.column_stats:[],_=Array.isArray(e==null?void 0:e.row_missing_stats)?e.row_missing_stats:[],x=Array.isArray(e==null?void 0:e.applied_steps)?e.applied_steps:[];let y=x;const v=f||null;if(v){const b=x.findIndex(S=>typeof S=="string"&&S.toLowerCase().startsWith("full dataset run"));b>=0?y=[...x.slice(0,b),v,...x.slice(b+1)]:x.includes(v)||(y=[...x,v])}const w=Array.isArray(e==null?void 0:e.sample_rows)?e.sample_rows:[],k=_.reduce((b,S)=>(S&&typeof S.index=="number"&&(b[S.index]=typeof S.missing_percentage=="number"?S.missing_percentage:0),b),{}),j=w.slice(0,AL);return a.jsxs("div",{className:"canvas-preview",children:[m&&a.jsxs("div",{className:"canvas-preview__metrics",role:"list",children:[a.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[a.jsx("span",{className:"canvas-preview__metric-label",children:"Rows"}),a.jsx("span",{className:"canvas-preview__metric-value",children:i(m.row_count)})]}),a.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[a.jsx("span",{className:"canvas-preview__metric-label",children:"Columns"}),a.jsx("span",{className:"canvas-preview__metric-value",children:i(m.column_count)})]}),a.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[a.jsx("span",{className:"canvas-preview__metric-label",children:"Duplicate rows"}),a.jsx("span",{className:"canvas-preview__metric-value",children:i(m.duplicate_rows)})]}),a.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[a.jsx("span",{className:"canvas-preview__metric-label",children:"Missing cells"}),a.jsx("span",{className:"canvas-preview__metric-value",children:i(m.missing_cells)})]}),a.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[a.jsx("span",{className:"canvas-preview__metric-label",children:"Rows sampled"}),a.jsx("span",{className:"canvas-preview__metric-value",children:i(m.preview_rows)})]}),a.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[a.jsx("span",{className:"canvas-preview__metric-label",children:"Dataset rows"}),a.jsx("span",{className:"canvas-preview__metric-value",children:i(m.total_rows)})]}),a.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[a.jsx("span",{className:"canvas-preview__metric-label",children:"Sample request"}),a.jsx("span",{className:"canvas-preview__metric-value",children:m.requested_sample_size===0?"Full dataset":i(m.requested_sample_size)})]})]}),y.length>0&&a.jsxs("div",{className:"canvas-preview__steps",children:[a.jsx("h4",{children:"Applied steps"}),a.jsx("ol",{children:y.map((b,S)=>a.jsx("li",{children:b},`${b}-${S}`))})]}),t.length>0&&n.length>0?a.jsxs("div",{className:"canvas-preview__table-wrapper",role:"region","aria-label":"Sample rows",children:[a.jsxs("table",{className:"canvas-preview__table",children:[a.jsx("thead",{children:a.jsx("tr",{children:t.map(b=>a.jsx("th",{children:b},b))})}),a.jsx("tbody",{children:n.map((b,S)=>a.jsx("tr",{children:t.map(E=>a.jsx("td",{children:r(b==null?void 0:b[E])},`${S}-${E}`))},`row-${S}`))})]}),s?a.jsx("p",{className:"canvas-modal__note",children:s}):null]}):a.jsx("p",{className:"canvas-modal__note",children:"No sample rows available after applying the upstream steps."}),_.length>0&&j.length>0&&a.jsxs("div",{className:"canvas-preview__row-stats",children:[a.jsx("h4",{children:"Row missingness"}),a.jsx("div",{className:"canvas-preview__row-grid",children:j.map((b,S)=>{const E=k[S]??0,M=E%1===0?0:1;return a.jsxs("div",{className:"canvas-preview__row-chip",children:[a.jsxs("span",{children:["Row ",S+1]}),a.jsxs("strong",{children:[i(E,M),"%"]})]},`row-missing-${S}`)})})]}),h.length>0&&a.jsxs("div",{className:"canvas-preview__column-stats",children:[a.jsx("h4",{children:"Column summary"}),a.jsx("div",{className:"canvas-preview__column-grid",children:h.map(b=>a.jsxs("div",{className:"canvas-preview__column-card",children:[a.jsx("div",{className:"canvas-preview__column-name",children:b.name}),b.dtype&&a.jsxs("div",{className:"canvas-preview__column-detail",children:["Type: ",b.dtype]}),a.jsxs("div",{className:"canvas-preview__column-detail",children:["Missing: ",l(b.missing_percentage)," (",i(b.missing_count),")"]}),typeof b.mean=="number"&&!Number.isNaN(b.mean)&&a.jsxs("div",{className:"canvas-preview__column-detail",children:["Mean: ",u(b.mean)]}),typeof b.median=="number"&&!Number.isNaN(b.median)&&a.jsxs("div",{className:"canvas-preview__column-detail",children:["Median: ",u(b.median)]}),b.mode!==void 0&&b.mode!==null&&b.mode!==""&&a.jsxs("div",{className:"canvas-preview__column-detail",children:["Mode: ",d(b.mode)]}),typeof b.distinct_count=="number"&&a.jsxs("div",{className:"canvas-preview__column-detail",children:["Distinct values: ",i(b.distinct_count)]})]},b.name))})]}),p&&p.length>0&&a.jsxs("div",{className:"canvas-preview__full-execution-warnings",children:[a.jsx("strong",{children:"Full execution notes:"}),a.jsx("ul",{children:p.map((b,S)=>a.jsx("li",{children:b},`${b}-${S}`))})]})]})},DL=({previewState:e,datasetSourceId:t,canTriggerPreview:n,onRefresh:s,formatCellValue:r,formatMetricValue:i,formatMissingPercentage:l,formatNumericStat:u,formatModeStat:d,nodeId:f,onUpdateNodeData:p})=>{var D,V,te,G,K;const[m,h]=N.useState(()=>Mw()),[_,x]=N.useState(null),[y,v]=N.useState(!1),w=N.useRef("idle"),k=N.useCallback(X=>{if(!f||!p){w.current=kw(X);return}const Q=kw(X);Q!==w.current&&(w.current=Q,p(f,{backgroundExecutionStatus:Q}))},[f,p]),j=e.status==="loading",b=j||!n,S=N.useMemo(()=>{var Q;const X=(Q=e.data)==null?void 0:Q.columns;return Array.isArray(X)?X.filter(J=>typeof J=="string"):[]},[(D=e.data)==null?void 0:D.columns]),E=N.useMemo(()=>{var X;return Array.isArray((X=e.data)==null?void 0:X.sample_rows)?e.data.sample_rows.slice(0,Nc):[]},[(V=e.data)==null?void 0:V.sample_rows]),M=E.length,O=Array.isArray((te=e.data)==null?void 0:te.sample_rows)?e.data.sample_rows.length:0,$=(G=e.data)==null?void 0:G.metrics,P=N.useMemo(()=>$?O>M||typeof $.total_rows=="number"&&$.total_rows>O:!1,[$,M,O]);N.useEffect(()=>{var Q,J;if(e.status!=="success"||!e.data){h(Z=>Z.status==="idle"?Z:Mw()),x(null),k(null);return}const X=Ew((Q=e.data.signals)==null?void 0:Q.full_execution,i);x(X),k((J=e.data.signals)==null?void 0:J.full_execution),h({status:"ready",columns:[...S],rows:[...E],nextOffset:M,hasMore:P,totalRows:typeof($==null?void 0:$.total_rows)=="number"?$.total_rows:null,samplingAdjustments:[],largeDataset:!1,error:null})},[S,E,M,P,i,$==null?void 0:$.total_rows,k,e.data,e.status]),N.useEffect(()=>{var Z,ee;if(!_||!_.isActive)return;const X=(ee=(Z=e.data)==null?void 0:Z.signals)==null?void 0:ee.full_execution;if(!X||!X.job_id||!t)return;const Q=typeof X.poll_after_seconds=="number"&&X.poll_after_seconds>0?X.poll_after_seconds*1e3:5e3,J=setTimeout(()=>{Promise.resolve().then(()=>ML).then(de=>de.fetchFullExecutionStatus(t,X.job_id)).then(de=>{const _e=Ew(de,i);x(_e),k(de),e.data&&{...e.data,signals:{...e.data.signals}}}).catch(de=>{console.error("Failed to poll background job status:",de)})},Q);return()=>clearTimeout(J)},[_,t,i,k,e.data]);const A=m.columns.length>0?m.columns:S,R=m.rows.length>0?m.rows:E,F=m.totalRows??(typeof($==null?void 0:$.total_rows)=="number"?$.total_rows:null),z=m.status==="idle"?P:m.hasMore,I=m.status==="loading",U=R.length,q=N.useMemo(()=>{if(!U)return null;const X=i(U);if(F!==null&&F>=0){const Q=i(F),J=`Loaded ${X} of ${Q} rows.`;return z&&U<F?`${J} Load more rows to continue.`:!z&&U<F?`${J} Preview limited by backend settings.`:J}return z?`Loaded ${X} rows. Additional rows available.`:`Loaded ${X} rows.`},[z,i,U,F]),H=N.useMemo(()=>(m.status==="idle"?[]:m.samplingAdjustments).map(zL).map(Q=>Q.trim()).filter(Boolean),[m.samplingAdjustments,m.status]),W=m.status==="idle"?!1:m.largeDataset,B=N.useCallback(()=>{var Z;if(!t||!z||m.status==="loading")return;const X=m.rows.length>0?m.rows:E,Q=m.status==="idle"?X.length:m.nextOffset??X.length,J=Array.isArray((Z=e.data)==null?void 0:Z.sample_rows)?e.data.sample_rows:[];if(Q<J.length){const ee=J.slice(Q,Q+Nc),de=X.concat(ee),_e=Q+ee.length,ge=_e<J.length||typeof($==null?void 0:$.total_rows)=="number"&&$.total_rows>J.length;h({status:"ready",columns:m.columns.length>0?m.columns:S,rows:de,nextOffset:ge?_e:null,hasMore:ge,totalRows:typeof($==null?void 0:$.total_rows)=="number"?$.total_rows:null,samplingAdjustments:m.samplingAdjustments,largeDataset:m.largeDataset,error:null});return}h(ee=>({...ee,status:"loading",error:null})),pw(t,{offset:Q,limit:Nc}).then(ee=>{h(de=>{const _e=de.rows.length>0?de.rows:X,ge=Array.isArray(ee.columns)&&ee.columns.length>0?ee.columns.map(qe=>String(qe)):de.columns.length>0?de.columns:S,be=typeof ee.offset=="number"&&ee.offset>=0?ee.offset:0,ze=Array.isArray(ee.rows)?ee.rows:[],Ee=be<=_e.length?_e.slice(0,be):_e.slice(),ie=be<=_e.length?Ee.concat(ze):_e.concat(ze),pe=ze.length,Ce=!!ee.has_more,Te=typeof ee.next_offset=="number"?ee.next_offset:Ce?be+pe:null,De=typeof ee.total_rows=="number"?ee.total_rows:null,ce=Ce?null:ie.length,Oe=De!==null?De:de.totalRows!==null?de.totalRows:ce;return{status:"ready",columns:[...ge],rows:ie,nextOffset:Te,hasMore:Ce,totalRows:Oe,samplingAdjustments:Array.isArray(ee.sampling_adjustments)?ee.sampling_adjustments:[],largeDataset:!!ee.large_dataset,error:null}})}).catch(ee=>{h(de=>({...de,status:"error",error:(ee==null?void 0:ee.message)??"Unable to load additional rows."}))})},[S,E,t,z,m,(K=e.data)==null?void 0:K.sample_rows,$]);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsxs("div",{className:"canvas-modal__section-title",children:[a.jsx("h3",{children:"Dataset snapshot"}),_&&a.jsx("div",{className:`canvas-preview__full-execution-badge canvas-preview__full-execution--${_.tone}`,role:"status","aria-live":_.isActive?"polite":"off",title:_.details.length>0?_.details.join(" "):void 0,children:_.label})]}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:s,disabled:b,children:j?"Refreshing":"Refresh"})})]}),_&&a.jsxs("div",{className:"canvas-preview__full-execution-context",children:[_.details.length>0&&a.jsx("ul",{className:"canvas-preview__full-execution-details",children:_.details.map((X,Q)=>a.jsx("li",{children:X},`${X}-${Q}`))}),_.metadata.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",className:"canvas-preview__full-execution-toggle",onClick:()=>v(!y),"aria-expanded":y,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[y?a.jsx(Rh,{size:14}):a.jsx(Dh,{size:14}),y?"Hide":"Show"," job details"]}),y&&a.jsx("dl",{className:"canvas-preview__full-execution-meta",children:_.metadata.map((X,Q)=>a.jsxs("div",{className:"canvas-preview__full-execution-meta-item",children:[a.jsx("dt",{children:X.label}),a.jsx("dd",{children:X.value})]},`${X.label}-${X.value}-${Q}`))})]})]}),j&&a.jsx("p",{className:"canvas-modal__note",children:"Generating preview"}),e.status==="error"&&e.error&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:e.error}),e.status==="success"&&e.data&&a.jsx(RL,{preview:e.data,columns:A,rows:R,tableNote:q,formatCellValue:r,formatMetricValue:i,formatMissingPercentage:l,formatNumericStat:u,formatModeStat:d,fullExecutionStepLabel:(_==null?void 0:_.stepLabel)??null,fullExecutionWarnings:(_==null?void 0:_.warnings)??[]}),m.error&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:m.error}),W&&a.jsxs("p",{className:"canvas-modal__note",children:["Large dataset detected. Preview windows are capped at ",i(Nc)," rows to stay responsive."]}),H.length>0&&a.jsxs("div",{className:"canvas-modal__note",children:[a.jsx("strong",{children:"Sampling adjustments:"}),a.jsx("ul",{children:H.map((X,Q)=>a.jsx("li",{children:X},`${X}-${Q}`))})]}),z&&t&&a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:B,disabled:I,children:I?"Loading rows":`Load next ${i(Nc)} rows`})}),!z&&!j&&F!==null&&U>=F&&U>0&&a.jsx("p",{className:"canvas-modal__note",children:"All available rows have been loaded."})]})},el=[{value:"200",label:"200 rows"},{value:"500",label:"500 rows"},{value:"1000",label:"1,000 rows"},{value:"all",label:"Full dataset"}],IL=({node:e,isDatasetProfileNode:t,sourceId:n,hasReachableSource:s,graphContext:r,profilingGraphSignature:i,formatRelativeTime:l})=>{var U;const[u,d]=N.useState({status:"idle",data:null,error:null}),[f,p]=N.useState(0),[m,h]=N.useState({}),[_,x]=N.useState("500"),[y,v]=N.useState("summary"),[w,k]=N.useState(!1),j=N.useMemo(()=>!t||!n?null:`${n}::${(e==null?void 0:e.id)??""}::${_}::${i}`,[t,e==null?void 0:e.id,i,_,n]),b=N.useMemo(()=>j?m[j]??null:null,[m,j]);N.useEffect(()=>{x("500"),d({status:"idle",data:null,error:null})},[t,e==null?void 0:e.id]),N.useEffect(()=>{if(!t){d({status:"idle",data:null,error:null});return}if(!n){d({status:"error",data:null,error:"Select a dataset to generate a lightweight profile."});return}if(!s){d({status:"error",data:null,error:"Connect this step to an upstream output to generate a profile."});return}if(b){d({status:"success",data:b,error:null});return}let q=!0;d({status:"loading",data:null,error:null});const H=el.find(B=>B.value===_)??el[1]??el[0],W=H.value==="all"?"all":Number(H.value);return dw(n,{sampleSize:W,graph:r,targetNodeId:(e==null?void 0:e.id)??null}).then(B=>{q&&(j&&B&&h(D=>({...D,[j]:B})),d({status:"success",data:B??null,error:null}))}).catch(B=>{q&&d({status:"error",data:null,error:(B==null?void 0:B.message)??"Unable to generate dataset profile"})}),()=>{q=!1}},[b,r,s,t,e==null?void 0:e.id,f,j,_,n]);const S=u.data,E=(S==null?void 0:S.generated_at)??null,M=((U=S==null?void 0:S.correlations)==null?void 0:U.length)??0;N.useEffect(()=>{k(!1),v("summary")},[t,E]),N.useEffect(()=>{y==="correlations"&&M===0&&v("summary")},[y,M]);const O=N.useCallback(()=>{j&&h(q=>{if(!Object.prototype.hasOwnProperty.call(q,j))return q;const H={...q};return delete H[j],H}),p(q=>q+1)},[j]),$=N.useMemo(()=>e!=null&&e.id?`profiling-warnings-${e.id}`:"profiling-warnings",[e==null?void 0:e.id]),P=N.useMemo(()=>e!=null&&e.id?`profiling-summary-${e.id}`:"profiling-summary",[e==null?void 0:e.id]),A=N.useMemo(()=>e!=null&&e.id?`profiling-correlations-${e.id}`:"profiling-correlations",[e==null?void 0:e.id]),R=N.useMemo(()=>e!=null&&e.id?`profiling-summary-tab-${e.id}`:"profiling-summary-tab",[e==null?void 0:e.id]),F=N.useMemo(()=>e!=null&&e.id?`profiling-correlations-tab-${e.id}`:"profiling-correlations-tab",[e==null?void 0:e.id]),z=N.useMemo(()=>el.find(q=>q.value===_)??el[0],[_]),I=N.useMemo(()=>l((S==null?void 0:S.generated_at)??null),[l,S==null?void 0:S.generated_at]);return{profileState:u,profileData:S,profilingSamplePreset:_,setProfilingSamplePreset:x,profilingActiveTab:y,setProfilingActiveTab:v,isProfilingWarningsOpen:w,setIsProfilingWarningsOpen:k,handleRefreshDatasetProfile:O,activeProfilingSamplePreset:z,profilingWarningsListId:$,profilingSummaryPanelId:P,profilingCorrelationsPanelId:A,profilingSummaryTabId:R,profilingCorrelationsTabId:F,profilingCorrelationCount:M,relativeProfilingGeneratedAt:I}},FL=({isDatasetProfileNode:e,controller:t,formatCellValue:n,formatNumericStat:s,formatMissingPercentage:r})=>{if(!e)return null;const{profileState:i,profileData:l,profilingSamplePreset:u,setProfilingSamplePreset:d,profilingActiveTab:f,setProfilingActiveTab:p,isProfilingWarningsOpen:m,setIsProfilingWarningsOpen:h,handleRefreshDatasetProfile:_,activeProfilingSamplePreset:x,profilingWarningsListId:y,profilingSummaryPanelId:v,profilingCorrelationsPanelId:w,profilingSummaryTabId:k,profilingCorrelationsTabId:j,profilingCorrelationCount:b,relativeProfilingGeneratedAt:S}=t,E=i.status==="success"&&!!l;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Dataset profile"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsxs("div",{className:"canvas-sample__group",children:[a.jsx("span",{className:"canvas-sample__label",children:"Sample"}),a.jsx("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Profile sampling presets",children:el.map(M=>a.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":M.value===u,onClick:()=>d(M.value),disabled:i.status==="loading",children:M.label},M.value))})]}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:_,disabled:i.status==="loading",children:i.status==="loading"?"Refreshing":"Refresh"})]})]}),S&&a.jsxs("span",{className:"canvas-modal__meta",children:["Updated ",S]}),a.jsxs("p",{className:"canvas-modal__note",children:["Sampling preset: ",a.jsx("strong",{children:x.label}),"."]}),i.status==="loading"&&a.jsx("p",{className:"canvas-modal__note",children:"Generating dataset profile"}),i.status==="error"&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:i.error}),E&&l&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"canvas-profiling__meta",children:[a.jsxs("span",{children:["Rows analysed: ",l.rows_analyzed.toLocaleString()]}),a.jsxs("span",{children:["Columns: ",l.columns_analyzed.toLocaleString()]}),a.jsxs("span",{children:["Sample size: ",l.sample_size.toLocaleString()," rows"]}),a.jsxs("span",{children:["Missing cells: ",l.metrics.missing_cells.toLocaleString()]}),a.jsxs("span",{children:["Duplicate rows: ",l.metrics.duplicate_rows.toLocaleString()]})]}),a.jsxs("div",{className:"canvas-profiling__tabs",role:"tablist","aria-label":"Dataset profile views",children:[a.jsx("button",{type:"button",className:"canvas-profiling__tab",id:k,role:"tab","data-active":f==="summary","aria-selected":f==="summary","aria-controls":v,onClick:()=>p("summary"),children:"Summary"}),a.jsx("button",{type:"button",className:"canvas-profiling__tab",id:j,role:"tab","data-active":f==="correlations","aria-selected":f==="correlations","aria-controls":w,onClick:()=>p("correlations"),disabled:!b,children:"Correlations"})]}),f==="summary"&&a.jsxs("div",{className:"canvas-profiling__panel",id:v,role:"tabpanel","aria-labelledby":k,children:[l.warnings&&l.warnings.length>0?a.jsxs("div",{className:"canvas-profiling__warnings",children:[a.jsx("button",{type:"button",className:"canvas-profiling__warnings-toggle",onClick:()=>h(M=>!M),"aria-expanded":m,"aria-controls":y,children:m?"Hide warnings":`Show warnings (${l.warnings.length})`}),m&&a.jsx("ul",{className:"canvas-profiling__warnings-list",id:y,children:l.warnings.map((M,O)=>a.jsx("li",{children:M},`profiling-warning-${O}`))})]}):null,a.jsx("div",{className:"canvas-quick-profile__columns",children:l.columns.map(M=>{const O=M.numeric_summary,$=!!O,P=Array.isArray(M.top_values)?M.top_values:[],A=Array.isArray(M.sample_values)?M.sample_values:[];return a.jsxs("article",{className:"canvas-quick-profile__column","aria-label":`${M.name} summary`,children:[a.jsxs("header",{className:"canvas-quick-profile__column-header",children:[a.jsx("h4",{children:M.name}),a.jsx("span",{className:"canvas-quick-profile__dtype",children:M.semantic_type??M.dtype??"Unknown"})]}),a.jsxs("dl",{className:"canvas-quick-profile__stats",children:[a.jsxs("div",{children:[a.jsx("dt",{children:"Missing"}),a.jsx("dd",{children:`${r(M.missing_percentage)} (${M.missing_count.toLocaleString()})`})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Distinct"}),a.jsx("dd",{children:M.distinct_count!==null?M.distinct_count.toLocaleString():""})]})]}),$?a.jsxs("div",{className:"canvas-quick-profile__numeric",children:[a.jsx("h5",{children:"Distribution"}),a.jsxs("div",{className:"canvas-quick-profile__numeric-grid",children:[a.jsxs("span",{children:[a.jsx("strong",{children:"Mean"})," ",s(O==null?void 0:O.mean)]}),a.jsxs("span",{children:[a.jsx("strong",{children:"Std dev"})," ",s(O==null?void 0:O.std)]}),a.jsxs("span",{children:[a.jsx("strong",{children:"Min"})," ",s(O==null?void 0:O.minimum)]}),a.jsxs("span",{children:[a.jsx("strong",{children:"Max"})," ",s(O==null?void 0:O.maximum)]}),a.jsxs("span",{children:[a.jsx("strong",{children:"P25"})," ",s(O==null?void 0:O.percentile_25)]}),a.jsxs("span",{children:[a.jsx("strong",{children:"Median"})," ",s(O==null?void 0:O.percentile_50)]}),a.jsxs("span",{children:[a.jsx("strong",{children:"P75"})," ",s(O==null?void 0:O.percentile_75)]})]})]}):null,P.length>0?a.jsxs("div",{className:"canvas-quick-profile__top-values",children:[a.jsx("h5",{children:"Top values"}),a.jsx("ul",{children:P.map((R,F)=>a.jsxs("li",{children:[a.jsx("span",{className:"canvas-quick-profile__value",children:n(R.value)}),a.jsxs("span",{className:"canvas-quick-profile__count",children:[R.count.toLocaleString()," (",R.percentage.toFixed(1),"%)"]})]},`${M.name}-top-${F}`))})]}):null,A.length>0?a.jsxs("div",{className:"canvas-quick-profile__samples",children:[a.jsx("h5",{children:"Sample values"}),a.jsx("ul",{children:A.slice(0,5).map((R,F)=>a.jsx("li",{children:n(R)},`${M.name}-sample-${F}`))})]}):null]},M.name)})})]}),f==="correlations"&&a.jsx("div",{className:"canvas-profiling__panel",id:w,role:"tabpanel","aria-labelledby":j,children:a.jsxs("div",{className:"canvas-quick-profile__correlations",children:[a.jsx("h4",{children:"Top correlations"}),l.correlations&&l.correlations.length>0?a.jsxs("table",{className:"canvas-quick-profile__correlation-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column A"}),a.jsx("th",{scope:"col",children:"Column B"}),a.jsx("th",{scope:"col",children:"Coefficient"})]})}),a.jsx("tbody",{children:l.correlations.map((M,O)=>{const $=Math.abs(M.coefficient);let P="low";$>=.85?P="extreme":$>=.7?P="strong":$>=.55&&(P="moderate");const A=M.coefficient>=0?"positive":"negative";return a.jsxs("tr",{children:[a.jsx("td",{children:M.column_a}),a.jsx("td",{children:M.column_b}),a.jsx("td",{className:"canvas-quick-profile__correlation-coefficient","data-strength":P,"data-sign":A,children:M.coefficient.toFixed(2)})]},`profile-correlation-${O}`)})})]}):a.jsx("p",{className:"canvas-quick-profile__correlations-empty",children:"Not enough numeric columns to compute correlations yet."})]})})]})]})},BL=({title:e,isDataset:t,onClose:n,canResetNode:s=!1,onResetNode:r})=>a.jsxs("div",{className:"canvas-modal__header",children:[a.jsxs("div",{className:"canvas-modal__title-group",children:[a.jsx("span",{className:`canvas-modal__title-glyph${t?" canvas-modal__title-glyph--dataset":""}`,style:{display:"flex",alignItems:"center",justifyContent:"center"},children:t?a.jsx(j2,{size:24,strokeWidth:1.5}):a.jsx(A2,{size:24,strokeWidth:1.5})}),a.jsx("div",{children:a.jsx("h2",{className:"canvas-modal__title",id:"node-settings-title",children:e})})]}),a.jsxs("div",{className:"canvas-modal__header-actions",children:[s&&r&&a.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx(Ih,{size:16}),"Reset node"]}),a.jsx("button",{type:"button",className:"canvas-modal__close",onClick:n,"aria-label":"Close settings",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(qi,{size:24,strokeWidth:1.5})})]})]}),UL=({onClose:e,canResetNode:t,onResetNode:n,showSaveButton:s,canSave:r,onSave:i,isBusy:l,busyLabel:u,isSaving:d=!1})=>a.jsxs("div",{className:"canvas-modal__footer",children:[a.jsx("div",{className:"canvas-modal__footer-status",role:"status","aria-live":"polite","aria-busy":l,children:l&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"canvas-modal__footer-spinner","aria-hidden":"true"}),a.jsx("span",{children:u??"Processing"})]})}),a.jsxs("div",{className:"canvas-modal__footer-actions",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:e,children:"Close"}),t&&a.jsxs("button",{type:"button",className:"btn btn-outline-secondary canvas-modal__reset",onClick:n,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx(Ih,{size:16}),"Reset node"]}),s&&a.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>i({closeModal:!1}),disabled:!r||d,style:{display:"flex",alignItems:"center",gap:"0.5rem",minWidth:"180px",justifyContent:"center"},children:d?a.jsxs(a.Fragment,{children:[a.jsx(Gx,{size:16,className:"animate-spin"}),"Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Xx,{size:16}),"Save and run changes"]})})]})]}),Ws=(e,t=0)=>e==null?"":new Intl.NumberFormat(void 0,{maximumFractionDigits:t}).format(e),Zn=e=>{if(e==null)return"";const t=Number(e);if(Number.isNaN(t))return"";const n=t%1===0?0:1;return`${t.toFixed(n)}%`},Ms=e=>{if(e==null)return"";const t=Number(e);if(Number.isNaN(t))return"";const n=Math.abs(t)>=1?2:4;return Ws(t,n)},Aw=e=>e==null||e===""?"":typeof e=="number"?Ms(e):String(e),HL=e=>{if(!e)return null;const t=e.toLowerCase();return t==="critical"?"critical":t==="high"?"high":t==="medium"?"medium":null},qL=e=>{if(!e)return null;const t=e.toLowerCase();return t==="critical"?"Critical":t==="high"?"High":t==="medium"?"Medium":e.charAt(0).toUpperCase()+e.slice(1)},jr=({label:e,htmlFor:t,description:n,children:s,className:r=""})=>a.jsxs("div",{className:`canvas-modal__parameter-field ${r}`,children:[a.jsx("label",{htmlFor:t,className:"canvas-modal__parameter-label",children:e}),a.jsx("div",{className:"canvas-modal__parameter-control",children:s}),n&&a.jsx("p",{className:"canvas-modal__parameter-description",children:n})]}),pp=({className:e="",...t})=>a.jsx("input",{type:"text",className:`canvas-modal__input ${e}`,...t}),tl=({className:e="",...t})=>a.jsx("input",{type:"number",className:`canvas-modal__input ${e}`,...t}),Ld=({className:e="",options:t,children:n,...s})=>a.jsxs("select",{className:`canvas-modal__select ${e}`,...s,children:[t.map(r=>a.jsx("option",{value:r.value,children:r.label},r.value)),n]}),nl=({label:e,fieldLabel:t,description:n,className:s="",...r})=>a.jsxs("div",{className:`canvas-modal__parameter-field ${s}`,children:[t&&a.jsx("div",{className:"canvas-modal__parameter-label",children:a.jsx("label",{htmlFor:r.id,children:t})}),a.jsxs("label",{className:"canvas-modal__boolean-control",children:[a.jsx("input",{type:"checkbox",...r}),e]}),n&&a.jsx("p",{className:"canvas-modal__parameter-description",children:n})]}),VL=({className:e="",...t})=>a.jsx("input",{type:"range",className:`canvas-imputer__filter-range ${e}`,...t}),Ow=({className:e="",...t})=>a.jsx("textarea",{className:`canvas-modal__input ${e}`,...t}),zd=({isOpen:e,onToggle:t,label:n="Advanced settings",description:s})=>a.jsxs("div",{className:"canvas-modal__advanced-toggle",children:[a.jsxs("button",{type:"button",className:"canvas-modal__advanced-button",onClick:t,"aria-expanded":e,children:[e?a.jsx(Rh,{size:16}):a.jsx(Dh,{size:16}),a.jsx("span",{children:n})]}),s&&!e&&a.jsx("span",{className:"canvas-modal__advanced-description",children:s})]}),WL=5,YL=4,KL=3,GL="_binned",$w="Missing",XL=5,QL="ordinal",ZL="quantile",JL=[{value:"equal_width",label:"Equal-width",description:"Uniform bin widths based on min/max range."},{value:"equal_frequency",label:"Equal-frequency",description:"Quantile-based bins with similar row counts in each bucket."},{value:"custom",label:"Custom edges",description:"Provide explicit thresholds and optional labels per column."},{value:"kbins",label:"KBins (sklearn)",description:"Use sklearn KBinsDiscretizer with uniform, quantile, or k-means strategies."}],ez=[{value:"range",label:"Numeric interval (default)"},{value:"bin_index",label:"Index (bin_0, bin_1, )"},{value:"ordinal",label:"Ordinal (Bin 1, Bin 2, )"},{value:"column_suffix",label:"Column suffix (col_binned_1, )"}],gp={equal_width:"Equal-width",equal_frequency:"Equal-frequency",custom:"Custom edges",kbins:"KBins (sklearn)"},tz=[{value:"keep",label:"Leave as missing"},{value:"label",label:"Replace with label"}],jc=[{value:"500",label:"500 rows (default)"},{value:"10000",label:"10000 rows (detailed)"},{value:"all",label:"Full dataset"}],Tw=e=>{const t=typeof(e==null?void 0:e.strategy)=="string"?e.strategy.trim().toLowerCase():"",n=["equal_width","equal_frequency","custom","kbins"].includes(t)?t:"equal_width",s=Ge(e==null?void 0:e.columns),r=(I,U,q,H)=>{const W=Number(I);if(!Number.isFinite(W))return U;const B=Math.round(W);return Math.max(q,Math.min(H,B))},i=r(e==null?void 0:e.equal_width_bins,WL,2,200),l=r(e==null?void 0:e.equal_frequency_bins,YL,2,200),u=r(e==null?void 0:e.precision,KL,0,8),d=(e==null?void 0:e.duplicates)==="drop"?"drop":"raise",f=!!((e==null?void 0:e.include_lowest)??!0),p=!!((e==null?void 0:e.drop_original)??!1),h=(typeof(e==null?void 0:e.output_suffix)=="string"?e.output_suffix.trim():"")||GL,_=typeof(e==null?void 0:e.label_format)=="string"?e.label_format.trim().toLowerCase():"",x=["range","bin_index","ordinal","column_suffix"].includes(_)?_:"range",v=(typeof(e==null?void 0:e.missing_strategy)=="string"?e.missing_strategy.trim().toLowerCase():"")==="label"?"label":"keep",w=typeof(e==null?void 0:e.missing_label)=="string"?e.missing_label.trim():"",k=v==="label"&&w||$w,j=r(e==null?void 0:e.kbins_n_bins,XL,2,200),b=typeof(e==null?void 0:e.kbins_encode)=="string"?e.kbins_encode.trim().toLowerCase():"",S=["ordinal","onehot","onehot-dense"].includes(b)?b:QL,E=typeof(e==null?void 0:e.kbins_strategy)=="string"?e.kbins_strategy.trim().toLowerCase():"",M=["uniform","quantile","kmeans"].includes(E)?E:ZL,O=I=>{if(!Array.isArray(I))return[];const q=I.map(H=>{if(typeof H=="number")return H;if(H==null)return Number.NaN;const W=String(H).trim();return W?Number(W):Number.NaN}).filter(H=>Number.isFinite(H)).sort((H,W)=>H-W).filter((H,W,B)=>W===0||H!==B[W-1]);return q.length>=2?q:[]},$=I=>Array.isArray(I)?I.map(U=>String(U).trim()).filter(Boolean):typeof I=="string"?I.split(/[\,\n]/).map(U=>U.trim()).filter(Boolean):[],P=(I,U,q)=>{if(I==null)return null;const H=Number(I);if(!Number.isFinite(H))return null;const W=Math.round(H);return Math.max(U,Math.min(q,W))},A={};e!=null&&e.custom_bins&&typeof e.custom_bins=="object"&&!Array.isArray(e.custom_bins)&&Object.entries(e.custom_bins).forEach(([I,U])=>{const q=String(I??"").trim();if(!q)return;const H=O(U);H.length>=2&&(A[q]=H)});const R={};e!=null&&e.custom_labels&&typeof e.custom_labels=="object"&&!Array.isArray(e.custom_labels)&&Object.entries(e.custom_labels).forEach(([I,U])=>{const q=String(I??"").trim();if(!q)return;const H=$(U);H.length&&(R[q]=H)});const F={},z=e!=null&&e.column_strategies&&typeof e.column_strategies=="object"&&!Array.isArray(e.column_strategies)?e.column_strategies:e!=null&&e.column_overrides&&typeof e.column_overrides=="object"&&!Array.isArray(e.column_overrides)?e.column_overrides:null;return z&&Object.entries(z).forEach(([I,U])=>{const q=String(I??"").trim();if(!q||!U||typeof U!="object"||Array.isArray(U))return;const H=U,W={},B=typeof H.strategy=="string"?H.strategy.trim().toLowerCase():"";["equal_width","equal_frequency","custom","kbins"].includes(B)&&(W.strategy=B);const D=P(H.equal_width_bins,2,200);D!==null&&(W.equalWidthBins=D);const V=P(H.equal_frequency_bins,2,200);V!==null&&(W.equalFrequencyBins=V);const te=P(H.kbins_n_bins,2,200);te!==null&&(W.kbinsNBins=te);const G=typeof H.kbins_encode=="string"?H.kbins_encode.trim().toLowerCase():"";["ordinal","onehot","onehot-dense"].includes(G)&&(W.kbinsEncode=G);const K=typeof H.kbins_strategy=="string"?H.kbins_strategy.trim().toLowerCase():"";["uniform","quantile","kmeans"].includes(K)&&(W.kbinsStrategy=K);const X=O(H.custom_bins);X.length>=2&&(W.customBins=X);const Q=$(H.custom_labels);Q.length>0&&(W.customLabels=Q),Object.keys(W).length>0&&(F[q]=W)}),{strategy:n,columns:s,equalWidthBins:i,equalFrequencyBins:l,includeLowest:f,precision:u,duplicates:d,outputSuffix:h,dropOriginal:p,labelFormat:x,missingStrategy:v,missingLabel:k,customBins:A,customLabels:R,columnStrategies:F,kbinsNBins:j,kbinsEncode:S,kbinsStrategy:M}},nz=(e,t,n,s=gp)=>{if(!e.length)return null;const r=e.map(i=>{const l=t[i],u=(l==null?void 0:l.strategy)??null;if(!u)return i;const d=s[u]??u,f=[];u==="equal_width"&&(l!=null&&l.equalWidthBins)?f.push(`${l.equalWidthBins} bins`):u==="equal_frequency"&&(l!=null&&l.equalFrequencyBins)?f.push(`${l.equalFrequencyBins} bins`):u==="kbins"&&(l!=null&&l.kbinsNBins&&f.push(`${l.kbinsNBins} bins`),l!=null&&l.kbinsStrategy&&f.push(l.kbinsStrategy),l!=null&&l.kbinsEncode&&f.push(l.kbinsEncode));const p=f.length?` (${f.join(", ")})`:"";return`${i} -> ${d}${p}`});return n>e.length&&r.push(""),r.join(", ")},sz=({config:e,fieldIds:t,onIntegerChange:n,onBooleanToggle:s,onSuffixChange:r,onLabelFormatChange:i,onMissingStrategyChange:l,onMissingLabelChange:u})=>{const[d,f]=N.useState(!1);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx(zd,{isOpen:d,onToggle:()=>f(!d),label:"Advanced binning settings",description:"Configure output formatting, precision, and missing value handling"}),d&&a.jsxs("div",{style:{marginTop:"1rem"},children:[a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Global output & labeling"}),a.jsx("p",{className:"canvas-modal__note",children:"Applies to every selected column unless custom bins or labels override the defaults."}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[a.jsx(jr,{label:"Output suffix",htmlFor:t.suffix,children:a.jsx(pp,{id:t.suffix,value:e.outputSuffix,onChange:p=>r(p.target.value),placeholder:"e.g. _binned"})}),a.jsx(jr,{label:"Label format",htmlFor:t.labelFormat,description:"Controls how new bin values are named when custom labels arent provided.",children:a.jsx(Ld,{id:t.labelFormat,value:e.labelFormat,onChange:p=>i(p.target.value??"range"),options:ez})}),a.jsx(jr,{label:"Decimal precision",htmlFor:t.precision,description:"Sets rounding precision for interval labels.",children:a.jsx(tl,{id:t.precision,min:0,max:8,step:1,value:e.precision,onChange:p=>n("precision",p.target.value,0,8)})})]}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[a.jsx(nl,{id:t.includeLowest,label:"Include the minimum value in the first bin",checked:e.includeLowest,onChange:p=>s("include_lowest",p.target.checked)}),a.jsx(nl,{id:t.dropOriginal,label:"Remove source columns after binning",checked:e.dropOriginal,onChange:p=>s("drop_original",p.target.checked)})]})]}),a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Missing values"}),a.jsx("div",{className:"canvas-skewness__segmented",role:"radiogroup","aria-label":"Missing value handling",children:tz.map(p=>a.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":e.missingStrategy===p.value,onClick:()=>l(p.value),children:p.label},p.value))}),e.missingStrategy==="label"&&a.jsxs("div",{className:"canvas-modal__parameter-field",children:[a.jsx("label",{htmlFor:t.missingLabel,className:"canvas-modal__parameter-label",children:"Missing label"}),a.jsx("div",{className:"canvas-modal__parameter-control",children:a.jsx("input",{id:t.missingLabel,type:"text",className:"canvas-modal__input",value:e.missingLabel,onChange:p=>u(p.target.value),placeholder:"e.g. Missing"})})]})]})]})]})},Pw=e=>gp[e]??e.replace(/_/g," "),rz=e=>{switch(e){case"high":return"High confidence";case"medium":return"Medium confidence";case"low":return"Low confidence";default:return"Confidence unknown"}},az=(e,t,n)=>{if(!e||typeof e!="object")return"No distribution summary";const s=[];typeof e.valid_count=="number"&&Number.isFinite(e.valid_count)&&s.push(`${t(e.valid_count)} valid rows`),typeof e.distinct_count=="number"&&Number.isFinite(e.distinct_count)&&s.push(`${t(e.distinct_count)} distinct values`);const r=typeof e.minimum=="number"&&Number.isFinite(e.minimum),i=typeof e.maximum=="number"&&Number.isFinite(e.maximum);if(r||i){const l=r?n(e.minimum):"",u=i?n(e.maximum):"";s.push(`Range ${l}  ${u}`)}return typeof e.skewness=="number"&&Number.isFinite(e.skewness)&&s.push(`Skew ${n(e.skewness)}`),s.length?s.join("  "):"No distribution summary"},oz=({hasSource:e,hasReachableSource:t,isFetching:n,error:s,relativeGeneratedAt:r,sampleSize:i,binningConfig:l,binningDefaultLabel:u,binningOverrideCount:d,binningOverrideSummary:f,recommendations:p,excludedColumns:m,numericColumnCount:h,canApplyAllNumeric:_,onApplyAllNumeric:x,onApplyStrategies:y,onClearOverrides:v,customEdgeDrafts:w,customLabelDrafts:k,onOverrideStrategyChange:j,onOverrideNumberChange:b,onOverrideKbinsEncodeChange:S,onOverrideKbinsStrategyChange:E,onOverrideClear:M,onCustomBinsChange:O,onCustomLabelsChange:$,onClearCustomColumn:P,formatMetricValue:A,formatNumericStat:R})=>{const F=N.useMemo(()=>e?t?n?"Diagnostics are loading":s?"Diagnostics are unavailable at the moment.":h>0?`Detected ${h} numeric column${h===1?"":"s"} in the current sample.`:m.length>0?`Diagnostics skipped ${m.length} column${m.length===1?"":"s"} (see details).`:"No additional diagnostics were produced for the current sample.":"Connect this step to an upstream output to surface diagnostics.":"Select a dataset to surface diagnostics.",[s,m.length,t,e,n,h]),z=N.useMemo(()=>{const B=m.slice(0,6),D=Math.max(0,m.length-B.length);return{preview:B,remaining:D}},[m]),I=N.useMemo(()=>{const B=new Map;return p.forEach(D=>{const V=typeof(D==null?void 0:D.column)=="string"?D.column.trim():"";V&&B.set(V,D)}),B},[p]),U=N.useMemo(()=>{const B=new Set;return l.columns.forEach(D=>{const V=String(D??"").trim();V&&B.add(V)}),Object.keys(l.columnStrategies).forEach(D=>{const V=String(D??"").trim();V&&B.add(V)}),p.forEach(D=>{const V=typeof(D==null?void 0:D.column)=="string"?D.column.trim():"";V&&B.add(V)}),Array.from(B).sort((D,V)=>D.localeCompare(V))},[l.columnStrategies,l.columns,p]),q=(B,D)=>{var V;return!B||Object.keys(B).length===0?"__default__":B.strategy?B.strategy:(V=B.customBins)!=null&&V.length?"custom":B.kbinsNBins||B.kbinsEncode||B.kbinsStrategy?"kbins":B.equalFrequencyBins?"equal_frequency":B.equalWidthBins?"equal_width":D},H=e&&t,W=B=>{var V,te;if(!B)return[];const D=[];return typeof B.equalWidthBins=="number"&&D.push(`${B.equalWidthBins} bins`),typeof B.equalFrequencyBins=="number"&&D.push(`${B.equalFrequencyBins} bins`),typeof B.kbinsNBins=="number"&&D.push(`${B.kbinsNBins} bins`),B.kbinsStrategy&&D.push(B.kbinsStrategy),B.kbinsEncode&&D.push(B.kbinsEncode),(V=B.customBins)!=null&&V.length&&D.push("Custom bins"),(te=B.customLabels)!=null&&te.length&&D.push("Custom labels"),D};return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Binning diagnostics"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:v,disabled:!d,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx(cc,{size:14}),"Clear"]}),y&&a.jsx("button",{type:"button",className:"btn btn-primary",onClick:y,disabled:!p.length,children:"Quick apply"})]})]}),a.jsx("p",{className:"canvas-modal__note",children:F}),a.jsxs("p",{className:"canvas-modal__note",children:["Default strategy ",a.jsx("strong",{children:u}),d>0?`  Overrides: ${d}${f?` (${f})`:""}`:"  No column overrides yet"]}),a.jsxs("div",{className:"canvas-modal__collapsible",children:[!e&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface binning insights and column diagnostics."}),e&&!t&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric feature distributions."}),H&&a.jsxs(a.Fragment,{children:[r&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",r,i!==null?` on ${A(i)} row${i===1?"":"s"}.`:"."]}),x&&h>0&&a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:x,disabled:!_,children:`Add all numeric columns (${h})`})}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading binning diagnostics"}),s&&!n&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s}),!s&&a.jsxs(a.Fragment,{children:[U.length>0&&a.jsx("div",{className:"canvas-cast__body",children:a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Suggested strategy"}),a.jsx("th",{scope:"col",children:"Configured strategy"}),a.jsx("th",{scope:"col",children:"Distribution highlights"})]})}),a.jsx("tbody",{children:U.map(B=>{var at,et,ot,Nt,Tt;const D=I.get(B)??null,V=l.columnStrategies[B],te=q(V,l.strategy),G=te==="__default__"?l.strategy:te,K=(D==null?void 0:D.recommended_strategy)??null,X=!!(K&&K!==G),Q=!!(V&&Object.keys(V).length),J=l.columns.includes(B),Z=D==null?void 0:D.recommended_bins,ee=typeof Z=="number"?Z:Z!=null?Number(Z):null,de=typeof ee=="number"&&Number.isFinite(ee)&&ee>0?ee:null,_e=(V==null?void 0:V.equalWidthBins)??l.equalWidthBins,ge=(V==null?void 0:V.equalFrequencyBins)??l.equalFrequencyBins,be=(V==null?void 0:V.kbinsNBins)??l.kbinsNBins,ze=(V==null?void 0:V.kbinsEncode)??"__default__",Ee=(V==null?void 0:V.kbinsStrategy)??"__default__",ie=["canvas-cast__row"];X&&ie.push("canvas-cast__row--attention"),Q&&ie.push("canvas-cast__row--override"),J||ie.push("canvas-cast__row--muted");const pe=az(D==null?void 0:D.stats,A,R),Ce=((at=D==null?void 0:D.reasons)==null?void 0:at.filter(tt=>tt&&tt.trim()))??[],Te=(()=>{const tt=W(V),Ft=Array.isArray(l.customBins[B])?l.customBins[B].length>=2:!1,Wt=Array.isArray(l.customLabels[B])?l.customLabels[B].length>0:!1,Pt=[...tt];return Ft&&!Pt.includes("Custom bins")&&Pt.push("Custom bins"),Wt&&!Pt.includes("Custom labels")&&Pt.push("Custom labels"),Pt})(),De=te==="__default__"?`Inheriting ${u}`:`Override  ${Pw(G)}${Te.length?` (${Te.join(", ")})`:""}`,ce=(D==null?void 0:D.dtype)??null,Oe=D?rz(D.confidence):null,qe=Object.prototype.hasOwnProperty.call(w,B)?w[B]:((et=l.customBins[B])==null?void 0:et.join(", "))??"",Qe=Object.prototype.hasOwnProperty.call(k,B)?k[B]:((ot=l.customLabels[B])==null?void 0:ot.join(", "))??"",Ye=(((Nt=l.customBins[B])==null?void 0:Nt.length)??0)>=2||(((Tt=l.customLabels[B])==null?void 0:Tt.length)??0)>0;return a.jsxs("tr",{className:ie.join(" "),children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:B}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[ce&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",ce]}),!J&&a.jsx("span",{className:"canvas-cast__muted",children:"Not currently in node"}),Q&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),X&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--attention",children:"Needs review"})]})]})}),a.jsx("td",{children:a.jsx("div",{className:"canvas-cast__recommendation",children:D?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"canvas-cast__chip canvas-cast__chip--applied",children:Pw(D.recommended_strategy)}),a.jsxs("span",{className:"canvas-cast__recommendation-note",children:[de!==null?`${de} bin${de===1?"":"s"}`:"Bins not provided",Oe?`  ${Oe}`:""]}),Ce.length>0&&a.jsx("span",{className:"canvas-cast__recommendation-note",children:Ce.join("; ")})]}):a.jsx("span",{className:"canvas-cast__muted",children:"No recommendation"})})}),a.jsx("td",{children:a.jsxs("div",{className:"canvas-cast__target",children:[a.jsxs("select",{value:te,onChange:tt=>j(B,tt.target.value,{recommendedBins:de}),children:[a.jsxs("option",{value:"__default__",children:["Inherit default (",u,")"]}),JL.map(tt=>a.jsx("option",{value:tt.value,children:tt.label},`${B}-${tt.value}`))]}),a.jsx("span",{className:"canvas-cast__target-note",children:De}),te==="equal_width"&&a.jsx("div",{className:"canvas-cast__target-note",children:a.jsxs("label",{children:["Integer bins",a.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:_e??"",onChange:tt=>b(B,"equal_width_bins",tt.target.value)})]})}),te==="equal_frequency"&&a.jsx("div",{className:"canvas-cast__target-note",children:a.jsxs("label",{children:["Integer bins",a.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:ge??"",onChange:tt=>b(B,"equal_frequency_bins",tt.target.value)})]})}),te==="kbins"&&a.jsxs("div",{className:"canvas-cast__target-note",children:[a.jsxs("label",{children:["Max bins",a.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:be??"",onChange:tt=>b(B,"kbins_n_bins",tt.target.value)})]}),a.jsxs("label",{children:["Encode",a.jsxs("select",{value:ze,onChange:tt=>S(B,tt.target.value==="__default__"?null:tt.target.value),children:[a.jsxs("option",{value:"__default__",children:["Default (",l.kbinsEncode,")"]}),a.jsx("option",{value:"ordinal",children:"Ordinal"}),a.jsx("option",{value:"onehot",children:"One-hot (sparse)"}),a.jsx("option",{value:"onehot-dense",children:"One-hot (dense)"})]})]}),a.jsxs("label",{children:["Strategy",a.jsxs("select",{value:Ee,onChange:tt=>E(B,tt.target.value==="__default__"?null:tt.target.value),children:[a.jsxs("option",{value:"__default__",children:["Default (",l.kbinsStrategy,")"]}),a.jsx("option",{value:"uniform",children:"Uniform"}),a.jsx("option",{value:"quantile",children:"Quantile"}),a.jsx("option",{value:"kmeans",children:"K-means"})]})]})]}),te==="custom"&&a.jsxs("div",{className:"canvas-cast__target-note",children:[a.jsxs("label",{children:["Custom edges",a.jsx("input",{type:"text",className:"canvas-modal__input",value:qe,placeholder:"e.g. 0, 50, 100",onChange:tt=>O(B,tt.target.value)})]}),a.jsxs("label",{children:["Optional labels",a.jsx("input",{type:"text",className:"canvas-modal__input",value:Qe,placeholder:"e.g. Low, Medium, High",onChange:tt=>$(B,tt.target.value)})]}),Ye&&a.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>P(B),children:"Clear custom edges"})]}),Q&&a.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>M(B),children:"Clear"})]})}),a.jsx("td",{children:a.jsx("span",{children:pe})})]},`binning-insight-${B}`)})})]})})}),!n&&U.length===0&&a.jsx("p",{className:"canvas-modal__note",children:"No columns met the sampling requirements for binning recommendations."}),m.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",m.length," column",m.length===1?"":"s"," due to non-numeric values or limited variance",z.preview.length>0&&a.jsxs(a.Fragment,{children:[":"," ",z.preview.map(B=>`${B.column}${B.reason?` (${B.reason})`:""}`).join(", "),z.remaining>0?`,  (+${z.remaining} more)`:""]}),"."]})]})]})]})]})},iz=({cards:e,selectedPreset:t,onSelectPreset:n,isFetching:s,sampleSize:r,relativeGeneratedAt:i,error:l,onRefresh:u,canRefresh:d})=>{const f=N.useMemo(()=>jc.find(p=>p.value===t)??jc[0],[t]);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Binned column distributions"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsxs("div",{className:"canvas-sample__group",children:[a.jsx("span",{className:"canvas-sample__label",children:"Sample"}),a.jsx("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Binned sampling presets",children:jc.map(p=>a.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":p.value===t,onClick:()=>n(p.value),disabled:s,children:p.label},p.value))})]}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:u,disabled:s||!d,children:s?"Refreshing":"Refresh"})]})]}),r!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Sampling preset: ",a.jsx("strong",{children:f.label}),"."," ",f.value==="all"?`Summaries computed from the full dataset (${r.toLocaleString()} rows).`:`Summaries computed from ${r.toLocaleString()} sampled rows.`]}),i&&a.jsxs("p",{className:"canvas-modal__note",children:["Updated ",i]}),s&&a.jsx("p",{className:"canvas-modal__note",children:"Loading binned distributions"}),!s&&l&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:l}),!s&&!l&&(e.length?a.jsx("div",{className:"canvas-binning__grid",children:e.map(p=>{const m=p.topPercentage!==null?`${p.topPercentage.toFixed(1)}%`:null,h=p.topCount!==null?`${p.topCount.toLocaleString()}${m?`  ${m}`:""}`:m??"";return a.jsxs("article",{className:"canvas-binning__card",children:[a.jsxs("header",{className:"canvas-binning__header",children:[a.jsxs("div",{children:[a.jsx("h4",{children:p.column}),p.sourceColumn&&p.sourceColumn!==p.column&&a.jsxs("p",{className:"canvas-binning__subtitle",children:["Derived from ",a.jsx("strong",{children:p.sourceColumn})]})]}),a.jsxs("div",{className:"canvas-binning__summary","aria-label":"Top bin summary",children:[a.jsx("span",{className:"canvas-binning__summary-label",children:"Top bin"}),a.jsx("span",{className:"canvas-binning__summary-value",children:p.topLabel??""}),a.jsx("span",{className:"canvas-binning__summary-meta",children:h})]})]}),a.jsxs("div",{className:"canvas-binning__meta",children:[a.jsxs("div",{children:[a.jsx("span",{className:"canvas-binning__meta-label",children:"Sample size"}),a.jsx("span",{className:"canvas-binning__meta-value",children:p.totalRows.toLocaleString()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-binning__meta-label",children:"Distinct bins"}),a.jsx("span",{className:"canvas-binning__meta-value",children:p.distinctBins.toLocaleString()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-binning__meta-label",children:"Missing rows"}),a.jsx("span",{className:"canvas-binning__meta-value",children:p.missingRows.toLocaleString()})]})]}),a.jsx("div",{className:"canvas-binning__bins",children:p.bins.map(_=>{const x=_.isMissing?"canvas-binning__bin-label canvas-binning__bin-label--missing":"canvas-binning__bin-label",y=Math.min(100,Math.max(0,_.percentage));return a.jsxs("div",{className:"canvas-binning__bin-row",children:[a.jsx("div",{className:x,children:_.label}),a.jsx("div",{className:"canvas-binning__bin-bar","aria-hidden":"true",children:a.jsx("div",{className:"canvas-binning__bin-bar-fill",style:{width:`${y}%`}})}),a.jsxs("div",{className:"canvas-binning__bin-stats",children:[a.jsx("span",{children:_.count.toLocaleString()}),a.jsxs("span",{children:[_.percentage.toFixed(1),"%"]})]})]},`${p.column}-${_.label}`)})}),p.hasMoreBins&&a.jsxs("p",{className:"canvas-binning__note",children:["Showing top ",p.bins.length," of ",p.totalBinCount," bins."]})]},`binned-card-${p.column}`)})}):a.jsx("p",{className:"canvas-modal__note",children:"No binned columns detected upstream. Connect this node after a binning step to view category distributions."}))]})},lz=[{value:"mean",label:"Mean (numeric)"},{value:"median",label:"Median (numeric)"},{value:"mode",label:"Mode (most frequent)"}],cz=[{value:"knn",label:"K-Nearest Neighbors (KNN)"},{value:"regression",label:"Iterative regression"},{value:"mice",label:"MICE (multivariate)"}],uz=[...lz,...cz],dz=[0,5,10,20,40,60],mz=["float","double","int","uint","long","short","byte","number","decimal"],fz=["bool","boolean"],hz=["object","string","category","datetime","date","time"],pz=e=>{const t=typeof e.dtype=="string"?e.dtype.trim().toLowerCase():"";return typeof e.mean=="number"||typeof e.median=="number"||!t?!0:hz.some(n=>t.includes(n))?!1:!!(mz.some(n=>t.includes(n))||fz.some(n=>t.includes(n)))},Lw=e=>e!=="mode",zw=e=>{if(e==="knn")return{neighbors:5};if(e==="regression"||e==="mice")return{max_iter:10}},Cc=(e,t)=>{if(e==="knn"){const n=t==null?void 0:t.neighbors,s=Number(n);return{neighbors:Number.isFinite(s)?Math.max(1,Math.round(s)):5}}if(e==="regression"||e==="mice"){const n=t==null?void 0:t.max_iter,s=Number(n);return{max_iter:Number.isFinite(s)?Math.max(1,Math.round(s)):10}}},Rw=(e,t)=>{if(!Array.isArray(e))return[];const n=t[0]??"mean",s=new Set(t);return e.map(r=>{if(!r||typeof r!="object")return null;const i=typeof r.method=="string"?r.method.trim().toLowerCase():n,l=s.has(i)?i:n;let u=[];Array.isArray(r.columns)?u=r.columns.map(m=>String(m).trim()).filter(Boolean):typeof r.columns=="string"&&(u=r.columns.split(",").map(m=>m.trim()).filter(Boolean));const d=r.options&&typeof r.options=="object"?r.options:{};let f;if(l==="knn"){const m=d.neighbors??r.neighbors,h=Number(m);f={neighbors:Number.isFinite(h)?Math.max(1,Math.round(h)):5}}else if(l==="regression"||l==="mice"){const m=d.max_iter??d.maxIter??r.max_iter??r.maxIter,h=Number(m);f={max_iter:Number.isFinite(h)?Math.max(1,Math.round(h)):10}}const p=Cc(l,f??zw(l));return{method:l,columns:u,options:p}}).filter(r=>!!r)},gz=e=>e.map(t=>{const n={method:t.method,columns:t.columns};return t.options&&Object.keys(t.options).length&&(n.options={...t.options}),n}),_z=({hasSource:e,hasReachableSource:t,strategies:n,columnOptions:s,methodOptions:r,missingFilter:i,missingFilterMax:l,missingFilterActive:u,filteredOptionCount:d,collapsedStrategies:f,onToggleStrategy:p,onRemoveStrategy:m,onAddStrategy:h,onMethodChange:_,onOptionNumberChange:x,onColumnsChange:y,onColumnToggle:v,onMissingFilterChange:w,formatMissingPercentage:k,formatNumericStat:j,formatModeStat:b,schemaDiagnostics:S})=>{const E=ve.useMemo(()=>{var P;return(P=S==null?void 0:S.entries)!=null&&P.length?new Map(S.entries.map(A=>[A.index,A])):new Map},[S]),M=Math.max(l,i||0),O=s.length>0,$=P=>{var R,F,z;const A=((R=r.find(I=>I.value===P.method))==null?void 0:R.label)??P.method;return P.method==="knn"&&((F=P.options)!=null&&F.neighbors)?`${A}  k=${P.options.neighbors}`:(P.method==="regression"||P.method==="mice")&&((z=P.options)!=null&&z.max_iter)?`${A}  ${P.options.max_iter} iter`:A};return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Imputation strategies"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:h,children:"Add strategy"})})]}),!e&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface missingness insights and recommended columns."}),e&&!t&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to load missingness insights."}),(S==null?void 0:S.blocked)&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:S.message}),s.length>0&&a.jsxs("div",{className:"canvas-imputer__filter",role:"group","aria-label":"Filter columns by missing percentage",children:[a.jsxs("div",{className:"canvas-imputer__filter-top",children:[a.jsx("label",{htmlFor:"imputer-missing-filter",children:"Minimum missing percentage"}),a.jsxs("span",{className:"canvas-imputer__filter-summary",children:["Showing ",d," of ",s.length," column",s.length===1?"":"s"]})]}),a.jsxs("div",{className:"canvas-imputer__filter-controls",children:[a.jsx(VL,{id:"imputer-missing-filter",min:0,max:M,step:1,value:i,onChange:P=>w(Number(P.target.value))}),a.jsxs("span",{className:"canvas-imputer__filter-value",children:["",a.jsxs("strong",{children:[i,"%"]})," missing"]}),a.jsx("button",{type:"button",className:"canvas-imputer__filter-reset",onClick:()=>w(0),disabled:!i,children:"Clear"})]}),a.jsx("div",{className:"canvas-imputer__filter-presets",children:dz.map(P=>a.jsxs("button",{type:"button",className:`canvas-imputer__filter-button${i===P?" canvas-imputer__filter-button--active":""}`,onClick:()=>w(P),children:["",P,"%"]},`imputer-missing-preset-${P}`))})]}),n.length?a.jsx("div",{className:"canvas-imputer__list",children:n.map((P,A)=>{var V,te,G;const R=P.columns.join(", "),F=Lw(P.method),z=s.filter(K=>{if(P.columns.includes(K.name))return!0;if(F&&!pz(K))return!1;const X=typeof K.missingPercentage=="number"?K.missingPercentage:null;return X!==null?X<=0?!1:X>=i:i===0}),I=$(P),U=P.columns.length?`${P.columns.length} column${P.columns.length===1?"":"s"}`:"No columns yet",q=f.has(A),H=z.filter(K=>!P.columns.includes(K.name)),W=E.get(A),B=(V=W==null?void 0:W.details)!=null&&V.length?W.details.map(K=>K.logical_family?`${K.name} (${K.logical_family})`:K.name).join(", "):"",D=()=>{if(!z.length)return;const K=[...P.columns];z.forEach(X=>{K.includes(X.name)||K.push(X.name)}),y(A,K.join(", "))};return a.jsxs("div",{className:"canvas-imputer__card",children:[a.jsxs("div",{className:"canvas-imputer__card-header",children:[a.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>p(A),"aria-expanded":!q,"aria-controls":`imputer-strategy-body-${A}`,children:[a.jsx("span",{className:`canvas-imputer__toggle-icon${q?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),a.jsxs("span",{className:"canvas-imputer__card-text",children:[a.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",A+1]}),a.jsxs("span",{className:"canvas-imputer__card-summary",children:[I,"  ",U]})]})]}),a.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>m(A),"aria-label":`Remove strategy ${A+1}`,children:"Remove"})]}),!q&&a.jsxs("div",{className:"canvas-imputer__card-body",id:`imputer-strategy-body-${A}`,children:[a.jsx(jr,{label:"Method",children:a.jsx(Ld,{value:P.method,onChange:K=>_(A,K.target.value??"mean"),options:r})}),P.method==="knn"&&a.jsx(jr,{label:"Neighbors (k)",children:a.jsx(tl,{min:1,max:50,step:1,value:((te=P.options)==null?void 0:te.neighbors)??5,onChange:K=>x(A,"neighbors",K.target.value)})}),(P.method==="regression"||P.method==="mice")&&a.jsx(jr,{label:"Max iterations",children:a.jsx(tl,{min:1,max:100,step:1,value:((G=P.options)==null?void 0:G.max_iter)??10,onChange:K=>x(A,"max_iter",K.target.value)})}),P.method==="mice"&&a.jsx("p",{className:"canvas-modal__note",children:"MICE performs chained regressions with posterior sampling for robust imputations."}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{children:"Columns"}),B&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Remove or recast columns before applying this strategy: ",B,"."]}),z.length>0&&H.length>0&&a.jsx("button",{type:"button",className:"btn btn-link",onClick:D,children:"Select all columns"}),z.length?a.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Columns eligible for imputation",children:z.map(K=>{const X=P.columns.includes(K.name),Q=k(K.missingPercentage),J=typeof K.mean=="number",Z=typeof K.median=="number",ee=K.mode!==null&&K.mode!==void 0&&K.mode!=="",de=J||Z||ee;return a.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${X?" canvas-imputer__column-pill--selected":""}`,onClick:()=>v(A,K.name),"aria-pressed":X,children:[a.jsx("span",{className:"canvas-imputer__column-pill-name",children:K.name}),a.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[a.jsxs("span",{className:"canvas-imputer__column-pill-metric",children:["Missing: ",Q]}),K.dtype&&a.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:K.dtype})]}),de&&a.jsxs("div",{className:"canvas-imputer__column-pill-stats",children:[J&&a.jsxs("span",{children:["Mean: ",j(K.mean)]}),Z&&a.jsxs("span",{children:["Median: ",j(K.median)]}),ee&&a.jsxs("span",{children:["Mode: ",b(K.mode)]})]})]},K.name)})}):a.jsx("p",{className:"canvas-modal__note",children:O?u?"No columns meet the current missingness filter. Lower the threshold or add manual columns below.":"No columns with missing values detected. Add columns manually or adjust upstream steps.":"Column catalog unavailable; enter names manually below."})]}),a.jsx("div",{className:`canvas-imputer__selected${P.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:P.columns.length?P.columns.map(K=>a.jsx("span",{className:"canvas-imputer__selected-chip",children:K},K)):a.jsx("span",{children:"No columns selected yet."})}),a.jsx(jr,{label:"Manual columns (optional)",children:a.jsx(pp,{value:R,onChange:K=>y(A,K.target.value),placeholder:"Add custom columns, separated by commas","aria-label":"Manual column entry"})}),a.jsx("p",{className:"canvas-modal__note",children:"Tap columns above to toggle them. Missing % reflects the latest row-level preview, and manual entry lets you include custom fields."})]})]},`imputer-strategy-${A}`)})}):a.jsx("p",{className:"canvas-modal__note",children:"Define one or more strategies to fill missing values. Each strategy targets a set of columns and a method."})]})},yz=({sourceId:e,hasReachableSource:t,isFetchingScaling:n,scalingConfig:s,scalingMethodOptions:r,scalingMethodDetailMap:i,scalingDefaultDetail:l,scalingAutoDetectEnabled:u,scalingSelectedCount:d,scalingDefaultLabel:f,scalingOverrideCount:p,scalingOverrideExampleSummary:m,scalingRecommendationRows:h,scalingHasRecommendations:_,scalingStatusMessage:x,scalingError:y,scalingSampleSize:v,relativeScalingGeneratedAt:w,formatMetricValue:k,formatNumericStat:j,formatMissingPercentage:b,onApplyAllRecommendations:S,onClearOverrides:E,onDefaultMethodChange:M,onAutoDetectToggle:O,onOverrideSelect:$})=>{const P=l??i.get(s.defaultMethod)??null;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Scaling insights"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsx("button",{type:"button",className:"btn btn-primary",onClick:S,disabled:!_,children:"Apply recommendations"}),a.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:E,disabled:!p,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx(cc,{size:14}),"Clear overrides"]})]})]}),a.jsxs("p",{className:"canvas-modal__note",children:["Automatically select scaling strategies for numeric features to keep model inputs in comparable ranges. Edits here refresh the preview immediately so you can inspect the effect, but nothing is committed to your pipeline until you click ",a.jsx("strong",{children:"Save changes"})," at the bottom of this modal."]}),!e&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface scaling insights and column recommendations."}),e&&!t&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric feature distributions."}),w&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",w,v!==null?` on ${k(v)} row${v===1?"":"s"}.`:"."]}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[a.jsxs("div",{className:"canvas-modal__parameter-field",children:[a.jsx("div",{className:"canvas-modal__parameter-label",children:a.jsx("span",{children:"Default scaling method"})}),a.jsx("div",{className:"canvas-scaling__method-toggle",role:"group","aria-label":"Default scaling method",children:r.map(A=>{const R=i.get(A.value)??null,F=A.value===s.defaultMethod;return a.jsxs("button",{type:"button",className:`canvas-scaling__method-button${F?" canvas-scaling__method-button--active":""}`,"aria-pressed":F,onClick:()=>M(A.value),children:[a.jsx("span",{className:"canvas-scaling__method-label",children:A.label}),(R==null?void 0:R.description)&&a.jsx("span",{className:"canvas-scaling__method-description",children:R.description})]},A.value)})}),(P==null?void 0:P.description)&&a.jsx("p",{className:"canvas-modal__parameter-description",children:P.description})]}),a.jsx(nl,{fieldLabel:"Auto-detect numeric columns",label:u?"Enabled":"Disabled",checked:u,onChange:A=>O(A.target.checked),description:"When enabled, recommended numeric features join this node automatically after each refresh."})]}),a.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",a.jsx("strong",{children:d})," column",d===1?"":"s"," in this node  Default method"," ",a.jsx("strong",{children:f})," ",u?" Auto-detect on":" Auto-detect off",p>0?`  Overrides: ${p}${m?` (${m})`:""}`:"  No column overrides yet"]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading scaling diagnostics"}),!n&&y&&e&&t&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:y}),!n&&!y&&a.jsxs(a.Fragment,{children:[x&&a.jsx("p",{className:"canvas-modal__note",children:x}),h.length>0&&a.jsx("div",{className:"canvas-cast__body",children:a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table canvas-scaling__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Recommendation"}),a.jsx("th",{scope:"col",children:"Distribution"}),a.jsx("th",{scope:"col",children:"Configured method"})]})}),a.jsx("tbody",{children:h.map(A=>{const R=!A.isSkipped&&A.recommendedMethod!==A.currentMethod,F=["canvas-cast__row"];R&&F.push("canvas-cast__row--attention"),A.isOverrideApplied&&F.push("canvas-cast__row--override"),A.isSkipped&&F.push("canvas-cast__row--muted");const z=A.isSkipped?"__skip__":A.isOverrideApplied?A.currentMethod:"__default__",I=A.isOverrideApplied?`Override -> ${A.currentMethodLabel}`:A.isSkipped?"Skipped (column will not be scaled)":A.isSelected?`Inheriting ${f}`:"Pending inclusion",U=A.stats,q=[];typeof U.valid_count=="number"&&Number.isFinite(U.valid_count)&&q.push(`${k(U.valid_count)} valid rows`),typeof U.mean=="number"&&Number.isFinite(U.mean)&&q.push(`Mean ${j(U.mean)}`),typeof U.median=="number"&&Number.isFinite(U.median)&&q.push(`Median ${j(U.median)}`),typeof U.stddev=="number"&&Number.isFinite(U.stddev)&&q.push(` ${j(U.stddev)}`),typeof U.iqr=="number"&&Number.isFinite(U.iqr)&&q.push(`IQR ${j(U.iqr)}`);const H=typeof U.minimum=="number"&&Number.isFinite(U.minimum),W=typeof U.maximum=="number"&&Number.isFinite(U.maximum);if(H||W){const D=H?j(U.minimum):"",V=W?j(U.maximum):"";q.push(`Range ${D}  ${V}`)}typeof U.skewness=="number"&&Number.isFinite(U.skewness)&&q.push(`Skew ${j(U.skewness)}`),typeof U.outlier_ratio=="number"&&Number.isFinite(U.outlier_ratio)&&U.outlier_ratio>0&&q.push(`${b(U.outlier_ratio*100)} outliers`);const B=q.length?q.join("  "):null;return a.jsxs("tr",{className:F.join(" "),children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:A.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[A.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",A.dtype]}),A.isExcluded&&a.jsx("span",{className:"canvas-cast__muted",children:"Excluded from scaling (non-numeric)"}),A.isSelected&&!A.isExcluded&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),A.isSkipped&&!A.isExcluded&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--skipped",children:"Skipped"}),A.isOverrideApplied&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"})]})]})}),a.jsx("td",{children:a.jsxs("div",{className:"canvas-cast__recommendation",children:[a.jsx("span",{className:`canvas-cast__chip${R?" canvas-cast__chip--attention":" canvas-cast__chip--applied"}`,children:A.recommendedLabel}),a.jsx("span",{className:"canvas-cast__recommendation-note",children:A.confidenceLabel}),A.reasons.length>0&&a.jsx("span",{className:"canvas-cast__recommendation-note",children:A.reasons.join("; ")})]})}),a.jsx("td",{children:B?a.jsx("span",{children:B}):a.jsx("span",{className:"canvas-cast__muted",children:"No distribution summary"})}),a.jsx("td",{children:a.jsxs("div",{className:"canvas-cast__target",children:[a.jsxs("select",{value:z,onChange:D=>$(A.column,D.target.value),children:[a.jsxs("option",{value:"__default__",children:["Inherit default (",f,")"]}),a.jsx("option",{value:"__skip__",children:"Skip scaling for this column"}),r.map(D=>a.jsx("option",{value:D.value,children:D.label},`${A.column}-${D.value}`))]}),a.jsx("span",{className:"canvas-cast__target-note",children:I})]})})]},`scaling-row-${A.column}`)})})]})})})]})]})},Rd=["log","square_root","cube_root","reciprocal","square","exponential","box_cox","yeo_johnson"],vz="log",oa=e=>typeof e=="string"&&Rd.includes(e),Dw=e=>Array.isArray(e)?e.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"",s=typeof t.method=="string"?t.method.trim():"";if(!n)return null;const r=oa(s)?s:vz;return{column:n,method:r}}).filter(t=>!!t):[],_p=e=>{const t=new Set,n=[];return e.forEach(s=>{const r=`${s.column}__${s.method}`;t.has(r)||(t.add(r),n.push(s))}),n},Iw={left:"Left skew",right:"Right skew"},xz={log:"Logarithmic",square_root:"Square Root",cube_root:"Cube Root",reciprocal:"Reciprocal (Inverse)",square:"Square",exponential:"Exponential",box_cox:"BoxCox",yeo_johnson:"YeoJohnson"},bz=e=>{const t={...xz};return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():"",r=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";!s||!r||oa(s)&&(t[s]=r)}),t},wz=({viewMode:e,recommendations:t,columnOptions:n,recommendationMap:s,transformationMap:r})=>{const i=e==="recommended"?t.map(d=>d!=null&&d.column?d.column:null).filter(d=>!!d):n,l=new Set,u=[];return i.forEach(d=>{const f=typeof d=="string"?d.trim():"";if(!f||l.has(f))return;l.add(f);const p=s.get(f)??null,m=p?p.recommended_methods.filter(oa):[],h=m.length?m[0]:null,_=p!=null&&p.direction?Iw[p.direction]??p.direction:null,x=p!=null&&p.magnitude?`${p.magnitude.charAt(0).toUpperCase()}${p.magnitude.slice(1)}`:null,y=p&&typeof p.skewness=="number"&&Number.isFinite(p.skewness)?p.skewness:null,v=(p==null?void 0:p.summary)??null,w=r.get(f)??null;u.push({column:f,recommendedMethods:m,primaryMethod:h,directionLabel:_,magnitudeLabel:x,skewnessValue:y,summary:v,selectedMethod:w})}),u.sort((d,f)=>{const p=typeof d.skewnessValue=="number"?Math.abs(d.skewnessValue):-1/0,m=typeof f.skewnessValue=="number"?Math.abs(f.skewnessValue):-1/0;if(p!==m)return m-p;const h=!!d.primaryMethod,_=!!f.primaryMethod;return h!==_?h?-1:1:d.column.localeCompare(f.column)}),u},Nz=(e,t,n)=>{if(!t)return[{key:"all",label:null,method:null,rows:e}];const s="no-recommendation",r=new Map;e.forEach(l=>{const u=l.primaryMethod??null,d=u??s,f=u?n(u):"No recommended action",p=r.get(d)??{key:d,label:f,method:u,rows:[]};p.rows.push(l),r.set(d,p)});const i=Array.from(r.values());return i.sort((l,u)=>{const d=h=>h?Rd.indexOf(h):Rd.length,f=d(l.method)-d(u.method);if(f!==0)return f;if(l.rows.length!==u.rows.length)return u.rows.length-l.rows.length;const p=l.label??"",m=u.label??"";return p.localeCompare(m)}),i},jz=({sourceId:e,hasReachableSource:t,isFetchingSkewness:n,skewnessThreshold:s,skewnessError:r,skewnessViewMode:i,skewnessRecommendedCount:l,skewnessNumericCount:u,skewnessGroupByMethod:d,skewnessRows:f,skewnessTableGroups:p,hasSkewnessAutoRecommendations:m,skewnessTransformationsCount:h,isFetchingRecommendations:_,getSkewnessMethodLabel:x,getSkewnessMethodStatus:y,onApplyRecommendations:v,onViewModeChange:w,onGroupByToggle:k,onOverrideChange:j,onClearSelections:b})=>a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Skewness insights"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:v,disabled:_||!m,children:"Apply recommendations"})})]}),s!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns with |skewness|  ",s.toFixed(2)," are surfaced below."]}),n&&f.length===0&&a.jsx("p",{className:"canvas-modal__note",children:"Loading skewness diagnostics"}),!n&&r&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:r}),(!n||f.length>0)&&!r&&a.jsxs("div",{className:"canvas-skewness__body",children:[a.jsxs("div",{className:"canvas-skewness__toolbar",children:[a.jsxs("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Skewness view",children:[a.jsxs("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":i==="recommended",onClick:()=>w("recommended"),disabled:!l,children:["Recommended (",l,")"]}),a.jsxs("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":i==="all",onClick:()=>w("all"),disabled:!u,children:["All numeric (",u,")"]})]}),a.jsx(nl,{label:"Group columns by recommended action",checked:d,onChange:S=>k(S.target.checked),className:"canvas-skewness__toggle"})]}),f.length===0?a.jsx("p",{className:"canvas-modal__note",children:i==="recommended"?"No columns met the skewness threshold for recommendations. Switch to All numeric to configure overrides manually.":"No numeric columns available for skewness review."}):a.jsx("div",{className:"canvas-skewness__table-wrapper",children:p.map(S=>a.jsxs("div",{className:"canvas-skewness__group",children:[S.label&&a.jsxs("div",{className:"canvas-skewness__group-header",children:[a.jsx("h4",{children:S.label}),a.jsxs("span",{children:[S.rows.length," column",S.rows.length===1?"":"s"]})]}),a.jsx("div",{className:"canvas-skewness__table-scroll",children:a.jsxs("table",{className:"canvas-skewness__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Suggested transform"}),a.jsx("th",{scope:"col",children:"Skewness level"}),a.jsx("th",{scope:"col",children:"Override"})]})}),a.jsx("tbody",{children:S.rows.map(E=>{const M=[];E.directionLabel&&M.push(E.directionLabel),E.skewnessValue!==null&&M.push(`(${E.skewnessValue.toFixed(2)})`),E.magnitudeLabel&&M.push(` ${E.magnitudeLabel}`);const O=M.length?M.join(" "):"",$=E.selectedMethod??"",P=new Set(E.recommendedMethods),A=[{value:"",label:"No transform",status:null,reason:null}];E.recommendedMethods.forEach(z=>{const I=y(E.column,z);A.push({value:z,label:`${x(z)}${z===E.primaryMethod?" (recommended)":""}`,status:I,reason:(I==null?void 0:I.reason)??null})}),Rd.forEach(z=>{if(P.has(z))return;const I=y(E.column,z);A.push({value:z,label:x(z),status:I,reason:(I==null?void 0:I.reason)??null})});const R=E.selectedMethod?y(E.column,E.selectedMethod):null,F=!E.selectedMethod&&E.primaryMethod?y(E.column,E.primaryMethod):null;return a.jsxs("tr",{className:`canvas-skewness__row${E.selectedMethod?" canvas-skewness__row--active":""}`,children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-skewness__column-cell",children:[a.jsx("span",{className:"canvas-skewness__column-name",children:E.column}),E.summary&&a.jsx("span",{className:"canvas-skewness__column-summary",children:E.summary})]})}),a.jsx("td",{children:E.recommendedMethods.length?a.jsx("span",{className:`canvas-skewness__chip${E.primaryMethod?" canvas-skewness__chip--recommended":""}`,children:E.primaryMethod?x(E.primaryMethod):x(E.recommendedMethods[0])}):a.jsx("span",{className:"canvas-skewness__muted",children:"No recommendation"})}),a.jsx("td",{children:a.jsx("span",{className:"canvas-skewness__metric",children:O})}),a.jsx("td",{children:a.jsxs("div",{className:"canvas-skewness__override",children:[a.jsx(Ld,{value:$,onChange:z=>j(E.column,z.target.value),disabled:_||!t,options:[],children:A.map(z=>{var q;const I=z.reason?`${z.label} (caution: ${z.reason})`:z.label,U=((q=z.status)==null?void 0:q.status)??"ready";return a.jsx("option",{value:z.value,"data-status":U,children:I},`skewness-option-${E.column}-${z.value||"none"}`)})}),R&&R.status!=="ready"&&R.reason&&a.jsxs("span",{className:"canvas-skewness__status canvas-skewness__status--error",children:["Selected transform may be incompatible: ",R.reason]}),!E.selectedMethod&&F&&F.status!=="ready"&&F.reason&&a.jsxs("span",{className:"canvas-skewness__status",children:["Recommended transform flagged: ",F.reason]})]})})]},`skewness-row-${E.column}`)})})]})})]},`skewness-group-${S.key}`))}),a.jsxs("div",{className:"canvas-skewness__footer",children:[a.jsx("span",{children:h?`${h} transformation${h===1?"":"s"} configured`:"No transformations configured yet."}),h>0&&a.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:b,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx(cc,{size:14}),"Clear selections"]})]})]})]}),Cz=({counts:e,binEdges:t,className:n})=>{const s=N.useId(),r=n??"canvas-skewness__histogram";if(!e||e.length===0||!t||t.length!==e.length+1)return a.jsx("div",{className:r,"aria-hidden":"true"});const i=e.reduce((d,f)=>Math.max(d,f),0),l=i>0?i:1,u=100/e.length;return a.jsx("div",{className:r,role:"img","aria-label":"Histogram sparkline",style:{width:"100%",height:"100%",display:"flex"},children:a.jsxs("svg",{viewBox:"0 0 100 60",style:{width:"100%",height:"100%",overflow:"visible"},preserveAspectRatio:"none",children:[a.jsx("line",{x1:"0",y1:"58",x2:"100",y2:"58",stroke:"rgba(148, 163, 184, 0.35)",strokeWidth:"0.75"}),e.map((d,f)=>{const p=d/l*52,m=f*u,h=58-p,_=Math.max(u-2,1);return a.jsx("rect",{x:m+1,y:h,width:_,height:p,rx:1.2,ry:1.2,fill:`url(#${s})`},`hist-bin-${f}`)}),a.jsx("defs",{children:a.jsxs("linearGradient",{id:s,x1:"0",x2:"0",y1:"0",y2:"1",children:[a.jsx("stop",{offset:"0%",stopColor:"rgba(165, 180, 252, 0.95)"}),a.jsx("stop",{offset:"100%",stopColor:"rgba(129, 140, 248, 0.35)"})]})})]})})},Sz=({skewnessThreshold:e,isFetchingSkewness:t,skewnessError:n,skewnessDistributionCards:s,skewnessDistributionView:r,setSkewnessDistributionView:i,onRefresh:l,canRefresh:u})=>{const d=(f,p,m)=>{const h=Math.max(0,f.sample_size||0),_=Math.max(0,f.missing_count||0);return a.jsxs("div",{className:"canvas-skewness__distribution-block",children:[a.jsxs("div",{className:"canvas-skewness__distribution-block-title",children:[a.jsx("span",{children:p}),m?a.jsx("span",{className:"canvas-skewness__distribution-block-method",children:m}):null]}),a.jsx(Cz,{counts:f.counts,binEdges:f.bin_edges,className:"canvas-skewness__histogram"}),a.jsxs("div",{className:"canvas-skewness__distribution-stats",children:[a.jsxs("div",{children:[a.jsx("span",{className:"canvas-skewness__stat-label",children:"Min"}),a.jsx("span",{className:"canvas-skewness__stat-value",children:Ms(f.minimum)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-skewness__stat-label",children:"Median"}),a.jsx("span",{className:"canvas-skewness__stat-value",children:Ms(f.median)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-skewness__stat-label",children:"Max"}),a.jsx("span",{className:"canvas-skewness__stat-value",children:Ms(f.maximum)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-skewness__stat-label",children:"Mean"}),a.jsx("span",{className:"canvas-skewness__stat-value",children:Ms(f.mean)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-skewness__stat-label",children:"Std dev"}),a.jsx("span",{className:"canvas-skewness__stat-value",children:Ms(f.stddev)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-skewness__stat-label",children:"Valid"}),a.jsx("span",{className:"canvas-skewness__stat-value",children:h.toLocaleString()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"canvas-skewness__stat-label",children:"Missing"}),a.jsx("span",{className:"canvas-skewness__stat-value",children:_.toLocaleString()})]})]})]},p)};return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Skewness distributions"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsxs("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Distribution view",children:[a.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":r==="before",onClick:()=>i("before"),disabled:!s.length,children:"Before"}),a.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":r==="after",onClick:()=>i("after"),disabled:!s.length,children:"After"})]}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:l,disabled:t||!u,children:t?"Refreshing":"Refresh"})]})]}),e!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns with |skewness|  ",e.toFixed(2)," are visualized below."]}),t&&s.length===0&&a.jsx("p",{className:"canvas-modal__note",children:"Loading skewness distributions"}),!t&&n&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:n}),(!t||s.length>0)&&!n&&(s.length?a.jsx("div",{className:"canvas-skewness__distribution-grid",children:s.map(f=>{const p=f.distributionAfter,m=r==="before",h=r==="after"&&!!p,_=r==="after"&&!p,x=r==="before"?"Showing the original distribution returned by the skewness analysis.":p?"Showing the recomputed distribution after the applied transform.":"A transformed distribution is not available yet for this column.";return a.jsxs("article",{className:"canvas-skewness__distribution-card","aria-label":`Distribution for ${f.column}`,children:[a.jsxs("header",{className:"canvas-skewness__distribution-header",children:[a.jsxs("div",{children:[a.jsx("h4",{children:f.column}),a.jsxs("div",{className:"canvas-skewness__distribution-tags",children:[f.directionLabel&&a.jsx("span",{className:"canvas-skewness__chip canvas-skewness__chip--muted",children:f.directionLabel}),f.magnitudeLabel&&a.jsx("span",{className:"canvas-skewness__chip canvas-skewness__chip--muted",children:f.magnitudeLabel}),f.recommendedLabel&&a.jsxs("span",{className:"canvas-skewness__chip canvas-skewness__chip--recommended",children:["Suggested: ",f.recommendedLabel]}),f.appliedLabel&&a.jsxs("span",{className:"canvas-skewness__chip canvas-skewness__chip--applied",children:["Applied: ",f.appliedLabel]})]})]}),a.jsxs("div",{className:"canvas-skewness__distribution-skew",children:[a.jsx("span",{children:"Skewness"}),a.jsx("strong",{children:f.skewness!==null?Ws(f.skewness,2):""})]})]}),f.summary&&a.jsx("p",{className:"canvas-skewness__distribution-summary",children:f.summary}),a.jsxs("div",{className:"canvas-skewness__distribution-comparison",children:[m?d(f.distributionBefore,"Before transform"):null,h&&p?d(p,"After transform",f.appliedLabel):null,_?a.jsx("div",{className:"canvas-skewness__distribution-empty",children:"After transform data isnt available yet. Apply a skewness method and rerun the node to generate this view."}):null]}),a.jsxs("footer",{className:"canvas-skewness__distribution-footnote",children:["Histogram bins are based on the sampled rows returned by the skewness analysis. ",x]})]},`skewness-dist-${f.column}`)})}):a.jsx("p",{className:"canvas-modal__note",children:"No columns met the skewness threshold for visualization. Refresh with a larger sample if needed."}))]})},Ez=({suffix:e,insights:t,formatMissingPercentage:n})=>{const{rows:s,flaggedColumnsInDataset:r,conflictCount:i}=t,l=s.length>0,u=e||"(no suffix)",d=r.slice(0,4),f=Math.max(r.length-d.length,0);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Missing indicator summary"})}),a.jsxs("p",{className:"canvas-modal__note",children:["Generates ",a.jsx("strong",{children:s.length})," flag column",s.length===1?"":"s"," using suffix"," ",a.jsx("strong",{children:u}),"."]}),r.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Detected ",r.length," existing flag column",r.length===1?"":"s"," ","with this suffix",d.length>0?` (examples: ${d.join(", ")}${f>0?", ":""})`:"","."]}),i>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[i," generated flag column",i===1?" has":"s have"," naming conflicts. Adjust the suffix or remove conflicting columns."]}),l?a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Missing %"}),a.jsx("th",{scope:"col",children:"Flag column"}),a.jsx("th",{scope:"col",children:"Status"})]})}),a.jsx("tbody",{children:s.map(p=>{const m=[];p.conflicts.alreadyExists&&m.push("Already exists"),p.conflicts.duplicateFlag&&m.push("Duplicate name");const h=m.length>0,_=h?m.join("  "):"Ready",x=h?"canvas-cast__chip canvas-cast__chip--attention":"canvas-cast__chip canvas-cast__chip--applied",y=h?"canvas-cast__row canvas-cast__row--attention":"canvas-cast__row";return a.jsxs("tr",{className:y,children:[a.jsx("th",{scope:"row",children:p.column}),a.jsx("td",{children:n(p.missingPercentage)}),a.jsx("td",{children:p.flagColumn}),a.jsx("td",{children:a.jsx("span",{className:x,children:_})})]},`missing-indicator-${p.column}`)})})]})}):a.jsx("p",{className:"canvas-modal__note",children:"Select columns below to create missing-value flags."})]})},kz=({columnsParameter:e,suffixParameter:t,renderParameterField:n})=>!e&&!t?null:a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Missing indicator settings"})}),a.jsxs("div",{className:"canvas-modal__parameter-list",children:[e?n(e):null,t?n(t):null]})]}),Fw=["canonicalize_country_codes","normalize_boolean","punctuation","custom"],yp="canonicalize_country_codes",Mz=new Set(Fw),Az=["string","object","text","category","mixed","varchar","char"],Oz=4,$z=6,zo=4,Tz=3,Bw=36,Pz=5,vp={canonicalize_country_codes:{label:"Country aliases",guidance:'Maps abbreviations such as "UK" or "UAE" to canonical country names.',examples:["UK => United Kingdom","UAE => United Arab Emirates"]},normalize_boolean:{label:"Boolean tokens",guidance:"Standardizes yes/no style values so downstream logic sees consistent tokens.",examples:["y => Yes","0 => No"]},punctuation:{label:"Punctuation cleanup",guidance:"Strips punctuation and squeezes whitespace to simplify fuzzy matching.",examples:["C.R.M. => CRM","Part - Time => Part Time"]},custom:{label:"Custom mappings",guidance:"Applies the alias pairs you provide. Each entry should follow alias => replacement.",examples:["st => Street","rd => Road"]}},Uw=Fw.map(e=>{var t;return{value:e,label:((t=vp[e])==null?void 0:t.label)??e}}),Lz=new Set(["true","1","yes","y","on"]),zz=new Set(["false","0","no","n","off"]),Rz=(e,t)=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:t:t;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(Lz.has(n))return!0;if(zz.has(n))return!1}return t},xp=e=>Array.isArray(e)?Array.from(new Set(e.map(t=>typeof t=="string"?t.trim():String(t??"").trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?xp(e.split(",")):[],Hw=(e,t)=>{if(!e||typeof e!="object")return null;const n=e,s=xp(n.columns),r=Rz(n.auto_detect??n.autoDetect??n.auto,t.autoDetect),i=Id(typeof n.mode=="string"?n.mode:void 0,t.mode);return!s.length&&!r?null:{mode:i,columns:s,autoDetect:r}},qw=(e,t)=>{const n={mode:t.mode,columns:xp(t.columns),autoDetect:!!t.autoDetect};if(!e)return!n.columns.length&&!n.autoDetect&&(n.autoDetect=!0),[n];if(!Array.isArray(e)){const r=Hw(e,n);return r?[r]:[n]}const s=[];return e.forEach(r=>{const i=Hw(r,n);i&&s.push(i)}),s.length===0?(!n.columns.length&&!n.autoDetect&&(n.autoDetect=!0),[n]):s},Dz=e=>e.map(t=>({mode:t.mode,columns:[...t.columns],auto_detect:!!t.autoDetect})),Iz=e=>e.replace(/[\s\W_]+/g,"").toLowerCase(),Dd=e=>e.length<=Bw?e:`${e.slice(0,Bw-1)}...`,Vw=e=>Mz.has(e),Ww=e=>{if(!e)return!1;const t=e.toLowerCase();return Az.some(n=>t.includes(n))},Id=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Vw(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&Vw(s)?s:yp},Fz=e=>{const t=vp[e]??vp[yp];return{mode:e,label:t.label,guidance:t.guidance,examples:t.examples}},Bz=({selectedColumns:e,availableColumns:t,columnTypeMap:n,autoDetectEnabled:s})=>{const r=Array.from(new Set(Ge(e))),i=new Set(r),l=t.filter(p=>Ww(n[p]??null)),u=l.filter(p=>!i.has(p)),d=r.filter(p=>!Ww(n[p]??null)),f=typeof s=="boolean"?s:r.length===0;return{selectedColumns:r,nonTextSelected:d,autoDetectionActive:f,recommendedColumns:u,textColumnCount:l.length,textColumns:l}},Uz=/[\n;,]+/,sl=(e,t)=>e.slice(0,t),Fd=(e,t)=>{const n=e.split(t);if(n.length<2)return null;const[s,...r]=n,i=r.join(t);return[s,i]},Hz=e=>{if(!e)return{totalPairs:0,previewPairs:[],previewOverflow:0,duplicates:[],duplicateOverflow:0,invalidEntries:[],invalidOverflow:0};const t=new Set,n=[],s=[],r=new Map;let i=0;const l=(p,m)=>{const h=String(p??"").trim(),_=String(m??"").trim();if(!h||!_){(h||_)&&n.push(`${h} => ${_}`.trim());return}const x=Iz(h);if(!x){n.push(`${h} => ${_}`);return}r.has(x)?t.add(h):(r.set(x,_),s.length<Oz&&s.push(`${h} => ${_}`)),i+=1};if(typeof e=="string"){e.split(Uz).forEach(x=>{const y=x.trim();if(y){if(y.includes("=>")){const v=Fd(y,"=>");v?l(v[0],v[1]):n.push(y);return}if(y.includes(":")){const v=Fd(y,":");v?l(v[0],v[1]):n.push(y);return}n.push(y)}});const m=Array.from(t),h=sl(m,zo),_=sl(n,zo);return{totalPairs:i,previewPairs:s,previewOverflow:Math.max(i-s.length,0),duplicates:h,duplicateOverflow:Math.max(m.length-h.length,0),invalidEntries:_,invalidOverflow:Math.max(n.length-_.length,0)}}if(Array.isArray(e)){e.forEach(_=>{if(_){if(typeof _=="string"){const x=_.trim();if(!x)return;if(x.includes("=>")){const y=Fd(x,"=>");y?l(y[0],y[1]):n.push(x)}else if(x.includes(":")){const y=Fd(x,":");y?l(y[0],y[1]):n.push(x)}else n.push(x);return}if(typeof _=="object"){const{alias:x,replacement:y}=_;l(x,y);return}n.push(String(_))}});const p=Array.from(t),m=sl(p,zo),h=sl(n,zo);return{totalPairs:i,previewPairs:s,previewOverflow:Math.max(i-s.length,0),duplicates:m,duplicateOverflow:Math.max(p.length-m.length,0),invalidEntries:h,invalidOverflow:Math.max(n.length-h.length,0)}}typeof e=="object"&&Object.entries(e).forEach(([p,m])=>{l(p,m)});const u=Array.from(t),d=sl(u,zo),f=sl(n,zo);return{totalPairs:i,previewPairs:s,previewOverflow:Math.max(i-s.length,0),duplicates:d,duplicateOverflow:Math.max(u.length-d.length,0),invalidEntries:f,invalidOverflow:Math.max(n.length-f.length,0)}},qz=e=>{const t=e.slice(0,$z);return{preview:t,remaining:Math.max(e.length-t.length,0)}},Vz=e=>{const t=e.slice(0,zo);return{preview:t,remaining:Math.max(e.length-t.length,0)}},Wz=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?Dd(String(e)):null;if(typeof e=="boolean")return e?"True":"False";if(typeof e=="string"){const t=e.trim();return t?Dd(t):null}try{const t=JSON.stringify(e);return t?Dd(t):null}catch{return Dd(String(e))}},Yz=(e,t=Tz)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;const u=Wz(i);if(!u)return;const d=n[l]??[];d.includes(u)||d.length>=t||(n[l]=[...d,u])})}),n},Kz=(e,t,n=Pz)=>{if(!t.length)return[];const s=[];for(const r of t){if(s.length>=n)break;const i=e[r];!i||!i.length||s.push({column:r,values:i,overflow:0})}return s},bp=e=>e.replace(/[^0-9a-zA-Z]+/g,"").toLowerCase(),Yw=[["UK","United Kingdom"],["UAE","United Arab Emirates"],["USA","United States"],["PRC","China"],["KSA","Saudi Arabia"],["Brasil","Brazil"]],Kw=new Set(["us","usa","unitedstates","unitedstatesofamerica","uk","unitedkingdom","greatbritain","england","uae","unitedarabemirates","prc","china","southkorea","republicofkorea","ksa","saudiarabia","brasil","brazil","de","germany","fr","france","es","spain","ca","canada","mx","mexico","country","state","province"]);Yw.forEach(e=>{e.forEach(t=>Kw.add(bp(t)))});const Gw=[["Y","Yes"],["1","Yes"],["ON","Yes"],["N","No"],["0","No"],["OFF","No"]],Xw=new Set(["yes","y","true","t","1","on","enable","enabled","no","n","false","f","0","off","disable","disabled","active","inactive","flag"]);Gw.forEach(e=>{e.forEach(t=>Xw.add(bp(t)))});const Gz=[["C.R.M.","CRM"],["Part - Time","Part Time"],["end-to-end","end to end"]],Xz=/^[A-Za-z]{2,3}$/,Qz=/[^0-9A-Za-z\s]/,Zz=/[^0-9A-Za-z]+/,Bd={canonicalize_country_codes:{title:"Country alias map",description:"Common country abbreviations resolve to canonical names or ISO codes.",preview:Yw},normalize_boolean:{title:"Boolean token map",description:"Typical yes / no style values are standardized.",preview:Gw},punctuation:{title:"Punctuation cleanup",description:"Removes punctuation and condenses whitespace for easier matching.",preview:Gz},custom:{title:"Custom mappings",description:"Define your own alias => replacement pairs below."}},Jz=e=>{const t=[];return e.forEach(n=>{n.split(Zz).filter(Boolean).forEach(r=>{t.push(r)})}),t},eR=(e,t)=>{if(!t.length)return!1;if(e==="punctuation")return t.some(s=>Qz.test(s));const n=Jz(t).map(s=>bp(s));return n.length?e==="canonicalize_country_codes"?n.some(s=>Kw.has(s))||t.some(s=>Xz.test(s.trim())):e==="normalize_boolean"?n.some(s=>Xw.has(s)):!1:!1},Qw=e=>{if(!e.length)return null;const t=e.slice(0,3);return e.length-t.length>0?`${t.join(", ")} ...`:t.join(", ")},tR=({hasSource:e,hasReachableSource:t,strategies:n,columnSummary:s,columnOptions:r,sampleMap:i,modeOptions:l=Uw,customPairSummary:u,customPairsParameter:d,collapsedStrategies:f,onToggleStrategy:p,onRemoveStrategy:m,onAddStrategy:h,onModeChange:_,onAutoDetectToggle:x,onColumnToggle:y,onColumnsChange:v,renderParameterField:w})=>{const k=n.length>0,j=s.selectedColumns.length,b=N.useMemo(()=>qz(s.recommendedColumns),[s.recommendedColumns]),S=N.useMemo(()=>Vz(s.nonTextSelected),[s.nonTextSelected]),E=N.useMemo(()=>Kz(i,s.selectedColumns),[s.selectedColumns,i]),M=!e||!t,O=u.duplicates.length+u.duplicateOverflow,$=u.invalidEntries.length+u.invalidOverflow,P=u.duplicates.join(", "),A=u.invalidEntries.join(", "),R=N.useMemo(()=>n.some(G=>G.mode==="custom"),[n]),F=N.useMemo(()=>{const G=new Map;return n.forEach(K=>{K.columns.forEach(X=>{const Q=X.trim();Q&&G.set(Q,(G.get(Q)??0)+1)})}),G},[n]),[z,I]=N.useState(()=>new Set),U=N.useCallback(G=>{I(K=>{const X=new Set(K);return X.has(G)?X.delete(G):X.add(G),X})},[]);N.useEffect(()=>{I(G=>{const K=new Set;return G.forEach(X=>{X<n.length&&K.add(X)}),K.size===G.size?G:K})},[n.length]);const[q,H]=N.useState(()=>({index:null,mode:null})),W=N.useMemo(()=>{const G=new Map;return r.forEach(K=>{const X=Array.isArray(K.samples)?K.samples:[],Q=Array.isArray(i[K.name])?i[K.name]:[],J=[...X,...Q].map(Z=>String(Z??"").trim()).filter(Z=>Z.length>0);G.set(K.name,J.slice(0,12))}),G},[r,i]),B=N.useMemo(()=>{const G=new Map;return r.forEach(K=>{const X=W.get(K.name)??[],Q=X.length?X:[K.name];["canonicalize_country_codes","normalize_boolean","punctuation"].forEach(J=>{eR(J,Q)&&(G.has(J)||G.set(J,new Set),G.get(J).add(K.name))})}),G},[r,W]);N.useEffect(()=>{if(q.index===null)return;const G=n[q.index];(!G||G.mode!==q.mode)&&H({index:null,mode:null})},[q.index,q.mode,n]);const D=N.useCallback((G,K)=>{H({index:G,mode:K})},[]),V=N.useCallback(()=>{H({index:null,mode:null})},[]);let te=!1;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Alias cleanup strategies"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:h,children:"Add strategy"})})]}),s.autoDetectionActive?a.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is enabled; any remaining text-like columns will be swept into the strategies when this node runs."}):a.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",a.jsx("strong",{children:j})," column",j===1?"":"s"," across all strategies."]}),E.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",E.map(G=>`${G.column} (${G.values.join(", ")})`).join("; "),"."]}),s.textColumnCount>0&&b.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",b.preview.join(", "),b.remaining>0?`, ... (${b.remaining} more)`:"","."]}),S.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[S.preview.join(", ")," ",S.preview.length===1?"is":"are"," not text-like.",S.remaining>0?` ${S.remaining} more column${S.remaining===1?" is":"s are"} also non-text.`:" Remove them or double-check the data."]}),M?e?a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to inspect available columns."}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to load available columns for alias cleanup."}):null,!k&&a.jsx("p",{className:"canvas-modal__note",children:"No strategies configured yet. Combine presets (countries, booleans, punctuation) or add custom maps to standardize aliases."}),k&&a.jsx("div",{className:"canvas-imputer__list",children:n.map((G,K)=>{var De;const X=Fz(G.mode),Q=((De=l.find(ce=>ce.value===G.mode))==null?void 0:De.label)??X.label,J=G.columns.length,Z=J?`${J} column${J===1?"":"s"}`:G.autoDetect?"Auto-detecting columns":"No columns yet",ee=f.has(K),de=z.has(K),_e=G.columns.join(", "),ge=B.get(G.mode)??new Set,be=G.mode==="custom"&&!!d&&!te,ze=G.mode==="custom"&&!!d&&te;be&&(te=!0);const Ee=r.map(ce=>{const Oe=G.columns.includes(ce.name),qe=ge.has(ce.name),Qe=Oe?0:qe?1:ce.isRecommended?2:ce.isTextLike?3:4;return{option:ce,priority:Qe}}).sort((ce,Oe)=>ce.priority!==Oe.priority?ce.priority-Oe.priority:ce.option.name.localeCompare(Oe.option.name)).map(ce=>ce.option),ie=ge.size>0,pe=Ee.filter(ce=>G.columns.includes(ce.name)?!0:ie?ge.has(ce.name):ce.isRecommended||ce.isTextLike),Ce=new Set(pe.map(ce=>ce.name)),Te=Ee.filter(ce=>!Ce.has(ce.name));return a.jsxs("div",{className:"canvas-imputer__card",children:[a.jsxs("div",{className:"canvas-imputer__card-header",children:[a.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>p(K),"aria-expanded":!ee,"aria-controls":`alias-strategy-body-${K}`,children:[a.jsx("span",{className:`canvas-imputer__toggle-icon${ee?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),a.jsxs("span",{className:"canvas-imputer__card-text",children:[a.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",K+1]}),a.jsxs("span",{className:"canvas-imputer__card-summary",children:[Q,G.autoDetect?"  auto-detect":"",Z?`  ${Z}`:""]})]})]}),a.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>m(K),"aria-label":`Remove alias strategy ${K+1}`,children:"Remove"})]}),!ee&&a.jsxs("div",{className:"canvas-imputer__card-body",id:`alias-strategy-body-${K}`,children:[a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{children:"Replacement strategy"}),a.jsxs("div",{className:"canvas-imputer__mode-toggle",role:"radiogroup","aria-label":"Alias replacement strategy",children:[l.map(ce=>{const Oe=ce.value===G.mode;return a.jsx("button",{type:"button",className:`btn btn-outline-secondary canvas-imputer__mode-button${Oe?" canvas-imputer__mode-button--active active":""}`,role:"radio","aria-checked":Oe,onClick:()=>_(K,ce.value),children:ce.label},ce.value)}),a.jsx("button",{type:"button",className:"btn btn-link canvas-imputer__mode-info",onClick:()=>D(K,G.mode),children:"View examples"})]}),a.jsx("p",{className:"canvas-modal__meta",children:X.guidance})]}),q.index===K&&q.mode===G.mode&&a.jsxs("div",{className:"canvas-modal__note canvas-modal__note--info",children:[a.jsxs("div",{children:[a.jsx("strong",{children:Bd[G.mode].title}),a.jsx("button",{type:"button",className:"btn btn-link",onClick:V,children:"Close"})]}),a.jsx("p",{children:Bd[G.mode].description}),Bd[G.mode].preview&&a.jsx("ul",{children:Bd[G.mode].preview.map(([ce,Oe])=>a.jsxs("li",{children:[ce," ",a.jsx("span",{"aria-hidden":"true",children:"->"})," ",Oe]},`${ce}-${Oe}`))})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`alias-strategy-${K}-auto-detect`,children:"Detection"}),a.jsxs("div",{className:"canvas-modal__boolean-control",children:[a.jsx("input",{id:`alias-strategy-${K}-auto-detect`,type:"checkbox",checked:G.autoDetect,onChange:ce=>x(K,ce.target.checked)}),a.jsx("label",{htmlFor:`alias-strategy-${K}-auto-detect`,children:"Auto-detect additional text columns"})]}),a.jsx("p",{className:"canvas-modal__note",children:"Detected text-like columns not assigned elsewhere will be appended to this strategy."})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{children:"Columns"}),r.length?a.jsxs(a.Fragment,{children:[ge.size>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Highlighting columns that resemble ",Q.toLowerCase()," entries."]}),pe.length?a.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":`Columns assigned to alias strategy ${K+1}`,children:pe.map(ce=>{const Oe=G.columns.includes(ce.name),qe=Qw(ce.samples.length?ce.samples:i[ce.name]??[]),Ye=(F.get(ce.name)??0)-(Oe?1:0)>0,at=ge.has(ce.name);return a.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${Oe?" canvas-imputer__column-pill--selected":""}`,onClick:()=>y(K,ce.name),"aria-pressed":Oe,children:[a.jsx("span",{className:"canvas-imputer__column-pill-name",children:ce.name}),a.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[ce.dtype&&a.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:ce.dtype}),ce.isRecommended&&a.jsx("span",{className:"canvas-modal__meta",children:"Suggested"}),!ce.isTextLike&&a.jsx("span",{className:"canvas-modal__meta",children:"Non-text"}),at&&a.jsx("span",{className:"canvas-modal__meta",children:"Likely match"}),Ye&&a.jsx("span",{className:"canvas-modal__meta",children:"Used elsewhere"})]}),qe&&a.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",qe]})]},ce.name)})}):a.jsx("p",{className:"canvas-modal__note",children:"No detected or selected columns yet. Expand other columns below to assign manually."}),Te.length>0&&a.jsxs("div",{className:"canvas-imputer__more-columns",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>U(K),"aria-expanded":de,"aria-controls":`alias-strategy-${K}-other-columns`,children:de?"Hide other columns":`Show other columns (${Te.length})`}),de&&a.jsx("div",{id:`alias-strategy-${K}-other-columns`,className:"canvas-imputer__columns-list",role:"listbox","aria-label":`Other available columns for alias strategy ${K+1}`,children:Te.map(ce=>{const Oe=G.columns.includes(ce.name),qe=Qw(ce.samples.length?ce.samples:i[ce.name]??[]),Ye=(F.get(ce.name)??0)-(Oe?1:0)>0,at=ge.has(ce.name);return a.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${Oe?" canvas-imputer__column-pill--selected":""}`,onClick:()=>y(K,ce.name),"aria-pressed":Oe,children:[a.jsx("span",{className:"canvas-imputer__column-pill-name",children:ce.name}),a.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[ce.dtype&&a.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:ce.dtype}),!ce.isTextLike&&a.jsx("span",{className:"canvas-modal__meta",children:"Non-text"}),at&&a.jsx("span",{className:"canvas-modal__meta",children:"Likely match"}),Ye&&a.jsx("span",{className:"canvas-modal__meta",children:"Used elsewhere"})]}),qe&&a.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",qe]})]},ce.name)})})]})]}):a.jsx("p",{className:"canvas-modal__note",children:"No catalogued columns yet. Add column names manually below or enable auto-detect to populate this list."})]}),a.jsx("div",{className:`canvas-imputer__selected${G.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:G.columns.length?G.columns.map(ce=>a.jsx("span",{className:"canvas-imputer__selected-chip",children:ce},ce)):a.jsx("span",{children:"No manual columns selected yet."})}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`alias-strategy-${K}-manual-columns`,children:"Manual columns (optional)"}),a.jsx("input",{id:`alias-strategy-${K}-manual-columns`,type:"text",className:"canvas-imputer__columns-input",value:_e,onChange:ce=>v(K,ce.target.value),placeholder:"Add custom columns, separated by commas"})]}),a.jsx("p",{className:"canvas-modal__note",children:"Tap suggestions to toggle columns. Manual entries let you set custom fields that are not listed above."}),G.mode==="custom"&&d&&a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{children:"Custom pairs"}),a.jsx("p",{className:"canvas-modal__meta",children:"Enter one alias => replacement per line. These mappings apply to every custom strategy in this node."}),a.jsx("div",{className:"canvas-modal__parameter-list",children:be?w(d):ze?a.jsx("p",{className:"canvas-modal__note",children:"Edit the custom pairs above to update this strategy."}):null})]})]})]},`alias-strategy-${K}`)})}),u.totalPairs>0&&a.jsxs("p",{className:"canvas-modal__note",children:[u.totalPairs," custom pair",u.totalPairs===1?"":"s"," captured.",R?" They will be applied during execution.":" Switch a strategy to Custom mappings to apply them.",u.previewPairs.length>0?` Examples: ${u.previewPairs.join("; ")}${u.previewOverflow>0?"...":""}`:""]}),u.totalPairs===0&&R&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"At least one strategy is set to Custom mappings, but no valid alias pairs were detected."}),O>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Duplicate alias entries",P?`: ${P}`:"",u.duplicateOverflow>0?"...":"",". Only the first entry for each alias will be used."]}),$>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Ignored ",$," incomplete pair",$===1?"":"s",".",A?` Examples: ${A}${u.invalidOverflow>0?"...":""}`:""]})]})},Ud=["iso_date","iso_datetime","month_day_year","day_month_year"],nR="iso_date",sR=["date","time","timestamp","datetime"],rR=3,Zw=36,Sc={iso_date:{label:"ISO date",guidance:"Formats values as YYYY-MM-DD. Ideal for analytics layers expecting canonical dates.",example:"2024-03-19"},iso_datetime:{label:"ISO datetime",guidance:"Preserves date and time with second precision (YYYY-MM-DD HH:MM:SS).",example:"2024-03-19 14:05:42"},month_day_year:{label:"MM/DD/YYYY",guidance:"Aligns with US-style date formats. Use when downstream tooling expects month/day ordering.",example:"03/19/2024"},day_month_year:{label:"DD/MM/YYYY",guidance:"Suitable for EU-style day-first formats.",example:"19/03/2024"}},wp=Ud.map(e=>({value:e,label:Sc[e].label,guidance:Sc[e].guidance,example:Sc[e].example})),aR=[/^\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/,/^\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4}/,/^[A-Za-z]{3,9}\s+\d{1,2},\s*\d{2,4}/,/^\d{1,2}\s+[A-Za-z]{3,9}\s+\d{2,4}/,/^\d{4}\d{2}\d{2}$/],Jw=e=>e.length<=Zw?e:`${e.slice(0,Zw-1)}...`,eN=e=>{if(!e)return!1;const t=e.toLowerCase();return sR.some(n=>t.includes(n))},oR=e=>aR.some(t=>t.test(e)),tN=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Ud.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&Ud.includes(s)?s:nR},iR=e=>{const t=[];return Object.entries(e).forEach(([n,s])=>{if(!s||!s.length)return;const r=s.length;let i=0;if(s.forEach(u=>{oR(u)&&(i+=1)}),!r)return;i/r>=.6&&i>=2&&t.push(n)}),t.sort((n,s)=>n.localeCompare(s)),t},lR=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((h,_)=>h.localeCompare(_));const i=new Set(r),l=t.filter(h=>eN(n[h]??null)),u=iR(s),d=new Set;l.forEach(h=>{i.has(h)||d.add(h)}),u.forEach(h=>{i.has(h)||d.add(h)});const f=Array.from(d);f.sort((h,_)=>h.localeCompare(_));const p=r.filter(h=>!(eN(n[h]??null)||u.includes(h))),m=u.slice().sort((h,_)=>h.localeCompare(_));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:f,nonDateSelected:p,dateColumnCount:l.length,sampleCandidateCount:u.length,sampleCandidates:m}},cR=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";return n&&Ud.includes(n)?n:t},uR=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="true"||t==="1"||t==="yes")return!0;if(t==="false"||t==="0"||t==="no")return!1}return typeof e=="number"?e!==0:!1},nN=(e,t)=>{if(!Array.isArray(e))return t.columns.length||t.autoDetect?[{mode:t.mode,columns:[...t.columns],autoDetect:t.autoDetect}]:[];const n=new Set,s=e.map(r=>{if(!r||typeof r!="object")return null;const i=Ge(r.columns),l=Array.from(new Set(i.map(p=>p.trim()).filter(Boolean))).sort((p,m)=>p.localeCompare(m)),u=cR(r.mode,t.mode),d=uR(r.auto_detect??r.autoDetect??r.auto),f=`${u}|${l.join(",")}|${d?"auto":"manual"}`;return n.has(f)?null:(n.add(f),{mode:u,columns:l,autoDetect:d})}).filter(r=>!!r);return s.length?s:t.columns.length||t.autoDetect?[{mode:t.mode,columns:[...t.columns],autoDetect:t.autoDetect}]:[]},dR=e=>e.map(t=>{const n={mode:t.mode,columns:[...t.columns]};return t.autoDetect&&(n.auto_detect=!0),n}),mR=e=>{var t;return((t=Sc[e])==null?void 0:t.label)??Sc.iso_date.label},fR=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?Jw(String(e)):null;if(typeof e=="boolean")return e?"True":"False";const t=String(e).trim();return t?Jw(t):null},hR=(e,t=rR)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;const u=fR(i);if(!u)return;const d=n[l]??[];d.includes(u)||d.length>=t||(n[l]=[...d,u])})}),n},pR={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonDateSelected:[],dateColumnCount:0,sampleCandidateCount:0,sampleCandidates:[]},sN=e=>{if(!e.length)return null;const t=e.slice(0,3);return e.length-t.length>0?`${t.join(", ")} `:t.join(", ")},gR=({hasSource:e,hasReachableSource:t,strategies:n,columnSummary:s,columnOptions:r,sampleMap:i,collapsedStrategies:l,onToggleStrategy:u,onRemoveStrategy:d,onAddStrategy:f,onModeChange:p,onColumnToggle:m,onColumnsChange:h,onAutoDetectToggle:_,modeOptions:x=wp})=>{const y=n.length>0,v=N.useMemo(()=>n.some(O=>O.autoDetect),[n]),[w,k]=N.useState(()=>new Set),j=N.useCallback(O=>{k($=>{const P=new Set($);return P.has(O)?P.delete(O):P.add(O),P})},[]);N.useEffect(()=>{k(O=>{const $=new Set;return O.forEach(P=>{P<n.length&&$.add(P)}),$.size===O.size?O:$})},[n.length]);const b=N.useMemo(()=>{const O=new Map;return n.forEach($=>{$.columns.forEach(P=>{const A=P.trim();A&&O.set(A,(O.get(A)??0)+1)})}),O},[n]),S=N.useMemo(()=>{const O=s.recommendedColumns.slice(0,6),$=Math.max(s.recommendedColumns.length-O.length,0);return{preview:O,remaining:$}},[s.recommendedColumns]),E=N.useMemo(()=>{const O=s.nonDateSelected.slice(0,4),$=Math.max(s.nonDateSelected.length-O.length,0);return{preview:O,remaining:$}},[s.nonDateSelected]),M=!e||!t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Date formatting strategies"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:f,children:"Add strategy"})})]}),M&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:e?"Connect this step to an upstream output to explore detected date columns.":"Select a dataset to load column samples and suggestions."}),S.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Suggested columns: ",S.preview.join(", "),S.remaining>0?`,  (${S.remaining} more)`:"",".",v?" Auto-detect strategies will automatically include remaining date-like columns.":""]}),s.sampleCandidates.length===0&&!S.preview.length&&a.jsx("p",{className:"canvas-modal__note",children:"No clear date candidates yet. Add columns manually or enable auto-detect to sweep for timestamps."}),E.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[E.preview.join(", ")," ",E.preview.length===1?"looks":"look"," non-date-like.",E.remaining>0?` ${E.remaining} more selected column${E.remaining===1?"":"s"} may require double-checking.`:" Double-check that these values represent consistent dates."]}),v&&a.jsxs("p",{className:"canvas-modal__note",children:["Auto-detect gathers from ",s.sampleCandidateCount||s.dateColumnCount," date-like columns that are not already assigned."]}),y?a.jsx("div",{className:"canvas-imputer__list",children:n.map((O,$)=>{var V,te;const P=((V=x.find(G=>G.value===O.mode))==null?void 0:V.label)??mR(O.mode),A=O.columns.length,R=A?`${A} column${A===1?"":"s"}`:O.autoDetect?"Auto-detecting columns":"No columns yet",F=l.has($),z=O.columns.join(", "),I=`date-strategy-${$}-toggle`,U=`date-strategy-${$}-auto-detect`,q=r.map(G=>({option:G,priority:G.isRecommended?0:G.isSampleCandidate?1:2})).sort((G,K)=>G.priority!==K.priority?G.priority-K.priority:G.option.name.localeCompare(K.option.name)).map(G=>G.option),H=q.filter(G=>O.columns.includes(G.name)?!0:G.isRecommended||G.isSampleCandidate),W=new Set(H.map(G=>G.name)),B=q.filter(G=>!W.has(G.name)),D=w.has($);return a.jsxs("div",{className:"canvas-imputer__card",children:[a.jsxs("div",{className:"canvas-imputer__card-header",children:[a.jsxs("button",{type:"button",id:I,className:"canvas-imputer__card-toggle",onClick:()=>u($),"aria-expanded":!F,"aria-controls":`date-strategy-body-${$}`,children:[a.jsx("span",{className:`canvas-imputer__toggle-icon${F?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),a.jsxs("span",{className:"canvas-imputer__card-text",children:[a.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",$+1]}),a.jsxs("span",{className:"canvas-imputer__card-summary",children:[P,O.autoDetect?"  auto-detect":"",R?`  ${R}`:""]})]})]}),a.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>d($),"aria-label":`Remove date formatting strategy ${$+1}`,children:"Remove"})]}),!F&&a.jsxs("div",{className:"canvas-imputer__card-body",id:`date-strategy-body-${$}`,children:[a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`date-strategy-${$}-mode`,children:"Format"}),a.jsx("select",{id:`date-strategy-${$}-mode`,value:O.mode,onChange:G=>p($,G.target.value),children:x.map(G=>a.jsx("option",{value:G.value,children:G.label},G.value))}),a.jsxs("p",{className:"canvas-modal__meta",children:["Example: ",((te=x.find(G=>G.value===O.mode))==null?void 0:te.example)??"2024-01-23"]})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:U,children:"Detection"}),a.jsxs("div",{className:"canvas-modal__boolean-control",children:[a.jsx("input",{id:U,type:"checkbox",checked:O.autoDetect,onChange:G=>_($,G.target.checked)}),a.jsx("label",{htmlFor:U,children:"Auto-detect additional date columns"})]}),a.jsx("p",{className:"canvas-modal__note",children:"We will append detected date-like fields that are not assigned to other strategies."})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{children:"Columns"}),q.length?a.jsxs(a.Fragment,{children:[H.length?a.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Detected or selected columns for date formatting",children:H.map(G=>{const K=O.columns.includes(G.name),X=sN(G.samples.length?G.samples:i[G.name]??[]),J=(b.get(G.name)??0)-(K?1:0)>0;return a.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${K?" canvas-imputer__column-pill--selected":""}`,onClick:()=>m($,G.name),"aria-pressed":K,children:[a.jsx("span",{className:"canvas-imputer__column-pill-name",children:G.name}),a.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[G.dtype&&a.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:G.dtype}),G.isRecommended&&a.jsx("span",{className:"canvas-modal__meta",children:"Suggested"}),!G.isRecommended&&G.isSampleCandidate&&a.jsx("span",{className:"canvas-modal__meta",children:"Detected"}),J&&a.jsx("span",{className:"canvas-modal__meta",children:"Used in another strategy"})]}),X&&a.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",X]})]},G.name)})}):a.jsx("p",{className:"canvas-modal__note",children:"No detected or selected columns yet. Expand other columns below to assign manually."}),B.length>0&&a.jsxs("div",{className:"canvas-imputer__more-columns",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>j($),"aria-expanded":D,"aria-controls":`date-strategy-${$}-other-columns`,children:D?"Hide other columns":`Show other columns (${B.length})`}),D&&a.jsx("div",{id:`date-strategy-${$}-other-columns`,className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Other available columns for date formatting",children:B.map(G=>{const K=O.columns.includes(G.name),X=sN(G.samples.length?G.samples:i[G.name]??[]),J=(b.get(G.name)??0)-(K?1:0)>0;return a.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${K?" canvas-imputer__column-pill--selected":""}`,onClick:()=>m($,G.name),"aria-pressed":K,children:[a.jsx("span",{className:"canvas-imputer__column-pill-name",children:G.name}),a.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[G.dtype&&a.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:G.dtype}),J&&a.jsx("span",{className:"canvas-modal__meta",children:"Used in another strategy"})]}),X&&a.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",X]})]},G.name)})})]})]}):a.jsx("p",{className:"canvas-modal__note",children:"No catalogued columns yet. Add column names manually below or enable auto-detect to populate this list."})]}),a.jsx("div",{className:`canvas-imputer__selected${O.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:O.columns.length?O.columns.map(G=>a.jsx("span",{className:"canvas-imputer__selected-chip",children:G},G)):a.jsx("span",{children:"No manual columns selected yet."})}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`date-strategy-${$}-manual-columns`,children:"Manual columns (optional)"}),a.jsx("input",{id:`date-strategy-${$}-manual-columns`,type:"text",className:"canvas-imputer__columns-input",value:z,onChange:G=>h($,G.target.value),placeholder:"Add custom columns, separated by commas"})]}),a.jsx("p",{className:"canvas-modal__note",children:"Tap suggestions to toggle columns. Manual entries let you set custom fields that are not listed above."})]})]},`date-strategy-${$}`)})}):a.jsx("p",{className:"canvas-modal__note",children:"Add a strategy to standardize one or more columns. You can combine manual selection with auto-detect for any remaining date-like fields."})]})},rN=["both","leading","trailing"],aN="both",_R=["string","object","text","category","mixed","varchar","char"],yR=3,oN=36,iN=6,vR=4,xR=5,lN={both:{label:"Trim both sides",guidance:"Removes whitespace on the left and right side of values. Safe default for messy strings.",example:"' ACME '  'ACME'"},leading:{label:"Trim leading whitespace",guidance:"Strips whitespace at the beginning of values while preserving trailing spacing.",example:"' 123 Main'  '123 Main'"},trailing:{label:"Trim trailing whitespace",guidance:"Removes whitespace at the end of values while keeping leading spacing intact.",example:"'Suite B  '  'Suite B'"}},bR=e=>e.length<=oN?e:`${e.slice(0,oN-1)}...`,cN=e=>{if(!e)return!1;const t=e.toLowerCase();return _R.some(n=>t.includes(n))},wR=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${bR(t)}'`},NR=e=>e.length?!!(e.trim()!==e||e.includes("  ")||e.includes(`
`)||e.includes("	")||e.includes("\r")):!1,jR=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&rN.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&rN.includes(s)?s:aN},CR=e=>{const t=lN[e]??lN[aN];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},SR=e=>{const t=[];return Object.entries(e).forEach(([n,s])=>{if(!s.length)return;const r=s.reduce((l,u)=>u.hasIssue?l+1:l,0);if(!r)return;const i=r/s.length;(r>=2||i>=.5)&&t.push(n)}),t.sort((n,s)=>n.localeCompare(s)),t},ER=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((m,h)=>m.localeCompare(h));const i=new Set(r),l=t.filter(m=>cN(n[m]??null)),u=SR(s),d=new Set;l.forEach(m=>{i.has(m)||d.add(m)}),u.forEach(m=>{i.has(m)||d.add(m)});const f=Array.from(d).sort((m,h)=>m.localeCompare(h)),p=r.filter(m=>!cN(n[m]??null));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:f,nonTextSelected:p,textColumnCount:l.length,whitespaceCandidateCount:u.length,whitespaceCandidates:u}},Np=(e,t)=>e.slice(0,t),kR=e=>{const t=Np(e,iN);return{preview:t,remaining:Math.max(e.length-t.length,0)}},MR=e=>{const t=Np(e,vR);return{preview:t,remaining:Math.max(e.length-t.length,0)}},AR=e=>{const t=Np(e,iN);return{preview:t,remaining:Math.max(e.length-t.length,0)}},OR=(e,t=yR)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=NR(u),f=wR(u),p=n[l]??[];p.find(m=>m.value===f)||p.length>=t||(n[l]=[...p,{value:f,hasIssue:d}])})}),n},$R=(e,t,n=xR)=>{if(!t.length)return[];const s=[];for(const r of t){if(s.length>=n)break;const i=e[r];!i||!i.length||s.push({column:r,values:i.map(l=>l.value),overflow:0})}return s},TR={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,whitespaceCandidateCount:0,whitespaceCandidates:[]},PR=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,renderMultiSelectField:r,renderParameterField:i,columnSummary:l,modeDetails:u,sampleMap:d})=>{if(!n&&!s)return null;const f=l.selectedColumns.length,p=kR(l.recommendedColumns),m=MR(l.nonTextSelected),h=AR(l.whitespaceCandidates),_=$R(d,l.selectedColumns),x=!e||!t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Whitespace trimming"})}),a.jsxs("p",{className:"canvas-modal__note",children:[a.jsx("strong",{children:u.label})," mode. ",u.guidance," Example: ",u.example,"."]}),l.autoDetectionActive?a.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):a.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",a.jsx("strong",{children:f})," column",f===1?"":"s"," for trimming."]}),_.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",_.map(y=>`${y.column} (${y.values.join(", ")})`).join("; "),"."]}),h.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns with leading/trailing whitespace detected: ",h.preview.join(", "),h.remaining>0?`, ... (${h.remaining} more)`:"","."]}),p.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",p.preview.join(", "),p.remaining>0?`, ... (${p.remaining} more)`:"","."]}),m.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[m.preview.join(", ")," ",m.preview.length===1?"is":"are"," not text-like.",m.remaining>0?` ${m.remaining} more column${m.remaining===1?" is":"s are"} also non-text.`:" Consider removing them or confirming whitespace cleanup is intentional."]}),x?e?a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples for trimming opportunities."}):null,n&&a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Columns to trim"}),r(n)]}),s&&a.jsx("div",{className:"canvas-modal__parameter-list",children:i(s)})]})},uN=["keep_alphanumeric","keep_alphanumeric_space","letters_only","digits_only"],dN="keep_alphanumeric",LR=["string","object","text","category","mixed","varchar","char"],zR=3,mN=36,RR=6,DR=4,IR=5,fN={keep_alphanumeric:{label:"Letters & digits",guidance:"Removes punctuation and symbols, leaving only letters and numbers.",example:"ACME-Co.  ACMEC o"},keep_alphanumeric_space:{label:"Letters, digits & spaces",guidance:"Strips punctuation while preserving spaces for readability.",example:"ACME-Co.  ACME Co"},letters_only:{label:"Letters only",guidance:"Keeps alphabetic characters and removes digits, punctuation, and symbols.",example:"R2-D2  RD"},digits_only:{label:"Digits only",guidance:"Preserves numbers while removing letters, punctuation, and symbols.",example:"Order #123A  123"}},FR=e=>e.length<=mN?e:`${e.slice(0,mN-1)}...`,BR=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${FR(t)}'`},hN=e=>{if(!e)return!1;const t=e.toLowerCase();return LR.some(n=>t.includes(n))},UR=e=>/[^0-9A-Za-z\s]/.test(e),HR=e=>/[A-Za-z]/.test(e),qR=e=>/[0-9]/.test(e),VR=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&uN.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&uN.includes(s)?s:dN},WR=e=>{const t=fN[e]??fN[dN];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},YR=e=>{const t=new Set,n=new Set,s=new Set;Object.entries(e).forEach(([u,d])=>{if(!d.length)return;let f=0,p=0,m=0;d.forEach(h=>{h.hasSpecial&&(f+=1),h.hasDigits&&(p+=1),h.hasLetters&&(m+=1)}),f>0&&t.add(u),p>0&&m===0&&n.add(u),m>0&&p===0&&s.add(u)});const r=Array.from(t).sort((u,d)=>u.localeCompare(d)),i=Array.from(n).sort((u,d)=>u.localeCompare(d)),l=Array.from(s).sort((u,d)=>u.localeCompare(d));return{specialCandidates:r,digitsOnlyCandidates:i,lettersOnlyCandidates:l}},KR=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((_,x)=>_.localeCompare(x));const i=new Set(r),l=t.filter(_=>hN(n[_]??null)),{specialCandidates:u,digitsOnlyCandidates:d,lettersOnlyCandidates:f}=YR(s),p=new Set;l.forEach(_=>{i.has(_)||p.add(_)}),u.forEach(_=>{i.has(_)||p.add(_)});const m=Array.from(p).sort((_,x)=>_.localeCompare(x)),h=r.filter(_=>!hN(n[_]??null));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:m,nonTextSelected:h,textColumnCount:l.length,specialCandidateCount:u.length,specialCandidates:u,digitsOnlyCandidates:d,lettersOnlyCandidates:f}},pN=(e,t)=>e.slice(0,t),GR=e=>{const t=pN(e,RR);return{preview:t,remaining:Math.max(e.length-t.length,0)}},Hd=e=>{const t=pN(e,DR);return{preview:t,remaining:Math.max(e.length-t.length,0)}},XR=(e,t=zR)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=BR(u),f=UR(u),p={value:d,hasSpecial:f,hasDigits:qR(u),hasLetters:HR(u)},m=n[l]??[];m.find(h=>h.value===d)||m.length>=t||(n[l]=[...m,p])})}),n},QR=(e,t,n=IR)=>{if(!t.length)return[];const s=[];for(const r of t){if(s.length>=n)break;const i=e[r];!i||!i.length||s.push({column:r,values:i.map(l=>l.value),overflow:0})}return s},ZR={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,specialCandidateCount:0,specialCandidates:[],digitsOnlyCandidates:[],lettersOnlyCandidates:[]},JR=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,replacementParameter:r,renderMultiSelectField:i,renderParameterField:l,columnSummary:u,modeDetails:d,sampleMap:f})=>{if(!n&&!s&&!r)return null;const p=u.selectedColumns.length,m=GR(u.recommendedColumns),h=Hd(u.specialCandidates),_=Hd(u.digitsOnlyCandidates),x=Hd(u.lettersOnlyCandidates),y=Hd(u.nonTextSelected),v=QR(f,u.selectedColumns),w=!e||!t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Special character cleanup"})}),a.jsxs("p",{className:"canvas-modal__note",children:[a.jsx("strong",{children:d.label})," mode. ",d.guidance," Example: ",d.example,"."]}),u.autoDetectionActive?a.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):a.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",a.jsx("strong",{children:p})," column",p===1?"":"s"," for cleanup."]}),v.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",v.map(k=>`${k.column} (${k.values.join(", ")})`).join("; "),"."]}),h.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns containing punctuation or symbols: ",h.preview.join(", "),h.remaining>0?`, ... (${h.remaining} more)`:"","."]}),_.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Numeric-only samples detected in: ",_.preview.join(", "),_.remaining>0?`, ... (${_.remaining} more)`:"",". Consider `digits only` mode."]}),x.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Letter-only samples detected in: ",x.preview.join(", "),x.remaining>0?`, ... (${x.remaining} more)`:"",". Consider `letters only` mode."]}),m.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",m.preview.join(", "),m.remaining>0?`, ... (${m.remaining} more)`:"","."]}),y.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[y.preview.join(", ")," ",y.preview.length===1?"is":"are"," not text-like.",y.remaining>0?` ${y.remaining} more column${y.remaining===1?" is":"s are"} also non-text.`:" Double-check that symbol stripping is necessary for these fields."]}),w?e?a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before removing characters."}):null,n&&a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Columns to sanitize"}),i(n)]}),(s||r)&&a.jsxs("div",{className:"canvas-modal__parameter-list",children:[s?l(s):null,r?l(r):null]})]})},gN=["lower","upper","title","sentence"],_N="lower",eD=["string","object","text","category","mixed","varchar","char"],tD=3,yN=60,nD=6,sD=4,rD=5,vN={lower:{label:"Lowercase",guidance:"Converts values to lowercase for consistent comparisons.",example:"Acme Corp  acme corp"},upper:{label:"Uppercase",guidance:"Transforms text to uppercase, useful for codes or standard identifiers.",example:"Acme Corp  ACME CORP"},title:{label:"Title case",guidance:"Capitalizes the first letter of each word, ideal for names or titles.",example:"ACME CORP  Acme Corp"},sentence:{label:"Sentence case",guidance:"Capitalizes the first letter of each sentence while lowercasing the rest.",example:"ACME CORP. DELIVERS.  Acme corp. delivers."}},aD=e=>e.length<=yN?e:`${e.slice(0,yN-1)}...`,xN=e=>{if(!e)return!1;const t=e.toLowerCase();return eD.some(n=>t.includes(n))},Ec=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${aD(t)}'`},oD=e=>e.toLowerCase().split(/([\s\-_/]+)/).map(t=>!t.length||/[\s\-_/]+/.test(t)?t:t.charAt(0).toUpperCase()+t.slice(1)).join(""),iD=e=>e.toLowerCase().replace(/(^\s*[a-z])|([\.\!\?]\s*[a-z])/g,n=>n.toUpperCase()),lD=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&gN.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&gN.includes(s)?s:_N},cD=e=>{const t=vN[e]??vN[_N];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},uD=(e,t)=>{const n=[];return Object.entries(e).forEach(([s,r])=>{if(!r.length)return;r.some(l=>{const u=l[t];return l.original!==u})&&n.push(s)}),n.sort((s,r)=>s.localeCompare(r)),n},dD=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s,mode:r})=>{const i=Array.from(new Set(Ge(e)));i.sort((h,_)=>h.localeCompare(_));const l=new Set(i),u=t.filter(h=>xN(n[h]??null)),d=uD(s,r),f=new Set;u.forEach(h=>{l.has(h)||f.add(h)}),d.forEach(h=>{l.has(h)||f.add(h)});const p=Array.from(f).sort((h,_)=>h.localeCompare(_)),m=i.filter(h=>!xN(n[h]??null));return{selectedColumns:i,autoDetectionActive:i.length===0,recommendedColumns:p,nonTextSelected:m,textColumnCount:u.length,inconsistentColumns:d}},bN=(e,t)=>e.slice(0,t),mD=e=>{const t=bN(e,nD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},wN=e=>{const t=bN(e,sD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},fD=(e,t=tD)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=Ec(u),f={original:d,lower:Ec(u.toLowerCase()),upper:Ec(u.toUpperCase()),title:Ec(oD(u)),sentence:Ec(iD(u))},p=n[l]??[];p.find(m=>m.original===d)||p.length>=t||(n[l]=[...p,f])})}),n},hD=(e,t,n,s=rD)=>{if(!t.length)return[];const r=[];for(const i of t){if(r.length>=s)break;const l=e[i];if(!l||!l.length)continue;const u=l.map(d=>`${d.original}  ${d[n]}`);r.push({column:i,values:u,overflow:0})}return r},pD={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,inconsistentColumns:[]},gD=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,renderMultiSelectField:r,renderParameterField:i,columnSummary:l,modeDetails:u,sampleMap:d,selectedMode:f})=>{if(!n&&!s)return null;const p=l.selectedColumns.length,m=mD(l.recommendedColumns),h=wN(l.inconsistentColumns),_=wN(l.nonTextSelected),x=hD(d,l.selectedColumns,f),y=!e||!t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Text case normalization"})}),a.jsxs("p",{className:"canvas-modal__note",children:[a.jsx("strong",{children:u.label})," mode. ",u.guidance," Example: ",u.example,"."]}),l.autoDetectionActive?a.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):a.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",a.jsx("strong",{children:p})," column",p===1?"":"s"," for case normalization."]}),x.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",x.map(v=>`${v.column} (${v.values.join("; ")})`).join(" | "),"."]}),h.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns with mixed casing: ",h.preview.join(", "),h.remaining>0?`, ... (${h.remaining} more)`:"","."]}),m.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",m.preview.join(", "),m.remaining>0?`, ... (${m.remaining} more)`:"","."]}),_.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[_.preview.join(", ")," ",_.preview.length===1?"is":"are"," not text-like.",_.remaining>0?` ${_.remaining} more column${_.remaining===1?" is":"s are"} also non-text.`:" Confirm case normalization is necessary for these values."]}),y?e?a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before adjusting case."}):null,n&&a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Columns to normalize"}),r(n)]}),s&&a.jsx("div",{className:"canvas-modal__parameter-list",children:i(s)})]})},NN=["preset_digits_only","preset_letters_only","preset_whitespace_collapse","custom"],jN="preset_digits_only",_D=["string","object","text","category","mixed","varchar","char"],yD=3,CN=60,vD=6,xD=4,bD=5,SN={preset_digits_only:{label:"Digits only preset",guidance:"Keeps digits while stripping other characters. Useful for IDs or numeric codes.",example:"Order #123A  123"},preset_letters_only:{label:"Letters only preset",guidance:"Removes digits and symbols, retaining alphabetical characters.",example:"SKU-45X  SKUX"},preset_whitespace_collapse:{label:"Collapse whitespace preset",guidance:"Replaces runs of whitespace with a single space, trimming leading/trailing spacing.",example:`ACME	Corp
 ACME Corp`},custom:{label:"Custom regex",guidance:"Applies your regex and replacement text. Supports JavaScript-style regular expressions.",example:'Pattern: /d+/g Replacement: "#"'}},wD=e=>e.length<=CN?e:`${e.slice(0,CN-1)}...`,kc=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${wD(t)}'`},EN=e=>{if(!e)return!1;const t=e.toLowerCase();return _D.some(n=>t.includes(n))},ND=e=>e.replace(/\s+/g," ").trim(),jD=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&NN.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&NN.includes(s)?s:jN},CD=e=>{const t=SN[e]??SN[jN];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},SD=e=>{const t=new Set,n=new Set,s=new Set;Object.entries(e).forEach(([i,l])=>{l.length&&l.forEach(u=>{u.hasDigits&&t.add(i),u.hasLetters&&n.add(i),u.hasWhitespaceRuns&&s.add(i)})});const r=i=>Array.from(i).sort((l,u)=>l.localeCompare(u));return{digits:r(t),letters:r(n),whitespace:r(s)}},ED=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((_,x)=>_.localeCompare(x));const i=new Set(r),l=t.filter(_=>EN(n[_]??null)),{digits:u,letters:d,whitespace:f}=SD(s),p=new Set;l.forEach(_=>{i.has(_)||p.add(_)}),[...u,...d,...f].forEach(_=>{i.has(_)||p.add(_)});const m=Array.from(p).sort((_,x)=>_.localeCompare(x)),h=r.filter(_=>!EN(n[_]??null));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:m,nonTextSelected:h,textColumnCount:l.length,digitsCandidates:u,lettersCandidates:d,whitespaceCandidates:f}},kN=(e,t)=>e.slice(0,t),kD=e=>{const t=kN(e,vD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},qd=e=>{const t=kN(e,xD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},MD=(e,t=yD)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=kc(u),f={original:d,presetDigits:kc(u.replace(/\D+/g,"")),presetLetters:kc(u.replace(/[^A-Za-z]+/g,"")),presetWhitespace:kc(ND(u)),hasDigits:/\d/.test(u),hasLetters:/[A-Za-z]/.test(u),hasWhitespaceRuns:/\s{2,}/.test(u)||/\t|\n|\r/.test(u)},p=n[l]??[];p.find(m=>m.original===d)||p.length>=t||(n[l]=[...p,f])})}),n},AD=(e,t,n)=>{const s=n??"",r=i=>i.length?i:"''";switch(t){case"preset_letters_only":return`${r(e.original)}  ${r(e.presetLetters)}`;case"preset_whitespace_collapse":return`${r(e.original)}  ${r(e.presetWhitespace)}`;case"custom":try{const i=new RegExp(s.split("|||")[0]??"",s.split("|||")[1]??""),l=kc(e.original.replace(i,s.split("|||")[2]??""));return`${r(e.original)}  ${r(l)}`}catch{return`${r(e.original)}  (invalid regex)`}case"preset_digits_only":default:return`${r(e.original)}  ${r(e.presetDigits)}`}},OD=(e,t,n,s,r=bD)=>{if(!t.length)return[];const i=[];for(const l of t){if(i.length>=r)break;const u=e[l];if(!u||!u.length)continue;const d=u.map(f=>AD(f,n,s));i.push({column:l,values:d,overflow:0})}return i},$D={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,digitsCandidates:[],lettersCandidates:[],whitespaceCandidates:[]},TD=e=>{if(!e)return null;const t=e.split("|||"),n=t[0]??"",s=t[1]??"",r=t[2]??"";return!n.trim()&&!r.trim()?null:`Pattern: /${n||"(empty)"}/${s||"(none)"} Replacement: ${r||"''"}`},PD=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,patternParameter:r,replacementParameter:i,renderMultiSelectField:l,renderParameterField:u,columnSummary:d,modeDetails:f,sampleMap:p,selectedMode:m,replacementValue:h})=>{if(!n&&!s&&!r&&!i)return null;const _=d.selectedColumns.length,x=kD(d.recommendedColumns),y=qd(d.digitsCandidates),v=qd(d.lettersCandidates),w=qd(d.whitespaceCandidates),k=qd(d.nonTextSelected),j=TD(h),b=OD(p,d.selectedColumns,m,h),S=!e||!t,E=m==="custom";return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Regex cleanup"})}),a.jsxs("p",{className:"canvas-modal__note",children:[a.jsx("strong",{children:f.label})," mode. ",f.guidance," Example: ",f.example,"."]}),j&&a.jsx("p",{className:"canvas-modal__note",children:j}),d.autoDetectionActive?a.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):a.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",a.jsx("strong",{children:_})," column",_===1?"":"s"," for regex cleanup."]}),b.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",b.map(M=>`${M.column} (${M.values.join("; ")})`).join(" | "),"."]}),y.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns containing digits: ",y.preview.join(", "),y.remaining>0?`, ... (${y.remaining} more)`:"","."]}),v.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns containing letters: ",v.preview.join(", "),v.remaining>0?`, ... (${v.remaining} more)`:"","."]}),w.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns with repeated whitespace: ",w.preview.join(", "),w.remaining>0?`, ... (${w.remaining} more)`:"","."]}),x.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",x.preview.join(", "),x.remaining>0?`, ... (${x.remaining} more)`:"","."]}),k.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[k.preview.join(", ")," ",k.preview.length===1?"is":"are"," not text-like.",k.remaining>0?` ${k.remaining} more column${k.remaining===1?" is":"s are"} also non-text.`:" Confirm regex cleanup is appropriate for these values."]}),E&&!j&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Custom regex mode is enabled, but no pattern or replacement details were detected. Provide both to avoid no-ops."}),S?e?a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before applying regex transformations."}):null,n&&a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Columns to clean"}),l(n)]}),(s||r||i)&&a.jsxs("div",{className:"canvas-modal__parameter-list",children:[s?u(s):null,r?u(r):null,i?u(i):null]})]})},MN=["negative_to_nan","zero_to_nan","percentage_bounds","age_bounds","custom_range"],AN="negative_to_nan",LD=["int","float","double","numeric","number","decimal","real","long"],zD=3,RD=6,DD=4,ID=5,ON={negative_to_nan:{label:"Negative to missing",guidance:"Sets negative readings to missing. Useful for metrics that cannot drop below zero.",example:"Inventory change 3  missing"},zero_to_nan:{label:"Zero to missing",guidance:"Treats placeholder zeros as missing values.",example:"Temperature 0  missing"},percentage_bounds:{label:"Percentage bounds",guidance:"Keeps readings within 0-100% unless you provide custom bounds.",example:"Completion 135%  missing"},age_bounds:{label:"Age bounds",guidance:"Flags implausible ages outside a typical 0-120 range unless overridden.",example:"Customer age 212  missing"},custom_range:{label:"Custom bounds",guidance:"Applies your minimum/maximum limits to selected columns.",example:"Metric < 10 or > 75  missing"}},FD=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return t.length<=60?t:`${t.slice(0,59)}`},BD=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="boolean")return e?1:0;if(typeof e=="string"){const t=e.trim();if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null},UD=e=>{if(!e)return!1;const t=e.toLowerCase();return LD.some(n=>t.includes(n))},HD=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&MN.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&MN.includes(s)?s:AN},qD=e=>{const t=ON[e]??ON[AN];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},VD=e=>{const t=new Set,n=new Set,s=new Set,r=new Set;Object.entries(e).forEach(([l,u])=>{u.forEach(d=>{d.isNegative&&t.add(l),d.isZero&&n.add(l),(d.numericValue<0||d.numericValue>100)&&s.add(l),(d.numericValue<0||d.numericValue>120)&&r.add(l)})});const i=l=>Array.from(l).sort((u,d)=>u.localeCompare(d));return{negative:i(t),zeros:i(n),percentage:i(s),age:i(r)}},WD=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e))).sort((x,y)=>x.localeCompare(y)),i=new Set(r),l=t.filter(x=>UD(n[x]??null)),u=new Set(l),{negative:d,zeros:f,percentage:p,age:m}=VD(s),h=new Set;l.forEach(x=>{i.has(x)||h.add(x)}),[...d,...f,...p,...m].forEach(x=>{i.has(x)||h.add(x)});const _=r.filter(x=>!u.has(x));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:Array.from(h).sort((x,y)=>x.localeCompare(y)),nonNumericSelected:_,numericColumnCount:l.length,negativeCandidates:d,zeroCandidates:f,percentageOutliers:p,ageOutliers:m}},YD=e=>{const t=e.slice(0,RD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},Mc=e=>{const t=e.slice(0,DD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},KD=(e,t=zD)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;const u=BD(i);if(u===null)return;const d=FD(String(i)),f={originalDisplay:d,numericValue:u,isNegative:u<0,isZero:Math.abs(u)<=1e-9},p=n[l]??[];p.find(m=>m.originalDisplay===d)||p.length>=t||(n[l]=[...p,f])})}),n},GD=0,XD=100,QD=0,ZD=120,JD=(e,t,n,s)=>{switch(t){case"negative_to_nan":{const r=n??0;return e.numericValue<r?{flagged:!0,reason:`value < ${r}`}:s!==null&&e.numericValue>s?{flagged:!0,reason:`value > ${s}`}:{flagged:!1,reason:null}}case"zero_to_nan":return{flagged:e.isZero,reason:e.isZero?"zero placeholder":null};case"percentage_bounds":{const r=n??GD,i=s??XD;return e.numericValue<r?{flagged:!0,reason:`value < ${r}`}:e.numericValue>i?{flagged:!0,reason:`value > ${i}`}:{flagged:!1,reason:null}}case"age_bounds":{const r=n??QD,i=s??ZD;return e.numericValue<r?{flagged:!0,reason:`value < ${r}`}:e.numericValue>i?{flagged:!0,reason:`value > ${i}`}:{flagged:!1,reason:null}}case"custom_range":default:{const r=n!=null,i=s!=null;return!r&&!i?{flagged:!1,reason:null}:r&&e.numericValue<n?{flagged:!0,reason:`value < ${n}`}:i&&e.numericValue>s?{flagged:!0,reason:`value > ${s}`}:{flagged:!1,reason:null}}}},eI=(e,t,n,s)=>{const{flagged:r,reason:i}=JD(e,t,n,s);return r?`${e.originalDisplay}  flagged (${i??"rule match"})`:`${e.originalDisplay}  ok`},tI=(e,t,n,s,r,i=ID)=>{if(!t.length)return[];const l=[];for(const u of t){if(l.length>=i)break;const d=e[u];!d||!d.length||l.push({column:u,values:d.map(f=>eI(f,n,s,r)),overflow:0})}return l},nI={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonNumericSelected:[],numericColumnCount:0,negativeCandidates:[],zeroCandidates:[],percentageOutliers:[],ageOutliers:[]},sI=(e,t,n)=>{if(e==="custom_range"){if(t===null&&n===null)return"Specify a minimum and/or maximum to enable the custom range rule.";const s=t===null?"-":String(t),r=n===null?"":String(n);return`Custom bounds active: [${s}, ${r}].`}if(e==="percentage_bounds")return`Using percentage bounds ${t??0}${n??100}.`;if(e==="age_bounds")return`Using age bounds ${t??0}${n??120}.`;if(e==="negative_to_nan"&&(t!==null||n!==null)){const s=t??0;return n===null?`Negative-to-missing rule overrides values below ${s}.`:`Negative-to-missing rule overrides values < ${s} or > ${n}.`}return null},rI=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,minValueParameter:r,maxValueParameter:i,renderMultiSelectField:l,renderParameterField:u,columnSummary:d,modeDetails:f,sampleMap:p,selectedMode:m,minValue:h,maxValue:_})=>{if(!n&&!s&&!r&&!i)return null;const{selectedColumns:x,autoDetectionActive:y}=d,v=x.length,w=YD(d.recommendedColumns),k=Mc(d.negativeCandidates),j=Mc(d.zeroCandidates),b=Mc(d.percentageOutliers),S=Mc(d.ageOutliers),E=Mc(d.nonNumericSelected),M=tI(p,x,m,h,_),O=sI(m,h,_),$=!e||!t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Replace invalid numeric values"})}),a.jsxs("p",{className:"canvas-modal__note",children:[a.jsx("strong",{children:f.label})," rule. ",f.guidance," Example: ",f.example,"."]}),O&&a.jsx("p",{className:"canvas-modal__note",children:O}),y?a.jsx("p",{className:"canvas-modal__note",children:"No columns selectednumeric columns will be auto-detected when the node runs."}):a.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",a.jsx("strong",{children:v})," column",v===1?"":"s"," for invalid value cleanup."]}),M.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",M.map(P=>`${P.column} (${P.values.join("; ")})`).join(" | "),"."]}),k.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns with negative values: ",k.preview.join(", "),k.remaining>0?`, ... (${k.remaining} more)`:"","."]}),j.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Columns with placeholder zeros: ",j.preview.join(", "),j.remaining>0?`, ... (${j.remaining} more)`:"","."]}),b.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Percentage candidates with values outside 0-100: ",b.preview.join(", "),b.remaining>0?`, ... (${b.remaining} more)`:"","."]}),S.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Age-like values outside 0-120: ",S.preview.join(", "),S.remaining>0?`, ... (${S.remaining} more)`:"","."]}),w.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Other numeric columns: ",w.preview.join(", "),w.remaining>0?`, ... (${w.remaining} more)`:"","."]}),E.preview.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[E.preview.join(", ")," ",E.preview.length===1?"is":"are"," not numeric-type columns.",E.remaining>0?` ${E.remaining} more column${E.remaining===1?" is":"s are"} also non-numeric.`:" Verify the selection or adjust the rule."]}),$?e?a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review numeric insights."}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect numeric samples before applying replacements."}):null,n&&a.jsxs("div",{className:"canvas-modal__subsection",children:[a.jsx("h4",{children:"Columns to clean"}),l(n)]}),(s||r||i)&&a.jsxs("div",{className:"canvas-modal__parameter-list",children:[s?u(s):null,r?u(r):null,i?u(i):null]})]})};let aI="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",$N=(e=21)=>{let t="",n=e|0;for(;n--;)t+=aI[Math.random()*64|0];return t};const TN=[{value:"add",label:"Addition (+)"},{value:"subtract",label:"Subtraction ()"},{value:"multiply",label:"Multiplication ()"},{value:"divide",label:"Division ()"}],PN=[{value:"sum",label:"Sum"},{value:"mean",label:"Mean"},{value:"min",label:"Minimum"},{value:"max",label:"Maximum"},{value:"std",label:"Standard deviation"},{value:"median",label:"Median"},{value:"count",label:"Count (non-missing)"},{value:"range",label:"Range (max - min)"}],jp=[{value:"token_sort_ratio",label:"Token Sort  Same words, ignore order",description:"Split into words, sort alphabetically, then compare. Great when the same words appear in different order."},{value:"token_set_ratio",label:"Token Set  Unique words, ignore extras",description:"Focus on overlapping unique words and down-weight extras. Best when one string has additional words."},{value:"ratio",label:"Character Ratio  Raw string similarity",description:"Compare characters in order using edit distance. Sensitive to spelling differences."}],Vd=[{value:"year",label:"Year"},{value:"quarter",label:"Quarter"},{value:"month",label:"Month"},{value:"month_name",label:"Month name"},{value:"week",label:"ISO week number"},{value:"day",label:"Day of month"},{value:"day_name",label:"Day name"},{value:"weekday",label:"Weekday index (Mon=0)"},{value:"is_weekend",label:"Is weekend"},{value:"hour",label:"Hour"},{value:"minute",label:"Minute"},{value:"second",label:"Second"},{value:"season",label:"Season"},{value:"time_of_day",label:"Time of day bucket"}],oI=new Set(Vd.map(e=>e.value)),Ac=[{value:"arithmetic",label:"Arithmetic",description:"Combine columns and constants using addition, subtraction, multiplication, or division.",defaultMethod:"add"},{value:"ratio",label:"Ratio",description:"Divide one column or group of columns by another with safe zero handling.",defaultMethod:"ratio"},{value:"stat",label:"Statistics",description:"Compute sums, averages, min/max, or dispersion metrics across columns.",defaultMethod:"mean"},{value:"similarity",label:"Text similarity",description:"Score two text columns using rapidfuzz token-based similarity.",defaultMethod:"token_sort_ratio"},{value:"datetime_extract",label:"Datetime extraction",description:"Expand datetime columns into year, month, weekday, season and similar features.",defaultMethod:"datetime_extract"}],Oc="UTC",Wd=e=>e?Array.isArray(e)?Array.from(new Set(e.map(t=>typeof t=="string"?t.trim():String(t??"").trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?Wd(e.split(",")):[]:[],LN=e=>{if(!e)return[];if(Array.isArray(e)){const n=[];return e.forEach(s=>{const r=Number(s);Number.isFinite(r)&&n.push(r)}),n}if(typeof e=="string")return LN(e.split(/[;,]+/));const t=Number(e);return Number.isFinite(t)?[t]:[]},Cp=e=>{const t=Number(e);return Number.isFinite(t)?t:null},zN=(e,t)=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e!==0:t;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(["true","1","yes","y","on"].includes(n))return!0;if(["false","0","no","n","off"].includes(n))return!1}return t},iI=(e,t)=>{var s,r,i,l,u;if(typeof t!="string")return((s=Ac.find(d=>d.value===e))==null?void 0:s.defaultMethod)??"";const n=t.trim().toLowerCase();return n?e==="arithmetic"?((i=TN.find(d=>d.value===n))==null?void 0:i.value)??"add":e==="stat"?((l=PN.find(d=>d.value===n))==null?void 0:l.value)??"mean":e==="similarity"?((u=jp.find(d=>d.value===n))==null?void 0:u.value)??"token_sort_ratio":e==="ratio"?"ratio":e==="datetime_extract"?"datetime_extract":n:((r=Ac.find(d=>d.value===e))==null?void 0:r.defaultMethod)??""},lI=e=>{if(typeof e!="string")return"arithmetic";const t=e.trim().toLowerCase();return t==="arithmetic"||t==="ratio"||t==="stat"||t==="similarity"||t==="datetime_extract"?t:"arithmetic"},cI=e=>{const t=Wd(e);return t.length?t.filter(n=>oI.has(n)):["year","month","day"]},uI=e=>typeof e!="string"?Oc:e.trim()||Oc,RN=e=>{if(!Array.isArray(e))return[];const t=[];return e.forEach((n,s)=>{if(!n||typeof n!="object")return;const r=n,i=lI(r.operation_type??r.type),l=r.operation_id??r.id??`feature_math_${s+1}`,u=typeof l=="string"&&l.trim()?l.trim():`feature_math_${s+1}`,d=iI(i,r.method),f=Wd(r.input_columns??r.inputs??r.inputColumns),p=Wd(r.secondary_columns??r.denominator??r.secondaryColumns),m=LN(r.constants),h=typeof r.output_column=="string"?r.output_column.trim():"",_=typeof r.output_prefix=="string"?r.output_prefix.trim():"",x=i==="datetime_extract"?cI(r.datetime_features):[],y=i==="datetime_extract"?uI(r.timezone):Oc,v=Cp(r.fillna),w=(()=>{const E=Cp(r.round??r.round_digits);return Number.isInteger(E??NaN),E})(),k=Cp(r.epsilon),j=i==="similarity"?zN(r.normalize,!1):!1,b=r.allow_overwrite===void 0?null:zN(r.allow_overwrite,!1),S=typeof r.description=="string"?r.description:void 0;t.push({id:u,type:i,method:d,inputColumns:f,secondaryColumns:p,constants:m,outputColumn:h,outputPrefix:_,datetimeFeatures:x,timezone:y,fillna:v,roundDigits:w,normalize:j,epsilon:k,allowOverwrite:b,description:S})}),t},dI=e=>{const t={id:e.id,operation_id:e.id,type:e.type,operation_type:e.type,method:e.method,input_columns:e.inputColumns,secondary_columns:e.secondaryColumns,constants:e.constants,output_column:e.outputColumn,output_prefix:e.outputPrefix};return e.type==="datetime_extract"?(t.datetime_features=e.datetimeFeatures.length?e.datetimeFeatures:["year","month","day"],t.timezone=e.timezone||Oc):e.datetimeFeatures.length&&(t.datetime_features=e.datetimeFeatures),e.type==="similarity"&&(t.normalize=e.normalize),e.fillna!==null&&Number.isFinite(e.fillna)&&(t.fillna=e.fillna),e.roundDigits!==null&&Number.isFinite(e.roundDigits)&&(t.round=e.roundDigits,t.round_digits=e.roundDigits),e.epsilon!==null&&Number.isFinite(e.epsilon)&&(t.epsilon=e.epsilon),e.allowOverwrite!==null&&(t.allow_overwrite=e.allowOverwrite),e.description&&e.description.trim()&&(t.description=e.description.trim()),t},mI=e=>e.map(t=>dI(t)),fI={arithmetic:{method:"add",constants:[]},ratio:{method:"ratio",constants:[]},stat:{method:"mean",constants:[]},similarity:{method:"token_sort_ratio",constants:[],normalize:!1},datetime_extract:{method:"datetime_extract",datetimeFeatures:["year","month","day"]}},DN=(e,t)=>{var r;const n=fI[e]??{};let s=`math_${e}_${$N(6)}`;for(;t.has(s);)s=`math_${e}_${$N(6)}`;return{id:s,type:e,method:n.method??((r=Ac.find(i=>i.value===e))==null?void 0:r.defaultMethod)??"add",inputColumns:[],secondaryColumns:[],constants:n.constants??[],outputColumn:"",outputPrefix:"",datetimeFeatures:e==="datetime_extract"?n.datetimeFeatures??["year","month","day"]:[],timezone:Oc,fillna:null,roundDigits:null,normalize:n.normalize??!1,epsilon:null,allowOverwrite:null,description:void 0}},hI=(e,t)=>{const n=new Map;return t==null||t.forEach(s=>{s.operations.forEach(r=>{n.has(r.operation_id)||n.set(r.operation_id,r)})}),e.map((s,r)=>{const i=n.get(s.id),l=`${r+1}. ${s.type.replace("_"," ")}${s.method?`  ${s.method}`:""}`;return{id:s.id,label:l,status:i==null?void 0:i.status,message:(i==null?void 0:i.message)??void 0,outputColumns:(i==null?void 0:i.output_columns)??[]}})},IN=e=>e==="arithmetic"?TN:e==="stat"?PN:e==="similarity"?jp:e==="ratio"?[{value:"ratio",label:"Ratio (numerator / denominator)"}]:[{value:"datetime_extract",label:"Extract datetime parts"}],pI=e=>{const t=jp.find(n=>n.value===e);return t!=null&&t.description?t.description:"Compare the input text columns using the selected similarity technique."},gI={applied:"Applied",skipped:"Skipped",failed:"Failed"},_I={applied:"canvas-cast__chip--applied",skipped:"canvas-cast__chip--muted",failed:"canvas-cast__chip--attention"},yI=new Set(Vd.map(e=>e.value)),vI=(e,t=4)=>{if(!e.length)return"No columns yet";const n=e.slice(0,t),s=e.length-n.length;return s>0?`${n.join(", ")}  (${s} more)`:n.join(", ")},FN=e=>e.trim()?Array.from(new Set(e.split(",").map(t=>t.trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):[],xI=e=>e.trim()?e.split(",").map(t=>Number(t.trim())).filter(t=>Number.isFinite(t)):[],bI=e=>e==="failed"?"canvas-modal__note canvas-modal__note--error":e==="skipped"?"canvas-modal__note canvas-modal__note--warning":"canvas-modal__note canvas-modal__note--info",wI=({index:e,total:t,operation:n,summary:s,availableColumns:r,isCollapsed:i,onToggleCollapsed:l,onDuplicate:u,onRemove:d,onReorder:f,onChange:p})=>{var J;const m=N.useMemo(()=>IN(n.type),[n.type]),h=N.useMemo(()=>{var Z;return((Z=Ac.find(ee=>ee.value===n.type))==null?void 0:Z.label)??n.type},[n.type]),_=N.useMemo(()=>{var Z;return((Z=m.find(ee=>ee.value===n.method))==null?void 0:Z.label)??n.method},[m,n.method]),x=N.useMemo(()=>n.type==="similarity"?pI(n.method):"",[n.method,n.type]),[y,v]=N.useState(n.inputColumns.join(", ")),[w,k]=N.useState(n.secondaryColumns.join(", ")),[j,b]=N.useState(n.constants.join(", "));N.useEffect(()=>{v(n.inputColumns.join(", "))},[n.inputColumns]),N.useEffect(()=>{k(n.secondaryColumns.join(", "))},[n.secondaryColumns]),N.useEffect(()=>{b(n.constants.join(", "))},[n.constants]);const S=()=>{p(n.id,{inputColumns:FN(y)})},E=()=>{p(n.id,{secondaryColumns:FN(w)})},M=()=>{p(n.id,{constants:xI(j)})},O=`feature-math-toggle-${n.id}`,$=`feature-math-body-${n.id}`,P=`feature-math-input-columns-${n.id}`,A=`feature-math-secondary-columns-${n.id}`,R=s==null?void 0:s.status,F=R?a.jsx("span",{className:`canvas-cast__chip ${_I[R]??""}`,style:{marginLeft:"0.5rem"},children:gI[R]}):null,z=s!=null&&s.message?s.message.trim():"",I=bI(R),U=(J=s==null?void 0:s.outputColumns)!=null&&J.length?s.outputColumns.join(", "):"",q=vI(n.inputColumns),H=n.type==="ratio"||n.type==="similarity",W=n.type==="arithmetic"||n.type==="stat"||n.type==="ratio",B=n.type==="arithmetic"||n.type==="stat"||n.type==="ratio",D=n.type==="similarity",V=n.type==="datetime_extract",te=n.type==="stat"||n.type==="datetime_extract",G=N.useMemo(()=>{if(!r.length)return"";const Z=r.slice(0,6),ee=r.length-Z.length;return ee>0?`${Z.join(", ")}  (${ee} more)`:Z.join(", ")},[r]),K=Z=>{if(!Z||!yI.has(Z))return;const ee=new Set(n.datetimeFeatures);ee.has(Z)?ee.delete(Z):ee.add(Z),p(n.id,{datetimeFeatures:Array.from(ee)})},X=Z=>ee=>{const de=ee.target.value;if(de===""){p(n.id,{[Z]:null});return}const _e=Number(de);Number.isFinite(_e)&&(Z==="roundDigits"?p(n.id,{roundDigits:Math.round(_e)}):Z==="fillna"?p(n.id,{fillna:_e}):p(n.id,{epsilon:_e}))},Q=n.allowOverwrite===null?"inherit":n.allowOverwrite?"allow":"prevent";return a.jsxs("div",{className:"canvas-imputer__card",children:[a.jsxs("div",{className:"canvas-imputer__card-header",children:[a.jsxs("button",{type:"button",id:O,className:"canvas-imputer__card-toggle",onClick:()=>l(n.id),"aria-expanded":!i,"aria-controls":$,children:[a.jsx("span",{className:`canvas-imputer__toggle-icon${i?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),a.jsxs("span",{className:"canvas-imputer__card-text",children:[a.jsxs("span",{className:"canvas-imputer__card-title",children:["Operation ",e+1]}),a.jsxs("span",{className:"canvas-imputer__card-summary",children:[h,_?`  ${_}`:"",n.outputColumn?`   ${n.outputColumn}`:"",F]}),a.jsxs("span",{className:"canvas-modal__meta",children:["Inputs: ",q]})]})]}),a.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>d(n.id),"aria-label":`Remove operation ${e+1}`,children:"Remove"})]}),!i&&a.jsxs("div",{className:"canvas-imputer__card-body",id:$,children:[a.jsx("div",{className:"canvas-imputer__row",children:a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>u(n.id),children:"Duplicate"}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>f(n.id,"up"),disabled:e===0,children:"Move up"}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>f(n.id,"down"),disabled:e>=t-1,children:"Move down"})]})}),z&&a.jsx("p",{className:I,children:z}),U&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Outputs: ",U]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-type`,children:"Operation type"}),a.jsx("select",{id:`feature-math-${n.id}-type`,value:n.type,onChange:Z=>p(n.id,{type:Z.target.value}),children:Ac.map(Z=>a.jsx("option",{value:Z.value,children:Z.label},Z.value))})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-method`,children:"Method"}),a.jsx("select",{id:`feature-math-${n.id}-method`,value:n.method,onChange:Z=>p(n.id,{method:Z.target.value}),children:m.map(Z=>a.jsx("option",{value:Z.value,children:Z.label},Z.value))})]}),n.type==="similarity"&&x&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:x}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-input-columns`,children:"Input columns"}),a.jsx("input",{id:`feature-math-${n.id}-input-columns`,type:"text",value:y,onChange:Z=>v(Z.target.value),onBlur:S,onKeyDown:Z=>{Z.key==="Enter"&&(Z.preventDefault(),S())},placeholder:"col_a, col_b",list:P}),a.jsx("datalist",{id:P,children:r.map(Z=>a.jsx("option",{value:Z},`${n.id}-input-option-${Z}`))}),G&&a.jsxs("p",{className:"canvas-modal__meta",children:["Available: ",G]})]}),H&&a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-secondary-columns`,children:n.type==="ratio"?"Denominator columns":"Compare against"}),a.jsx("input",{id:`feature-math-${n.id}-secondary-columns`,type:"text",value:w,onChange:Z=>k(Z.target.value),onBlur:E,onKeyDown:Z=>{Z.key==="Enter"&&(Z.preventDefault(),E())},placeholder:n.type==="ratio"?"denominator_col":"comparison column",list:A}),a.jsx("datalist",{id:A,children:r.map(Z=>a.jsx("option",{value:Z},`${n.id}-secondary-option-${Z}`))}),a.jsx("p",{className:"canvas-modal__meta",children:"Comma separated list"})]}),W&&a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-constants`,children:"Constants (optional)"}),a.jsx("input",{id:`feature-math-${n.id}-constants`,type:"text",value:j,onChange:Z=>b(Z.target.value),onBlur:M,onKeyDown:Z=>{Z.key==="Enter"&&(Z.preventDefault(),M())},placeholder:"0.0, 1.5"}),a.jsx("p",{className:"canvas-modal__meta",children:"Numbers separated by commas are added alongside the selected columns."})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-output-column`,children:"Output column (optional)"}),a.jsx("input",{id:`feature-math-${n.id}-output-column`,type:"text",value:n.outputColumn,onChange:Z=>p(n.id,{outputColumn:Z.target.value}),placeholder:"custom_feature_name"}),a.jsx("p",{className:"canvas-modal__meta",children:"Leave blank to derive a name automatically."})]}),te&&a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-output-prefix`,children:"Output prefix"}),a.jsx("input",{id:`feature-math-${n.id}-output-prefix`,type:"text",value:n.outputPrefix,onChange:Z=>p(n.id,{outputPrefix:Z.target.value}),placeholder:"prefix_"}),a.jsx("p",{className:"canvas-modal__meta",children:"Applied to generated column names (statistics or datetime features)."})]}),B&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-fillna`,children:"Fill missing result with"}),a.jsx("input",{id:`feature-math-${n.id}-fillna`,type:"number",value:n.fillna??"",onChange:X("fillna"),placeholder:"none"}),a.jsx("p",{className:"canvas-modal__meta",children:"Applies after computing the operation."})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-round`,children:"Round digits"}),a.jsx("input",{id:`feature-math-${n.id}-round`,type:"number",value:n.roundDigits??"",onChange:X("roundDigits"),placeholder:"none",step:1}),a.jsx("p",{className:"canvas-modal__meta",children:"Leave blank for no rounding."})]})]}),n.type==="ratio"&&a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-epsilon`,children:"Division epsilon"}),a.jsx("input",{id:`feature-math-${n.id}-epsilon`,type:"number",value:n.epsilon??"",onChange:X("epsilon"),placeholder:"inherit",step:"any"}),a.jsx("p",{className:"canvas-modal__meta",children:"Overrides the node-level epsilon for this ratio."})]}),D&&a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsxs("label",{htmlFor:`feature-math-${n.id}-normalize`,className:"canvas-modal__boolean-control",children:[a.jsx("input",{id:`feature-math-${n.id}-normalize`,type:"checkbox",checked:n.normalize,onChange:Z=>p(n.id,{normalize:Z.target.checked})}),a.jsx("span",{children:"Normalize scores to the [0, 1] range"})]}),a.jsx("p",{className:"canvas-modal__meta",children:"Useful when chaining similarity outputs into downstream calculations."})]}),V&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"canvas-imputer__row canvas-imputer__row--wrap",children:a.jsxs("fieldset",{children:[a.jsx("legend",{children:"Datetime features"}),a.jsx("div",{className:"canvas-modal__checkbox-grid",children:Vd.map(Z=>{const ee=`feature-math-${n.id}-datetime-${Z.value}`,de=n.datetimeFeatures.includes(Z.value);return a.jsxs("label",{className:"canvas-modal__checkbox-item",htmlFor:ee,children:[a.jsx("input",{id:ee,type:"checkbox",checked:de,onChange:()=>K(Z.value)}),a.jsx("span",{className:"canvas-modal__checkbox-label",children:Z.label})]},Z.value)})})]})}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-timezone`,children:"Timezone override"}),a.jsx("input",{id:`feature-math-${n.id}-timezone`,type:"text",value:n.timezone,onChange:Z=>p(n.id,{timezone:Z.target.value}),placeholder:"UTC"}),a.jsx("p",{className:"canvas-modal__meta",children:"Use an IANA timezone identifier, e.g. America/New_York."})]})]}),a.jsxs("div",{className:"canvas-imputer__row",children:[a.jsx("label",{htmlFor:`feature-math-${n.id}-allow-overwrite`,children:"Overwrite behavior"}),a.jsxs("select",{id:`feature-math-${n.id}-allow-overwrite`,value:Q,onChange:Z=>{const ee=Z.target.value;ee==="inherit"?p(n.id,{allowOverwrite:null}):p(n.id,{allowOverwrite:ee==="allow"})},children:[a.jsx("option",{value:"inherit",children:"Inherit node default"}),a.jsx("option",{value:"allow",children:"Always overwrite existing columns"}),a.jsx("option",{value:"prevent",children:"Never overwrite existing columns"})]})]})]})]})},NI=({operations:e,summaries:t,collapsed:n,onToggleCollapsed:s,onAddOperation:r,onDuplicateOperation:i,onRemoveOperation:l,onReorderOperation:u,onOperationChange:d,availableColumns:f,signals:p,previewStatus:m,errorHandlingParameter:h,allowOverwriteParameter:_,defaultTimezoneParameter:x,epsilonParameter:y,renderParameterField:v})=>{const[w,k]=N.useState("arithmetic"),j=N.useMemo(()=>{const O=new Map;return t.forEach($=>{O.set($.id,$)}),O},[t]),b=N.useMemo(()=>p.length?p[p.length-1]:null,[p]),S=(b==null?void 0:b.warnings)??[],E=b&&b.failed_operations>0?"canvas-modal__note canvas-modal__note--warning":"canvas-modal__note canvas-modal__note--info",M=()=>{r(w)};return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Feature math operations"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:M,children:"Add operation"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Blend columns using arithmetic formulas, ratios, statistics, similarity scores, or datetime extractions. Configure each operation below  they execute in order."}),m==="loading"&&a.jsx("p",{className:"canvas-modal__note",children:"Preview updating"}),b&&a.jsxs("p",{className:E,children:["Preview applied ",b.applied_operations," of ",b.total_operations," operation",b.total_operations===1?"":"s"," (",b.skipped_operations," skipped, ",b.failed_operations," failed)."]}),S.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:S.map((O,$)=>a.jsx("li",{children:O},`feature-math-warning-${$}`))}),e.length===0&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"No feature math steps configured yet. Add an operation to create engineered columns."}),e.map((O,$)=>a.jsx(wI,{index:$,total:e.length,operation:O,summary:j.get(O.id),availableColumns:f,isCollapsed:n.has(O.id),onToggleCollapsed:s,onDuplicate:i,onRemove:l,onReorder:u,onChange:d},O.id)),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[h&&v(h),_&&v(_),x&&v(x),y&&v(y)]})]})},jI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},CI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},BN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),SI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxUniqueParameter:d,outputSuffixParameter:f,dropOriginalParameter:p,missingStrategyParameter:m,missingCodeParameter:h,selectedColumns:_,renderParameterField:x,onToggleColumn:y,onApplyRecommended:v,formatMissingPercentage:w})=>{const k=N.useMemo(()=>{if(!r.length)return[];const E=new Set;return r.forEach(M=>{M.status==="recommended"&&M.selectable&&E.add(M.column)}),Array.from(E)},[r]),j=N.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface label encoding suggestions.",[t,e]),b=r.length>0,S=!n&&!!s&&!!e&&t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Label encoding suggestions"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(k),disabled:!k.length,children:"Add recommended"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Convert short-form categorical text into integer labels. Suggestions come from EDA heuristics and the current pipeline preview."}),j&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:j}),i.generatedAt&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.autoDetectDefault&&a.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),i.notes.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((E,M)=>a.jsx("li",{children:E},`label-encoding-note-${M}`))}),i.highCardinalityColumns.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading label encoding insights"}),S&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!b&&e&&t&&a.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&b&&a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Distinct"}),a.jsx("th",{scope:"col",children:"Missing"}),a.jsx("th",{scope:"col",children:"Status"}),a.jsx("th",{scope:"col",children:"Select"})]})}),a.jsx("tbody",{children:r.map(E=>{const M=_.includes(E.column),O=jI[E.status],$=CI[E.status]??"canvas-cast__chip--muted",P=E.sample_values.length?E.sample_values.join(", "):"",A=E.unique_count!==void 0&&E.unique_count!==null?`${BN(E.unique_count)} (${BN(E.unique_percentage)}%)`:"",R=w(E.missing_percentage);return a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:E.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[E.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",E.dtype]}),E.text_category&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:E.text_category})]}),a.jsx("div",{className:"canvas-cast__column-meta",children:a.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",P]})}),a.jsx("p",{className:"canvas-cast__recommendation-note",children:E.reason})]})}),a.jsx("td",{children:A}),a.jsx("td",{children:R}),a.jsx("td",{children:a.jsx("span",{className:`canvas-cast__chip ${$}`,children:O})}),a.jsx("td",{children:a.jsxs("label",{className:"canvas-modal__checkbox-item",children:[a.jsx("input",{type:"checkbox",checked:M,onChange:()=>y(E.column),disabled:!E.selectable}),a.jsx("span",{className:"canvas-modal__checkbox-label",children:E.selectable?M?"In node":"Add column":"Not eligible"})]})})]},`label-encoding-row-${E.column}`)})})]})}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),f&&x(f),p&&x(p),m&&x(m),h&&x(h)]}),l&&a.jsxs("div",{children:[a.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},EI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},kI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},UN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),MI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,targetColumnParameter:u,autoDetectParameter:d,maxCategoriesParameter:f,outputSuffixParameter:p,dropOriginalParameter:m,smoothingParameter:h,encodeMissingParameter:_,handleUnknownParameter:x,selectedColumns:y,renderParameterField:v,onToggleColumn:w,onApplyRecommended:k,formatMissingPercentage:j})=>{const b=N.useMemo(()=>{if(!r.length)return[];const O=new Set;return r.forEach($=>{$.status==="recommended"&&$.selectable&&O.add($.column)}),Array.from(O)},[r]),S=N.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface target encoding suggestions.",[t,e]),E=r.length>0,M=!n&&!!s&&!!e&&t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Target encoding suggestions"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>k(b),disabled:!b.length,children:"Add recommended"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Encode categorical columns by replacing each category with the smoothed mean of a numeric target column. This is useful for high-cardinality features when a label or ordinal encoding is too coarse."}),S&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:S}),!u&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Add a target column parameter to unlock target encoding. The backend requires a numeric target to compute averages."}),i.autoDetectDefault&&a.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),i.enableGlobalFallbackDefault&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Enable the global mean fallback so unseen categories and nulls do not break downstream transforms."}),i.generatedAt&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.notes.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((O,$)=>a.jsx("li",{children:O},`target-encoding-note-${$}`))}),i.highCardinalityColumns.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading target encoding insights"}),M&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!E&&e&&t&&a.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&E&&a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Distinct"}),a.jsx("th",{scope:"col",children:"Missing"}),a.jsx("th",{scope:"col",children:"Fallback"}),a.jsx("th",{scope:"col",children:"Status"}),a.jsx("th",{scope:"col",children:"Select"})]})}),a.jsx("tbody",{children:r.map(O=>{const $=y.includes(O.column),P=EI[O.status],A=kI[O.status]??"canvas-cast__chip--muted",R=O.sample_values.length?O.sample_values.join(", "):"",F=O.unique_count!==void 0&&O.unique_count!==null?`${UN(O.unique_count)} (${UN(O.unique_percentage)}%)`:"",z=j(O.missing_percentage),I=O.recommended_use_global_fallback?"Use global mean":"";return a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:O.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[O.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",O.dtype]}),O.text_category&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:O.text_category})]}),a.jsx("div",{className:"canvas-cast__column-meta",children:a.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",R]})}),a.jsx("p",{className:"canvas-cast__recommendation-note",children:O.reason})]})}),a.jsx("td",{children:F}),a.jsx("td",{children:z}),a.jsx("td",{children:I}),a.jsx("td",{children:a.jsx("span",{className:`canvas-cast__chip ${A}`,children:P})}),a.jsx("td",{children:a.jsxs("label",{className:"canvas-modal__checkbox-item",children:[a.jsx("input",{type:"checkbox",checked:$,onChange:()=>w(O.column),disabled:!O.selectable}),a.jsx("span",{className:"canvas-modal__checkbox-label",children:O.selectable?$?"In node":"Add column":"Not eligible"})]})})]},`target-encoding-row-${O.column}`)})})]})}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&v(u),d&&v(d),f&&v(f),p&&v(p),m&&v(m),h&&v(h),_&&v(_),x&&v(x)]}),l&&a.jsxs("div",{children:[a.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),v(l)]})]})},AI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},OI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},HN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),$I=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,bucketsParameter:f,outputSuffixParameter:p,dropOriginalParameter:m,encodeMissingParameter:h,selectedColumns:_,renderParameterField:x,onToggleColumn:y,onApplyRecommended:v,formatMissingPercentage:w})=>{const k=N.useMemo(()=>{if(!r.length)return[];const M=new Set;return r.forEach(O=>{O.status==="recommended"&&O.selectable&&M.add(O.column)}),Array.from(M)},[r]),j=N.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface hash encoding suggestions.",[t,e]),b=r.length>0,S=i.suggestedBucketDefault>0?`Default bucket suggestion: ${i.suggestedBucketDefault.toLocaleString()}.`:null,E=!n&&!!s&&!!e&&t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Hash encoding suggestions"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(k),disabled:!k.length,children:"Add recommended"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Hash encoding maps categorical labels into a fixed number of numeric buckets, keeping feature width bounded even when categories grow over time. Collisions are acceptable for tree models and regularised linear models that can tolerate sparse overlaps."}),j&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:j}),i.autoDetectDefault&&a.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so newly ingested categorical columns pick up hashing without manual edits."}),S&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:S}),i.generatedAt&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.notes.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((M,O)=>a.jsx("li",{children:M},`hash-encoding-note-${O}`))}),i.highCardinalityColumns.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["High-cardinality columns highlighted:"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading hash encoding insights"}),E&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!b&&e&&t&&a.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&b&&a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Distinct"}),a.jsx("th",{scope:"col",children:"Missing"}),a.jsx("th",{scope:"col",children:"Suggested buckets"}),a.jsx("th",{scope:"col",children:"Status"}),a.jsx("th",{scope:"col",children:"Select"})]})}),a.jsx("tbody",{children:r.map(M=>{const O=_.includes(M.column),$=AI[M.status],P=OI[M.status]??"canvas-cast__chip--muted",A=M.sample_values.length?M.sample_values.join(", "):"",R=M.unique_count!==void 0&&M.unique_count!==null?`${HN(M.unique_count)} (${HN(M.unique_percentage)}%)`:"",F=w(M.missing_percentage),z=M.recommended_bucket_count?M.recommended_bucket_count.toLocaleString():"";return a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:M.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[M.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",M.dtype]}),M.text_category&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:M.text_category})]}),a.jsx("div",{className:"canvas-cast__column-meta",children:a.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",A]})}),a.jsx("p",{className:"canvas-cast__recommendation-note",children:M.reason})]})}),a.jsx("td",{children:R}),a.jsx("td",{children:F}),a.jsx("td",{children:z}),a.jsx("td",{children:a.jsx("span",{className:`canvas-cast__chip ${P}`,children:$})}),a.jsx("td",{children:a.jsxs("label",{className:"canvas-modal__checkbox-item",children:[a.jsx("input",{type:"checkbox",checked:O,onChange:()=>y(M.column),disabled:!M.selectable}),a.jsx("span",{className:"canvas-modal__checkbox-label",children:M.selectable?O?"In node":"Add column":"Not eligible"})]})})]},`hash-encoding-row-${M.column}`)})})]})}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),f&&x(f),p&&x(p),m&&x(m),h&&x(h)]}),l&&a.jsxs("div",{children:[a.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},TI=({columnsParameter:e,autoDetectParameter:t,degreeParameter:n,includeBiasParameter:s,interactionOnlyParameter:r,includeInputFeaturesParameter:i,outputPrefixParameter:l,renderParameterField:u,signal:d})=>{const[f,p]=N.useState(!1),m=N.useMemo(()=>[e,t,n].filter(j=>!!j),[e,t,n]),h=N.useMemo(()=>[s,r,i,l].filter(j=>!!j),[s,r,i,l]),_=(d==null?void 0:d.generated_features)??[],x=(d==null?void 0:d.skipped_columns)??[],y=(d==null?void 0:d.filled_columns)??{},v=(d==null?void 0:d.notes)??[],w=(d==null?void 0:d.feature_count)??0,k=N.useMemo(()=>{const j=Object.entries(y);return j.length?j.map(([b,S])=>`${b} (${S.toLocaleString()} missing)`).join(", "):null},[y]);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Polynomial feature settings"})}),a.jsx("p",{className:"canvas-modal__note",children:"Expand numeric features with polynomial powers and interaction terms to capture non-linear relations. Preview the node to inspect generated columns and adjust degree or interaction options as needed."}),m.length>0&&a.jsx("div",{className:"canvas-modal__parameter-grid",children:m.map(j=>u(j))}),h.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(zd,{isOpen:f,onToggle:()=>p(!f),label:"Advanced polynomial settings",description:"Configure bias, interactions, and output naming"}),f&&a.jsx("div",{className:"canvas-modal__parameter-grid",style:{marginTop:"1rem"},children:h.map(j=>u(j))})]}),x.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Skipped columns: ",x.join(", "),"."]}),k&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Filled missing values with 0 for ",k," before generating features."]}),w>0?a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Feature column"}),a.jsx("th",{scope:"col",children:"Expression"}),a.jsx("th",{scope:"col",children:"Degree"})]})}),a.jsx("tbody",{children:_.map(j=>a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:j.column}),a.jsx("td",{children:j.expression||(j.terms.length?j.terms.join("  "):"1")}),a.jsx("td",{children:j.degree})]},`poly-feature-${j.column}`))})]})}):a.jsx("p",{className:"canvas-modal__note",children:"No derived features yet. Run a preview to generate polynomial terms for the current configuration."}),v.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:v.map((j,b)=>a.jsx("li",{children:j},`polynomial-note-${b}`))})]})},qN=e=>!!e,$c=(e,t=4)=>{if(e==null)return"";const n=Number(e);return Number.isFinite(n)?n.toLocaleString(void 0,{maximumFractionDigits:t}):""},PI=e=>{if(e==null)return"";const t=Number(e);return Number.isFinite(t)?t===0?"< 1e-12":t<1e-4?t.toExponential(2):t.toLocaleString(void 0,{maximumFractionDigits:6}):""},VN=(e,t=8)=>{if(!e.length)return"None";const n=e.slice(0,t),s=e.length-n.length;return s>0?`${n.join(", ")}  (${s} more)`:n.join(", ")},LI=({columnsParameter:e,autoDetectParameter:t,targetColumnParameter:n,methodParameter:s,scoreFuncParameter:r,problemTypeParameter:i,kParameter:l,percentileParameter:u,alphaParameter:d,thresholdParameter:f,modeParameter:p,estimatorParameter:m,stepParameter:h,minFeaturesParameter:_,maxFeaturesParameter:x,dropUnselectedParameter:y,renderParameterField:v,signal:w})=>{const[k,j]=N.useState(!1),b=N.useMemo(()=>[e,t,n,s,r,i].filter(qN),[e,t,n,s,r,i]),S=N.useMemo(()=>[l,u,d,f,p,m,h,_,x,y].filter(qN),[l,u,d,f,p,m,h,_,x,y]),E=(w==null?void 0:w.configured_columns)??[],M=(w==null?void 0:w.evaluated_columns)??[],O=(w==null?void 0:w.selected_columns)??[],$=(w==null?void 0:w.dropped_columns)??[],P=(w==null?void 0:w.feature_summaries)??[],A=(w==null?void 0:w.notes)??[],R=(w==null?void 0:w.drop_unselected)??!1,F=N.useMemo(()=>{if(!M.length&&!E.length)return null;if(M.length===E.length)return`Evaluated ${M.length.toLocaleString()} column(s).`;if(!E.length)return`Evaluated ${M.length.toLocaleString()} column(s) via auto-detect.`;const q=Math.max(M.length-E.length,0);return q>0?`Evaluated ${M.length.toLocaleString()} column(s) (${q.toLocaleString()} auto-detected).`:`Evaluated ${M.length.toLocaleString()} of ${E.length.toLocaleString()} configured column(s).`},[E,M]),z=N.useMemo(()=>{if(!w)return null;const q=[];return w.method&&q.push(`Method: ${w.method}`),w.score_func&&q.push(`Score: ${w.score_func}`),w.estimator&&q.push(`Estimator: ${w.estimator}`),w.problem_type&&w.problem_type!=="auto"&&q.push(`Problem: ${w.problem_type}`),w.target_column&&q.push(`Target: ${w.target_column}`),typeof w.k=="number"&&Number.isFinite(w.k)&&q.push(`k = ${w.k.toLocaleString()}`),typeof w.percentile=="number"&&Number.isFinite(w.percentile)&&q.push(`percentile = ${$c(w.percentile,2)}`),typeof w.alpha=="number"&&Number.isFinite(w.alpha)&&q.push(`alpha = ${$c(w.alpha,4)}`),w.threshold!==null&&w.threshold!==void 0&&Number.isFinite(w.threshold)&&q.push(`threshold = ${$c(w.threshold,4)}`),w.auto_detect&&q.push("Auto-detect enabled"),q.length?q.join("  "):null},[w]),I=N.useMemo(()=>VN(O),[O]),U=N.useMemo(()=>VN($),[$]);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Feature selection settings"})}),a.jsx("p",{className:"canvas-modal__note",children:"Score candidate predictors and retain the most informative columns using statistical tests or model-based selectors. Run a preview after adjusting parameters to refresh rankings."}),z&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:z}),F&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:F}),b.length>0&&a.jsx("div",{className:"canvas-modal__parameter-grid",children:b.map(q=>v(q))}),S.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(zd,{isOpen:k,onToggle:()=>j(!k),label:"Advanced tuning",description:"Configure thresholds, percentiles, and estimator settings"}),k&&a.jsx("div",{className:"canvas-modal__parameter-grid",style:{marginTop:"1rem"},children:S.map(q=>v(q))})]}),a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:R?"Unselected columns will be dropped from the dataset when this node runs.":"Unselected columns will remain in the dataset for downstream steps."}),O.length>0?a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Selected ",O.length.toLocaleString()," column(s): ",I]}):a.jsx("p",{className:"canvas-modal__note",children:"No columns selected yet. Run a preview to compute selection scores."}),$.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Dropped ",$.length.toLocaleString()," column(s): ",U]}),P.length>0?a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Feature column"}),a.jsx("th",{scope:"col",children:"Score"}),a.jsx("th",{scope:"col",children:"p-value"}),a.jsx("th",{scope:"col",children:"Rank"}),a.jsx("th",{scope:"col",children:"Importance"}),a.jsx("th",{scope:"col",children:"Status"}),a.jsx("th",{scope:"col",children:"Note"})]})}),a.jsx("tbody",{children:P.map(q=>{const H=["canvas-cast__row"];return q.selected||H.push("canvas-cast__row--muted"),a.jsxs("tr",{className:H.join(" "),children:[a.jsx("th",{scope:"row",children:q.column}),a.jsx("td",{children:$c(q.score)}),a.jsx("td",{children:PI(q.p_value)}),a.jsx("td",{children:q.rank??""}),a.jsx("td",{children:$c(q.importance,4)}),a.jsx("td",{children:q.selected?"Selected":"Dropped"}),a.jsx("td",{children:q.note??""})]},`feature-selection-summary-${q.column}`)})})]})}):a.jsx("p",{className:"canvas-modal__note",children:"Preview results will display per-column scores, ranks, and selection outcomes here."}),A.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:A.map((q,H)=>a.jsx("li",{children:q},`feature-selection-note-${H}`))})]})},zI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},RI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},WN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),DI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,outputSuffixParameter:f,dropOriginalParameter:p,encodeMissingParameter:m,handleUnknownParameter:h,unknownValueParameter:_,selectedColumns:x,renderParameterField:y,onToggleColumn:v,onApplyRecommended:w,formatMissingPercentage:k})=>{const j=N.useMemo(()=>{if(!r.length)return[];const M=new Set;return r.forEach(O=>{O.status==="recommended"&&O.selectable&&M.add(O.column)}),Array.from(M)},[r]),b=N.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface ordinal encoding suggestions.",[t,e]),S=r.length>0,E=!n&&!!s&&!!e&&t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Ordinal encoding suggestions"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>w(j),disabled:!j.length,children:"Add recommended"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Convert categorical columns into ordered integer codes. Use the fallback controls to keep pipelines stable when unexpected categories or missing values appear."}),b&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:b}),i.autoDetectDefault&&a.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),i.enableUnknownDefault&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Enable the fallback code so unseen categories and nulls do not break downstream transforms."}),i.generatedAt&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.notes.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((M,O)=>a.jsx("li",{children:M},`ordinal-encoding-note-${O}`))}),i.highCardinalityColumns.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading ordinal encoding insights"}),E&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!S&&e&&t&&a.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&S&&a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Distinct"}),a.jsx("th",{scope:"col",children:"Missing"}),a.jsx("th",{scope:"col",children:"Unknowns"}),a.jsx("th",{scope:"col",children:"Status"}),a.jsx("th",{scope:"col",children:"Select"})]})}),a.jsx("tbody",{children:r.map(M=>{const O=x.includes(M.column),$=zI[M.status],P=RI[M.status]??"canvas-cast__chip--muted",A=M.sample_values.length?M.sample_values.join(", "):"",R=M.unique_count!==void 0&&M.unique_count!==null?`${WN(M.unique_count)} (${WN(M.unique_percentage)}%)`:"",F=k(M.missing_percentage),z=M.recommended_handle_unknown?"Enable fallback":"";return a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:M.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[M.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",M.dtype]}),M.text_category&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:M.text_category})]}),a.jsx("div",{className:"canvas-cast__column-meta",children:a.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",A]})}),a.jsx("p",{className:"canvas-cast__recommendation-note",children:M.reason})]})}),a.jsx("td",{children:R}),a.jsx("td",{children:F}),a.jsx("td",{children:z}),a.jsx("td",{children:a.jsx("span",{className:`canvas-cast__chip ${P}`,children:$})}),a.jsx("td",{children:a.jsxs("label",{className:"canvas-modal__checkbox-item",children:[a.jsx("input",{type:"checkbox",checked:O,onChange:()=>v(M.column),disabled:!M.selectable}),a.jsx("span",{className:"canvas-modal__checkbox-label",children:M.selectable?O?"In node":"Add column":"Not eligible"})]})})]},`ordinal-encoding-row-${M.column}`)})})]})}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&y(u),d&&y(d),f&&y(f),p&&y(p),m&&y(m),h&&y(h),_&&y(_)]}),l&&a.jsxs("div",{children:[a.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),y(l)]})]})},II={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},FI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},YN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),BI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,dropFirstParameter:f,includeMissingParameter:p,dropOriginalParameter:m,prefixSeparatorParameter:h,selectedColumns:_,renderParameterField:x,onToggleColumn:y,onApplyRecommended:v,formatMissingPercentage:w})=>{const k=N.useMemo(()=>{if(!r.length)return[];const E=new Set;return r.forEach(M=>{M.status==="recommended"&&M.selectable&&E.add(M.column)}),Array.from(E)},[r]),j=N.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface dummy encoding suggestions.",[t,e]),b=r.length>0,S=!n&&!!s&&!!e&&t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Dummy encoding suggestions"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(k),disabled:!k.length,children:"Add recommended"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Create dummy variables while automatically dropping a reference category. This mirrors one-hot encoding but keeps feature matrices full rank."}),j&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:j}),i.autoDetectDefault&&u&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Auto-detection is recommended here so new categorical columns are captured by default."}),i.generatedAt&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.cautionedCount>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[i.cautionedCount," column",i.cautionedCount===1?"":"s"," could expand heavily  consider alternate encodings."]}),i.notes.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((E,M)=>a.jsx("li",{children:E},`dummy-note-${M}`))}),i.highCardinalityColumns.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading dummy encoding insights"}),S&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!b&&e&&t&&a.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&b&&a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Distinct"}),a.jsx("th",{scope:"col",children:"Missing"}),a.jsx("th",{scope:"col",children:"Dummy cols"}),a.jsx("th",{scope:"col",children:"Status"}),a.jsx("th",{scope:"col",children:"Select"})]})}),a.jsx("tbody",{children:r.map(E=>{const M=_.includes(E.column),O=II[E.status],$=FI[E.status]??"canvas-cast__chip--muted",P=E.sample_values.length?E.sample_values.join(", "):"",A=E.unique_count!==void 0&&E.unique_count!==null?`${YN(E.unique_count)} (${YN(E.unique_percentage)}%)`:"",R=w(E.missing_percentage),F=E.estimated_dummy_columns?E.estimated_dummy_columns.toLocaleString():"";return a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:E.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[E.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",E.dtype]}),E.text_category&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:E.text_category}),E.recommended_drop_first&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--info",children:"Drop first suggested"})]}),a.jsx("div",{className:"canvas-cast__column-meta",children:a.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",P]})}),a.jsx("p",{className:"canvas-cast__recommendation-note",children:E.reason})]})}),a.jsx("td",{children:A}),a.jsx("td",{children:R}),a.jsx("td",{children:F}),a.jsx("td",{children:a.jsx("span",{className:`canvas-cast__chip ${$}`,children:O})}),a.jsx("td",{children:a.jsxs("label",{className:"canvas-modal__checkbox-item",children:[a.jsx("input",{type:"checkbox",checked:M,onChange:()=>y(E.column),disabled:!E.selectable}),a.jsx("span",{className:"canvas-modal__checkbox-label",children:E.selectable?M?"In node":"Add column":"Not eligible"})]})})]},`dummy-encoding-row-${E.column}`)})})]})}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),f&&x(f),p&&x(p),m&&x(m),h&&x(h)]}),l&&a.jsxs("div",{children:[a.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},UI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},HI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},KN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),qI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,dropFirstParameter:f,includeMissingParameter:p,dropOriginalParameter:m,prefixSeparatorParameter:h,selectedColumns:_,renderParameterField:x,onToggleColumn:y,onApplyRecommended:v,formatMissingPercentage:w})=>{const k=N.useMemo(()=>{if(!r.length)return[];const E=new Set;return r.forEach(M=>{M.status==="recommended"&&M.selectable&&E.add(M.column)}),Array.from(E)},[r]),j=N.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface one-hot encoding suggestions.",[t,e]),b=r.length>0,S=!n&&!!s&&!!e&&t;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"One-hot encoding suggestions"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(k),disabled:!k.length,children:"Add recommended"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Expand categorical text into binary indicator columns. Suggestions factor in estimated dummy counts so encodings stay tractable."}),j&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:j}),i.generatedAt&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.cautionedCount>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[i.cautionedCount," column",i.cautionedCount===1?"":"s"," could explode in width  consider alternate encodings."]}),i.notes.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((E,M)=>a.jsx("li",{children:E},`one-hot-note-${M}`))}),i.highCardinalityColumns.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading one-hot encoding insights"}),S&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!b&&e&&t&&a.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&b&&a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Distinct"}),a.jsx("th",{scope:"col",children:"Missing"}),a.jsx("th",{scope:"col",children:"Dummy cols"}),a.jsx("th",{scope:"col",children:"Status"}),a.jsx("th",{scope:"col",children:"Select"})]})}),a.jsx("tbody",{children:r.map(E=>{const M=_.includes(E.column),O=UI[E.status],$=HI[E.status]??"canvas-cast__chip--muted",P=E.sample_values.length?E.sample_values.join(", "):"",A=E.unique_count!==void 0&&E.unique_count!==null?`${KN(E.unique_count)} (${KN(E.unique_percentage)}%)`:"",R=w(E.missing_percentage),F=E.estimated_dummy_columns?E.estimated_dummy_columns.toLocaleString():"";return a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:E.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[E.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",E.dtype]}),E.text_category&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:E.text_category}),E.recommended_drop_first&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--info",children:"Drop first suggested"})]}),a.jsx("div",{className:"canvas-cast__column-meta",children:a.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",P]})}),a.jsx("p",{className:"canvas-cast__recommendation-note",children:E.reason})]})}),a.jsx("td",{children:A}),a.jsx("td",{children:R}),a.jsx("td",{children:F}),a.jsx("td",{children:a.jsx("span",{className:`canvas-cast__chip ${$}`,children:O})}),a.jsx("td",{children:a.jsxs("label",{className:"canvas-modal__checkbox-item",children:[a.jsx("input",{type:"checkbox",checked:M,onChange:()=>y(E.column),disabled:!E.selectable}),a.jsx("span",{className:"canvas-modal__checkbox-label",children:E.selectable?M?"In node":"Add column":"Not eligible"})]})})]},`one-hot-row-${E.column}`)})})]})}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),f&&x(f),p&&x(p),m&&x(m),h&&x(h)]}),l&&a.jsxs("div",{children:[a.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},GN={fit_transform:"Fit + transform",transform:"Transform",not_applied:"Not applied",not_available:""},VI=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()},XN=e=>{if(e==null||Number.isNaN(e)||e<=0)return null;const t=Math.round(e);return`${t.toLocaleString()} row${t===1?"":"s"}`},WI=(e,t)=>Array.isArray(e.split_activity)?e.split_activity.find(s=>s&&s.split===t)??null:null,Sp=(e,t)=>{const n=WI(e,t);if(!n||n.action==="not_available")return a.jsx("span",{children:""});const s=GN[n.action]??n.action,r=XN(n.rows??null);return a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{children:s}),r&&a.jsx("span",{className:"canvas-cast__muted",children:r})]})},YI=e=>{if(!Array.isArray(e.split_activity))return null;const t=e.split_activity.filter(s=>s&&!["train","test","validation"].includes(s.split));return t.length&&t.map(s=>{const r=s.label||s.split,i=GN[s.action]??s.action,l=XN(s.rows??null);return l?`${r}: ${i} (${l})`:`${r}: ${i}`}).join("; ")||null},KI=e=>!e.metadata||typeof e.metadata!="object"?null:e.metadata.method_label?String(e.metadata.method_label):e.metadata.method?String(e.metadata.method):null,GI=({signal:e,previewStatus:t,hasSource:n,hasReachableSource:s,onRefreshPreview:r})=>{const i=N.useMemo(()=>(e==null?void 0:e.transformers)??[],[e==null?void 0:e.transformers]),l=(e==null?void 0:e.total_transformers)??i.length,u=Array.isArray(e==null?void 0:e.notes)?e==null?void 0:e.notes:[],d=t==="loading",f=l?`Tracking ${l.toLocaleString()} transformer${l===1?"":"s"}.`:null,p=d||!n||!s;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Transformer activity"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,disabled:p,children:d?"Refreshing":"Refresh preview"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Review whether split-aware transformers (e.g. one-hot encoders) fit on training data and propagated to test/validation splits."}),f&&a.jsx("p",{className:"canvas-modal__note",children:f}),!n&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface transformer activity."}),n&&!s&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream branch to inspect transformer history."}),u.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:u.map((m,h)=>a.jsx("li",{children:m},`transformer-audit-note-${h}`))}),d&&a.jsx("p",{className:"canvas-modal__note",children:"Loading transformer activity"}),!d&&t==="error"&&n&&s&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:"Unable to load transformer activity. Try refreshing the preview."}),!d&&n&&s&&!i.length&&a.jsx("p",{className:"canvas-modal__note",children:"No transformer activity recorded yet. Run a preview after executing split-aware transformation nodes."}),!d&&i.length>0&&a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Node"}),a.jsx("th",{scope:"col",children:"Transformer"}),a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Method"}),a.jsx("th",{scope:"col",children:"Train"}),a.jsx("th",{scope:"col",children:"Test"}),a.jsx("th",{scope:"col",children:"Validation"}),a.jsx("th",{scope:"col",children:"Updated"})]})}),a.jsx("tbody",{children:i.map((m,h)=>{const _=m.storage_key??`${m.transformer_name}-${m.column_name??"all"}-${h}`,x=YI(m),y=m.source_node_label||m.source_node_id||"",v=VI(m.updated_at??m.created_at??null),w=m.column_name??"",k=KI(m);return a.jsxs(ve.Fragment,{children:[a.jsxs("tr",{className:"canvas-cast__row",children:[a.jsx("th",{scope:"row",children:a.jsx("div",{className:"canvas-cast__column-cell",children:a.jsx("span",{className:"canvas-cast__column-name",children:y})})}),a.jsx("td",{children:m.transformer_name}),a.jsx("td",{children:w}),a.jsx("td",{children:k||""}),a.jsx("td",{children:Sp(m,"train")}),a.jsx("td",{children:Sp(m,"test")}),a.jsx("td",{children:Sp(m,"validation")}),a.jsx("td",{children:v})]}),x&&a.jsx("tr",{className:"canvas-cast__row canvas-cast__row--subtle",children:a.jsx("td",{colSpan:8,children:a.jsxs("span",{className:"canvas-cast__muted",children:["Additional splits: ",x]})})})]},_)})})]})})]})},XI=({parameters:e,renderParameterField:t})=>e.length===0?null:a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Data consistency settings"})}),a.jsx("div",{className:"canvas-modal__parameter-list",children:e.map(n=>t(n))})]}),Ep=(e,t=5)=>e.length?e.length<=t?e.join(", "):`${e.slice(0,t).join(", ")}, ...`:"",QI=e=>{for(let t=e.length-1;t>=0;t-=1){const n=e[t];if(typeof n!="string")continue;if(n.toLowerCase().includes("feature/target split"))return n}return null},ZI=(e,t)=>{if(!e.length)return null;const n=e.filter(s=>!(s!=null&&s.node_id)||s.node_id===t);return n.length?n[n.length-1]:e[e.length-1]},JI=({nodeId:e,sourceId:t,hasReachableSource:n,previewState:s,onRefreshPreview:r,config:i,targetColumnParameter:l,renderParameterField:u,formatMetricValue:d,formatMissingPercentage:f})=>{var te,G,K,X;const p=s.data,m=s.status,h=Array.isArray(p==null?void 0:p.applied_steps)?p.applied_steps:[],_=Array.isArray(p==null?void 0:p.columns)?p==null?void 0:p.columns:[],x=Array.isArray((te=p==null?void 0:p.signals)==null?void 0:te.feature_target_split)?(G=p==null?void 0:p.signals)==null?void 0:G.feature_target_split:[],y=ZI(x,e),v=(i==null?void 0:i.targetColumn)??"",w=(y==null?void 0:y.target_column)??v,k=(i==null?void 0:i.featureColumns)??[],j=N.useMemo(()=>Array.isArray(p==null?void 0:p.column_stats)?p==null?void 0:p.column_stats:[],[p==null?void 0:p.column_stats]),b=N.useMemo(()=>{const Q=new Map;return j.forEach(J=>{J!=null&&J.name&&Q.set(J.name,J)}),Q},[j]),S=N.useMemo(()=>{var Q;return(Q=y==null?void 0:y.feature_columns)!=null&&Q.length?y.feature_columns:k.length?k:w?_.filter(J=>J!==w):_.slice()},[y==null?void 0:y.feature_columns,k,_,w]),E=(y==null?void 0:y.auto_included_columns)??[],M=(y==null?void 0:y.missing_feature_columns)??[],O=(y==null?void 0:y.excluded_columns)??[],$=(y==null?void 0:y.target_missing_count)??0,P=typeof(y==null?void 0:y.target_missing_percentage)=="number"?y.target_missing_percentage:null,A=(y==null?void 0:y.target_dtype)??(w?((K=b.get(w))==null?void 0:K.dtype)??null:null),R=typeof((X=p==null?void 0:p.metrics)==null?void 0:X.row_count)=="number"?p.metrics.row_count:null,F=S.length,z=E.length,I=O.length,U=M.length,q=N.useMemo(()=>QI(h),[h]),H=N.useMemo(()=>{const Q=[];if(Q.push({label:"Target column",value:w||"Not set"}),Q.push({label:"Feature columns",value:d(F)}),R!==null&&Q.push({label:"Preview rows",value:d(R)}),z&&Q.push({label:"Auto-selected features",value:d(z)}),U&&Q.push({label:"Configured features missing",value:d(U)}),I&&Q.push({label:"Excluded columns",value:d(I)}),$){const J=d($),Z=P!==null?f(P):null;Q.push({label:"Target missing values",value:Z?`${J} (${Z})`:J})}return Q},[z,I,F,d,f,U,R,w,$,P]),W=N.useMemo(()=>t?n?null:"Link this node to the upstream dataset to resolve feature columns.":"Connect this node to a dataset to confirm feature and target mappings.",[n,t]),B=N.useMemo(()=>!t||!n?null:m==="idle"?"Refresh the preview to surface feature/target diagnostics.":null,[n,m,t]),D=N.useMemo(()=>w?m==="success"&&w&&!_.includes(w)?`Target column "${w}" is not present in the current preview output.`:null:"Set a target column so downstream nodes understand the supervised objective.",[_,m,w]),V=!!t&&n&&m!=="loading";return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Feature/target separation"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,disabled:!V,children:m==="loading"?"Refreshing...":"Refresh preview"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Confirm which columns feed the feature matrix (X) and which column serves as the supervised target (y). This metadata helps downstream modeling nodes stay aligned with the configured training objective."}),W&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:W}),s.error&&m==="error"&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s.error}),B&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:B}),D&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:D}),U>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Missing configured feature columns: ",Ep(M),"."]}),I>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Columns excluded from the feature matrix: ",Ep(O),"."]}),z>0&&k.length===0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Auto-selected feature columns: ",Ep(E),"."]}),q&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:q}),H.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:H.map(Q=>a.jsxs("li",{children:[Q.label,": ",a.jsx("strong",{children:Q.value})]},`feature-target-summary-${Q.label}`))}),a.jsx("div",{className:"canvas-modal__parameter-grid",children:l&&u(l)}),m==="success"&&F===0&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"No feature columns detected. Confirm that the dataset includes columns other than the target."}),w&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Target dtype: ",A?a.jsx("strong",{children:A}):a.jsx("span",{children:"Unknown"}),$?` - Missing rows flagged for review: ${d($)}.`:""]})]})},e3=(e,t)=>{if(!e.length)return null;const n=e.filter(s=>!(s!=null&&s.node_id)||s.node_id===t);return n.length?n[n.length-1]:e[e.length-1]},ia=e=>`${(e*100).toFixed(1)}%`,t3=({nodeId:e,sourceId:t,hasReachableSource:n,previewState:s,onRefreshPreview:r,config:i,parameters:l,renderParameterField:u,formatMetricValue:d})=>{var P,A;const f=s.data,p=s.status,m=Array.isArray((P=f==null?void 0:f.signals)==null?void 0:P.train_test_split)?(A=f==null?void 0:f.signals)==null?void 0:A.train_test_split:[],h=e3(m,e),_=(i==null?void 0:i.test_size)??.2,x=(i==null?void 0:i.validation_size)??0,y=i==null?void 0:i.random_state;i==null||i.shuffle;const v=(i==null?void 0:i.stratify)??!1,w=(i==null?void 0:i.target_column)??"",k=x>0,j=N.useMemo(()=>h?{trainSize:h.train_size??0,validationSize:h.validation_size??0,testSize:h.test_size??0,totalSize:h.total_size??0,trainRatio:h.train_size&&h.total_size?h.train_size/h.total_size:0,validationRatio:h.validation_ratio??0,testRatio:h.test_ratio??0}:{trainSize:0,validationSize:0,testSize:0,totalSize:0,trainRatio:1-_-x,validationRatio:x,testRatio:_},[h,_,x]),b=l.find(R=>R.name==="test_size"),S=l.find(R=>R.name==="validation_size"),E=l.find(R=>R.name==="random_state"),M=l.find(R=>R.name==="shuffle"),O=l.find(R=>R.name==="stratify"),$=l.find(R=>R.name==="target_column");return a.jsxs("div",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Train/Test Split Configuration"})}),a.jsxs("div",{className:"node-settings__field-group",children:[b&&u(b),S&&u(S),E&&u(E),M&&u(M),O&&u(O),v&&$&&u($)]}),p==="success"&&h&&a.jsxs("div",{className:"node-settings__info-panel",children:[a.jsx("h4",{className:"node-settings__info-title",children:"Split Summary"}),a.jsx("div",{className:"node-settings__split-visualization",children:a.jsxs("div",{className:"split-bar",children:[a.jsx("div",{className:"split-bar__segment split-bar__segment--train",style:{width:ia(j.trainRatio)},title:`Training: ${j.trainSize} rows (${ia(j.trainRatio)})`,children:a.jsx("span",{className:"split-bar__label",children:"Train"})}),k&&a.jsx("div",{className:"split-bar__segment split-bar__segment--validation",style:{width:ia(j.validationRatio)},title:`Validation: ${j.validationSize} rows (${ia(j.validationRatio)})`,children:a.jsx("span",{className:"split-bar__label",children:"Val"})}),a.jsx("div",{className:"split-bar__segment split-bar__segment--test",style:{width:ia(j.testRatio)},title:`Test: ${j.testSize} rows (${ia(j.testRatio)})`,children:a.jsx("span",{className:"split-bar__label",children:"Test"})})]})}),a.jsxs("div",{className:"node-settings__stats-grid",children:[a.jsxs("div",{className:"node-settings__stat-item",children:[a.jsx("span",{className:"node-settings__stat-label",children:"Total rows:"}),a.jsx("span",{className:"node-settings__stat-value",children:d(j.totalSize,0)})]}),a.jsxs("div",{className:"node-settings__stat-item",children:[a.jsx("span",{className:"node-settings__stat-label",children:"Training:"}),a.jsxs("span",{className:"node-settings__stat-value",children:[d(j.trainSize,0)," (",ia(j.trainRatio),")"]})]}),k&&a.jsxs("div",{className:"node-settings__stat-item",children:[a.jsx("span",{className:"node-settings__stat-label",children:"Validation:"}),a.jsxs("span",{className:"node-settings__stat-value",children:[d(j.validationSize,0)," (",ia(j.validationRatio),")"]})]}),a.jsxs("div",{className:"node-settings__stat-item",children:[a.jsx("span",{className:"node-settings__stat-label",children:"Test:"}),a.jsxs("span",{className:"node-settings__stat-value",children:[d(j.testSize,0)," (",ia(j.testRatio),")"]})]}),v&&w&&a.jsxs("div",{className:"node-settings__stat-item",children:[a.jsx("span",{className:"node-settings__stat-label",children:"Stratified by:"}),a.jsx("span",{className:"node-settings__stat-value",children:w})]}),y!==void 0&&a.jsxs("div",{className:"node-settings__stat-item",children:[a.jsx("span",{className:"node-settings__stat-label",children:"Random state:"}),a.jsx("span",{className:"node-settings__stat-value",children:y})]})]})]}),!n&&a.jsxs("div",{className:"node-settings__warning",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("span",{className:"node-settings__warning-icon",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(za,{size:16})}),"Connect this node to a data source to configure the split."]}),p==="loading"&&a.jsx("div",{className:"node-settings__loading",children:"Loading preview..."}),p==="error"&&a.jsxs("div",{className:"node-settings__error",children:[a.jsx("span",{className:"node-settings__error-icon",children:""}),"Failed to load preview. Try refreshing."]})]})},n3={classification:"Classification",regression:"Regression"},s3=e=>e==="numeric"||e==="integer",r3=e=>{if(!e)return!1;const t=e.toLowerCase();return t.includes("int")||t.includes("float")||t.includes("double")||t.includes("decimal")||t.includes("number")},kp=(e,t=3)=>e.length===0?"":e.length<=t?e.join(", "):`${e.slice(0,t).join(", ")}, ...`,a3=e=>{for(let t=e.length-1;t>=0;t-=1){const n=e[t];if(typeof n=="string"&&n.toLowerCase().startsWith("train model draft"))return n}return null},o3=({sourceId:e,hasReachableSource:t,previewState:n,onRefreshPreview:s,config:r,targetColumnParameter:i,problemTypeParameter:l,renderParameterField:u,formatMetricValue:d,formatMissingPercentage:f,schemaColumns:p})=>{var K;const m=n.data,h=n.status,_=Array.isArray(m==null?void 0:m.applied_steps)?m.applied_steps:[],x=Array.isArray(m==null?void 0:m.column_stats)?m.column_stats:[],y=(m==null?void 0:m.metrics)??null,v=N.useMemo(()=>Array.isArray(m==null?void 0:m.columns)?m.columns.filter(X=>typeof X=="string"&&X.trim().length>0):[],[m==null?void 0:m.columns]),w=N.useMemo(()=>{var X;return p.length?p:Array.isArray((X=m==null?void 0:m.schema)==null?void 0:X.columns)?m.schema.columns:v.length>0?v.map(Q=>({name:Q,pandas_dtype:null,logical_family:"unknown",nullable:!0})):[]},[(K=m==null?void 0:m.schema)==null?void 0:K.columns,v,p]),k=N.useMemo(()=>{const X=new Map;return w.forEach(Q=>{Q!=null&&Q.name&&X.set(Q.name,Q)}),X},[w]),j=(r==null?void 0:r.targetColumn)??"",b=(r==null?void 0:r.problemType)??"classification",S=j?x.find(X=>(X==null?void 0:X.name)===j)??null:null,M=!!(j?k.get(j)??null:null),O=N.useMemo(()=>{const X=new Set;return x.forEach(Q=>{Q!=null&&Q.name&&Q.name!==j&&X.add(Q.name)}),w.forEach(Q=>{Q!=null&&Q.name&&Q.name!==j&&X.add(Q.name)}),Array.from(X).sort()},[x,w,j]),$=N.useMemo(()=>O.filter(X=>{const Q=k.get(X);if(Q&&s3(Q.logical_family))return!0;const J=x.find(Z=>Z.name===X);return r3((J==null?void 0:J.dtype)??null)}),[x,O,k]),P=N.useMemo(()=>new Set($),[$]),A=N.useMemo(()=>O.filter(X=>!P.has(X)),[O,P]),R=N.useMemo(()=>x.filter(X=>(X==null?void 0:X.name)&&X.name!==j&&(X.missing_count??0)>0).map(X=>X.name),[x,j]),F=typeof(y==null?void 0:y.row_count)=="number"?y.row_count:null,z=typeof(S==null?void 0:S.distinct_count)=="number"&&Number.isFinite(S.distinct_count)?S.distinct_count:null,I=typeof(S==null?void 0:S.missing_count)=="number"?S.missing_count:0,U=typeof(S==null?void 0:S.missing_percentage)=="number"?S.missing_percentage:null,q=N.useMemo(()=>{const X=[];return j?h!=="success"?X:!S&&!M&&!O.length?(X.push(`Target column "${j}" is not present in the preview output, and no feature columns were found.`),X):(O.length||X.push("Add at least one feature column in addition to the target before training."),S&&I>0&&X.push(`Target column includes ${I} missing value${I===1?"":"s"}.`),b==="classification"&&S&&(z??0)<2&&X.push("Classification tasks require at least two distinct target classes."),b==="regression"&&$.length===0&&X.push("Regression tasks need at least one numeric feature column."),R.length>0&&X.push(`Feature columns with missing values: ${kp(R)}.`),F!==null&&F===0&&X.push("Preview returned zero rows after upstream transformations."),X):(X.push("Set a target column to evaluate downstream modeling constraints."),X)},[R,O.length,I,$.length,F,h,b,j,z,S,M]),H=N.useMemo(()=>n3[b],[b]),W=N.useMemo(()=>{const X=[{label:"Problem type",value:H},{label:"Target column",value:j||"Not set"}];if(h==="success"){if(z!==null&&X.push({label:"Target distinct values",value:d(z)}),S){const Q=d(I),J=U!==null?f(U):null;X.push({label:"Target missing values",value:J?`${Q} (${J})`:Q})}R.length>0&&X.push({label:"Features with missing values",value:d(R.length)})}return X},[H,R.length,d,f,I,h,j,z,U,S]),B=N.useMemo(()=>e?t?null:"Link this node to upstream transforms to analyse the feature set that reaches it.":"Connect this node to a dataset to validate training readiness.",[t,e]),D=N.useMemo(()=>!e||!t?null:h==="idle"?"Refresh the preview to surface downstream modeling checks.":null,[t,h,e]),V=N.useMemo(()=>a3(_),[_]),te=!!e&&t&&h!=="loading",G=N.useMemo(()=>!j||h!=="success"||q.length>0?null:"No critical blockers detected in the preview. Proceed with downstream training when ready.",[h,q.length,j]);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Train model readiness"}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:s,disabled:!te,children:h==="loading"?"Refreshing":"Refresh preview"})})]}),a.jsx("p",{className:"canvas-modal__note",children:"Validate that the pipeline output is ready for lightweight training by checking the target column, feature balance, and missing values against the cached preview."}),B&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:B}),n.error&&h==="error"&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:n.error}),D&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:D}),q.map((X,Q)=>a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:X},`train-model-issue-${Q}`)),G&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:G}),V&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:V}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[i&&u(i),l&&u(l)]}),W.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:W.map(X=>a.jsxs("li",{children:[X.label,": ",a.jsx("strong",{children:X.value})]},`train-model-summary-${X.label}`))}),h==="success"&&R.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Features with missing values: ",kp(R),"."]}),h==="success"&&b==="regression"&&A.length>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Non-numeric features detected: ",kp(A),". Consider encoding or casting them before training regression models."]})]})},QN=e=>{if(e==null)return"";if(typeof e=="number")return Number.isFinite(e)?Ws(e,Math.abs(e)>=1?2:4):String(e);if(typeof e=="string")return e;if(typeof e=="boolean")return e?"True":"False";if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.length?JSON.stringify(e):"[]";if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},i3=e=>e||"Unknown",l3=e=>{if(!e)return null;let t=e.trim();if(!t)return null;/^\d{4}-\d{2}-\d{2}\s+\d/.test(t)&&(t=t.replace(" ","T")),/(Z|z|[+-]\d{2}:?\d{2})$/.test(t)||(t=`${t}Z`);const n=new Date(t);return Number.isNaN(n.getTime())?null:n},Fn=e=>{const t=l3(e);if(!t)return null;const n=Math.round((Date.now()-t.getTime())/6e4);if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;const s=Math.round(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;const r=Math.round(s/24);return r===1?"1 day ago":`${r} days ago`},ZN=e=>typeof e!="number"||!Number.isFinite(e)?"":Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3),c3=({presets:e,isOpen:t,onClose:n,onApply:s,activePresetId:r,fieldMetadata:i})=>{const[l,u]=N.useState(null);N.useEffect(()=>{var m;if(!t){u(null);return}l&&e.some(h=>h.id===l)||u(((m=e[0])==null?void 0:m.id)??null)},[t,e,l]),N.useEffect(()=>{if(!t)return;const m=h=>{h.key==="Escape"&&n()};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[t,n]);const d=N.useMemo(()=>l?e.find(m=>m.id===l)??e[0]??null:e[0]??null,[e,l]),f=N.useMemo(()=>!r||!d?!1:r===d.id,[r,d]),p=N.useMemo(()=>{var v,w;if(!t||!e.length)return null;const m=((v=d==null?void 0:d.modelType)==null?void 0:v.toLowerCase())==="logistic_regression"?(w=d==null?void 0:d.params)==null?void 0:w.solver:null,h=typeof m=="string"?m.trim().toLowerCase():null,_=h&&(h==="sag"||h==="saga")?"SAG/SAGA solvers require scaled features for stability.":null,x=d?Object.entries(d.params??{}).sort(([k],[j])=>k.localeCompare(j)).map(([k,j])=>{const b=i==null?void 0:i[k],S=A=>{var R;return(R=b==null?void 0:b.options)!=null&&R.length?b.options.find(F=>{const z=F.value;return A==null?z===null||typeof z=="string"&&z.trim().toLowerCase()==="none":typeof A=="string"&&typeof z=="string"?z===A?!0:z.trim().toLowerCase()===A.trim().toLowerCase():String(z)===String(A)})??null:null},E=A=>{if(A===null)return b!=null&&b.nullable?"None":"";if(A===void 0)return"";if(typeof A=="boolean")return A?"true":"false";if(typeof A=="number")return Number.isFinite(A)?A.toString():String(A);if(A&&typeof A=="object")try{return JSON.stringify(A)}catch{return"[object]"}return String(A??"")},M=A=>{var I;if(!A)return null;const R=A.value,F=(I=A.label)==null?void 0:I.trim(),z=E(R);return F&&z&&F!==z?`${F} (${z})`:F||z},O=()=>{if(b&&b.default!==void 0){const A=$(b.default,!1);if(A.text)return{text:A.text,note:"Using estimator default"}}return{text:"",note:"Using estimator default"}},$=(A,R=!0)=>{const F=S(A);return F?{text:M(F)??"",note:null}:Array.isArray(A)?A.length===0?R?O():{text:"",note:null}:{text:A.map(I=>$(I,!1)).map(I=>I.text).filter(Boolean).join(", "),note:null}:A===void 0||typeof A=="string"&&A.trim()===""?R?O():{text:"",note:null}:A===null?b!=null&&b.nullable?{text:"None",note:null}:R?O():{text:"",note:null}:{text:E(A),note:null}},P=$(j);return{key:k,label:(b==null?void 0:b.label)??k,description:(b==null?void 0:b.description)??null,value:P.text,note:P.note}}):[],y=d!=null&&d.finishedAt?Fn(d.finishedAt):null;return a.jsxs("div",{className:"canvas-modal best-param-modal",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"canvas-modal__backdrop",onClick:n}),a.jsxs("div",{className:"canvas-modal__panel best-param-modal__panel",role:"document",children:[a.jsxs("header",{className:"best-param-modal__header",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"best-param-modal__title",children:"Tuned Hyperparameter Presets"}),a.jsx("p",{className:"best-param-modal__subtitle",children:"Review hyperparameter sets discovered by recent tuning runs and apply them to the current model."})]}),a.jsx("button",{type:"button",className:"best-param-modal__close",onClick:n,children:"Close"})]}),a.jsxs("div",{className:"best-param-modal__layout",children:[a.jsx("aside",{className:"best-param-modal__list","aria-label":"Tuned presets",children:e.map(k=>{const j=k.id===(d==null?void 0:d.id),b=k.finishedAt?Fn(k.finishedAt):null;return a.jsxs("button",{type:"button",className:`best-param-modal__list-button${j?" best-param-modal__list-button--active":""}`,onClick:()=>u(k.id),children:[a.jsx("span",{className:"best-param-modal__list-title",children:k.label}),a.jsxs("span",{className:"best-param-modal__list-meta",children:[k.runNumber?`Run ${k.runNumber}`:"Tuning run",b?`  ${b}`:""]}),k.scoring&&a.jsxs("span",{className:"best-param-modal__list-score",children:[k.scoring,": ",ZN(k.score)]}),k.targetColumn&&a.jsxs("span",{className:"best-param-modal__list-target",children:["Target: ",k.targetColumn]})]},k.id)})}),a.jsx("section",{className:"best-param-modal__details",children:d?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"best-param-modal__summary",children:[a.jsxs("div",{className:"best-param-modal__summary-main",children:[a.jsx("h4",{children:d.label}),a.jsxs("p",{children:[d.runNumber?`Run ${d.runNumber}`:"Tuning run",y?`  ${y}`:"",d.searchStrategy?`  ${d.searchStrategy}`:""]}),a.jsxs("p",{children:["Model: ",a.jsx("strong",{children:d.modelType}),d.targetColumn?a.jsxs(a.Fragment,{children:[" "," Target: ",a.jsx("strong",{children:d.targetColumn})]}):null,d.scoring?a.jsxs(a.Fragment,{children:[" "," ",d.scoring,": ",a.jsx("strong",{children:ZN(d.score)})]}):null]})]}),a.jsx("div",{className:"best-param-modal__summary-actions",children:a.jsx("button",{type:"button",className:"best-param-modal__apply",onClick:()=>s(d),disabled:!x.length,children:f?"Already applied":"Apply preset"})})]}),d.description&&a.jsx("p",{className:"best-param-modal__note",children:d.description}),_&&a.jsxs("div",{className:"best-param-modal__notice best-param-modal__notice--warning",style:{padding:"0.4rem 0.75rem",fontSize:"0.8rem",margin:"0.5rem 0"},children:[a.jsx("strong",{children:"Tip:"})," ",_]}),a.jsx("div",{className:"best-param-modal__param-grid",role:"table",children:x.length?x.map(k=>a.jsxs("div",{className:"best-param-modal__param-row",role:"row",children:[a.jsxs("div",{className:"best-param-modal__param-name",role:"cell",children:[a.jsxs("div",{className:"best-param-modal__param-label",children:[k.label,k.label!==k.key&&a.jsx("span",{className:"best-param-modal__param-key",children:a.jsx("code",{children:k.key})})]}),k.description&&a.jsx("div",{className:"best-param-modal__param-description",children:k.description})]}),a.jsxs("div",{className:"best-param-modal__param-value",role:"cell",children:[a.jsx("code",{children:k.value}),k.note&&a.jsx("span",{className:"best-param-modal__param-note",children:k.note})]})]},k.key)):a.jsx("p",{className:"best-param-modal__empty",children:"No hyperparameters available for this preset."})})]}):a.jsx("p",{className:"best-param-modal__empty",children:"Select a tuning run to inspect its hyperparameters."})})]})]})]})},[r,f,i,t,s,n,e,d]);return p?G_.createPortal(p,document.body):null},u3=new Set(["scale_numeric_features","scaling","scale_numeric"]),d3=[/convergencewarning/i,/failed to converge/i,/did not converge/i,/optimizer failed to converge/i,/increase the number of iterations/i,/scale your features/i,/standardize your features/i,/consider scaling your (data|features)/i,/feature scaling is (recommended|required)/i],m3=["forest","tree","boost","xgboost","lightgbm","catboost","gradient","histgradient","bagging"],f3=["bayes","naive_bayes","gaussian_nb"],h3=e=>{const t=e.trim().toLowerCase();return t?m3.some(s=>t.includes(s))?{required:!1,reason:null}:f3.some(s=>t.includes(s))?{required:!1,reason:null}:t.includes("logistic")?{required:!0,reason:"logistic"}:t.includes("svm")||t.includes("svc")||t.includes("svr")?{required:!0,reason:"svm"}:t.includes("knn")||t.includes("nearest")?{required:!0,reason:"knn"}:t.includes("sgd")||t.includes("perceptron")?{required:!0,reason:"sgd"}:["linear","ridge","lasso","elastic","regression"].some(s=>t.includes(s))?{required:!0,reason:"linear"}:{required:!1,reason:null}:{required:!1,reason:null}},p3=(e,t)=>{const n=new Set;if(!e||!t)return n;const s=Array.isArray(e.edges)?e.edges:[],r=[t];for(;r.length;){const i=r.pop();if(i)for(const l of s){if(!l)continue;const u=typeof l.source=="string"?l.source.trim():"",d=typeof l.target=="string"?l.target.trim():"";!u||!d||d===i&&!n.has(u)&&(n.add(u),r.push(u))}}return n},g3=(e,t)=>{if(!e||!t)return!1;const n=p3(e,t);return n.size?(Array.isArray(e.nodes)?e.nodes:[]).some(r=>{var l;if(!r||typeof r.id!="string"||!n.has(r.id))return!1;const i=String(((l=r==null?void 0:r.data)==null?void 0:l.catalogType)??(r==null?void 0:r.type)??"").toLowerCase();return i?u3.has(i)?!0:i.includes("scale")&&i.includes("numeric"):!1}):!1},_3=(e,t)=>{const n=t.find(s=>(s==null?void 0:s.value)===e);return n!=null&&n.label?n.label:e.replace(/_/g," ").replace(/\s+/g," ").trim()},Mp=(e,t=new Set,n=0)=>{if(e==null)return[];if(typeof e=="string")return[e];if(typeof e=="number"||typeof e=="boolean")return[];if(n>3)return[];if(Array.isArray(e)){if(!e.length)return[];const s=32,r=[];for(let i=0;i<e.length&&i<s;i+=1)r.push(...Mp(e[i],t,n+1));return r}if(typeof e=="object"){if(t.has(e))return[];t.add(e);const s=Object.values(e);if(!s.length)return[];const r=32,i=[];for(let l=0;l<s.length&&l<r;l+=1)i.push(...Mp(s[l],t,n+1));return i}return[]},rl=e=>{if(!e)return!1;const t=Mp(e);return t.length?t.some(n=>d3.some(s=>s.test(n))):!1},Tc=e=>{var n,s,r,i,l,u,d,f,p,m,h,_,x,y;if(!e)return!1;const t=[e.error_message,e.warning_message,e.message,e.details,e.notes,e.status_reason,e.status_message,e.error,(n=e.metadata)==null?void 0:n.warnings,(s=e.metadata)==null?void 0:s.warning,(r=e.metadata)==null?void 0:r.notes,(i=e.metadata)==null?void 0:i.messages,(l=e.metadata)==null?void 0:l.message,(u=e.metadata)==null?void 0:u.errors,(d=e.metrics)==null?void 0:d.warnings,(f=e.metrics)==null?void 0:f.warning,(p=e.metrics)==null?void 0:p.messages,(m=e.metrics)==null?void 0:m.message,(h=e.job_metadata)==null?void 0:h.warnings,(_=e.job_metadata)==null?void 0:_.warning,(x=e.job_metadata)==null?void 0:x.messages,(y=e.job_metadata)==null?void 0:y.notes];for(const v of t)if(rl(v))return!0;return!!(rl(e.metadata)||rl(e.metrics))},y3=(e,t,n)=>{const s=t||"This model";switch(e){case"logistic":return{headline:`${s} needs scaled numeric features`,summary:'Standardize numeric inputs before launching jobs to keep the logistic solver stable and avoid repeated "scale your features" warnings.',details:["Insert a Scale numeric features step before this node or reuse an upstream scaler.","StandardScaler works for most datasets; RobustScaler can help when outliers dominate.","Once scaling is in place, re-run tuning or training so the solver converges cleanly."]};case"svm":return{headline:`${s} is sensitive to feature scale`,summary:"Support Vector Machines depend on distance calculations. Keep numeric features on comparable scales to preserve margin geometry.",details:["Add the Scale numeric features step upstream of this node.","Try StandardScaler or MinMaxScaler depending on the kernel and expected ranges.","Retrain after scaling to refresh support vectors and hyperparameters."]};case"knn":return{headline:`${s} uses distance-based comparisons`,summary:"k-NN models weigh distances directly, so unscaled columns dominate neighbors. Scale numeric fields to keep votes balanced.",details:["Drop in a Scale numeric features step before launching jobs.","MinMaxScaler keeps features in [0, 1]; StandardScaler works when values are roughly normal.","Requeue jobs after scaling so neighbor search reflects the new feature space."]};case"sgd":return{headline:`${s} benefits from normalized inputs`,summary:"Stochastic gradient models converge faster and produce steadier coefficients when numeric inputs share a common scale.",details:["Insert a Scale numeric features node prior to this step.","StandardScaler plus optional RobustScaler for heavy-tailed features keeps gradients stable.","Re-run jobs after scaling to avoid exploding or vanishing updates."]};default:return{headline:`${s} prefers standardized numeric features`,summary:n==="regression"?"Linear regression families rely on comparable feature magnitudes. Scaling keeps coefficients well-conditioned and improves R stability.":"Linear classification models respond better when numeric inputs share a common scale. Scaling prevents any single column from dominating the loss.",details:["Add the Scale numeric features step ahead of this node or reuse an existing scaler.","StandardScaler is a safe default; RobustScaler helps when outliers skew distributions.","Re-launch jobs once scaling is applied so coefficients represent the standardized space."]}}},JN=({graph:e,nodeId:t,modelType:n,problemType:s,modelTypeOptions:r,enabled:i})=>N.useMemo(()=>{if(!i||!n||!n.trim()||g3(e,t))return null;const l=n.trim().toLowerCase(),{required:u,reason:d}=h3(l);if(!u||!d)return null;const f=_3(n,r);return y3(d,f,s)},[i,e,n,r,t,s]),v3={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},al={classification:["accuracy","f1_weighted","roc_auc","precision_weighted","recall_weighted"],regression:["rmse","mae","r2"],fallback:["rmse","mae","r2","accuracy","f1_weighted","roc_auc"]},Ap=(e,t)=>{if(!e)return{};const n={};return Object.entries(e).forEach(([s,r])=>{t.has(s)&&(n[s]=r)}),n},ej=(e,t)=>{if(e===t||typeof e=="number"&&typeof t=="number"&&Number.isNaN(e)&&Number.isNaN(t))return!0;if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?!1:e.every((n,s)=>ej(n,t[s]));if(e&&t&&typeof e=="object"&&typeof t=="object")try{return JSON.stringify(e)===JSON.stringify(t)}catch{return!1}return!1},x3=(e,t,n)=>{if(!e)return{};const s={};return Object.entries(e).forEach(([r,i])=>{if(!t.has(r)||i===""||i===null||i===void 0)return;const l=n==null?void 0:n[r];let u=i;if(l){if(typeof u=="string"){const d=u.trim();if(!d)return;l.type==="select"&&(u=d)}if(l.name==="multi_class"&&typeof u=="string"){const d=u.trim().toLowerCase();if(d==="auto")return;(d==="ovr"||d==="multinomial")&&(u=d)}if(l.default!==void 0){if(typeof l.default=="string"&&typeof u=="string"){const d=l.default.trim(),f=u.trim();if(d===f)return}else if(ej(l.default,u))return}}s[r]=u}),s},tj=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Pc=e=>{try{return JSON.parse(JSON.stringify(e))}catch{return e}},b3=e=>{if(!e)return al.fallback;const t=String(e.model_type??e.modelType??"").toLowerCase();if(t.includes("regressor"))return al.regression;if(t.includes("classifier")||t.includes("classification"))return al.classification;const n=String(e.problem_type??e.problemType??"").toLowerCase();return n==="regression"?al.regression:n==="classification"?al.classification:al.fallback},w3=e=>{var i,l,u;if(!e)return null;const t=[],n=(l=(i=e==null?void 0:e.cross_validation)==null?void 0:i.metrics)==null?void 0:l.mean;tj(n)&&((u=e==null?void 0:e.cross_validation)==null?void 0:u.status)==="completed"&&t.push({dataset:n,labelPrefix:"CV mean "});const s=[e.test,e.validation,e.train];for(const d of s)tj(d)&&t.push({dataset:d,labelPrefix:""});const r=b3(e);for(const d of t)for(const f of r){const p=d.dataset[f];if(typeof p=="number"&&Number.isFinite(p))return{label:d.labelPrefix?`${d.labelPrefix}${f}`:f,value:p}}for(const d of t)for(const[f,p]of Object.entries(d.dataset))if(typeof p=="number"&&Number.isFinite(p))return{label:d.labelPrefix?`${d.labelPrefix}${f}`:f,value:p};return null},Op=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",N3=({jobs:e})=>{const[t,n]=N.useState({key:"created_at",direction:"desc"}),s=N.useMemo(()=>e.map(f=>{var p,m;return f.problem_type||((p=f.metadata)==null?void 0:p.problem_type)||((m=f.metadata)==null?void 0:m.resolved_problem_type)}).filter(Boolean).some(f=>String(f).toLowerCase()==="regression")?"regression":"classification",[e]),r=N.useMemo(()=>{let d=[];s==="regression"?d=[{key:"r2",label:"R"},{key:"rmse",label:"RMSE"},{key:"mae",label:"MAE"},{key:"mse",label:"MSE"}]:d=[{key:"accuracy",label:"Accuracy"},{key:"f1",label:"F1"},{key:"f1_weighted",label:"F1 (Weighted)"},{key:"precision",label:"Precision"},{key:"precision_weighted",label:"Precision (Weighted)"},{key:"recall",label:"Recall"},{key:"recall_weighted",label:"Recall (Weighted)"},{key:"roc_auc",label:"AUC"},{key:"roc_auc_weighted",label:"AUC (Weighted)"}];const f=d.filter(_=>e.some(x=>{const y=x.metrics||{};return(w=>{var j,b,S;if(y[w]!==void 0)return y[w];const k=[y.test,y.validation,y.train];for(const E of k)if(E&&typeof E=="object"&&E[w]!==void 0)return E[w];if(((S=(b=(j=y.cross_validation)==null?void 0:j.metrics)==null?void 0:b.mean)==null?void 0:S[w])!==void 0)return y.cross_validation.metrics.mean[w]})(_.key)!==void 0})),p=f.some(_=>_.key==="f1"),m=f.some(_=>_.key==="precision"),h=f.some(_=>_.key==="recall");return f.filter(_=>!(_.key==="f1_weighted"&&p&&!e.some(y=>{var j,b;const v=y.metrics||{},w=v.f1_weighted!==void 0||((j=v.test)==null?void 0:j.f1_weighted)!==void 0,k=v.f1!==void 0||((b=v.test)==null?void 0:b.f1)!==void 0;return w&&!k})||_.key==="precision_weighted"&&m&&!e.some(y=>{var j,b;const v=y.metrics||{},w=v.precision_weighted!==void 0||((j=v.test)==null?void 0:j.precision_weighted)!==void 0,k=v.precision!==void 0||((b=v.test)==null?void 0:b.precision)!==void 0;return w&&!k})||_.key==="recall_weighted"&&h&&!e.some(y=>{var j,b;const v=y.metrics||{},w=v.recall_weighted!==void 0||((j=v.test)==null?void 0:j.recall_weighted)!==void 0,k=v.recall!==void 0||((b=v.test)==null?void 0:b.recall)!==void 0;return w&&!k})))},[s,e]),i=N.useMemo(()=>{const d=[...e];return d.sort((f,p)=>{let m,h;if(t.key==="created_at")m=f.created_at?new Date(f.created_at).getTime():0,h=p.created_at?new Date(p.created_at).getTime():0;else if(t.key==="model_type")m=f.model_type||"",h=p.model_type||"";else if(t.key==="status")m=f.status||"",h=p.status||"";else{const _=f.metrics||{},x=p.metrics||{},y=(v,w)=>{if(v[w]!==void 0)return v[w];if(w==="f1_weighted")return v.f1;if(w==="precision_weighted")return v.precision;if(w==="recall_weighted")return v.recall};m=y(_,t.key)??-1/0,h=y(x,t.key)??-1/0}return m<h?t.direction==="asc"?-1:1:m>h?t.direction==="asc"?1:-1:0}),d},[e,t]),l=d=>{n(f=>({key:d,direction:f.key===d&&f.direction==="desc"?"asc":"desc"}))},u=d=>t.key!==d?a.jsx("span",{style:{opacity:.3},children:""}):t.direction==="asc"?"":"";return e.length===0?a.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"rgba(148, 163, 184, 0.8)"},children:"No training jobs available for comparison."}):a.jsx("div",{className:"canvas-table-container",style:{overflowX:"auto"},children:a.jsxs("table",{className:"canvas-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"0.85rem"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{onClick:()=>l("model_type"),style:{cursor:"pointer",textAlign:"left",padding:"0.75rem",color:"#e2e8f0",fontWeight:600},children:["Model ",u("model_type")]}),a.jsx("th",{style:{textAlign:"left",padding:"0.75rem",color:"#e2e8f0",fontWeight:600},children:"Target"}),a.jsxs("th",{onClick:()=>l("status"),style:{cursor:"pointer",textAlign:"left",padding:"0.75rem",color:"#e2e8f0",fontWeight:600},children:["Status ",u("status")]}),r.map(d=>a.jsxs("th",{onClick:()=>l(d.key),style:{cursor:"pointer",textAlign:"right",padding:"0.75rem",color:"#e2e8f0",fontWeight:600},children:[d.label," ",u(d.key)]},d.key)),a.jsxs("th",{onClick:()=>l("created_at"),style:{cursor:"pointer",textAlign:"right",padding:"0.75rem",color:"#e2e8f0",fontWeight:600},children:["Created ",u("created_at")]})]})}),a.jsx("tbody",{children:i.map(d=>{var h;const f=d.metrics||{},p=d.status==="succeeded",m=_=>{var y,v,w;if(f[_]!==void 0)return f[_];const x=[f.test,f.validation,f.train];for(const k of x)if(k&&typeof k=="object"&&k[_]!==void 0)return k[_];if(((w=(v=(y=f.cross_validation)==null?void 0:y.metrics)==null?void 0:v.mean)==null?void 0:w[_])!==void 0)return f.cross_validation.metrics.mean[_]};return a.jsxs("tr",{style:{borderTop:"1px solid rgba(148, 163, 184, 0.1)"},children:[a.jsxs("td",{style:{padding:"0.75rem"},children:[a.jsx("div",{style:{fontWeight:500,color:"#e2e8f0"},children:d.model_type.replace(/_/g," ")}),a.jsxs("div",{style:{fontSize:"0.75rem",color:"rgba(148, 163, 184, 0.7)"},children:["ID: ",d.id.slice(0,8)]})]}),a.jsx("td",{style:{padding:"0.75rem",color:"#e2e8f0"},children:((h=d.metadata)==null?void 0:h.target_column)||""}),a.jsx("td",{style:{padding:"0.75rem"},children:a.jsx("span",{style:{display:"inline-block",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:500,background:d.status==="succeeded"?"rgba(34, 197, 94, 0.15)":d.status==="failed"?"rgba(239, 68, 68, 0.15)":"rgba(59, 130, 246, 0.15)",color:d.status==="succeeded"?"#4ade80":d.status==="failed"?"#f87171":"#60a5fa"},children:d.status})}),r.map(_=>{let x=m(_.key);x===void 0&&(_.key==="f1_weighted"?x=m("f1"):_.key==="precision_weighted"?x=m("precision"):_.key==="recall_weighted"?x=m("recall"):_.key==="roc_auc"&&(x=m("roc_auc_weighted")));const y=x!=null;return a.jsx("td",{style:{padding:"0.75rem",textAlign:"right"},children:p&&y?a.jsx("span",{style:{fontFamily:"monospace",color:"#e2e8f0"},children:Op(x)}):a.jsx("span",{style:{color:"rgba(148, 163, 184, 0.3)"},children:""})},_.key)}),a.jsx("td",{style:{padding:"0.75rem",textAlign:"right",color:"rgba(148, 163, 184, 0.8)"},children:d.created_at?Fn(d.created_at):""})]},d.id)})})]})})},j3=({jobs:e,isLoading:t,hiddenJobCount:n,onRefresh:s,pipelineId:r,createJobError:i,jobsError:l,tuningJobsError:u,lastCreatedJob:d,lastCreatedJobCount:f,isTuningJobsLoading:p})=>{const[m,h]=N.useState("list"),_=$a(),x=Oi({mutationFn:xw,onSuccess:()=>{_.invalidateQueries({queryKey:["training-jobs"]})},onError:w=>{console.error("Failed to cancel job:",w),alert(w instanceof Error?w.message:"Failed to cancel job")}}),y=w=>{confirm("Are you sure you want to cancel this training job?")&&x.mutate(w)},v=w=>{var I,U,q,H;const k=w3(w.metrics??null),j=w.updated_at?Fn(w.updated_at):null,b=w.updated_at||w.created_at,S=b?j??new Date(b).toLocaleString():null,E=v3[w.status]??w.status,M=(w.problem_type||((I=w.metadata)==null?void 0:I.resolved_problem_type)||((U=w.metadata)==null?void 0:U.problem_type)||"").toString(),O=((q=w.metadata)==null?void 0:q.cross_validation)??null,$=((H=w.metrics)==null?void 0:H.cross_validation)??null,P=typeof w.error_message=="string"?w.error_message.trim():"",A=[];if(A.push(`Model ${w.model_type}`),M&&A.push(M.charAt(0).toUpperCase()+M.slice(1)),O!=null&&O.enabled){const W=String(O.strategy??"auto"),B=W==="stratified_kfold"?"Stratified KFold":W==="kfold"?"KFold":"Auto CV",D=typeof O.folds=="number"?`${O.folds} folds`:"CV enabled";if(A.push(`${B} (${D})`),($==null?void 0:$.status)==="skipped"){const V=String(($==null?void 0:$.reason)??"unknown reason").replace(/_/g," ");A.push(`CV skipped (${V})`)}}else if(($==null?void 0:$.status)==="skipped"){const W=String(($==null?void 0:$.reason)??"unknown reason").replace(/_/g," ");A.push(`CV skipped (${W})`)}if(k&&A.push(`${k.label}: ${Op(k.value)}`),w.status==="failed"&&P){const W=P.replace(/\s+/g," ");A.push(`Error: ${W}`)}S&&A.push(`Updated ${S}`);const R=w.status==="running"||w.status==="queued",F=w.progress??0,z=w.current_step;return a.jsxs("li",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[a.jsxs("span",{children:[a.jsxs("strong",{children:["v",w.version]}),"  ",E]}),R&&a.jsx("button",{type:"button",onClick:W=>{W.stopPropagation(),y(w.id)},disabled:x.isPending,title:"Cancel this job (may not be immediate on Windows)",style:{padding:"2px 8px",fontSize:"0.75rem",fontWeight:500,color:"#b91c1c",background:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"4px",cursor:"pointer"},children:"Cancel"})]}),R&&a.jsxs("span",{style:{fontSize:"0.85em",color:"#666"},children:[F,"% ",z?` ${z}`:""]})]}),R&&a.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"#eee",borderRadius:"2px",overflow:"hidden"},children:a.jsx("div",{style:{width:`${F}%`,height:"100%",background:"linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%)",transition:"width 0.3s ease"}})}),a.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:A.length>0?A.join("  "):""})]},w.id)};return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Background training jobs"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginRight:"0.75rem"},children:[a.jsx("button",{type:"button",className:`btn ${m==="list"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>h("list"),style:{padding:"0.25rem 0.75rem",fontSize:"0.8rem"},children:"List"}),a.jsx("button",{type:"button",className:`btn ${m==="compare"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>h("compare"),style:{padding:"0.25rem 0.75rem",fontSize:"0.8rem"},children:"Compare"})]}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:s,disabled:t,children:t?"Refreshing":"Refresh jobs"})]})]}),a.jsx("p",{className:"canvas-modal__note",children:"Enqueue a background training job for this node. Jobs run via Celery, versioned per pipeline, and report metrics when finished."}),r&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Pipeline ID: ",a.jsx("code",{children:r})]}),i instanceof Error&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:i.message}),l&&!(i instanceof Error)&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:l.message||"Unable to load training jobs."}),u&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:u.message||"Unable to load tuning jobs."}),d&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:f>1?a.jsxs("span",{children:["Queued ",f," training jobs. Latest job ",d.id," (version ",d.version,")."]}):a.jsxs("span",{children:["Training job ",d.id," queued (version ",d.version,")."]})}),p&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading tuning jobs"}),t&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading recent jobs"}),n>0&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:n===1?"1 training job uses a different problem type. Switch the problem type to view it.":`${n} training jobs use a different problem type. Switch the problem type to view them.`}),!t&&e.length===0&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No training jobs found for this node."}),e.length>0&&(m==="list"?a.jsx("ul",{className:"canvas-modal__note-list",children:e.map(v)}):a.jsx(N3,{jobs:e}))]})},C3=({modelType:e,showAdvanced:t,hyperparamFields:n,hyperparamValues:s,onHyperparamChange:r,onToggleAdvanced:i,isLoading:l,error:u,primaryPreset:d,latestTuningJob:f,applyStatus:p,onApplyBestParams:m,onBrowsePresets:h,applyButtonDisabled:_,browsePresetsDisabled:x,latestTuningRunNumber:y,latestTuningRelative:v,primaryPresetRelative:w,primaryPresetScoreLabel:k,applyStatusColor:j,renderParameterField:b,hyperparametersParameter:S})=>{const E=M=>{var P;const O=s[M.name]??M.default,$=`hyperparam-${M.name}`;return a.jsxs("div",{className:"canvas-modal__parameter",children:[a.jsxs("label",{htmlFor:$,className:"canvas-modal__parameter-label",children:[M.label,M.description&&a.jsx("span",{className:"canvas-modal__parameter-description",children:M.description})]}),M.type==="number"&&a.jsx("input",{id:$,type:"number",className:"canvas-modal__parameter-input",value:O??"",onChange:A=>{const R=A.target.value;if(R===""&&M.nullable)r(M.name,null);else{const F=parseFloat(R);isNaN(F)||r(M.name,F)}},min:M.min,max:M.max,step:M.step,placeholder:M.nullable?"Empty = default":""}),M.type==="select"&&a.jsx("select",{id:$,className:"canvas-modal__parameter-select",value:O??"",onChange:A=>r(M.name,A.target.value),children:(P=M.options)==null?void 0:P.map(A=>a.jsx("option",{value:String(A.value),children:A.label},String(A.value)))}),M.type==="boolean"&&a.jsx("input",{id:$,type:"checkbox",className:"canvas-modal__parameter-checkbox",checked:!!O,onChange:A=>r(M.name,A.target.checked)}),M.type==="text"&&a.jsx("input",{id:$,type:"text",className:"canvas-modal__parameter-input",value:O??"",onChange:A=>r(M.name,A.target.value),placeholder:M.nullable?"Empty = default":""})]},M.name)};return!e&&S?a.jsx(a.Fragment,{children:b(S)}):!e||n.length===0?null:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"canvas-modal__parameter",style:{gridColumn:"1 / -1"},children:a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem",marginBottom:"0.75rem",padding:"0.75rem 1rem",background:"rgba(15, 23, 42, 0.35)",borderRadius:"6px",border:"1px solid rgba(148, 163, 184, 0.25)"},children:[a.jsxs("div",{style:{flex:"1 1 260px"},children:[a.jsx("strong",{style:{fontSize:"0.95rem",color:"#e2e8f0"},children:"Model Configuration"}),a.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:t?"Fine-tune hyperparameters or use defaults for quick training":"Using default hyperparameters  toggle Advanced to customize"}),(d||f)&&a.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",color:"rgba(148, 163, 184, 0.8)"},children:d?a.jsxs(a.Fragment,{children:[" Tuned parameters available for ",a.jsx("strong",{children:d.modelType}),d.runNumber?` (run ${d.runNumber})`:"",w?`  ${w}`:"",d.targetColumn?`  Target: ${d.targetColumn}`:"",k?`  ${k}`:""]}):a.jsxs(a.Fragment,{children:["Latest tuning run ",y||"N/A",v?`  ${v}`:"",f!=null&&f.model_type&&f.model_type!==e?` targeted ${f.model_type}.`:" did not produce reusable parameters for this configuration yet."]})}),p&&a.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",color:j},children:p.message})]}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center",justifyContent:"flex-end"},children:[a.jsx("button",{type:"button",onClick:m,disabled:_,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:_?"rgba(148, 163, 184, 0.55)":"#0c4a6e",background:_?"rgba(15, 23, 42, 0.35)":"rgba(191, 219, 254, 0.9)",border:_?"1px solid rgba(148, 163, 184, 0.35)":"1px solid rgba(147, 197, 253, 0.9)",borderRadius:"4px",cursor:_?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"130px",boxShadow:_?"none":"0 3px 10px rgba(14, 116, 144, 0.25)"},children:"Apply tuned params"}),a.jsx("button",{type:"button",onClick:h,disabled:x,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:x?"rgba(148, 163, 184, 0.55)":"rgba(168, 85, 247, 0.95)",background:x?"rgba(15, 23, 42, 0.35)":"rgba(76, 29, 149, 0.18)",border:x?"1px solid rgba(148, 163, 184, 0.35)":"1px solid rgba(168, 85, 247, 0.45)",borderRadius:"4px",cursor:x?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"150px"},children:"Browse tuned params"})]})]})}),l&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading hyperparameters"}),u&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--error",children:["Failed to load hyperparameters: ",u.message]}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(zd,{isOpen:t,onToggle:i,label:"Advanced Hyperparameters",description:e?`Configure ${e.replace(/_/g," ")} hyperparameters. Leave empty to use recommended defaults.`:"Configure model hyperparameters."}),t&&a.jsx("div",{className:"canvas-modal__parameter-grid",style:{marginTop:"0.5rem"},children:n.map(E)})]})]})},S3=({nodeId:e,sourceId:t,graph:n,config:s,runtimeConfig:r,cvConfig:i,draftConfigState:l,renderParameterField:u,modelTypeParameter:d,modelTypeOptions:f,hyperparametersParameter:p,cvEnabledParameter:m,cvStrategyParameter:h,cvFoldsParameter:_,cvShuffleParameter:x,cvRandomStateParameter:y,cvRefitStrategyParameter:v,onSaveDraftConfig:w})=>{var $e,Dt,Ps,es;const k=$a(),[j,b]=N.useState(null),[S,E]=N.useState(null),[M,O]=N.useState(null),[$,P]=N.useState(0),[A,R]=N.useState({}),[F,z]=N.useState(!1),I=N.useRef(!1),[U,q]=N.useState(null),[H,W]=N.useState(!1),[B,D]=N.useState(!1),[V,te]=N.useState(null),[G,K]=N.useState(null),[X,Q]=N.useState(!1),J=((s==null?void 0:s.targetColumn)??"").trim(),Z=(s==null?void 0:s.problemType)==="regression"?"regression":"classification",ee=((r==null?void 0:r.modelType)??"").trim(),de=(r==null?void 0:r.hyperparameters)??null,_e=(r==null?void 0:r.hyperparametersError)??null,ge=!!(i!=null&&i.enabled),be=(i==null?void 0:i.strategy)??"auto",ze=typeof(i==null?void 0:i.folds)=="number"?i.folds:0,Ee=!!(i!=null&&i.shuffle),ie=(i==null?void 0:i.randomState)??null,pe=(i==null?void 0:i.refitStrategy)??"train_plus_validation",Ce=N.useMemo(()=>d?f.length?{...d,options:f}:d:null,[f,d]),Te=Es({queryKey:["model-hyperparameters",ee],queryFn:()=>Pd(ee),enabled:!!ee,staleTime:5*60*1e3}),De=Es({queryKey:["best-hyperparameters",ee,U,t],queryFn:()=>Cw(ee,{pipelineId:U||void 0,datasetSourceId:t||void 0}),enabled:!!(ee&&t),staleTime:30*1e3,retry:1}),ce=(($e=Te.data)==null?void 0:$e.fields)??[],Oe=((Dt=Te.data)==null?void 0:Dt.defaults)??{},qe=N.useMemo(()=>ce.length?new Set(ce.map(ue=>ue.name)):new Set,[ce]),Qe=N.useMemo(()=>ce.length?ce.reduce((ue,we)=>(we!=null&&we.name&&(ue[we.name]=we),ue),{}):{},[ce]),Ye=N.useMemo(()=>{if(!ee||!de||qe.size===0)return null;const ue=Ap(de,qe);return Object.keys(ue).length>0?ue:null},[qe,de,ee]);N.useEffect(()=>{R({}),z(!1),I.current=!1},[ee]),N.useEffect(()=>{Ye&&(R(ue=>{const we=Object.keys(ue),Fe=Object.keys(Ye);return we.length===Fe.length&&Fe.every(ke=>Object.is(ue[ke],Ye[ke]))?ue:Ye}),I.current||(z(!0),I.current=!0))},[Ye]),N.useEffect(()=>{if(!ee||Ye||qe.size===0||!Oe||Object.keys(Oe).length===0)return;const ue=Ap(Oe,qe);Object.keys(ue).length!==0&&R(we=>Object.keys(we).length>0?we:ue)},[qe,Ye,Oe,ee]);const at=N.useMemo(()=>{if(qe.size===0)return null;const ue=x3(A,qe,Qe);return Object.keys(ue).length>0?ue:null},[qe,A]),et=N.useCallback(()=>{z(ue=>{const we=!ue;return we&&(I.current=!0),we})},[]),ot=N.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),Nt=N.useMemo(()=>{if(!ot)return null;if(!l||Object.keys(l).length===0)return ot;const ue=Pc(ot);return!ue||!Array.isArray(ue.nodes)||(ue.nodes=ue.nodes.map(we=>{if(!we||we.id!==e)return we;const Fe=(we==null?void 0:we.data)??{},ke={...(Fe==null?void 0:Fe.config)??{},...l};return{...we,data:{...Fe,config:ke,isConfigured:!0}}})),ue},[l,ot,e]);N.useEffect(()=>{let ue=!1;return!t||!ot?(q(null),()=>{ue=!0}):(Lo(t,ot).then(we=>{ue||q(we)}).catch(()=>{ue||q(null)}),()=>{ue=!0})},[ot,t]),N.useEffect(()=>{let ue=!1;E(null);const we=Nt??ot;return!t||!we?(b(null),()=>{ue=!0}):(Lo(t,we).then(Fe=>{ue||b(Fe)}).catch(Fe=>{ue||(E((Fe==null?void 0:Fe.message)??"Unable to compute pipeline ID"),b(null))}),()=>{ue=!0})},[ot,Nt,t]),N.useEffect(()=>{if(!j||!U){W(!1);return}W(j!==U)},[j,U]);const Tt=N.useMemo(()=>["feature-canvas","training-jobs",t??"none",j??"pending",e],[e,j,t]),tt=N.useMemo(()=>["feature-canvas","tuning-jobs",t??"none",j??"pending",e],[e,j,t]),Ft=!!(t&&e),Wt=Es({queryKey:tt,queryFn:async()=>{var we;const ue={datasetSourceId:t||void 0,limit:5};if(j){const Fe=await wc({...ue,pipelineId:j});if((((we=Fe==null?void 0:Fe.jobs)==null?void 0:we.length)??0)>0)return Fe}return wc(ue)},enabled:Ft,retry:(ue,we)=>we.message.includes("Sign in")?!1:ue<2,refetchInterval:ue=>{const we=ue.state.data;return((we==null?void 0:we.jobs)??[]).some(ke=>ke.status==="queued"||ke.status==="running")?5e3:!1}}),Pt=Es({queryKey:Tt,queryFn:async()=>{var we;const ue={datasetSourceId:t||void 0,nodeId:e,limit:5};if(j){const Fe=await bc({...ue,pipelineId:j});if((((we=Fe==null?void 0:Fe.jobs)==null?void 0:we.length)??0)>0)return Fe}return bc(ue)},enabled:Ft,retry:(ue,we)=>we.message.includes("Sign in")?!1:ue<2,refetchInterval:ue=>{const we=ue.state.data;return((we==null?void 0:we.jobs)??[]).some(ke=>ke.status==="queued"||ke.status==="running")?5e3:!1}}),{mutateAsync:bn,isPending:gn,error:jt}=Oi({mutationFn:vw,onSuccess:ue=>{const we=Array.isArray(ue.jobs)?ue.jobs.length:0,Fe=we>0?ue.jobs[0]:null;O(Fe),P(we),k.invalidateQueries({queryKey:Tt})}}),cn=Wt.error,un=Wt.isLoading||Wt.isFetching,Lt=((Ps=Wt.data)==null?void 0:Ps.jobs)??[],ut=De.data,wn=N.useCallback(ue=>{if(!ue)return null;const we=Object.keys(ue);if(we.length===0)return null;if(qe.size===0)return{params:ue,hasUnmapped:!1};const Fe=Ap(ue,qe),gt=Object.keys(Fe);return gt.length>0?{params:Fe,hasUnmapped:gt.length!==we.length}:{params:ue,hasUnmapped:!0}},[qe]),ht=N.useMemo(()=>Lt.length?Lt.filter(ue=>ue.status==="succeeded"):[],[Lt]),Bt=N.useMemo(()=>{if(!ee)return[];const ue=[],we=new Set,Fe=J?J.trim().toLowerCase():"",gt=ke=>!Fe||!ke?!0:ke.trim().toLowerCase()===Fe;if(ut!=null&&ut.available&&ut.best_params&&(!ut.model_type||ut.model_type===ee)){const ke=wn(ut.best_params);if(ke){const kt=ut.job_id??null;if(!kt||!we.has(kt)){const nt=["Most recent tuned run"];ut.run_number&&nt.push(`#${ut.run_number}`);const nn=`best-api-${kt??ee}`;ue.push({id:nn,label:nt.join(" "),source:"best-api",modelType:ut.model_type??ee,params:ke.params,jobId:kt,nodeId:ut.node_id??null,runNumber:ut.run_number??null,score:ut.best_score??null,scoring:ut.scoring??null,finishedAt:ut.finished_at??null,searchStrategy:ut.search_strategy??null,nIterations:ut.n_iterations??null,targetColumn:J||null,pipelineId:ut.pipeline_id??null,datasetSourceId:t??null,description:ke.hasUnmapped?"Includes parameters outside the current template. They will be stored as custom overrides.":null}),kt&&we.add(kt)}}}return ht.forEach(ke=>{var ts,Tn,Pn,xs,jn;if(!ke.best_params||ke.model_type!==ee||t&&ke.dataset_source_id&&ke.dataset_source_id!==t||we.has(ke.id))return;const kt=wn(ke.best_params);if(!kt)return;const nt=typeof((ts=ke.metadata)==null?void 0:ts.target_column)=="string"?ke.metadata.target_column:typeof((Tn=ke.metadata)==null?void 0:Tn.targetColumn)=="string"?ke.metadata.targetColumn:null;if(!gt(nt))return;const nn=`job-${ke.id}`,vn=(()=>{var bs;const Ln=typeof((bs=ke.metadata)==null?void 0:bs.label)=="string"?ke.metadata.label.trim():"";return Ln||(ke.run_number?`Run ${ke.run_number}`:`Job ${ke.id.slice(0,6)}`)})(),Mt=typeof((Pn=ke.metadata)==null?void 0:Pn.scoring)=="string"?ke.metadata.scoring:typeof((xs=ke.metrics)==null?void 0:xs.scoring)=="string"?ke.metrics.scoring:null,Zt=typeof((jn=ke.metadata)==null?void 0:jn.n_iterations)=="number"?ke.metadata.n_iterations:null;ue.push({id:nn,label:vn,source:"tuning-job",modelType:ke.model_type,params:kt.params,jobId:ke.id,nodeId:ke.node_id,runNumber:ke.run_number??null,score:ke.best_score??null,scoring:Mt,finishedAt:ke.updated_at??ke.created_at??null,searchStrategy:ke.search_strategy??null,nIterations:Zt,targetColumn:nt??(J||null),pipelineId:ke.pipeline_id??null,datasetSourceId:ke.dataset_source_id??null,description:kt.hasUnmapped?"Some tuned parameters fall outside the current template and will be saved as custom overrides.":null}),we.add(ke.id)}),ue.sort((ke,kt)=>{const nt=ke.finishedAt?Date.parse(ke.finishedAt):0,nn=kt.finishedAt?Date.parse(kt.finishedAt):0;return nt!==nn?nn-nt:(kt.runNumber??0)-(ke.runNumber??0)}),ue},[ut,wn,ee,t,J,ht]),mt=Bt[0]??null,Vn=Bt.length>0,_n=!mt,ls=!Vn,xt=N.useMemo(()=>ht.length?ht.slice().sort((ue,we)=>{const Fe=Date.parse(ue.updated_at||ue.created_at||"0");return Date.parse(we.updated_at||we.created_at||"0")-Fe})[0]:Lt.length?Lt.slice().sort((ue,we)=>{const Fe=Date.parse(ue.updated_at||ue.created_at||"0");return Date.parse(we.updated_at||we.created_at||"0")-Fe})[0]:null,[ht,Lt]),pt=xt&&(xt.updated_at||xt.created_at)||null,yn=pt?Fn(pt):null,ys=(xt==null?void 0:xt.run_number)??null,dn=mt!=null&&mt.finishedAt?Fn(mt.finishedAt):null,Xt=mt&&mt.scoring&&typeof mt.score=="number"&&Number.isFinite(mt.score)?`${mt.scoring}: ${Op(mt.score)}`:null;N.useEffect(()=>{if(!Bt.length){V&&te(null),(G==null?void 0:G.tone)==="success"&&K(null);return}V&&!Bt.some(ue=>ue.id===V)&&(te(null),K(null))},[G,Bt,V]);const tn=N.useCallback((ue,we)=>{if(!ue||Object.keys(ue.params??{}).length===0){K({message:"Selected preset does not include any hyperparameters to apply.",tone:"warning"});return}R(()=>Pc(ue.params)),z(!0),I.current=!0,te(ue.id),K({message:we??`Applied tuned parameters from ${ue.label}.`,tone:"success"})},[R,z,K,te]),Nn=N.useCallback(()=>{if(!mt){const we=xt&&xt.model_type&&xt.model_type!==ee?`Latest tuning run targeted ${xt.model_type}. Switch the model template to reuse its parameters.`:"No tuning job results available to apply.";K({message:we,tone:"warning"});return}const ue=mt.runNumber?`Applied tuned parameters from run ${mt.runNumber}.`:`Applied tuned parameters from ${mt.label}.`;tn(mt,ue)},[tn,xt,ee,mt,K]),Wn=N.useMemo(()=>{if(!G)return"rgba(148, 163, 184, 0.75)";switch(G.tone){case"success":return"rgba(134, 239, 172, 0.9)";case"warning":return"rgba(253, 186, 116, 0.95)";default:return"rgba(148, 163, 184, 0.85)"}},[G]),Yn=N.useMemo(()=>{const ue=[];return t||ue.push("Select a dataset before launching training jobs."),(!ot||!ot.nodes.length)&&ue.push("Connect this node to an upstream pipeline before training."),J||ue.push("Set a target column in the Train model readiness section."),ee||ue.push("Choose a model type before enqueuing training jobs."),ge&&ze<2&&ue.push("Cross-validation requires at least 2 folds."),S&&ue.push(S),_e&&ue.push(_e),ue},[ge,ze,ot,_e,ee,S,t,J]),vt=((es=Pt.data)==null?void 0:es.jobs)??[],Yt=N.useMemo(()=>{if(!vt.length)return vt;const ue=Z==null?void 0:Z.toLowerCase();return vt.filter(we=>{if(!ue)return!0;const Fe=(()=>{var nn,vn,Mt,Zt;const ke=typeof we.problem_type=="string"?we.problem_type:null,kt=typeof((nn=we.metadata)==null?void 0:nn.problem_type)=="string"?(vn=we.metadata)==null?void 0:vn.problem_type:null,nt=typeof((Mt=we.metadata)==null?void 0:Mt.resolved_problem_type)=="string"?(Zt=we.metadata)==null?void 0:Zt.resolved_problem_type:null;return(ke||nt||kt||"").toLowerCase()})();if(Fe)return Fe===ue;const gt=String(we.model_type||"").toLowerCase();return ue==="regression"?gt.includes("regress"):ue==="classification"?gt.includes("classif"):!0})},[vt,Z]),Jn=N.useMemo(()=>!!(jt instanceof Error&&rl(jt.message)||M&&Tc(M)||vt.some(ue=>Tc(ue))||Lt.some(ue=>Tc(ue))),[jt,vt,M,Lt]),$n=JN({graph:n,nodeId:e,modelType:ee,problemType:Z,modelTypeOptions:f,enabled:Jn});N.useEffect(()=>{$n||Q(!1)},[$n]);const Xs=Math.max(vt.length-Yt.length,0),vs=Pt.isLoading||Pt.isFetching,cs=Pt.error,$s=Yn.length>0||!j||!t||!ot||gn,Kt=N.useCallback((ue,we)=>{R(Fe=>({...Fe,[ue]:we}))},[]);N.useCallback(ue=>{var gt;const we=A[ue.name]??ue.default,Fe=`hyperparam-${e}-${ue.name}`;return a.jsxs("div",{className:"canvas-modal__parameter",children:[a.jsxs("label",{htmlFor:Fe,className:"canvas-modal__parameter-label",children:[ue.label,ue.description&&a.jsx("span",{className:"canvas-modal__parameter-description",children:ue.description})]}),ue.type==="number"&&a.jsx("input",{id:Fe,type:"number",className:"canvas-modal__parameter-input",value:we??"",onChange:ke=>{const kt=ke.target.value;if(kt===""&&ue.nullable)Kt(ue.name,null);else{const nt=parseFloat(kt);isNaN(nt)||Kt(ue.name,nt)}},min:ue.min,max:ue.max,step:ue.step,placeholder:ue.nullable?"Empty = default":""}),ue.type==="select"&&a.jsx("select",{id:Fe,className:"canvas-modal__parameter-select",value:we??"",onChange:ke=>Kt(ue.name,ke.target.value),children:(gt=ue.options)==null?void 0:gt.map(ke=>a.jsx("option",{value:String(ke.value),children:ke.label},String(ke.value)))}),ue.type==="boolean"&&a.jsx("input",{id:Fe,type:"checkbox",className:"canvas-modal__parameter-checkbox",checked:!!we,onChange:ke=>Kt(ue.name,ke.target.checked)}),ue.type==="text"&&a.jsx("input",{id:Fe,type:"text",className:"canvas-modal__parameter-input",value:we??"",onChange:ke=>Kt(ue.name,ke.target.value),placeholder:ue.nullable?"Empty = default":""})]},ue.name)},[A,Kt,e]);const Ts=N.useCallback(async()=>{if(!j||!t||!ee)return;if(H&&w){try{const nt=w({closeModal:!1});nt&&typeof nt.then=="function"&&await nt,W(!1)}catch{}await new Promise(nt=>setTimeout(nt,100))}const ue=Nt??ot;if(!ue)return;const we={};J&&(we.target_column=J),we.problem_type=Z,we.cross_validation={enabled:ge,strategy:be,folds:ze,shuffle:Ee,random_state:ie,refit_strategy:pe};const Fe=Object.keys(we).length?we:void 0,gt=Pc(ue);gt&&Array.isArray(gt.nodes)&&(gt.nodes=gt.nodes.map(nt=>{if(!nt||nt.id!==e)return nt;const nn=(nt==null?void 0:nt.data)??{},vn=(nn==null?void 0:nn.config)??{},Mt=l?{...vn,...l}:vn;return{...nt,data:{...nn,config:Mt,isConfigured:!0}}}));const ke=ee?[ee]:[],kt={dataset_source_id:t,pipeline_id:j,node_id:e,model_type:ee||void 0,model_types:ke.length?ke:void 0,hyperparameters:F&&at?Pc(at):void 0,metadata:Fe,job_metadata:Fe,run_training:!0,graph:gt??Pc(ue),target_node_id:e};try{await bn(kt)}catch{}},[ge,ze,ie,pe,Ee,be,l,bn,ot,Nt,H,ee,e,w,j,Z,at,F,t,J]),Ut=N.useCallback(()=>{Ft&&Pt.refetch()},[Ft,Pt]);return a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Model Training"})}),a.jsx("p",{className:"canvas-modal__note",children:"Configure and launch training jobs."}),j&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Pipeline ID: ",a.jsx("code",{children:j})]}),H&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{background:"rgba(251, 146, 60, 0.1)",borderLeft:"3px solid rgba(251, 146, 60, 0.8)",padding:"0.75rem 1rem",margin:"0.75rem 0",display:"flex",alignItems:"start",gap:"0.5rem"},children:[a.jsx(za,{size:16,style:{marginTop:"2px",flexShrink:0}}),a.jsxs("span",{children:[a.jsx("strong",{children:"Unsaved Configuration Changes"}),a.jsx("br",{}),"Your changes will create a new training pipeline. Previous jobs remain under the old configuration. Jobs will auto-save when you launch training."]})]}),Yn.map((ue,we)=>a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:ue},`training-prereq-${we}`)),jt instanceof Error&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:jt.message}),cs&&!(jt instanceof Error)&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:cs.message||"Unable to load training jobs."}),cn&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:cn.message||"Unable to load tuning jobs."}),M&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:$>1?a.jsxs("span",{children:["Queued ",$," training jobs. Latest job ",M.id," (version ",M.version,")."]}):a.jsxs("span",{children:["Training job ",M.id," queued (version ",M.version,")."]})}),un&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading tuning jobs"}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[Ce&&u(Ce),m&&u(m),ge&&a.jsxs(a.Fragment,{children:[h&&u(h),_&&u(_),x&&u(x),y&&u(y),v&&u(v)]}),a.jsx(C3,{modelType:ee,showAdvanced:F,hyperparamFields:ce,hyperparamValues:A,onHyperparamChange:Kt,onToggleAdvanced:et,isLoading:Te.isLoading,error:Te.error,primaryPreset:mt,latestTuningJob:xt,applyStatus:G,onApplyBestParams:Nn,onBrowsePresets:()=>D(!0),applyButtonDisabled:_n,browsePresetsDisabled:ls,latestTuningRunNumber:ys,latestTuningRelative:yn,primaryPresetRelative:dn,primaryPresetScoreLabel:Xt,applyStatusColor:Wn,renderParameterField:u,hyperparametersParameter:p})]}),ge&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Cross-validation runs ",ze," folds before refitting on"," ",pe==="train_plus_validation"?"training plus validation data.":"training data only."]}),$n&&a.jsxs("div",{className:"canvas-modal__note canvas-modal__note--warning",style:{margin:"0.75rem 0",borderLeft:"3px solid rgba(251, 191, 36, 0.9)",background:"rgba(251, 191, 36, 0.12)",padding:"0.75rem 1rem"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"0.75rem"},children:[a.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"start"},children:[a.jsx(za,{size:16,style:{marginTop:"2px",flexShrink:0}}),a.jsxs("div",{children:[a.jsx("strong",{children:$n.headline}),a.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem"},children:$n.summary})]})]}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Q(ue=>!ue),style:{whiteSpace:"nowrap"},children:X?"Hide tips":"Show tips"})]}),X&&a.jsx("ul",{style:{margin:"0.75rem 0 0 1rem",padding:0,listStyle:"disc",fontSize:"0.85rem"},children:$n.details.map((ue,we)=>a.jsx("li",{style:{marginBottom:"0.35rem"},children:ue},`scaling-tip-${we}`))})]}),a.jsx("div",{className:"canvas-modal__actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:Ts,disabled:$s,children:gn?"Queuing":"Launch training job"})}),a.jsx(c3,{presets:Bt,isOpen:B,onClose:()=>D(!1),onApply:ue=>{tn(ue),D(!1)},activePresetId:V,fieldMetadata:Qe})]}),a.jsx(j3,{jobs:Yt,isLoading:vs,hiddenJobCount:Xs,onRefresh:Ut,pipelineId:j,createJobError:jt instanceof Error?jt:null,jobsError:cs,tuningJobsError:cn,lastCreatedJob:M,lastCreatedJobCount:$,isTuningJobsLoading:un})]})},E3=new Set(["true","1","yes","on"]),k3=new Set(["false","0","no","off"]),M3=["auto_detect","autoDetect","auto_detect_columns","auto","auto_detect_text"],nj=new Set(["true","1","yes","y","on","t"]),sj=new Set(["false","0","no","n","off","f"]),Ro=e=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:null:null;if(typeof e=="string"){const t=e.trim().toLowerCase();if(!t)return null;if(E3.has(t))return!0;if(k3.has(t))return!1}return null},ol=e=>{if(!(!e||typeof e!="object")){for(const t of M3)if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}},Yd=e=>{if(e==null)return{};try{return JSON.parse(JSON.stringify(e))}catch{return Array.isArray(e)?[...e]:typeof e=="object"?{...e}:e}},$p=e=>Array.isArray(e)?e.map(t=>$p(t)):e&&typeof e=="object"?Object.keys(e).sort().reduce((t,n)=>(t[n]=$p(e[n]),t),{}):e,Lc=e=>e===void 0?"":JSON.stringify($p(e)),rj=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0},A3=(e,t)=>{const n=[],s=m=>{n.includes(m)||n.push(m)},r=(e??"").toLowerCase();if(!t.length)return n;const i=t.filter(m=>m!=null);if(!i.length)return n;const l=i.reduce((m,h)=>{if(typeof h=="number"&&Number.isFinite(h))return m+1;if(typeof h=="string"){const _=h.trim();if(!_)return m;const x=Number(_);if(!Number.isNaN(x)&&Number.isFinite(x))return m+1}return m},0),u=i.reduce((m,h)=>{const _=String(h).trim().toLowerCase();return _&&(nj.has(_)||sj.has(_))?m+1:m},0),d=(()=>{const m=new Set;return i.forEach(h=>{m.add(String(h).trim().toLowerCase())}),m.size})(),f=l/i.length,p=u/i.length;if(r.includes("object")||r.includes("string"))return p>=.7&&s("boolean"),f>=.7&&s("float64"),d>0&&d<=20&&s("category"),n;if(r.includes("float")){const m=i.reduce((h,_)=>{if(typeof _=="number")return Number.isInteger(_)?h+1:h;if(typeof _=="string"){const x=_.trim();if(!x)return h;const y=Number(x);if(!Number.isNaN(y)&&Number.isFinite(y)&&Number.isInteger(y))return h+1}return h},0);return p>=.8&&s("boolean"),i.length>0&&m/i.length>=.9&&s("Int64"),n}return r.includes("int")&&p>=.7&&s("boolean"),n},Kd=[{value:"train",label:"Train",accent:"train"},{value:"test",label:"Test",accent:"test"},{value:"validation",label:"Validation",accent:"validation"}],Gd={train:0,test:1,validation:2},O3=["train","test","validation"],Tp=e=>Array.isArray(e)?e.map(t=>typeof t=="string"?t:String(t??"")).map(t=>t.trim().toLowerCase()).filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim().toLowerCase()).filter(Boolean):[],zc=e=>{const t=new Set(Kd.map(r=>r.value)),n=[];e.forEach(r=>{if(r){if(r==="training"&&(r="train"),r==="valid"||r==="val"){n.push("validation");return}t.has(r)&&n.push(r)}});const s=new Set;return n.filter(r=>s.has(r)?!1:(s.add(r),!0)).sort((r,i)=>Gd[r]-Gd[i])},$3=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0},Pp=(e,t)=>{const n=Ro(e);return n===null?t:n},aj=(e,t)=>{if(typeof e=="number"&&Number.isFinite(e)&&e>0)return Math.round(e);if(typeof e=="string"&&e.trim()){const n=Number(e);if(Number.isFinite(n)&&n>0)return Math.round(n)}return t},oj=e=>{if(!e)return 0;const t=Date.parse(e);return Number.isFinite(t)?t:0},ij=e=>{const t=Kd.find(n=>n.value===e);return t?t.label:e.charAt(0).toUpperCase()+e.slice(1)},T3=e=>{const t=e.replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1)},P3=e=>{const t=[];e.model_type&&t.push(e.model_type),typeof e.version=="number"&&t.push(`v${e.version}`),t.push(` ${T3(e.status)}`);const n=Fn(e.updated_at??e.created_at);return n&&t.push(`(${n})`),t.join(" ")},Xd=e=>!Number.isFinite(e)||e<0?0:e>1?1:e,lj=e=>{if(!e||typeof e!="object")return[];const t=[];return Object.entries(e).forEach(([n,s])=>{typeof s=="number"&&Number.isFinite(s)&&t.push({key:n,value:s})}),t.sort((n,s)=>n.key.localeCompare(s.key)),t},cj=(e,t)=>{if(!Number.isFinite(e))return"";const n=t(e*100,Math.abs(e)>=.1?1:2);return n?`${n}%`:""},L3=({nodeId:e,sourceId:t,graph:n,config:s,setConfigState:r,renderParameterField:i,formatMetricValue:l,connectedSplitHandles:u})=>{var Ee;const d=$a(),f=N.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),p=N.useMemo(()=>{if(!f)return[];const ie=new Map;f.nodes.forEach(Ce=>{Ce!=null&&Ce.id&&ie.set(Ce.id,Ce)});const pe=new Set;return f.edges.forEach(Ce=>{var De;if(!Ce||Ce.target!==e)return;const Te=ie.get(Ce.source);((De=Te==null?void 0:Te.data)==null?void 0:De.catalogType)==="train_model_draft"&&pe.add(Te.id)}),pe.size>0?Array.from(pe):f.nodes.filter(Ce=>{var Te;return((Te=Ce==null?void 0:Ce.data)==null?void 0:Te.catalogType)==="train_model_draft"}).map(Ce=>Ce.id)},[f,e]),m=N.useMemo(()=>p.length?p.slice().sort().join("|"):"all",[p]),[h,_]=N.useState(null),[x,y]=N.useState(null);N.useEffect(()=>{let ie=!1;return y(null),!t||!f?(_(null),()=>{ie=!0}):(Lo(t,f).then(pe=>{ie||_(pe)}).catch(pe=>{ie||(y((pe==null?void 0:pe.message)??"Unable to compute pipeline signature."),_(null))}),()=>{ie=!0})},[f,t]);const v=N.useMemo(()=>{const ie=s==null?void 0:s.training_job_id;return typeof ie=="string"?ie.trim():typeof ie=="number"?String(ie):""},[s==null?void 0:s.training_job_id]),w=N.useMemo(()=>zc(Tp(s==null?void 0:s.splits)),[s==null?void 0:s.splits]),k=N.useMemo(()=>w.length?w:O3,[w]);N.useEffect(()=>{u&&r(ie=>{const pe=ie??{},Ce=zc(Tp(pe.splits)),Te=Ce.filter(ce=>u[ce]!==!1);if(Te.length===Ce.length&&Te.every((ce,Oe)=>ce===Ce[Oe]))return ie;const De={...pe};return Te.length?De.splits=Te:delete De.splits,De})},[u,r]);const j=N.useMemo(()=>u?k.filter(ie=>u[ie]!==!1):k,[u,k]),b=N.useMemo(()=>u?Kd.filter(ie=>u[ie.value]===!1).map(ie=>ie.label):[],[u]),S=N.useMemo(()=>{if(!b.length)return"";if(b.length===1)return b[0];if(b.length===2)return`${b[0]} and ${b[1]}`;const ie=b[b.length-1];return`${b.slice(0,-1).join(", ")}, and ${ie}`},[b]),E=j.length>0,M=Pp(s==null?void 0:s.include_confusion,!0),O=Pp(s==null?void 0:s.include_curves,!0),$=Pp(s==null?void 0:s.include_residuals,!0),P=aj(s==null?void 0:s.max_curve_points,500),A=aj(s==null?void 0:s.max_scatter_points,750),R=typeof(s==null?void 0:s.last_evaluated_at)=="string"?s.last_evaluated_at:null,[F,z]=N.useState(null),[I,U]=N.useState("details"),q=N.useRef(!1);N.useEffect(()=>{z(null),q.current=!1},[v]),N.useEffect(()=>{U("details")},[F==null?void 0:F.job_id]);const H=N.useMemo(()=>["feature-canvas","model-evaluation",t??"none",h??"pending",m],[h,t,m]),W=Es({queryKey:H,queryFn:async()=>{const ie={datasetSourceId:t||void 0,limit:50},pe=new Map,Ce=[];let Te=null;const De=Qe=>{Array.isArray(Qe)&&Qe.forEach(Ye=>{Ye&&!pe.has(Ye.id)&&pe.set(Ye.id,Ye)})},ce=async Qe=>{try{const Ye=await bc(Qe);return De(Ye==null?void 0:Ye.jobs),Ye}catch(Ye){return Ye instanceof Error&&Ce.push(Ye),null}};if(h&&await ce({...ie,pipelineId:h}),p.length&&await Promise.all(p.map(Qe=>ce({...ie,nodeId:Qe}))),Te=await ce(ie),!pe.size){if(Te)return Te;if(Ce.length)throw Ce[0];return{jobs:[],total:0}}const Oe=Array.from(pe.values());Oe.sort((Qe,Ye)=>oj(Ye.updated_at??Ye.created_at)-oj(Qe.updated_at??Qe.created_at));const qe=(Te==null?void 0:Te.total)??Oe.length;return{jobs:Oe,total:qe}},enabled:!!t,staleTime:30*1e3,retry:(ie,pe)=>pe.message.includes("Sign in")?!1:ie<2,refetchInterval:ie=>{const pe=ie.state.data;return((pe==null?void 0:pe.jobs)??[]).some(De=>De.status==="queued"||De.status==="running")?5e3:!1}}),B=((Ee=W.data)==null?void 0:Ee.jobs)??[],D=N.useMemo(()=>{const ie=new Map;return B.forEach(pe=>{ie.set(pe.id,pe)}),ie},[B]),V=N.useMemo(()=>B.filter(ie=>ie.status==="succeeded"),[B]),te=N.useMemo(()=>V.map(ie=>({value:ie.id,label:P3(ie)})),[V]),G=v?D.get(v)??null:null,K=Es({queryKey:["feature-canvas","training-job",v||"none"],queryFn:()=>bw(v),enabled:!!v,staleTime:30*1e3});N.useEffect(()=>{var Qe,Ye;const ie=K.data;if(!ie)return;const pe=(Qe=ie.metrics)==null?void 0:Qe.evaluation;if(!pe||typeof pe!="object")return;const Ce=pe.splits;if(!Ce||typeof Ce!="object")return;const Te={};Object.entries(Ce).forEach(([at,et])=>{et&&typeof et=="object"&&(Te[at]=et)});const De=typeof pe.generated_at=="string"?pe.generated_at:R??ie.updated_at??ie.created_at??new Date().toISOString(),ce=pe.problem_type==="regression"?"regression":"classification",Oe={job_id:ie.id,pipeline_id:ie.pipeline_id,node_id:ie.node_id,generated_at:De,problem_type:ce,target_column:pe.target_column??((Ye=ie.metadata)==null?void 0:Ye.target_column)??null,splits:Te};z(Oe),De&&De!==R&&r(at=>({...at??{},last_evaluated_at:De}));const qe=zc(Object.keys(Te));qe.length&&!q.current&&!$3(w,qe)&&r(at=>({...at??{},splits:qe}))},[K.data,R,r,w]);const X=Oi({mutationFn:async ie=>{if(!v)throw new Error("Select a training job before running evaluation.");return ww(v,ie)},onSuccess:ie=>{z(ie),r(pe=>({...pe??{},training_job_id:v,splits:ie.splits?Object.keys(ie.splits):j,include_confusion:M,include_curves:O,include_residuals:$,max_curve_points:P,max_scatter_points:A,last_evaluated_at:ie.generated_at})),d.invalidateQueries({queryKey:["feature-canvas","training-job",v]})}}),Q=N.useCallback(ie=>{const pe=ie.target.value;X.reset(),r(Ce=>{const Te={...Ce??{}};return pe?Te.training_job_id=pe:delete Te.training_job_id,Te})},[X,r]),J=N.useCallback(ie=>{u&&u[ie]===!1||(X.reset(),q.current=!0,r(pe=>{const Ce=zc(Tp(pe==null?void 0:pe.splits)),Te=Ce.includes(ie);let De;if(Te){if(Ce.length<=1)return pe??{};De=Ce.filter(ce=>ce!==ie)}else De=zc([...Ce,ie]);return{...pe??{},splits:De}}))},[u,X,r]),Z=N.useCallback((ie,pe)=>{X.reset(),r(Ce=>({...Ce??{},[ie]:pe}))},[X,r]),ee=N.useCallback(()=>{if(!v)return;const ie={splits:j,include_confusion:M,include_curves:O,include_residuals:$,max_curve_points:O?P:void 0,max_scatter_points:$?A:void 0};X.mutate(ie)},[X,M,O,$,P,A,v,j]),de=F?Fn(F.generated_at):R?Fn(R):null,_e=N.useMemo(()=>F?Object.entries(F.splits).sort((ie,pe)=>{const[Ce]=ie,[Te]=pe,De=Gd[Ce]??99,ce=Gd[Te]??99;return De-ce}):[],[F]),ge=N.useMemo(()=>{if(!F||!_e.length)return null;const ie=_e.map(([Ce,Te])=>{const De=lj(Te.metrics).reduce((ce,Oe)=>(ce[Oe.key]=Oe.value,ce),{});return{key:Ce,label:ij(Ce),rowCount:typeof Te.row_count=="number"?Te.row_count:null,metrics:De}}),pe=Array.from(new Set(ie.flatMap(Ce=>Object.keys(Ce.metrics)))).sort((Ce,Te)=>Ce.localeCompare(Te));return{splits:ie,metricKeys:pe}},[_e,F]),be=N.useMemo(()=>ge?ge.splits.length<=1?"Connect at least two splits to compare results.":ge.metricKeys.length?null:"No numeric metrics available for comparison yet.":"Run an evaluation to compare metrics.",[ge]);N.useEffect(()=>{I==="comparison"&&be&&U("details")},[I,be]);const ze=N.useCallback(ie=>{ie==="comparison"&&be||U(ie)},[be]);return a.jsxs("div",{className:"canvas-modal__section node-settings__evaluation",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Model Evaluation"}),a.jsx("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:de&&a.jsxs("span",{className:"evaluation-status",children:["Last ran ",de]})})]}),a.jsxs("div",{className:"evaluation-controls",children:[a.jsxs("label",{className:"evaluation-control",children:[a.jsx("span",{className:"evaluation-control__label",children:"Training job"}),a.jsxs("select",{className:"evaluation-control__select",value:v,onChange:Q,disabled:W.isLoading||W.isFetching,children:[a.jsx("option",{value:"",children:"Select a trained model"}),te.map(ie=>a.jsx("option",{value:ie.value,children:ie.label},ie.value))]}),W.isLoading&&a.jsx("span",{className:"evaluation-hint",children:"Loading training jobs"}),W.error&&a.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:W.error.message}),!W.isLoading&&!te.length&&a.jsx("span",{className:"evaluation-hint",children:"No successful training jobs detected yet."}),x&&a.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:x})]}),a.jsxs("div",{className:"evaluation-control",children:[a.jsx("span",{className:"evaluation-control__label",children:"Dataset splits"}),a.jsx("div",{className:"evaluation-split-toggle",children:Kd.map(ie=>{const pe=u?u[ie.value]!==!1:!0,Ce=pe&&j.includes(ie.value);return a.jsxs("label",{className:`evaluation-chip evaluation-chip--${ie.accent} ${Ce?"evaluation-chip--active":""}`,"aria-disabled":!pe,title:pe?void 0:`${ie.label} split is not connected`,style:pe?void 0:{opacity:.45,cursor:"not-allowed",borderStyle:"dashed"},children:[a.jsx("input",{type:"checkbox",checked:Ce,disabled:!pe,onChange:()=>J(ie.value)}),a.jsx("span",{children:ie.label})]},ie.value)})}),b.length>0&&a.jsxs("span",{className:"evaluation-hint evaluation-hint--warning",children:["Connect ",S," split",b.length>1?"s":""," to enable diagnostics."]}),!E&&a.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"No dataset splits are available. Attach a train, validation, or test split to run evaluation."})]}),a.jsxs("div",{className:"evaluation-control evaluation-control--toggles",children:[a.jsxs("label",{className:"evaluation-toggle",children:[a.jsx("input",{type:"checkbox",checked:M,onChange:ie=>Z("include_confusion",ie.target.checked)}),a.jsx("span",{children:"Confusion matrix"})]}),a.jsxs("label",{className:"evaluation-toggle",children:[a.jsx("input",{type:"checkbox",checked:O,onChange:ie=>Z("include_curves",ie.target.checked)}),a.jsx("span",{children:"ROC / PR curves"})]}),a.jsxs("label",{className:"evaluation-toggle",children:[a.jsx("input",{type:"checkbox",checked:$,onChange:ie=>Z("include_residuals",ie.target.checked)}),a.jsx("span",{children:"Residual diagnostics"})]})]})]}),a.jsxs("div",{className:"evaluation-actions",children:[a.jsx("button",{type:"button",className:"evaluation-button",onClick:ee,disabled:!v||X.isPending||!E,children:X.isPending?"Running":"Run evaluation"}),G&&G.status!=="succeeded"&&a.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"Selected job is not marked as succeeded; results may be incomplete."}),!E&&a.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"Connect at least one dataset split to run evaluation diagnostics."}),X.isError&&a.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:X.error.message}),X.isSuccess&&F&&a.jsxs("span",{className:"evaluation-hint evaluation-hint--success",children:["Diagnostics generated ",Fn(F.generated_at),"."]}),K.error&&a.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:K.error.message})]}),F?a.jsxs("div",{className:"node-settings__evaluation-results",children:[a.jsxs("div",{className:"evaluation-summary",children:[a.jsxs("div",{children:[a.jsx("span",{className:"evaluation-summary__label",children:"Problem type"}),a.jsx("span",{className:"evaluation-summary__value",children:F.problem_type==="regression"?"Regression":"Classification"})]}),F.target_column&&a.jsxs("div",{children:[a.jsx("span",{className:"evaluation-summary__label",children:"Target column"}),a.jsx("span",{className:"evaluation-summary__value",children:F.target_column})]}),a.jsxs("div",{children:[a.jsx("span",{className:"evaluation-summary__label",children:"Evaluation time"}),a.jsx("span",{className:"evaluation-summary__value",children:Fn(F.generated_at)??F.generated_at})]})]}),a.jsxs("div",{className:"evaluation-tabs",role:"tablist","aria-label":"Evaluation views",children:[a.jsx("button",{type:"button",className:`evaluation-tab ${I==="details"?"evaluation-tab--active":""}`,role:"tab","aria-selected":I==="details",onClick:()=>ze("details"),children:"Split details"}),a.jsx("button",{type:"button",className:`evaluation-tab ${I==="comparison"?"evaluation-tab--active":""}`,role:"tab","aria-selected":I==="comparison","aria-disabled":!!be,disabled:!!be,title:be??void 0,onClick:()=>ze("comparison"),children:"Split comparison"})]}),I==="comparison"&&ge?a.jsx(z3,{comparison:ge,formatMetricValue:l}):_e.map(([ie,pe])=>a.jsx(R3,{splitKey:ie,payload:pe,problemType:F.problem_type,formatMetricValue:l},ie))]}):a.jsx("div",{className:"evaluation-placeholder",children:v?a.jsx("p",{children:"Run the evaluation to generate metrics and diagnostics for the selected model."}):a.jsx("p",{children:"Select a completed training job to enable the evaluation workflow."})})]})},z3=({comparison:e,formatMetricValue:t})=>e.metricKeys.length?a.jsx("section",{className:"evaluation-comparison",children:a.jsx("div",{className:"evaluation-comparison__table-wrapper",children:a.jsxs("table",{className:"evaluation-comparison__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Metric"}),e.splits.map(n=>a.jsx("th",{children:n.label},n.key))]})}),a.jsxs("tbody",{children:[a.jsxs("tr",{className:"evaluation-comparison__row evaluation-comparison__row--muted",children:[a.jsx("td",{children:"Rows evaluated"}),e.splits.map(n=>a.jsx("td",{children:typeof n.rowCount=="number"?n.rowCount.toLocaleString():""},`${n.key}-rows`))]}),e.metricKeys.map(n=>a.jsxs("tr",{className:"evaluation-comparison__row",children:[a.jsx("td",{children:n}),e.splits.map(s=>a.jsx("td",{children:typeof s.metrics[n]=="number"?t(s.metrics[n]):""},`${s.key}-${n}`))]},n))]})]})})}):a.jsx("div",{className:"evaluation-placeholder",children:a.jsx("p",{children:"No numeric metrics were reported across splits for comparison."})}),R3=({splitKey:e,payload:t,problemType:n,formatMetricValue:s})=>{const r=lj(t.metrics),i=r.length>0,l=Array.isArray(t.notes)?t.notes.filter(Boolean):[];return a.jsxs("section",{className:"evaluation-split",children:[a.jsx("header",{className:"evaluation-split__header",children:a.jsxs("div",{children:[a.jsxs("h4",{children:[ij(e)," split"]}),a.jsxs("span",{className:"evaluation-split__rows",children:[t.row_count," rows"]})]})}),a.jsxs("div",{className:"evaluation-split__content",children:[a.jsxs("div",{className:"evaluation-metrics",children:[a.jsx("h5",{children:"Metrics"}),i?a.jsx("div",{className:"evaluation-metrics__grid",children:r.map(u=>a.jsxs("div",{className:"evaluation-metrics__item",children:[a.jsx("span",{className:"evaluation-metrics__label",children:u.key}),a.jsx("span",{className:"evaluation-metrics__value",children:s(u.value)})]},u.key))}):a.jsx("p",{className:"evaluation-hint",children:"No numeric metrics reported for this split."})]}),n==="classification"&&t.confusion_matrix&&a.jsx(D3,{matrix:t.confusion_matrix,formatMetricValue:s}),n==="classification"&&t.roc_curves.length>0&&a.jsxs("div",{className:"evaluation-curves",children:[t.roc_curves.map(u=>a.jsx(I3,{curve:u,formatMetricValue:s},`roc-${u.label}`)),t.pr_curves.map(u=>a.jsx(F3,{curve:u,formatMetricValue:s},`pr-${u.label}`))]}),n==="regression"&&t.residuals&&a.jsx(U3,{residuals:t.residuals,formatMetricValue:s})]}),l.length>0&&a.jsx("ul",{className:"evaluation-notes",children:l.map((u,d)=>a.jsx("li",{children:u},`${e}-note-${d}`))})]})},D3=({matrix:e,formatMetricValue:t})=>{const n=Array.isArray(e.labels)?e.labels:[],s=Array.isArray(e.totals)?e.totals:[],r=Array.isArray(e.normalized)?e.normalized:[],i=typeof e.accuracy=="number"?e.accuracy:null;return a.jsxs("div",{className:"evaluation-confusion",children:[a.jsx("h5",{children:"Confusion matrix"}),i!==null&&a.jsxs("span",{className:"evaluation-confusion__accuracy",children:["Accuracy ",cj(i,t)]}),a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Actual \\ Predicted"}),n.map((l,u)=>a.jsx("th",{children:l},`pred-${u}`)),a.jsx("th",{children:"Total"})]})}),a.jsx("tbody",{children:e.matrix.map((l,u)=>{const d=r[u]??[],f=s[u]??l.reduce((p,m)=>p+m,0);return a.jsxs("tr",{children:[a.jsx("th",{children:n[u]??`Class ${u}`}),l.map((p,m)=>{const h=typeof d[m]=="number"?d[m]:null;return a.jsxs("td",{children:[a.jsx("span",{className:"evaluation-confusion__count",children:p}),h!==null&&a.jsx("span",{className:"evaluation-confusion__percentage",children:cj(h,t)})]},`cell-${u}-${m}`)}),a.jsx("td",{children:f})]},`row-${u}`)})})]})]})},I3=({curve:e,formatMetricValue:t})=>{if(!Array.isArray(e.fpr)||!Array.isArray(e.tpr)||!e.fpr.length||e.fpr.length!==e.tpr.length)return null;const n=240,s=240,r=28,i=n-r*2,l=s-r*2,u=e.fpr.map((d,f)=>{const p=r+Xd(d)*i,m=s-r-Xd(e.tpr[f])*l;return`${f===0?"M":"L"}${p} ${m}`}).join(" ");return a.jsxs("div",{className:"evaluation-chart",children:[a.jsxs("svg",{viewBox:`0 0 ${n} ${s}`,role:"img","aria-label":`ROC curve for ${e.label}`,children:[a.jsx("rect",{x:r,y:r,width:i,height:l,className:"evaluation-chart__frame"}),a.jsx("line",{x1:r,y1:s-r,x2:n-r,y2:r,className:"evaluation-curve__baseline"}),a.jsx("line",{x1:r,y1:r,x2:r,y2:s-r,className:"evaluation-chart__axis"}),a.jsx("line",{x1:r,y1:s-r,x2:n-r,y2:s-r,className:"evaluation-chart__axis"}),a.jsx("path",{d:u,className:"evaluation-curve__path"}),a.jsx("text",{x:n/2,y:s-4,className:"evaluation-chart__tick",textAnchor:"middle",children:"False positive rate"}),a.jsx("text",{x:-120,y:12,transform:"rotate(-90)",className:"evaluation-chart__tick",textAnchor:"middle",children:"True positive rate"})]}),a.jsxs("div",{className:"evaluation-chart__caption",children:[a.jsx("span",{children:e.label}),typeof e.auc=="number"&&a.jsxs("span",{children:["AUC ",t(e.auc)]})]})]})},F3=({curve:e,formatMetricValue:t})=>{if(!Array.isArray(e.recall)||!Array.isArray(e.precision)||!e.recall.length||e.recall.length!==e.precision.length)return null;const n=240,s=240,r=28,i=n-r*2,l=s-r*2,u=e.recall.map((d,f)=>{const p=r+Xd(d)*i,m=s-r-Xd(e.precision[f])*l;return`${f===0?"M":"L"}${p} ${m}`}).join(" ");return a.jsxs("div",{className:"evaluation-chart",children:[a.jsxs("svg",{viewBox:`0 0 ${n} ${s}`,role:"img","aria-label":`Precision/recall for ${e.label}`,children:[a.jsx("rect",{x:r,y:r,width:i,height:l,className:"evaluation-chart__frame"}),a.jsx("line",{x1:r,y1:r,x2:r,y2:s-r,className:"evaluation-chart__axis"}),a.jsx("line",{x1:r,y1:s-r,x2:n-r,y2:s-r,className:"evaluation-chart__axis"}),a.jsx("path",{d:u,className:"evaluation-curve__path"}),a.jsx("text",{x:n/2,y:s-4,className:"evaluation-chart__tick",textAnchor:"middle",children:"Recall"}),a.jsx("text",{x:-120,y:12,transform:"rotate(-90)",className:"evaluation-chart__tick",textAnchor:"middle",children:"Precision"})]}),a.jsxs("div",{className:"evaluation-chart__caption",children:[a.jsx("span",{children:e.label}),typeof e.average_precision=="number"&&a.jsxs("span",{children:["AP ",t(e.average_precision)]})]})]})},B3={residual_min:"Residual min",residual_max:"Residual max",residual_mean:"Residual mean",residual_std:"Residual std"},U3=({residuals:e,formatMetricValue:t})=>{const n=Object.entries(e.summary??{}).filter(s=>typeof s[1]=="number"&&Number.isFinite(s[1]));return a.jsxs("div",{className:"evaluation-regression",children:[a.jsx("h5",{children:"Residual analysis"}),n.length>0&&a.jsx("div",{className:"evaluation-summary evaluation-summary--compact",children:n.map(([s,r])=>a.jsxs("div",{children:[a.jsx("span",{className:"evaluation-summary__label",children:B3[s]??s}),a.jsx("span",{className:"evaluation-summary__value",children:t(r)})]},s))}),a.jsx(H3,{histogram:e.histogram}),e.scatter&&e.scatter.length>0&&a.jsx(q3,{points:e.scatter})]})},H3=({histogram:e})=>{const t=Array.isArray(e.counts)?e.counts:[],n=Array.isArray(e.bin_edges)?e.bin_edges:[];if(!t.length||n.length!==t.length+1)return null;const s=t.reduce((r,i)=>Math.max(r,i),0)||1;return a.jsx("div",{className:"evaluation-histogram","aria-label":"Residual histogram",children:t.map((r,i)=>{const l=r/s*100;return a.jsx("div",{className:"evaluation-histogram__bin",title:`${r} rows`,children:a.jsx("div",{className:"evaluation-histogram__bar",style:{height:`${l}%`}})},`bin-${i}`)})})},q3=({points:e})=>{if(!Array.isArray(e)||!e.length)return null;const t=320,n=260,s=36,r=e.map(h=>h.actual),i=e.map(h=>h.predicted),l=Math.min(...r,...i),u=Math.max(...r,...i),d=u-l||1,f=h=>(h-l)/d,p=h=>s+f(h)*(t-s*2),m=h=>n-s-f(h)*(n-s*2);return a.jsx("div",{className:"evaluation-scatter","aria-label":"Actual vs predicted scatter",children:a.jsxs("svg",{viewBox:`0 0 ${t} ${n}`,children:[a.jsx("rect",{x:s,y:s,width:t-s*2,height:n-s*2,className:"evaluation-chart__frame"}),a.jsx("line",{x1:s,y1:n-s,x2:t-s,y2:n-s,className:"evaluation-chart__axis"}),a.jsx("line",{x1:s,y1:s,x2:s,y2:n-s,className:"evaluation-chart__axis"}),a.jsx("line",{x1:p(l),y1:m(l),x2:p(u),y2:m(u),className:"evaluation-curve__baseline"}),e.map((h,_)=>a.jsx("circle",{cx:p(h.actual),cy:m(h.predicted),r:2.1,className:"evaluation-scatter__point"},`scatter-${_}`))]})})},V3={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},il={classification:["accuracy","f1_weighted","roc_auc","roc_auc_weighted","precision_weighted","recall_weighted","pr_auc","pr_auc_weighted","g_score","f1","precision","recall"],regression:["rmse","mae","r2","mape","mse"],fallback:["rmse","mae","r2","accuracy","f1_weighted","roc_auc","f1","precision","recall"]},uj=["accuracy","f1_weighted","precision_weighted","recall_weighted","roc_auc","roc_auc_weighted","f1","precision","recall"],dj=["rmse","mae","r2","mape","mse"],mj=new Set(["rmse","mae","mape","mse"]),fj={logistic_regression:"Logistic Regression",random_forest_classifier:"Random Forest (Classifier)",random_forest_regressor:"Random Forest (Regressor)",ridge_regression:"Ridge Regression"},Ys=e=>!!e&&typeof e=="object"&&!Array.isArray(e),W3=(e,t)=>{if(e==null)return t;if(typeof e=="boolean")return e;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(["true","1","yes","on","enabled"].includes(n))return!0;if(["false","0","no","off","disabled"].includes(n))return!1}return typeof e=="number"?Number.isFinite(e)?e!==0:t:!!e},Lp=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",Y3=e=>{if(!e)return il.fallback;const t=String(e.model_type??e.modelType??"").toLowerCase();if(t.includes("regress"))return il.regression;if(t.includes("class")||t.includes("classification"))return il.classification;const n=String(e.problem_type??e.problemType??"").toLowerCase();return n==="regression"?il.regression:n==="classification"?il.classification:il.fallback},K3=e=>{var r,i,l;if(!Ys(e))return null;const t=[],n=(i=(r=e==null?void 0:e.cross_validation)==null?void 0:r.metrics)==null?void 0:i.mean;Ys(n)&&((l=e==null?void 0:e.cross_validation)==null?void 0:l.status)==="completed"&&t.push({values:n,labelPrefix:"CV mean "}),Ys(e.test)&&t.push({values:e.test,labelPrefix:""}),Ys(e.validation)&&t.push({values:e.validation,labelPrefix:""}),Ys(e.train)&&t.push({values:e.train,labelPrefix:""});const s=Y3(e);for(const u of t)for(const d of s){const f=u.values[d];if(typeof f=="number"&&Number.isFinite(f))return{label:u.labelPrefix?`${u.labelPrefix}${d}`:d,value:f}}for(const u of t)for(const[d,f]of Object.entries(u.values))if(typeof f=="number"&&Number.isFinite(f))return{label:u.labelPrefix?`${u.labelPrefix}${d}`:d,value:f};return null},G3=e=>{var n,s;if(!Ys(e))return{label:null,values:{}};if(Ys(e.test))return{label:"Test",values:e.test};if(Ys(e.validation))return{label:"Validation",values:e.validation};const t=(s=(n=e==null?void 0:e.cross_validation)==null?void 0:n.metrics)==null?void 0:s.mean;return Ys(t)?{label:"CV mean",values:t}:Ys(e.train)?{label:"Train",values:e.train}:{label:null,values:{}}},hj=e=>{if(!e)return"Unknown model";const t=e.trim();return fj[t]?fj[t]:t.split("_").filter(Boolean).map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")},X3=e=>{var i,l;const t=e.metadata??{},n=[e.problem_type,t==null?void 0:t.resolved_problem_type,t==null?void 0:t.problem_type];for(const u of n)if(typeof u=="string"){const d=u.trim().toLowerCase();if(d==="classification"||d==="regression")return d}const s=typeof e.model_type=="string"?e.model_type.toLowerCase():"";if(s.includes("classifier")||s.includes("classification"))return"classification";if(s.includes("regress")||s.includes("regression"))return"regression";const r=e.metrics;if(Ys(r)){const u=new Set,d=h=>{Ys(h)&&Object.keys(h).forEach(_=>u.add(_.toLowerCase()))};d(r.test),d(r.validation),d(r.train);const f=(l=(i=r==null?void 0:r.cross_validation)==null?void 0:i.metrics)==null?void 0:l.mean;Ys(f)&&d(f);const p=uj.some(h=>u.has(h)),m=dj.some(h=>u.has(h));if(p&&!m)return"classification";if(m&&!p)return"regression"}return"unknown"},Q3=e=>e.map(t=>{const n=t.metrics??null;return{job:t,problemType:X3(t),modelLabel:hj(t.model_type),primaryMetric:K3(n),metricBucket:G3(n)}}),pj=e=>{if(!e||!Number.isFinite(e.value))return null;const t=e.label.toLowerCase();return mj.has(t)||mj.has(t.replace(/^cv mean\s+/i,""))?-e.value:e.value},Z3=({nodeId:e,sourceId:t,graph:n,parameters:s,config:r,renderParameterField:i})=>{var G;const l=N.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),u=N.useMemo(()=>{if(!l)return[];const K=new Map;l.nodes.forEach(J=>{J&&J.id&&K.set(J.id,J)});const X=new Set;return l.edges.forEach(J=>{var ee;if(!J||J.target!==e)return;const Z=K.get(J.source);((ee=Z==null?void 0:Z.data)==null?void 0:ee.catalogType)==="train_model_draft"&&X.add(Z.id)}),X.size>0?Array.from(X):l.nodes.filter(J=>{var Z;return((Z=J==null?void 0:J.data)==null?void 0:Z.catalogType)==="train_model_draft"}).map(J=>J.id)},[l,e]),d=N.useMemo(()=>u.length?u.slice().sort().join("|"):"all",[u]),[f,p]=N.useState(null),[m,h]=N.useState(null);N.useEffect(()=>{let K=!1;return h(null),!t||!l?(p(null),()=>{K=!0}):(Lo(t,l).then(X=>{K||p(X)}).catch(X=>{K||(h((X==null?void 0:X.message)??"Unable to compute pipeline ID"),p(null))}),()=>{K=!0})},[l,t]);const _=W3(r==null?void 0:r.show_non_success,!0),x=N.useMemo(()=>["feature-canvas","model-registry",t??"none",f??"pending",d,_?"all-statuses":"succeeded"],[f,_,t,d]),y=Es({queryKey:x,queryFn:async()=>{const K={datasetSourceId:t||void 0,limit:50},X=new Map,Q=[];let J=null;const Z=ge=>{!Array.isArray(ge)||!ge.length||ge.forEach(be=>{be&&!X.has(be.id)&&X.set(be.id,be)})},ee=async ge=>{try{const be=await bc(ge);return Z(be==null?void 0:be.jobs),be}catch(be){return be instanceof Error&&Q.push(be),null}};if(f&&await ee({...K,pipelineId:f}),u.length===1){const[ge]=u;await ee({...K,nodeId:ge})}if(J=await ee(K),!X.size){if(J)return J;if(Q.length)throw Q[0];return{jobs:[],total:0}}const de=Array.from(X.values()),_e=(J==null?void 0:J.total)??de.length;return{jobs:de,total:_e}},enabled:!!t,staleTime:30*1e3,retry:(K,X)=>X.message.includes("Sign in")?!1:K<2,refetchInterval:K=>{const X=K.state.data;return((X==null?void 0:X.jobs)??[]).some(Z=>Z.status==="queued"||Z.status==="running")?5e3:!1}}),v=((G=y.data)==null?void 0:G.jobs)??[],w=N.useMemo(()=>{if(!v.length)return[];if(!u.length)return v;const K=v.filter(X=>u.includes(X.node_id));return K.length?K:v},[v,u]),k=N.useMemo(()=>Q3(w),[w]),j=N.useMemo(()=>_?k:k.filter(K=>K.job.status==="succeeded"),[k,_]),b=N.useMemo(()=>j.filter(K=>K.problemType==="classification"),[j]),S=N.useMemo(()=>j.filter(K=>K.problemType==="regression"),[j]),E=N.useMemo(()=>!b.length&&!S.length?"classification":b.length?S.length?b.length>=S.length?"classification":"regression":"classification":"regression",[b.length,S.length]),M=typeof(r==null?void 0:r.default_problem_type)=="string"?r.default_problem_type.trim().toLowerCase():"auto",O=M==="classification"||M==="regression"?M:E,[$,P]=N.useState(O);N.useEffect(()=>{P(O)},[O]);const A=$==="classification"?b:S,R=N.useMemo(()=>{const K=new Map;return A.forEach(X=>{const Q=X.job.model_type,J=K.get(Q)??{label:X.modelLabel,count:0};J.count+=1,K.set(Q,J)}),Array.from(K.entries()).map(([X,Q])=>({value:X,label:Q.label,count:Q.count})).sort((X,Q)=>X.label.localeCompare(Q.label))},[A]),F=typeof(r==null?void 0:r.default_method)=="string"?r.default_method.trim().toLowerCase():"",[z,I]=N.useState("all");N.useEffect(()=>{if(!R.length){I("all");return}const K=R.find(X=>X.value.toLowerCase()===F);I(K?K.value:"all")},[F,R,$]);const U=N.useMemo(()=>z==="all"?A:A.filter(K=>K.job.model_type===z),[z,A]),q=N.useMemo(()=>U.slice().sort((K,X)=>{if(X.job.version!==K.job.version)return X.job.version-K.job.version;const Q=Date.parse(K.job.updated_at??K.job.created_at??"");return Date.parse(X.job.updated_at??X.job.created_at??"")-Q}),[U]),H=N.useMemo(()=>{if(!A.length)return[];const K=new Map;A.forEach(Q=>{const J=Q.job.model_type,Z=K.get(J)??[];Z.push(Q),K.set(J,Z)});const X=[];return K.forEach((Q,J)=>{const Z=Q.reduce((ee,de)=>{const _e=pj(de.primaryMetric);if(_e===null)return ee;if(!ee)return de;const ge=pj(ee.primaryMetric);return ge===null||_e>ge?de:ee},null);X.push({modelType:J,label:hj(J),bestJob:Z})}),X.sort((Q,J)=>Q.label.localeCompare(J.label))},[A]),W=N.useMemo(()=>s.filter(K=>["default_problem_type","show_non_success"].includes(K.name)),[s]),B=$==="classification"?uj:dj,D=y.isLoading||y.isFetching,V=y.error??null,te=q.length>0;return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Model registry"}),f&&a.jsxs("span",{className:"model-registry__pipeline",children:["Pipeline ID: ",f]})]}),m&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:m}),!u.length&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to a Train model step to populate the registry."}),W.length>0&&a.jsx("div",{className:"canvas-modal__parameter-grid model-registry__parameters",children:W.map(K=>a.jsx(ve.Fragment,{children:i(K)},K.name))}),a.jsxs("div",{className:"model-registry__toolbar",children:[a.jsx("div",{className:"model-registry__tabs",role:"tablist","aria-label":"Problem type",children:["classification","regression"].map(K=>a.jsxs("button",{type:"button",role:"tab","data-active":$===K,className:"model-registry__tab",onClick:()=>P(K),disabled:K==="classification"&&!b.length||K==="regression"&&!S.length,children:[K==="classification"?"Classification":"Regression",a.jsx("span",{className:"model-registry__tab-count",children:K==="classification"?b.length:S.length})]},K))}),a.jsxs("div",{className:"model-registry__methods","aria-label":"Model template filter",children:[a.jsxs("button",{type:"button",className:"model-registry__method","data-active":z==="all",onClick:()=>I("all"),children:["All methods",a.jsx("span",{className:"model-registry__method-count",children:A.length})]}),R.map(K=>a.jsxs("button",{type:"button",className:"model-registry__method","data-active":z===K.value,onClick:()=>I(K.value),children:[K.label,a.jsx("span",{className:"model-registry__method-count",children:K.count})]},K.value))]})]}),H.length>0&&a.jsx("div",{className:"model-registry__summary",children:H.map(K=>{const X=K.bestJob,Q=X!=null&&X.primaryMetric?X.primaryMetric.label:null,J=X!=null&&X.primaryMetric?Lp(X.primaryMetric.value):"";return a.jsxs("div",{className:"model-registry__summary-card",children:[a.jsx("span",{className:"model-registry__summary-title",children:K.label}),a.jsxs("span",{className:"model-registry__summary-metric",children:[Q||"No metrics",Q&&a.jsx("strong",{children:J})]}),(X==null?void 0:X.job)&&a.jsxs("span",{className:"model-registry__summary-version",children:["v",X.job.version]})]},K.modelType)})}),D&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading model history"}),V&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:V.message}),!D&&!V&&!te&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No model versions available for the current filters."}),te&&a.jsx("div",{className:"model-registry__table-wrapper",style:{overflowX:"auto"},children:a.jsxs("table",{className:"model-registry__table",style:{width:"100%",borderCollapse:"collapse",fontSize:"0.85rem"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"left",color:"#e2e8f0",fontWeight:600},children:"Version"}),a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"left",color:"#e2e8f0",fontWeight:600},children:"Status"}),a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"left",color:"#e2e8f0",fontWeight:600},children:"Model"}),a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"left",color:"#e2e8f0",fontWeight:600},children:"Target"}),a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"right",color:"#e2e8f0",fontWeight:600},children:"Primary metric"}),B.map(K=>a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"right",color:"#e2e8f0",fontWeight:600},children:K.replace(/_/g," ")},K)),a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"left",color:"#e2e8f0",fontWeight:600},children:"Evaluated"}),a.jsx("th",{scope:"col",style:{padding:"0.75rem",textAlign:"right",color:"#e2e8f0",fontWeight:600},children:"Updated"})]})}),a.jsx("tbody",{children:q.map(K=>{var _e;const{job:X,primaryMetric:Q,metricBucket:J}=K,Z=J.values||{},ee=J.label??"",de=X.updated_at??X.created_at??null;return a.jsxs("tr",{style:{borderTop:"1px solid rgba(148, 163, 184, 0.1)"},children:[a.jsxs("td",{style:{padding:"0.75rem",color:"rgba(148, 163, 184, 0.8)"},children:["v",X.version]}),a.jsx("td",{style:{padding:"0.75rem"},children:a.jsx("span",{style:{display:"inline-block",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:500,background:X.status==="succeeded"?"rgba(34, 197, 94, 0.15)":X.status==="failed"?"rgba(239, 68, 68, 0.15)":"rgba(59, 130, 246, 0.15)",color:X.status==="succeeded"?"#4ade80":X.status==="failed"?"#f87171":"#60a5fa"},children:V3[X.status]})}),a.jsx("td",{style:{padding:"0.75rem",fontWeight:500,color:"#e2e8f0"},children:K.modelLabel}),a.jsx("td",{style:{padding:"0.75rem",color:"rgba(148, 163, 184, 0.8)"},children:((_e=X.metadata)==null?void 0:_e.target_column)||""}),a.jsx("td",{style:{padding:"0.75rem",textAlign:"right"},children:Q?a.jsxs("span",{className:"model-registry__metric",children:[a.jsx("span",{className:"model-registry__metric-label",style:{marginRight:"0.5rem",color:"rgba(148, 163, 184, 0.6)",fontSize:"0.75rem"},children:Q.label}),a.jsx("span",{className:"model-registry__metric-value",style:{fontFamily:"monospace",color:"#e2e8f0",fontWeight:600},children:Lp(Q.value)})]}):a.jsx("span",{style:{color:"rgba(148, 163, 184, 0.3)"},children:""})}),B.map(ge=>{const be=Z[ge],ze=typeof be=="number"&&Number.isFinite(be);return a.jsx("td",{style:{padding:"0.75rem",textAlign:"right"},children:ze?a.jsx("span",{style:{fontFamily:"monospace",color:"#e2e8f0"},children:Lp(be)}):a.jsx("span",{style:{color:"rgba(148, 163, 184, 0.3)"},children:""})},`${X.id}-${ge}`)}),a.jsx("td",{style:{padding:"0.75rem",color:"rgba(148, 163, 184, 0.8)"},children:ee}),a.jsx("td",{style:{padding:"0.75rem",textAlign:"right",color:"rgba(148, 163, 184, 0.8)"},children:de?Fn(de)??de:""})]},X.id)})})]})})]})},J3={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},Do="__tuning_strategies",Io="__active_tuning_strategy_id",Fo="__expanded_tuning_strategy_ids",zp=["random","grid","halving","optuna"],Qd=(e,t)=>{if(typeof e!="string")return null;const n=e.trim();if(!n.length)return null;const s=n.toLowerCase();if(t&&t.length>0){const i=t.find(l=>l.toLowerCase()===s);if(i)return i}const r=zp.find(i=>i.toLowerCase()===s);return r||n},Cr=e=>!!e&&typeof e=="object"&&!Array.isArray(e),is=e=>{try{return JSON.parse(JSON.stringify(e))}catch{return e}},Ua=e=>{if(e==null)return{value:null,error:null};if(typeof e=="string"){const t=e.trim();if(!t.length)return{value:null,error:null};try{const n=JSON.parse(t);return Cr(n)?{value:n,error:null}:{value:null,error:"JSON must evaluate to an object."}}catch{return{value:null,error:"Invalid JSON. Provide a valid JSON object."}}}return Cr(e)?{value:e,error:null}:{value:null,error:"Provide a JSON object for this field."}},Rp=e=>{if(!e)return{value:null,error:null};const t={};return Object.entries(e).forEach(([n,s])=>{if(n){if(Array.isArray(s)){const r=s.filter(i=>i!=null);r.length>0&&(t[n]=r.map(i=>is(i)));return}s==null||s===""||(t[n]=[is(s)])}}),Object.keys(e).length?Object.keys(t).length===0?{value:null,error:"Search space must list candidate values for at least one hyperparameter."}:{value:t,error:null}:{value:null,error:"Populate the search space with at least one hyperparameter."}},eF=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",tF=new Set(["train","test","validation"]),gj=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(n=>{if(typeof n=="string"){const s=n.trim().toLowerCase();tF.has(s)&&t.add(s)}}),Array.from(t)},Dp=(e,t)=>{if(!e||t.size===0)return{};const n={};return Object.entries(e).forEach(([s,r])=>{t.has(s)&&(n[s]=r)}),n},Ip=(e,t)=>{if(!e||t.size===0)return{};const n={};return Object.entries(e).forEach(([s,r])=>{if(t.has(s)){if(Array.isArray(r)){const i=r.map(l=>is(l)).filter(l=>l!=null&&l!=="");i.length>0&&(n[s]=i);return}r!=null&&r!==""&&(n[s]=[is(r)])}}),n},nF=(e,t)=>{const n=t.split(/[\n,]+/).map(d=>d.trim()).filter(d=>d.length>0);if(n.length===0)return{values:[],error:null};const s=[],r=[],i=Array.isArray(e.options)?new Set(e.options.map(d=>d.value)):null;n.forEach(d=>{if(e.type==="number"){const f=Number(d);Number.isFinite(f)?s.push(f):r.push(d);return}if(e.type==="boolean"){const f=d.toLowerCase();if(["true","1","yes","y"].includes(f)){s.push(!0);return}if(["false","0","no","n"].includes(f)){s.push(!1);return}r.push(d);return}if(e.type==="select"){if(i&&!i.has(d)){r.push(d);return}s.push(d);return}s.push(d)});const l=[],u=new Set;if(s.forEach(d=>{const f=typeof d=="object"?JSON.stringify(d):String(d);u.has(f)||(u.add(f),l.push(d))}),r.length>0){const d=r.slice(0,3).join(", "),f=r.length>3?"":"";return{values:l,error:`Invalid value${r.length>1?"s":""}: ${d}${f}`}}return{values:l,error:null}},_j=(e,t)=>t==null?"":typeof t=="number"?Number.isFinite(t)?t.toString():"":typeof t=="boolean"?t?"true":"false":e.type==="select"&&typeof t=="string"?t:String(t),Zd=e=>{if(e==null)return"";if(typeof e=="number")return Number.isFinite(e)?e.toString():"";if(typeof e=="boolean")return e?"True":"False";if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}},Jd=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim().length){const t=Number(e);return Number.isFinite(t)?t:null}return null},Rc=(e,t,n)=>{let s=e;return typeof t=="number"&&Number.isFinite(t)&&(s=Math.max(s,t)),typeof n=="number"&&Number.isFinite(n)&&(s=Math.min(s,n)),s},sF=(e,t)=>{const n={},s=e.find(d=>(d==null?void 0:d.name)==="solver"),r=e.find(d=>(d==null?void 0:d.name)==="penalty"),i=!!(s&&r&&Array.isArray(s.options)&&s.options.some(d=>(d==null?void 0:d.value)==="liblinear")&&Array.isArray(r.options)&&r.options.some(d=>(d==null?void 0:d.value)==="elasticnet")),l=new Set(["lbfgs","saga"]),u=new Set(["l2","none"]);return e.forEach(d=>{if(!(d!=null&&d.name))return;const f=new Map,p=_=>{if(_==null||typeof _=="number"&&!Number.isFinite(_))return;const x=typeof _=="object"?JSON.stringify(_):`${typeof _}:${String(_)}`;f.has(x)||f.set(x,is(_))},m=t==null?void 0:t[d.name];if(i&&d.name==="solver")(Array.isArray(d.options)?d.options:[]).forEach(x=>{x!=null&&x.value&&l.has(String(x.value))&&p(x.value)}),!f.size&&typeof m=="string"&&l.has(m)&&p(m),f.size||l.forEach(x=>p(x));else if(i&&d.name==="penalty")(Array.isArray(d.options)?d.options:[]).forEach(x=>{x!=null&&x.value&&u.has(String(x.value))&&p(x.value)}),!f.size&&typeof m=="string"&&u.has(m)&&p(m),f.size||u.forEach(x=>p(x));else if(d.type==="number"){const _=Jd(m),x=Jd(d.min),y=Jd(d.max);if(x!==null&&p(x),_!==null&&p(Rc(_,x,y)),y!==null&&p(y),f.size<=1&&_!==null){const v=Jd(d.step);v!==null&&v>0?(p(Rc(_+v,x,y)),p(Rc(_-v,x,y))):(p(Rc(_*1.5,x,y)),p(Rc(_*.5,x,y)))}}else d.type==="boolean"?(p(!0),p(!1),typeof m=="boolean"&&p(m)):(d.type==="select"&&(d.options??[]).slice(0,6).forEach(_=>{(_==null?void 0:_.value)!==void 0&&p(_.value)}),typeof m=="string"&&m.trim().length&&p(m.trim()));const h=Array.from(f.values());h.length>0&&(n[d.name]=h)}),n},rF={classification:[{value:"accuracy",label:"Accuracy"},{value:"balanced_accuracy",label:"Balanced accuracy"},{value:"f1",label:"F1"},{value:"f1_macro",label:"F1 macro"},{value:"f1_weighted",label:"F1 weighted"},{value:"precision",label:"Precision"},{value:"recall",label:"Recall"},{value:"roc_auc",label:"ROC AUC (binary)"},{value:"roc_auc_ovr",label:"ROC AUC (one-vs-rest)"}],regression:[{value:"neg_mean_squared_error",label:"Negative MSE"},{value:"neg_root_mean_squared_error",label:"Negative RMSE"},{value:"neg_mean_absolute_error",label:"Negative MAE"},{value:"neg_median_absolute_error",label:"Negative MedAE"},{value:"r2",label:"R"}]},Fp=()=>`strategy-${Math.random().toString(36).slice(2,10)}`,Dc=e=>{if(!Cr(e))return{};const t=is(e);return Cr(t)?(delete t[Do],delete t[Io],delete t[Fo],t):{}},ll=e=>Dc(e),aF=(e,t,n)=>({id:Fp(),label:e,config:ll(t),searchSpaceTexts:n!=null&&n.searchSpaceTexts?{...n.searchSpaceTexts}:{},searchSpaceFieldErrors:n!=null&&n.searchSpaceFieldErrors?{...n.searchSpaceFieldErrors}:{},hasAutoFilledSearchSpace:(n==null?void 0:n.hasAutoFilledSearchSpace)??!1,searchSpaceManuallyCleared:(n==null?void 0:n.searchSpaceManuallyCleared)??!1}),Ha=e=>`Strategy ${e}`,yj=e=>Cr(e)?Object.keys(e).filter(t=>typeof e[t]=="string").sort().reduce((t,n)=>(t[n]=String(e[n]),t),{}):{},vj=e=>Cr(e)?Object.keys(e).filter(t=>e[t]===null||typeof e[t]=="string").sort().reduce((t,n)=>{const s=e[n];return t[n]=s===null?null:String(s),t},{}):{},oF=e=>{if(!Cr(e))return{};const t={};return Object.prototype.hasOwnProperty.call(e,Do)&&(t[Do]=is(e[Do])),Object.prototype.hasOwnProperty.call(e,Io)&&(t[Io]=e[Io]),Object.prototype.hasOwnProperty.call(e,Fo)&&(t[Fo]=is(e[Fo])),t},iF=()=>({strategies:[],activeId:null,expandedIds:[]}),Bp=e=>{var d;const t=iF();if(!Cr(e))return t;const n=e[Do];if(Array.isArray(n)){const f=new Set;n.forEach(p=>{if(!Cr(p))return;let m=typeof p.id=="string"?p.id.trim():"";(!m||f.has(m))&&(m=Fp()),f.add(m);const h=typeof p.label=="string"?p.label.trim():"",_=h.length?h:Ha(t.strategies.length+1),x=Cr(p.config)?p.config:{},y={id:m,label:_,config:Dc(x),searchSpaceTexts:yj(p.searchSpaceTexts),searchSpaceFieldErrors:vj(p.searchSpaceFieldErrors),hasAutoFilledSearchSpace:!!p.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:!!p.searchSpaceManuallyCleared};t.strategies.push(y)})}const s=new Set(t.strategies.map(f=>f.id)),r=e[Io],i=typeof r=="string"?r.trim():"";t.activeId=i&&s.has(i)?i:((d=t.strategies[0])==null?void 0:d.id)??null;const l=e[Fo],u=Array.isArray(l)?l.map(f=>typeof f=="string"?f.trim():"").filter(f=>!!f&&s.has(f)):[];return t.activeId&&!u.includes(t.activeId)&&u.push(t.activeId),t.expandedIds=Array.from(new Set(u)).sort(),t},xj=e=>({id:e.id,label:e.label,config:ll(e.config),searchSpaceTexts:{...e.searchSpaceTexts},searchSpaceFieldErrors:{...e.searchSpaceFieldErrors},hasAutoFilledSearchSpace:e.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:e.searchSpaceManuallyCleared}),lF=(e,t,n)=>{var u;const s=e.map((d,f)=>({id:typeof d.id=="string"&&d.id.trim().length?d.id:Fp(),label:typeof d.label=="string"&&d.label.trim().length?d.label:Ha(f+1),config:Dc(d.config),searchSpaceTexts:yj(d.searchSpaceTexts),searchSpaceFieldErrors:vj(d.searchSpaceFieldErrors),hasAutoFilledSearchSpace:!!d.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:!!d.searchSpaceManuallyCleared})),r=new Set(s.map(d=>d.id)),i=typeof t=="string"&&r.has(t)?t:((u=s[0])==null?void 0:u.id)??null,l=Array.from(n??new Set).filter(d=>r.has(d));return i&&!l.includes(i)&&l.push(i),{strategies:s,activeId:i,expandedIds:Array.from(new Set(l)).sort()}},bj=(e,t)=>{var n;return t&&e.some(s=>s.id===t)?t:((n=e[0])==null?void 0:n.id)??""},wj=(e,t)=>{const n=new Set(e.map(r=>r.id)),s=t.filter(r=>n.has(r));return!s.length&&e[0]&&s.push(e[0].id),new Set(s)},em=e=>Lc(e),Nj=(e,t)=>{const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0},cF=({nodeId:e,sourceId:t,graph:n,config:s,runtimeConfig:r,cvConfig:i,draftConfigState:l,renderParameterField:u,modelTypeParameter:d,modelTypeOptions:f,searchStrategyParameter:p,searchIterationsParameter:m,searchRandomStateParameter:h,scoringMetricParameter:_,setDraftConfigState:x,onSaveDraftConfig:y})=>{var ga,Qs,Zs,Js;const v=$a(),w=Oi({mutationFn:jw,onSuccess:()=>{v.invalidateQueries({queryKey:["hyperparameter-tuning-jobs"]})},onError:ne=>{console.error("Failed to cancel job:",ne),alert(ne instanceof Error?ne.message:"Failed to cancel job")}}),k=ne=>{confirm("Are you sure you want to cancel this tuning job?")&&w.mutate(ne)},[j,b]=N.useState(null),[S,E]=N.useState(null),[M,O]=N.useState(null),[$,P]=N.useState(0),[A,R]=N.useState(null),[F,z]=N.useState(!1),[I,U]=N.useState(null),[q,H]=N.useState(!1),W=((s==null?void 0:s.targetColumn)??"").trim(),B=(s==null?void 0:s.problemType)==="regression"?"regression":"classification",D=(d==null?void 0:d.name)??"model_type",V=(p==null?void 0:p.name)??"search_strategy",te=(m==null?void 0:m.name)??"search_iterations",G=(h==null?void 0:h.name)??"search_random_state",K=(_==null?void 0:_.name)??"scoring_metric",X=l==null?void 0:l[D],Q=typeof X=="string"&&X.trim().length?X.trim():((r==null?void 0:r.modelType)??"").trim(),J=Es({queryKey:["model-hyperparameters",Q],queryFn:()=>Pd(Q),enabled:!!Q,staleTime:5*60*1e3}),Z=((ga=J.data)==null?void 0:ga.fields)??[],ee=((Qs=J.data)==null?void 0:Qs.defaults)??{},de=N.useMemo(()=>{if(!Z.length)return new Set;const ne=new Set;return Z.forEach(ye=>{ye!=null&&ye.name&&ne.add(ye.name)}),ne},[Z]),_e=!!(i!=null&&i.enabled),ge=(i==null?void 0:i.strategy)??"auto",be=typeof(i==null?void 0:i.folds)=="number"?i.folds:5,ze=!!(i!=null&&i.shuffle),Ee=(i==null?void 0:i.randomState)??null,ie=N.useMemo(()=>{const ne=[];return((p==null?void 0:p.options)??[]).forEach(ye=>{if(!ye||typeof ye.value!="string")return;const fe=ye.value.trim();if(!fe.length)return;const Pe=fe.toLowerCase();ne.some(Ae=>Ae.toLowerCase()===Pe)||ne.push(fe)}),ne},[p]),pe=N.useMemo(()=>ie.length>0?[...ie]:[...zp],[ie]),Ce=Qd(p==null?void 0:p.default,ie),De=Qd(l==null?void 0:l[V],ie)??Ce??pe[0]??zp[0],ce=l==null?void 0:l[te];let Oe=null;if(typeof ce=="number"&&Number.isFinite(ce))Oe=Math.max(1,Math.floor(ce));else if(typeof ce=="string"){const ne=Number(ce.trim());Number.isFinite(ne)&&ne>0&&(Oe=Math.max(1,Math.floor(ne)))}const qe=l==null?void 0:l[G];let Qe=null;if(typeof qe=="number"&&Number.isFinite(qe))Qe=Math.trunc(qe);else if(typeof qe=="string"){const ne=Number(qe.trim());Number.isFinite(ne)&&(Qe=Math.trunc(ne))}const Ye=typeof(m==null?void 0:m.default)=="number"&&Number.isFinite(m.default)?Math.max(1,Math.floor(m.default)):null,at=typeof(h==null?void 0:h.default)=="number"&&Number.isFinite(h.default)?Math.trunc(h.default):null,et=typeof(l==null?void 0:l[K])=="string"?String(l[K]).trim():"",ot=et.length?et:null,Nt=N.useMemo(()=>Ua(l==null?void 0:l.baseline_hyperparameters),[l==null?void 0:l.baseline_hyperparameters]),Tt=N.useMemo(()=>Ua(l==null?void 0:l.search_space),[l==null?void 0:l.search_space]),tt=N.useMemo(()=>Rp(Tt.value),[Tt.value]),Ft=Nt.value,Wt=Nt.error,Pt=tt.value,bn=Tt.error??tt.error,gn=N.useMemo(()=>Dp(Ft,de),[de,Ft]),jt=N.useMemo(()=>Ip(Pt,de),[de,Pt]),cn=N.useMemo(()=>Object.keys(gn).length,[gn]),un=N.useMemo(()=>Object.keys(jt).length,[jt]),Lt=un>0,[ut,wn]=N.useState({}),[ht,Bt]=N.useState({}),[mt,Vn]=N.useState(!1),[_n,ls]=N.useState(!1),xt=N.useRef(null);if(!xt.current){const ne=Bp(l);let Pe=ne.strategies.length>0?ne.strategies.map(xj):[];const Ae=bj(Pe,ne.activeId),xe=wj(Pe,ne.expandedIds);Ae&&!xe.has(Ae)&&Pe.length&&xe.add(Ae);const st=em(ne);xt.current={strategies:Pe,activeId:Ae,expanded:xe,signature:st}}const[pt,yn]=N.useState(()=>xt.current?xt.current.strategies:[]),[ys,dn]=N.useState(()=>new Set(xt.current?Array.from(xt.current.expanded):[])),[Xt,tn]=N.useState(()=>{var ne;return((ne=xt.current)==null?void 0:ne.activeId)??""}),Nn=N.useRef(((Zs=xt.current)==null?void 0:Zs.signature)??""),Wn=N.useRef(null),Yn=N.useRef(null),vt=N.useMemo(()=>pt.length?pt.find(ye=>ye.id===Xt)??pt[0]:null,[Xt,pt]),Yt=N.useMemo(()=>Bp(l),[l]),Jn=N.useMemo(()=>em(Yt),[Yt]);N.useEffect(()=>{if(Jn===Nn.current)return;const ne=Yt.strategies.length?Yt.strategies.map(xj):[],ye=bj(ne,Yt.activeId),fe=wj(ne,Yt.expandedIds);ye&&!fe.has(ye)&&ne.length&&fe.add(ye),Wn.current=null,yn(ne),tn(ye),dn(fe),Nn.current=Jn},[Jn,Yt,l]),N.useEffect(()=>{if(!pt.length)return;pt.some(ye=>ye.id===Xt)||tn(pt[0].id)},[Xt,pt]),N.useEffect(()=>{const ne=lF(pt,Xt,ys),ye=em(ne);Nn.current!==ye&&x(fe=>{const Pe=Bp(fe),Ae=em(Pe);if(Ae===ye)return Nn.current=Ae,fe??{};const xe=fe?{...fe}:{};return ne.strategies.length?xe[Do]=ne.strategies.map(st=>({...st,config:is(st.config),searchSpaceTexts:{...st.searchSpaceTexts},searchSpaceFieldErrors:{...st.searchSpaceFieldErrors}})):delete xe[Do],ne.activeId?xe[Io]=ne.activeId:delete xe[Io],ne.expandedIds.length?xe[Fo]=[...ne.expandedIds]:delete xe[Fo],Nn.current=ye,xe})},[Xt,ys,x,pt]),N.useEffect(()=>{if(!vt||Wn.current===vt.id)return;Wn.current=vt.id;const ne=ll(vt.config);x(fe=>({...oF(fe),...ne})),wn(vt.searchSpaceTexts??{}),Bt(vt.searchSpaceFieldErrors??{}),Vn(vt.hasAutoFilledSearchSpace??!1),ls(vt.searchSpaceManuallyCleared??!1);const ye=typeof(ne==null?void 0:ne[D])=="string"?String(ne[D]):(r==null?void 0:r.modelType)??"";Yn.current=ye},[vt,D,r==null?void 0:r.modelType,x]),N.useEffect(()=>{if(!vt)return;const ne=ll(l),ye=JSON.stringify(ne)!==JSON.stringify(vt.config??{}),fe=!Nj(ut,vt.searchSpaceTexts),Pe=!Nj(ht,vt.searchSpaceFieldErrors),Ae=vt.hasAutoFilledSearchSpace!==mt,xe=vt.searchSpaceManuallyCleared!==_n;!ye&&!fe&&!Pe&&!Ae&&!xe||yn(st=>st.map(Ve=>Ve.id!==vt.id?Ve:{...Ve,config:ne,searchSpaceTexts:{...ut},searchSpaceFieldErrors:{...ht},hasAutoFilledSearchSpace:mt,searchSpaceManuallyCleared:_n}))},[vt,l,mt,ht,_n,ut]);const $n=N.useCallback(()=>{const ne=pt.length+1,ye=ll(l),fe=new Set;pt.forEach(Ve=>{var it;const ct=Qd((it=Ve.config)==null?void 0:it[V],pe);ct&&fe.add(ct)});const Pe=pe.find(Ve=>!fe.has(Ve))??De,Ae=is(ye),xe=Cr(Ae)?Ae:{};if(xe[V]=Pe,Pe==="random"||Pe==="optuna"){const Ve=Oe!==null?Oe:Ye;Ve!==null?xe[te]=Ve:delete xe[te];const ct=Qe!==null?Qe:at;ct!==null?xe[G]=ct:delete xe[G]}else delete xe[te],delete xe[G];const st=aF(Ha(ne),xe,{searchSpaceTexts:{...ut},searchSpaceFieldErrors:{},hasAutoFilledSearchSpace:mt,searchSpaceManuallyCleared:_n});yn(Ve=>[...Ve,st]),dn(Ve=>new Set([...Ve,st.id])),Wn.current=null,tn(st.id)},[pe,l,mt,Oe,Ye,Qe,at,_n,ut,De,V,te,G,yn,tn,dn,pt]),Xs=N.useCallback(ne=>{dn(ye=>{const fe=new Set(ye);return fe.has(ne)?fe.delete(ne):fe.add(ne),fe})},[]),vs=N.useCallback(ne=>{!ne||ne===Xt||(Wn.current=null,tn(ne),dn(ye=>{const fe=new Set(ye);return fe.add(ne),fe}))},[Xt]),cs=N.useCallback(ne=>{let ye=null;yn(fe=>{if(fe.length<=1)return fe;const Pe=fe.filter(xe=>xe.id!==ne);if(!Pe.length)return fe;const Ae=Pe.map((xe,st)=>({...xe,label:Ha(st+1)}));if(ne===Xt){Wn.current=null;const xe=Ae[0].id;ye=xe,tn(xe)}return Ae}),dn(fe=>{const Pe=new Set(fe);return Pe.delete(ne),ye&&Pe.add(ye),Pe})},[Xt]),$s=N.useMemo(()=>pt.map((ne,ye)=>{var us,Ns;const fe=ne.config??{},Pe=fe==null?void 0:fe[D],Ae=typeof Pe=="string"?Pe.trim():"",xe=((us=f.find(Cn=>Cn.value===Ae))==null?void 0:us.label)??Ae,st=fe==null?void 0:fe[V],Ve=typeof st=="string"?st.trim():"",ct=(Ns=((p==null?void 0:p.options)??[]).find(Cn=>Cn.value===Ve))==null?void 0:Ns.label,it=fe==null?void 0:fe[K],rt=typeof it=="string"?it.trim():"",sn=Ua(fe==null?void 0:fe.baseline_hyperparameters).error,It=Ua(fe==null?void 0:fe.search_space),Bn=Rp(It.value),Wr=Bn.value?Object.keys(Bn.value).length:0,kr=Bn.value?Object.values(Bn.value).reduce((Cn,zn)=>Cn+(Array.isArray(zn)?zn.length:0),0):0,zs=sn!==null||Object.values(ne.searchSpaceFieldErrors).some(Cn=>!!Cn);return{id:ne.id,label:ne.label||Ha(ye+1),modelLabel:xe||"Select model",searchStrategyLabel:ct??(Ve||"Random search"),scoringLabel:rt||"Estimator default",parameterCount:Wr,candidateCount:kr,hasErrors:zs}}),[f,D,K,p,V,pt]);N.useEffect(()=>{const ne=Yn.current;if(ne===null){Yn.current=Q;return}ne!==Q&&(Yn.current=Q,wn({}),Bt({}),Vn(!1),ls(!1))},[Q]),N.useEffect(()=>{!Q||!Z.length||wn(ne=>{const ye={...ne};let fe=!1;return Z.forEach(Pe=>{if(ht[Pe.name])return;const Ae=jt[Pe.name],xe=Array.isArray(Ae)&&Ae.length>0?Ae.map(st=>_j(Pe,st)).join(", "):"";ye[Pe.name]!==xe&&(ye[Pe.name]=xe,fe=!0)}),fe?ye:ne})},[jt,Z,Q,ht]),N.useEffect(()=>{if(!Q||!Z.length||_n)return;if(Lt){mt||Vn(!0);return}if(mt)return;const ne=sF(Z,ee);Object.keys(ne).length&&(Vn(!0),Bt({}),wn(()=>{const ye={};return Z.forEach(fe=>{if(!ne[fe.name])return;const Pe=ne[fe.name].map(Ae=>_j(fe,Ae)).filter(Ae=>Ae.length>0).join(", ");ye[fe.name]=Pe}),ye}),x(ye=>{const fe=ye?{...ye}:{};return fe.search_space=ne,fe}))},[mt,ee,Z,Q,Lt,_n,x]);const[Kt,Ts]=N.useState(ot??"");N.useEffect(()=>{Ts(ot??"")},[ot]);const Ut=N.useMemo(()=>rF[B==="regression"?"regression":"classification"],[B]),$e=(_==null?void 0:_.label)??"Scoring metric",Dt=(_==null?void 0:_.description)??"Pick the evaluation metric used to rank candidates.",Ps=N.useMemo(()=>`tuning-${e}-scoring-metric`,[e]),es=N.useMemo(()=>Object.values(ht).some(ne=>!!ne),[ht]),ue=N.useCallback((ne,ye)=>{de.has(ne)&&x(fe=>{const Pe={...fe},Ae=Ua(fe==null?void 0:fe.baseline_hyperparameters).value??{},st={...Dp(Ae,de)};return ye===void 0?delete st[ne]:st[ne]=ye,Object.keys(st).length>0?Pe.baseline_hyperparameters=st:delete Pe.baseline_hyperparameters,Pe})},[de,x]),we=N.useCallback((ne,ye)=>{wn(Ae=>({...Ae,[ne.name]:ye}));const{values:fe,error:Pe}=nF(ne,ye);Bt(Ae=>({...Ae,[ne.name]:Pe})),!Pe&&x(Ae=>{const xe={...Ae},st=Ua(Ae==null?void 0:Ae.search_space).value??{},ct={...Ip(st,de)};return fe.length>0?ct[ne.name]=fe.map(it=>is(it)):delete ct[ne.name],Object.keys(ct).length>0?xe.search_space=ct:delete xe.search_space,xe})},[de,x]),Fe=N.useCallback(ne=>{ue(ne,void 0)},[ue]),gt=N.useCallback(()=>{x(ne=>{if(!ne||!ne.baseline_hyperparameters)return ne??{};const ye={...ne};return delete ye.baseline_hyperparameters,ye})},[x]),ke=N.useCallback(()=>{ls(!0),Vn(!0),wn({}),Bt({}),x(ne=>{if(!ne||!ne.search_space)return ne??{};const ye={...ne};return delete ye.search_space,ye})},[x]),kt=N.useCallback(ne=>{Ts(ne);const ye=ne.trim();x(fe=>{const Pe={...fe};return ye.length>0?Pe.scoring_metric=ye:delete Pe.scoring_metric,Pe})},[x]),nt=N.useCallback(ne=>{if(!(ne!=null&&ne.name)||!de.has(ne.name))return null;const ye=`baseline-${e}-${ne.name}`,fe=gn[ne.name],Pe=fe!==void 0,Ae=ee==null?void 0:ee[ne.name],xe=ne.label??ne.name,st=ne.description,Ve=Ae!==void 0?`Default: ${Zd(Ae)}`:"Default: estimator setting";let ct;if(ne.type==="number"){const it=typeof fe=="number"?String(fe):"";ct=a.jsx("input",{id:ye,type:"number",className:"canvas-modal__parameter-input",value:it,onChange:rt=>{const _t=rt.target.value;if(!_t.length){Fe(ne.name);return}const sn=Number(_t);Number.isFinite(sn)&&ue(ne.name,sn)},min:ne.min,max:ne.max,step:ne.step,placeholder:"Leave blank to use default"})}else if(ne.type==="select"){const it=Pe?String(fe):"";ct=a.jsxs("select",{id:ye,className:"canvas-modal__parameter-select",value:it,onChange:rt=>{const _t=rt.target.value;if(!_t.length){Fe(ne.name);return}ue(ne.name,_t)},children:[a.jsx("option",{value:"",children:"Use default"}),(ne.options??[]).map(rt=>a.jsx("option",{value:String(rt.value),children:rt.label},String(rt.value)))]})}else if(ne.type==="boolean"){const it=Pe?fe?"true":"false":"";ct=a.jsxs("select",{id:ye,className:"canvas-modal__parameter-select",value:it,onChange:rt=>{const _t=rt.target.value;if(!_t.length){Fe(ne.name);return}ue(ne.name,_t==="true")},children:[a.jsx("option",{value:"",children:"Use default"}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]})}else{const it=typeof fe=="string"?fe:"";ct=a.jsx("input",{id:ye,type:"text",className:"canvas-modal__parameter-input",value:it,onChange:rt=>{const _t=rt.target.value;if(!_t.length){Fe(ne.name);return}ue(ne.name,_t)},placeholder:"Leave blank to use default"})}return a.jsxs("div",{className:"canvas-modal__parameter",children:[a.jsxs("label",{htmlFor:ye,className:"canvas-modal__parameter-label",children:[xe,st&&a.jsx("span",{className:"canvas-modal__parameter-description",children:st})]}),ct,a.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.4rem",gap:"0.75rem"},children:a.jsx("small",{style:{color:"rgba(148, 163, 184, 0.85)"},children:Pe?`Override: ${Zd(fe)}`:Ve})})]},ne.name)},[de,gn,ee,e,ue]),nn=N.useCallback(ne=>{if(!(ne!=null&&ne.name)||!de.has(ne.name))return null;const ye=`search-${e}-${ne.name}`,fe=ut[ne.name]??"",Pe=jt[ne.name],Ae=Array.isArray(Pe)?Pe.length:0,xe=ht[ne.name],st=ee==null?void 0:ee[ne.name],Ve=ne.type==="number"?"Comma or newline separated numbers (e.g. 0.01, 0.1, 1)":ne.type==="boolean"?"Enter true/false values, separated by commas or new lines":ne.type==="select"?"Comma or newline separated option values":"Comma or newline separated values",ct=Array.isArray(Pe)?Pe.slice(0,3).map(it=>Zd(it)).join(", "):"";return a.jsxs("div",{className:"canvas-modal__parameter",children:[a.jsxs("label",{htmlFor:ye,className:"canvas-modal__parameter-label",children:[ne.label??ne.name,ne.description&&a.jsx("span",{className:"canvas-modal__parameter-description",children:ne.description})]}),a.jsx("textarea",{id:ye,className:"canvas-modal__parameter-input",rows:3,value:fe,onChange:it=>we(ne,it.target.value),placeholder:Ve,style:{minHeight:"92px",resize:"vertical"}}),a.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.4rem",gap:"0.75rem",flexWrap:"wrap"},children:a.jsx("small",{style:{color:"rgba(148, 163, 184, 0.85)"},children:Ae>0?`Configured ${Ae} value${Ae===1?"":"s"}${ct?` (${ct}${Ae>3?"":""})`:""}`:`Default: ${Zd(st)}`})}),xe&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.5rem"},children:xe})]},ne.name)},[de,jt,we,ee,e,ht,ut]),vn=N.useMemo(()=>{if(!Lt)return{parameterCount:0,candidateProduct:null};const ne=Object.values(jt),ye=ne.length;let fe=null;if(ne.length>0){let Pe=1,Ae=!1;ne.forEach(xe=>{Pe*=Math.max(xe.length,1),(!Number.isFinite(Pe)||Pe>1e6)&&(Ae=!0)}),fe=Ae?null:Pe}return{parameterCount:ye,candidateProduct:fe}},[jt,Lt]),Mt=N.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),Zt=N.useCallback(ne=>{if(!Mt)return null;const ye=is(Mt);if(!ye||!Array.isArray(ye.nodes))return Mt;const fe=Dc(ne),Pe=Object.keys(fe).length>0;return ye.nodes=ye.nodes.map(Ae=>{if(!Ae||Ae.id!==e)return Ae;const xe=(Ae==null?void 0:Ae.data)??{},st=(xe==null?void 0:xe.config)??{},Ve=Dc(st),ct=Pe?{...Ve,...fe}:Ve;return{...Ae,data:{...xe,config:ct,isConfigured:!0}}}),ye},[Mt,e]),ts=N.useMemo(()=>{const ne=Zt(l);return ne||Mt},[l,Mt,Zt]),Tn=N.useMemo(()=>{if(!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges))return null;const ne=n.nodes,ye=n.edges;return(()=>{var st;const xe=ne.find(Ve=>(Ve==null?void 0:Ve.id)===e);return xe?gj((st=xe==null?void 0:xe.data)==null?void 0:st.connectedSplits):[]})().includes("validation")||ye.some(xe=>!xe||(typeof xe.target=="string"?xe.target:null)!==e?!1:(typeof xe.sourceHandle=="string"?xe.sourceHandle.toLowerCase():"").includes("validation"))?!0:ye.some(xe=>{var rt;if(!xe||(typeof xe.target=="string"?xe.target:null)!==e)return!1;const Ve=typeof xe.source=="string"?xe.source:null;if(!Ve)return!1;const ct=ne.find(_t=>(_t==null?void 0:_t.id)===Ve);return ct?gj((rt=ct==null?void 0:ct.data)==null?void 0:rt.activeSplits).includes("validation"):!1})?!1:null},[n,e]);N.useEffect(()=>{let ne=!1;return!t||!Mt?(R(null),()=>{ne=!0}):(Lo(t,Mt).then(ye=>{ne||R(ye)}).catch(()=>{ne||R(null)}),()=>{ne=!0})},[Mt,t]),N.useEffect(()=>{let ne=!1;E(null);const ye=ts??Mt;return!t||!ye?(b(null),()=>{ne=!0}):(Lo(t,ye).then(fe=>{ne||b(fe)}).catch(fe=>{ne||(E((fe==null?void 0:fe.message)??"Unable to compute pipeline ID"),b(null))}),()=>{ne=!0})},[Mt,ts,t]),N.useEffect(()=>{if(!j||!A){z(!1);return}z(j!==A)},[j,A]);const Pn=!!(t&&e),xs=N.useMemo(()=>["feature-canvas","hyperparameter-tuning-jobs",t??"none",j??"pending",e],[e,j,t]),jn=Es({queryKey:xs,queryFn:async()=>{var ye;const ne={datasetSourceId:t||void 0,nodeId:e,limit:5};if(j){const fe=await wc({...ne,pipelineId:j});if((((ye=fe==null?void 0:fe.jobs)==null?void 0:ye.length)??0)>0)return fe}return wc(ne)},enabled:Pn,retry:(ne,ye)=>ye.message.includes("Sign in")?!1:ne<2,refetchInterval:ne=>{const ye=ne.state.data;return((ye==null?void 0:ye.jobs)??[]).some(Ae=>Ae.status==="queued"||Ae.status==="running")?5e3:!1}}),{mutateAsync:Ln,isPending:bs,error:ws}=Oi({mutationFn:Nw,onSuccess:ne=>{const ye=Array.isArray(ne.jobs)?ne.jobs.length:0,fe=ye>0?ne.jobs[0]:null;O(fe),P(ye),v.invalidateQueries({queryKey:xs})}}),Ls=N.useMemo(()=>{const ne=[];return t||ne.push("Select a dataset before launching tuning jobs."),(!Mt||!Mt.nodes.length)&&ne.push("Connect this node to an upstream pipeline before tuning."),W||ne.push("Set a target column before tuning."),Tn===!1&&ne.push("Connect the validation split to this node to enable tuning."),Q||ne.push("Choose a model type before enqueuing tuning jobs."),pt.length===0&&ne.push("Add a tuning strategy before launching tuning jobs."),Lt||ne.push("Define at least one hyperparameter in the search space."),Wt&&ne.push(Wt),bn&&ne.push(bn),es&&ne.push("Resolve invalid candidate values in the search space."),(De==="random"||De==="optuna")&&!Oe&&ne.push("Provide the maximum iterations for random or Optuna search."),_e&&be<2&&ne.push("Cross-validation requires at least 2 folds."),S&&ne.push(S),ne},[Wt,_e,be,Mt,Lt,es,Q,S,Oe,bn,De,t,W,Tn,pt.length]),qr=((Js=jn.data)==null?void 0:Js.jobs)??[],Vr=jn.isLoading||jn.isFetching,St=jn.error,wl=N.useMemo(()=>!!(ws instanceof Error&&rl(ws.message)||I&&rl(I)||M&&Tc(M)||qr.some(ne=>Tc(ne))),[I,ws,M,qr]),dr=JN({graph:n,nodeId:e,modelType:Q,problemType:B,modelTypeOptions:f,enabled:wl});N.useEffect(()=>{dr||H(!1)},[dr]);const Qo=Ls.length>0||es||!j||!t||!Mt||pt.length===0||!Lt||bs,pa=N.useMemo(()=>d?f.length?{...d,options:f}:d:null,[f,d]),Zo=N.useCallback(async()=>{if(!j||!t||!Mt||pt.length===0)return;if(y){try{const Ae=y({closeModal:!1});z(!1),Ae&&typeof Ae.then=="function"&&await Ae}catch{}await new Promise(Ae=>setTimeout(Ae,100))}const ne=async()=>{const Ae=[],xe=[],st=async Ve=>{if(!Ve)return new Set;if(Ve===Q)return de;const ct=["model-hyperparameters",Ve],it=v.getQueryData(ct),rt=_t=>{const sn=new Set;return(_t??[]).forEach(It=>{It!=null&&It.name&&sn.add(It.name)}),sn};if(it)return rt(it.fields);try{const _t=await v.fetchQuery({queryKey:ct,queryFn:()=>Pd(Ve)});return rt(_t==null?void 0:_t.fields)}catch{return new Set}};for(let Ve=0;Ve<pt.length;Ve+=1){const ct=pt[Ve],it=ct.label||Ha(Ve+1),rt=ll(ct.config),_t=rt==null?void 0:rt[D],sn=typeof _t=="string"&&_t.trim().length?_t.trim():Q;if(!sn){xe.push(`${it} is missing a model selection.`);continue}const It=Qd(rt==null?void 0:rt[V],pe)??Ce??"random",Bn=await st(sn),kr=Ua(rt==null?void 0:rt.baseline_hyperparameters).value??{},zs=Bn.size>0?Dp(kr,Bn):is(kr),us=Ua(rt==null?void 0:rt.search_space);if(us.error){xe.push(`${it} has invalid search space: ${us.error}`);continue}const Ns=Rp(us.value);if(Ns.error){xe.push(`${it} has invalid search space: ${Ns.error}`);continue}const Cn=Ns.value??{},zn=Bn.size>0?Ip(Cn,Bn):is(Cn);if(!zn||Object.keys(zn).length===0){xe.push(`${it} requires at least one hyperparameter in the search space.`);continue}if(Object.values(ct.searchSpaceFieldErrors??{}).some(Jt=>!!Jt)){xe.push(`${it} has search space entries that need attention.`);continue}const _a=Object.keys(zn).length;let Yr=null;if(_a>0){let Jt=1,ss=!1;Object.values(zn).forEach(er=>{const Gc=Array.isArray(er)?er.length:0;Jt*=Math.max(Gc,1),(!Number.isFinite(Jt)||Jt>1e6)&&(ss=!0)}),Yr=ss?null:Jt}const ei=rt==null?void 0:rt[K],ya=typeof ei=="string"?ei.trim():"",Kr=ya.length?ya:null,to=()=>{const Jt=rt==null?void 0:rt[te];let ss=null;if(typeof Jt=="number"&&Number.isFinite(Jt))ss=Math.max(1,Math.floor(Jt));else if(typeof Jt=="string"){const er=Number(Jt.trim());Number.isFinite(er)&&er>0&&(ss=Math.max(1,Math.floor(er)))}return ss===null&&(It==="random"||It==="optuna")?Ye!==null?Ye:null:ss},ns=()=>{const Jt=rt==null?void 0:rt[G];let ss=null;if(typeof Jt=="number"&&Number.isFinite(Jt))ss=Math.trunc(Jt);else if(typeof Jt=="string"){const er=Number(Jt.trim());Number.isFinite(er)&&(ss=Math.trunc(er))}return ss===null&&(It==="random"||It==="optuna")?at!==null?at:null:ss},mr=to(),va=ns(),mn={};W&&(mn.target_column=W),mn.problem_type=B,mn.strategy_id=ct.id,mn.strategy_label=it,mn.strategy_index=Ve+1,mn.search_strategy=It,mr!==null&&(It==="random"||It==="optuna")&&(mn.max_iterations=mr),Kr&&(mn.scoring_metric=Kr),va!==null&&(mn.random_state=va),mn.search_space_keys=Object.keys(zn),_a>0&&(mn.search_space_parameters=_a),Yr!==null&&(mn.search_space_candidates=Yr),mn.cross_validation={enabled:_e,strategy:ge,folds:be,shuffle:ze,random_state:Ee};const ti=Zt(rt)??Mt;if(!ti){xe.push(`Unable to build pipeline graph for ${it}.`);continue}const ni=zs&&Object.keys(zs).length>0?is(zs):void 0,si=is(zn),Mr={dataset_source_id:t,pipeline_id:j,node_id:e,model_type:sn,model_types:[sn],search_strategy:It,search_space:si,baseline_hyperparameters:ni,n_iterations:It==="random"||It==="optuna"?mr??void 0:void 0,scoring:Kr??void 0,random_state:va??void 0,cross_validation:{enabled:_e,strategy:ge,folds:be,shuffle:ze,random_state:Ee},metadata:mn,job_metadata:mn,run_tuning:!0,graph:ti,target_node_id:e};Ae.push({payload:Mr,label:it})}return{plans:Ae,issues:xe}};U(null);const{plans:ye,issues:fe}=await ne();if(!ye.length){fe.length&&U(fe.join(" "));return}const Pe=[];for(const{payload:Ae}of ye)try{const xe=await Ln(Ae);Array.isArray(xe==null?void 0:xe.jobs)&&xe.jobs.length&&Pe.push(...xe.jobs)}catch(xe){xe instanceof Error&&xe.message?U(xe.message):U("Failed to enqueue one or more tuning jobs.");return}if(Pe.length){const Ae=Pe[Pe.length-1];O(Ae),P(Pe.length)}},[de,_e,be,Ee,ze,ge,Ln,Mt,Zt,Q,D,e,y,Ce,v,j,B,K,Ye,te,at,G,V,U,z,t,pt,W]),Nl=N.useCallback(()=>{Pn&&jn.refetch()},[Pn,jn]),Jo=ne=>{var Wr,kr,zs,us,Ns;const ye=J3[ne.status]??ne.status,Pe=(((Wr=f.find(Cn=>Cn.value===ne.model_type))==null?void 0:Wr.label)??ne.model_type??"").trim(),Ae=(()=>{switch(ne.search_strategy){case"grid":return"Grid search";case"halving":return"Successive halving";case"halving_random":return"Successive halving (randomized)";case"optuna":return"Optuna search";default:return"Random search"}})(),xe=ne.updated_at?Fn(ne.updated_at):null,st=ne.updated_at||ne.created_at,Ve=st?xe??new Date(st).toLocaleString():null,ct=typeof ne.error_message=="string"?ne.error_message.trim():"",it=[];Pe&&it.push(`Model ${Pe}`),it.push(Ae),Array.isArray(ne.results)&&ne.results.length>0&&it.push(`${ne.results.length} candidates`);const rt=typeof ne.best_score=="number"&&Number.isFinite(ne.best_score)?ne.best_score:typeof((kr=ne.metrics)==null?void 0:kr.best_score)=="number"?ne.metrics.best_score:null;rt!==null&&it.push(`Best score ${eF(rt)}`);const _t=String(((zs=ne.metrics)==null?void 0:zs.scoring)??((us=ne.metrics)==null?void 0:us.scorer)??((Ns=ne.metadata)==null?void 0:Ns.scoring_metric)??"").trim();if(_t&&it.push(`Scoring ${_t}`),ne.status==="failed"&&ct){const Cn=ct.replace(/\s+/g," ");it.push(`Error: ${Cn}`)}Ve&&it.push(`Updated ${Ve}`);const sn=ne.status==="running"||ne.status==="queued",It=ne.progress??0,Bn=ne.current_step;return a.jsxs("li",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[a.jsxs("span",{children:[a.jsxs("strong",{children:["Run ",ne.run_number]}),"  ",ye]}),sn&&a.jsx("button",{type:"button",onClick:Cn=>{Cn.stopPropagation(),k(ne.id)},disabled:w.isPending,title:"Cancel this job (may not be immediate on Windows)",style:{padding:"2px 8px",fontSize:"0.75rem",fontWeight:500,color:"#b91c1c",background:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"4px",cursor:"pointer"},children:"Cancel"})]}),sn&&a.jsxs("span",{style:{fontSize:"0.85em",color:"#666"},children:[It,"% ",Bn?` ${Bn}`:""]})]}),sn&&a.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"#eee",borderRadius:"2px",overflow:"hidden"},children:a.jsx("div",{style:{width:`${It}%`,height:"100%",background:"linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%)",transition:"width 0.3s ease"}})}),a.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:it.length?it.join("  "):""})]},ne.id)};return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Hyperparameter tuning jobs"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:$n,children:"Add strategy"}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Nl,disabled:!Pn||Vr,children:Vr?"Refreshing":"Refresh jobs"})]})]}),a.jsx("p",{className:"canvas-modal__note",children:"Launch background tuning jobs that evaluate candidate hyperparameters via cross-validation. Jobs are versioned per pipeline and surface the best configuration when finished."}),j&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Pipeline ID: ",a.jsx("code",{children:j})]}),F&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{background:"rgba(251, 146, 60, 0.1)",borderLeft:"3px solid rgba(251, 146, 60, 0.8)",padding:"0.75rem 1rem",margin:"0.75rem 0",display:"flex",alignItems:"start",gap:"0.5rem"},children:[a.jsx(za,{size:16,style:{marginTop:"2px",flexShrink:0}}),a.jsxs("span",{children:[a.jsx("strong",{children:"Unsaved Configuration Changes"}),a.jsx("br",{}),"Enqueuing a tuning job saves the current configuration so results align with this pipeline snapshot."]})]}),Ls.map((ne,ye)=>a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:ne},`tuning-prereq-${ye}`)),ws instanceof Error&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:ws.message}),I&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:I}),St&&!(ws instanceof Error)&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:St.message||"Unable to load tuning jobs."}),M&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:$>1?a.jsxs("span",{children:["Queued ",$," tuning jobs. Latest job ",M.id," (run ",M.run_number,")."]}):a.jsxs("span",{children:["Tuning job ",M.id," queued (run ",M.run_number,")."]})}),Lt&&vn.parameterCount>0&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Search space covers ",vn.parameterCount," hyperparameter",vn.parameterCount===1?"":"s",vn.candidateProduct!==null?`  up to ${vn.candidateProduct.toLocaleString()} combinations`:"","."]}),a.jsxs("div",{className:"canvas-imputer__list",style:{marginTop:"1.25rem"},children:[pt.length===0&&a.jsx("p",{style:{margin:"0",padding:"1rem 1.25rem",border:"1px dashed rgba(148, 163, 184, 0.4)",borderRadius:"6px",color:"rgba(148, 163, 184, 0.85)",background:"rgba(15, 23, 42, 0.35)"},children:'No tuning strategies configured yet. Use "Add strategy" to define your search plan.'}),pt.map((ne,ye)=>{const fe=$s[ye],Pe=!!(vt&&vt.id===ne.id),Ae=ys.has(ne.id),xe=[];if(fe!=null&&fe.modelLabel&&xe.push(fe.modelLabel),fe!=null&&fe.searchStrategyLabel&&xe.push(fe.searchStrategyLabel),fe!=null&&fe.scoringLabel&&xe.push(`Scoring ${fe.scoringLabel}`),fe!=null&&fe.parameterCount){const Ve=fe.candidateCount?`${fe.parameterCount} param${fe.parameterCount===1?"":"s"}  ${fe.candidateCount} candidate${fe.candidateCount===1?"":"s"}`:`${fe.parameterCount} param${fe.parameterCount===1?"":"s"}`;xe.push(Ve)}else xe.includes("Needs attention")||xe.push("No search values");fe!=null&&fe.hasErrors&&xe.push("Needs attention");const st=xe.length>0?xe.join("  "):"Configure strategy settings";return a.jsxs("div",{className:"canvas-imputer__card",children:[a.jsxs("div",{className:"canvas-imputer__card-header",children:[a.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>{Xs(ne.id),Pe||vs(ne.id)},"aria-expanded":Ae,"aria-controls":`tuning-strategy-body-${ne.id}`,children:[a.jsx("span",{className:`canvas-imputer__toggle-icon${Ae?" canvas-imputer__toggle-icon--open":""}`,"aria-hidden":"true"}),a.jsxs("span",{className:"canvas-imputer__card-text",children:[a.jsx("span",{className:"canvas-imputer__card-title",children:(fe==null?void 0:fe.label)??Ha(ye+1)}),a.jsx("span",{className:"canvas-imputer__card-summary",children:st})]})]}),pt.length>1&&a.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>cs(ne.id),"aria-label":`Remove ${(fe==null?void 0:fe.label)??Ha(ye+1)}`,children:"Remove"})]}),Ae&&Pe&&a.jsxs("div",{className:"canvas-imputer__card-body",id:`tuning-strategy-body-${ne.id}`,children:[a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[pa&&u(pa),p&&u(p),(De==="random"||De==="optuna")&&m&&u(m),(De==="random"||De==="optuna")&&h&&u(h)]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"1rem 1.25rem",background:"rgba(15, 23, 42, 0.25)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[a.jsx("div",{style:{fontWeight:600,color:"#e2e8f0",display:"block"},children:$e}),a.jsx("p",{style:{margin:"0.4rem 0 0.75rem",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:Dt}),a.jsxs("div",{id:Ps,style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.4rem 0.75rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",fontSize:"0.85rem",maxWidth:"320px",marginBottom:"0.75rem"},children:[a.jsx("span",{style:{opacity:.75},children:"Selected:"}),a.jsx("strong",{style:{color:"#e2e8f0"},children:Kt||"Estimator default"})]}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.75rem"},children:[Ut.map(Ve=>a.jsx("button",{type:"button",onClick:()=>kt(Ve.value),style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:Kt===Ve.value?"rgba(59, 130, 246, 0.2)":"rgba(15, 23, 42, 0.35)",color:Kt===Ve.value?"#bfdbfe":"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:Ve.label},Ve.value)),a.jsx("button",{type:"button",onClick:()=>kt(""),style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:"Reset to default"})]})]}),Q&&Z.length>0&&a.jsxs("div",{style:{marginTop:"1.25rem",padding:"1.25rem",background:"rgba(15, 23, 42, 0.2)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"0.75rem"},children:[a.jsxs("div",{children:[a.jsx("h4",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#e2e8f0"},children:"Baseline hyperparameter overrides"}),a.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:"Pre-fill model defaults before the search runs. Leave fields blank to keep the template values."})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.5rem"},children:[a.jsx("span",{style:{fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:cn>0?`${cn} override${cn===1?"":"s"} configured`:"Using template defaults"}),cn>0&&a.jsx("button",{type:"button",onClick:gt,style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:"Reset overrides"})]})]}),Wt&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.75rem"},children:Wt}),a.jsx("div",{style:{marginTop:"1rem",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:Z.map(nt)})]}),Q&&Z.length>0&&a.jsxs("div",{style:{marginTop:"1.25rem",padding:"1.25rem",background:"rgba(15, 23, 42, 0.2)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"0.75rem"},children:[a.jsxs("div",{children:[a.jsx("h4",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#e2e8f0"},children:"Search space"}),a.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:"Provide candidate values for each hyperparameter. Separate entries with commas or new lines."})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.5rem"},children:[a.jsx("span",{style:{fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:un>0?`${un} parameter${un===1?"":"s"} targeted`:"No parameters queued for tuning yet"}),a.jsx("button",{type:"button",onClick:ke,disabled:un===0,style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:un===0?"rgba(15, 23, 42, 0.2)":"rgba(15, 23, 42, 0.35)",color:un===0?"rgba(148, 163, 184, 0.5)":"rgba(203, 213, 225, 0.9)",cursor:un===0?"not-allowed":"pointer"},children:"Clear search space"})]})]}),bn&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.75rem"},children:bn}),es&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{marginTop:"0.75rem"},children:"Fix the highlighted search entries before launching tuning jobs."}),a.jsx("div",{style:{marginTop:"1rem",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:"1rem"},children:Z.map(nn)})]})]})]},ne.id)})]}),_e&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Cross-validation evaluates each candidate with ",be," folds before reporting aggregate metrics."]}),dr&&a.jsxs("div",{className:"canvas-modal__note canvas-modal__note--warning",style:{margin:"0.75rem 0",borderLeft:"3px solid rgba(251, 191, 36, 0.9)",background:"rgba(251, 191, 36, 0.12)",padding:"0.75rem 1rem"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"0.75rem"},children:[a.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"start"},children:[a.jsx(za,{size:16,style:{marginTop:"2px",flexShrink:0}}),a.jsxs("div",{children:[a.jsx("strong",{children:dr.headline}),a.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem"},children:dr.summary})]})]}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>H(ne=>!ne),style:{whiteSpace:"nowrap"},children:q?"Hide tips":"Show tips"})]}),q&&a.jsx("ul",{style:{margin:"0.75rem 0 0 1rem",padding:0,listStyle:"disc",fontSize:"0.85rem"},children:dr.details.map((ne,ye)=>a.jsx("li",{style:{marginBottom:"0.35rem"},children:ne},`tuning-scaling-tip-${ye}`))})]}),a.jsx("div",{className:"canvas-modal__actions",children:a.jsx("button",{type:"button",className:"btn btn-primary",onClick:Zo,disabled:Qo,children:bs?"Queuing":"Launch tuning job"})}),Vr&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading recent jobs"}),!Vr&&qr.length===0&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No tuning jobs found for this node."}),qr.length>0&&a.jsx("ul",{className:"canvas-modal__note-list",children:qr.map(Jo)})]})},Up={undersampling:{auto:"auto (match majority to the smallest class)",majority:"majority (down-sample only the majority class)","not minority":"not minority (down-sample all but the minority class)","not majority":"not majority (down-sample every class except the majority)",all:"all (down-sample every class)"},oversampling:{auto:"auto (boost minority class to majority size)",minority:"minority (only over-sample the minority class)","not minority":"not minority (over-sample every class except the minority)","not majority":"not majority (avoid synthesising the majority class)",all:"all (over-sample all classes equally)"}},uF=(e,t)=>{if(e==null||e==="")return Up[t].auto;if(typeof e=="number"){if(!Number.isFinite(e))return Up[t].auto;const s=Math.max(Math.min(e,1),0),r=s*100,i=s.toFixed(s>=.1||s===0?2:3),l=t==="undersampling"?"majority":"majority baseline";return`${i} ratio (${r.toFixed(1)}% of ${l})`}const n=e.trim().toLowerCase();return Up[t][n]??n},dF=(e,t)=>{const n=t==="oversampling"?["over-sampling","oversampling","smote","adasyn","tomek","svm smote","kmeans smote","borderline smote"]:["under-sampling","undersampling","resampling"];for(let s=e.length-1;s>=0;s-=1){const r=e[s];if(typeof r!="string")continue;const i=r.toLowerCase();if(n.some(l=>i.includes(l)))return r}return null},mF=(e,t)=>t?"Missing":e.length?e:"Empty string",fF=({mode:e="undersampling",sourceId:t,hasReachableSource:n,previewState:s,onRefreshPreview:r,config:i,methodParameter:l,targetColumnParameter:u,samplingStrategyParameter:d,randomStateParameter:f,replacementParameter:p,kNeighborsParameter:m,renderParameterField:h,formatMetricValue:_,formatMissingPercentage:x,schemaGuard:y})=>{var D;const v=s.data,w=s.status,k=Array.isArray(v==null?void 0:v.applied_steps)?v==null?void 0:v.applied_steps:[],j=N.useMemo(()=>dF(k,e),[k,e]),b=(i==null?void 0:i.targetColumn)??"",S=(i==null?void 0:i.method)||(typeof(l==null?void 0:l.default)=="string"?l.default:""),E=N.useMemo(()=>{const V=Array.isArray(l==null?void 0:l.options)?l==null?void 0:l.options:[];if(S){const te=V.find(G=>G.value===S);return te!=null&&te.label?te.label:S.replace(/_/g," ")}return V.length>0?V[0].label??V[0].value:e==="undersampling"?"Random under-sampling":"Synthetic over-sampling"},[S,l==null?void 0:l.options,e]),M=N.useMemo(()=>uF(i==null?void 0:i.samplingStrategy,e),[i==null?void 0:i.samplingStrategy,e]),O=N.useMemo(()=>(i==null?void 0:i.randomState)===null||(i==null?void 0:i.randomState)===void 0?"Not set":Number.isFinite(i.randomState)?String(i.randomState):"Not set",[i==null?void 0:i.randomState]),$=N.useMemo(()=>{if(e!=="oversampling")return null;const V=i==null?void 0:i.kNeighbors;if(typeof V=="number"&&Number.isFinite(V))return String(Math.max(1,Math.round(V)));if(m&&typeof m.default=="number"){const te=m.default;if(Number.isFinite(te))return String(Math.max(1,Math.round(te)))}return"Default"},[i==null?void 0:i.kNeighbors,m,e]),P=(i==null?void 0:i.replacement)===null||(i==null?void 0:i.replacement)===void 0?null:i.replacement?"With replacement":"Without replacement",A=N.useMemo(()=>{if(w!=="success"||!v||!b)return{rows:[],total:0,truncated:!1};const V=Array.isArray(v.sample_rows)?v.sample_rows:[];if(!V.length)return{rows:[],total:0,truncated:!1};const te=new Map;V.forEach(ee=>{if(!ee||typeof ee!="object")return;const de=ee[b],_e=de==null,ge=_e?"__missing__":String(de),be=mF(_e?"":ge,_e),ze=te.get(ge);ze?ze.count+=1:te.set(ge,{label:be,count:1,percentage:0,isMissing:_e})});const G=Array.from(te.values()).sort((ee,de)=>de.count-ee.count),K=G.reduce((ee,de)=>ee+de.count,0),X=8,Q=G.length>X;return{rows:(Q?G.slice(0,X):G).map(ee=>({...ee,percentage:K>0?ee.count/K*100:0})),total:K,truncated:Q}},[v,w,b]),R=((D=v==null?void 0:v.metrics)==null?void 0:D.row_count)??null,F=!!t&&n&&w!=="loading"&&!(y!=null&&y.blocked),z=N.useMemo(()=>t?n?null:"Link this node to the dataset input to evaluate class balance.":"Connect to a dataset to preview class distributions.",[n,t]),I=N.useMemo(()=>!(y!=null&&y.blocked)||!y.details.length?"":y.details.map(V=>V.logical_family?`${V.name} (${V.logical_family})`:V.name).join(", "),[y]),U=!b,q=!!b&&Array.isArray(v==null?void 0:v.columns)&&!(v!=null&&v.columns.includes(b)),H=e==="undersampling"?"Class undersampling":"Class oversampling",W=e==="undersampling"?"Random under-sampling trims majority-class examples to mitigate imbalance before training downstream models. It preserves minority class signals but can discard information from majority classes when ratios are aggressive.":"Synthetic over-sampling boosts minority representation by generating new samples. Integer feature columns are temporarily cast to float so synthesized values can include decimals, which helps models learn rare classes while requiring careful preprocessing to avoid noise.",B=e==="undersampling"?"enable undersampling":"enable oversampling";return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:H}),a.jsx("div",{className:"canvas-modal__section-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,disabled:!F,children:w==="loading"?"Refreshing":"Refresh preview"})})]}),a.jsx("p",{className:"canvas-modal__note",children:W}),z&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:z}),U&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Specify a target column to compute class ratios and ",B,"."]}),(y==null?void 0:y.blocked)&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[y.message,I&&a.jsxs(a.Fragment,{children:[" ","Columns: ",I,"."]})]}),w==="error"&&s.error&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s.error}),q&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Target column ",b," is not present in the current preview. Check upstream nodes or refresh the dataset snapshot."]}),j&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:j}),a.jsxs("ul",{className:"canvas-modal__note-list",children:[a.jsxs("li",{children:["Method: ",a.jsx("strong",{children:E})]}),a.jsxs("li",{children:["Sampling strategy: ",a.jsx("strong",{children:M})]}),e==="oversampling"&&$&&a.jsxs("li",{children:["k-neighbors: ",a.jsx("strong",{children:$})]}),P&&a.jsxs("li",{children:["Replacement: ",a.jsx("strong",{children:P})]}),a.jsxs("li",{children:["Random state: ",a.jsx("strong",{children:O})]})]}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[l&&h(l),d&&h(d),e==="oversampling"&&m&&h(m),f&&h(f),p&&h(p)]}),u&&a.jsx("div",{className:"canvas-modal__parameter-list",children:h(u)}),b&&w==="success"&&!q&&(A.rows.length?a.jsxs("div",{className:"canvas-cast__table-wrapper",children:[a.jsxs("table",{className:"canvas-cast__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Class"}),a.jsx("th",{scope:"col",children:"Sample count"}),a.jsx("th",{scope:"col",children:"Share"})]})}),a.jsx("tbody",{children:A.rows.map(V=>a.jsxs("tr",{children:[a.jsx("th",{scope:"row",children:V.label}),a.jsx("td",{children:_(V.count)}),a.jsx("td",{children:x(V.percentage)})]},`resampling-class-${V.label}`))})]}),a.jsxs("p",{className:"canvas-modal__note",children:["Analysed ",_(A.total)," row",A.total===1?"":"s"," from the preview.",A.truncated?" Showing top classes by frequency.":""]}),R!==null&&a.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Preview rows after resampling: ",_(R),"."]})]}):a.jsx("p",{className:"canvas-modal__note",children:"No class distribution available in the preview sample. Refresh after configuring the node or increasing the sample size."}))]})},hF=["int","float","double","numeric","number"],jj=e=>{if(!e)return!1;const t=e.toLowerCase();return hF.some(n=>t.includes(n))},pF=({catalogFlags:e,skewnessData:t,skewnessTransformations:n,availableColumns:s,previewColumns:r,columnTypeMap:i,updateSkewnessTransformations:l})=>{const{isSkewnessNode:u,isSkewnessDistributionNode:d}=e,f=u||d,[p,m]=N.useState("recommended"),[h,_]=N.useState(!1),[x,y]=N.useState("before"),v=n.length,w=N.useMemo(()=>t!=null&&t.methods?[...t.methods]:[],[t==null?void 0:t.methods]),k=N.useMemo(()=>bz(w),[w]),j=N.useMemo(()=>t!=null&&t.columns?[...t.columns]:[],[t==null?void 0:t.columns]),b=N.useMemo(()=>{const B=new Map;return j.forEach(D=>{D&&D.column&&B.set(D.column,D)}),B},[j]),S=N.useMemo(()=>{const B=new Set;return j.forEach(D=>{D!=null&&D.column&&B.add(D.column)}),s.forEach(D=>{D&&jj(i[D]??null)&&B.add(D)}),r.forEach(D=>{const V=typeof D=="string"?D.trim():"";V&&jj(i[V]??null)&&B.add(V)}),Array.from(B).sort((D,V)=>D.localeCompare(V))},[s,r,j,i]);N.useEffect(()=>{p==="recommended"&&j.length===0&&S.length>0&&m("all")},[S.length,j.length,p]);const E=(t==null?void 0:t.skewness_threshold)??null,M=N.useCallback(B=>k[B]??B,[k]),O=N.useCallback((B,D)=>{const V=b.get(B);return!V||!V.method_status?{status:"ready",reason:void 0}:V.method_status[D]??{status:"ready",reason:void 0}},[b]),$=N.useCallback(()=>{const B=j.map(D=>{if(!D||!D.column)return null;const V=Array.isArray(D.recommended_methods)?D.recommended_methods.find(oa):void 0;return V?{column:D.column,method:V}:null}).filter(D=>!!D);B.length&&l(D=>{const V=new Map;return D.forEach(te=>{const G=typeof te.column=="string"?te.column.trim():"";G&&oa(te.method)&&V.set(G,te.method)}),B.forEach(te=>{const G=typeof te.column=="string"?te.column.trim():"";G&&V.set(G,te.method)}),Array.from(V.entries()).map(([te,G])=>({column:te,method:G}))})},[j,l]),P=N.useMemo(()=>{const B=new Map;return n.forEach(D=>{const V=typeof D.column=="string"?D.column.trim():"";!V||B.has(V)||B.set(V,D.method)}),B},[n]),A=N.useCallback((B,D)=>{const V=typeof B=="string"?B.trim():"";V&&l(te=>{const G=te.filter(K=>K.column!==V);return D?[...G,{column:V,method:D}]:G})},[l]),R=N.useCallback((B,D)=>{if(B){if(!D){A(B,null);return}oa(D)&&A(B,D)}},[A]),F=N.useCallback(()=>{l(()=>[])},[l]),z=j.length,I=N.useMemo(()=>j.some(B=>B&&typeof B.column=="string"&&Array.isArray(B.recommended_methods)&&B.recommended_methods.some(oa)),[j]),U=S.length,q=N.useMemo(()=>wz({viewMode:p,recommendations:j,columnOptions:S,recommendationMap:b,transformationMap:P}),[p,j,S,b,P]),H=N.useMemo(()=>f?j.map(B=>{var ee;if(!B||!B.column)return null;const D=B.distribution_before??B.distribution??null;if(!D||!Array.isArray(D.bin_edges)||!Array.isArray(D.counts)||D.counts.length===0||D.bin_edges.length!==D.counts.length+1)return null;let V=B.distribution_after??null;V&&(!Array.isArray(V.bin_edges)||!Array.isArray(V.counts)||V.counts.length===0||V.bin_edges.length!==V.counts.length+1)&&(V=null);const te=((ee=B.recommended_methods)==null?void 0:ee.find(oa))??null,G=B.magnitude?`${B.magnitude.charAt(0).toUpperCase()}${B.magnitude.slice(1)}`:null,K=B.direction?Iw[B.direction]??B.direction:null,X=B.applied_method&&oa(B.applied_method)?B.applied_method:null,Q=P.get(B.column)??null,J=X??Q??null,Z=J?M(J):null;return{column:B.column,skewness:typeof B.skewness=="number"?B.skewness:null,magnitudeLabel:G,directionLabel:K,summary:B.summary??null,recommendedLabel:Z?null:te?M(te):null,appliedLabel:Z,distributionBefore:D,distributionAfter:V}}).filter(B=>!!B).sort((B,D)=>{const V=B.skewness!==null?Math.abs(B.skewness):-1/0,te=D.skewness!==null?Math.abs(D.skewness):-1/0;return V!==te?te-V:B.column.localeCompare(D.column)}):[],[M,f,j,P]),W=N.useMemo(()=>Nz(q,h,M),[q,h,M]);return{state:{threshold:E,viewMode:p,groupByMethod:h,distributionView:x,recommendedCount:z,numericCount:U,transformationsCount:v,hasAutoRecommendations:I,rows:q,tableGroups:W,distributionCards:H},handlers:{setViewMode:m,setGroupByMethod:_,setDistributionView:y,getMethodLabel:M,getMethodStatus:O,applyRecommendations:$,handleOverrideChange:R,clearTransformations:F}}},gF=({catalogFlags:e,imputerStrategies:t,availableColumns:n,columnMissingMap:s,previewColumns:r,previewColumnStats:i,nodeColumns:l,imputerMissingFilter:u})=>{const{isImputerNode:d}=e,f=N.useMemo(()=>{if(!d)return[];const _=r.length?new Set(r.map(b=>typeof b=="string"?b.trim():"").filter(b=>b.length>0)):null,x=new Set;t.forEach(b=>{b.columns.forEach(S=>{const E=typeof S=="string"?S.trim():"";E&&x.add(E)})}),Ge(l).forEach(b=>{b&&x.add(b)});const y=b=>!_||_.size===0?!1:!_.has(b)&&!x.has(b),v=new Map,w=(b,S)=>{const E=typeof b=="string"?b.trim():"";if(!E||y(E))return;const M=v.get(E)??{missingPercentage:null,dtype:void 0,mean:null,median:null,mode:null};S&&(typeof S.missingPercentage=="number"&&!Number.isNaN(S.missingPercentage)&&(M.missingPercentage=Math.max(0,S.missingPercentage)),S.dtype!==void 0&&(M.dtype=S.dtype),typeof S.mean=="number"&&!Number.isNaN(S.mean)&&(M.mean=S.mean),typeof S.median=="number"&&!Number.isNaN(S.median)&&(M.median=S.median),S.mode!==void 0&&S.mode!==null&&S.mode!==""&&(M.mode=S.mode)),v.set(E,M)};n.forEach(b=>{const S=Object.prototype.hasOwnProperty.call(s,b)?s[b]:null;w(b,{missingPercentage:typeof S=="number"?S:null})}),(Array.isArray(i)?i:[]).forEach(b=>{!b||!b.name||w(b.name,{missingPercentage:typeof b.missing_percentage=="number"?b.missing_percentage:null,dtype:b.dtype??null,mean:typeof b.mean=="number"?b.mean:null,median:typeof b.median=="number"?b.median:null,mode:b.mode??null})}),Ge(l).forEach(b=>w(b)),t.forEach(b=>{b.columns.forEach(S=>w(S))});const j=Array.from(v.entries()).map(([b,S])=>({name:b,missingPercentage:typeof S.missingPercentage=="number"&&!Number.isNaN(S.missingPercentage)?Math.max(0,S.missingPercentage):null,dtype:S.dtype??null,mean:typeof S.mean=="number"&&!Number.isNaN(S.mean)?S.mean:null,median:typeof S.median=="number"&&!Number.isNaN(S.median)?S.median:null,mode:S.mode!==void 0&&S.mode!==null&&S.mode!==""?S.mode:null}));return j.sort((b,S)=>{const E=typeof b.missingPercentage=="number",M=typeof S.missingPercentage=="number";return E&&M&&b.missingPercentage!==S.missingPercentage?S.missingPercentage-b.missingPercentage:E!==M?E?-1:1:b.name.localeCompare(S.name)}),j},[n,s,t,l,i,r,d]),p=N.useMemo(()=>{if(!f.length)return 100;const _=f.reduce((y,v)=>{const w=typeof v.missingPercentage=="number"?v.missingPercentage:0;return w>y?w:y},0),x=Math.ceil(_/5)*5;return Math.max(100,x||0)},[f]),m=N.useMemo(()=>f.length?f.reduce((_,x)=>{const y=typeof x.missingPercentage=="number"?x.missingPercentage:null;return y!==null?y<=0?_:y>=u?_+1:_:u===0?_+1:_},0):0,[f,u]),h=u>0;return{imputerColumnOptions:f,imputerMissingSliderMax:p,imputerFilteredOptionCount:m,imputerMissingFilterActive:h}},_F=({suggestedThreshold:e,thresholdParameterName:t,configState:n,handleParameterChange:s})=>{const r=N.useMemo(()=>{if(e===null||Number.isNaN(Number(e)))return null;const d=Number(e);return Math.round(d*10)/10},[e]),i=N.useMemo(()=>{if(t===null||r===null)return!1;const d=Number(n==null?void 0:n[t]);return!Number.isNaN(d)&&d===r},[n,r,t]),l=r!==null&&!i,u=N.useCallback(()=>{r===null||!t||s(t,r)},[s,r,t]);return{normalizedSuggestedThreshold:r,thresholdMatchesSuggestion:i,canApplySuggestedThreshold:l,handleApplySuggestedThreshold:u}},yF=({catalogFlags:e,skewnessData:t,skewnessTransformations:n,availableColumns:s,previewColumns:r,columnTypeMap:i,updateSkewnessTransformations:l,imputerStrategies:u,columnMissingMap:d,previewColumnStats:f,nodeColumns:p,imputerMissingFilter:m,suggestedThreshold:h,thresholdParameterName:_,configState:x,handleParameterChange:y})=>{const v=pF({catalogFlags:e,skewnessData:t,skewnessTransformations:n,availableColumns:s,previewColumns:r,columnTypeMap:i,updateSkewnessTransformations:l}),w=gF({catalogFlags:e,imputerStrategies:u,availableColumns:s,columnMissingMap:d,previewColumns:r,previewColumnStats:f,nodeColumns:p,imputerMissingFilter:m}),k=_F({suggestedThreshold:h,thresholdParameterName:_,configState:x,handleParameterChange:y});return{skewness:v,imputationConfiguration:w,thresholdRecommendations:k}},vF=({graphSnapshot:e,nodeId:t,catalogFlags:n})=>{const{isDataset:s}=n,r=N.useMemo(()=>{if(!e)return null;const h=Array.isArray(e.nodes)?e.nodes:[],_=Array.isArray(e.edges)?e.edges:[];return{nodes:h,edges:_}},[e]),i=N.useMemo(()=>e&&Array.isArray(e.nodes)?e.nodes:[],[e]),l=N.useMemo(()=>e&&Array.isArray(e.edges)?e.edges:[],[e]),u=i.length,d=N.useMemo(()=>{if(!t||!l.length)return[];const h=new Set,_=[t];for(;_.length;){const y=_.pop();y&&l.forEach(v=>{const w=v&&typeof v.source=="string"?v.source.trim():"",k=v&&typeof v.target=="string"?v.target.trim():"";!w||!k||k===y&&!h.has(w)&&(h.add(w),_.push(w))})}const x=Array.from(h);return x.sort(),x},[l,t]),f=N.useMemo(()=>{var x,y,v,w,k;if(!d.length)return"";let h="",_="";for(const j of d){const b=i.find(E=>(E==null?void 0:E.id)===j);if(!b)continue;const S=String(((x=b==null?void 0:b.data)==null?void 0:x.catalogType)??"").toLowerCase().trim();if(S==="feature_target_split"){const E=(v=(y=b==null?void 0:b.data)==null?void 0:y.config)==null?void 0:v.target_column;typeof E=="string"&&E.trim()&&(h=E.trim())}else if(S==="train_test_split"){const E=(k=(w=b==null?void 0:b.data)==null?void 0:w.config)==null?void 0:k.target_column;typeof E=="string"&&E.trim()&&(_=E.trim())}}return h||_||""},[i,d]),p=N.useMemo(()=>{const h=new Set;return i.forEach(_=>{if(!_)return;const x=typeof _.id=="string"?_.id.trim():String((_==null?void 0:_.id)??"").trim();if(!x)return;const y=(_==null?void 0:_.data)??{};(x==="dataset-source"||(y==null?void 0:y.isDataset)===!0||(y==null?void 0:y.catalogType)==="dataset")&&h.add(x)}),h.size||h.add("dataset-source"),Array.from(h)},[i]),m=N.useMemo(()=>{if(!t)return!1;if(s)return!0;if(!l.length)return p.includes(t);const h=new Map;l.forEach(y=>{const v=y==null?void 0:y.source,w=y==null?void 0:y.target,k=typeof v=="string"?v.trim():String(v??"").trim(),j=typeof w=="string"?w.trim():String(w??"").trim();if(!k||!j)return;const b=h.get(k);b?b.push(j):h.set(k,[j])});const _=new Set,x=[...p];for(;x.length;){const y=x.pop();if(!y||_.has(y))continue;_.add(y);const v=h.get(y);v&&v.forEach(w=>{w&&!_.has(w)&&x.push(w)})}return _.has(t)},[p,l,s,t]);return{graphContext:r,graphNodes:i,graphEdges:l,graphNodeCount:u,upstreamNodeIds:d,upstreamTargetColumn:f,hasReachableSource:m}},xF=({configState:e,setConfigState:t,catalogFlags:n,upstreamTargetColumn:s,nodeId:r,modelTypeOptions:i})=>{const{isFeatureTargetSplitNode:l,isTrainTestSplitNode:u,isTrainModelDraftNode:d,isHyperparameterTuningNode:f,isClassOversamplingNode:p,isClassUndersamplingNode:m}=n,h=m||p,_=d||f,x=N.useMemo(()=>{if(!l)return null;const $=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",P=Ge(e==null?void 0:e.feature_columns).map(A=>typeof A=="string"?A.trim():"").filter(A=>!!A);return{targetColumn:$,featureColumns:P}},[e==null?void 0:e.feature_columns,e==null?void 0:e.target_column,l]),y=N.useMemo(()=>{if(!u)return null;const $=typeof(e==null?void 0:e.test_size)=="number"?e.test_size:.2,P=typeof(e==null?void 0:e.validation_size)=="number"?e.validation_size:0,A=typeof(e==null?void 0:e.random_state)=="number"?e.random_state:42,R=typeof(e==null?void 0:e.shuffle)=="boolean"?e.shuffle:!0,F=typeof(e==null?void 0:e.stratify)=="boolean"?e.stratify:!1,z=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"";return{test_size:$,validation_size:P,random_state:A,shuffle:R,stratify:F,target_column:z}},[e==null?void 0:e.random_state,e==null?void 0:e.shuffle,e==null?void 0:e.stratify,e==null?void 0:e.target_column,e==null?void 0:e.test_size,e==null?void 0:e.validation_size,u]),v=N.useMemo(()=>{if(!h)return null;const $=typeof(e==null?void 0:e.method)=="string"?e.method.trim():"",P=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",A=e==null?void 0:e.sampling_strategy;let R=null;if(typeof A=="number"&&Number.isFinite(A))R=A;else if(typeof A=="string"){const q=A.trim();R=q||null}else A===null&&(R=null);const F=e==null?void 0:e.random_state;let z=null;if(typeof F=="number"&&Number.isFinite(F))z=F;else if(typeof F=="string"){const q=Number(F);z=Number.isFinite(q)?q:null}let I=null;if(m){const q=e==null?void 0:e.replacement;I=typeof q=="boolean"?q:typeof q=="string"?q.trim().toLowerCase()==="true":!!q}let U=null;if(p){const q=e==null?void 0:e.k_neighbors;if(typeof q=="number"&&Number.isFinite(q))U=Math.max(1,Math.round(q));else if(typeof q=="string"){const H=Number(q);Number.isFinite(H)&&(U=Math.max(1,Math.round(H)))}}return{method:$,targetColumn:P,samplingStrategy:R,randomState:z,replacement:I,kNeighbors:U}},[e==null?void 0:e.k_neighbors,e==null?void 0:e.method,e==null?void 0:e.random_state,e==null?void 0:e.replacement,e==null?void 0:e.sampling_strategy,e==null?void 0:e.target_column,p,h,m]),w=typeof(e==null?void 0:e.problem_type)=="string"?e.problem_type.trim().toLowerCase():"",k=w==="regression"?"regression":"classification",j=N.useMemo(()=>Array.isArray(i)?i.filter($=>$&&typeof $.value=="string"):[],[i]),b=N.useMemo(()=>{const $={classification:[],regression:[]};return j.forEach(P=>{var R;const A=String(((R=P==null?void 0:P.metadata)==null?void 0:R.problem_type)??"").trim().toLowerCase();A==="regression"?$.regression.push(P):A==="classification"?$.classification.push(P):($.classification.push(P),$.regression.push(P))}),$},[j]),S=N.useMemo(()=>{if(!j.length)return[];const $=k==="regression"?b.regression:b.classification;return $.length>0?$:j},[j,b,k]),E=N.useMemo(()=>_?{targetColumn:typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",problemType:k}:null,[e==null?void 0:e.target_column,_,k]),M=N.useMemo(()=>{if(!_)return{enabled:!1,strategy:"auto",folds:5,shuffle:!0,randomState:42,refitStrategy:"train_plus_validation"};const $=(e==null?void 0:e.cv_enabled)===void 0?!!f:!!e.cv_enabled,P=typeof(e==null?void 0:e.cv_strategy)=="string"?e.cv_strategy.trim().toLowerCase():"auto",A=["auto","kfold","stratified_kfold"].includes(P)?P:"auto",R=Number(e==null?void 0:e.cv_folds),F=Number.isFinite(R)&&R>=2?Math.floor(R):5,z=(e==null?void 0:e.cv_shuffle)===void 0?!0:!!e.cv_shuffle;let I=null;if(typeof(e==null?void 0:e.cv_random_state)=="number"&&Number.isFinite(e.cv_random_state))I=Math.trunc(e.cv_random_state);else if(typeof(e==null?void 0:e.cv_random_state)=="string"){const H=Number(e.cv_random_state.trim());I=Number.isFinite(H)?Math.trunc(H):null}const q=(typeof(e==null?void 0:e.cv_refit_strategy)=="string"?e.cv_refit_strategy.trim().toLowerCase():"train_plus_validation")==="train_only"?"train_only":"train_plus_validation";return{enabled:$,strategy:A,folds:F,shuffle:z,randomState:I,refitStrategy:q}},[e==null?void 0:e.cv_enabled,e==null?void 0:e.cv_folds,e==null?void 0:e.cv_random_state,e==null?void 0:e.cv_refit_strategy,e==null?void 0:e.cv_shuffle,e==null?void 0:e.cv_strategy,f,_]);N.useEffect(()=>{_&&w!==k&&t($=>({...$,problem_type:k}))},[_,k,w,t]),N.useEffect(()=>{var R;if(!_||!S.length)return;const $=new Set(S.map(F=>F.value)),P=typeof(e==null?void 0:e.model_type)=="string"?e.model_type.trim():"";if(P&&$.has(P))return;const A=((R=S[0])==null?void 0:R.value)??"";A&&t(F=>{const z=typeof(F==null?void 0:F.model_type)=="string"?F.model_type.trim():"";return z&&$.has(z)||z===A?F:{...F,model_type:A}})},[e==null?void 0:e.model_type,S,_,t]);const O=N.useMemo(()=>{if(!_)return null;const $=typeof(e==null?void 0:e.model_type)=="string"?e.model_type.trim():"",P=e==null?void 0:e.hyperparameters;let A=null,R=null;if(P&&typeof P=="string"){const F=P.trim();if(F.length)try{const z=JSON.parse(F);z&&typeof z=="object"&&!Array.isArray(z)?A=z:R="Hyperparameters JSON must be an object."}catch{R="Hyperparameters JSON is invalid. Provide a valid JSON object."}}else P&&typeof P=="object"&&!Array.isArray(P)&&(A=P);return{modelType:$||null,hyperparameters:A,hyperparametersError:R}},[e==null?void 0:e.hyperparameters,e==null?void 0:e.model_type,_]);return N.useEffect(()=>{(u||d||f)&&s&&(u&&(e==null?void 0:e.stratify)!==!0||t($=>(typeof($==null?void 0:$.target_column)=="string"?$.target_column.trim():"")?$:{...$,target_column:s}))},[e==null?void 0:e.stratify,f,d,u,r,t,s]),{featureTargetSplitConfig:x,trainTestSplitConfig:y,resamplingConfig:v,trainModelDraftConfig:E,trainModelRuntimeConfig:O,trainModelCVConfig:M,filteredModelTypeOptions:S}},bF=({nodeId:e,sourceId:t,configState:n,upstreamNodeIds:s,graphNodes:r})=>{const i=N.useMemo(()=>{if(!s.length)return{};const u={};return s.forEach(d=>{var m;const f=r.find(h=>h&&typeof h.id=="string"&&h.id===d);if(!f)return;const p=((m=f==null?void 0:f.data)==null?void 0:m.config)??null;u[d]=p}),u},[r,s]),l=N.useMemo(()=>Lc({sourceId:t??null,nodeId:e||null,config:n,upstreamIds:s,upstreamConfig:i}),[n,e,t,i,s]);return{upstreamConfigFingerprints:i,previewSignature:l}},wF=({cachedPreviewSchema:e,catalogFlags:t,resamplingTargetColumn:n,imputerStrategies:s})=>{const{isClassOversamplingNode:r,isImputerNode:i}=t,l=N.useMemo(()=>(e==null?void 0:e.columns)??[],[e]),u=N.useMemo(()=>{if(!r||!l.length||!n)return null;const p=new Set(["numeric","integer","boolean"]),m=l.filter(h=>h&&h.name!==n).filter(h=>!p.has(String(h.logical_family??"unknown"))).map(h=>({name:h.name,logical_family:String(h.logical_family??"unknown")}));return m.length?{blocked:!0,message:"Class oversampling requires numeric feature columns. Encode or cast the listed fields before refreshing the preview.",columns:m.map(h=>h.name),details:m}:null},[l,r,n]),d=N.useMemo(()=>{if(!i||!l.length||!s.length)return null;const p=new Set(["numeric","integer"]),m=new Map(l.map(_=>[_.name,_])),h=[];return s.forEach((_,x)=>{if(!Lw(_.method)||!Array.isArray(_.columns)||!_.columns.length)return;const y=_.columns.map(v=>m.get(v)).filter(v=>!!v).filter(v=>!p.has(String(v.logical_family??"unknown"))).map(v=>({name:v.name,logical_family:String(v.logical_family??"unknown")}));y.length&&h.push({index:x,columns:y.map(v=>v.name),details:y})}),h.length?{blocked:!0,message:"Numeric imputation methods can only target numeric columns. Recast or adjust the highlighted fields before running the preview.",entries:h}:null},[l,s,i]),f=!!(u!=null&&u.blocked||d!=null&&d.blocked);return{cachedSchemaColumns:l,oversamplingSchemaGuard:u,imputationSchemaDiagnostics:d,skipPreview:f}},NF=(e,t,n,s,r)=>{e([]),t({}),n({}),s({}),r("")},jF=({requiresColumnCatalog:e,catalogFlags:t,nodeId:n,sourceId:s,hasReachableSource:r})=>{const{isImputerNode:i}=t,[l,u]=N.useState([]),[d,f]=N.useState(""),[p,m]=N.useState({}),[h,_]=N.useState({}),[x,y]=N.useState({}),[v,w]=N.useState(0);N.useEffect(()=>{!e&&!i||s&&r||NF(u,m,_,y,f)},[r,i,e,s]),N.useEffect(()=>{w(0)},[i,n]);const k=N.useMemo(()=>d.trim().toLowerCase(),[d]),j=N.useMemo(()=>k?l.filter(b=>b.toLowerCase().includes(k)):l,[l,k]);return{availableColumns:l,setAvailableColumns:u,columnSearch:d,setColumnSearch:f,columnMissingMap:p,setColumnMissingMap:m,columnTypeMap:h,setColumnTypeMap:_,columnSuggestions:x,setColumnSuggestions:y,imputerMissingFilter:v,setImputerMissingFilter:w,normalizedColumnSearch:k,filteredColumnOptions:j}},CF=({graphSnapshot:e,nodeId:t,catalogFlags:n,configState:s,setConfigState:r,nodeParams:i,sourceId:l,requiresColumnCatalog:u,imputerStrategies:d})=>{var S;const f=vF({graphSnapshot:e,nodeId:t,catalogFlags:n}),{graphNodes:p,upstreamNodeIds:m,upstreamTargetColumn:h,hasReachableSource:_}=f,x=xF({configState:s,setConfigState:r,catalogFlags:n,upstreamTargetColumn:h,nodeId:t,modelTypeOptions:((S=i.trainModel.modelType)==null?void 0:S.options)??null}),{resamplingConfig:y}=x,v=bF({nodeId:t,sourceId:l,configState:s,upstreamNodeIds:m,graphNodes:p}),[w,k]=N.useState(null),j=wF({cachedPreviewSchema:w,catalogFlags:n,resamplingTargetColumn:(y==null?void 0:y.targetColumn)??null,imputerStrategies:d}),b=jF({requiresColumnCatalog:u,catalogFlags:n,nodeId:t,sourceId:l,hasReachableSource:_});return{graphTopology:f,modelingConfig:x,previewSignatureResult:v,cachedPreviewSchema:w,setCachedPreviewSchema:k,schemaDiagnostics:j,columnCatalogState:b}},SF=({previewState:e,previewSampleRows:t,activeFlagSuffix:n,setColumnTypeMap:s,setColumnSuggestions:r})=>{var i;N.useEffect(()=>{var p;const l=Array.isArray((p=e.data)==null?void 0:p.column_stats)?e.data.column_stats:[],u=e.status;if(!l.length){if(u==="loading")return;s(m=>Object.keys(m).length?{}:m),r(m=>Object.keys(m).length?{}:m);return}const d={},f={};l.forEach(m=>{if(!m||!m.name)return;const h=String(m.name).trim();if(!h||n&&h.endsWith(n))return;const _=typeof m.dtype=="string"?m.dtype:null;_&&(d[h]=_);const x=t.map(v=>v&&Object.prototype.hasOwnProperty.call(v,h)?v[h]:void 0),y=A3(_,x);y.length&&(f[h]=y)}),s(m=>{const h=Object.entries(m),_=Object.entries(d);return h.length===_.length&&h.every(([x,y])=>Object.prototype.hasOwnProperty.call(d,x)&&d[x]===y)?m:d}),r(m=>{const h=Object.keys(m),_=Object.keys(f);return h.length===_.length&&h.every(x=>{if(!Object.prototype.hasOwnProperty.call(f,x))return!1;const y=m[x]??[],v=f[x]??[];return rj(y,v)})?m:f})},[n,t,(i=e.data)==null?void 0:i.column_stats,e.status,r,s])},EF=({previewState:e,activeFlagSuffix:t,hasReachableSource:n,requiresColumnCatalog:s,nodeColumns:r,selectedColumns:i,setAvailableColumns:l,setColumnMissingMap:u})=>{var d,f;N.useEffect(()=>{var y,v;if(!s||!n)return;const p=new Set;(Array.isArray((y=e.data)==null?void 0:y.columns)?e.data.columns:[]).forEach(w=>{const k=typeof w=="string"?w.trim():"";k&&(t&&k.endsWith(t)||p.add(k))});const h=Array.isArray((v=e.data)==null?void 0:v.column_stats)?e.data.column_stats:[],_={};if(h.forEach(w=>{if(!w||!w.name)return;const k=String(w.name).trim();if(!k||t&&k.endsWith(t))return;p.add(k);const j=Number(w.missing_percentage);!Number.isNaN(j)&&j>=0&&(_[k]=j)}),Ge(r).forEach(w=>{w&&!(t&&w.endsWith(t))&&p.add(w)}),i.forEach(w=>{w&&!(t&&w.endsWith(t))&&p.add(w)}),p.size===0)return;const x=Array.from(p).sort((w,k)=>w.localeCompare(k));l(w=>rj(w,x)?w:x),Object.keys(_).length>0&&u(w=>({...w,..._}))},[t,n,r,(d=e.data)==null?void 0:d.column_stats,(f=e.data)==null?void 0:f.columns,s,i,l,u])},kF=({previewState:e,previewSampleRows:t,activeFlagSuffix:n,setColumnTypeMap:s,setColumnSuggestions:r,hasReachableSource:i,requiresColumnCatalog:l,nodeColumns:u,selectedColumns:d,setAvailableColumns:f,setColumnMissingMap:p})=>{SF({previewState:e,previewSampleRows:t,activeFlagSuffix:n,setColumnTypeMap:s,setColumnSuggestions:r}),EF({previewState:e,activeFlagSuffix:n,hasReachableSource:i,requiresColumnCatalog:l,nodeColumns:u,selectedColumns:d,setAvailableColumns:f,setColumnMissingMap:p})},Ks=["standard","robust","minmax","maxabs"],Bo={standard:"Standard scaler",robust:"Robust scaler",minmax:"MinMax scaler",maxabs:"MaxAbs scaler"},Cj={high:"High confidence",medium:"Moderate confidence",low:"Exploratory"},Sj=e=>Array.isArray(e)?Array.from(new Set(e.map(t=>String(t??"").trim()).filter(Boolean))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?Array.from(new Set(e.split(",").map(t=>t.trim()).filter(Boolean))).sort((t,n)=>t.localeCompare(n)):[],Ej=e=>{const t=e&&typeof e=="object"&&!Array.isArray(e)?e:{},n=Sj(t.columns),s=typeof t.default_method=="string"?t.default_method.trim().toLowerCase():"",r=Ks.includes(s)?s:"standard",i={},l=t.column_methods;l&&typeof l=="object"&&!Array.isArray(l)&&Object.entries(l).forEach(([f,p])=>{const m=String(f??"").trim(),h=typeof p=="string"?p.trim().toLowerCase():"";m&&Ks.includes(h)&&(i[m]=h)});const u=typeof t.auto_detect=="boolean"?t.auto_detect:!0,d=Sj(t.skipped_columns);return{columns:n,defaultMethod:r,columnMethods:i,autoDetect:u,skippedColumns:d}},MF=e=>{const t={...Bo};return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null,r=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";s&&Ks.includes(s)&&r&&(t[s]=r)}),t},AF=e=>{const t=new Map;return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null;s&&Ks.includes(s)&&t.set(s,n)}),t},OF=e=>Ks.map(t=>({value:t,label:e[t]??Bo[t]??t})),$F=({recommendations:e,scalingConfig:t,scalingMethodLabelMap:n,scalingSelectedSet:s,scalingSkippedColumns:r,scalingExcludedColumns:i})=>{if(!e.length)return[];const l=[];return e.forEach(u=>{const d=String((u==null?void 0:u.column)??"").trim();if(!d)return;const f=u.recommended_method,p=n[f]??Bo[f]??f,m=Array.isArray(u.fallback_methods)?u.fallback_methods.filter(E=>Ks.includes(E)).map(E=>{const M=E;return n[M]??Bo[M]??M}):[],h=u.confidence??"medium",_=Cj[h]??Cj.medium,y=t.columnMethods[d]??null,v=y??t.defaultMethod,w=n[v]??Bo[v]??v,k=i.has(d),j=r.has(d),b=s.has(d),S=u.stats;l.push({column:d,dtype:u.dtype??null,recommendedMethod:f,recommendedLabel:p,confidence:h,confidenceLabel:_,reasons:Array.isArray(u.reasons)?u.reasons:[],fallbackLabels:m,stats:S,hasMissing:!!u.has_missing,currentOverride:y,currentMethod:v,currentMethodLabel:w,isOverrideApplied:y!==null,isSelected:b,isExcluded:k,isSkipped:j})}),l.sort((u,d)=>u.column.localeCompare(d.column)),l},TF=(e,t,n,s)=>{if(!e.length)return null;const r=e.map(i=>{const l=t[i],u=l?n[l]??Bo[l]??l:null;return u?`${i} -> ${u}`:i});return s>e.length&&r.push(""),r.join(", ")},tm=e=>String(e??"").trim(),PF=({catalogFlags:e,setConfigState:t,binningExcludedColumns:n,scalingExcludedColumns:s,availableColumns:r,recommendations:i})=>{const{isBinningNode:l,isScalingNode:u}=e,d=N.useCallback((y,v,w)=>{const k=tm(y);k&&t(j=>{const b=j.manual_bounds&&typeof j.manual_bounds=="object"&&!Array.isArray(j.manual_bounds)?{...j.manual_bounds}:{},S=b[k]&&typeof b[k]=="object"?{...b[k]}:{lower:null,upper:null};if(w==="")v==="lower"?S.lower=null:S.upper=null;else{const O=Number(w);if(!Number.isFinite(O))return j;v==="lower"?S.lower=O:S.upper=O}const E=S.lower??null,M=S.upper??null;return E===null&&M===null?delete b[k]:b[k]={lower:E,upper:M},{...j,manual_bounds:b}})},[t]),f=N.useCallback(y=>{const v=tm(y);v&&t(w=>{const k=w.manual_bounds&&typeof w.manual_bounds=="object"&&!Array.isArray(w.manual_bounds)?w.manual_bounds:null;if(!k||!Object.prototype.hasOwnProperty.call(k,v))return w;const j={...k};return delete j[v],{...w,manual_bounds:j}})},[t]),p=N.useCallback(y=>{const v=tm(y);v&&t(w=>{const k=Ge(w.columns),j=k.includes(v),b=j?k.filter(O=>O!==v):[...k,v];let S=!1,E=w.manual_bounds;j&&E&&typeof E=="object"&&!Array.isArray(E)&&Object.prototype.hasOwnProperty.call(E,v)&&(E={...E},delete E[v],S=!0);const M={...w,columns:b};if(S&&(M.manual_bounds=E),l){const O=new Set(b);if(w.custom_bins&&typeof w.custom_bins=="object"&&!Array.isArray(w.custom_bins)){const $={};Object.entries(w.custom_bins).forEach(([P,A])=>{O.has(P)&&Array.isArray(A)&&A.length&&($[P]=[...A])}),Object.keys($).length?M.custom_bins=$:"custom_bins"in M&&delete M.custom_bins}else"custom_bins"in M&&delete M.custom_bins;if(w.custom_labels&&typeof w.custom_labels=="object"&&!Array.isArray(w.custom_labels)){const $={};Object.entries(w.custom_labels).forEach(([P,A])=>{O.has(P)&&Array.isArray(A)&&A.length&&($[P]=A.map(R=>String(R)))}),Object.keys($).length?M.custom_labels=$:"custom_labels"in M&&delete M.custom_labels}else"custom_labels"in M&&delete M.custom_labels;if(w.column_overrides&&typeof w.column_overrides=="object"&&!Array.isArray(w.column_overrides)){const $={};Object.entries(w.column_overrides).forEach(([P,A])=>{O.has(P)&&A&&typeof A=="object"&&!Array.isArray(A)&&($[P]={...A})}),Object.keys($).length?(M.column_overrides=$,M.column_strategies=$):("column_overrides"in M&&delete M.column_overrides,"column_strategies"in M&&delete M.column_strategies)}else"column_overrides"in M&&delete M.column_overrides,"column_strategies"in M&&delete M.column_strategies}if(u){let O=null;w.column_methods&&typeof w.column_methods=="object"&&!Array.isArray(w.column_methods)&&(O={},Object.entries(w.column_methods).forEach(([$,P])=>{const A=typeof P=="string"?P.trim():null;!A||!Ks.includes(A)||j&&$===v||(O[$]=A)})),O&&Object.keys(O).length?M.column_methods=O:j&&Object.prototype.hasOwnProperty.call(M,"column_methods")&&delete M.column_methods}return M})},[l,u,t]),m=N.useCallback(()=>{i.length&&t(y=>{const v=new Set(Ge(y.columns));return i.forEach(w=>{w!=null&&w.name&&v.add(String(w.name))}),{...y,columns:Array.from(v)}})},[i,t]),h=N.useCallback(()=>{r.length&&t(y=>{const v=new Set(Ge(y.columns));return r.filter(k=>l?!n.has(k):u?!s.has(k):!0).forEach(k=>v.add(k)),{...y,columns:Array.from(v).sort((k,j)=>k.localeCompare(j))}})},[r,n,l,u,s,t]),_=N.useCallback(()=>{t(y=>{const v={...y,columns:[]};return y!=null&&y.manual_bounds&&typeof y.manual_bounds=="object"&&!Array.isArray(y.manual_bounds)&&Object.keys(y.manual_bounds).length&&(v.manual_bounds={}),l&&("custom_bins"in v&&delete v.custom_bins,"custom_labels"in v&&delete v.custom_labels,"column_overrides"in v&&delete v.column_overrides,"column_strategies"in v&&delete v.column_strategies),u&&"column_methods"in v&&delete v.column_methods,v})},[l,u,t]),x=N.useCallback(y=>{const v=tm(y);v&&t(w=>{const k=Ge(w.columns);if(!k.includes(v))return w;const j=k.filter(M=>M!==v);let b=!1,S=w.manual_bounds;S&&typeof S=="object"&&!Array.isArray(S)&&Object.prototype.hasOwnProperty.call(S,v)&&(S={...S},delete S[v],b=!0);const E={...w,columns:j};if(b&&(E.manual_bounds=S),l){if(w.custom_bins&&typeof w.custom_bins=="object"&&!Array.isArray(w.custom_bins)){const M={};Object.entries(w.custom_bins).forEach(([O,$])=>{O!==v&&Array.isArray($)&&$.length&&(M[O]=[...$])}),Object.keys(M).length?E.custom_bins=M:"custom_bins"in E&&delete E.custom_bins}else"custom_bins"in E&&delete E.custom_bins;if(w.custom_labels&&typeof w.custom_labels=="object"&&!Array.isArray(w.custom_labels)){const M={};Object.entries(w.custom_labels).forEach(([O,$])=>{O!==v&&Array.isArray($)&&$.length&&(M[O]=$.map(P=>String(P)))}),Object.keys(M).length?E.custom_labels=M:"custom_labels"in E&&delete E.custom_labels}else"custom_labels"in E&&delete E.custom_labels;if(w.column_overrides&&typeof w.column_overrides=="object"&&!Array.isArray(w.column_overrides)){const M={};Object.entries(w.column_overrides).forEach(([O,$])=>{O!==v&&$&&typeof $=="object"&&!Array.isArray($)&&(M[O]={...$})}),Object.keys(M).length?(E.column_overrides=M,E.column_strategies=M):("column_overrides"in E&&delete E.column_overrides,"column_strategies"in E&&delete E.column_strategies)}else"column_overrides"in E&&delete E.column_overrides,"column_strategies"in E&&delete E.column_strategies}if(u)if(w.column_methods&&typeof w.column_methods=="object"&&!Array.isArray(w.column_methods)){const M={};Object.entries(w.column_methods).forEach(([O,$])=>{const P=typeof $=="string"?$.trim():null;!P||!Ks.includes(P)||O!==v&&(M[O]=P)}),Object.keys(M).length?E.column_methods=M:Object.prototype.hasOwnProperty.call(E,"column_methods")&&delete E.column_methods}else Object.prototype.hasOwnProperty.call(E,"column_methods")&&delete E.column_methods;return E})},[l,u,t]);return{handleManualBoundChange:d,handleClearManualBound:f,handleToggleColumn:p,handleApplyAllRecommended:m,handleSelectAllColumns:h,handleClearColumns:_,handleRemoveColumn:x}},kj=28,Mj=320,LF=170,Aj="Removes columns whose missing percentage exceeds a configurable threshold and applies EDA-backed column drop recommendations.",Oj="Drop columns",$j=new Set(["transformer_audit"]),qa="__pending_confirmation__",zF=[/^columns?$/i,/_columns$/i,/_features$/i,/_list$/i,/_ids$/i,/^selected_/i,/^target_/i,/^include_/i,/^exclude_/i,/^skipped_/i,/_rules$/i,/_transformations$/i,/^strategies$/i,/^recommendations$/i],RF=[/methods$/i,/overrides$/i,/mapping$/i,/weights$/i,/assignments$/i],nm=e=>e&&typeof e=="object"&&!Array.isArray(e),Ic=e=>{if(e==null)return{};try{return JSON.parse(JSON.stringify(e))}catch{return{...e}}},sm=e=>typeof e=="string"&&$j.has(e),rm=e=>{const t=e==null?void 0:e.default_config,n=(e==null?void 0:e.type)??"",s=!$j.has(n),r=l=>(s?l[qa]=!0:delete l[qa],l);if(t==null)return r({});const i=Ic(t);if(!nm(i))return r(i&&typeof i=="object"?i:{});switch(Object.entries(i).forEach(([l,u])=>{Array.isArray(u)?zF.some(f=>f.test(l))&&(i[l]=[]):nm(u)&&RF.some(f=>f.test(l))&&(i[l]={})}),"auto_detect"in i&&(i.auto_detect=!1),e==null?void 0:e.type){case"scale_numeric_features":i.columns=Array.isArray(i.columns)?i.columns:[],i.column_methods=nm(i.column_methods)?i.column_methods:{},i.skipped_columns=Array.isArray(i.skipped_columns)?i.skipped_columns:[],i.default_method=typeof i.default_method=="string"&&i.default_method.trim()?i.default_method:"standard";break;case"polynomial_features":i.columns=Array.isArray(i.columns)?i.columns:[],i.auto_detect=!!i.auto_detect,i.include_bias=!!i.include_bias,i.interaction_only=!!i.interaction_only,i.include_input_features=!!i.include_input_features,i.degree=typeof i.degree=="number"&&Number.isFinite(i.degree)?i.degree:2,i.output_prefix=typeof i.output_prefix=="string"&&i.output_prefix.trim()?i.output_prefix:"poly";break;case"drop_missing_columns":"missing_threshold"in i&&(i.missing_threshold=null),i.columns=Array.isArray(i.columns)?i.columns:[];break;case"drop_missing_rows":"missing_threshold"in i&&(i.missing_threshold=null),"drop_if_any_missing"in i&&(i.drop_if_any_missing=!1);break;case"outlier_removal":i.method="manual",i.columns=Array.isArray(i.columns)?i.columns:[],i.manual_bounds=nm(i.manual_bounds)?i.manual_bounds:{};break;case"missing_value_indicator":i.columns=Array.isArray(i.columns)?i.columns:[];break;case"remove_duplicates":if(i.columns=Array.isArray(i.columns)?i.columns:[],typeof i.keep=="string"){const l=i.keep.trim().toLowerCase();i.keep=l==="last"||l==="none"?l:"first"}else i.keep="first";break}return r(i)},DF=(e,t)=>t==="drop_missing_columns"||e===Aj?Oj:e,IF=e=>Array.isArray(e)?e.map(t=>({...t})):[],FF=({configState:e,catalogFlags:t,nodeId:n,onUpdateConfig:s,onClose:r,sourceId:i,graphSnapshot:l,onUpdateNodeData:u,setConfigState:d,canResetNode:f,defaultConfigTemplate:p,onResetConfig:m})=>{const{isBinningNode:h,isScalingNode:_,isInspectionNode:x}=t,y=N.useRef(null),v=N.useCallback(S=>{if(!S)return"idle";const E=(S.job_status??S.status??"").toLowerCase();return E?E==="succeeded"?"success":E==="failed"||E==="skipped"||E==="cancelled"?"error":E==="running"||E==="queued"||E==="deferred"?"loading":"idle":"idle"},[]),w=N.useCallback(S=>{var R;if((R=y.current)==null||R.call(y),!S)return;const E=i;if(!E||!n)return;const M=E;if(v(S)!=="loading")return;const $=S.job_id;if(!$)return;let P=!1;const A=async F=>{const z=typeof F=="number"&&F>0?F*1e3:5e3;if(await new Promise(I=>setTimeout(I,z)),!P)try{const I=await yw(M,$),U=v(I);u==null||u(n,{backgroundExecutionStatus:U}),U==="loading"&&A((I==null?void 0:I.poll_after_seconds)??null)}catch(I){console.warn("Failed to poll full dataset execution status:",I),u==null||u(n,{backgroundExecutionStatus:"error"})}};A(S.poll_after_seconds??null),y.current=()=>{P=!0}},[v,n,u,i]),k=N.useCallback((S,E,M)=>{if(!S)return null;const O=Yd(M);return O&&typeof O=="object"&&delete O[qa],{nodes:Array.isArray(S.nodes)?S.nodes.map(P=>{if(!P||P.id!==E)return P;const A={...P.data??{},config:O,isConfigured:!0};return{...P,data:A}}):S.nodes,edges:Array.isArray(S.edges)?[...S.edges]:S.edges}},[]),j=N.useCallback(S=>{if(!n)return;let E=Yd(e);if(h){const O=Tw(E);E={...E,strategy:O.strategy,columns:O.columns,equal_width_bins:O.equalWidthBins,equal_frequency_bins:O.equalFrequencyBins,include_lowest:O.includeLowest,precision:O.precision,duplicates:O.duplicates,output_suffix:O.outputSuffix,drop_original:O.dropOriginal,label_format:O.labelFormat,missing_strategy:O.missingStrategy},O.missingStrategy==="label"?E.missing_label=O.missingLabel:Object.prototype.hasOwnProperty.call(E,"missing_label")&&delete E.missing_label,Object.keys(O.customBins).length?E.custom_bins=O.customBins:Object.prototype.hasOwnProperty.call(E,"custom_bins")&&delete E.custom_bins,Object.keys(O.customLabels).length?E.custom_labels=O.customLabels:Object.prototype.hasOwnProperty.call(E,"custom_labels")&&delete E.custom_labels}if(_){const O=Ej(E);E={...E,columns:O.columns,default_method:O.defaultMethod,auto_detect:O.autoDetect,skipped_columns:O.skippedColumns},Object.keys(O.columnMethods).length>0?E.column_methods=O.columnMethods:Object.prototype.hasOwnProperty.call(E,"column_methods")&&delete E.column_methods}s(n,E),(S==null?void 0:S.closeModal)!==!1&&r();const M=k(l,n,E);i&&M&&!x&&(u==null||u(n,{backgroundExecutionStatus:"loading"}),_w({dataset_source_id:i,graph:{nodes:M.nodes||[],edges:M.edges||[]},target_node_id:n}).then(O=>{var A;const $=(A=O==null?void 0:O.signals)==null?void 0:A.full_execution,P=v($);u==null||u(n,{backgroundExecutionStatus:P}),w($)}).catch(O=>{u==null||u(n,{backgroundExecutionStatus:"error"}),console.warn("Background full dataset execution failed:",O)}))},[e,l,h,x,_,n,r,s,u,i,k]),b=N.useCallback(()=>{if(!f||!n)return;const S=Yd(p??{});d(S),m==null||m(n,S)},[f,p,n,m,d]);return{handleSave:j,handleResetNode:b}},BF=({setConfigState:e,imputationMethodValues:t,imputationMethodOptions:n,imputerStrategyCount:s,setCollapsedStrategies:r,setImputerMissingFilter:i})=>{const l=N.useCallback(y=>{e(v=>{const w=Rw(v==null?void 0:v.strategies,t),k=y(w).map(j=>({...j,options:Cc(j.method,j.options)}));return{...v,strategies:gz(k)}})},[t,e]),u=N.useCallback(()=>{var w;const y=s,v=((w=n[0])==null?void 0:w.value)??"mean";l(k=>[...k,{method:v,columns:[],options:Cc(v,zw(v))}]),r(k=>{const j=new Set(k);return j.delete(y),j})},[n,s,l,r]),d=N.useCallback(y=>{l(v=>v.filter((w,k)=>k!==y)),r(v=>{const w=new Set;return v.forEach(k=>{k!==y&&w.add(k>y?k-1:k)}),w})},[l,r]),f=N.useCallback(y=>{r(v=>{const w=new Set(v);return w.has(y)?w.delete(y):w.add(y),w})},[r]),p=N.useCallback((y,v)=>{l(w=>w.map((k,j)=>j===y?{...k,method:v,options:Cc(v,k.options)}:k))},[l]),m=N.useCallback((y,v,w)=>{l(k=>k.map((j,b)=>{if(b!==y)return j;const S={...j.options??{}};if(w==="")delete S[v];else{const E=Number(w);if(!Number.isFinite(E))return j;S[v]=E}return{...j,options:Cc(j.method,S)}}))},[l]),h=N.useCallback((y,v)=>{const w=v.split(",").map(k=>k.trim()).filter(Boolean);l(k=>k.map((j,b)=>b===y?{...j,columns:w}:j))},[l]),_=N.useCallback((y,v)=>{const w=v.trim();w&&l(k=>k.map((j,b)=>{if(b!==y)return j;const E=j.columns.includes(w)?j.columns.filter(M=>M!==w):[...j.columns,w];return E.sort((M,O)=>M.localeCompare(O)),{...j,columns:E}}))},[l]),x=N.useCallback(y=>{i(y)},[i]);return{updateImputerStrategies:l,handleAddImputerStrategy:u,handleRemoveImputerStrategy:d,toggleImputerStrategySection:f,handleImputerMethodChange:p,handleImputerOptionNumberChange:m,handleImputerColumnsChange:h,handleImputerColumnToggle:_,handleImputerMissingFilterChange:x}},UF=({catalogFlags:e,node:t,setConfigState:n,setCollapsedStrategies:s,aliasColumnSummary:r,aliasStrategyCount:i})=>{var y;const{isReplaceAliasesNode:l}=e,u=N.useCallback(v=>{l&&n(w=>{var R,F,z,I,U,q,H,W,B;if(!l)return w;const k=Ge((w==null?void 0:w.columns)??((F=(R=t==null?void 0:t.data)==null?void 0:R.config)==null?void 0:F.columns)),j=Id(w==null?void 0:w.mode,(I=(z=t==null?void 0:t.data)==null?void 0:z.config)==null?void 0:I.mode),b=(()=>{var te;const D=ol(w);if(D!==void 0){const G=Ro(D);if(G!==null)return G}const V=ol((te=t==null?void 0:t.data)==null?void 0:te.config);if(V!==void 0){const G=Ro(V);if(G!==null)return G}return k.length===0})(),S=(w==null?void 0:w.alias_strategies)??(w==null?void 0:w.strategies)??((q=(U=t==null?void 0:t.data)==null?void 0:U.config)==null?void 0:q.alias_strategies)??((W=(H=t==null?void 0:t.data)==null?void 0:H.config)==null?void 0:W.strategies),E=qw(S,{mode:j,columns:k,autoDetect:b}),M=v(E).map(D=>({mode:Id(D.mode,j),columns:Array.from(new Set(D.columns.map(V=>V.trim()).filter(Boolean))).sort((V,te)=>V.localeCompare(te)),autoDetect:!!D.autoDetect})),O=Dz(M),$=Array.from(new Set(M.flatMap(D=>D.columns))).sort((D,V)=>D.localeCompare(V)),P=((B=M[0])==null?void 0:B.mode)??j,A=M.length?M.some(D=>D.autoDetect):b;return{...w,alias_strategies:O,columns:$,mode:P,auto_detect:A}})},[l,(y=t==null?void 0:t.data)==null?void 0:y.config,n]),d=N.useCallback(()=>{if(!l)return;const v=i;u(w=>{var E;const k=new Set;w.forEach(M=>{M.columns.forEach(O=>{const $=O.trim();$&&k.add($)})});const j=r.recommendedColumns.find(M=>!k.has(M)),S={mode:w.length?w[w.length-1].mode:((E=Uw[0])==null?void 0:E.value)??yp,columns:j?[j]:[],autoDetect:!j};return[...w,S]}),s(w=>{const k=new Set(w);return k.delete(v),k})},[r.recommendedColumns,i,l,s,u]),f=N.useCallback(v=>{u(w=>w.filter((k,j)=>j!==v)),s(w=>{const k=new Set;return w.forEach(j=>{j!==v&&k.add(j>v?j-1:j)}),k})},[s,u]),p=N.useCallback(v=>{s(w=>{const k=new Set(w);return k.has(v)?k.delete(v):k.add(v),k})},[s]),m=N.useCallback((v,w)=>{u(k=>k.map((j,b)=>b===v?{...j,mode:w}:j))},[u]),h=N.useCallback((v,w)=>{const k=w.trim();k&&u(j=>j.map((b,S)=>{if(S!==v)return b;const M=b.columns.includes(k)?b.columns.filter(O=>O!==k):[...b.columns,k];return M.sort((O,$)=>O.localeCompare($)),{...b,columns:M}}))},[u]),_=N.useCallback((v,w)=>{const k=w.split(",").map(b=>b.trim()).filter(Boolean),j=Array.from(new Set(k)).sort((b,S)=>b.localeCompare(S));u(b=>b.map((S,E)=>E===v?{...S,columns:j}:S))},[u]),x=N.useCallback((v,w)=>{u(k=>k.map((j,b)=>b===v?{...j,autoDetect:w}:j))},[u]);return{updateAliasStrategies:u,handleAddAliasStrategy:d,handleRemoveAliasStrategy:f,toggleAliasStrategySection:p,handleAliasModeChange:m,handleAliasColumnToggle:h,handleAliasColumnsChange:_,handleAliasAutoDetectToggle:x}},HF=({catalogFlags:e,node:t,setConfigState:n,setCollapsedStrategies:s,dateStrategies:r,standardizeDatesColumnSummary:i,standardizeDatesMode:l})=>{var v,w,k,j,b,S;const{isStandardizeDatesNode:u}=e,d=N.useCallback(E=>{n(M=>{var U,q,H,W,B,D,V;if(!u)return M;const O=Ge((M==null?void 0:M.columns)??((q=(U=t==null?void 0:t.data)==null?void 0:U.config)==null?void 0:q.columns)),$=tN(M==null?void 0:M.mode,(W=(H=t==null?void 0:t.data)==null?void 0:H.config)==null?void 0:W.mode),P=O.length===0,A=nN((M==null?void 0:M.format_strategies)??((D=(B=t==null?void 0:t.data)==null?void 0:B.config)==null?void 0:D.format_strategies),{columns:O,mode:$,autoDetect:P}),R=E(A),F=dR(R),z=Array.from(new Set(R.flatMap(te=>te.columns.map(G=>G.trim()).filter(Boolean)))).sort((te,G)=>te.localeCompare(G)),I=((V=R[0])==null?void 0:V.mode)??$;return{...M,format_strategies:F,columns:z,mode:I}})},[u,(w=(v=t==null?void 0:t.data)==null?void 0:v.config)==null?void 0:w.columns,(j=(k=t==null?void 0:t.data)==null?void 0:k.config)==null?void 0:j.format_strategies,(S=(b=t==null?void 0:t.data)==null?void 0:b.config)==null?void 0:S.mode,n]),f=N.useCallback(()=>{const E=r.length;d(M=>{var R;const O=new Set;M.forEach(F=>{F.columns.forEach(z=>{const I=z.trim();I&&O.add(I)})});const $=i.recommendedColumns.find(F=>!O.has(F)),A={mode:M.length?M[M.length-1].mode:((R=wp[0])==null?void 0:R.value)??l,columns:$?[$]:[],autoDetect:!$};return[...M,A]}),s(M=>{const O=new Set(M);return O.delete(E),O})},[r.length,s,i.recommendedColumns,l,d]),p=N.useCallback(E=>{d(M=>M.filter((O,$)=>$!==E)),s(M=>{const O=new Set;return M.forEach($=>{$!==E&&O.add($>E?$-1:$)}),O})},[s,d]),m=N.useCallback(E=>{s(M=>{const O=new Set(M);return O.has(E)?O.delete(E):O.add(E),O})},[s]),h=N.useCallback((E,M)=>{d(O=>O.map(($,P)=>P===E?{...$,mode:M}:$))},[d]),_=N.useCallback((E,M)=>{const O=M.split(",").map($=>$.trim()).filter(Boolean).sort(($,P)=>$.localeCompare(P));d($=>$.map((P,A)=>A===E?{...P,columns:O}:P))},[d]),x=N.useCallback((E,M)=>{const O=M.trim();O&&d($=>$.map((P,A)=>{if(A!==E)return P;const F=P.columns.includes(O)?P.columns.filter(z=>z!==O):[...P.columns,O];return F.sort((z,I)=>z.localeCompare(I)),{...P,columns:F}}))},[d]),y=N.useCallback((E,M)=>{d(O=>O.map(($,P)=>P===E?{...$,autoDetect:M}:$))},[d]);return{updateDateStrategies:d,handleAddDateStrategy:f,handleRemoveDateStrategy:p,toggleDateStrategySection:m,handleDateStrategyModeChange:h,handleDateStrategyColumnsChange:_,handleDateStrategyColumnToggle:x,handleDateStrategyAutoDetectToggle:y}},qF=new Set(Vd.map(e=>e.value)),Fc=e=>!e||!e.length?[]:Array.from(new Set(e.map(t=>t.trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)),Tj=e=>!e||!e.length?[]:e.filter(t=>Number.isFinite(t)),Pj=e=>{const n=Fc(e).filter(s=>qF.has(s));return n.length?n:["year","month","day"]},Bc=e=>e==null?null:Number.isFinite(e)?e:null,Lj=e=>{const t=Bc(e);if(t===null)return null;const n=Math.round(t);return Number.isFinite(n)?n:null},zj=e=>typeof e!="string"?"UTC":e.trim()||"UTC",VF=({catalogFlags:e,setConfigState:t,setCollapsedFeatureMath:n})=>{const{isFeatureMathNode:s}=e,r=N.useCallback(m=>{t(h=>{if(!s)return h;const _=h&&typeof h=="object"&&!Array.isArray(h)?{...h}:{},x=RN(Array.isArray(h==null?void 0:h.operations)?h.operations:[]),y=m(x);return _.operations=mI(y),_})},[s,t]),i=N.useCallback(m=>{if(!s)return;let h="";r(_=>{const x=new Set(_.map(v=>v.id)),y=DN(m,x);return h=y.id,[..._,y]}),h&&n(_=>{const x=new Set(_);return x.delete(h),x})},[s,n,r]),l=N.useCallback(m=>{if(!s)return;let h="";r(_=>{const x=_.findIndex(b=>b.id===m);if(x===-1)return _;const y=_[x],v=new Set(_.map(b=>b.id)),w=DN(y.type,v);h=w.id;const k={...y,id:w.id,inputColumns:[...y.inputColumns],secondaryColumns:[...y.secondaryColumns],constants:[...y.constants],datetimeFeatures:[...y.datetimeFeatures],outputColumn:y.outputColumn?`${y.outputColumn}_copy`:""},j=[..._];return j.splice(x+1,0,k),j}),h&&n(_=>{const x=new Set(_);return x.delete(h),x})},[s,n,r]),u=N.useCallback(m=>{s&&(r(h=>h.filter(_=>_.id!==m)),n(h=>{const _=new Set(h);return _.delete(m),_}))},[s,n,r]),d=N.useCallback((m,h)=>{s&&r(_=>{const x=_.findIndex(k=>k.id===m);if(x===-1)return _;const y=h==="up"?x-1:x+1;if(y<0||y>=_.length)return _;const v=[..._],[w]=v.splice(x,1);return v.splice(y,0,w),v})},[s,r]),f=N.useCallback(m=>{n(h=>{const _=new Set(h);return _.has(m)?_.delete(m):_.add(m),_})},[n]),p=N.useCallback((m,h)=>{s&&r(_=>_.map(x=>{if(x.id!==m)return x;let y={...x};if(h.type&&(y.type=h.type),h.method!==void 0&&(y.method=h.method),h.inputColumns!==void 0&&(y.inputColumns=Fc(h.inputColumns)),h.secondaryColumns!==void 0&&(y.secondaryColumns=Fc(h.secondaryColumns)),h.constants!==void 0&&(y.constants=Tj(h.constants)),h.outputColumn!==void 0&&(y.outputColumn=h.outputColumn.trim()),h.outputPrefix!==void 0&&(y.outputPrefix=h.outputPrefix.trim()),h.datetimeFeatures!==void 0&&(y.datetimeFeatures=Pj(h.datetimeFeatures)),h.timezone!==void 0&&(y.timezone=zj(h.timezone)),h.fillna!==void 0&&(y.fillna=Bc(h.fillna)),h.roundDigits!==void 0&&(y.roundDigits=Lj(h.roundDigits)),h.normalize!==void 0&&(y.normalize=h.normalize),h.epsilon!==void 0&&(y.epsilon=Bc(h.epsilon)),h.allowOverwrite!==void 0&&(y.allowOverwrite=h.allowOverwrite),h.description!==void 0){const k=typeof h.description=="string"?h.description.trim():"";y.description=k||void 0}const v=y.type,w=IN(v);return w.length?new Set(w.map(j=>j.value)).has(y.method)||(y.method=w[0].value):v==="ratio"?y.method="ratio":v==="datetime_extract"&&(y.method="datetime_extract"),y.inputColumns=Fc(y.inputColumns),v==="ratio"||v==="similarity"?y.secondaryColumns=Fc(y.secondaryColumns):y.secondaryColumns=[],y.constants=Tj(y.constants),y.fillna=Bc(y.fillna),y.roundDigits=Lj(y.roundDigits),y.epsilon=Bc(y.epsilon),v==="datetime_extract"?(y.datetimeFeatures=Pj(y.datetimeFeatures),y.timezone=zj(y.timezone)):(y.datetimeFeatures=[],y.timezone="UTC"),v!=="similarity"?y.normalize=!1:y.normalize=!!y.normalize,typeof y.allowOverwrite!="boolean"&&(y.allowOverwrite=null),y.outputColumn=y.outputColumn.trim(),y.outputPrefix=y.outputPrefix.trim(),y}))},[s,r]);return{updateFeatureMathOperations:r,handleAddFeatureMathOperation:i,handleDuplicateFeatureMathOperation:l,handleRemoveFeatureMathOperation:u,handleReorderFeatureMathOperation:d,handleToggleFeatureMathOperation:f,handleFeatureMathOperationChange:p}},WF=({catalogFlags:e,setConfigState:t,binningExcludedColumns:n,scalingExcludedColumns:s,availableColumns:r,recommendations:i,nodeId:l,onUpdateConfig:u,onClose:d,sourceId:f,graphSnapshot:p,onUpdateNodeData:m,canResetNode:h,defaultConfigTemplate:_,onResetConfig:x,imputationMethodValues:y,imputationMethodOptions:v,imputerStrategyCount:w,setCollapsedStrategies:k,setImputerMissingFilter:j,node:b,aliasColumnSummary:S,aliasStrategyCount:E,dateStrategies:M,standardizeDatesColumnSummary:O,standardizeDatesMode:$,setCollapsedFeatureMath:P,configState:A})=>{const R=PF({catalogFlags:e,setConfigState:t,binningExcludedColumns:n,scalingExcludedColumns:s,availableColumns:r,recommendations:i}),F=FF({configState:A,catalogFlags:e,nodeId:l,onUpdateConfig:u,onClose:d,sourceId:f,graphSnapshot:p,onUpdateNodeData:m,setConfigState:t,canResetNode:h,defaultConfigTemplate:_,onResetConfig:x}),z=BF({setConfigState:t,imputationMethodValues:y,imputationMethodOptions:v,imputerStrategyCount:w,setCollapsedStrategies:k,setImputerMissingFilter:j}),I=UF({catalogFlags:e,node:b,setConfigState:t,setCollapsedStrategies:k,aliasColumnSummary:S,aliasStrategyCount:E}),U=HF({catalogFlags:e,node:b,setConfigState:t,setCollapsedStrategies:k,dateStrategies:M,standardizeDatesColumnSummary:O,standardizeDatesMode:$}),q=VF({catalogFlags:e,setConfigState:t,setCollapsedFeatureMath:P});return{columnSelectionHandlers:R,nodeSaveHandlers:F,imputationStrategyHandlers:z,aliasStrategyHandlers:I,dateStrategyHandlers:U,featureMathHandlers:q}},YF=({hasDropColumnSource:e,sourceId:t,nodeId:n,graphContext:s,hasReachableSource:r,columnTypeMap:i,setAvailableColumns:l,setColumnSearch:u,setColumnMissingMap:d,setColumnTypeMap:f,setColumnSuggestions:p})=>{const[m,h]=N.useState([]),[_,x]=N.useState(null),[y,v]=N.useState([]),[w,k]=N.useState(null),[j,b]=N.useState(!1),[S,E]=N.useState(null),[M,O]=N.useState(null),[$,P]=N.useState(0),A=N.useRef(i);N.useEffect(()=>{A.current=i},[i]),N.useEffect(()=>{let U=!0;const q=H=>{v([]),k(H??null),E(null),O(null),b(!1),h([]),x(null),l([]),u(""),d({}),f({}),p({})};return e?t?r?(b(!0),k(null),fp(t,{graph:s,targetNodeId:n??null}).then(H=>{if(!U)return;const W=Array.isArray(H==null?void 0:H.candidates)?H.candidates:[];v(W),E((H==null?void 0:H.generated_at)??null),O(typeof(H==null?void 0:H.suggested_threshold)=="number"?Number(H.suggested_threshold):null);const B=Array.isArray(H==null?void 0:H.available_filters)?H.available_filters:[];h(B),x(G=>G&&B.some(K=>K.id===G)?G:null);const D={};H&&typeof H=="object"&&(H!=null&&H.column_missing_map)&&typeof H.column_missing_map=="object"&&Object.entries(H.column_missing_map).forEach(([G,K])=>{const X=String(G??"").trim();if(!X)return;const Q=Number(K);Number.isFinite(Q)&&(D[X]=Number(Q))});const V=new Set;Array.isArray(H==null?void 0:H.all_columns)&&H.all_columns.forEach(G=>{const K=String(G??"").trim();K&&V.add(K)}),Object.keys(A.current??{}).forEach(G=>V.add(G));const te=Array.from(V).sort((G,K)=>G.localeCompare(K));te.forEach(G=>{Object.prototype.hasOwnProperty.call(D,G)||(D[G]=0)}),l(te),u(""),d(D),f(G=>{const K=H==null?void 0:H.column_type_map;if(!K||typeof K!="object")return G;const X={...G};return Object.entries(K).forEach(([Q,J])=>{const Z=String(Q??"").trim();if(!Z)return;const ee=String(J??"").trim();X[Z]=ee||G[Z]||""}),X}),p(G=>{const K=H==null?void 0:H.column_recommendations;if(!K||typeof K!="object")return G;const X={};return Object.entries(K).forEach(([Q,J])=>{const Z=String(Q??"").trim();if(!Z)return;const ee=Array.isArray(J)?J.map(de=>String(de??"").trim()).filter(Boolean):[];X[Z]=ee}),X})}).catch(H=>{U&&q((H==null?void 0:H.message)??"Unable to load recommendations")}).finally(()=>{U&&b(!1)}),()=>{U=!1}):(q("Connect this step to an upstream output to load recommendations."),()=>{U=!1}):(q(),()=>{U=!1}):(q(),()=>{U=!1})},[A,s,e,r,n,$,l,d,u,p,f,t]);const R=N.useCallback(()=>{!e||!t||!r||P(U=>U+1)},[e,r,t]),F=N.useMemo(()=>{const U=new Map;return m.forEach(q=>{q!=null&&q.id&&U.set(q.id,q.label)}),U},[m]),z=N.useCallback(U=>U?F.has(U)?F.get(U)??null:U.split("_").filter(Boolean).map(H=>H.charAt(0).toUpperCase()+H.slice(1)).join(" ")||U:null,[F]),I=N.useMemo(()=>_?y.filter(U=>Array.isArray(U==null?void 0:U.signals)&&U.signals.includes(_)):y,[_,y]);return{hasDropColumnSource:e,availableFilters:m,activeFilterId:_,setActiveFilterId:x,recommendations:y,filteredRecommendations:I,formatSignalName:z,isFetchingRecommendations:j,recommendationsError:w,recommendationsGeneratedAt:S,suggestedThreshold:M,refreshRecommendations:R}},KF=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r,setAvailableColumns:i,setColumnMissingMap:l})=>{const{isImputerNode:u}=e,d=u,[f,p]=N.useState(!1),[m,h]=N.useState(null),[_,x]=N.useState(0),y=N.useCallback(()=>{!d||!t||!n||x(v=>v+1)},[n,d,t]);return N.useEffect(()=>{let v=!0;return d?t?n?(p(!0),h(null),fp(t,{graph:s,targetNodeId:r}).then(w=>{if(!v)return;const k={};w&&typeof w=="object"&&(w!=null&&w.column_missing_map)&&typeof w.column_missing_map=="object"&&Object.entries(w.column_missing_map).forEach(([S,E])=>{const M=String(S??"").trim();if(!M)return;const O=Number(E);Number.isNaN(O)||O<0||(k[M]=Number(O))});const j=new Set;Array.isArray(w==null?void 0:w.all_columns)&&w.all_columns.forEach(S=>{const E=String(S??"").trim();E&&j.add(E)}),Object.keys(k).forEach(S=>j.add(S));const b=Array.from(j).sort((S,E)=>S.localeCompare(E));b.forEach(S=>{Object.prototype.hasOwnProperty.call(k,S)||(k[S]=0)}),b.length&&i(b),Object.keys(k).length&&l(S=>({...S,...k}))}).catch(w=>{v&&h((w==null?void 0:w.message)??"Unable to load column metrics.")}).finally(()=>{v&&p(!1)}),()=>{v=!1}):(h("Connect this step to an upstream output to load column metrics."),p(!1),()=>{v=!1}):(h("Select a dataset to load column metrics."),p(!1),()=>{v=!1}):()=>{v=!1}},[s,n,_,i,l,d,t,r]),{isFetching:f,error:m,refreshDropColumnRecommendations:y}},Hp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,highCardinalityColumns:[],notes:[]},GF=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},qp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],XF=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=GF(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,f=typeof t.text_category=="string"?t.text_category:null,p=qp(t.sample_values),m=typeof t.score=="number"?t.score:0,h=typeof t.selectable=="boolean"?t.selectable:!0;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:f,sample_values:p,score:m,selectable:h}}).filter(t=>!!t),QF=e=>{if(!e||typeof e!="object")return{...Hp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.auto_detect_default,l=qp(e.high_cardinality_columns),u=qp(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:i,highCardinalityColumns:l,notes:u}},ZF=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isLabelEncodingNode:i}=e,[l,u]=N.useState(!1),[d,f]=N.useState(null),[p,m]=N.useState([]),[h,_]=N.useState({...Hp}),[x,y]=N.useState(0);N.useEffect(()=>{let j=!0;const b=S=>{m([]),_({...Hp}),u(!1),f(S??null)};return i?t?n?(u(!0),f(null),ew(t,{graph:s??null,targetNodeId:r??null}).then(S=>{j&&(m(XF(S)),_(QF(S)))}).catch(S=>{if(!j)return;const E=typeof(S==null?void 0:S.message)=="string"?S.message:"Unable to load label encoding suggestions";b(E)}).finally(()=>{j&&u(!1)}),()=>{j=!1}):(b("Connect this node to the dataset input to load suggestions."),()=>{j=!1}):(b(),()=>{j=!1}):(b(),()=>{j=!1})},[s,n,i,x,t,r]);const v=N.useCallback(()=>{!i||!t||!n||y(j=>j+1)},[n,i,t]),w=N.useMemo(()=>h,[h]),k=N.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:k,metadata:w,refresh:v}},Vp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,enableGlobalFallbackDefault:!1,highCardinalityColumns:[],notes:[]},JF=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Wp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],e5=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=JF(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,f=typeof t.text_category=="string"?t.text_category:null,p=Wp(t.sample_values),m=typeof t.score=="number"?t.score:0,h=typeof t.selectable=="boolean"?t.selectable:!0,_=typeof t.recommended_use_global_fallback=="boolean"?t.recommended_use_global_fallback:!!(t.missing_percentage&&t.missing_percentage>0);return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:f,sample_values:p,score:m,selectable:h,recommended_use_global_fallback:_}}).filter(t=>!!t),t5=e=>{if(!e||typeof e!="object")return{...Vp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.enable_global_fallback_default,l=Wp(e.high_cardinality_columns),u=Wp(e.notes),d=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:d,enableGlobalFallbackDefault:i,highCardinalityColumns:l,notes:u}},n5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isTargetEncodingNode:i}=e,[l,u]=N.useState(!1),[d,f]=N.useState(null),[p,m]=N.useState([]),[h,_]=N.useState({...Vp}),[x,y]=N.useState(0);N.useEffect(()=>{let j=!0;const b=S=>{m([]),_({...Vp}),u(!1),f(S??null)};return i?t?n?(u(!0),f(null),nw(t,{graph:s??null,targetNodeId:r??null}).then(S=>{j&&(m(e5(S)),_(t5(S)))}).catch(S=>{if(!j)return;const E=typeof(S==null?void 0:S.message)=="string"?S.message:"Unable to load target encoding suggestions";b(E)}).finally(()=>{j&&u(!1)}),()=>{j=!1}):(b("Connect this node to the dataset input to load suggestions."),()=>{j=!1}):(b(),()=>{j=!1}):(b(),()=>{j=!1})},[s,n,i,x,t,r]);const v=N.useCallback(()=>{!i||!t||!n||y(j=>j+1)},[n,i,t]),w=N.useMemo(()=>h,[h]),k=N.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:k,metadata:w,refresh:v}},am={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,suggestedBucketDefault:0,highCardinalityColumns:[],notes:[]},s5=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Yp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],r5=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=s5(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,f=typeof t.text_category=="string"?t.text_category:null,p=Yp(t.sample_values),m=typeof t.score=="number"?t.score:0,h=typeof t.selectable=="boolean"?t.selectable:!0,_=typeof t.recommended_bucket_count=="number"?Math.max(2,Math.round(t.recommended_bucket_count)):0;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:f,sample_values:p,score:m,selectable:h,recommended_bucket_count:_}}).filter(t=>!!t),a5=e=>{if(!e||typeof e!="object")return{...am};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.auto_detect_default,l=Number(e.suggested_bucket_default??0)||0,u=Yp(e.high_cardinality_columns),d=Yp(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:i,suggestedBucketDefault:l,highCardinalityColumns:u,notes:d}},o5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isHashEncodingNode:i}=e,[l,u]=N.useState(!1),[d,f]=N.useState(null),[p,m]=N.useState([]),[h,_]=N.useState({...am}),[x,y]=N.useState(0),v=N.useCallback(j=>{m([]),_({...am}),u(!1),f(j??null)},[]);N.useEffect(()=>{let j=!0;return i?t?n?(u(!0),f(null),sw(t,{graph:s??null,targetNodeId:r??null}).then(b=>{j&&(m(r5(b)),_(a5(b)))}).catch(b=>{j&&(m([]),_({...am}),f(b!=null&&b.message?String(b.message):"Unable to load hash encoding suggestions"))}).finally(()=>{j&&u(!1)}),()=>{j=!1}):(v("Connect this node to the dataset input to load suggestions."),()=>{j=!1}):(v(),()=>{j=!1}):(v(),()=>{j=!1})},[s,n,i,v,t,r,x]);const w=N.useCallback(()=>{y(j=>j+1)},[]);return N.useMemo(()=>({isFetching:l,error:d,suggestions:p,metadata:h,refresh:w}),[d,l,h,w,p])},Kp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,enableUnknownDefault:!1,highCardinalityColumns:[],notes:[]},i5=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Gp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],l5=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=i5(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,f=typeof t.text_category=="string"?t.text_category:null,p=Gp(t.sample_values),m=typeof t.score=="number"?t.score:0,h=typeof t.selectable=="boolean"?t.selectable:!0,_=typeof t.recommended_handle_unknown=="boolean"?t.recommended_handle_unknown:!!(t.missing_percentage&&t.missing_percentage>0);return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:f,sample_values:p,score:m,selectable:h,recommended_handle_unknown:_}}).filter(t=>!!t),c5=e=>{if(!e||typeof e!="object")return{...Kp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.enable_unknown_default,l=Gp(e.high_cardinality_columns),u=Gp(e.notes),d=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:d,enableUnknownDefault:i,highCardinalityColumns:l,notes:u}},u5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isOrdinalEncodingNode:i}=e,[l,u]=N.useState(!1),[d,f]=N.useState(null),[p,m]=N.useState([]),[h,_]=N.useState({...Kp}),[x,y]=N.useState(0);N.useEffect(()=>{let j=!0;const b=S=>{m([]),_({...Kp}),u(!1),f(S??null)};return i?t?n?(u(!0),f(null),tw(t,{graph:s??null,targetNodeId:r??null}).then(S=>{j&&(m(l5(S)),_(c5(S)))}).catch(S=>{if(!j)return;const E=typeof(S==null?void 0:S.message)=="string"?S.message:"Unable to load ordinal encoding suggestions";b(E)}).finally(()=>{j&&u(!1)}),()=>{j=!1}):(b("Connect this node to the dataset input to load suggestions."),()=>{j=!1}):(b(),()=>{j=!1}):(b(),()=>{j=!1})},[s,n,i,x,t,r]);const v=N.useCallback(()=>{!i||!t||!n||y(j=>j+1)},[n,i,t]),w=N.useMemo(()=>h,[h]),k=N.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:k,metadata:w,refresh:v}},Xp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,cautionedCount:0,highCardinalityColumns:[],notes:[],autoDetectDefault:!1},d5=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Qp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],m5=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=d5(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,f=typeof t.text_category=="string"?t.text_category:null,p=Qp(t.sample_values),m=typeof t.estimated_dummy_columns=="number"?Math.max(0,Math.round(t.estimated_dummy_columns)):0,h=typeof t.score=="number"?t.score:0,_=typeof t.selectable=="boolean"?t.selectable:!0,x=typeof t.recommended_drop_first=="boolean"?t.recommended_drop_first:!0;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:f,sample_values:p,estimated_dummy_columns:m,score:h,selectable:_,recommended_drop_first:x}}).filter(t=>!!t),f5=e=>{if(!e||typeof e!="object")return{...Xp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=Number(e.cautioned_count??0)||0,l=Qp(e.high_cardinality_columns),u=Qp(e.notes),d=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,cautionedCount:i,highCardinalityColumns:l,notes:u,autoDetectDefault:d}},h5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isDummyEncodingNode:i}=e,[l,u]=N.useState(!1),[d,f]=N.useState(null),[p,m]=N.useState([]),[h,_]=N.useState({...Xp}),[x,y]=N.useState(0);N.useEffect(()=>{let j=!0;const b=S=>{m([]),_({...Xp}),u(!1),f(S??null)};return i?t?n?(u(!0),f(null),aw(t,{graph:s??null,targetNodeId:r??null}).then(S=>{j&&(m(m5(S)),_(f5(S)))}).catch(S=>{if(!j)return;const E=typeof(S==null?void 0:S.message)=="string"?S.message:"Unable to load dummy encoding suggestions";b(E)}).finally(()=>{j&&u(!1)}),()=>{j=!1}):(b("Connect this node to the dataset input to load suggestions."),()=>{j=!1}):(b(),()=>{j=!1}):(b(),()=>{j=!1})},[s,n,i,x,t,r]);const v=N.useCallback(()=>{!i||!t||!n||y(j=>j+1)},[n,i,t]),w=N.useMemo(()=>h,[h]),k=N.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:k,metadata:w,refresh:v}},Zp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,cautionedCount:0,highCardinalityColumns:[],notes:[]},p5=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Jp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],g5=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=p5(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,f=typeof t.text_category=="string"?t.text_category:null,p=Jp(t.sample_values),m=typeof t.estimated_dummy_columns=="number"?Math.max(0,Math.round(t.estimated_dummy_columns)):0,h=typeof t.score=="number"?t.score:0,_=typeof t.selectable=="boolean"?t.selectable:!0,x=typeof t.recommended_drop_first=="boolean"?t.recommended_drop_first:!1;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:f,sample_values:p,estimated_dummy_columns:m,score:h,selectable:_,recommended_drop_first:x}}).filter(t=>!!t),_5=e=>{if(!e||typeof e!="object")return{...Zp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=Number(e.cautioned_count??0)||0,l=Jp(e.high_cardinality_columns),u=Jp(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,cautionedCount:i,highCardinalityColumns:l,notes:u}},y5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isOneHotEncodingNode:i}=e,[l,u]=N.useState(!1),[d,f]=N.useState(null),[p,m]=N.useState([]),[h,_]=N.useState({...Zp}),[x,y]=N.useState(0);N.useEffect(()=>{let j=!0;const b=S=>{m([]),_({...Zp}),u(!1),f(S??null)};return i?t?n?(u(!0),f(null),rw(t,{graph:s??null,targetNodeId:r??null}).then(S=>{j&&(m(g5(S)),_(_5(S)))}).catch(S=>{if(!j)return;const E=typeof(S==null?void 0:S.message)=="string"?S.message:"Unable to load one-hot encoding suggestions";b(E)}).finally(()=>{j&&u(!1)}),()=>{j=!1}):(b("Connect this node to the dataset input to load suggestions."),()=>{j=!1}):(b(),()=>{j=!1}):(b(),()=>{j=!1})},[s,n,i,x,t,r]);const v=N.useCallback(()=>{!i||!t||!n||y(j=>j+1)},[n,i,t]),w=N.useMemo(()=>h,[h]),k=N.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:k,metadata:w,refresh:v}},v5=({catalogFlags:e,enableGlobalFallbackDefault:t,encodeMissing:n,handleUnknown:s,setConfigState:r,nodeChangeVersion:i})=>{const{isTargetEncodingNode:l}=e,u=N.useRef(!1);N.useEffect(()=>{u.current=!1},[i]),N.useEffect(()=>{if(!l||!t||u.current)return;const d=typeof n=="boolean"?n:null,f=typeof s=="string"?s.trim().toLowerCase():"";if(d===!0&&f==="global_mean"){u.current=!0;return}r(p=>{const m=typeof(p==null?void 0:p.encode_missing)=="boolean"?p.encode_missing:null,h=typeof(p==null?void 0:p.handle_unknown)=="string"?p.handle_unknown.trim().toLowerCase():"";if(m===!0&&h==="global_mean")return u.current=!0,p;const _={...p};return m!==!0&&(_.encode_missing=!0),h!=="global_mean"&&(_.handle_unknown="global_mean"),u.current=!0,_})},[n,s,l,t,r])},x5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,node:r,configState:i,setConfigState:l,nodeChangeVersion:u})=>{const{isLabelEncodingNode:d,isTargetEncodingNode:f,isHashEncodingNode:p,isOrdinalEncodingNode:m,isDummyEncodingNode:h,isOneHotEncodingNode:_}=e,x=(r==null?void 0:r.id)??null,{isFetching:y,error:v,suggestions:w,metadata:k}=ZF({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:j,error:b,suggestions:S,metadata:E}=n5({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x});v5({catalogFlags:e,enableGlobalFallbackDefault:E.enableGlobalFallbackDefault,encodeMissing:i==null?void 0:i.encode_missing,handleUnknown:i==null?void 0:i.handle_unknown,setConfigState:l,nodeChangeVersion:u});const{isFetching:M,error:O,suggestions:$,metadata:P}=o5({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:A,error:R,suggestions:F,metadata:z}=u5({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:I,error:U,suggestions:q,metadata:H}=h5({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:W,error:B,suggestions:D,metadata:V}=y5({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x});N.useEffect(()=>{d&&(i!=null&&i.auto_detect)&&k.autoDetectDefault&&l(Z=>({...Z,columns:k.autoDetectDefault}))},[i==null?void 0:i.auto_detect,d,k.autoDetectDefault,l]),N.useEffect(()=>{f&&(i!=null&&i.auto_detect)&&E.autoDetectDefault&&l(Z=>({...Z,columns:E.autoDetectDefault}))},[i==null?void 0:i.auto_detect,f,l,E.autoDetectDefault]),N.useEffect(()=>{p&&(i!=null&&i.auto_detect)&&P.autoDetectDefault&&l(Z=>({...Z,columns:P.autoDetectDefault}))},[i==null?void 0:i.auto_detect,P.autoDetectDefault,p,l]),N.useEffect(()=>{p&&P.suggestedBucketDefault&&l(Z=>({...Z,n_buckets:P.suggestedBucketDefault}))},[P.suggestedBucketDefault,p,l]),N.useEffect(()=>{f&&E.enableGlobalFallbackDefault&&l(Z=>{const ee={};return Z.encode_missing===void 0&&(ee.encode_missing=!0),Z.handle_unknown===void 0&&(ee.handle_unknown="value"),Object.keys(ee).length>0?{...Z,...ee}:Z})},[i==null?void 0:i.encode_missing,i==null?void 0:i.handle_unknown,f,l,E.enableGlobalFallbackDefault]),N.useEffect(()=>{m&&(i!=null&&i.auto_detect)&&z.autoDetectDefault&&l(Z=>({...Z,columns:z.autoDetectDefault}))},[i==null?void 0:i.auto_detect,m,z.autoDetectDefault,l]),N.useEffect(()=>{m&&z.enableUnknownDefault&&l(Z=>Z.handle_unknown===void 0?{...Z,handle_unknown:"use_encoded_value",unknown_value:-1}:Z)},[i==null?void 0:i.handle_unknown,m,z.enableUnknownDefault,l]),N.useEffect(()=>{h&&(i!=null&&i.auto_detect)&&H.autoDetectDefault&&l(Z=>({...Z,columns:H.autoDetectDefault}))},[i==null?void 0:i.auto_detect,H.autoDetectDefault,h,l]);const te=N.useCallback(Z=>{l(ee=>({...ee,columns:Z}))},[l]),G=N.useCallback(Z=>{l(ee=>({...ee,columns:Z}))},[l]),K=N.useCallback(Z=>{l(ee=>({...ee,columns:Z}))},[l]),X=N.useCallback(Z=>{l(ee=>({...ee,columns:Z}))},[l]),Q=N.useCallback(Z=>{l(ee=>({...ee,columns:Z}))},[l]),J=N.useCallback(Z=>{l(ee=>({...ee,columns:Z}))},[l]);return{labelEncoding:{isFetching:y,error:v,suggestions:w,metadata:k,handleApplyRecommended:te},targetEncoding:{isFetching:j,error:b,suggestions:S,metadata:E,handleApplyRecommended:G},hashEncoding:{isFetching:M,error:O,suggestions:$,metadata:P,handleApplyRecommended:K},ordinalEncoding:{isFetching:A,error:R,suggestions:F,metadata:z,handleApplyRecommended:X},dummyEncoding:{isFetching:I,error:U,suggestions:q,metadata:H,handleApplyRecommended:Q},oneHotEncoding:{isFetching:W,error:B,suggestions:D,metadata:V,handleApplyRecommended:J}}},b5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isOutlierNode:i}=e,[l,u]=N.useState(null),[d,f]=N.useState(null),[p,m]=N.useState(!1),[h,_]=N.useState(0),x=N.useCallback(()=>{_(y=>y+1)},[]);return N.useEffect(()=>{let y=!0;return i?t?n?(m(!0),f(null),ow(t,{graph:s,targetNodeId:r}).then(v=>{y&&u(v??null)}).catch(v=>{y&&(u(null),f((v==null?void 0:v.message)??"Unable to load outlier insights"))}).finally(()=>{y&&m(!1)}),()=>{y=!1}):(u(null),f("Connect this step to an upstream output to load outlier insights."),m(!1),()=>{y=!1}):(u(null),f("Select a dataset to load outlier insights."),m(!1),()=>{y=!1}):(u(null),f(null),m(!1),()=>{y=!1})},[s,n,i,h,t,r]),{outlierData:l,outlierError:d,isFetchingOutliers:p,refreshOutliers:x}},w5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isScalingNode:i}=e,[l,u]=N.useState(null),[d,f]=N.useState(null),[p,m]=N.useState(!1),[h,_]=N.useState(0),x=N.useCallback(()=>{_(y=>y+1)},[]);return N.useEffect(()=>{let y=!0;return i?t?n?(m(!0),f(null),lw(t,{graph:s,targetNodeId:r}).then(v=>{y&&u(v??null)}).catch(v=>{y&&(u(null),f((v==null?void 0:v.message)??"Unable to load scaling insights"))}).finally(()=>{y&&m(!1)}),()=>{y=!1}):(u(null),f("Connect this step to an upstream output to load scaling insights."),m(!1),()=>{y=!1}):(u(null),f("Select a dataset to load scaling insights."),m(!1),()=>{y=!1}):(u(null),f(null),m(!1),()=>{y=!1})},[s,n,i,h,t,r]),{scalingData:l,scalingError:d,isFetchingScaling:p,refreshScaling:x}},N5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isBinningNode:i}=e,[l,u]=N.useState(null),[d,f]=N.useState(null),[p,m]=N.useState(!1),[h,_]=N.useState(0),x=N.useCallback(()=>{_(y=>y+1)},[]);return N.useEffect(()=>{let y=!0;return i?t?n?(m(!0),f(null),cw(t,{graph:s,targetNodeId:r}).then(v=>{y&&u(v??null)}).catch(v=>{y&&(u(null),f((v==null?void 0:v.message)??"Unable to load binning insights"))}).finally(()=>{y&&m(!1)}),()=>{y=!1}):(u(null),f("Connect this step to an upstream output to analyse numeric columns."),m(!1),()=>{y=!1}):(u(null),f("Select a dataset to load binning insights."),m(!1),()=>{y=!1}):(u(null),f(null),m(!1),()=>{y=!1})},[s,n,i,h,t,r]),{binningData:l,binningError:d,isFetchingBinning:p,refreshBinning:x}},j5=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r,samplePreset:i})=>{const{isBinnedDistributionNode:l}=e,[u,d]=N.useState(null),[f,p]=N.useState(null),[m,h]=N.useState(!1),[_,x]=N.useState(0),y=N.useCallback(()=>{x(v=>v+1)},[]);return N.useEffect(()=>{let v=!0;if(!l)return d(null),p(null),h(!1),()=>{v=!1};if(!t)return d(null),p("Select a dataset to load binned column distributions."),h(!1),()=>{v=!1};if(!n)return d(null),p("Connect this step to an upstream output to load binned column distributions."),h(!1),()=>{v=!1};h(!0),p(null);const w=jc.find(j=>j.value===i)??jc[0],k=w.value==="all"?"all":Number(w.value);return uw(t,{sampleSize:k,graph:s,targetNodeId:r}).then(j=>{v&&d(j??null)}).catch(j=>{v&&(d(null),p((j==null?void 0:j.message)??"Unable to load binned column distributions"))}).finally(()=>{v&&h(!1)}),()=>{v=!1}},[s,n,l,_,i,t,r]),{binnedDistributionData:u,binnedDistributionError:f,isFetchingBinnedDistribution:m,refreshBinnedDistribution:y}},C5=({catalogFlags:e,sourceId:t,graphContext:n,targetNodeId:s,transformations:r})=>{const{isSkewnessNode:i,isSkewnessDistributionNode:l}=e,u=i||l,[d,f]=N.useState(null),[p,m]=N.useState(null),[h,_]=N.useState(!1),[x,y]=N.useState(0),v=N.useRef(null),w=N.useCallback(()=>{y(k=>k+1)},[]);return N.useEffect(()=>{let k=!0;return u?t?(v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{if(!k)return;_(!0),m(null);let j;r.length>0&&(j=r.map(b=>({column:b.column,method:b.method}))),iw(t,{transformations:j,graph:n,targetNodeId:s}).then(b=>{k&&f(b??null)}).catch(b=>{k&&(f(null),m((b==null?void 0:b.message)??"Unable to load skewness insights"))}).finally(()=>{k&&_(!1)})},300),()=>{k=!1,v.current&&clearTimeout(v.current)}):(f(null),m("Select a dataset to load skewness insights."),_(!1),v.current&&(clearTimeout(v.current),v.current=null),()=>{k=!1}):(f(null),m(null),_(!1),v.current&&(clearTimeout(v.current),v.current=null),()=>{k=!1})},[n,x,u,t,s,r]),{skewnessData:d,skewnessError:p,isFetchingSkewness:h,refreshSkewness:w}},S5="_was_missing",E5=(e,t)=>{const n=typeof e=="string"?e.trim():"";if(n)return n;const s=typeof t=="string"?t.trim():"";return s||S5},k5=(e,t)=>{const n=typeof e=="string"?e.trim():"",s=typeof t=="string"?t:"";return!n||!s?!1:n.endsWith(s)},M5=({selectedColumns:e,availableColumns:t,columnMissingMap:n,suffix:s})=>{const r=typeof s=="string"?s:"",i=Ge(t),l=new Set(i),u=Array.from(new Set(Ge(e))),d=[];if(u.forEach(m=>{const h=`${m}${r}`,_=n[m],x=typeof _=="number"&&Number.isFinite(_)?Math.max(0,_):null;d.push({column:m,missingPercentage:x,flagColumn:h,conflicts:{alreadyExists:l.has(h),duplicateFlag:!1}})}),d.length>0){const m=new Map;d.forEach(h=>{m.set(h.flagColumn,(m.get(h.flagColumn)??0)+1)}),d.forEach(h=>{h.conflicts.duplicateFlag=(m.get(h.flagColumn)??0)>1})}d.sort((m,h)=>{const _=m.missingPercentage,x=h.missingPercentage,y=typeof _=="number",v=typeof x=="number";return y&&v&&_!==x?x-_:y!==v?y?-1:1:m.column.localeCompare(h.column)});const f=r?Array.from(new Set(i.filter(m=>k5(m,r)))):[],p=d.reduce((m,h)=>h.conflicts.alreadyExists||h.conflicts.duplicateFlag?m+1:m,0);return{rows:d,flaggedColumnsInDataset:f,conflictCount:p}},A5=({catalogFlags:e,configState:t,node:n,availableColumns:s,columnMissingMap:r})=>{var f,p;const{isMissingIndicatorNode:i}=e,l=N.useMemo(()=>{var m,h;return i?E5(t==null?void 0:t.flag_suffix,(h=(m=n==null?void 0:n.data)==null?void 0:m.config)==null?void 0:h.flag_suffix):""},[t==null?void 0:t.flag_suffix,i,(p=(f=n==null?void 0:n.data)==null?void 0:f.config)==null?void 0:p.flag_suffix]),u=N.useMemo(()=>i?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,i]),d=N.useMemo(()=>i?M5({selectedColumns:u,availableColumns:s,columnMissingMap:r,suffix:l}):{rows:[],flaggedColumnsInDataset:[],conflictCount:0},[l,s,r,i,u]);return{activeFlagSuffix:l,missingIndicatorColumns:u,missingIndicatorInsights:d}},Rj={enabled:!1,explicit:!1},O5={selectedColumns:[],nonTextSelected:[],autoDetectionActive:!1,recommendedColumns:[],textColumnCount:0,textColumns:[]},$5={totalPairs:0,previewPairs:[],previewOverflow:0,duplicates:[],duplicateOverflow:0,invalidEntries:[],invalidOverflow:0},T5={},P5=[],L5=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isReplaceAliasesNode:l}=e,u=N.useMemo(()=>{if(!l)return Rj;const v=ol(t);if(v!==void 0)return{enabled:!!Ro(v),explicit:!0};if(n&&typeof n=="object"){const w=ol(n);if(w!==void 0)return{enabled:!!Ro(w),explicit:!0}}return Rj},[t,l,n]),d=N.useMemo(()=>{if(!l)return[];const v=Ge((t==null?void 0:t.columns)??(n==null?void 0:n.columns)),w=Id(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),k=(()=>{const b=ol(t);if(b!==void 0){const S=Ro(b);if(S!==null)return S}if(n&&typeof n=="object"){const S=ol(n);if(S!==void 0){const E=Ro(S);if(E!==null)return E}}return v.length===0})(),j=(t==null?void 0:t.alias_strategies)??(t==null?void 0:t.strategies)??(n==null?void 0:n.alias_strategies)??(n==null?void 0:n.strategies);return qw(j,{mode:w,columns:v,autoDetect:k})},[t,l,n]),f=N.useMemo(()=>l?d.length?Array.from(new Set(d.flatMap(v=>v.columns.map(w=>w.trim()).filter(Boolean)))).sort((v,w)=>v.localeCompare(w)):Ge(t==null?void 0:t.columns):[],[d,t==null?void 0:t.columns,l]),p=N.useMemo(()=>l?d.length?d.some(v=>v.autoDetect):u.explicit?u.enabled:f.length===0:!1,[u.enabled,u.explicit,f.length,d,l]),m=N.useMemo(()=>{if(l)return t==null?void 0:t.custom_pairs},[t==null?void 0:t.custom_pairs,l]),h=N.useMemo(()=>l?Yz(i):T5,[l,i]),_=N.useMemo(()=>l?Bz({selectedColumns:f,availableColumns:s,columnTypeMap:r,autoDetectEnabled:p}):O5,[p,f,s,r,l]),x=N.useMemo(()=>l?Hz(m):$5,[l,m]),y=N.useMemo(()=>{if(!l)return P5;const v=new Set(_.recommendedColumns),w=new Set(_.textColumns);return s.map(k=>{const j=r[k]??null,b=h[k]??[];return{name:k,dtype:j,samples:b.slice(0,3),isRecommended:v.has(k),isTextLike:w.has(k)}})},[_.recommendedColumns,_.textColumns,h,s,r,l]);return{aliasAutoDetectMeta:u,aliasStrategies:d,aliasStrategyCount:d.length,aliasSelectedColumns:f,aliasAutoDetectEnabled:p,replaceAliasesCustomPairsValue:m,aliasColumnSummary:_,aliasCustomPairSummary:x,aliasSampleMap:h,aliasColumnOptions:y}},z5=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isTrimWhitespaceNode:l,isRemoveSpecialCharsNode:u,isRegexCleanupNode:d,isNormalizeTextCaseNode:f}=e,p=N.useMemo(()=>jR(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,l,n==null?void 0:n.mode]),m=N.useMemo(()=>l?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,l]),h=N.useMemo(()=>l?OR(i):{},[l,i]),_=N.useMemo(()=>l?ER({selectedColumns:m,availableColumns:s,columnTypeMap:r,sampleMap:h}):TR,[s,r,l,m,h]),x=N.useMemo(()=>CR(p),[p]),y=N.useMemo(()=>VR(u?t==null?void 0:t.mode:void 0,u?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,u,n==null?void 0:n.mode]),v=N.useMemo(()=>u?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,u]),w=N.useMemo(()=>u?XR(i):{},[u,i]),k=N.useMemo(()=>u?KR({selectedColumns:v,availableColumns:s,columnTypeMap:r,sampleMap:w}):ZR,[s,r,u,v,w]),j=N.useMemo(()=>WR(y),[y]),b=N.useMemo(()=>jD(d?t==null?void 0:t.mode:void 0,d?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,d,n==null?void 0:n.mode]),S=N.useMemo(()=>d?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,d]),E=N.useMemo(()=>d?MD(i):{},[d,i]),M=N.useMemo(()=>d?ED({selectedColumns:S,availableColumns:s,columnTypeMap:r,sampleMap:E}):$D,[s,r,d,S,E]),O=N.useMemo(()=>CD(b),[b]),$=N.useMemo(()=>{if(!d)return null;const I=(t==null?void 0:t.replacement)??(n==null?void 0:n.replacement)??null;return typeof I=="string"?I:null},[t==null?void 0:t.replacement,d,n==null?void 0:n.replacement]),P=N.useMemo(()=>lD(f?t==null?void 0:t.mode:void 0,f?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,f,n==null?void 0:n.mode]),A=N.useMemo(()=>f?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,f]),R=N.useMemo(()=>f?fD(i):{},[f,i]),F=N.useMemo(()=>f?dD({selectedColumns:A,availableColumns:s,columnTypeMap:r,sampleMap:R,mode:P}):pD,[s,r,f,A,P,R]),z=N.useMemo(()=>cD(P),[P]);return{trimWhitespace:{columnSummary:_,sampleMap:h,modeDetails:x},removeSpecial:{columnSummary:k,sampleMap:w,modeDetails:j,selectedMode:y},regexCleanup:{columnSummary:M,sampleMap:E,modeDetails:O,selectedMode:b,replacementValue:$},normalizeCase:{columnSummary:F,sampleMap:R,modeDetails:z,selectedMode:P}}},R5={},D5=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isReplaceInvalidValuesNode:l}=e,u=N.useMemo(()=>HD(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,l,n==null?void 0:n.mode]),d=N.useMemo(()=>l?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,l]),f=N.useMemo(()=>{if(!l)return null;const x=(t==null?void 0:t.min_value)??(n==null?void 0:n.min_value),y=Number(x);return Number.isFinite(y)?y:null},[t==null?void 0:t.min_value,l,n==null?void 0:n.min_value]),p=N.useMemo(()=>{if(!l)return null;const x=(t==null?void 0:t.max_value)??(n==null?void 0:n.max_value),y=Number(x);return Number.isFinite(y)?y:null},[t==null?void 0:t.max_value,l,n==null?void 0:n.max_value]),m=N.useMemo(()=>l?KD(i):R5,[l,i]),h=N.useMemo(()=>l?WD({selectedColumns:d,availableColumns:s,columnTypeMap:r,sampleMap:m}):nI,[s,r,l,m,d]),_=N.useMemo(()=>qD(u),[u]);return{selectedColumns:d,selectedMode:u,modeDetails:_,sampleMap:m,columnSummary:h,minValue:f,maxValue:p}},I5={},F5=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isStandardizeDatesNode:l}=e,u=N.useMemo(()=>tN(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,l,n==null?void 0:n.mode]),d=N.useMemo(()=>l?Ge((t==null?void 0:t.columns)??(n==null?void 0:n.columns)):[],[t==null?void 0:t.columns,l,n==null?void 0:n.columns]),f=N.useMemo(()=>{if(!l)return[];const y={columns:d,mode:u,autoDetect:d.length===0};return nN((t==null?void 0:t.format_strategies)??(n==null?void 0:n.format_strategies),y)},[t==null?void 0:t.format_strategies,l,d,n==null?void 0:n.format_strategies,u]),p=N.useMemo(()=>{if(!l)return[];const y=new Set;return f.forEach(v=>{v.columns.forEach(w=>{const k=w.trim();k&&y.add(k)})}),Array.from(y).sort((v,w)=>v.localeCompare(w))},[l,f]),m=N.useMemo(()=>f.some(y=>y.autoDetect),[f]),h=N.useMemo(()=>l?hR(i):I5,[l,i]),_=N.useMemo(()=>{if(!l)return pR;const y=lR({selectedColumns:p,availableColumns:s,columnTypeMap:r,sampleMap:h});return m?{...y,autoDetectionActive:!0}:y},[s,r,m,l,h,p]),x=N.useMemo(()=>{if(!l)return[];const y=new Set(_.recommendedColumns),v=new Set(_.sampleCandidates);return s.map(w=>{const k=r[w]??null,j=h[w]??[];return{name:w,dtype:k,samples:j.slice(0,3),isRecommended:y.has(w),isSampleCandidate:v.has(w)}})},[s,_,r,l,h]);return{selectedMode:u,strategies:f,sampleMap:h,columnSummary:_,columnOptions:x}},B5=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isReplaceAliasesNode:l,isTrimWhitespaceNode:u,isRemoveSpecialCharsNode:d,isRegexCleanupNode:f,isNormalizeTextCaseNode:p,isReplaceInvalidValuesNode:m,isStandardizeDatesNode:h}=e,{aliasAutoDetectMeta:_,aliasStrategies:x,aliasStrategyCount:y,aliasSelectedColumns:v,aliasAutoDetectEnabled:w,replaceAliasesCustomPairsValue:k,aliasColumnSummary:j,aliasCustomPairSummary:b,aliasSampleMap:S,aliasColumnOptions:E}=L5({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i}),{trimWhitespace:M,removeSpecial:O,regexCleanup:$,normalizeCase:P}=z5({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i}),{selectedMode:A,modeDetails:R,sampleMap:F,columnSummary:z,minValue:I,maxValue:U}=D5({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i}),{selectedMode:q,strategies:H,sampleMap:W,columnSummary:B,columnOptions:D}=F5({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i});return{alias:{autoDetectMeta:_,strategies:x,strategyCount:y,selectedColumns:v,autoDetectEnabled:w,customPairsValue:k,columnSummary:j,customPairSummary:b,sampleMap:S,columnOptions:E},trimWhitespace:M,removeSpecial:O,regexCleanup:$,normalizeCase:P,replaceInvalid:{mode:A,modeDetails:R,sampleMap:F,columnSummary:z,minValue:I,maxValue:U},standardizeDates:{mode:q,strategies:H,sampleMap:W,columnSummary:B,columnOptions:D}}},U5=["int","float","double","decimal","number","numeric","long","short"],H5=["datetime","date","time","timestamp"],q5=["object","string","text","category","categorical","char"],V5=({catalogFlags:e,availableColumns:t,columnTypeMap:n,previewSampleRows:s})=>{const{isBinningNode:r,isScalingNode:i,isOutlierNode:l}=e,u=r||i||l,d=N.useMemo(()=>{if(!u)return{excluded:new Set,reasons:new Map};const f=new Set,p=new Map;return t.forEach(m=>{const h=(n[m]??"").toLowerCase(),_=U5.some(S=>h.includes(S)),x=H5.some(S=>h.includes(S)),y=q5.some(S=>h.includes(S));if(h.includes("bool")){f.add(m),p.set(m,"Boolean dtype");return}if((x||y)&&!_){f.add(m),p.set(m,"Non-numeric dtype");return}const v=s.map(S=>S&&Object.prototype.hasOwnProperty.call(S,m)?S[m]:void 0).filter(S=>S!=null);if(!v.length){_||(f.add(m),p.set(m,"No numeric samples"));return}let w=!0,k=!1,j=!1;const b=new Set;for(const S of v){if(typeof S=="boolean"){b.add(S?"1":"0");continue}if(typeof S=="number"){if(!Number.isFinite(S)){w=!1;break}k=!0,Math.abs(S)<1e-9?b.add("0"):Math.abs(S-1)<1e-9?b.add("1"):j=!0;continue}if(typeof S=="string"){const E=S.trim();if(!E)continue;const M=E.toLowerCase();if(nj.has(M)){b.add("1");continue}if(sj.has(M)){b.add("0");continue}const O=Number(E);if(!Number.isNaN(O)&&Number.isFinite(O)){k=!0,Math.abs(O)<1e-9?b.add("0"):Math.abs(O-1)<1e-9?b.add("1"):j=!0;continue}w=!1;break}w=!1;break}if(!w||!k&&!_){f.add(m),p.set(m,"Non-numeric values");return}!j&&b.size>0&&Array.from(b).every(E=>E==="0"||E==="1")&&(f.add(m),p.set(m,"Binary/bool-like values"))}),{excluded:f,reasons:p}},[t,n,s,u]);return{numericExcludedColumns:d.excluded,numericExclusionReasons:d.reasons}},W5=({catalogFlags:e,configState:t,numericExcludedColumns:n,scalingData:s})=>{const{isScalingNode:r}=e,i=N.useMemo(()=>Ej(t),[t]),l=N.useMemo(()=>new Set(i.skippedColumns),[i.skippedColumns]),u=N.useMemo(()=>r?n:new Set,[r,n]),d=N.useMemo(()=>r?new Set(i.columns):new Set,[r,i.columns]),f=N.useMemo(()=>new Set(Object.keys(i.columnMethods)),[i.columnMethods]),p=N.useMemo(()=>Array.isArray(s==null?void 0:s.columns)?s.columns.filter(F=>!!(F&&F.column)):[],[s==null?void 0:s.columns]),m=N.useMemo(()=>MF(s==null?void 0:s.methods),[s==null?void 0:s.methods]),h=N.useMemo(()=>AF(s==null?void 0:s.methods),[s==null?void 0:s.methods]),_=N.useMemo(()=>$F({recommendations:p,scalingConfig:i,scalingMethodLabelMap:m,scalingSelectedSet:d,scalingSkippedColumns:l,scalingExcludedColumns:u}),[p,i,m,d,l,u]),x=N.useMemo(()=>Array.from(f).sort((F,z)=>F.localeCompare(z)),[f]),y=N.useMemo(()=>x.slice(0,4),[x]),v=_.length,w=f.size,k=d.size,j=i.autoDetect,b=N.useMemo(()=>h.get(i.defaultMethod)??null,[i.defaultMethod,h]),S=N.useMemo(()=>{const F=i.defaultMethod;return m[F]??Bo[F]??F},[i.defaultMethod,m]),E=v>0,M=N.useMemo(()=>_.filter(F=>!F.isSkipped&&!F.isExcluded&&F.isSelected&&F.recommendedMethod!==F.currentMethod).length,[_]),O=N.useMemo(()=>_.filter(F=>F.isSelected&&!F.isSkipped&&!F.isExcluded).length,[_]),$=N.useMemo(()=>_.filter(F=>F.isSkipped&&!F.isExcluded).length,[_]),P=N.useMemo(()=>_.length?M>0?`${M} column${M===1?"":"s"} need attention. Apply the recommended scalers or override them manually below.`:O>0?"All configured columns align with the recommended scalers.":$>0?"All recommendations are currently skipped.":"Review the recommendations below.":"No scaling recommendations yetselect numeric columns to evaluate.",[M,O,_,$]),A=N.useMemo(()=>OF(m),[m]),R=N.useMemo(()=>TF(y,i.columnMethods,m,w),[y,i.columnMethods,m,w]);return{scalingConfig:i,scalingExcludedColumns:u,scalingMethodDetailMap:h,scalingMethodOptions:A,scalingRecommendations:p,scalingRecommendationRows:_,scalingSelectedCount:k,scalingOverrideCount:w,scalingDefaultDetail:b,scalingDefaultLabel:S,scalingAutoDetectEnabled:j,scalingHasRecommendations:E,scalingStatusMessage:P,scalingOverrideExampleSummary:R}},Gs=["iqr","zscore","elliptic_envelope","winsorize","manual"],cl={iqr:"IQR filter",zscore:"Z-score filter",elliptic_envelope:"Elliptic Envelope",winsorize:"Winsorize",manual:"Manual bounds"},om={iqr:["multiplier"],zscore:["threshold"],elliptic_envelope:["contamination"],winsorize:["lower_percentile","upper_percentile"],manual:["lower_bound","upper_bound"]},Va={iqr:{multiplier:1.5},zscore:{threshold:3},elliptic_envelope:{contamination:.01},winsorize:{lower_percentile:5,upper_percentile:95},manual:{}},im=(e,{min:t,max:n}={})=>{const s=typeof e=="number"?e:Number(e);if(!Number.isFinite(s))return null;let r=s;return typeof t=="number"&&Number.isFinite(t)&&r<t&&(r=t),typeof n=="number"&&Number.isFinite(n)&&r>n&&(r=n),r},Dj=e=>{const t=[];return Array.isArray(e)?e.forEach(n=>{const s=String(n??"").trim();s&&t.push(s)}):typeof e=="string"&&e.split(",").map(n=>n.trim()).forEach(n=>{n&&t.push(n)}),Array.from(new Set(t)).sort((n,s)=>n.localeCompare(s))},Y5=e=>{const t={iqr:{...Va.iqr},zscore:{...Va.zscore},elliptic_envelope:{...Va.elliptic_envelope},winsorize:{...Va.winsorize},manual:{}};return!e||typeof e!="object"||Array.isArray(e)||Object.entries(e).forEach(([n,s])=>{const r=n.trim().toLowerCase();if(!Gs.includes(r))return;const i=t[r]??{};if(!(!s||typeof s!="object"||Array.isArray(s))){if(Object.entries(s).forEach(([l,u])=>{const d=l.trim().toLowerCase();if(!om[r].includes(d))return;let f={};d==="threshold"?f={min:.1}:d==="multiplier"?f={min:.1}:(d==="lower_percentile"||d==="upper_percentile")&&(f={min:0,max:100});const p=im(u,f);p!==null&&(i[d]=p)}),r==="winsorize"){const l=im(i.lower_percentile,{min:0,max:100}),u=im(i.upper_percentile,{min:0,max:100});typeof l=="number"&&typeof u=="number"&&l>=u?(i.lower_percentile=Va.winsorize.lower_percentile,i.upper_percentile=Va.winsorize.upper_percentile):(typeof l=="number"&&(i.lower_percentile=l),typeof u=="number"&&(i.upper_percentile=u))}t[r]=i}}),t},K5=e=>{if(!e||typeof e!="object"||Array.isArray(e))return{};const t={};return Object.entries(e).forEach(([n,s])=>{const r=String(n??"").trim();if(!r||!s||typeof s!="object"||Array.isArray(s))return;const i={};Object.entries(s).forEach(([l,u])=>{const d=l.trim().toLowerCase();if(!Object.values(om).some(h=>h.includes(d)))return;let p={};d==="threshold"?p={min:.1}:d==="multiplier"?p={min:.1}:d==="contamination"?p={min:1e-4,max:.49}:(d==="lower_percentile"||d==="upper_percentile")&&(p={min:0,max:100});const m=im(u,p);m!==null&&(i[d]=m)}),Object.keys(i).length&&(t[r]=i)}),t},G5=e=>{const t=e&&typeof e=="object"&&!Array.isArray(e)?e:{},n=Dj(t.columns),s=typeof t.default_method=="string"?t.default_method.trim().toLowerCase():"",r=Gs.includes(s)?s:"iqr",i={};t.column_methods&&typeof t.column_methods=="object"&&!Array.isArray(t.column_methods)&&Object.entries(t.column_methods).forEach(([p,m])=>{const h=String(p??"").trim(),_=typeof m=="string"?m.trim().toLowerCase():"";h&&Gs.includes(_)&&(i[h]=_)});const l=typeof t.auto_detect=="boolean"?t.auto_detect:!0,u=Dj(t.skipped_columns),d=Y5(t.method_parameters),f=K5(t.column_parameters);return{columns:n,defaultMethod:r,columnMethods:i,autoDetect:l,skippedColumns:u,methodParameters:d,columnParameters:f}},X5=e=>{const t={...cl};return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null,r=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";s&&r&&Gs.includes(s)&&(t[s]=r)}),t},Q5=e=>{const t=new Map;return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null;s&&Gs.includes(s)&&t.set(s,n)}),t},Z5=e=>Gs.map(t=>({value:t,label:e[t]??cl[t]??t})),J5=({insights:e,outlierConfig:t,labelMap:n,selectedColumns:s,skippedColumns:r,excludedColumns:i})=>{if(!e.length)return[];const l=[];return e.forEach(u=>{const d=String((u==null?void 0:u.column)??"").trim();if(!d)return;const f={};Array.isArray(u==null?void 0:u.method_summaries)&&u.method_summaries.forEach(j=>{const b=j==null?void 0:j.method;b&&Gs.includes(b)&&(f[b]=j)});const p=u!=null&&u.recommended_method&&Gs.includes(u.recommended_method)?u.recommended_method:null,m=p?n[p]??cl[p]??p:null,h=t.columnMethods[d]??null,_=h??t.defaultMethod,x=n[_]??cl[_]??_,y=r.has(d),v=i.has(d),w=s.has(d),k=!!(u!=null&&u.has_missing);l.push({column:d,dtype:typeof(u==null?void 0:u.dtype)=="string"?u.dtype:null,stats:(u==null?void 0:u.stats)??{},recommendedMethod:p,recommendedLabel:m,recommendedReason:typeof(u==null?void 0:u.recommended_reason)=="string"?u.recommended_reason:null,methodSummaries:f,currentOverride:h,currentMethod:_,currentMethodLabel:x,isOverrideApplied:h!==null,isSelected:w,isSkipped:y,isExcluded:v,hasMissing:k})}),l.sort((u,d)=>u.column.localeCompare(d.column)),l},e4=(e,t,n,s)=>{if(!e.length)return null;const r=e.map(i=>{const l=t[i],u=l?n[l]??cl[l]??l:null;return u?`${i} -> ${u}`:i});return s>e.length&&r.push(""),r.join(", ")},t4=({catalogFlags:e,configState:t,numericExcludedColumns:n,outlierData:s})=>{const{isOutlierNode:r}=e,i=N.useMemo(()=>G5(t),[t]),l=N.useMemo(()=>Array.isArray(s==null?void 0:s.columns)?s.columns.filter(F=>!!(F&&F.column)):[],[s==null?void 0:s.columns]),u=N.useMemo(()=>new Set(i.skippedColumns),[i.skippedColumns]),d=N.useMemo(()=>r?new Set(i.columns):new Set,[r,i.columns]),f=N.useMemo(()=>{if(!r||!n.size)return new Set;const F=new Set;i.columns.forEach(I=>{const U=String(I??"").trim();U&&F.add(U)}),l.forEach(I=>{const U=String((I==null?void 0:I.column)??"").trim();U&&F.add(U)});const z=new Set;return n.forEach(I=>{F.has(I)||z.add(I)}),z},[r,n,i.columns,l]),p=N.useMemo(()=>new Set(Object.keys(i.columnMethods)),[i.columnMethods]),m=N.useMemo(()=>X5(s==null?void 0:s.methods),[s==null?void 0:s.methods]),h=N.useMemo(()=>Q5(s==null?void 0:s.methods),[s==null?void 0:s.methods]),_=N.useMemo(()=>J5({insights:l,outlierConfig:i,labelMap:m,selectedColumns:d,skippedColumns:u,excludedColumns:f}),[l,i,m,d,u,f]),x=N.useMemo(()=>Z5(m),[m]),y=N.useMemo(()=>Array.from(p).sort((F,z)=>F.localeCompare(z)),[p]),v=N.useMemo(()=>y.slice(0,4),[y]),w=d.size,k=p.size,j=N.useMemo(()=>Object.keys(i.columnParameters).length,[i.columnParameters]),b=i.autoDetect,S=N.useMemo(()=>h.get(i.defaultMethod)??null,[i.defaultMethod,h]),E=N.useMemo(()=>{const F=i.defaultMethod;return m[F]??cl[F]??F},[i.defaultMethod,m]),M=_.length>0,O=N.useMemo(()=>_.filter(F=>F.isSkipped||F.isExcluded||!F.isSelected||!F.recommendedMethod?!1:F.recommendedMethod!==F.currentMethod).length,[_]),$=N.useMemo(()=>_.filter(F=>F.isSelected&&!F.isSkipped&&!F.isExcluded).length,[_]),P=N.useMemo(()=>_.filter(F=>F.isSkipped&&!F.isExcluded).length,[_]),A=N.useMemo(()=>_.length?O>0?`${O} column${O===1?"":"s"} need attention. Apply the recommended strategies or adjust manually below.`:$>0?"All configured columns align with the recommended outlier handling strategies.":P>0?"All outlier recommendations are currently skipped.":"Review the outlier diagnostics below.":"No outlier recommendations yetselect numeric columns to evaluate.",[O,$,_,P]),R=N.useMemo(()=>e4(v,i.columnMethods,m,k),[v,i.columnMethods,m,k]);return{outlierConfig:i,outlierExcludedColumns:f,outlierMethodLabelMap:m,outlierMethodDetailMap:h,outlierMethodOptions:x,outlierRecommendations:l,outlierRecommendationRows:_,outlierSelectedCount:w,outlierOverrideCount:k,outlierParameterOverrideCount:j,outlierDefaultDetail:S,outlierDefaultLabel:E,outlierAutoDetectEnabled:b,outlierHasRecommendations:M,outlierStatusMessage:A,outlierOverrideExampleSummary:R}},n4=({configState:e,nodeId:t})=>{const n=N.useMemo(()=>Tw(e),[e]),s=n.columns.length,r=gp[n.strategy]??n.strategy,i=N.useMemo(()=>Object.keys(n.columnStrategies).map(x=>x.trim()).filter(Boolean).sort((x,y)=>x.localeCompare(y)),[n.columnStrategies]),l=i.length,u=N.useMemo(()=>{if(!i.length)return null;const x=i.slice(0,4);return nz(x,n.columnStrategies,l)},[n.columnStrategies,i,l]),d=N.useMemo(()=>`binning-${t||"node"}`,[t]),f=N.useMemo(()=>({equalWidth:`${d}-equal-width-bins`,equalFrequency:`${d}-equal-frequency-bins`,precision:`${d}-precision`,suffix:`${d}-suffix`,missingLabel:`${d}-missing-label`,includeLowest:`${d}-include-lowest`,dropOriginal:`${d}-drop-original`,labelFormat:`${d}-label-format`,duplicates:`${d}-duplicates`,kbinsNBins:`${d}-kbins-n-bins`,kbinsEncode:`${d}-kbins-encode`,kbinsStrategy:`${d}-kbins-strategy`}),[d]),[p,m]=N.useState({}),[h,_]=N.useState({});return N.useEffect(()=>{m(x=>{const y=new Set,v={...x};return n.columns.forEach(w=>{const k=String(w??"").trim();if(!k||(y.add(k),Object.prototype.hasOwnProperty.call(v,k)))return;const j=n.customBins[k]??[];v[k]=j.length>=2?j.join(", "):""}),Object.keys(v).forEach(w=>{y.has(w)||delete v[w]}),v})},[n.columns,n.customBins]),N.useEffect(()=>{_(x=>{const y=new Set,v={...x};return n.columns.forEach(w=>{const k=String(w??"").trim();if(!k||(y.add(k),Object.prototype.hasOwnProperty.call(v,k)))return;const j=n.customLabels[k]??[];v[k]=j.length>0?j.join(", "):""}),Object.keys(v).forEach(w=>{y.has(w)||delete v[w]}),v})},[n.columns,n.customLabels]),{binningConfig:n,binningSelectedCount:s,binningDefaultLabel:r,binningOverrideColumns:i,binningOverrideCount:l,binningOverrideSummary:u,fieldIds:f,customEdgeDrafts:p,setCustomEdgeDrafts:m,customLabelDrafts:h,setCustomLabelDrafts:_}},s4=({setConfigState:e,setBinningCustomEdgeDrafts:t,setBinningCustomLabelDrafts:n,binningConfig:s,binningInsightsRecommendations:r,binningAllNumericColumns:i})=>{const l=N.useCallback(($,P,A,R)=>{e(F=>{const z=typeof(F==null?void 0:F[$])=="number"&&Number.isFinite(F[$])?F[$]:void 0;if(P===""){if(z===void 0)return F;const q={...F};return delete q[$],q}const I=Number(P);if(!Number.isFinite(I))return F;const U=Math.min(Math.max(Math.round(I),A),R);return z===U?F:{...F,[$]:U}})},[e]),u=N.useCallback(($,P)=>{e(A=>!!(A!=null&&A[$])===P?A:{...A,[$]:P})},[e]),d=N.useCallback($=>{const P=$.trim();e(A=>{const R=typeof(A==null?void 0:A.output_suffix)=="string"?A.output_suffix:"";if(!P){if(!R)return A;const F={...A};return delete F.output_suffix,F}return R===P?A:{...A,output_suffix:P}})},[e]),f=N.useCallback($=>{e(P=>{const A=typeof(P==null?void 0:P.label_format)=="string"?P.label_format:"";return(["range","bin_index","ordinal","column_suffix"].includes(A)?A:"range")===$?P:{...P,label_format:$}})},[e]),p=N.useCallback($=>{e(P=>{if(((P==null?void 0:P.missing_strategy)==="label"?"label":"keep")===$)return P;const R={...P,missing_strategy:$};return $!=="label"&&Object.prototype.hasOwnProperty.call(R,"missing_label")&&delete R.missing_label,R})},[e]),m=N.useCallback($=>{const P=$.trim();e(A=>{const R=typeof(A==null?void 0:A.missing_label)=="string"?A.missing_label:"";if(!P){if(!R)return A;const F={...A};return delete F.missing_label,F}return R===P?A:{...A,missing_label:P}})},[e]),h=N.useCallback(($,P)=>{const A=String($??"").trim();A&&(t(R=>({...R,[A]:P})),e(R=>{const F=R==null?void 0:R.custom_bins,z=F&&typeof F=="object"&&!Array.isArray(F)?F:{},I=Array.isArray(z[A])?z[A]:void 0,q=P.split(/[,\n]/).map(D=>D.trim()).filter(Boolean).map(D=>Number(D)).filter(D=>Number.isFinite(D)).sort((D,V)=>D-V).filter((D,V,te)=>V===0||D!==te[V-1]),H=q.length>=2;if(H&&I&&I.length===q.length&&I.every((D,V)=>D===q[V])||!H&&!I)return R;const W={...R},B={...z};return H?B[A]=q:delete B[A],Object.keys(B).length>0?W.custom_bins=B:delete W.custom_bins,W}))},[t,e]),_=N.useCallback(($,P)=>{const A=String($??"").trim();A&&(n(R=>({...R,[A]:P})),e(R=>{const F=R==null?void 0:R.custom_labels,z=F&&typeof F=="object"&&!Array.isArray(F)?F:{},I=Array.isArray(z[A])?z[A]:void 0,U=P.split(/[,\n]/).map(W=>W.trim()).filter(Boolean);if(U.length>0&&I&&I.length===U.length&&I.every((W,B)=>W===U[B])||U.length===0&&!I)return R;const q={...R},H={...z};return U.length>0?H[A]=U:delete H[A],Object.keys(H).length>0?q.custom_labels=H:delete q.custom_labels,q}))},[n,e]),x=N.useCallback($=>{const P=String($??"").trim();P&&(t(A=>{if(!Object.prototype.hasOwnProperty.call(A,P))return A;const R={...A};return delete R[P],R}),n(A=>{if(!Object.prototype.hasOwnProperty.call(A,P))return A;const R={...A};return delete R[P],R}),e(A=>{let R=!1;const F={...A};if(A!=null&&A.custom_bins&&typeof A.custom_bins=="object"&&!Array.isArray(A.custom_bins)&&Object.prototype.hasOwnProperty.call(A.custom_bins,P)){const z={...A.custom_bins};delete z[P],Object.keys(z).length>0?F.custom_bins=z:delete F.custom_bins,R=!0}if(A!=null&&A.custom_labels&&typeof A.custom_labels=="object"&&!Array.isArray(A.custom_labels)&&Object.prototype.hasOwnProperty.call(A.custom_labels,P)){const z={...A.custom_labels};delete z[P],Object.keys(z).length>0?F.custom_labels=z:delete F.custom_labels,R=!0}return R?F:A}))},[t,n,e]),y=N.useCallback(($,P)=>{const A=String($??"").trim();A&&e(R=>{const z={...R!=null&&R.column_strategies&&typeof R.column_strategies=="object"&&!Array.isArray(R.column_strategies)?R.column_strategies:R!=null&&R.column_overrides&&typeof R.column_overrides=="object"&&!Array.isArray(R.column_overrides)?R.column_overrides:{}},I=z[A],U=I&&typeof I=="object"&&!Array.isArray(I)?{...I}:{},q=P(U),H=!!(q&&Object.keys(q).length);H?z[A]=q:delete z[A];const W={...R};if(H){const B=new Set(Ge(R==null?void 0:R.columns));B.has(A)||(B.add(A),W.columns=Array.from(B).sort((D,V)=>D.localeCompare(V)))}return Object.keys(z).length?(W.column_overrides=z,W.column_strategies=z):(Object.prototype.hasOwnProperty.call(W,"column_overrides")&&delete W.column_overrides,Object.prototype.hasOwnProperty.call(W,"column_strategies")&&delete W.column_strategies),W})},[e]),v=N.useCallback(($,P,A)=>{const R=String($??"").trim();if(!R)return;if(P==="__default__"){x(R),y(R,()=>null);return}const F=Number.isFinite(A==null?void 0:A.recommendedBins)?Math.round(A.recommendedBins):null;y(R,z=>{const I={...z};I.strategy=P;const U=q=>Math.min(200,Math.max(2,Math.round(F??q)));return P==="equal_width"?(I.equal_width_bins=U(s.equalWidthBins),delete I.equal_frequency_bins,delete I.kbins_n_bins,delete I.kbins_encode,delete I.kbins_strategy):P==="equal_frequency"?(I.equal_frequency_bins=U(s.equalFrequencyBins),delete I.equal_width_bins,delete I.kbins_n_bins,delete I.kbins_encode,delete I.kbins_strategy):P==="kbins"?(I.kbins_n_bins=U(s.kbinsNBins),I.kbins_encode=s.kbinsEncode,I.kbins_strategy=s.kbinsStrategy,delete I.equal_width_bins,delete I.equal_frequency_bins):P==="custom"&&(delete I.equal_width_bins,delete I.equal_frequency_bins,delete I.kbins_n_bins,delete I.kbins_encode,delete I.kbins_strategy),Object.keys(I).length?I:null}),P!=="custom"&&x(R)},[s.equalFrequencyBins,s.equalWidthBins,s.kbinsEncode,s.kbinsNBins,s.kbinsStrategy,x,y]),w=N.useCallback(($,P,A)=>{const R=String($??"").trim();R&&(y(R,F=>{const z={...F};if(!A.trim())delete z[P];else{const I=Number(A);if(!Number.isFinite(I))return F;const U=Math.min(200,Math.max(2,Math.round(I)));z[P]=U,P==="equal_width_bins"?(z.strategy="equal_width",delete z.equal_frequency_bins,delete z.kbins_n_bins,delete z.kbins_encode,delete z.kbins_strategy):P==="equal_frequency_bins"?(z.strategy="equal_frequency",delete z.equal_width_bins,delete z.kbins_n_bins,delete z.kbins_encode,delete z.kbins_strategy):P==="kbins_n_bins"&&(z.strategy="kbins",delete z.equal_width_bins,delete z.equal_frequency_bins)}return Object.keys(z).length?z:null}),x(R))},[x,y]),k=N.useCallback(($,P)=>{const A=String($??"").trim();A&&y(A,R=>{const F={...R};return P?(F.strategy="kbins",F.kbins_encode=P):delete F.kbins_encode,Object.keys(F).length?F:null})},[y]),j=N.useCallback(($,P)=>{const A=String($??"").trim();A&&y(A,R=>{const F={...R};return P?(F.strategy="kbins",F.kbins_strategy=P):delete F.kbins_strategy,Object.keys(F).length?F:null})},[y]),b=N.useCallback($=>{const P=String($??"").trim();P&&(x(P),y(P,()=>null))},[x,y]),S=N.useCallback(()=>{e($=>{if(!(($==null?void 0:$.column_strategies)&&typeof $.column_strategies=="object"&&!Array.isArray($.column_strategies)&&Object.keys($.column_strategies).length>0||($==null?void 0:$.column_overrides)&&typeof $.column_overrides=="object"&&!Array.isArray($.column_overrides)&&Object.keys($.column_overrides).length>0))return $;const A={...$};return Object.prototype.hasOwnProperty.call(A,"column_overrides")&&delete A.column_overrides,Object.prototype.hasOwnProperty.call(A,"column_strategies")&&delete A.column_strategies,A})},[e]),E=N.useCallback(()=>{r.length&&r.forEach($=>{const P=typeof($==null?void 0:$.column)=="string"?$.column.trim():"";if(!P)return;const A=$.recommended_strategy??"equal_width";v(P,A,{recommendedBins:Number.isFinite($==null?void 0:$.recommended_bins)?$.recommended_bins:null})})},[r,v]),M=N.useCallback($=>{if(!$)return;const P=[];for(const A of $){const R=typeof A=="string"?A.trim():"";R&&P.push(R)}P.length&&e(A=>{const R=A&&typeof A=="object"?A:{},F=new Set(Ge(R.columns));let z=!1;if(P.forEach(U=>{F.has(U)||(F.add(U),z=!0)}),!z)return A;const I={...R};return I.columns=Array.from(F).sort((U,q)=>U.localeCompare(q)),I})},[e]),O=N.useCallback(()=>{i.length&&M(i)},[i,M]);return{handleBinningIntegerChange:l,handleBinningBooleanToggle:u,handleBinningSuffixChange:d,handleBinningLabelFormatChange:f,handleBinningMissingStrategyChange:p,handleBinningMissingLabelChange:m,handleBinningCustomBinsChange:h,handleBinningCustomLabelsChange:_,handleBinningClearCustomColumn:x,updateBinningColumnOverride:y,handleBinningOverrideStrategyChange:v,handleBinningOverrideNumberChange:w,handleBinningOverrideKbinsEncodeChange:k,handleBinningOverrideKbinsStrategyChange:j,handleBinningClearOverride:b,handleBinningClearOverrides:S,handleBinningApplyStrategies:E,handleBinningApplyColumns:M,handleApplyAllBinningNumeric:O}},r4=({setConfigState:e,outlierRecommendationRows:t,outlierExcludedColumns:n,outlierConfig:s})=>{const r=N.useCallback(x=>{Gs.includes(x)&&e(y=>(y==null?void 0:y.default_method)===x?y:{...y,default_method:x})},[e]),i=N.useCallback(x=>{e(y=>(typeof(y==null?void 0:y.auto_detect)=="boolean"?y.auto_detect:!0)===x?y:{...y,auto_detect:x})},[e]),l=N.useCallback((x,y)=>{const v=String(x??"").trim();v&&e(w=>{if(!w||typeof w!="object")return w;const k=Ge(w.columns),j=new Set(k),b=w.column_methods&&typeof w.column_methods=="object"&&!Array.isArray(w.column_methods)?{...w.column_methods}:{};let S=!1;if(y){if(!Gs.includes(y))return w;b[v]!==y&&(b[v]=y,S=!0),j.has(v)||(j.add(v),S=!0)}else Object.prototype.hasOwnProperty.call(b,v)&&(delete b[v],S=!0);if(!S)return w;const E={...w};return E.columns=Array.from(j).sort((M,O)=>M.localeCompare(O)),Object.keys(b).length?E.column_methods=b:Object.prototype.hasOwnProperty.call(E,"column_methods")&&delete E.column_methods,E})},[e]),u=N.useCallback(()=>{e(x=>{if(!x||typeof x!="object")return x;const y=x.column_methods&&typeof x.column_methods=="object"&&!Array.isArray(x.column_methods)&&Object.keys(x.column_methods).length>0,v=x.column_parameters&&typeof x.column_parameters=="object"&&!Array.isArray(x.column_parameters)&&Object.keys(x.column_parameters).length>0;if(!y&&!v)return x;const w={...x};return y&&delete w.column_methods,v&&delete w.column_parameters,w})},[e]),d=N.useCallback(()=>{t.length&&e(x=>{if(!x||typeof x!="object")return x;const y=new Set(Ge(x.columns)),v=new Set(Ge(x.skipped_columns)),w=x.column_methods&&typeof x.column_methods=="object"&&!Array.isArray(x.column_methods)?{...x.column_methods}:{},k=x.column_parameters&&typeof x.column_parameters=="object"&&!Array.isArray(x.column_parameters)?{...x.column_parameters}:{};let j=!1;if(t.forEach(S=>{if(!S||S.isExcluded||!S.recommendedMethod)return;const E=String(S.column??"").trim();if(!E||n.has(E))return;const M=S.recommendedMethod;Gs.includes(M)&&(v.has(E)&&(v.delete(E),j=!0),y.has(E)||(y.add(E),j=!0),M===s.defaultMethod?Object.prototype.hasOwnProperty.call(w,E)&&(delete w[E],j=!0):w[E]!==M&&(w[E]=M,j=!0),Object.prototype.hasOwnProperty.call(k,E)&&(delete k[E],j=!0))}),!j)return x;const b={...x,columns:Array.from(y).sort((S,E)=>S.localeCompare(E))};return v.size?b.skipped_columns=Array.from(v).sort((S,E)=>S.localeCompare(E)):Object.prototype.hasOwnProperty.call(b,"skipped_columns")&&delete b.skipped_columns,Object.keys(w).length?b.column_methods=w:Object.prototype.hasOwnProperty.call(b,"column_methods")&&delete b.column_methods,Object.keys(k).length?b.column_parameters=k:Object.prototype.hasOwnProperty.call(b,"column_parameters")&&delete b.column_parameters,b})},[s.defaultMethod,n,t,e]),f=N.useCallback(x=>{const y=String(x??"").trim();y&&e(v=>{if(!v||typeof v!="object")return v;const w=Ge(v.columns),k=w.filter(R=>R!==y),j=new Set(Ge(v.skipped_columns)),b=j.size;j.add(y);const S=b!==j.size,E=v.column_methods&&typeof v.column_methods=="object"&&!Array.isArray(v.column_methods)?{...v.column_methods}:{},M=Object.prototype.hasOwnProperty.call(E,y);M&&delete E[y];const O=v.column_parameters&&typeof v.column_parameters=="object"&&!Array.isArray(v.column_parameters)?{...v.column_parameters}:{},$=Object.prototype.hasOwnProperty.call(O,y);if($&&delete O[y],!(k.length!==w.length)&&!S&&!M&&!$)return v;const A={...v,columns:k.sort((R,F)=>R.localeCompare(F)),skipped_columns:Array.from(j).sort((R,F)=>R.localeCompare(F))};return Object.keys(E).length?A.column_methods=E:Object.prototype.hasOwnProperty.call(A,"column_methods")&&delete A.column_methods,Object.keys(O).length?A.column_parameters=O:Object.prototype.hasOwnProperty.call(A,"column_parameters")&&delete A.column_parameters,A})},[e]),p=N.useCallback(x=>{const y=String(x??"").trim();y&&e(v=>{if(!v||typeof v!="object")return v;const w=Ge(v.skipped_columns);if(!w.includes(y))return v;const k=w.filter(S=>S!==y),j=new Set(Ge(v.columns));j.has(y)||j.add(y);const b={...v,columns:Array.from(j).sort((S,E)=>S.localeCompare(E))};return k.length?b.skipped_columns=k.sort((S,E)=>S.localeCompare(E)):Object.prototype.hasOwnProperty.call(b,"skipped_columns")&&delete b.skipped_columns,b})},[e]),m=N.useCallback((x,y)=>{if(y==="__skip__"){f(x);return}if(y==="__default__"){p(x),l(x,null);return}Gs.includes(y)&&(p(x),l(x,y))},[f,p,l]),h=N.useCallback((x,y,v)=>{const w=String(y??"").trim().toLowerCase();e(k=>{if(!k||typeof k!="object")return k;const j=k.method_parameters&&typeof k.method_parameters=="object"&&!Array.isArray(k.method_parameters)?{...k.method_parameters}:{},b={...j[x]??{}},S=typeof v=="number"&&Number.isFinite(v)?v:null;let E=!1;if(S===null?Object.prototype.hasOwnProperty.call(b,w)&&(delete b[w],E=!0):b[w]!==S&&(b[w]=S,E=!0),!E)return k;if(Object.keys(b).length?j[x]=b:delete j[x],!Object.keys(j).length){const M={...k};return Object.prototype.hasOwnProperty.call(M,"method_parameters")&&delete M.method_parameters,M}return{...k,method_parameters:j}})},[e]),_=N.useCallback((x,y,v)=>{const w=String(x??"").trim();if(!w)return;const k=String(y??"").trim().toLowerCase();e(j=>{if(!j||typeof j!="object")return j;const b=j.column_parameters&&typeof j.column_parameters=="object"&&!Array.isArray(j.column_parameters)?{...j.column_parameters}:{},S={...b[w]??{}},E=typeof v=="number"&&Number.isFinite(v)?v:null;let M=!1;if(E===null?Object.prototype.hasOwnProperty.call(S,k)&&(delete S[k],M=!0):S[k]!==E&&(S[k]=E,M=!0),!M)return j;if(Object.keys(S).length?b[w]=S:delete b[w],!Object.keys(b).length){const O={...j};return Object.prototype.hasOwnProperty.call(O,"column_parameters")&&delete O.column_parameters,O}return{...j,column_parameters:b}})},[e]);return{handleOutlierDefaultMethodChange:r,handleOutlierAutoDetectToggle:i,setOutlierColumnMethod:l,handleOutlierClearOverrides:u,handleOutlierApplyAllRecommendations:d,handleOutlierSkipColumn:f,handleOutlierUnskipColumn:p,handleOutlierOverrideSelect:m,handleOutlierMethodParameterChange:h,handleOutlierColumnParameterChange:_}},a4=({setConfigState:e,scalingRecommendations:t})=>{const n=N.useCallback(p=>{Ks.includes(p)&&e(m=>(m==null?void 0:m.default_method)===p?m:{...m,default_method:p})},[e]),s=N.useCallback(p=>{e(m=>(typeof(m==null?void 0:m.auto_detect)=="boolean"?m.auto_detect:!0)===p?m:{...m,auto_detect:p})},[e]),r=N.useCallback((p,m)=>{const h=String(p??"").trim();h&&e(_=>{const x=Ge(_.columns),y=x.includes(h),v=_.column_methods&&typeof _.column_methods=="object"&&!Array.isArray(_.column_methods)?{..._.column_methods}:{};if(m){if(!Ks.includes(m))return _;const j=(v[h]??null)!==m,b=!y;if(!j&&!b)return _;v[h]=m;const S=b?[...x,h].sort((E,M)=>E.localeCompare(M)):x;return{..._,columns:S,column_methods:v}}if(!Object.prototype.hasOwnProperty.call(v,h))return _;if(delete v[h],Object.keys(v).length)return{..._,column_methods:v};const w={..._};return Object.prototype.hasOwnProperty.call(w,"column_methods")&&delete w.column_methods,w})},[e]),i=N.useCallback(()=>{e(p=>{if(!p.column_methods||typeof p.column_methods!="object"||Array.isArray(p.column_methods)||!Object.keys(p.column_methods).length)return p;const m={...p};return delete m.column_methods,m})},[e]),l=N.useCallback(()=>{t.length&&e(p=>{const m=Ge(p.columns),h=new Set(m),_=new Set(Ge(p.skipped_columns)),x=p.column_methods&&typeof p.column_methods=="object"&&!Array.isArray(p.column_methods)?{...p.column_methods}:{};let y=!1;if(t.forEach(w=>{const k=String(w.column??"").trim(),j=w.recommended_method;!k||!Ks.includes(j)||_.has(k)||(x[k]!==j&&(x[k]=j,y=!0),h.has(k)||(h.add(k),y=!0))}),!y)return p;const v=Array.from(h).sort((w,k)=>w.localeCompare(k));return{...p,columns:v,column_methods:x}})},[t,e]),u=N.useCallback(p=>{const m=String(p??"").trim();m&&e(h=>{const _=Ge(h.columns),x=_.filter(b=>b!==m),y=new Set(Ge(h.skipped_columns)),v=y.size;y.add(m);const w=y.size!==v,k=h.column_methods&&typeof h.column_methods=="object"&&!Array.isArray(h.column_methods)?{...h.column_methods}:{},j=Object.prototype.hasOwnProperty.call(k,m);return j&&delete k[m],!w&&x.length===_.length&&!j?h:{...h,columns:x.sort((b,S)=>b.localeCompare(S)),column_methods:k,skipped_columns:Array.from(y).sort((b,S)=>b.localeCompare(S))}})},[e]),d=N.useCallback(p=>{const m=String(p??"").trim();m&&e(h=>{const _=Ge(h.skipped_columns);if(!_.includes(m))return h;const x=new Set(_);x.delete(m);const y=new Set(Ge(h.columns));return y.has(m)||y.add(m),{...h,columns:Array.from(y).sort((w,k)=>w.localeCompare(k)),skipped_columns:Array.from(x).sort((w,k)=>w.localeCompare(k))}})},[e]),f=N.useCallback((p,m)=>{if(m==="__skip__"){u(p);return}if(m==="__default__"){d(p),r(p,null);return}Ks.includes(m)&&(d(p),r(p,m))},[u,d,r]);return{handleScalingDefaultMethodChange:n,handleScalingAutoDetectToggle:s,setScalingColumnMethod:r,handleScalingClearOverrides:i,handleScalingApplyAllRecommendations:l,handleScalingSkipColumn:u,handleScalingUnskipColumn:d,handleScalingOverrideSelect:f}},o4=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const t=Number(e);if(Number.isFinite(t))return t}return null},i4=({catalogFlags:e,numericExcludedColumns:t,selectedColumns:n,previewSampleRows:s,availableColumns:r,recommendedColumns:i})=>{const{isBinningNode:l}=e,u=N.useMemo(()=>{if(!i)return null;const m=new Set;for(const h of i){const _=typeof h=="string"?h.trim():"";_&&m.add(_)}return m.size>0?m:null},[i]),d=N.useMemo(()=>{if(!Array.isArray(n)||!n.length)return null;const m=new Set;return n.forEach(h=>{const _=typeof h=="string"?h.trim():"";_&&m.add(_)}),m.size>0?m:null},[n]),f=N.useMemo(()=>{if(!l)return new Set;if(!t.size||!u&&!d)return t;const m=new Set;return t.forEach(h=>{u!=null&&u.has(h)||d!=null&&d.has(h)||m.add(h)}),m},[l,t,u,d]),p=N.useMemo(()=>{if(!l||!s.length)return{};const m={};return r.forEach(h=>{if(f.has(h))return;let _=null,x=null;const y=new Set;if(s.forEach(v=>{if(!v||!Object.prototype.hasOwnProperty.call(v,h))return;const w=o4(v[h]);w!==null&&((_===null||w<_)&&(_=w),(x===null||w>x)&&(x=w),y.size<=1e3&&y.add(w))}),_!==null||x!==null){const v=y.size>0?y.size:null;m[h]={min:_,max:x,distinct:v}}}),m},[r,f,l,s]);return{binningExcludedColumns:f,binningColumnPreviewMap:p,manualBoundColumns:[],manualRangeFallbackMap:{}}},l4=({catalogFlags:e,scalingExcludedColumns:t,binningExcludedColumns:n,outlierExcludedColumns:s,setConfigState:r})=>{const{isScalingNode:i,isBinningNode:l,isOutlierNode:u}=e;N.useEffect(()=>{!i||t.size===0||r(d=>{if(!d||typeof d!="object")return d;const f=Ge(d.columns);if(!f.length)return d;const p=f.filter(h=>!t.has(h));if(p.length===f.length||!p.length)return d;const m={...d,columns:p};if(d.column_methods&&typeof d.column_methods=="object"&&!Array.isArray(d.column_methods)){const h={};let _=!1;Object.entries(d.column_methods).forEach(([x,y])=>{const v=String(x??"").trim();if(!v)return;if(t.has(v)){_=!0;return}const w=typeof y=="string"?y.trim():null;w&&Ks.includes(w)&&(h[v]=w)}),_?Object.keys(h).length?m.column_methods=h:m.column_methods={}:m.column_methods=d.column_methods}return m})},[i,t,r]),N.useEffect(()=>{!l||n.size===0||r(d=>{if(!d||typeof d!="object")return d;const f=Ge(d.columns);if(!f.length)return d;const p=f.filter(_=>!n.has(_));if(p.length===f.length)return d;const m=new Set(f.filter(_=>n.has(_))),h={...d,columns:p};if(d.custom_bins&&typeof d.custom_bins=="object"&&!Array.isArray(d.custom_bins)){const _={};Object.entries(d.custom_bins).forEach(([x,y])=>{!m.has(x)&&Array.isArray(y)&&y.length&&(_[x]=[...y])}),Object.keys(_).length?h.custom_bins=_:Object.prototype.hasOwnProperty.call(h,"custom_bins")&&delete h.custom_bins}if(d.custom_labels&&typeof d.custom_labels=="object"&&!Array.isArray(d.custom_labels)){const _={};Object.entries(d.custom_labels).forEach(([x,y])=>{!m.has(x)&&Array.isArray(y)&&y.length&&(_[x]=y.map(v=>String(v)))}),Object.keys(_).length?h.custom_labels=_:Object.prototype.hasOwnProperty.call(h,"custom_labels")&&delete h.custom_labels}return h})},[n,l,r]),N.useEffect(()=>{!u||s.size===0||r(d=>{if(!d||typeof d!="object")return d;const f=Ge(d.columns),p=f.filter(j=>!s.has(j)),m=p.length!==f.length,h=Ge(d.skipped_columns),_=h.filter(j=>!s.has(j)),x=_.length!==h.length,y=j=>j??{...d};let v=null;m&&(v=y(v),v.columns=p.sort((j,b)=>j.localeCompare(b))),x&&(v=y(v),_.length?v.skipped_columns=_.sort((j,b)=>j.localeCompare(b)):Object.prototype.hasOwnProperty.call(v,"skipped_columns")&&delete v.skipped_columns);let w=!1;if(d.column_methods&&typeof d.column_methods=="object"&&!Array.isArray(d.column_methods)){const j={};Object.entries(d.column_methods).forEach(([b,S])=>{const E=String(b??"").trim();if(!E||s.has(E)){w=!0;return}const M=typeof S=="string"?S.trim():null;M&&Gs.includes(M)?j[E]=M:w=!0}),w&&(v=y(v),Object.keys(j).length?v.column_methods=j:Object.prototype.hasOwnProperty.call(v,"column_methods")&&delete v.column_methods)}let k=!1;if(d.column_parameters&&typeof d.column_parameters=="object"&&!Array.isArray(d.column_parameters)){const j={};Object.entries(d.column_parameters).forEach(([b,S])=>{const E=String(b??"").trim();if(!E||s.has(E)){k=!0;return}if(!S||typeof S!="object"||Array.isArray(S)){k=!0;return}j[E]={...S}}),k&&(v=y(v),Object.keys(j).length?v.column_parameters=j:Object.prototype.hasOwnProperty.call(v,"column_parameters")&&delete v.column_parameters)}return v||d})},[u,s,r])},c4=({catalogFlags:e,configState:t,setConfigState:n,nodeId:s,numericExcludedColumns:r,scalingData:i,outlierData:l,binningData:u,availableColumns:d,previewSampleRows:f})=>{const{isScalingNode:p,isOutlierNode:m,isBinningNode:h}=e,{scalingConfig:_,scalingExcludedColumns:x,scalingMethodDetailMap:y,scalingMethodOptions:v,scalingRecommendations:w,scalingRecommendationRows:k,scalingSelectedCount:j,scalingOverrideCount:b,scalingDefaultDetail:S,scalingDefaultLabel:E,scalingAutoDetectEnabled:M,scalingHasRecommendations:O,scalingStatusMessage:$,scalingOverrideExampleSummary:P}=W5({catalogFlags:e,configState:t,numericExcludedColumns:r,scalingData:i}),{outlierConfig:A,outlierExcludedColumns:R,outlierMethodLabelMap:F,outlierMethodDetailMap:z,outlierMethodOptions:I,outlierRecommendations:U,outlierRecommendationRows:q,outlierSelectedCount:H,outlierOverrideCount:W,outlierParameterOverrideCount:B,outlierDefaultDetail:D,outlierDefaultLabel:V,outlierAutoDetectEnabled:te,outlierHasRecommendations:G,outlierStatusMessage:K,outlierOverrideExampleSummary:X}=t4({catalogFlags:e,configState:t,numericExcludedColumns:r,outlierData:l}),Q=typeof(l==null?void 0:l.sample_size)=="number"?l.sample_size:null,J=null,Z=W>0||B>0,ee=N.useMemo(()=>W>0?X:B>0?`${B} column${B===1?"":"s"} with parameter overrides`:null,[W,B,X]),{binningConfig:de,binningSelectedCount:_e,binningDefaultLabel:ge,binningOverrideColumns:be,binningOverrideCount:ze,binningOverrideSummary:Ee,fieldIds:ie,customEdgeDrafts:pe,setCustomEdgeDrafts:Ce,customLabelDrafts:Te,setCustomLabelDrafts:De}=n4({configState:t,nodeId:s}),ce=N.useMemo(()=>p?_.columns:h?de.columns:m?A.columns:Ge(t==null?void 0:t.columns),[de.columns,t,h,m,p,A.columns,_.columns]),Oe=N.useMemo(()=>{const Ut=u==null?void 0:u.columns;return Array.isArray(Ut)?Ut.filter($e=>!$e||typeof $e.column!="string"?!1:!!$e.column.trim()):[]},[u==null?void 0:u.columns]),qe=N.useMemo(()=>{if(!Oe.length)return new Set;const Ut=new Set;return Oe.forEach($e=>{const Dt=typeof $e.column=="string"?$e.column.trim():"";Dt&&Ut.add(Dt)}),Ut},[Oe]),Qe=N.useMemo(()=>{if(!h)return[];const Ut=new Set;return d.forEach($e=>{if(r.has($e))return;const Dt=$e.trim();Dt&&Ut.add(Dt)}),Oe.forEach($e=>{const Dt=typeof $e.column=="string"?$e.column.trim():"";Dt&&(!r.has(Dt)||qe.has(Dt))&&Ut.add(Dt)}),ce.forEach($e=>{const Dt=typeof $e=="string"?$e.trim():"";Dt&&(!r.has(Dt)||qe.has(Dt))&&Ut.add(Dt)}),Array.from(Ut).sort(($e,Dt)=>$e.localeCompare(Dt))},[d,Oe,qe,h,r,ce]),Ye=N.useMemo(()=>!h||!Qe.length?[]:Qe.filter(Ut=>!ce.includes(Ut)),[Qe,h,ce]),at=Ye.length>0,{handleBinningIntegerChange:et,handleBinningBooleanToggle:ot,handleBinningSuffixChange:Nt,handleBinningLabelFormatChange:Tt,handleBinningMissingStrategyChange:tt,handleBinningMissingLabelChange:Ft,handleBinningCustomBinsChange:Wt,handleBinningCustomLabelsChange:Pt,handleBinningClearCustomColumn:bn,updateBinningColumnOverride:gn,handleBinningOverrideStrategyChange:jt,handleBinningOverrideNumberChange:cn,handleBinningOverrideKbinsEncodeChange:un,handleBinningOverrideKbinsStrategyChange:Lt,handleBinningClearOverride:ut,handleBinningClearOverrides:wn,handleBinningApplyStrategies:ht,handleBinningApplyColumns:Bt,handleApplyAllBinningNumeric:mt}=s4({setConfigState:n,setBinningCustomEdgeDrafts:Ce,setBinningCustomLabelDrafts:De,binningConfig:de,binningInsightsRecommendations:Oe,binningAllNumericColumns:Qe}),{handleOutlierDefaultMethodChange:Vn,handleOutlierAutoDetectToggle:_n,setOutlierColumnMethod:ls,handleOutlierClearOverrides:xt,handleOutlierApplyAllRecommendations:pt,handleOutlierSkipColumn:yn,handleOutlierUnskipColumn:ys,handleOutlierOverrideSelect:dn,handleOutlierMethodParameterChange:Xt,handleOutlierColumnParameterChange:tn}=r4({setConfigState:n,outlierRecommendationRows:q,outlierExcludedColumns:R,outlierConfig:A}),{handleScalingDefaultMethodChange:Nn,handleScalingAutoDetectToggle:Wn,setScalingColumnMethod:Yn,handleScalingClearOverrides:vt,handleScalingApplyAllRecommendations:Yt,handleScalingSkipColumn:Jn,handleScalingUnskipColumn:$n,handleScalingOverrideSelect:Xs}=a4({setConfigState:n,scalingRecommendations:w}),{binningExcludedColumns:vs,binningColumnPreviewMap:cs,manualBoundColumns:$s,manualRangeFallbackMap:Kt}=i4({catalogFlags:e,numericExcludedColumns:r,selectedColumns:ce,previewSampleRows:f,availableColumns:d,recommendedColumns:qe}),Ts=N.useMemo(()=>{const Ut=u==null?void 0:u.excluded_columns;return Array.isArray(Ut)?Ut.filter($e=>!$e||typeof $e.column!="string"?!1:!!$e.column.trim()):[]},[u==null?void 0:u.excluded_columns]);return l4({catalogFlags:e,scalingExcludedColumns:x,binningExcludedColumns:vs,outlierExcludedColumns:R,setConfigState:n}),{scaling:{config:_,state:{excludedColumns:x,methodDetailMap:y,methodOptions:v,recommendations:w,recommendationRows:k,selectedCount:j,overrideCount:b,defaultDetail:S,defaultLabel:E,autoDetectEnabled:M,hasRecommendations:O,statusMessage:$,overrideExampleSummary:P},handlers:{handleDefaultMethodChange:Nn,handleAutoDetectToggle:Wn,setColumnMethod:Yn,handleClearOverrides:vt,handleApplyAllRecommendations:Yt,handleSkipColumn:Jn,handleUnskipColumn:$n,handleOverrideSelect:Xs}},outlier:{config:A,state:{excludedColumns:R,methodLabelMap:F,methodDetailMap:z,methodOptions:I,recommendations:U,recommendationRows:q,selectedCount:H,overrideCount:W,parameterOverrideCount:B,defaultDetail:D,defaultLabel:V,autoDetectEnabled:te,hasRecommendations:G,statusMessage:K,overrideExampleSummary:X,sampleSize:Q,relativeGeneratedAt:J,hasOverrides:Z,overrideSummaryDisplay:ee},handlers:{handleDefaultMethodChange:Vn,handleAutoDetectToggle:_n,setColumnMethod:ls,handleClearOverrides:xt,handleApplyAllRecommendations:pt,handleSkipColumn:yn,handleUnskipColumn:ys,handleOverrideSelect:dn,handleMethodParameterChange:Xt,handleColumnParameterChange:tn}},binning:{config:de,state:{selectedCount:_e,defaultLabel:ge,overrideColumns:be,overrideCount:ze,overrideSummary:Ee,fieldIds:ie,customEdgeDrafts:pe,customLabelDrafts:Te,insightsRecommendations:Oe,recommendedColumnSet:qe,allNumericColumns:Qe,numericColumnsNotSelected:Ye,canApplyAllNumeric:at,excludedColumns:vs,columnPreviewMap:cs,manualBoundColumns:$s,manualRangeFallbackMap:Kt,insightsExcludedColumns:Ts},handlers:{setCustomEdgeDrafts:Ce,setCustomLabelDrafts:De,handleIntegerChange:et,handleBooleanToggle:ot,handleSuffixChange:Nt,handleLabelFormatChange:Tt,handleMissingStrategyChange:tt,handleMissingLabelChange:Ft,handleCustomBinsChange:Wt,handleCustomLabelsChange:Pt,handleClearCustomColumn:bn,updateColumnOverride:gn,handleOverrideStrategyChange:jt,handleOverrideNumberChange:cn,handleOverrideKbinsEncodeChange:un,handleOverrideKbinsStrategyChange:Lt,handleClearOverride:ut,handleClearOverrides:wn,handleApplyStrategies:ht,handleApplyColumns:Bt,handleApplyAllNumeric:mt}},selectedColumns:ce}},u4=e=>{var t;return!!((t=e==null?void 0:e.data)!=null&&t.isDataset||(e==null?void 0:e.id)==="dataset-source")},d4=new Set(["binned_distribution","data_preview","outlier_monitor","skewness_distribution","dataset_profile","transformer_audit"]),m4=new Set(["trim_whitespace","normalize_text_case","replace_aliases_typos","standardize_date_formats","remove_special_characters","replace_invalid_values","regex_replace_fix"]),Ij=e=>{var n;const t=((n=e==null?void 0:e.data)==null?void 0:n.catalogType)??"";return N.useMemo(()=>{const s=u4(e),r=t==="data_preview",i=t==="dataset_profile",l=t==="imputation_methods"||t==="advanced_imputer"||t==="simple_imputer",u=t==="missing_value_indicator",d=t==="replace_aliases_typos",f=t==="trim_whitespace",p=t==="remove_special_characters",m=t==="replace_invalid_values",h=t==="regex_replace_fix",_=t==="normalize_text_case",x=t==="standardize_date_formats",y=t==="label_encoding",v=t==="target_encoding",w=t==="hash_encoding",k=t==="train_model_draft",j=t==="model_evaluation",b=t==="model_registry_overview",S=t==="hyperparameter_tuning",E=t==="feature_target_split",M=t==="train_test_split",O=t==="class_undersampling",$=t==="class_oversampling",P=t==="ordinal_encoding",A=t==="dummy_encoding",R=t==="one_hot_encoding",F=t==="feature_math",z=t==="cast_column_types",I=t==="binning_discretization",U=t==="scale_numeric_features",q=t==="polynomial_features",H=t==="feature_selection",W=t==="transformer_audit",B=t==="outlier_removal",D=t==="skewness_transform",V=t==="skewness_distribution",te=t==="binned_distribution",G=m4.has(t),K=d4.has(t),X=t==="remove_duplicates",Q=t==="drop_missing_columns",J=t==="drop_missing_rows";return{catalogType:t,isDataset:s,isImputerNode:l,isMissingIndicatorNode:u,isReplaceAliasesNode:d,isTrimWhitespaceNode:f,isRemoveSpecialCharsNode:p,isReplaceInvalidValuesNode:m,isRegexCleanupNode:h,isNormalizeTextCaseNode:_,isStandardizeDatesNode:x,isLabelEncodingNode:y,isTargetEncodingNode:v,isHashEncodingNode:w,isTrainModelDraftNode:k,isModelEvaluationNode:j,isModelRegistryNode:b,isHyperparameterTuningNode:S,isFeatureTargetSplitNode:E,isTrainTestSplitNode:M,isClassUndersamplingNode:O,isClassOversamplingNode:$,isOrdinalEncodingNode:P,isDummyEncodingNode:A,isOneHotEncodingNode:R,isFeatureMathNode:F,isCastNode:z,isBinningNode:I,isScalingNode:U,isPolynomialFeaturesNode:q,isFeatureSelectionNode:H,isTransformerAuditNode:W,isOutlierNode:B,isSkewnessNode:D,isSkewnessDistributionNode:V,isBinnedDistributionNode:te,isDataConsistencyNode:G,isInspectionNode:K,isRemoveDuplicatesNode:X,isDropMissingColumnsNode:Q,isDropMissingRowsNode:J,isDropMissingNode:Q||J,isPreviewNode:r,isDatasetProfileNode:i}},[t,e])},f4=({node:e,nodeId:t,configState:n,setConfigState:s})=>{const{isRemoveDuplicatesNode:r}=Ij(e),i=`${t||"node"}-remove-duplicates-keep`,l=N.useMemo(()=>{if(!r)return Zb;const d=typeof(n==null?void 0:n.keep)=="string"?n.keep.trim().toLowerCase():"";return d==="last"||d==="none"?d:Zb},[n==null?void 0:n.keep,r]),u=N.useCallback(d=>{s(f=>({...f,keep:d}))},[s]);return{removeDuplicatesKeepSelectId:i,removeDuplicatesKeep:l,handleRemoveDuplicatesKeepChange:u}},h4=({catalogFlags:e,sourceId:t,nodeId:n,graphContext:s,hasReachableSource:r,columnTypeMap:i,setAvailableColumns:l,setColumnSearch:u,setColumnMissingMap:d,setColumnTypeMap:f,setColumnSuggestions:p,dropColumnParameter:m,node:h,configState:_,setConfigState:x,nodeChangeVersion:y,binnedSamplePreset:v,skewnessTransformations:w,availableColumns:k,columnMissingMap:j,previewSampleRows:b})=>{var H;const E=YF({hasDropColumnSource:!!m,sourceId:t,nodeId:n,graphContext:s,hasReachableSource:r,columnTypeMap:i,setAvailableColumns:l,setColumnSearch:u,setColumnMissingMap:d,setColumnTypeMap:f,setColumnSuggestions:p});KF({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(h==null?void 0:h.id)??null,setAvailableColumns:l,setColumnMissingMap:d});const M=x5({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,node:h,configState:_,setConfigState:x,nodeChangeVersion:y}),O=b5({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:n||null}),$=w5({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(h==null?void 0:h.id)??null}),P=N5({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(h==null?void 0:h.id)??null}),A=j5({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(h==null?void 0:h.id)??null,samplePreset:v}),R=C5({catalogFlags:e,sourceId:t,graphContext:s,targetNodeId:(h==null?void 0:h.id)??null,transformations:w}),F=A5({catalogFlags:e,configState:_,node:h,availableColumns:k,columnMissingMap:j}),z=B5({catalogFlags:e,configState:_,nodeConfig:((H=h==null?void 0:h.data)==null?void 0:H.config)??null,availableColumns:k,columnTypeMap:i,previewSampleRows:b}),I=V5({catalogFlags:e,availableColumns:k,columnTypeMap:i,previewSampleRows:b}),U=c4({catalogFlags:e,configState:_,setConfigState:x,nodeId:n,numericExcludedColumns:I.numericExcludedColumns,scalingData:$.scalingData,outlierData:O.outlierData,binningData:P.binningData,availableColumns:k,previewSampleRows:b}),q=f4({node:h,nodeId:n,configState:_,setConfigState:x});return{dropMissingColumns:E,encodingRecommendations:M,outlierRecommendations:O,scalingInsights:$,binningInsights:P,binnedDistribution:A,skewnessInsights:R,missingIndicatorState:F,dataCleaningState:z,numericColumnAnalysis:I,numericAnalysisState:U,removeDuplicatesState:q}},Uc={status:"idle",data:null,error:null},p4=1e3,g4=({shouldFetchPreview:e,sourceId:t,canTriggerPreview:n,graphSnapshot:s,catalogFlags:r,targetNodeId:i,previewSignature:l,skipPreview:u=!1,requestPreviewRows:d,includeSignals:f})=>{const{isPreviewNode:p}=r,[m,h]=N.useState(Uc),[_,x]=N.useState(0),y=N.useRef(null),v=N.useRef(-1),w=N.useCallback(()=>{x(k=>k+1)},[]);return N.useEffect(()=>{if(!e){h(Uc),y.current=null,v.current=-1;return}if(u)return;if(!t){h(p?{status:"error",data:null,error:"Select a dataset to generate previews."}:Uc);return}if(!n){h(p?{status:"error",data:null,error:"Add nodes to the canvas before generating a snapshot."}:Uc);return}if(!s)return;const k=(()=>{const P=Array.isArray(s.nodes)?s.nodes.map(R=>R&&typeof R.id=="string"?R.id:null).filter(R=>!!R).sort():[],A=Array.isArray(s.edges)?s.edges.map(R=>{const F=R&&typeof R.source=="string"?R.source.trim():"",z=R&&typeof R.target=="string"?R.target.trim():"";return F&&z?`${F}->${z}`:null}).filter(R=>!!R).sort():[];return JSON.stringify({sourceId:t??null,targetNodeId:i??null,nodeIds:P,edgePairs:A})})(),j=l??k,b=j!==y.current;if(!(v.current!==_)&&!b)return;y.current=j,v.current=_;let E=!0;h(P=>({status:"loading",data:P.data??null,error:null}));const M=d??p,O=f??M,$={dataset_source_id:t,graph:{nodes:s.nodes,edges:s.edges},target_node_id:i??void 0,include_preview_rows:M,include_signals:O};return M&&($.sample_size=p4),gw($).then(P=>{E&&h({status:"success",data:P,error:null})}).catch(P=>{E&&h(p?{status:"error",data:null,error:(P==null?void 0:P.message)??"Unable to generate preview."}:Uc)}),()=>{E=!1}},[n,s,p,u,l,_,e,t,i]),{previewState:m,refreshPreview:w}},_4=({graphSnapshot:e,graphNodeCount:t,hasReachableSource:n,sourceId:s,node:r,nodeId:i,previewSignature:l,skipPreview:u,catalogFlags:d,cachedPreviewSchema:f,setCachedPreviewSchema:p})=>{var $;const{isPreviewNode:m,isFeatureMathNode:h,isPolynomialFeaturesNode:_,isFeatureSelectionNode:x,isTrainTestSplitNode:y,isOutlierNode:v,isTransformerAuditNode:w,isCastNode:k}=d,j=N.useMemo(()=>!(!e||!t||!n),[t,e,n]),b=N.useMemo(()=>!e||!s||!n?!1:t>0,[t,e,n,s]),S=N.useMemo(()=>m||h||_||x||y||v||w,[h,x,v,_,m,y,w]),{previewState:E,refreshPreview:M}=g4({shouldFetchPreview:j,sourceId:s,canTriggerPreview:b,graphSnapshot:e,catalogFlags:d,targetNodeId:(r==null?void 0:r.id)??null,previewSignature:l,skipPreview:u,requestPreviewRows:m||k,includeSignals:S});N.useEffect(()=>{var A;const P=((A=E.data)==null?void 0:A.schema)??null;P&&p(R=>R!=null&&R.signature&&P.signature&&R.signature===P.signature?R:P)},[($=E.data)==null?void 0:$.schema]),N.useEffect(()=>{p(null)},[s]),N.useEffect(()=>{p(null)},[l]);const O=N.useCallback(()=>{p(null)},[]);return{previewState:E,refreshPreview:M,cachedPreviewSchema:f,clearCachedPreviewSchema:O,canTriggerPreview:b}},y4=({previewState:e,nodeId:t,catalogFlags:n})=>{var _,x,y,v,w,k,j,b,S,E;const{isFeatureMathNode:s,isPolynomialFeaturesNode:r,isFeatureSelectionNode:i,isOutlierNode:l,isTransformerAuditNode:u}=n,d=N.useMemo(()=>{var O,$;if(!s)return[];const M=($=(O=e.data)==null?void 0:O.signals)==null?void 0:$.feature_math;return Array.isArray(M)?M:[]},[s,(x=(_=e.data)==null?void 0:_.signals)==null?void 0:x.feature_math]),f=N.useMemo(()=>{var $,P;if(!r)return null;const M=(P=($=e.data)==null?void 0:$.signals)==null?void 0:P.polynomial_features;return!Array.isArray(M)||M.length===0?null:(t?M.find(A=>A&&typeof A.node_id=="string"&&A.node_id===t):null)??M[0]??null},[r,t,(v=(y=e.data)==null?void 0:y.signals)==null?void 0:v.polynomial_features]),p=N.useMemo(()=>{var $,P;if(!i)return null;const M=(P=($=e.data)==null?void 0:$.signals)==null?void 0:P.feature_selection;return!Array.isArray(M)||M.length===0?null:(t?M.find(A=>A&&typeof A.node_id=="string"&&A.node_id===t):null)??M[0]??null},[i,t,(k=(w=e.data)==null?void 0:w.signals)==null?void 0:k.feature_selection]),m=N.useMemo(()=>{var $,P;if(!l)return null;const M=(P=($=e.data)==null?void 0:$.signals)==null?void 0:P.outlier_removal;return!Array.isArray(M)||!M.length?null:t?M.find(A=>A&&A.node_id===t)??M[M.length-1]??null:M[M.length-1]??null},[l,t,(b=(j=e.data)==null?void 0:j.signals)==null?void 0:b.outlier_removal]),h=N.useMemo(()=>{var $,P;if(!u)return null;const M=(P=($=e.data)==null?void 0:$.signals)==null?void 0:P.transformer_audit;return!Array.isArray(M)||!M.length?null:t?M.find(A=>A&&A.node_id===t)??M[M.length-1]??null:M[M.length-1]??null},[u,t,(E=(S=e.data)==null?void 0:S.signals)==null?void 0:E.transformer_audit]);return{featureMathSignals:d,polynomialSignal:f,featureSelectionSignal:p,outlierPreviewSignal:m,transformerAuditSignal:h}},v4=({catalogFlags:e,featureSelectionSignal:t,upstreamTargetColumn:n,setConfigState:s})=>{const{isFeatureSelectionNode:r}=e;N.useEffect(()=>{if(!r)return;const i=typeof(t==null?void 0:t.target_column)=="string"?t.target_column.trim():"",l=typeof n=="string"?n.trim():"",u=i||l;u&&s(d=>(typeof(d==null?void 0:d.target_column)=="string"?d.target_column.trim():"")?d:{...d,target_column:u})},[t==null?void 0:t.target_column,r,s,n]),N.useEffect(()=>{if(!r)return;const i=typeof(t==null?void 0:t.k)=="number"&&Number.isFinite(t.k)?Math.max(0,Math.trunc(t.k)):null,l=Array.isArray(t==null?void 0:t.selected_columns)?t.selected_columns.length:null,u=i??l??null;u===null||u<=0||s(d=>{const f=d==null?void 0:d.k;let p=null;if(typeof f=="number"&&Number.isFinite(f))p=Math.trunc(f);else if(typeof f=="string"){const m=Number(f);Number.isFinite(m)&&(p=Math.trunc(m))}return p!==null&&p<=u?d:{...d,k:u}})},[t==null?void 0:t.k,t==null?void 0:t.selected_columns,r,s])},x4=(e,t,n)=>{const{isFeatureMathNode:s}=e,[r,i]=N.useState(()=>new Set),l=N.useMemo(()=>s?RN((t==null?void 0:t.operations)??[]):[],[t==null?void 0:t.operations,s]),u=N.useMemo(()=>s?hI(l,n):[],[l,n,s]);return N.useEffect(()=>{if(!s){i(()=>new Set);return}i(d=>{if(!d.size)return d;const f=new Set(l.map(m=>m.id)),p=new Set;return d.forEach(m=>{f.has(m)&&p.add(m)}),p.size===d.size?d:p})},[l,s]),{featureMathOperations:l,featureMathSummaries:u,collapsedFeatureMath:r,setCollapsedFeatureMath:i}},b4=e=>{var r,i,l;const t=N.useMemo(()=>{var d;const u=(d=e.data)==null?void 0:d.columns;return Array.isArray(u)?u.filter(f=>typeof f=="string"):[]},[(r=e.data)==null?void 0:r.columns]),n=N.useMemo(()=>{var d;const u=(d=e.data)==null?void 0:d.column_stats;return Array.isArray(u)?u:[]},[(i=e.data)==null?void 0:i.column_stats]),s=N.useMemo(()=>{var u;return Array.isArray((u=e.data)==null?void 0:u.sample_rows)?e.data.sample_rows:[]},[(l=e.data)==null?void 0:l.sample_rows]);return{previewColumns:t,previewColumnStats:n,previewSampleRows:s}},w4=({graphSnapshot:e,graphNodeCount:t,hasReachableSource:n,sourceId:s,node:r,nodeId:i,previewSignature:l,skipPreview:u,cachedPreviewSchema:d,setCachedPreviewSchema:f,catalogFlags:p,upstreamTargetColumn:m,setConfigState:h,configState:_})=>{const x=_4({graphSnapshot:e,graphNodeCount:t,hasReachableSource:n,sourceId:s,node:r,nodeId:i,previewSignature:l,skipPreview:u,cachedPreviewSchema:d,setCachedPreviewSchema:f,catalogFlags:p}),{previewState:y}=x,v=y4({previewState:y,nodeId:i,catalogFlags:p}),{featureSelectionSignal:w,featureMathSignals:k}=v;v4({catalogFlags:p,featureSelectionSignal:w,upstreamTargetColumn:m??"",setConfigState:h});const j=x4(p,_,k),b=b4(y);return{nodePreview:x,previewSignals:v,featureMathState:j,previewData:b}},N4=({sourceId:e,availableFilters:t,activeFilterId:n,setActiveFilterId:s,recommendations:r,filteredRecommendations:i,isFetchingRecommendations:l,recommendationsError:u,relativeGeneratedAt:d,formatSignalName:f,formatMissingPercentage:p,getPriorityClass:m,getPriorityLabel:h,handleToggleColumn:_,selectedColumns:x})=>{const y=v=>{if(!(v!=null&&v.name))return null;const w=String(v.name),k=x.includes(w),j=m(v.priority),b=h(v.priority),S=Array.isArray(v==null?void 0:v.signals)?v.signals.map(E=>f(E)).filter(E=>!!E):[];return a.jsxs("label",{className:"canvas-modal__checkbox-item",children:[a.jsx("input",{type:"checkbox",checked:k,onChange:()=>_(w)}),a.jsxs("div",{className:"canvas-modal__checkbox-content",children:[a.jsx("div",{className:"canvas-modal__recommendation-name",children:w}),a.jsxs("div",{className:"canvas-modal__recommendation-meta",children:[v.missing_percentage!==void 0&&v.missing_percentage!==null&&a.jsx("span",{children:`Missing: ${p(v.missing_percentage)}`}),j&&b&&a.jsx("span",{className:`canvas-modal__priority-badge canvas-modal__priority-badge--${j}`,children:b})]}),S.length>0&&a.jsx("div",{className:"canvas-modal__signal-badges",children:S.map(E=>a.jsx("span",{className:"canvas-modal__signal-badge",children:E},`${w}-${E}`))}),v.reason&&a.jsx("p",{className:"canvas-modal__recommendation-reason",children:v.reason})]})]},w)};return e?a.jsxs(a.Fragment,{children:[t.length>0&&a.jsxs("div",{className:"canvas-modal__filter-row",role:"group","aria-label":"Recommendation filters",children:[a.jsxs("button",{type:"button",className:`canvas-modal__filter-button${n?"":" canvas-modal__filter-button--active"}`,onClick:()=>s(null),children:["All reasons (",r.length,")"]}),t.map(v=>{const w=n===v.id;return a.jsxs("button",{type:"button",className:`canvas-modal__filter-button${w?" canvas-modal__filter-button--active":""}`,onClick:()=>s(k=>k===v.id?null:v.id),title:v.description??void 0,children:[v.label," (",v.count,")"]},v.id)})]}),l&&a.jsx("p",{className:"canvas-modal__note",children:"Loading column recommendations"}),!l&&u&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:u}),!l&&!u&&a.jsxs(a.Fragment,{children:[d&&a.jsxs("p",{className:"canvas-modal__note",children:["Recommendations generated ",d,"."]}),i.length?a.jsx("div",{className:"canvas-modal__checkbox-list",role:"group","aria-label":"Recommended columns",children:i.map(v=>y(v))}):a.jsx("p",{className:"canvas-modal__note",children:n?"No columns matched this filter in the latest quality scan.":"No columns crossed the missingness threshold in the latest quality scan."})]})]}):a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Choose a dataset to load EDA-backed column suggestions."})},j4=({parameter:e,previewStateStatus:t,isBinningNode:n,isScalingNode:s,binningAllNumericColumns:r,binningRecommendedColumnSet:i,selectedColumns:l,availableColumns:u,scalingExcludedColumns:d,normalizedColumnSearch:f,filteredColumnOptions:p,binningExcludedColumns:m,selectionCount:h,isCastNode:_,columnSuggestions:x,sourceId:y,isFetchingRecommendations:v,hasReachableSource:w,refreshRecommendations:k,availableFilters:j,activeFilterId:b,setActiveFilterId:S,recommendations:E,filteredRecommendations:M,recommendationsError:O,relativeGeneratedAt:$,formatSignalName:P,handleToggleColumn:A,handleRemoveColumn:R,handleApplyAllRecommended:F,handleBinningApplyColumns:z,handleSelectAllColumns:I,handleClearColumns:U,columnSearch:q,setColumnSearch:H,columnMissingMap:W,columnTypeMap:B,binningColumnPreviewMap:D,isImputerNode:V,showRecommendations:te})=>{var De;const G=((De=e==null?void 0:e.source)==null?void 0:De.type)==="drop_column_recommendations",K=!G,X=K&&t==="loading",Q=n&&e.name==="columns",J=s&&e.name==="columns",Z=(()=>{if(!Q)return[];const ce=[...r];return i.size>0&&i.forEach(Oe=>{ce.includes(Oe)||ce.push(Oe)}),l.forEach(Oe=>{Oe&&!ce.includes(Oe)&&ce.push(Oe)}),ce})(),ee=Q?Z:J?u.filter(ce=>!d.has(ce)):u,de=Q?f?Z.filter(ce=>ce.toLowerCase().includes(f)):Z:J?p.filter(ce=>!d.has(ce)):p,_e=Q?l.filter(ce=>!m.has(ce)).length:J?l.filter(ce=>!d.has(ce)).length:h,ge=K&&ee.length>0&&_e>=ee.length,be=G||V,ze=new Set(ee),Ee=_&&K?Object.entries(x).filter(([ce,Oe])=>ze.has(ce)&&Oe.length>0).map(([ce,Oe])=>`${ce}: ${Oe.join(", ")}`).slice(0,4):[],ie=Q?Array.from(m).slice(0,4):[],pe=J?Array.from(d).slice(0,4):[],Ce=Q&&i.size>0,Te=Ce?Array.from(i).some(ce=>!l.includes(ce)):!1;return a.jsxs("div",{className:"canvas-modal__parameter-field canvas-modal__parameter-field--multiselect",children:[a.jsxs("div",{className:"canvas-modal__parameter-label",children:[a.jsx("span",{children:e.label}),G&&y&&a.jsx("div",{className:"canvas-modal__parameter-actions",children:a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:k,disabled:v||!w,children:v?"Refreshing":"Refresh suggestions"})})]}),e.description&&a.jsx("p",{className:"canvas-modal__parameter-description",children:e.description}),Ee.length>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Smart suggestions: ",Ee.join("; ")]}),Q&&m.size>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipping ",m.size," non-numeric column",m.size===1?"":"s",ie.length?` (examples: ${ie.join(", ")}${m.size>ie.length?", ":""})`:""," binning only supports numeric inputs."]}),J&&d.size>0&&a.jsxs("p",{className:"canvas-modal__note",children:["Skipping ",d.size," non-numeric column",d.size===1?"":"s",pe.length?` (examples: ${pe.join(", ")}${d.size>pe.length?", ":""})`:""," scaling only supports numeric inputs."]}),G&&a.jsx(N4,{sourceId:y,availableFilters:j,activeFilterId:b,setActiveFilterId:S,recommendations:E,filteredRecommendations:M,isFetchingRecommendations:v,recommendationsError:O,relativeGeneratedAt:$,formatSignalName:P,formatMissingPercentage:Zn,getPriorityClass:HL,getPriorityLabel:qL,handleToggleColumn:A,selectedColumns:l}),a.jsxs("div",{className:"canvas-modal__note",children:["Selected columns: ",a.jsx("strong",{children:_e})]}),_e>0&&a.jsxs("div",{className:"canvas-modal__selection-summary",children:[a.jsx("h4",{children:"Selected columns"}),a.jsx("div",{className:"canvas-modal__selection-chips",children:l.map(ce=>a.jsxs("span",{className:"canvas-modal__selection-chip",children:[ce,a.jsx("button",{type:"button",onClick:()=>R(ce),"aria-label":`Remove ${ce}`,style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(qi,{size:12})})]},ce))})]}),a.jsxs("div",{className:"canvas-modal__multi-select-actions",children:[G&&a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:F,disabled:!E.length,children:"Use all recommendations"}),Ce&&a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>z(i),disabled:!Te,children:"Add recommended columns"}),K&&a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:I,disabled:!ee.length||ge,children:"Select all columns"}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:U,disabled:!h,children:"Clear selection"})]}),a.jsxs("div",{className:"canvas-modal__all-columns",children:[a.jsx("h4",{children:"All columns"}),a.jsx("div",{className:"canvas-modal__all-columns-search",children:a.jsx("input",{type:"text",className:"canvas-modal__custom-input",value:q,onChange:ce=>H(ce.target.value),placeholder:"Search columns","aria-label":"Search columns"})}),a.jsx("div",{className:"canvas-modal__all-columns-list",role:"group","aria-label":"All columns",children:de.length?de.map(ce=>{const Oe=l.includes(ce),qe=Object.prototype.hasOwnProperty.call(W,ce)?W[ce]:void 0,Qe=Zn(typeof qe=="number"?qe:null),Ye=B[ce]??null,at=x[ce]??[],et=Q?D[ce]:void 0,ot=!!(et&&(et.min!==null&&et.min!==void 0||et.max!==null&&et.max!==void 0)),Nt=Q?(et==null?void 0:et.distinct)??null:null,Tt=Q&&Nt!==null&&Number.isFinite(Nt),tt=Tt?Nt:null,Ft=!Q,Wt=Ft||be||ot||Tt,Pt=Ft&&at.length>0;return a.jsxs("label",{className:`canvas-modal__checkbox-item canvas-modal__checkbox-item--compact${Oe?" canvas-modal__checkbox-item--selected":""}`,children:[a.jsx("input",{type:"checkbox",checked:Oe,onChange:()=>A(ce)}),a.jsxs("div",{className:"canvas-modal__column-option",children:[a.jsx("span",{className:"canvas-modal__column-option-name",children:ce}),Wt&&a.jsxs("div",{className:"canvas-modal__column-option-meta",children:[Ft&&a.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Type: ",i3(Ye)]}),be&&a.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Missing: ",Qe]}),ot&&a.jsxs("span",{className:"canvas-modal__column-option-metric",children:[Q?"Sample range":"Range",":"," ",et&&et.min!==null&&et.min!==void 0?Ms(et.min):""," ",""," ",et&&et.max!==null&&et.max!==void 0?Ms(et.max):""]}),Tt&&tt!==null&&a.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Distinct sample values: ",Ws(tt)]})]}),Pt&&a.jsxs("span",{className:"canvas-modal__column-option-hint",children:["Suggested: ",at.join(", ")]})]})]},ce)}):a.jsx("p",{className:"canvas-modal__note",children:u.length?Q&&ee.length===0?"No eligible columns for binning (non-numeric fields are skipped).":"No columns match your search.":X?"Loading column catalog":y?w?"Column catalog unavailable for this dataset.":"Connect this step to an upstream output to load column catalog.":"Select a dataset to load column catalog."})})]})]},e.name)},C4=({parameter:e,nodeId:t,configState:n,handleNumberChange:s,handleBooleanChange:r,handleTextChange:i,thresholdParameterName:l,normalizedSuggestedThreshold:u,showRecommendations:d,canApplySuggestedThreshold:f,thresholdMatchesSuggestion:p,handleApplySuggestedThreshold:m,renderMultiSelect:h})=>{var y;if(!(e!=null&&e.name))return null;if(e.type==="multi_select")return a.jsx(a.Fragment,{children:h(e)});if(e.type==="number"){const v=`node-${t}-${e.name}`,w=n==null?void 0:n[e.name],k=typeof w=="number"?w:w??"";return a.jsxs("div",{className:"canvas-modal__parameter-field",children:[a.jsxs("label",{htmlFor:v,className:"canvas-modal__parameter-label",children:[a.jsx("span",{children:e.label}),e.unit&&a.jsx("span",{className:"canvas-modal__parameter-unit",children:e.unit})]}),e.description&&a.jsx("p",{className:"canvas-modal__parameter-description",children:e.description}),a.jsxs("div",{className:"canvas-modal__parameter-control",children:[a.jsx(tl,{id:v,value:k,min:e.min!==void 0?e.min:void 0,max:e.max!==void 0?e.max:void 0,step:e.step!==void 0?e.step:"any",onChange:j=>s(e.name,j.target.value)}),e.unit&&a.jsx("span",{className:"canvas-modal__parameter-unit",children:e.unit})]}),l===e.name&&u!==null&&d&&a.jsxs("div",{className:"canvas-modal__note",children:["Suggested threshold from EDA:"," ",a.jsx("strong",{children:Zn(u)}),a.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:m,disabled:!f,children:p?"Applied":"Apply suggestion"})]})]},e.name)}if(e.type==="boolean"){const v=`node-${t}-${e.name}`,w=!!(n!=null&&n[e.name]);return a.jsx(nl,{id:v,label:w?"Enabled":"Disabled",fieldLabel:e.label,description:e.description,checked:w,onChange:k=>r(e.name,k.target.checked)},e.name)}if(e.type==="select"){const v=`node-${t}-${e.name}`,w=Array.isArray(e.options)?e.options:[],k=n==null?void 0:n[e.name],j=typeof e.default=="string"?e.default:((y=w.find(S=>S&&typeof S.value=="string"))==null?void 0:y.value)??"",b=typeof k=="string"&&k.trim().length?k:j;return a.jsx(jr,{label:e.label,htmlFor:v,description:e.description,children:a.jsx(Ld,{id:v,value:b,onChange:S=>i(e.name,S.target.value),options:[],children:w.map(S=>a.jsx("option",{value:S.value,title:S.description??void 0,children:S.label??S.value},S.value))})},e.name)}if(e.type==="textarea"){const v=`node-${t}-${e.name}`;if(e.name==="hyperparameters"){let k="",j=n==null?void 0:n[e.name];if(typeof j=="string"&&j.trim())try{const b=JSON.parse(j);b&&typeof b=="object"&&!Array.isArray(b)?k=Object.entries(b).map(([S,E])=>`${S}: ${JSON.stringify(E)}`).join(`
`):k=j}catch{k=j}else j&&typeof j=="object"&&!Array.isArray(j)&&(k=Object.entries(j).map(([b,S])=>`${b}: ${JSON.stringify(S)}`).join(`
`));return a.jsx(jr,{label:e.label,htmlFor:v,description:e.description||"Enter parameters as key: value pairs (one per line)",children:a.jsx(Ow,{id:v,className:"canvas-modal__input--wide",value:k,placeholder:`n_estimators: 100
max_depth: 10
learning_rate: 0.01`,onChange:b=>{const E=b.target.value.split(`
`).filter(O=>O.trim()),M={};for(const O of E){const $=O.indexOf(":");if($===-1)continue;const P=O.substring(0,$).trim(),A=O.substring($+1).trim();if(P)try{M[P]=JSON.parse(A)}catch{M[P]=A}}i(e.name,JSON.stringify(M,null,2))},rows:6})},e.name)}const w=typeof(n==null?void 0:n[e.name])=="string"?n==null?void 0:n[e.name]:"";return a.jsx(jr,{label:e.label,htmlFor:v,description:e.description,children:a.jsx(Ow,{id:v,className:"canvas-modal__input--wide",value:w,placeholder:e.placeholder??"",onChange:k=>i(e.name,k.target.value),rows:4})},e.name)}const _=`node-${t}-${e.name}`,x=(n==null?void 0:n[e.name])??"";return a.jsx(jr,{label:e.label,htmlFor:_,description:e.description,children:a.jsx(pp,{id:_,className:"canvas-modal__input--wide",value:x,placeholder:e.placeholder??"",onChange:v=>i(e.name,v.target.value)})},e.name)},S4=({nodeId:e,catalogFlags:t,configState:n,previewState:s,binning:r,scaling:i,selectedColumns:l,availableColumns:u,filteredColumnOptions:d,normalizedColumnSearch:f,columnSearch:p,setColumnSearch:m,columnSuggestions:h,columnMissingMap:_,columnTypeMap:x,sourceId:y,hasReachableSource:v,recommendationsState:w,columnSelectionHandlers:k,parameterHandlers:j,thresholdRecommendations:b,numericExcludedColumns:S,selectionCount:E})=>{const{isBinningNode:M,isScalingNode:O,isCastNode:$,isImputerNode:P}=t,A=N.useCallback(F=>a.jsx(j4,{parameter:F,previewStateStatus:s.status,isBinningNode:M,isScalingNode:O,binningAllNumericColumns:r.state.allNumericColumns,binningRecommendedColumnSet:r.state.recommendedColumnSet,selectedColumns:l,availableColumns:u,scalingExcludedColumns:i.state.excludedColumns,normalizedColumnSearch:f,filteredColumnOptions:d,binningExcludedColumns:r.state.excludedColumns,selectionCount:E,isCastNode:$,columnSuggestions:h,sourceId:y,isFetchingRecommendations:w.isFetching,hasReachableSource:v,refreshRecommendations:w.refresh,availableFilters:w.availableFilters,activeFilterId:w.activeFilterId,setActiveFilterId:w.setActiveFilterId,recommendations:w.recommendations,filteredRecommendations:w.filteredRecommendations,recommendationsError:w.error,relativeGeneratedAt:w.relativeGeneratedAt,formatSignalName:w.formatSignalName,handleToggleColumn:k.handleToggleColumn,handleRemoveColumn:k.handleRemoveColumn,handleApplyAllRecommended:k.handleApplyAllRecommended,handleBinningApplyColumns:r.handlers.handleApplyColumns,handleSelectAllColumns:k.handleSelectAllColumns,handleClearColumns:k.handleClearColumns,columnSearch:p,setColumnSearch:m,columnMissingMap:_,columnTypeMap:x,binningColumnPreviewMap:r.state.columnPreviewMap,isImputerNode:P,showRecommendations:w.show}),[w.activeFilterId,u,w.availableFilters,_,p,h,x,r.state.allNumericColumns,S,d,w.filteredRecommendations,w.formatSignalName,k.handleApplyAllRecommended,r.handlers.handleApplyColumns,k.handleClearColumns,k.handleRemoveColumn,k.handleSelectAllColumns,k.handleToggleColumn,v,$,w.isFetching,M,r.state.recommendedColumnSet,r.state.columnPreviewMap,P,O,r.state.excludedColumns,s.status,w.recommendations,w.error,w.relativeGeneratedAt,l,E,w.setActiveFilterId,m,i.state.excludedColumns,w.show,y,w.refresh,f]),R=N.useCallback(F=>a.jsx(C4,{parameter:F,nodeId:e,configState:n,handleNumberChange:j.handleNumberChange,handleBooleanChange:j.handleBooleanChange,handleTextChange:j.handleTextChange,thresholdParameterName:b.thresholdParameterName,normalizedSuggestedThreshold:b.normalizedSuggestedThreshold,showRecommendations:w.show,canApplySuggestedThreshold:b.canApplySuggestedThreshold,thresholdMatchesSuggestion:b.thresholdMatchesSuggestion,handleApplySuggestedThreshold:b.handleApplySuggestedThreshold,renderMultiSelect:A}),[b.canApplySuggestedThreshold,n,b.handleApplySuggestedThreshold,j.handleBooleanChange,j.handleNumberChange,j.handleTextChange,e,b.normalizedSuggestedThreshold,A,w.show,b.thresholdMatchesSuggestion,b.thresholdParameterName]);return{renderMultiSelectField:A,renderParameterField:R}},E4=(e,t)=>{const n=N.useMemo(()=>{var p,m,h,_,x,y;const r=[],i=((p=e==null?void 0:e.data)==null?void 0:p.label)||(t==null?void 0:t.label);i&&r.push({label:"Label",value:String(i)});const l=((m=e==null?void 0:e.data)==null?void 0:m.description)||(t==null?void 0:t.description);l&&r.push({label:"Description",value:String(l)});const u=((h=e==null?void 0:e.data)==null?void 0:h.category)||(t==null?void 0:t.category);u&&r.push({label:"Category",value:String(u)}),(_=e==null?void 0:e.data)!=null&&_.catalogType&&r.push({label:"Node type",value:String(e.data.catalogType)});const d=((x=e==null?void 0:e.data)==null?void 0:x.inputs)||(t==null?void 0:t.inputs);d&&Array.isArray(d)&&d.length&&r.push({label:"Inputs",value:d.join(", ")});const f=((y=e==null?void 0:e.data)==null?void 0:y.outputs)||(t==null?void 0:t.outputs);return f&&Array.isArray(f)&&f.length&&r.push({label:"Outputs",value:f.join(", ")}),r},[e,t]),s=N.useMemo(()=>{var i;const r=((i=e==null?void 0:e.data)==null?void 0:i.label)??(t==null?void 0:t.label)??(e==null?void 0:e.id);return typeof r=="string"&&r.trim()?r:`Node ${(e==null?void 0:e.id)??""}`},[e,t]);return{metadata:n,title:s}},Fj=(e,t)=>{if(!t||typeof t!="string")return null;const n=`${e}-`;if(t.startsWith(n))return t.slice(n.length);const s=t.split("-");return s.length>=2?s.slice(-2).join("-"):t},k4=(e,t)=>{var _;const n=typeof(e==null?void 0:e.id)=="string"?e.id:"",s=N.useMemo(()=>{var v;const x=(v=e==null?void 0:e.data)==null?void 0:v.connectionInfo;if(!x)return null;const y=w=>Array.isArray(w)?w.map(k=>({...k})):[];return{inputs:y(x.inputs),outputs:y(x.outputs)}},[e]),r=N.useMemo(()=>{if(!n||!t||!Array.isArray(t.edges))return new Set;const x=t.edges.filter(y=>(y==null?void 0:y.target)===n).map(y=>Fj(n,y==null?void 0:y.targetHandle)).filter(y=>!!y);return new Set(x)},[t,n]),i=N.useMemo(()=>{if(!n||!t||!Array.isArray(t.edges))return new Set;const x=t.edges.filter(y=>(y==null?void 0:y.source)===n).map(y=>Fj(n,y==null?void 0:y.sourceHandle)).filter(y=>!!y);return new Set(x)},[t,n]),l=((_=e==null?void 0:e.data)==null?void 0:_.hasRequiredConnections)!==!1,u=N.useMemo(()=>{var x;return(x=s==null?void 0:s.inputs)!=null&&x.length?s.inputs.filter(y=>y.required!==!1):[]},[s==null?void 0:s.inputs]),d=N.useMemo(()=>u.length?u.filter(x=>!r.has(x.key)):[],[r,u]),f=l&&d.length===0,p=N.useMemo(()=>{if(!f)return{opacity:.45,pointerEvents:"none",userSelect:"none"}},[f]),m=f?void 0:!0,h=N.useMemo(()=>{if(!(s!=null&&s.inputs)||s.inputs.length===0)return;let x=!1;const y={};return s.inputs.forEach(v=>{if(!Array.isArray(v.accepts)||v.accepts.length===0)return;const w=r.has(v.key);v.accepts.forEach(k=>{(k==="train"||k==="validation"||k==="test")&&(y[k]=w,x=!0)})}),x?y:void 0},[s==null?void 0:s.inputs,r]);return{connectionInfo:s,connectedHandleKeys:r,connectedOutputHandleKeys:i,evaluationSplitConnectivity:h,connectionReady:f,gatedSectionStyle:p,gatedAriaDisabled:m}},M4=e=>N.useMemo(()=>{const t=new Map;return e.forEach(n=>{n!=null&&n.name&&t.set(n.name,n)}),n=>t.get(n)??null},[e]),A4=(e,t)=>{const n=N.useMemo(()=>{var f;const u=(f=e==null?void 0:e.data)==null?void 0:f.parameters;let d=[];return Array.isArray(u)&&u.length>0?d=u:t!=null&&t.parameters&&(d=t.parameters),d.filter(p=>!!(p!=null&&p.name)).map(p=>({...p}))},[e,t]),s=M4(n),r=N.useCallback((u,d)=>u?s(d):null,[s]),i=N.useMemo(()=>n.some(u=>{var d;return(u==null?void 0:u.type)==="multi_select"&&((d=u==null?void 0:u.source)==null?void 0:d.type)!=="drop_column_recommendations"}),[n]),l=N.useMemo(()=>n.find(u=>{var d;return((d=u==null?void 0:u.source)==null?void 0:d.type)==="drop_column_recommendations"})??null,[n]);return{parameters:n,getParameter:s,getParameterIf:r,requiresColumnCatalog:i,dropColumnParameter:l}},O4=({isResetAvailable:e=!1,defaultConfigTemplate:t,catalogFlags:n})=>{const{isDataset:s,isScalingNode:r,isBinningNode:i,isBinnedDistributionNode:l,isSkewnessDistributionNode:u,isFeatureMathNode:d,isFeatureTargetSplitNode:f,isTrainTestSplitNode:p,isModelEvaluationNode:m,isHashEncodingNode:h,isPolynomialFeaturesNode:_,isFeatureSelectionNode:x,isDataConsistencyNode:y,isTrainModelDraftNode:v,isHyperparameterTuningNode:w,isClassUndersamplingNode:k,isClassOversamplingNode:j,isLabelEncodingNode:b,isTargetEncodingNode:S,isDummyEncodingNode:E,isOneHotEncodingNode:M,isOrdinalEncodingNode:O,isImputerNode:$,isMissingIndicatorNode:P,isReplaceAliasesNode:A,isTrimWhitespaceNode:R,isRemoveSpecialCharsNode:F,isReplaceInvalidValuesNode:z,isRegexCleanupNode:I,isNormalizeTextCaseNode:U,isStandardizeDatesNode:q,isCastNode:H,isRemoveDuplicatesNode:W,isDropMissingNode:B,isOutlierNode:D}=n,V=N.useMemo(()=>!!(e&&!s&&t),[t,s,e]),K=[d,f,p,m,h,_,x,y,v,w,k||j,b,S,E,M,O,$,P,A,R,F,z,I,U,q,H,W,B,D].some(Boolean),X=l||u;return{canResetNode:V,headerCanResetNode:V&&!(X||r||i||K),footerCanResetNode:V&&!X}},$4=({node:e})=>{var m;const t=typeof(e==null?void 0:e.id)=="string"?e.id:void 0,n=N.useMemo(()=>{var _;const h=Yd(((_=e==null?void 0:e.data)==null?void 0:_.config)??{});return!h||typeof h!="object"||Array.isArray(h)?{}:((!h.column_overrides||typeof h.column_overrides!="object"||Array.isArray(h.column_overrides))&&(h.column_overrides={}),h)},[e==null?void 0:e.id,(m=e==null?void 0:e.data)==null?void 0:m.config]),[s,r]=N.useState(n),[i,l]=N.useState(0),u=N.useRef(t);N.useEffect(()=>{u.current!==t&&(u.current=t,r(n),l(h=>h+1))},[t]);const d=N.useMemo(()=>Lc(n),[n]),f=N.useMemo(()=>Lc(s),[s]),p=N.useCallback(()=>{r(n)},[n]);return{initialConfig:n,configState:s,setConfigState:r,stableInitialConfig:d,stableCurrentConfig:f,nodeChangeVersion:i,resetToInitialConfig:p}},T4=({setConfigState:e})=>{const t=N.useCallback((l,u)=>{l&&e(d=>{const f={...d};return u===void 0?delete f[l]:f[l]=u,f})},[e]),n=N.useCallback((l,u)=>{if(!l)return;if(u===""){t(l,void 0);return}const d=Number(u);Number.isNaN(d)||t(l,d)},[t]),s=N.useCallback((l,u)=>{if(!l)return;if(u===""){t(l,void 0);return}const d=Number(u);if(!Number.isFinite(d))return;const f=Math.min(Math.max(d,0),100);t(l,f)},[t]),r=N.useCallback((l,u)=>{t(l,u)},[t]),i=N.useCallback((l,u)=>{t(l,u)},[t]);return{handleParameterChange:t,handleNumberChange:n,handlePercentileChange:s,handleBooleanChange:r,handleTextChange:i}},P4=(e,t)=>{const n=(s,r)=>s?e(r):null;return N.useMemo(()=>{const{isBinningNode:s,isScalingNode:r,isRemoveDuplicatesNode:i,isReplaceAliasesNode:l,isTrimWhitespaceNode:u,isRemoveSpecialCharsNode:d,isReplaceInvalidValuesNode:f,isRegexCleanupNode:p,isNormalizeTextCaseNode:m,isLabelEncodingNode:h,isHashEncodingNode:_,isPolynomialFeaturesNode:x,isFeatureSelectionNode:y,isFeatureMathNode:v,isClassUndersamplingNode:w,isClassOversamplingNode:k,isFeatureTargetSplitNode:j,isTrainModelDraftNode:b,isHyperparameterTuningNode:S,isTargetEncodingNode:E,isOrdinalEncodingNode:M,isDummyEncodingNode:O,isOneHotEncodingNode:$,isMissingIndicatorNode:P,isDropMissingRowsNode:A,isDropMissingColumnsNode:R}=t,F=w||k,z=b||S;return{binning:{columns:n(s,"columns")},scaling:{columns:n(r,"columns"),defaultMethod:n(r,"default_method"),autoDetect:n(r,"auto_detect")},removeDuplicates:{columns:n(i,"columns"),keep:n(i,"keep")},replaceAliases:{customPairs:n(l,"custom_pairs")},trimWhitespace:{columns:n(u,"columns"),mode:n(u,"mode")},removeSpecial:{columns:n(d,"columns"),mode:n(d,"mode"),replacement:n(d,"replacement")},replaceInvalid:{columns:n(f,"columns"),mode:n(f,"mode"),minValue:n(f,"min_value"),maxValue:n(f,"max_value")},regexCleanup:{columns:n(p,"columns"),mode:n(p,"mode"),pattern:n(p,"pattern"),replacement:n(p,"replacement")},normalizeCase:{columns:n(m,"columns"),mode:n(m,"mode")},labelEncoding:{columns:h?e("columns"):null,autoDetect:h?e("auto_detect"):null,maxUnique:h?e("max_unique_values"):null,outputSuffix:h?e("output_suffix"):null,dropOriginal:h?e("drop_original"):null,missingStrategy:h?e("missing_strategy"):null,missingCode:h?e("missing_code"):null},hashEncoding:{columns:_?e("columns"):null,autoDetect:_?e("auto_detect"):null,maxCategories:_?e("max_categories"):null,buckets:_?e("n_buckets"):null,outputSuffix:_?e("output_suffix"):null,dropOriginal:_?e("drop_original"):null,encodeMissing:_?e("encode_missing"):null},polynomial:{columns:n(x,"columns"),autoDetect:n(x,"auto_detect"),degree:n(x,"degree"),includeBias:n(x,"include_bias"),interactionOnly:n(x,"interaction_only"),includeInputFeatures:n(x,"include_input_features"),outputPrefix:n(x,"output_prefix")},featureSelection:{columns:n(y,"columns"),autoDetect:n(y,"auto_detect"),targetColumn:n(y,"target_column"),method:n(y,"method"),scoreFunc:n(y,"score_func"),problemType:n(y,"problem_type"),k:n(y,"k"),percentile:n(y,"percentile"),alpha:n(y,"alpha"),threshold:n(y,"threshold"),mode:n(y,"mode"),estimator:n(y,"estimator"),step:n(y,"step"),minFeatures:n(y,"min_features"),maxFeatures:n(y,"max_features"),dropUnselected:n(y,"drop_unselected")},featureMath:{errorHandling:n(v,"error_handling"),allowOverwrite:n(v,"allow_overwrite"),defaultTimezone:n(v,"default_timezone"),epsilon:n(v,"epsilon")},resampling:{method:n(F,"method"),targetColumn:n(F,"target_column"),samplingStrategy:n(F,"sampling_strategy"),randomState:n(F,"random_state"),kNeighbors:n(k,"k_neighbors"),replacement:n(w,"replacement")},featureTargetSplit:{targetColumn:n(j,"target_column")},trainModel:{targetColumn:n(z,"target_column"),problemType:n(z,"problem_type"),modelType:n(z,"model_type"),hyperparameters:n(b,"hyperparameters"),cvEnabled:n(z,"cv_enabled"),cvStrategy:n(z,"cv_strategy"),cvFolds:n(z,"cv_folds"),cvShuffle:n(z,"cv_shuffle"),cvRandomState:n(z,"cv_random_state"),cvRefitStrategy:n(b,"cv_refit_strategy")},hyperparameterTuning:{searchStrategy:n(S,"search_strategy"),searchIterations:n(S,"search_iterations"),searchRandomState:n(S,"search_random_state"),scoringMetric:n(S,"scoring_metric")},targetEncoding:{columns:E?e("columns"):null,targetColumn:E?e("target_column"):null,autoDetect:E?e("auto_detect"):null,maxCategories:E?e("max_categories"):null,outputSuffix:E?e("output_suffix"):null,dropOriginal:E?e("drop_original"):null,smoothing:E?e("smoothing"):null,encodeMissing:E?e("encode_missing"):null,handleUnknown:E?e("handle_unknown"):null},ordinalEncoding:{columns:M?e("columns"):null,autoDetect:M?e("auto_detect"):null,maxCategories:M?e("max_categories"):null,outputSuffix:M?e("output_suffix"):null,dropOriginal:M?e("drop_original"):null,encodeMissing:M?e("encode_missing"):null,handleUnknown:M?e("handle_unknown"):null,unknownValue:M?e("unknown_value"):null},dummyEncoding:{columns:O?e("columns"):null,autoDetect:O?e("auto_detect"):null,maxCategories:O?e("max_categories"):null,dropFirst:O?e("drop_first"):null,includeMissing:O?e("include_missing"):null,dropOriginal:O?e("drop_original"):null,prefixSeparator:O?e("prefix_separator"):null},oneHotEncoding:{columns:$?e("columns"):null,autoDetect:$?e("auto_detect"):null,maxCategories:$?e("max_categories"):null,dropFirst:$?e("drop_first"):null,includeMissing:$?e("include_missing"):null,dropOriginal:$?e("drop_original"):null,prefixSeparator:$?e("prefix_separator"):null},missingIndicator:{columns:n(P,"columns"),suffix:n(P,"flag_suffix")},dropRows:{any:n(A,"drop_if_any_missing")},dropMissing:{threshold:n(R||A,"missing_threshold")}}},[t,e])},L4=(e,t)=>{const{isBinningNode:n,isCastNode:s,isDropMissingColumnsNode:r,isDropMissingRowsNode:i,isImputerNode:l,isMissingIndicatorNode:u,isReplaceAliasesNode:d,isTrimWhitespaceNode:f,isRemoveSpecialCharsNode:p,isReplaceInvalidValuesNode:m,isRegexCleanupNode:h,isNormalizeTextCaseNode:_,isStandardizeDatesNode:x,isScalingNode:y,isClassUndersamplingNode:v,isClassOversamplingNode:w,isTrainModelDraftNode:k,isLabelEncodingNode:j,isOrdinalEncodingNode:b,isDummyEncodingNode:S,isOneHotEncodingNode:E,isRemoveDuplicatesNode:M,isSkewnessNode:O,isFeatureTargetSplitNode:$}=t;return N.useMemo(()=>{let P=e;return P=P.filter(A=>{var R;return((R=A==null?void 0:A.source)==null?void 0:R.type)!=="drop_column_recommendations"}),(r||i)&&(P=P.filter(A=>A.name!=="missing_threshold")),i&&(P=P.filter(A=>A.name!=="drop_if_any_missing")),l&&(P=P.filter(A=>A.name!=="strategies")),O&&(P=P.filter(A=>A.name!=="transformations")),s&&(P=P.filter(A=>A.name!=="columns")),n&&(P=P.filter(A=>A.name!=="columns")),y&&(P=P.filter(A=>!["columns","default_method","auto_detect"].includes(A.name))),M&&(P=P.filter(A=>A.name!=="columns"&&A.name!=="keep")),u&&(P=P.filter(A=>A.name!=="columns"&&A.name!=="flag_suffix")),d&&(P=P.filter(A=>!["columns","mode","custom_pairs"].includes(A.name))),f&&(P=P.filter(A=>!["columns","mode"].includes(A.name))),p&&(P=P.filter(A=>!["columns","mode","replacement"].includes(A.name))),m&&(P=P.filter(A=>!["columns","mode","min_value","max_value"].includes(A.name))),h&&(P=P.filter(A=>!["columns","mode","pattern","replacement"].includes(A.name))),_&&(P=P.filter(A=>!["columns","mode"].includes(A.name))),x&&(P=P.filter(A=>!["columns","mode"].includes(A.name))),v&&(P=P.filter(A=>!["method","target_column","sampling_strategy","random_state","replacement"].includes(A.name))),w&&(P=P.filter(A=>!["method","target_column","sampling_strategy","random_state"].includes(A.name))),k&&(P=P.filter(A=>!["target_column","problem_type","cv_enabled","cv_strategy","cv_folds","cv_shuffle","cv_random_state","cv_refit_strategy"].includes(A.name))),$&&(P=P.filter(A=>A.name!=="target_column")),j&&(P=P.filter(A=>!["columns","auto_detect","max_unique_values","output_suffix","drop_original","missing_strategy","missing_code"].includes(A.name))),b&&(P=P.filter(A=>!["columns","auto_detect","max_categories","output_suffix","drop_original","encode_missing","handle_unknown","unknown_value"].includes(A.name))),S&&(P=P.filter(A=>!["columns","auto_detect","max_categories","drop_first","include_missing","drop_original","prefix_separator"].includes(A.name))),E&&(P=P.filter(A=>!["columns","auto_detect","max_categories","drop_first","include_missing","drop_original","prefix_separator"].includes(A.name))),P},[e,n,s,r,i,l,u,d,f,p,m,h,_,x,y,v,w,k,j,b,S,E,M,O,$])},z4=e=>{const t=N.useMemo(()=>uz,[]),n=N.useMemo(()=>t.map(i=>i.value),[t]),s=N.useMemo(()=>Rw(e==null?void 0:e.strategies,n),[e==null?void 0:e.strategies,n]),r=s.length;return{imputationMethodOptions:t,imputationMethodValues:n,imputerStrategies:s,imputerStrategyCount:r}},R4=(e,t)=>{const n=N.useMemo(()=>_p(Dw(e==null?void 0:e.transformations)),[e==null?void 0:e.transformations]),s=N.useCallback(r=>{t(i=>{const l=_p(Dw(i==null?void 0:i.transformations)),u=_p(r(l));return{...i,transformations:u.map(d=>({...d}))}})},[t]);return{skewnessTransformations:n,updateSkewnessTransformations:s}},D4=()=>{const{data:e=[],isLoading:t,error:n}=Es({queryKey:["feature-canvas","node-catalog"],queryFn:mp,staleTime:3e5}),s=N.useMemo(()=>{const r=new Map;return e.forEach(i=>{i&&typeof i.type=="string"&&i.type.trim()&&r.set(i.type,i)}),r},[e]);return{nodeCatalog:e,catalogEntryMap:s,isLoading:t,error:n}},I4={trim_whitespace:{title:"Use after Dataset snapshot or Missing indicator nodes",body:"Great for cleaning string columns before alias replacement or case normalization. Auto-detects text columns when left blank."},normalize_text_case:{title:"Use after trimming and alias cleanup",body:"Keeps categorical values consistent for joins and grouping. Pair with Dataset profile or Preview to confirm column impacts."},replace_aliases_typos:{title:"Requires Dataset profile insights",body:"Apply after profiling so you can confirm value distributions. Combine with custom pairs to align business-specific labels."},standardize_date_formats:{title:"Run after parsing-friendly nodes",body:"Normalizes mixed date strings into the format you choose. Works best once whitespace and punctuation cleanup nodes have run."},remove_special_characters:{title:"Pair with Trim whitespace or Regex cleanup",body:"Strips punctuation or noise from text fields before alias grouping. Preview to ensure replacements retain the intent of each field."},replace_invalid_values:{title:"Use after Outlier diagnostics or Dataset profile",body:"Flags negative, zero, or out-of-range numeric placeholders and converts them to missing for downstream handling."},regex_replace_fix:{title:"Configure after reviewing Dataset snapshot",body:"Use presets for quick fixes or supply a custom regex. Ideal before date standardization or alias cleanup passes."}},F4=({node:e,graphSnapshot:t,isResetAvailable:n,defaultConfigTemplate:s})=>{const r=k4(e,t),i=Ij(e),{catalogType:l,isDataset:u,isClassUndersamplingNode:d,isClassOversamplingNode:f,isDataConsistencyNode:p,isSkewnessNode:m,isSkewnessDistributionNode:h}=i,_=u,x=d||f,{catalogEntryMap:y}=D4(),v=N.useMemo(()=>l?y.get(l):null,[l,y]),{metadata:w,title:k}=E4(e,v),{parameters:j,getParameter:b,requiresColumnCatalog:S,dropColumnParameter:E}=A4(e,v),M=N.useMemo(()=>I4[l]??null,[l]),O=typeof(e==null?void 0:e.id)=="string"?e.id:"",$=O4({isResetAvailable:n,defaultConfigTemplate:s,catalogFlags:i}),P=P4(b,i),A=L4(j,i),R=N.useMemo(()=>p?A:[],[A,p]),F=m||h,z=$4({node:e}),{setConfigState:I,configState:U}=z,q=T4({setConfigState:I}),H=z4(U),W=R4(U,I);return{metadata:w,title:k,connectionReadiness:r,catalogFlags:i,datasetBadge:_,isClassResamplingNode:x,parameters:j,getParameter:b,requiresColumnCatalog:S,dropColumnParameter:E,dataConsistencyHint:M,nodeId:O,resetPermissions:$,nodeParams:P,filteredParameters:A,dataConsistencyParameters:R,shouldLoadSkewnessInsights:F,configStateResult:z,parameterHandlers:q,imputationStrategiesResult:H,skewnessStateResult:W,catalogEntry:v}},lm=e=>{const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):null},B4=({recommendationsGeneratedAt:e,scalingData:t,binningData:n,binnedDistributionData:s,outlierData:r})=>{const i=N.useMemo(()=>Fn(e??null),[e]),l=N.useMemo(()=>Fn((t==null?void 0:t.generated_at)??null),[t==null?void 0:t.generated_at]),u=N.useMemo(()=>Fn((n==null?void 0:n.generated_at)??null),[n==null?void 0:n.generated_at]),d=N.useMemo(()=>Fn((s==null?void 0:s.generated_at)??null),[s==null?void 0:s.generated_at]),f=N.useMemo(()=>Fn((r==null?void 0:r.generated_at)??null),[r==null?void 0:r.generated_at]),p=N.useMemo(()=>lm((t==null?void 0:t.sample_size)??null),[t==null?void 0:t.sample_size]),m=N.useMemo(()=>lm((n==null?void 0:n.sample_size)??null),[n==null?void 0:n.sample_size]),h=N.useMemo(()=>lm((s==null?void 0:s.sample_size)??null),[s==null?void 0:s.sample_size]),_=N.useMemo(()=>lm((r==null?void 0:r.sample_size)??null),[r==null?void 0:r.sample_size]);return{relativeGeneratedAt:i,relativeScalingGeneratedAt:l,relativeBinningGeneratedAt:u,relativeBinnedGeneratedAt:d,relativeOutlierGeneratedAt:f,scalingSampleSize:p,binningSampleSize:m,binnedSampleSize:h,outlierSampleSize:_}},U4=({isProfileLoading:e,isPreviewLoading:t,isFetchingScaling:n,isFetchingBinning:s,isFetchingHashEncoding:r,isFetchingBinnedDistribution:i,isFetchingRecommendations:l,catalogFlags:u})=>{const{isPreviewNode:d}=u,f=N.useMemo(()=>e||t||n||s||r||i||l,[i,s,r,n,l,t,e]),p=N.useMemo(()=>e?"Generating dataset profile":n?"Loading scaling insights":s?"Loading binning insights":r?"Loading hash encoding insights":i?"Computing binned distributions":l?"Fetching column recommendations":t?d?"Loading dataset preview":"Analyzing node outputs":null,[i,s,r,l,n,t,d,e]);return{hasActiveAsyncWork:f,busyLabel:p,footerBusyLabel:p??(f?"Processing":null)}},H4=({recommendationsGeneratedAt:e,scalingData:t,binningData:n,binnedDistributionData:s,outlierData:r,isProfileLoading:i,isPreviewLoading:l,isFetchingScaling:u,isFetchingBinning:d,isFetchingHashEncoding:f,isFetchingBinnedDistribution:p,isFetchingRecommendations:m,catalogFlags:h})=>{const _=B4({recommendationsGeneratedAt:e,scalingData:t,binningData:n,binnedDistributionData:s,outlierData:r}),x=U4({isProfileLoading:i,isPreviewLoading:l,isFetchingScaling:u,isFetchingBinning:d,isFetchingHashEncoding:f,isFetchingBinnedDistribution:p,isFetchingRecommendations:m,catalogFlags:h});return{insightSummaries:_,asyncBusyLabel:x}},q4=({catalogFlags:e,binnedDistributionData:t})=>{const{isBinnedDistributionNode:n}=e;return N.useMemo(()=>{if(!n)return[];const r=(Array.isArray(t==null?void 0:t.columns)?t==null?void 0:t.columns:[]).map(i=>{if(!i||!i.column)return null;const l=Number(i.total_rows),u=Number.isFinite(l)?Math.max(0,Math.round(l)):0;if(u<=0)return null;const f=(Array.isArray(i.bins)?i.bins:[]).map($=>{if(!$)return null;const A=(typeof $.label=="string"?$.label.trim():String($.label??""))||($.is_missing?"Missing":"Unlabeled bin"),R=Number($.count);if(!Number.isFinite(R))return null;const F=Math.max(0,Math.round(R)),z=Number($.percentage),I=Number.isFinite(z)?Math.min(100,Math.max(0,z)):0,U=Number(I.toFixed(2));return{label:A,count:F,percentage:U,isMissing:!!$.is_missing}}).filter($=>!!$);if(!f.length)return null;f.sort(($,P)=>$.isMissing!==P.isMissing?$.isMissing?1:-1:$.count!==P.count?P.count-$.count:$.label.localeCompare(P.label));const p=f.length,m=12,h=p>m,_=h?f.slice(0,m):f,x=Number(i.missing_rows),y=Number.isFinite(x)?Math.max(0,Math.round(x)):0,v=Number(i.distinct_bins),w=Number.isFinite(v)?Math.max(0,Math.round(v)):f.length,k=i.top_label;let j=typeof k=="string"?k.trim()||null:k??null;const b=Number(i.top_count);let S=Number.isFinite(b)?Math.max(0,Math.round(b)):null;const E=Number(i.top_percentage);let M=Number.isFinite(E)?Number(Math.min(100,Math.max(0,E)).toFixed(2)):null;(j===null||S===null||M===null)&&_.length&&(j=_[0].label,S=_[0].count,M=_[0].percentage);const O=typeof i.source_column=="string"?i.source_column.trim()||null:i.source_column??null;return{column:i.column,sourceColumn:O,totalRows:u,missingRows:y,distinctBins:w,topLabel:j,topCount:S,topPercentage:M,bins:_,hasMoreBins:h,totalBinCount:p}}).filter(i=>!!i);return r.sort((i,l)=>{const u=(l.topCount??0)-(i.topCount??0);return u!==0?u:i.column.localeCompare(l.column)}),r},[t,n])},V4=({node:e,graphContext:t,hasReachableSource:n,sourceId:s,formatRelativeTime:r,catalogFlags:i})=>{const{isDatasetProfileNode:l}=i,u=N.useMemo(()=>t?Lc(t):"",[t]),d=IL({node:e,isDatasetProfileNode:l,sourceId:s,hasReachableSource:n,graphContext:t,profilingGraphSignature:u,formatRelativeTime:r}),{profileState:f}=d;return{datasetProfileController:d,profileState:f}},W4=(e,t)=>{var r;const n=(r=e==null?void 0:e.parameter_help)==null?void 0:r[t];if(n)return n;const s=t.replace(/_/g," ").trim();return s.charAt(0).toUpperCase()+s.slice(1)},Y4=e=>{if(!e)return null;const t=[];if(e.removed_rows&&e.removed_rows>0&&t.push(`Removed ${e.removed_rows} row${e.removed_rows===1?"":"s"}`),Array.isArray(e.clipped_columns)&&e.clipped_columns.length){const n=Array.from(new Set(e.clipped_columns));t.push(`Winsorized ${n.length} column${n.length===1?"":"s"}`)}if(t.length||t.push("No rows removed or clipped during the last preview"),Array.isArray(e.skipped_columns)&&e.skipped_columns.length){const n=e.skipped_columns.join(", ");t.push(`Skipped columns: ${n}`)}return t.join("  ")},K4=(e,t,n,s,r)=>{var f;const i=n[s]??{};if(Object.prototype.hasOwnProperty.call(i,t)){const p=i[t];if(typeof p=="number"&&Number.isFinite(p))return{value:p,fallback:null}}const u=(r[e]??{})[t];return typeof u=="number"&&Number.isFinite(u)?{value:"",fallback:u}:{value:"",fallback:((f=Va[e])==null?void 0:f[t])??null??null}},Bj=e=>typeof e=="number"&&Number.isFinite(e)?String(e):"",Uj={lower_percentile:"%",upper_percentile:"%"},G4=({sourceId:e,hasReachableSource:t,isFetchingOutliers:n,outlierConfig:s,outlierMethodOptions:r,outlierMethodDetailMap:i,outlierDefaultDetail:l,outlierAutoDetectEnabled:u,outlierSelectedCount:d,outlierDefaultLabel:f,outlierOverrideCount:p,outlierParameterOverrideCount:m,outlierOverrideExampleSummary:h,outlierHasOverrides:_,outlierRecommendationRows:x,outlierHasRecommendations:y,outlierStatusMessage:v,outlierError:w,outlierSampleSize:k,relativeOutlierGeneratedAt:j,outlierPreviewSignal:b,formatMetricValue:S,formatNumericStat:E,onApplyAllRecommendations:M,onClearOverrides:O,onDefaultMethodChange:$,onAutoDetectToggle:P,onOverrideSelect:A,onMethodParameterChange:R,onColumnParameterChange:F})=>{const z=Y4(b);return a.jsxs("section",{className:"canvas-modal__section",children:[a.jsxs("div",{className:"canvas-modal__section-header",children:[a.jsx("h3",{children:"Outlier insights"}),a.jsxs("div",{className:"canvas-modal__section-actions",children:[a.jsx("button",{type:"button",className:"btn btn-primary",onClick:M,disabled:!y,children:"Apply recommendations"}),a.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:O,disabled:!_,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx(cc,{size:14}),"Clear overrides"]})]})]}),a.jsx("p",{className:"canvas-modal__note",children:"Diagnose numeric outliers and configure how to handle them across the dataset. Preview updates immediately, letting you validate the impact before saving this node."}),!e&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface outlier diagnostics."}),e&&!t&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric distributions."}),j&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",j,k!==null?` on ${S(k)} row${k===1?"":"s"}.`:"."]}),!j&&k!==null&&a.jsxs("p",{className:"canvas-modal__note",children:["Insights generated on ",S(k)," row",k===1?"":"s","."]}),z&&a.jsxs("p",{className:"canvas-modal__note",children:["Last preview: ",z]}),a.jsxs("div",{className:"canvas-modal__parameter-grid",children:[a.jsxs("div",{className:"canvas-modal__parameter-field",children:[a.jsx("div",{className:"canvas-modal__parameter-label",children:a.jsx("span",{children:"Default outlier method"})}),a.jsx("div",{className:"canvas-scaling__method-toggle",role:"group","aria-label":"Default outlier method",children:r.map(I=>{const U=i.get(I.value)??null,q=I.value===s.defaultMethod;return a.jsxs("button",{type:"button",className:`canvas-scaling__method-button${q?" canvas-scaling__method-button--active":""}`,"aria-pressed":q,onClick:()=>$(I.value),children:[a.jsx("span",{className:"canvas-scaling__method-label",children:I.label}),(U==null?void 0:U.description)&&a.jsx("span",{className:"canvas-scaling__method-description",children:U.description})]},I.value)})}),(l==null?void 0:l.description)&&a.jsx("p",{className:"canvas-modal__parameter-description",children:l.description})]}),a.jsx(nl,{fieldLabel:"Auto-detect numeric columns",label:u?"Enabled":"Disabled",checked:u,onChange:I=>P(I.target.checked),description:"Auto-detection tracks numeric features so newly profiled columns join the node automatically."})]}),(()=>{const I=s.defaultMethod,U=om[I]??[];if(!U.length)return null;const q=i.get(I)??null;return a.jsxs("section",{className:"canvas-modal__parameter-field",children:[a.jsx("div",{className:"canvas-modal__parameter-label",children:a.jsx("span",{children:"Global method parameters"})}),a.jsx("p",{className:"canvas-modal__parameter-description canvas-outlier__method-note",children:"Tune default thresholds for the selected strategy. Column overrides can refine these further."}),a.jsx("div",{className:"canvas-outlier__method-grid",children:a.jsx("article",{className:"canvas-outlier__method-card",children:a.jsx("div",{className:"canvas-outlier__parameter-list",children:U.map(H=>{var D,V;const W=((D=s.methodParameters[I])==null?void 0:D[H])??null,B=Uj[H]??"";return a.jsxs("label",{className:"canvas-outlier__method-parameter",children:[a.jsx("span",{className:"canvas-outlier__parameter-label",children:W4(q,H)}),a.jsxs("div",{className:"canvas-outlier__method-input",children:[a.jsx(tl,{className:"canvas-outlier__method-input-field",value:typeof W=="number"&&Number.isFinite(W)?W:"",placeholder:Bj(((V=Va[I])==null?void 0:V[H])??null),onChange:te=>{const G=te.target.value;if(G==="")R(I,H,null);else{const K=Number(G);R(I,H,Number.isFinite(K)?K:null)}}}),B&&a.jsx("span",{className:"canvas-outlier__parameter-suffix",children:B})]})]},`${I}-${H}`)})})})})]})})(),a.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",a.jsx("strong",{children:d})," column",d===1?"":"s","  Default method"," ",a.jsx("strong",{children:f})," ",u?" Auto-detect on":" Auto-detect off",(()=>{if(!(p+m))return"  No overrides yet";const U=[];return p>0&&U.push(h?`${p} method override${p===1?"":"s"} (${h})`:`${p} method override${p===1?"":"s"}`),m>0&&U.push(`${m} parameter override${m===1?"":"s"}`),`  Overrides: ${U.join("; ")}`})()]}),n&&a.jsx("p",{className:"canvas-modal__note",children:"Loading outlier diagnostics"}),!n&&w&&e&&t&&a.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:w}),!n&&!w&&a.jsxs(a.Fragment,{children:[v&&a.jsx("p",{className:"canvas-modal__note",children:v}),x.length>0&&a.jsx("div",{className:"canvas-cast__body",children:a.jsx("div",{className:"canvas-cast__table-wrapper",children:a.jsxs("table",{className:"canvas-cast__table canvas-scaling__table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Column"}),a.jsx("th",{scope:"col",children:"Recommendation"}),a.jsx("th",{scope:"col",children:"Distribution"}),a.jsx("th",{scope:"col",children:"Configured method"})]})}),a.jsx("tbody",{children:x.map(I=>{const U=!I.isSkipped&&!I.isExcluded&&I.recommendedMethod&&I.recommendedMethod!==I.currentMethod,q=["canvas-cast__row"];U&&q.push("canvas-cast__row--attention"),I.isOverrideApplied&&q.push("canvas-cast__row--override"),I.isSkipped&&q.push("canvas-cast__row--muted");const H=I.isSkipped?"__skip__":I.isOverrideApplied?I.currentMethod:"__default__",W=I.isOverrideApplied?`Override -> ${I.currentMethodLabel}`:I.isSkipped?"Skipped (column will not be altered)":I.isSelected?`Inheriting ${f}`:"Pending inclusion",B=I.stats,D=[];typeof B.valid_count=="number"&&Number.isFinite(B.valid_count)&&D.push(`${S(B.valid_count)} valid rows`);const V=typeof B.minimum=="number"&&Number.isFinite(B.minimum),te=typeof B.maximum=="number"&&Number.isFinite(B.maximum);if(V||te){const Z=V?E(B.minimum):"",ee=te?E(B.maximum):"";D.push(`Range ${Z}  ${ee}`)}typeof B.mean=="number"&&Number.isFinite(B.mean)&&D.push(`Mean ${E(B.mean)}`),typeof B.median=="number"&&Number.isFinite(B.median)&&D.push(`Median ${E(B.median)}`),typeof B.stddev=="number"&&Number.isFinite(B.stddev)&&D.push(` ${E(B.stddev)}`);const G=D.length?D.join("  "):null,K=!I.recommendedMethod||!I.recommendedLabel?I.recommendedReason||"No outlier risk detected":I.recommendedReason?`${I.recommendedLabel}  ${I.recommendedReason}`:I.recommendedLabel,X=s.columnParameters,Q=s.methodParameters,J=om[I.currentMethod]??[];return a.jsxs("tr",{className:q.join(" "),children:[a.jsx("th",{scope:"row",children:a.jsxs("div",{className:"canvas-cast__column-cell",children:[a.jsx("span",{className:"canvas-cast__column-name",children:I.column}),a.jsxs("div",{className:"canvas-cast__column-meta",children:[I.dtype&&a.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",I.dtype]}),I.isExcluded&&a.jsx("span",{className:"canvas-cast__muted",children:"Excluded from outlier evaluation (non-numeric)"}),I.isSelected&&!I.isExcluded&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),I.isSkipped&&!I.isExcluded&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--skipped",children:"Skipped"}),I.isOverrideApplied&&a.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),I.hasMissing&&a.jsx("span",{className:"canvas-cast__muted",children:"Contains missing values"})]})]})}),a.jsx("td",{children:a.jsxs("div",{className:"canvas-cast__recommendation",children:[I.recommendedLabel?a.jsx("span",{className:`canvas-cast__chip${U?" canvas-cast__chip--attention":" canvas-cast__chip--applied"}`,children:I.recommendedLabel}):a.jsx("span",{className:"canvas-cast__chip",children:"No action needed"}),K&&a.jsx("span",{className:"canvas-cast__recommendation-note",children:K})]})}),a.jsx("td",{children:G?a.jsx("span",{children:G}):a.jsx("span",{className:"canvas-cast__muted",children:"No distribution summary"})}),a.jsx("td",{children:a.jsxs("div",{className:"canvas-cast__target",children:[a.jsxs("select",{value:H,onChange:Z=>A(I.column,Z.target.value),disabled:I.isExcluded,children:[a.jsxs("option",{value:"__default__",children:["Inherit default (",f,")"]}),a.jsx("option",{value:"__skip__",children:"Skip outlier handling"}),r.map(Z=>a.jsx("option",{value:Z.value,children:Z.label},`${I.column}-${Z.value}`))]}),a.jsx("span",{className:"canvas-cast__target-note",children:W}),J.length>0&&!I.isExcluded&&!I.isSkipped&&a.jsx("div",{className:"canvas-outlier__parameters",children:J.map(Z=>{const{value:ee,fallback:de}=K4(I.currentMethod,Z,X,I.column,Q),_e=Uj[Z]??"";return a.jsxs("label",{children:[a.jsx("span",{children:Z.replace(/_/g," ")}),a.jsx(tl,{value:ee,placeholder:Bj(de),onChange:ge=>{const be=ge.target.value;if(be==="")F(I.column,Z,null);else{const ze=Number(be);F(I.column,Z,Number.isFinite(ze)?ze:null)}}}),_e&&a.jsx("span",{className:"canvas-outlier__parameter-suffix",children:_e})]},`${I.column}-${I.currentMethod}-${Z}`)})})]})})]},`outlier-row-${I.column}`)})})]})})})]})]})},X4=({connectionInfo:e,connectedInputHandles:t,connectedOutputHandles:n,connectionReady:s})=>e?a.jsxs("section",{className:"canvas-modal__section",children:[a.jsx("div",{className:"canvas-modal__section-header",children:a.jsx("h3",{children:"Connection requirements"})}),a.jsxs("p",{className:s?"canvas-modal__note":"canvas-modal__note canvas-modal__note--warning",style:{display:"flex",alignItems:"start",gap:"0.5rem"},children:[a.jsx("span",{style:{marginTop:"2px"},children:s?a.jsx(zh,{size:16}):a.jsx(za,{size:16})}),a.jsxs("span",{children:[a.jsx("strong",{children:s?"Ready to execute.":"Missing required connections."})," ",s?"All required inputs are connected; you can continue configuring this node.":"Connect the required inputs listed below before running training or evaluation workflows."]})]}),e.inputs&&e.inputs.length>0&&a.jsxs("div",{className:"canvas-modal__note",children:[a.jsx("strong",{children:"Inputs"}),a.jsx("ul",{children:e.inputs.map(r=>{const i=t.has(r.key),l=r.required!==!1;return a.jsxs("li",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[i?a.jsx(zh,{size:14}):l?a.jsx(za,{size:14}):a.jsx(N2,{size:14}),a.jsx("span",{children:r.label}),a.jsx("span",{children:" - "}),a.jsx("span",{children:i?"Connected":l?"Missing":"Optional"})]},`inputs-${r.key}`)})})]}),e.outputs&&e.outputs.length>0&&a.jsxs("div",{className:"canvas-modal__note",children:[a.jsx("strong",{children:"Outputs"}),a.jsx("ul",{children:e.outputs.map(r=>{const i=n.has(r.key),l=r.required!==!1;return a.jsxs("li",{children:[a.jsx("span",{children:r.label}),a.jsx("span",{children:" - "}),a.jsx("span",{children:i?"Connected":l?"Unlinked":"Optional"})]},`outputs-${r.key}`)})})]})]}):null,Q4=({node:e,onClose:t,onUpdateConfig:n,onUpdateNodeData:s,sourceId:r,graphSnapshot:i,onResetConfig:l,defaultConfigTemplate:u,isResetAvailable:d=!1})=>{var qt,Ht,Ar;const{title:f,connectionReadiness:p,catalogFlags:m,datasetBadge:h,isClassResamplingNode:_,parameters:x,requiresColumnCatalog:y,dropColumnParameter:v,dataConsistencyHint:w,nodeId:k,resetPermissions:j,nodeParams:b,dataConsistencyParameters:S,configStateResult:E,parameterHandlers:M,imputationStrategiesResult:O,skewnessStateResult:$}=F4({node:e,graphSnapshot:i??null,isResetAvailable:d,defaultConfigTemplate:u}),{connectionInfo:P,connectedHandleKeys:A,connectedOutputHandleKeys:R,evaluationSplitConnectivity:F,connectionReady:z,gatedSectionStyle:I,gatedAriaDisabled:U}=p,{catalogType:q,isDataset:H,isImputerNode:W,isMissingIndicatorNode:B,isReplaceAliasesNode:D,isTrimWhitespaceNode:V,isRemoveSpecialCharsNode:te,isReplaceInvalidValuesNode:G,isRegexCleanupNode:K,isNormalizeTextCaseNode:X,isStandardizeDatesNode:Q,isLabelEncodingNode:J,isTargetEncodingNode:Z,isHashEncodingNode:ee,isFeatureTargetSplitNode:de,isTrainTestSplitNode:_e,isTrainModelDraftNode:ge,isModelEvaluationNode:be,isModelRegistryNode:ze,isHyperparameterTuningNode:Ee,isClassUndersamplingNode:ie,isClassOversamplingNode:pe,isOrdinalEncodingNode:Ce,isDummyEncodingNode:Te,isOneHotEncodingNode:De,isFeatureMathNode:ce,isCastNode:Oe,isBinningNode:qe,isScalingNode:Qe,isPolynomialFeaturesNode:Ye,isFeatureSelectionNode:at,isTransformerAuditNode:et,isOutlierNode:ot,isSkewnessNode:Nt,isSkewnessDistributionNode:Tt,isBinnedDistributionNode:tt,isDataConsistencyNode:Ft,isInspectionNode:Wt,isRemoveDuplicatesNode:Pt,isDropMissingColumnsNode:bn,isDropMissingRowsNode:gn,isDropMissingNode:jt,isPreviewNode:cn,isDatasetProfileNode:un}=m,{canResetNode:Lt,headerCanResetNode:ut,footerCanResetNode:wn}=j,{configState:ht,setConfigState:Bt,stableInitialConfig:mt,stableCurrentConfig:Vn,nodeChangeVersion:_n}=E,{handleParameterChange:ls,handleNumberChange:xt,handlePercentileChange:pt,handleBooleanChange:yn,handleTextChange:ys}=M,dn=N.useMemo(()=>ze?ht?{...ht}:{}:null,[ht,ze]),{imputationMethodOptions:Xt,imputationMethodValues:tn,imputerStrategies:Nn,imputerStrategyCount:Wn}=O,{skewnessTransformations:Yn,updateSkewnessTransformations:vt}=$,{graphTopology:Yt,modelingConfig:Jn,previewSignatureResult:$n,cachedPreviewSchema:Xs,setCachedPreviewSchema:vs,schemaDiagnostics:cs,columnCatalogState:$s}=CF({graphSnapshot:i??null,nodeId:k,catalogFlags:m,configState:ht,setConfigState:Bt,nodeParams:b,sourceId:r,requiresColumnCatalog:y,imputerStrategies:Nn}),{graphContext:Kt,graphNodeCount:Ts,upstreamTargetColumn:Ut,hasReachableSource:$e}=Yt,{featureTargetSplitConfig:Dt,trainTestSplitConfig:Ps,resamplingConfig:es,trainModelDraftConfig:ue,trainModelRuntimeConfig:we,trainModelCVConfig:Fe,filteredModelTypeOptions:gt}=Jn,{upstreamConfigFingerprints:ke,previewSignature:kt}=$n,{cachedSchemaColumns:nt,oversamplingSchemaGuard:nn,imputationSchemaDiagnostics:vn,skipPreview:Mt}=cs,{availableColumns:Zt,setAvailableColumns:ts,columnSearch:Tn,setColumnSearch:Pn,columnMissingMap:xs,setColumnMissingMap:jn,columnTypeMap:Ln,setColumnTypeMap:bs,columnSuggestions:ws,setColumnSuggestions:Ls,imputerMissingFilter:qr,setImputerMissingFilter:Vr,normalizedColumnSearch:St,filteredColumnOptions:wl}=$s,[dr,Qo]=N.useState("500"),[pa,Zo]=N.useState(()=>new Set);N.useEffect(()=>{Zo(new Set)},[mt]);const{datasetProfileController:Nl,profileState:Jo}=V4({node:e,graphContext:Kt,hasReachableSource:$e,sourceId:r,formatRelativeTime:Fn,catalogFlags:m}),{nodePreview:ga,previewSignals:Qs,featureMathState:Zs,previewData:Js}=w4({graphSnapshot:i??null,graphNodeCount:Ts,hasReachableSource:$e,sourceId:r,node:e,nodeId:k,previewSignature:kt,skipPreview:Mt,cachedPreviewSchema:Xs,setCachedPreviewSchema:vs,catalogFlags:m,upstreamTargetColumn:Ut,setConfigState:Bt,configState:ht}),{previewState:ne,refreshPreview:ye,clearCachedPreviewSchema:fe,canTriggerPreview:Pe}=ga,{featureMathSignals:Ae,polynomialSignal:xe,featureSelectionSignal:st,outlierPreviewSignal:Ve,transformerAuditSignal:ct}=Qs,{featureMathOperations:it,featureMathSummaries:rt,collapsedFeatureMath:_t,setCollapsedFeatureMath:sn}=Zs,{previewColumns:It,previewColumnStats:Bn,previewSampleRows:Wr}=Js,{dropMissingColumns:kr,encodingRecommendations:zs,outlierRecommendations:us,scalingInsights:Ns,binningInsights:Cn,binnedDistribution:zn,skewnessInsights:_a,missingIndicatorState:Yr,dataCleaningState:ei,numericColumnAnalysis:ya,numericAnalysisState:Kr,removeDuplicatesState:to}=h4({catalogFlags:m,sourceId:r,nodeId:k,graphContext:Kt,hasReachableSource:$e,columnTypeMap:Ln,setAvailableColumns:ts,setColumnSearch:Pn,setColumnMissingMap:jn,setColumnTypeMap:bs,setColumnSuggestions:Ls,dropColumnParameter:v,node:e,configState:ht,setConfigState:Bt,nodeChangeVersion:_n,binnedSamplePreset:dr,skewnessTransformations:Yn,availableColumns:Zt,columnMissingMap:xs,previewSampleRows:Wr}),{hasDropColumnSource:ns,availableFilters:mr,activeFilterId:va,setActiveFilterId:mn,recommendations:ti,filteredRecommendations:ni,formatSignalName:si,isFetchingRecommendations:Mr,recommendationsError:Jt,recommendationsGeneratedAt:ss,suggestedThreshold:er,refreshRecommendations:Gc}=kr,{labelEncoding:ri,targetEncoding:xa,hashEncoding:no,ordinalEncoding:ai,dummyEncoding:oi,oneHotEncoding:ii}=zs,{outlierData:rg,outlierError:dm,isFetchingOutliers:ag,refreshOutliers:mm}=us,{scalingData:og,scalingError:ig,isFetchingScaling:jl,refreshScaling:fm}=Ns,{binningData:lg,binningError:cg,isFetchingBinning:Xc,refreshBinning:hm}=Cn,so=N.useCallback(()=>{fe(),ye(),Qe&&fm(),qe&&hm(),ot&&mm()},[qe,ot,Qe,hm,mm,fe,ye,fm]),{binnedDistributionData:pm,binnedDistributionError:ug,isFetchingBinnedDistribution:gm,refreshBinnedDistribution:_m}=zn,{skewnessData:dg,skewnessError:Cl,isFetchingSkewness:ro,refreshSkewness:mg}=_a,{activeFlagSuffix:Qc,missingIndicatorColumns:fg,missingIndicatorInsights:ym}=Yr,vm=!!r&&$e,xm=N.useMemo(()=>{var En;return Ge((En=e==null?void 0:e.data)==null?void 0:En.columns)},[(qt=e==null?void 0:e.data)==null?void 0:qt.columns]),{alias:Rs,trimWhitespace:Zc,removeSpecial:Jc,regexCleanup:li,normalizeCase:ci,replaceInvalid:ba,standardizeDates:tr}=ei,{numericExcludedColumns:ui}=ya,{scaling:Sn,outlier:Qt,binning:At,selectedColumns:nr}=Kr;kF({previewState:ne,previewSampleRows:Wr,activeFlagSuffix:Qc??"",setColumnTypeMap:bs,setColumnSuggestions:Ls,hasReachableSource:$e,requiresColumnCatalog:y,nodeColumns:xm,selectedColumns:nr,setAvailableColumns:ts,setColumnMissingMap:jn});const Sl=((Ht=b.dropMissing.threshold)==null?void 0:Ht.name)??null,{skewness:rn,imputationConfiguration:bm,thresholdRecommendations:wm}=yF({catalogFlags:m,skewnessData:dg,skewnessTransformations:Yn,availableColumns:Zt,previewColumns:It,columnTypeMap:Ln,updateSkewnessTransformations:vt,imputerStrategies:Nn,columnMissingMap:xs,previewColumnStats:Bn,nodeColumns:(Ar=e==null?void 0:e.data)==null?void 0:Ar.columns,imputerMissingFilter:qr,suggestedThreshold:er,thresholdParameterName:Sl,configState:ht,handleParameterChange:ls}),{imputerColumnOptions:Nm,imputerMissingSliderMax:hg,imputerFilteredOptionCount:pg,imputerMissingFilterActive:gg}=bm,{normalizedSuggestedThreshold:_g,thresholdMatchesSuggestion:yg,canApplySuggestedThreshold:sr,handleApplySuggestedThreshold:di}=wm,jm=gn&&!!(b.dropMissing.threshold||b.dropRows.any),{columnSelectionHandlers:Cm,nodeSaveHandlers:Sm,imputationStrategyHandlers:Em,aliasStrategyHandlers:eu,dateStrategyHandlers:vg,featureMathHandlers:xg}=WF({catalogFlags:m,setConfigState:Bt,binningExcludedColumns:At.state.excludedColumns,scalingExcludedColumns:Sn.state.excludedColumns,availableColumns:Zt,recommendations:ti,nodeId:k,onUpdateConfig:n,onClose:t,sourceId:r??null,graphSnapshot:i??null,onUpdateNodeData:s,canResetNode:Lt,defaultConfigTemplate:u,onResetConfig:l,imputationMethodValues:tn,imputationMethodOptions:Xt,imputerStrategyCount:Wn,setCollapsedStrategies:Zo,setImputerMissingFilter:Vr,node:e,aliasColumnSummary:Rs.columnSummary,aliasStrategyCount:Rs.strategyCount,dateStrategies:tr.strategies,standardizeDatesColumnSummary:tr.columnSummary,standardizeDatesMode:tr.mode,setCollapsedFeatureMath:sn,configState:ht}),{handleManualBoundChange:mi,handleClearManualBound:km,handleToggleColumn:rr,handleApplyAllRecommended:tu,handleSelectAllColumns:Mm,handleClearColumns:El,handleRemoveColumn:ao}=Cm,{handleSave:fi,handleResetNode:nu}=Sm,kl=nr.length,Am=ns&&!!r&&$e,su=!h&&!Wt,Om=su&&mt!==Vn,$m=Jo.status==="loading",Tm=ne.status==="loading",{insightSummaries:Pm,asyncBusyLabel:Gr}=H4({recommendationsGeneratedAt:ss,scalingData:og,binningData:lg,binnedDistributionData:pm,outlierData:rg,isProfileLoading:$m,isPreviewLoading:Tm,isFetchingScaling:jl,isFetchingBinning:Xc,isFetchingHashEncoding:no.isFetching,isFetchingBinnedDistribution:gm,isFetchingRecommendations:Mr,catalogFlags:m}),{relativeGeneratedAt:ru,relativeScalingGeneratedAt:au,relativeBinningGeneratedAt:bg,relativeBinnedGeneratedAt:wg,relativeOutlierGeneratedAt:hi,scalingSampleSize:Ng,binningSampleSize:Lm,binnedSampleSize:zm,outlierSampleSize:Gt}=Pm,{hasActiveAsyncWork:ou,busyLabel:iu,footerBusyLabel:pi}=Gr,{updateImputerStrategies:jg,handleAddImputerStrategy:lu,handleRemoveImputerStrategy:gi,toggleImputerStrategySection:Ml,handleImputerMethodChange:oo,handleImputerOptionNumberChange:Rm,handleImputerColumnsChange:Cg,handleImputerColumnToggle:Sg,handleImputerMissingFilterChange:Dm}=Em,{updateAliasStrategies:cu,handleAddAliasStrategy:Al,handleRemoveAliasStrategy:uu,toggleAliasStrategySection:du,handleAliasModeChange:mu,handleAliasColumnToggle:fu,handleAliasColumnsChange:Eg,handleAliasAutoDetectToggle:Im}=eu,{updateDateStrategies:mC,handleAddDateStrategy:kg,handleRemoveDateStrategy:hu,toggleDateStrategySection:Xr,handleDateStrategyModeChange:Fm,handleDateStrategyColumnsChange:io,handleDateStrategyColumnToggle:fr,handleDateStrategyAutoDetectToggle:_i}=vg,{updateFeatureMathOperations:Qr,handleAddFeatureMathOperation:pu,handleDuplicateFeatureMathOperation:Mg,handleRemoveFeatureMathOperation:Ag,handleReorderFeatureMathOperation:wa,handleToggleFeatureMathOperation:yi,handleFeatureMathOperationChange:lo}=xg,Ol=N.useCallback(()=>{r&&_m()},[_m,r]),gu=q4({catalogFlags:m,binnedDistributionData:pm}),{renderMultiSelectField:Ds,renderParameterField:bt}=S4({nodeId:k,catalogFlags:m,configState:ht,previewState:ne,binning:At,scaling:Sn,selectedColumns:nr,availableColumns:Zt,filteredColumnOptions:wl,normalizedColumnSearch:St,columnSearch:Tn,setColumnSearch:Pn,columnSuggestions:ws,columnMissingMap:xs,columnTypeMap:Ln,sourceId:r,hasReachableSource:$e,recommendationsState:{isFetching:Mr,availableFilters:mr,activeFilterId:va,setActiveFilterId:mn,recommendations:ti,filteredRecommendations:ni,error:Jt,relativeGeneratedAt:ru,formatSignalName:si,refresh:Gc,show:Am},columnSelectionHandlers:{handleToggleColumn:rr,handleRemoveColumn:ao,handleApplyAllRecommended:tu,handleSelectAllColumns:Mm,handleClearColumns:El},parameterHandlers:{handleNumberChange:xt,handleBooleanChange:yn,handleTextChange:ys},thresholdRecommendations:{thresholdParameterName:Sl,normalizedSuggestedThreshold:_g,canApplySuggestedThreshold:sr,thresholdMatchesSuggestion:yg,handleApplySuggestedThreshold:di},numericExcludedColumns:ui,selectionCount:kl});return a.jsxs("div",{className:"canvas-modal",role:"dialog","aria-modal":"true","aria-labelledby":"node-settings-title",children:[a.jsx("div",{className:"canvas-modal__backdrop",onClick:t}),a.jsxs("div",{className:"canvas-modal__panel",children:[a.jsx(BL,{title:f,isDataset:h,onClose:t,canResetNode:ut,onResetNode:nu}),a.jsxs("div",{className:"canvas-modal__body",children:[P&&a.jsx(X4,{connectionInfo:P,connectedInputHandles:A,connectedOutputHandles:R,connectionReady:z}),jm&&a.jsx(vL,{thresholdParameter:b.dropMissing.threshold??null,dropIfAnyParameter:b.dropRows.any,renderParameterField:bt}),v&&a.jsx(yL,{thresholdParameter:b.dropMissing.threshold??null,dropColumnParameter:v,renderParameterField:bt,renderMultiSelectField:Ds}),B&&a.jsxs(a.Fragment,{children:[a.jsx(Ez,{suffix:Qc,insights:ym,formatMissingPercentage:Zn}),a.jsx(kz,{columnsParameter:b.missingIndicator.columns,suffixParameter:b.missingIndicator.suffix,renderParameterField:bt})]}),cn&&a.jsx(DL,{previewState:ne,datasetSourceId:r??null,canTriggerPreview:Pe,onRefresh:so,formatCellValue:QN,formatMetricValue:Ws,formatMissingPercentage:Zn,formatNumericStat:Ms,formatModeStat:Aw,nodeId:e==null?void 0:e.id,onUpdateNodeData:s}),a.jsx(FL,{isDatasetProfileNode:un,controller:Nl,formatCellValue:QN,formatNumericStat:Ms,formatMissingPercentage:Zn}),w&&a.jsx("section",{className:"canvas-modal__section",children:a.jsxs("p",{className:"canvas-modal__note",style:{display:"flex",alignItems:"start",gap:"0.5rem"},children:[a.jsx(C2,{size:16,style:{marginTop:"2px",flexShrink:0}}),a.jsxs("span",{children:[a.jsxs("strong",{children:[w.title,"."]})," ",w.body]})]})}),V&&a.jsx(PR,{sourceId:r,hasReachableSource:$e,columnsParameter:b.trimWhitespace.columns,modeParameter:b.trimWhitespace.mode,renderMultiSelectField:Ds,renderParameterField:bt,columnSummary:Zc.columnSummary,modeDetails:Zc.modeDetails,sampleMap:Zc.sampleMap}),te&&a.jsx(JR,{sourceId:r,hasReachableSource:$e,columnsParameter:b.removeSpecial.columns,modeParameter:b.removeSpecial.mode,replacementParameter:b.removeSpecial.replacement,renderMultiSelectField:Ds,renderParameterField:bt,columnSummary:Jc.columnSummary,modeDetails:Jc.modeDetails,sampleMap:Jc.sampleMap}),G&&a.jsx(rI,{sourceId:r,hasReachableSource:$e,columnsParameter:b.replaceInvalid.columns,modeParameter:b.replaceInvalid.mode,minValueParameter:b.replaceInvalid.minValue,maxValueParameter:b.replaceInvalid.maxValue,renderMultiSelectField:Ds,renderParameterField:bt,columnSummary:ba.columnSummary,modeDetails:ba.modeDetails,sampleMap:ba.sampleMap,selectedMode:ba.mode,minValue:ba.minValue,maxValue:ba.maxValue}),K&&a.jsx(PD,{sourceId:r,hasReachableSource:$e,columnsParameter:b.regexCleanup.columns,modeParameter:b.regexCleanup.mode,patternParameter:b.regexCleanup.pattern,replacementParameter:b.regexCleanup.replacement,renderMultiSelectField:Ds,renderParameterField:bt,columnSummary:li.columnSummary,modeDetails:li.modeDetails,sampleMap:li.sampleMap,selectedMode:li.selectedMode,replacementValue:li.replacementValue}),X&&a.jsx(gD,{sourceId:r,hasReachableSource:$e,columnsParameter:b.normalizeCase.columns,modeParameter:b.normalizeCase.mode,renderMultiSelectField:Ds,renderParameterField:bt,columnSummary:ci.columnSummary,modeDetails:ci.modeDetails,sampleMap:ci.sampleMap,selectedMode:ci.selectedMode}),ce&&a.jsx(NI,{operations:it,summaries:rt,collapsed:_t,onToggleCollapsed:yi,onAddOperation:pu,onDuplicateOperation:Mg,onRemoveOperation:Ag,onReorderOperation:wa,onOperationChange:lo,availableColumns:Zt,signals:Ae,previewStatus:ne.status,errorHandlingParameter:b.featureMath.errorHandling,allowOverwriteParameter:b.featureMath.allowOverwrite,defaultTimezoneParameter:b.featureMath.defaultTimezone,epsilonParameter:b.featureMath.epsilon,renderParameterField:bt}),Ce&&a.jsx(DI,{sourceId:r,hasReachableSource:$e,isFetching:ai.isFetching,error:ai.error,suggestions:ai.suggestions,metadata:ai.metadata,columnsParameter:b.ordinalEncoding.columns,autoDetectParameter:b.ordinalEncoding.autoDetect,maxCategoriesParameter:b.ordinalEncoding.maxCategories,outputSuffixParameter:b.ordinalEncoding.outputSuffix,dropOriginalParameter:b.ordinalEncoding.dropOriginal,encodeMissingParameter:b.ordinalEncoding.encodeMissing,handleUnknownParameter:b.ordinalEncoding.handleUnknown,unknownValueParameter:b.ordinalEncoding.unknownValue,selectedColumns:nr,renderParameterField:bt,onToggleColumn:rr,onApplyRecommended:ai.handleApplyRecommended,formatMissingPercentage:Zn}),Z&&a.jsx(MI,{sourceId:r,hasReachableSource:$e,isFetching:xa.isFetching,error:xa.error,suggestions:xa.suggestions,metadata:xa.metadata,columnsParameter:b.targetEncoding.columns,targetColumnParameter:b.targetEncoding.targetColumn,autoDetectParameter:b.targetEncoding.autoDetect,maxCategoriesParameter:b.targetEncoding.maxCategories,outputSuffixParameter:b.targetEncoding.outputSuffix,dropOriginalParameter:b.targetEncoding.dropOriginal,smoothingParameter:b.targetEncoding.smoothing,encodeMissingParameter:b.targetEncoding.encodeMissing,handleUnknownParameter:b.targetEncoding.handleUnknown,selectedColumns:nr,renderParameterField:bt,onToggleColumn:rr,onApplyRecommended:xa.handleApplyRecommended,formatMissingPercentage:Zn}),Te&&a.jsx(BI,{sourceId:r,hasReachableSource:$e,isFetching:oi.isFetching,error:oi.error,suggestions:oi.suggestions,metadata:oi.metadata,columnsParameter:b.dummyEncoding.columns,autoDetectParameter:b.dummyEncoding.autoDetect,maxCategoriesParameter:b.dummyEncoding.maxCategories,dropFirstParameter:b.dummyEncoding.dropFirst,includeMissingParameter:b.dummyEncoding.includeMissing,dropOriginalParameter:b.dummyEncoding.dropOriginal,prefixSeparatorParameter:b.dummyEncoding.prefixSeparator,selectedColumns:nr,renderParameterField:bt,onToggleColumn:rr,onApplyRecommended:oi.handleApplyRecommended,formatMissingPercentage:Zn}),De&&a.jsx(qI,{sourceId:r,hasReachableSource:$e,isFetching:ii.isFetching,error:ii.error,suggestions:ii.suggestions,metadata:ii.metadata,columnsParameter:b.oneHotEncoding.columns,autoDetectParameter:b.oneHotEncoding.autoDetect,maxCategoriesParameter:b.oneHotEncoding.maxCategories,dropFirstParameter:b.oneHotEncoding.dropFirst,includeMissingParameter:b.oneHotEncoding.includeMissing,dropOriginalParameter:b.oneHotEncoding.dropOriginal,prefixSeparatorParameter:b.oneHotEncoding.prefixSeparator,selectedColumns:nr,renderParameterField:bt,onToggleColumn:rr,onApplyRecommended:ii.handleApplyRecommended,formatMissingPercentage:Zn}),de&&a.jsx(JI,{nodeId:k,sourceId:r,hasReachableSource:$e,previewState:ne,onRefreshPreview:so,config:Dt,targetColumnParameter:b.featureTargetSplit.targetColumn,renderParameterField:bt,formatMetricValue:Ws,formatMissingPercentage:Zn}),_e&&a.jsx(t3,{nodeId:k,sourceId:r,hasReachableSource:$e,previewState:ne,onRefreshPreview:so,config:Ps,parameters:x,renderParameterField:bt,formatMetricValue:Ws}),_&&a.jsx(fF,{mode:pe?"oversampling":"undersampling",sourceId:r,hasReachableSource:$e,previewState:ne,onRefreshPreview:so,config:es,methodParameter:b.resampling.method,targetColumnParameter:b.resampling.targetColumn,samplingStrategyParameter:b.resampling.samplingStrategy,randomStateParameter:b.resampling.randomState,kNeighborsParameter:pe?b.resampling.kNeighbors:null,replacementParameter:ie?b.resampling.replacement:null,renderParameterField:bt,formatMetricValue:Ws,formatMissingPercentage:Zn,schemaGuard:nn}),(ge||Ee)&&a.jsx(o3,{sourceId:r,hasReachableSource:$e,previewState:ne,onRefreshPreview:so,config:ue,targetColumnParameter:b.trainModel.targetColumn,problemTypeParameter:b.trainModel.problemType,renderParameterField:bt,formatMetricValue:Ws,formatMissingPercentage:Zn,schemaColumns:nt}),ge&&a.jsx("div",{style:I,"aria-disabled":U,children:a.jsx(S3,{nodeId:k,sourceId:r,graph:Kt,config:ue,runtimeConfig:we,cvConfig:Fe,draftConfigState:ht,renderParameterField:bt,modelTypeParameter:b.trainModel.modelType,modelTypeOptions:gt,hyperparametersParameter:b.trainModel.hyperparameters,cvEnabledParameter:b.trainModel.cvEnabled,cvStrategyParameter:b.trainModel.cvStrategy,cvFoldsParameter:b.trainModel.cvFolds,cvShuffleParameter:b.trainModel.cvShuffle,cvRandomStateParameter:b.trainModel.cvRandomState,cvRefitStrategyParameter:b.trainModel.cvRefitStrategy,onSaveDraftConfig:fi})}),be&&a.jsx("div",{style:I,"aria-disabled":U,children:a.jsx(L3,{nodeId:k,sourceId:r,graph:Kt,config:ht,setConfigState:Bt,renderParameterField:bt,formatMetricValue:Ws,connectedSplitHandles:F})}),ze&&a.jsx("div",{style:I,"aria-disabled":U,children:a.jsx(Z3,{nodeId:k,sourceId:r,graph:Kt,parameters:x,config:dn,renderParameterField:bt})}),Ee&&a.jsx("div",{style:I,"aria-disabled":U,children:a.jsx(cF,{nodeId:k,sourceId:r,graph:Kt,config:ue,runtimeConfig:we,cvConfig:Fe,draftConfigState:ht,renderParameterField:bt,modelTypeParameter:b.trainModel.modelType,modelTypeOptions:gt,searchStrategyParameter:b.hyperparameterTuning.searchStrategy,searchIterationsParameter:b.hyperparameterTuning.searchIterations,searchRandomStateParameter:b.hyperparameterTuning.searchRandomState,scoringMetricParameter:b.hyperparameterTuning.scoringMetric,setDraftConfigState:Bt,onSaveDraftConfig:fi})}),J&&a.jsx(SI,{sourceId:r,hasReachableSource:$e,isFetching:ri.isFetching,error:ri.error,suggestions:ri.suggestions,metadata:ri.metadata,columnsParameter:b.labelEncoding.columns,autoDetectParameter:b.labelEncoding.autoDetect,maxUniqueParameter:b.labelEncoding.maxUnique,outputSuffixParameter:b.labelEncoding.outputSuffix,dropOriginalParameter:b.labelEncoding.dropOriginal,missingStrategyParameter:b.labelEncoding.missingStrategy,missingCodeParameter:b.labelEncoding.missingCode,selectedColumns:nr,renderParameterField:bt,onToggleColumn:rr,onApplyRecommended:ri.handleApplyRecommended,formatMissingPercentage:Zn}),ee&&a.jsx($I,{sourceId:r,hasReachableSource:$e,isFetching:no.isFetching,error:no.error,suggestions:no.suggestions,metadata:no.metadata,columnsParameter:b.hashEncoding.columns,autoDetectParameter:b.hashEncoding.autoDetect,maxCategoriesParameter:b.hashEncoding.maxCategories,bucketsParameter:b.hashEncoding.buckets,outputSuffixParameter:b.hashEncoding.outputSuffix,dropOriginalParameter:b.hashEncoding.dropOriginal,encodeMissingParameter:b.hashEncoding.encodeMissing,selectedColumns:nr,renderParameterField:bt,onToggleColumn:rr,onApplyRecommended:no.handleApplyRecommended,formatMissingPercentage:Zn}),Ye&&a.jsx(TI,{columnsParameter:b.polynomial.columns,autoDetectParameter:b.polynomial.autoDetect,degreeParameter:b.polynomial.degree,includeBiasParameter:b.polynomial.includeBias,interactionOnlyParameter:b.polynomial.interactionOnly,includeInputFeaturesParameter:b.polynomial.includeInputFeatures,outputPrefixParameter:b.polynomial.outputPrefix,renderParameterField:bt,signal:xe}),at&&a.jsx(LI,{columnsParameter:b.featureSelection.columns,autoDetectParameter:b.featureSelection.autoDetect,targetColumnParameter:b.featureSelection.targetColumn,methodParameter:b.featureSelection.method,scoreFuncParameter:b.featureSelection.scoreFunc,problemTypeParameter:b.featureSelection.problemType,kParameter:b.featureSelection.k,percentileParameter:b.featureSelection.percentile,alphaParameter:b.featureSelection.alpha,thresholdParameter:b.featureSelection.threshold,modeParameter:b.featureSelection.mode,estimatorParameter:b.featureSelection.estimator,stepParameter:b.featureSelection.step,minFeaturesParameter:b.featureSelection.minFeatures,maxFeaturesParameter:b.featureSelection.maxFeatures,dropUnselectedParameter:b.featureSelection.dropUnselected,renderParameterField:bt,signal:st}),Q&&a.jsx(gR,{hasSource:!!r,hasReachableSource:$e,strategies:tr.strategies,columnSummary:tr.columnSummary,columnOptions:tr.columnOptions,sampleMap:tr.sampleMap,collapsedStrategies:pa,onToggleStrategy:Xr,onRemoveStrategy:hu,onAddStrategy:kg,onModeChange:Fm,onColumnToggle:fr,onColumnsChange:io,onAutoDetectToggle:_i,modeOptions:wp}),D&&a.jsx(tR,{hasSource:!!r,hasReachableSource:$e,strategies:Rs.strategies,columnSummary:Rs.columnSummary,columnOptions:Rs.columnOptions,sampleMap:Rs.sampleMap,customPairSummary:Rs.customPairSummary,customPairsParameter:b.replaceAliases.customPairs,collapsedStrategies:pa,onToggleStrategy:du,onRemoveStrategy:uu,onAddStrategy:Al,onModeChange:mu,onAutoDetectToggle:Im,onColumnToggle:fu,onColumnsChange:Eg,renderParameterField:bt}),W&&a.jsx(_z,{hasSource:!!r,hasReachableSource:$e,strategies:Nn,columnOptions:Nm,methodOptions:Xt,missingFilter:qr,missingFilterMax:hg,missingFilterActive:gg,filteredOptionCount:pg,collapsedStrategies:pa,onToggleStrategy:Ml,onRemoveStrategy:gi,onAddStrategy:lu,onMethodChange:oo,onOptionNumberChange:Rm,onColumnsChange:Cg,onColumnToggle:Sg,onMissingFilterChange:Dm,formatMissingPercentage:Zn,formatNumericStat:Ms,formatModeStat:Aw,schemaDiagnostics:vn}),Oe&&a.jsx(NL,{configState:ht,setConfigState:Bt,availableColumns:Zt,columnTypeMap:Ln,columnSuggestions:ws,selectedColumns:nr,previewColumns:It,previewStatus:ne.status,sourceId:r,hasReachableSource:$e}),ot&&a.jsx(G4,{sourceId:r,hasReachableSource:$e,isFetchingOutliers:ag,outlierConfig:Qt.config,outlierMethodOptions:Qt.state.methodOptions,outlierMethodDetailMap:Qt.state.methodDetailMap,outlierDefaultDetail:Qt.state.defaultDetail,outlierAutoDetectEnabled:Qt.state.autoDetectEnabled,outlierSelectedCount:Qt.state.selectedCount,outlierDefaultLabel:Qt.state.defaultLabel,outlierOverrideCount:Qt.state.overrideCount,outlierParameterOverrideCount:Qt.state.parameterOverrideCount,outlierOverrideExampleSummary:Qt.state.overrideExampleSummary,outlierHasOverrides:Qt.state.hasOverrides,outlierRecommendationRows:Qt.state.recommendationRows,outlierHasRecommendations:Qt.state.hasRecommendations,outlierStatusMessage:Qt.state.statusMessage,outlierError:dm,outlierSampleSize:Gt,relativeOutlierGeneratedAt:hi,outlierPreviewSignal:Ve,formatMetricValue:Ws,formatNumericStat:Ms,onApplyAllRecommendations:Qt.handlers.handleApplyAllRecommendations,onClearOverrides:Qt.handlers.handleClearOverrides,onDefaultMethodChange:Qt.handlers.handleDefaultMethodChange,onAutoDetectToggle:Qt.handlers.handleAutoDetectToggle,onOverrideSelect:Qt.handlers.handleOverrideSelect,onMethodParameterChange:Qt.handlers.handleMethodParameterChange,onColumnParameterChange:Qt.handlers.handleColumnParameterChange}),Qe&&a.jsx(yz,{sourceId:r,hasReachableSource:$e,isFetchingScaling:jl,scalingConfig:Sn.config,scalingMethodOptions:Sn.state.methodOptions,scalingMethodDetailMap:Sn.state.methodDetailMap,scalingDefaultDetail:Sn.state.defaultDetail,scalingAutoDetectEnabled:Sn.state.autoDetectEnabled,scalingSelectedCount:Sn.state.selectedCount,scalingDefaultLabel:Sn.state.defaultLabel,scalingOverrideCount:Sn.state.overrideCount,scalingOverrideExampleSummary:Sn.state.overrideExampleSummary,scalingRecommendationRows:Sn.state.recommendationRows,scalingHasRecommendations:Sn.state.hasRecommendations,scalingStatusMessage:Sn.state.statusMessage,scalingError:ig,scalingSampleSize:Ng,relativeScalingGeneratedAt:au,formatMetricValue:Ws,formatNumericStat:Ms,formatMissingPercentage:Zn,onApplyAllRecommendations:Sn.handlers.handleApplyAllRecommendations,onClearOverrides:Sn.handlers.handleClearOverrides,onDefaultMethodChange:Sn.handlers.handleDefaultMethodChange,onAutoDetectToggle:Sn.handlers.handleAutoDetectToggle,onOverrideSelect:Sn.handlers.handleOverrideSelect}),qe&&a.jsxs(a.Fragment,{children:[a.jsx(oz,{hasSource:!!r,hasReachableSource:$e,isFetching:Xc,error:cg,relativeGeneratedAt:bg,sampleSize:Lm,binningConfig:At.config,binningDefaultLabel:At.state.defaultLabel,binningOverrideCount:At.state.overrideCount,binningOverrideSummary:At.state.overrideSummary,recommendations:At.state.insightsRecommendations,excludedColumns:At.state.insightsExcludedColumns,numericColumnCount:At.state.allNumericColumns.length,canApplyAllNumeric:At.state.canApplyAllNumeric,onApplyAllNumeric:At.handlers.handleApplyAllNumeric,onApplyStrategies:At.handlers.handleApplyStrategies,onClearOverrides:At.handlers.handleClearOverrides,customEdgeDrafts:At.state.customEdgeDrafts,customLabelDrafts:At.state.customLabelDrafts,onOverrideStrategyChange:At.handlers.handleOverrideStrategyChange,onOverrideNumberChange:At.handlers.handleOverrideNumberChange,onOverrideKbinsEncodeChange:At.handlers.handleOverrideKbinsEncodeChange,onOverrideKbinsStrategyChange:At.handlers.handleOverrideKbinsStrategyChange,onOverrideClear:At.handlers.handleClearOverride,onCustomBinsChange:At.handlers.handleCustomBinsChange,onCustomLabelsChange:At.handlers.handleCustomLabelsChange,onClearCustomColumn:At.handlers.handleClearCustomColumn,formatMetricValue:Ws,formatNumericStat:Ms}),a.jsx(sz,{config:At.config,fieldIds:At.state.fieldIds,onIntegerChange:At.handlers.handleIntegerChange,onBooleanToggle:At.handlers.handleBooleanToggle,onSuffixChange:At.handlers.handleSuffixChange,onLabelFormatChange:At.handlers.handleLabelFormatChange,onMissingStrategyChange:At.handlers.handleMissingStrategyChange,onMissingLabelChange:At.handlers.handleMissingLabelChange})]}),Nt&&a.jsx(jz,{sourceId:r,hasReachableSource:$e,isFetchingSkewness:ro,skewnessThreshold:rn.state.threshold,skewnessError:Cl,skewnessViewMode:rn.state.viewMode,skewnessRecommendedCount:rn.state.recommendedCount,skewnessNumericCount:rn.state.numericCount,skewnessGroupByMethod:rn.state.groupByMethod,skewnessRows:rn.state.rows,skewnessTableGroups:rn.state.tableGroups,hasSkewnessAutoRecommendations:rn.state.hasAutoRecommendations,skewnessTransformationsCount:rn.state.transformationsCount,isFetchingRecommendations:Mr,getSkewnessMethodLabel:rn.handlers.getMethodLabel,getSkewnessMethodStatus:rn.handlers.getMethodStatus,onApplyRecommendations:rn.handlers.applyRecommendations,onViewModeChange:rn.handlers.setViewMode,onGroupByToggle:rn.handlers.setGroupByMethod,onOverrideChange:rn.handlers.handleOverrideChange,onClearSelections:rn.handlers.clearTransformations}),Tt&&a.jsx(Sz,{skewnessThreshold:rn.state.threshold,isFetchingSkewness:ro,skewnessError:Cl,skewnessDistributionCards:rn.state.distributionCards,skewnessDistributionView:rn.state.distributionView,setSkewnessDistributionView:rn.handlers.setDistributionView,onRefresh:mg,canRefresh:vm}),tt&&a.jsx(iz,{cards:gu,selectedPreset:dr,onSelectPreset:En=>Qo(En),isFetching:gm,sampleSize:zm,relativeGeneratedAt:wg,error:ug,onRefresh:Ol,canRefresh:!!r}),Pt&&a.jsx(bL,{sourceId:r,hasReachableSource:$e,removeDuplicatesColumnsParameter:b.removeDuplicates.columns,removeDuplicatesKeepParameter:b.removeDuplicates.keep,renderMultiSelectField:Ds,removeDuplicatesKeepSelectId:to.removeDuplicatesKeepSelectId,removeDuplicatesKeep:to.removeDuplicatesKeep,onKeepChange:to.handleRemoveDuplicatesKeepChange}),Ft&&a.jsx(XI,{parameters:S,renderParameterField:bt}),et&&a.jsx(GI,{signal:ct,previewStatus:ne.status,hasSource:!!r,hasReachableSource:$e,onRefreshPreview:so})]}),a.jsx(UL,{onClose:t,canResetNode:wn,onResetNode:nu,showSaveButton:su,canSave:Om,onSave:fi,isBusy:ou,busyLabel:pi})]})]})},Hj=[{key:"train",label:"Train"},{key:"test",label:"Test"},{key:"validation",label:"Validation"}],la=Hj.map(e=>e.key),Z4=Hj.reduce((e,t)=>({...e,[t.key]:t.label}),{}),J4=e=>typeof e=="string"&&la.includes(e),ca=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(n=>{J4(n)&&t.add(n)}),la.filter(n=>t.has(n))},qj=(e,t)=>{const n=ca(e),s=ca(t);return n.length!==s.length?!1:n.every((r,i)=>r===s[i])},Vj=e=>!e||typeof e!="string"?null:la.find(t=>e.endsWith(`-${t}`))??null,Wj=(e,t)=>{if(t<=1)return"50%";const n=100/(t+1);return`${Math.round((e+1)*n)}%`},eB={train:e=>e.endsWith("-train"),validation:e=>e.endsWith("-validation"),test:e=>e.endsWith("-test"),model:e=>e.endsWith("-model-out"),params:e=>e.endsWith("-best-params-out")},Hc={hyperparameter_tuning:{inputs:[{key:"train-in",label:"Train Split",position:35,required:!0,accepts:["train"]},{key:"validation-in",label:"Validation Split",position:65,required:!0,accepts:["validation"]}],outputs:[{key:"best-params-out",label:"Best Params",position:50}]},train_model_draft:{inputs:[{key:"train-in",label:"Train Split",position:40,required:!0,accepts:["train"]},{key:"params-in",label:"Best Params",position:60,required:!1,accepts:["params"]}],outputs:[{key:"model-out",label:"Model",position:50}]},model_evaluation:{inputs:[{key:"train-in",label:"Train Split",position:20,required:!1,accepts:["train"]},{key:"test-in",label:"Test Split",position:40,required:!1,accepts:["test"]},{key:"validation-in",label:"Validation Split",position:60,required:!1,accepts:["validation"]},{key:"models-in",label:"Model",position:80,required:!0,accepts:["model"]}]},model_registry_overview:{inputs:[{key:"models-in",label:"Model",position:50,required:!0,accepts:["model"]}]}},Yj=(e,t,n)=>typeof e.position=="number"&&Number.isFinite(e.position)?`${Math.min(Math.max(e.position,5),95)}%`:Wj(t,n),tB=e=>e.required===!1?`${e.label} (optional)`:`${e.label} (required)`,nB=e=>e.required===!1?`${e.label} (optional)`:`${e.label} (required)`,Kj=(e,t)=>{if(!t||typeof t!="string")return null;const n=`${e}-`;if(t.startsWith(n))return t.slice(n.length);const s=t.split("-");return s.length>=2?s.slice(-2).join("-"):t},sB=e=>({width:`${kj}px`,height:`${kj}px`,borderRadius:"999px",border:e==="target"?"1px solid rgba(148, 163, 184, 0.55)":"1px solid rgba(45, 212, 191, 0.55)",background:e==="target"?"rgba(148, 163, 184, 0.22)":"rgba(45, 212, 191, 0.18)",boxShadow:e==="target"?"0 0 0 3px rgba(148, 163, 184, 0.18)":"0 0 0 3px rgba(45, 212, 191, 0.18)",backdropFilter:"blur(2px)"}),rB=({id:e,data:t,selected:n})=>{var b;const s=(t==null?void 0:t.label)??e,r=!!((t==null?void 0:t.isDataset)??e==="dataset-source"),i=(t==null?void 0:t.isRemovable)??!r,l=(t==null?void 0:t.catalogType)==="train_test_split",u=r?"Primary dataset input":void 0,d=(t==null?void 0:t.description)??u,p=(t==null?void 0:t.catalogType)==="drop_missing_columns"||d===Aj?Oj:d,m=(t==null?void 0:t.backgroundExecutionStatus)??"idle",_=!((t==null?void 0:t.hasRequiredConnections)??!0),x=(t==null?void 0:t.catalogType)??"",y=["hyperparameter_tuning","train_model_draft","model_evaluation","model_registry_overview"].includes(x),v=N.useCallback(S=>{var E;S.stopPropagation(),(E=t==null?void 0:t.onRemoveNode)==null||E.call(t,e)},[t,e]),w=N.useMemo(()=>{if(r)return[];const S=(t==null?void 0:t.catalogType)??"",E=S?Hc[S]:void 0;if(E!=null&&E.inputs&&E.inputs.length){const M=E.inputs.length;return E.inputs.map((O,$)=>({position:Le.Left,id:`${e}-${O.key}`,label:tB(O),style:{top:Yj(O,$,M)}}))}return[{position:Le.Left,id:`${e}-target`},{position:Le.Top,id:`${e}-target-top`}]},[t==null?void 0:t.catalogType,e,r]),k=N.useMemo(()=>{if(r)return[{position:Le.Left,id:`${e}-source-left`},{position:Le.Right,id:`${e}-source`},{position:Le.Top,id:`${e}-source-top`},{position:Le.Bottom,id:`${e}-source-bottom`}];const S=(t==null?void 0:t.catalogType)??"",E=S?Hc[S]:void 0;if(E!=null&&E.outputs&&E.outputs.length){const $=E.outputs.length;return E.outputs.map((P,A)=>({position:Le.Right,id:`${e}-${P.key}`,label:P.label,style:{top:Yj(P,A,$)}}))}const M=l?la:ca((t==null?void 0:t.activeSplits)??[]),O=ca((t==null?void 0:t.connectedSplits)??[]);if(M.length){const $=M.length;return M.map((P,A)=>({position:Le.Right,id:`${e}-${P}`,style:{top:Wj(A,$)},label:(()=>{var F;const R=Z4[P];if(l){if(P==="validation"&&!(Number(((F=t==null?void 0:t.config)==null?void 0:F.validation_size)??0)>0))return`${R} (disabled)`;if(!O.includes(P))return`${R} (not set)`}return R})()}))}return[{position:Le.Right,id:`${e}-source`},{position:Le.Bottom,id:`${e}-source-bottom`}]},[t==null?void 0:t.activeSplits,t==null?void 0:t.catalogType,t==null?void 0:t.connectedSplits,(b=t==null?void 0:t.config)==null?void 0:b.validation_size,e,r,l]),j=N.useCallback((S,E)=>{const{position:M,id:O,style:$,label:P}=S,A=O.includes("-train")||O.includes("-test")||O.includes("-validation");return a.jsxs(ve.Fragment,{children:[a.jsx(ic,{type:E,position:M,id:O,className:`feature-node__handle feature-node__handle--${E}`,style:{...sB(E),...$??{},...A?{opacity:1,visibility:"visible",pointerEvents:"all"}:{}}}),P&&E==="source"&&a.jsx("div",{className:"feature-node__handle-label",style:{position:"absolute",right:"-8px",top:($==null?void 0:$.top)||"50%",transform:"translate(100%, calc(-100% - 8px))",fontSize:"0.7rem",fontWeight:"600",color:"rgba(148, 163, 184, 0.9)",background:"rgba(15, 23, 42, 0.95)",padding:"3px 8px",borderRadius:"4px",whiteSpace:"nowrap",pointerEvents:"none",zIndex:100,border:"1px solid rgba(71, 85, 105, 0.5)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:P}),P&&E==="target"&&a.jsx("div",{className:"feature-node__handle-label",style:{position:"absolute",left:"-8px",top:($==null?void 0:$.top)||"50%",transform:"translate(-100%, calc(-100% - 8px))",fontSize:"0.7rem",fontWeight:"600",color:"rgba(148, 163, 184, 0.9)",background:"rgba(15, 23, 42, 0.95)",padding:"3px 8px",borderRadius:"4px",whiteSpace:"nowrap",pointerEvents:"none",zIndex:100,border:"1px solid rgba(71, 85, 105, 0.5)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:P})]},O)},[]);return a.jsxs("div",{className:`feature-node${n?" feature-node--selected":""}${r?" feature-node--dataset":""}`,children:[w.map(S=>j(S,"target")),a.jsxs("div",{className:"feature-node__header",children:[a.jsxs("div",{className:"feature-node__title-group",children:[a.jsx("span",{className:"feature-node__drag-handle","aria-hidden":"true",children:""}),a.jsx("span",{className:"feature-node__title",children:s})]}),a.jsxs("div",{className:"feature-node__controls",children:[_&&y&&a.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--warning",title:"Required connections missing",style:{background:"rgba(251, 191, 36, 0.2)",color:"rgb(245, 158, 11)",border:"1px solid rgba(245, 158, 11, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(za,{size:12})}),m==="loading"&&a.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--loading",title:"Loading full dataset in background...",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(Gx,{size:12,className:"feature-node__spinner"})}),m==="success"&&a.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--success",title:"Full dataset ready",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(zh,{size:12})}),m==="error"&&a.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--error",title:"Background execution failed",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(w2,{size:12})}),i&&a.jsx("button",{className:"feature-node__control feature-node__control--danger",type:"button",onClick:v,title:"Remove node",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(qi,{size:12})})]})]}),p&&a.jsx("p",{className:"feature-node__description",children:p}),k.map(S=>j(S,"source"))]})},aB=[{id:"dataset-source",type:"featureNode",position:{x:-200,y:0},data:{label:"Dataset input",description:"Start from the currently selected dataset",isDataset:!0,isRemovable:!1,isConfigured:!0},style:{background:"linear-gradient(165deg, rgba(30, 64, 175, 0.9), rgba(59, 130, 246, 0.85))",border:"1px solid rgba(59, 130, 246, 0.55)",color:"#e0f2fe",fontWeight:600}}],oB=[],iB=e=>({...e,data:{...e.data??{}}}),cm=()=>aB.map(e=>iB(e)),lB=()=>oB.map(e=>({...e})),cB=12,uB=e=>{const n=`Dataset input
(${e&&e.trim()?e.trim():"Demo dataset"})`;return{nodes:[{id:"dataset-source",type:"featureNode",position:{x:-200,y:40},data:{label:n,isDataset:!0,isRemovable:!1},style:{whiteSpace:"pre-line",background:"#eef2ff",border:"1px solid rgba(99, 102, 241, 0.35)",color:"#312e81",fontWeight:600}},{id:"node-1",type:"featureNode",position:{x:260,y:40},data:{label:`Profile columns
(assess types & nulls)`},style:{whiteSpace:"pre-line",background:"linear-gradient(165deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.85))"}},{id:"node-4",type:"featureNode",position:{x:600,y:60},data:{label:`Feature preview
(sample rows)`},style:{whiteSpace:"pre-line",background:"linear-gradient(165deg, rgba(8, 145, 178, 0.42), rgba(2, 132, 199, 0.32))"}}],edges:[{id:"edge-dataset-profile",source:"dataset-source",target:"node-1",animated:!0,type:"animatedEdge",sourceHandle:"dataset-source-source",targetHandle:"node-1-target"},{id:"edge-profile-preview",source:"node-1",target:"node-4",animated:!0,type:"animatedEdge",sourceHandle:"node-1-source",targetHandle:"node-4-target"}]}},dB=(e,t,n)=>{if(!t||typeof t.project!="function"||!n)return;const s=n.getBoundingClientRect(),r=t.project({x:s.width/2,y:s.height/2});if(!r)return;const i=e.filter(m=>m.id!=="dataset-source").length,l=[{x:0,y:0},{x:220,y:0},{x:-220,y:0},{x:0,y:180},{x:220,y:180},{x:-220,y:180},{x:0,y:-180},{x:220,y:-180},{x:-220,y:-180}],u=i%l.length,d=Math.floor(i/l.length),f=l[u],p=d+1;return{x:r.x+f.x*p,y:r.y+f.y*p}},mB=new Set(["binned_distribution","skewness_distribution","skewness_transform","binning_discretization","label_encoding","target_encoding","ordinal_encoding","dummy_encoding","one_hot_encoding","hash_encoding","scale_numeric_features","polynomial_features","feature_selection","feature_math","missing_value_indicator","trim_whitespace","normalize_text_case","replace_aliases_typos","standardize_date_formats","remove_special_characters","replace_invalid_values","regex_replace_fix","class_undersampling","class_oversampling","feature_target_split","train_test_split","train_model_draft","model_evaluation","hyperparameter_tuning"]),Gj=(e,t)=>{if(!e)return!1;if(mB.has(e))return!0;const n=t==null?void 0:t.get(e);return n?(typeof n.category=="string"?n.category.toLowerCase():"").includes("preprocess"):!1},Xj=(e,t)=>{var b,S,E,M,O,$;const{handleOpenSettings:n,handleRemoveNode:s,catalogEntryMap:r}=t,i=e.data??{},l=i.isDataset??e.id==="dataset-source",u={...e.style??{}},d=i.catalogType??i.type??e.id;let p=Array.isArray(i.parameters)?i.parameters:null;if((!p||p.length===0)&&typeof d=="string"){const P=r.get(d)??null;(b=P==null?void 0:P.parameters)!=null&&b.length&&(p=P.parameters)}const m=IF(p);let h;if(m.length||i.config&&typeof i.config=="object"){const P=Ic(i.config);m.forEach(A=>{A!=null&&A.name&&P[A.name]===void 0&&A.default!==void 0&&(Array.isArray(A.default)?P[A.name]=[...A.default]:A.type==="boolean"?P[A.name]=!!A.default:P[A.name]=A.default)}),h=P}u.width||(u.width=l?Mj+20:Mj),u.minHeight||(u.minHeight=LF),u.padding||(u.padding=12),u.borderRadius||(u.borderRadius=16),u.boxSizing=u.boxSizing??"border-box",u.whiteSpace=u.whiteSpace??"pre-line",u.background||(u.background=l?"linear-gradient(165deg, rgba(30, 64, 175, 0.9), rgba(59, 130, 246, 0.85))":"linear-gradient(160deg, rgba(30, 41, 59, 0.92), rgba(15, 23, 42, 0.92))"),u.border||(u.border=l?"1px solid rgba(59, 130, 246, 0.55)":"1px solid rgba(148, 163, 184, 0.22)"),u.boxShadow||(u.boxShadow=l?"0 24px 54px rgba(59, 130, 246, 0.28)":"0 18px 42px rgba(2, 6, 23, 0.45)"),u.color||(u.color=l?"#e0f2fe":"#e2e8f0"),u.fontWeight||(u.fontWeight=l?600:500);const _=DF(i.description,d),x=sm(d),y=h??(i.config&&typeof i.config=="object"?Ic(i.config):void 0);y&&typeof y=="object"&&x&&delete y[qa];const v={...i,label:i.label??e.id,description:_,isDataset:l,isRemovable:i.isRemovable??!l,isConfigured:l||i.isConfigured===!0?!0:i.config&&typeof i.config=="object"?x?!0:!i.config[qa]:!1,inputs:Array.isArray(i.inputs)?[...i.inputs]:i.inputs,outputs:Array.isArray(i.outputs)?[...i.outputs]:i.outputs,category:i.category,parameters:m,config:y,catalogType:d,onRemoveNode:s,onOpenSettings:n},w=typeof d=="string"?Hc[d]:void 0;if(w){const P=((S=w.inputs)==null?void 0:S.map(R=>nB(R)))??[],A=((E=w.outputs)==null?void 0:E.map(R=>R.label))??[];P.length?v.inputs=P:delete v.inputs,A.length?v.outputs=A:delete v.outputs,v.connectionInfo={inputs:((M=w.inputs)==null?void 0:M.map(R=>({...R})))??[],outputs:((O=w.outputs)==null?void 0:O.map(R=>({...R})))??[]}}else(!v.inputs||v.inputs.length===0)&&delete v.inputs,(!v.outputs||v.outputs.length===0)&&delete v.outputs,delete v.connectionInfo;const k=ca(v.activeSplits);k.length?v.activeSplits=k:delete v.activeSplits;const j=ca(v.connectedSplits);return j.length?v.connectedSplits=j:delete v.connectedSplits,d==="train_test_split"&&(v.activeSplits=[...la],j.length||delete v.connectedSplits),($=v.parameters)!=null&&$.length||delete v.parameters,v.config===void 0&&delete v.config,{...e,type:"featureNode",position:e.position??{x:0,y:0},data:v,style:u}},fB=(e,t,n,s,r)=>{const i=(e==null?void 0:e.label)??(e==null?void 0:e.type)??s,l=typeof i=="string"&&i.trim()?i:s,u=rm(e),d=sm((e==null?void 0:e.type)??null);return Xj({id:t,type:"featureNode",position:n,data:{label:l,description:e==null?void 0:e.description,inputs:e==null?void 0:e.inputs,outputs:e==null?void 0:e.outputs,category:e==null?void 0:e.category,parameters:e==null?void 0:e.parameters,config:u,catalogType:e==null?void 0:e.type,isConfigured:!!d}},r)},hB=(e,t)=>{const n=e.map(r=>{const{data:i,...l}=r,u=i?{...i}:void 0;return u&&(delete u.onRemoveNode,delete u.onOpenSettings),JSON.parse(JSON.stringify({...l,data:u}))}),s=t.map(r=>JSON.parse(JSON.stringify(r)));return{nodes:n,edges:s}},pB=e=>{var _;const[t,n]=N.useState(e??null),[s,r]=N.useState(null),i=Es({queryKey:["feature-canvas","datasets"],queryFn:()=>Jb(12),staleTime:5*60*1e3}),l=i.data??[],u=N.useMemo(()=>l.filter(x=>(x==null?void 0:x.is_owned)!==!1),[l]);N.useEffect(()=>{if(!l.length){r(null);return}if(t){const y=l.find(v=>v.source_id===t);if(y){r(v=>(v==null?void 0:v.id)===y.id?v:y);return}}const x=u[0]??l[0];x&&(t||n(x.source_id??String(x.id)),r(x))},[t,l,u]);const d=N.useMemo(()=>l.map(x=>({value:x.source_id,label:x.name??x.source_id,isOwned:x.is_owned!==!1})),[l]),f=u.length>1,p=l.length>0,m=u.length,h=i.error?((_=i.error)==null?void 0:_.message)??"Unable to load datasets":null;return{datasets:l,ownedDatasets:u,selectedDataset:s,setSelectedDataset:r,activeSourceId:t,setActiveSourceId:n,datasetOptions:d,canSelectDatasets:f,hasDatasets:p,ownedDatasetsCount:m,isDatasetLoading:i.isLoading,datasetErrorMessage:h}},gB=({sourceId:e,setIsDirty:t,setSaveFeedback:n,isHydratingRef:s})=>{const r=pB(e),{datasets:i,setActiveSourceId:l,setSelectedDataset:u}=r,d=N.useCallback(f=>{const p=i.find(m=>m.source_id===f)??null;if(!p){n({message:"Dataset unavailable. Choose another option.",tone:"error"});return}if(p.is_owned===!1){n({message:"Only datasets you own can be selected.",tone:"error"});return}l(f),u(p),s.current=!0,t(!1),n(null)},[i,s,l,t,n,u]);return{...r,handleDatasetSelection:d}},_B=({nodes:e,setEdges:t,scheduleNodeInternalsUpdate:n})=>{const s=N.useCallback(i=>{var _,x;const{source:l,target:u,sourceHandle:d,targetHandle:f}=i;if(!l||!u||!f||l===u)return!1;const p=e.find(y=>y.id===u);if(!p)return!1;const m=((_=p==null?void 0:p.data)==null?void 0:_.catalogType)??"",h=m?Hc[m]:void 0;if((x=h==null?void 0:h.inputs)!=null&&x.length){const y=Kj(u,f);if(!y)return!1;const v=h.inputs.find(w=>w.key===y);return!v||!d?!1:v.accepts&&v.accepts.length>0?v.accepts.some(w=>{const k=eB[w];return k?k(d):!1}):!0}return!0},[e]),r=N.useCallback(i=>{t(u=>Nv({...i,type:"animatedEdge",animated:!0},u));const l=[i.source,i.target].filter(u=>!!u);l.length&&n(l)},[n,t]);return{isValidConnection:s,onConnect:r}},yB=({setNodes:e,setEdges:t,setSelectedNodeId:n,setIsSettingsModalOpen:s,catalogEntryMapRef:r,handleOpenSettings:i,reactFlowInstanceRef:l,canvasViewportRef:u,scheduleFitView:d})=>{const f=N.useRef(0),p=N.useCallback(j=>{j!=="dataset-source"&&(e(b=>b.filter(S=>S.id!==j)),t(b=>b.filter(S=>S.source!==j&&S.target!==j)),n(b=>b===j?(s(!1),null):b))},[t,s,e,n]),m=N.useCallback(j=>Xj(j,{handleOpenSettings:i,handleRemoveNode:p,catalogEntryMap:r.current}),[r,i,p]),h=N.useCallback(j=>{const b=j.reduce((S,E)=>{if(typeof E.id=="string"&&E.id.startsWith("node-")){const M=Number(E.id.replace("node-",""));if(!Number.isNaN(M))return Math.max(S,M)}return S},0);b>f.current&&(f.current=b)},[]),_=N.useCallback((j,b)=>{const S=f.current+1,E=`node-${S}`;f.current=S;const M=b??{x:160+(S-1)%4*220,y:40+Math.floor((S-1)/4)*160};return m(fB(j??null,E,M,`Step ${S}`,{handleOpenSettings:i,handleRemoveNode:p,catalogEntryMap:r.current}))},[r,i,p,m]),x=N.useCallback(j=>{e(b=>{const S=dB(b,l.current,u.current),E=_(j,S);return[...b,E]}),d()},[u,_,l,d,e]),y=N.useCallback((j,b)=>{e(S=>S.map(E=>{if(E.id!==j)return E;const M=Ic(b);M&&typeof M=="object"&&delete M[qa];const O={...E.data??{},config:M,isConfigured:!0};return m({...E,data:O})}))},[m,e]),v=N.useCallback((j,b)=>{e(S=>S.map(E=>{if(E.id!==j)return E;const M={...E.data??{},...b};return m({...E,data:M})}))},[m,e]),w=N.useCallback((j,b)=>{e(S=>S.map(E=>{var A;if(E.id!==j)return E;const M=(A=E==null?void 0:E.data)==null?void 0:A.catalogType,O=M?r.current.get(M)??null:null,$=b&&typeof b=="object"?Ic(b):rm(O??null),P={...E.data??{},config:$,isConfigured:!1,backgroundExecutionStatus:"idle"};return m({...E,data:P})}))},[r,m,e]),k=N.useCallback(()=>{e(j=>j.map(b=>{var $,P;if(!Gj(($=b==null?void 0:b.data)==null?void 0:$.catalogType,r.current))return b;const S=(P=b==null?void 0:b.data)==null?void 0:P.catalogType,E=S?r.current.get(S)??null:null,M=rm(E??null),O={...b.data??{},config:M,isConfigured:!1,backgroundExecutionStatus:"idle"};return m({...b,data:O})}))},[r,m,e]);return{registerNode:m,createNode:_,handleAddNode:x,handleRemoveNode:p,handleUpdateNodeConfig:y,handleUpdateNodeData:v,handleResetNodeConfig:w,handleResetAllNodes:k,updateNodeCounter:h}},vB=new Set(["train_model_draft","model_registry_overview","model_evaluation","hyperparameter_tuning"]),xB=e=>{var n;const t=e?Hc[e]:void 0;return(n=t==null?void 0:t.inputs)!=null&&n.length?t.inputs.filter(s=>s.required!==!1).map(s=>s.key):[]},bB=(e,t,n)=>{const s=xB(t);if(s.length===0)return!0;const r=n.filter(l=>l.target===e),i=new Set(r.map(l=>Kj(e,l.targetHandle)).filter(l=>!!l));return s.every(l=>i.has(l))},wB=(e,t)=>{const n=new Map,s=new Set;e.forEach(d=>{var p;const f=(p=d==null?void 0:d.data)==null?void 0:p.catalogType;if(f&&vB.has(f)){s.add(d.id);return}f==="train_test_split"&&n.set(d.id,new Set(la))});let r=!0,i=0;const l=e.length*3;for(;r&&i<l;)r=!1,i++,t.forEach(d=>{if(s.has(d.source)||s.has(d.target))return;const f=n.get(d.source),p=Vj(d.sourceHandle);if(!f||f.size===0)return;n.has(d.target)||n.set(d.target,new Set);const m=n.get(d.target),h=m.size;p?f.has(p)&&m.add(p):f.forEach(_=>m.add(_)),m.size>h&&(r=!0)});const u=new Map;return n.forEach((d,f)=>{!d.size||s.has(f)||u.set(f,la.filter(p=>d.has(p)))}),u},NB=e=>{const t=new Map;e.forEach(s=>{const r=Vj(s.sourceHandle);r&&(t.has(s.source)||t.set(s.source,new Set),t.get(s.source).add(r))});const n=new Map;return t.forEach((s,r)=>{n.set(r,la.filter(i=>s.has(i)))}),n},jB=({edges:e,setNodes:t,scheduleNodeInternalsUpdate:n})=>{N.useEffect(()=>{const s=[];t(r=>{const i=wB(r,e),l=NB(e);let u=!1;const d=r.map(f=>{var E,M,O,$,P;const m=((E=f==null?void 0:f.data)==null?void 0:E.catalogType)==="train_test_split"?[...la]:i.get(f.id)??[],h=ca((M=f.data)==null?void 0:M.activeSplits),_=ca(l.get(f.id)),x=ca((O=f.data)==null?void 0:O.connectedSplits),y=(($=f==null?void 0:f.data)==null?void 0:$.catalogType)??"",v=bB(f.id,y,e),w=((P=f.data)==null?void 0:P.hasRequiredConnections)??!0,k=!qj(h,m),j=!qj(x,_);if(!k&&!j&&!(v!==w))return f;const S={...f.data,hasRequiredConnections:v};return m.length?S.activeSplits=m:delete S.activeSplits,_.length?S.connectedSplits=_:delete S.connectedSplits,(k||j)&&s.push(f.id),u=!0,{...f,data:S}});return u?d:r}),s.length&&n(s)},[e,n,t])},Qj=(e,t)=>({nodes:JSON.parse(JSON.stringify(e??[])),edges:JSON.parse(JSON.stringify(t??[]))}),Zj=e=>Array.isArray(e)?e.some(t=>(t==null?void 0:t.id)&&t.id!=="dataset-source"):!1,Jj=e=>Array.isArray(e)?e.length>0:!1,CB=({setIsDirty:e,setSaveFeedback:t,isHydratingRef:n})=>{const s=N.useRef({nodes:[],edges:[]}),[r,i]=N.useState(!1),l=N.useCallback((d,f)=>{const p=Qj(d,f);s.current=p;const m=Zj(p.nodes),h=Jj(p.edges);return i(m||h),{hasCustomNodes:m,hasEdges:h}},[]),u=N.useCallback((d,f)=>{const p=Qj(d,f),m=s.current,h=JSON.stringify(m.nodes??[])===JSON.stringify(p.nodes??[])&&JSON.stringify(m.edges??[])===JSON.stringify(p.edges??[]);s.current=p;const _=Zj(p.nodes),x=Jj(p.edges);i(_||x),!(n.current||h)&&(e(!0),t(null))},[n,e,t]);return{graphSnapshotRef:s,canClearCanvas:r,handleGraphChange:u,applyHydratedSnapshot:l}},SB=({canvasShellRef:e,canClearCanvas:t,setSaveFeedback:n})=>N.useCallback(()=>{var s;t&&(typeof window<"u"&&!window.confirm("Clear all nodes and connections from the canvas? This cannot be undone.")||((s=e.current)==null||s.clearGraph(),n(r=>(r==null?void 0:r.tone)==="error"?r:{message:"Canvas cleared. Unsaved edits pending.",tone:"info"})))},[e,t,n]),EB=({activeSourceId:e,isDirty:t,setSaveFeedback:n,pipelineQueryKey:s,pendingHistoryIdRef:r,isHydratingRef:i,historyLimit:l=cB})=>{var p;const u=$a(),d=Es({queryKey:["feature-canvas","pipeline-history",e],queryFn:()=>hw(e,l),enabled:!!e,staleTime:30*1e3,retry:1}),f=N.useCallback(m=>{if(!(m!=null&&m.graph)){n({message:"Selected revision is missing pipeline data.",tone:"error"});return}t&&typeof window<"u"&&!window.confirm("You have unsaved changes. Replace the canvas with the selected revision?")||(r.current=m.id??null,i.current=!0,n({message:`Loading revision ${m.name??`#${m.id}`}`,tone:"info"}),u.setQueryData(s,m))},[t,i,r,s,u,n]);return{historyItems:d.data??[],isHistoryLoading:d.isLoading||d.isFetching,historyErrorMessage:d.error?((p=d.error)==null?void 0:p.message)??"Unable to load history":null,refetchHistory:d.refetch,handleHistorySelection:f}},eC=e=>{if(!e)return null;let t=e.trim();if(!t)return null;/^\d{4}-\d{2}-\d{2}\s+\d/.test(t)&&(t=t.replace(" ","T")),/(Z|z|[+-]\d{2}:?\d{2})$/.test(t)||(t=`${t}Z`);const n=new Date(t);return Number.isNaN(n.getTime())?null:n},eg=e=>{const t=eC(e);return t?t.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"Unknown time"},tg=e=>{const t=eC(e);if(!t)return null;const n=t.getTime(),s=Date.now()-n,r=Math.round(s/6e4);if(r<1)return"just now";if(r===1)return"1 minute ago";if(r<60)return`${r} minutes ago`;const i=Math.round(r/60);if(i===1)return"1 hour ago";if(i<24)return`${i} hours ago`;const l=Math.round(i/24);if(l===1)return"1 day ago";if(l<7)return`${l} days ago`;const u=Math.round(l/7);return u===1?"1 week ago":`${u} weeks ago`},kB=({applyHydratedSnapshot:e,selectedDataset:t,activeSourceId:n,setActivePipelineId:s,setActivePipelineName:r,setActivePipelineUpdatedAt:i,setIsDirty:l,setSaveFeedback:u,pendingHistoryIdRef:d,isHydratingRef:f})=>{const p=N.useCallback(h=>{const{nodes:_,edges:x,pipeline:y,context:v}=h,{hasCustomNodes:w}=e(_,x),k=(y==null?void 0:y.id)??null;if(s(k),r((y==null?void 0:y.name)??null),i((y==null?void 0:y.updated_at)??null),v==="stored"&&y)if(d.current===y.id){const b=tg(y.updated_at)??eg(y.updated_at);u({message:`Saved revision ${y.name??`#${y.id}`} (${b})`,tone:"info"}),d.current=null}else f.current&&u(j=>(j==null?void 0:j.tone)==="error"?j:w?{message:"Loaded saved pipeline",tone:"info"}:j);else v==="sample"?(d.current=null,u(j=>(j==null?void 0:j.tone)==="error"||w?j:{message:`Showing starter pipeline for ${(t==null?void 0:t.name)??(t==null?void 0:t.source_id)??n??"demo dataset"}`,tone:"info"})):v==="reset"?d.current=null:y||(d.current=null,u(j=>(j==null?void 0:j.tone)==="error"?j:null));f.current&&l(!1),y&&d.current&&d.current!==y.id&&(d.current=null),f.current=!1},[n,e,d,t,s,r,i,l,u,f]),m=N.useCallback(h=>{u({message:(h==null?void 0:h.message)??"Unable to load saved pipeline. Starting fresh.",tone:"error"})},[u]);return{handlePipelineHydrated:p,handlePipelineError:m}},MB=({sourceId:e,datasetDisplayLabel:t,registerNode:n,prepareNodes:s,setNodes:r,setEdges:i,updateNodeCounter:l,scheduleFitView:u,onPipelineHydrated:d,onPipelineError:f})=>{const p=N.useRef(!1),m=Es({queryKey:["feature-canvas","pipeline",e],queryFn:()=>mw(e),enabled:!!e,staleTime:60*1e3,retry:1});return N.useEffect(()=>{const h=`Dataset input
(${t})`;if(!e){if(p.current)r(_=>{let x=!1;const y=_.map(v=>{var k;return v.id!=="dataset-source"||(((k=v==null?void 0:v.data)==null?void 0:k.label)??"")===h?v:(x=!0,n({...v,data:{...v.data??{},label:h,isDataset:!0,isRemovable:!1}}))});return x?y:_});else{const _=uB(t),x=s(_.nodes);p.current=!0,r(x),i(_.edges),l(x),u(),d==null||d({nodes:x,edges:_.edges,pipeline:null,context:"sample"})}return}if(p.current=!1,m.isLoading){r(_=>_.map(x=>x.id==="dataset-source"?n({...x,data:{...x.data??{},label:h,isDataset:!0,isRemovable:!1}}):x));return}if(m.isError){const _=m.error??new Error("Failed to load saved pipeline");console.error("Failed to load saved pipeline",_),f==null||f(_);const x=cm().map(v=>v.id==="dataset-source"?{...v,data:{...v.data??{},label:h,isDataset:!0,isRemovable:!1}}:v),y=s(x);r(y),i([]),l(y),u(),d==null||d({nodes:y,edges:[],pipeline:null,context:"reset"});return}if(m.data){const _=m.data.graph??{},x=Array.isArray(_==null?void 0:_.nodes)&&_.nodes.length?_.nodes:cm(),y=s(x),w=(Array.isArray(_==null?void 0:_.edges)?_.edges:[]).map(k=>{var P;const j=k==null?void 0:k.type,b=!j||j==="smoothstep"||j==="default"?"animatedEdge":j,S=k==null?void 0:k.source,E=k==null?void 0:k.target,M=y.find(A=>A.id===E),O=(k==null?void 0:k.sourceHandle)??(S?`${S}-source`:void 0),$=(k==null?void 0:k.targetHandle)??((P=M==null?void 0:M.data)!=null&&P.isDataset?void 0:E?`${E}-target`:void 0);return{...k,animated:(k==null?void 0:k.animated)??!0,type:b,sourceHandle:O,targetHandle:$}});r(y),i(w),l(y),u(),d==null||d({nodes:y,edges:w,pipeline:m.data??null,context:"stored"});return}if(m.isFetched&&!m.data){const _=cm().map(y=>y.id==="dataset-source"?{...y,data:{...y.data??{},label:h,isDataset:!0,isRemovable:!1}}:y),x=s(_);r(x),i([]),l(x),u(),d==null||d({nodes:x,edges:[],pipeline:null,context:"sample"})}},[t,d,f,m.data,m.error,m.isError,m.isFetched,m.isLoading,s,n,u,i,r,e,l]),{isPipelineLoading:m.isLoading||m.isFetching}},AB=({queryClient:e,setSaveFeedback:t,setIsDirty:n,setActivePipelineId:s,setActivePipelineName:r,setActivePipelineUpdatedAt:i,pendingHistoryIdRef:l})=>{const{mutate:u,isPending:d}=Oi({mutationFn:async({sourceId:f,payload:p})=>fw(f,p),onSuccess:(f,p)=>{t({message:"Draft saved successfully.",tone:"success"}),n(!1),s(f.id??null),r(f.name??null),i(f.updated_at??null),l.current=f.id??null,e.setQueryData(["feature-canvas","pipeline",p.sourceId],f),e.invalidateQueries({queryKey:["feature-canvas","pipeline-history",p.sourceId],exact:!1})},onError:f=>{t({message:(f==null?void 0:f.message)??"Failed to save pipeline.",tone:"error"})}});return{triggerSave:u,isSaving:d}},um=e=>!e||!e.length?"":e.join(", "),OB=({nodes:e,onAddNode:t})=>{const[n,s]=N.useState(""),[r,i]=N.useState([]),l=n.trim().toLowerCase(),u=N.useMemo(()=>l?e.filter(h=>{const _=[h.label,h.type,h.description];return h.category&&_.push(h.category),h.tags&&h.tags.length&&_.push(h.tags.join(" ")),_.some(x=>x==null?void 0:x.toLowerCase().includes(l))}):e,[e,l]),d=N.useMemo(()=>{const h=new Map;return u.forEach(_=>{var v;const x=((v=_.category)==null?void 0:v.trim())||"Other",y=h.get(x)??[];y.push(_),h.set(x,y)}),Array.from(h.entries()).sort(([_],[x])=>_.localeCompare(x)).map(([_,x])=>({category:_,entries:x.sort((y,v)=>(y.label||y.type).localeCompare(v.label||v.type))}))},[u]);N.useEffect(()=>{if(!l){i([]);return}i(h=>{const _=new Set(h);let x=!1;return d.forEach(({category:y})=>{_.has(y)||(_.add(y),x=!0)}),x?Array.from(_):h})},[d,l]);const f=h=>{i(_=>{const x=new Set(_);return x.has(h)?x.delete(h):x.add(h),Array.from(x)})},p=u.length,m=p>0;return a.jsxs("div",{className:"feature-canvas-sidebar",role:"presentation",children:[a.jsxs("header",{className:"feature-canvas-sidebar__header",children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[a.jsx(S2,{size:20,className:"text-muted"}),a.jsx("h3",{style:{margin:0},children:"Available steps"})]}),a.jsxs("div",{className:"feature-canvas-sidebar__search",style:{position:"relative",display:"flex",alignItems:"center"},children:[a.jsx(M2,{size:16,style:{position:"absolute",left:"12px",color:"#9ca3af",pointerEvents:"none"}}),a.jsx("input",{type:"search",value:n,onChange:h=>s(h.target.value),placeholder:"Search by name, tag, or output",className:"feature-canvas-sidebar__search-input","aria-label":"Search available steps",style:{paddingLeft:"36px"}}),n&&a.jsx("button",{type:"button",className:"feature-canvas-sidebar__search-clear",onClick:()=>s(""),"aria-label":"Clear search",style:{display:"flex",alignItems:"center",justifyContent:"center",right:"8px"},children:a.jsx(qi,{size:14})})]}),a.jsxs("span",{className:"feature-canvas-sidebar__results",children:["Showing ",p," ",p===1?"step":"steps",l?` matching ${n.trim()}`:""]})]}),m?a.jsx("div",{className:"feature-canvas-sidebar__sections",children:d.map(({category:h,entries:_})=>{const x=r.includes(h);return a.jsxs("section",{className:"feature-canvas-sidebar__section",children:[a.jsxs("button",{type:"button",className:"feature-canvas-sidebar__section-toggle",onClick:()=>f(h),"aria-expanded":x,children:[a.jsx("span",{className:"feature-canvas-sidebar__section-label",children:h.charAt(0).toUpperCase()+h.slice(1)}),a.jsxs("span",{className:"feature-canvas-sidebar__section-meta",children:[_.length,a.jsx("span",{className:"feature-canvas-sidebar__section-arrow","data-expanded":x,style:{display:"flex",alignItems:"center"},children:x?a.jsx(Rh,{size:14}):a.jsx(Dh,{size:14})})]})]}),x&&a.jsx("div",{className:"feature-canvas-sidebar__group",children:_.map(y=>{var v,w;return a.jsx("button",{className:"feature-canvas-sidebar__card",type:"button",onClick:()=>t==null?void 0:t(y),children:a.jsxs("div",{className:"feature-canvas-sidebar__card-body",children:[a.jsx("span",{className:"feature-canvas-sidebar__card-title",children:y.label||y.type}),y.description&&a.jsx("span",{className:"feature-canvas-sidebar__card-description",children:y.description}),a.jsxs("div",{className:"feature-canvas-sidebar__card-tags",children:[(v=y.inputs)!=null&&v.length?a.jsxs("span",{className:"feature-canvas-sidebar__chip",title:`Inputs: ${um(y.inputs)}`,children:["In: ",um(y.inputs)]}):null,(w=y.outputs)!=null&&w.length?a.jsxs("span",{className:"feature-canvas-sidebar__chip",title:`Outputs: ${um(y.outputs)}`,children:["Out: ",um(y.outputs)]}):null,y.parameters&&y.parameters.length>0?a.jsxs("span",{className:"feature-canvas-sidebar__chip",style:{display:"flex",alignItems:"center",gap:"4px"},children:[a.jsx(O2,{size:12}),y.parameters.length," param",y.parameters.length>1?"s":""]}):null]})]})},y.type)})})]},h)})}):a.jsx("div",{className:"feature-canvas-sidebar__empty",children:a.jsxs("p",{children:["No steps match ",n.trim(),". Try adjusting your search or browse by category."]})})]})},$B=({nodeCatalog:e,isCatalogLoading:t,catalogErrorMessage:n,handleAddNode:s})=>({sidebarContent:N.useMemo(()=>t?a.jsx("p",{className:"text-muted",children:"Loading node catalog"}):n?a.jsx("p",{className:"text-danger",children:n}):e.length?a.jsx(OB,{nodes:e,onAddNode:s}):a.jsx("p",{className:"text-muted",children:"Node catalog unavailable. Define nodes in the backend to continue."}),[n,s,t,e])}),TB=()=>{var p;const[e,t]=N.useState(!1),n=N.useRef(new Map),s=Es({queryKey:["feature-canvas","node-catalog"],queryFn:mp,staleTime:5*60*1e3}),r=s.data??[],i=s.isLoading||s.isFetching,l=s.error?((p=s.error)==null?void 0:p.message)??"Unable to load node catalog":null;N.useEffect(()=>{const m=new Map;r.forEach(h=>{h&&typeof h.type=="string"&&h.type.trim()&&m.set(h.type,h)}),n.current=m},[r]);const u=N.useCallback(()=>t(!0),[]),d=N.useCallback(()=>t(!1),[]),f=N.useCallback(()=>t(m=>!m),[]);return{nodeCatalog:r,catalogEntryMapRef:n,isCatalogOpen:e,openCatalog:u,closeCatalog:d,toggleCatalog:f,isCatalogLoading:i,catalogErrorMessage:l}},PB=e=>e==="success"?"":e==="error"?"":"",LB=e=>e==="error"?"text-danger":e==="success"?"text-success":"text-muted",zB=()=>{const[e,t]=N.useState(null);N.useEffect(()=>{if(!e||e.tone==="error"||typeof window>"u")return;const r=window.setTimeout(()=>t(null),e.tone==="success"?4e3:2500);return()=>window.clearTimeout(r)},[e]);const n=N.useMemo(()=>PB(e==null?void 0:e.tone),[e]),s=N.useMemo(()=>LB(e==null?void 0:e.tone),[e]);return{saveFeedback:e,setSaveFeedback:t,feedbackIcon:n,feedbackClass:s}},RB=(e=!0)=>{const[t,n]=N.useState(e),s=N.useCallback(()=>{n(r=>!r)},[]);return{isSidepanelExpanded:t,handleToggleSidepanel:s}},DB=({activePipelineUpdatedAt:e,datasetErrorMessage:t,isDatasetLoading:n,hasDatasets:s,ownedDatasetsCount:r,canSelectDatasets:i,datasetOptions:l,selectedDataset:u,activeSourceId:d,canClearCanvas:f,onDatasetSelection:p,onClearCanvas:m,onRefreshHistory:h,onSaveClick:_,isHistoryLoading:x,historyErrorMessage:y,historyItems:v,activePipelineId:w,isDirty:k,isSaving:j,saveFeedback:b,feedbackIcon:S,feedbackClass:E,onSelectHistory:M})=>({sidepanelProps:{activePipelineUpdatedAt:e,datasetErrorMessage:t,isDatasetLoading:n,hasDatasets:s,ownedDatasetsCount:r,canSelectDatasets:i,datasetOptions:l,selectedDataset:u,activeSourceId:d,canClearCanvas:f,onDatasetSelection:p,onClearCanvas:m,onRefreshHistory:h,onSaveClick:_,isHistoryLoading:x,historyErrorMessage:y,historyItems:v,activePipelineId:w,isDirty:k,isSaveDisabled:!d||j,saveButtonLabel:j?"Saving":k?"Save draft*":"Save draft",saveFeedback:b,feedbackIcon:S,feedbackClass:E,onSelectHistory:M}}),IB=(e,t,n,s)=>{if(e===n&&t===s)return`M ${e},${t}`;const r=Math.abs(n-e),i=Math.max(64,Math.min(r*.45,240)),l=Number.isFinite(i)?i:100,u=n>=e?1:-1,d=e+u*l,f=t,p=n-u*l;return`M ${e},${t} C ${d},${f} ${p},${s} ${n},${s}`},FB=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:r,targetPosition:i})=>{const l=IB(e,t,n,s),u="connection-line-gradient";return a.jsxs("g",{children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:u,gradientUnits:"userSpaceOnUse",x1:e,y1:t,x2:n,y2:s,children:[a.jsx("stop",{offset:"0%",stopColor:"#38bdf8",stopOpacity:.8}),a.jsx("stop",{offset:"50%",stopColor:"#6366f1",stopOpacity:.9}),a.jsx("stop",{offset:"100%",stopColor:"#a855f7",stopOpacity:.85})]}),a.jsxs("filter",{id:"connection-glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"coloredBlur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("path",{d:l,fill:"none",stroke:`url(#${u})`,strokeWidth:8,strokeOpacity:.2,strokeLinecap:"round",style:{filter:"url(#connection-glow)"}}),a.jsx("path",{d:l,fill:"none",stroke:`url(#${u})`,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",style:{strokeDasharray:"8 4",animation:"connection-line-dash 1s linear infinite"}}),a.jsx("circle",{cx:n,cy:s,r:6,fill:"#a855f7",opacity:.8,style:{animation:"connection-pulse 1.5s ease-in-out infinite"}})]})},BB=({nodes:e,edges:t,nodeTypes:n,edgeTypes:s,onNodesChange:r,onEdgesChange:i,onConnect:l,isValidConnection:u,onNodeClick:d,reactFlowInstanceRef:f,canvasViewportRef:p,handleResetAllNodes:m,openCatalog:h})=>a.jsxs("div",{className:"canvas-stage__viewport",ref:p,children:[a.jsxs(qx,{style:{width:"100%",height:"100%"},nodes:e,edges:t,nodeTypes:n,edgeTypes:s,onNodesChange:r,onEdgesChange:i,onConnect:l,isValidConnection:u,onNodeClick:d,onInit:_=>{f.current=_,requestAnimationFrame(()=>_.fitView({padding:.25}))},minZoom:.5,maxZoom:1.75,connectionRadius:180,connectionMode:Mo.Loose,connectOnClick:!0,nodeDragHandle:".feature-node__drag-handle",defaultEdgeOptions:{type:"animatedEdge",animated:!0,style:{strokeWidth:3}},connectionLineComponent:FB,elevateEdgesOnSelect:!0,edgesUpdatable:!1,children:[a.jsx(UA,{position:"bottom-left"}),a.jsx(YA,{gap:16})]}),a.jsx("button",{type:"button",className:"canvas-fab canvas-fab--reset",onClick:m,"aria-label":"Reset preprocessing nodes",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(Ih,{size:20})}),a.jsx("button",{type:"button",className:"canvas-fab",onClick:h,"aria-label":"Open node catalog",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(E2,{size:24})})]}),UB=N.forwardRef(({sourceId:e,datasetName:t,onGraphChange:n,onPipelineHydrated:s,onPipelineError:r},i)=>{const l=N.useMemo(()=>({featureNode:rB}),[]),u=N.useMemo(()=>({animatedEdge:_L}),[]),[d,f,p]=p2(cm().map(Ee=>({...Ee,type:"featureNode"}))),[m,h,_]=g2(lB()),[x,y]=N.useState(null),[v,w]=N.useState(!1),k=N.useRef(null),j=N.useRef(null),b=N.useRef(!1),S=t??e??"Demo dataset",E=GA(),{nodeCatalog:M,catalogEntryMapRef:O,isCatalogOpen:$,openCatalog:P,closeCatalog:A,isCatalogLoading:R,catalogErrorMessage:F}=TB(),z=N.useCallback(Ee=>{const ie=(Array.isArray(Ee)?Ee:[Ee]).filter(Boolean);if(!ie.length)return;const pe=Array.from(new Set(ie));requestAnimationFrame(()=>{requestAnimationFrame(()=>{pe.forEach(Ce=>{E(Ce)})})})},[E]);jB({edges:m,setNodes:f,scheduleNodeInternalsUpdate:z});const I=N.useMemo(()=>d.find(Ee=>Ee.id===x)??null,[d,x]),U=N.useMemo(()=>hB(d,m),[m,d]),q=N.useCallback(Ee=>{y(Ee),w(!0)},[]),H=N.useCallback(()=>{w(!1),y(null)},[]),W=N.useCallback(()=>{b.current=!0},[]);N.useEffect(()=>{b.current&&(b.current=!1,requestAnimationFrame(()=>{var Ee;(Ee=k.current)==null||Ee.fitView({padding:.25,duration:350})}))},[m,d]);const{registerNode:B,handleAddNode:D,handleUpdateNodeConfig:V,handleUpdateNodeData:te,handleResetNodeConfig:G,handleResetAllNodes:K,updateNodeCounter:X}=yB({setNodes:f,setEdges:h,setSelectedNodeId:y,setIsSettingsModalOpen:w,catalogEntryMapRef:O,handleOpenSettings:q,reactFlowInstanceRef:k,canvasViewportRef:j,scheduleFitView:W});N.useEffect(()=>{X(d)},[d,X]);const Q=N.useCallback(Ee=>Ee.map(ie=>{const pe={...ie.data??{}};ie.id==="dataset-source"&&(pe.label=`Dataset input
(${S})`,pe.isDataset=!0,pe.isRemovable=!1,pe.isConfigured=!0);const Ce=pe.catalogType??pe.type??ie.id;return pe.config&&typeof pe.config=="object"&&sm(Ce)&&delete pe.config[qa],pe.isConfigured===void 0&&(pe.config&&typeof pe.config=="object"?pe.isConfigured=sm(Ce)?!0:!pe.config[qa]:pe.isConfigured=!0),B({...ie,data:pe})}),[S,B]),{isPipelineLoading:J}=MB({sourceId:e,datasetDisplayLabel:S,registerNode:B,prepareNodes:Q,setNodes:f,setEdges:h,updateNodeCounter:X,scheduleFitView:W,onPipelineHydrated:s,onPipelineError:r}),Z=N.useCallback(()=>{f(Ee=>{const ie=Ee.find(Ce=>Ce.id==="dataset-source");return[B(ie?{...ie,data:{...ie.data??{},label:`Dataset input
(${S})`,isDataset:!0,isRemovable:!1,isConfigured:!0}}:{id:"dataset-source",type:"featureNode",position:{x:-200,y:40},data:{label:`Dataset input
(${S})`,isDataset:!0,isRemovable:!1,isConfigured:!0}})]}),h([]),y(null),w(!1),W()},[S,B,W,h,f,y,w]);N.useImperativeHandle(i,()=>({openCatalog:P,closeCatalog:A,clearGraph:Z}),[Z,A,P]);const{isValidConnection:ee,onConnect:de}=_B({nodes:d,setEdges:h,scheduleNodeInternalsUpdate:z});N.useEffect(()=>{n==null||n(d,m)},[m,d,n]);const _e=N.useMemo(()=>{var pe;if(!I)return null;const Ee=(pe=I==null?void 0:I.data)==null?void 0:pe.catalogType;if(!Ee)return null;const ie=O.current.get(Ee);return ie?rm(ie):null},[I]),ge=N.useMemo(()=>{var ie,pe;if(!I||(ie=I.data)!=null&&ie.isDataset)return!1;const Ee=(pe=I==null?void 0:I.data)==null?void 0:pe.catalogType;return Gj(typeof Ee=="string"?Ee:null,O.current)},[I]),{sidebarContent:be}=$B({nodeCatalog:M,isCatalogLoading:R,catalogErrorMessage:F,handleAddNode:D}),ze=N.useCallback((Ee,ie)=>{q(ie.id)},[q]);return a.jsxs("div",{className:"canvas-stage","data-pipeline-loading":J?"true":"false","aria-busy":J,children:[a.jsx(BB,{nodes:d,edges:m,nodeTypes:l,edgeTypes:u,onNodesChange:p,onEdgesChange:_,onConnect:de,isValidConnection:ee,onNodeClick:ze,reactFlowInstanceRef:k,canvasViewportRef:j,handleResetAllNodes:K,openCatalog:P}),a.jsxs("div",{className:`canvas-drawer${$?" canvas-drawer--open":""}`,children:[a.jsxs("div",{className:"canvas-drawer__header",children:[a.jsx("h2",{children:"Node catalog"}),a.jsx("button",{type:"button",className:"canvas-drawer__close",onClick:A,"aria-label":"Close catalog",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(qi,{size:20})})]}),a.jsx("div",{className:"canvas-drawer__body",children:be})]}),$&&a.jsx("div",{className:"canvas-drawer__backdrop",onClick:A}),v&&I&&a.jsx(Q4,{node:I,sourceId:e??null,graphSnapshot:U,onClose:H,onUpdateConfig:V,onUpdateNodeData:te,onResetConfig:G,defaultConfigTemplate:_e,isResetAvailable:ge})]})}),HB=({activePipelineUpdatedAt:e,datasetErrorMessage:t,isDatasetLoading:n,hasDatasets:s,ownedDatasetsCount:r,canSelectDatasets:i,datasetOptions:l,selectedDataset:u,activeSourceId:d,canClearCanvas:f,onDatasetSelection:p,onClearCanvas:m,onRefreshHistory:h,onSaveClick:_,isHistoryLoading:x,historyErrorMessage:y,historyItems:v,activePipelineId:w,isDirty:k,isSaveDisabled:j,saveButtonLabel:b,saveFeedback:S,feedbackIcon:E,feedbackClass:M,onSelectHistory:O})=>{const $=d?(u==null?void 0:u.name)??d:null;return a.jsxs("aside",{id:"feature-canvas-sidepanel",className:"canvas-sidepanel",role:"complementary","aria-label":"Canvas details",children:[a.jsxs("div",{className:"canvas-sidepanel__content",role:"group","aria-label":"Canvas controls",children:[a.jsxs("section",{className:"canvas-sidepanel__section",children:[a.jsxs("div",{className:"canvas-sidepanel__section-heading",children:[a.jsx("h2",{children:"Dataset"}),e&&a.jsx("span",{className:"canvas-sidepanel__meta",children:tg(e)??eg(e)})]}),t?a.jsx("p",{className:"text-danger",children:t}):r?a.jsx("div",{className:"canvas-sidepanel__select-wrapper",children:a.jsx("select",{className:"canvas-sidepanel__select",value:d??"",onChange:P=>p(P.target.value),disabled:n||!i,"aria-label":"Select dataset",children:l.map(P=>a.jsx("option",{value:P.value,disabled:!P.isOwned,children:`${P.label}${P.isOwned?"":" (locked)"}`},P.value))})}):a.jsx("p",{className:"text-muted",children:"Dataset switching is limited to collections you own."}),n&&a.jsx("p",{className:"text-muted",children:"Loading datasets"}),!n&&!s&&!t&&a.jsx("p",{className:"text-muted",children:"No datasets available. Send one from EDA to get started."}),(u==null?void 0:u.description)&&a.jsx("p",{className:"canvas-sidepanel__description",children:u.description}),$&&a.jsxs("p",{className:"canvas-sidepanel__meta",children:["Working with ",a.jsx("strong",{children:$})]}),!i&&r>0&&a.jsx("p",{className:"canvas-sidepanel__hint",children:"Add more owned datasets to switch between them."})]}),a.jsxs("section",{className:"canvas-sidepanel__section",children:[a.jsx("div",{className:"canvas-sidepanel__section-action",children:a.jsxs("button",{type:"button",className:"canvas-sidepanel__action-button",onClick:m,disabled:!f,"aria-label":"Clean all nodes",title:f?"Remove all nodes and edges from the canvas":"Nothing to clean yet",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx(cc,{size:16}),a.jsx("span",{children:"Clean all nodes"})]})}),a.jsxs("div",{className:"canvas-sidepanel__section-heading",children:[a.jsx("h2",{children:"History"}),a.jsxs("div",{className:"canvas-sidepanel__section-controls",children:[a.jsx("button",{type:"button",className:"canvas-sidepanel__icon-button",onClick:h,disabled:x||!d,"aria-label":"Refresh history",title:"Refresh history",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(k2,{size:16})}),a.jsx("button",{type:"button",className:"canvas-sidepanel__icon-button",onClick:_,disabled:j,"aria-label":b,title:b,style:{display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(Xx,{size:16})})]})]}),a.jsx("div",{className:"canvas-sidepanel__history",children:x?a.jsx("p",{className:"text-muted",children:"Loading history"}):y?a.jsx("p",{className:"text-danger",children:y}):v.length?v.map(P=>{const R=tg(P.updated_at)??eg(P.updated_at),F=P.id===w,z=F&&!k;return a.jsxs("button",{type:"button",className:`canvas-sidepanel__history-item${F?" canvas-sidepanel__history-item--active":""}`,onClick:()=>O(P),disabled:z,children:[a.jsx("span",{className:"canvas-sidepanel__history-title",children:P.name||`Pipeline #${P.id}`}),a.jsx("span",{className:"canvas-sidepanel__history-meta",children:R}),F&&k&&a.jsx("span",{className:"canvas-sidepanel__history-badge",children:"Unsaved edits"})]},P.id)}):a.jsx("p",{className:"text-muted",children:"No saved revisions yet. Save a draft to populate history."})})]})]}),S&&a.jsxs("p",{className:`canvas-sidepanel__feedback ${M}`,children:[a.jsx("span",{className:"canvas-sidepanel__feedback-icon","aria-hidden":"true",children:E}),a.jsx("span",{className:"canvas-sidepanel__feedback-text",children:S.message})]})]})},qB=e=>{const t=e==null?void 0:e.type;return!t||t==="smoothstep"||t==="default"?"animatedEdge":t},VB=({snapshot:e,selectedDataset:t,activeSourceId:n})=>{const s=e.nodes??[],r=e.edges??[];return{name:t!=null&&t.name?`Draft pipeline for ${t.name}`:`Draft pipeline for ${n}`,graph:{nodes:s,edges:r.map(i=>({...i,animated:(i==null?void 0:i.animated)??!0,type:qB(i)}))},metadata:{lastClientSave:new Date().toISOString(),nodeCount:s.length,edgeCount:r.length}}},WB=({sourceId:e})=>{const t=$a(),n=N.useRef(null),s=N.useRef(!0),{isSidepanelExpanded:r,handleToggleSidepanel:i}=RB(!0),[l,u]=N.useState(!1),{saveFeedback:d,setSaveFeedback:f,feedbackIcon:p,feedbackClass:m}=zB(),{selectedDataset:h,activeSourceId:_,datasetOptions:x,canSelectDatasets:y,hasDatasets:v,ownedDatasetsCount:w,isDatasetLoading:k,datasetErrorMessage:j,handleDatasetSelection:b}=gB({sourceId:e,setIsDirty:u,setSaveFeedback:f,isHydratingRef:s}),[S,E]=N.useState(null),[M,O]=N.useState(null),[$,P]=N.useState(null),A=N.useMemo(()=>["feature-canvas","pipeline",_],[_]),R=N.useRef(null),{graphSnapshotRef:F,canClearCanvas:z,handleGraphChange:I,applyHydratedSnapshot:U}=CB({setIsDirty:u,setSaveFeedback:f,isHydratingRef:s}),q=SB({canvasShellRef:n,canClearCanvas:z,setSaveFeedback:f}),{historyItems:H,isHistoryLoading:W,historyErrorMessage:B,refetchHistory:D,handleHistorySelection:V}=EB({activeSourceId:_,isDirty:l,setSaveFeedback:f,pipelineQueryKey:A,pendingHistoryIdRef:R,isHydratingRef:s}),{triggerSave:te,isSaving:G}=AB({queryClient:t,setSaveFeedback:f,setIsDirty:u,setActivePipelineId:E,setActivePipelineName:P,setActivePipelineUpdatedAt:O,pendingHistoryIdRef:R}),{handlePipelineHydrated:K,handlePipelineError:X}=kB({applyHydratedSnapshot:U,selectedDataset:h,activeSourceId:_,setActivePipelineId:E,setActivePipelineName:P,setActivePipelineUpdatedAt:O,setIsDirty:u,setSaveFeedback:f,pendingHistoryIdRef:R,isHydratingRef:s}),Q=N.useCallback(()=>{if(!_){f({message:"Select a dataset before saving.",tone:"error"});return}const Z=F.current;if(!Z.nodes||!Z.nodes.length){f({message:"Add nodes to the canvas before saving.",tone:"error"});return}const ee=VB({snapshot:Z,selectedDataset:h,activeSourceId:_});f({message:"Saving draft",tone:"info"}),te({sourceId:_,payload:ee})},[_,h==null?void 0:h.name,te]),{sidepanelProps:J}=DB({activePipelineUpdatedAt:M,datasetErrorMessage:j,isDatasetLoading:k,hasDatasets:v,ownedDatasetsCount:w,canSelectDatasets:y,datasetOptions:x,selectedDataset:h,activeSourceId:_,canClearCanvas:z,onDatasetSelection:b,onClearCanvas:q,onRefreshHistory:()=>{D()},onSaveClick:Q,isHistoryLoading:W,historyErrorMessage:B,historyItems:H,activePipelineId:S,isDirty:l,isSaving:G,saveFeedback:d,feedbackIcon:p,feedbackClass:m,onSelectHistory:V});return a.jsxs("div",{className:"feature-canvas-app","data-sidepanel-expanded":r?"true":"false",children:[a.jsx("button",{type:"button",className:"canvas-sidepanel__toggle",onClick:i,"aria-label":r?"Collapse details panel":"Expand details panel","aria-expanded":r,"aria-controls":"feature-canvas-sidepanel",children:r?"":""}),!r&&d&&a.jsxs("div",{className:`canvas-sidepanel__feedback canvas-sidepanel__feedback--floating ${m}`,children:[a.jsx("span",{className:"canvas-sidepanel__feedback-icon","aria-hidden":"true",children:p}),a.jsx("span",{className:"canvas-sidepanel__feedback-text",children:d.message})]}),r&&a.jsx(HB,{...J}),a.jsx("div",{className:"feature-canvas-app__viewport",children:a.jsx(Vx,{children:a.jsx(UB,{ref:n,sourceId:_,datasetName:(h==null?void 0:h.name)??(h==null?void 0:h.source_id)??null,onGraphChange:I,onPipelineHydrated:K,onPipelineError:X})})})]})},YB=new b1,ng=document.getElementById("ml-workflow-root");if(!ng)throw new Error("ML workflow root element not found");const KB=kf.createRoot(ng),GB=ng.getAttribute("data-source-id")||void 0;KB.render(a.jsx(ve.StrictMode,{children:a.jsx(w1,{client:YB,children:a.jsx(WB,{sourceId:GB})})}))})();
//# sourceMappingURL=feature-canvas.js.map
