var mj=$n=>{throw TypeError($n)};var Y_=($n,Kn,Yn)=>Kn.has($n)||mj("Cannot "+Yn);var de=($n,Kn,Yn)=>(Y_($n,Kn,"read from private field"),Yn?Yn.call($n):Kn.get($n)),gt=($n,Kn,Yn)=>Kn.has($n)?mj("Cannot add the same private member more than once"):Kn instanceof WeakSet?Kn.add($n):Kn.set($n,Yn),Je=($n,Kn,Yn,Yi)=>(Y_($n,Kn,"write to private field"),Yi?Yi.call($n,Yn):Kn.set($n,Yn),Yn),It=($n,Kn,Yn)=>(Y_($n,Kn,"access private method"),Yn);var Np=($n,Kn,Yn,Yi)=>({set _(Rt){Je($n,Kn,Rt,Yn)},get _(){return de($n,Kn,Yi)}});(function(){"use strict";var ni,b_,tj,hl,si,zc,nj,Rc,ri,Fc,sj,pl,rj,gl,Ic,Gr,_l,fs,Rd,vl,fa,Ko,aj,cr,Vt,Fd,Qs,yl,Bc,po,ai,Id,Uc,qc,bl,xl,oi,Hc,nn,Km,Q_,G_,X_,J_,Z_,ev,tv,fj,oj,Bd,Ra,Gs,wl,Fa,Ki,ij,go,ha,Ud,lj,_o,ii,ur,vo,yo,Sp,nv,cj,Ia,uj,Ln,li,ci,Vc,Wc,ui,Kc,Yc,dj;function $n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Kn={exports:{}},Yn={},Yi={exports:{}},Rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sv;function hj(){if(sv)return Rt;sv=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.iterator;function y(I){return I===null||typeof I!="object"?null:(I=_&&I[_]||I["@@iterator"],typeof I=="function"?I:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function k(I,Q,me){this.props=I,this.context=Q,this.refs=S,this.updater=me||w}k.prototype.isReactComponent={},k.prototype.setState=function(I,Q){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,Q,"setState")},k.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function M(){}M.prototype=k.prototype;function P(I,Q,me){this.props=I,this.context=Q,this.refs=S,this.updater=me||w}var T=P.prototype=new M;T.constructor=P,x(T,k.prototype),T.isPureReactComponent=!0;var j=Array.isArray,O=Object.prototype.hasOwnProperty,A={current:null},z={key:!0,ref:!0,__self:!0,__source:!0};function $(I,Q,me){var J,H={},Z=null,ne=null;if(Q!=null)for(J in Q.ref!==void 0&&(ne=Q.ref),Q.key!==void 0&&(Z=""+Q.key),Q)O.call(Q,J)&&!z.hasOwnProperty(J)&&(H[J]=Q[J]);var fe=arguments.length-2;if(fe===1)H.children=me;else if(1<fe){for(var ae=Array(fe),pe=0;pe<fe;pe++)ae[pe]=arguments[pe+2];H.children=ae}if(I&&I.defaultProps)for(J in fe=I.defaultProps,fe)H[J]===void 0&&(H[J]=fe[J]);return{$$typeof:e,type:I,key:Z,ref:ne,props:H,_owner:A.current}}function q(I,Q){return{$$typeof:e,type:I.type,key:Q,ref:I.ref,props:I.props,_owner:I._owner}}function V(I){return typeof I=="object"&&I!==null&&I.$$typeof===e}function R(I){var Q={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(me){return Q[me]})}var ee=/\/+/g;function le(I,Q){return typeof I=="object"&&I!==null&&I.key!=null?R(""+I.key):Q.toString(36)}function D(I,Q,me,J,H){var Z=typeof I;(Z==="undefined"||Z==="boolean")&&(I=null);var ne=!1;if(I===null)ne=!0;else switch(Z){case"string":case"number":ne=!0;break;case"object":switch(I.$$typeof){case e:case t:ne=!0}}if(ne)return ne=I,H=H(ne),I=J===""?"."+le(ne,0):J,j(H)?(me="",I!=null&&(me=I.replace(ee,"$&/")+"/"),D(H,Q,me,"",function(pe){return pe})):H!=null&&(V(H)&&(H=q(H,me+(!H.key||ne&&ne.key===H.key?"":(""+H.key).replace(ee,"$&/")+"/")+I)),Q.push(H)),1;if(ne=0,J=J===""?".":J+":",j(I))for(var fe=0;fe<I.length;fe++){Z=I[fe];var ae=J+le(Z,fe);ne+=D(Z,Q,me,ae,H)}else if(ae=y(I),typeof ae=="function")for(I=ae.call(I),fe=0;!(Z=I.next()).done;)Z=Z.value,ae=J+le(Z,fe++),ne+=D(Z,Q,me,ae,H);else if(Z==="object")throw Q=String(I),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.");return ne}function X(I,Q,me){if(I==null)return I;var J=[],H=0;return D(I,J,"","",function(Z){return Q.call(me,Z,H++)}),J}function Y(I){if(I._status===-1){var Q=I._result;Q=Q(),Q.then(function(me){(I._status===0||I._status===-1)&&(I._status=1,I._result=me)},function(me){(I._status===0||I._status===-1)&&(I._status=2,I._result=me)}),I._status===-1&&(I._status=0,I._result=Q)}if(I._status===1)return I._result.default;throw I._result}var K={current:null},U={transition:null},te={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:U,ReactCurrentOwner:A};function W(){throw Error("act(...) is not supported in production builds of React.")}return Rt.Children={map:X,forEach:function(I,Q,me){X(I,function(){Q.apply(this,arguments)},me)},count:function(I){var Q=0;return X(I,function(){Q++}),Q},toArray:function(I){return X(I,function(Q){return Q})||[]},only:function(I){if(!V(I))throw Error("React.Children.only expected to receive a single React element child.");return I}},Rt.Component=k,Rt.Fragment=n,Rt.Profiler=i,Rt.PureComponent=P,Rt.StrictMode=a,Rt.Suspense=m,Rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=te,Rt.act=W,Rt.cloneElement=function(I,Q,me){if(I==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+I+".");var J=x({},I.props),H=I.key,Z=I.ref,ne=I._owner;if(Q!=null){if(Q.ref!==void 0&&(Z=Q.ref,ne=A.current),Q.key!==void 0&&(H=""+Q.key),I.type&&I.type.defaultProps)var fe=I.type.defaultProps;for(ae in Q)O.call(Q,ae)&&!z.hasOwnProperty(ae)&&(J[ae]=Q[ae]===void 0&&fe!==void 0?fe[ae]:Q[ae])}var ae=arguments.length-2;if(ae===1)J.children=me;else if(1<ae){fe=Array(ae);for(var pe=0;pe<ae;pe++)fe[pe]=arguments[pe+2];J.children=fe}return{$$typeof:e,type:I.type,key:H,ref:Z,props:J,_owner:ne}},Rt.createContext=function(I){return I={$$typeof:u,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},I.Provider={$$typeof:l,_context:I},I.Consumer=I},Rt.createElement=$,Rt.createFactory=function(I){var Q=$.bind(null,I);return Q.type=I,Q},Rt.createRef=function(){return{current:null}},Rt.forwardRef=function(I){return{$$typeof:d,render:I}},Rt.isValidElement=V,Rt.lazy=function(I){return{$$typeof:p,_payload:{_status:-1,_result:I},_init:Y}},Rt.memo=function(I,Q){return{$$typeof:v,type:I,compare:Q===void 0?null:Q}},Rt.startTransition=function(I){var Q=U.transition;U.transition={};try{I()}finally{U.transition=Q}},Rt.unstable_act=W,Rt.useCallback=function(I,Q){return K.current.useCallback(I,Q)},Rt.useContext=function(I){return K.current.useContext(I)},Rt.useDebugValue=function(){},Rt.useDeferredValue=function(I){return K.current.useDeferredValue(I)},Rt.useEffect=function(I,Q){return K.current.useEffect(I,Q)},Rt.useId=function(){return K.current.useId()},Rt.useImperativeHandle=function(I,Q,me){return K.current.useImperativeHandle(I,Q,me)},Rt.useInsertionEffect=function(I,Q){return K.current.useInsertionEffect(I,Q)},Rt.useLayoutEffect=function(I,Q){return K.current.useLayoutEffect(I,Q)},Rt.useMemo=function(I,Q){return K.current.useMemo(I,Q)},Rt.useReducer=function(I,Q,me){return K.current.useReducer(I,Q,me)},Rt.useRef=function(I){return K.current.useRef(I)},Rt.useState=function(I){return K.current.useState(I)},Rt.useSyncExternalStore=function(I,Q,me){return K.current.useSyncExternalStore(I,Q,me)},Rt.useTransition=function(){return K.current.useTransition()},Rt.version="18.3.1",Rt}Yi.exports=hj();var f=Yi.exports;const Oe=$n(f);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rv;function pj(){if(rv)return Yn;rv=1;var e=f,t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function u(d,m,v){var p,_={},y=null,w=null;v!==void 0&&(y=""+v),m.key!==void 0&&(y=""+m.key),m.ref!==void 0&&(w=m.ref);for(p in m)a.call(m,p)&&!l.hasOwnProperty(p)&&(_[p]=m[p]);if(d&&d.defaultProps)for(p in m=d.defaultProps,m)_[p]===void 0&&(_[p]=m[p]);return{$$typeof:t,type:d,key:y,ref:w,props:_,_owner:i.current}}return Yn.Fragment=n,Yn.jsx=u,Yn.jsxs=u,Yn}Kn.exports=pj();var r=Kn.exports,Cp={},av={exports:{}},ar={},Ep={exports:{}},kp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ov;function gj(){return ov||(ov=1,function(e){function t(U,te){var W=U.length;U.push(te);e:for(;0<W;){var I=W-1>>>1,Q=U[I];if(0<i(Q,te))U[I]=te,U[W]=Q,W=I;else break e}}function n(U){return U.length===0?null:U[0]}function a(U){if(U.length===0)return null;var te=U[0],W=U.pop();if(W!==te){U[0]=W;e:for(var I=0,Q=U.length,me=Q>>>1;I<me;){var J=2*(I+1)-1,H=U[J],Z=J+1,ne=U[Z];if(0>i(H,W))Z<Q&&0>i(ne,H)?(U[I]=ne,U[Z]=W,I=Z):(U[I]=H,U[J]=W,I=J);else if(Z<Q&&0>i(ne,W))U[I]=ne,U[Z]=W,I=Z;else break e}}return te}function i(U,te){var W=U.sortIndex-te.sortIndex;return W!==0?W:U.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var u=Date,d=u.now();e.unstable_now=function(){return u.now()-d}}var m=[],v=[],p=1,_=null,y=3,w=!1,x=!1,S=!1,k=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(U){for(var te=n(v);te!==null;){if(te.callback===null)a(v);else if(te.startTime<=U)a(v),te.sortIndex=te.expirationTime,t(m,te);else break;te=n(v)}}function j(U){if(S=!1,T(U),!x)if(n(m)!==null)x=!0,Y(O);else{var te=n(v);te!==null&&K(j,te.startTime-U)}}function O(U,te){x=!1,S&&(S=!1,M($),$=-1),w=!0;var W=y;try{for(T(te),_=n(m);_!==null&&(!(_.expirationTime>te)||U&&!R());){var I=_.callback;if(typeof I=="function"){_.callback=null,y=_.priorityLevel;var Q=I(_.expirationTime<=te);te=e.unstable_now(),typeof Q=="function"?_.callback=Q:_===n(m)&&a(m),T(te)}else a(m);_=n(m)}if(_!==null)var me=!0;else{var J=n(v);J!==null&&K(j,J.startTime-te),me=!1}return me}finally{_=null,y=W,w=!1}}var A=!1,z=null,$=-1,q=5,V=-1;function R(){return!(e.unstable_now()-V<q)}function ee(){if(z!==null){var U=e.unstable_now();V=U;var te=!0;try{te=z(!0,U)}finally{te?le():(A=!1,z=null)}}else A=!1}var le;if(typeof P=="function")le=function(){P(ee)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,X=D.port2;D.port1.onmessage=ee,le=function(){X.postMessage(null)}}else le=function(){k(ee,0)};function Y(U){z=U,A||(A=!0,le())}function K(U,te){$=k(function(){U(e.unstable_now())},te)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(U){U.callback=null},e.unstable_continueExecution=function(){x||w||(x=!0,Y(O))},e.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<U?Math.floor(1e3/U):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_getFirstCallbackNode=function(){return n(m)},e.unstable_next=function(U){switch(y){case 1:case 2:case 3:var te=3;break;default:te=y}var W=y;y=te;try{return U()}finally{y=W}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(U,te){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var W=y;y=U;try{return te()}finally{y=W}},e.unstable_scheduleCallback=function(U,te,W){var I=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?I+W:I):W=I,U){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=W+Q,U={id:p++,callback:te,priorityLevel:U,startTime:W,expirationTime:Q,sortIndex:-1},W>I?(U.sortIndex=W,t(v,U),n(m)===null&&U===n(v)&&(S?(M($),$=-1):S=!0,K(j,W-I))):(U.sortIndex=Q,t(m,U),x||w||(x=!0,Y(O))),U},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(U){var te=y;return function(){var W=y;y=te;try{return U.apply(this,arguments)}finally{y=W}}}}(kp)),kp}var iv;function _j(){return iv||(iv=1,Ep.exports=gj()),Ep.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lv;function vj(){if(lv)return ar;lv=1;var e=f,t=_j();function n(s){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+s,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,i={};function l(s,o){u(s,o),u(s+"Capture",o)}function u(s,o){for(i[s]=o,s=0;s<o.length;s++)a.add(o[s])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),m=Object.prototype.hasOwnProperty,v=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},_={};function y(s){return m.call(_,s)?!0:m.call(p,s)?!1:v.test(s)?_[s]=!0:(p[s]=!0,!1)}function w(s,o,c,h){if(c!==null&&c.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return h?!1:c!==null?!c.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function x(s,o,c,h){if(o===null||typeof o>"u"||w(s,o,c,h))return!0;if(h)return!1;if(c!==null)switch(c.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function S(s,o,c,h,b,C,B){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=h,this.attributeNamespace=b,this.mustUseProperty=c,this.propertyName=s,this.type=o,this.sanitizeURL=C,this.removeEmptyString=B}var k={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){k[s]=new S(s,0,!1,s,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var o=s[0];k[o]=new S(o,1,!1,s[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(s){k[s]=new S(s,2,!1,s.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){k[s]=new S(s,2,!1,s,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){k[s]=new S(s,3,!1,s.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(s){k[s]=new S(s,3,!0,s,null,!1,!1)}),["capture","download"].forEach(function(s){k[s]=new S(s,4,!1,s,null,!1,!1)}),["cols","rows","size","span"].forEach(function(s){k[s]=new S(s,6,!1,s,null,!1,!1)}),["rowSpan","start"].forEach(function(s){k[s]=new S(s,5,!1,s.toLowerCase(),null,!1,!1)});var M=/[\-:]([a-z])/g;function P(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var o=s.replace(M,P);k[o]=new S(o,1,!1,s,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var o=s.replace(M,P);k[o]=new S(o,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(s){var o=s.replace(M,P);k[o]=new S(o,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(s){k[s]=new S(s,1,!1,s.toLowerCase(),null,!1,!1)}),k.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(s){k[s]=new S(s,1,!1,s.toLowerCase(),null,!0,!0)});function T(s,o,c,h){var b=k.hasOwnProperty(o)?k[o]:null;(b!==null?b.type!==0:h||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(x(o,c,b,h)&&(c=null),h||b===null?y(o)&&(c===null?s.removeAttribute(o):s.setAttribute(o,""+c)):b.mustUseProperty?s[b.propertyName]=c===null?b.type===3?!1:"":c:(o=b.attributeName,h=b.attributeNamespace,c===null?s.removeAttribute(o):(b=b.type,c=b===3||b===4&&c===!0?"":""+c,h?s.setAttributeNS(h,o,c):s.setAttribute(o,c))))}var j=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=Symbol.for("react.element"),A=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),q=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),R=Symbol.for("react.context"),ee=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),U=Symbol.iterator;function te(s){return s===null||typeof s!="object"?null:(s=U&&s[U]||s["@@iterator"],typeof s=="function"?s:null)}var W=Object.assign,I;function Q(s){if(I===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);I=o&&o[1]||""}return`
`+I+s}var me=!1;function J(s,o){if(!s||me)return"";me=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(Ee){var h=Ee}Reflect.construct(s,[],o)}else{try{o.call()}catch(Ee){h=Ee}s.call(o.prototype)}else{try{throw Error()}catch(Ee){h=Ee}s()}}catch(Ee){if(Ee&&h&&typeof Ee.stack=="string"){for(var b=Ee.stack.split(`
`),C=h.stack.split(`
`),B=b.length-1,ie=C.length-1;1<=B&&0<=ie&&b[B]!==C[ie];)ie--;for(;1<=B&&0<=ie;B--,ie--)if(b[B]!==C[ie]){if(B!==1||ie!==1)do if(B--,ie--,0>ie||b[B]!==C[ie]){var he=`
`+b[B].replace(" at new "," at ");return s.displayName&&he.includes("<anonymous>")&&(he=he.replace("<anonymous>",s.displayName)),he}while(1<=B&&0<=ie);break}}}finally{me=!1,Error.prepareStackTrace=c}return(s=s?s.displayName||s.name:"")?Q(s):""}function H(s){switch(s.tag){case 5:return Q(s.type);case 16:return Q("Lazy");case 13:return Q("Suspense");case 19:return Q("SuspenseList");case 0:case 2:case 15:return s=J(s.type,!1),s;case 11:return s=J(s.type.render,!1),s;case 1:return s=J(s.type,!0),s;default:return""}}function Z(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case z:return"Fragment";case A:return"Portal";case q:return"Profiler";case $:return"StrictMode";case le:return"Suspense";case D:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case R:return(s.displayName||"Context")+".Consumer";case V:return(s._context.displayName||"Context")+".Provider";case ee:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case X:return o=s.displayName||null,o!==null?o:Z(s.type)||"Memo";case Y:o=s._payload,s=s._init;try{return Z(s(o))}catch{}}return null}function ne(s){var o=s.type;switch(s.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=o.render,s=s.displayName||s.name||"",o.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Z(o);case 8:return o===$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function fe(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function ae(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function pe(s){var o=ae(s)?"checked":"value",c=Object.getOwnPropertyDescriptor(s.constructor.prototype,o),h=""+s[o];if(!s.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var b=c.get,C=c.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return b.call(this)},set:function(B){h=""+B,C.call(this,B)}}),Object.defineProperty(s,o,{enumerable:c.enumerable}),{getValue:function(){return h},setValue:function(B){h=""+B},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function Ve(s){s._valueTracker||(s._valueTracker=pe(s))}function st(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var c=o.getValue(),h="";return s&&(h=ae(s)?s.checked?"true":"false":s.value),s=h,s!==c?(o.setValue(s),!0):!1}function Ke(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function mt(s,o){var c=o.checked;return W({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??s._wrapperState.initialChecked})}function yt(s,o){var c=o.defaultValue==null?"":o.defaultValue,h=o.checked!=null?o.checked:o.defaultChecked;c=fe(o.value!=null?o.value:c),s._wrapperState={initialChecked:h,initialValue:c,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Te(s,o){o=o.checked,o!=null&&T(s,"checked",o,!1)}function at(s,o){Te(s,o);var c=fe(o.value),h=o.type;if(c!=null)h==="number"?(c===0&&s.value===""||s.value!=c)&&(s.value=""+c):s.value!==""+c&&(s.value=""+c);else if(h==="submit"||h==="reset"){s.removeAttribute("value");return}o.hasOwnProperty("value")?be(s,o.type,c):o.hasOwnProperty("defaultValue")&&be(s,o.type,fe(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(s.defaultChecked=!!o.defaultChecked)}function it(s,o,c){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var h=o.type;if(!(h!=="submit"&&h!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+s._wrapperState.initialValue,c||o===s.value||(s.value=o),s.defaultValue=o}c=s.name,c!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,c!==""&&(s.name=c)}function be(s,o,c){(o!=="number"||Ke(s.ownerDocument)!==s)&&(c==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+c&&(s.defaultValue=""+c))}var Pe=Array.isArray;function G(s,o,c,h){if(s=s.options,o){o={};for(var b=0;b<c.length;b++)o["$"+c[b]]=!0;for(c=0;c<s.length;c++)b=o.hasOwnProperty("$"+s[c].value),s[c].selected!==b&&(s[c].selected=b),b&&h&&(s[c].defaultSelected=!0)}else{for(c=""+fe(c),o=null,b=0;b<s.length;b++){if(s[b].value===c){s[b].selected=!0,h&&(s[b].defaultSelected=!0);return}o!==null||s[b].disabled||(o=s[b])}o!==null&&(o.selected=!0)}}function ke(s,o){if(o.dangerouslySetInnerHTML!=null)throw Error(n(91));return W({},o,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function Ae(s,o){var c=o.value;if(c==null){if(c=o.children,o=o.defaultValue,c!=null){if(o!=null)throw Error(n(92));if(Pe(c)){if(1<c.length)throw Error(n(93));c=c[0]}o=c}o==null&&(o=""),c=o}s._wrapperState={initialValue:fe(c)}}function Ge(s,o){var c=fe(o.value),h=fe(o.defaultValue);c!=null&&(c=""+c,c!==s.value&&(s.value=c),o.defaultValue==null&&s.defaultValue!==c&&(s.defaultValue=c)),h!=null&&(s.defaultValue=""+h)}function ft(s){var o=s.textContent;o===s._wrapperState.initialValue&&o!==""&&o!==null&&(s.value=o)}function zt(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ve(s,o){return s==null||s==="http://www.w3.org/1999/xhtml"?zt(o):s==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var xe,Se=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,c,h,b){MSApp.execUnsafeLocalFunction(function(){return s(o,c,h,b)})}:s}(function(s,o){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=o;else{for(xe=xe||document.createElement("div"),xe.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=xe.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;o.firstChild;)s.appendChild(o.firstChild)}});function $e(s,o){if(o){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=o;return}}s.textContent=o}var Ye={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ue=["Webkit","ms","Moz","O"];Object.keys(Ye).forEach(function(s){Ue.forEach(function(o){o=o+s.charAt(0).toUpperCase()+s.substring(1),Ye[o]=Ye[s]})});function Ze(s,o,c){return o==null||typeof o=="boolean"||o===""?"":c||typeof o!="number"||o===0||Ye.hasOwnProperty(s)&&Ye[s]?(""+o).trim():o+"px"}function Nt(s,o){s=s.style;for(var c in o)if(o.hasOwnProperty(c)){var h=c.indexOf("--")===0,b=Ze(c,o[c],h);c==="float"&&(c="cssFloat"),h?s.setProperty(c,b):s[c]=b}}var Et=W({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qt(s,o){if(o){if(Et[s]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(n(137,s));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(n(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(n(61))}if(o.style!=null&&typeof o.style!="object")throw Error(n(62))}}function Ht(s,o){if(s.indexOf("-")===-1)return typeof o.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pt=null;function pt(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Jt=null,Gt=null,Ct=null;function Dn(s){if(s=ta(s)){if(typeof Jt!="function")throw Error(n(280));var o=s.stateNode;o&&(o=_u(o),Jt(s.stateNode,s.type,o))}}function wn(s){Gt?Ct?Ct.push(s):Ct=[s]:Gt=s}function pn(){if(Gt){var s=Gt,o=Ct;if(Ct=Gt=null,Dn(s),o)for(s=0;s<o.length;s++)Dn(o[s])}}function Tt(s,o){return s(o)}function hs(){}var sn=!1;function ht(s,o,c){if(sn)return s(o,c);sn=!0;try{return Tt(s,o,c)}finally{sn=!1,(Gt!==null||Ct!==null)&&(hs(),pn())}}function _t(s,o){var c=s.stateNode;if(c===null)return null;var h=_u(c);if(h===null)return null;c=h[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(s=s.type,h=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!h;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(n(231,o,typeof c));return c}var zn=!1;if(d)try{var Gn={};Object.defineProperty(Gn,"passive",{get:function(){zn=!0}}),window.addEventListener("test",Gn,Gn),window.removeEventListener("test",Gn,Gn)}catch{zn=!1}function ps(s,o,c,h,b,C,B,ie,he){var Ee=Array.prototype.slice.call(arguments,3);try{o.apply(c,Ee)}catch(Fe){this.onError(Fe)}}var Xn=!1,Es=null,Jn=!1,dr=null,bn={onError:function(s){Xn=!0,Es=s}};function zs(s,o,c,h,b,C,B,ie,he){Xn=!1,Es=null,ps.apply(bn,arguments)}function ks(s,o,c,h,b,C,B,ie,he){if(zs.apply(this,arguments),Xn){if(Xn){var Ee=Es;Xn=!1,Es=null}else throw Error(n(198));Jn||(Jn=!0,dr=Ee)}}function gs(s){var o=s,c=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,o.flags&4098&&(c=o.return),s=o.return;while(s)}return o.tag===3?c:null}function Ba(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function Xs(s){if(gs(s)!==s)throw Error(n(188))}function pa(s){var o=s.alternate;if(!o){if(o=gs(s),o===null)throw Error(n(188));return o!==s?null:s}for(var c=s,h=o;;){var b=c.return;if(b===null)break;var C=b.alternate;if(C===null){if(h=b.return,h!==null){c=h;continue}break}if(b.child===C.child){for(C=b.child;C;){if(C===c)return Xs(b),s;if(C===h)return Xs(b),o;C=C.sibling}throw Error(n(188))}if(c.return!==h.return)c=b,h=C;else{for(var B=!1,ie=b.child;ie;){if(ie===c){B=!0,c=b,h=C;break}if(ie===h){B=!0,h=b,c=C;break}ie=ie.sibling}if(!B){for(ie=C.child;ie;){if(ie===c){B=!0,c=C,h=b;break}if(ie===h){B=!0,h=C,c=b;break}ie=ie.sibling}if(!B)throw Error(n(189))}}if(c.alternate!==h)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?s:o}function zr(s){return s=pa(s),s!==null?Rr(s):null}function Rr(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var o=Rr(s);if(o!==null)return o;s=s.sibling}return null}var ga=t.unstable_scheduleCallback,Js=t.unstable_cancelCallback,bo=t.unstable_shouldYield,Ua=t.unstable_requestPaint,fn=t.unstable_now,Xr=t.unstable_getCurrentPriorityLevel,_s=t.unstable_ImmediatePriority,Fr=t.unstable_UserBlockingPriority,Rs=t.unstable_NormalPriority,_a=t.unstable_LowPriority,_e=t.unstable_IdlePriority,De=null,et=null;function Yt(s){if(et&&typeof et.onCommitFiberRoot=="function")try{et.onCommitFiberRoot(De,s,void 0,(s.current.flags&128)===128)}catch{}}var Be=Math.clz32?Math.clz32:rn,kt=Math.log,$t=Math.LN2;function rn(s){return s>>>=0,s===0?32:31-(kt(s)/$t|0)|0}var Zt=64,On=4194304;function gn(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function Rn(s,o){var c=s.pendingLanes;if(c===0)return 0;var h=0,b=s.suspendedLanes,C=s.pingedLanes,B=c&268435455;if(B!==0){var ie=B&~b;ie!==0?h=gn(ie):(C&=B,C!==0&&(h=gn(C)))}else B=c&~b,B!==0?h=gn(B):C!==0&&(h=gn(C));if(h===0)return 0;if(o!==0&&o!==h&&!(o&b)&&(b=h&-h,C=o&-o,b>=C||b===16&&(C&4194240)!==0))return o;if(h&4&&(h|=c&16),o=s.entangledLanes,o!==0)for(s=s.entanglements,o&=h;0<o;)c=31-Be(o),b=1<<c,h|=s[c],o&=~b;return h}function mr(s,o){switch(s){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ms(s,o){for(var c=s.suspendedLanes,h=s.pingedLanes,b=s.expirationTimes,C=s.pendingLanes;0<C;){var B=31-Be(C),ie=1<<B,he=b[B];he===-1?(!(ie&c)||ie&h)&&(b[B]=mr(ie,o)):he<=o&&(s.expiredLanes|=ie),C&=~ie}}function Zn(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function is(){var s=Zt;return Zt<<=1,!(Zt&4194240)&&(Zt=64),s}function Fs(s){for(var o=[],c=0;31>c;c++)o.push(s);return o}function As(s,o,c){s.pendingLanes|=o,o!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,o=31-Be(o),s[o]=c}function di(s,o){var c=s.pendingLanes&~o;s.pendingLanes=o,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=o,s.mutableReadLanes&=o,s.entangledLanes&=o,o=s.entanglements;var h=s.eventTimes;for(s=s.expirationTimes;0<c;){var b=31-Be(c),C=1<<b;o[b]=0,h[b]=-1,s[b]=-1,c&=~C}}function jl(s,o){var c=s.entangledLanes|=o;for(s=s.entanglements;c;){var h=31-Be(c),b=1<<h;b&o|s[h]&o&&(s[h]|=o),c&=~b}}var Bt=0;function Qc(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var Nl,Sl,Gc,Xc,va,mi=!1,xo=[],Ir=null,se=null,Me=null,Ce=new Map,Qe=new Map,He=[],Re="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function St(s,o){switch(s){case"focusin":case"focusout":Ir=null;break;case"dragenter":case"dragleave":se=null;break;case"mouseover":case"mouseout":Me=null;break;case"pointerover":case"pointerout":Ce.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qe.delete(o.pointerId)}}function ot(s,o,c,h,b,C){return s===null||s.nativeEvent!==C?(s={blockedOn:o,domEventName:c,eventSystemFlags:h,nativeEvent:C,targetContainers:[b]},o!==null&&(o=ta(o),o!==null&&Sl(o)),s):(s.eventSystemFlags|=h,o=s.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),s)}function Dt(s,o,c,h,b){switch(o){case"focusin":return Ir=ot(Ir,s,o,c,h,b),!0;case"dragenter":return se=ot(se,s,o,c,h,b),!0;case"mouseover":return Me=ot(Me,s,o,c,h,b),!0;case"pointerover":var C=b.pointerId;return Ce.set(C,ot(Ce.get(C)||null,s,o,c,h,b)),!0;case"gotpointercapture":return C=b.pointerId,Qe.set(C,ot(Qe.get(C)||null,s,o,c,h,b)),!0}return!1}function Mt(s){var o=Ga(s.target);if(o!==null){var c=gs(o);if(c!==null){if(o=c.tag,o===13){if(o=Ba(c),o!==null){s.blockedOn=o,va(s.priority,function(){Gc(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function bt(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var c=Zs(s.domEventName,s.eventSystemFlags,o[0],s.nativeEvent);if(c===null){c=s.nativeEvent;var h=new c.constructor(c.type,c);Pt=h,c.target.dispatchEvent(h),Pt=null}else return o=ta(c),o!==null&&Sl(o),s.blockedOn=c,!1;o.shift()}return!0}function Wt(s,o,c){bt(s)&&c.delete(o)}function ls(){mi=!1,Ir!==null&&bt(Ir)&&(Ir=null),se!==null&&bt(se)&&(se=null),Me!==null&&bt(Me)&&(Me=null),Ce.forEach(Wt),Qe.forEach(Wt)}function _n(s,o){s.blockedOn===o&&(s.blockedOn=null,mi||(mi=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,ls)))}function es(s){function o(b){return _n(b,s)}if(0<xo.length){_n(xo[0],s);for(var c=1;c<xo.length;c++){var h=xo[c];h.blockedOn===s&&(h.blockedOn=null)}}for(Ir!==null&&_n(Ir,s),se!==null&&_n(se,s),Me!==null&&_n(Me,s),Ce.forEach(o),Qe.forEach(o),c=0;c<He.length;c++)h=He[c],h.blockedOn===s&&(h.blockedOn=null);for(;0<He.length&&(c=He[0],c.blockedOn===null);)Mt(c),c.blockedOn===null&&He.shift()}var fr=j.ReactCurrentBatchConfig,hr=!0;function Br(s,o,c,h){var b=Bt,C=fr.transition;fr.transition=null;try{Bt=1,Jr(s,o,c,h)}finally{Bt=b,fr.transition=C}}function qa(s,o,c,h){var b=Bt,C=fr.transition;fr.transition=null;try{Bt=4,Jr(s,o,c,h)}finally{Bt=b,fr.transition=C}}function Jr(s,o,c,h){if(hr){var b=Zs(s,o,c,h);if(b===null)vs(s,o,h,Os,c),St(s,h);else if(Dt(b,s,o,c,h))h.stopPropagation();else if(St(s,h),o&4&&-1<Re.indexOf(s)){for(;b!==null;){var C=ta(b);if(C!==null&&Nl(C),C=Zs(s,o,c,h),C===null&&vs(s,o,h,Os,c),C===b)break;b=C}b!==null&&h.stopPropagation()}else vs(s,o,h,null,c)}}var Os=null;function Zs(s,o,c,h){if(Os=null,s=pt(h),s=Ga(s),s!==null)if(o=gs(s),o===null)s=null;else if(c=o.tag,c===13){if(s=Ba(o),s!==null)return s;s=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null);return Os=s,null}function fi(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xr()){case _s:return 1;case Fr:return 4;case Rs:case _a:return 16;case _e:return 536870912;default:return 16}default:return 16}}var pr=null,hi=null,wo=null;function pi(){if(wo)return wo;var s,o=hi,c=o.length,h,b="value"in pr?pr.value:pr.textContent,C=b.length;for(s=0;s<c&&o[s]===b[s];s++);var B=c-s;for(h=1;h<=B&&o[c-h]===b[C-h];h++);return wo=b.slice(s,1<h?1-h:void 0)}function gi(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function _i(){return!0}function vi(){return!1}function cs(s){function o(c,h,b,C,B){this._reactName=c,this._targetInst=b,this.type=h,this.nativeEvent=C,this.target=B,this.currentTarget=null;for(var ie in s)s.hasOwnProperty(ie)&&(c=s[ie],this[ie]=c?c(C):C[ie]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?_i:vi,this.isPropagationStopped=vi,this}return W(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=_i)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=_i)},persist:function(){},isPersistent:_i}),o}var Mn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yi=cs(Mn),jo=W({},Mn,{view:0,detail:0}),qd=cs(jo),Cl,An,ts,Is=W({},jo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ha,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ts&&(ts&&s.type==="mousemove"?(Cl=s.screenX-ts.screenX,An=s.screenY-ts.screenY):An=Cl=0,ts=s),Cl)},movementY:function(s){return"movementY"in s?s.movementY:An}}),bi=cs(Is),Hd=W({},Is,{dataTransfer:0}),Jc=cs(Hd),Vd=W({},jo,{relatedTarget:0}),Zc=cs(Vd),rh=W({},Mn,{animationName:0,elapsedTime:0,pseudoElement:0}),ah=cs(rh),oh=W({},Mn,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),eu=cs(oh),ye=W({},Mn,{data:0}),Ie=cs(ye),ya={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ih={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},x_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function w_(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=x_[s])?!!o[s]:!1}function Ha(){return w_}var lh=W({},jo,{key:function(s){if(s.key){var o=ya[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=gi(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?ih[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ha,charCode:function(s){return s.type==="keypress"?gi(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?gi(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),ch=cs(lh),Pn=W({},Is,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Va=cs(Pn),xi=W({},jo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ha}),tu=cs(xi),Wa=W({},Mn,{propertyName:0,elapsedTime:0,pseudoElement:0}),nu=cs(Wa),j_=W({},Is,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),N_=cs(j_),No=[9,13,27,32],El=d&&"CompositionEvent"in window,wi=null;d&&"documentMode"in document&&(wi=document.documentMode);var uh=d&&"TextEvent"in window&&!wi,Wd=d&&(!El||wi&&8<wi&&11>=wi),ji=" ",Kd=!1;function Yd(s,o){switch(s){case"keyup":return No.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kl(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var ba=!1;function So(s,o){switch(s){case"compositionend":return kl(o);case"keypress":return o.which!==32?null:(Kd=!0,ji);case"textInput":return s=o.data,s===ji&&Kd?null:s;default:return null}}function Qd(s,o){if(ba)return s==="compositionend"||!El&&Yd(s,o)?(s=pi(),wo=hi=pr=null,ba=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Wd&&o.locale!=="ko"?null:o.data;default:return null}}var xt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ml(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!xt[s.type]:o==="textarea"}function Al(s,o,c,h){wn(h),o=yr(o,"onChange"),0<o.length&&(c=new yi("onChange","change",null,c,h),s.push({event:c,listeners:o}))}var Ol=null,an=null;function su(s){gh(s,0)}function Co(s){var o=ns(s);if(st(o))return s}function ru(s,o){if(s==="change")return o}var Eo=!1;if(d){var Ni;if(d){var gr="oninput"in document;if(!gr){var Pl=document.createElement("div");Pl.setAttribute("oninput","return;"),gr=typeof Pl.oninput=="function"}Ni=gr}else Ni=!1;Eo=Ni&&(!document.documentMode||9<document.documentMode)}function Tl(){Ol&&(Ol.detachEvent("onpropertychange",$l),an=Ol=null)}function $l(s){if(s.propertyName==="value"&&Co(an)){var o=[];Al(o,an,s,pt(s)),ht(su,o)}}function dh(s,o,c){s==="focusin"?(Tl(),Ol=o,an=c,Ol.attachEvent("onpropertychange",$l)):s==="focusout"&&Tl()}function Gd(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Co(an)}function S_(s,o){if(s==="click")return Co(o)}function C_(s,o){if(s==="input"||s==="change")return Co(o)}function mh(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var _r=typeof Object.is=="function"?Object.is:mh;function Si(s,o){if(_r(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var c=Object.keys(s),h=Object.keys(o);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var b=c[h];if(!m.call(o,b)||!_r(s[b],o[b]))return!1}return!0}function ko(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Xd(s,o){var c=ko(s);s=0;for(var h;c;){if(c.nodeType===3){if(h=s+c.textContent.length,s<=o&&h>=o)return{node:c,offset:o-s};s=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=ko(c)}}function Jd(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?Jd(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function xa(){for(var s=window,o=Ke();o instanceof s.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)s=o.contentWindow;else break;o=Ke(s.document)}return o}function au(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}function E_(s){var o=xa(),c=s.focusedElem,h=s.selectionRange;if(o!==c&&c&&c.ownerDocument&&Jd(c.ownerDocument.documentElement,c)){if(h!==null&&au(c)){if(o=h.start,s=h.end,s===void 0&&(s=o),"selectionStart"in c)c.selectionStart=o,c.selectionEnd=Math.min(s,c.value.length);else if(s=(o=c.ownerDocument||document)&&o.defaultView||window,s.getSelection){s=s.getSelection();var b=c.textContent.length,C=Math.min(h.start,b);h=h.end===void 0?C:Math.min(h.end,b),!s.extend&&C>h&&(b=h,h=C,C=b),b=Xd(c,C);var B=Xd(c,h);b&&B&&(s.rangeCount!==1||s.anchorNode!==b.node||s.anchorOffset!==b.offset||s.focusNode!==B.node||s.focusOffset!==B.offset)&&(o=o.createRange(),o.setStart(b.node,b.offset),s.removeAllRanges(),C>h?(s.addRange(o),s.extend(B.node,B.offset)):(o.setEnd(B.node,B.offset),s.addRange(o)))}}for(o=[],s=c;s=s.parentNode;)s.nodeType===1&&o.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<o.length;c++)s=o[c],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var ou=d&&"documentMode"in document&&11>=document.documentMode,Mo=null,Zd=null,Ll=null,em=!1;function iu(s,o,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;em||Mo==null||Mo!==Ke(h)||(h=Mo,"selectionStart"in h&&au(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ll&&Si(Ll,h)||(Ll=h,h=yr(Zd,"onSelect"),0<h.length&&(o=new yi("onSelect","select",null,o,c),s.push({event:o,listeners:h}),o.target=Mo)))}function lu(s,o){var c={};return c[s.toLowerCase()]=o.toLowerCase(),c["Webkit"+s]="webkit"+o,c["Moz"+s]="moz"+o,c}var Ci={animationend:lu("Animation","AnimationEnd"),animationiteration:lu("Animation","AnimationIteration"),animationstart:lu("Animation","AnimationStart"),transitionend:lu("Transition","TransitionEnd")},Dl={},Ka={};d&&(Ka=document.createElement("div").style,"AnimationEvent"in window||(delete Ci.animationend.animation,delete Ci.animationiteration.animation,delete Ci.animationstart.animation),"TransitionEvent"in window||delete Ci.transitionend.transition);function Ao(s){if(Dl[s])return Dl[s];if(!Ci[s])return s;var o=Ci[s],c;for(c in o)if(o.hasOwnProperty(c)&&c in Ka)return Dl[s]=o[c];return s}var fh=Ao("animationend"),cu=Ao("animationiteration"),Ei=Ao("animationstart"),hh=Ao("transitionend"),ph=new Map,uu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vr(s,o){ph.set(s,o),l(o,[s])}for(var tm=0;tm<uu.length;tm++){var nm=uu[tm],sm=nm.toLowerCase(),rm=nm[0].toUpperCase()+nm.slice(1);vr(sm,"on"+rm)}vr(fh,"onAnimationEnd"),vr(cu,"onAnimationIteration"),vr(Ei,"onAnimationStart"),vr("dblclick","onDoubleClick"),vr("focusin","onFocus"),vr("focusout","onBlur"),vr(hh,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),k_=new Set("cancel close invalid load scroll toggle".split(" ").concat(zl));function du(s,o,c){var h=s.type||"unknown-event";s.currentTarget=c,ks(h,o,void 0,s),s.currentTarget=null}function gh(s,o){o=(o&4)!==0;for(var c=0;c<s.length;c++){var h=s[c],b=h.event;h=h.listeners;e:{var C=void 0;if(o)for(var B=h.length-1;0<=B;B--){var ie=h[B],he=ie.instance,Ee=ie.currentTarget;if(ie=ie.listener,he!==C&&b.isPropagationStopped())break e;du(b,ie,Ee),C=he}else for(B=0;B<h.length;B++){if(ie=h[B],he=ie.instance,Ee=ie.currentTarget,ie=ie.listener,he!==C&&b.isPropagationStopped())break e;du(b,ie,Ee),C=he}}}if(Jn)throw s=dr,Jn=!1,dr=null,s}function on(s,o){var c=o[Fn];c===void 0&&(c=o[Fn]=new Set);var h=s+"__bubble";c.has(h)||(fu(o,s,2,!1),c.add(h))}function mu(s,o,c){var h=0;o&&(h|=4),fu(c,s,h,o)}var Rl="_reactListening"+Math.random().toString(36).slice(2);function Fl(s){if(!s[Rl]){s[Rl]=!0,a.forEach(function(c){c!=="selectionchange"&&(k_.has(c)||mu(c,!1,s),mu(c,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[Rl]||(o[Rl]=!0,mu("selectionchange",!1,o))}}function fu(s,o,c,h){switch(fi(o)){case 1:var b=Br;break;case 4:b=qa;break;default:b=Jr}c=b.bind(null,o,c,s),b=void 0,!zn||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),h?b!==void 0?s.addEventListener(o,c,{capture:!0,passive:b}):s.addEventListener(o,c,!0):b!==void 0?s.addEventListener(o,c,{passive:b}):s.addEventListener(o,c,!1)}function vs(s,o,c,h,b){var C=h;if(!(o&1)&&!(o&2)&&h!==null)e:for(;;){if(h===null)return;var B=h.tag;if(B===3||B===4){var ie=h.stateNode.containerInfo;if(ie===b||ie.nodeType===8&&ie.parentNode===b)break;if(B===4)for(B=h.return;B!==null;){var he=B.tag;if((he===3||he===4)&&(he=B.stateNode.containerInfo,he===b||he.nodeType===8&&he.parentNode===b))return;B=B.return}for(;ie!==null;){if(B=Ga(ie),B===null)return;if(he=B.tag,he===5||he===6){h=C=B;continue e}ie=ie.parentNode}}h=h.return}ht(function(){var Ee=C,Fe=pt(c),qe=[];e:{var ze=ph.get(s);if(ze!==void 0){var tt=yi,rt=s;switch(s){case"keypress":if(gi(c)===0)break e;case"keydown":case"keyup":tt=ch;break;case"focusin":rt="focus",tt=Zc;break;case"focusout":rt="blur",tt=Zc;break;case"beforeblur":case"afterblur":tt=Zc;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tt=bi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tt=Jc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tt=tu;break;case fh:case cu:case Ei:tt=ah;break;case hh:tt=nu;break;case"scroll":tt=qd;break;case"wheel":tt=N_;break;case"copy":case"cut":case"paste":tt=eu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tt=Va}var ct=(o&4)!==0,Wn=!ct&&s==="scroll",we=ct?ze!==null?ze+"Capture":null:ze;ct=[];for(var ge=Ee,Ne;ge!==null;){Ne=ge;var We=Ne.stateNode;if(Ne.tag===5&&We!==null&&(Ne=We,we!==null&&(We=_t(ge,we),We!=null&&ct.push(Il(ge,We,Ne)))),Wn)break;ge=ge.return}0<ct.length&&(ze=new tt(ze,rt,null,c,Fe),qe.push({event:ze,listeners:ct}))}}if(!(o&7)){e:{if(ze=s==="mouseover"||s==="pointerover",tt=s==="mouseout"||s==="pointerout",ze&&c!==Pt&&(rt=c.relatedTarget||c.fromElement)&&(Ga(rt)||rt[ea]))break e;if((tt||ze)&&(ze=Fe.window===Fe?Fe:(ze=Fe.ownerDocument)?ze.defaultView||ze.parentWindow:window,tt?(rt=c.relatedTarget||c.toElement,tt=Ee,rt=rt?Ga(rt):null,rt!==null&&(Wn=gs(rt),rt!==Wn||rt.tag!==5&&rt.tag!==6)&&(rt=null)):(tt=null,rt=Ee),tt!==rt)){if(ct=bi,We="onMouseLeave",we="onMouseEnter",ge="mouse",(s==="pointerout"||s==="pointerover")&&(ct=Va,We="onPointerLeave",we="onPointerEnter",ge="pointer"),Wn=tt==null?ze:ns(tt),Ne=rt==null?ze:ns(rt),ze=new ct(We,ge+"leave",tt,c,Fe),ze.target=Wn,ze.relatedTarget=Ne,We=null,Ga(Fe)===Ee&&(ct=new ct(we,ge+"enter",rt,c,Fe),ct.target=Ne,ct.relatedTarget=Wn,We=ct),Wn=We,tt&&rt)t:{for(ct=tt,we=rt,ge=0,Ne=ct;Ne;Ne=Ur(Ne))ge++;for(Ne=0,We=we;We;We=Ur(We))Ne++;for(;0<ge-Ne;)ct=Ur(ct),ge--;for(;0<Ne-ge;)we=Ur(we),Ne--;for(;ge--;){if(ct===we||we!==null&&ct===we.alternate)break t;ct=Ur(ct),we=Ur(we)}ct=null}else ct=null;tt!==null&&am(qe,ze,tt,ct,!1),rt!==null&&Wn!==null&&am(qe,Wn,rt,ct,!0)}}e:{if(ze=Ee?ns(Ee):window,tt=ze.nodeName&&ze.nodeName.toLowerCase(),tt==="select"||tt==="input"&&ze.type==="file")var dt=ru;else if(Ml(ze))if(Eo)dt=C_;else{dt=Gd;var wt=dh}else(tt=ze.nodeName)&&tt.toLowerCase()==="input"&&(ze.type==="checkbox"||ze.type==="radio")&&(dt=S_);if(dt&&(dt=dt(s,Ee))){Al(qe,dt,c,Fe);break e}wt&&wt(s,ze,Ee),s==="focusout"&&(wt=ze._wrapperState)&&wt.controlled&&ze.type==="number"&&be(ze,"number",ze.value)}switch(wt=Ee?ns(Ee):window,s){case"focusin":(Ml(wt)||wt.contentEditable==="true")&&(Mo=wt,Zd=Ee,Ll=null);break;case"focusout":Ll=Zd=Mo=null;break;case"mousedown":em=!0;break;case"contextmenu":case"mouseup":case"dragend":em=!1,iu(qe,c,Fe);break;case"selectionchange":if(ou)break;case"keydown":case"keyup":iu(qe,c,Fe)}var jt;if(El)e:{switch(s){case"compositionstart":var Ot="onCompositionStart";break e;case"compositionend":Ot="onCompositionEnd";break e;case"compositionupdate":Ot="onCompositionUpdate";break e}Ot=void 0}else ba?Yd(s,c)&&(Ot="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(Ot="onCompositionStart");Ot&&(Wd&&c.locale!=="ko"&&(ba||Ot!=="onCompositionStart"?Ot==="onCompositionEnd"&&ba&&(jt=pi()):(pr=Fe,hi="value"in pr?pr.value:pr.textContent,ba=!0)),wt=yr(Ee,Ot),0<wt.length&&(Ot=new Ie(Ot,s,null,c,Fe),qe.push({event:Ot,listeners:wt}),jt?Ot.data=jt:(jt=kl(c),jt!==null&&(Ot.data=jt)))),(jt=uh?So(s,c):Qd(s,c))&&(Ee=yr(Ee,"onBeforeInput"),0<Ee.length&&(Fe=new Ie("onBeforeInput","beforeinput",null,c,Fe),qe.push({event:Fe,listeners:Ee}),Fe.data=jt))}gh(qe,o)})}function Il(s,o,c){return{instance:s,listener:o,currentTarget:c}}function yr(s,o){for(var c=o+"Capture",h=[];s!==null;){var b=s,C=b.stateNode;b.tag===5&&C!==null&&(b=C,C=_t(s,c),C!=null&&h.unshift(Il(s,C,b)),C=_t(s,o),C!=null&&h.push(Il(s,C,b))),s=s.return}return h}function Ur(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function am(s,o,c,h,b){for(var C=o._reactName,B=[];c!==null&&c!==h;){var ie=c,he=ie.alternate,Ee=ie.stateNode;if(he!==null&&he===h)break;ie.tag===5&&Ee!==null&&(ie=Ee,b?(he=_t(c,C),he!=null&&B.unshift(Il(c,he,ie))):b||(he=_t(c,C),he!=null&&B.push(Il(c,he,ie)))),c=c.return}B.length!==0&&s.push({event:o,listeners:B})}var M_=/\r\n?/g,_h=/\u0000|\uFFFD/g;function vh(s){return(typeof s=="string"?s:""+s).replace(M_,`
`).replace(_h,"")}function hu(s,o,c){if(o=vh(o),vh(s)!==o&&c)throw Error(n(425))}function Bl(){}var om=null,Lt=null;function pu(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Ul=typeof setTimeout=="function"?setTimeout:void 0,A_=typeof clearTimeout=="function"?clearTimeout:void 0,jn=typeof Promise=="function"?Promise:void 0,O_=typeof queueMicrotask=="function"?queueMicrotask:typeof jn<"u"?function(s){return jn.resolve(null).then(s).catch(ql)}:Ul;function ql(s){setTimeout(function(){throw s})}function im(s,o){var c=o,h=0;do{var b=c.nextSibling;if(s.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"){if(h===0){s.removeChild(b),es(o);return}h--}else c!=="$"&&c!=="$?"&&c!=="$!"||h++;c=b}while(c);es(o)}function Ya(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return s}function lm(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return s;o--}else c==="/$"&&o++}s=s.previousSibling}return null}var br=Math.random().toString(36).slice(2),Zr="__reactFiber$"+br,Qa="__reactProps$"+br,ea="__reactContainer$"+br,Fn="__reactEvents$"+br,P_="__reactListeners$"+br,gu="__reactHandles$"+br;function Ga(s){var o=s[Zr];if(o)return o;for(var c=s.parentNode;c;){if(o=c[ea]||c[Zr]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(s=lm(s);s!==null;){if(c=s[Zr])return c;s=lm(s)}return o}s=c,c=s.parentNode}return null}function ta(s){return s=s[Zr]||s[ea],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function ns(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(n(33))}function _u(s){return s[Qa]||null}var ki=[],Oo=-1;function Xa(s){return{current:s}}function ln(s){0>Oo||(s.current=ki[Oo],ki[Oo]=null,Oo--)}function en(s,o){Oo++,ki[Oo]=s.current,s.current=o}var na={},ys=Xa(na),cn=Xa(!1),Ja=na;function Mi(s,o){var c=s.type.contextTypes;if(!c)return na;var h=s.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===o)return h.__reactInternalMemoizedMaskedChildContext;var b={},C;for(C in c)b[C]=o[C];return h&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=o,s.__reactInternalMemoizedMaskedChildContext=b),b}function Tn(s){return s=s.childContextTypes,s!=null}function vu(){ln(cn),ln(ys)}function cm(s,o,c){if(ys.current!==na)throw Error(n(168));en(ys,o),en(cn,c)}function yu(s,o,c){var h=s.stateNode;if(o=o.childContextTypes,typeof h.getChildContext!="function")return c;h=h.getChildContext();for(var b in h)if(!(b in o))throw Error(n(108,ne(s)||"Unknown",b));return W({},c,h)}function bu(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||na,Ja=ys.current,en(ys,s),en(cn,cn.current),!0}function yh(s,o,c){var h=s.stateNode;if(!h)throw Error(n(169));c?(s=yu(s,o,Ja),h.__reactInternalMemoizedMergedChildContext=s,ln(cn),ln(ys),en(ys,s)):ln(cn),en(cn,c)}var wa=null,xu=!1,um=!1;function bh(s){wa===null?wa=[s]:wa.push(s)}function T_(s){xu=!0,bh(s)}function Za(){if(!um&&wa!==null){um=!0;var s=0,o=Bt;try{var c=wa;for(Bt=1;s<c.length;s++){var h=c[s];do h=h(!0);while(h!==null)}wa=null,xu=!1}catch(b){throw wa!==null&&(wa=wa.slice(s+1)),ga(_s,Za),b}finally{Bt=o,um=!1}}return null}var Ai=[],Oi=0,wu=null,ju=0,xr=[],wr=0,Po=null,ja=1,Na="";function To(s,o){Ai[Oi++]=ju,Ai[Oi++]=wu,wu=s,ju=o}function xh(s,o,c){xr[wr++]=ja,xr[wr++]=Na,xr[wr++]=Po,Po=s;var h=ja;s=Na;var b=32-Be(h)-1;h&=~(1<<b),c+=1;var C=32-Be(o)+b;if(30<C){var B=b-b%5;C=(h&(1<<B)-1).toString(32),h>>=B,b-=B,ja=1<<32-Be(o)+b|c<<b|h,Na=C+s}else ja=1<<C|c<<b|h,Na=s}function dm(s){s.return!==null&&(To(s,1),xh(s,1,0))}function mm(s){for(;s===wu;)wu=Ai[--Oi],Ai[Oi]=null,ju=Ai[--Oi],Ai[Oi]=null;for(;s===Po;)Po=xr[--wr],xr[wr]=null,Na=xr[--wr],xr[wr]=null,ja=xr[--wr],xr[wr]=null}var er=null,tr=null,Nn=!1,jr=null;function Nu(s,o){var c=oe(5,null,null,0);c.elementType="DELETED",c.stateNode=o,c.return=s,o=s.deletions,o===null?(s.deletions=[c],s.flags|=16):o.push(c)}function wh(s,o){switch(s.tag){case 5:var c=s.type;return o=o.nodeType!==1||c.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(s.stateNode=o,er=s,tr=Ya(o.firstChild),!0):!1;case 6:return o=s.pendingProps===""||o.nodeType!==3?null:o,o!==null?(s.stateNode=o,er=s,tr=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(c=Po!==null?{id:ja,overflow:Na}:null,s.memoizedState={dehydrated:o,treeContext:c,retryLane:1073741824},c=oe(18,null,null,0),c.stateNode=o,c.return=s,s.child=c,er=s,tr=null,!0):!1;default:return!1}}function Hl(s){return(s.mode&1)!==0&&(s.flags&128)===0}function fm(s){if(Nn){var o=tr;if(o){var c=o;if(!wh(s,o)){if(Hl(s))throw Error(n(418));o=Ya(c.nextSibling);var h=er;o&&wh(s,o)?Nu(h,c):(s.flags=s.flags&-4097|2,Nn=!1,er=s)}}else{if(Hl(s))throw Error(n(418));s.flags=s.flags&-4097|2,Nn=!1,er=s}}}function jh(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;er=s}function qr(s){if(s!==er)return!1;if(!Nn)return jh(s),Nn=!0,!1;var o;if((o=s.tag!==3)&&!(o=s.tag!==5)&&(o=s.type,o=o!=="head"&&o!=="body"&&!pu(s.type,s.memoizedProps)),o&&(o=tr)){if(Hl(s))throw Su(),Error(n(418));for(;o;)Nu(s,o),o=Ya(o.nextSibling)}if(jh(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));e:{for(s=s.nextSibling,o=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"){if(o===0){tr=Ya(s.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++}s=s.nextSibling}tr=null}}else tr=er?Ya(s.stateNode.nextSibling):null;return!0}function Su(){for(var s=tr;s;)s=Ya(s.nextSibling)}function us(){tr=er=null,Nn=!1}function hm(s){jr===null?jr=[s]:jr.push(s)}var $_=j.ReactCurrentBatchConfig;function $o(s,o,c){if(s=c.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(n(309));var h=c.stateNode}if(!h)throw Error(n(147,s));var b=h,C=""+s;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===C?o.ref:(o=function(B){var ie=b.refs;B===null?delete ie[C]:ie[C]=B},o._stringRef=C,o)}if(typeof s!="string")throw Error(n(284));if(!c._owner)throw Error(n(290,s))}return s}function Cu(s,o){throw s=Object.prototype.toString.call(o),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s))}function Nh(s){var o=s._init;return o(s._payload)}function Sh(s){function o(we,ge){if(s){var Ne=we.deletions;Ne===null?(we.deletions=[ge],we.flags|=16):Ne.push(ge)}}function c(we,ge){if(!s)return null;for(;ge!==null;)o(we,ge),ge=ge.sibling;return null}function h(we,ge){for(we=new Map;ge!==null;)ge.key!==null?we.set(ge.key,ge):we.set(ge.index,ge),ge=ge.sibling;return we}function b(we,ge){return we=je(we,ge),we.index=0,we.sibling=null,we}function C(we,ge,Ne){return we.index=Ne,s?(Ne=we.alternate,Ne!==null?(Ne=Ne.index,Ne<ge?(we.flags|=2,ge):Ne):(we.flags|=2,ge)):(we.flags|=1048576,ge)}function B(we){return s&&we.alternate===null&&(we.flags|=2),we}function ie(we,ge,Ne,We){return ge===null||ge.tag!==6?(ge=Ft(Ne,we.mode,We),ge.return=we,ge):(ge=b(ge,Ne),ge.return=we,ge)}function he(we,ge,Ne,We){var dt=Ne.type;return dt===z?Fe(we,ge,Ne.props.children,We,Ne.key):ge!==null&&(ge.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===Y&&Nh(dt)===ge.type)?(We=b(ge,Ne.props),We.ref=$o(we,ge,Ne),We.return=we,We):(We=Le(Ne.type,Ne.key,Ne.props,null,we.mode,We),We.ref=$o(we,ge,Ne),We.return=we,We)}function Ee(we,ge,Ne,We){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Ne.containerInfo||ge.stateNode.implementation!==Ne.implementation?(ge=xn(Ne,we.mode,We),ge.return=we,ge):(ge=b(ge,Ne.children||[]),ge.return=we,ge)}function Fe(we,ge,Ne,We,dt){return ge===null||ge.tag!==7?(ge=lt(Ne,we.mode,We,dt),ge.return=we,ge):(ge=b(ge,Ne),ge.return=we,ge)}function qe(we,ge,Ne){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=Ft(""+ge,we.mode,Ne),ge.return=we,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case O:return Ne=Le(ge.type,ge.key,ge.props,null,we.mode,Ne),Ne.ref=$o(we,null,ge),Ne.return=we,Ne;case A:return ge=xn(ge,we.mode,Ne),ge.return=we,ge;case Y:var We=ge._init;return qe(we,We(ge._payload),Ne)}if(Pe(ge)||te(ge))return ge=lt(ge,we.mode,Ne,null),ge.return=we,ge;Cu(we,ge)}return null}function ze(we,ge,Ne,We){var dt=ge!==null?ge.key:null;if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return dt!==null?null:ie(we,ge,""+Ne,We);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case O:return Ne.key===dt?he(we,ge,Ne,We):null;case A:return Ne.key===dt?Ee(we,ge,Ne,We):null;case Y:return dt=Ne._init,ze(we,ge,dt(Ne._payload),We)}if(Pe(Ne)||te(Ne))return dt!==null?null:Fe(we,ge,Ne,We,null);Cu(we,Ne)}return null}function tt(we,ge,Ne,We,dt){if(typeof We=="string"&&We!==""||typeof We=="number")return we=we.get(Ne)||null,ie(ge,we,""+We,dt);if(typeof We=="object"&&We!==null){switch(We.$$typeof){case O:return we=we.get(We.key===null?Ne:We.key)||null,he(ge,we,We,dt);case A:return we=we.get(We.key===null?Ne:We.key)||null,Ee(ge,we,We,dt);case Y:var wt=We._init;return tt(we,ge,Ne,wt(We._payload),dt)}if(Pe(We)||te(We))return we=we.get(Ne)||null,Fe(ge,we,We,dt,null);Cu(ge,We)}return null}function rt(we,ge,Ne,We){for(var dt=null,wt=null,jt=ge,Ot=ge=0,js=null;jt!==null&&Ot<Ne.length;Ot++){jt.index>Ot?(js=jt,jt=null):js=jt.sibling;var tn=ze(we,jt,Ne[Ot],We);if(tn===null){jt===null&&(jt=js);break}s&&jt&&tn.alternate===null&&o(we,jt),ge=C(tn,ge,Ot),wt===null?dt=tn:wt.sibling=tn,wt=tn,jt=js}if(Ot===Ne.length)return c(we,jt),Nn&&To(we,Ot),dt;if(jt===null){for(;Ot<Ne.length;Ot++)jt=qe(we,Ne[Ot],We),jt!==null&&(ge=C(jt,ge,Ot),wt===null?dt=jt:wt.sibling=jt,wt=jt);return Nn&&To(we,Ot),dt}for(jt=h(we,jt);Ot<Ne.length;Ot++)js=tt(jt,we,Ot,Ne[Ot],We),js!==null&&(s&&js.alternate!==null&&jt.delete(js.key===null?Ot:js.key),ge=C(js,ge,Ot),wt===null?dt=js:wt.sibling=js,wt=js);return s&&jt.forEach(function(Wi){return o(we,Wi)}),Nn&&To(we,Ot),dt}function ct(we,ge,Ne,We){var dt=te(Ne);if(typeof dt!="function")throw Error(n(150));if(Ne=dt.call(Ne),Ne==null)throw Error(n(151));for(var wt=dt=null,jt=ge,Ot=ge=0,js=null,tn=Ne.next();jt!==null&&!tn.done;Ot++,tn=Ne.next()){jt.index>Ot?(js=jt,jt=null):js=jt.sibling;var Wi=ze(we,jt,tn.value,We);if(Wi===null){jt===null&&(jt=js);break}s&&jt&&Wi.alternate===null&&o(we,jt),ge=C(Wi,ge,Ot),wt===null?dt=Wi:wt.sibling=Wi,wt=Wi,jt=js}if(tn.done)return c(we,jt),Nn&&To(we,Ot),dt;if(jt===null){for(;!tn.done;Ot++,tn=Ne.next())tn=qe(we,tn.value,We),tn!==null&&(ge=C(tn,ge,Ot),wt===null?dt=tn:wt.sibling=tn,wt=tn);return Nn&&To(we,Ot),dt}for(jt=h(we,jt);!tn.done;Ot++,tn=Ne.next())tn=tt(jt,we,Ot,tn.value,We),tn!==null&&(s&&tn.alternate!==null&&jt.delete(tn.key===null?Ot:tn.key),ge=C(tn,ge,Ot),wt===null?dt=tn:wt.sibling=tn,wt=tn);return s&&jt.forEach(function(UL){return o(we,UL)}),Nn&&To(we,Ot),dt}function Wn(we,ge,Ne,We){if(typeof Ne=="object"&&Ne!==null&&Ne.type===z&&Ne.key===null&&(Ne=Ne.props.children),typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case O:e:{for(var dt=Ne.key,wt=ge;wt!==null;){if(wt.key===dt){if(dt=Ne.type,dt===z){if(wt.tag===7){c(we,wt.sibling),ge=b(wt,Ne.props.children),ge.return=we,we=ge;break e}}else if(wt.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===Y&&Nh(dt)===wt.type){c(we,wt.sibling),ge=b(wt,Ne.props),ge.ref=$o(we,wt,Ne),ge.return=we,we=ge;break e}c(we,wt);break}else o(we,wt);wt=wt.sibling}Ne.type===z?(ge=lt(Ne.props.children,we.mode,We,Ne.key),ge.return=we,we=ge):(We=Le(Ne.type,Ne.key,Ne.props,null,we.mode,We),We.ref=$o(we,ge,Ne),We.return=we,we=We)}return B(we);case A:e:{for(wt=Ne.key;ge!==null;){if(ge.key===wt)if(ge.tag===4&&ge.stateNode.containerInfo===Ne.containerInfo&&ge.stateNode.implementation===Ne.implementation){c(we,ge.sibling),ge=b(ge,Ne.children||[]),ge.return=we,we=ge;break e}else{c(we,ge);break}else o(we,ge);ge=ge.sibling}ge=xn(Ne,we.mode,We),ge.return=we,we=ge}return B(we);case Y:return wt=Ne._init,Wn(we,ge,wt(Ne._payload),We)}if(Pe(Ne))return rt(we,ge,Ne,We);if(te(Ne))return ct(we,ge,Ne,We);Cu(we,Ne)}return typeof Ne=="string"&&Ne!==""||typeof Ne=="number"?(Ne=""+Ne,ge!==null&&ge.tag===6?(c(we,ge.sibling),ge=b(ge,Ne),ge.return=we,we=ge):(c(we,ge),ge=Ft(Ne,we.mode,We),ge.return=we,we=ge),B(we)):c(we,ge)}return Wn}var Pi=Sh(!0),Ch=Sh(!1),Eu=Xa(null),ku=null,Ti=null,pm=null;function Lo(){pm=Ti=ku=null}function Vl(s){var o=Eu.current;ln(Eu),s._currentValue=o}function gm(s,o,c){for(;s!==null;){var h=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,h!==null&&(h.childLanes|=o)):h!==null&&(h.childLanes&o)!==o&&(h.childLanes|=o),s===c)break;s=s.return}}function $i(s,o){ku=s,pm=Ti=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&o&&(Bs=!0),s.firstContext=null)}function Ps(s){var o=s._currentValue;if(pm!==s)if(s={context:s,memoizedValue:o,next:null},Ti===null){if(ku===null)throw Error(n(308));Ti=s,ku.dependencies={lanes:0,firstContext:s}}else Ti=Ti.next=s;return o}var Do=null;function Li(s){Do===null?Do=[s]:Do.push(s)}function zo(s,o,c,h){var b=o.interleaved;return b===null?(c.next=c,Li(o)):(c.next=b.next,b.next=c),o.interleaved=c,Sa(s,h)}function Sa(s,o){s.lanes|=o;var c=s.alternate;for(c!==null&&(c.lanes|=o),c=s,s=s.return;s!==null;)s.childLanes|=o,c=s.alternate,c!==null&&(c.childLanes|=o),c=s,s=s.return;return c.tag===3?c.stateNode:null}var eo=!1;function _m(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Eh(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Ca(s,o){return{eventTime:s,lane:o,tag:0,payload:null,callback:null,next:null}}function Ea(s,o,c){var h=s.updateQueue;if(h===null)return null;if(h=h.shared,Kt&2){var b=h.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),h.pending=o,Sa(s,c)}return b=h.interleaved,b===null?(o.next=o,Li(h)):(o.next=b.next,b.next=o),h.interleaved=o,Sa(s,c)}function Mu(s,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194240)!==0)){var h=o.lanes;h&=s.pendingLanes,c|=h,o.lanes=c,jl(s,c)}}function kh(s,o){var c=s.updateQueue,h=s.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var b=null,C=null;if(c=c.firstBaseUpdate,c!==null){do{var B={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};C===null?b=C=B:C=C.next=B,c=c.next}while(c!==null);C===null?b=C=o:C=C.next=o}else b=C=o;c={baseState:h.baseState,firstBaseUpdate:b,lastBaseUpdate:C,shared:h.shared,effects:h.effects},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=o:s.next=o,c.lastBaseUpdate=o}function Au(s,o,c,h){var b=s.updateQueue;eo=!1;var C=b.firstBaseUpdate,B=b.lastBaseUpdate,ie=b.shared.pending;if(ie!==null){b.shared.pending=null;var he=ie,Ee=he.next;he.next=null,B===null?C=Ee:B.next=Ee,B=he;var Fe=s.alternate;Fe!==null&&(Fe=Fe.updateQueue,ie=Fe.lastBaseUpdate,ie!==B&&(ie===null?Fe.firstBaseUpdate=Ee:ie.next=Ee,Fe.lastBaseUpdate=he))}if(C!==null){var qe=b.baseState;B=0,Fe=Ee=he=null,ie=C;do{var ze=ie.lane,tt=ie.eventTime;if((h&ze)===ze){Fe!==null&&(Fe=Fe.next={eventTime:tt,lane:0,tag:ie.tag,payload:ie.payload,callback:ie.callback,next:null});e:{var rt=s,ct=ie;switch(ze=o,tt=c,ct.tag){case 1:if(rt=ct.payload,typeof rt=="function"){qe=rt.call(tt,qe,ze);break e}qe=rt;break e;case 3:rt.flags=rt.flags&-65537|128;case 0:if(rt=ct.payload,ze=typeof rt=="function"?rt.call(tt,qe,ze):rt,ze==null)break e;qe=W({},qe,ze);break e;case 2:eo=!0}}ie.callback!==null&&ie.lane!==0&&(s.flags|=64,ze=b.effects,ze===null?b.effects=[ie]:ze.push(ie))}else tt={eventTime:tt,lane:ze,tag:ie.tag,payload:ie.payload,callback:ie.callback,next:null},Fe===null?(Ee=Fe=tt,he=qe):Fe=Fe.next=tt,B|=ze;if(ie=ie.next,ie===null){if(ie=b.shared.pending,ie===null)break;ze=ie,ie=ze.next,ze.next=null,b.lastBaseUpdate=ze,b.shared.pending=null}}while(!0);if(Fe===null&&(he=qe),b.baseState=he,b.firstBaseUpdate=Ee,b.lastBaseUpdate=Fe,o=b.shared.interleaved,o!==null){b=o;do B|=b.lane,b=b.next;while(b!==o)}else C===null&&(b.shared.lanes=0);qo|=B,s.lanes=B,s.memoizedState=qe}}function Mh(s,o,c){if(s=o.effects,o.effects=null,s!==null)for(o=0;o<s.length;o++){var h=s[o],b=h.callback;if(b!==null){if(h.callback=null,h=c,typeof b!="function")throw Error(n(191,b));b.call(h)}}}var ss={},sa=Xa(ss),Wl=Xa(ss),Kl=Xa(ss);function Ro(s){if(s===ss)throw Error(n(174));return s}function vm(s,o){switch(en(Kl,o),en(Wl,s),en(sa,ss),s=o.nodeType,s){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:ve(null,"");break;default:s=s===8?o.parentNode:o,o=s.namespaceURI||null,s=s.tagName,o=ve(o,s)}ln(sa),en(sa,o)}function Fo(){ln(sa),ln(Wl),ln(Kl)}function Ah(s){Ro(Kl.current);var o=Ro(sa.current),c=ve(o,s.type);o!==c&&(en(Wl,s),en(sa,c))}function Ou(s){Wl.current===s&&(ln(sa),ln(Wl))}var Sn=Xa(0);function vn(s){for(var o=s;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Hr=[];function Nr(){for(var s=0;s<Hr.length;s++)Hr[s]._workInProgressVersionPrimary=null;Hr.length=0}var Sr=j.ReactCurrentDispatcher,Oh=j.ReactCurrentBatchConfig,Io=0,Cn=null,un=null,Hn=null,Pu=!1,Yl=!1,Ql=0,Di=0;function rs(){throw Error(n(321))}function ym(s,o){if(o===null)return!1;for(var c=0;c<o.length&&c<s.length;c++)if(!_r(s[c],o[c]))return!1;return!0}function Gl(s,o,c,h,b,C){if(Io=C,Cn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Sr.current=s===null||s.memoizedState===null?D_:z_,s=c(h,b),Yl){C=0;do{if(Yl=!1,Ql=0,25<=C)throw Error(n(301));C+=1,Hn=un=null,o.updateQueue=null,Sr.current=R_,s=c(h,b)}while(Yl)}if(Sr.current=zu,o=un!==null&&un.next!==null,Io=0,Hn=un=Cn=null,Pu=!1,o)throw Error(n(300));return s}function bm(){var s=Ql!==0;return Ql=0,s}function ra(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hn===null?Cn.memoizedState=Hn=s:Hn=Hn.next=s,Hn}function Cr(){if(un===null){var s=Cn.alternate;s=s!==null?s.memoizedState:null}else s=un.next;var o=Hn===null?Cn.memoizedState:Hn.next;if(o!==null)Hn=o,un=s;else{if(s===null)throw Error(n(310));un=s,s={memoizedState:un.memoizedState,baseState:un.baseState,baseQueue:un.baseQueue,queue:un.queue,next:null},Hn===null?Cn.memoizedState=Hn=s:Hn=Hn.next=s}return Hn}function Xl(s,o){return typeof o=="function"?o(s):o}function to(s){var o=Cr(),c=o.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=s;var h=un,b=h.baseQueue,C=c.pending;if(C!==null){if(b!==null){var B=b.next;b.next=C.next,C.next=B}h.baseQueue=b=C,c.pending=null}if(b!==null){C=b.next,h=h.baseState;var ie=B=null,he=null,Ee=C;do{var Fe=Ee.lane;if((Io&Fe)===Fe)he!==null&&(he=he.next={lane:0,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null}),h=Ee.hasEagerState?Ee.eagerState:s(h,Ee.action);else{var qe={lane:Fe,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null};he===null?(ie=he=qe,B=h):he=he.next=qe,Cn.lanes|=Fe,qo|=Fe}Ee=Ee.next}while(Ee!==null&&Ee!==C);he===null?B=h:he.next=ie,_r(h,o.memoizedState)||(Bs=!0),o.memoizedState=h,o.baseState=B,o.baseQueue=he,c.lastRenderedState=h}if(s=c.interleaved,s!==null){b=s;do C=b.lane,Cn.lanes|=C,qo|=C,b=b.next;while(b!==s)}else b===null&&(c.lanes=0);return[o.memoizedState,c.dispatch]}function Tu(s){var o=Cr(),c=o.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=s;var h=c.dispatch,b=c.pending,C=o.memoizedState;if(b!==null){c.pending=null;var B=b=b.next;do C=s(C,B.action),B=B.next;while(B!==b);_r(C,o.memoizedState)||(Bs=!0),o.memoizedState=C,o.baseQueue===null&&(o.baseState=C),c.lastRenderedState=C}return[C,h]}function Ph(){}function Th(s,o){var c=Cn,h=Cr(),b=o(),C=!_r(h.memoizedState,b);if(C&&(h.memoizedState=b,Bs=!0),h=h.queue,xm(Dh.bind(null,c,h,s),[s]),h.getSnapshot!==o||C||Hn!==null&&Hn.memoizedState.tag&1){if(c.flags|=2048,Jl(9,Lh.bind(null,c,h,b,o),void 0,null),hn===null)throw Error(n(349));Io&30||$h(c,o,b)}return b}function $h(s,o,c){s.flags|=16384,s={getSnapshot:o,value:c},o=Cn.updateQueue,o===null?(o={lastEffect:null,stores:null},Cn.updateQueue=o,o.stores=[s]):(c=o.stores,c===null?o.stores=[s]:c.push(s))}function Lh(s,o,c,h){o.value=c,o.getSnapshot=h,zh(o)&&Bo(s)}function Dh(s,o,c){return c(function(){zh(o)&&Bo(s)})}function zh(s){var o=s.getSnapshot;s=s.value;try{var c=o();return!_r(s,c)}catch{return!0}}function Bo(s){var o=Sa(s,1);o!==null&&Mr(o,s,1,-1)}function Rh(s){var o=ra();return typeof s=="function"&&(s=s()),o.memoizedState=o.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xl,lastRenderedState:s},o.queue=s,s=s.dispatch=L_.bind(null,Cn,s),[o.memoizedState,s]}function Jl(s,o,c,h){return s={tag:s,create:o,destroy:c,deps:h,next:null},o=Cn.updateQueue,o===null?(o={lastEffect:null,stores:null},Cn.updateQueue=o,o.lastEffect=s.next=s):(c=o.lastEffect,c===null?o.lastEffect=s.next=s:(h=c.next,c.next=s,s.next=h,o.lastEffect=s)),s}function Fh(){return Cr().memoizedState}function $u(s,o,c,h){var b=ra();Cn.flags|=s,b.memoizedState=Jl(1|o,c,void 0,h===void 0?null:h)}function Lu(s,o,c,h){var b=Cr();h=h===void 0?null:h;var C=void 0;if(un!==null){var B=un.memoizedState;if(C=B.destroy,h!==null&&ym(h,B.deps)){b.memoizedState=Jl(o,c,C,h);return}}Cn.flags|=s,b.memoizedState=Jl(1|o,c,C,h)}function Ih(s,o){return $u(8390656,8,s,o)}function xm(s,o){return Lu(2048,8,s,o)}function Bh(s,o){return Lu(4,2,s,o)}function Uh(s,o){return Lu(4,4,s,o)}function no(s,o){if(typeof o=="function")return s=s(),o(s),function(){o(null)};if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function ka(s,o,c){return c=c!=null?c.concat([s]):null,Lu(4,4,no.bind(null,o,s),c)}function Er(){}function Du(s,o){var c=Cr();o=o===void 0?null:o;var h=c.memoizedState;return h!==null&&o!==null&&ym(o,h[1])?h[0]:(c.memoizedState=[s,o],s)}function qh(s,o){var c=Cr();o=o===void 0?null:o;var h=c.memoizedState;return h!==null&&o!==null&&ym(o,h[1])?h[0]:(s=s(),c.memoizedState=[s,o],s)}function nr(s,o,c){return Io&21?(_r(c,o)||(c=is(),Cn.lanes|=c,qo|=c,s.baseState=!0),o):(s.baseState&&(s.baseState=!1,Bs=!0),s.memoizedState=c)}function Hh(s,o){var c=Bt;Bt=c!==0&&4>c?c:4,s(!0);var h=Oh.transition;Oh.transition={};try{s(!1),o()}finally{Bt=c,Oh.transition=h}}function wm(){return Cr().memoizedState}function Zl(s,o,c){var h=Oa(s);if(c={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null},Vh(s))Wh(o,c);else if(c=zo(s,o,c,h),c!==null){var b=ws();Mr(c,s,h,b),Kh(c,o,h)}}function L_(s,o,c){var h=Oa(s),b={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null};if(Vh(s))Wh(o,b);else{var C=s.alternate;if(s.lanes===0&&(C===null||C.lanes===0)&&(C=o.lastRenderedReducer,C!==null))try{var B=o.lastRenderedState,ie=C(B,c);if(b.hasEagerState=!0,b.eagerState=ie,_r(ie,B)){var he=o.interleaved;he===null?(b.next=b,Li(o)):(b.next=he.next,he.next=b),o.interleaved=b;return}}catch{}finally{}c=zo(s,o,b,h),c!==null&&(b=ws(),Mr(c,s,h,b),Kh(c,o,h))}}function Vh(s){var o=s.alternate;return s===Cn||o!==null&&o===Cn}function Wh(s,o){Yl=Pu=!0;var c=s.pending;c===null?o.next=o:(o.next=c.next,c.next=o),s.pending=o}function Kh(s,o,c){if(c&4194240){var h=o.lanes;h&=s.pendingLanes,c|=h,o.lanes=c,jl(s,c)}}var zu={readContext:Ps,useCallback:rs,useContext:rs,useEffect:rs,useImperativeHandle:rs,useInsertionEffect:rs,useLayoutEffect:rs,useMemo:rs,useReducer:rs,useRef:rs,useState:rs,useDebugValue:rs,useDeferredValue:rs,useTransition:rs,useMutableSource:rs,useSyncExternalStore:rs,useId:rs,unstable_isNewReconciler:!1},D_={readContext:Ps,useCallback:function(s,o){return ra().memoizedState=[s,o===void 0?null:o],s},useContext:Ps,useEffect:Ih,useImperativeHandle:function(s,o,c){return c=c!=null?c.concat([s]):null,$u(4194308,4,no.bind(null,o,s),c)},useLayoutEffect:function(s,o){return $u(4194308,4,s,o)},useInsertionEffect:function(s,o){return $u(4,2,s,o)},useMemo:function(s,o){var c=ra();return o=o===void 0?null:o,s=s(),c.memoizedState=[s,o],s},useReducer:function(s,o,c){var h=ra();return o=c!==void 0?c(o):o,h.memoizedState=h.baseState=o,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:o},h.queue=s,s=s.dispatch=Zl.bind(null,Cn,s),[h.memoizedState,s]},useRef:function(s){var o=ra();return s={current:s},o.memoizedState=s},useState:Rh,useDebugValue:Er,useDeferredValue:function(s){return ra().memoizedState=s},useTransition:function(){var s=Rh(!1),o=s[0];return s=Hh.bind(null,s[1]),ra().memoizedState=s,[o,s]},useMutableSource:function(){},useSyncExternalStore:function(s,o,c){var h=Cn,b=ra();if(Nn){if(c===void 0)throw Error(n(407));c=c()}else{if(c=o(),hn===null)throw Error(n(349));Io&30||$h(h,o,c)}b.memoizedState=c;var C={value:c,getSnapshot:o};return b.queue=C,Ih(Dh.bind(null,h,C,s),[s]),h.flags|=2048,Jl(9,Lh.bind(null,h,C,c,o),void 0,null),c},useId:function(){var s=ra(),o=hn.identifierPrefix;if(Nn){var c=Na,h=ja;c=(h&~(1<<32-Be(h)-1)).toString(32)+c,o=":"+o+"R"+c,c=Ql++,0<c&&(o+="H"+c.toString(32)),o+=":"}else c=Di++,o=":"+o+"r"+c.toString(32)+":";return s.memoizedState=o},unstable_isNewReconciler:!1},z_={readContext:Ps,useCallback:Du,useContext:Ps,useEffect:xm,useImperativeHandle:ka,useInsertionEffect:Bh,useLayoutEffect:Uh,useMemo:qh,useReducer:to,useRef:Fh,useState:function(){return to(Xl)},useDebugValue:Er,useDeferredValue:function(s){var o=Cr();return nr(o,un.memoizedState,s)},useTransition:function(){var s=to(Xl)[0],o=Cr().memoizedState;return[s,o]},useMutableSource:Ph,useSyncExternalStore:Th,useId:wm,unstable_isNewReconciler:!1},R_={readContext:Ps,useCallback:Du,useContext:Ps,useEffect:xm,useImperativeHandle:ka,useInsertionEffect:Bh,useLayoutEffect:Uh,useMemo:qh,useReducer:Tu,useRef:Fh,useState:function(){return Tu(Xl)},useDebugValue:Er,useDeferredValue:function(s){var o=Cr();return un===null?o.memoizedState=s:nr(o,un.memoizedState,s)},useTransition:function(){var s=Tu(Xl)[0],o=Cr().memoizedState;return[s,o]},useMutableSource:Ph,useSyncExternalStore:Th,useId:wm,unstable_isNewReconciler:!1};function as(s,o){if(s&&s.defaultProps){o=W({},o),s=s.defaultProps;for(var c in s)o[c]===void 0&&(o[c]=s[c]);return o}return o}function sr(s,o,c,h){o=s.memoizedState,c=c(h,o),c=c==null?o:W({},o,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var zi={isMounted:function(s){return(s=s._reactInternals)?gs(s)===s:!1},enqueueSetState:function(s,o,c){s=s._reactInternals;var h=ws(),b=Oa(s),C=Ca(h,b);C.payload=o,c!=null&&(C.callback=c),o=Ea(s,C,b),o!==null&&(Mr(o,s,b,h),Mu(o,s,b))},enqueueReplaceState:function(s,o,c){s=s._reactInternals;var h=ws(),b=Oa(s),C=Ca(h,b);C.tag=1,C.payload=o,c!=null&&(C.callback=c),o=Ea(s,C,b),o!==null&&(Mr(o,s,b,h),Mu(o,s,b))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var c=ws(),h=Oa(s),b=Ca(c,h);b.tag=2,o!=null&&(b.callback=o),o=Ea(s,b,h),o!==null&&(Mr(o,s,h,c),Mu(o,s,h))}};function Yh(s,o,c,h,b,C,B){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(h,C,B):o.prototype&&o.prototype.isPureReactComponent?!Si(c,h)||!Si(b,C):!0}function Qh(s,o,c){var h=!1,b=na,C=o.contextType;return typeof C=="object"&&C!==null?C=Ps(C):(b=Tn(o)?Ja:ys.current,h=o.contextTypes,C=(h=h!=null)?Mi(s,b):na),o=new o(c,C),s.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=zi,s.stateNode=o,o._reactInternals=s,h&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=b,s.__reactInternalMemoizedMaskedChildContext=C),o}function Gh(s,o,c,h){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,h),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,h),o.state!==s&&zi.enqueueReplaceState(o,o.state,null)}function jm(s,o,c,h){var b=s.stateNode;b.props=c,b.state=s.memoizedState,b.refs={},_m(s);var C=o.contextType;typeof C=="object"&&C!==null?b.context=Ps(C):(C=Tn(o)?Ja:ys.current,b.context=Mi(s,C)),b.state=s.memoizedState,C=o.getDerivedStateFromProps,typeof C=="function"&&(sr(s,o,C,c),b.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(o=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),o!==b.state&&zi.enqueueReplaceState(b,b.state,null),Au(s,c,b,h),b.state=s.memoizedState),typeof b.componentDidMount=="function"&&(s.flags|=4194308)}function Ri(s,o){try{var c="",h=o;do c+=H(h),h=h.return;while(h);var b=c}catch(C){b=`
Error generating stack: `+C.message+`
`+C.stack}return{value:s,source:o,stack:b,digest:null}}function Nm(s,o,c){return{value:s,source:null,stack:c??null,digest:o??null}}function Fi(s,o){try{console.error(o.value)}catch(c){setTimeout(function(){throw c})}}var F_=typeof WeakMap=="function"?WeakMap:Map;function aa(s,o,c){c=Ca(-1,c),c.tag=3,c.payload={element:null};var h=o.value;return c.callback=function(){Xt||(Xt=!0,Rm=h),Fi(s,o)},c}function Sm(s,o,c){c=Ca(-1,c),c.tag=3;var h=s.type.getDerivedStateFromError;if(typeof h=="function"){var b=o.value;c.payload=function(){return h(b)},c.callback=function(){Fi(s,o)}}var C=s.stateNode;return C!==null&&typeof C.componentDidCatch=="function"&&(c.callback=function(){Fi(s,o),typeof h!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var B=o.stack;this.componentDidCatch(o.value,{componentStack:B!==null?B:""})}),c}function Xh(s,o,c){var h=s.pingCache;if(h===null){h=s.pingCache=new F_;var b=new Set;h.set(o,b)}else b=h.get(o),b===void 0&&(b=new Set,h.set(o,b));b.has(c)||(b.add(c),s=wp.bind(null,s,o,c),o.then(s,s))}function Jh(s){do{var o;if((o=s.tag===13)&&(o=s.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return s;s=s.return}while(s!==null);return null}function Zh(s,o,c,h,b){return s.mode&1?(s.flags|=65536,s.lanes=b,s):(s===o?s.flags|=65536:(s.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(o=Ca(-1,1),o.tag=2,Ea(c,o,1))),c.lanes|=1),s)}var I_=j.ReactCurrentOwner,Bs=!1;function Ts(s,o,c,h){o.child=s===null?Ch(o,null,c,h):Pi(o,s.child,c,h)}function Cm(s,o,c,h,b){c=c.render;var C=o.ref;return $i(o,b),h=Gl(s,o,c,h,C,b),c=bm(),s!==null&&!Bs?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~b,oa(s,o,b)):(Nn&&c&&dm(o),o.flags|=1,Ts(s,o,h,b),o.child)}function ep(s,o,c,h,b){if(s===null){var C=c.type;return typeof C=="function"&&!ue(C)&&C.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(o.tag=15,o.type=C,tp(s,o,C,h,b)):(s=Le(c.type,null,h,o,o.mode,b),s.ref=o.ref,s.return=o,o.child=s)}if(C=s.child,!(s.lanes&b)){var B=C.memoizedProps;if(c=c.compare,c=c!==null?c:Si,c(B,h)&&s.ref===o.ref)return oa(s,o,b)}return o.flags|=1,s=je(C,h),s.ref=o.ref,s.return=o,o.child=s}function tp(s,o,c,h,b){if(s!==null){var C=s.memoizedProps;if(Si(C,h)&&s.ref===o.ref)if(Bs=!1,o.pendingProps=h=C,(s.lanes&b)!==0)s.flags&131072&&(Bs=!0);else return o.lanes=s.lanes,oa(s,o,b)}return Em(s,o,c,h,b)}function Ru(s,o,c){var h=o.pendingProps,b=h.children,C=s!==null?s.memoizedState:null;if(h.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},en(Ui,rr),rr|=c;else{if(!(c&1073741824))return s=C!==null?C.baseLanes|c:c,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:s,cachePool:null,transitions:null},o.updateQueue=null,en(Ui,rr),rr|=s,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=C!==null?C.baseLanes:c,en(Ui,rr),rr|=h}else C!==null?(h=C.baseLanes|c,o.memoizedState=null):h=c,en(Ui,rr),rr|=h;return Ts(s,o,b,c),o.child}function np(s,o){var c=o.ref;(s===null&&c!==null||s!==null&&s.ref!==c)&&(o.flags|=512,o.flags|=2097152)}function Em(s,o,c,h,b){var C=Tn(c)?Ja:ys.current;return C=Mi(o,C),$i(o,b),c=Gl(s,o,c,h,C,b),h=bm(),s!==null&&!Bs?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~b,oa(s,o,b)):(Nn&&h&&dm(o),o.flags|=1,Ts(s,o,c,b),o.child)}function km(s,o,c,h,b){if(Tn(c)){var C=!0;bu(o)}else C=!1;if($i(o,b),o.stateNode===null)sc(s,o),Qh(o,c,h),jm(o,c,h,b),h=!0;else if(s===null){var B=o.stateNode,ie=o.memoizedProps;B.props=ie;var he=B.context,Ee=c.contextType;typeof Ee=="object"&&Ee!==null?Ee=Ps(Ee):(Ee=Tn(c)?Ja:ys.current,Ee=Mi(o,Ee));var Fe=c.getDerivedStateFromProps,qe=typeof Fe=="function"||typeof B.getSnapshotBeforeUpdate=="function";qe||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(ie!==h||he!==Ee)&&Gh(o,B,h,Ee),eo=!1;var ze=o.memoizedState;B.state=ze,Au(o,h,B,b),he=o.memoizedState,ie!==h||ze!==he||cn.current||eo?(typeof Fe=="function"&&(sr(o,c,Fe,h),he=o.memoizedState),(ie=eo||Yh(o,c,ie,h,ze,he,Ee))?(qe||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(o.flags|=4194308)):(typeof B.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=h,o.memoizedState=he),B.props=h,B.state=he,B.context=Ee,h=ie):(typeof B.componentDidMount=="function"&&(o.flags|=4194308),h=!1)}else{B=o.stateNode,Eh(s,o),ie=o.memoizedProps,Ee=o.type===o.elementType?ie:as(o.type,ie),B.props=Ee,qe=o.pendingProps,ze=B.context,he=c.contextType,typeof he=="object"&&he!==null?he=Ps(he):(he=Tn(c)?Ja:ys.current,he=Mi(o,he));var tt=c.getDerivedStateFromProps;(Fe=typeof tt=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(ie!==qe||ze!==he)&&Gh(o,B,h,he),eo=!1,ze=o.memoizedState,B.state=ze,Au(o,h,B,b);var rt=o.memoizedState;ie!==qe||ze!==rt||cn.current||eo?(typeof tt=="function"&&(sr(o,c,tt,h),rt=o.memoizedState),(Ee=eo||Yh(o,c,Ee,h,ze,rt,he)||!1)?(Fe||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(h,rt,he),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(h,rt,he)),typeof B.componentDidUpdate=="function"&&(o.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof B.componentDidUpdate!="function"||ie===s.memoizedProps&&ze===s.memoizedState||(o.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ie===s.memoizedProps&&ze===s.memoizedState||(o.flags|=1024),o.memoizedProps=h,o.memoizedState=rt),B.props=h,B.state=rt,B.context=he,h=Ee):(typeof B.componentDidUpdate!="function"||ie===s.memoizedProps&&ze===s.memoizedState||(o.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ie===s.memoizedProps&&ze===s.memoizedState||(o.flags|=1024),h=!1)}return ec(s,o,c,h,C,b)}function ec(s,o,c,h,b,C){np(s,o);var B=(o.flags&128)!==0;if(!h&&!B)return b&&yh(o,c,!1),oa(s,o,C);h=o.stateNode,I_.current=o;var ie=B&&typeof c.getDerivedStateFromError!="function"?null:h.render();return o.flags|=1,s!==null&&B?(o.child=Pi(o,s.child,null,C),o.child=Pi(o,null,ie,C)):Ts(s,o,ie,C),o.memoizedState=h.state,b&&yh(o,c,!0),o.child}function sp(s){var o=s.stateNode;o.pendingContext?cm(s,o.pendingContext,o.pendingContext!==o.context):o.context&&cm(s,o.context,!1),vm(s,o.containerInfo)}function rp(s,o,c,h,b){return us(),hm(b),o.flags|=256,Ts(s,o,c,h),o.child}var Mm={dehydrated:null,treeContext:null,retryLane:0};function Am(s){return{baseLanes:s,cachePool:null,transitions:null}}function ap(s,o,c){var h=o.pendingProps,b=Sn.current,C=!1,B=(o.flags&128)!==0,ie;if((ie=B)||(ie=s!==null&&s.memoizedState===null?!1:(b&2)!==0),ie?(C=!0,o.flags&=-129):(s===null||s.memoizedState!==null)&&(b|=1),en(Sn,b&1),s===null)return fm(o),s=o.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(o.mode&1?s.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(B=h.children,s=h.fallback,C?(h=o.mode,C=o.child,B={mode:"hidden",children:B},!(h&1)&&C!==null?(C.childLanes=0,C.pendingProps=B):C=vt(B,h,0,null),s=lt(s,h,c,null),C.return=o,s.return=o,C.sibling=s,o.child=C,o.child.memoizedState=Am(c),o.memoizedState=Mm,s):tc(o,B));if(b=s.memoizedState,b!==null&&(ie=b.dehydrated,ie!==null))return B_(s,o,B,h,ie,b,c);if(C){C=h.fallback,B=o.mode,b=s.child,ie=b.sibling;var he={mode:"hidden",children:h.children};return!(B&1)&&o.child!==b?(h=o.child,h.childLanes=0,h.pendingProps=he,o.deletions=null):(h=je(b,he),h.subtreeFlags=b.subtreeFlags&14680064),ie!==null?C=je(ie,C):(C=lt(C,B,c,null),C.flags|=2),C.return=o,h.return=o,h.sibling=C,o.child=h,h=C,C=o.child,B=s.child.memoizedState,B=B===null?Am(c):{baseLanes:B.baseLanes|c,cachePool:null,transitions:B.transitions},C.memoizedState=B,C.childLanes=s.childLanes&~c,o.memoizedState=Mm,h}return C=s.child,s=C.sibling,h=je(C,{mode:"visible",children:h.children}),!(o.mode&1)&&(h.lanes=c),h.return=o,h.sibling=null,s!==null&&(c=o.deletions,c===null?(o.deletions=[s],o.flags|=16):c.push(s)),o.child=h,o.memoizedState=null,h}function tc(s,o){return o=vt({mode:"visible",children:o},s.mode,0,null),o.return=s,s.child=o}function Fu(s,o,c,h){return h!==null&&hm(h),Pi(o,s.child,null,c),s=tc(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function B_(s,o,c,h,b,C,B){if(c)return o.flags&256?(o.flags&=-257,h=Nm(Error(n(422))),Fu(s,o,B,h)):o.memoizedState!==null?(o.child=s.child,o.flags|=128,null):(C=h.fallback,b=o.mode,h=vt({mode:"visible",children:h.children},b,0,null),C=lt(C,b,B,null),C.flags|=2,h.return=o,C.return=o,h.sibling=C,o.child=h,o.mode&1&&Pi(o,s.child,null,B),o.child.memoizedState=Am(B),o.memoizedState=Mm,C);if(!(o.mode&1))return Fu(s,o,B,null);if(b.data==="$!"){if(h=b.nextSibling&&b.nextSibling.dataset,h)var ie=h.dgst;return h=ie,C=Error(n(419)),h=Nm(C,h,void 0),Fu(s,o,B,h)}if(ie=(B&s.childLanes)!==0,Bs||ie){if(h=hn,h!==null){switch(B&-B){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(h.suspendedLanes|B)?0:b,b!==0&&b!==C.retryLane&&(C.retryLane=b,Sa(s,b),Mr(h,s,b,-1))}return Qu(),h=Nm(Error(n(421))),Fu(s,o,B,h)}return b.data==="$?"?(o.flags|=128,o.child=s.child,o=N.bind(null,s),b._reactRetry=o,null):(s=C.treeContext,tr=Ya(b.nextSibling),er=o,Nn=!0,jr=null,s!==null&&(xr[wr++]=ja,xr[wr++]=Na,xr[wr++]=Po,ja=s.id,Na=s.overflow,Po=o),o=tc(o,h.children),o.flags|=4096,o)}function Om(s,o,c){s.lanes|=o;var h=s.alternate;h!==null&&(h.lanes|=o),gm(s.return,o,c)}function nc(s,o,c,h,b){var C=s.memoizedState;C===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:b}:(C.isBackwards=o,C.rendering=null,C.renderingStartTime=0,C.last=h,C.tail=c,C.tailMode=b)}function op(s,o,c){var h=o.pendingProps,b=h.revealOrder,C=h.tail;if(Ts(s,o,h.children,c),h=Sn.current,h&2)h=h&1|2,o.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Om(s,c,o);else if(s.tag===19)Om(s,c,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break e;for(;s.sibling===null;){if(s.return===null||s.return===o)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}h&=1}if(en(Sn,h),!(o.mode&1))o.memoizedState=null;else switch(b){case"forwards":for(c=o.child,b=null;c!==null;)s=c.alternate,s!==null&&vn(s)===null&&(b=c),c=c.sibling;c=b,c===null?(b=o.child,o.child=null):(b=c.sibling,c.sibling=null),nc(o,!1,b,c,C);break;case"backwards":for(c=null,b=o.child,o.child=null;b!==null;){if(s=b.alternate,s!==null&&vn(s)===null){o.child=b;break}s=b.sibling,b.sibling=c,c=b,b=s}nc(o,!0,c,null,C);break;case"together":nc(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function sc(s,o){!(o.mode&1)&&s!==null&&(s.alternate=null,o.alternate=null,o.flags|=2)}function oa(s,o,c){if(s!==null&&(o.dependencies=s.dependencies),qo|=o.lanes,!(c&o.childLanes))return null;if(s!==null&&o.child!==s.child)throw Error(n(153));if(o.child!==null){for(s=o.child,c=je(s,s.pendingProps),o.child=c,c.return=o;s.sibling!==null;)s=s.sibling,c=c.sibling=je(s,s.pendingProps),c.return=o;c.sibling=null}return o.child}function ip(s,o,c){switch(o.tag){case 3:sp(o),us();break;case 5:Ah(o);break;case 1:Tn(o.type)&&bu(o);break;case 4:vm(o,o.stateNode.containerInfo);break;case 10:var h=o.type._context,b=o.memoizedProps.value;en(Eu,h._currentValue),h._currentValue=b;break;case 13:if(h=o.memoizedState,h!==null)return h.dehydrated!==null?(en(Sn,Sn.current&1),o.flags|=128,null):c&o.child.childLanes?ap(s,o,c):(en(Sn,Sn.current&1),s=oa(s,o,c),s!==null?s.sibling:null);en(Sn,Sn.current&1);break;case 19:if(h=(c&o.childLanes)!==0,s.flags&128){if(h)return op(s,o,c);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),en(Sn,Sn.current),h)break;return null;case 22:case 23:return o.lanes=0,Ru(s,o,c)}return oa(s,o,c)}var Vr,rc,Pm,Iu;Vr=function(s,o){for(var c=o.child;c!==null;){if(c.tag===5||c.tag===6)s.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},rc=function(){},Pm=function(s,o,c,h){var b=s.memoizedProps;if(b!==h){s=o.stateNode,Ro(sa.current);var C=null;switch(c){case"input":b=mt(s,b),h=mt(s,h),C=[];break;case"select":b=W({},b,{value:void 0}),h=W({},h,{value:void 0}),C=[];break;case"textarea":b=ke(s,b),h=ke(s,h),C=[];break;default:typeof b.onClick!="function"&&typeof h.onClick=="function"&&(s.onclick=Bl)}qt(c,h);var B;c=null;for(Ee in b)if(!h.hasOwnProperty(Ee)&&b.hasOwnProperty(Ee)&&b[Ee]!=null)if(Ee==="style"){var ie=b[Ee];for(B in ie)ie.hasOwnProperty(B)&&(c||(c={}),c[B]="")}else Ee!=="dangerouslySetInnerHTML"&&Ee!=="children"&&Ee!=="suppressContentEditableWarning"&&Ee!=="suppressHydrationWarning"&&Ee!=="autoFocus"&&(i.hasOwnProperty(Ee)?C||(C=[]):(C=C||[]).push(Ee,null));for(Ee in h){var he=h[Ee];if(ie=b!=null?b[Ee]:void 0,h.hasOwnProperty(Ee)&&he!==ie&&(he!=null||ie!=null))if(Ee==="style")if(ie){for(B in ie)!ie.hasOwnProperty(B)||he&&he.hasOwnProperty(B)||(c||(c={}),c[B]="");for(B in he)he.hasOwnProperty(B)&&ie[B]!==he[B]&&(c||(c={}),c[B]=he[B])}else c||(C||(C=[]),C.push(Ee,c)),c=he;else Ee==="dangerouslySetInnerHTML"?(he=he?he.__html:void 0,ie=ie?ie.__html:void 0,he!=null&&ie!==he&&(C=C||[]).push(Ee,he)):Ee==="children"?typeof he!="string"&&typeof he!="number"||(C=C||[]).push(Ee,""+he):Ee!=="suppressContentEditableWarning"&&Ee!=="suppressHydrationWarning"&&(i.hasOwnProperty(Ee)?(he!=null&&Ee==="onScroll"&&on("scroll",s),C||ie===he||(C=[])):(C=C||[]).push(Ee,he))}c&&(C=C||[]).push("style",c);var Ee=C;(o.updateQueue=Ee)&&(o.flags|=4)}},Iu=function(s,o,c,h){c!==h&&(o.flags|=4)};function Ii(s,o){if(!Nn)switch(s.tailMode){case"hidden":o=s.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:h.sibling=null}}function bs(s){var o=s.alternate!==null&&s.alternate.child===s.child,c=0,h=0;if(o)for(var b=s.child;b!==null;)c|=b.lanes|b.childLanes,h|=b.subtreeFlags&14680064,h|=b.flags&14680064,b.return=s,b=b.sibling;else for(b=s.child;b!==null;)c|=b.lanes|b.childLanes,h|=b.subtreeFlags,h|=b.flags,b.return=s,b=b.sibling;return s.subtreeFlags|=h,s.childLanes=c,o}function U_(s,o,c){var h=o.pendingProps;switch(mm(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bs(o),null;case 1:return Tn(o.type)&&vu(),bs(o),null;case 3:return h=o.stateNode,Fo(),ln(cn),ln(ys),Nr(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(s===null||s.child===null)&&(qr(o)?o.flags|=4:s===null||s.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,jr!==null&&(Wu(jr),jr=null))),rc(s,o),bs(o),null;case 5:Ou(o);var b=Ro(Kl.current);if(c=o.type,s!==null&&o.stateNode!=null)Pm(s,o,c,h,b),s.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!h){if(o.stateNode===null)throw Error(n(166));return bs(o),null}if(s=Ro(sa.current),qr(o)){h=o.stateNode,c=o.type;var C=o.memoizedProps;switch(h[Zr]=o,h[Qa]=C,s=(o.mode&1)!==0,c){case"dialog":on("cancel",h),on("close",h);break;case"iframe":case"object":case"embed":on("load",h);break;case"video":case"audio":for(b=0;b<zl.length;b++)on(zl[b],h);break;case"source":on("error",h);break;case"img":case"image":case"link":on("error",h),on("load",h);break;case"details":on("toggle",h);break;case"input":yt(h,C),on("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!C.multiple},on("invalid",h);break;case"textarea":Ae(h,C),on("invalid",h)}qt(c,C),b=null;for(var B in C)if(C.hasOwnProperty(B)){var ie=C[B];B==="children"?typeof ie=="string"?h.textContent!==ie&&(C.suppressHydrationWarning!==!0&&hu(h.textContent,ie,s),b=["children",ie]):typeof ie=="number"&&h.textContent!==""+ie&&(C.suppressHydrationWarning!==!0&&hu(h.textContent,ie,s),b=["children",""+ie]):i.hasOwnProperty(B)&&ie!=null&&B==="onScroll"&&on("scroll",h)}switch(c){case"input":Ve(h),it(h,C,!0);break;case"textarea":Ve(h),ft(h);break;case"select":case"option":break;default:typeof C.onClick=="function"&&(h.onclick=Bl)}h=b,o.updateQueue=h,h!==null&&(o.flags|=4)}else{B=b.nodeType===9?b:b.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=zt(c)),s==="http://www.w3.org/1999/xhtml"?c==="script"?(s=B.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof h.is=="string"?s=B.createElement(c,{is:h.is}):(s=B.createElement(c),c==="select"&&(B=s,h.multiple?B.multiple=!0:h.size&&(B.size=h.size))):s=B.createElementNS(s,c),s[Zr]=o,s[Qa]=h,Vr(s,o,!1,!1),o.stateNode=s;e:{switch(B=Ht(c,h),c){case"dialog":on("cancel",s),on("close",s),b=h;break;case"iframe":case"object":case"embed":on("load",s),b=h;break;case"video":case"audio":for(b=0;b<zl.length;b++)on(zl[b],s);b=h;break;case"source":on("error",s),b=h;break;case"img":case"image":case"link":on("error",s),on("load",s),b=h;break;case"details":on("toggle",s),b=h;break;case"input":yt(s,h),b=mt(s,h),on("invalid",s);break;case"option":b=h;break;case"select":s._wrapperState={wasMultiple:!!h.multiple},b=W({},h,{value:void 0}),on("invalid",s);break;case"textarea":Ae(s,h),b=ke(s,h),on("invalid",s);break;default:b=h}qt(c,b),ie=b;for(C in ie)if(ie.hasOwnProperty(C)){var he=ie[C];C==="style"?Nt(s,he):C==="dangerouslySetInnerHTML"?(he=he?he.__html:void 0,he!=null&&Se(s,he)):C==="children"?typeof he=="string"?(c!=="textarea"||he!=="")&&$e(s,he):typeof he=="number"&&$e(s,""+he):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(i.hasOwnProperty(C)?he!=null&&C==="onScroll"&&on("scroll",s):he!=null&&T(s,C,he,B))}switch(c){case"input":Ve(s),it(s,h,!1);break;case"textarea":Ve(s),ft(s);break;case"option":h.value!=null&&s.setAttribute("value",""+fe(h.value));break;case"select":s.multiple=!!h.multiple,C=h.value,C!=null?G(s,!!h.multiple,C,!1):h.defaultValue!=null&&G(s,!!h.multiple,h.defaultValue,!0);break;default:typeof b.onClick=="function"&&(s.onclick=Bl)}switch(c){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return bs(o),null;case 6:if(s&&o.stateNode!=null)Iu(s,o,s.memoizedProps,h);else{if(typeof h!="string"&&o.stateNode===null)throw Error(n(166));if(c=Ro(Kl.current),Ro(sa.current),qr(o)){if(h=o.stateNode,c=o.memoizedProps,h[Zr]=o,(C=h.nodeValue!==c)&&(s=er,s!==null))switch(s.tag){case 3:hu(h.nodeValue,c,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&hu(h.nodeValue,c,(s.mode&1)!==0)}C&&(o.flags|=4)}else h=(c.nodeType===9?c:c.ownerDocument).createTextNode(h),h[Zr]=o,o.stateNode=h}return bs(o),null;case 13:if(ln(Sn),h=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(Nn&&tr!==null&&o.mode&1&&!(o.flags&128))Su(),us(),o.flags|=98560,C=!1;else if(C=qr(o),h!==null&&h.dehydrated!==null){if(s===null){if(!C)throw Error(n(318));if(C=o.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(n(317));C[Zr]=o}else us(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;bs(o),C=!1}else jr!==null&&(Wu(jr),jr=null),C=!0;if(!C)return o.flags&65536?o:null}return o.flags&128?(o.lanes=c,o):(h=h!==null,h!==(s!==null&&s.memoizedState!==null)&&h&&(o.child.flags|=8192,o.mode&1&&(s===null||Sn.current&1?Vn===0&&(Vn=3):Qu())),o.updateQueue!==null&&(o.flags|=4),bs(o),null);case 4:return Fo(),rc(s,o),s===null&&Fl(o.stateNode.containerInfo),bs(o),null;case 10:return Vl(o.type._context),bs(o),null;case 17:return Tn(o.type)&&vu(),bs(o),null;case 19:if(ln(Sn),C=o.memoizedState,C===null)return bs(o),null;if(h=(o.flags&128)!==0,B=C.rendering,B===null)if(h)Ii(C,!1);else{if(Vn!==0||s!==null&&s.flags&128)for(s=o.child;s!==null;){if(B=vn(s),B!==null){for(o.flags|=128,Ii(C,!1),h=B.updateQueue,h!==null&&(o.updateQueue=h,o.flags|=4),o.subtreeFlags=0,h=c,c=o.child;c!==null;)C=c,s=h,C.flags&=14680066,B=C.alternate,B===null?(C.childLanes=0,C.lanes=s,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=B.childLanes,C.lanes=B.lanes,C.child=B.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=B.memoizedProps,C.memoizedState=B.memoizedState,C.updateQueue=B.updateQueue,C.type=B.type,s=B.dependencies,C.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),c=c.sibling;return en(Sn,Sn.current&1|2),o.child}s=s.sibling}C.tail!==null&&fn()>qi&&(o.flags|=128,h=!0,Ii(C,!1),o.lanes=4194304)}else{if(!h)if(s=vn(B),s!==null){if(o.flags|=128,h=!0,c=s.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),Ii(C,!0),C.tail===null&&C.tailMode==="hidden"&&!B.alternate&&!Nn)return bs(o),null}else 2*fn()-C.renderingStartTime>qi&&c!==1073741824&&(o.flags|=128,h=!0,Ii(C,!1),o.lanes=4194304);C.isBackwards?(B.sibling=o.child,o.child=B):(c=C.last,c!==null?c.sibling=B:o.child=B,C.last=B)}return C.tail!==null?(o=C.tail,C.rendering=o,C.tail=o.sibling,C.renderingStartTime=fn(),o.sibling=null,c=Sn.current,en(Sn,h?c&1|2:c&1),o):(bs(o),null);case 22:case 23:return Yu(),h=o.memoizedState!==null,s!==null&&s.memoizedState!==null!==h&&(o.flags|=8192),h&&o.mode&1?rr&1073741824&&(bs(o),o.subtreeFlags&6&&(o.flags|=8192)):bs(o),null;case 24:return null;case 25:return null}throw Error(n(156,o.tag))}function q_(s,o){switch(mm(o),o.tag){case 1:return Tn(o.type)&&vu(),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return Fo(),ln(cn),ln(ys),Nr(),s=o.flags,s&65536&&!(s&128)?(o.flags=s&-65537|128,o):null;case 5:return Ou(o),null;case 13:if(ln(Sn),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(n(340));us()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return ln(Sn),null;case 4:return Fo(),null;case 10:return Vl(o.type._context),null;case 22:case 23:return Yu(),null;case 24:return null;default:return null}}var ac=!1,xs=!1,lp=typeof WeakSet=="function"?WeakSet:Set,nt=null;function Uo(s,o){var c=s.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(h){En(s,o,h)}else c.current=null}function Tm(s,o,c){try{c()}catch(h){En(s,o,h)}}var Bu=!1;function cp(s,o){if(om=hr,s=xa(),au(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var b=h.anchorOffset,C=h.focusNode;h=h.focusOffset;try{c.nodeType,C.nodeType}catch{c=null;break e}var B=0,ie=-1,he=-1,Ee=0,Fe=0,qe=s,ze=null;t:for(;;){for(var tt;qe!==c||b!==0&&qe.nodeType!==3||(ie=B+b),qe!==C||h!==0&&qe.nodeType!==3||(he=B+h),qe.nodeType===3&&(B+=qe.nodeValue.length),(tt=qe.firstChild)!==null;)ze=qe,qe=tt;for(;;){if(qe===s)break t;if(ze===c&&++Ee===b&&(ie=B),ze===C&&++Fe===h&&(he=B),(tt=qe.nextSibling)!==null)break;qe=ze,ze=qe.parentNode}qe=tt}c=ie===-1||he===-1?null:{start:ie,end:he}}else c=null}c=c||{start:0,end:0}}else c=null;for(Lt={focusedElem:s,selectionRange:c},hr=!1,nt=o;nt!==null;)if(o=nt,s=o.child,(o.subtreeFlags&1028)!==0&&s!==null)s.return=o,nt=s;else for(;nt!==null;){o=nt;try{var rt=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(rt!==null){var ct=rt.memoizedProps,Wn=rt.memoizedState,we=o.stateNode,ge=we.getSnapshotBeforeUpdate(o.elementType===o.type?ct:as(o.type,ct),Wn);we.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Ne=o.stateNode.containerInfo;Ne.nodeType===1?Ne.textContent="":Ne.nodeType===9&&Ne.documentElement&&Ne.removeChild(Ne.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(We){En(o,o.return,We)}if(s=o.sibling,s!==null){s.return=o.return,nt=s;break}nt=o.return}return rt=Bu,Bu=!1,rt}function oc(s,o,c){var h=o.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var b=h=h.next;do{if((b.tag&s)===s){var C=b.destroy;b.destroy=void 0,C!==void 0&&Tm(o,c,C)}b=b.next}while(b!==h)}}function Bi(s,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&s)===s){var h=c.create;c.destroy=h()}c=c.next}while(c!==o)}}function ic(s){var o=s.ref;if(o!==null){var c=s.stateNode;switch(s.tag){case 5:s=c;break;default:s=c}typeof o=="function"?o(s):o.current=s}}function $m(s){var o=s.alternate;o!==null&&(s.alternate=null,$m(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&(delete o[Zr],delete o[Qa],delete o[Fn],delete o[P_],delete o[gu])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function H_(s){return s.tag===5||s.tag===3||s.tag===4}function up(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||H_(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Us(s,o,c){var h=s.tag;if(h===5||h===6)s=s.stateNode,o?c.nodeType===8?c.parentNode.insertBefore(s,o):c.insertBefore(s,o):(c.nodeType===8?(o=c.parentNode,o.insertBefore(s,c)):(o=c,o.appendChild(s)),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=Bl));else if(h!==4&&(s=s.child,s!==null))for(Us(s,o,c),s=s.sibling;s!==null;)Us(s,o,c),s=s.sibling}function qs(s,o,c){var h=s.tag;if(h===5||h===6)s=s.stateNode,o?c.insertBefore(s,o):c.appendChild(s);else if(h!==4&&(s=s.child,s!==null))for(qs(s,o,c),s=s.sibling;s!==null;)qs(s,o,c),s=s.sibling}var dn=null,Wr=!1;function so(s,o,c){for(c=c.child;c!==null;)dp(s,o,c),c=c.sibling}function dp(s,o,c){if(et&&typeof et.onCommitFiberUnmount=="function")try{et.onCommitFiberUnmount(De,c)}catch{}switch(c.tag){case 5:xs||Uo(c,o);case 6:var h=dn,b=Wr;dn=null,so(s,o,c),dn=h,Wr=b,dn!==null&&(Wr?(s=dn,c=c.stateNode,s.nodeType===8?s.parentNode.removeChild(c):s.removeChild(c)):dn.removeChild(c.stateNode));break;case 18:dn!==null&&(Wr?(s=dn,c=c.stateNode,s.nodeType===8?im(s.parentNode,c):s.nodeType===1&&im(s,c),es(s)):im(dn,c.stateNode));break;case 4:h=dn,b=Wr,dn=c.stateNode.containerInfo,Wr=!0,so(s,o,c),dn=h,Wr=b;break;case 0:case 11:case 14:case 15:if(!xs&&(h=c.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){b=h=h.next;do{var C=b,B=C.destroy;C=C.tag,B!==void 0&&(C&2||C&4)&&Tm(c,o,B),b=b.next}while(b!==h)}so(s,o,c);break;case 1:if(!xs&&(Uo(c,o),h=c.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=c.memoizedProps,h.state=c.memoizedState,h.componentWillUnmount()}catch(ie){En(c,o,ie)}so(s,o,c);break;case 21:so(s,o,c);break;case 22:c.mode&1?(xs=(h=xs)||c.memoizedState!==null,so(s,o,c),xs=h):so(s,o,c);break;default:so(s,o,c)}}function mp(s){var o=s.updateQueue;if(o!==null){s.updateQueue=null;var c=s.stateNode;c===null&&(c=s.stateNode=new lp),o.forEach(function(h){var b=E.bind(null,s,h);c.has(h)||(c.add(h),h.then(b,b))})}}function Kr(s,o){var c=o.deletions;if(c!==null)for(var h=0;h<c.length;h++){var b=c[h];try{var C=s,B=o,ie=B;e:for(;ie!==null;){switch(ie.tag){case 5:dn=ie.stateNode,Wr=!1;break e;case 3:dn=ie.stateNode.containerInfo,Wr=!0;break e;case 4:dn=ie.stateNode.containerInfo,Wr=!0;break e}ie=ie.return}if(dn===null)throw Error(n(160));dp(C,B,b),dn=null,Wr=!1;var he=b.alternate;he!==null&&(he.return=null),b.return=null}catch(Ee){En(b,o,Ee)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)fp(o,s),o=o.sibling}function fp(s,o){var c=s.alternate,h=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Kr(o,s),ia(s),h&4){try{oc(3,s,s.return),Bi(3,s)}catch(ct){En(s,s.return,ct)}try{oc(5,s,s.return)}catch(ct){En(s,s.return,ct)}}break;case 1:Kr(o,s),ia(s),h&512&&c!==null&&Uo(c,c.return);break;case 5:if(Kr(o,s),ia(s),h&512&&c!==null&&Uo(c,c.return),s.flags&32){var b=s.stateNode;try{$e(b,"")}catch(ct){En(s,s.return,ct)}}if(h&4&&(b=s.stateNode,b!=null)){var C=s.memoizedProps,B=c!==null?c.memoizedProps:C,ie=s.type,he=s.updateQueue;if(s.updateQueue=null,he!==null)try{ie==="input"&&C.type==="radio"&&C.name!=null&&Te(b,C),Ht(ie,B);var Ee=Ht(ie,C);for(B=0;B<he.length;B+=2){var Fe=he[B],qe=he[B+1];Fe==="style"?Nt(b,qe):Fe==="dangerouslySetInnerHTML"?Se(b,qe):Fe==="children"?$e(b,qe):T(b,Fe,qe,Ee)}switch(ie){case"input":at(b,C);break;case"textarea":Ge(b,C);break;case"select":var ze=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!C.multiple;var tt=C.value;tt!=null?G(b,!!C.multiple,tt,!1):ze!==!!C.multiple&&(C.defaultValue!=null?G(b,!!C.multiple,C.defaultValue,!0):G(b,!!C.multiple,C.multiple?[]:"",!1))}b[Qa]=C}catch(ct){En(s,s.return,ct)}}break;case 6:if(Kr(o,s),ia(s),h&4){if(s.stateNode===null)throw Error(n(162));b=s.stateNode,C=s.memoizedProps;try{b.nodeValue=C}catch(ct){En(s,s.return,ct)}}break;case 3:if(Kr(o,s),ia(s),h&4&&c!==null&&c.memoizedState.isDehydrated)try{es(o.containerInfo)}catch(ct){En(s,s.return,ct)}break;case 4:Kr(o,s),ia(s);break;case 13:Kr(o,s),ia(s),b=s.child,b.flags&8192&&(C=b.memoizedState!==null,b.stateNode.isHidden=C,!C||b.alternate!==null&&b.alternate.memoizedState!==null||(zm=fn())),h&4&&mp(s);break;case 22:if(Fe=c!==null&&c.memoizedState!==null,s.mode&1?(xs=(Ee=xs)||Fe,Kr(o,s),xs=Ee):Kr(o,s),ia(s),h&8192){if(Ee=s.memoizedState!==null,(s.stateNode.isHidden=Ee)&&!Fe&&s.mode&1)for(nt=s,Fe=s.child;Fe!==null;){for(qe=nt=Fe;nt!==null;){switch(ze=nt,tt=ze.child,ze.tag){case 0:case 11:case 14:case 15:oc(4,ze,ze.return);break;case 1:Uo(ze,ze.return);var rt=ze.stateNode;if(typeof rt.componentWillUnmount=="function"){h=ze,c=ze.return;try{o=h,rt.props=o.memoizedProps,rt.state=o.memoizedState,rt.componentWillUnmount()}catch(ct){En(h,c,ct)}}break;case 5:Uo(ze,ze.return);break;case 22:if(ze.memoizedState!==null){gp(qe);continue}}tt!==null?(tt.return=ze,nt=tt):gp(qe)}Fe=Fe.sibling}e:for(Fe=null,qe=s;;){if(qe.tag===5){if(Fe===null){Fe=qe;try{b=qe.stateNode,Ee?(C=b.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none"):(ie=qe.stateNode,he=qe.memoizedProps.style,B=he!=null&&he.hasOwnProperty("display")?he.display:null,ie.style.display=Ze("display",B))}catch(ct){En(s,s.return,ct)}}}else if(qe.tag===6){if(Fe===null)try{qe.stateNode.nodeValue=Ee?"":qe.memoizedProps}catch(ct){En(s,s.return,ct)}}else if((qe.tag!==22&&qe.tag!==23||qe.memoizedState===null||qe===s)&&qe.child!==null){qe.child.return=qe,qe=qe.child;continue}if(qe===s)break e;for(;qe.sibling===null;){if(qe.return===null||qe.return===s)break e;Fe===qe&&(Fe=null),qe=qe.return}Fe===qe&&(Fe=null),qe.sibling.return=qe.return,qe=qe.sibling}}break;case 19:Kr(o,s),ia(s),h&4&&mp(s);break;case 21:break;default:Kr(o,s),ia(s)}}function ia(s){var o=s.flags;if(o&2){try{e:{for(var c=s.return;c!==null;){if(H_(c)){var h=c;break e}c=c.return}throw Error(n(160))}switch(h.tag){case 5:var b=h.stateNode;h.flags&32&&($e(b,""),h.flags&=-33);var C=up(s);qs(s,C,b);break;case 3:case 4:var B=h.stateNode.containerInfo,ie=up(s);Us(s,ie,B);break;default:throw Error(n(161))}}catch(he){En(s,s.return,he)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function V_(s,o,c){nt=s,hp(s)}function hp(s,o,c){for(var h=(s.mode&1)!==0;nt!==null;){var b=nt,C=b.child;if(b.tag===22&&h){var B=b.memoizedState!==null||ac;if(!B){var ie=b.alternate,he=ie!==null&&ie.memoizedState!==null||xs;ie=ac;var Ee=xs;if(ac=B,(xs=he)&&!Ee)for(nt=b;nt!==null;)B=nt,he=B.child,B.tag===22&&B.memoizedState!==null?_p(b):he!==null?(he.return=B,nt=he):_p(b);for(;C!==null;)nt=C,hp(C),C=C.sibling;nt=b,ac=ie,xs=Ee}pp(s)}else b.subtreeFlags&8772&&C!==null?(C.return=b,nt=C):pp(s)}}function pp(s){for(;nt!==null;){var o=nt;if(o.flags&8772){var c=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:xs||Bi(5,o);break;case 1:var h=o.stateNode;if(o.flags&4&&!xs)if(c===null)h.componentDidMount();else{var b=o.elementType===o.type?c.memoizedProps:as(o.type,c.memoizedProps);h.componentDidUpdate(b,c.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var C=o.updateQueue;C!==null&&Mh(o,C,h);break;case 3:var B=o.updateQueue;if(B!==null){if(c=null,o.child!==null)switch(o.child.tag){case 5:c=o.child.stateNode;break;case 1:c=o.child.stateNode}Mh(o,B,c)}break;case 5:var ie=o.stateNode;if(c===null&&o.flags&4){c=ie;var he=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":he.autoFocus&&c.focus();break;case"img":he.src&&(c.src=he.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var Ee=o.alternate;if(Ee!==null){var Fe=Ee.memoizedState;if(Fe!==null){var qe=Fe.dehydrated;qe!==null&&es(qe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}xs||o.flags&512&&ic(o)}catch(ze){En(o,o.return,ze)}}if(o===s){nt=null;break}if(c=o.sibling,c!==null){c.return=o.return,nt=c;break}nt=o.return}}function gp(s){for(;nt!==null;){var o=nt;if(o===s){nt=null;break}var c=o.sibling;if(c!==null){c.return=o.return,nt=c;break}nt=o.return}}function _p(s){for(;nt!==null;){var o=nt;try{switch(o.tag){case 0:case 11:case 15:var c=o.return;try{Bi(4,o)}catch(he){En(o,c,he)}break;case 1:var h=o.stateNode;if(typeof h.componentDidMount=="function"){var b=o.return;try{h.componentDidMount()}catch(he){En(o,b,he)}}var C=o.return;try{ic(o)}catch(he){En(o,C,he)}break;case 5:var B=o.return;try{ic(o)}catch(he){En(o,B,he)}}}catch(he){En(o,o.return,he)}if(o===s){nt=null;break}var ie=o.sibling;if(ie!==null){ie.return=o.return,nt=ie;break}nt=o.return}}var W_=Math.ceil,Uu=j.ReactCurrentDispatcher,Lm=j.ReactCurrentOwner,kr=j.ReactCurrentBatchConfig,Kt=0,hn=null,In=null,ds=0,rr=0,Ui=Xa(0),Vn=0,lc=null,qo=0,qu=0,Dm=0,cc=null,Hs=null,zm=0,qi=1/0,ms=null,Xt=!1,Rm=null,Ma=null,uc=!1,Aa=null,dc=0,Hi=0,Hu=null,mc=-1,fc=0;function ws(){return Kt&6?fn():mc!==-1?mc:mc=fn()}function Oa(s){return s.mode&1?Kt&2&&ds!==0?ds&-ds:$_.transition!==null?(fc===0&&(fc=is()),fc):(s=Bt,s!==0||(s=window.event,s=s===void 0?16:fi(s.type)),s):1}function Mr(s,o,c,h){if(50<Hi)throw Hi=0,Hu=null,Error(n(185));As(s,c,h),(!(Kt&2)||s!==hn)&&(s===hn&&(!(Kt&2)&&(qu|=c),Vn===4&&Pa(s,ds)),$s(s,h),c===1&&Kt===0&&!(o.mode&1)&&(qi=fn()+500,xu&&Za()))}function $s(s,o){var c=s.callbackNode;Ms(s,o);var h=Rn(s,s===hn?ds:0);if(h===0)c!==null&&Js(c),s.callbackNode=null,s.callbackPriority=0;else if(o=h&-h,s.callbackPriority!==o){if(c!=null&&Js(c),o===1)s.tag===0?T_(Im.bind(null,s)):bh(Im.bind(null,s)),O_(function(){!(Kt&6)&&Za()}),c=null;else{switch(Qc(h)){case 1:c=_s;break;case 4:c=Fr;break;case 16:c=Rs;break;case 536870912:c=_e;break;default:c=Rs}c=F(c,Fm.bind(null,s))}s.callbackPriority=o,s.callbackNode=c}}function Fm(s,o){if(mc=-1,fc=0,Kt&6)throw Error(n(327));var c=s.callbackNode;if(Ho()&&s.callbackNode!==c)return null;var h=Rn(s,s===hn?ds:0);if(h===0)return null;if(h&30||h&s.expiredLanes||o)o=hc(s,h);else{o=h;var b=Kt;Kt|=2;var C=Um();(hn!==s||ds!==o)&&(ms=null,qi=fn()+500,ao(s,o));do try{bp();break}catch(ie){Bm(s,ie)}while(!0);Lo(),Uu.current=C,Kt=b,In!==null?o=0:(hn=null,ds=0,o=Vn)}if(o!==0){if(o===2&&(b=Zn(s),b!==0&&(h=b,o=Vu(s,b))),o===1)throw c=lc,ao(s,0),Pa(s,h),$s(s,fn()),c;if(o===6)Pa(s,h);else{if(b=s.current.alternate,!(h&30)&&!vp(b)&&(o=hc(s,h),o===2&&(C=Zn(s),C!==0&&(h=C,o=Vu(s,C))),o===1))throw c=lc,ao(s,0),Pa(s,h),$s(s,fn()),c;switch(s.finishedWork=b,s.finishedLanes=h,o){case 0:case 1:throw Error(n(345));case 2:oo(s,Hs,ms);break;case 3:if(Pa(s,h),(h&130023424)===h&&(o=zm+500-fn(),10<o)){if(Rn(s,0)!==0)break;if(b=s.suspendedLanes,(b&h)!==h){ws(),s.pingedLanes|=s.suspendedLanes&b;break}s.timeoutHandle=Ul(oo.bind(null,s,Hs,ms),o);break}oo(s,Hs,ms);break;case 4:if(Pa(s,h),(h&4194240)===h)break;for(o=s.eventTimes,b=-1;0<h;){var B=31-Be(h);C=1<<B,B=o[B],B>b&&(b=B),h&=~C}if(h=b,h=fn()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*W_(h/1960))-h,10<h){s.timeoutHandle=Ul(oo.bind(null,s,Hs,ms),h);break}oo(s,Hs,ms);break;case 5:oo(s,Hs,ms);break;default:throw Error(n(329))}}}return $s(s,fn()),s.callbackNode===c?Fm.bind(null,s):null}function Vu(s,o){var c=cc;return s.current.memoizedState.isDehydrated&&(ao(s,o).flags|=256),s=hc(s,o),s!==2&&(o=Hs,Hs=c,o!==null&&Wu(o)),s}function Wu(s){Hs===null?Hs=s:Hs.push.apply(Hs,s)}function vp(s){for(var o=s;;){if(o.flags&16384){var c=o.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var h=0;h<c.length;h++){var b=c[h],C=b.getSnapshot;b=b.value;try{if(!_r(C(),b))return!1}catch{return!1}}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Pa(s,o){for(o&=~Dm,o&=~qu,s.suspendedLanes|=o,s.pingedLanes&=~o,s=s.expirationTimes;0<o;){var c=31-Be(o),h=1<<c;s[c]=-1,o&=~h}}function Im(s){if(Kt&6)throw Error(n(327));Ho();var o=Rn(s,0);if(!(o&1))return $s(s,fn()),null;var c=hc(s,o);if(s.tag!==0&&c===2){var h=Zn(s);h!==0&&(o=h,c=Vu(s,h))}if(c===1)throw c=lc,ao(s,0),Pa(s,o),$s(s,fn()),c;if(c===6)throw Error(n(345));return s.finishedWork=s.current.alternate,s.finishedLanes=o,oo(s,Hs,ms),$s(s,fn()),null}function Ku(s,o){var c=Kt;Kt|=1;try{return s(o)}finally{Kt=c,Kt===0&&(qi=fn()+500,xu&&Za())}}function ro(s){Aa!==null&&Aa.tag===0&&!(Kt&6)&&Ho();var o=Kt;Kt|=1;var c=kr.transition,h=Bt;try{if(kr.transition=null,Bt=1,s)return s()}finally{Bt=h,kr.transition=c,Kt=o,!(Kt&6)&&Za()}}function Yu(){rr=Ui.current,ln(Ui)}function ao(s,o){s.finishedWork=null,s.finishedLanes=0;var c=s.timeoutHandle;if(c!==-1&&(s.timeoutHandle=-1,A_(c)),In!==null)for(c=In.return;c!==null;){var h=c;switch(mm(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&vu();break;case 3:Fo(),ln(cn),ln(ys),Nr();break;case 5:Ou(h);break;case 4:Fo();break;case 13:ln(Sn);break;case 19:ln(Sn);break;case 10:Vl(h.type._context);break;case 22:case 23:Yu()}c=c.return}if(hn=s,In=s=je(s.current,null),ds=rr=o,Vn=0,lc=null,Dm=qu=qo=0,Hs=cc=null,Do!==null){for(o=0;o<Do.length;o++)if(c=Do[o],h=c.interleaved,h!==null){c.interleaved=null;var b=h.next,C=c.pending;if(C!==null){var B=C.next;C.next=b,h.next=B}c.pending=h}Do=null}return s}function Bm(s,o){do{var c=In;try{if(Lo(),Sr.current=zu,Pu){for(var h=Cn.memoizedState;h!==null;){var b=h.queue;b!==null&&(b.pending=null),h=h.next}Pu=!1}if(Io=0,Hn=un=Cn=null,Yl=!1,Ql=0,Lm.current=null,c===null||c.return===null){Vn=1,lc=o,In=null;break}e:{var C=s,B=c.return,ie=c,he=o;if(o=ds,ie.flags|=32768,he!==null&&typeof he=="object"&&typeof he.then=="function"){var Ee=he,Fe=ie,qe=Fe.tag;if(!(Fe.mode&1)&&(qe===0||qe===11||qe===15)){var ze=Fe.alternate;ze?(Fe.updateQueue=ze.updateQueue,Fe.memoizedState=ze.memoizedState,Fe.lanes=ze.lanes):(Fe.updateQueue=null,Fe.memoizedState=null)}var tt=Jh(B);if(tt!==null){tt.flags&=-257,Zh(tt,B,ie,C,o),tt.mode&1&&Xh(C,Ee,o),o=tt,he=Ee;var rt=o.updateQueue;if(rt===null){var ct=new Set;ct.add(he),o.updateQueue=ct}else rt.add(he);break e}else{if(!(o&1)){Xh(C,Ee,o),Qu();break e}he=Error(n(426))}}else if(Nn&&ie.mode&1){var Wn=Jh(B);if(Wn!==null){!(Wn.flags&65536)&&(Wn.flags|=256),Zh(Wn,B,ie,C,o),hm(Ri(he,ie));break e}}C=he=Ri(he,ie),Vn!==4&&(Vn=2),cc===null?cc=[C]:cc.push(C),C=B;do{switch(C.tag){case 3:C.flags|=65536,o&=-o,C.lanes|=o;var we=aa(C,he,o);kh(C,we);break e;case 1:ie=he;var ge=C.type,Ne=C.stateNode;if(!(C.flags&128)&&(typeof ge.getDerivedStateFromError=="function"||Ne!==null&&typeof Ne.componentDidCatch=="function"&&(Ma===null||!Ma.has(Ne)))){C.flags|=65536,o&=-o,C.lanes|=o;var We=Sm(C,ie,o);kh(C,We);break e}}C=C.return}while(C!==null)}Hm(c)}catch(dt){o=dt,In===c&&c!==null&&(In=c=c.return);continue}break}while(!0)}function Um(){var s=Uu.current;return Uu.current=zu,s===null?zu:s}function Qu(){(Vn===0||Vn===3||Vn===2)&&(Vn=4),hn===null||!(qo&268435455)&&!(qu&268435455)||Pa(hn,ds)}function hc(s,o){var c=Kt;Kt|=2;var h=Um();(hn!==s||ds!==o)&&(ms=null,ao(s,o));do try{yp();break}catch(b){Bm(s,b)}while(!0);if(Lo(),Kt=c,Uu.current=h,In!==null)throw Error(n(261));return hn=null,ds=0,Vn}function yp(){for(;In!==null;)qm(In)}function bp(){for(;In!==null&&!bo();)qm(In)}function qm(s){var o=L(s.alternate,s,rr);s.memoizedProps=s.pendingProps,o===null?Hm(s):In=o,Lm.current=null}function Hm(s){var o=s;do{var c=o.alternate;if(s=o.return,o.flags&32768){if(c=q_(c,o),c!==null){c.flags&=32767,In=c;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Vn=6,In=null;return}}else if(c=U_(c,o,rr),c!==null){In=c;return}if(o=o.sibling,o!==null){In=o;return}In=o=s}while(o!==null);Vn===0&&(Vn=5)}function oo(s,o,c){var h=Bt,b=kr.transition;try{kr.transition=null,Bt=1,xp(s,o,c,h)}finally{kr.transition=b,Bt=h}return null}function xp(s,o,c,h){do Ho();while(Aa!==null);if(Kt&6)throw Error(n(327));c=s.finishedWork;var b=s.finishedLanes;if(c===null)return null;if(s.finishedWork=null,s.finishedLanes=0,c===s.current)throw Error(n(177));s.callbackNode=null,s.callbackPriority=0;var C=c.lanes|c.childLanes;if(di(s,C),s===hn&&(In=hn=null,ds=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||uc||(uc=!0,F(Rs,function(){return Ho(),null})),C=(c.flags&15990)!==0,c.subtreeFlags&15990||C){C=kr.transition,kr.transition=null;var B=Bt;Bt=1;var ie=Kt;Kt|=4,Lm.current=null,cp(s,c),fp(c,s),E_(Lt),hr=!!om,Lt=om=null,s.current=c,V_(c),Ua(),Kt=ie,Bt=B,kr.transition=C}else s.current=c;if(uc&&(uc=!1,Aa=s,dc=b),C=s.pendingLanes,C===0&&(Ma=null),Yt(c.stateNode),$s(s,fn()),o!==null)for(h=s.onRecoverableError,c=0;c<o.length;c++)b=o[c],h(b.value,{componentStack:b.stack,digest:b.digest});if(Xt)throw Xt=!1,s=Rm,Rm=null,s;return dc&1&&s.tag!==0&&Ho(),C=s.pendingLanes,C&1?s===Hu?Hi++:(Hi=0,Hu=s):Hi=0,Za(),null}function Ho(){if(Aa!==null){var s=Qc(dc),o=kr.transition,c=Bt;try{if(kr.transition=null,Bt=16>s?16:s,Aa===null)var h=!1;else{if(s=Aa,Aa=null,dc=0,Kt&6)throw Error(n(331));var b=Kt;for(Kt|=4,nt=s.current;nt!==null;){var C=nt,B=C.child;if(nt.flags&16){var ie=C.deletions;if(ie!==null){for(var he=0;he<ie.length;he++){var Ee=ie[he];for(nt=Ee;nt!==null;){var Fe=nt;switch(Fe.tag){case 0:case 11:case 15:oc(8,Fe,C)}var qe=Fe.child;if(qe!==null)qe.return=Fe,nt=qe;else for(;nt!==null;){Fe=nt;var ze=Fe.sibling,tt=Fe.return;if($m(Fe),Fe===Ee){nt=null;break}if(ze!==null){ze.return=tt,nt=ze;break}nt=tt}}}var rt=C.alternate;if(rt!==null){var ct=rt.child;if(ct!==null){rt.child=null;do{var Wn=ct.sibling;ct.sibling=null,ct=Wn}while(ct!==null)}}nt=C}}if(C.subtreeFlags&2064&&B!==null)B.return=C,nt=B;else e:for(;nt!==null;){if(C=nt,C.flags&2048)switch(C.tag){case 0:case 11:case 15:oc(9,C,C.return)}var we=C.sibling;if(we!==null){we.return=C.return,nt=we;break e}nt=C.return}}var ge=s.current;for(nt=ge;nt!==null;){B=nt;var Ne=B.child;if(B.subtreeFlags&2064&&Ne!==null)Ne.return=B,nt=Ne;else e:for(B=ge;nt!==null;){if(ie=nt,ie.flags&2048)try{switch(ie.tag){case 0:case 11:case 15:Bi(9,ie)}}catch(dt){En(ie,ie.return,dt)}if(ie===B){nt=null;break e}var We=ie.sibling;if(We!==null){We.return=ie.return,nt=We;break e}nt=ie.return}}if(Kt=b,Za(),et&&typeof et.onPostCommitFiberRoot=="function")try{et.onPostCommitFiberRoot(De,s)}catch{}h=!0}return h}finally{Bt=c,kr.transition=o}}return!1}function Vm(s,o,c){o=Ri(c,o),o=aa(s,o,1),s=Ea(s,o,1),o=ws(),s!==null&&(As(s,1,o),$s(s,o))}function En(s,o,c){if(s.tag===3)Vm(s,s,c);else for(;o!==null;){if(o.tag===3){Vm(o,s,c);break}else if(o.tag===1){var h=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ma===null||!Ma.has(h))){s=Ri(c,s),s=Sm(o,s,1),o=Ea(o,s,1),s=ws(),o!==null&&(As(o,1,s),$s(o,s));break}}o=o.return}}function wp(s,o,c){var h=s.pingCache;h!==null&&h.delete(o),o=ws(),s.pingedLanes|=s.suspendedLanes&c,hn===s&&(ds&c)===c&&(Vn===4||Vn===3&&(ds&130023424)===ds&&500>fn()-zm?ao(s,0):Dm|=c),$s(s,o)}function g(s,o){o===0&&(s.mode&1?(o=On,On<<=1,!(On&130023424)&&(On=4194304)):o=1);var c=ws();s=Sa(s,o),s!==null&&(As(s,o,c),$s(s,c))}function N(s){var o=s.memoizedState,c=0;o!==null&&(c=o.retryLane),g(s,c)}function E(s,o){var c=0;switch(s.tag){case 13:var h=s.stateNode,b=s.memoizedState;b!==null&&(c=b.retryLane);break;case 19:h=s.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(o),g(s,c)}var L;L=function(s,o,c){if(s!==null)if(s.memoizedProps!==o.pendingProps||cn.current)Bs=!0;else{if(!(s.lanes&c)&&!(o.flags&128))return Bs=!1,ip(s,o,c);Bs=!!(s.flags&131072)}else Bs=!1,Nn&&o.flags&1048576&&xh(o,ju,o.index);switch(o.lanes=0,o.tag){case 2:var h=o.type;sc(s,o),s=o.pendingProps;var b=Mi(o,ys.current);$i(o,c),b=Gl(null,o,h,s,b,c);var C=bm();return o.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Tn(h)?(C=!0,bu(o)):C=!1,o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,_m(o),b.updater=zi,o.stateNode=b,b._reactInternals=o,jm(o,h,s,c),o=ec(null,o,h,!0,C,c)):(o.tag=0,Nn&&C&&dm(o),Ts(null,o,b,c),o=o.child),o;case 16:h=o.elementType;e:{switch(sc(s,o),s=o.pendingProps,b=h._init,h=b(h._payload),o.type=h,b=o.tag=ce(h),s=as(h,s),b){case 0:o=Em(null,o,h,s,c);break e;case 1:o=km(null,o,h,s,c);break e;case 11:o=Cm(null,o,h,s,c);break e;case 14:o=ep(null,o,h,as(h.type,s),c);break e}throw Error(n(306,h,""))}return o;case 0:return h=o.type,b=o.pendingProps,b=o.elementType===h?b:as(h,b),Em(s,o,h,b,c);case 1:return h=o.type,b=o.pendingProps,b=o.elementType===h?b:as(h,b),km(s,o,h,b,c);case 3:e:{if(sp(o),s===null)throw Error(n(387));h=o.pendingProps,C=o.memoizedState,b=C.element,Eh(s,o),Au(o,h,null,c);var B=o.memoizedState;if(h=B.element,C.isDehydrated)if(C={element:h,isDehydrated:!1,cache:B.cache,pendingSuspenseBoundaries:B.pendingSuspenseBoundaries,transitions:B.transitions},o.updateQueue.baseState=C,o.memoizedState=C,o.flags&256){b=Ri(Error(n(423)),o),o=rp(s,o,h,c,b);break e}else if(h!==b){b=Ri(Error(n(424)),o),o=rp(s,o,h,c,b);break e}else for(tr=Ya(o.stateNode.containerInfo.firstChild),er=o,Nn=!0,jr=null,c=Ch(o,null,h,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(us(),h===b){o=oa(s,o,c);break e}Ts(s,o,h,c)}o=o.child}return o;case 5:return Ah(o),s===null&&fm(o),h=o.type,b=o.pendingProps,C=s!==null?s.memoizedProps:null,B=b.children,pu(h,b)?B=null:C!==null&&pu(h,C)&&(o.flags|=32),np(s,o),Ts(s,o,B,c),o.child;case 6:return s===null&&fm(o),null;case 13:return ap(s,o,c);case 4:return vm(o,o.stateNode.containerInfo),h=o.pendingProps,s===null?o.child=Pi(o,null,h,c):Ts(s,o,h,c),o.child;case 11:return h=o.type,b=o.pendingProps,b=o.elementType===h?b:as(h,b),Cm(s,o,h,b,c);case 7:return Ts(s,o,o.pendingProps,c),o.child;case 8:return Ts(s,o,o.pendingProps.children,c),o.child;case 12:return Ts(s,o,o.pendingProps.children,c),o.child;case 10:e:{if(h=o.type._context,b=o.pendingProps,C=o.memoizedProps,B=b.value,en(Eu,h._currentValue),h._currentValue=B,C!==null)if(_r(C.value,B)){if(C.children===b.children&&!cn.current){o=oa(s,o,c);break e}}else for(C=o.child,C!==null&&(C.return=o);C!==null;){var ie=C.dependencies;if(ie!==null){B=C.child;for(var he=ie.firstContext;he!==null;){if(he.context===h){if(C.tag===1){he=Ca(-1,c&-c),he.tag=2;var Ee=C.updateQueue;if(Ee!==null){Ee=Ee.shared;var Fe=Ee.pending;Fe===null?he.next=he:(he.next=Fe.next,Fe.next=he),Ee.pending=he}}C.lanes|=c,he=C.alternate,he!==null&&(he.lanes|=c),gm(C.return,c,o),ie.lanes|=c;break}he=he.next}}else if(C.tag===10)B=C.type===o.type?null:C.child;else if(C.tag===18){if(B=C.return,B===null)throw Error(n(341));B.lanes|=c,ie=B.alternate,ie!==null&&(ie.lanes|=c),gm(B,c,o),B=C.sibling}else B=C.child;if(B!==null)B.return=C;else for(B=C;B!==null;){if(B===o){B=null;break}if(C=B.sibling,C!==null){C.return=B.return,B=C;break}B=B.return}C=B}Ts(s,o,b.children,c),o=o.child}return o;case 9:return b=o.type,h=o.pendingProps.children,$i(o,c),b=Ps(b),h=h(b),o.flags|=1,Ts(s,o,h,c),o.child;case 14:return h=o.type,b=as(h,o.pendingProps),b=as(h.type,b),ep(s,o,h,b,c);case 15:return tp(s,o,o.type,o.pendingProps,c);case 17:return h=o.type,b=o.pendingProps,b=o.elementType===h?b:as(h,b),sc(s,o),o.tag=1,Tn(h)?(s=!0,bu(o)):s=!1,$i(o,c),Qh(o,h,b),jm(o,h,b,c),ec(null,o,h,!0,s,c);case 19:return op(s,o,c);case 22:return Ru(s,o,c)}throw Error(n(156,o.tag))};function F(s,o){return ga(s,o)}function re(s,o,c,h){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oe(s,o,c,h){return new re(s,o,c,h)}function ue(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ce(s){if(typeof s=="function")return ue(s)?1:0;if(s!=null){if(s=s.$$typeof,s===ee)return 11;if(s===X)return 14}return 2}function je(s,o){var c=s.alternate;return c===null?(c=oe(s.tag,o,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=o,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&14680064,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,o=s.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c}function Le(s,o,c,h,b,C){var B=2;if(h=s,typeof s=="function")ue(s)&&(B=1);else if(typeof s=="string")B=5;else e:switch(s){case z:return lt(c.children,b,C,o);case $:B=8,b|=8;break;case q:return s=oe(12,c,o,b|2),s.elementType=q,s.lanes=C,s;case le:return s=oe(13,c,o,b),s.elementType=le,s.lanes=C,s;case D:return s=oe(19,c,o,b),s.elementType=D,s.lanes=C,s;case K:return vt(c,b,C,o);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case V:B=10;break e;case R:B=9;break e;case ee:B=11;break e;case X:B=14;break e;case Y:B=16,h=null;break e}throw Error(n(130,s==null?s:typeof s,""))}return o=oe(B,c,o,b),o.elementType=s,o.type=h,o.lanes=C,o}function lt(s,o,c,h){return s=oe(7,s,h,o),s.lanes=c,s}function vt(s,o,c,h){return s=oe(22,s,h,o),s.elementType=K,s.lanes=c,s.stateNode={isHidden:!1},s}function Ft(s,o,c){return s=oe(6,s,null,o),s.lanes=c,s}function xn(s,o,c){return o=oe(4,s.children!==null?s.children:[],s.key,o),o.lanes=c,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}function Bn(s,o,c,h,b){this.tag=o,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fs(0),this.expirationTimes=Fs(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fs(0),this.identifierPrefix=h,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function Vs(s,o,c,h,b,C,B,ie,he){return s=new Bn(s,o,c,ie,he),o===1?(o=1,C===!0&&(o|=8)):o=0,C=oe(3,null,null,o),s.current=C,C.stateNode=s,C.memoizedState={element:h,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},_m(C),s}function Yr(s,o,c){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:A,key:h==null?null:""+h,children:s,containerInfo:o,implementation:c}}function Ws(s){if(!s)return na;s=s._reactInternals;e:{if(gs(s)!==s||s.tag!==1)throw Error(n(170));var o=s;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Tn(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(n(171))}if(s.tag===1){var c=s.type;if(Tn(c))return yu(s,c,o)}return o}function At(s,o,c,h,b,C,B,ie,he){return s=Vs(c,h,!0,s,b,C,B,ie,he),s.context=Ws(null),c=s.current,h=ws(),b=Oa(c),C=Ca(h,b),C.callback=o??null,Ea(c,C,b),s.current.lanes=b,As(s,b,h),$s(s,h),s}function kn(s,o,c,h){var b=o.current,C=ws(),B=Oa(b);return c=Ws(c),o.context===null?o.context=c:o.pendingContext=c,o=Ca(C,B),o.payload={element:s},h=h===void 0?null:h,h!==null&&(o.callback=h),s=Ea(b,o,B),s!==null&&(Mr(s,b,B,C),Mu(s,b,B)),B}function Un(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function mn(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<o?c:o}}function Ks(s,o){mn(s,o),(s=s.alternate)&&mn(s,o)}function la(){return null}var qn=typeof reportError=="function"?reportError:function(s){console.error(s)};function Vi(s){this._internalRoot=s}Ta.prototype.render=Vi.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(n(409));kn(s,o,null,null)},Ta.prototype.unmount=Vi.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;ro(function(){kn(null,s,null,null)}),o[ea]=null}};function Ta(s){this._internalRoot=s}Ta.prototype.unstable_scheduleHydration=function(s){if(s){var o=Xc();s={blockedOn:null,target:s,priority:o};for(var c=0;c<He.length&&o!==0&&o<He[c].priority;c++);He.splice(c,0,s),c===0&&Mt(s)}};function Vo(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Wo(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function Gu(){}function K_(s,o,c,h,b){if(b){if(typeof h=="function"){var C=h;h=function(){var Ee=Un(B);C.call(Ee)}}var B=At(o,h,s,0,null,!1,!1,"",Gu);return s._reactRootContainer=B,s[ea]=B.current,Fl(s.nodeType===8?s.parentNode:s),ro(),B}for(;b=s.lastChild;)s.removeChild(b);if(typeof h=="function"){var ie=h;h=function(){var Ee=Un(he);ie.call(Ee)}}var he=Vs(s,0,!1,null,null,!1,!1,"",Gu);return s._reactRootContainer=he,s[ea]=he.current,Fl(s.nodeType===8?s.parentNode:s),ro(function(){kn(o,he,c,h)}),he}function Xu(s,o,c,h,b){var C=c._reactRootContainer;if(C){var B=C;if(typeof b=="function"){var ie=b;b=function(){var he=Un(B);ie.call(he)}}kn(o,B,s,b)}else B=K_(c,o,s,b,h);return Un(B)}Nl=function(s){switch(s.tag){case 3:var o=s.stateNode;if(o.current.memoizedState.isDehydrated){var c=gn(o.pendingLanes);c!==0&&(jl(o,c|1),$s(o,fn()),!(Kt&6)&&(qi=fn()+500,Za()))}break;case 13:ro(function(){var h=Sa(s,1);if(h!==null){var b=ws();Mr(h,s,1,b)}}),Ks(s,1)}},Sl=function(s){if(s.tag===13){var o=Sa(s,134217728);if(o!==null){var c=ws();Mr(o,s,134217728,c)}Ks(s,134217728)}},Gc=function(s){if(s.tag===13){var o=Oa(s),c=Sa(s,o);if(c!==null){var h=ws();Mr(c,s,o,h)}Ks(s,o)}},Xc=function(){return Bt},va=function(s,o){var c=Bt;try{return Bt=s,o()}finally{Bt=c}},Jt=function(s,o,c){switch(o){case"input":if(at(s,c),o=c.name,c.type==="radio"&&o!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<c.length;o++){var h=c[o];if(h!==s&&h.form===s.form){var b=_u(h);if(!b)throw Error(n(90));st(h),at(h,b)}}}break;case"textarea":Ge(s,c);break;case"select":o=c.value,o!=null&&G(s,!!c.multiple,o,!1)}},Tt=Ku,hs=ro;var IL={usingClientEntryPoint:!1,Events:[ta,ns,_u,wn,pn,Ku]},Wm={findFiberByHostInstance:Ga,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},BL={bundleType:Wm.bundleType,version:Wm.version,rendererPackageName:Wm.rendererPackageName,rendererConfig:Wm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:j.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=zr(s),s===null?null:s.stateNode},findFiberByHostInstance:Wm.findFiberByHostInstance||la,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jp.isDisabled&&jp.supportsFiber)try{De=jp.inject(BL),et=jp}catch{}}return ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=IL,ar.createPortal=function(s,o){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vo(o))throw Error(n(200));return Yr(s,o,null,c)},ar.createRoot=function(s,o){if(!Vo(s))throw Error(n(299));var c=!1,h="",b=qn;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),o=Vs(s,1,!1,null,null,c,!1,h,b),s[ea]=o.current,Fl(s.nodeType===8?s.parentNode:s),new Vi(o)},ar.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=zr(o),s=s===null?null:s.stateNode,s},ar.flushSync=function(s){return ro(s)},ar.hydrate=function(s,o,c){if(!Wo(o))throw Error(n(200));return Xu(null,s,o,!0,c)},ar.hydrateRoot=function(s,o,c){if(!Vo(s))throw Error(n(405));var h=c!=null&&c.hydratedSources||null,b=!1,C="",B=qn;if(c!=null&&(c.unstable_strictMode===!0&&(b=!0),c.identifierPrefix!==void 0&&(C=c.identifierPrefix),c.onRecoverableError!==void 0&&(B=c.onRecoverableError)),o=At(o,null,s,1,c??null,b,!1,C,B),s[ea]=o.current,Fl(s),h)for(s=0;s<h.length;s++)c=h[s],b=c._getVersion,b=b(c._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[c,b]:o.mutableSourceEagerHydrationData.push(c,b);return new Ta(o)},ar.render=function(s,o,c){if(!Wo(o))throw Error(n(200));return Xu(null,s,o,!1,c)},ar.unmountComponentAtNode=function(s){if(!Wo(s))throw Error(n(40));return s._reactRootContainer?(ro(function(){Xu(null,null,s,!1,function(){s._reactRootContainer=null,s[ea]=null})}),!0):!1},ar.unstable_batchedUpdates=Ku,ar.unstable_renderSubtreeIntoContainer=function(s,o,c,h){if(!Wo(c))throw Error(n(200));if(s==null||s._reactInternals===void 0)throw Error(n(38));return Xu(s,o,c,!1,h)},ar.version="18.3.1-next-f1338f8080-20240426",ar}function cv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cv)}catch(e){console.error(e)}}cv(),av.exports=vj();var uv=av.exports,dv=uv;Cp.createRoot=dv.createRoot,Cp.hydrateRoot=dv.hydrateRoot;var pc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},yj={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},bj=(tj=class{constructor(){gt(this,ni,yj);gt(this,b_,!1)}setTimeoutProvider(e){Je(this,ni,e)}setTimeout(e,t){return de(this,ni).setTimeout(e,t)}clearTimeout(e){de(this,ni).clearTimeout(e)}setInterval(e,t){return de(this,ni).setInterval(e,t)}clearInterval(e){de(this,ni).clearInterval(e)}},ni=new WeakMap,b_=new WeakMap,tj),Qi=new bj;function xj(e){setTimeout(e,0)}var Gi=typeof window>"u"||"Deno"in globalThis;function Ys(){}function wj(e,t){return typeof e=="function"?e(t):e}function Mp(e){return typeof e=="number"&&e>=0&&e!==1/0}function mv(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Yo(e,t){return typeof e=="function"?e(t):e}function Qr(e,t){return typeof e=="function"?e(t):e}function fv(e,t){const{type:n="all",exact:a,fetchStatus:i,predicate:l,queryKey:u,stale:d}=e;if(u){if(a){if(t.queryHash!==Ap(u,t.options))return!1}else if(!Ju(t.queryKey,u))return!1}if(n!=="all"){const m=t.isActive();if(n==="active"&&!m||n==="inactive"&&m)return!1}return!(typeof d=="boolean"&&t.isStale()!==d||i&&i!==t.state.fetchStatus||l&&!l(t))}function hv(e,t){const{exact:n,status:a,predicate:i,mutationKey:l}=e;if(l){if(!t.options.mutationKey)return!1;if(n){if(Xi(t.options.mutationKey)!==Xi(l))return!1}else if(!Ju(t.options.mutationKey,l))return!1}return!(a&&t.state.status!==a||i&&!i(t))}function Ap(e,t){return((t==null?void 0:t.queryKeyHashFn)||Xi)(e)}function Xi(e){return JSON.stringify(e,(t,n)=>Op(n)?Object.keys(n).sort().reduce((a,i)=>(a[i]=n[i],a),{}):n)}function Ju(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Ju(e[n],t[n])):!1}var jj=Object.prototype.hasOwnProperty;function pv(e,t){if(e===t)return e;const n=gv(e)&&gv(t);if(!n&&!(Op(e)&&Op(t)))return t;const i=(n?e:Object.keys(e)).length,l=n?t:Object.keys(t),u=l.length,d=n?new Array(u):{};let m=0;for(let v=0;v<u;v++){const p=n?v:l[v],_=e[p],y=t[p];if(_===y){d[p]=_,(n?v<i:jj.call(e,p))&&m++;continue}if(_===null||y===null||typeof _!="object"||typeof y!="object"){d[p]=y;continue}const w=pv(_,y);d[p]=w,w===_&&m++}return i===u&&m===i?e:d}function Ym(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function gv(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Op(e){if(!_v(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!_v(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function _v(e){return Object.prototype.toString.call(e)==="[object Object]"}function Nj(e){return new Promise(t=>{Qi.setTimeout(t,e)})}function Pp(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?pv(e,t):t}function Sj(e,t,n=0){const a=[...e,t];return n&&a.length>n?a.slice(1):a}function Cj(e,t,n=0){const a=[t,...e];return n&&a.length>n?a.slice(0,-1):a}var Tp=Symbol();function vv(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===Tp?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function yv(e,t){return typeof e=="function"?e(...t):!!e}var Ej=(nj=class extends pc{constructor(){super();gt(this,hl);gt(this,si);gt(this,zc);Je(this,zc,t=>{if(!Gi&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){de(this,si)||this.setEventListener(de(this,zc))}onUnsubscribe(){var t;this.hasListeners()||((t=de(this,si))==null||t.call(this),Je(this,si,void 0))}setEventListener(t){var n;Je(this,zc,t),(n=de(this,si))==null||n.call(this),Je(this,si,t(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(t){de(this,hl)!==t&&(Je(this,hl,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof de(this,hl)=="boolean"?de(this,hl):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},hl=new WeakMap,si=new WeakMap,zc=new WeakMap,nj),$p=new Ej;function Lp(){let e,t;const n=new Promise((i,l)=>{e=i,t=l});n.status="pending",n.catch(()=>{});function a(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{a({status:"fulfilled",value:i}),e(i)},n.reject=i=>{a({status:"rejected",reason:i}),t(i)},n}var kj=xj;function Mj(){let e=[],t=0,n=d=>{d()},a=d=>{d()},i=kj;const l=d=>{t?e.push(d):i(()=>{n(d)})},u=()=>{const d=e;e=[],d.length&&i(()=>{a(()=>{d.forEach(m=>{n(m)})})})};return{batch:d=>{let m;t++;try{m=d()}finally{t--,t||u()}return m},batchCalls:d=>(...m)=>{l(()=>{d(...m)})},schedule:l,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{a=d},setScheduler:d=>{i=d}}}var os=Mj(),Aj=(sj=class extends pc{constructor(){super();gt(this,Rc,!0);gt(this,ri);gt(this,Fc);Je(this,Fc,t=>{if(!Gi&&window.addEventListener){const n=()=>t(!0),a=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",a)}}})}onSubscribe(){de(this,ri)||this.setEventListener(de(this,Fc))}onUnsubscribe(){var t;this.hasListeners()||((t=de(this,ri))==null||t.call(this),Je(this,ri,void 0))}setEventListener(t){var n;Je(this,Fc,t),(n=de(this,ri))==null||n.call(this),Je(this,ri,t(this.setOnline.bind(this)))}setOnline(t){de(this,Rc)!==t&&(Je(this,Rc,t),this.listeners.forEach(a=>{a(t)}))}isOnline(){return de(this,Rc)}},Rc=new WeakMap,ri=new WeakMap,Fc=new WeakMap,sj),Qm=new Aj;function Oj(e){return Math.min(1e3*2**e,3e4)}function bv(e){return(e??"online")==="online"?Qm.isOnline():!0}var Dp=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function xv(e){let t=!1,n=0,a;const i=Lp(),l=()=>i.status!=="pending",u=S=>{var k;if(!l()){const M=new Dp(S);y(M),(k=e.onCancel)==null||k.call(e,M)}},d=()=>{t=!0},m=()=>{t=!1},v=()=>$p.isFocused()&&(e.networkMode==="always"||Qm.isOnline())&&e.canRun(),p=()=>bv(e.networkMode)&&e.canRun(),_=S=>{l()||(a==null||a(),i.resolve(S))},y=S=>{l()||(a==null||a(),i.reject(S))},w=()=>new Promise(S=>{var k;a=M=>{(l()||v())&&S(M)},(k=e.onPause)==null||k.call(e)}).then(()=>{var S;a=void 0,l()||(S=e.onContinue)==null||S.call(e)}),x=()=>{if(l())return;let S;const k=n===0?e.initialPromise:void 0;try{S=k??e.fn()}catch(M){S=Promise.reject(M)}Promise.resolve(S).then(_).catch(M=>{var A;if(l())return;const P=e.retry??(Gi?0:3),T=e.retryDelay??Oj,j=typeof T=="function"?T(n,M):T,O=P===!0||typeof P=="number"&&n<P||typeof P=="function"&&P(n,M);if(t||!O){y(M);return}n++,(A=e.onFail)==null||A.call(e,n,M),Nj(j).then(()=>v()?void 0:w()).then(()=>{t?y(M):x()})})};return{promise:i,status:()=>i.status,cancel:u,continue:()=>(a==null||a(),i),cancelRetry:d,continueRetry:m,canStart:p,start:()=>(p()?x():w().then(x),i)}}var wv=(rj=class{constructor(){gt(this,pl)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Mp(this.gcTime)&&Je(this,pl,Qi.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Gi?1/0:5*60*1e3))}clearGcTimeout(){de(this,pl)&&(Qi.clearTimeout(de(this,pl)),Je(this,pl,void 0))}},pl=new WeakMap,rj),Pj={NODE_ENV:"production"},Tj=(aj=class extends wv{constructor(t){super();gt(this,fa);gt(this,gl);gt(this,Ic);gt(this,Gr);gt(this,_l);gt(this,fs);gt(this,Rd);gt(this,vl);Je(this,vl,!1),Je(this,Rd,t.defaultOptions),this.setOptions(t.options),this.observers=[],Je(this,_l,t.client),Je(this,Gr,de(this,_l).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Je(this,gl,Nv(this.options)),this.state=t.state??de(this,gl),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=de(this,fs))==null?void 0:t.promise}setOptions(t){if(this.options={...de(this,Rd),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Nv(this.options);n.data!==void 0&&(this.setData(n.data,{updatedAt:n.dataUpdatedAt,manual:!0}),Je(this,gl,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&de(this,Gr).remove(this)}setData(t,n){const a=Pp(this.state.data,t,this.options);return It(this,fa,Ko).call(this,{data:a,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),a}setState(t,n){It(this,fa,Ko).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var a,i;const n=(a=de(this,fs))==null?void 0:a.promise;return(i=de(this,fs))==null||i.cancel(t),n?n.then(Ys).catch(Ys):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(de(this,gl))}isActive(){return this.observers.some(t=>Qr(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Tp||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Yo(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!mv(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(a=>a.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=de(this,fs))==null||n.continue()}onOnline(){var n;const t=this.observers.find(a=>a.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=de(this,fs))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),de(this,Gr).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(de(this,fs)&&(de(this,vl)?de(this,fs).cancel({revert:!0}):de(this,fs).cancelRetry()),this.scheduleGc()),de(this,Gr).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||It(this,fa,Ko).call(this,{type:"invalidate"})}async fetch(t,n){var m,v,p,_,y,w,x,S,k,M,P,T;if(this.state.fetchStatus!=="idle"&&((m=de(this,fs))==null?void 0:m.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(de(this,fs))return de(this,fs).continueRetry(),de(this,fs).promise}if(t&&this.setOptions(t),!this.options.queryFn){const j=this.observers.find(O=>O.options.queryFn);j&&this.setOptions(j.options)}const a=new AbortController,i=j=>{Object.defineProperty(j,"signal",{enumerable:!0,get:()=>(Je(this,vl,!0),a.signal)})},l=()=>{const j=vv(this.options,n),A=(()=>{const z={client:de(this,_l),queryKey:this.queryKey,meta:this.meta};return i(z),z})();return Je(this,vl,!1),this.options.persister?this.options.persister(j,A,this):j(A)},d=(()=>{const j={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:de(this,_l),state:this.state,fetchFn:l};return i(j),j})();(v=this.options.behavior)==null||v.onFetch(d,this),Je(this,Ic,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((p=d.fetchOptions)==null?void 0:p.meta))&&It(this,fa,Ko).call(this,{type:"fetch",meta:(_=d.fetchOptions)==null?void 0:_.meta}),Je(this,fs,xv({initialPromise:n==null?void 0:n.initialPromise,fn:d.fetchFn,onCancel:j=>{j instanceof Dp&&j.revert&&this.setState({...de(this,Ic),fetchStatus:"idle"}),a.abort()},onFail:(j,O)=>{It(this,fa,Ko).call(this,{type:"failed",failureCount:j,error:O})},onPause:()=>{It(this,fa,Ko).call(this,{type:"pause"})},onContinue:()=>{It(this,fa,Ko).call(this,{type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0}));try{const j=await de(this,fs).start();if(j===void 0)throw Pj.NODE_ENV,new Error(`${this.queryHash} data is undefined`);return this.setData(j),(w=(y=de(this,Gr).config).onSuccess)==null||w.call(y,j,this),(S=(x=de(this,Gr).config).onSettled)==null||S.call(x,j,this.state.error,this),j}catch(j){if(j instanceof Dp){if(j.silent)return de(this,fs).promise;if(j.revert){if(this.state.data===void 0)throw j;return this.state.data}}throw It(this,fa,Ko).call(this,{type:"error",error:j}),(M=(k=de(this,Gr).config).onError)==null||M.call(k,j,this),(T=(P=de(this,Gr).config).onSettled)==null||T.call(P,this.state.data,j,this),j}finally{this.scheduleGc()}}},gl=new WeakMap,Ic=new WeakMap,Gr=new WeakMap,_l=new WeakMap,fs=new WeakMap,Rd=new WeakMap,vl=new WeakMap,fa=new WeakSet,Ko=function(t){const n=a=>{switch(t.type){case"failed":return{...a,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...jv(a.data,this.options),fetchMeta:t.meta??null};case"success":const i={...a,data:t.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Je(this,Ic,t.manual?i:void 0),i;case"error":const l=t.error;return{...a,error:l,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...t.state}}};this.state=n(this.state),os.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),de(this,Gr).notify({query:this,type:"updated",action:t})})},aj);function jv(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:bv(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Nv(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,a=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var $j=(oj=class extends pc{constructor(t,n){super();gt(this,nn);gt(this,cr);gt(this,Vt);gt(this,Fd);gt(this,Qs);gt(this,yl);gt(this,Bc);gt(this,po);gt(this,ai);gt(this,Id);gt(this,Uc);gt(this,qc);gt(this,bl);gt(this,xl);gt(this,oi);gt(this,Hc,new Set);this.options=n,Je(this,cr,t),Je(this,ai,null),Je(this,po,Lp()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(de(this,Vt).addObserver(this),Sv(de(this,Vt),this.options)?It(this,nn,Km).call(this):this.updateResult(),It(this,nn,J_).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return zp(de(this,Vt),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return zp(de(this,Vt),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,It(this,nn,Z_).call(this),It(this,nn,ev).call(this),de(this,Vt).removeObserver(this)}setOptions(t){const n=this.options,a=de(this,Vt);if(this.options=de(this,cr).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Qr(this.options.enabled,de(this,Vt))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");It(this,nn,tv).call(this),de(this,Vt).setOptions(this.options),n._defaulted&&!Ym(this.options,n)&&de(this,cr).getQueryCache().notify({type:"observerOptionsUpdated",query:de(this,Vt),observer:this});const i=this.hasListeners();i&&Cv(de(this,Vt),a,this.options,n)&&It(this,nn,Km).call(this),this.updateResult(),i&&(de(this,Vt)!==a||Qr(this.options.enabled,de(this,Vt))!==Qr(n.enabled,de(this,Vt))||Yo(this.options.staleTime,de(this,Vt))!==Yo(n.staleTime,de(this,Vt)))&&It(this,nn,Q_).call(this);const l=It(this,nn,G_).call(this);i&&(de(this,Vt)!==a||Qr(this.options.enabled,de(this,Vt))!==Qr(n.enabled,de(this,Vt))||l!==de(this,oi))&&It(this,nn,X_).call(this,l)}getOptimisticResult(t){const n=de(this,cr).getQueryCache().build(de(this,cr),t),a=this.createResult(n,t);return Dj(this,a)&&(Je(this,Qs,a),Je(this,Bc,this.options),Je(this,yl,de(this,Vt).state)),a}getCurrentResult(){return de(this,Qs)}trackResult(t,n){return new Proxy(t,{get:(a,i)=>(this.trackProp(i),n==null||n(i),i==="promise"&&!this.options.experimental_prefetchInRender&&de(this,po).status==="pending"&&de(this,po).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(a,i))})}trackProp(t){de(this,Hc).add(t)}getCurrentQuery(){return de(this,Vt)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=de(this,cr).defaultQueryOptions(t),a=de(this,cr).getQueryCache().build(de(this,cr),n);return a.fetch().then(()=>this.createResult(a,n))}fetch(t){return It(this,nn,Km).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),de(this,Qs)))}createResult(t,n){var q;const a=de(this,Vt),i=this.options,l=de(this,Qs),u=de(this,yl),d=de(this,Bc),v=t!==a?t.state:de(this,Fd),{state:p}=t;let _={...p},y=!1,w;if(n._optimisticResults){const V=this.hasListeners(),R=!V&&Sv(t,n),ee=V&&Cv(t,a,n,i);(R||ee)&&(_={..._,...jv(p.data,t.options)}),n._optimisticResults==="isRestoring"&&(_.fetchStatus="idle")}let{error:x,errorUpdatedAt:S,status:k}=_;w=_.data;let M=!1;if(n.placeholderData!==void 0&&w===void 0&&k==="pending"){let V;l!=null&&l.isPlaceholderData&&n.placeholderData===(d==null?void 0:d.placeholderData)?(V=l.data,M=!0):V=typeof n.placeholderData=="function"?n.placeholderData((q=de(this,qc))==null?void 0:q.state.data,de(this,qc)):n.placeholderData,V!==void 0&&(k="success",w=Pp(l==null?void 0:l.data,V,n),y=!0)}if(n.select&&w!==void 0&&!M)if(l&&w===(u==null?void 0:u.data)&&n.select===de(this,Id))w=de(this,Uc);else try{Je(this,Id,n.select),w=n.select(w),w=Pp(l==null?void 0:l.data,w,n),Je(this,Uc,w),Je(this,ai,null)}catch(V){Je(this,ai,V)}de(this,ai)&&(x=de(this,ai),w=de(this,Uc),S=Date.now(),k="error");const P=_.fetchStatus==="fetching",T=k==="pending",j=k==="error",O=T&&P,A=w!==void 0,$={status:k,fetchStatus:_.fetchStatus,isPending:T,isSuccess:k==="success",isError:j,isInitialLoading:O,isLoading:O,data:w,dataUpdatedAt:_.dataUpdatedAt,error:x,errorUpdatedAt:S,failureCount:_.fetchFailureCount,failureReason:_.fetchFailureReason,errorUpdateCount:_.errorUpdateCount,isFetched:_.dataUpdateCount>0||_.errorUpdateCount>0,isFetchedAfterMount:_.dataUpdateCount>v.dataUpdateCount||_.errorUpdateCount>v.errorUpdateCount,isFetching:P,isRefetching:P&&!T,isLoadingError:j&&!A,isPaused:_.fetchStatus==="paused",isPlaceholderData:y,isRefetchError:j&&A,isStale:Rp(t,n),refetch:this.refetch,promise:de(this,po),isEnabled:Qr(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const V=le=>{$.status==="error"?le.reject($.error):$.data!==void 0&&le.resolve($.data)},R=()=>{const le=Je(this,po,$.promise=Lp());V(le)},ee=de(this,po);switch(ee.status){case"pending":t.queryHash===a.queryHash&&V(ee);break;case"fulfilled":($.status==="error"||$.data!==ee.value)&&R();break;case"rejected":($.status!=="error"||$.error!==ee.reason)&&R();break}}return $}updateResult(){const t=de(this,Qs),n=this.createResult(de(this,Vt),this.options);if(Je(this,yl,de(this,Vt).state),Je(this,Bc,this.options),de(this,yl).data!==void 0&&Je(this,qc,de(this,Vt)),Ym(n,t))return;Je(this,Qs,n);const a=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,l=typeof i=="function"?i():i;if(l==="all"||!l&&!de(this,Hc).size)return!0;const u=new Set(l??de(this,Hc));return this.options.throwOnError&&u.add("error"),Object.keys(de(this,Qs)).some(d=>{const m=d;return de(this,Qs)[m]!==t[m]&&u.has(m)})};It(this,nn,fj).call(this,{listeners:a()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&It(this,nn,J_).call(this)}},cr=new WeakMap,Vt=new WeakMap,Fd=new WeakMap,Qs=new WeakMap,yl=new WeakMap,Bc=new WeakMap,po=new WeakMap,ai=new WeakMap,Id=new WeakMap,Uc=new WeakMap,qc=new WeakMap,bl=new WeakMap,xl=new WeakMap,oi=new WeakMap,Hc=new WeakMap,nn=new WeakSet,Km=function(t){It(this,nn,tv).call(this);let n=de(this,Vt).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(Ys)),n},Q_=function(){It(this,nn,Z_).call(this);const t=Yo(this.options.staleTime,de(this,Vt));if(Gi||de(this,Qs).isStale||!Mp(t))return;const a=mv(de(this,Qs).dataUpdatedAt,t)+1;Je(this,bl,Qi.setTimeout(()=>{de(this,Qs).isStale||this.updateResult()},a))},G_=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(de(this,Vt)):this.options.refetchInterval)??!1},X_=function(t){It(this,nn,ev).call(this),Je(this,oi,t),!(Gi||Qr(this.options.enabled,de(this,Vt))===!1||!Mp(de(this,oi))||de(this,oi)===0)&&Je(this,xl,Qi.setInterval(()=>{(this.options.refetchIntervalInBackground||$p.isFocused())&&It(this,nn,Km).call(this)},de(this,oi)))},J_=function(){It(this,nn,Q_).call(this),It(this,nn,X_).call(this,It(this,nn,G_).call(this))},Z_=function(){de(this,bl)&&(Qi.clearTimeout(de(this,bl)),Je(this,bl,void 0))},ev=function(){de(this,xl)&&(Qi.clearInterval(de(this,xl)),Je(this,xl,void 0))},tv=function(){const t=de(this,cr).getQueryCache().build(de(this,cr),this.options);if(t===de(this,Vt))return;const n=de(this,Vt);Je(this,Vt,t),Je(this,Fd,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},fj=function(t){os.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(de(this,Qs))}),de(this,cr).getQueryCache().notify({query:de(this,Vt),type:"observerResultsUpdated"})})},oj);function Lj(e,t){return Qr(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Sv(e,t){return Lj(e,t)||e.state.data!==void 0&&zp(e,t,t.refetchOnMount)}function zp(e,t,n){if(Qr(t.enabled,e)!==!1&&Yo(t.staleTime,e)!=="static"){const a=typeof n=="function"?n(e):n;return a==="always"||a!==!1&&Rp(e,t)}return!1}function Cv(e,t,n,a){return(e!==t||Qr(a.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&Rp(e,n)}function Rp(e,t){return Qr(t.enabled,e)!==!1&&e.isStaleByTime(Yo(t.staleTime,e))}function Dj(e,t){return!Ym(e.getCurrentResult(),t)}function Ev(e){return{onFetch:(t,n)=>{var p,_,y,w,x;const a=t.options,i=(y=(_=(p=t.fetchOptions)==null?void 0:p.meta)==null?void 0:_.fetchMore)==null?void 0:y.direction,l=((w=t.state.data)==null?void 0:w.pages)||[],u=((x=t.state.data)==null?void 0:x.pageParams)||[];let d={pages:[],pageParams:[]},m=0;const v=async()=>{let S=!1;const k=T=>{Object.defineProperty(T,"signal",{enumerable:!0,get:()=>(t.signal.aborted?S=!0:t.signal.addEventListener("abort",()=>{S=!0}),t.signal)})},M=vv(t.options,t.fetchOptions),P=async(T,j,O)=>{if(S)return Promise.reject();if(j==null&&T.pages.length)return Promise.resolve(T);const z=(()=>{const R={client:t.client,queryKey:t.queryKey,pageParam:j,direction:O?"backward":"forward",meta:t.options.meta};return k(R),R})(),$=await M(z),{maxPages:q}=t.options,V=O?Cj:Sj;return{pages:V(T.pages,$,q),pageParams:V(T.pageParams,j,q)}};if(i&&l.length){const T=i==="backward",j=T?zj:kv,O={pages:l,pageParams:u},A=j(a,O);d=await P(O,A,T)}else{const T=e??l.length;do{const j=m===0?u[0]??a.initialPageParam:kv(a,d);if(m>0&&j==null)break;d=await P(d,j),m++}while(m<T)}return d};t.options.persister?t.fetchFn=()=>{var S,k;return(k=(S=t.options).persister)==null?void 0:k.call(S,v,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=v}}}function kv(e,{pages:t,pageParams:n}){const a=t.length-1;return t.length>0?e.getNextPageParam(t[a],t,n[a],n):void 0}function zj(e,{pages:t,pageParams:n}){var a;return t.length>0?(a=e.getPreviousPageParam)==null?void 0:a.call(e,t[0],t,n[0],n):void 0}var Rj=(ij=class extends wv{constructor(t){super();gt(this,Fa);gt(this,Bd);gt(this,Ra);gt(this,Gs);gt(this,wl);Je(this,Bd,t.client),this.mutationId=t.mutationId,Je(this,Gs,t.mutationCache),Je(this,Ra,[]),this.state=t.state||Mv(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){de(this,Ra).includes(t)||(de(this,Ra).push(t),this.clearGcTimeout(),de(this,Gs).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Je(this,Ra,de(this,Ra).filter(n=>n!==t)),this.scheduleGc(),de(this,Gs).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){de(this,Ra).length||(this.state.status==="pending"?this.scheduleGc():de(this,Gs).remove(this))}continue(){var t;return((t=de(this,wl))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var u,d,m,v,p,_,y,w,x,S,k,M,P,T,j,O,A,z,$,q;const n=()=>{It(this,Fa,Ki).call(this,{type:"continue"})},a={client:de(this,Bd),meta:this.options.meta,mutationKey:this.options.mutationKey};Je(this,wl,xv({fn:()=>this.options.mutationFn?this.options.mutationFn(t,a):Promise.reject(new Error("No mutationFn found")),onFail:(V,R)=>{It(this,Fa,Ki).call(this,{type:"failed",failureCount:V,error:R})},onPause:()=>{It(this,Fa,Ki).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>de(this,Gs).canRun(this)}));const i=this.state.status==="pending",l=!de(this,wl).canStart();try{if(i)n();else{It(this,Fa,Ki).call(this,{type:"pending",variables:t,isPaused:l}),await((d=(u=de(this,Gs).config).onMutate)==null?void 0:d.call(u,t,this,a));const R=await((v=(m=this.options).onMutate)==null?void 0:v.call(m,t,a));R!==this.state.context&&It(this,Fa,Ki).call(this,{type:"pending",context:R,variables:t,isPaused:l})}const V=await de(this,wl).start();return await((_=(p=de(this,Gs).config).onSuccess)==null?void 0:_.call(p,V,t,this.state.context,this,a)),await((w=(y=this.options).onSuccess)==null?void 0:w.call(y,V,t,this.state.context,a)),await((S=(x=de(this,Gs).config).onSettled)==null?void 0:S.call(x,V,null,this.state.variables,this.state.context,this,a)),await((M=(k=this.options).onSettled)==null?void 0:M.call(k,V,null,t,this.state.context,a)),It(this,Fa,Ki).call(this,{type:"success",data:V}),V}catch(V){try{throw await((T=(P=de(this,Gs).config).onError)==null?void 0:T.call(P,V,t,this.state.context,this,a)),await((O=(j=this.options).onError)==null?void 0:O.call(j,V,t,this.state.context,a)),await((z=(A=de(this,Gs).config).onSettled)==null?void 0:z.call(A,void 0,V,this.state.variables,this.state.context,this,a)),await((q=($=this.options).onSettled)==null?void 0:q.call($,void 0,V,t,this.state.context,a)),V}finally{It(this,Fa,Ki).call(this,{type:"error",error:V})}}finally{de(this,Gs).runNext(this)}}},Bd=new WeakMap,Ra=new WeakMap,Gs=new WeakMap,wl=new WeakMap,Fa=new WeakSet,Ki=function(t){const n=a=>{switch(t.type){case"failed":return{...a,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...a,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:t.error,failureCount:a.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),os.batch(()=>{de(this,Ra).forEach(a=>{a.onMutationUpdate(t)}),de(this,Gs).notify({mutation:this,type:"updated",action:t})})},ij);function Mv(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Fj=(lj=class extends pc{constructor(t={}){super();gt(this,go);gt(this,ha);gt(this,Ud);this.config=t,Je(this,go,new Set),Je(this,ha,new Map),Je(this,Ud,0)}build(t,n,a){const i=new Rj({client:t,mutationCache:this,mutationId:++Np(this,Ud)._,options:t.defaultMutationOptions(n),state:a});return this.add(i),i}add(t){de(this,go).add(t);const n=Gm(t);if(typeof n=="string"){const a=de(this,ha).get(n);a?a.push(t):de(this,ha).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(de(this,go).delete(t)){const n=Gm(t);if(typeof n=="string"){const a=de(this,ha).get(n);if(a)if(a.length>1){const i=a.indexOf(t);i!==-1&&a.splice(i,1)}else a[0]===t&&de(this,ha).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=Gm(t);if(typeof n=="string"){const a=de(this,ha).get(n),i=a==null?void 0:a.find(l=>l.state.status==="pending");return!i||i===t}else return!0}runNext(t){var a;const n=Gm(t);if(typeof n=="string"){const i=(a=de(this,ha).get(n))==null?void 0:a.find(l=>l!==t&&l.state.isPaused);return(i==null?void 0:i.continue())??Promise.resolve()}else return Promise.resolve()}clear(){os.batch(()=>{de(this,go).forEach(t=>{this.notify({type:"removed",mutation:t})}),de(this,go).clear(),de(this,ha).clear()})}getAll(){return Array.from(de(this,go))}find(t){const n={exact:!0,...t};return this.getAll().find(a=>hv(n,a))}findAll(t={}){return this.getAll().filter(n=>hv(t,n))}notify(t){os.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return os.batch(()=>Promise.all(t.map(n=>n.continue().catch(Ys))))}},go=new WeakMap,ha=new WeakMap,Ud=new WeakMap,lj);function Gm(e){var t;return(t=e.options.scope)==null?void 0:t.id}var Ij=(cj=class extends pc{constructor(t,n){super();gt(this,yo);gt(this,_o);gt(this,ii);gt(this,ur);gt(this,vo);Je(this,_o,t),this.setOptions(n),this.bindMethods(),It(this,yo,Sp).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var a;const n=this.options;this.options=de(this,_o).defaultMutationOptions(t),Ym(this.options,n)||de(this,_o).getMutationCache().notify({type:"observerOptionsUpdated",mutation:de(this,ur),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&Xi(n.mutationKey)!==Xi(this.options.mutationKey)?this.reset():((a=de(this,ur))==null?void 0:a.state.status)==="pending"&&de(this,ur).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=de(this,ur))==null||t.removeObserver(this)}onMutationUpdate(t){It(this,yo,Sp).call(this),It(this,yo,nv).call(this,t)}getCurrentResult(){return de(this,ii)}reset(){var t;(t=de(this,ur))==null||t.removeObserver(this),Je(this,ur,void 0),It(this,yo,Sp).call(this),It(this,yo,nv).call(this)}mutate(t,n){var a;return Je(this,vo,n),(a=de(this,ur))==null||a.removeObserver(this),Je(this,ur,de(this,_o).getMutationCache().build(de(this,_o),this.options)),de(this,ur).addObserver(this),de(this,ur).execute(t)}},_o=new WeakMap,ii=new WeakMap,ur=new WeakMap,vo=new WeakMap,yo=new WeakSet,Sp=function(){var n;const t=((n=de(this,ur))==null?void 0:n.state)??Mv();Je(this,ii,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},nv=function(t){os.batch(()=>{var n,a,i,l,u,d,m,v;if(de(this,vo)&&this.hasListeners()){const p=de(this,ii).variables,_=de(this,ii).context,y={client:de(this,_o),meta:this.options.meta,mutationKey:this.options.mutationKey};(t==null?void 0:t.type)==="success"?((a=(n=de(this,vo)).onSuccess)==null||a.call(n,t.data,p,_,y),(l=(i=de(this,vo)).onSettled)==null||l.call(i,t.data,null,p,_,y)):(t==null?void 0:t.type)==="error"&&((d=(u=de(this,vo)).onError)==null||d.call(u,t.error,p,_,y),(v=(m=de(this,vo)).onSettled)==null||v.call(m,void 0,t.error,p,_,y))}this.listeners.forEach(p=>{p(de(this,ii))})})},cj),Bj=(uj=class extends pc{constructor(t={}){super();gt(this,Ia);this.config=t,Je(this,Ia,new Map)}build(t,n,a){const i=n.queryKey,l=n.queryHash??Ap(i,n);let u=this.get(l);return u||(u=new Tj({client:t,queryKey:i,queryHash:l,options:t.defaultQueryOptions(n),state:a,defaultOptions:t.getQueryDefaults(i)}),this.add(u)),u}add(t){de(this,Ia).has(t.queryHash)||(de(this,Ia).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=de(this,Ia).get(t.queryHash);n&&(t.destroy(),n===t&&de(this,Ia).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){os.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return de(this,Ia).get(t)}getAll(){return[...de(this,Ia).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(a=>fv(n,a))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(a=>fv(t,a)):n}notify(t){os.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){os.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){os.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Ia=new WeakMap,uj),Uj=(dj=class{constructor(e={}){gt(this,Ln);gt(this,li);gt(this,ci);gt(this,Vc);gt(this,Wc);gt(this,ui);gt(this,Kc);gt(this,Yc);Je(this,Ln,e.queryCache||new Bj),Je(this,li,e.mutationCache||new Fj),Je(this,ci,e.defaultOptions||{}),Je(this,Vc,new Map),Je(this,Wc,new Map),Je(this,ui,0)}mount(){Np(this,ui)._++,de(this,ui)===1&&(Je(this,Kc,$p.subscribe(async e=>{e&&(await this.resumePausedMutations(),de(this,Ln).onFocus())})),Je(this,Yc,Qm.subscribe(async e=>{e&&(await this.resumePausedMutations(),de(this,Ln).onOnline())})))}unmount(){var e,t;Np(this,ui)._--,de(this,ui)===0&&((e=de(this,Kc))==null||e.call(this),Je(this,Kc,void 0),(t=de(this,Yc))==null||t.call(this),Je(this,Yc,void 0))}isFetching(e){return de(this,Ln).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return de(this,li).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=de(this,Ln).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=de(this,Ln).build(this,t),a=n.state.data;return a===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Yo(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(a))}getQueriesData(e){return de(this,Ln).findAll(e).map(({queryKey:t,state:n})=>{const a=n.data;return[t,a]})}setQueryData(e,t,n){const a=this.defaultQueryOptions({queryKey:e}),i=de(this,Ln).get(a.queryHash),l=i==null?void 0:i.state.data,u=wj(t,l);if(u!==void 0)return de(this,Ln).build(this,a).setData(u,{...n,manual:!0})}setQueriesData(e,t,n){return os.batch(()=>de(this,Ln).findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=de(this,Ln).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=de(this,Ln);os.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=de(this,Ln);return os.batch(()=>(n.findAll(e).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},a=os.batch(()=>de(this,Ln).findAll(e).map(i=>i.cancel(n)));return Promise.all(a).then(Ys).catch(Ys)}invalidateQueries(e,t={}){return os.batch(()=>(de(this,Ln).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},a=os.batch(()=>de(this,Ln).findAll(e).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let l=i.fetch(void 0,n);return n.throwOnError||(l=l.catch(Ys)),i.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(a).then(Ys)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=de(this,Ln).build(this,t);return n.isStaleByTime(Yo(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Ys).catch(Ys)}fetchInfiniteQuery(e){return e.behavior=Ev(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Ys).catch(Ys)}ensureInfiniteQueryData(e){return e.behavior=Ev(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Qm.isOnline()?de(this,li).resumePausedMutations():Promise.resolve()}getQueryCache(){return de(this,Ln)}getMutationCache(){return de(this,li)}getDefaultOptions(){return de(this,ci)}setDefaultOptions(e){Je(this,ci,e)}setQueryDefaults(e,t){de(this,Vc).set(Xi(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...de(this,Vc).values()],n={};return t.forEach(a=>{Ju(e,a.queryKey)&&Object.assign(n,a.defaultOptions)}),n}setMutationDefaults(e,t){de(this,Wc).set(Xi(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...de(this,Wc).values()],n={};return t.forEach(a=>{Ju(e,a.mutationKey)&&Object.assign(n,a.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...de(this,ci).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Ap(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Tp&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...de(this,ci).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){de(this,Ln).clear(),de(this,li).clear()}},Ln=new WeakMap,li=new WeakMap,ci=new WeakMap,Vc=new WeakMap,Wc=new WeakMap,ui=new WeakMap,Kc=new WeakMap,Yc=new WeakMap,dj),Av=f.createContext(void 0),gc=e=>{const t=f.useContext(Av);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},qj=({client:e,children:t})=>(f.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),r.jsx(Av.Provider,{value:e,children:t})),Ov=f.createContext(!1),Hj=()=>f.useContext(Ov);Ov.Provider;function Vj(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Wj=f.createContext(Vj()),Kj=()=>f.useContext(Wj),Yj=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Qj=e=>{f.useEffect(()=>{e.clearReset()},[e])},Gj=({result:e,errorResetBoundary:t,throwOnError:n,query:a,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&a&&(i&&e.data===void 0||yv(n,[e.error,a])),Xj=e=>{if(e.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),a=e.staleTime;e.staleTime=typeof a=="function"?(...i)=>n(a(...i)):n(a),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Jj=(e,t)=>e.isLoading&&e.isFetching&&!t,Zj=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Pv=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function eN(e,t,n){var _,y,w,x,S;const a=Hj(),i=Kj(),l=gc(),u=l.defaultQueryOptions(e);(y=(_=l.getDefaultOptions().queries)==null?void 0:_._experimental_beforeQuery)==null||y.call(_,u),u._optimisticResults=a?"isRestoring":"optimistic",Xj(u),Yj(u,i),Qj(i);const d=!l.getQueryCache().get(u.queryHash),[m]=f.useState(()=>new t(l,u)),v=m.getOptimisticResult(u),p=!a&&e.subscribed!==!1;if(f.useSyncExternalStore(f.useCallback(k=>{const M=p?m.subscribe(os.batchCalls(k)):Ys;return m.updateResult(),M},[m,p]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),f.useEffect(()=>{m.setOptions(u)},[u,m]),Zj(u,v))throw Pv(u,m,i);if(Gj({result:v,errorResetBoundary:i,throwOnError:u.throwOnError,query:l.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw v.error;if((x=(w=l.getDefaultOptions().queries)==null?void 0:w._experimental_afterQuery)==null||x.call(w,u,v),u.experimental_prefetchInRender&&!Gi&&Jj(v,a)){const k=d?Pv(u,m,i):(S=l.getQueryCache().get(u.queryHash))==null?void 0:S.promise;k==null||k.catch(Ys).finally(()=>{m.updateResult()})}return u.notifyOnChangeProps?v:m.trackResult(v)}function Ar(e,t){return eN(e,$j)}function Xm(e,t){const n=gc(),[a]=f.useState(()=>new Ij(n,e));f.useEffect(()=>{a.setOptions(e)},[a,e]);const i=f.useSyncExternalStore(f.useCallback(u=>a.subscribe(os.batchCalls(u)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),l=f.useCallback((u,d)=>{a.mutate(u,d).catch(Ys)},[a]);if(i.error&&yv(a.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:l,mutateAsync:i.mutate}}function tN(e){let t;const n=new Set,a=(v,p)=>{const _=typeof v=="function"?v(t):v;if(_!==t){const y=t;t=p?_:Object.assign({},t,_),n.forEach(w=>w(t,y))}},i=()=>t,l=(v,p=i,_=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let y=p(t);function w(){const x=p(t);if(!_(y,x)){const S=y;v(y=x,S)}}return n.add(w),()=>n.delete(w)},m={setState:a,getState:i,subscribe:(v,p,_)=>p||_?l(v,p,_):(n.add(v),()=>n.delete(v)),destroy:()=>n.clear()};return t=e(a,i,m),m}const Tv=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?f.useEffect:f.useLayoutEffect;function nN(e){const t=typeof e=="function"?tN(e):e,n=(a=t.getState,i=Object.is)=>{const[,l]=f.useReducer(k=>k+1,0),u=t.getState(),d=f.useRef(u),m=f.useRef(a),v=f.useRef(i),p=f.useRef(!1),_=f.useRef();_.current===void 0&&(_.current=a(u));let y,w=!1;(d.current!==u||m.current!==a||v.current!==i||p.current)&&(y=a(u),w=!i(_.current,y)),Tv(()=>{w&&(_.current=y),d.current=u,m.current=a,v.current=i,p.current=!1});const x=f.useRef(u);Tv(()=>{const k=()=>{try{const P=t.getState(),T=m.current(P);v.current(_.current,T)||(d.current=P,_.current=T,l())}catch{p.current=!0,l()}},M=t.subscribe(k);return t.getState()!==x.current&&k(),M},[]);const S=w?y:_.current;return f.useDebugValue(S),S};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const a=[n,t];return{next(){const i=a.length<=0;return{value:a.shift(),done:i}}}},n}function sN(){const e=f.createContext(void 0);return{Provider:({initialStore:i,createStore:l,children:u})=>{const d=f.useRef();return d.current||(i&&(console.warn("Provider initialStore is deprecated and will be removed in the next version."),l||(l=()=>i)),d.current=l()),f.createElement(e.Provider,{value:d.current},u)},useStore:(i,l=Object.is)=>{const u=f.useContext(e);if(!u)throw new Error("Seems like you have not used zustand provider as an ancestor.");return u(i,l)},useStoreApi:()=>{const i=f.useContext(e);if(!i)throw new Error("Seems like you have not used zustand provider as an ancestor.");return f.useMemo(()=>({getState:i.getState,setState:i.setState,subscribe:i.subscribe,destroy:i.destroy}),[i])}}}var rN={value:()=>{}};function Jm(){for(var e=0,t=arguments.length,n={},a;e<t;++e){if(!(a=arguments[e]+"")||a in n||/[\s.]/.test(a))throw new Error("illegal type: "+a);n[a]=[]}return new Zm(n)}function Zm(e){this._=e}function aN(e,t){return e.trim().split(/^|\s+/).map(function(n){var a="",i=n.indexOf(".");if(i>=0&&(a=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:a}})}Zm.prototype=Jm.prototype={constructor:Zm,on:function(e,t){var n=this._,a=aN(e+"",n),i,l=-1,u=a.length;if(arguments.length<2){for(;++l<u;)if((i=(e=a[l]).type)&&(i=oN(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++l<u;)if(i=(e=a[l]).type)n[i]=$v(n[i],e.name,t);else if(t==null)for(i in n)n[i]=$v(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Zm(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),a=0,i,l;a<i;++a)n[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(l=this._[e],a=0,i=l.length;a<i;++a)l[a].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var a=this._[e],i=0,l=a.length;i<l;++i)a[i].value.apply(t,n)}};function oN(e,t){for(var n=0,a=e.length,i;n<a;++n)if((i=e[n]).name===t)return i.value}function $v(e,t,n){for(var a=0,i=e.length;a<i;++a)if(e[a].name===t){e[a]=rN,e=e.slice(0,a).concat(e.slice(a+1));break}return n!=null&&e.push({name:t,value:n}),e}var Fp="http://www.w3.org/1999/xhtml";const Lv={svg:"http://www.w3.org/2000/svg",xhtml:Fp,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ef(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Lv.hasOwnProperty(t)?{space:Lv[t],local:e}:e}function iN(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Fp&&t.documentElement.namespaceURI===Fp?t.createElement(e):t.createElementNS(n,e)}}function lN(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Dv(e){var t=ef(e);return(t.local?lN:iN)(t)}function cN(){}function Ip(e){return e==null?cN:function(){return this.querySelector(e)}}function uN(e){typeof e!="function"&&(e=Ip(e));for(var t=this._groups,n=t.length,a=new Array(n),i=0;i<n;++i)for(var l=t[i],u=l.length,d=a[i]=new Array(u),m,v,p=0;p<u;++p)(m=l[p])&&(v=e.call(m,m.__data__,p,l))&&("__data__"in m&&(v.__data__=m.__data__),d[p]=v);return new Or(a,this._parents)}function dN(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function mN(){return[]}function zv(e){return e==null?mN:function(){return this.querySelectorAll(e)}}function fN(e){return function(){return dN(e.apply(this,arguments))}}function hN(e){typeof e=="function"?e=fN(e):e=zv(e);for(var t=this._groups,n=t.length,a=[],i=[],l=0;l<n;++l)for(var u=t[l],d=u.length,m,v=0;v<d;++v)(m=u[v])&&(a.push(e.call(m,m.__data__,v,u)),i.push(m));return new Or(a,i)}function Rv(e){return function(){return this.matches(e)}}function Fv(e){return function(t){return t.matches(e)}}var pN=Array.prototype.find;function gN(e){return function(){return pN.call(this.children,e)}}function _N(){return this.firstElementChild}function vN(e){return this.select(e==null?_N:gN(typeof e=="function"?e:Fv(e)))}var yN=Array.prototype.filter;function bN(){return Array.from(this.children)}function xN(e){return function(){return yN.call(this.children,e)}}function wN(e){return this.selectAll(e==null?bN:xN(typeof e=="function"?e:Fv(e)))}function jN(e){typeof e!="function"&&(e=Rv(e));for(var t=this._groups,n=t.length,a=new Array(n),i=0;i<n;++i)for(var l=t[i],u=l.length,d=a[i]=[],m,v=0;v<u;++v)(m=l[v])&&e.call(m,m.__data__,v,l)&&d.push(m);return new Or(a,this._parents)}function Iv(e){return new Array(e.length)}function NN(){return new Or(this._enter||this._groups.map(Iv),this._parents)}function tf(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}tf.prototype={constructor:tf,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function SN(e){return function(){return e}}function CN(e,t,n,a,i,l){for(var u=0,d,m=t.length,v=l.length;u<v;++u)(d=t[u])?(d.__data__=l[u],a[u]=d):n[u]=new tf(e,l[u]);for(;u<m;++u)(d=t[u])&&(i[u]=d)}function EN(e,t,n,a,i,l,u){var d,m,v=new Map,p=t.length,_=l.length,y=new Array(p),w;for(d=0;d<p;++d)(m=t[d])&&(y[d]=w=u.call(m,m.__data__,d,t)+"",v.has(w)?i[d]=m:v.set(w,m));for(d=0;d<_;++d)w=u.call(e,l[d],d,l)+"",(m=v.get(w))?(a[d]=m,m.__data__=l[d],v.delete(w)):n[d]=new tf(e,l[d]);for(d=0;d<p;++d)(m=t[d])&&v.get(y[d])===m&&(i[d]=m)}function kN(e){return e.__data__}function MN(e,t){if(!arguments.length)return Array.from(this,kN);var n=t?EN:CN,a=this._parents,i=this._groups;typeof e!="function"&&(e=SN(e));for(var l=i.length,u=new Array(l),d=new Array(l),m=new Array(l),v=0;v<l;++v){var p=a[v],_=i[v],y=_.length,w=AN(e.call(p,p&&p.__data__,v,a)),x=w.length,S=d[v]=new Array(x),k=u[v]=new Array(x),M=m[v]=new Array(y);n(p,_,S,k,M,w,t);for(var P=0,T=0,j,O;P<x;++P)if(j=S[P]){for(P>=T&&(T=P+1);!(O=k[T])&&++T<x;);j._next=O||null}}return u=new Or(u,a),u._enter=d,u._exit=m,u}function AN(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ON(){return new Or(this._exit||this._groups.map(Iv),this._parents)}function PN(e,t,n){var a=this.enter(),i=this,l=this.exit();return typeof e=="function"?(a=e(a),a&&(a=a.selection())):a=a.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?l.remove():n(l),a&&i?a.merge(i).order():i}function TN(e){for(var t=e.selection?e.selection():e,n=this._groups,a=t._groups,i=n.length,l=a.length,u=Math.min(i,l),d=new Array(i),m=0;m<u;++m)for(var v=n[m],p=a[m],_=v.length,y=d[m]=new Array(_),w,x=0;x<_;++x)(w=v[x]||p[x])&&(y[x]=w);for(;m<i;++m)d[m]=n[m];return new Or(d,this._parents)}function $N(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var a=e[t],i=a.length-1,l=a[i],u;--i>=0;)(u=a[i])&&(l&&u.compareDocumentPosition(l)^4&&l.parentNode.insertBefore(u,l),l=u);return this}function LN(e){e||(e=DN);function t(_,y){return _&&y?e(_.__data__,y.__data__):!_-!y}for(var n=this._groups,a=n.length,i=new Array(a),l=0;l<a;++l){for(var u=n[l],d=u.length,m=i[l]=new Array(d),v,p=0;p<d;++p)(v=u[p])&&(m[p]=v);m.sort(t)}return new Or(i,this._parents).order()}function DN(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function zN(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function RN(){return Array.from(this)}function FN(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var a=e[t],i=0,l=a.length;i<l;++i){var u=a[i];if(u)return u}return null}function IN(){let e=0;for(const t of this)++e;return e}function BN(){return!this.node()}function UN(e){for(var t=this._groups,n=0,a=t.length;n<a;++n)for(var i=t[n],l=0,u=i.length,d;l<u;++l)(d=i[l])&&e.call(d,d.__data__,l,i);return this}function qN(e){return function(){this.removeAttribute(e)}}function HN(e){return function(){this.removeAttributeNS(e.space,e.local)}}function VN(e,t){return function(){this.setAttribute(e,t)}}function WN(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function KN(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function YN(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function QN(e,t){var n=ef(e);if(arguments.length<2){var a=this.node();return n.local?a.getAttributeNS(n.space,n.local):a.getAttribute(n)}return this.each((t==null?n.local?HN:qN:typeof t=="function"?n.local?YN:KN:n.local?WN:VN)(n,t))}function Bv(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function GN(e){return function(){this.style.removeProperty(e)}}function XN(e,t,n){return function(){this.style.setProperty(e,t,n)}}function JN(e,t,n){return function(){var a=t.apply(this,arguments);a==null?this.style.removeProperty(e):this.style.setProperty(e,a,n)}}function ZN(e,t,n){return arguments.length>1?this.each((t==null?GN:typeof t=="function"?JN:XN)(e,t,n??"")):_c(this.node(),e)}function _c(e,t){return e.style.getPropertyValue(t)||Bv(e).getComputedStyle(e,null).getPropertyValue(t)}function eS(e){return function(){delete this[e]}}function tS(e,t){return function(){this[e]=t}}function nS(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function sS(e,t){return arguments.length>1?this.each((t==null?eS:typeof t=="function"?nS:tS)(e,t)):this.node()[e]}function Uv(e){return e.trim().split(/^|\s+/)}function Bp(e){return e.classList||new qv(e)}function qv(e){this._node=e,this._names=Uv(e.getAttribute("class")||"")}qv.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Hv(e,t){for(var n=Bp(e),a=-1,i=t.length;++a<i;)n.add(t[a])}function Vv(e,t){for(var n=Bp(e),a=-1,i=t.length;++a<i;)n.remove(t[a])}function rS(e){return function(){Hv(this,e)}}function aS(e){return function(){Vv(this,e)}}function oS(e,t){return function(){(t.apply(this,arguments)?Hv:Vv)(this,e)}}function iS(e,t){var n=Uv(e+"");if(arguments.length<2){for(var a=Bp(this.node()),i=-1,l=n.length;++i<l;)if(!a.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?oS:t?rS:aS)(n,t))}function lS(){this.textContent=""}function cS(e){return function(){this.textContent=e}}function uS(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function dS(e){return arguments.length?this.each(e==null?lS:(typeof e=="function"?uS:cS)(e)):this.node().textContent}function mS(){this.innerHTML=""}function fS(e){return function(){this.innerHTML=e}}function hS(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function pS(e){return arguments.length?this.each(e==null?mS:(typeof e=="function"?hS:fS)(e)):this.node().innerHTML}function gS(){this.nextSibling&&this.parentNode.appendChild(this)}function _S(){return this.each(gS)}function vS(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function yS(){return this.each(vS)}function bS(e){var t=typeof e=="function"?e:Dv(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function xS(){return null}function wS(e,t){var n=typeof e=="function"?e:Dv(e),a=t==null?xS:typeof t=="function"?t:Ip(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),a.apply(this,arguments)||null)})}function jS(){var e=this.parentNode;e&&e.removeChild(this)}function NS(){return this.each(jS)}function SS(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function CS(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ES(e){return this.select(e?CS:SS)}function kS(e){return arguments.length?this.property("__data__",e):this.node().__data__}function MS(e){return function(t){e.call(this,t,this.__data__)}}function AS(e){return e.trim().split(/^|\s+/).map(function(t){var n="",a=t.indexOf(".");return a>=0&&(n=t.slice(a+1),t=t.slice(0,a)),{type:t,name:n}})}function OS(e){return function(){var t=this.__on;if(t){for(var n=0,a=-1,i=t.length,l;n<i;++n)l=t[n],(!e.type||l.type===e.type)&&l.name===e.name?this.removeEventListener(l.type,l.listener,l.options):t[++a]=l;++a?t.length=a:delete this.__on}}}function PS(e,t,n){return function(){var a=this.__on,i,l=MS(t);if(a){for(var u=0,d=a.length;u<d;++u)if((i=a[u]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=l,i.options=n),i.value=t;return}}this.addEventListener(e.type,l,n),i={type:e.type,name:e.name,value:t,listener:l,options:n},a?a.push(i):this.__on=[i]}}function TS(e,t,n){var a=AS(e+""),i,l=a.length,u;if(arguments.length<2){var d=this.node().__on;if(d){for(var m=0,v=d.length,p;m<v;++m)for(i=0,p=d[m];i<l;++i)if((u=a[i]).type===p.type&&u.name===p.name)return p.value}return}for(d=t?PS:OS,i=0;i<l;++i)this.each(d(a[i],t,n));return this}function Wv(e,t,n){var a=Bv(e),i=a.CustomEvent;typeof i=="function"?i=new i(t,n):(i=a.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function $S(e,t){return function(){return Wv(this,e,t)}}function LS(e,t){return function(){return Wv(this,e,t.apply(this,arguments))}}function DS(e,t){return this.each((typeof t=="function"?LS:$S)(e,t))}function*zS(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var a=e[t],i=0,l=a.length,u;i<l;++i)(u=a[i])&&(yield u)}var Kv=[null];function Or(e,t){this._groups=e,this._parents=t}function Zu(){return new Or([[document.documentElement]],Kv)}function RS(){return this}Or.prototype=Zu.prototype={constructor:Or,select:uN,selectAll:hN,selectChild:vN,selectChildren:wN,filter:jN,data:MN,enter:NN,exit:ON,join:PN,merge:TN,selection:RS,order:$N,sort:LN,call:zN,nodes:RN,node:FN,size:IN,empty:BN,each:UN,attr:QN,style:ZN,property:sS,classed:iS,text:dS,html:pS,raise:_S,lower:yS,append:bS,insert:wS,remove:NS,clone:ES,datum:kS,on:TS,dispatch:DS,[Symbol.iterator]:zS};function ca(e){return typeof e=="string"?new Or([[document.querySelector(e)]],[document.documentElement]):new Or([[e]],Kv)}function FS(e){let t;for(;t=e.sourceEvent;)e=t;return e}function $a(e,t){if(e=FS(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var a=n.createSVGPoint();return a.x=e.clientX,a.y=e.clientY,a=a.matrixTransform(t.getScreenCTM().inverse()),[a.x,a.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const IS={passive:!1},ed={capture:!0,passive:!1};function Up(e){e.stopImmediatePropagation()}function vc(e){e.preventDefault(),e.stopImmediatePropagation()}function Yv(e){var t=e.document.documentElement,n=ca(e).on("dragstart.drag",vc,ed);"onselectstart"in t?n.on("selectstart.drag",vc,ed):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Qv(e,t){var n=e.document.documentElement,a=ca(e).on("dragstart.drag",null);t&&(a.on("click.drag",vc,ed),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in n?a.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const nf=e=>()=>e;function qp(e,{sourceEvent:t,subject:n,target:a,identifier:i,active:l,x:u,y:d,dx:m,dy:v,dispatch:p}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:l,enumerable:!0,configurable:!0},x:{value:u,enumerable:!0,configurable:!0},y:{value:d,enumerable:!0,configurable:!0},dx:{value:m,enumerable:!0,configurable:!0},dy:{value:v,enumerable:!0,configurable:!0},_:{value:p}})}qp.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function BS(e){return!e.ctrlKey&&!e.button}function US(){return this.parentNode}function qS(e,t){return t??{x:e.x,y:e.y}}function HS(){return navigator.maxTouchPoints||"ontouchstart"in this}function VS(){var e=BS,t=US,n=qS,a=HS,i={},l=Jm("start","drag","end"),u=0,d,m,v,p,_=0;function y(j){j.on("mousedown.drag",w).filter(a).on("touchstart.drag",k).on("touchmove.drag",M,IS).on("touchend.drag touchcancel.drag",P).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function w(j,O){if(!(p||!e.call(this,j,O))){var A=T(this,t.call(this,j,O),j,O,"mouse");A&&(ca(j.view).on("mousemove.drag",x,ed).on("mouseup.drag",S,ed),Yv(j.view),Up(j),v=!1,d=j.clientX,m=j.clientY,A("start",j))}}function x(j){if(vc(j),!v){var O=j.clientX-d,A=j.clientY-m;v=O*O+A*A>_}i.mouse("drag",j)}function S(j){ca(j.view).on("mousemove.drag mouseup.drag",null),Qv(j.view,v),vc(j),i.mouse("end",j)}function k(j,O){if(e.call(this,j,O)){var A=j.changedTouches,z=t.call(this,j,O),$=A.length,q,V;for(q=0;q<$;++q)(V=T(this,z,j,O,A[q].identifier,A[q]))&&(Up(j),V("start",j,A[q]))}}function M(j){var O=j.changedTouches,A=O.length,z,$;for(z=0;z<A;++z)($=i[O[z].identifier])&&(vc(j),$("drag",j,O[z]))}function P(j){var O=j.changedTouches,A=O.length,z,$;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),z=0;z<A;++z)($=i[O[z].identifier])&&(Up(j),$("end",j,O[z]))}function T(j,O,A,z,$,q){var V=l.copy(),R=$a(q||A,O),ee,le,D;if((D=n.call(j,new qp("beforestart",{sourceEvent:A,target:y,identifier:$,active:u,x:R[0],y:R[1],dx:0,dy:0,dispatch:V}),z))!=null)return ee=D.x-R[0]||0,le=D.y-R[1]||0,function X(Y,K,U){var te=R,W;switch(Y){case"start":i[$]=X,W=u++;break;case"end":delete i[$],--u;case"drag":R=$a(U||K,O),W=u;break}V.call(Y,j,new qp(Y,{sourceEvent:K,subject:D,target:y,identifier:$,active:W,x:R[0]+ee,y:R[1]+le,dx:R[0]-te[0],dy:R[1]-te[1],dispatch:V}),z)}}return y.filter=function(j){return arguments.length?(e=typeof j=="function"?j:nf(!!j),y):e},y.container=function(j){return arguments.length?(t=typeof j=="function"?j:nf(j),y):t},y.subject=function(j){return arguments.length?(n=typeof j=="function"?j:nf(j),y):n},y.touchable=function(j){return arguments.length?(a=typeof j=="function"?j:nf(!!j),y):a},y.on=function(){var j=l.on.apply(l,arguments);return j===l?y:j},y.clickDistance=function(j){return arguments.length?(_=(j=+j)*j,y):Math.sqrt(_)},y}function Hp(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Gv(e,t){var n=Object.create(e.prototype);for(var a in t)n[a]=t[a];return n}function td(){}var nd=.7,sf=1/nd,yc="\\s*([+-]?\\d+)\\s*",sd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",La="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",WS=/^#([0-9a-f]{3,8})$/,KS=new RegExp(`^rgb\\(${yc},${yc},${yc}\\)$`),YS=new RegExp(`^rgb\\(${La},${La},${La}\\)$`),QS=new RegExp(`^rgba\\(${yc},${yc},${yc},${sd}\\)$`),GS=new RegExp(`^rgba\\(${La},${La},${La},${sd}\\)$`),XS=new RegExp(`^hsl\\(${sd},${La},${La}\\)$`),JS=new RegExp(`^hsla\\(${sd},${La},${La},${sd}\\)$`),Xv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Hp(td,rd,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Jv,formatHex:Jv,formatHex8:ZS,formatHsl:eC,formatRgb:Zv,toString:Zv});function Jv(){return this.rgb().formatHex()}function ZS(){return this.rgb().formatHex8()}function eC(){return ry(this).formatHsl()}function Zv(){return this.rgb().formatRgb()}function rd(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=WS.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?ey(t):n===3?new or(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?rf(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?rf(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=KS.exec(e))?new or(t[1],t[2],t[3],1):(t=YS.exec(e))?new or(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=QS.exec(e))?rf(t[1],t[2],t[3],t[4]):(t=GS.exec(e))?rf(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=XS.exec(e))?sy(t[1],t[2]/100,t[3]/100,1):(t=JS.exec(e))?sy(t[1],t[2]/100,t[3]/100,t[4]):Xv.hasOwnProperty(e)?ey(Xv[e]):e==="transparent"?new or(NaN,NaN,NaN,0):null}function ey(e){return new or(e>>16&255,e>>8&255,e&255,1)}function rf(e,t,n,a){return a<=0&&(e=t=n=NaN),new or(e,t,n,a)}function tC(e){return e instanceof td||(e=rd(e)),e?(e=e.rgb(),new or(e.r,e.g,e.b,e.opacity)):new or}function Vp(e,t,n,a){return arguments.length===1?tC(e):new or(e,t,n,a??1)}function or(e,t,n,a){this.r=+e,this.g=+t,this.b=+n,this.opacity=+a}Hp(or,Vp,Gv(td,{brighter(e){return e=e==null?sf:Math.pow(sf,e),new or(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?nd:Math.pow(nd,e),new or(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new or(Ji(this.r),Ji(this.g),Ji(this.b),af(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ty,formatHex:ty,formatHex8:nC,formatRgb:ny,toString:ny}));function ty(){return`#${Zi(this.r)}${Zi(this.g)}${Zi(this.b)}`}function nC(){return`#${Zi(this.r)}${Zi(this.g)}${Zi(this.b)}${Zi((isNaN(this.opacity)?1:this.opacity)*255)}`}function ny(){const e=af(this.opacity);return`${e===1?"rgb(":"rgba("}${Ji(this.r)}, ${Ji(this.g)}, ${Ji(this.b)}${e===1?")":`, ${e})`}`}function af(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ji(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Zi(e){return e=Ji(e),(e<16?"0":"")+e.toString(16)}function sy(e,t,n,a){return a<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ua(e,t,n,a)}function ry(e){if(e instanceof ua)return new ua(e.h,e.s,e.l,e.opacity);if(e instanceof td||(e=rd(e)),!e)return new ua;if(e instanceof ua)return e;e=e.rgb();var t=e.r/255,n=e.g/255,a=e.b/255,i=Math.min(t,n,a),l=Math.max(t,n,a),u=NaN,d=l-i,m=(l+i)/2;return d?(t===l?u=(n-a)/d+(n<a)*6:n===l?u=(a-t)/d+2:u=(t-n)/d+4,d/=m<.5?l+i:2-l-i,u*=60):d=m>0&&m<1?0:u,new ua(u,d,m,e.opacity)}function sC(e,t,n,a){return arguments.length===1?ry(e):new ua(e,t,n,a??1)}function ua(e,t,n,a){this.h=+e,this.s=+t,this.l=+n,this.opacity=+a}Hp(ua,sC,Gv(td,{brighter(e){return e=e==null?sf:Math.pow(sf,e),new ua(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?nd:Math.pow(nd,e),new ua(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,a=n+(n<.5?n:1-n)*t,i=2*n-a;return new or(Wp(e>=240?e-240:e+120,i,a),Wp(e,i,a),Wp(e<120?e+240:e-120,i,a),this.opacity)},clamp(){return new ua(ay(this.h),of(this.s),of(this.l),af(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=af(this.opacity);return`${e===1?"hsl(":"hsla("}${ay(this.h)}, ${of(this.s)*100}%, ${of(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ay(e){return e=(e||0)%360,e<0?e+360:e}function of(e){return Math.max(0,Math.min(1,e||0))}function Wp(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const oy=e=>()=>e;function rC(e,t){return function(n){return e+n*t}}function aC(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(a){return Math.pow(e+a*t,n)}}function oC(e){return(e=+e)==1?iy:function(t,n){return n-t?aC(t,n,e):oy(isNaN(t)?n:t)}}function iy(e,t){var n=t-e;return n?rC(e,n):oy(isNaN(e)?t:e)}const ly=function e(t){var n=oC(t);function a(i,l){var u=n((i=Vp(i)).r,(l=Vp(l)).r),d=n(i.g,l.g),m=n(i.b,l.b),v=iy(i.opacity,l.opacity);return function(p){return i.r=u(p),i.g=d(p),i.b=m(p),i.opacity=v(p),i+""}}return a.gamma=e,a}(1);function Qo(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Kp=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yp=new RegExp(Kp.source,"g");function iC(e){return function(){return e}}function lC(e){return function(t){return e(t)+""}}function cC(e,t){var n=Kp.lastIndex=Yp.lastIndex=0,a,i,l,u=-1,d=[],m=[];for(e=e+"",t=t+"";(a=Kp.exec(e))&&(i=Yp.exec(t));)(l=i.index)>n&&(l=t.slice(n,l),d[u]?d[u]+=l:d[++u]=l),(a=a[0])===(i=i[0])?d[u]?d[u]+=i:d[++u]=i:(d[++u]=null,m.push({i:u,x:Qo(a,i)})),n=Yp.lastIndex;return n<t.length&&(l=t.slice(n),d[u]?d[u]+=l:d[++u]=l),d.length<2?m[0]?lC(m[0].x):iC(t):(t=m.length,function(v){for(var p=0,_;p<t;++p)d[(_=m[p]).i]=_.x(v);return d.join("")})}var cy=180/Math.PI,Qp={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function uy(e,t,n,a,i,l){var u,d,m;return(u=Math.sqrt(e*e+t*t))&&(e/=u,t/=u),(m=e*n+t*a)&&(n-=e*m,a-=t*m),(d=Math.sqrt(n*n+a*a))&&(n/=d,a/=d,m/=d),e*a<t*n&&(e=-e,t=-t,m=-m,u=-u),{translateX:i,translateY:l,rotate:Math.atan2(t,e)*cy,skewX:Math.atan(m)*cy,scaleX:u,scaleY:d}}var lf;function uC(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Qp:uy(t.a,t.b,t.c,t.d,t.e,t.f)}function dC(e){return e==null||(lf||(lf=document.createElementNS("http://www.w3.org/2000/svg","g")),lf.setAttribute("transform",e),!(e=lf.transform.baseVal.consolidate()))?Qp:(e=e.matrix,uy(e.a,e.b,e.c,e.d,e.e,e.f))}function dy(e,t,n,a){function i(v){return v.length?v.pop()+" ":""}function l(v,p,_,y,w,x){if(v!==_||p!==y){var S=w.push("translate(",null,t,null,n);x.push({i:S-4,x:Qo(v,_)},{i:S-2,x:Qo(p,y)})}else(_||y)&&w.push("translate("+_+t+y+n)}function u(v,p,_,y){v!==p?(v-p>180?p+=360:p-v>180&&(v+=360),y.push({i:_.push(i(_)+"rotate(",null,a)-2,x:Qo(v,p)})):p&&_.push(i(_)+"rotate("+p+a)}function d(v,p,_,y){v!==p?y.push({i:_.push(i(_)+"skewX(",null,a)-2,x:Qo(v,p)}):p&&_.push(i(_)+"skewX("+p+a)}function m(v,p,_,y,w,x){if(v!==_||p!==y){var S=w.push(i(w)+"scale(",null,",",null,")");x.push({i:S-4,x:Qo(v,_)},{i:S-2,x:Qo(p,y)})}else(_!==1||y!==1)&&w.push(i(w)+"scale("+_+","+y+")")}return function(v,p){var _=[],y=[];return v=e(v),p=e(p),l(v.translateX,v.translateY,p.translateX,p.translateY,_,y),u(v.rotate,p.rotate,_,y),d(v.skewX,p.skewX,_,y),m(v.scaleX,v.scaleY,p.scaleX,p.scaleY,_,y),v=p=null,function(w){for(var x=-1,S=y.length,k;++x<S;)_[(k=y[x]).i]=k.x(w);return _.join("")}}}var mC=dy(uC,"px, ","px)","deg)"),fC=dy(dC,", ",")",")"),hC=1e-12;function my(e){return((e=Math.exp(e))+1/e)/2}function pC(e){return((e=Math.exp(e))-1/e)/2}function gC(e){return((e=Math.exp(2*e))-1)/(e+1)}const _C=function e(t,n,a){function i(l,u){var d=l[0],m=l[1],v=l[2],p=u[0],_=u[1],y=u[2],w=p-d,x=_-m,S=w*w+x*x,k,M;if(S<hC)M=Math.log(y/v)/t,k=function(z){return[d+z*w,m+z*x,v*Math.exp(t*z*M)]};else{var P=Math.sqrt(S),T=(y*y-v*v+a*S)/(2*v*n*P),j=(y*y-v*v-a*S)/(2*y*n*P),O=Math.log(Math.sqrt(T*T+1)-T),A=Math.log(Math.sqrt(j*j+1)-j);M=(A-O)/t,k=function(z){var $=z*M,q=my(O),V=v/(n*P)*(q*gC(t*$+O)-pC(O));return[d+V*w,m+V*x,v*q/my(t*$+O)]}}return k.duration=M*1e3*t/Math.SQRT2,k}return i.rho=function(l){var u=Math.max(.001,+l),d=u*u,m=d*d;return e(u,d,m)},i}(Math.SQRT2,2,4);var bc=0,ad=0,od=0,fy=1e3,cf,id,uf=0,el=0,df=0,ld=typeof performance=="object"&&performance.now?performance:Date,hy=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Gp(){return el||(hy(vC),el=ld.now()+df)}function vC(){el=0}function mf(){this._call=this._time=this._next=null}mf.prototype=py.prototype={constructor:mf,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Gp():+n)+(t==null?0:+t),!this._next&&id!==this&&(id?id._next=this:cf=this,id=this),this._call=e,this._time=n,Xp()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xp())}};function py(e,t,n){var a=new mf;return a.restart(e,t,n),a}function yC(){Gp(),++bc;for(var e=cf,t;e;)(t=el-e._time)>=0&&e._call.call(void 0,t),e=e._next;--bc}function gy(){el=(uf=ld.now())+df,bc=ad=0;try{yC()}finally{bc=0,xC(),el=0}}function bC(){var e=ld.now(),t=e-uf;t>fy&&(df-=t,uf=e)}function xC(){for(var e,t=cf,n,a=1/0;t;)t._call?(a>t._time&&(a=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:cf=n);id=e,Xp(a)}function Xp(e){if(!bc){ad&&(ad=clearTimeout(ad));var t=e-el;t>24?(e<1/0&&(ad=setTimeout(gy,e-ld.now()-df)),od&&(od=clearInterval(od))):(od||(uf=ld.now(),od=setInterval(bC,fy)),bc=1,hy(gy))}}function _y(e,t,n){var a=new mf;return t=t==null?0:+t,a.restart(i=>{a.stop(),e(i+t)},t,n),a}var wC=Jm("start","end","cancel","interrupt"),jC=[],vy=0,yy=1,Jp=2,ff=3,by=4,Zp=5,hf=6;function pf(e,t,n,a,i,l){var u=e.__transition;if(!u)e.__transition={};else if(n in u)return;NC(e,n,{name:t,index:a,group:i,on:wC,tween:jC,time:l.time,delay:l.delay,duration:l.duration,ease:l.ease,timer:null,state:vy})}function eg(e,t){var n=da(e,t);if(n.state>vy)throw new Error("too late; already scheduled");return n}function Da(e,t){var n=da(e,t);if(n.state>ff)throw new Error("too late; already running");return n}function da(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function NC(e,t,n){var a=e.__transition,i;a[t]=n,n.timer=py(l,0,n.time);function l(v){n.state=yy,n.timer.restart(u,n.delay,n.time),n.delay<=v&&u(v-n.delay)}function u(v){var p,_,y,w;if(n.state!==yy)return m();for(p in a)if(w=a[p],w.name===n.name){if(w.state===ff)return _y(u);w.state===by?(w.state=hf,w.timer.stop(),w.on.call("interrupt",e,e.__data__,w.index,w.group),delete a[p]):+p<t&&(w.state=hf,w.timer.stop(),w.on.call("cancel",e,e.__data__,w.index,w.group),delete a[p])}if(_y(function(){n.state===ff&&(n.state=by,n.timer.restart(d,n.delay,n.time),d(v))}),n.state=Jp,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Jp){for(n.state=ff,i=new Array(y=n.tween.length),p=0,_=-1;p<y;++p)(w=n.tween[p].value.call(e,e.__data__,n.index,n.group))&&(i[++_]=w);i.length=_+1}}function d(v){for(var p=v<n.duration?n.ease.call(null,v/n.duration):(n.timer.restart(m),n.state=Zp,1),_=-1,y=i.length;++_<y;)i[_].call(e,p);n.state===Zp&&(n.on.call("end",e,e.__data__,n.index,n.group),m())}function m(){n.state=hf,n.timer.stop(),delete a[t];for(var v in a)return;delete e.__transition}}function gf(e,t){var n=e.__transition,a,i,l=!0,u;if(n){t=t==null?null:t+"";for(u in n){if((a=n[u]).name!==t){l=!1;continue}i=a.state>Jp&&a.state<Zp,a.state=hf,a.timer.stop(),a.on.call(i?"interrupt":"cancel",e,e.__data__,a.index,a.group),delete n[u]}l&&delete e.__transition}}function SC(e){return this.each(function(){gf(this,e)})}function CC(e,t){var n,a;return function(){var i=Da(this,e),l=i.tween;if(l!==n){a=n=l;for(var u=0,d=a.length;u<d;++u)if(a[u].name===t){a=a.slice(),a.splice(u,1);break}}i.tween=a}}function EC(e,t,n){var a,i;if(typeof n!="function")throw new Error;return function(){var l=Da(this,e),u=l.tween;if(u!==a){i=(a=u).slice();for(var d={name:t,value:n},m=0,v=i.length;m<v;++m)if(i[m].name===t){i[m]=d;break}m===v&&i.push(d)}l.tween=i}}function kC(e,t){var n=this._id;if(e+="",arguments.length<2){for(var a=da(this.node(),n).tween,i=0,l=a.length,u;i<l;++i)if((u=a[i]).name===e)return u.value;return null}return this.each((t==null?CC:EC)(n,e,t))}function tg(e,t,n){var a=e._id;return e.each(function(){var i=Da(this,a);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return da(i,a).value[t]}}function xy(e,t){var n;return(typeof t=="number"?Qo:t instanceof rd?ly:(n=rd(t))?(t=n,ly):cC)(e,t)}function MC(e){return function(){this.removeAttribute(e)}}function AC(e){return function(){this.removeAttributeNS(e.space,e.local)}}function OC(e,t,n){var a,i=n+"",l;return function(){var u=this.getAttribute(e);return u===i?null:u===a?l:l=t(a=u,n)}}function PC(e,t,n){var a,i=n+"",l;return function(){var u=this.getAttributeNS(e.space,e.local);return u===i?null:u===a?l:l=t(a=u,n)}}function TC(e,t,n){var a,i,l;return function(){var u,d=n(this),m;return d==null?void this.removeAttribute(e):(u=this.getAttribute(e),m=d+"",u===m?null:u===a&&m===i?l:(i=m,l=t(a=u,d)))}}function $C(e,t,n){var a,i,l;return function(){var u,d=n(this),m;return d==null?void this.removeAttributeNS(e.space,e.local):(u=this.getAttributeNS(e.space,e.local),m=d+"",u===m?null:u===a&&m===i?l:(i=m,l=t(a=u,d)))}}function LC(e,t){var n=ef(e),a=n==="transform"?fC:xy;return this.attrTween(e,typeof t=="function"?(n.local?$C:TC)(n,a,tg(this,"attr."+e,t)):t==null?(n.local?AC:MC)(n):(n.local?PC:OC)(n,a,t))}function DC(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function zC(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function RC(e,t){var n,a;function i(){var l=t.apply(this,arguments);return l!==a&&(n=(a=l)&&zC(e,l)),n}return i._value=t,i}function FC(e,t){var n,a;function i(){var l=t.apply(this,arguments);return l!==a&&(n=(a=l)&&DC(e,l)),n}return i._value=t,i}function IC(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var a=ef(e);return this.tween(n,(a.local?RC:FC)(a,t))}function BC(e,t){return function(){eg(this,e).delay=+t.apply(this,arguments)}}function UC(e,t){return t=+t,function(){eg(this,e).delay=t}}function qC(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?BC:UC)(t,e)):da(this.node(),t).delay}function HC(e,t){return function(){Da(this,e).duration=+t.apply(this,arguments)}}function VC(e,t){return t=+t,function(){Da(this,e).duration=t}}function WC(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?HC:VC)(t,e)):da(this.node(),t).duration}function KC(e,t){if(typeof t!="function")throw new Error;return function(){Da(this,e).ease=t}}function YC(e){var t=this._id;return arguments.length?this.each(KC(t,e)):da(this.node(),t).ease}function QC(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Da(this,e).ease=n}}function GC(e){if(typeof e!="function")throw new Error;return this.each(QC(this._id,e))}function XC(e){typeof e!="function"&&(e=Rv(e));for(var t=this._groups,n=t.length,a=new Array(n),i=0;i<n;++i)for(var l=t[i],u=l.length,d=a[i]=[],m,v=0;v<u;++v)(m=l[v])&&e.call(m,m.__data__,v,l)&&d.push(m);return new io(a,this._parents,this._name,this._id)}function JC(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,a=t.length,i=n.length,l=Math.min(a,i),u=new Array(a),d=0;d<l;++d)for(var m=t[d],v=n[d],p=m.length,_=u[d]=new Array(p),y,w=0;w<p;++w)(y=m[w]||v[w])&&(_[w]=y);for(;d<a;++d)u[d]=t[d];return new io(u,this._parents,this._name,this._id)}function ZC(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function eE(e,t,n){var a,i,l=ZC(t)?eg:Da;return function(){var u=l(this,e),d=u.on;d!==a&&(i=(a=d).copy()).on(t,n),u.on=i}}function tE(e,t){var n=this._id;return arguments.length<2?da(this.node(),n).on.on(e):this.each(eE(n,e,t))}function nE(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function sE(){return this.on("end.remove",nE(this._id))}function rE(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ip(e));for(var a=this._groups,i=a.length,l=new Array(i),u=0;u<i;++u)for(var d=a[u],m=d.length,v=l[u]=new Array(m),p,_,y=0;y<m;++y)(p=d[y])&&(_=e.call(p,p.__data__,y,d))&&("__data__"in p&&(_.__data__=p.__data__),v[y]=_,pf(v[y],t,n,y,v,da(p,n)));return new io(l,this._parents,t,n)}function aE(e){var t=this._name,n=this._id;typeof e!="function"&&(e=zv(e));for(var a=this._groups,i=a.length,l=[],u=[],d=0;d<i;++d)for(var m=a[d],v=m.length,p,_=0;_<v;++_)if(p=m[_]){for(var y=e.call(p,p.__data__,_,m),w,x=da(p,n),S=0,k=y.length;S<k;++S)(w=y[S])&&pf(w,t,n,S,y,x);l.push(y),u.push(p)}return new io(l,u,t,n)}var oE=Zu.prototype.constructor;function iE(){return new oE(this._groups,this._parents)}function lE(e,t){var n,a,i;return function(){var l=_c(this,e),u=(this.style.removeProperty(e),_c(this,e));return l===u?null:l===n&&u===a?i:i=t(n=l,a=u)}}function wy(e){return function(){this.style.removeProperty(e)}}function cE(e,t,n){var a,i=n+"",l;return function(){var u=_c(this,e);return u===i?null:u===a?l:l=t(a=u,n)}}function uE(e,t,n){var a,i,l;return function(){var u=_c(this,e),d=n(this),m=d+"";return d==null&&(m=d=(this.style.removeProperty(e),_c(this,e))),u===m?null:u===a&&m===i?l:(i=m,l=t(a=u,d))}}function dE(e,t){var n,a,i,l="style."+t,u="end."+l,d;return function(){var m=Da(this,e),v=m.on,p=m.value[l]==null?d||(d=wy(t)):void 0;(v!==n||i!==p)&&(a=(n=v).copy()).on(u,i=p),m.on=a}}function mE(e,t,n){var a=(e+="")=="transform"?mC:xy;return t==null?this.styleTween(e,lE(e,a)).on("end.style."+e,wy(e)):typeof t=="function"?this.styleTween(e,uE(e,a,tg(this,"style."+e,t))).each(dE(this._id,e)):this.styleTween(e,cE(e,a,t),n).on("end.style."+e,null)}function fE(e,t,n){return function(a){this.style.setProperty(e,t.call(this,a),n)}}function hE(e,t,n){var a,i;function l(){var u=t.apply(this,arguments);return u!==i&&(a=(i=u)&&fE(e,u,n)),a}return l._value=t,l}function pE(e,t,n){var a="style."+(e+="");if(arguments.length<2)return(a=this.tween(a))&&a._value;if(t==null)return this.tween(a,null);if(typeof t!="function")throw new Error;return this.tween(a,hE(e,t,n??""))}function gE(e){return function(){this.textContent=e}}function _E(e){return function(){var t=e(this);this.textContent=t??""}}function vE(e){return this.tween("text",typeof e=="function"?_E(tg(this,"text",e)):gE(e==null?"":e+""))}function yE(e){return function(t){this.textContent=e.call(this,t)}}function bE(e){var t,n;function a(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&yE(i)),t}return a._value=e,a}function xE(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,bE(e))}function wE(){for(var e=this._name,t=this._id,n=jy(),a=this._groups,i=a.length,l=0;l<i;++l)for(var u=a[l],d=u.length,m,v=0;v<d;++v)if(m=u[v]){var p=da(m,t);pf(m,e,n,v,u,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new io(a,this._parents,e,n)}function jE(){var e,t,n=this,a=n._id,i=n.size();return new Promise(function(l,u){var d={value:u},m={value:function(){--i===0&&l()}};n.each(function(){var v=Da(this,a),p=v.on;p!==e&&(t=(e=p).copy(),t._.cancel.push(d),t._.interrupt.push(d),t._.end.push(m)),v.on=t}),i===0&&l()})}var NE=0;function io(e,t,n,a){this._groups=e,this._parents=t,this._name=n,this._id=a}function jy(){return++NE}var lo=Zu.prototype;io.prototype={constructor:io,select:rE,selectAll:aE,selectChild:lo.selectChild,selectChildren:lo.selectChildren,filter:XC,merge:JC,selection:iE,transition:wE,call:lo.call,nodes:lo.nodes,node:lo.node,size:lo.size,empty:lo.empty,each:lo.each,on:tE,attr:LC,attrTween:IC,style:mE,styleTween:pE,text:vE,textTween:xE,remove:sE,tween:kC,delay:qC,duration:WC,ease:YC,easeVarying:GC,end:jE,[Symbol.iterator]:lo[Symbol.iterator]};function SE(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var CE={time:null,delay:0,duration:250,ease:SE};function EE(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function kE(e){var t,n;e instanceof io?(t=e._id,e=e._name):(t=jy(),(n=CE).time=Gp(),e=e==null?null:e+"");for(var a=this._groups,i=a.length,l=0;l<i;++l)for(var u=a[l],d=u.length,m,v=0;v<d;++v)(m=u[v])&&pf(m,e,t,v,u,n||EE(m,t));return new io(a,this._parents,e,t)}Zu.prototype.interrupt=SC,Zu.prototype.transition=kE;const _f=e=>()=>e;function ME(e,{sourceEvent:t,target:n,transform:a,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:a,enumerable:!0,configurable:!0},_:{value:i}})}function co(e,t,n){this.k=e,this.x=t,this.y=n}co.prototype={constructor:co,scale:function(e){return e===1?this:new co(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new co(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var tl=new co(1,0,0);co.prototype;function ng(e){e.stopImmediatePropagation()}function cd(e){e.preventDefault(),e.stopImmediatePropagation()}function AE(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function OE(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Ny(){return this.__zoom||tl}function PE(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function TE(){return navigator.maxTouchPoints||"ontouchstart"in this}function $E(e,t,n){var a=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],l=e.invertY(t[0][1])-n[0][1],u=e.invertY(t[1][1])-n[1][1];return e.translate(i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i),u>l?(l+u)/2:Math.min(0,l)||Math.max(0,u))}function LE(){var e=AE,t=OE,n=$E,a=PE,i=TE,l=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],d=250,m=_C,v=Jm("start","zoom","end"),p,_,y,w=500,x=150,S=0,k=10;function M(D){D.property("__zoom",Ny).on("wheel.zoom",$,{passive:!1}).on("mousedown.zoom",q).on("dblclick.zoom",V).filter(i).on("touchstart.zoom",R).on("touchmove.zoom",ee).on("touchend.zoom touchcancel.zoom",le).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}M.transform=function(D,X,Y,K){var U=D.selection?D.selection():D;U.property("__zoom",Ny),D!==U?O(D,X,Y,K):U.interrupt().each(function(){A(this,arguments).event(K).start().zoom(null,typeof X=="function"?X.apply(this,arguments):X).end()})},M.scaleBy=function(D,X,Y,K){M.scaleTo(D,function(){var U=this.__zoom.k,te=typeof X=="function"?X.apply(this,arguments):X;return U*te},Y,K)},M.scaleTo=function(D,X,Y,K){M.transform(D,function(){var U=t.apply(this,arguments),te=this.__zoom,W=Y==null?j(U):typeof Y=="function"?Y.apply(this,arguments):Y,I=te.invert(W),Q=typeof X=="function"?X.apply(this,arguments):X;return n(T(P(te,Q),W,I),U,u)},Y,K)},M.translateBy=function(D,X,Y,K){M.transform(D,function(){return n(this.__zoom.translate(typeof X=="function"?X.apply(this,arguments):X,typeof Y=="function"?Y.apply(this,arguments):Y),t.apply(this,arguments),u)},null,K)},M.translateTo=function(D,X,Y,K,U){M.transform(D,function(){var te=t.apply(this,arguments),W=this.__zoom,I=K==null?j(te):typeof K=="function"?K.apply(this,arguments):K;return n(tl.translate(I[0],I[1]).scale(W.k).translate(typeof X=="function"?-X.apply(this,arguments):-X,typeof Y=="function"?-Y.apply(this,arguments):-Y),te,u)},K,U)};function P(D,X){return X=Math.max(l[0],Math.min(l[1],X)),X===D.k?D:new co(X,D.x,D.y)}function T(D,X,Y){var K=X[0]-Y[0]*D.k,U=X[1]-Y[1]*D.k;return K===D.x&&U===D.y?D:new co(D.k,K,U)}function j(D){return[(+D[0][0]+ +D[1][0])/2,(+D[0][1]+ +D[1][1])/2]}function O(D,X,Y,K){D.on("start.zoom",function(){A(this,arguments).event(K).start()}).on("interrupt.zoom end.zoom",function(){A(this,arguments).event(K).end()}).tween("zoom",function(){var U=this,te=arguments,W=A(U,te).event(K),I=t.apply(U,te),Q=Y==null?j(I):typeof Y=="function"?Y.apply(U,te):Y,me=Math.max(I[1][0]-I[0][0],I[1][1]-I[0][1]),J=U.__zoom,H=typeof X=="function"?X.apply(U,te):X,Z=m(J.invert(Q).concat(me/J.k),H.invert(Q).concat(me/H.k));return function(ne){if(ne===1)ne=H;else{var fe=Z(ne),ae=me/fe[2];ne=new co(ae,Q[0]-fe[0]*ae,Q[1]-fe[1]*ae)}W.zoom(null,ne)}})}function A(D,X,Y){return!Y&&D.__zooming||new z(D,X)}function z(D,X){this.that=D,this.args=X,this.active=0,this.sourceEvent=null,this.extent=t.apply(D,X),this.taps=0}z.prototype={event:function(D){return D&&(this.sourceEvent=D),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(D,X){return this.mouse&&D!=="mouse"&&(this.mouse[1]=X.invert(this.mouse[0])),this.touch0&&D!=="touch"&&(this.touch0[1]=X.invert(this.touch0[0])),this.touch1&&D!=="touch"&&(this.touch1[1]=X.invert(this.touch1[0])),this.that.__zoom=X,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(D){var X=ca(this.that).datum();v.call(D,this.that,new ME(D,{sourceEvent:this.sourceEvent,target:M,transform:this.that.__zoom,dispatch:v}),X)}};function $(D,...X){if(!e.apply(this,arguments))return;var Y=A(this,X).event(D),K=this.__zoom,U=Math.max(l[0],Math.min(l[1],K.k*Math.pow(2,a.apply(this,arguments)))),te=$a(D);if(Y.wheel)(Y.mouse[0][0]!==te[0]||Y.mouse[0][1]!==te[1])&&(Y.mouse[1]=K.invert(Y.mouse[0]=te)),clearTimeout(Y.wheel);else{if(K.k===U)return;Y.mouse=[te,K.invert(te)],gf(this),Y.start()}cd(D),Y.wheel=setTimeout(W,x),Y.zoom("mouse",n(T(P(K,U),Y.mouse[0],Y.mouse[1]),Y.extent,u));function W(){Y.wheel=null,Y.end()}}function q(D,...X){if(y||!e.apply(this,arguments))return;var Y=D.currentTarget,K=A(this,X,!0).event(D),U=ca(D.view).on("mousemove.zoom",Q,!0).on("mouseup.zoom",me,!0),te=$a(D,Y),W=D.clientX,I=D.clientY;Yv(D.view),ng(D),K.mouse=[te,this.__zoom.invert(te)],gf(this),K.start();function Q(J){if(cd(J),!K.moved){var H=J.clientX-W,Z=J.clientY-I;K.moved=H*H+Z*Z>S}K.event(J).zoom("mouse",n(T(K.that.__zoom,K.mouse[0]=$a(J,Y),K.mouse[1]),K.extent,u))}function me(J){U.on("mousemove.zoom mouseup.zoom",null),Qv(J.view,K.moved),cd(J),K.event(J).end()}}function V(D,...X){if(e.apply(this,arguments)){var Y=this.__zoom,K=$a(D.changedTouches?D.changedTouches[0]:D,this),U=Y.invert(K),te=Y.k*(D.shiftKey?.5:2),W=n(T(P(Y,te),K,U),t.apply(this,X),u);cd(D),d>0?ca(this).transition().duration(d).call(O,W,K,D):ca(this).call(M.transform,W,K,D)}}function R(D,...X){if(e.apply(this,arguments)){var Y=D.touches,K=Y.length,U=A(this,X,D.changedTouches.length===K).event(D),te,W,I,Q;for(ng(D),W=0;W<K;++W)I=Y[W],Q=$a(I,this),Q=[Q,this.__zoom.invert(Q),I.identifier],U.touch0?!U.touch1&&U.touch0[2]!==Q[2]&&(U.touch1=Q,U.taps=0):(U.touch0=Q,te=!0,U.taps=1+!!p);p&&(p=clearTimeout(p)),te&&(U.taps<2&&(_=Q[0],p=setTimeout(function(){p=null},w)),gf(this),U.start())}}function ee(D,...X){if(this.__zooming){var Y=A(this,X).event(D),K=D.changedTouches,U=K.length,te,W,I,Q;for(cd(D),te=0;te<U;++te)W=K[te],I=$a(W,this),Y.touch0&&Y.touch0[2]===W.identifier?Y.touch0[0]=I:Y.touch1&&Y.touch1[2]===W.identifier&&(Y.touch1[0]=I);if(W=Y.that.__zoom,Y.touch1){var me=Y.touch0[0],J=Y.touch0[1],H=Y.touch1[0],Z=Y.touch1[1],ne=(ne=H[0]-me[0])*ne+(ne=H[1]-me[1])*ne,fe=(fe=Z[0]-J[0])*fe+(fe=Z[1]-J[1])*fe;W=P(W,Math.sqrt(ne/fe)),I=[(me[0]+H[0])/2,(me[1]+H[1])/2],Q=[(J[0]+Z[0])/2,(J[1]+Z[1])/2]}else if(Y.touch0)I=Y.touch0[0],Q=Y.touch0[1];else return;Y.zoom("touch",n(T(W,I,Q),Y.extent,u))}}function le(D,...X){if(this.__zooming){var Y=A(this,X).event(D),K=D.changedTouches,U=K.length,te,W;for(ng(D),y&&clearTimeout(y),y=setTimeout(function(){y=null},w),te=0;te<U;++te)W=K[te],Y.touch0&&Y.touch0[2]===W.identifier?delete Y.touch0:Y.touch1&&Y.touch1[2]===W.identifier&&delete Y.touch1;if(Y.touch1&&!Y.touch0&&(Y.touch0=Y.touch1,delete Y.touch1),Y.touch0)Y.touch0[1]=this.__zoom.invert(Y.touch0[0]);else if(Y.end(),Y.taps===2&&(W=$a(W,this),Math.hypot(_[0]-W[0],_[1]-W[1])<k)){var I=ca(this).on("dblclick.zoom");I&&I.apply(this,arguments)}}}return M.wheelDelta=function(D){return arguments.length?(a=typeof D=="function"?D:_f(+D),M):a},M.filter=function(D){return arguments.length?(e=typeof D=="function"?D:_f(!!D),M):e},M.touchable=function(D){return arguments.length?(i=typeof D=="function"?D:_f(!!D),M):i},M.extent=function(D){return arguments.length?(t=typeof D=="function"?D:_f([[+D[0][0],+D[0][1]],[+D[1][0],+D[1][1]]]),M):t},M.scaleExtent=function(D){return arguments.length?(l[0]=+D[0],l[1]=+D[1],M):[l[0],l[1]]},M.translateExtent=function(D){return arguments.length?(u[0][0]=+D[0][0],u[1][0]=+D[1][0],u[0][1]=+D[0][1],u[1][1]=+D[1][1],M):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},M.constrain=function(D){return arguments.length?(n=D,M):n},M.duration=function(D){return arguments.length?(d=+D,M):d},M.interpolate=function(D){return arguments.length?(m=D,M):m},M.on=function(){var D=v.on.apply(v,arguments);return D===v?M:D},M.clickDistance=function(D){return arguments.length?(S=(D=+D)*D,M):Math.sqrt(S)},M.tapDistance=function(D){return arguments.length?(k=+D,M):k},M}function Qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sg(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Sy(e,t){if(e){if(typeof e=="string")return sg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sg(e,t)}}function DE(e){if(Array.isArray(e))return e}function zE(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var a=[],i=!0,l=!1,u,d;try{for(n=n.call(e);!(i=(u=n.next()).done)&&(a.push(u.value),!(t&&a.length===t));i=!0);}catch(m){l=!0,d=m}finally{try{!i&&n.return!=null&&n.return()}finally{if(l)throw d}}return a}}function RE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ut(e,t){return DE(e)||zE(e,t)||Sy(e,t)||RE()}var nl;(function(e){e.Strict="strict",e.Loose="loose"})(nl||(nl={}));var xc;(function(e){e.Lines="lines",e.Dots="dots"})(xc||(xc={}));var wc;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(wc||(wc={}));var Go;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Go||(Go={}));var vf;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(vf||(vf={}));var Xe;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Xe||(Xe={}));var rg=function(t){return{width:t.offsetWidth,height:t.offsetHeight}},jc=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(Math.max(t,n),a)},Cy=function(t,n){return{x:jc(t.x,n[0][0],n[1][0]),y:jc(t.y,n[0][1],n[1][1])}},Ey=function(t){var n,a;return((n=t.getRootNode)===null||n===void 0?void 0:n.call(t))||((a=window)===null||a===void 0?void 0:a.document)},FE=function(t,n){return{x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x2,n.x2),y2:Math.max(t.y2,n.y2)}},yf=function(t){var n=t.x,a=t.y,i=t.width,l=t.height;return{x:n,y:a,x2:n+i,y2:a+l}},IE=function(t){var n=t.x,a=t.y,i=t.x2,l=t.y2;return{x:n,y:a,width:i-n,height:l-a}},ky=function(t){return!isNaN(t)&&isFinite(t)},Ns=Symbol("internals");function My(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function ud(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?My(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):My(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Ay(e,t){var n=e.find(function(v){return v.id===t.parentNode});if(n){var a=t.position.x+t.width-n.width,i=t.position.y+t.height-n.height;if(a>0||i>0||t.position.x<0||t.position.y<0){var l,u;if(n.style=ud({},n.style)||{},n.style.width=(l=n.style.width)!==null&&l!==void 0?l:n.width,n.style.height=(u=n.style.height)!==null&&u!==void 0?u:n.height,a>0&&(n.style.width+=a),i>0&&(n.style.height+=i),t.position.x<0){var d=Math.abs(t.position.x);n.position.x=n.position.x-d,n.style.width+=d,t.position.x=0}if(t.position.y<0){var m=Math.abs(t.position.y);n.position.y=n.position.y-m,n.style.height+=m,t.position.y=0}n.width=n.style.width,n.height=n.style.height}}}function Oy(e,t){if(e.some(function(a){return a.type==="reset"}))return e.filter(function(a){return a.type==="reset"}).map(function(a){return a.item});var n=e.filter(function(a){return a.type==="add"}).map(function(a){return a.item});return t.reduce(function(a,i){var l=e.find(function(m){return m.id===i.id});if(l)switch(l.type){case"select":return a.push(ud(ud({},i),{},{selected:l.selected})),a;case"position":{var u=ud({},i);return typeof l.position<"u"&&(u.position=l.position),typeof l.positionAbsolute<"u"&&(u.positionAbsolute=l.positionAbsolute),typeof l.dragging<"u"&&(u.dragging=l.dragging),u.expandParent&&Ay(a,u),a.push(u),a}case"dimensions":{var d=ud({},i);return typeof l.dimensions<"u"&&(d.width=l.dimensions.width,d.height=l.dimensions.height),d.expandParent&&Ay(a,d),a.push(d),a}case"remove":return a}return a.push(i),a},n)}function Py(e,t){return Oy(e,t)}function BE(e,t){return Oy(e,t)}var Xo=function(t,n){return{id:t,type:"select",selected:n}};function Nc(e,t){return e.reduce(function(n,a){var i=t.includes(a.id);return!a.selected&&i?(a.selected=!0,n.push(Xo(a.id,!0))):a.selected&&!i&&(a.selected=!1,n.push(Xo(a.id,!1))),n},[])}function Ty(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function $y(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ty(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ty(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var Ly=function(t,n,a){var i=n.querySelectorAll(t);if(!i||!i.length)return null;var l=Array.from(i),u=n.getBoundingClientRect();return l.map(function(d){var m=d.getBoundingClientRect();return $y({id:d.getAttribute("data-handleid"),position:d.getAttribute("data-handlepos"),x:(m.left-u.left)/a,y:(m.top-u.top)/a},rg(d))})};function dd(e,t,n){return n===void 0?n:function(a){var i=t().nodeInternals.get(e);n(a,$y({},i))}}function Dy(e){var t=e.id,n=e.store,a=n.getState(),i=a.addSelectedNodes,l=a.unselectNodesAndEdges,u=a.multiSelectionActive,d=a.nodeInternals,m=d.get(t);n.setState({nodesSelectionActive:!1}),m.selected?m.selected&&u&&l({nodes:[m]}):i([t])}function zy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function md(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zy(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zy(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var UE=function(t){return"id"in t&&"source"in t&&"target"in t},qE=function(t){var n=t.source,a=t.sourceHandle,i=t.target,l=t.targetHandle;return"reactflow__edge-".concat(n).concat(a||"","-").concat(i).concat(l||"")},ag=function(t,n){if(typeof t>"u")return"";if(typeof t=="string")return t;var a=n?"".concat(n,"__"):"";return"".concat(a).concat(Object.keys(t).sort().map(function(i){return"".concat(i,"=").concat(t[i])}).join("&"))},HE=function(t,n){return n.some(function(a){return a.source===t.source&&a.target===t.target&&(a.sourceHandle===t.sourceHandle||!a.sourceHandle&&!t.sourceHandle)&&(a.targetHandle===t.targetHandle||!a.targetHandle&&!t.targetHandle)})},Ry=function(t,n){if(!t.source||!t.target)return n;var a;return UE(t)?a=md({},t):a=md(md({},t),{},{id:qE(t)}),HE(a,n)?n:n.concat(a)},Fy=function(t,n,a,i){var l=t.x,u=t.y,d=Ut(n,3),m=d[0],v=d[1],p=d[2],_=Ut(i,2),y=_[0],w=_[1],x={x:(l-m)/p,y:(u-v)/p};return a?{x:y*Math.round(x.x/y),y:w*Math.round(x.y/w)}:x},og=function(t){if(t.length===0)return{x:0,y:0,width:0,height:0};var n=t.reduce(function(a,i){var l=i.positionAbsolute,u=i.position,d=i.width,m=i.height;return FE(a,yf({x:l?l.x:u.x,y:l?l.y:u.y,width:d||0,height:m||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return IE(n)},Iy=function(t,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,1],i=Ut(a,3),l=i[0],u=i[1],d=i[2],m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,p=yf({x:(n.x-l)/d,y:(n.y-u)/d,width:n.width/d,height:n.height/d}),_=[];return t.forEach(function(y){var w=y.positionAbsolute,x=y.width,S=y.height,k=y.selectable,M=k===void 0?!0:k;if(v&&!M)return!1;var P=yf(md(md({},w),{},{width:x||0,height:S||0})),T=Math.max(0,Math.min(p.x2,P.x2)-Math.max(p.x,P.x)),j=Math.max(0,Math.min(p.y2,P.y2)-Math.max(p.y,P.y)),O=Math.ceil(T*j),A=typeof x>"u"||typeof S>"u"||x===null||S===null,z=m&&O>0,$=(x||0)*(S||0),q=A||z||O>=$;q&&_.push(y)}),_},By=function(t,n){var a=t.map(function(i){return i.id});return n.filter(function(i){return a.includes(i.source)||a.includes(i.target)})},Uy=function(t,n,a,i,l){var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:.1,d=n/(t.width*(1+u)),m=a/(t.height*(1+u)),v=Math.min(d,m),p=jc(v,i,l),_=t.x+t.width/2,y=t.y+t.height/2,w=n/2-_*p,x=a/2-y*p;return[w,x,p]},sl=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.transition().duration(n)};function qy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function Sc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qy(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qy(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Hy(e,t,n,a){var i,l,u,d,m,v,p,_,y,w,x,S;if(!e.parentNode)return a;var k=t.get(e.parentNode);return Hy(k,t,n,{x:((i=a.x)!==null&&i!==void 0?i:0)+((l=(u=k.position)===null||u===void 0?void 0:u.x)!==null&&l!==void 0?l:0),y:((d=a.y)!==null&&d!==void 0?d:0)+((m=(v=k.position)===null||v===void 0?void 0:v.y)!==null&&m!==void 0?m:0),z:((p=(_=k[Ns])===null||_===void 0?void 0:_.z)!==null&&p!==void 0?p:0)>((y=a.z)!==null&&y!==void 0?y:0)?(w=(x=k[Ns])===null||x===void 0?void 0:x.z)!==null&&w!==void 0?w:0:(S=a.z)!==null&&S!==void 0?S:0})}function ig(e,t){var n=new Map,a={};return e.forEach(function(i){var l,u=ky(i.zIndex)?i.zIndex:i.selected?1e3:0,d=t.get(i.id),m=Sc(Sc({width:d==null?void 0:d.width,height:d==null?void 0:d.height},i),{},{positionAbsolute:{x:i.position.x,y:i.position.y}});i.parentNode&&(m.parentNode=i.parentNode,a[i.parentNode]=!0),Object.defineProperty(m,Ns,{enumerable:!1,value:{handleBounds:d==null||(l=d[Ns])===null||l===void 0?void 0:l.handleBounds,z:u}}),n.set(i.id,m)}),n.forEach(function(i){if(i.parentNode&&!n.has(i.parentNode))throw new Error("Parent node ".concat(i.parentNode," not found"));if(i.parentNode||a[i.id]){var l,u,d=Hy(i,n,a,Sc(Sc({},i.position),{},{z:(l=(u=i[Ns])===null||u===void 0?void 0:u.z)!==null&&l!==void 0?l:0})),m=d.x,v=d.y,p=d.z;i.positionAbsolute={x:m,y:v},i[Ns].z=p,a[i.id]&&(i[Ns].isParent=!0)}}),n}function Vy(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e(),a=n.nodeInternals,i=n.width,l=n.height,u=n.minZoom,d=n.maxZoom,m=n.d3Zoom,v=n.d3Selection,p=n.fitViewOnInitDone,_=n.fitViewOnInit;if((t.initial&&!p&&_||!t.initial)&&m&&v){var y=Array.from(a.values()).filter(function($){return t.includeHiddenNodes?$.width&&$.height:!$.hidden}),w=y.every(function($){return $.width&&$.height});if(y.length>0&&w){var x,S,k,M=og(y),P=Uy(M,i,l,(x=t.minZoom)!==null&&x!==void 0?x:u,(S=t.maxZoom)!==null&&S!==void 0?S:d,(k=t.padding)!==null&&k!==void 0?k:.1),T=Ut(P,3),j=T[0],O=T[1],A=T[2],z=tl.translate(j,O).scale(A);return typeof t.duration=="number"&&t.duration>0?m.transform(sl(v,t.duration),z):m.transform(v,z),!0}}return!1}function VE(e,t){return e.forEach(function(n){var a=t.get(n.id);if(a){var i;t.set(a.id,Sc(Sc({},a),{},(i={},Qt(i,Ns,a[Ns]),Qt(i,"selected",n.selected),i)))}}),new Map(t)}function WE(e,t){return t.map(function(n){var a=e.find(function(i){return i.id===n.id});return a&&(n.selected=a.selected),n})}function bf(e){var t=e.changedNodes,n=e.changedEdges,a=e.get,i=e.set,l=a(),u=l.nodeInternals,d=l.edges,m=l.onNodesChange,v=l.onEdgesChange,p=l.hasDefaultNodes,_=l.hasDefaultEdges;t!=null&&t.length&&(p&&i({nodeInternals:VE(t,u)}),m==null||m(t)),n!=null&&n.length&&(_&&i({edges:WE(n,d)}),v==null||v(n))}var lg=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Wy={width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:lg,nodeExtent:lg,nodesSelectionActive:!1,userSelectionActive:!1,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionMode:nl.Strict,domNode:null,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,multiSelectionActive:!1,reactFlowVersion:"10.3.17",connectionStartHandle:null,connectOnClick:!0};function Ky(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function za(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ky(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ky(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var cg=sN(),Yy=cg.Provider,Qn=cg.useStore,Ls=cg.useStoreApi,Qy=function(){return nN(function(t,n){return za(za({},Wy),{},{setNodes:function(i){t({nodeInternals:ig(i,n().nodeInternals)})},setEdges:function(i){var l=n(),u=l.defaultEdgeOptions,d=u===void 0?{}:u;t({edges:i.map(function(m){return za(za({},d),m)})})},setDefaultNodesAndEdges:function(i,l){var u=typeof i<"u",d=typeof l<"u",m=u?ig(i,new Map):new Map,v=d?l:[];t({nodeInternals:m,edges:v,hasDefaultNodes:u,hasDefaultEdges:d})},updateNodeDimensions:function(i){var l=n(),u=l.onNodesChange,d=l.nodeInternals,m=l.fitViewOnInit,v=l.fitViewOnInitDone,p=l.fitViewOnInitOptions,_=l.domNode,y=_==null?void 0:_.querySelector(".react-flow__viewport");if(y){var w=window.getComputedStyle(y),x=new window.DOMMatrixReadOnly(w.transform),S=x.m22,k=i.reduce(function(P,T){var j=d.get(T.id);if(j){var O=rg(T.nodeElement),A=!!(O.width&&O.height&&(j.width!==O.width||j.height!==O.height||T.forceUpdate));A&&(d.set(j.id,za(za({},j),{},Qt({},Ns,za(za({},j[Ns]),{},{handleBounds:{source:Ly(".source",T.nodeElement,S),target:Ly(".target",T.nodeElement,S)}})),O)),P.push({id:j.id,type:"dimensions",dimensions:O}))}return P},[]),M=v||m&&!v&&Vy(n,za({initial:!0},p));t({nodeInternals:new Map(d),fitViewOnInitDone:M}),(k==null?void 0:k.length)>0&&(u==null||u(k))}},updateNodePositions:function(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=n(),m=d.onNodesChange,v=d.nodeInternals,p=d.hasDefaultNodes;if(p||m){var _=i.map(function(x){var S={id:x.id,type:"position",dragging:u};return l&&(S.positionAbsolute=x.positionAbsolute,S.position=x.position),S});if(_!=null&&_.length){if(p){var y=Py(_,Array.from(v.values())),w=ig(y,v);t({nodeInternals:w})}m==null||m(_)}}},addSelectedNodes:function(i){var l=n(),u=l.multiSelectionActive,d=l.nodeInternals,m=l.edges,v,p=null;u?v=i.map(function(_){return Xo(_,!0)}):(v=Nc(Array.from(d.values()),i),p=Nc(m,[])),bf({changedNodes:v,changedEdges:p,get:n,set:t})},addSelectedEdges:function(i){var l=n(),u=l.multiSelectionActive,d=l.edges,m=l.nodeInternals,v,p=null;u?v=i.map(function(_){return Xo(_,!0)}):(v=Nc(d,i),p=Nc(Array.from(m.values()),[])),bf({changedNodes:p,changedEdges:v,get:n,set:t})},unselectNodesAndEdges:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=i.nodes,u=i.edges,d=n(),m=d.nodeInternals,v=d.edges,p=l||Array.from(m.values()),_=u||v,y=p.map(function(x){return x.selected=!1,Xo(x.id,!1)}),w=_.map(function(x){return Xo(x.id,!1)});bf({changedNodes:y,changedEdges:w,get:n,set:t})},setMinZoom:function(i){var l=n(),u=l.d3Zoom,d=l.maxZoom;u==null||u.scaleExtent([i,d]),t({minZoom:i})},setMaxZoom:function(i){var l=n(),u=l.d3Zoom,d=l.minZoom;u==null||u.scaleExtent([d,i]),t({maxZoom:i})},setTranslateExtent:function(i){var l=n(),u=l.d3Zoom;u==null||u.translateExtent(i),t({translateExtent:i})},resetSelectedElements:function(){var i=n(),l=i.nodeInternals,u=i.edges,d=Array.from(l.values()),m=d.filter(function(p){return p.selected}).map(function(p){return Xo(p.id,!1)}),v=u.filter(function(p){return p.selected}).map(function(p){return Xo(p.id,!1)});bf({changedNodes:m,changedEdges:v,get:n,set:t})},setNodeExtent:function(i){var l=n(),u=l.nodeInternals;u.forEach(function(d){d.positionAbsolute=Cy(d.position,i)}),t({nodeExtent:i,nodeInternals:new Map(u)})},reset:function(){return t(za({},Wy))}})})};function Pr(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,a;n<e.length;n++)(a=Pr(e[n]))!==""&&(t+=(t&&" ")+a);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}function Tr(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let a=0;a<n.length;a++)if(!Object.prototype.hasOwnProperty.call(t,n[a])||!Object.is(e[n[a]],t[n[a]]))return!1;return!0}function KE(e){if(Array.isArray(e))return sg(e)}function YE(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function QE(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rl(e){return KE(e)||YE(e)||Sy(e)||QE()}var GE={zoomIn:function(){},zoomOut:function(){},zoomTo:function(t){},getZoom:function(){return 1},setViewport:function(t){},getViewport:function(){return{x:0,y:0,zoom:1}},fitView:function(){},setCenter:function(t,n){},fitBounds:function(t){},project:function(t){return t},viewportInitialized:!1},XE=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection}},JE=function(){var t=Ls(),n=Qn(XE,Tr),a=n.d3Zoom,i=n.d3Selection,l=f.useMemo(function(){return i&&a?{zoomIn:function(d){return a.scaleBy(sl(i,d==null?void 0:d.duration),1.2)},zoomOut:function(d){return a.scaleBy(sl(i,d==null?void 0:d.duration),1/1.2)},zoomTo:function(d,m){return a.scaleTo(sl(i,m==null?void 0:m.duration),d)},getZoom:function(){return t.getState().transform[2]},setViewport:function(d,m){var v,p,_,y=Ut(t.getState().transform,3),w=y[0],x=y[1],S=y[2],k=tl.translate((v=d.x)!==null&&v!==void 0?v:w,(p=d.y)!==null&&p!==void 0?p:x).scale((_=d.zoom)!==null&&_!==void 0?_:S);a.transform(sl(i,m==null?void 0:m.duration),k)},getViewport:function(){var d=Ut(t.getState().transform,3),m=d[0],v=d[1],p=d[2];return{x:m,y:v,zoom:p}},fitView:function(d){return Vy(t.getState,d)},setCenter:function(d,m,v){var p=t.getState(),_=p.width,y=p.height,w=p.maxZoom,x=typeof(v==null?void 0:v.zoom)<"u"?v.zoom:w,S=_/2-d*x,k=y/2-m*x,M=tl.translate(S,k).scale(x);a.transform(sl(i,v==null?void 0:v.duration),M)},fitBounds:function(d,m){var v,p=t.getState(),_=p.width,y=p.height,w=p.minZoom,x=p.maxZoom,S=Uy(d,_,y,w,x,(v=m==null?void 0:m.padding)!==null&&v!==void 0?v:.1),k=Ut(S,3),M=k[0],P=k[1],T=k[2],j=tl.translate(M,P).scale(T);a.transform(sl(i,m==null?void 0:m.duration),j)},project:function(d){var m=t.getState(),v=m.transform,p=m.snapToGrid,_=m.snapGrid;return Fy(d,v,p,_)},viewportInitialized:!0}:GE},[a,i]);return l};function Gy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function Cc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Gy(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gy(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function ug(){var e=JE(),t=Ls(),n=f.useCallback(function(){var _=t.getState(),y=_.nodeInternals,w=Array.from(y.values());return w.map(function(x){return Cc({},x)})},[]),a=f.useCallback(function(_){var y=t.getState(),w=y.nodeInternals;return w.get(_)},[]),i=f.useCallback(function(){var _=t.getState(),y=_.edges,w=y===void 0?[]:y;return w.map(function(x){return Cc({},x)})},[]),l=f.useCallback(function(_){var y=t.getState(),w=y.edges,x=w===void 0?[]:w;return x.find(function(S){return S.id===_})},[]),u=f.useCallback(function(_){var y=t.getState(),w=y.nodeInternals,x=y.setNodes,S=y.hasDefaultNodes,k=y.onNodesChange,M=Array.from(w.values()),P=typeof _=="function"?_(M):_;if(S)x(P);else if(k){var T=P.length===0?M.map(function(j){return{type:"remove",id:j.id}}):P.map(function(j){return{item:j,type:"reset"}});k(T)}},[]),d=f.useCallback(function(_){var y=t.getState(),w=y.edges,x=w===void 0?[]:w,S=y.setEdges,k=y.hasDefaultEdges,M=y.onEdgesChange,P=typeof _=="function"?_(x):_;if(k)S(P);else if(M){var T=P.length===0?x.map(function(j){return{type:"remove",id:j.id}}):P.map(function(j){return{item:j,type:"reset"}});M(T)}},[]),m=f.useCallback(function(_){var y=Array.isArray(_)?_:[_],w=t.getState(),x=w.nodeInternals,S=w.setNodes,k=w.hasDefaultNodes,M=w.onNodesChange;if(k){var P=Array.from(x.values()),T=[].concat(P,rl(y));S(T)}else if(M){var j=y.map(function(O){return{item:O,type:"add"}});M(j)}},[]),v=f.useCallback(function(_){var y=Array.isArray(_)?_:[_],w=t.getState(),x=w.edges,S=x===void 0?[]:x,k=w.setEdges,M=w.hasDefaultEdges,P=w.onEdgesChange;if(M)k([].concat(rl(S),rl(y)));else if(P){var T=y.map(function(j){return{item:j,type:"add"}});P(T)}},[]),p=f.useCallback(function(){var _=t.getState(),y=_.nodeInternals,w=_.edges,x=w===void 0?[]:w,S=_.transform,k=Array.from(y.values()),M=Ut(S,3),P=M[0],T=M[1],j=M[2];return{nodes:k.map(function(O){return Cc({},O)}),edges:x.map(function(O){return Cc({},O)}),viewport:{x:P,y:T,zoom:j}}},[]);return f.useMemo(function(){return Cc(Cc({},e),{},{getNodes:n,getNode:a,getEdges:i,getEdge:l,setNodes:u,setEdges:d,addNodes:m,addEdges:v,toObject:p})},[e,n,a,i,l,u,d,m,v,p])}function ZE(e,t){if(e==null)return{};var n={},a=Object.keys(e),i,l;for(l=0;l<a.length;l++)i=a[l],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}function xf(e,t){if(e==null)return{};var n=ZE(e,t),a,i;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)a=l[i],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ek(){return Oe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Oe.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function tk(){return Oe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Oe.createElement("path",{d:"M0 0h32v4.2H0z"}))}function nk(){return Oe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Oe.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function sk(){return Oe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Oe.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function rk(){return Oe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Oe.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}var ak=["children","className"];function Xy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function ok(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xy(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xy(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var wf=function(t){var n=t.children,a=t.className,i=xf(t,ak);return Oe.createElement("button",ok({type:"button",className:Pr(["react-flow__controls-button",a])},i),n)},ik=function(t){return t.nodesDraggable&&t.nodesConnectable&&t.elementsSelectable},Jy=function(t){var n=t.style,a=t.showZoom,i=a===void 0?!0:a,l=t.showFitView,u=l===void 0?!0:l,d=t.showInteractive,m=d===void 0?!0:d,v=t.fitViewOptions,p=t.onZoomIn,_=t.onZoomOut,y=t.onFitView,w=t.onInteractiveChange,x=t.className,S=t.children,k=Ls(),M=f.useState(!1),P=Ut(M,2),T=P[0],j=P[1],O=Qn(ik),A=ug(),z=A.zoomIn,$=A.zoomOut,q=A.fitView;if(f.useEffect(function(){j(!0)},[]),!T)return null;var V=function(){z==null||z(),p==null||p()},R=function(){$==null||$(),_==null||_()},ee=function(){q==null||q(v),y==null||y()},le=function(){k.setState({nodesDraggable:!O,nodesConnectable:!O,elementsSelectable:!O}),w==null||w(!O)};return Oe.createElement("div",{className:Pr(["react-flow__controls",x]),style:n},i&&Oe.createElement(Oe.Fragment,null,Oe.createElement(wf,{onClick:V,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in"},Oe.createElement(ek,null)),Oe.createElement(wf,{onClick:R,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out"},Oe.createElement(tk,null))),u&&Oe.createElement(wf,{className:"react-flow__controls-fitview",onClick:ee,title:"fit view","aria-label":"fit view"},Oe.createElement(nk,null)),m&&Oe.createElement(wf,{className:"react-flow__controls-interactive",onClick:le,title:"toggle interactivity","aria-label":"toggle interactivity"},O?Oe.createElement(rk,null):Oe.createElement(sk,null)),S)};Jy.displayName="Controls";var lk=f.memo(Jy),ck=function(t,n,a){return Oe.createElement("path",{stroke:a,strokeWidth:n,d:"M".concat(t/2," 0 V").concat(t," M0 ").concat(t/2," H").concat(t)})},uk=function(t,n){return Oe.createElement("circle",{cx:t,cy:t,r:t,fill:n})},jf;function Zy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function eb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Zy(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zy(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var dk=(jf={},Qt(jf,xc.Dots,"#81818a"),Qt(jf,xc.Lines,"#eee"),jf),mk=function(t){return t.transform},tb=function(t){var n=t.variant,a=n===void 0?xc.Dots:n,i=t.gap,l=i===void 0?15:i,u=t.size,d=u===void 0?.4:u,m=t.color,v=t.style,p=t.className,_=f.useRef(null),y=f.useState(null),w=Ut(y,2),x=w[0],S=w[1],k=Qn(mk),M=Ut(k,3),P=M[0],T=M[1],j=M[2];f.useEffect(function(){var R=document.querySelectorAll(".react-flow__background"),ee=Array.from(R).findIndex(function(le){return le===_.current});S("pattern-".concat(ee))},[]);var O=l*j||1,A=P%O,z=T%O,$=a===xc.Lines,q=m||dk[a],V=$?ck(O,d,q):uk(d*j,q);return Oe.createElement("svg",{className:Pr(["react-flow__background","react-flow__container",p]),style:eb(eb({},v),{},{width:"100%",height:"100%"}),ref:_},x&&Oe.createElement(Oe.Fragment,null,Oe.createElement("pattern",{id:x,x:A,y:z,width:O,height:O,patternUnits:"userSpaceOnUse"},V),Oe.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#".concat(x,")")})))};tb.displayName="Background";var fk=f.memo(tb),hk=function(t){return t.updateNodeDimensions};function pk(){var e=Ls(),t=Qn(hk);return f.useCallback(function(n){var a,i=(a=e.getState().domNode)===null||a===void 0?void 0:a.querySelector('.react-flow__node[data-id="'.concat(n,'"]'));i&&requestAnimationFrame(function(){return t([{id:n,nodeElement:i,forceUpdate:!0}])})},[])}var gk=["paid-pro","paid-sponsor","paid-enterprise","paid-custom"];function _k(e){var t=e.proOptions,n=e.position,a=n===void 0?"bottom-right":n;if(t!=null&&t.account&&gk.includes(t==null?void 0:t.account)&&t!==null&&t!==void 0&&t.hideAttribution)return null;var i="".concat(a).split("-");return Oe.createElement("div",{className:Pr(["react-flow__attribution"].concat(rl(i))),"data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev/pricing"},Oe.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer"},"React Flow"))}var vk=["x","y","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","children","className"];function nb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function yk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var bk=function(t){var n=t.x,a=t.y,i=t.label,l=t.labelStyle,u=l===void 0?{}:l,d=t.labelShowBg,m=d===void 0?!0:d,v=t.labelBgStyle,p=v===void 0?{}:v,_=t.labelBgPadding,y=_===void 0?[2,4]:_,w=t.labelBgBorderRadius,x=w===void 0?2:w,S=t.children,k=t.className,M=xf(t,vk),P=f.useRef(null),T=f.useState({x:0,y:0,width:0,height:0}),j=Ut(T,2),O=j[0],A=j[1],z=Pr(["react-flow__edge-textwrapper",k]);return f.useEffect(function(){if(P.current){var $=P.current.getBBox();A({x:$.x,y:$.y,width:$.width,height:$.height})}},[i]),typeof i>"u"||!i?null:Oe.createElement("g",yk({transform:"translate(".concat(n-O.width/2," ").concat(a-O.height/2,")"),className:z},M),m&&Oe.createElement("rect",{width:O.width+2*y[0],x:-y[0],y:-y[1],height:O.height+2*y[1],className:"react-flow__edge-textbg",style:p,rx:x,ry:x}),Oe.createElement("text",{className:"react-flow__edge-text",y:O.height/2,dy:"0.3em",ref:P,style:u},i),S)},xk=f.memo(bk),Nf=function(e){var t=e.path,n=e.centerX,a=e.centerY,i=e.label,l=e.labelStyle,u=e.labelShowBg,d=e.labelBgStyle,m=e.labelBgPadding,v=e.labelBgBorderRadius,p=e.style,_=e.markerEnd,y=e.markerStart,w=i?Oe.createElement(xk,{x:n,y:a,label:i,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:m,labelBgBorderRadius:v}):null;return Oe.createElement(Oe.Fragment,null,Oe.createElement("path",{style:p,d:t,className:"react-flow__edge-path",markerEnd:_,markerStart:y}),w)};function Sf(e){var t=e.pos,n=e.x1,a=e.y1,i=e.x2,l=e.y2,u,d;switch(t){case Xe.Left:case Xe.Right:u=.5*(n+i),d=a;break;case Xe.Top:case Xe.Bottom:u=n,d=.5*(a+l);break}return[u,d]}function sb(e){var t=e.sourceX,n=e.sourceY,a=e.sourcePosition,i=a===void 0?Xe.Bottom:a,l=e.targetX,u=e.targetY,d=e.targetPosition,m=d===void 0?Xe.Top:d,v=Sf({pos:i,x1:t,y1:n,x2:l,y2:u}),p=Ut(v,2),_=p[0],y=p[1],w=Sf({pos:m,x1:l,y1:u,x2:t,y2:n}),x=Ut(w,2),S=x[0],k=x[1];return"M".concat(t,",").concat(n," C").concat(_,",").concat(y," ").concat(S,",").concat(k," ").concat(l,",").concat(u)}function wk(e){var t=e.sourceX,n=e.sourceY,a=e.sourcePosition,i=a===void 0?Xe.Bottom:a,l=e.targetX,u=e.targetY,d=e.targetPosition,m=d===void 0?Xe.Top:d,v=Sf({pos:i,x1:t,y1:n,x2:l,y2:u}),p=Ut(v,2),_=p[0],y=p[1],w=Sf({pos:m,x1:l,y1:u,x2:t,y2:n}),x=Ut(w,2),S=x[0],k=x[1],M=t*.125+_*.375+S*.375+l*.125,P=n*.125+y*.375+k*.375+u*.125,T=Math.abs(M-t),j=Math.abs(P-n);return[M,P,T,j]}var rb=f.memo(function(e){var t=e.sourceX,n=e.sourceY,a=e.targetX,i=e.targetY,l=e.sourcePosition,u=l===void 0?Xe.Bottom:l,d=e.targetPosition,m=d===void 0?Xe.Top:d,v=e.label,p=e.labelStyle,_=e.labelShowBg,y=e.labelBgStyle,w=e.labelBgPadding,x=e.labelBgBorderRadius,S=e.style,k=e.markerEnd,M=e.markerStart,P={sourceX:t,sourceY:n,sourcePosition:u,targetX:a,targetY:i,targetPosition:m},T=sb(P),j=wk(P),O=Ut(j,2),A=O[0],z=O[1];return Oe.createElement(Nf,{path:T,centerX:A,centerY:z,label:v,labelStyle:p,labelShowBg:_,labelBgStyle:y,labelBgPadding:w,labelBgBorderRadius:x,style:S,markerEnd:k,markerStart:M})});function ab(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function jk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ab(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ab(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var ob=[Xe.Left,Xe.Right],ib=function(t){var n=t.sourceX,a=t.sourceY,i=t.targetX,l=t.targetY,u=t.sourcePosition,d=u===void 0?Xe.Bottom:u,m=t.targetPosition,v=m===void 0?Xe.Top:m,p=ob.includes(d),_=ob.includes(v),y=p&&!_||_&&!p;if(y){var w=p?Math.abs(i-n):0,x=n>i?n-w:n+w,S=p?0:Math.abs(l-a),k=a<l?a+S:a-S;return[x,k,w,S]}var M=Math.abs(i-n)/2,P=i<n?i+M:i-M,T=Math.abs(l-a)/2,j=l<a?l+T:l-T;return[P,j,M,T]};function fd(e,t,n){return n===void 0?n:function(a){var i=t().edges.find(function(l){return l.id===e});n(a,jk({},i))}}var dg=function(t,n,a){return"L ".concat(t,",").concat(n-a,"Q ").concat(t,",").concat(n," ").concat(t+a,",").concat(n)},mg=function(t,n,a){return"L ".concat(t+a,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n-a)},fg=function(t,n,a){return"L ".concat(t,",").concat(n-a,"Q ").concat(t,",").concat(n," ").concat(t-a,",").concat(n)},hg=function(t,n,a){return"L ".concat(t-a,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n-a)},pg=function(t,n,a){return"L ".concat(t+a,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n+a)},gg=function(t,n,a){return"L ".concat(t,",").concat(n+a,"Q ").concat(t,",").concat(n," ").concat(t+a,",").concat(n)},_g=function(t,n,a){return"L ".concat(t,",").concat(n+a,"Q ").concat(t,",").concat(n," ").concat(t-a,",").concat(n)},vg=function(t,n,a){return"L ".concat(t-a,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n+a)};function yg(e){var t=e.sourceX,n=e.sourceY,a=e.sourcePosition,i=a===void 0?Xe.Bottom:a,l=e.targetX,u=e.targetY,d=e.targetPosition,m=d===void 0?Xe.Top:d,v=e.borderRadius,p=v===void 0?5:v,_=e.centerX,y=e.centerY,w=ib({sourceX:t,sourceY:n,targetX:l,targetY:u}),x=Ut(w,4),S=x[0],k=x[1],M=x[2],P=x[3],T=Math.min(p,Math.abs(l-t)),j=Math.min(p,Math.abs(u-n)),O=Math.min(T,j,M,P),A=[Xe.Left,Xe.Right],z=typeof _<"u"?_:S,$=typeof y<"u"?y:k,q=null,V=null;return t<=l?(q=n<=u?dg(t,$,O):gg(t,$,O),V=n<=u?vg(l,$,O):hg(l,$,O)):(q=n<u?fg(t,$,O):_g(t,$,O),V=n<u?pg(l,$,O):mg(l,$,O)),A.includes(i)&&A.includes(m)?t<=l?(q=n<=u?vg(z,n,O):hg(z,n,O),V=n<=u?dg(z,u,O):gg(z,u,O)):(i===Xe.Right&&m===Xe.Left||i===Xe.Left&&m===Xe.Right||i===Xe.Left&&m===Xe.Left)&&(q=n<=u?pg(z,n,O):mg(z,n,O),V=n<=u?fg(z,u,O):_g(z,u,O)):A.includes(i)&&!A.includes(m)?(t<=l?q=n<=u?vg(l,n,O):hg(l,n,O):q=n<=u?pg(l,n,O):mg(l,n,O),V=""):!A.includes(i)&&A.includes(m)&&(t<=l?q=n<=u?dg(t,u,O):gg(t,u,O):q=n<=u?fg(t,u,O):_g(t,u,O),V=""),"M ".concat(t,",").concat(n).concat(q).concat(V,"L ").concat(l,",").concat(u)}var bg=f.memo(function(e){var t=e.sourceX,n=e.sourceY,a=e.targetX,i=e.targetY,l=e.label,u=e.labelStyle,d=e.labelShowBg,m=e.labelBgStyle,v=e.labelBgPadding,p=e.labelBgBorderRadius,_=e.style,y=e.sourcePosition,w=y===void 0?Xe.Bottom:y,x=e.targetPosition,S=x===void 0?Xe.Top:x,k=e.markerEnd,M=e.markerStart,P=e.borderRadius,T=P===void 0?5:P,j=ib({sourceX:t,sourceY:n,targetX:a,targetY:i,sourcePosition:w,targetPosition:S}),O=Ut(j,2),A=O[0],z=O[1],$=yg({sourceX:t,sourceY:n,sourcePosition:w,targetX:a,targetY:i,targetPosition:S,borderRadius:T});return Oe.createElement(Nf,{path:$,centerX:A,centerY:z,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:m,labelBgPadding:v,labelBgBorderRadius:p,style:_,markerEnd:k,markerStart:M})});function lb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function cb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var ub=f.memo(function(e){return Oe.createElement(bg,cb(cb({},e),{},{borderRadius:0}))}),db=f.memo(function(e){var t=e.sourceX,n=e.sourceY,a=e.targetX,i=e.targetY,l=e.label,u=e.labelStyle,d=e.labelShowBg,m=e.labelBgStyle,v=e.labelBgPadding,p=e.labelBgBorderRadius,_=e.style,y=e.markerEnd,w=e.markerStart,x=Math.abs(i-n)/2,S=i<n?i+x:i-x,k=Math.abs(a-t)/2,M=a<t?a+k:a-k,P="M ".concat(t,",").concat(n,"L ").concat(a,",").concat(i);return Oe.createElement(Nf,{path:P,centerX:M,centerY:S,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:m,labelBgPadding:v,labelBgBorderRadius:p,style:_,markerEnd:y,markerStart:w})});function Cf(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function Ef(e){var t=e.pos,n=e.x1,a=e.y1,i=e.x2,l=e.y2,u=e.c,d,m;switch(t){case Xe.Left:d=n-Cf(n-i,u),m=a;break;case Xe.Right:d=n+Cf(i-n,u),m=a;break;case Xe.Top:d=n,m=a-Cf(a-l,u);break;case Xe.Bottom:d=n,m=a+Cf(l-a,u);break}return[d,m]}function mb(e){var t=e.sourceX,n=e.sourceY,a=e.sourcePosition,i=a===void 0?Xe.Bottom:a,l=e.targetX,u=e.targetY,d=e.targetPosition,m=d===void 0?Xe.Top:d,v=e.curvature,p=v===void 0?.25:v,_=Ef({pos:i,x1:t,y1:n,x2:l,y2:u,c:p}),y=Ut(_,2),w=y[0],x=y[1],S=Ef({pos:m,x1:l,y1:u,x2:t,y2:n,c:p}),k=Ut(S,2),M=k[0],P=k[1];return"M".concat(t,",").concat(n," C").concat(w,",").concat(x," ").concat(M,",").concat(P," ").concat(l,",").concat(u)}function Nk(e){var t=e.sourceX,n=e.sourceY,a=e.sourcePosition,i=a===void 0?Xe.Bottom:a,l=e.targetX,u=e.targetY,d=e.targetPosition,m=d===void 0?Xe.Top:d,v=e.curvature,p=v===void 0?.25:v,_=Ef({pos:i,x1:t,y1:n,x2:l,y2:u,c:p}),y=Ut(_,2),w=y[0],x=y[1],S=Ef({pos:m,x1:l,y1:u,x2:t,y2:n,c:p}),k=Ut(S,2),M=k[0],P=k[1],T=t*.125+w*.375+M*.375+l*.125,j=n*.125+x*.375+P*.375+u*.125,O=Math.abs(T-t),A=Math.abs(j-n);return[T,j,O,A]}var xg=f.memo(function(e){var t=e.sourceX,n=e.sourceY,a=e.targetX,i=e.targetY,l=e.sourcePosition,u=l===void 0?Xe.Bottom:l,d=e.targetPosition,m=d===void 0?Xe.Top:d,v=e.label,p=e.labelStyle,_=e.labelShowBg,y=e.labelBgStyle,w=e.labelBgPadding,x=e.labelBgBorderRadius,S=e.style,k=e.markerEnd,M=e.markerStart,P=e.curvature,T={sourceX:t,sourceY:n,sourcePosition:u,targetX:a,targetY:i,targetPosition:m,curvature:P},j=mb(T),O=Nk(T),A=Ut(O,2),z=A[0],$=A[1];return Oe.createElement(Nf,{path:j,centerX:z,centerY:$,label:v,labelStyle:p,labelShowBg:_,labelBgStyle:y,labelBgPadding:w,labelBgBorderRadius:x,style:S,markerEnd:k,markerStart:M})}),wg=f.createContext(null),Sk=wg.Provider;wg.Consumer;function jg(e,t,n,a,i,l,u){var d=u.elementFromPoint(e.clientX,e.clientY),m=(d==null?void 0:d.classList.contains("target"))||!1,v=(d==null?void 0:d.classList.contains("source"))||!1,p={elementBelow:d,isValid:!1,connection:{source:null,target:null,sourceHandle:null,targetHandle:null},isHoveringHandle:!1};if(d&&(m||v)){p.isHoveringHandle=!0;var _=d.getAttribute("data-nodeid"),y=d.getAttribute("data-handleid"),w=n?{source:_,sourceHandle:y,target:a,targetHandle:i}:{source:a,sourceHandle:i,target:_,targetHandle:y};p.connection=w;var x=t===nl.Strict?n&&v||!n&&m:!0;x&&(p.isValid=l(w))}return p}function Ng(e){e==null||e.classList.remove("react-flow__handle-valid"),e==null||e.classList.remove("react-flow__handle-connecting")}function fb(e){var t=e.event,n=e.handleId,a=e.nodeId,i=e.onConnect,l=e.isTarget,u=e.getState,d=e.setState,m=e.isValidConnection,v=e.elementEdgeUpdaterType,p=e.onEdgeUpdateEnd,_=t.target.closest(".react-flow"),y=Ey(t.target);if(!y)return;var w=y.elementFromPoint(t.clientX,t.clientY),x=w==null?void 0:w.classList.contains("target"),S=w==null?void 0:w.classList.contains("source");if(!_||!x&&!S&&!v)return;var k=u(),M=k.onConnectStart,P=k.connectionMode,T=v||(x?"target":"source"),j=_.getBoundingClientRect(),O;d({connectionPosition:{x:t.clientX-j.left,y:t.clientY-j.top},connectionNodeId:a,connectionHandleId:n,connectionHandleType:T}),M==null||M(t,{nodeId:a,handleId:n,handleType:T});function A($){d({connectionPosition:{x:$.clientX-j.left,y:$.clientY-j.top}});var q=jg($,P,l,a,n,m,y),V=q.connection,R=q.elementBelow,ee=q.isValid,le=q.isHoveringHandle;if(!le)return Ng(O);V.source!==V.target&&R&&(Ng(O),O=R,R.classList.add("react-flow__handle-connecting"),R.classList.toggle("react-flow__handle-valid",ee))}function z($){var q=u(),V=q.onConnectStop,R=q.onConnectEnd,ee=jg($,P,l,a,n,m,y),le=ee.connection,D=ee.isValid;V==null||V($),D&&(i==null||i(le)),R==null||R($),v&&p&&p($),Ng(O),d({connectionNodeId:null,connectionHandleId:null,connectionHandleType:null}),y.removeEventListener("mousemove",A),y.removeEventListener("mouseup",z)}y.addEventListener("mousemove",A),y.addEventListener("mouseup",z)}var Ck=["type","position","isValidConnection","isConnectable","id","onConnect","children","className","onMouseDown"];function hb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function Sg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var Ek=function(){return!0},kk=function(t){return{connectionStartHandle:t.connectionStartHandle,connectOnClick:t.connectOnClick}},pb=f.forwardRef(function(e,t){var n=e.type,a=n===void 0?"source":n,i=e.position,l=i===void 0?Xe.Top:i,u=e.isValidConnection,d=u===void 0?Ek:u,m=e.isConnectable,v=m===void 0?!0:m,p=e.id,_=e.onConnect,y=e.children,w=e.className,x=e.onMouseDown,S=xf(e,Ck),k=Ls(),M=f.useContext(wg),P=Qn(kk,Tr),T=P.connectionStartHandle,j=P.connectOnClick,O=p||null,A=a==="target",z=function(R){var ee=k.getState(),le=ee.defaultEdgeOptions,D=ee.onConnect,X=ee.hasDefaultEdges,Y=Sg(Sg({},le),R);if(X){var K=k.getState(),U=K.edges;k.setState({edges:Ry(Y,U)})}D==null||D(Y),_==null||_(Y)},$=function(R){R.button===0&&fb({event:R,handleId:O,nodeId:M,onConnect:z,isTarget:A,getState:k.getState,setState:k.setState,isValidConnection:d}),x==null||x(R)},q=function(R){var ee=k.getState(),le=ee.onClickConnectStart,D=ee.onClickConnectStop,X=ee.onClickConnectEnd,Y=ee.connectionMode;if(!T){le==null||le(R,{nodeId:M,handleId:O,handleType:a}),k.setState({connectionStartHandle:{nodeId:M,type:a,handleId:O}});return}var K=Ey(R.target),U=jg(R,Y,T.type==="target",T.nodeId,T.handleId||null,d,K),te=U.connection,W=U.isValid;D==null||D(R),W&&z(te),X==null||X(R),k.setState({connectionStartHandle:null})};return Oe.createElement("div",Sg({"data-handleid":O,"data-nodeid":M,"data-handlepos":l,className:Pr(["react-flow__handle","react-flow__handle-".concat(l),"nodrag",w,{source:!A,target:A,connectable:v,connecting:(T==null?void 0:T.nodeId)===M&&(T==null?void 0:T.handleId)===O&&(T==null?void 0:T.type)===a}]),onMouseDown:$,onClick:j?q:void 0,ref:t},S),y)});pb.displayName="Handle";var hd=f.memo(pb),gb=function(t){var n=t.data,a=t.isConnectable,i=t.targetPosition,l=i===void 0?Xe.Top:i,u=t.sourcePosition,d=u===void 0?Xe.Bottom:u;return Oe.createElement(Oe.Fragment,null,Oe.createElement(hd,{type:"target",position:l,isConnectable:a}),n==null?void 0:n.label,Oe.createElement(hd,{type:"source",position:d,isConnectable:a}))};gb.displayName="DefaultNode";var Cg=f.memo(gb),_b=function(t){var n=t.data,a=t.isConnectable,i=t.sourcePosition,l=i===void 0?Xe.Bottom:i;return Oe.createElement(Oe.Fragment,null,n==null?void 0:n.label,Oe.createElement(hd,{type:"source",position:l,isConnectable:a}))};_b.displayName="InputNode";var vb=f.memo(_b),yb=function(t){var n=t.data,a=t.isConnectable,i=t.targetPosition,l=i===void 0?Xe.Top:i;return Oe.createElement(Oe.Fragment,null,Oe.createElement(hd,{type:"target",position:l,isConnectable:a}),n==null?void 0:n.label)};yb.displayName="OutputNode";var bb=f.memo(yb),Mk=function(t){return{selectedNodes:Array.from(t.nodeInternals.values()).filter(function(n){return n.selected}),selectedEdges:t.edges.filter(function(n){return n.selected})}},Ak=function(t,n){var a=t.selectedNodes.map(function(d){return d.id}),i=n.selectedNodes.map(function(d){return d.id}),l=t.selectedEdges.map(function(d){return d.id}),u=n.selectedEdges.map(function(d){return d.id});return Tr(a,i)&&Tr(l,u)};function Ok(e){var t=e.onSelectionChange,n=Qn(Mk,Ak),a=n.selectedNodes,i=n.selectedEdges;return f.useEffect(function(){t({nodes:a,edges:i})},[a,i]),null}var Pk=f.memo(Ok),Tk=function(t){return{setNodes:t.setNodes,setEdges:t.setEdges,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset}};function Jo(e,t){f.useEffect(function(){typeof e<"u"&&t(e)},[e])}function yn(e,t,n){f.useEffect(function(){typeof t<"u"&&n(Qt({},e,t))},[t])}var $k=function(t){var n=t.nodes,a=t.edges,i=t.defaultNodes,l=t.defaultEdges,u=t.onConnect,d=t.onConnectStart,m=t.onConnectStop,v=t.onConnectEnd,p=t.onClickConnectStart,_=t.onClickConnectStop,y=t.onClickConnectEnd,w=t.nodesDraggable,x=t.nodesConnectable,S=t.minZoom,k=t.maxZoom,M=t.nodeExtent,P=t.onNodesChange,T=t.onEdgesChange,j=t.elementsSelectable,O=t.connectionMode,A=t.snapGrid,z=t.snapToGrid,$=t.translateExtent,q=t.connectOnClick,V=t.defaultEdgeOptions,R=t.fitView,ee=t.fitViewOptions,le=t.onNodesDelete,D=t.onEdgesDelete,X=t.onNodeDrag,Y=t.onNodeDragStart,K=t.onNodeDragStop,U=t.onSelectionDrag,te=t.onSelectionDragStart,W=t.onSelectionDragStop,I=Qn(Tk,Tr),Q=I.setNodes,me=I.setEdges,J=I.setDefaultNodesAndEdges,H=I.setMinZoom,Z=I.setMaxZoom,ne=I.setTranslateExtent,fe=I.setNodeExtent,ae=I.reset,pe=Ls();return f.useEffect(function(){return J(i,l),function(){ae()}},[]),yn("defaultEdgeOptions",V,pe.setState),yn("connectionMode",O,pe.setState),yn("onConnect",u,pe.setState),yn("onConnectStart",d,pe.setState),yn("onConnectStop",m,pe.setState),yn("onConnectEnd",v,pe.setState),yn("onClickConnectStart",p,pe.setState),yn("onClickConnectStop",_,pe.setState),yn("onClickConnectEnd",y,pe.setState),yn("nodesDraggable",w,pe.setState),yn("nodesConnectable",x,pe.setState),yn("elementsSelectable",j,pe.setState),yn("snapToGrid",z,pe.setState),yn("snapGrid",A,pe.setState),yn("onNodesChange",P,pe.setState),yn("onEdgesChange",T,pe.setState),yn("connectOnClick",q,pe.setState),yn("fitViewOnInit",R,pe.setState),yn("fitViewOnInitOptions",ee,pe.setState),yn("onNodesDelete",le,pe.setState),yn("onEdgesDelete",D,pe.setState),yn("onNodeDrag",X,pe.setState),yn("onNodeDragStart",Y,pe.setState),yn("onNodeDragStop",K,pe.setState),yn("onSelectionDrag",U,pe.setState),yn("onSelectionDragStart",te,pe.setState),yn("onSelectionDragStop",W,pe.setState),Jo(n,Q),Jo(a,me),Jo(i,Q),Jo(l,me),Jo(S,H),Jo(k,Z),Jo($,ne),Jo(M,fe),null},Lk=".react-flow{height:100%;overflow:hidden;position:relative;width:100%}.react-flow__container{height:100%;left:0;position:absolute;top:0;width:100%}.react-flow__pane{z-index:1}.react-flow__viewport{pointer-events:none;transform-origin:0 0;z-index:2}.react-flow__renderer{z-index:4}.react-flow__selectionpane{z-index:5}.react-flow .react-flow__edges{overflow:visible;pointer-events:none}.react-flow .react-flow__connectionline{z-index:1001}.react-flow__edge{pointer-events:visibleStroke}.react-flow__edge.inactive{pointer-events:none}@-webkit-keyframes dashdraw{0%{stroke-dashoffset:10}}@keyframes dashdraw{0%{stroke-dashoffset:10}}.react-flow__edge-path{fill:none}.react-flow__edge-textwrapper{pointer-events:all}.react-flow__edge-text{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__connection{pointer-events:none}.react-flow__connection .animated{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__connection-path{fill:none}.react-flow__nodes{pointer-events:none;transform-origin:0 0}.react-flow__node{box-sizing:border-box;pointer-events:all;position:absolute;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__nodesselection{pointer-events:none;transform-origin:left top;z-index:3}.react-flow__nodesselection-rect{cursor:-webkit-grab;cursor:grab;pointer-events:all;position:absolute}.react-flow__handle{pointer-events:none;position:absolute}.react-flow__handle.connectable{pointer-events:all}.react-flow__handle-bottom{bottom:-4px;left:50%;top:auto;transform:translate(-50%)}.react-flow__handle-top{left:50%;top:-4px;transform:translate(-50%)}.react-flow__handle-left{left:-4px;top:50%;transform:translateY(-50%)}.react-flow__handle-right{right:-4px;top:50%;transform:translateY(-50%)}.react-flow__edgeupdater{cursor:move;pointer-events:all}.react-flow__controls{bottom:20px;left:15px;position:absolute;z-index:5}.react-flow__controls-button{border:none;height:24px;width:24px}.react-flow__controls-button svg{width:100%}.react-flow__minimap{bottom:20px;position:absolute;right:15px;z-index:5}.react-flow__attribution{background:hsla(0,0%,100%,.5);color:#999;font-size:10px;padding:2px 3px;position:absolute;z-index:1000}.react-flow__attribution a{color:#555;text-decoration:none}.react-flow__attribution.top{top:0}.react-flow__attribution.bottom{bottom:0}.react-flow__attribution.left{left:0}.react-flow__attribution.right{right:0}.react-flow__attribution.center{left:50%;transform:translateX(-50%)}",Dk=Lk,zk=".react-flow__edge.selected .react-flow__edge-path{stroke:#555}.react-flow__edge.animated path{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__edge.updating .react-flow__edge-path{stroke:#777}.react-flow__edge-path{stroke:#b1b1b7;stroke-width:1}.react-flow__edge-text{font-size:10px}.react-flow__edge-textbg{fill:#fff}.react-flow__connection-path{stroke:#b1b1b7;stroke-width:1}.react-flow__node{cursor:-webkit-grab;cursor:grab}.react-flow__node-default,.react-flow__node-group,.react-flow__node-input,.react-flow__node-output{background:#fff;border:1px solid #1a192b;border-radius:3px;color:#222;font-size:12px;padding:10px;text-align:center;width:150px}.react-flow__node-default.selected,.react-flow__node-group.selected,.react-flow__node-input.selected,.react-flow__node-output.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-default .react-flow__handle,.react-flow__node-group .react-flow__handle,.react-flow__node-input .react-flow__handle,.react-flow__node-output .react-flow__handle{background:#1a192b}.react-flow__node-default.selectable:hover,.react-flow__node-group.selectable:hover,.react-flow__node-input.selectable:hover,.react-flow__node-output.selectable:hover{box-shadow:0 1px 4px 1px rgba(0,0,0,.08)}.react-flow__node-default.selectable.selected,.react-flow__node-group.selectable.selected,.react-flow__node-input.selectable.selected,.react-flow__node-output.selectable.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-group{background:hsla(0,0%,94%,.25);border-color:#1a192b}.react-flow__nodesselection-rect,.react-flow__selection{background:rgba(0,89,220,.08);border:1px dotted rgba(0,89,220,.8)}.react-flow__handle{background:#555;border:1px solid #fff;border-radius:100%;height:6px;width:6px}.react-flow__handle.connectable{cursor:crosshair}.react-flow__minimap{background-color:#fff}.react-flow__controls{box-shadow:0 0 2px 1px rgba(0,0,0,.08)}.react-flow__controls-button{align-items:center;background:#fefefe;border-bottom:1px solid #eee;box-sizing:content-box;cursor:pointer;display:flex;height:16px;justify-content:center;padding:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:16px}.react-flow__controls-button svg{max-height:12px;max-width:12px}.react-flow__controls-button:hover{background:#f4f4f4}",Rk=zk,Fk=function(t,n,a){return a===Xe.Left?t-n:a===Xe.Right?t+n:t},Ik=function(t,n,a){return a===Xe.Top?t-n:a===Xe.Bottom?t+n:t},xb=function(t){var n=t.className,a=t.position,i=t.centerX,l=t.centerY,u=t.radius,d=u===void 0?10:u;return Oe.createElement("circle",{className:Pr(["react-flow__edgeupdater",n]),cx:Fk(i,d,a),cy:Ik(l,d,a),r:d,stroke:"transparent",fill:"transparent"})},Ec=function(e){var t=function(a){var i=a.id,l=a.className,u=a.type,d=a.data,m=a.onClick,v=a.onEdgeDoubleClick,p=a.selected,_=a.animated,y=a.label,w=a.labelStyle,x=a.labelShowBg,S=a.labelBgStyle,k=a.labelBgPadding,M=a.labelBgBorderRadius,P=a.style,T=a.source,j=a.target,O=a.sourceX,A=a.sourceY,z=a.targetX,$=a.targetY,q=a.sourcePosition,V=a.targetPosition,R=a.elementsSelectable,ee=a.hidden,le=a.sourceHandleId,D=a.targetHandleId,X=a.onContextMenu,Y=a.onMouseEnter,K=a.onMouseMove,U=a.onMouseLeave,te=a.edgeUpdaterRadius,W=a.onEdgeUpdate,I=a.onEdgeUpdateStart,Q=a.onEdgeUpdateEnd,me=a.markerEnd,J=a.markerStart,H=a.rfId,Z=f.useState(!1),ne=Ut(Z,2),fe=ne[0],ae=ne[1],pe=Ls(),Ve=function(xe){var Se=pe.getState(),$e=Se.edges,Ye=Se.addSelectedEdges,Ue=$e.find(function(Ze){return Ze.id===i});R&&(pe.setState({nodesSelectionActive:!1}),Ye([i])),m==null||m(xe,Ue)},st=fd(i,pe.getState,v),Ke=fd(i,pe.getState,X),mt=fd(i,pe.getState,Y),yt=fd(i,pe.getState,K),Te=fd(i,pe.getState,U),at=function(xe,Se){var $e=Se?j:T,Ye=(Se?D:le)||null,Ue=Se?"target":"source",Ze=function(){return!0},Nt=Se,Et=pe.getState().edges.find(function(Pt){return Pt.id===i});I==null||I(xe,Et,Ue);var qt=Q?function(Pt){return Q(Pt,Et,Ue)}:void 0,Ht=function(pt){return W==null?void 0:W(Et,pt)};fb({event:xe,handleId:Ye,nodeId:$e,onConnect:Ht,isTarget:Nt,getState:pe.getState,setState:pe.setState,isValidConnection:Ze,elementEdgeUpdaterType:Ue,onEdgeUpdateEnd:qt})},it=function(xe){return at(xe,!0)},be=function(xe){return at(xe,!1)},Pe=function(){return ae(!0)},G=function(){return ae(!1)},ke=f.useMemo(function(){return"url(#".concat(ag(J,H),")")},[J,H]),Ae=f.useMemo(function(){return"url(#".concat(ag(me,H),")")},[me,H]);if(ee)return null;var Ge=!R&&!m,ft=typeof W<"u",zt=Pr(["react-flow__edge","react-flow__edge-".concat(u),l,{selected:p,animated:_,inactive:Ge,updating:fe}]);return Oe.createElement("g",{className:zt,onClick:Ve,onDoubleClick:st,onContextMenu:Ke,onMouseEnter:mt,onMouseMove:yt,onMouseLeave:Te},Oe.createElement(e,{id:i,source:T,target:j,selected:p,animated:_,label:y,labelStyle:w,labelShowBg:x,labelBgStyle:S,labelBgPadding:k,labelBgBorderRadius:M,data:d,style:P,sourceX:O,sourceY:A,targetX:z,targetY:$,sourcePosition:q,targetPosition:V,sourceHandleId:le,targetHandleId:D,markerStart:ke,markerEnd:Ae,"data-testid":"rf__edge-".concat(i)}),ft&&Oe.createElement("g",{onMouseDown:it,onMouseEnter:Pe,onMouseOut:G},Oe.createElement(xb,{position:q,centerX:O,centerY:A,radius:te})),ft&&Oe.createElement("g",{onMouseDown:be,onMouseEnter:Pe,onMouseOut:G},Oe.createElement(xb,{position:V,centerX:z,centerY:$,radius:te})))};return t.displayName="EdgeWrapper",f.memo(t)};function wb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function jb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Bk(e){var t={default:Ec(e.default||xg),straight:Ec(e.bezier||db),step:Ec(e.step||ub),smoothstep:Ec(e.step||bg),simplebezier:Ec(e.simplebezier||rb)},n={},a=Object.keys(e).filter(function(i){return!["default","bezier"].includes(i)}).reduce(function(i,l){return i[l]=Ec(e[l]||xg),i},n);return jb(jb({},t),a)}function Nb(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=((n==null?void 0:n.x)||0)+t.x,i=((n==null?void 0:n.y)||0)+t.y,l=(n==null?void 0:n.width)||t.width,u=(n==null?void 0:n.height)||t.height;switch(e){case Xe.Top:return{x:a+l/2,y:i};case Xe.Right:return{x:a+l,y:i+u/2};case Xe.Bottom:return{x:a+l/2,y:i+u};case Xe.Left:return{x:a,y:i+u/2}}}function Sb(e,t){if(!e)return null;var n=null;return e.length===1||!t?n=e[0]:t&&(n=e.find(function(a){return a.id===t})),typeof n>"u"?null:n}var Uk=function(t,n,a,i,l,u){var d=Nb(a,t,n),m=Nb(u,i,l);return{sourceX:d.x,sourceY:d.y,targetX:m.x,targetY:m.y}};function qk(e){var t=e.sourcePos,n=e.targetPos,a=e.sourceWidth,i=e.sourceHeight,l=e.targetWidth,u=e.targetHeight,d=e.width,m=e.height,v=e.transform,p={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x+a,n.x+l),y2:Math.max(t.y+i,n.y+u)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);var _=yf({x:(0-v[0])/v[2],y:(0-v[1])/v[2],width:d/v[2],height:m/v[2]}),y=Math.max(0,Math.min(_.x2,p.x2)-Math.max(_.x,p.x)),w=Math.max(0,Math.min(_.y2,p.y2)-Math.max(_.y,p.y)),x=Math.ceil(y*w);return x>0}function Cb(e,t){var n,a,i,l,u,d=e.get(t),m=(d==null||(n=d[Ns])===null||n===void 0?void 0:n.handleBounds)||null,v=!d||!m||!d.width||!d.height||typeof((a=d.positionAbsolute)===null||a===void 0?void 0:a.x)>"u"||typeof((i=d.positionAbsolute)===null||i===void 0?void 0:i.y)>"u";return[{x:(d==null||(l=d.positionAbsolute)===null||l===void 0?void 0:l.x)||0,y:(d==null||(u=d.positionAbsolute)===null||u===void 0?void 0:u.y)||0,width:(d==null?void 0:d.width)||0,height:(d==null?void 0:d.height)||0},m,!v]}var Hk=typeof document<"u"?document:null,kf=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:Hk},n=f.useState(!1),a=Ut(n,2),i=a[0],l=a[1],u=f.useRef(new Set([])),d=f.useMemo(function(){if(e!==null){var _=Array.isArray(e)?e:[e],y=_.filter(function(x){return typeof x=="string"}).map(function(x){return x.split("+")}),w=y.reduce(function(x,S){return x.concat.apply(x,rl(S))},[]);return[y,w]}return[[],[]]},[e]),m=Ut(d,2),v=m[0],p=m[1];return f.useEffect(function(){if(e!==null){var _,y,w=function(M){if(Mb(M))return!1;var P=kb(M.code,p);u.current.add(M[P]),Eb(v,u.current,!1)&&(M.preventDefault(),l(!0))},x=function(M){if(Mb(M))return!1;var P=kb(M.code,p);Eb(v,u.current,!0)?(l(!1),u.current.clear()):u.current.delete(M[P])},S=function(){u.current.clear(),l(!1)};return t==null||(_=t.target)===null||_===void 0||_.addEventListener("keydown",w),t==null||(y=t.target)===null||y===void 0||y.addEventListener("keyup",x),window.addEventListener("blur",S),function(){var k,M;t==null||(k=t.target)===null||k===void 0||k.removeEventListener("keydown",w),t==null||(M=t.target)===null||M===void 0||M.removeEventListener("keyup",x),window.removeEventListener("blur",S)}}},[e,l]),i};function Eb(e,t,n){return e.filter(function(a){return n||a.length===t.size}).some(function(a){return a.every(function(i){return t.has(i)})})}function kb(e,t){return t.includes(e)?"code":"key"}function Mb(e){var t,n=((t=e.composedPath)===null||t===void 0?void 0:t.call(e)[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n==null?void 0:n.nodeName)||(n==null?void 0:n.hasAttribute("contenteditable"))}var Vk=function(t){return{onNodesChange:t.onNodesChange,onEdgesChange:t.onEdgesChange}},Wk=function(e){var t=e.deleteKeyCode,n=e.multiSelectionKeyCode,a=Ls(),i=Qn(Vk,Tr),l=i.onNodesChange,u=i.onEdgesChange,d=kf(t),m=kf(n);f.useEffect(function(){var v=a.getState(),p=v.nodeInternals,_=v.edges,y=v.hasDefaultNodes,w=v.hasDefaultEdges,x=v.onNodesDelete,S=v.onEdgesDelete,k=Array.from(p.values()),M=k.reduce(function($,q){return(!q.selected&&q.parentNode&&$.find(function(V){return V.id===q.parentNode})||q.selected)&&$.push(q),$},[]),P=_.filter(function($){return $.selected});if(d&&(M||P)){var T=By(M,_),j=[].concat(rl(P),rl(T)),O=j.reduce(function($,q){return $.includes(q.id)||$.push(q.id),$},[]);if((w||y)&&(w&&a.setState({edges:_.filter(function($){return!O.includes($.id)})}),y&&(M.forEach(function($){p.delete($.id)}),a.setState({nodeInternals:new Map(p)}))),O.length>0&&(S==null||S(j),u)){var A=O.map(function($){return{id:$,type:"remove"}});u(A)}if(M.length>0&&(x==null||x(M),l)){var z=M.map(function($){return{id:$.id,type:"remove"}});l(z)}a.setState({nodesSelectionActive:!1})}},[d,l,u]),f.useEffect(function(){a.setState({multiSelectionActive:m})},[m])};function Kk(e){var t=Ls();f.useEffect(function(){var n,a=function(){if(e.current){var l=rg(e.current);t.setState({width:l.width||500,height:l.height||500})}};return a(),window.onresize=a,e.current&&(n=new ResizeObserver(function(){return a()}),n.observe(e.current)),function(){window.onresize=null,n&&e.current&&n.unobserve(e.current)}},[])}var Yk=function(t,n){return t.x!==n.x||t.y!==n.y||t.zoom!==n.k},Eg=function(t){return{x:t.x,y:t.y,zoom:t.k}},Mf=function(t,n){return t.target.closest(".".concat(n))},Qk=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection,d3ZoomHandler:t.d3ZoomHandler}},Gk=function(t){var n=t.onMove,a=t.onMoveStart,i=t.onMoveEnd,l=t.zoomOnScroll,u=l===void 0?!0:l,d=t.zoomOnPinch,m=d===void 0?!0:d,v=t.panOnScroll,p=v===void 0?!1:v,_=t.panOnScrollSpeed,y=_===void 0?.5:_,w=t.panOnScrollMode,x=w===void 0?wc.Free:w,S=t.zoomOnDoubleClick,k=S===void 0?!0:S,M=t.selectionKeyPressed,P=t.elementsSelectable,T=t.panOnDrag,j=T===void 0?!0:T,O=t.translateExtent,A=t.minZoom,z=t.maxZoom,$=t.defaultZoom,q=$===void 0?1:$,V=t.defaultPosition,R=V===void 0?[0,0]:V,ee=t.zoomActivationKeyCode,le=t.preventScrolling,D=le===void 0?!0:le,X=t.children,Y=t.noWheelClassName,K=t.noPanClassName,U=Ls(),te=f.useRef(!1),W=f.useRef(null),I=f.useRef({x:0,y:0,zoom:0}),Q=Qn(Qk,Tr),me=Q.d3Zoom,J=Q.d3Selection,H=Q.d3ZoomHandler,Z=kf(ee);return Kk(W),f.useEffect(function(){if(W.current){var ne,fe=LE().scaleExtent([A,z]).translateExtent(O),ae=ca(W.current).call(fe),pe=jc(R[0],O[0][0],O[1][0]),Ve=jc(R[1],O[0][1],O[1][1]),st=jc(q,A,z),Ke=tl.translate(pe,Ve).scale(st);fe.transform(ae,Ke),U.setState({d3Zoom:fe,d3Selection:ae,d3ZoomHandler:ae.on("wheel.zoom"),transform:[pe,Ve,st],domNode:(ne=ae.node())===null||ne===void 0?void 0:ne.closest(".react-flow")})}},[]),f.useEffect(function(){J&&me&&(p&&!Z?J.on("wheel",function(ne){if(Mf(ne,Y))return!1;ne.preventDefault(),ne.stopImmediatePropagation();var fe=J.property("__zoom").k||1;if(ne.ctrlKey&&m){var ae=$a(ne),pe=-ne.deltaY*(ne.deltaMode===1?.05:ne.deltaMode?1:.002)*10,Ve=fe*Math.pow(2,pe);me.scaleTo(J,Ve,ae);return}var st=ne.deltaMode===1?20:1,Ke=x===wc.Vertical?0:ne.deltaX*st,mt=x===wc.Horizontal?0:ne.deltaY*st;me.translateBy(J,-(Ke/fe)*y,-(mt/fe)*y)}).on("wheel.zoom",null):typeof H<"u"&&J.on("wheel",function(ne){if(!D||Mf(ne,Y))return null;ne.preventDefault()}).on("wheel.zoom",H))},[p,x,J,me,H,Z,m,D,Y]),f.useEffect(function(){me&&(M&&!te.current?me.on("zoom",null):M||me.on("zoom",function(ne){if(U.setState({transform:[ne.transform.x,ne.transform.y,ne.transform.k]}),n){var fe=Eg(ne.transform);n(ne.sourceEvent,fe)}}))},[M,me,n]),f.useEffect(function(){me&&me.on("start",function(ne){if(te.current=!0,a){var fe=Eg(ne.transform);I.current=fe,a(ne.sourceEvent,fe)}})},[me,a]),f.useEffect(function(){me&&me.on("end",function(ne){if(te.current=!1,i&&Yk(I.current,ne.transform)){var fe=Eg(ne.transform);I.current=fe,i(ne.sourceEvent,fe)}})},[me,i]),f.useEffect(function(){me&&me.filter(function(ne){var fe=Z||u,ae=m&&ne.ctrlKey;return!j&&!fe&&!p&&!k&&!m||M||!k&&ne.type==="dblclick"||Mf(ne,Y)&&ne.type==="wheel"||Mf(ne,K)&&ne.type!=="wheel"||!m&&ne.ctrlKey&&ne.type==="wheel"||!fe&&!p&&!ae&&ne.type==="wheel"||!j&&(ne.type==="mousedown"||ne.type==="touchstart")?!1:(!ne.ctrlKey||ne.type==="wheel")&&!ne.button})},[me,u,m,p,k,j,M,P,Z]),Oe.createElement("div",{className:"react-flow__renderer react-flow__container",ref:W},X)};function Ab(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function Ob(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ab(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ab(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Pb(e,t){return{x:e.clientX-t.left,y:e.clientY-t.top}}var Xk=function(t){return{userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable}},Tb={startX:0,startY:0,x:0,y:0,width:0,height:0,draw:!1},Jk=f.memo(function(e){var t=e.selectionKeyPressed,n=Ls(),a=f.useRef(0),i=f.useRef(0),l=f.useRef(),u=f.useState(Tb),d=Ut(u,2),m=d[0],v=d[1],p=Qn(Xk,Tr),_=p.userSelectionActive,y=p.elementsSelectable,w=_||t;if(!y||!w)return null;var x=function(){v(Tb),n.setState({userSelectionActive:!1}),a.current=0,i.current=0},S=function(j){var O=j.target.closest(".react-flow");l.current=O.getBoundingClientRect();var A=Pb(j,l.current);v({width:0,height:0,startX:A.x,startY:A.y,x:A.x,y:A.y,draw:!0}),n.setState({userSelectionActive:!0,nodesSelectionActive:!1})},k=function(j){var O,A;if(!(!t||!m.draw||!l.current)){var z=Pb(j,l.current),$=(O=m.startX)!==null&&O!==void 0?O:0,q=(A=m.startY)!==null&&A!==void 0?A:0,V=Ob(Ob({},m),{},{x:z.x<$?z.x:$,y:z.y<q?z.y:q,width:Math.abs(z.x-$),height:Math.abs(z.y-q)}),R=n.getState(),ee=R.nodeInternals,le=R.edges,D=R.transform,X=R.onNodesChange,Y=R.onEdgesChange,K=Array.from(ee.values()),U=Iy(ee,V,D,!1,!0),te=By(U,le).map(function(me){return me.id}),W=U.map(function(me){return me.id});if(a.current!==W.length){a.current=W.length;var I=Nc(K,W);I.length&&(X==null||X(I))}if(i.current!==te.length){i.current=te.length;var Q=Nc(le,te);Q.length&&(Y==null||Y(Q))}v(V)}},M=function(){n.setState({nodesSelectionActive:a.current>0}),x()},P=function(){n.setState({nodesSelectionActive:!1}),x()};return Oe.createElement("div",{className:"react-flow__selectionpane react-flow__container",onMouseDown:S,onMouseMove:k,onMouseUp:M,onMouseLeave:P},m.draw&&Oe.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:m.width,height:m.height,transform:"translate(".concat(m.x,"px, ").concat(m.y,"px)")}}))});function $b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function Lb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$b(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$b(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Db(e,t){if(!e.parentNode)return!1;var n=t.get(e.parentNode);return n?n.selected?!0:Db(n,t):!1}function zb(e,t,n){var a=e;do{var i;if((i=a)!==null&&i!==void 0&&i.matches(t))return!0;if(a===n.current)return!1;a=a.parentElement}while(a);return!1}function Zk(e,t,n){return Array.from(e.values()).filter(function(a){return(a.selected||a.id===n)&&(!a.parentNode||!Db(a,e))}).map(function(a){var i,l,u,d;return{id:a.id,position:a.position||{x:0,y:0},positionAbsolute:a.positionAbsolute||{x:0,y:0},distance:{x:t.x-((i=(l=a.positionAbsolute)===null||l===void 0?void 0:l.x)!==null&&i!==void 0?i:0),y:t.y-((u=(d=a.positionAbsolute)===null||d===void 0?void 0:d.y)!==null&&u!==void 0?u:0)},delta:{x:0,y:0},extent:a.extent,parentNode:a.parentNode,width:a.width,height:a.height}})}function e1(e,t,n,a,i,l){var u=Ut(a,2),d=u[0],m=u[1],v=e.extent||l,p={x:t.x-e.distance.x,y:t.y-e.distance.y};if(n&&(p.x=d*Math.round(p.x/d),p.y=m*Math.round(p.y/m)),e.extent==="parent")if(e.parentNode&&e.width&&e.height){var _=i.get(e.parentNode);v=_!=null&&_.positionAbsolute&&_!==null&&_!==void 0&&_.width&&_!==null&&_!==void 0&&_.height?[[_.positionAbsolute.x,_.positionAbsolute.y],[_.positionAbsolute.x+_.width-e.width,_.positionAbsolute.y+_.height-e.height]]:v}else v=l;else if(e.extent&&e.parentNode){var y,w,x,S,k=i.get(e.parentNode),M=(y=k==null||(w=k.positionAbsolute)===null||w===void 0?void 0:w.x)!==null&&y!==void 0?y:0,P=(x=k==null||(S=k.positionAbsolute)===null||S===void 0?void 0:S.y)!==null&&x!==void 0?x:0;v=[[e.extent[0][0]+M,e.extent[0][1]+P],[e.extent[1][0]+M,e.extent[1][1]+P]]}var T={x:0,y:0};if(e.parentNode){var j,O,A,z,$=i.get(e.parentNode);T={x:(j=$==null||(O=$.positionAbsolute)===null||O===void 0?void 0:O.x)!==null&&j!==void 0?j:0,y:(A=$==null||(z=$.positionAbsolute)===null||z===void 0?void 0:z.y)!==null&&A!==void 0?A:0}}return e.positionAbsolute=v?Cy(p,v):p,e.position={x:e.positionAbsolute.x-T.x,y:e.positionAbsolute.y-T.y},e}function kg(e){var t=e.nodeId,n=e.dragItems,a=e.nodeInternals,i=n.map(function(l){var u=a.get(l.id);return Lb(Lb({},u),{},{position:l.position,positionAbsolute:l.positionAbsolute})});return[t?i.find(function(l){return l.id===t}):i[0],i]}function Mg(e){return function(t,n,a){return e==null?void 0:e(t,a)}}function Rb(e){var t=e.nodeRef,n=e.disabled,a=n===void 0?!1:n,i=e.noDragClassName,l=e.handleSelector,u=e.nodeId,d=e.isSelectable,m=e.selectNodesOnDrag,v=f.useState(!1),p=Ut(v,2),_=p[0],y=p[1],w=Ls(),x=f.useRef(),S=f.useRef({x:null,y:null}),k=f.useCallback(function(M){var P=M.sourceEvent,T=w.getState(),j=T.transform,O=T.snapGrid,A=T.snapToGrid,z=P.touches?P.touches[0].clientX:P.clientX,$=P.touches?P.touches[0].clientY:P.clientY,q=Fy({x:z,y:$},j,A,O);return q},[]);return f.useEffect(function(){if(t!=null&&t.current){var M=ca(t.current);if(a)M.on(".drag",null);else{var P=VS().on("start",function(T){var j=w.getState(),O=j.nodeInternals,A=j.multiSelectionActive,z=j.unselectNodesAndEdges,$=j.onNodeDragStart,q=j.onSelectionDragStart,V=u?$:Mg(q);if(!m&&!A&&u){var R;(R=O.get(u))!==null&&R!==void 0&&R.selected||z()}u&&d&&m&&Dy({id:u,store:w});var ee=k(T);if(S.current=ee,x.current=Zk(O,ee,u),V&&x.current){var le=kg({nodeId:u,dragItems:x.current,nodeInternals:O}),D=Ut(le,2),X=D[0],Y=D[1];V(T.sourceEvent,X,Y)}}).on("drag",function(T){var j=w.getState(),O=j.updateNodePositions,A=j.snapToGrid,z=j.snapGrid,$=j.nodeInternals,q=j.nodeExtent,V=j.onNodeDrag,R=j.onSelectionDrag,ee=k(T);if((S.current.x!==ee.x||S.current.y!==ee.y)&&x.current){S.current=ee,x.current=x.current.map(function(U){return e1(U,ee,A,z,$,q)});var le=u?V:Mg(R);if(O(x.current,!0,!0),y(!0),le){var D=kg({nodeId:u,dragItems:x.current,nodeInternals:$}),X=Ut(D,2),Y=X[0],K=X[1];le(T.sourceEvent,Y,K)}}T.on("end",function(U){if(y(!1),x.current){var te=w.getState(),W=te.updateNodePositions,I=te.nodeInternals,Q=te.onNodeDragStop,me=te.onSelectionDragStop,J=u?Q:Mg(me);if(W(x.current,!1,!1),J){var H=kg({nodeId:u,dragItems:x.current,nodeInternals:I}),Z=Ut(H,2),ne=Z[0],fe=Z[1];J(U.sourceEvent,ne,fe)}}})}).filter(function(T){var j=T.target,O=!T.button&&(!i||!zb(j,".".concat(i),t))&&(!l||zb(j,l,t));return O});return M.call(P),function(){M.on(".drag",null)}}}},[t,a,i,l,d,w,u,m,k]),_}function Fb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function t1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var n1=function(t){return t1({transformString:"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")"),userSelectionActive:t.userSelectionActive},og(Array.from(t.nodeInternals.values()).filter(function(n){return n.selected})))},s1=function(t){var n=Array.from(t.nodeInternals.values()).filter(function(a){return a.selected});return og(n)};function r1(e){var t=e.onSelectionContextMenu,n=e.noPanClassName,a=Ls(),i=Qn(n1,Tr),l=i.transformString,u=i.userSelectionActive,d=Qn(s1,Tr),m=d.width,v=d.height,p=d.x,_=d.y,y=f.useRef(null);if(Rb({nodeRef:y}),u||!m||!v)return null;var w=t?function(x){var S=Array.from(a.getState().nodeInternals.values()).filter(function(k){return k.selected});t(x,S)}:void 0;return Oe.createElement("div",{className:Pr(["react-flow__nodesselection","react-flow__container",n]),style:{transform:l}},Oe.createElement("div",{ref:y,className:"react-flow__nodesselection-rect",onContextMenu:w,style:{width:m,height:v,top:_,left:p}}))}var a1=f.memo(r1),o1=function(t){return t.nodesSelectionActive},Ib=function(t){var n=t.children,a=t.onPaneClick,i=t.onPaneContextMenu,l=t.onPaneScroll,u=t.deleteKeyCode,d=t.onMove,m=t.onMoveStart,v=t.onMoveEnd,p=t.selectionKeyCode,_=t.multiSelectionKeyCode,y=t.zoomActivationKeyCode,w=t.elementsSelectable,x=t.zoomOnScroll,S=t.zoomOnPinch,k=t.panOnScroll,M=t.panOnScrollSpeed,P=t.panOnScrollMode,T=t.zoomOnDoubleClick,j=t.panOnDrag,O=t.translateExtent,A=t.minZoom,z=t.maxZoom,$=t.defaultZoom,q=t.defaultPosition,V=t.preventScrolling,R=t.onSelectionContextMenu,ee=t.noWheelClassName,le=t.noPanClassName,D=Ls(),X=Qn(o1),Y=kf(p);Wk({deleteKeyCode:u,multiSelectionKeyCode:_});var K=function(I){a==null||a(I),D.getState().resetSelectedElements(),D.setState({nodesSelectionActive:!1})},U=i?function(W){return i(W)}:void 0,te=l?function(W){return l(W)}:void 0;return Oe.createElement(Gk,{onMove:d,onMoveStart:m,onMoveEnd:v,selectionKeyPressed:Y,elementsSelectable:w,zoomOnScroll:x,zoomOnPinch:S,panOnScroll:k,panOnScrollSpeed:M,panOnScrollMode:P,zoomOnDoubleClick:T,panOnDrag:j,translateExtent:O,minZoom:A,maxZoom:z,defaultZoom:$,defaultPosition:q,zoomActivationKeyCode:y,preventScrolling:V,noWheelClassName:ee,noPanClassName:le},n,Oe.createElement(Jk,{selectionKeyPressed:Y}),X&&Oe.createElement(a1,{onSelectionContextMenu:R,noPanClassName:le}),Oe.createElement("div",{className:"react-flow__pane react-flow__container",onClick:K,onContextMenu:U,onWheel:te}))};Ib.displayName="FlowRenderer";var i1=f.memo(Ib);function l1(e){var t=Qn(f.useCallback(function(n){return e?Iy(n.nodeInternals,{x:0,y:0,width:n.width,height:n.height},n.transform,!0):Array.from(n.nodeInternals.values())},[e]));return t}var c1=function(t){return{nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,updateNodeDimensions:t.updateNodeDimensions}},Bb=function(t){var n=Qn(c1,Tr),a=n.nodesDraggable,i=n.nodesConnectable,l=n.elementsSelectable,u=n.updateNodeDimensions,d=l1(t.onlyRenderVisibleElements),m=f.useRef(),v=f.useMemo(function(){if(typeof ResizeObserver>"u")return null;var p=new ResizeObserver(function(_){var y=_.map(function(w){return{id:w.target.getAttribute("data-id"),nodeElement:w.target,forceUpdate:!0}});u(y)});return m.current=p,p},[]);return f.useEffect(function(){return function(){var p;m==null||(p=m.current)===null||p===void 0||p.disconnect()}},[]),Oe.createElement("div",{className:"react-flow__nodes react-flow__container"},d.map(function(p){var _,y,w,x,S,k,M,P=p.type||"default";t.nodeTypes[P]||(P="default");var T=t.nodeTypes[P]||t.nodeTypes.default,j=!!(p.draggable||a&&typeof p.draggable>"u"),O=!!(p.selectable||l&&typeof p.selectable>"u"),A=!!(p.connectable||i&&typeof p.connectable>"u");return Oe.createElement(T,{key:p.id,id:p.id,className:p.className,style:p.style,type:P,data:p.data,sourcePosition:p.sourcePosition||Xe.Bottom,targetPosition:p.targetPosition||Xe.Top,hidden:p.hidden,xPos:(_=(y=p.positionAbsolute)===null||y===void 0?void 0:y.x)!==null&&_!==void 0?_:0,yPos:(w=(x=p.positionAbsolute)===null||x===void 0?void 0:x.y)!==null&&w!==void 0?w:0,selectNodesOnDrag:t.selectNodesOnDrag,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,selected:!!p.selected,isDraggable:j,isSelectable:O,isConnectable:A,resizeObserver:v,dragHandle:p.dragHandle,zIndex:(S=(k=p[Ns])===null||k===void 0?void 0:k.z)!==null&&S!==void 0?S:0,isParent:!!((M=p[Ns])!==null&&M!==void 0&&M.isParent),noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,initialized:!!p.width&&!!p.height})}))};Bb.displayName="NodeRenderer";var u1=f.memo(Bb),kc;function Ub(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function qb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ub(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ub(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var d1=(kc={},Qt(kc,Xe.Left,Xe.Right),Qt(kc,Xe.Right,Xe.Left),Qt(kc,Xe.Top,Xe.Bottom),Qt(kc,Xe.Bottom,Xe.Top),kc),m1=function(e){var t,n,a,i,l,u=e.connectionNodeId,d=e.connectionHandleType,m=e.connectionLineStyle,v=e.connectionLineType,p=v===void 0?Go.Bezier:v,_=e.isConnectable,y=e.CustomConnectionLineComponent,w=Qn(f.useCallback(function(te){return{fromNode:te.nodeInternals.get(u),handleId:te.connectionHandleId,toX:(te.connectionPosition.x-te.transform[0])/te.transform[2],toY:(te.connectionPosition.y-te.transform[1])/te.transform[2]}},[u]),Tr),x=w.fromNode,S=w.handleId,k=w.toX,M=w.toY,P=x==null||(t=x[Ns])===null||t===void 0?void 0:t.handleBounds;if(!x||!_||!(P!=null&&P[d]))return null;var T=P[d],j=S?T.find(function(te){return te.id===S}):T[0],O=j?j.x+j.width/2:((n=x==null?void 0:x.width)!==null&&n!==void 0?n:0)/2,A=j?j.y+j.height/2:(a=x==null?void 0:x.height)!==null&&a!==void 0?a:0,z=((x==null||(i=x.positionAbsolute)===null||i===void 0?void 0:i.x)||0)+O,$=((x==null||(l=x.positionAbsolute)===null||l===void 0?void 0:l.y)||0)+A,q=j==null?void 0:j.position;if(!q)return null;var V=d1[q],R,ee,le,D,X,Y;switch(d){case"source":R=z,ee=$,le=q,D=k,X=M,Y=V;break;case"target":R=k,ee=M,le=V,D=z,X=$,Y=q;break}if(y)return Oe.createElement("g",{className:"react-flow__connection"},Oe.createElement(y,{connectionLineType:p,connectionLineStyle:m,fromNode:x,fromHandle:j,fromX:z,fromY:$,toX:k,toY:M,fromPosition:q,toPosition:V,sourcePosition:le,targetPosition:Y,sourceNode:x,sourceHandle:j,targetX:D,targetY:X,sourceX:R,sourceY:ee}));var K="",U={sourceX:R,sourceY:ee,sourcePosition:le,targetX:D,targetY:X,targetPosition:Y};return p===Go.Bezier?K=mb(U):p===Go.Step?K=yg(qb(qb({},U),{},{borderRadius:0})):p===Go.SmoothStep?K=yg(U):p===Go.SimpleBezier?K=sb(U):K="M".concat(R,",").concat(ee," ").concat(D,",").concat(X),Oe.createElement("g",{className:"react-flow__connection"},Oe.createElement("path",{d:K,className:"react-flow__connection-path",style:m}))};function Ag(e){"@babel/helpers - typeof";return Ag=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ag(e)}var Af,f1=function(t){var n=t.color,a=n===void 0?"none":n,i=t.strokeWidth,l=i===void 0?1:i;return Oe.createElement("polyline",{stroke:a,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:l,fill:"none",points:"-5,-4 0,0 -5,4"})},h1=function(t){var n=t.color,a=n===void 0?"none":n,i=t.strokeWidth,l=i===void 0?1:i;return Oe.createElement("polyline",{stroke:a,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:l,fill:a,points:"-5,-4 0,0 -5,4 -5,-4"})},Hb=(Af={},Qt(Af,vf.Arrow,f1),Qt(Af,vf.ArrowClosed,h1),Af);function p1(e){var t=f.useMemo(function(){var n=Hb.hasOwnProperty(e);return n?Hb[e]:function(){return null}},[e]);return t}function Vb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function g1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Vb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var _1=function(t){var n=t.id,a=t.type,i=t.color,l=t.width,u=l===void 0?12.5:l,d=t.height,m=d===void 0?12.5:d,v=t.markerUnits,p=v===void 0?"strokeWidth":v,_=t.strokeWidth,y=t.orient,w=y===void 0?"auto":y,x=p1(a);return Oe.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:"".concat(u),markerHeight:"".concat(m),viewBox:"-10 -10 20 20",markerUnits:p,orient:w,refX:"0",refY:"0"},Oe.createElement(x,{color:i,strokeWidth:_}))},v1=function(t){var n=t.defaultColor,a=t.rfId;return function(i){var l=[];return i.edges.reduce(function(u,d){return[d.markerStart,d.markerEnd].forEach(function(m){if(m&&Ag(m)==="object"){var v=ag(m,a);l.includes(v)||(u.push(g1({id:v,color:m.color||n},m)),l.push(v))}}),u},[]).sort(function(u,d){return u.id.localeCompare(d.id)})}},Wb=function(t){var n=t.defaultColor,a=t.rfId,i=Qn(f.useCallback(v1({defaultColor:n,rfId:a}),[n,a]),function(l,u){return!(l.length!==u.length||l.some(function(d,m){return d.id!==u[m].id}))});return Oe.createElement("defs",null,i.map(function(l){return Oe.createElement(_1,{id:l.id,key:l.id,type:l.type,color:l.color,width:l.width,height:l.height,markerUnits:l.markerUnits,strokeWidth:l.strokeWidth,orient:l.orient})}))};Wb.displayName="MarkerDefinitions";var y1=f.memo(Wb),b1=[{level:0,isMaxLevel:!0,edges:[]}];function x1(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=-1,i=e.reduce(function(u,d){var m=ky(d.zIndex),v=m?d.zIndex:0;if(n){var p,_,y,w;v=m?d.zIndex:Math.max(((p=t.get(d.source))===null||p===void 0||(_=p[Ns])===null||_===void 0?void 0:_.z)||0,((y=t.get(d.target))===null||y===void 0||(w=y[Ns])===null||w===void 0?void 0:w.z)||0)}return u[v]?u[v].push(d):u[v]=[d],a=v>a?v:a,u},{}),l=Object.entries(i).map(function(u){var d=Ut(u,2),m=d[0],v=d[1],p=+m;return{edges:v,level:p,isMaxLevel:p===a}});return l.length===0?b1:l}function w1(e,t,n){var a=Qn(f.useCallback(function(i){return e?i.edges.filter(function(l){var u=t.get(l.source),d=t.get(l.target);return(u==null?void 0:u.width)&&(u==null?void 0:u.height)&&(d==null?void 0:d.width)&&(d==null?void 0:d.height)&&qk({sourcePos:u.positionAbsolute||{x:0,y:0},targetPos:d.positionAbsolute||{x:0,y:0},sourceWidth:u.width,sourceHeight:u.height,targetWidth:d.width,targetHeight:d.height,width:i.width,height:i.height,transform:i.transform})}):i.edges},[e,t]));return x1(a,t,n)}var j1=function(t){return{connectionNodeId:t.connectionNodeId,connectionHandleType:t.connectionHandleType,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,width:t.width,height:t.height,connectionMode:t.connectionMode,nodeInternals:t.nodeInternals}},Kb=function(t){var n=Qn(j1,Tr),a=n.connectionNodeId,i=n.connectionHandleType,l=n.nodesConnectable,u=n.elementsSelectable,d=n.width,m=n.height,v=n.connectionMode,p=n.nodeInternals,_=w1(t.onlyRenderVisibleElements,p,t.elevateEdgesOnSelect);if(!d)return null;var y=t.connectionLineType,w=t.defaultMarkerColor,x=t.connectionLineStyle,S=t.connectionLineComponent,k=t.connectionLineContainerStyle,M=a&&i;return Oe.createElement(Oe.Fragment,null,_.map(function(P){var T=P.level,j=P.edges,O=P.isMaxLevel;return Oe.createElement("svg",{key:T,style:{zIndex:T},width:d,height:m,className:"react-flow__edges react-flow__container"},O&&Oe.createElement(y1,{defaultColor:w,rfId:t.rfId}),Oe.createElement("g",null,j.map(function(A){var z=Cb(p,A.source),$=Ut(z,3),q=$[0],V=$[1],R=$[2],ee=Cb(p,A.target),le=Ut(ee,3),D=le[0],X=le[1],Y=le[2];if(!R||!Y)return null;var K=A.type||"default";t.edgeTypes[K]||(console.warn('[React Flow]: Edge type "'.concat(K,'" not found. Using fallback type "default". Help: https://reactflow.dev/error#300')),K="default");var U=t.edgeTypes[K]||t.edgeTypes.default,te=v===nl.Strict?X.target:X.target||X.source,W=Sb(V.source,A.sourceHandle||null),I=Sb(te,A.targetHandle||null),Q=(W==null?void 0:W.position)||Xe.Bottom,me=(I==null?void 0:I.position)||Xe.Top;if(!W||!I)return null;var J=Uk(q,W,Q,D,I,me),H=J.sourceX,Z=J.sourceY,ne=J.targetX,fe=J.targetY;return Oe.createElement(U,{key:A.id,id:A.id,className:Pr([A.className,t.noPanClassName]),type:K,data:A.data,selected:!!A.selected,animated:!!A.animated,hidden:!!A.hidden,label:A.label,labelStyle:A.labelStyle,labelShowBg:A.labelShowBg,labelBgStyle:A.labelBgStyle,labelBgPadding:A.labelBgPadding,labelBgBorderRadius:A.labelBgBorderRadius,style:A.style,source:A.source,target:A.target,sourceHandleId:A.sourceHandle,targetHandleId:A.targetHandle,markerEnd:A.markerEnd,markerStart:A.markerStart,sourceX:H,sourceY:Z,targetX:ne,targetY:fe,sourcePosition:Q,targetPosition:me,elementsSelectable:u,onEdgeUpdate:t.onEdgeUpdate,onContextMenu:t.onEdgeContextMenu,onMouseEnter:t.onEdgeMouseEnter,onMouseMove:t.onEdgeMouseMove,onMouseLeave:t.onEdgeMouseLeave,onClick:t.onEdgeClick,edgeUpdaterRadius:t.edgeUpdaterRadius,onEdgeDoubleClick:t.onEdgeDoubleClick,onEdgeUpdateStart:t.onEdgeUpdateStart,onEdgeUpdateEnd:t.onEdgeUpdateEnd,rfId:t.rfId})})))}),M&&Oe.createElement("svg",{style:k,width:d,height:m,className:"react-flow__edges react-flow__connectionline react-flow__container"},Oe.createElement(m1,{connectionNodeId:a,connectionHandleType:i,connectionLineStyle:x,connectionLineType:y,isConnectable:l,CustomConnectionLineComponent:S})))};Kb.displayName="EdgeRenderer";var N1=f.memo(Kb),S1=function(t){return"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")")};function C1(e){var t=e.children,n=Qn(S1);return Oe.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:n}},t)}function E1(e){var t=ug(),n=f.useRef(!1);f.useEffect(function(){!n.current&&t.viewportInitialized&&e&&(setTimeout(function(){return e(t)},1),n.current=!0)},[e,t.viewportInitialized])}var Yb=function(t){var n=t.nodeTypes,a=t.edgeTypes,i=t.onMove,l=t.onMoveStart,u=t.onMoveEnd,d=t.onInit,m=t.onNodeClick,v=t.onEdgeClick,p=t.onNodeDoubleClick,_=t.onEdgeDoubleClick,y=t.onNodeMouseEnter,w=t.onNodeMouseMove,x=t.onNodeMouseLeave,S=t.onNodeContextMenu,k=t.onSelectionContextMenu,M=t.connectionLineType,P=t.connectionLineStyle,T=t.connectionLineComponent,j=t.connectionLineContainerStyle,O=t.selectionKeyCode,A=t.multiSelectionKeyCode,z=t.zoomActivationKeyCode,$=t.deleteKeyCode,q=t.onlyRenderVisibleElements,V=t.elementsSelectable,R=t.selectNodesOnDrag,ee=t.translateExtent,le=t.minZoom,D=t.maxZoom,X=t.defaultZoom,Y=t.defaultPosition,K=t.preventScrolling,U=t.defaultMarkerColor,te=t.zoomOnScroll,W=t.zoomOnPinch,I=t.panOnScroll,Q=t.panOnScrollSpeed,me=t.panOnScrollMode,J=t.zoomOnDoubleClick,H=t.panOnDrag,Z=t.onPaneClick,ne=t.onPaneScroll,fe=t.onPaneContextMenu,ae=t.onEdgeUpdate,pe=t.onEdgeContextMenu,Ve=t.onEdgeMouseEnter,st=t.onEdgeMouseMove,Ke=t.onEdgeMouseLeave,mt=t.edgeUpdaterRadius,yt=t.onEdgeUpdateStart,Te=t.onEdgeUpdateEnd,at=t.noDragClassName,it=t.noWheelClassName,be=t.noPanClassName,Pe=t.elevateEdgesOnSelect,G=t.id;return E1(d),Oe.createElement(i1,{onPaneClick:Z,onPaneContextMenu:fe,onPaneScroll:ne,deleteKeyCode:$,selectionKeyCode:O,multiSelectionKeyCode:A,zoomActivationKeyCode:z,elementsSelectable:V,onMove:i,onMoveStart:l,onMoveEnd:u,zoomOnScroll:te,zoomOnPinch:W,zoomOnDoubleClick:J,panOnScroll:I,panOnScrollSpeed:Q,panOnScrollMode:me,panOnDrag:H,translateExtent:ee,minZoom:le,maxZoom:D,defaultZoom:X,defaultPosition:Y,onSelectionContextMenu:k,preventScrolling:K,noDragClassName:at,noWheelClassName:it,noPanClassName:be},Oe.createElement(C1,null,Oe.createElement(N1,{edgeTypes:a,onEdgeClick:v,onEdgeDoubleClick:_,connectionLineType:M,connectionLineStyle:P,connectionLineComponent:T,connectionLineContainerStyle:j,onEdgeUpdate:ae,onlyRenderVisibleElements:q,onEdgeContextMenu:pe,onEdgeMouseEnter:Ve,onEdgeMouseMove:st,onEdgeMouseLeave:Ke,onEdgeUpdateStart:yt,onEdgeUpdateEnd:Te,edgeUpdaterRadius:mt,defaultMarkerColor:U,noPanClassName:be,elevateEdgesOnSelect:!!Pe,rfId:G}),Oe.createElement(u1,{nodeTypes:n,onNodeClick:m,onNodeDoubleClick:p,onNodeMouseEnter:y,onNodeMouseMove:w,onNodeMouseLeave:x,onNodeContextMenu:S,selectNodesOnDrag:R,onlyRenderVisibleElements:q,noPanClassName:be,noDragClassName:at})))};Yb.displayName="GraphView";var k1=f.memo(Yb),Qb=function(){return null};Qb.displayName="GroupNode";function Gb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function Xb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Gb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}var pd=function(e){var t=function(a){var i=a.id,l=a.type,u=a.data,d=a.xPos,m=a.yPos,v=a.selected,p=a.onClick,_=a.onMouseEnter,y=a.onMouseMove,w=a.onMouseLeave,x=a.onContextMenu,S=a.onDoubleClick,k=a.style,M=a.className,P=a.isDraggable,T=a.isSelectable,j=a.isConnectable,O=a.selectNodesOnDrag,A=a.sourcePosition,z=a.targetPosition,$=a.hidden,q=a.resizeObserver,V=a.dragHandle,R=a.zIndex,ee=a.isParent,le=a.noPanClassName,D=a.noDragClassName,X=a.initialized,Y=Ls(),K=f.useRef(null),U=f.useRef(A),te=f.useRef(z),W=f.useRef(l),I=T||P||p||_||y||w,Q=dd(i,Y.getState,_),me=dd(i,Y.getState,y),J=dd(i,Y.getState,w),H=dd(i,Y.getState,x),Z=dd(i,Y.getState,S),ne=function(pe){if(T&&(!O||!P)&&Dy({id:i,store:Y}),p){var Ve=Y.getState().nodeInternals.get(i);p(pe,Xb({},Ve))}};f.useEffect(function(){if(K.current&&!$){var ae=K.current;return q==null||q.observe(ae),function(){return q==null?void 0:q.unobserve(ae)}}},[$]),f.useEffect(function(){var ae=W.current!==l,pe=U.current!==A,Ve=te.current!==z;K.current&&(ae||pe||Ve)&&(ae&&(W.current=l),pe&&(U.current=A),Ve&&(te.current=z),Y.getState().updateNodeDimensions([{id:i,nodeElement:K.current,forceUpdate:!0}]))},[i,l,A,z]);var fe=Rb({nodeRef:K,disabled:$||!P,noDragClassName:D,handleSelector:V,nodeId:i,isSelectable:T,selectNodesOnDrag:O});return $?null:Oe.createElement("div",{className:Pr(["react-flow__node","react-flow__node-".concat(l),le,M,{selected:v,selectable:T,parent:ee}]),ref:K,style:Xb({zIndex:R,transform:"translate(".concat(d,"px,").concat(m,"px)"),pointerEvents:I?"all":"none",visibility:X?"visible":"hidden"},k),onMouseEnter:Q,onMouseMove:me,onMouseLeave:J,onContextMenu:H,onClick:ne,onDoubleClick:Z,"data-testid":"rf__node-".concat(i),"data-id":i},Oe.createElement(Sk,{value:i},Oe.createElement(e,{id:i,data:u,type:l,xPos:d,yPos:m,selected:v,isConnectable:j,sourcePosition:A,targetPosition:z,dragging:fe,dragHandle:V,zIndex:R})))};return t.displayName="NodeWrapper",f.memo(t)};function Jb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function Zb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jb(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jb(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function M1(e){var t={input:pd(e.input||vb),default:pd(e.default||Cg),output:pd(e.output||bb),group:pd(e.group||Qb)},n={},a=Object.keys(e).filter(function(i){return!["input","default","output","group"].includes(i)}).reduce(function(i,l){return i[l]=pd(e[l]||Cg),i},n);return Zb(Zb({},t),a)}function ex(e,t){f.useRef(null);var n=f.useMemo(function(){return t(e)},[e]);return n}function tx(e){if(!(!e||typeof document>"u")){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");t.appendChild(n),n.appendChild(document.createTextNode(e))}}var nx=function(t){var n=t.children,a=!0;try{Ls()}catch{a=!1}return a?Oe.createElement(Oe.Fragment,null,n):Oe.createElement(Yy,{createStore:Qy},n)};nx.displayName="ReactFlowWrapper";var A1=["nodes","edges","defaultNodes","defaultEdges","className","nodeTypes","edgeTypes","onNodeClick","onEdgeClick","onInit","onMove","onMoveStart","onMoveEnd","onConnect","onConnectStart","onConnectStop","onConnectEnd","onClickConnectStart","onClickConnectStop","onClickConnectEnd","onNodeMouseEnter","onNodeMouseMove","onNodeMouseLeave","onNodeContextMenu","onNodeDoubleClick","onNodeDragStart","onNodeDrag","onNodeDragStop","onNodesDelete","onEdgesDelete","onSelectionChange","onSelectionDragStart","onSelectionDrag","onSelectionDragStop","onSelectionContextMenu","connectionMode","connectionLineType","connectionLineStyle","connectionLineComponent","connectionLineContainerStyle","deleteKeyCode","selectionKeyCode","multiSelectionKeyCode","zoomActivationKeyCode","snapToGrid","snapGrid","onlyRenderVisibleElements","selectNodesOnDrag","nodesDraggable","nodesConnectable","elementsSelectable","minZoom","maxZoom","defaultZoom","defaultPosition","translateExtent","preventScrolling","nodeExtent","defaultMarkerColor","zoomOnScroll","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnScrollMode","zoomOnDoubleClick","panOnDrag","onPaneClick","onPaneScroll","onPaneContextMenu","children","onEdgeUpdate","onEdgeContextMenu","onEdgeDoubleClick","onEdgeMouseEnter","onEdgeMouseMove","onEdgeMouseLeave","onEdgeUpdateStart","onEdgeUpdateEnd","edgeUpdaterRadius","onNodesChange","onEdgesChange","noDragClassName","noWheelClassName","noPanClassName","fitView","fitViewOptions","connectOnClick","attributionPosition","proOptions","defaultEdgeOptions","elevateEdgesOnSelect"];function sx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,a)}return n}function rx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sx(Object(n),!0).forEach(function(a){Qt(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sx(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}tx(Dk),tx(Rk);var O1={input:vb,default:Cg,output:bb},P1={default:xg,straight:db,step:ub,smoothstep:bg,simplebezier:rb},T1=[15,15],$1=[0,0],ax=f.forwardRef(function(e,t){var n=e.nodes,a=e.edges,i=e.defaultNodes,l=e.defaultEdges,u=e.className,d=e.nodeTypes,m=d===void 0?O1:d,v=e.edgeTypes,p=v===void 0?P1:v,_=e.onNodeClick,y=e.onEdgeClick,w=e.onInit,x=e.onMove,S=e.onMoveStart,k=e.onMoveEnd,M=e.onConnect,P=e.onConnectStart,T=e.onConnectStop,j=e.onConnectEnd,O=e.onClickConnectStart,A=e.onClickConnectStop,z=e.onClickConnectEnd,$=e.onNodeMouseEnter,q=e.onNodeMouseMove,V=e.onNodeMouseLeave,R=e.onNodeContextMenu,ee=e.onNodeDoubleClick,le=e.onNodeDragStart,D=e.onNodeDrag,X=e.onNodeDragStop,Y=e.onNodesDelete,K=e.onEdgesDelete,U=e.onSelectionChange,te=e.onSelectionDragStart,W=e.onSelectionDrag,I=e.onSelectionDragStop,Q=e.onSelectionContextMenu,me=e.connectionMode,J=me===void 0?nl.Strict:me,H=e.connectionLineType,Z=H===void 0?Go.Bezier:H,ne=e.connectionLineStyle,fe=e.connectionLineComponent,ae=e.connectionLineContainerStyle,pe=e.deleteKeyCode,Ve=pe===void 0?"Backspace":pe,st=e.selectionKeyCode,Ke=st===void 0?"Shift":st,mt=e.multiSelectionKeyCode,yt=mt===void 0?"Meta":mt,Te=e.zoomActivationKeyCode,at=Te===void 0?"Meta":Te,it=e.snapToGrid,be=it===void 0?!1:it,Pe=e.snapGrid,G=Pe===void 0?T1:Pe,ke=e.onlyRenderVisibleElements,Ae=ke===void 0?!1:ke,Ge=e.selectNodesOnDrag,ft=Ge===void 0?!0:Ge,zt=e.nodesDraggable,ve=e.nodesConnectable,xe=e.elementsSelectable,Se=e.minZoom,$e=Se===void 0?.5:Se,Ye=e.maxZoom,Ue=Ye===void 0?2:Ye,Ze=e.defaultZoom,Nt=Ze===void 0?1:Ze,Et=e.defaultPosition,qt=Et===void 0?$1:Et,Ht=e.translateExtent,Pt=Ht===void 0?lg:Ht,pt=e.preventScrolling,Jt=pt===void 0?!0:pt,Gt=e.nodeExtent,Ct=e.defaultMarkerColor,Dn=Ct===void 0?"#b1b1b7":Ct,wn=e.zoomOnScroll,pn=wn===void 0?!0:wn,Tt=e.zoomOnPinch,hs=Tt===void 0?!0:Tt,sn=e.panOnScroll,ht=sn===void 0?!1:sn,_t=e.panOnScrollSpeed,zn=_t===void 0?.5:_t,Gn=e.panOnScrollMode,ps=Gn===void 0?wc.Free:Gn,Xn=e.zoomOnDoubleClick,Es=Xn===void 0?!0:Xn,Jn=e.panOnDrag,dr=Jn===void 0?!0:Jn,bn=e.onPaneClick,zs=e.onPaneScroll,ks=e.onPaneContextMenu,gs=e.children,Ba=e.onEdgeUpdate,Xs=e.onEdgeContextMenu,pa=e.onEdgeDoubleClick,zr=e.onEdgeMouseEnter,Rr=e.onEdgeMouseMove,ga=e.onEdgeMouseLeave,Js=e.onEdgeUpdateStart,bo=e.onEdgeUpdateEnd,Ua=e.edgeUpdaterRadius,fn=Ua===void 0?10:Ua,Xr=e.onNodesChange,_s=e.onEdgesChange,Fr=e.noDragClassName,Rs=Fr===void 0?"nodrag":Fr,_a=e.noWheelClassName,_e=_a===void 0?"nowheel":_a,De=e.noPanClassName,et=De===void 0?"nopan":De,Yt=e.fitView,Be=Yt===void 0?!1:Yt,kt=e.fitViewOptions,$t=e.connectOnClick,rn=$t===void 0?!0:$t,Zt=e.attributionPosition,On=e.proOptions,gn=e.defaultEdgeOptions,Rn=e.elevateEdgesOnSelect,mr=Rn===void 0?!1:Rn,Ms=xf(e,A1),Zn=ex(m,M1),is=ex(p,Bk);return Oe.createElement("div",rx(rx({},Ms),{},{ref:t,className:Pr(["react-flow",u])}),Oe.createElement(nx,null,Oe.createElement(k1,{onInit:w,onMove:x,onMoveStart:S,onMoveEnd:k,onNodeClick:_,onEdgeClick:y,onNodeMouseEnter:$,onNodeMouseMove:q,onNodeMouseLeave:V,onNodeContextMenu:R,onNodeDoubleClick:ee,nodeTypes:Zn,edgeTypes:is,connectionLineType:Z,connectionLineStyle:ne,connectionLineComponent:fe,connectionLineContainerStyle:ae,selectionKeyCode:Ke,deleteKeyCode:Ve,multiSelectionKeyCode:yt,zoomActivationKeyCode:at,onlyRenderVisibleElements:Ae,selectNodesOnDrag:ft,translateExtent:Pt,minZoom:$e,maxZoom:Ue,defaultZoom:Nt,defaultPosition:qt,preventScrolling:Jt,zoomOnScroll:pn,zoomOnPinch:hs,zoomOnDoubleClick:Es,panOnScroll:ht,panOnScrollSpeed:zn,panOnScrollMode:ps,panOnDrag:dr,onPaneClick:bn,onPaneScroll:zs,onPaneContextMenu:ks,onSelectionContextMenu:Q,onEdgeUpdate:Ba,onEdgeContextMenu:Xs,onEdgeDoubleClick:pa,onEdgeMouseEnter:zr,onEdgeMouseMove:Rr,onEdgeMouseLeave:ga,onEdgeUpdateStart:Js,onEdgeUpdateEnd:bo,edgeUpdaterRadius:fn,defaultMarkerColor:Dn,noDragClassName:Rs,noWheelClassName:_e,noPanClassName:et,elevateEdgesOnSelect:mr,id:Ms==null?void 0:Ms.id}),Oe.createElement($k,{nodes:n,edges:a,defaultNodes:i,defaultEdges:l,onConnect:M,onConnectStart:P,onConnectStop:T,onConnectEnd:j,onClickConnectStart:O,onClickConnectStop:A,onClickConnectEnd:z,nodesDraggable:zt,nodesConnectable:ve,elementsSelectable:xe,minZoom:$e,maxZoom:Ue,nodeExtent:Gt,onNodesChange:Xr,onEdgesChange:_s,snapToGrid:be,snapGrid:G,connectionMode:J,translateExtent:Pt,connectOnClick:rn,defaultEdgeOptions:gn,fitView:Be,fitViewOptions:kt,onNodesDelete:Y,onEdgesDelete:K,onNodeDragStart:le,onNodeDrag:D,onNodeDragStop:X,onSelectionDrag:W,onSelectionDragStart:te,onSelectionDragStop:I}),U&&Oe.createElement(Pk,{onSelectionChange:U}),gs,Oe.createElement(_k,{proOptions:On,position:Zt})))});ax.displayName="ReactFlow";var ox=function(t){var n=t.children;return Oe.createElement(Yy,{createStore:Qy},n)};ox.displayName="ReactFlowProvider";function ix(e){return function(t){var n=f.useState(t),a=Ut(n,2),i=a[0],l=a[1],u=f.useCallback(function(d){return l(function(m){return e(d,m)})},[]);return[i,l,u]}}var L1=ix(Py),D1=ix(BE);const z1=e=>Number.isFinite(e),Of=e=>Math.round(e*100)/100,R1=(e,t,n,a)=>{if(e===n&&t===a)return`M ${e},${t}`;const i=Math.abs(n-e),l=Math.abs(a-t),u=Math.sqrt(i*i+l*l),d=Math.max(80,Math.min(u*.4,280)),m=Number.isFinite(d)?d:120,v=n>=e?1:-1,p=Math.min(Math.abs(a-t)*.2,50),_=e+v*m,y=t+(a>t?p:-p),w=n-v*m,x=a-(a>t?p:-p);return`M ${e},${t} C ${_},${y} ${w},${x} ${n},${a}`},F1=({id:e,sourceX:t,sourceY:n,targetX:a,targetY:i,markerEnd:l,style:u})=>{const{setEdges:d}=ug(),[m,v]=f.useState(!1),p=f.useCallback(()=>{v(!0)},[]),_=f.useCallback(()=>{v(!1)},[]),y=f.useMemo(()=>[t,n,a,i].every(V=>z1(V))?{sourceX:Of(t),sourceY:Of(n),targetX:Of(a),targetY:Of(i)}:(console.error(` Edge ${e}: Invalid coordinates`,{sourceX:t,sourceY:n,targetX:a,targetY:i}),null),[t,n,a,i,e]),w=f.useMemo(()=>{if(!y)return null;const{sourceX:V,sourceY:R,targetX:ee,targetY:le}=y;return R1(V,R,ee,le)},[y]),x=f.useMemo(()=>`animated-edge-gradient-${e}`,[e]);if(!y||!w)return null;const{sourceX:S,sourceY:k,targetX:M,targetY:P}=y,T=(S+M)/2,j=(k+P)/2,O=32,A=T-O/2,z=j-O/2,$=`animated-edge${m?" animated-edge--hovered":""}`,q=`canvas-edge-remove${m?" canvas-edge-remove--visible":""}`;return r.jsxs("g",{className:$,onMouseEnter:p,onMouseLeave:_,children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:x,gradientUnits:"userSpaceOnUse",x1:S,y1:k,x2:M,y2:P,children:[r.jsx("stop",{offset:"0%",stopColor:"#38bdf8",stopOpacity:.85}),r.jsx("stop",{offset:"50%",stopColor:"#6366f1",stopOpacity:.95}),r.jsx("stop",{offset:"100%",stopColor:"#a855f7",stopOpacity:.9})]}),r.jsxs("filter",{id:`edge-glow-${e}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),r.jsx("path",{d:w,fill:"none",stroke:"transparent",strokeWidth:20,style:{cursor:"pointer"},className:"animated-edge__interaction"}),r.jsx("path",{d:w,fill:"none",stroke:`url(#${x})`,strokeWidth:6,strokeOpacity:.2,strokeLinecap:"round",strokeLinejoin:"round",style:{filter:`url(#edge-glow-${e})`}}),r.jsx("path",{d:w,fill:"none",stroke:`url(#${x})`,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",markerEnd:l,className:"animated-edge__base",style:{...u,transition:"stroke-width 0.2s ease"}}),r.jsx("path",{d:w,fill:"none",stroke:`url(#${x})`,strokeWidth:m?3.5:3,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"16 12",className:"animated-edge__trail",style:{transition:"stroke-width 0.2s ease"}}),r.jsx("path",{d:w,fill:"none",stroke:"rgba(248, 250, 252, 0.4)",strokeWidth:1.5,strokeDasharray:"3 8",strokeLinecap:"round",strokeLinejoin:"round",className:"animated-edge__spark"}),r.jsx("foreignObject",{className:q,x:A,y:z,width:O,height:O,requiredExtensions:"http://www.w3.org/1999/xhtml",children:r.jsx("div",{className:"canvas-edge-remove__wrapper",children:r.jsx("button",{type:"button",className:"canvas-edge-remove__button",onClick:V=>{V.stopPropagation(),d(R=>R.filter(ee=>ee.id!==e))},"aria-label":"Remove connection",children:""})})})]})},I1=(e,t,n,a)=>{if(e===n&&t===a)return`M ${e},${t}`;const i=Math.abs(n-e),l=Math.max(64,Math.min(i*.45,240)),u=Number.isFinite(l)?l:100,d=n>=e?1:-1,m=e+d*u,v=t,p=n-d*u;return`M ${e},${t} C ${m},${v} ${p},${a} ${n},${a}`},B1=({sourceX:e,sourceY:t,targetX:n,targetY:a,sourcePosition:i,targetPosition:l})=>{const u=I1(e,t,n,a),d="connection-line-gradient";return r.jsxs("g",{children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:d,gradientUnits:"userSpaceOnUse",x1:e,y1:t,x2:n,y2:a,children:[r.jsx("stop",{offset:"0%",stopColor:"#38bdf8",stopOpacity:.8}),r.jsx("stop",{offset:"50%",stopColor:"#6366f1",stopOpacity:.9}),r.jsx("stop",{offset:"100%",stopColor:"#a855f7",stopOpacity:.85})]}),r.jsxs("filter",{id:"connection-glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),r.jsx("path",{d:u,fill:"none",stroke:`url(#${d})`,strokeWidth:8,strokeOpacity:.2,strokeLinecap:"round",style:{filter:"url(#connection-glow)"}}),r.jsx("path",{d:u,fill:"none",stroke:`url(#${d})`,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",style:{strokeDasharray:"8 4",animation:"connection-line-dash 1s linear infinite"}}),r.jsx("circle",{cx:n,cy:a,r:6,fill:"#a855f7",opacity:.8,style:{animation:"connection-pulse 1.5s ease-in-out infinite"}})]})},Pf=e=>!e||!e.length?"":e.join(", "),U1=({nodes:e,onAddNode:t})=>{const[n,a]=f.useState(""),[i,l]=f.useState([]),u=n.trim().toLowerCase(),d=f.useMemo(()=>u?e.filter(y=>{const w=[y.label,y.type,y.description];return y.category&&w.push(y.category),y.tags&&y.tags.length&&w.push(y.tags.join(" ")),w.some(x=>x==null?void 0:x.toLowerCase().includes(u))}):e,[e,u]),m=f.useMemo(()=>{const y=new Map;return d.forEach(w=>{var k;const x=((k=w.category)==null?void 0:k.trim())||"Other",S=y.get(x)??[];S.push(w),y.set(x,S)}),Array.from(y.entries()).sort(([w],[x])=>w.localeCompare(x)).map(([w,x])=>({category:w,entries:x.sort((S,k)=>(S.label||S.type).localeCompare(k.label||k.type))}))},[d]);f.useEffect(()=>{if(!u){l([]);return}l(y=>{const w=new Set(y);let x=!1;return m.forEach(({category:S})=>{w.has(S)||(w.add(S),x=!0)}),x?Array.from(w):y})},[m,u]);const v=y=>{l(w=>{const x=new Set(w);return x.has(y)?x.delete(y):x.add(y),Array.from(x)})},p=d.length,_=p>0;return r.jsxs("div",{className:"feature-canvas-sidebar",role:"presentation",children:[r.jsxs("header",{className:"feature-canvas-sidebar__header",children:[r.jsx("h3",{children:"Available steps"}),r.jsxs("div",{className:"feature-canvas-sidebar__search",children:[r.jsx("input",{type:"search",value:n,onChange:y=>a(y.target.value),placeholder:"Search by name, tag, or output",className:"feature-canvas-sidebar__search-input","aria-label":"Search available steps"}),n&&r.jsx("button",{type:"button",className:"feature-canvas-sidebar__search-clear",onClick:()=>a(""),"aria-label":"Clear search",children:""})]}),r.jsxs("span",{className:"feature-canvas-sidebar__results",children:["Showing ",p," ",p===1?"step":"steps",u?` matching ${n.trim()}`:""]})]}),_?r.jsx("div",{className:"feature-canvas-sidebar__sections",children:m.map(({category:y,entries:w})=>{const x=i.includes(y);return r.jsxs("section",{className:"feature-canvas-sidebar__section",children:[r.jsxs("button",{type:"button",className:"feature-canvas-sidebar__section-toggle",onClick:()=>v(y),"aria-expanded":x,children:[r.jsx("span",{className:"feature-canvas-sidebar__section-label",children:y.charAt(0).toUpperCase()+y.slice(1)}),r.jsxs("span",{className:"feature-canvas-sidebar__section-meta",children:[w.length,r.jsx("span",{className:"feature-canvas-sidebar__section-arrow","data-expanded":x,children:""})]})]}),x&&r.jsx("div",{className:"feature-canvas-sidebar__group",children:w.map(S=>{var k,M;return r.jsx("button",{className:"feature-canvas-sidebar__card",type:"button",onClick:()=>t==null?void 0:t(S),children:r.jsxs("div",{className:"feature-canvas-sidebar__card-body",children:[r.jsx("span",{className:"feature-canvas-sidebar__card-title",children:S.label||S.type}),S.description&&r.jsx("span",{className:"feature-canvas-sidebar__card-description",children:S.description}),r.jsxs("div",{className:"feature-canvas-sidebar__card-tags",children:[(k=S.inputs)!=null&&k.length?r.jsxs("span",{className:"feature-canvas-sidebar__chip",title:`Inputs: ${Pf(S.inputs)}`,children:["In: ",Pf(S.inputs)]}):null,(M=S.outputs)!=null&&M.length?r.jsxs("span",{className:"feature-canvas-sidebar__chip",title:`Outputs: ${Pf(S.outputs)}`,children:["Out: ",Pf(S.outputs)]}):null,S.parameters&&S.parameters.length>0?r.jsxs("span",{className:"feature-canvas-sidebar__chip",children:[S.parameters.length," param",S.parameters.length>1?"s":""]}):null]})]})},S.type)})})]},y)})}):r.jsx("div",{className:"feature-canvas-sidebar__empty",children:r.jsxs("p",{children:["No steps match ",n.trim(),". Try adjusting your search or browse by category."]})})]})};async function lx(){const e=await fetch("/ml-workflow/api/node-catalog");if(!e.ok)throw new Error("Failed to load node catalog");return e.json()}async function Og(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/drop-columns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load column drop recommendations");return u.json()}async function cx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/label-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load label encoding recommendations");return u.json()}async function ux(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/ordinal-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load ordinal encoding suggestions");return u.json()}async function dx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/target-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load target encoding recommendations");return u.json()}async function mx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/hash-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load hash encoding recommendations");return u.json()}async function fx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/one-hot-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load one-hot encoding recommendations");return u.json()}async function hx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/dummy-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load dummy encoding recommendations");return u.json()}async function px(e,t={}){const{sampleSize:n=500,transformations:a,graph:i,targetNodeId:l}=t,u={dataset_source_id:e,sample_size:n};Array.isArray(a)?a.length>0&&(u.transformations=JSON.stringify(a)):a&&typeof a=="object"&&Object.keys(a).length>0&&(u.transformations=JSON.stringify(a)),i&&Array.isArray(i.nodes)&&Array.isArray(i.edges)&&(u.graph={nodes:i.nodes,edges:i.edges}),l&&(u.target_node_id=l);const d=await fetch("/ml-workflow/api/recommendations/skewness",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!d.ok)throw new Error("Failed to load skewness recommendations");return d.json()}async function gx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/scaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load scaling recommendations");return u.json()}async function _x(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(l.graph={nodes:a.nodes,edges:a.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/binning",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load binning recommendations");return u.json()}async function vx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l=typeof n=="number"&&Number.isFinite(n)?Math.min(5e3,Math.max(50,Math.round(n))):500,u={dataset_source_id:e,sample_size:l};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(u.graph={nodes:a.nodes,edges:a.edges}),i&&(u.target_node_id=i);const d=await fetch("/ml-workflow/api/recommendations/outliers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!d.ok)throw new Error("Failed to load outlier recommendations");return d.json()}async function yx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l=n==="all"?0:typeof n=="number"&&Number.isFinite(n)?Math.max(0,Math.round(n)):500,u={dataset_source_id:e,sample_size:l};a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(u.graph={nodes:a.nodes,edges:a.edges}),i&&(u.target_node_id=i);const d=await fetch("/ml-workflow/api/analytics/binned-distribution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!d.ok){let m="Failed to load binned column distributions";try{const v=await d.clone().json(),p=typeof(v==null?void 0:v.detail)=="string"&&v.detail.trim()?v.detail.trim():typeof(v==null?void 0:v.error)=="string"&&v.error.trim()?v.error.trim():typeof(v==null?void 0:v.message)=="string"&&v.message.trim()?v.message.trim():null;p&&(m=p)}catch{try{const p=(await d.text()).trim();p&&(m=p)}catch{}}throw new Error(m)}return d.json()}async function bx(e,t={}){const{sampleSize:n=500,graph:a,targetNodeId:i}=t,l=n==="all"?0:typeof n=="number"&&Number.isFinite(n)?Math.max(0,Math.round(n)):500,u=new URLSearchParams({dataset_source_id:e,sample_size:String(l)});a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&u.set("graph",JSON.stringify({nodes:a.nodes,edges:a.edges})),i&&u.set("target_node_id",i);const d=await fetch(`/ml-workflow/api/analytics/quick-profile?${u.toString()}`);if(!d.ok){let m="Failed to generate dataset profile";try{const v=await d.clone().json(),p=typeof(v==null?void 0:v.detail)=="string"&&v.detail.trim()?v.detail.trim():typeof(v==null?void 0:v.error)=="string"&&v.error.trim()?v.error.trim():typeof(v==null?void 0:v.message)=="string"&&v.message.trim()?v.message.trim():null;p&&(m=p)}catch{try{const p=(await d.text()).trim();p&&(m=p)}catch{}}throw new Error(m)}return d.json()}async function q1(e,t={}){const{config:n,sampleSize:a,graph:i,targetNodeId:l}=t,u={dataset_source_id:e,sample_size:a==="all"?0:typeof a=="number"&&Number.isFinite(a)?a:300};if(n&&typeof n=="object"){const m=(y,w)=>{const x=Number(y);return Number.isFinite(x)?x<0?0:x>100?100:x:w},v=y=>{if(!y||typeof y!="object")return{};const w={};return Object.entries(y).forEach(([x,S])=>{const k=String(x??"").trim();if(!k)return;let M=null,P=null;if(S&&typeof S=="object"){const T=S.lower??S.min??S.minimum??null,j=S.upper??S.max??S.maximum??null,O=Number(T);Number.isFinite(O)&&(M=O);const A=Number(j);Number.isFinite(A)&&(P=A)}if(!(M===null&&P===null)){if(M!==null&&P!==null&&M>P){const T=M;M=P,P=T}w[k]={lower:M,upper:P}}}),w},p=m(n.lower_percentile,5),_=m(n.upper_percentile,95);u.config={...n,method:n.method??"z_score",columns:Array.isArray(n.columns)?n.columns:[],z_threshold:typeof n.z_threshold=="number"&&Number.isFinite(n.z_threshold)?n.z_threshold:3,iqr_multiplier:typeof n.iqr_multiplier=="number"&&Number.isFinite(n.iqr_multiplier)?n.iqr_multiplier:1.5,lower_percentile:p,upper_percentile:_<=p?Math.min(p+1,100):_,manual_bounds:v(n.manual_bounds)}}i&&Array.isArray(i.nodes)&&Array.isArray(i.edges)&&(u.graph={nodes:i.nodes,edges:i.edges}),l&&(u.target_node_id=l);const d=await fetch("/ml-workflow/api/analytics/outliers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!d.ok){const m=await d.text();throw new Error(m||"Failed to load outlier diagnostics")}return d.json()}async function xx(e=8){const t=await fetch(`/ml-workflow/api/datasets?limit=${encodeURIComponent(String(e))}`);if(!t.ok)throw new Error("Failed to load datasets");return t.json()}async function wx(e){const t=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}`);if(t.status===404)return null;if(!t.ok)throw new Error("Failed to load saved pipeline");return t.json()}async function jx(e,t){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to save pipeline");return n.json()}async function Nx(e,t=10){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/history?limit=${encodeURIComponent(String(t))}`);if(n.status===404)return[];if(!n.ok)throw new Error("Failed to load pipeline history");return n.json()}async function Sx(e,t={}){const{offset:n,limit:a,mode:i}=t,l=new URLSearchParams;typeof n=="number"&&Number.isFinite(n)&&l.set("offset",String(n)),typeof a=="number"&&Number.isFinite(a)&&l.set("limit",String(a)),i&&l.set("mode",i);const u=l.toString(),d=`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/preview/rows${u?`?${u}`:""}`,m=await fetch(d);if(!m.ok){const v=await m.text();throw new Error(v||"Failed to load preview rows")}return m.json()}async function Cx(e){const t=await fetch("/ml-workflow/api/pipelines/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const n=await t.text();throw new Error(n||"Failed to load pipeline preview")}return t.json()}const Pg=e=>{if(Array.isArray(e))return e.map(t=>Pg(t));if(e&&typeof e=="object"){const t=Object.keys(e).sort(),n={};return t.forEach(a=>{n[a]=Pg(e[a])}),n}return e},H1=e=>Array.from(new Uint8Array(e)).map(t=>t.toString(16).padStart(2,"0")).join(""),V1=async e=>{if(!globalThis.crypto||!globalThis.crypto.subtle)throw new Error("Secure hashing is not available in this environment");const t=new TextEncoder,n=await globalThis.crypto.subtle.digest("SHA-256",t.encode(e));return H1(n)},W1=e=>{const t=e&&Array.isArray(e.nodes)?e.nodes:[],n=e&&Array.isArray(e.edges)?e.edges:[],a=t.map(l=>{let u=null;if(l&&l.data&&typeof l.data=="object"){const d=l.data.config;if(d!==void 0)try{u=JSON.parse(JSON.stringify(d))}catch{u=d}}return{id:l&&Object.prototype.hasOwnProperty.call(l,"id")?l.id??null:null,type:l&&Object.prototype.hasOwnProperty.call(l,"type")?l.type??null:null,catalogType:l&&l.data&&Object.prototype.hasOwnProperty.call(l.data,"catalogType")?l.data.catalogType??null:null,config:u}}).sort((l,u)=>{const d=typeof l.id=="string"?l.id:String(l.id??""),m=typeof u.id=="string"?u.id:String(u.id??"");return d.localeCompare(m)}),i=n.map(l=>({source:l&&Object.prototype.hasOwnProperty.call(l,"source")?l.source??null:null,target:l&&Object.prototype.hasOwnProperty.call(l,"target")?l.target??null:null,sourceHandle:l&&Object.prototype.hasOwnProperty.call(l,"sourceHandle")?l.sourceHandle??null:null,targetHandle:l&&Object.prototype.hasOwnProperty.call(l,"targetHandle")?l.targetHandle??null:null})).sort((l,u)=>{const d=String(l.source??"").localeCompare(String(u.source??""));return d!==0?d:String(l.target??"").localeCompare(String(u.target??""))});return{nodes:a,edges:i}};async function al(e,t){if(!e)throw new Error("datasetSourceId is required to compute pipeline ID");const n=W1(t),a=JSON.stringify(Pg(n)),i=await V1(a);return`${e}_${i.slice(0,8)}`}async function Ex(e){const t=await fetch("/ml-workflow/api/training-jobs",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to launch training jobs.");const a=await t.text();throw new Error(a||"Failed to enqueue training job")}const n=await t.json();if(n&&Array.isArray(n==null?void 0:n.jobs)){const a=n.jobs,i=typeof n.total=="number"?n.total:a.length;return{jobs:a,total:i}}return n&&n.id?{jobs:[n],total:1}:{jobs:[],total:0}}async function kx(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/training-jobs/${encodeURIComponent(e)}`,{credentials:"include"});if(t.status===404)throw new Error("Training job not found");if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to view this training job.");const n=await t.text();throw new Error(n||"Failed to load training job")}return t.json()}async function gd(e={}){const t=new URLSearchParams;e.datasetSourceId&&t.set("dataset_source_id",e.datasetSourceId),e.pipelineId&&t.set("pipeline_id",e.pipelineId),e.nodeId&&t.set("node_id",e.nodeId),typeof e.limit=="number"&&Number.isFinite(e.limit)&&t.set("limit",String(e.limit));const n=t.toString(),a=await fetch(`/ml-workflow/api/training-jobs${n?`?${n}`:""}`,{credentials:"include"});if(!a.ok){if(a.status===401||a.status===403)throw new Error("Sign in to view training jobs.");const i=await a.text();throw new Error(i||"Failed to load training jobs")}return a.json()}async function Mx(e,t){if(!e)throw new Error("jobId is required for evaluation");const n=await fetch(`/ml-workflow/api/training-jobs/${encodeURIComponent(e)}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t??{})});if(!n.ok){if(n.status===401||n.status===403)throw new Error("Sign in to evaluate this model.");const a=await n.text();throw new Error(a||"Failed to evaluate model")}return n.json()}async function Ax(e){const t=await fetch("/ml-workflow/api/hyperparameter-tuning-jobs",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to launch tuning jobs.");const a=await t.text();throw new Error(a||"Failed to enqueue tuning job")}const n=await t.json();if(n&&Array.isArray(n==null?void 0:n.jobs)){const a=n.jobs,i=typeof n.total=="number"?n.total:a.length;return{jobs:a,total:i}}return n&&n.id?{jobs:[n],total:1}:{jobs:[],total:0}}async function K1(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/hyperparameter-tuning-jobs/${encodeURIComponent(e)}`,{credentials:"include"});if(t.status===404)throw new Error("Tuning job not found");if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to view this tuning job.");const n=await t.text();throw new Error(n||"Failed to load tuning job")}return t.json()}async function _d(e={}){const t=new URLSearchParams;e.datasetSourceId&&t.set("dataset_source_id",e.datasetSourceId),e.pipelineId&&t.set("pipeline_id",e.pipelineId),e.nodeId&&t.set("node_id",e.nodeId),typeof e.limit=="number"&&Number.isFinite(e.limit)&&t.set("limit",String(e.limit));const n=t.toString(),a=await fetch(`/ml-workflow/api/hyperparameter-tuning-jobs${n?`?${n}`:""}`,{credentials:"include"});if(!a.ok){if(a.status===401||a.status===403)throw new Error("Sign in to view tuning jobs.");const i=await a.text();throw new Error(i||"Failed to load tuning jobs")}return a.json()}async function Ox(e){const t={...e,sample_size:0},n=await fetch("/ml-workflow/api/pipelines/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const a=await n.text();throw new Error(a||"Failed to trigger full dataset execution")}return n.json()}async function Tf(e){const t=await fetch(`/ml-workflow/api/model-hyperparameters/${encodeURIComponent(e)}`);if(!t.ok){if(t.status===404)throw new Error(`Model type '${e}' not found`);const n=await t.text();throw new Error(n||"Failed to load model hyperparameters")}return t.json()}async function Px(e,t={}){const n=new URLSearchParams;t.pipelineId&&n.set("pipeline_id",t.pipelineId),t.datasetSourceId&&n.set("dataset_source_id",t.datasetSourceId);const a=n.toString(),i=await fetch(`/ml-workflow/api/hyperparameter-tuning/best-params/${encodeURIComponent(e)}${a?`?${a}`:""}`,{credentials:"include"});if(!i.ok){if(i.status===404)throw new Error(`Model type '${e}' not found`);const l=await i.text();throw new Error(l||"Failed to fetch best hyperparameters")}return i.json()}async function Y1(e,t){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/full-execution/${encodeURIComponent(t)}`);if(!n.ok){const a=await n.text();throw new Error(a||"Failed to fetch full execution status")}return n.json()}const Q1=Object.freeze(Object.defineProperty({__proto__:null,createHyperparameterTuningJob:Ax,createTrainingJob:Ex,evaluateTrainingJob:Mx,fetchBestHyperparameters:Px,fetchBinnedDistribution:yx,fetchBinningRecommendations:_x,fetchDatasets:xx,fetchDropColumnRecommendations:Og,fetchDummyEncodingRecommendations:hx,fetchFullExecutionStatus:Y1,fetchHashEncodingRecommendations:mx,fetchHyperparameterTuningJob:K1,fetchHyperparameterTuningJobs:_d,fetchLabelEncodingRecommendations:cx,fetchModelHyperparameters:Tf,fetchNodeCatalog:lx,fetchOneHotEncodingRecommendations:fx,fetchOrdinalEncodingRecommendations:ux,fetchOutlierDiagnostics:q1,fetchOutlierRecommendations:vx,fetchPipeline:wx,fetchPipelineHistory:Nx,fetchPipelinePreview:Cx,fetchPipelinePreviewRows:Sx,fetchQuickProfile:bx,fetchScalingRecommendations:gx,fetchSkewnessRecommendations:px,fetchTargetEncodingRecommendations:dx,fetchTrainingJob:kx,fetchTrainingJobs:gd,generatePipelineId:al,savePipeline:jx,triggerFullDatasetExecution:Ox},Symbol.toStringTag,{value:"Module"})),G1=({hasDropColumnSource:e,sourceId:t,nodeId:n,graphContext:a,hasReachableSource:i,columnTypeMap:l,setAvailableColumns:u,setColumnSearch:d,setColumnMissingMap:m,setColumnTypeMap:v,setColumnSuggestions:p})=>{const[_,y]=f.useState([]),[w,x]=f.useState(null),[S,k]=f.useState([]),[M,P]=f.useState(null),[T,j]=f.useState(!1),[O,A]=f.useState(null),[z,$]=f.useState(null),[q,V]=f.useState(0),R=f.useRef(l);f.useEffect(()=>{R.current=l},[l]),f.useEffect(()=>{let Y=!0;const K=U=>{k([]),P(U??null),A(null),$(null),j(!1),y([]),x(null),u([]),d(""),m({}),v({}),p({})};return e?t?i?(j(!0),P(null),Og(t,{graph:a,targetNodeId:n??null}).then(U=>{if(!Y)return;const te=Array.isArray(U==null?void 0:U.candidates)?U.candidates:[];k(te),A((U==null?void 0:U.generated_at)??null),$(typeof(U==null?void 0:U.suggested_threshold)=="number"?Number(U.suggested_threshold):null);const W=Array.isArray(U==null?void 0:U.available_filters)?U.available_filters:[];y(W),x(J=>J&&W.some(H=>H.id===J)?J:null);const I={};U&&typeof U=="object"&&(U!=null&&U.column_missing_map)&&typeof U.column_missing_map=="object"&&Object.entries(U.column_missing_map).forEach(([J,H])=>{const Z=String(J??"").trim();if(!Z)return;const ne=Number(H);Number.isFinite(ne)&&(I[Z]=Number(ne))});const Q=new Set;Array.isArray(U==null?void 0:U.all_columns)&&U.all_columns.forEach(J=>{const H=String(J??"").trim();H&&Q.add(H)}),Object.keys(R.current??{}).forEach(J=>Q.add(J));const me=Array.from(Q).sort((J,H)=>J.localeCompare(H));me.forEach(J=>{Object.prototype.hasOwnProperty.call(I,J)||(I[J]=0)}),u(me),d(""),m(I),v(J=>{const H=U==null?void 0:U.column_type_map;if(!H||typeof H!="object")return J;const Z={...J};return Object.entries(H).forEach(([ne,fe])=>{const ae=String(ne??"").trim();if(!ae)return;const pe=String(fe??"").trim();Z[ae]=pe||J[ae]||""}),Z}),p(J=>{const H=U==null?void 0:U.column_recommendations;if(!H||typeof H!="object")return J;const Z={};return Object.entries(H).forEach(([ne,fe])=>{const ae=String(ne??"").trim();if(!ae)return;const pe=Array.isArray(fe)?fe.map(Ve=>String(Ve??"").trim()).filter(Boolean):[];Z[ae]=pe}),Z})}).catch(U=>{Y&&K((U==null?void 0:U.message)??"Unable to load recommendations")}).finally(()=>{Y&&j(!1)}),()=>{Y=!1}):(K("Connect this step to an upstream output to load recommendations."),()=>{Y=!1}):(K(),()=>{Y=!1}):(K(),()=>{Y=!1})},[R,a,e,i,n,q,u,m,d,p,v,t]);const ee=f.useCallback(()=>{!e||!t||!i||V(Y=>Y+1)},[e,i,t]),le=f.useMemo(()=>{const Y=new Map;return _.forEach(K=>{K!=null&&K.id&&Y.set(K.id,K.label)}),Y},[_]),D=f.useCallback(Y=>Y?le.has(Y)?le.get(Y)??null:Y.split("_").filter(Boolean).map(U=>U.charAt(0).toUpperCase()+U.slice(1)).join(" ")||Y:null,[le]),X=f.useMemo(()=>w?S.filter(Y=>Array.isArray(Y==null?void 0:Y.signals)&&Y.signals.includes(w)):S,[w,S]);return{hasDropColumnSource:e,availableFilters:_,activeFilterId:w,setActiveFilterId:x,recommendations:S,filteredRecommendations:X,formatSignalName:D,isFetchingRecommendations:T,recommendationsError:M,recommendationsGeneratedAt:O,suggestedThreshold:z,refreshRecommendations:ee}},X1=({sourceId:e,availableFilters:t,activeFilterId:n,setActiveFilterId:a,recommendations:i,filteredRecommendations:l,isFetchingRecommendations:u,recommendationsError:d,relativeGeneratedAt:m,formatSignalName:v,formatMissingPercentage:p,getPriorityClass:_,getPriorityLabel:y,handleToggleColumn:w,selectedColumns:x})=>{const S=k=>{if(!(k!=null&&k.name))return null;const M=String(k.name),P=x.includes(M),T=_(k.priority),j=y(k.priority),O=Array.isArray(k==null?void 0:k.signals)?k.signals.map(A=>v(A)).filter(A=>!!A):[];return r.jsxs("label",{className:"canvas-modal__checkbox-item",children:[r.jsx("input",{type:"checkbox",checked:P,onChange:()=>w(M)}),r.jsxs("div",{className:"canvas-modal__checkbox-content",children:[r.jsx("div",{className:"canvas-modal__recommendation-name",children:M}),r.jsxs("div",{className:"canvas-modal__recommendation-meta",children:[k.missing_percentage!==void 0&&k.missing_percentage!==null&&r.jsx("span",{children:`Missing: ${p(k.missing_percentage)}`}),T&&j&&r.jsx("span",{className:`canvas-modal__priority-badge canvas-modal__priority-badge--${T}`,children:j})]}),O.length>0&&r.jsx("div",{className:"canvas-modal__signal-badges",children:O.map(A=>r.jsx("span",{className:"canvas-modal__signal-badge",children:A},`${M}-${A}`))}),k.reason&&r.jsx("p",{className:"canvas-modal__recommendation-reason",children:k.reason})]})]},M)};return e?r.jsxs(r.Fragment,{children:[t.length>0&&r.jsxs("div",{className:"canvas-modal__filter-row",role:"group","aria-label":"Recommendation filters",children:[r.jsxs("button",{type:"button",className:`canvas-modal__filter-button${n?"":" canvas-modal__filter-button--active"}`,onClick:()=>a(null),children:["All reasons (",i.length,")"]}),t.map(k=>{const M=n===k.id;return r.jsxs("button",{type:"button",className:`canvas-modal__filter-button${M?" canvas-modal__filter-button--active":""}`,onClick:()=>a(P=>P===k.id?null:k.id),title:k.description??void 0,children:[k.label," (",k.count,")"]},k.id)})]}),u&&r.jsx("p",{className:"canvas-modal__note",children:"Loading column recommendations"}),!u&&d&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:d}),!u&&!d&&r.jsxs(r.Fragment,{children:[m&&r.jsxs("p",{className:"canvas-modal__note",children:["Recommendations generated ",m,"."]}),l.length?r.jsx("div",{className:"canvas-modal__checkbox-list",role:"group","aria-label":"Recommended columns",children:l.map(k=>S(k))}):r.jsx("p",{className:"canvas-modal__note",children:n?"No columns matched this filter in the latest quality scan.":"No columns crossed the missingness threshold in the latest quality scan."})]})]}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Choose a dataset to load EDA-backed column suggestions."})},J1=({thresholdParameter:e,dropIfAnyParameter:t,renderParameterField:n})=>!e&&!t?null:r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Row missingness"})}),e&&n(e),t&&n(t)]}),Z1="first",eM=[{value:"first",label:"Keep first occurrence"},{value:"last",label:"Keep last occurrence"},{value:"none",label:"Drop all duplicates"}],tM=({sourceId:e,hasReachableSource:t,removeDuplicatesColumnsParameter:n,removeDuplicatesKeepParameter:a,renderMultiSelectField:i,removeDuplicatesKeepSelectId:l,removeDuplicatesKeep:u,onKeepChange:d})=>{if(!n&&!a)return null;const m=v=>{const p=v.target.value;d(p==="last"||p==="none"?p:"first")};return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Duplicate handling"})}),r.jsx("p",{className:"canvas-modal__note",children:"Choose comparison columns and decide whether to keep the first row, last row, or drop all duplicates."}),e?t?null:r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to inspect its columns."}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to load the available columns for duplicate checks."}),n&&r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Columns to compare"}),i(n)]}),a&&r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:l,className:"canvas-modal__parameter-label",children:a.label??"Keep strategy"}),a.description&&r.jsx("p",{className:"canvas-modal__parameter-description",children:a.description}),r.jsx("div",{className:"canvas-modal__parameter-control",children:r.jsx("select",{id:l,value:u,onChange:m,children:eM.map(v=>r.jsx("option",{value:v.value,children:v.label},v.value))})})]})]})},ut=e=>Array.isArray(e)?e.map(t=>String(t??"").trim()).filter(t=>t.length>0):[],nM=["float64","Int64","boolean","string","category","datetime64[ns]","object"],sM=({configState:e,setConfigState:t,availableColumns:n,columnTypeMap:a,columnSuggestions:i,selectedColumns:l,previewColumns:u,previewStatus:d,sourceId:m,hasReachableSource:v})=>{const p=f.useMemo(()=>{const j=e==null?void 0:e.column_overrides;if(!j||typeof j!="object"||Array.isArray(j))return{};const O={};return Object.entries(j).forEach(([A,z])=>{const $=String(A??"").trim();if(!$||typeof z!="string")return;const q=z.trim();q&&(O[$]=q)}),O},[e==null?void 0:e.column_overrides]),_=f.useMemo(()=>{const j=e==null?void 0:e.target_dtype;return typeof j=="string"?j.trim():""},[e==null?void 0:e.target_dtype]),y=f.useMemo(()=>{const j=new Set;return n.forEach(A=>j.add(A)),Object.keys(a).forEach(A=>j.add(A)),Object.keys(i).forEach(A=>j.add(A)),Object.keys(p).forEach(A=>j.add(A)),l.forEach(A=>j.add(A)),u.forEach(A=>{typeof A=="string"&&j.add(A)}),Array.from(j).sort((A,z)=>A.localeCompare(z)).map(A=>{const z=a[A]??"Unknown",$=i[A]??[],q=$.length?$[0]:null,V=Object.prototype.hasOwnProperty.call(p,A),R=V?p[A]:null,ee=typeof R=="string"?R.trim():"",le=V?ee:_,D=new Set;le&&D.add(le),$.forEach(W=>D.add(W)),z&&z!=="Unknown"&&D.add(z),_&&D.add(_),nM.forEach(W=>D.add(W));const X=le??"",Y=!!(q&&q!==X),K=!!(q&&q===X),U=l.includes(A),te=Array.from(D).sort((W,I)=>W.localeCompare(I));return{column:A,originalType:z,recommended:q,currentTarget:le,suggestions:$,options:te,hasRecommendationGap:Y,hasOverride:V,usesDefaultTarget:!V,isRecommendationApplied:K,isSelected:U}})},[n,_,p,i,a,u,l]),w=f.useMemo(()=>{const j=y.filter(z=>z.hasRecommendationGap),O=y.filter(z=>!z.hasRecommendationGap),A=[];return j.length&&A.push({key:"needs-attention",label:"Needs attention",rows:j}),O.length&&A.push({key:"all-columns",label:j.length?"Other columns":"All columns",rows:O}),A},[y]),x=f.useMemo(()=>y.filter(j=>j.hasRecommendationGap).length,[y]),S=f.useMemo(()=>x>0,[x]),k=f.useMemo(()=>y.filter(j=>j.isSelected).length,[y]),M=f.useCallback((j,O)=>{const A=j.trim();A&&t(z=>{const $=z.column_overrides&&typeof z.column_overrides=="object"&&!Array.isArray(z.column_overrides)?{...z.column_overrides}:{},q=typeof O=="string"?O.trim():"",V=new Set(ut(z.columns)),R=new Set(ut(z.skipped_columns)),ee=R.delete(A);q?($[A]=q,V.add(A)):delete $[A];const le={...z,columns:Array.from(V).sort((D,X)=>D.localeCompare(X)),column_overrides:$};return ee&&(le.skipped_columns=Array.from(R).sort((D,X)=>D.localeCompare(X))),le})},[t]),P=f.useCallback(()=>{const j=Object.entries(i).filter(([,O])=>O.length>0);j.length&&t(O=>{const A=new Set(ut(O.columns)),z=O.column_overrides&&typeof O.column_overrides=="object"&&!Array.isArray(O.column_overrides)?{...O.column_overrides}:{};return j.forEach(([$,q])=>{const V=$.trim();V&&(A.add(V),q.length&&(z[V]=q[0]))}),{...O,columns:Array.from(A).sort(($,q)=>$.localeCompare(q)),column_overrides:z}})},[i,t]),T=f.useCallback((j,O)=>{O==="__default__"?M(j,null):M(j,O)},[M]);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Column dtype alignment"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:P,disabled:!S,children:"Apply recommendations"})})]}),!m&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to analyse current column dtypes and suggestions."}),m&&!v&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to load dtype insights."}),_?r.jsxs("p",{className:"canvas-modal__note",children:["Global target dtype: ",r.jsx("strong",{children:_}),". Columns inherit this unless an override is set."]}):r.jsx("p",{className:"canvas-modal__note",children:"Set a global target dtype or override individual columns below."}),y.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",y.length," column",y.length===1?"":"s","  ",k," mapped in node selection."]}),S?r.jsxs("p",{className:"canvas-modal__note",children:[x," column",x===1?"":"s"," need attention. Apply them in bulk or adjust individually."]}):y.length>0&&r.jsx("p",{className:"canvas-modal__note",children:"All recommendations are in sync. Fine-tune overrides per column as needed."}),d==="loading"&&!y.length&&r.jsx("p",{className:"canvas-modal__note",children:"Loading column type insights"}),y.length===0?r.jsx("p",{className:"canvas-modal__note",children:"Add columns or refresh the dataset preview to surface dtype intelligence."}):r.jsx("div",{className:"canvas-cast__body",children:w.map(j=>r.jsxs("div",{className:"canvas-cast__group",children:[j.label&&r.jsxs("div",{className:"canvas-cast__group-header",children:[r.jsx("h4",{children:j.label}),r.jsxs("span",{children:[j.rows.length," column",j.rows.length===1?"":"s"]})]}),r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Original dtype"}),r.jsx("th",{scope:"col",children:"Recommended"}),r.jsx("th",{scope:"col",children:"Target dtype"})]})}),r.jsx("tbody",{children:j.rows.map(O=>{const A=["canvas-cast__row"];O.hasRecommendationGap&&A.push("canvas-cast__row--attention"),O.hasOverride&&A.push("canvas-cast__row--override");const z=O.hasOverride?O.currentTarget||"":"__default__",$=O.isRecommendationApplied,q=O.suggestions.slice(1,4),V=O.hasOverride?O.currentTarget?`Override  ${O.currentTarget}`:"Override cleared (uses original dtype)":_?`Inheriting ${_}`:"Retains original dtype until a target is set";return r.jsxs("tr",{className:A.join(" "),children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:O.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[O.isSelected&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),O.hasOverride&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),!O.isSelected&&!O.hasOverride&&r.jsx("span",{className:"canvas-cast__muted",children:"Not yet in node"})]})]})}),r.jsx("td",{children:r.jsx("span",{className:"canvas-cast__muted",children:O.originalType})}),r.jsx("td",{children:O.recommended?r.jsxs("div",{className:"canvas-cast__recommendation",children:[r.jsx("span",{className:`canvas-cast__chip${O.hasRecommendationGap?" canvas-cast__chip--attention":""}${$?" canvas-cast__chip--applied":""}`,children:O.recommended}),r.jsx("span",{className:"canvas-cast__recommendation-note",children:$?"Aligned with target":"Not applied yet"}),q.length>0&&r.jsxs("span",{className:"canvas-cast__suggestions",children:["Other options: ",q.join(", ")]})]}):r.jsx("span",{className:"canvas-cast__muted",children:"No recommendation"})}),r.jsx("td",{children:r.jsxs("div",{className:"canvas-cast__target",children:[r.jsxs("select",{value:z,onChange:R=>T(O.column,R.target.value),children:[r.jsx("option",{value:"__default__",children:_?`Inherit global (${_})`:"No override (use original)"}),O.options.map(R=>r.jsx("option",{value:R,children:R},`${O.column}-${R}`))]}),r.jsx("span",{className:"canvas-cast__target-note",children:V})]})})]},`cast-row-${O.column}`)})})]})})]},`cast-group-${j.key}`))})]})},vd=100,rM=12,aM={limited_full_sample_for_large_dataset:"Preview limited because the dataset is large.",capped_sample_for_large_dataset:"Requested sample size capped for a large dataset.",switched_to_first_last_for_large_dataset:"Using first and last rows to summarize the large dataset.",default_offset:"Offset fallback applied; starting from the beginning.",normalized_negative_offset:"Negative offset normalized to zero.",default_limit:"Using the default preview window size.",normalized_non_positive_limit:"Requested preview size too small; using the minimum window.",capped_limit_for_sample:"Preview window capped to stay within safe limits."},Tx={succeeded:"Completed",deferred:"Deferred",queued:"Queued",running:"In progress",failed:"Failed",skipped:"Skipped",cancelled:"Cancelled"},oM={dataset_too_large:"Full dataset run is executing in the background for large datasets.",memory_error:"Full dataset execution failed because the server ran out of memory.",background_failure:"Background job ended unexpectedly. Check server logs for details."},iM={queued:"Queued",running:"Running",succeeded:"Completed",failed:"Failed",cancelled:"Cancelled"},lM=e=>{switch(e){case"succeeded":case"deferred":case"queued":case"running":case"failed":case"skipped":case"cancelled":return e;default:return"deferred"}},cM=e=>{if(!e)return"";const t=oM[e];if(t)return t;const n=e.replace(/_/g," ").trim();return n?n.charAt(0).toUpperCase()+n.slice(1):e},$x=(e,t)=>{if(!e)return null;const n=e.job_status??null,a=lM(n??e.status??null),i=Tx[n??e.status??a]??Tx[a],l=typeof e.processed_rows=="number"&&e.processed_rows>=0?t(e.processed_rows):null,u=typeof e.total_rows=="number"&&e.total_rows>=0?t(e.total_rows):null;let d=`Full dataset run: ${i}`;a==="running"&&l&&u?d=`Full dataset run: In progress (${l}/${u})`:a==="running"&&l?d=`Full dataset run: In progress (${l} rows)`:a==="succeeded"&&l?d=`Full dataset run: Completed (${l} rows)`:a==="succeeded"&&u&&(d=`Full dataset run: Completed (${u} rows)`);const m=[],v=[],p=n?iM[n]??n:null;if(n==="running"?l&&u?m.push(`Processed ${l} of ${u} rows.`):l?m.push(`Processed ${l} rows.`):u&&m.push(`Processing ${u} rows.`):l?m.push(`Processed ${l} rows.`):u&&m.push(`Total rows ${u}.`),e.reason&&m.push(e.reason),p&&v.push({label:"Background job",value:p}),e.job_id&&v.push({label:"Background job ID",value:e.job_id}),u&&v.push({label:"Dataset rows",value:u}),l&&a!=="queued"&&a!=="skipped"&&v.push({label:"Processed rows",value:l}),typeof e.poll_after_seconds=="number"&&e.poll_after_seconds>0&&v.push({label:"Next status check",value:`${e.poll_after_seconds}s`}),e.last_updated)try{const w=new Date(e.last_updated).toLocaleString();v.push({label:"Last updated",value:w})}catch{v.push({label:"Last updated",value:String(e.last_updated)})}const _=Array.isArray(e.warnings)?e.warnings.map(cM).map(w=>w.trim()).filter(Boolean):[];let y=null;switch(a){case"queued":y=e.reason?e.reason:"Full dataset run queued in background.";break;case"running":y=e.reason?e.reason:"Full dataset run in progress.";break;case"succeeded":if(l){const w=e.processed_rows===1?"":"s";y=`Full dataset run processed ${l} row${w}.`}else u?y=`Full dataset run completed (${u} rows).`:y="Full dataset run completed.";break;case"failed":y=e.reason?`Full dataset run failed: ${e.reason}`:"Full dataset run failed.";break;case"cancelled":y="Full dataset run cancelled.";break;case"skipped":y=e.reason?`Full dataset run skipped: ${e.reason}`:"Full dataset run skipped.";break;case"deferred":y=e.reason?e.reason:"Full dataset run deferred to background processing.";break;default:y=null;break}return{label:d,tone:a,details:m,metadata:v,warnings:_,stepLabel:y,isActive:n==="queued"||n==="running"}},Lx=()=>({status:"idle",columns:[],rows:[],nextOffset:null,hasMore:!1,totalRows:null,samplingAdjustments:[],largeDataset:!1,error:null}),uM=e=>{if(!e)return"";if(e.startsWith("window_mode_fallback:")){const a=e.split(":",2)[1]??"";return a?`Preview mode "${a}" is not supported; falling back to head sampling.`:"Preview mode fallback applied."}const t=aM[e];if(t)return t;const n=e.replace(/_/g," ").trim();return n?n.charAt(0).toUpperCase()+n.slice(1):e},dM=({preview:e,columns:t,rows:n,tableNote:a,formatCellValue:i,formatMetricValue:l,formatMissingPercentage:u,formatNumericStat:d,formatModeStat:m,fullExecutionStepLabel:v,fullExecutionWarnings:p})=>{const _=e==null?void 0:e.metrics,y=Array.isArray(e==null?void 0:e.column_stats)?e.column_stats:[],w=Array.isArray(e==null?void 0:e.row_missing_stats)?e.row_missing_stats:[],x=Array.isArray(e==null?void 0:e.applied_steps)?e.applied_steps:[];let S=x;const k=v||null;if(k){const j=x.findIndex(O=>typeof O=="string"&&O.toLowerCase().startsWith("full dataset run"));j>=0?S=[...x.slice(0,j),k,...x.slice(j+1)]:x.includes(k)||(S=[...x,k])}const M=Array.isArray(e==null?void 0:e.sample_rows)?e.sample_rows:[],P=w.reduce((j,O)=>(O&&typeof O.index=="number"&&(j[O.index]=typeof O.missing_percentage=="number"?O.missing_percentage:0),j),{}),T=M.slice(0,rM);return r.jsxs("div",{className:"canvas-preview",children:[_&&r.jsxs("div",{className:"canvas-preview__metrics",role:"list",children:[r.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[r.jsx("span",{className:"canvas-preview__metric-label",children:"Rows"}),r.jsx("span",{className:"canvas-preview__metric-value",children:l(_.row_count)})]}),r.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[r.jsx("span",{className:"canvas-preview__metric-label",children:"Columns"}),r.jsx("span",{className:"canvas-preview__metric-value",children:l(_.column_count)})]}),r.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[r.jsx("span",{className:"canvas-preview__metric-label",children:"Duplicate rows"}),r.jsx("span",{className:"canvas-preview__metric-value",children:l(_.duplicate_rows)})]}),r.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[r.jsx("span",{className:"canvas-preview__metric-label",children:"Missing cells"}),r.jsx("span",{className:"canvas-preview__metric-value",children:l(_.missing_cells)})]}),r.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[r.jsx("span",{className:"canvas-preview__metric-label",children:"Rows sampled"}),r.jsx("span",{className:"canvas-preview__metric-value",children:l(_.preview_rows)})]}),r.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[r.jsx("span",{className:"canvas-preview__metric-label",children:"Dataset rows"}),r.jsx("span",{className:"canvas-preview__metric-value",children:l(_.total_rows)})]}),r.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[r.jsx("span",{className:"canvas-preview__metric-label",children:"Sample request"}),r.jsx("span",{className:"canvas-preview__metric-value",children:_.requested_sample_size===0?"Full dataset":l(_.requested_sample_size)})]})]}),S.length>0&&r.jsxs("div",{className:"canvas-preview__steps",children:[r.jsx("h4",{children:"Applied steps"}),r.jsx("ol",{children:S.map((j,O)=>r.jsx("li",{children:j},`${j}-${O}`))})]}),t.length>0&&n.length>0?r.jsxs("div",{className:"canvas-preview__table-wrapper",role:"region","aria-label":"Sample rows",children:[r.jsxs("table",{className:"canvas-preview__table",children:[r.jsx("thead",{children:r.jsx("tr",{children:t.map(j=>r.jsx("th",{children:j},j))})}),r.jsx("tbody",{children:n.map((j,O)=>r.jsx("tr",{children:t.map(A=>r.jsx("td",{children:i(j==null?void 0:j[A])},`${O}-${A}`))},`row-${O}`))})]}),a?r.jsx("p",{className:"canvas-modal__note",children:a}):null]}):r.jsx("p",{className:"canvas-modal__note",children:"No sample rows available after applying the upstream steps."}),w.length>0&&T.length>0&&r.jsxs("div",{className:"canvas-preview__row-stats",children:[r.jsx("h4",{children:"Row missingness"}),r.jsx("div",{className:"canvas-preview__row-grid",children:T.map((j,O)=>{const A=P[O]??0,z=A%1===0?0:1;return r.jsxs("div",{className:"canvas-preview__row-chip",children:[r.jsxs("span",{children:["Row ",O+1]}),r.jsxs("strong",{children:[l(A,z),"%"]})]},`row-missing-${O}`)})})]}),y.length>0&&r.jsxs("div",{className:"canvas-preview__column-stats",children:[r.jsx("h4",{children:"Column summary"}),r.jsx("div",{className:"canvas-preview__column-grid",children:y.map(j=>r.jsxs("div",{className:"canvas-preview__column-card",children:[r.jsx("div",{className:"canvas-preview__column-name",children:j.name}),j.dtype&&r.jsxs("div",{className:"canvas-preview__column-detail",children:["Type: ",j.dtype]}),r.jsxs("div",{className:"canvas-preview__column-detail",children:["Missing: ",u(j.missing_percentage)," (",l(j.missing_count),")"]}),typeof j.mean=="number"&&!Number.isNaN(j.mean)&&r.jsxs("div",{className:"canvas-preview__column-detail",children:["Mean: ",d(j.mean)]}),typeof j.median=="number"&&!Number.isNaN(j.median)&&r.jsxs("div",{className:"canvas-preview__column-detail",children:["Median: ",d(j.median)]}),j.mode!==void 0&&j.mode!==null&&j.mode!==""&&r.jsxs("div",{className:"canvas-preview__column-detail",children:["Mode: ",m(j.mode)]}),typeof j.distinct_count=="number"&&r.jsxs("div",{className:"canvas-preview__column-detail",children:["Distinct values: ",l(j.distinct_count)]})]},j.name))})]}),p&&p.length>0&&r.jsxs("div",{className:"canvas-preview__full-execution-warnings",children:[r.jsx("strong",{children:"Full execution notes:"}),r.jsx("ul",{children:p.map((j,O)=>r.jsx("li",{children:j},`${j}-${O}`))})]})]})},mM=({previewState:e,datasetSourceId:t,canTriggerPreview:n,onRefresh:a,formatCellValue:i,formatMetricValue:l,formatMissingPercentage:u,formatNumericStat:d,formatModeStat:m})=>{var K,U,te,W,I;const[v,p]=f.useState(()=>Lx()),[_,y]=f.useState(null),[w,x]=f.useState(!1),S=e.status==="loading",k=S||!n,M=f.useMemo(()=>{var me;const Q=(me=e.data)==null?void 0:me.columns;return Array.isArray(Q)?Q.filter(J=>typeof J=="string"):[]},[(K=e.data)==null?void 0:K.columns]),P=f.useMemo(()=>{var Q;return Array.isArray((Q=e.data)==null?void 0:Q.sample_rows)?e.data.sample_rows.slice(0,vd):[]},[(U=e.data)==null?void 0:U.sample_rows]),T=P.length,j=Array.isArray((te=e.data)==null?void 0:te.sample_rows)?e.data.sample_rows.length:0,O=(W=e.data)==null?void 0:W.metrics,A=f.useMemo(()=>O?j>T||typeof O.total_rows=="number"&&O.total_rows>j:!1,[O,T,j]);f.useEffect(()=>{var me;if(e.status!=="success"||!e.data){p(J=>J.status==="idle"?J:Lx()),y(null);return}const Q=$x((me=e.data.signals)==null?void 0:me.full_execution,l);y(Q),p({status:"ready",columns:[...M],rows:[...P],nextOffset:T,hasMore:A,totalRows:typeof(O==null?void 0:O.total_rows)=="number"?O.total_rows:null,samplingAdjustments:[],largeDataset:!1,error:null})},[M,P,T,A,l,O==null?void 0:O.total_rows,e.data,e.status]),f.useEffect(()=>{var H,Z;if(!_||!_.isActive)return;const Q=(Z=(H=e.data)==null?void 0:H.signals)==null?void 0:Z.full_execution;if(!Q||!Q.job_id||!t)return;const me=typeof Q.poll_after_seconds=="number"&&Q.poll_after_seconds>0?Q.poll_after_seconds*1e3:5e3,J=setTimeout(()=>{Promise.resolve().then(()=>Q1).then(ne=>ne.fetchFullExecutionStatus(t,Q.job_id)).then(ne=>{const fe=$x(ne,l);y(fe),e.data&&{...e.data,signals:{...e.data.signals}}}).catch(ne=>{console.error("Failed to poll background job status:",ne)})},me);return()=>clearTimeout(J)},[_,t,l,e.data]);const z=v.columns.length>0?v.columns:M,$=v.rows.length>0?v.rows:P,q=v.totalRows??(typeof(O==null?void 0:O.total_rows)=="number"?O.total_rows:null),V=v.status==="idle"?A:v.hasMore,R=v.status==="loading",ee=$.length,le=f.useMemo(()=>{if(!ee)return null;const Q=l(ee);if(q!==null&&q>=0){const me=l(q),J=`Loaded ${Q} of ${me} rows.`;return V&&ee<q?`${J} Load more rows to continue.`:!V&&ee<q?`${J} Preview limited by backend settings.`:J}return V?`Loaded ${Q} rows. Additional rows available.`:`Loaded ${Q} rows.`},[V,l,ee,q]),D=f.useMemo(()=>(v.status==="idle"?[]:v.samplingAdjustments).map(uM).map(me=>me.trim()).filter(Boolean),[v.samplingAdjustments,v.status]),X=v.status==="idle"?!1:v.largeDataset,Y=f.useCallback(()=>{var H;if(!t||!V||v.status==="loading")return;const Q=v.rows.length>0?v.rows:P,me=v.status==="idle"?Q.length:v.nextOffset??Q.length,J=Array.isArray((H=e.data)==null?void 0:H.sample_rows)?e.data.sample_rows:[];if(me<J.length){const Z=J.slice(me,me+vd),ne=Q.concat(Z),fe=me+Z.length,ae=fe<J.length||typeof(O==null?void 0:O.total_rows)=="number"&&O.total_rows>J.length;p({status:"ready",columns:v.columns.length>0?v.columns:M,rows:ne,nextOffset:ae?fe:null,hasMore:ae,totalRows:typeof(O==null?void 0:O.total_rows)=="number"?O.total_rows:null,samplingAdjustments:v.samplingAdjustments,largeDataset:v.largeDataset,error:null});return}p(Z=>({...Z,status:"loading",error:null})),Sx(t,{offset:me,limit:vd}).then(Z=>{p(ne=>{const fe=ne.rows.length>0?ne.rows:Q,ae=Array.isArray(Z.columns)&&Z.columns.length>0?Z.columns.map(Pe=>String(Pe)):ne.columns.length>0?ne.columns:M,pe=typeof Z.offset=="number"&&Z.offset>=0?Z.offset:0,Ve=Array.isArray(Z.rows)?Z.rows:[],st=pe<=fe.length?fe.slice(0,pe):fe.slice(),Ke=pe<=fe.length?st.concat(Ve):fe.concat(Ve),mt=Ve.length,yt=!!Z.has_more,Te=typeof Z.next_offset=="number"?Z.next_offset:yt?pe+mt:null,at=typeof Z.total_rows=="number"?Z.total_rows:null,it=yt?null:Ke.length,be=at!==null?at:ne.totalRows!==null?ne.totalRows:it;return{status:"ready",columns:[...ae],rows:Ke,nextOffset:Te,hasMore:yt,totalRows:be,samplingAdjustments:Array.isArray(Z.sampling_adjustments)?Z.sampling_adjustments:[],largeDataset:!!Z.large_dataset,error:null}})}).catch(Z=>{p(ne=>({...ne,status:"error",error:(Z==null?void 0:Z.message)??"Unable to load additional rows."}))})},[M,P,t,V,v,(I=e.data)==null?void 0:I.sample_rows,O]);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsxs("div",{className:"canvas-modal__section-title",children:[r.jsx("h3",{children:"Dataset snapshot"}),_&&r.jsx("div",{className:`canvas-preview__full-execution-badge canvas-preview__full-execution--${_.tone}`,role:"status","aria-live":_.isActive?"polite":"off",title:_.details.length>0?_.details.join(" "):void 0,children:_.label})]}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:a,disabled:k,children:S?"Refreshing":"Refresh"})})]}),_&&r.jsxs("div",{className:"canvas-preview__full-execution-context",children:[_.details.length>0&&r.jsx("ul",{className:"canvas-preview__full-execution-details",children:_.details.map((Q,me)=>r.jsx("li",{children:Q},`${Q}-${me}`))}),_.metadata.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{type:"button",className:"canvas-preview__full-execution-toggle",onClick:()=>x(!w),"aria-expanded":w,children:[w?"":""," ",w?"Hide":"Show"," job details"]}),w&&r.jsx("dl",{className:"canvas-preview__full-execution-meta",children:_.metadata.map((Q,me)=>r.jsxs("div",{className:"canvas-preview__full-execution-meta-item",children:[r.jsx("dt",{children:Q.label}),r.jsx("dd",{children:Q.value})]},`${Q.label}-${Q.value}-${me}`))})]})]}),S&&r.jsx("p",{className:"canvas-modal__note",children:"Generating preview"}),e.status==="error"&&e.error&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:e.error}),e.status==="success"&&e.data&&r.jsx(dM,{preview:e.data,columns:z,rows:$,tableNote:le,formatCellValue:i,formatMetricValue:l,formatMissingPercentage:u,formatNumericStat:d,formatModeStat:m,fullExecutionStepLabel:(_==null?void 0:_.stepLabel)??null,fullExecutionWarnings:(_==null?void 0:_.warnings)??[]}),v.error&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:v.error}),X&&r.jsxs("p",{className:"canvas-modal__note",children:["Large dataset detected. Preview windows are capped at ",l(vd)," rows to stay responsive."]}),D.length>0&&r.jsxs("div",{className:"canvas-modal__note",children:[r.jsx("strong",{children:"Sampling adjustments:"}),r.jsx("ul",{children:D.map((Q,me)=>r.jsx("li",{children:Q},`${Q}-${me}`))})]}),V&&t&&r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Y,disabled:R,children:R?"Loading rows":`Load next ${l(vd)} rows`})}),!V&&!S&&q!==null&&ee>=q&&ee>0&&r.jsx("p",{className:"canvas-modal__note",children:"All available rows have been loaded."})]})},Mc=[{value:"200",label:"200 rows"},{value:"500",label:"500 rows"},{value:"1000",label:"1,000 rows"},{value:"all",label:"Full dataset"}],fM=({node:e,isDatasetProfileNode:t,sourceId:n,hasReachableSource:a,graphContext:i,profilingGraphSignature:l,formatRelativeTime:u})=>{var Y;const[d,m]=f.useState({status:"idle",data:null,error:null}),[v,p]=f.useState(0),[_,y]=f.useState({}),[w,x]=f.useState("500"),[S,k]=f.useState("summary"),[M,P]=f.useState(!1),T=f.useMemo(()=>!t||!n?null:`${n}::${(e==null?void 0:e.id)??""}::${w}::${l}`,[t,e==null?void 0:e.id,l,w,n]),j=f.useMemo(()=>T?_[T]??null:null,[_,T]);f.useEffect(()=>{x("500"),m({status:"idle",data:null,error:null})},[t,e==null?void 0:e.id]),f.useEffect(()=>{if(!t){m({status:"idle",data:null,error:null});return}if(!n){m({status:"error",data:null,error:"Select a dataset to generate a lightweight profile."});return}if(!a){m({status:"error",data:null,error:"Connect this step to an upstream output to generate a profile."});return}if(j){m({status:"success",data:j,error:null});return}let K=!0;m({status:"loading",data:null,error:null});const U=Mc.find(W=>W.value===w)??Mc[1]??Mc[0],te=U.value==="all"?"all":Number(U.value);return bx(n,{sampleSize:te,graph:i,targetNodeId:(e==null?void 0:e.id)??null}).then(W=>{K&&(T&&W&&y(I=>({...I,[T]:W})),m({status:"success",data:W??null,error:null}))}).catch(W=>{K&&m({status:"error",data:null,error:(W==null?void 0:W.message)??"Unable to generate dataset profile"})}),()=>{K=!1}},[j,i,a,t,e==null?void 0:e.id,v,T,w,n]);const O=d.data,A=(O==null?void 0:O.generated_at)??null,z=((Y=O==null?void 0:O.correlations)==null?void 0:Y.length)??0;f.useEffect(()=>{P(!1),k("summary")},[t,A]),f.useEffect(()=>{S==="correlations"&&z===0&&k("summary")},[S,z]);const $=f.useCallback(()=>{T&&y(K=>{if(!Object.prototype.hasOwnProperty.call(K,T))return K;const U={...K};return delete U[T],U}),p(K=>K+1)},[T]),q=f.useMemo(()=>e!=null&&e.id?`profiling-warnings-${e.id}`:"profiling-warnings",[e==null?void 0:e.id]),V=f.useMemo(()=>e!=null&&e.id?`profiling-summary-${e.id}`:"profiling-summary",[e==null?void 0:e.id]),R=f.useMemo(()=>e!=null&&e.id?`profiling-correlations-${e.id}`:"profiling-correlations",[e==null?void 0:e.id]),ee=f.useMemo(()=>e!=null&&e.id?`profiling-summary-tab-${e.id}`:"profiling-summary-tab",[e==null?void 0:e.id]),le=f.useMemo(()=>e!=null&&e.id?`profiling-correlations-tab-${e.id}`:"profiling-correlations-tab",[e==null?void 0:e.id]),D=f.useMemo(()=>Mc.find(K=>K.value===w)??Mc[0],[w]),X=f.useMemo(()=>u((O==null?void 0:O.generated_at)??null),[u,O==null?void 0:O.generated_at]);return{profileState:d,profileData:O,profilingSamplePreset:w,setProfilingSamplePreset:x,profilingActiveTab:S,setProfilingActiveTab:k,isProfilingWarningsOpen:M,setIsProfilingWarningsOpen:P,handleRefreshDatasetProfile:$,activeProfilingSamplePreset:D,profilingWarningsListId:q,profilingSummaryPanelId:V,profilingCorrelationsPanelId:R,profilingSummaryTabId:ee,profilingCorrelationsTabId:le,profilingCorrelationCount:z,relativeProfilingGeneratedAt:X}},hM=({isDatasetProfileNode:e,controller:t,formatCellValue:n,formatNumericStat:a,formatMissingPercentage:i})=>{if(!e)return null;const{profileState:l,profileData:u,profilingSamplePreset:d,setProfilingSamplePreset:m,profilingActiveTab:v,setProfilingActiveTab:p,isProfilingWarningsOpen:_,setIsProfilingWarningsOpen:y,handleRefreshDatasetProfile:w,activeProfilingSamplePreset:x,profilingWarningsListId:S,profilingSummaryPanelId:k,profilingCorrelationsPanelId:M,profilingSummaryTabId:P,profilingCorrelationsTabId:T,profilingCorrelationCount:j,relativeProfilingGeneratedAt:O}=t,A=l.status==="success"&&!!u;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Dataset profile"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsxs("div",{className:"canvas-sample__group",children:[r.jsx("span",{className:"canvas-sample__label",children:"Sample"}),r.jsx("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Profile sampling presets",children:Mc.map(z=>r.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":z.value===d,onClick:()=>m(z.value),disabled:l.status==="loading",children:z.label},z.value))})]}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:w,disabled:l.status==="loading",children:l.status==="loading"?"Refreshing":"Refresh"})]})]}),O&&r.jsxs("span",{className:"canvas-modal__meta",children:["Updated ",O]}),r.jsxs("p",{className:"canvas-modal__note",children:["Sampling preset: ",r.jsx("strong",{children:x.label}),"."]}),l.status==="loading"&&r.jsx("p",{className:"canvas-modal__note",children:"Generating dataset profile"}),l.status==="error"&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:l.error}),A&&u&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"canvas-profiling__meta",children:[r.jsxs("span",{children:["Rows analysed: ",u.rows_analyzed.toLocaleString()]}),r.jsxs("span",{children:["Columns: ",u.columns_analyzed.toLocaleString()]}),r.jsxs("span",{children:["Sample size: ",u.sample_size.toLocaleString()," rows"]}),r.jsxs("span",{children:["Missing cells: ",u.metrics.missing_cells.toLocaleString()]}),r.jsxs("span",{children:["Duplicate rows: ",u.metrics.duplicate_rows.toLocaleString()]})]}),r.jsxs("div",{className:"canvas-profiling__tabs",role:"tablist","aria-label":"Dataset profile views",children:[r.jsx("button",{type:"button",className:"canvas-profiling__tab",id:P,role:"tab","data-active":v==="summary","aria-selected":v==="summary","aria-controls":k,onClick:()=>p("summary"),children:"Summary"}),r.jsx("button",{type:"button",className:"canvas-profiling__tab",id:T,role:"tab","data-active":v==="correlations","aria-selected":v==="correlations","aria-controls":M,onClick:()=>p("correlations"),disabled:!j,children:"Correlations"})]}),v==="summary"&&r.jsxs("div",{className:"canvas-profiling__panel",id:k,role:"tabpanel","aria-labelledby":P,children:[u.warnings&&u.warnings.length>0?r.jsxs("div",{className:"canvas-profiling__warnings",children:[r.jsx("button",{type:"button",className:"canvas-profiling__warnings-toggle",onClick:()=>y(z=>!z),"aria-expanded":_,"aria-controls":S,children:_?"Hide warnings":`Show warnings (${u.warnings.length})`}),_&&r.jsx("ul",{className:"canvas-profiling__warnings-list",id:S,children:u.warnings.map((z,$)=>r.jsx("li",{children:z},`profiling-warning-${$}`))})]}):null,r.jsx("div",{className:"canvas-quick-profile__columns",children:u.columns.map(z=>{const $=z.numeric_summary,q=!!$,V=Array.isArray(z.top_values)?z.top_values:[],R=Array.isArray(z.sample_values)?z.sample_values:[];return r.jsxs("article",{className:"canvas-quick-profile__column","aria-label":`${z.name} summary`,children:[r.jsxs("header",{className:"canvas-quick-profile__column-header",children:[r.jsx("h4",{children:z.name}),r.jsx("span",{className:"canvas-quick-profile__dtype",children:z.semantic_type??z.dtype??"Unknown"})]}),r.jsxs("dl",{className:"canvas-quick-profile__stats",children:[r.jsxs("div",{children:[r.jsx("dt",{children:"Missing"}),r.jsx("dd",{children:`${i(z.missing_percentage)} (${z.missing_count.toLocaleString()})`})]}),r.jsxs("div",{children:[r.jsx("dt",{children:"Distinct"}),r.jsx("dd",{children:z.distinct_count!==null?z.distinct_count.toLocaleString():""})]})]}),q?r.jsxs("div",{className:"canvas-quick-profile__numeric",children:[r.jsx("h5",{children:"Distribution"}),r.jsxs("div",{className:"canvas-quick-profile__numeric-grid",children:[r.jsxs("span",{children:[r.jsx("strong",{children:"Mean"})," ",a($==null?void 0:$.mean)]}),r.jsxs("span",{children:[r.jsx("strong",{children:"Std dev"})," ",a($==null?void 0:$.std)]}),r.jsxs("span",{children:[r.jsx("strong",{children:"Min"})," ",a($==null?void 0:$.minimum)]}),r.jsxs("span",{children:[r.jsx("strong",{children:"Max"})," ",a($==null?void 0:$.maximum)]}),r.jsxs("span",{children:[r.jsx("strong",{children:"P25"})," ",a($==null?void 0:$.percentile_25)]}),r.jsxs("span",{children:[r.jsx("strong",{children:"Median"})," ",a($==null?void 0:$.percentile_50)]}),r.jsxs("span",{children:[r.jsx("strong",{children:"P75"})," ",a($==null?void 0:$.percentile_75)]})]})]}):null,V.length>0?r.jsxs("div",{className:"canvas-quick-profile__top-values",children:[r.jsx("h5",{children:"Top values"}),r.jsx("ul",{children:V.map((ee,le)=>r.jsxs("li",{children:[r.jsx("span",{className:"canvas-quick-profile__value",children:n(ee.value)}),r.jsxs("span",{className:"canvas-quick-profile__count",children:[ee.count.toLocaleString()," (",ee.percentage.toFixed(1),"%)"]})]},`${z.name}-top-${le}`))})]}):null,R.length>0?r.jsxs("div",{className:"canvas-quick-profile__samples",children:[r.jsx("h5",{children:"Sample values"}),r.jsx("ul",{children:R.slice(0,5).map((ee,le)=>r.jsx("li",{children:n(ee)},`${z.name}-sample-${le}`))})]}):null]},z.name)})})]}),v==="correlations"&&r.jsx("div",{className:"canvas-profiling__panel",id:M,role:"tabpanel","aria-labelledby":T,children:r.jsxs("div",{className:"canvas-quick-profile__correlations",children:[r.jsx("h4",{children:"Top correlations"}),u.correlations&&u.correlations.length>0?r.jsxs("table",{className:"canvas-quick-profile__correlation-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column A"}),r.jsx("th",{scope:"col",children:"Column B"}),r.jsx("th",{scope:"col",children:"Coefficient"})]})}),r.jsx("tbody",{children:u.correlations.map((z,$)=>{const q=Math.abs(z.coefficient);let V="low";q>=.85?V="extreme":q>=.7?V="strong":q>=.55&&(V="moderate");const R=z.coefficient>=0?"positive":"negative";return r.jsxs("tr",{children:[r.jsx("td",{children:z.column_a}),r.jsx("td",{children:z.column_b}),r.jsx("td",{className:"canvas-quick-profile__correlation-coefficient","data-strength":V,"data-sign":R,children:z.coefficient.toFixed(2)})]},`profile-correlation-${$}`)})})]}):r.jsx("p",{className:"canvas-quick-profile__correlations-empty",children:"Not enough numeric columns to compute correlations yet."})]})})]})]})},pM=({type:e})=>r.jsx("span",{"aria-hidden":"true",className:`canvas-modal__title-glyph${e==="dataset"?" canvas-modal__title-glyph--dataset":""}`,children:e==="dataset"?"":""}),gM=({title:e,isDataset:t,onClose:n,canResetNode:a=!1,onResetNode:i})=>r.jsxs("div",{className:"canvas-modal__header",children:[r.jsxs("div",{className:"canvas-modal__title-group",children:[r.jsx(pM,{type:t?"dataset":"default"}),r.jsxs("div",{children:[r.jsx("h2",{className:"canvas-modal__title",id:"node-settings-title",children:e}),r.jsx("p",{className:"canvas-modal__subtitle",children:t?"Configure how this dataset feeds the pipeline.":"Adjust parameters to control this transformation."})]})]}),r.jsxs("div",{className:"canvas-modal__header-actions",children:[a&&i&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:i,children:"Reset node"}),r.jsx("button",{type:"button",className:"canvas-modal__close",onClick:n,"aria-label":"Close settings",children:""})]})]}),_M=({onClose:e,canResetNode:t,onResetNode:n,showSaveButton:a,canSave:i,onSave:l,isBusy:u,busyLabel:d})=>r.jsxs("div",{className:"canvas-modal__footer",children:[r.jsx("div",{className:"canvas-modal__footer-status",role:"status","aria-live":"polite","aria-busy":u,children:u&&r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"canvas-modal__footer-spinner","aria-hidden":"true"}),r.jsx("span",{children:d??"Processing"})]})}),r.jsxs("div",{className:"canvas-modal__footer-actions",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:e,children:"Close"}),t&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary canvas-modal__reset",onClick:n,children:"Reset node"}),a&&r.jsx("button",{type:"button",className:"btn btn-primary",onClick:l,disabled:!i,children:"Save changes"})]})]}),$r=(e,t=0)=>e==null?"":new Intl.NumberFormat(void 0,{maximumFractionDigits:t}).format(e),Ss=e=>{if(e==null)return"";const t=Number(e);if(Number.isNaN(t))return"";const n=t%1===0?0:1;return`${t.toFixed(n)}%`},ir=e=>{if(e==null)return"";const t=Number(e);if(Number.isNaN(t))return"";const n=Math.abs(t)>=1?2:4;return $r(t,n)},Dx=e=>e==null||e===""?"":typeof e=="number"?ir(e):String(e),vM=e=>{if(!e)return null;const t=e.toLowerCase();return t==="critical"?"critical":t==="high"?"high":t==="medium"?"medium":null},yM=e=>{if(!e)return null;const t=e.toLowerCase();return t==="critical"?"Critical":t==="high"?"High":t==="medium"?"Medium":e.charAt(0).toUpperCase()+e.slice(1)},bM=5,xM=4,wM=3,jM="_binned",zx="Missing",NM=5,SM="ordinal",CM="quantile",EM=[{value:"equal_width",label:"Equal-width",description:"Uniform bin widths based on min/max range."},{value:"equal_frequency",label:"Equal-frequency",description:"Quantile-based bins with similar row counts in each bucket."},{value:"custom",label:"Custom edges",description:"Provide explicit thresholds and optional labels per column."},{value:"kbins",label:"KBins (sklearn)",description:"Use sklearn KBinsDiscretizer with uniform, quantile, or k-means strategies."}],kM=[{value:"range",label:"Numeric interval (default)"},{value:"bin_index",label:"Index (bin_0, bin_1, )"},{value:"ordinal",label:"Ordinal (Bin 1, Bin 2, )"},{value:"column_suffix",label:"Column suffix (col_binned_1, )"}],Tg={equal_width:"Equal-width",equal_frequency:"Equal-frequency",custom:"Custom edges",kbins:"KBins (sklearn)"},MM=[{value:"keep",label:"Leave as missing"},{value:"label",label:"Replace with label"}],yd=[{value:"500",label:"500 rows (default)"},{value:"10000",label:"10000 rows (detailed)"},{value:"all",label:"Full dataset"}],Rx=e=>{const t=typeof(e==null?void 0:e.strategy)=="string"?e.strategy.trim().toLowerCase():"",n=["equal_width","equal_frequency","custom","kbins"].includes(t)?t:"equal_width",a=ut(e==null?void 0:e.columns),i=(X,Y,K,U)=>{const te=Number(X);if(!Number.isFinite(te))return Y;const W=Math.round(te);return Math.max(K,Math.min(U,W))},l=i(e==null?void 0:e.equal_width_bins,bM,2,200),u=i(e==null?void 0:e.equal_frequency_bins,xM,2,200),d=i(e==null?void 0:e.precision,wM,0,8),m=(e==null?void 0:e.duplicates)==="drop"?"drop":"raise",v=!!((e==null?void 0:e.include_lowest)??!0),p=!!((e==null?void 0:e.drop_original)??!1),y=(typeof(e==null?void 0:e.output_suffix)=="string"?e.output_suffix.trim():"")||jM,w=typeof(e==null?void 0:e.label_format)=="string"?e.label_format.trim().toLowerCase():"",x=["range","bin_index","ordinal","column_suffix"].includes(w)?w:"range",k=(typeof(e==null?void 0:e.missing_strategy)=="string"?e.missing_strategy.trim().toLowerCase():"")==="label"?"label":"keep",M=typeof(e==null?void 0:e.missing_label)=="string"?e.missing_label.trim():"",P=k==="label"&&M||zx,T=i(e==null?void 0:e.kbins_n_bins,NM,2,200),j=typeof(e==null?void 0:e.kbins_encode)=="string"?e.kbins_encode.trim().toLowerCase():"",O=["ordinal","onehot","onehot-dense"].includes(j)?j:SM,A=typeof(e==null?void 0:e.kbins_strategy)=="string"?e.kbins_strategy.trim().toLowerCase():"",z=["uniform","quantile","kmeans"].includes(A)?A:CM,$=X=>{if(!Array.isArray(X))return[];const K=X.map(U=>{if(typeof U=="number")return U;if(U==null)return Number.NaN;const te=String(U).trim();return te?Number(te):Number.NaN}).filter(U=>Number.isFinite(U)).sort((U,te)=>U-te).filter((U,te,W)=>te===0||U!==W[te-1]);return K.length>=2?K:[]},q=X=>Array.isArray(X)?X.map(Y=>String(Y).trim()).filter(Boolean):typeof X=="string"?X.split(/[\,\n]/).map(Y=>Y.trim()).filter(Boolean):[],V=(X,Y,K)=>{if(X==null)return null;const U=Number(X);if(!Number.isFinite(U))return null;const te=Math.round(U);return Math.max(Y,Math.min(K,te))},R={};e!=null&&e.custom_bins&&typeof e.custom_bins=="object"&&!Array.isArray(e.custom_bins)&&Object.entries(e.custom_bins).forEach(([X,Y])=>{const K=String(X??"").trim();if(!K)return;const U=$(Y);U.length>=2&&(R[K]=U)});const ee={};e!=null&&e.custom_labels&&typeof e.custom_labels=="object"&&!Array.isArray(e.custom_labels)&&Object.entries(e.custom_labels).forEach(([X,Y])=>{const K=String(X??"").trim();if(!K)return;const U=q(Y);U.length&&(ee[K]=U)});const le={},D=e!=null&&e.column_strategies&&typeof e.column_strategies=="object"&&!Array.isArray(e.column_strategies)?e.column_strategies:e!=null&&e.column_overrides&&typeof e.column_overrides=="object"&&!Array.isArray(e.column_overrides)?e.column_overrides:null;return D&&Object.entries(D).forEach(([X,Y])=>{const K=String(X??"").trim();if(!K||!Y||typeof Y!="object"||Array.isArray(Y))return;const U=Y,te={},W=typeof U.strategy=="string"?U.strategy.trim().toLowerCase():"";["equal_width","equal_frequency","custom","kbins"].includes(W)&&(te.strategy=W);const I=V(U.equal_width_bins,2,200);I!==null&&(te.equalWidthBins=I);const Q=V(U.equal_frequency_bins,2,200);Q!==null&&(te.equalFrequencyBins=Q);const me=V(U.kbins_n_bins,2,200);me!==null&&(te.kbinsNBins=me);const J=typeof U.kbins_encode=="string"?U.kbins_encode.trim().toLowerCase():"";["ordinal","onehot","onehot-dense"].includes(J)&&(te.kbinsEncode=J);const H=typeof U.kbins_strategy=="string"?U.kbins_strategy.trim().toLowerCase():"";["uniform","quantile","kmeans"].includes(H)&&(te.kbinsStrategy=H);const Z=$(U.custom_bins);Z.length>=2&&(te.customBins=Z);const ne=q(U.custom_labels);ne.length>0&&(te.customLabels=ne),Object.keys(te).length>0&&(le[K]=te)}),{strategy:n,columns:a,equalWidthBins:l,equalFrequencyBins:u,includeLowest:v,precision:d,duplicates:m,outputSuffix:y,dropOriginal:p,labelFormat:x,missingStrategy:k,missingLabel:P,customBins:R,customLabels:ee,columnStrategies:le,kbinsNBins:T,kbinsEncode:O,kbinsStrategy:z}},AM=(e,t,n,a=Tg)=>{if(!e.length)return null;const i=e.map(l=>{const u=t[l],d=(u==null?void 0:u.strategy)??null;if(!d)return l;const m=a[d]??d,v=[];d==="equal_width"&&(u!=null&&u.equalWidthBins)?v.push(`${u.equalWidthBins} bins`):d==="equal_frequency"&&(u!=null&&u.equalFrequencyBins)?v.push(`${u.equalFrequencyBins} bins`):d==="kbins"&&(u!=null&&u.kbinsNBins&&v.push(`${u.kbinsNBins} bins`),u!=null&&u.kbinsStrategy&&v.push(u.kbinsStrategy),u!=null&&u.kbinsEncode&&v.push(u.kbinsEncode));const p=v.length?` (${v.join(", ")})`:"";return`${l} -> ${m}${p}`});return n>e.length&&i.push(""),i.join(", ")},OM=({config:e,fieldIds:t,onIntegerChange:n,onBooleanToggle:a,onSuffixChange:i,onLabelFormatChange:l,onMissingStrategyChange:u,onMissingLabelChange:d})=>r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Global output & labeling"}),r.jsx("p",{className:"canvas-modal__note",children:"Applies to every selected column unless custom bins or labels override the defaults."}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:t.suffix,className:"canvas-modal__parameter-label",children:"Output suffix"}),r.jsx("div",{className:"canvas-modal__parameter-control",children:r.jsx("input",{id:t.suffix,type:"text",className:"canvas-modal__input",value:e.outputSuffix,onChange:m=>i(m.target.value),placeholder:"e.g. _binned"})})]}),r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:t.labelFormat,className:"canvas-modal__parameter-label",children:"Label format"}),r.jsx("div",{className:"canvas-modal__parameter-control",children:r.jsx("select",{id:t.labelFormat,value:e.labelFormat,onChange:m=>l(m.target.value??"range"),children:kM.map(m=>r.jsx("option",{value:m.value,children:m.label},m.value))})}),r.jsx("p",{className:"canvas-modal__parameter-description",children:"Controls how new bin values are named when custom labels arent provided."})]}),r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:t.precision,className:"canvas-modal__parameter-label",children:"Decimal precision"}),r.jsx("div",{className:"canvas-modal__parameter-control",children:r.jsx("input",{id:t.precision,type:"number",className:"canvas-modal__input",min:0,max:8,step:1,value:e.precision,onChange:m=>n("precision",m.target.value,0,8)})}),r.jsx("p",{className:"canvas-modal__parameter-description",children:"Sets rounding precision for interval labels."})]})]}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("label",{htmlFor:t.includeLowest,children:"Include lowest edge"})}),r.jsxs("label",{className:"canvas-modal__boolean-control",children:[r.jsx("input",{id:t.includeLowest,type:"checkbox",checked:e.includeLowest,onChange:m=>a("include_lowest",m.target.checked)}),"Include the minimum value in the first bin"]})]}),r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("label",{htmlFor:t.dropOriginal,children:"Drop original columns"})}),r.jsxs("label",{className:"canvas-modal__boolean-control",children:[r.jsx("input",{id:t.dropOriginal,type:"checkbox",checked:e.dropOriginal,onChange:m=>a("drop_original",m.target.checked)}),"Remove source columns after binning"]})]})]})]}),r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Missing values"}),r.jsx("div",{className:"canvas-skewness__segmented",role:"radiogroup","aria-label":"Missing value handling",children:MM.map(m=>r.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":e.missingStrategy===m.value,onClick:()=>u(m.value),children:m.label},m.value))}),e.missingStrategy==="label"&&r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:t.missingLabel,className:"canvas-modal__parameter-label",children:"Missing label"}),r.jsx("div",{className:"canvas-modal__parameter-control",children:r.jsx("input",{id:t.missingLabel,type:"text",className:"canvas-modal__input",value:e.missingLabel,onChange:m=>d(m.target.value),placeholder:"e.g. Missing"})})]})]})]}),Fx=e=>Tg[e]??e.replace(/_/g," "),PM=e=>{switch(e){case"high":return"High confidence";case"medium":return"Medium confidence";case"low":return"Low confidence";default:return"Confidence unknown"}},TM=(e,t,n)=>{if(!e||typeof e!="object")return"No distribution summary";const a=[];typeof e.valid_count=="number"&&Number.isFinite(e.valid_count)&&a.push(`${t(e.valid_count)} valid rows`),typeof e.distinct_count=="number"&&Number.isFinite(e.distinct_count)&&a.push(`${t(e.distinct_count)} distinct values`);const i=typeof e.minimum=="number"&&Number.isFinite(e.minimum),l=typeof e.maximum=="number"&&Number.isFinite(e.maximum);if(i||l){const u=i?n(e.minimum):"",d=l?n(e.maximum):"";a.push(`Range ${u}  ${d}`)}return typeof e.skewness=="number"&&Number.isFinite(e.skewness)&&a.push(`Skew ${n(e.skewness)}`),a.length?a.join("  "):"No distribution summary"},$M=({hasSource:e,hasReachableSource:t,isFetching:n,error:a,relativeGeneratedAt:i,sampleSize:l,binningConfig:u,binningDefaultLabel:d,binningOverrideCount:m,binningOverrideSummary:v,recommendations:p,excludedColumns:_,numericColumnCount:y,canApplyAllNumeric:w,onApplyAllNumeric:x,onApplyStrategies:S,onClearOverrides:k,customEdgeDrafts:M,customLabelDrafts:P,onOverrideStrategyChange:T,onOverrideNumberChange:j,onOverrideKbinsEncodeChange:O,onOverrideKbinsStrategyChange:A,onOverrideClear:z,onCustomBinsChange:$,onCustomLabelsChange:q,onClearCustomColumn:V,formatMetricValue:R,formatNumericStat:ee})=>{const le=f.useMemo(()=>e?t?n?"Diagnostics are loading":a?"Diagnostics are unavailable at the moment.":y>0?`Detected ${y} numeric column${y===1?"":"s"} in the current sample.`:_.length>0?`Diagnostics skipped ${_.length} column${_.length===1?"":"s"} (see details).`:"No additional diagnostics were produced for the current sample.":"Connect this step to an upstream output to surface diagnostics.":"Select a dataset to surface diagnostics.",[a,_.length,t,e,n,y]),D=f.useMemo(()=>{const W=_.slice(0,6),I=Math.max(0,_.length-W.length);return{preview:W,remaining:I}},[_]),X=f.useMemo(()=>{const W=new Map;return p.forEach(I=>{const Q=typeof(I==null?void 0:I.column)=="string"?I.column.trim():"";Q&&W.set(Q,I)}),W},[p]),Y=f.useMemo(()=>{const W=new Set;return u.columns.forEach(I=>{const Q=String(I??"").trim();Q&&W.add(Q)}),Object.keys(u.columnStrategies).forEach(I=>{const Q=String(I??"").trim();Q&&W.add(Q)}),p.forEach(I=>{const Q=typeof(I==null?void 0:I.column)=="string"?I.column.trim():"";Q&&W.add(Q)}),Array.from(W).sort((I,Q)=>I.localeCompare(Q))},[u.columnStrategies,u.columns,p]),K=(W,I)=>{var Q;return!W||Object.keys(W).length===0?"__default__":W.strategy?W.strategy:(Q=W.customBins)!=null&&Q.length?"custom":W.kbinsNBins||W.kbinsEncode||W.kbinsStrategy?"kbins":W.equalFrequencyBins?"equal_frequency":W.equalWidthBins?"equal_width":I},U=e&&t,te=W=>{var Q,me;if(!W)return[];const I=[];return typeof W.equalWidthBins=="number"&&I.push(`${W.equalWidthBins} bins`),typeof W.equalFrequencyBins=="number"&&I.push(`${W.equalFrequencyBins} bins`),typeof W.kbinsNBins=="number"&&I.push(`${W.kbinsNBins} bins`),W.kbinsStrategy&&I.push(W.kbinsStrategy),W.kbinsEncode&&I.push(W.kbinsEncode),(Q=W.customBins)!=null&&Q.length&&I.push("Custom bins"),(me=W.customLabels)!=null&&me.length&&I.push("Custom labels"),I};return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Binning diagnostics"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:k,disabled:!m,children:"Clear"}),S&&r.jsx("button",{type:"button",className:"btn btn-primary",onClick:S,disabled:!p.length,children:"Quick apply"})]})]}),r.jsx("p",{className:"canvas-modal__note",children:le}),r.jsxs("p",{className:"canvas-modal__note",children:["Default strategy ",r.jsx("strong",{children:d}),m>0?`  Overrides: ${m}${v?` (${v})`:""}`:"  No column overrides yet"]}),r.jsxs("div",{className:"canvas-modal__collapsible",children:[!e&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface binning insights and column diagnostics."}),e&&!t&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric feature distributions."}),U&&r.jsxs(r.Fragment,{children:[i&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",i,l!==null?` on ${R(l)} row${l===1?"":"s"}.`:"."]}),x&&y>0&&r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:x,disabled:!w,children:`Add all numeric columns (${y})`})}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading binning diagnostics"}),a&&!n&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a}),!a&&r.jsxs(r.Fragment,{children:[Y.length>0&&r.jsx("div",{className:"canvas-cast__body",children:r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Suggested strategy"}),r.jsx("th",{scope:"col",children:"Configured strategy"}),r.jsx("th",{scope:"col",children:"Distribution highlights"})]})}),r.jsx("tbody",{children:Y.map(W=>{var ve,xe,Se,$e,Ye;const I=X.get(W)??null,Q=u.columnStrategies[W],me=K(Q,u.strategy),J=me==="__default__"?u.strategy:me,H=(I==null?void 0:I.recommended_strategy)??null,Z=!!(H&&H!==J),ne=!!(Q&&Object.keys(Q).length),fe=u.columns.includes(W),ae=I==null?void 0:I.recommended_bins,pe=typeof ae=="number"?ae:ae!=null?Number(ae):null,Ve=typeof pe=="number"&&Number.isFinite(pe)&&pe>0?pe:null,st=(Q==null?void 0:Q.equalWidthBins)??u.equalWidthBins,Ke=(Q==null?void 0:Q.equalFrequencyBins)??u.equalFrequencyBins,mt=(Q==null?void 0:Q.kbinsNBins)??u.kbinsNBins,yt=(Q==null?void 0:Q.kbinsEncode)??"__default__",Te=(Q==null?void 0:Q.kbinsStrategy)??"__default__",at=["canvas-cast__row"];Z&&at.push("canvas-cast__row--attention"),ne&&at.push("canvas-cast__row--override"),fe||at.push("canvas-cast__row--muted");const it=TM(I==null?void 0:I.stats,R,ee),be=((ve=I==null?void 0:I.reasons)==null?void 0:ve.filter(Ue=>Ue&&Ue.trim()))??[],Pe=(()=>{const Ue=te(Q),Ze=Array.isArray(u.customBins[W])?u.customBins[W].length>=2:!1,Nt=Array.isArray(u.customLabels[W])?u.customLabels[W].length>0:!1,Et=[...Ue];return Ze&&!Et.includes("Custom bins")&&Et.push("Custom bins"),Nt&&!Et.includes("Custom labels")&&Et.push("Custom labels"),Et})(),G=me==="__default__"?`Inheriting ${d}`:`Override  ${Fx(J)}${Pe.length?` (${Pe.join(", ")})`:""}`,ke=(I==null?void 0:I.dtype)??null,Ae=I?PM(I.confidence):null,Ge=Object.prototype.hasOwnProperty.call(M,W)?M[W]:((xe=u.customBins[W])==null?void 0:xe.join(", "))??"",ft=Object.prototype.hasOwnProperty.call(P,W)?P[W]:((Se=u.customLabels[W])==null?void 0:Se.join(", "))??"",zt=((($e=u.customBins[W])==null?void 0:$e.length)??0)>=2||(((Ye=u.customLabels[W])==null?void 0:Ye.length)??0)>0;return r.jsxs("tr",{className:at.join(" "),children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:W}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[ke&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",ke]}),!fe&&r.jsx("span",{className:"canvas-cast__muted",children:"Not currently in node"}),ne&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),Z&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--attention",children:"Needs review"})]})]})}),r.jsx("td",{children:r.jsx("div",{className:"canvas-cast__recommendation",children:I?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"canvas-cast__chip canvas-cast__chip--applied",children:Fx(I.recommended_strategy)}),r.jsxs("span",{className:"canvas-cast__recommendation-note",children:[Ve!==null?`${Ve} bin${Ve===1?"":"s"}`:"Bins not provided",Ae?`  ${Ae}`:""]}),be.length>0&&r.jsx("span",{className:"canvas-cast__recommendation-note",children:be.join("; ")})]}):r.jsx("span",{className:"canvas-cast__muted",children:"No recommendation"})})}),r.jsx("td",{children:r.jsxs("div",{className:"canvas-cast__target",children:[r.jsxs("select",{value:me,onChange:Ue=>T(W,Ue.target.value,{recommendedBins:Ve}),children:[r.jsxs("option",{value:"__default__",children:["Inherit default (",d,")"]}),EM.map(Ue=>r.jsx("option",{value:Ue.value,children:Ue.label},`${W}-${Ue.value}`))]}),r.jsx("span",{className:"canvas-cast__target-note",children:G}),me==="equal_width"&&r.jsx("div",{className:"canvas-cast__target-note",children:r.jsxs("label",{children:["Integer bins",r.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:st??"",onChange:Ue=>j(W,"equal_width_bins",Ue.target.value)})]})}),me==="equal_frequency"&&r.jsx("div",{className:"canvas-cast__target-note",children:r.jsxs("label",{children:["Integer bins",r.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:Ke??"",onChange:Ue=>j(W,"equal_frequency_bins",Ue.target.value)})]})}),me==="kbins"&&r.jsxs("div",{className:"canvas-cast__target-note",children:[r.jsxs("label",{children:["Max bins",r.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:mt??"",onChange:Ue=>j(W,"kbins_n_bins",Ue.target.value)})]}),r.jsxs("label",{children:["Encode",r.jsxs("select",{value:yt,onChange:Ue=>O(W,Ue.target.value==="__default__"?null:Ue.target.value),children:[r.jsxs("option",{value:"__default__",children:["Default (",u.kbinsEncode,")"]}),r.jsx("option",{value:"ordinal",children:"Ordinal"}),r.jsx("option",{value:"onehot",children:"One-hot (sparse)"}),r.jsx("option",{value:"onehot-dense",children:"One-hot (dense)"})]})]}),r.jsxs("label",{children:["Strategy",r.jsxs("select",{value:Te,onChange:Ue=>A(W,Ue.target.value==="__default__"?null:Ue.target.value),children:[r.jsxs("option",{value:"__default__",children:["Default (",u.kbinsStrategy,")"]}),r.jsx("option",{value:"uniform",children:"Uniform"}),r.jsx("option",{value:"quantile",children:"Quantile"}),r.jsx("option",{value:"kmeans",children:"K-means"})]})]})]}),me==="custom"&&r.jsxs("div",{className:"canvas-cast__target-note",children:[r.jsxs("label",{children:["Custom edges",r.jsx("input",{type:"text",className:"canvas-modal__input",value:Ge,placeholder:"e.g. 0, 50, 100",onChange:Ue=>$(W,Ue.target.value)})]}),r.jsxs("label",{children:["Optional labels",r.jsx("input",{type:"text",className:"canvas-modal__input",value:ft,placeholder:"e.g. Low, Medium, High",onChange:Ue=>q(W,Ue.target.value)})]}),zt&&r.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>V(W),children:"Clear custom edges"})]}),ne&&r.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>z(W),children:"Clear"})]})}),r.jsx("td",{children:r.jsx("span",{children:it})})]},`binning-insight-${W}`)})})]})})}),!n&&Y.length===0&&r.jsx("p",{className:"canvas-modal__note",children:"No columns met the sampling requirements for binning recommendations."}),_.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",_.length," column",_.length===1?"":"s"," due to non-numeric values or limited variance",D.preview.length>0&&r.jsxs(r.Fragment,{children:[":"," ",D.preview.map(W=>`${W.column}${W.reason?` (${W.reason})`:""}`).join(", "),D.remaining>0?`,  (+${D.remaining} more)`:""]}),"."]})]})]})]})]})},LM=({cards:e,selectedPreset:t,onSelectPreset:n,isFetching:a,sampleSize:i,relativeGeneratedAt:l,error:u,onRefresh:d,canRefresh:m})=>{const v=f.useMemo(()=>yd.find(p=>p.value===t)??yd[0],[t]);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Binned column distributions"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsxs("div",{className:"canvas-sample__group",children:[r.jsx("span",{className:"canvas-sample__label",children:"Sample"}),r.jsx("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Binned sampling presets",children:yd.map(p=>r.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":p.value===t,onClick:()=>n(p.value),disabled:a,children:p.label},p.value))})]}),l&&r.jsxs("span",{className:"canvas-modal__meta",children:["Updated ",l]}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:d,disabled:a||!m,children:a?"Refreshing":"Refresh"})]})]}),i!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Sampling preset: ",r.jsx("strong",{children:v.label}),"."," ",v.value==="all"?`Summaries computed from the full dataset (${i.toLocaleString()} rows).`:`Summaries computed from ${i.toLocaleString()} sampled rows.`]}),a&&r.jsx("p",{className:"canvas-modal__note",children:"Loading binned distributions"}),!a&&u&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:u}),!a&&!u&&(e.length?r.jsx("div",{className:"canvas-binning__grid",children:e.map(p=>{const _=p.topPercentage!==null?`${p.topPercentage.toFixed(1)}%`:null,y=p.topCount!==null?`${p.topCount.toLocaleString()}${_?`  ${_}`:""}`:_??"";return r.jsxs("article",{className:"canvas-binning__card",children:[r.jsxs("header",{className:"canvas-binning__header",children:[r.jsxs("div",{children:[r.jsx("h4",{children:p.column}),p.sourceColumn&&p.sourceColumn!==p.column&&r.jsxs("p",{className:"canvas-binning__subtitle",children:["Derived from ",r.jsx("strong",{children:p.sourceColumn})]})]}),r.jsxs("div",{className:"canvas-binning__summary","aria-label":"Top bin summary",children:[r.jsx("span",{className:"canvas-binning__summary-label",children:"Top bin"}),r.jsx("span",{className:"canvas-binning__summary-value",children:p.topLabel??""}),r.jsx("span",{className:"canvas-binning__summary-meta",children:y})]})]}),r.jsxs("div",{className:"canvas-binning__meta",children:[r.jsxs("div",{children:[r.jsx("span",{className:"canvas-binning__meta-label",children:"Sample size"}),r.jsx("span",{className:"canvas-binning__meta-value",children:p.totalRows.toLocaleString()})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-binning__meta-label",children:"Distinct bins"}),r.jsx("span",{className:"canvas-binning__meta-value",children:p.distinctBins.toLocaleString()})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-binning__meta-label",children:"Missing rows"}),r.jsx("span",{className:"canvas-binning__meta-value",children:p.missingRows.toLocaleString()})]})]}),r.jsx("div",{className:"canvas-binning__bins",children:p.bins.map(w=>{const x=w.isMissing?"canvas-binning__bin-label canvas-binning__bin-label--missing":"canvas-binning__bin-label",S=Math.min(100,Math.max(0,w.percentage));return r.jsxs("div",{className:"canvas-binning__bin-row",children:[r.jsx("div",{className:x,children:w.label}),r.jsx("div",{className:"canvas-binning__bin-bar","aria-hidden":"true",children:r.jsx("div",{className:"canvas-binning__bin-bar-fill",style:{width:`${S}%`}})}),r.jsxs("div",{className:"canvas-binning__bin-stats",children:[r.jsx("span",{children:w.count.toLocaleString()}),r.jsxs("span",{children:[w.percentage.toFixed(1),"%"]})]})]},`${p.column}-${w.label}`)})}),p.hasMoreBins&&r.jsxs("p",{className:"canvas-binning__note",children:["Showing top ",p.bins.length," of ",p.totalBinCount," bins."]})]},`binned-card-${p.column}`)})}):r.jsx("p",{className:"canvas-modal__note",children:"No binned columns detected upstream. Connect this node after a binning step to view category distributions."}))]})},DM=[{value:"mean",label:"Mean (numeric)"},{value:"median",label:"Median (numeric)"},{value:"mode",label:"Mode (most frequent)"}],zM=[{value:"knn",label:"K-Nearest Neighbors (KNN)"},{value:"regression",label:"Iterative regression"},{value:"mice",label:"MICE (multivariate)"}],RM=[...DM,...zM],FM=[0,5,10,20,40,60],IM=["float","double","int","uint","long","short","byte","number","decimal"],BM=["bool","boolean"],UM=["object","string","category","datetime","date","time"],qM=e=>{const t=typeof e.dtype=="string"?e.dtype.trim().toLowerCase():"";return typeof e.mean=="number"||typeof e.median=="number"||!t?!0:UM.some(n=>t.includes(n))?!1:!!(IM.some(n=>t.includes(n))||BM.some(n=>t.includes(n)))},Ix=e=>e!=="mode",Bx=e=>{if(e==="knn")return{neighbors:5};if(e==="regression"||e==="mice")return{max_iter:10}},bd=(e,t)=>{if(e==="knn"){const n=t==null?void 0:t.neighbors,a=Number(n);return{neighbors:Number.isFinite(a)?Math.max(1,Math.round(a)):5}}if(e==="regression"||e==="mice"){const n=t==null?void 0:t.max_iter,a=Number(n);return{max_iter:Number.isFinite(a)?Math.max(1,Math.round(a)):10}}},Ux=(e,t)=>{if(!Array.isArray(e))return[];const n=t[0]??"mean",a=new Set(t);return e.map(i=>{if(!i||typeof i!="object")return null;const l=typeof i.method=="string"?i.method.trim().toLowerCase():n,u=a.has(l)?l:n;let d=[];Array.isArray(i.columns)?d=i.columns.map(_=>String(_).trim()).filter(Boolean):typeof i.columns=="string"&&(d=i.columns.split(",").map(_=>_.trim()).filter(Boolean));const m=i.options&&typeof i.options=="object"?i.options:{};let v;if(u==="knn"){const _=m.neighbors??i.neighbors,y=Number(_);v={neighbors:Number.isFinite(y)?Math.max(1,Math.round(y)):5}}else if(u==="regression"||u==="mice"){const _=m.max_iter??m.maxIter??i.max_iter??i.maxIter,y=Number(_);v={max_iter:Number.isFinite(y)?Math.max(1,Math.round(y)):10}}const p=bd(u,v??Bx(u));return{method:u,columns:d,options:p}}).filter(i=>!!i)},HM=e=>e.map(t=>{const n={method:t.method,columns:t.columns};return t.options&&Object.keys(t.options).length&&(n.options={...t.options}),n}),VM=({hasSource:e,hasReachableSource:t,strategies:n,columnOptions:a,methodOptions:i,missingFilter:l,missingFilterMax:u,missingFilterActive:d,filteredOptionCount:m,collapsedStrategies:v,onToggleStrategy:p,onRemoveStrategy:_,onAddStrategy:y,onMethodChange:w,onOptionNumberChange:x,onColumnsChange:S,onColumnToggle:k,onMissingFilterChange:M,formatMissingPercentage:P,formatNumericStat:T,formatModeStat:j,schemaDiagnostics:O})=>{const A=Oe.useMemo(()=>{var V;return(V=O==null?void 0:O.entries)!=null&&V.length?new Map(O.entries.map(R=>[R.index,R])):new Map},[O]),z=Math.max(u,l||0),$=a.length>0,q=V=>{var ee,le,D;const R=((ee=i.find(X=>X.value===V.method))==null?void 0:ee.label)??V.method;return V.method==="knn"&&((le=V.options)!=null&&le.neighbors)?`${R}  k=${V.options.neighbors}`:(V.method==="regression"||V.method==="mice")&&((D=V.options)!=null&&D.max_iter)?`${R}  ${V.options.max_iter} iter`:R};return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Imputation strategies"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:y,children:"Add strategy"})})]}),!e&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface missingness insights and recommended columns."}),e&&!t&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to load missingness insights."}),(O==null?void 0:O.blocked)&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:O.message}),a.length>0&&r.jsxs("div",{className:"canvas-imputer__filter",role:"group","aria-label":"Filter columns by missing percentage",children:[r.jsxs("div",{className:"canvas-imputer__filter-top",children:[r.jsx("label",{htmlFor:"imputer-missing-filter",children:"Minimum missing percentage"}),r.jsxs("span",{className:"canvas-imputer__filter-summary",children:["Showing ",m," of ",a.length," column",a.length===1?"":"s"]})]}),r.jsxs("div",{className:"canvas-imputer__filter-controls",children:[r.jsx("input",{id:"imputer-missing-filter",type:"range",min:0,max:z,step:1,value:l,onChange:V=>M(Number(V.target.value)),className:"canvas-imputer__filter-range"}),r.jsxs("span",{className:"canvas-imputer__filter-value",children:["",r.jsxs("strong",{children:[l,"%"]})," missing"]}),r.jsx("button",{type:"button",className:"canvas-imputer__filter-reset",onClick:()=>M(0),disabled:!l,children:"Clear"})]}),r.jsx("div",{className:"canvas-imputer__filter-presets",children:FM.map(V=>r.jsxs("button",{type:"button",className:`canvas-imputer__filter-button${l===V?" canvas-imputer__filter-button--active":""}`,onClick:()=>M(V),children:["",V,"%"]},`imputer-missing-preset-${V}`))})]}),n.length?r.jsx("div",{className:"canvas-imputer__list",children:n.map((V,R)=>{var Q,me,J;const ee=V.columns.join(", "),le=Ix(V.method),D=a.filter(H=>{if(V.columns.includes(H.name))return!0;if(le&&!qM(H))return!1;const Z=typeof H.missingPercentage=="number"?H.missingPercentage:null;return Z!==null?Z<=0?!1:Z>=l:l===0}),X=q(V),Y=V.columns.length?`${V.columns.length} column${V.columns.length===1?"":"s"}`:"No columns yet",K=v.has(R),U=D.filter(H=>!V.columns.includes(H.name)),te=A.get(R),W=(Q=te==null?void 0:te.details)!=null&&Q.length?te.details.map(H=>H.logical_family?`${H.name} (${H.logical_family})`:H.name).join(", "):"",I=()=>{if(!D.length)return;const H=[...V.columns];D.forEach(Z=>{H.includes(Z.name)||H.push(Z.name)}),S(R,H.join(", "))};return r.jsxs("div",{className:"canvas-imputer__card",children:[r.jsxs("div",{className:"canvas-imputer__card-header",children:[r.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>p(R),"aria-expanded":!K,"aria-controls":`imputer-strategy-body-${R}`,children:[r.jsx("span",{className:`canvas-imputer__toggle-icon${K?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),r.jsxs("span",{className:"canvas-imputer__card-text",children:[r.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",R+1]}),r.jsxs("span",{className:"canvas-imputer__card-summary",children:[X,"  ",Y]})]})]}),r.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>_(R),"aria-label":`Remove strategy ${R+1}`,children:"Remove"})]}),!K&&r.jsxs("div",{className:"canvas-imputer__card-body",id:`imputer-strategy-body-${R}`,children:[r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Method"}),r.jsx("select",{value:V.method,onChange:H=>w(R,H.target.value??"mean"),children:i.map(H=>r.jsx("option",{value:H.value,children:H.label},H.value))})]}),V.method==="knn"&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Neighbors (k)"}),r.jsx("input",{type:"number",className:"canvas-imputer__columns-input",min:1,max:50,step:1,value:((me=V.options)==null?void 0:me.neighbors)??5,onChange:H=>x(R,"neighbors",H.target.value)})]}),(V.method==="regression"||V.method==="mice")&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Max iterations"}),r.jsx("input",{type:"number",className:"canvas-imputer__columns-input",min:1,max:100,step:1,value:((J=V.options)==null?void 0:J.max_iter)??10,onChange:H=>x(R,"max_iter",H.target.value)})]}),V.method==="mice"&&r.jsx("p",{className:"canvas-modal__note",children:"MICE performs chained regressions with posterior sampling for robust imputations."}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Columns"}),W&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Remove or recast columns before applying this strategy: ",W,"."]}),D.length>0&&U.length>0&&r.jsx("button",{type:"button",className:"btn btn-link",onClick:I,children:"Select all columns"}),D.length?r.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Columns eligible for imputation",children:D.map(H=>{const Z=V.columns.includes(H.name),ne=P(H.missingPercentage),fe=typeof H.mean=="number",ae=typeof H.median=="number",pe=H.mode!==null&&H.mode!==void 0&&H.mode!=="",Ve=fe||ae||pe;return r.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${Z?" canvas-imputer__column-pill--selected":""}`,onClick:()=>k(R,H.name),"aria-pressed":Z,children:[r.jsx("span",{className:"canvas-imputer__column-pill-name",children:H.name}),r.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[r.jsxs("span",{className:"canvas-imputer__column-pill-metric",children:["Missing: ",ne]}),H.dtype&&r.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:H.dtype})]}),Ve&&r.jsxs("div",{className:"canvas-imputer__column-pill-stats",children:[fe&&r.jsxs("span",{children:["Mean: ",T(H.mean)]}),ae&&r.jsxs("span",{children:["Median: ",T(H.median)]}),pe&&r.jsxs("span",{children:["Mode: ",j(H.mode)]})]})]},H.name)})}):r.jsx("p",{className:"canvas-modal__note",children:$?d?"No columns meet the current missingness filter. Lower the threshold or add manual columns below.":"No columns with missing values detected. Add columns manually or adjust upstream steps.":"Column catalog unavailable; enter names manually below."})]}),r.jsx("div",{className:`canvas-imputer__selected${V.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:V.columns.length?V.columns.map(H=>r.jsx("span",{className:"canvas-imputer__selected-chip",children:H},H)):r.jsx("span",{children:"No columns selected yet."})}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Manual columns (optional)"}),r.jsx("input",{type:"text",className:"canvas-imputer__columns-input",value:ee,onChange:H=>S(R,H.target.value),placeholder:"Add custom columns, separated by commas","aria-label":"Manual column entry"})]}),r.jsx("p",{className:"canvas-modal__note",children:"Tap columns above to toggle them. Missing % reflects the latest row-level preview, and manual entry lets you include custom fields."})]})]},`imputer-strategy-${R}`)})}):r.jsx("p",{className:"canvas-modal__note",children:"Define one or more strategies to fill missing values. Each strategy targets a set of columns and a method."})]})},Lr=["standard","robust","minmax","maxabs"],ol={standard:"Standard scaler",robust:"Robust scaler",minmax:"MinMax scaler",maxabs:"MaxAbs scaler"},qx={high:"High confidence",medium:"Moderate confidence",low:"Exploratory"},Hx=e=>Array.isArray(e)?Array.from(new Set(e.map(t=>String(t??"").trim()).filter(Boolean))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?Array.from(new Set(e.split(",").map(t=>t.trim()).filter(Boolean))).sort((t,n)=>t.localeCompare(n)):[],Vx=e=>{const t=e&&typeof e=="object"&&!Array.isArray(e)?e:{},n=Hx(t.columns),a=typeof t.default_method=="string"?t.default_method.trim().toLowerCase():"",i=Lr.includes(a)?a:"standard",l={},u=t.column_methods;u&&typeof u=="object"&&!Array.isArray(u)&&Object.entries(u).forEach(([v,p])=>{const _=String(v??"").trim(),y=typeof p=="string"?p.trim().toLowerCase():"";_&&Lr.includes(y)&&(l[_]=y)});const d=typeof t.auto_detect=="boolean"?t.auto_detect:!0,m=Hx(t.skipped_columns);return{columns:n,defaultMethod:i,columnMethods:l,autoDetect:d,skippedColumns:m}},WM=e=>{const t={...ol};return Array.isArray(e)&&e.forEach(n=>{const a=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null,i=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";a&&Lr.includes(a)&&i&&(t[a]=i)}),t},KM=e=>{const t=new Map;return Array.isArray(e)&&e.forEach(n=>{const a=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null;a&&Lr.includes(a)&&t.set(a,n)}),t},YM=e=>Lr.map(t=>({value:t,label:e[t]??ol[t]??t})),QM=({recommendations:e,scalingConfig:t,scalingMethodLabelMap:n,scalingSelectedSet:a,scalingSkippedColumns:i,scalingExcludedColumns:l})=>{if(!e.length)return[];const u=[];return e.forEach(d=>{const m=String((d==null?void 0:d.column)??"").trim();if(!m)return;const v=d.recommended_method,p=n[v]??ol[v]??v,_=Array.isArray(d.fallback_methods)?d.fallback_methods.filter(A=>Lr.includes(A)).map(A=>{const z=A;return n[z]??ol[z]??z}):[],y=d.confidence??"medium",w=qx[y]??qx.medium,S=t.columnMethods[m]??null,k=S??t.defaultMethod,M=n[k]??ol[k]??k,P=l.has(m),T=i.has(m),j=a.has(m),O=d.stats;u.push({column:m,dtype:d.dtype??null,recommendedMethod:v,recommendedLabel:p,confidence:y,confidenceLabel:w,reasons:Array.isArray(d.reasons)?d.reasons:[],fallbackLabels:_,stats:O,hasMissing:!!d.has_missing,currentOverride:S,currentMethod:k,currentMethodLabel:M,isOverrideApplied:S!==null,isSelected:j,isExcluded:P,isSkipped:T})}),u.sort((d,m)=>d.column.localeCompare(m.column)),u},GM=(e,t,n,a)=>{if(!e.length)return null;const i=e.map(l=>{const u=t[l],d=u?n[u]??ol[u]??u:null;return d?`${l} -> ${d}`:l});return a>e.length&&i.push(""),i.join(", ")},XM=({sourceId:e,hasReachableSource:t,isFetchingScaling:n,scalingConfig:a,scalingMethodOptions:i,scalingMethodDetailMap:l,scalingDefaultDetail:u,scalingAutoDetectEnabled:d,scalingSelectedCount:m,scalingDefaultLabel:v,scalingOverrideCount:p,scalingOverrideExampleSummary:_,scalingRecommendationRows:y,scalingHasRecommendations:w,scalingStatusMessage:x,scalingError:S,scalingSampleSize:k,relativeScalingGeneratedAt:M,formatMetricValue:P,formatNumericStat:T,formatMissingPercentage:j,onApplyAllRecommendations:O,onClearOverrides:A,onDefaultMethodChange:z,onAutoDetectToggle:$,onOverrideSelect:q})=>{const V=u??l.get(a.defaultMethod)??null;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Scaling insights"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsx("button",{type:"button",className:"btn btn-primary",onClick:O,disabled:!w,children:"Apply recommendations"}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:A,disabled:!p,children:"Clear overrides"})]})]}),r.jsxs("p",{className:"canvas-modal__note",children:["Automatically select scaling strategies for numeric features to keep model inputs in comparable ranges. Edits here refresh the preview immediately so you can inspect the effect, but nothing is committed to your pipeline until you click ",r.jsx("strong",{children:"Save changes"})," at the bottom of this modal."]}),!e&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface scaling insights and column recommendations."}),e&&!t&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric feature distributions."}),M&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",M,k!==null?` on ${P(k)} row${k===1?"":"s"}.`:"."]}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("span",{children:"Default scaling method"})}),r.jsx("div",{className:"canvas-scaling__method-toggle",role:"group","aria-label":"Default scaling method",children:i.map(R=>{const ee=l.get(R.value)??null,le=R.value===a.defaultMethod;return r.jsxs("button",{type:"button",className:`canvas-scaling__method-button${le?" canvas-scaling__method-button--active":""}`,"aria-pressed":le,onClick:()=>z(R.value),children:[r.jsx("span",{className:"canvas-scaling__method-label",children:R.label}),(ee==null?void 0:ee.description)&&r.jsx("span",{className:"canvas-scaling__method-description",children:ee.description})]},R.value)})}),(V==null?void 0:V.description)&&r.jsx("p",{className:"canvas-modal__parameter-description",children:V.description})]}),r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("span",{children:"Auto-detect numeric columns"})}),r.jsxs("label",{className:"canvas-modal__boolean-control",children:[r.jsx("input",{type:"checkbox",checked:d,onChange:R=>$(R.target.checked)}),r.jsx("span",{children:d?"Enabled":"Disabled"})]}),r.jsx("p",{className:"canvas-modal__parameter-description",children:"When enabled, recommended numeric features join this node automatically after each refresh."})]})]}),r.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",r.jsx("strong",{children:m})," column",m===1?"":"s"," in this node  Default method"," ",r.jsx("strong",{children:v})," ",d?" Auto-detect on":" Auto-detect off",p>0?`  Overrides: ${p}${_?` (${_})`:""}`:"  No column overrides yet"]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading scaling diagnostics"}),!n&&S&&e&&t&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:S}),!n&&!S&&r.jsxs(r.Fragment,{children:[x&&r.jsx("p",{className:"canvas-modal__note",children:x}),y.length>0&&r.jsx("div",{className:"canvas-cast__body",children:r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table canvas-scaling__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Recommendation"}),r.jsx("th",{scope:"col",children:"Distribution"}),r.jsx("th",{scope:"col",children:"Configured method"})]})}),r.jsx("tbody",{children:y.map(R=>{const ee=!R.isSkipped&&R.recommendedMethod!==R.currentMethod,le=["canvas-cast__row"];ee&&le.push("canvas-cast__row--attention"),R.isOverrideApplied&&le.push("canvas-cast__row--override"),R.isSkipped&&le.push("canvas-cast__row--muted");const D=R.isSkipped?"__skip__":R.isOverrideApplied?R.currentMethod:"__default__",X=R.isOverrideApplied?`Override -> ${R.currentMethodLabel}`:R.isSkipped?"Skipped (column will not be scaled)":R.isSelected?`Inheriting ${v}`:"Pending inclusion",Y=R.stats,K=[];typeof Y.valid_count=="number"&&Number.isFinite(Y.valid_count)&&K.push(`${P(Y.valid_count)} valid rows`),typeof Y.mean=="number"&&Number.isFinite(Y.mean)&&K.push(`Mean ${T(Y.mean)}`),typeof Y.median=="number"&&Number.isFinite(Y.median)&&K.push(`Median ${T(Y.median)}`),typeof Y.stddev=="number"&&Number.isFinite(Y.stddev)&&K.push(` ${T(Y.stddev)}`),typeof Y.iqr=="number"&&Number.isFinite(Y.iqr)&&K.push(`IQR ${T(Y.iqr)}`);const U=typeof Y.minimum=="number"&&Number.isFinite(Y.minimum),te=typeof Y.maximum=="number"&&Number.isFinite(Y.maximum);if(U||te){const I=U?T(Y.minimum):"",Q=te?T(Y.maximum):"";K.push(`Range ${I}  ${Q}`)}typeof Y.skewness=="number"&&Number.isFinite(Y.skewness)&&K.push(`Skew ${T(Y.skewness)}`),typeof Y.outlier_ratio=="number"&&Number.isFinite(Y.outlier_ratio)&&Y.outlier_ratio>0&&K.push(`${j(Y.outlier_ratio*100)} outliers`);const W=K.length?K.join("  "):null;return r.jsxs("tr",{className:le.join(" "),children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:R.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[R.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",R.dtype]}),R.isExcluded&&r.jsx("span",{className:"canvas-cast__muted",children:"Excluded from scaling (non-numeric)"}),R.isSelected&&!R.isExcluded&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),R.isSkipped&&!R.isExcluded&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--skipped",children:"Skipped"}),R.isOverrideApplied&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"})]})]})}),r.jsx("td",{children:r.jsxs("div",{className:"canvas-cast__recommendation",children:[r.jsx("span",{className:`canvas-cast__chip${ee?" canvas-cast__chip--attention":" canvas-cast__chip--applied"}`,children:R.recommendedLabel}),r.jsx("span",{className:"canvas-cast__recommendation-note",children:R.confidenceLabel}),R.reasons.length>0&&r.jsx("span",{className:"canvas-cast__recommendation-note",children:R.reasons.join("; ")})]})}),r.jsx("td",{children:W?r.jsx("span",{children:W}):r.jsx("span",{className:"canvas-cast__muted",children:"No distribution summary"})}),r.jsx("td",{children:r.jsxs("div",{className:"canvas-cast__target",children:[r.jsxs("select",{value:D,onChange:I=>q(R.column,I.target.value),children:[r.jsxs("option",{value:"__default__",children:["Inherit default (",v,")"]}),r.jsx("option",{value:"__skip__",children:"Skip scaling for this column"}),i.map(I=>r.jsx("option",{value:I.value,children:I.label},`${R.column}-${I.value}`))]}),r.jsx("span",{className:"canvas-cast__target-note",children:X})]})})]},`scaling-row-${R.column}`)})})]})})})]})]})},$f=["log","square_root","cube_root","reciprocal","square","exponential","box_cox","yeo_johnson"],JM="log",uo=e=>typeof e=="string"&&$f.includes(e),Wx=e=>Array.isArray(e)?e.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"",a=typeof t.method=="string"?t.method.trim():"";if(!n)return null;const i=uo(a)?a:JM;return{column:n,method:i}}).filter(t=>!!t):[],$g=e=>{const t=new Set,n=[];return e.forEach(a=>{const i=`${a.column}__${a.method}`;t.has(i)||(t.add(i),n.push(a))}),n},Kx={left:"Left skew",right:"Right skew"},ZM={log:"Logarithmic",square_root:"Square Root",cube_root:"Cube Root",reciprocal:"Reciprocal (Inverse)",square:"Square",exponential:"Exponential",box_cox:"BoxCox",yeo_johnson:"YeoJohnson"},eA=e=>{const t={...ZM};return Array.isArray(e)&&e.forEach(n=>{const a=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():"",i=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";!a||!i||uo(a)&&(t[a]=i)}),t},tA=({viewMode:e,recommendations:t,columnOptions:n,recommendationMap:a,transformationMap:i})=>{const l=e==="recommended"?t.map(m=>m!=null&&m.column?m.column:null).filter(m=>!!m):n,u=new Set,d=[];return l.forEach(m=>{const v=typeof m=="string"?m.trim():"";if(!v||u.has(v))return;u.add(v);const p=a.get(v)??null,_=p?p.recommended_methods.filter(uo):[],y=_.length?_[0]:null,w=p!=null&&p.direction?Kx[p.direction]??p.direction:null,x=p!=null&&p.magnitude?`${p.magnitude.charAt(0).toUpperCase()}${p.magnitude.slice(1)}`:null,S=p&&typeof p.skewness=="number"&&Number.isFinite(p.skewness)?p.skewness:null,k=(p==null?void 0:p.summary)??null,M=i.get(v)??null;d.push({column:v,recommendedMethods:_,primaryMethod:y,directionLabel:w,magnitudeLabel:x,skewnessValue:S,summary:k,selectedMethod:M})}),d.sort((m,v)=>{const p=typeof m.skewnessValue=="number"?Math.abs(m.skewnessValue):-1/0,_=typeof v.skewnessValue=="number"?Math.abs(v.skewnessValue):-1/0;if(p!==_)return _-p;const y=!!m.primaryMethod,w=!!v.primaryMethod;return y!==w?y?-1:1:m.column.localeCompare(v.column)}),d},nA=(e,t,n)=>{if(!t)return[{key:"all",label:null,method:null,rows:e}];const a="no-recommendation",i=new Map;e.forEach(u=>{const d=u.primaryMethod??null,m=d??a,v=d?n(d):"No recommended action",p=i.get(m)??{key:m,label:v,method:d,rows:[]};p.rows.push(u),i.set(m,p)});const l=Array.from(i.values());return l.sort((u,d)=>{const m=y=>y?$f.indexOf(y):$f.length,v=m(u.method)-m(d.method);if(v!==0)return v;if(u.rows.length!==d.rows.length)return d.rows.length-u.rows.length;const p=u.label??"",_=d.label??"";return p.localeCompare(_)}),l},sA=({sourceId:e,hasReachableSource:t,isFetchingSkewness:n,skewnessThreshold:a,skewnessError:i,skewnessViewMode:l,skewnessRecommendedCount:u,skewnessNumericCount:d,skewnessGroupByMethod:m,skewnessRows:v,skewnessTableGroups:p,hasSkewnessAutoRecommendations:_,skewnessTransformationsCount:y,isFetchingRecommendations:w,getSkewnessMethodLabel:x,getSkewnessMethodStatus:S,onApplyRecommendations:k,onViewModeChange:M,onGroupByToggle:P,onOverrideChange:T,onClearSelections:j})=>r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Skewness insights"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:k,disabled:w||!_,children:"Apply recommendations"})})]}),a!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns with |skewness|  ",a.toFixed(2)," are surfaced below."]}),n&&v.length===0&&r.jsx("p",{className:"canvas-modal__note",children:"Loading skewness diagnostics"}),!n&&i&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:i}),(!n||v.length>0)&&!i&&r.jsxs("div",{className:"canvas-skewness__body",children:[r.jsxs("div",{className:"canvas-skewness__toolbar",children:[r.jsxs("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Skewness view",children:[r.jsxs("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":l==="recommended",onClick:()=>M("recommended"),disabled:!u,children:["Recommended (",u,")"]}),r.jsxs("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":l==="all",onClick:()=>M("all"),disabled:!d,children:["All numeric (",d,")"]})]}),r.jsxs("label",{className:"canvas-skewness__toggle",children:[r.jsx("input",{type:"checkbox",checked:m,onChange:O=>P(O.target.checked)}),"Group columns by recommended action"]})]}),v.length===0?r.jsx("p",{className:"canvas-modal__note",children:l==="recommended"?"No columns met the skewness threshold for recommendations. Switch to All numeric to configure overrides manually.":"No numeric columns available for skewness review."}):r.jsx("div",{className:"canvas-skewness__table-wrapper",children:p.map(O=>r.jsxs("div",{className:"canvas-skewness__group",children:[O.label&&r.jsxs("div",{className:"canvas-skewness__group-header",children:[r.jsx("h4",{children:O.label}),r.jsxs("span",{children:[O.rows.length," column",O.rows.length===1?"":"s"]})]}),r.jsx("div",{className:"canvas-skewness__table-scroll",children:r.jsxs("table",{className:"canvas-skewness__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Suggested transform"}),r.jsx("th",{scope:"col",children:"Skewness level"}),r.jsx("th",{scope:"col",children:"Override"})]})}),r.jsx("tbody",{children:O.rows.map(A=>{const z=[];A.directionLabel&&z.push(A.directionLabel),A.skewnessValue!==null&&z.push(`(${A.skewnessValue.toFixed(2)})`),A.magnitudeLabel&&z.push(` ${A.magnitudeLabel}`);const $=z.length?z.join(" "):"",q=A.selectedMethod??"",V=new Set(A.recommendedMethods),R=[{value:"",label:"No transform",status:null,reason:null}];A.recommendedMethods.forEach(D=>{const X=S(A.column,D);R.push({value:D,label:`${x(D)}${D===A.primaryMethod?" (recommended)":""}`,status:X,reason:(X==null?void 0:X.reason)??null})}),$f.forEach(D=>{if(V.has(D))return;const X=S(A.column,D);R.push({value:D,label:x(D),status:X,reason:(X==null?void 0:X.reason)??null})});const ee=A.selectedMethod?S(A.column,A.selectedMethod):null,le=!A.selectedMethod&&A.primaryMethod?S(A.column,A.primaryMethod):null;return r.jsxs("tr",{className:`canvas-skewness__row${A.selectedMethod?" canvas-skewness__row--active":""}`,children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-skewness__column-cell",children:[r.jsx("span",{className:"canvas-skewness__column-name",children:A.column}),A.summary&&r.jsx("span",{className:"canvas-skewness__column-summary",children:A.summary})]})}),r.jsx("td",{children:A.recommendedMethods.length?r.jsx("span",{className:`canvas-skewness__chip${A.primaryMethod?" canvas-skewness__chip--recommended":""}`,children:A.primaryMethod?x(A.primaryMethod):x(A.recommendedMethods[0])}):r.jsx("span",{className:"canvas-skewness__muted",children:"No recommendation"})}),r.jsx("td",{children:r.jsx("span",{className:"canvas-skewness__metric",children:$})}),r.jsx("td",{children:r.jsxs("div",{className:"canvas-skewness__override",children:[r.jsx("select",{value:q,onChange:D=>T(A.column,D.target.value),disabled:w||!t,children:R.map(D=>{var K;const X=D.reason?`${D.label} (caution: ${D.reason})`:D.label,Y=((K=D.status)==null?void 0:K.status)??"ready";return r.jsx("option",{value:D.value,"data-status":Y,children:X},`skewness-option-${A.column}-${D.value||"none"}`)})}),ee&&ee.status!=="ready"&&ee.reason&&r.jsxs("span",{className:"canvas-skewness__status canvas-skewness__status--error",children:["Selected transform may be incompatible: ",ee.reason]}),!A.selectedMethod&&le&&le.status!=="ready"&&le.reason&&r.jsxs("span",{className:"canvas-skewness__status",children:["Recommended transform flagged: ",le.reason]})]})})]},`skewness-row-${A.column}`)})})]})})]},`skewness-group-${O.key}`))}),r.jsxs("div",{className:"canvas-skewness__footer",children:[r.jsx("span",{children:y?`${y} transformation${y===1?"":"s"} configured`:"No transformations configured yet."}),y>0&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:j,children:"Clear selections"})]})]})]}),rA="_was_missing",aA=(e,t)=>{const n=typeof e=="string"?e.trim():"";if(n)return n;const a=typeof t=="string"?t.trim():"";return a||rA},oA=(e,t)=>{const n=typeof e=="string"?e.trim():"",a=typeof t=="string"?t:"";return!n||!a?!1:n.endsWith(a)},iA=({selectedColumns:e,availableColumns:t,columnMissingMap:n,suffix:a})=>{const i=typeof a=="string"?a:"",l=ut(t),u=new Set(l),d=Array.from(new Set(ut(e))),m=[];if(d.forEach(_=>{const y=`${_}${i}`,w=n[_],x=typeof w=="number"&&Number.isFinite(w)?Math.max(0,w):null;m.push({column:_,missingPercentage:x,flagColumn:y,conflicts:{alreadyExists:u.has(y),duplicateFlag:!1}})}),m.length>0){const _=new Map;m.forEach(y=>{_.set(y.flagColumn,(_.get(y.flagColumn)??0)+1)}),m.forEach(y=>{y.conflicts.duplicateFlag=(_.get(y.flagColumn)??0)>1})}m.sort((_,y)=>{const w=_.missingPercentage,x=y.missingPercentage,S=typeof w=="number",k=typeof x=="number";return S&&k&&w!==x?x-w:S!==k?S?-1:1:_.column.localeCompare(y.column)});const v=i?Array.from(new Set(l.filter(_=>oA(_,i)))):[],p=m.reduce((_,y)=>y.conflicts.alreadyExists||y.conflicts.duplicateFlag?_+1:_,0);return{rows:m,flaggedColumnsInDataset:v,conflictCount:p}},lA=({suffix:e,insights:t,formatMissingPercentage:n})=>{const{rows:a,flaggedColumnsInDataset:i,conflictCount:l}=t,u=a.length>0,d=e||"(no suffix)",m=i.slice(0,4),v=Math.max(i.length-m.length,0);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Missing indicator summary"})}),r.jsxs("p",{className:"canvas-modal__note",children:["Generates ",r.jsx("strong",{children:a.length})," flag column",a.length===1?"":"s"," using suffix"," ",r.jsx("strong",{children:d}),"."]}),i.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Detected ",i.length," existing flag column",i.length===1?"":"s"," ","with this suffix",m.length>0?` (examples: ${m.join(", ")}${v>0?", ":""})`:"","."]}),l>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[l," generated flag column",l===1?" has":"s have"," naming conflicts. Adjust the suffix or remove conflicting columns."]}),u?r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Missing %"}),r.jsx("th",{scope:"col",children:"Flag column"}),r.jsx("th",{scope:"col",children:"Status"})]})}),r.jsx("tbody",{children:a.map(p=>{const _=[];p.conflicts.alreadyExists&&_.push("Already exists"),p.conflicts.duplicateFlag&&_.push("Duplicate name");const y=_.length>0,w=y?_.join("  "):"Ready",x=y?"canvas-cast__chip canvas-cast__chip--attention":"canvas-cast__chip canvas-cast__chip--applied",S=y?"canvas-cast__row canvas-cast__row--attention":"canvas-cast__row";return r.jsxs("tr",{className:S,children:[r.jsx("th",{scope:"row",children:p.column}),r.jsx("td",{children:n(p.missingPercentage)}),r.jsx("td",{children:p.flagColumn}),r.jsx("td",{children:r.jsx("span",{className:x,children:w})})]},`missing-indicator-${p.column}`)})})]})}):r.jsx("p",{className:"canvas-modal__note",children:"Select columns below to create missing-value flags."})]})},Yx=["canonicalize_country_codes","normalize_boolean","punctuation","custom"],Lg="canonicalize_country_codes",cA=new Set(Yx),uA=["string","object","text","category","mixed","varchar","char"],dA=4,mA=6,il=4,fA=3,Qx=36,hA=5,Dg={canonicalize_country_codes:{label:"Country aliases",guidance:'Maps abbreviations such as "UK" or "UAE" to canonical country names.',examples:["UK => United Kingdom","UAE => United Arab Emirates"]},normalize_boolean:{label:"Boolean tokens",guidance:"Standardizes yes/no style values so downstream logic sees consistent tokens.",examples:["y => Yes","0 => No"]},punctuation:{label:"Punctuation cleanup",guidance:"Strips punctuation and squeezes whitespace to simplify fuzzy matching.",examples:["C.R.M. => CRM","Part - Time => Part Time"]},custom:{label:"Custom mappings",guidance:"Applies the alias pairs you provide. Each entry should follow alias => replacement.",examples:["st => Street","rd => Road"]}},Gx=Yx.map(e=>{var t;return{value:e,label:((t=Dg[e])==null?void 0:t.label)??e}}),pA=new Set(["true","1","yes","y","on"]),gA=new Set(["false","0","no","n","off"]),_A=(e,t)=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:t:t;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(pA.has(n))return!0;if(gA.has(n))return!1}return t},zg=e=>Array.isArray(e)?Array.from(new Set(e.map(t=>typeof t=="string"?t.trim():String(t??"").trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?zg(e.split(",")):[],Xx=(e,t)=>{if(!e||typeof e!="object")return null;const n=e,a=zg(n.columns),i=_A(n.auto_detect??n.autoDetect??n.auto,t.autoDetect),l=Df(typeof n.mode=="string"?n.mode:void 0,t.mode);return!a.length&&!i?null:{mode:l,columns:a,autoDetect:i}},Jx=(e,t)=>{const n={mode:t.mode,columns:zg(t.columns),autoDetect:!!t.autoDetect};if(!e)return!n.columns.length&&!n.autoDetect&&(n.autoDetect=!0),[n];if(!Array.isArray(e)){const i=Xx(e,n);return i?[i]:[n]}const a=[];return e.forEach(i=>{const l=Xx(i,n);l&&a.push(l)}),a.length===0?(!n.columns.length&&!n.autoDetect&&(n.autoDetect=!0),[n]):a},vA=e=>e.map(t=>({mode:t.mode,columns:[...t.columns],auto_detect:!!t.autoDetect})),yA=e=>e.replace(/[\s\W_]+/g,"").toLowerCase(),Lf=e=>e.length<=Qx?e:`${e.slice(0,Qx-1)}...`,Zx=e=>cA.has(e),e0=e=>{if(!e)return!1;const t=e.toLowerCase();return uA.some(n=>t.includes(n))},Df=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Zx(n))return n;const a=typeof t=="string"?t.trim().toLowerCase():"";return a&&Zx(a)?a:Lg},bA=e=>{const t=Dg[e]??Dg[Lg];return{mode:e,label:t.label,guidance:t.guidance,examples:t.examples}},xA=({selectedColumns:e,availableColumns:t,columnTypeMap:n,autoDetectEnabled:a})=>{const i=Array.from(new Set(ut(e))),l=new Set(i),u=t.filter(p=>e0(n[p]??null)),d=u.filter(p=>!l.has(p)),m=i.filter(p=>!e0(n[p]??null)),v=typeof a=="boolean"?a:i.length===0;return{selectedColumns:i,nonTextSelected:m,autoDetectionActive:v,recommendedColumns:d,textColumnCount:u.length,textColumns:u}},wA=/[\n;,]+/,Ac=(e,t)=>e.slice(0,t),zf=(e,t)=>{const n=e.split(t);if(n.length<2)return null;const[a,...i]=n,l=i.join(t);return[a,l]},jA=e=>{if(!e)return{totalPairs:0,previewPairs:[],previewOverflow:0,duplicates:[],duplicateOverflow:0,invalidEntries:[],invalidOverflow:0};const t=new Set,n=[],a=[],i=new Map;let l=0;const u=(p,_)=>{const y=String(p??"").trim(),w=String(_??"").trim();if(!y||!w){(y||w)&&n.push(`${y} => ${w}`.trim());return}const x=yA(y);if(!x){n.push(`${y} => ${w}`);return}i.has(x)?t.add(y):(i.set(x,w),a.length<dA&&a.push(`${y} => ${w}`)),l+=1};if(typeof e=="string"){e.split(wA).forEach(x=>{const S=x.trim();if(S){if(S.includes("=>")){const k=zf(S,"=>");k?u(k[0],k[1]):n.push(S);return}if(S.includes(":")){const k=zf(S,":");k?u(k[0],k[1]):n.push(S);return}n.push(S)}});const _=Array.from(t),y=Ac(_,il),w=Ac(n,il);return{totalPairs:l,previewPairs:a,previewOverflow:Math.max(l-a.length,0),duplicates:y,duplicateOverflow:Math.max(_.length-y.length,0),invalidEntries:w,invalidOverflow:Math.max(n.length-w.length,0)}}if(Array.isArray(e)){e.forEach(w=>{if(w){if(typeof w=="string"){const x=w.trim();if(!x)return;if(x.includes("=>")){const S=zf(x,"=>");S?u(S[0],S[1]):n.push(x)}else if(x.includes(":")){const S=zf(x,":");S?u(S[0],S[1]):n.push(x)}else n.push(x);return}if(typeof w=="object"){const{alias:x,replacement:S}=w;u(x,S);return}n.push(String(w))}});const p=Array.from(t),_=Ac(p,il),y=Ac(n,il);return{totalPairs:l,previewPairs:a,previewOverflow:Math.max(l-a.length,0),duplicates:_,duplicateOverflow:Math.max(p.length-_.length,0),invalidEntries:y,invalidOverflow:Math.max(n.length-y.length,0)}}typeof e=="object"&&Object.entries(e).forEach(([p,_])=>{u(p,_)});const d=Array.from(t),m=Ac(d,il),v=Ac(n,il);return{totalPairs:l,previewPairs:a,previewOverflow:Math.max(l-a.length,0),duplicates:m,duplicateOverflow:Math.max(d.length-m.length,0),invalidEntries:v,invalidOverflow:Math.max(n.length-v.length,0)}},NA=e=>{const t=e.slice(0,mA);return{preview:t,remaining:Math.max(e.length-t.length,0)}},SA=e=>{const t=e.slice(0,il);return{preview:t,remaining:Math.max(e.length-t.length,0)}},CA=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?Lf(String(e)):null;if(typeof e=="boolean")return e?"True":"False";if(typeof e=="string"){const t=e.trim();return t?Lf(t):null}try{const t=JSON.stringify(e);return t?Lf(t):null}catch{return Lf(String(e))}},EA=(e,t=fA)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(a=>{!a||typeof a!="object"||Object.entries(a).forEach(([i,l])=>{const u=typeof i=="string"?i.trim():"";if(!u)return;const d=CA(l);if(!d)return;const m=n[u]??[];m.includes(d)||m.length>=t||(n[u]=[...m,d])})}),n},kA=(e,t,n=hA)=>{if(!t.length)return[];const a=[];for(const i of t){if(a.length>=n)break;const l=e[i];!l||!l.length||a.push({column:i,values:l,overflow:0})}return a},Rg=e=>e.replace(/[^0-9a-zA-Z]+/g,"").toLowerCase(),t0=[["UK","United Kingdom"],["UAE","United Arab Emirates"],["USA","United States"],["PRC","China"],["KSA","Saudi Arabia"],["Brasil","Brazil"]],n0=new Set(["us","usa","unitedstates","unitedstatesofamerica","uk","unitedkingdom","greatbritain","england","uae","unitedarabemirates","prc","china","southkorea","republicofkorea","ksa","saudiarabia","brasil","brazil","de","germany","fr","france","es","spain","ca","canada","mx","mexico","country","state","province"]);t0.forEach(e=>{e.forEach(t=>n0.add(Rg(t)))});const s0=[["Y","Yes"],["1","Yes"],["ON","Yes"],["N","No"],["0","No"],["OFF","No"]],r0=new Set(["yes","y","true","t","1","on","enable","enabled","no","n","false","f","0","off","disable","disabled","active","inactive","flag"]);s0.forEach(e=>{e.forEach(t=>r0.add(Rg(t)))});const MA=[["C.R.M.","CRM"],["Part - Time","Part Time"],["end-to-end","end to end"]],AA=/^[A-Za-z]{2,3}$/,OA=/[^0-9A-Za-z\s]/,PA=/[^0-9A-Za-z]+/,Rf={canonicalize_country_codes:{title:"Country alias map",description:"Common country abbreviations resolve to canonical names or ISO codes.",preview:t0},normalize_boolean:{title:"Boolean token map",description:"Typical yes / no style values are standardized.",preview:s0},punctuation:{title:"Punctuation cleanup",description:"Removes punctuation and condenses whitespace for easier matching.",preview:MA},custom:{title:"Custom mappings",description:"Define your own alias => replacement pairs below."}},TA=e=>{const t=[];return e.forEach(n=>{n.split(PA).filter(Boolean).forEach(i=>{t.push(i)})}),t},$A=(e,t)=>{if(!t.length)return!1;if(e==="punctuation")return t.some(a=>OA.test(a));const n=TA(t).map(a=>Rg(a));return n.length?e==="canonicalize_country_codes"?n.some(a=>n0.has(a))||t.some(a=>AA.test(a.trim())):e==="normalize_boolean"?n.some(a=>r0.has(a)):!1:!1},a0=e=>{if(!e.length)return null;const t=e.slice(0,3);return e.length-t.length>0?`${t.join(", ")} ...`:t.join(", ")},LA=({hasSource:e,hasReachableSource:t,strategies:n,columnSummary:a,columnOptions:i,sampleMap:l,modeOptions:u=Gx,customPairSummary:d,customPairsParameter:m,collapsedStrategies:v,onToggleStrategy:p,onRemoveStrategy:_,onAddStrategy:y,onModeChange:w,onAutoDetectToggle:x,onColumnToggle:S,onColumnsChange:k,renderParameterField:M})=>{const P=n.length>0,T=a.selectedColumns.length,j=f.useMemo(()=>NA(a.recommendedColumns),[a.recommendedColumns]),O=f.useMemo(()=>SA(a.nonTextSelected),[a.nonTextSelected]),A=f.useMemo(()=>kA(l,a.selectedColumns),[a.selectedColumns,l]),z=!e||!t,$=d.duplicates.length+d.duplicateOverflow,q=d.invalidEntries.length+d.invalidOverflow,V=d.duplicates.join(", "),R=d.invalidEntries.join(", "),ee=f.useMemo(()=>n.some(J=>J.mode==="custom"),[n]),le=f.useMemo(()=>{const J=new Map;return n.forEach(H=>{H.columns.forEach(Z=>{const ne=Z.trim();ne&&J.set(ne,(J.get(ne)??0)+1)})}),J},[n]),[D,X]=f.useState(()=>new Set),Y=f.useCallback(J=>{X(H=>{const Z=new Set(H);return Z.has(J)?Z.delete(J):Z.add(J),Z})},[]);f.useEffect(()=>{X(J=>{const H=new Set;return J.forEach(Z=>{Z<n.length&&H.add(Z)}),H.size===J.size?J:H})},[n.length]);const[K,U]=f.useState(()=>({index:null,mode:null})),te=f.useMemo(()=>{const J=new Map;return i.forEach(H=>{const Z=Array.isArray(H.samples)?H.samples:[],ne=Array.isArray(l[H.name])?l[H.name]:[],fe=[...Z,...ne].map(ae=>String(ae??"").trim()).filter(ae=>ae.length>0);J.set(H.name,fe.slice(0,12))}),J},[i,l]),W=f.useMemo(()=>{const J=new Map;return i.forEach(H=>{const Z=te.get(H.name)??[],ne=Z.length?Z:[H.name];["canonicalize_country_codes","normalize_boolean","punctuation"].forEach(fe=>{$A(fe,ne)&&(J.has(fe)||J.set(fe,new Set),J.get(fe).add(H.name))})}),J},[i,te]);f.useEffect(()=>{if(K.index===null)return;const J=n[K.index];(!J||J.mode!==K.mode)&&U({index:null,mode:null})},[K.index,K.mode,n]);const I=f.useCallback((J,H)=>{U({index:J,mode:H})},[]),Q=f.useCallback(()=>{U({index:null,mode:null})},[]);let me=!1;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Alias cleanup strategies"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:y,children:"Add strategy"})})]}),a.autoDetectionActive?r.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is enabled; any remaining text-like columns will be swept into the strategies when this node runs."}):r.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",r.jsx("strong",{children:T})," column",T===1?"":"s"," across all strategies."]}),A.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",A.map(J=>`${J.column} (${J.values.join(", ")})`).join("; "),"."]}),a.textColumnCount>0&&j.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",j.preview.join(", "),j.remaining>0?`, ... (${j.remaining} more)`:"","."]}),O.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[O.preview.join(", ")," ",O.preview.length===1?"is":"are"," not text-like.",O.remaining>0?` ${O.remaining} more column${O.remaining===1?" is":"s are"} also non-text.`:" Remove them or double-check the data."]}),z?e?r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to inspect available columns."}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to load available columns for alias cleanup."}):null,!P&&r.jsx("p",{className:"canvas-modal__note",children:"No strategies configured yet. Combine presets (countries, booleans, punctuation) or add custom maps to standardize aliases."}),P&&r.jsx("div",{className:"canvas-imputer__list",children:n.map((J,H)=>{var G;const Z=bA(J.mode),ne=((G=u.find(ke=>ke.value===J.mode))==null?void 0:G.label)??Z.label,fe=J.columns.length,ae=fe?`${fe} column${fe===1?"":"s"}`:J.autoDetect?"Auto-detecting columns":"No columns yet",pe=v.has(H),Ve=D.has(H),st=J.columns.join(", "),Ke=W.get(J.mode)??new Set,mt=J.mode==="custom"&&!!m&&!me,yt=J.mode==="custom"&&!!m&&me;mt&&(me=!0);const Te=i.map(ke=>{const Ae=J.columns.includes(ke.name),Ge=Ke.has(ke.name),ft=Ae?0:Ge?1:ke.isRecommended?2:ke.isTextLike?3:4;return{option:ke,priority:ft}}).sort((ke,Ae)=>ke.priority!==Ae.priority?ke.priority-Ae.priority:ke.option.name.localeCompare(Ae.option.name)).map(ke=>ke.option),at=Ke.size>0,it=Te.filter(ke=>J.columns.includes(ke.name)?!0:at?Ke.has(ke.name):ke.isRecommended||ke.isTextLike),be=new Set(it.map(ke=>ke.name)),Pe=Te.filter(ke=>!be.has(ke.name));return r.jsxs("div",{className:"canvas-imputer__card",children:[r.jsxs("div",{className:"canvas-imputer__card-header",children:[r.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>p(H),"aria-expanded":!pe,"aria-controls":`alias-strategy-body-${H}`,children:[r.jsx("span",{className:`canvas-imputer__toggle-icon${pe?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),r.jsxs("span",{className:"canvas-imputer__card-text",children:[r.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",H+1]}),r.jsxs("span",{className:"canvas-imputer__card-summary",children:[ne,J.autoDetect?"  auto-detect":"",ae?`  ${ae}`:""]})]})]}),r.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>_(H),"aria-label":`Remove alias strategy ${H+1}`,children:"Remove"})]}),!pe&&r.jsxs("div",{className:"canvas-imputer__card-body",id:`alias-strategy-body-${H}`,children:[r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Replacement strategy"}),r.jsxs("div",{className:"canvas-imputer__mode-toggle",role:"radiogroup","aria-label":"Alias replacement strategy",children:[u.map(ke=>{const Ae=ke.value===J.mode;return r.jsx("button",{type:"button",className:`btn btn-outline-secondary canvas-imputer__mode-button${Ae?" canvas-imputer__mode-button--active active":""}`,role:"radio","aria-checked":Ae,onClick:()=>w(H,ke.value),children:ke.label},ke.value)}),r.jsx("button",{type:"button",className:"btn btn-link canvas-imputer__mode-info",onClick:()=>I(H,J.mode),children:"View examples"})]}),r.jsx("p",{className:"canvas-modal__meta",children:Z.guidance})]}),K.index===H&&K.mode===J.mode&&r.jsxs("div",{className:"canvas-modal__note canvas-modal__note--info",children:[r.jsxs("div",{children:[r.jsx("strong",{children:Rf[J.mode].title}),r.jsx("button",{type:"button",className:"btn btn-link",onClick:Q,children:"Close"})]}),r.jsx("p",{children:Rf[J.mode].description}),Rf[J.mode].preview&&r.jsx("ul",{children:Rf[J.mode].preview.map(([ke,Ae])=>r.jsxs("li",{children:[ke," ",r.jsx("span",{"aria-hidden":"true",children:"->"})," ",Ae]},`${ke}-${Ae}`))})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`alias-strategy-${H}-auto-detect`,children:"Detection"}),r.jsxs("div",{className:"canvas-modal__boolean-control",children:[r.jsx("input",{id:`alias-strategy-${H}-auto-detect`,type:"checkbox",checked:J.autoDetect,onChange:ke=>x(H,ke.target.checked)}),r.jsx("label",{htmlFor:`alias-strategy-${H}-auto-detect`,children:"Auto-detect additional text columns"})]}),r.jsx("p",{className:"canvas-modal__note",children:"Detected text-like columns not assigned elsewhere will be appended to this strategy."})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Columns"}),i.length?r.jsxs(r.Fragment,{children:[Ke.size>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Highlighting columns that resemble ",ne.toLowerCase()," entries."]}),it.length?r.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":`Columns assigned to alias strategy ${H+1}`,children:it.map(ke=>{const Ae=J.columns.includes(ke.name),Ge=a0(ke.samples.length?ke.samples:l[ke.name]??[]),zt=(le.get(ke.name)??0)-(Ae?1:0)>0,ve=Ke.has(ke.name);return r.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${Ae?" canvas-imputer__column-pill--selected":""}`,onClick:()=>S(H,ke.name),"aria-pressed":Ae,children:[r.jsx("span",{className:"canvas-imputer__column-pill-name",children:ke.name}),r.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[ke.dtype&&r.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:ke.dtype}),ke.isRecommended&&r.jsx("span",{className:"canvas-modal__meta",children:"Suggested"}),!ke.isTextLike&&r.jsx("span",{className:"canvas-modal__meta",children:"Non-text"}),ve&&r.jsx("span",{className:"canvas-modal__meta",children:"Likely match"}),zt&&r.jsx("span",{className:"canvas-modal__meta",children:"Used elsewhere"})]}),Ge&&r.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",Ge]})]},ke.name)})}):r.jsx("p",{className:"canvas-modal__note",children:"No detected or selected columns yet. Expand other columns below to assign manually."}),Pe.length>0&&r.jsxs("div",{className:"canvas-imputer__more-columns",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Y(H),"aria-expanded":Ve,"aria-controls":`alias-strategy-${H}-other-columns`,children:Ve?"Hide other columns":`Show other columns (${Pe.length})`}),Ve&&r.jsx("div",{id:`alias-strategy-${H}-other-columns`,className:"canvas-imputer__columns-list",role:"listbox","aria-label":`Other available columns for alias strategy ${H+1}`,children:Pe.map(ke=>{const Ae=J.columns.includes(ke.name),Ge=a0(ke.samples.length?ke.samples:l[ke.name]??[]),zt=(le.get(ke.name)??0)-(Ae?1:0)>0,ve=Ke.has(ke.name);return r.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${Ae?" canvas-imputer__column-pill--selected":""}`,onClick:()=>S(H,ke.name),"aria-pressed":Ae,children:[r.jsx("span",{className:"canvas-imputer__column-pill-name",children:ke.name}),r.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[ke.dtype&&r.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:ke.dtype}),!ke.isTextLike&&r.jsx("span",{className:"canvas-modal__meta",children:"Non-text"}),ve&&r.jsx("span",{className:"canvas-modal__meta",children:"Likely match"}),zt&&r.jsx("span",{className:"canvas-modal__meta",children:"Used elsewhere"})]}),Ge&&r.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",Ge]})]},ke.name)})})]})]}):r.jsx("p",{className:"canvas-modal__note",children:"No catalogued columns yet. Add column names manually below or enable auto-detect to populate this list."})]}),r.jsx("div",{className:`canvas-imputer__selected${J.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:J.columns.length?J.columns.map(ke=>r.jsx("span",{className:"canvas-imputer__selected-chip",children:ke},ke)):r.jsx("span",{children:"No manual columns selected yet."})}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`alias-strategy-${H}-manual-columns`,children:"Manual columns (optional)"}),r.jsx("input",{id:`alias-strategy-${H}-manual-columns`,type:"text",className:"canvas-imputer__columns-input",value:st,onChange:ke=>k(H,ke.target.value),placeholder:"Add custom columns, separated by commas"})]}),r.jsx("p",{className:"canvas-modal__note",children:"Tap suggestions to toggle columns. Manual entries let you set custom fields that are not listed above."}),J.mode==="custom"&&m&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Custom pairs"}),r.jsx("p",{className:"canvas-modal__meta",children:"Enter one alias => replacement per line. These mappings apply to every custom strategy in this node."}),r.jsx("div",{className:"canvas-modal__parameter-list",children:mt?M(m):yt?r.jsx("p",{className:"canvas-modal__note",children:"Edit the custom pairs above to update this strategy."}):null})]})]})]},`alias-strategy-${H}`)})}),d.totalPairs>0&&r.jsxs("p",{className:"canvas-modal__note",children:[d.totalPairs," custom pair",d.totalPairs===1?"":"s"," captured.",ee?" They will be applied during execution.":" Switch a strategy to Custom mappings to apply them.",d.previewPairs.length>0?` Examples: ${d.previewPairs.join("; ")}${d.previewOverflow>0?"...":""}`:""]}),d.totalPairs===0&&ee&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"At least one strategy is set to Custom mappings, but no valid alias pairs were detected."}),$>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Duplicate alias entries",V?`: ${V}`:"",d.duplicateOverflow>0?"...":"",". Only the first entry for each alias will be used."]}),q>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Ignored ",q," incomplete pair",q===1?"":"s",".",R?` Examples: ${R}${d.invalidOverflow>0?"...":""}`:""]})]})},Ff=["iso_date","iso_datetime","month_day_year","day_month_year"],DA="iso_date",zA=["date","time","timestamp","datetime"],RA=3,o0=36,xd={iso_date:{label:"ISO date",guidance:"Formats values as YYYY-MM-DD. Ideal for analytics layers expecting canonical dates.",example:"2024-03-19"},iso_datetime:{label:"ISO datetime",guidance:"Preserves date and time with second precision (YYYY-MM-DD HH:MM:SS).",example:"2024-03-19 14:05:42"},month_day_year:{label:"MM/DD/YYYY",guidance:"Aligns with US-style date formats. Use when downstream tooling expects month/day ordering.",example:"03/19/2024"},day_month_year:{label:"DD/MM/YYYY",guidance:"Suitable for EU-style day-first formats.",example:"19/03/2024"}},Fg=Ff.map(e=>({value:e,label:xd[e].label,guidance:xd[e].guidance,example:xd[e].example})),FA=[/^\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/,/^\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4}/,/^[A-Za-z]{3,9}\s+\d{1,2},\s*\d{2,4}/,/^\d{1,2}\s+[A-Za-z]{3,9}\s+\d{2,4}/,/^\d{4}\d{2}\d{2}$/],i0=e=>e.length<=o0?e:`${e.slice(0,o0-1)}...`,l0=e=>{if(!e)return!1;const t=e.toLowerCase();return zA.some(n=>t.includes(n))},IA=e=>FA.some(t=>t.test(e)),c0=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Ff.includes(n))return n;const a=typeof t=="string"?t.trim().toLowerCase():"";return a&&Ff.includes(a)?a:DA},BA=e=>{const t=[];return Object.entries(e).forEach(([n,a])=>{if(!a||!a.length)return;const i=a.length;let l=0;if(a.forEach(d=>{IA(d)&&(l+=1)}),!i)return;l/i>=.6&&l>=2&&t.push(n)}),t.sort((n,a)=>n.localeCompare(a)),t},UA=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:a})=>{const i=Array.from(new Set(ut(e)));i.sort((y,w)=>y.localeCompare(w));const l=new Set(i),u=t.filter(y=>l0(n[y]??null)),d=BA(a),m=new Set;u.forEach(y=>{l.has(y)||m.add(y)}),d.forEach(y=>{l.has(y)||m.add(y)});const v=Array.from(m);v.sort((y,w)=>y.localeCompare(w));const p=i.filter(y=>!(l0(n[y]??null)||d.includes(y))),_=d.slice().sort((y,w)=>y.localeCompare(w));return{selectedColumns:i,autoDetectionActive:i.length===0,recommendedColumns:v,nonDateSelected:p,dateColumnCount:u.length,sampleCandidateCount:d.length,sampleCandidates:_}},qA=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";return n&&Ff.includes(n)?n:t},HA=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="true"||t==="1"||t==="yes")return!0;if(t==="false"||t==="0"||t==="no")return!1}return typeof e=="number"?e!==0:!1},u0=(e,t)=>{if(!Array.isArray(e))return t.columns.length||t.autoDetect?[{mode:t.mode,columns:[...t.columns],autoDetect:t.autoDetect}]:[];const n=new Set,a=e.map(i=>{if(!i||typeof i!="object")return null;const l=ut(i.columns),u=Array.from(new Set(l.map(p=>p.trim()).filter(Boolean))).sort((p,_)=>p.localeCompare(_)),d=qA(i.mode,t.mode),m=HA(i.auto_detect??i.autoDetect??i.auto),v=`${d}|${u.join(",")}|${m?"auto":"manual"}`;return n.has(v)?null:(n.add(v),{mode:d,columns:u,autoDetect:m})}).filter(i=>!!i);return a.length?a:t.columns.length||t.autoDetect?[{mode:t.mode,columns:[...t.columns],autoDetect:t.autoDetect}]:[]},VA=e=>e.map(t=>{const n={mode:t.mode,columns:[...t.columns]};return t.autoDetect&&(n.auto_detect=!0),n}),WA=e=>{var t;return((t=xd[e])==null?void 0:t.label)??xd.iso_date.label},KA=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?i0(String(e)):null;if(typeof e=="boolean")return e?"True":"False";const t=String(e).trim();return t?i0(t):null},YA=(e,t=RA)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(a=>{!a||typeof a!="object"||Object.entries(a).forEach(([i,l])=>{const u=typeof i=="string"?i.trim():"";if(!u)return;const d=KA(l);if(!d)return;const m=n[u]??[];m.includes(d)||m.length>=t||(n[u]=[...m,d])})}),n},QA={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonDateSelected:[],dateColumnCount:0,sampleCandidateCount:0,sampleCandidates:[]},d0=e=>{if(!e.length)return null;const t=e.slice(0,3);return e.length-t.length>0?`${t.join(", ")} `:t.join(", ")},GA=({hasSource:e,hasReachableSource:t,strategies:n,columnSummary:a,columnOptions:i,sampleMap:l,collapsedStrategies:u,onToggleStrategy:d,onRemoveStrategy:m,onAddStrategy:v,onModeChange:p,onColumnToggle:_,onColumnsChange:y,onAutoDetectToggle:w,modeOptions:x=Fg})=>{const S=n.length>0,k=f.useMemo(()=>n.some($=>$.autoDetect),[n]),[M,P]=f.useState(()=>new Set),T=f.useCallback($=>{P(q=>{const V=new Set(q);return V.has($)?V.delete($):V.add($),V})},[]);f.useEffect(()=>{P($=>{const q=new Set;return $.forEach(V=>{V<n.length&&q.add(V)}),q.size===$.size?$:q})},[n.length]);const j=f.useMemo(()=>{const $=new Map;return n.forEach(q=>{q.columns.forEach(V=>{const R=V.trim();R&&$.set(R,($.get(R)??0)+1)})}),$},[n]),O=f.useMemo(()=>{const $=a.recommendedColumns.slice(0,6),q=Math.max(a.recommendedColumns.length-$.length,0);return{preview:$,remaining:q}},[a.recommendedColumns]),A=f.useMemo(()=>{const $=a.nonDateSelected.slice(0,4),q=Math.max(a.nonDateSelected.length-$.length,0);return{preview:$,remaining:q}},[a.nonDateSelected]),z=!e||!t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Date formatting strategies"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:v,children:"Add strategy"})})]}),z&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:e?"Connect this step to an upstream output to explore detected date columns.":"Select a dataset to load column samples and suggestions."}),O.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Suggested columns: ",O.preview.join(", "),O.remaining>0?`,  (${O.remaining} more)`:"",".",k?" Auto-detect strategies will automatically include remaining date-like columns.":""]}),a.sampleCandidates.length===0&&!O.preview.length&&r.jsx("p",{className:"canvas-modal__note",children:"No clear date candidates yet. Add columns manually or enable auto-detect to sweep for timestamps."}),A.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[A.preview.join(", ")," ",A.preview.length===1?"looks":"look"," non-date-like.",A.remaining>0?` ${A.remaining} more selected column${A.remaining===1?"":"s"} may require double-checking.`:" Double-check that these values represent consistent dates."]}),k&&r.jsxs("p",{className:"canvas-modal__note",children:["Auto-detect gathers from ",a.sampleCandidateCount||a.dateColumnCount," date-like columns that are not already assigned."]}),S?r.jsx("div",{className:"canvas-imputer__list",children:n.map(($,q)=>{var Q,me;const V=((Q=x.find(J=>J.value===$.mode))==null?void 0:Q.label)??WA($.mode),R=$.columns.length,ee=R?`${R} column${R===1?"":"s"}`:$.autoDetect?"Auto-detecting columns":"No columns yet",le=u.has(q),D=$.columns.join(", "),X=`date-strategy-${q}-toggle`,Y=`date-strategy-${q}-auto-detect`,K=i.map(J=>({option:J,priority:J.isRecommended?0:J.isSampleCandidate?1:2})).sort((J,H)=>J.priority!==H.priority?J.priority-H.priority:J.option.name.localeCompare(H.option.name)).map(J=>J.option),U=K.filter(J=>$.columns.includes(J.name)?!0:J.isRecommended||J.isSampleCandidate),te=new Set(U.map(J=>J.name)),W=K.filter(J=>!te.has(J.name)),I=M.has(q);return r.jsxs("div",{className:"canvas-imputer__card",children:[r.jsxs("div",{className:"canvas-imputer__card-header",children:[r.jsxs("button",{type:"button",id:X,className:"canvas-imputer__card-toggle",onClick:()=>d(q),"aria-expanded":!le,"aria-controls":`date-strategy-body-${q}`,children:[r.jsx("span",{className:`canvas-imputer__toggle-icon${le?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),r.jsxs("span",{className:"canvas-imputer__card-text",children:[r.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",q+1]}),r.jsxs("span",{className:"canvas-imputer__card-summary",children:[V,$.autoDetect?"  auto-detect":"",ee?`  ${ee}`:""]})]})]}),r.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>m(q),"aria-label":`Remove date formatting strategy ${q+1}`,children:"Remove"})]}),!le&&r.jsxs("div",{className:"canvas-imputer__card-body",id:`date-strategy-body-${q}`,children:[r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`date-strategy-${q}-mode`,children:"Format"}),r.jsx("select",{id:`date-strategy-${q}-mode`,value:$.mode,onChange:J=>p(q,J.target.value),children:x.map(J=>r.jsx("option",{value:J.value,children:J.label},J.value))}),r.jsxs("p",{className:"canvas-modal__meta",children:["Example: ",((me=x.find(J=>J.value===$.mode))==null?void 0:me.example)??"2024-01-23"]})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:Y,children:"Detection"}),r.jsxs("div",{className:"canvas-modal__boolean-control",children:[r.jsx("input",{id:Y,type:"checkbox",checked:$.autoDetect,onChange:J=>w(q,J.target.checked)}),r.jsx("label",{htmlFor:Y,children:"Auto-detect additional date columns"})]}),r.jsx("p",{className:"canvas-modal__note",children:"We will append detected date-like fields that are not assigned to other strategies."})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{children:"Columns"}),K.length?r.jsxs(r.Fragment,{children:[U.length?r.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Detected or selected columns for date formatting",children:U.map(J=>{const H=$.columns.includes(J.name),Z=d0(J.samples.length?J.samples:l[J.name]??[]),fe=(j.get(J.name)??0)-(H?1:0)>0;return r.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${H?" canvas-imputer__column-pill--selected":""}`,onClick:()=>_(q,J.name),"aria-pressed":H,children:[r.jsx("span",{className:"canvas-imputer__column-pill-name",children:J.name}),r.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[J.dtype&&r.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:J.dtype}),J.isRecommended&&r.jsx("span",{className:"canvas-modal__meta",children:"Suggested"}),!J.isRecommended&&J.isSampleCandidate&&r.jsx("span",{className:"canvas-modal__meta",children:"Detected"}),fe&&r.jsx("span",{className:"canvas-modal__meta",children:"Used in another strategy"})]}),Z&&r.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",Z]})]},J.name)})}):r.jsx("p",{className:"canvas-modal__note",children:"No detected or selected columns yet. Expand other columns below to assign manually."}),W.length>0&&r.jsxs("div",{className:"canvas-imputer__more-columns",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>T(q),"aria-expanded":I,"aria-controls":`date-strategy-${q}-other-columns`,children:I?"Hide other columns":`Show other columns (${W.length})`}),I&&r.jsx("div",{id:`date-strategy-${q}-other-columns`,className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Other available columns for date formatting",children:W.map(J=>{const H=$.columns.includes(J.name),Z=d0(J.samples.length?J.samples:l[J.name]??[]),fe=(j.get(J.name)??0)-(H?1:0)>0;return r.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${H?" canvas-imputer__column-pill--selected":""}`,onClick:()=>_(q,J.name),"aria-pressed":H,children:[r.jsx("span",{className:"canvas-imputer__column-pill-name",children:J.name}),r.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[J.dtype&&r.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:J.dtype}),fe&&r.jsx("span",{className:"canvas-modal__meta",children:"Used in another strategy"})]}),Z&&r.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",Z]})]},J.name)})})]})]}):r.jsx("p",{className:"canvas-modal__note",children:"No catalogued columns yet. Add column names manually below or enable auto-detect to populate this list."})]}),r.jsx("div",{className:`canvas-imputer__selected${$.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:$.columns.length?$.columns.map(J=>r.jsx("span",{className:"canvas-imputer__selected-chip",children:J},J)):r.jsx("span",{children:"No manual columns selected yet."})}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`date-strategy-${q}-manual-columns`,children:"Manual columns (optional)"}),r.jsx("input",{id:`date-strategy-${q}-manual-columns`,type:"text",className:"canvas-imputer__columns-input",value:D,onChange:J=>y(q,J.target.value),placeholder:"Add custom columns, separated by commas"})]}),r.jsx("p",{className:"canvas-modal__note",children:"Tap suggestions to toggle columns. Manual entries let you set custom fields that are not listed above."})]})]},`date-strategy-${q}`)})}):r.jsx("p",{className:"canvas-modal__note",children:"Add a strategy to standardize one or more columns. You can combine manual selection with auto-detect for any remaining date-like fields."})]})},m0=["both","leading","trailing"],f0="both",XA=["string","object","text","category","mixed","varchar","char"],JA=3,h0=36,p0=6,ZA=4,eO=5,g0={both:{label:"Trim both sides",guidance:"Removes whitespace on the left and right side of values. Safe default for messy strings.",example:"' ACME '  'ACME'"},leading:{label:"Trim leading whitespace",guidance:"Strips whitespace at the beginning of values while preserving trailing spacing.",example:"' 123 Main'  '123 Main'"},trailing:{label:"Trim trailing whitespace",guidance:"Removes whitespace at the end of values while keeping leading spacing intact.",example:"'Suite B  '  'Suite B'"}},tO=e=>e.length<=h0?e:`${e.slice(0,h0-1)}...`,_0=e=>{if(!e)return!1;const t=e.toLowerCase();return XA.some(n=>t.includes(n))},nO=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${tO(t)}'`},sO=e=>e.length?!!(e.trim()!==e||e.includes("  ")||e.includes(`
`)||e.includes("	")||e.includes("\r")):!1,rO=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&m0.includes(n))return n;const a=typeof t=="string"?t.trim().toLowerCase():"";return a&&m0.includes(a)?a:f0},aO=e=>{const t=g0[e]??g0[f0];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},oO=e=>{const t=[];return Object.entries(e).forEach(([n,a])=>{if(!a.length)return;const i=a.reduce((u,d)=>d.hasIssue?u+1:u,0);if(!i)return;const l=i/a.length;(i>=2||l>=.5)&&t.push(n)}),t.sort((n,a)=>n.localeCompare(a)),t},iO=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:a})=>{const i=Array.from(new Set(ut(e)));i.sort((_,y)=>_.localeCompare(y));const l=new Set(i),u=t.filter(_=>_0(n[_]??null)),d=oO(a),m=new Set;u.forEach(_=>{l.has(_)||m.add(_)}),d.forEach(_=>{l.has(_)||m.add(_)});const v=Array.from(m).sort((_,y)=>_.localeCompare(y)),p=i.filter(_=>!_0(n[_]??null));return{selectedColumns:i,autoDetectionActive:i.length===0,recommendedColumns:v,nonTextSelected:p,textColumnCount:u.length,whitespaceCandidateCount:d.length,whitespaceCandidates:d}},Ig=(e,t)=>e.slice(0,t),lO=e=>{const t=Ig(e,p0);return{preview:t,remaining:Math.max(e.length-t.length,0)}},cO=e=>{const t=Ig(e,ZA);return{preview:t,remaining:Math.max(e.length-t.length,0)}},uO=e=>{const t=Ig(e,p0);return{preview:t,remaining:Math.max(e.length-t.length,0)}},dO=(e,t=JA)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(a=>{!a||typeof a!="object"||Object.entries(a).forEach(([i,l])=>{const u=typeof i=="string"?i.trim():"";if(!u)return;let d="";if(l==null)d="";else if(typeof l=="string")d=l;else if(typeof l=="number"||typeof l=="boolean")d=String(l);else try{d=JSON.stringify(l)}catch{d=String(l)}if(!d.length)return;const m=sO(d),v=nO(d),p=n[u]??[];p.find(_=>_.value===v)||p.length>=t||(n[u]=[...p,{value:v,hasIssue:m}])})}),n},mO=(e,t,n=eO)=>{if(!t.length)return[];const a=[];for(const i of t){if(a.length>=n)break;const l=e[i];!l||!l.length||a.push({column:i,values:l.map(u=>u.value),overflow:0})}return a},fO={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,whitespaceCandidateCount:0,whitespaceCandidates:[]},hO=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:a,renderMultiSelectField:i,renderParameterField:l,columnSummary:u,modeDetails:d,sampleMap:m})=>{if(!n&&!a)return null;const v=u.selectedColumns.length,p=lO(u.recommendedColumns),_=cO(u.nonTextSelected),y=uO(u.whitespaceCandidates),w=mO(m,u.selectedColumns),x=!e||!t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Whitespace trimming"})}),r.jsxs("p",{className:"canvas-modal__note",children:[r.jsx("strong",{children:d.label})," mode. ",d.guidance," Example: ",d.example,"."]}),u.autoDetectionActive?r.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):r.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",r.jsx("strong",{children:v})," column",v===1?"":"s"," for trimming."]}),w.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",w.map(S=>`${S.column} (${S.values.join(", ")})`).join("; "),"."]}),y.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns with leading/trailing whitespace detected: ",y.preview.join(", "),y.remaining>0?`, ... (${y.remaining} more)`:"","."]}),p.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",p.preview.join(", "),p.remaining>0?`, ... (${p.remaining} more)`:"","."]}),_.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[_.preview.join(", ")," ",_.preview.length===1?"is":"are"," not text-like.",_.remaining>0?` ${_.remaining} more column${_.remaining===1?" is":"s are"} also non-text.`:" Consider removing them or confirming whitespace cleanup is intentional."]}),x?e?r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples for trimming opportunities."}):null,n&&r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Columns to trim"}),i(n)]}),a&&r.jsx("div",{className:"canvas-modal__parameter-list",children:l(a)})]})},v0=["keep_alphanumeric","keep_alphanumeric_space","letters_only","digits_only"],y0="keep_alphanumeric",pO=["string","object","text","category","mixed","varchar","char"],gO=3,b0=36,_O=6,vO=4,yO=5,x0={keep_alphanumeric:{label:"Letters & digits",guidance:"Removes punctuation and symbols, leaving only letters and numbers.",example:"ACME-Co.  ACMEC o"},keep_alphanumeric_space:{label:"Letters, digits & spaces",guidance:"Strips punctuation while preserving spaces for readability.",example:"ACME-Co.  ACME Co"},letters_only:{label:"Letters only",guidance:"Keeps alphabetic characters and removes digits, punctuation, and symbols.",example:"R2-D2  RD"},digits_only:{label:"Digits only",guidance:"Preserves numbers while removing letters, punctuation, and symbols.",example:"Order #123A  123"}},bO=e=>e.length<=b0?e:`${e.slice(0,b0-1)}...`,xO=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${bO(t)}'`},w0=e=>{if(!e)return!1;const t=e.toLowerCase();return pO.some(n=>t.includes(n))},wO=e=>/[^0-9A-Za-z\s]/.test(e),jO=e=>/[A-Za-z]/.test(e),NO=e=>/[0-9]/.test(e),SO=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&v0.includes(n))return n;const a=typeof t=="string"?t.trim().toLowerCase():"";return a&&v0.includes(a)?a:y0},CO=e=>{const t=x0[e]??x0[y0];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},EO=e=>{const t=new Set,n=new Set,a=new Set;Object.entries(e).forEach(([d,m])=>{if(!m.length)return;let v=0,p=0,_=0;m.forEach(y=>{y.hasSpecial&&(v+=1),y.hasDigits&&(p+=1),y.hasLetters&&(_+=1)}),v>0&&t.add(d),p>0&&_===0&&n.add(d),_>0&&p===0&&a.add(d)});const i=Array.from(t).sort((d,m)=>d.localeCompare(m)),l=Array.from(n).sort((d,m)=>d.localeCompare(m)),u=Array.from(a).sort((d,m)=>d.localeCompare(m));return{specialCandidates:i,digitsOnlyCandidates:l,lettersOnlyCandidates:u}},kO=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:a})=>{const i=Array.from(new Set(ut(e)));i.sort((w,x)=>w.localeCompare(x));const l=new Set(i),u=t.filter(w=>w0(n[w]??null)),{specialCandidates:d,digitsOnlyCandidates:m,lettersOnlyCandidates:v}=EO(a),p=new Set;u.forEach(w=>{l.has(w)||p.add(w)}),d.forEach(w=>{l.has(w)||p.add(w)});const _=Array.from(p).sort((w,x)=>w.localeCompare(x)),y=i.filter(w=>!w0(n[w]??null));return{selectedColumns:i,autoDetectionActive:i.length===0,recommendedColumns:_,nonTextSelected:y,textColumnCount:u.length,specialCandidateCount:d.length,specialCandidates:d,digitsOnlyCandidates:m,lettersOnlyCandidates:v}},j0=(e,t)=>e.slice(0,t),MO=e=>{const t=j0(e,_O);return{preview:t,remaining:Math.max(e.length-t.length,0)}},If=e=>{const t=j0(e,vO);return{preview:t,remaining:Math.max(e.length-t.length,0)}},AO=(e,t=gO)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(a=>{!a||typeof a!="object"||Object.entries(a).forEach(([i,l])=>{const u=typeof i=="string"?i.trim():"";if(!u)return;let d="";if(l==null)d="";else if(typeof l=="string")d=l;else if(typeof l=="number"||typeof l=="boolean")d=String(l);else try{d=JSON.stringify(l)}catch{d=String(l)}if(!d.length)return;const m=xO(d),v=wO(d),p={value:m,hasSpecial:v,hasDigits:NO(d),hasLetters:jO(d)},_=n[u]??[];_.find(y=>y.value===m)||_.length>=t||(n[u]=[..._,p])})}),n},OO=(e,t,n=yO)=>{if(!t.length)return[];const a=[];for(const i of t){if(a.length>=n)break;const l=e[i];!l||!l.length||a.push({column:i,values:l.map(u=>u.value),overflow:0})}return a},PO={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,specialCandidateCount:0,specialCandidates:[],digitsOnlyCandidates:[],lettersOnlyCandidates:[]},TO=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:a,replacementParameter:i,renderMultiSelectField:l,renderParameterField:u,columnSummary:d,modeDetails:m,sampleMap:v})=>{if(!n&&!a&&!i)return null;const p=d.selectedColumns.length,_=MO(d.recommendedColumns),y=If(d.specialCandidates),w=If(d.digitsOnlyCandidates),x=If(d.lettersOnlyCandidates),S=If(d.nonTextSelected),k=OO(v,d.selectedColumns),M=!e||!t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Special character cleanup"})}),r.jsxs("p",{className:"canvas-modal__note",children:[r.jsx("strong",{children:m.label})," mode. ",m.guidance," Example: ",m.example,"."]}),d.autoDetectionActive?r.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):r.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",r.jsx("strong",{children:p})," column",p===1?"":"s"," for cleanup."]}),k.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",k.map(P=>`${P.column} (${P.values.join(", ")})`).join("; "),"."]}),y.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns containing punctuation or symbols: ",y.preview.join(", "),y.remaining>0?`, ... (${y.remaining} more)`:"","."]}),w.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Numeric-only samples detected in: ",w.preview.join(", "),w.remaining>0?`, ... (${w.remaining} more)`:"",". Consider `digits only` mode."]}),x.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Letter-only samples detected in: ",x.preview.join(", "),x.remaining>0?`, ... (${x.remaining} more)`:"",". Consider `letters only` mode."]}),_.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",_.preview.join(", "),_.remaining>0?`, ... (${_.remaining} more)`:"","."]}),S.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[S.preview.join(", ")," ",S.preview.length===1?"is":"are"," not text-like.",S.remaining>0?` ${S.remaining} more column${S.remaining===1?" is":"s are"} also non-text.`:" Double-check that symbol stripping is necessary for these fields."]}),M?e?r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before removing characters."}):null,n&&r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Columns to sanitize"}),l(n)]}),(a||i)&&r.jsxs("div",{className:"canvas-modal__parameter-list",children:[a?u(a):null,i?u(i):null]})]})},N0=["lower","upper","title","sentence"],S0="lower",$O=["string","object","text","category","mixed","varchar","char"],LO=3,C0=60,DO=6,zO=4,RO=5,E0={lower:{label:"Lowercase",guidance:"Converts values to lowercase for consistent comparisons.",example:"Acme Corp  acme corp"},upper:{label:"Uppercase",guidance:"Transforms text to uppercase, useful for codes or standard identifiers.",example:"Acme Corp  ACME CORP"},title:{label:"Title case",guidance:"Capitalizes the first letter of each word, ideal for names or titles.",example:"ACME CORP  Acme Corp"},sentence:{label:"Sentence case",guidance:"Capitalizes the first letter of each sentence while lowercasing the rest.",example:"ACME CORP. DELIVERS.  Acme corp. delivers."}},FO=e=>e.length<=C0?e:`${e.slice(0,C0-1)}...`,k0=e=>{if(!e)return!1;const t=e.toLowerCase();return $O.some(n=>t.includes(n))},wd=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${FO(t)}'`},IO=e=>e.toLowerCase().split(/([\s\-_/]+)/).map(t=>!t.length||/[\s\-_/]+/.test(t)?t:t.charAt(0).toUpperCase()+t.slice(1)).join(""),BO=e=>e.toLowerCase().replace(/(^\s*[a-z])|([\.\!\?]\s*[a-z])/g,n=>n.toUpperCase()),UO=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&N0.includes(n))return n;const a=typeof t=="string"?t.trim().toLowerCase():"";return a&&N0.includes(a)?a:S0},qO=e=>{const t=E0[e]??E0[S0];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},HO=(e,t)=>{const n=[];return Object.entries(e).forEach(([a,i])=>{if(!i.length)return;i.some(u=>{const d=u[t];return u.original!==d})&&n.push(a)}),n.sort((a,i)=>a.localeCompare(i)),n},VO=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:a,mode:i})=>{const l=Array.from(new Set(ut(e)));l.sort((y,w)=>y.localeCompare(w));const u=new Set(l),d=t.filter(y=>k0(n[y]??null)),m=HO(a,i),v=new Set;d.forEach(y=>{u.has(y)||v.add(y)}),m.forEach(y=>{u.has(y)||v.add(y)});const p=Array.from(v).sort((y,w)=>y.localeCompare(w)),_=l.filter(y=>!k0(n[y]??null));return{selectedColumns:l,autoDetectionActive:l.length===0,recommendedColumns:p,nonTextSelected:_,textColumnCount:d.length,inconsistentColumns:m}},M0=(e,t)=>e.slice(0,t),WO=e=>{const t=M0(e,DO);return{preview:t,remaining:Math.max(e.length-t.length,0)}},A0=e=>{const t=M0(e,zO);return{preview:t,remaining:Math.max(e.length-t.length,0)}},KO=(e,t=LO)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(a=>{!a||typeof a!="object"||Object.entries(a).forEach(([i,l])=>{const u=typeof i=="string"?i.trim():"";if(!u)return;let d="";if(l==null)d="";else if(typeof l=="string")d=l;else if(typeof l=="number"||typeof l=="boolean")d=String(l);else try{d=JSON.stringify(l)}catch{d=String(l)}if(!d.length)return;const m=wd(d),v={original:m,lower:wd(d.toLowerCase()),upper:wd(d.toUpperCase()),title:wd(IO(d)),sentence:wd(BO(d))},p=n[u]??[];p.find(_=>_.original===m)||p.length>=t||(n[u]=[...p,v])})}),n},YO=(e,t,n,a=RO)=>{if(!t.length)return[];const i=[];for(const l of t){if(i.length>=a)break;const u=e[l];if(!u||!u.length)continue;const d=u.map(m=>`${m.original}  ${m[n]}`);i.push({column:l,values:d,overflow:0})}return i},QO={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,inconsistentColumns:[]},GO=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:a,renderMultiSelectField:i,renderParameterField:l,columnSummary:u,modeDetails:d,sampleMap:m,selectedMode:v})=>{if(!n&&!a)return null;const p=u.selectedColumns.length,_=WO(u.recommendedColumns),y=A0(u.inconsistentColumns),w=A0(u.nonTextSelected),x=YO(m,u.selectedColumns,v),S=!e||!t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Text case normalization"})}),r.jsxs("p",{className:"canvas-modal__note",children:[r.jsx("strong",{children:d.label})," mode. ",d.guidance," Example: ",d.example,"."]}),u.autoDetectionActive?r.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):r.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",r.jsx("strong",{children:p})," column",p===1?"":"s"," for case normalization."]}),x.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",x.map(k=>`${k.column} (${k.values.join("; ")})`).join(" | "),"."]}),y.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns with mixed casing: ",y.preview.join(", "),y.remaining>0?`, ... (${y.remaining} more)`:"","."]}),_.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",_.preview.join(", "),_.remaining>0?`, ... (${_.remaining} more)`:"","."]}),w.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[w.preview.join(", ")," ",w.preview.length===1?"is":"are"," not text-like.",w.remaining>0?` ${w.remaining} more column${w.remaining===1?" is":"s are"} also non-text.`:" Confirm case normalization is necessary for these values."]}),S?e?r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before adjusting case."}):null,n&&r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Columns to normalize"}),i(n)]}),a&&r.jsx("div",{className:"canvas-modal__parameter-list",children:l(a)})]})},O0=["preset_digits_only","preset_letters_only","preset_whitespace_collapse","custom"],P0="preset_digits_only",XO=["string","object","text","category","mixed","varchar","char"],JO=3,T0=60,ZO=6,eP=4,tP=5,$0={preset_digits_only:{label:"Digits only preset",guidance:"Keeps digits while stripping other characters. Useful for IDs or numeric codes.",example:"Order #123A  123"},preset_letters_only:{label:"Letters only preset",guidance:"Removes digits and symbols, retaining alphabetical characters.",example:"SKU-45X  SKUX"},preset_whitespace_collapse:{label:"Collapse whitespace preset",guidance:"Replaces runs of whitespace with a single space, trimming leading/trailing spacing.",example:`ACME	Corp
 ACME Corp`},custom:{label:"Custom regex",guidance:"Applies your regex and replacement text. Supports JavaScript-style regular expressions.",example:'Pattern: /d+/g Replacement: "#"'}},nP=e=>e.length<=T0?e:`${e.slice(0,T0-1)}...`,jd=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${nP(t)}'`},L0=e=>{if(!e)return!1;const t=e.toLowerCase();return XO.some(n=>t.includes(n))},sP=e=>e.replace(/\s+/g," ").trim(),rP=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&O0.includes(n))return n;const a=typeof t=="string"?t.trim().toLowerCase():"";return a&&O0.includes(a)?a:P0},aP=e=>{const t=$0[e]??$0[P0];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},oP=e=>{const t=new Set,n=new Set,a=new Set;Object.entries(e).forEach(([l,u])=>{u.length&&u.forEach(d=>{d.hasDigits&&t.add(l),d.hasLetters&&n.add(l),d.hasWhitespaceRuns&&a.add(l)})});const i=l=>Array.from(l).sort((u,d)=>u.localeCompare(d));return{digits:i(t),letters:i(n),whitespace:i(a)}},iP=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:a})=>{const i=Array.from(new Set(ut(e)));i.sort((w,x)=>w.localeCompare(x));const l=new Set(i),u=t.filter(w=>L0(n[w]??null)),{digits:d,letters:m,whitespace:v}=oP(a),p=new Set;u.forEach(w=>{l.has(w)||p.add(w)}),[...d,...m,...v].forEach(w=>{l.has(w)||p.add(w)});const _=Array.from(p).sort((w,x)=>w.localeCompare(x)),y=i.filter(w=>!L0(n[w]??null));return{selectedColumns:i,autoDetectionActive:i.length===0,recommendedColumns:_,nonTextSelected:y,textColumnCount:u.length,digitsCandidates:d,lettersCandidates:m,whitespaceCandidates:v}},D0=(e,t)=>e.slice(0,t),lP=e=>{const t=D0(e,ZO);return{preview:t,remaining:Math.max(e.length-t.length,0)}},Bf=e=>{const t=D0(e,eP);return{preview:t,remaining:Math.max(e.length-t.length,0)}},cP=(e,t=JO)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(a=>{!a||typeof a!="object"||Object.entries(a).forEach(([i,l])=>{const u=typeof i=="string"?i.trim():"";if(!u)return;let d="";if(l==null)d="";else if(typeof l=="string")d=l;else if(typeof l=="number"||typeof l=="boolean")d=String(l);else try{d=JSON.stringify(l)}catch{d=String(l)}if(!d.length)return;const m=jd(d),v={original:m,presetDigits:jd(d.replace(/\D+/g,"")),presetLetters:jd(d.replace(/[^A-Za-z]+/g,"")),presetWhitespace:jd(sP(d)),hasDigits:/\d/.test(d),hasLetters:/[A-Za-z]/.test(d),hasWhitespaceRuns:/\s{2,}/.test(d)||/\t|\n|\r/.test(d)},p=n[u]??[];p.find(_=>_.original===m)||p.length>=t||(n[u]=[...p,v])})}),n},uP=(e,t,n)=>{const a=n??"",i=l=>l.length?l:"''";switch(t){case"preset_letters_only":return`${i(e.original)}  ${i(e.presetLetters)}`;case"preset_whitespace_collapse":return`${i(e.original)}  ${i(e.presetWhitespace)}`;case"custom":try{const l=new RegExp(a.split("|||")[0]??"",a.split("|||")[1]??""),u=jd(e.original.replace(l,a.split("|||")[2]??""));return`${i(e.original)}  ${i(u)}`}catch{return`${i(e.original)}  (invalid regex)`}case"preset_digits_only":default:return`${i(e.original)}  ${i(e.presetDigits)}`}},dP=(e,t,n,a,i=tP)=>{if(!t.length)return[];const l=[];for(const u of t){if(l.length>=i)break;const d=e[u];if(!d||!d.length)continue;const m=d.map(v=>uP(v,n,a));l.push({column:u,values:m,overflow:0})}return l},mP={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,digitsCandidates:[],lettersCandidates:[],whitespaceCandidates:[]},fP=e=>{if(!e)return null;const t=e.split("|||"),n=t[0]??"",a=t[1]??"",i=t[2]??"";return!n.trim()&&!i.trim()?null:`Pattern: /${n||"(empty)"}/${a||"(none)"} Replacement: ${i||"''"}`},hP=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:a,patternParameter:i,replacementParameter:l,renderMultiSelectField:u,renderParameterField:d,columnSummary:m,modeDetails:v,sampleMap:p,selectedMode:_,replacementValue:y})=>{if(!n&&!a&&!i&&!l)return null;const w=m.selectedColumns.length,x=lP(m.recommendedColumns),S=Bf(m.digitsCandidates),k=Bf(m.lettersCandidates),M=Bf(m.whitespaceCandidates),P=Bf(m.nonTextSelected),T=fP(y),j=dP(p,m.selectedColumns,_,y),O=!e||!t,A=_==="custom";return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Regex cleanup"})}),r.jsxs("p",{className:"canvas-modal__note",children:[r.jsx("strong",{children:v.label})," mode. ",v.guidance," Example: ",v.example,"."]}),T&&r.jsx("p",{className:"canvas-modal__note",children:T}),m.autoDetectionActive?r.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):r.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",r.jsx("strong",{children:w})," column",w===1?"":"s"," for regex cleanup."]}),j.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",j.map(z=>`${z.column} (${z.values.join("; ")})`).join(" | "),"."]}),S.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns containing digits: ",S.preview.join(", "),S.remaining>0?`, ... (${S.remaining} more)`:"","."]}),k.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns containing letters: ",k.preview.join(", "),k.remaining>0?`, ... (${k.remaining} more)`:"","."]}),M.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns with repeated whitespace: ",M.preview.join(", "),M.remaining>0?`, ... (${M.remaining} more)`:"","."]}),x.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",x.preview.join(", "),x.remaining>0?`, ... (${x.remaining} more)`:"","."]}),P.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[P.preview.join(", ")," ",P.preview.length===1?"is":"are"," not text-like.",P.remaining>0?` ${P.remaining} more column${P.remaining===1?" is":"s are"} also non-text.`:" Confirm regex cleanup is appropriate for these values."]}),A&&!T&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Custom regex mode is enabled, but no pattern or replacement details were detected. Provide both to avoid no-ops."}),O?e?r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before applying regex transformations."}):null,n&&r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Columns to clean"}),u(n)]}),(a||i||l)&&r.jsxs("div",{className:"canvas-modal__parameter-list",children:[a?d(a):null,i?d(i):null,l?d(l):null]})]})},z0=["negative_to_nan","zero_to_nan","percentage_bounds","age_bounds","custom_range"],R0="negative_to_nan",pP=["int","float","double","numeric","number","decimal","real","long"],gP=3,_P=6,vP=4,yP=5,F0={negative_to_nan:{label:"Negative to missing",guidance:"Sets negative readings to missing. Useful for metrics that cannot drop below zero.",example:"Inventory change 3  missing"},zero_to_nan:{label:"Zero to missing",guidance:"Treats placeholder zeros as missing values.",example:"Temperature 0  missing"},percentage_bounds:{label:"Percentage bounds",guidance:"Keeps readings within 0-100% unless you provide custom bounds.",example:"Completion 135%  missing"},age_bounds:{label:"Age bounds",guidance:"Flags implausible ages outside a typical 0-120 range unless overridden.",example:"Customer age 212  missing"},custom_range:{label:"Custom bounds",guidance:"Applies your minimum/maximum limits to selected columns.",example:"Metric < 10 or > 75  missing"}},bP=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return t.length<=60?t:`${t.slice(0,59)}`},xP=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="boolean")return e?1:0;if(typeof e=="string"){const t=e.trim();if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null},wP=e=>{if(!e)return!1;const t=e.toLowerCase();return pP.some(n=>t.includes(n))},jP=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&z0.includes(n))return n;const a=typeof t=="string"?t.trim().toLowerCase():"";return a&&z0.includes(a)?a:R0},NP=e=>{const t=F0[e]??F0[R0];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},SP=e=>{const t=new Set,n=new Set,a=new Set,i=new Set;Object.entries(e).forEach(([u,d])=>{d.forEach(m=>{m.isNegative&&t.add(u),m.isZero&&n.add(u),(m.numericValue<0||m.numericValue>100)&&a.add(u),(m.numericValue<0||m.numericValue>120)&&i.add(u)})});const l=u=>Array.from(u).sort((d,m)=>d.localeCompare(m));return{negative:l(t),zeros:l(n),percentage:l(a),age:l(i)}},CP=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:a})=>{const i=Array.from(new Set(ut(e))).sort((x,S)=>x.localeCompare(S)),l=new Set(i),u=t.filter(x=>wP(n[x]??null)),d=new Set(u),{negative:m,zeros:v,percentage:p,age:_}=SP(a),y=new Set;u.forEach(x=>{l.has(x)||y.add(x)}),[...m,...v,...p,..._].forEach(x=>{l.has(x)||y.add(x)});const w=i.filter(x=>!d.has(x));return{selectedColumns:i,autoDetectionActive:i.length===0,recommendedColumns:Array.from(y).sort((x,S)=>x.localeCompare(S)),nonNumericSelected:w,numericColumnCount:u.length,negativeCandidates:m,zeroCandidates:v,percentageOutliers:p,ageOutliers:_}},EP=e=>{const t=e.slice(0,_P);return{preview:t,remaining:Math.max(e.length-t.length,0)}},Nd=e=>{const t=e.slice(0,vP);return{preview:t,remaining:Math.max(e.length-t.length,0)}},kP=(e,t=gP)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(a=>{!a||typeof a!="object"||Object.entries(a).forEach(([i,l])=>{const u=typeof i=="string"?i.trim():"";if(!u)return;const d=xP(l);if(d===null)return;const m=bP(String(l)),v={originalDisplay:m,numericValue:d,isNegative:d<0,isZero:Math.abs(d)<=1e-9},p=n[u]??[];p.find(_=>_.originalDisplay===m)||p.length>=t||(n[u]=[...p,v])})}),n},MP=0,AP=100,OP=0,PP=120,TP=(e,t,n,a)=>{switch(t){case"negative_to_nan":{const i=n??0;return e.numericValue<i?{flagged:!0,reason:`value < ${i}`}:a!==null&&e.numericValue>a?{flagged:!0,reason:`value > ${a}`}:{flagged:!1,reason:null}}case"zero_to_nan":return{flagged:e.isZero,reason:e.isZero?"zero placeholder":null};case"percentage_bounds":{const i=n??MP,l=a??AP;return e.numericValue<i?{flagged:!0,reason:`value < ${i}`}:e.numericValue>l?{flagged:!0,reason:`value > ${l}`}:{flagged:!1,reason:null}}case"age_bounds":{const i=n??OP,l=a??PP;return e.numericValue<i?{flagged:!0,reason:`value < ${i}`}:e.numericValue>l?{flagged:!0,reason:`value > ${l}`}:{flagged:!1,reason:null}}case"custom_range":default:{const i=n!=null,l=a!=null;return!i&&!l?{flagged:!1,reason:null}:i&&e.numericValue<n?{flagged:!0,reason:`value < ${n}`}:l&&e.numericValue>a?{flagged:!0,reason:`value > ${a}`}:{flagged:!1,reason:null}}}},$P=(e,t,n,a)=>{const{flagged:i,reason:l}=TP(e,t,n,a);return i?`${e.originalDisplay}  flagged (${l??"rule match"})`:`${e.originalDisplay}  ok`},LP=(e,t,n,a,i,l=yP)=>{if(!t.length)return[];const u=[];for(const d of t){if(u.length>=l)break;const m=e[d];!m||!m.length||u.push({column:d,values:m.map(v=>$P(v,n,a,i)),overflow:0})}return u},DP={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonNumericSelected:[],numericColumnCount:0,negativeCandidates:[],zeroCandidates:[],percentageOutliers:[],ageOutliers:[]},zP=(e,t,n)=>{if(e==="custom_range"){if(t===null&&n===null)return"Specify a minimum and/or maximum to enable the custom range rule.";const a=t===null?"-":String(t),i=n===null?"":String(n);return`Custom bounds active: [${a}, ${i}].`}if(e==="percentage_bounds")return`Using percentage bounds ${t??0}${n??100}.`;if(e==="age_bounds")return`Using age bounds ${t??0}${n??120}.`;if(e==="negative_to_nan"&&(t!==null||n!==null)){const a=t??0;return n===null?`Negative-to-missing rule overrides values below ${a}.`:`Negative-to-missing rule overrides values < ${a} or > ${n}.`}return null},RP=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:a,minValueParameter:i,maxValueParameter:l,renderMultiSelectField:u,renderParameterField:d,columnSummary:m,modeDetails:v,sampleMap:p,selectedMode:_,minValue:y,maxValue:w})=>{if(!n&&!a&&!i&&!l)return null;const{selectedColumns:x,autoDetectionActive:S}=m,k=x.length,M=EP(m.recommendedColumns),P=Nd(m.negativeCandidates),T=Nd(m.zeroCandidates),j=Nd(m.percentageOutliers),O=Nd(m.ageOutliers),A=Nd(m.nonNumericSelected),z=LP(p,x,_,y,w),$=zP(_,y,w),q=!e||!t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Replace invalid numeric values"})}),r.jsxs("p",{className:"canvas-modal__note",children:[r.jsx("strong",{children:v.label})," rule. ",v.guidance," Example: ",v.example,"."]}),$&&r.jsx("p",{className:"canvas-modal__note",children:$}),S?r.jsx("p",{className:"canvas-modal__note",children:"No columns selectednumeric columns will be auto-detected when the node runs."}):r.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",r.jsx("strong",{children:k})," column",k===1?"":"s"," for invalid value cleanup."]}),z.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",z.map(V=>`${V.column} (${V.values.join("; ")})`).join(" | "),"."]}),P.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns with negative values: ",P.preview.join(", "),P.remaining>0?`, ... (${P.remaining} more)`:"","."]}),T.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns with placeholder zeros: ",T.preview.join(", "),T.remaining>0?`, ... (${T.remaining} more)`:"","."]}),j.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Percentage candidates with values outside 0-100: ",j.preview.join(", "),j.remaining>0?`, ... (${j.remaining} more)`:"","."]}),O.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Age-like values outside 0-120: ",O.preview.join(", "),O.remaining>0?`, ... (${O.remaining} more)`:"","."]}),M.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Other numeric columns: ",M.preview.join(", "),M.remaining>0?`, ... (${M.remaining} more)`:"","."]}),A.preview.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[A.preview.join(", ")," ",A.preview.length===1?"is":"are"," not numeric-type columns.",A.remaining>0?` ${A.remaining} more column${A.remaining===1?" is":"s are"} also non-numeric.`:" Verify the selection or adjust the rule."]}),q?e?r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review numeric insights."}):r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect numeric samples before applying replacements."}):null,n&&r.jsxs("div",{className:"canvas-modal__subsection",children:[r.jsx("h4",{children:"Columns to clean"}),u(n)]}),(a||i||l)&&r.jsxs("div",{className:"canvas-modal__parameter-list",children:[a?d(a):null,i?d(i):null,l?d(l):null]})]})};let FP="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",I0=(e=21)=>{let t="",n=e|0;for(;n--;)t+=FP[Math.random()*64|0];return t};const B0=[{value:"add",label:"Addition (+)"},{value:"subtract",label:"Subtraction ()"},{value:"multiply",label:"Multiplication ()"},{value:"divide",label:"Division ()"}],U0=[{value:"sum",label:"Sum"},{value:"mean",label:"Mean"},{value:"min",label:"Minimum"},{value:"max",label:"Maximum"},{value:"std",label:"Standard deviation"},{value:"median",label:"Median"},{value:"count",label:"Count (non-missing)"},{value:"range",label:"Range (max - min)"}],Bg=[{value:"token_sort_ratio",label:"Token Sort  Same words, ignore order",description:"Split into words, sort alphabetically, then compare. Great when the same words appear in different order."},{value:"token_set_ratio",label:"Token Set  Unique words, ignore extras",description:"Focus on overlapping unique words and down-weight extras. Best when one string has additional words."},{value:"ratio",label:"Character Ratio  Raw string similarity",description:"Compare characters in order using edit distance. Sensitive to spelling differences."}],Uf=[{value:"year",label:"Year"},{value:"quarter",label:"Quarter"},{value:"month",label:"Month"},{value:"month_name",label:"Month name"},{value:"week",label:"ISO week number"},{value:"day",label:"Day of month"},{value:"day_name",label:"Day name"},{value:"weekday",label:"Weekday index (Mon=0)"},{value:"is_weekend",label:"Is weekend"},{value:"hour",label:"Hour"},{value:"minute",label:"Minute"},{value:"second",label:"Second"},{value:"season",label:"Season"},{value:"time_of_day",label:"Time of day bucket"}],IP=new Set(Uf.map(e=>e.value)),Oc=[{value:"arithmetic",label:"Arithmetic",description:"Combine columns and constants using addition, subtraction, multiplication, or division.",defaultMethod:"add"},{value:"ratio",label:"Ratio",description:"Divide one column or group of columns by another with safe zero handling.",defaultMethod:"ratio"},{value:"stat",label:"Statistics",description:"Compute sums, averages, min/max, or dispersion metrics across columns.",defaultMethod:"mean"},{value:"similarity",label:"Text similarity",description:"Score two text columns using rapidfuzz token-based similarity.",defaultMethod:"token_sort_ratio"},{value:"datetime_extract",label:"Datetime extraction",description:"Expand datetime columns into year, month, weekday, season and similar features.",defaultMethod:"datetime_extract"}],Sd="UTC",qf=e=>e?Array.isArray(e)?Array.from(new Set(e.map(t=>typeof t=="string"?t.trim():String(t??"").trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?qf(e.split(",")):[]:[],q0=e=>{if(!e)return[];if(Array.isArray(e)){const n=[];return e.forEach(a=>{const i=Number(a);Number.isFinite(i)&&n.push(i)}),n}if(typeof e=="string")return q0(e.split(/[;,]+/));const t=Number(e);return Number.isFinite(t)?[t]:[]},Ug=e=>{const t=Number(e);return Number.isFinite(t)?t:null},H0=(e,t)=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e!==0:t;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(["true","1","yes","y","on"].includes(n))return!0;if(["false","0","no","n","off"].includes(n))return!1}return t},BP=(e,t)=>{var a,i,l,u,d;if(typeof t!="string")return((a=Oc.find(m=>m.value===e))==null?void 0:a.defaultMethod)??"";const n=t.trim().toLowerCase();return n?e==="arithmetic"?((l=B0.find(m=>m.value===n))==null?void 0:l.value)??"add":e==="stat"?((u=U0.find(m=>m.value===n))==null?void 0:u.value)??"mean":e==="similarity"?((d=Bg.find(m=>m.value===n))==null?void 0:d.value)??"token_sort_ratio":e==="ratio"?"ratio":e==="datetime_extract"?"datetime_extract":n:((i=Oc.find(m=>m.value===e))==null?void 0:i.defaultMethod)??""},UP=e=>{if(typeof e!="string")return"arithmetic";const t=e.trim().toLowerCase();return t==="arithmetic"||t==="ratio"||t==="stat"||t==="similarity"||t==="datetime_extract"?t:"arithmetic"},qP=e=>{const t=qf(e);return t.length?t.filter(n=>IP.has(n)):["year","month","day"]},HP=e=>typeof e!="string"?Sd:e.trim()||Sd,V0=e=>{if(!Array.isArray(e))return[];const t=[];return e.forEach((n,a)=>{if(!n||typeof n!="object")return;const i=n,l=UP(i.operation_type??i.type),u=i.operation_id??i.id??`feature_math_${a+1}`,d=typeof u=="string"&&u.trim()?u.trim():`feature_math_${a+1}`,m=BP(l,i.method),v=qf(i.input_columns??i.inputs??i.inputColumns),p=qf(i.secondary_columns??i.denominator??i.secondaryColumns),_=q0(i.constants),y=typeof i.output_column=="string"?i.output_column.trim():"",w=typeof i.output_prefix=="string"?i.output_prefix.trim():"",x=l==="datetime_extract"?qP(i.datetime_features):[],S=l==="datetime_extract"?HP(i.timezone):Sd,k=Ug(i.fillna),M=(()=>{const A=Ug(i.round??i.round_digits);return Number.isInteger(A??NaN),A})(),P=Ug(i.epsilon),T=l==="similarity"?H0(i.normalize,!1):!1,j=i.allow_overwrite===void 0?null:H0(i.allow_overwrite,!1),O=typeof i.description=="string"?i.description:void 0;t.push({id:d,type:l,method:m,inputColumns:v,secondaryColumns:p,constants:_,outputColumn:y,outputPrefix:w,datetimeFeatures:x,timezone:S,fillna:k,roundDigits:M,normalize:T,epsilon:P,allowOverwrite:j,description:O})}),t},VP=e=>{const t={id:e.id,operation_id:e.id,type:e.type,operation_type:e.type,method:e.method,input_columns:e.inputColumns,secondary_columns:e.secondaryColumns,constants:e.constants,output_column:e.outputColumn,output_prefix:e.outputPrefix};return e.type==="datetime_extract"?(t.datetime_features=e.datetimeFeatures.length?e.datetimeFeatures:["year","month","day"],t.timezone=e.timezone||Sd):e.datetimeFeatures.length&&(t.datetime_features=e.datetimeFeatures),e.type==="similarity"&&(t.normalize=e.normalize),e.fillna!==null&&Number.isFinite(e.fillna)&&(t.fillna=e.fillna),e.roundDigits!==null&&Number.isFinite(e.roundDigits)&&(t.round=e.roundDigits,t.round_digits=e.roundDigits),e.epsilon!==null&&Number.isFinite(e.epsilon)&&(t.epsilon=e.epsilon),e.allowOverwrite!==null&&(t.allow_overwrite=e.allowOverwrite),e.description&&e.description.trim()&&(t.description=e.description.trim()),t},WP=e=>e.map(t=>VP(t)),KP={arithmetic:{method:"add",constants:[]},ratio:{method:"ratio",constants:[]},stat:{method:"mean",constants:[]},similarity:{method:"token_sort_ratio",constants:[],normalize:!1},datetime_extract:{method:"datetime_extract",datetimeFeatures:["year","month","day"]}},W0=(e,t)=>{var i;const n=KP[e]??{};let a=`math_${e}_${I0(6)}`;for(;t.has(a);)a=`math_${e}_${I0(6)}`;return{id:a,type:e,method:n.method??((i=Oc.find(l=>l.value===e))==null?void 0:i.defaultMethod)??"add",inputColumns:[],secondaryColumns:[],constants:n.constants??[],outputColumn:"",outputPrefix:"",datetimeFeatures:e==="datetime_extract"?n.datetimeFeatures??["year","month","day"]:[],timezone:Sd,fillna:null,roundDigits:null,normalize:n.normalize??!1,epsilon:null,allowOverwrite:null,description:void 0}},YP=(e,t)=>{const n=new Map;return t==null||t.forEach(a=>{a.operations.forEach(i=>{n.has(i.operation_id)||n.set(i.operation_id,i)})}),e.map((a,i)=>{const l=n.get(a.id),u=`${i+1}. ${a.type.replace("_"," ")}${a.method?`  ${a.method}`:""}`;return{id:a.id,label:u,status:l==null?void 0:l.status,message:(l==null?void 0:l.message)??void 0,outputColumns:(l==null?void 0:l.output_columns)??[]}})},K0=e=>e==="arithmetic"?B0:e==="stat"?U0:e==="similarity"?Bg:e==="ratio"?[{value:"ratio",label:"Ratio (numerator / denominator)"}]:[{value:"datetime_extract",label:"Extract datetime parts"}],QP=e=>{const t=Bg.find(n=>n.value===e);return t!=null&&t.description?t.description:"Compare the input text columns using the selected similarity technique."},GP={applied:"Applied",skipped:"Skipped",failed:"Failed"},XP={applied:"canvas-cast__chip--applied",skipped:"canvas-cast__chip--muted",failed:"canvas-cast__chip--attention"},JP=new Set(Uf.map(e=>e.value)),ZP=(e,t=4)=>{if(!e.length)return"No columns yet";const n=e.slice(0,t),a=e.length-n.length;return a>0?`${n.join(", ")}  (${a} more)`:n.join(", ")},Y0=e=>e.trim()?Array.from(new Set(e.split(",").map(t=>t.trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):[],eT=e=>e.trim()?e.split(",").map(t=>Number(t.trim())).filter(t=>Number.isFinite(t)):[],tT=e=>e==="failed"?"canvas-modal__note canvas-modal__note--error":e==="skipped"?"canvas-modal__note canvas-modal__note--warning":"canvas-modal__note canvas-modal__note--info",nT=({index:e,total:t,operation:n,summary:a,availableColumns:i,isCollapsed:l,onToggleCollapsed:u,onDuplicate:d,onRemove:m,onReorder:v,onChange:p})=>{var fe;const _=f.useMemo(()=>K0(n.type),[n.type]),y=f.useMemo(()=>{var ae;return((ae=Oc.find(pe=>pe.value===n.type))==null?void 0:ae.label)??n.type},[n.type]),w=f.useMemo(()=>{var ae;return((ae=_.find(pe=>pe.value===n.method))==null?void 0:ae.label)??n.method},[_,n.method]),x=f.useMemo(()=>n.type==="similarity"?QP(n.method):"",[n.method,n.type]),[S,k]=f.useState(n.inputColumns.join(", ")),[M,P]=f.useState(n.secondaryColumns.join(", ")),[T,j]=f.useState(n.constants.join(", "));f.useEffect(()=>{k(n.inputColumns.join(", "))},[n.inputColumns]),f.useEffect(()=>{P(n.secondaryColumns.join(", "))},[n.secondaryColumns]),f.useEffect(()=>{j(n.constants.join(", "))},[n.constants]);const O=()=>{p(n.id,{inputColumns:Y0(S)})},A=()=>{p(n.id,{secondaryColumns:Y0(M)})},z=()=>{p(n.id,{constants:eT(T)})},$=`feature-math-toggle-${n.id}`,q=`feature-math-body-${n.id}`,V=`feature-math-input-columns-${n.id}`,R=`feature-math-secondary-columns-${n.id}`,ee=a==null?void 0:a.status,le=ee?r.jsx("span",{className:`canvas-cast__chip ${XP[ee]??""}`,style:{marginLeft:"0.5rem"},children:GP[ee]}):null,D=a!=null&&a.message?a.message.trim():"",X=tT(ee),Y=(fe=a==null?void 0:a.outputColumns)!=null&&fe.length?a.outputColumns.join(", "):"",K=ZP(n.inputColumns),U=n.type==="ratio"||n.type==="similarity",te=n.type==="arithmetic"||n.type==="stat"||n.type==="ratio",W=n.type==="arithmetic"||n.type==="stat"||n.type==="ratio",I=n.type==="similarity",Q=n.type==="datetime_extract",me=n.type==="stat"||n.type==="datetime_extract",J=f.useMemo(()=>{if(!i.length)return"";const ae=i.slice(0,6),pe=i.length-ae.length;return pe>0?`${ae.join(", ")}  (${pe} more)`:ae.join(", ")},[i]),H=ae=>{if(!ae||!JP.has(ae))return;const pe=new Set(n.datetimeFeatures);pe.has(ae)?pe.delete(ae):pe.add(ae),p(n.id,{datetimeFeatures:Array.from(pe)})},Z=ae=>pe=>{const Ve=pe.target.value;if(Ve===""){p(n.id,{[ae]:null});return}const st=Number(Ve);Number.isFinite(st)&&(ae==="roundDigits"?p(n.id,{roundDigits:Math.round(st)}):ae==="fillna"?p(n.id,{fillna:st}):p(n.id,{epsilon:st}))},ne=n.allowOverwrite===null?"inherit":n.allowOverwrite?"allow":"prevent";return r.jsxs("div",{className:"canvas-imputer__card",children:[r.jsxs("div",{className:"canvas-imputer__card-header",children:[r.jsxs("button",{type:"button",id:$,className:"canvas-imputer__card-toggle",onClick:()=>u(n.id),"aria-expanded":!l,"aria-controls":q,children:[r.jsx("span",{className:`canvas-imputer__toggle-icon${l?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),r.jsxs("span",{className:"canvas-imputer__card-text",children:[r.jsxs("span",{className:"canvas-imputer__card-title",children:["Operation ",e+1]}),r.jsxs("span",{className:"canvas-imputer__card-summary",children:[y,w?`  ${w}`:"",n.outputColumn?`   ${n.outputColumn}`:"",le]}),r.jsxs("span",{className:"canvas-modal__meta",children:["Inputs: ",K]})]})]}),r.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>m(n.id),"aria-label":`Remove operation ${e+1}`,children:"Remove"})]}),!l&&r.jsxs("div",{className:"canvas-imputer__card-body",id:q,children:[r.jsx("div",{className:"canvas-imputer__row",children:r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>d(n.id),children:"Duplicate"}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>v(n.id,"up"),disabled:e===0,children:"Move up"}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>v(n.id,"down"),disabled:e>=t-1,children:"Move down"})]})}),D&&r.jsx("p",{className:X,children:D}),Y&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Outputs: ",Y]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-type`,children:"Operation type"}),r.jsx("select",{id:`feature-math-${n.id}-type`,value:n.type,onChange:ae=>p(n.id,{type:ae.target.value}),children:Oc.map(ae=>r.jsx("option",{value:ae.value,children:ae.label},ae.value))})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-method`,children:"Method"}),r.jsx("select",{id:`feature-math-${n.id}-method`,value:n.method,onChange:ae=>p(n.id,{method:ae.target.value}),children:_.map(ae=>r.jsx("option",{value:ae.value,children:ae.label},ae.value))})]}),n.type==="similarity"&&x&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:x}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-input-columns`,children:"Input columns"}),r.jsx("input",{id:`feature-math-${n.id}-input-columns`,type:"text",value:S,onChange:ae=>k(ae.target.value),onBlur:O,onKeyDown:ae=>{ae.key==="Enter"&&(ae.preventDefault(),O())},placeholder:"col_a, col_b",list:V}),r.jsx("datalist",{id:V,children:i.map(ae=>r.jsx("option",{value:ae},`${n.id}-input-option-${ae}`))}),J&&r.jsxs("p",{className:"canvas-modal__meta",children:["Available: ",J]})]}),U&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-secondary-columns`,children:n.type==="ratio"?"Denominator columns":"Compare against"}),r.jsx("input",{id:`feature-math-${n.id}-secondary-columns`,type:"text",value:M,onChange:ae=>P(ae.target.value),onBlur:A,onKeyDown:ae=>{ae.key==="Enter"&&(ae.preventDefault(),A())},placeholder:n.type==="ratio"?"denominator_col":"comparison column",list:R}),r.jsx("datalist",{id:R,children:i.map(ae=>r.jsx("option",{value:ae},`${n.id}-secondary-option-${ae}`))}),r.jsx("p",{className:"canvas-modal__meta",children:"Comma separated list"})]}),te&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-constants`,children:"Constants (optional)"}),r.jsx("input",{id:`feature-math-${n.id}-constants`,type:"text",value:T,onChange:ae=>j(ae.target.value),onBlur:z,onKeyDown:ae=>{ae.key==="Enter"&&(ae.preventDefault(),z())},placeholder:"0.0, 1.5"}),r.jsx("p",{className:"canvas-modal__meta",children:"Numbers separated by commas are added alongside the selected columns."})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-output-column`,children:"Output column (optional)"}),r.jsx("input",{id:`feature-math-${n.id}-output-column`,type:"text",value:n.outputColumn,onChange:ae=>p(n.id,{outputColumn:ae.target.value}),placeholder:"custom_feature_name"}),r.jsx("p",{className:"canvas-modal__meta",children:"Leave blank to derive a name automatically."})]}),me&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-output-prefix`,children:"Output prefix"}),r.jsx("input",{id:`feature-math-${n.id}-output-prefix`,type:"text",value:n.outputPrefix,onChange:ae=>p(n.id,{outputPrefix:ae.target.value}),placeholder:"prefix_"}),r.jsx("p",{className:"canvas-modal__meta",children:"Applied to generated column names (statistics or datetime features)."})]}),W&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-fillna`,children:"Fill missing result with"}),r.jsx("input",{id:`feature-math-${n.id}-fillna`,type:"number",value:n.fillna??"",onChange:Z("fillna"),placeholder:"none"}),r.jsx("p",{className:"canvas-modal__meta",children:"Applies after computing the operation."})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-round`,children:"Round digits"}),r.jsx("input",{id:`feature-math-${n.id}-round`,type:"number",value:n.roundDigits??"",onChange:Z("roundDigits"),placeholder:"none",step:1}),r.jsx("p",{className:"canvas-modal__meta",children:"Leave blank for no rounding."})]})]}),n.type==="ratio"&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-epsilon`,children:"Division epsilon"}),r.jsx("input",{id:`feature-math-${n.id}-epsilon`,type:"number",value:n.epsilon??"",onChange:Z("epsilon"),placeholder:"inherit",step:"any"}),r.jsx("p",{className:"canvas-modal__meta",children:"Overrides the node-level epsilon for this ratio."})]}),I&&r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsxs("label",{htmlFor:`feature-math-${n.id}-normalize`,className:"canvas-modal__boolean-control",children:[r.jsx("input",{id:`feature-math-${n.id}-normalize`,type:"checkbox",checked:n.normalize,onChange:ae=>p(n.id,{normalize:ae.target.checked})}),r.jsx("span",{children:"Normalize scores to the [0, 1] range"})]}),r.jsx("p",{className:"canvas-modal__meta",children:"Useful when chaining similarity outputs into downstream calculations."})]}),Q&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"canvas-imputer__row canvas-imputer__row--wrap",children:r.jsxs("fieldset",{children:[r.jsx("legend",{children:"Datetime features"}),r.jsx("div",{className:"canvas-modal__checkbox-grid",children:Uf.map(ae=>{const pe=`feature-math-${n.id}-datetime-${ae.value}`,Ve=n.datetimeFeatures.includes(ae.value);return r.jsxs("label",{className:"canvas-modal__checkbox-item",htmlFor:pe,children:[r.jsx("input",{id:pe,type:"checkbox",checked:Ve,onChange:()=>H(ae.value)}),r.jsx("span",{className:"canvas-modal__checkbox-label",children:ae.label})]},ae.value)})})]})}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-timezone`,children:"Timezone override"}),r.jsx("input",{id:`feature-math-${n.id}-timezone`,type:"text",value:n.timezone,onChange:ae=>p(n.id,{timezone:ae.target.value}),placeholder:"UTC"}),r.jsx("p",{className:"canvas-modal__meta",children:"Use an IANA timezone identifier, e.g. America/New_York."})]})]}),r.jsxs("div",{className:"canvas-imputer__row",children:[r.jsx("label",{htmlFor:`feature-math-${n.id}-allow-overwrite`,children:"Overwrite behavior"}),r.jsxs("select",{id:`feature-math-${n.id}-allow-overwrite`,value:ne,onChange:ae=>{const pe=ae.target.value;pe==="inherit"?p(n.id,{allowOverwrite:null}):p(n.id,{allowOverwrite:pe==="allow"})},children:[r.jsx("option",{value:"inherit",children:"Inherit node default"}),r.jsx("option",{value:"allow",children:"Always overwrite existing columns"}),r.jsx("option",{value:"prevent",children:"Never overwrite existing columns"})]})]})]})]})},sT=({operations:e,summaries:t,collapsed:n,onToggleCollapsed:a,onAddOperation:i,onDuplicateOperation:l,onRemoveOperation:u,onReorderOperation:d,onOperationChange:m,availableColumns:v,signals:p,previewStatus:_,errorHandlingParameter:y,allowOverwriteParameter:w,defaultTimezoneParameter:x,epsilonParameter:S,renderParameterField:k,canResetNode:M=!1,onResetNode:P})=>{const[T,j]=f.useState("arithmetic"),O=f.useMemo(()=>{const V=new Map;return t.forEach(R=>{V.set(R.id,R)}),V},[t]),A=f.useMemo(()=>p.length?p[p.length-1]:null,[p]),z=(A==null?void 0:A.warnings)??[],$=A&&A.failed_operations>0?"canvas-modal__note canvas-modal__note--warning":"canvas-modal__note canvas-modal__note--info",q=()=>{i(T)};return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Feature math operations"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsx("select",{value:T,onChange:V=>j(V.target.value),children:Oc.map(V=>r.jsx("option",{value:V.value,children:V.label},V.value))}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:q,children:"Add operation"}),M&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:P,disabled:!P,children:"Reset node"})]})]}),r.jsx("p",{className:"canvas-modal__note",children:"Blend columns using arithmetic formulas, ratios, statistics, similarity scores, or datetime extractions. Configure each operation below  they execute in order."}),_==="loading"&&r.jsx("p",{className:"canvas-modal__note",children:"Preview updating"}),A&&r.jsxs("p",{className:$,children:["Preview applied ",A.applied_operations," of ",A.total_operations," operation",A.total_operations===1?"":"s"," (",A.skipped_operations," skipped, ",A.failed_operations," failed)."]}),z.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:z.map((V,R)=>r.jsx("li",{children:V},`feature-math-warning-${R}`))}),e.length===0&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"No feature math steps configured yet. Add an operation to create engineered columns."}),e.map((V,R)=>r.jsx(nT,{index:R,total:e.length,operation:V,summary:O.get(V.id),availableColumns:v,isCollapsed:n.has(V.id),onToggleCollapsed:a,onDuplicate:l,onRemove:u,onReorder:d,onChange:m},V.id)),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[y&&k(y),w&&k(w),x&&k(x),S&&k(S)]})]})},rT={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},aT={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},Q0=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),oT=({sourceId:e,hasReachableSource:t,isFetching:n,error:a,suggestions:i,metadata:l,columnsParameter:u,autoDetectParameter:d,maxUniqueParameter:m,outputSuffixParameter:v,dropOriginalParameter:p,missingStrategyParameter:_,missingCodeParameter:y,selectedColumns:w,renderParameterField:x,onToggleColumn:S,onApplyRecommended:k,formatMissingPercentage:M})=>{const P=f.useMemo(()=>{if(!i.length)return[];const A=new Set;return i.forEach(z=>{z.status==="recommended"&&z.selectable&&A.add(z.column)}),Array.from(A)},[i]),T=f.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface label encoding suggestions.",[t,e]),j=i.length>0,O=!n&&!!a&&!!e&&t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Label encoding suggestions"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>k(P),disabled:!P.length,children:"Add recommended"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Convert short-form categorical text into integer labels. Suggestions come from EDA heuristics and the current pipeline preview."}),T&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:T}),l.generatedAt&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(l.generatedAt).toLocaleString()," on"," ",l.sampleSize===null?"sampled rows":`${l.sampleSize.toLocaleString()} row${l.sampleSize===1?"":"s"}`,"."]}),!l.generatedAt&&l.sampleSize!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",l.sampleSize.toLocaleString()," row",l.sampleSize===1?"":"s"," for categorical trends."]}),l.totalTextColumns>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Found ",l.totalTextColumns," text column",l.totalTextColumns===1?"":"s","; recommendations cover"," ",l.recommendedCount," candidate",l.recommendedCount===1?"":"s","."]}),l.autoDetectDefault&&r.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),l.notes.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:l.notes.map((A,z)=>r.jsx("li",{children:A},`label-encoding-note-${z}`))}),l.highCardinalityColumns.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",l.highCardinalityColumns.length," high-cardinality column",l.highCardinalityColumns.length===1?"":"s",":"," ",l.highCardinalityColumns.slice(0,4).join(", "),l.highCardinalityColumns.length>4?", ":"","."]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading label encoding insights"}),O&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a??""}),!n&&!a&&!j&&e&&t&&r.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!a&&j&&r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Distinct"}),r.jsx("th",{scope:"col",children:"Missing"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Select"})]})}),r.jsx("tbody",{children:i.map(A=>{const z=w.includes(A.column),$=rT[A.status],q=aT[A.status]??"canvas-cast__chip--muted",V=A.sample_values.length?A.sample_values.join(", "):"",R=A.unique_count!==void 0&&A.unique_count!==null?`${Q0(A.unique_count)} (${Q0(A.unique_percentage)}%)`:"",ee=M(A.missing_percentage);return r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:A.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[A.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",A.dtype]}),A.text_category&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:A.text_category})]}),r.jsx("div",{className:"canvas-cast__column-meta",children:r.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",V]})}),r.jsx("p",{className:"canvas-cast__recommendation-note",children:A.reason})]})}),r.jsx("td",{children:R}),r.jsx("td",{children:ee}),r.jsx("td",{children:r.jsx("span",{className:`canvas-cast__chip ${q}`,children:$})}),r.jsx("td",{children:r.jsxs("label",{className:"canvas-modal__checkbox-item",children:[r.jsx("input",{type:"checkbox",checked:z,onChange:()=>S(A.column),disabled:!A.selectable}),r.jsx("span",{className:"canvas-modal__checkbox-label",children:A.selectable?z?"In node":"Add column":"Not eligible"})]})})]},`label-encoding-row-${A.column}`)})})]})}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[d&&x(d),m&&x(m),v&&x(v),p&&x(p),_&&x(_),y&&x(y)]}),u&&r.jsxs("div",{children:[r.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(u)]})]})},iT={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},lT={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},G0=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),cT=({sourceId:e,hasReachableSource:t,isFetching:n,error:a,suggestions:i,metadata:l,columnsParameter:u,targetColumnParameter:d,autoDetectParameter:m,maxCategoriesParameter:v,outputSuffixParameter:p,dropOriginalParameter:_,smoothingParameter:y,encodeMissingParameter:w,handleUnknownParameter:x,selectedColumns:S,renderParameterField:k,onToggleColumn:M,onApplyRecommended:P,formatMissingPercentage:T})=>{const j=f.useMemo(()=>{if(!i.length)return[];const $=new Set;return i.forEach(q=>{q.status==="recommended"&&q.selectable&&$.add(q.column)}),Array.from($)},[i]),O=f.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface target encoding suggestions.",[t,e]),A=i.length>0,z=!n&&!!a&&!!e&&t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Target encoding suggestions"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>P(j),disabled:!j.length,children:"Add recommended"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Encode categorical columns by replacing each category with the smoothed mean of a numeric target column. This is useful for high-cardinality features when a label or ordinal encoding is too coarse."}),O&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:O}),!d&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Add a target column parameter to unlock target encoding. The backend requires a numeric target to compute averages."}),l.autoDetectDefault&&r.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),l.enableGlobalFallbackDefault&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Enable the global mean fallback so unseen categories and nulls do not break downstream transforms."}),l.generatedAt&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(l.generatedAt).toLocaleString()," on"," ",l.sampleSize===null?"sampled rows":`${l.sampleSize.toLocaleString()} row${l.sampleSize===1?"":"s"}`,"."]}),!l.generatedAt&&l.sampleSize!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",l.sampleSize.toLocaleString()," row",l.sampleSize===1?"":"s"," for categorical trends."]}),l.totalTextColumns>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Found ",l.totalTextColumns," text column",l.totalTextColumns===1?"":"s","; recommendations cover"," ",l.recommendedCount," candidate",l.recommendedCount===1?"":"s","."]}),l.notes.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:l.notes.map(($,q)=>r.jsx("li",{children:$},`target-encoding-note-${q}`))}),l.highCardinalityColumns.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",l.highCardinalityColumns.length," high-cardinality column",l.highCardinalityColumns.length===1?"":"s",":"," ",l.highCardinalityColumns.slice(0,4).join(", "),l.highCardinalityColumns.length>4?", ":"","."]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading target encoding insights"}),z&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a??""}),!n&&!a&&!A&&e&&t&&r.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!a&&A&&r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Distinct"}),r.jsx("th",{scope:"col",children:"Missing"}),r.jsx("th",{scope:"col",children:"Fallback"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Select"})]})}),r.jsx("tbody",{children:i.map($=>{const q=S.includes($.column),V=iT[$.status],R=lT[$.status]??"canvas-cast__chip--muted",ee=$.sample_values.length?$.sample_values.join(", "):"",le=$.unique_count!==void 0&&$.unique_count!==null?`${G0($.unique_count)} (${G0($.unique_percentage)}%)`:"",D=T($.missing_percentage),X=$.recommended_use_global_fallback?"Use global mean":"";return r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:$.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[$.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",$.dtype]}),$.text_category&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:$.text_category})]}),r.jsx("div",{className:"canvas-cast__column-meta",children:r.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",ee]})}),r.jsx("p",{className:"canvas-cast__recommendation-note",children:$.reason})]})}),r.jsx("td",{children:le}),r.jsx("td",{children:D}),r.jsx("td",{children:X}),r.jsx("td",{children:r.jsx("span",{className:`canvas-cast__chip ${R}`,children:V})}),r.jsx("td",{children:r.jsxs("label",{className:"canvas-modal__checkbox-item",children:[r.jsx("input",{type:"checkbox",checked:q,onChange:()=>M($.column),disabled:!$.selectable}),r.jsx("span",{className:"canvas-modal__checkbox-label",children:$.selectable?q?"In node":"Add column":"Not eligible"})]})})]},`target-encoding-row-${$.column}`)})})]})}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[d&&k(d),m&&k(m),v&&k(v),p&&k(p),_&&k(_),y&&k(y),w&&k(w),x&&k(x)]}),u&&r.jsxs("div",{children:[r.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),k(u)]})]})},uT={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},dT={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},X0=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),mT=({sourceId:e,hasReachableSource:t,isFetching:n,error:a,suggestions:i,metadata:l,columnsParameter:u,autoDetectParameter:d,maxCategoriesParameter:m,bucketsParameter:v,outputSuffixParameter:p,dropOriginalParameter:_,encodeMissingParameter:y,selectedColumns:w,renderParameterField:x,onToggleColumn:S,onApplyRecommended:k,canResetNode:M=!1,onResetNode:P,formatMissingPercentage:T})=>{const j=f.useMemo(()=>{if(!i.length)return[];const q=new Set;return i.forEach(V=>{V.status==="recommended"&&V.selectable&&q.add(V.column)}),Array.from(q)},[i]),O=f.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface hash encoding suggestions.",[t,e]),A=i.length>0,z=l.suggestedBucketDefault>0?`Default bucket suggestion: ${l.suggestedBucketDefault.toLocaleString()}.`:null,$=!n&&!!a&&!!e&&t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Hash encoding suggestions"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>k(j),disabled:!j.length,children:"Add recommended"}),M&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:P,disabled:!P,children:"Reset node"})]})]}),r.jsx("p",{className:"canvas-modal__note",children:"Hash encoding maps categorical labels into a fixed number of numeric buckets, keeping feature width bounded even when categories grow over time. Collisions are acceptable for tree models and regularised linear models that can tolerate sparse overlaps."}),O&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:O}),l.autoDetectDefault&&r.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so newly ingested categorical columns pick up hashing without manual edits."}),z&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:z}),l.generatedAt&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(l.generatedAt).toLocaleString()," on"," ",l.sampleSize===null?"sampled rows":`${l.sampleSize.toLocaleString()} row${l.sampleSize===1?"":"s"}`,"."]}),!l.generatedAt&&l.sampleSize!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",l.sampleSize.toLocaleString()," row",l.sampleSize===1?"":"s"," for categorical trends."]}),l.totalTextColumns>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Found ",l.totalTextColumns," text column",l.totalTextColumns===1?"":"s","; recommendations cover"," ",l.recommendedCount," candidate",l.recommendedCount===1?"":"s","."]}),l.notes.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:l.notes.map((q,V)=>r.jsx("li",{children:q},`hash-encoding-note-${V}`))}),l.highCardinalityColumns.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["High-cardinality columns highlighted:"," ",l.highCardinalityColumns.slice(0,4).join(", "),l.highCardinalityColumns.length>4?", ":"","."]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading hash encoding insights"}),$&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a??""}),!n&&!a&&!A&&e&&t&&r.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!a&&A&&r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Distinct"}),r.jsx("th",{scope:"col",children:"Missing"}),r.jsx("th",{scope:"col",children:"Suggested buckets"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Select"})]})}),r.jsx("tbody",{children:i.map(q=>{const V=w.includes(q.column),R=uT[q.status],ee=dT[q.status]??"canvas-cast__chip--muted",le=q.sample_values.length?q.sample_values.join(", "):"",D=q.unique_count!==void 0&&q.unique_count!==null?`${X0(q.unique_count)} (${X0(q.unique_percentage)}%)`:"",X=T(q.missing_percentage),Y=q.recommended_bucket_count?q.recommended_bucket_count.toLocaleString():"";return r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:q.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[q.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",q.dtype]}),q.text_category&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:q.text_category})]}),r.jsx("div",{className:"canvas-cast__column-meta",children:r.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",le]})}),r.jsx("p",{className:"canvas-cast__recommendation-note",children:q.reason})]})}),r.jsx("td",{children:D}),r.jsx("td",{children:X}),r.jsx("td",{children:Y}),r.jsx("td",{children:r.jsx("span",{className:`canvas-cast__chip ${ee}`,children:R})}),r.jsx("td",{children:r.jsxs("label",{className:"canvas-modal__checkbox-item",children:[r.jsx("input",{type:"checkbox",checked:V,onChange:()=>S(q.column),disabled:!q.selectable}),r.jsx("span",{className:"canvas-modal__checkbox-label",children:q.selectable?V?"In node":"Add column":"Not eligible"})]})})]},`hash-encoding-row-${q.column}`)})})]})}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[d&&x(d),m&&x(m),v&&x(v),p&&x(p),_&&x(_),y&&x(y)]}),u&&r.jsxs("div",{children:[r.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(u)]})]})},fT=({columnsParameter:e,autoDetectParameter:t,degreeParameter:n,includeBiasParameter:a,interactionOnlyParameter:i,includeInputFeaturesParameter:l,outputPrefixParameter:u,renderParameterField:d,signal:m,canResetNode:v=!1,onResetNode:p})=>{const _=f.useMemo(()=>[e,t,n,a,i,l,u].filter(P=>!!P),[e,t,n,a,i,l,u]),y=(m==null?void 0:m.generated_features)??[],w=(m==null?void 0:m.skipped_columns)??[],x=(m==null?void 0:m.filled_columns)??{},S=(m==null?void 0:m.notes)??[],k=(m==null?void 0:m.feature_count)??0,M=f.useMemo(()=>{const P=Object.entries(x);return P.length?P.map(([T,j])=>`${T} (${j.toLocaleString()} missing)`).join(", "):null},[x]);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Polynomial feature settings"}),v&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:p,disabled:!p,children:"Reset node"})]}),r.jsx("p",{className:"canvas-modal__note",children:"Expand numeric features with polynomial powers and interaction terms to capture non-linear relations. Preview the node to inspect generated columns and adjust degree or interaction options as needed."}),_.length>0&&r.jsx("div",{className:"canvas-modal__parameter-grid",children:_.map(P=>d(P))}),w.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Skipped columns: ",w.join(", "),"."]}),M&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Filled missing values with 0 for ",M," before generating features."]}),k>0?r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Feature column"}),r.jsx("th",{scope:"col",children:"Expression"}),r.jsx("th",{scope:"col",children:"Degree"})]})}),r.jsx("tbody",{children:y.map(P=>r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:P.column}),r.jsx("td",{children:P.expression||(P.terms.length?P.terms.join("  "):"1")}),r.jsx("td",{children:P.degree})]},`poly-feature-${P.column}`))})]})}):r.jsx("p",{className:"canvas-modal__note",children:"No derived features yet. Run a preview to generate polynomial terms for the current configuration."}),S.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:S.map((P,T)=>r.jsx("li",{children:P},`polynomial-note-${T}`))})]})},J0=e=>!!e,Cd=(e,t=4)=>{if(e==null)return"";const n=Number(e);return Number.isFinite(n)?n.toLocaleString(void 0,{maximumFractionDigits:t}):""},hT=e=>{if(e==null)return"";const t=Number(e);return Number.isFinite(t)?t===0?"< 1e-12":t<1e-4?t.toExponential(2):t.toLocaleString(void 0,{maximumFractionDigits:6}):""},Z0=(e,t=8)=>{if(!e.length)return"None";const n=e.slice(0,t),a=e.length-n.length;return a>0?`${n.join(", ")}  (${a} more)`:n.join(", ")},pT=({columnsParameter:e,autoDetectParameter:t,targetColumnParameter:n,methodParameter:a,scoreFuncParameter:i,problemTypeParameter:l,kParameter:u,percentileParameter:d,alphaParameter:m,thresholdParameter:v,modeParameter:p,estimatorParameter:_,stepParameter:y,minFeaturesParameter:w,maxFeaturesParameter:x,dropUnselectedParameter:S,renderParameterField:k,signal:M,canResetNode:P=!1,onResetNode:T})=>{const j=f.useMemo(()=>[e,t,n,a,i,l].filter(J0),[e,t,n,a,i,l]),O=f.useMemo(()=>[u,d,m,v,p,_,y,w,x,S].filter(J0),[u,d,m,v,p,_,y,w,x,S]),A=(M==null?void 0:M.configured_columns)??[],z=(M==null?void 0:M.evaluated_columns)??[],$=(M==null?void 0:M.selected_columns)??[],q=(M==null?void 0:M.dropped_columns)??[],V=(M==null?void 0:M.feature_summaries)??[],R=(M==null?void 0:M.notes)??[],ee=(M==null?void 0:M.drop_unselected)??!1,le=f.useMemo(()=>{if(!z.length&&!A.length)return null;if(z.length===A.length)return`Evaluated ${z.length.toLocaleString()} column(s).`;if(!A.length)return`Evaluated ${z.length.toLocaleString()} column(s) via auto-detect.`;const K=Math.max(z.length-A.length,0);return K>0?`Evaluated ${z.length.toLocaleString()} column(s) (${K.toLocaleString()} auto-detected).`:`Evaluated ${z.length.toLocaleString()} of ${A.length.toLocaleString()} configured column(s).`},[A,z]),D=f.useMemo(()=>{if(!M)return null;const K=[];return M.method&&K.push(`Method: ${M.method}`),M.score_func&&K.push(`Score: ${M.score_func}`),M.estimator&&K.push(`Estimator: ${M.estimator}`),M.problem_type&&M.problem_type!=="auto"&&K.push(`Problem: ${M.problem_type}`),M.target_column&&K.push(`Target: ${M.target_column}`),typeof M.k=="number"&&Number.isFinite(M.k)&&K.push(`k = ${M.k.toLocaleString()}`),typeof M.percentile=="number"&&Number.isFinite(M.percentile)&&K.push(`percentile = ${Cd(M.percentile,2)}`),typeof M.alpha=="number"&&Number.isFinite(M.alpha)&&K.push(`alpha = ${Cd(M.alpha,4)}`),M.threshold!==null&&M.threshold!==void 0&&Number.isFinite(M.threshold)&&K.push(`threshold = ${Cd(M.threshold,4)}`),M.auto_detect&&K.push("Auto-detect enabled"),K.length?K.join("  "):null},[M]),X=f.useMemo(()=>Z0($),[$]),Y=f.useMemo(()=>Z0(q),[q]);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Feature selection settings"}),P&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:T,disabled:!T,children:"Reset node"})]}),r.jsx("p",{className:"canvas-modal__note",children:"Score candidate predictors and retain the most informative columns using statistical tests or model-based selectors. Run a preview after adjusting parameters to refresh rankings."}),D&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:D}),le&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:le}),j.length>0&&r.jsx("div",{className:"canvas-modal__parameter-grid",children:j.map(K=>k(K))}),O.length>0&&r.jsx("div",{className:"canvas-modal__parameter-grid",style:{marginTop:"1rem"},children:O.map(K=>k(K))}),r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:ee?"Unselected columns will be dropped from the dataset when this node runs.":"Unselected columns will remain in the dataset for downstream steps."}),$.length>0?r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Selected ",$.length.toLocaleString()," column(s): ",X]}):r.jsx("p",{className:"canvas-modal__note",children:"No columns selected yet. Run a preview to compute selection scores."}),q.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Dropped ",q.length.toLocaleString()," column(s): ",Y]}),V.length>0?r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Feature column"}),r.jsx("th",{scope:"col",children:"Score"}),r.jsx("th",{scope:"col",children:"p-value"}),r.jsx("th",{scope:"col",children:"Rank"}),r.jsx("th",{scope:"col",children:"Importance"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Note"})]})}),r.jsx("tbody",{children:V.map(K=>{const U=["canvas-cast__row"];return K.selected||U.push("canvas-cast__row--muted"),r.jsxs("tr",{className:U.join(" "),children:[r.jsx("th",{scope:"row",children:K.column}),r.jsx("td",{children:Cd(K.score)}),r.jsx("td",{children:hT(K.p_value)}),r.jsx("td",{children:K.rank??""}),r.jsx("td",{children:Cd(K.importance,4)}),r.jsx("td",{children:K.selected?"Selected":"Dropped"}),r.jsx("td",{children:K.note??""})]},`feature-selection-summary-${K.column}`)})})]})}):r.jsx("p",{className:"canvas-modal__note",children:"Preview results will display per-column scores, ranks, and selection outcomes here."}),R.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:R.map((K,U)=>r.jsx("li",{children:K},`feature-selection-note-${U}`))})]})},gT={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},_T={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},ew=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),vT=({sourceId:e,hasReachableSource:t,isFetching:n,error:a,suggestions:i,metadata:l,columnsParameter:u,autoDetectParameter:d,maxCategoriesParameter:m,outputSuffixParameter:v,dropOriginalParameter:p,encodeMissingParameter:_,handleUnknownParameter:y,unknownValueParameter:w,selectedColumns:x,renderParameterField:S,onToggleColumn:k,onApplyRecommended:M,formatMissingPercentage:P})=>{const T=f.useMemo(()=>{if(!i.length)return[];const z=new Set;return i.forEach($=>{$.status==="recommended"&&$.selectable&&z.add($.column)}),Array.from(z)},[i]),j=f.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface ordinal encoding suggestions.",[t,e]),O=i.length>0,A=!n&&!!a&&!!e&&t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Ordinal encoding suggestions"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>M(T),disabled:!T.length,children:"Add recommended"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Convert categorical columns into ordered integer codes. Use the fallback controls to keep pipelines stable when unexpected categories or missing values appear."}),j&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:j}),l.autoDetectDefault&&r.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),l.enableUnknownDefault&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Enable the fallback code so unseen categories and nulls do not break downstream transforms."}),l.generatedAt&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(l.generatedAt).toLocaleString()," on"," ",l.sampleSize===null?"sampled rows":`${l.sampleSize.toLocaleString()} row${l.sampleSize===1?"":"s"}`,"."]}),!l.generatedAt&&l.sampleSize!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",l.sampleSize.toLocaleString()," row",l.sampleSize===1?"":"s"," for categorical trends."]}),l.totalTextColumns>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Found ",l.totalTextColumns," text column",l.totalTextColumns===1?"":"s","; recommendations cover"," ",l.recommendedCount," candidate",l.recommendedCount===1?"":"s","."]}),l.notes.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:l.notes.map((z,$)=>r.jsx("li",{children:z},`ordinal-encoding-note-${$}`))}),l.highCardinalityColumns.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",l.highCardinalityColumns.length," high-cardinality column",l.highCardinalityColumns.length===1?"":"s",":"," ",l.highCardinalityColumns.slice(0,4).join(", "),l.highCardinalityColumns.length>4?", ":"","."]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading ordinal encoding insights"}),A&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a??""}),!n&&!a&&!O&&e&&t&&r.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!a&&O&&r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Distinct"}),r.jsx("th",{scope:"col",children:"Missing"}),r.jsx("th",{scope:"col",children:"Unknowns"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Select"})]})}),r.jsx("tbody",{children:i.map(z=>{const $=x.includes(z.column),q=gT[z.status],V=_T[z.status]??"canvas-cast__chip--muted",R=z.sample_values.length?z.sample_values.join(", "):"",ee=z.unique_count!==void 0&&z.unique_count!==null?`${ew(z.unique_count)} (${ew(z.unique_percentage)}%)`:"",le=P(z.missing_percentage),D=z.recommended_handle_unknown?"Enable fallback":"";return r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:z.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[z.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",z.dtype]}),z.text_category&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:z.text_category})]}),r.jsx("div",{className:"canvas-cast__column-meta",children:r.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",R]})}),r.jsx("p",{className:"canvas-cast__recommendation-note",children:z.reason})]})}),r.jsx("td",{children:ee}),r.jsx("td",{children:le}),r.jsx("td",{children:D}),r.jsx("td",{children:r.jsx("span",{className:`canvas-cast__chip ${V}`,children:q})}),r.jsx("td",{children:r.jsxs("label",{className:"canvas-modal__checkbox-item",children:[r.jsx("input",{type:"checkbox",checked:$,onChange:()=>k(z.column),disabled:!z.selectable}),r.jsx("span",{className:"canvas-modal__checkbox-label",children:z.selectable?$?"In node":"Add column":"Not eligible"})]})})]},`ordinal-encoding-row-${z.column}`)})})]})}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[d&&S(d),m&&S(m),v&&S(v),p&&S(p),_&&S(_),y&&S(y),w&&S(w)]}),u&&r.jsxs("div",{children:[r.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),S(u)]})]})},yT={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},bT={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},tw=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),xT=({sourceId:e,hasReachableSource:t,isFetching:n,error:a,suggestions:i,metadata:l,columnsParameter:u,autoDetectParameter:d,maxCategoriesParameter:m,dropFirstParameter:v,includeMissingParameter:p,dropOriginalParameter:_,prefixSeparatorParameter:y,selectedColumns:w,renderParameterField:x,onToggleColumn:S,onApplyRecommended:k,formatMissingPercentage:M})=>{const P=f.useMemo(()=>{if(!i.length)return[];const A=new Set;return i.forEach(z=>{z.status==="recommended"&&z.selectable&&A.add(z.column)}),Array.from(A)},[i]),T=f.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface dummy encoding suggestions.",[t,e]),j=i.length>0,O=!n&&!!a&&!!e&&t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Dummy encoding suggestions"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>k(P),disabled:!P.length,children:"Add recommended"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Create dummy variables while automatically dropping a reference category. This mirrors one-hot encoding but keeps feature matrices full rank."}),T&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:T}),l.autoDetectDefault&&d&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Auto-detection is recommended here so new categorical columns are captured by default."}),l.generatedAt&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(l.generatedAt).toLocaleString()," on"," ",l.sampleSize===null?"sampled rows":`${l.sampleSize.toLocaleString()} row${l.sampleSize===1?"":"s"}`,"."]}),!l.generatedAt&&l.sampleSize!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",l.sampleSize.toLocaleString()," row",l.sampleSize===1?"":"s"," for categorical trends."]}),l.totalTextColumns>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Found ",l.totalTextColumns," text column",l.totalTextColumns===1?"":"s","; recommendations cover"," ",l.recommendedCount," candidate",l.recommendedCount===1?"":"s","."]}),l.cautionedCount>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[l.cautionedCount," column",l.cautionedCount===1?"":"s"," could expand heavily  consider alternate encodings."]}),l.notes.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:l.notes.map((A,z)=>r.jsx("li",{children:A},`dummy-note-${z}`))}),l.highCardinalityColumns.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",l.highCardinalityColumns.length," high-cardinality column",l.highCardinalityColumns.length===1?"":"s",":"," ",l.highCardinalityColumns.slice(0,4).join(", "),l.highCardinalityColumns.length>4?", ":"","."]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading dummy encoding insights"}),O&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a??""}),!n&&!a&&!j&&e&&t&&r.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!a&&j&&r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Distinct"}),r.jsx("th",{scope:"col",children:"Missing"}),r.jsx("th",{scope:"col",children:"Dummy cols"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Select"})]})}),r.jsx("tbody",{children:i.map(A=>{const z=w.includes(A.column),$=yT[A.status],q=bT[A.status]??"canvas-cast__chip--muted",V=A.sample_values.length?A.sample_values.join(", "):"",R=A.unique_count!==void 0&&A.unique_count!==null?`${tw(A.unique_count)} (${tw(A.unique_percentage)}%)`:"",ee=M(A.missing_percentage),le=A.estimated_dummy_columns?A.estimated_dummy_columns.toLocaleString():"";return r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:A.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[A.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",A.dtype]}),A.text_category&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:A.text_category}),A.recommended_drop_first&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--info",children:"Drop first suggested"})]}),r.jsx("div",{className:"canvas-cast__column-meta",children:r.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",V]})}),r.jsx("p",{className:"canvas-cast__recommendation-note",children:A.reason})]})}),r.jsx("td",{children:R}),r.jsx("td",{children:ee}),r.jsx("td",{children:le}),r.jsx("td",{children:r.jsx("span",{className:`canvas-cast__chip ${q}`,children:$})}),r.jsx("td",{children:r.jsxs("label",{className:"canvas-modal__checkbox-item",children:[r.jsx("input",{type:"checkbox",checked:z,onChange:()=>S(A.column),disabled:!A.selectable}),r.jsx("span",{className:"canvas-modal__checkbox-label",children:A.selectable?z?"In node":"Add column":"Not eligible"})]})})]},`dummy-encoding-row-${A.column}`)})})]})}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[d&&x(d),m&&x(m),v&&x(v),p&&x(p),_&&x(_),y&&x(y)]}),u&&r.jsxs("div",{children:[r.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(u)]})]})},wT={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},jT={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},nw=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),NT=({sourceId:e,hasReachableSource:t,isFetching:n,error:a,suggestions:i,metadata:l,columnsParameter:u,autoDetectParameter:d,maxCategoriesParameter:m,dropFirstParameter:v,includeMissingParameter:p,dropOriginalParameter:_,prefixSeparatorParameter:y,selectedColumns:w,renderParameterField:x,onToggleColumn:S,onApplyRecommended:k,formatMissingPercentage:M})=>{const P=f.useMemo(()=>{if(!i.length)return[];const A=new Set;return i.forEach(z=>{z.status==="recommended"&&z.selectable&&A.add(z.column)}),Array.from(A)},[i]),T=f.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface one-hot encoding suggestions.",[t,e]),j=i.length>0,O=!n&&!!a&&!!e&&t;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"One-hot encoding suggestions"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>k(P),disabled:!P.length,children:"Add recommended"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Expand categorical text into binary indicator columns. Suggestions factor in estimated dummy counts so encodings stay tractable."}),T&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:T}),l.generatedAt&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(l.generatedAt).toLocaleString()," on"," ",l.sampleSize===null?"sampled rows":`${l.sampleSize.toLocaleString()} row${l.sampleSize===1?"":"s"}`,"."]}),!l.generatedAt&&l.sampleSize!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",l.sampleSize.toLocaleString()," row",l.sampleSize===1?"":"s"," for categorical trends."]}),l.totalTextColumns>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Found ",l.totalTextColumns," text column",l.totalTextColumns===1?"":"s","; recommendations cover"," ",l.recommendedCount," candidate",l.recommendedCount===1?"":"s","."]}),l.cautionedCount>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[l.cautionedCount," column",l.cautionedCount===1?"":"s"," could explode in width  consider alternate encodings."]}),l.notes.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:l.notes.map((A,z)=>r.jsx("li",{children:A},`one-hot-note-${z}`))}),l.highCardinalityColumns.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",l.highCardinalityColumns.length," high-cardinality column",l.highCardinalityColumns.length===1?"":"s",":"," ",l.highCardinalityColumns.slice(0,4).join(", "),l.highCardinalityColumns.length>4?", ":"","."]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading one-hot encoding insights"}),O&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a??""}),!n&&!a&&!j&&e&&t&&r.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!a&&j&&r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Distinct"}),r.jsx("th",{scope:"col",children:"Missing"}),r.jsx("th",{scope:"col",children:"Dummy cols"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Select"})]})}),r.jsx("tbody",{children:i.map(A=>{const z=w.includes(A.column),$=wT[A.status],q=jT[A.status]??"canvas-cast__chip--muted",V=A.sample_values.length?A.sample_values.join(", "):"",R=A.unique_count!==void 0&&A.unique_count!==null?`${nw(A.unique_count)} (${nw(A.unique_percentage)}%)`:"",ee=M(A.missing_percentage),le=A.estimated_dummy_columns?A.estimated_dummy_columns.toLocaleString():"";return r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:A.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[A.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",A.dtype]}),A.text_category&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:A.text_category}),A.recommended_drop_first&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--info",children:"Drop first suggested"})]}),r.jsx("div",{className:"canvas-cast__column-meta",children:r.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",V]})}),r.jsx("p",{className:"canvas-cast__recommendation-note",children:A.reason})]})}),r.jsx("td",{children:R}),r.jsx("td",{children:ee}),r.jsx("td",{children:le}),r.jsx("td",{children:r.jsx("span",{className:`canvas-cast__chip ${q}`,children:$})}),r.jsx("td",{children:r.jsxs("label",{className:"canvas-modal__checkbox-item",children:[r.jsx("input",{type:"checkbox",checked:z,onChange:()=>S(A.column),disabled:!A.selectable}),r.jsx("span",{className:"canvas-modal__checkbox-label",children:A.selectable?z?"In node":"Add column":"Not eligible"})]})})]},`one-hot-row-${A.column}`)})})]})}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[d&&x(d),m&&x(m),v&&x(v),p&&x(p),_&&x(_),y&&x(y)]}),u&&r.jsxs("div",{children:[r.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(u)]})]})},sw={fit_transform:"Fit + transform",transform:"Transform",not_applied:"Not applied",not_available:""},ST=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()},rw=e=>{if(e==null||Number.isNaN(e)||e<=0)return null;const t=Math.round(e);return`${t.toLocaleString()} row${t===1?"":"s"}`},CT=(e,t)=>Array.isArray(e.split_activity)?e.split_activity.find(a=>a&&a.split===t)??null:null,qg=(e,t)=>{const n=CT(e,t);if(!n||n.action==="not_available")return r.jsx("span",{children:""});const a=sw[n.action]??n.action,i=rw(n.rows??null);return r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{children:a}),i&&r.jsx("span",{className:"canvas-cast__muted",children:i})]})},ET=e=>{if(!Array.isArray(e.split_activity))return null;const t=e.split_activity.filter(a=>a&&!["train","test","validation"].includes(a.split));return t.length&&t.map(a=>{const i=a.label||a.split,l=sw[a.action]??a.action,u=rw(a.rows??null);return u?`${i}: ${l} (${u})`:`${i}: ${l}`}).join("; ")||null},kT=e=>!e.metadata||typeof e.metadata!="object"?null:e.metadata.method_label?String(e.metadata.method_label):e.metadata.method?String(e.metadata.method):null,MT=({signal:e,previewStatus:t,hasSource:n,hasReachableSource:a,onRefreshPreview:i})=>{const l=f.useMemo(()=>(e==null?void 0:e.transformers)??[],[e==null?void 0:e.transformers]),u=(e==null?void 0:e.total_transformers)??l.length,d=Array.isArray(e==null?void 0:e.notes)?e==null?void 0:e.notes:[],m=t==="loading",v=u?`Tracking ${u.toLocaleString()} transformer${u===1?"":"s"}.`:null,p=m||!n||!a;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Transformer activity"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:i,disabled:p,children:m?"Refreshing":"Refresh preview"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Review whether split-aware transformers (e.g. one-hot encoders) fit on training data and propagated to test/validation splits."}),v&&r.jsx("p",{className:"canvas-modal__note",children:v}),!n&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface transformer activity."}),n&&!a&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream branch to inspect transformer history."}),d.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:d.map((_,y)=>r.jsx("li",{children:_},`transformer-audit-note-${y}`))}),m&&r.jsx("p",{className:"canvas-modal__note",children:"Loading transformer activity"}),!m&&t==="error"&&n&&a&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:"Unable to load transformer activity. Try refreshing the preview."}),!m&&n&&a&&!l.length&&r.jsx("p",{className:"canvas-modal__note",children:"No transformer activity recorded yet. Run a preview after executing split-aware transformation nodes."}),!m&&l.length>0&&r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Node"}),r.jsx("th",{scope:"col",children:"Transformer"}),r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Method"}),r.jsx("th",{scope:"col",children:"Train"}),r.jsx("th",{scope:"col",children:"Test"}),r.jsx("th",{scope:"col",children:"Validation"}),r.jsx("th",{scope:"col",children:"Updated"})]})}),r.jsx("tbody",{children:l.map((_,y)=>{const w=_.storage_key??`${_.transformer_name}-${_.column_name??"all"}-${y}`,x=ET(_),S=_.source_node_label||_.source_node_id||"",k=ST(_.updated_at??_.created_at??null),M=_.column_name??"",P=kT(_);return r.jsxs(Oe.Fragment,{children:[r.jsxs("tr",{className:"canvas-cast__row",children:[r.jsx("th",{scope:"row",children:r.jsx("div",{className:"canvas-cast__column-cell",children:r.jsx("span",{className:"canvas-cast__column-name",children:S})})}),r.jsx("td",{children:_.transformer_name}),r.jsx("td",{children:M}),r.jsx("td",{children:P||""}),r.jsx("td",{children:qg(_,"train")}),r.jsx("td",{children:qg(_,"test")}),r.jsx("td",{children:qg(_,"validation")}),r.jsx("td",{children:k})]}),x&&r.jsx("tr",{className:"canvas-cast__row canvas-cast__row--subtle",children:r.jsx("td",{colSpan:8,children:r.jsxs("span",{className:"canvas-cast__muted",children:["Additional splits: ",x]})})})]},w)})})]})})]})},Hg=(e,t=5)=>e.length?e.length<=t?e.join(", "):`${e.slice(0,t).join(", ")}, ...`:"",AT=e=>{for(let t=e.length-1;t>=0;t-=1){const n=e[t];if(typeof n!="string")continue;if(n.toLowerCase().includes("feature/target split"))return n}return null},OT=(e,t)=>{if(!e.length)return null;const n=e.filter(a=>!(a!=null&&a.node_id)||a.node_id===t);return n.length?n[n.length-1]:e[e.length-1]},PT=({nodeId:e,sourceId:t,hasReachableSource:n,previewState:a,onRefreshPreview:i,config:l,targetColumnParameter:u,renderParameterField:d,formatMetricValue:m,formatMissingPercentage:v,canResetNode:p,onResetNode:_})=>{var H,Z,ne,fe;const y=a.data,w=a.status,x=Array.isArray(y==null?void 0:y.applied_steps)?y.applied_steps:[],S=Array.isArray(y==null?void 0:y.columns)?y==null?void 0:y.columns:[],k=Array.isArray((H=y==null?void 0:y.signals)==null?void 0:H.feature_target_split)?(Z=y==null?void 0:y.signals)==null?void 0:Z.feature_target_split:[],M=OT(k,e),P=(l==null?void 0:l.targetColumn)??"",T=(M==null?void 0:M.target_column)??P,j=(l==null?void 0:l.featureColumns)??[],O=f.useMemo(()=>Array.isArray(y==null?void 0:y.column_stats)?y==null?void 0:y.column_stats:[],[y==null?void 0:y.column_stats]),A=f.useMemo(()=>{const ae=new Map;return O.forEach(pe=>{pe!=null&&pe.name&&ae.set(pe.name,pe)}),ae},[O]),z=f.useMemo(()=>{var ae;return(ae=M==null?void 0:M.feature_columns)!=null&&ae.length?M.feature_columns:j.length?j:T?S.filter(pe=>pe!==T):S.slice()},[M==null?void 0:M.feature_columns,j,S,T]),$=(M==null?void 0:M.auto_included_columns)??[],q=(M==null?void 0:M.missing_feature_columns)??[],V=(M==null?void 0:M.excluded_columns)??[],R=(M==null?void 0:M.target_missing_count)??0,ee=typeof(M==null?void 0:M.target_missing_percentage)=="number"?M.target_missing_percentage:null,le=(M==null?void 0:M.target_dtype)??(T?((ne=A.get(T))==null?void 0:ne.dtype)??null:null),D=typeof((fe=y==null?void 0:y.metrics)==null?void 0:fe.row_count)=="number"?y.metrics.row_count:null,X=z.length,Y=$.length,K=V.length,U=q.length,te=f.useMemo(()=>AT(x),[x]),W=f.useMemo(()=>{const ae=[];if(ae.push({label:"Target column",value:T||"Not set"}),ae.push({label:"Feature columns",value:m(X)}),D!==null&&ae.push({label:"Preview rows",value:m(D)}),Y&&ae.push({label:"Auto-selected features",value:m(Y)}),U&&ae.push({label:"Configured features missing",value:m(U)}),K&&ae.push({label:"Excluded columns",value:m(K)}),R){const pe=m(R),Ve=ee!==null?v(ee):null;ae.push({label:"Target missing values",value:Ve?`${pe} (${Ve})`:pe})}return ae},[Y,K,X,m,v,U,D,T,R,ee]),I=f.useMemo(()=>t?n?null:"Link this node to the upstream dataset to resolve feature columns.":"Connect this node to a dataset to confirm feature and target mappings.",[n,t]),Q=f.useMemo(()=>!t||!n?null:w==="idle"?"Refresh the preview to surface feature/target diagnostics.":null,[n,w,t]),me=f.useMemo(()=>T?w==="success"&&T&&!S.includes(T)?`Target column "${T}" is not present in the current preview output.`:null:"Set a target column so downstream nodes understand the supervised objective.",[S,w,T]),J=!!t&&n&&w!=="loading";return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Feature/target separation"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[p&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:_,disabled:!_,children:"Reset node"}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:i,disabled:!J,children:w==="loading"?"Refreshing...":"Refresh preview"})]})]}),r.jsx("p",{className:"canvas-modal__note",children:"Confirm which columns feed the feature matrix (X) and which column serves as the supervised target (y). This metadata helps downstream modeling nodes stay aligned with the configured training objective."}),I&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:I}),a.error&&w==="error"&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a.error}),Q&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:Q}),me&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:me}),U>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Missing configured feature columns: ",Hg(q),"."]}),K>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Columns excluded from the feature matrix: ",Hg(V),"."]}),Y>0&&j.length===0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Auto-selected feature columns: ",Hg($),"."]}),te&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:te}),W.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:W.map(ae=>r.jsxs("li",{children:[ae.label,": ",r.jsx("strong",{children:ae.value})]},`feature-target-summary-${ae.label}`))}),r.jsx("div",{className:"canvas-modal__parameter-grid",children:u&&d(u)}),w==="success"&&X===0&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"No feature columns detected. Confirm that the dataset includes columns other than the target."}),T&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Target dtype: ",le?r.jsx("strong",{children:le}):r.jsx("span",{children:"Unknown"}),R?` - Missing rows flagged for review: ${m(R)}.`:""]})]})},TT=(e,t)=>{if(!e.length)return null;const n=e.filter(a=>!(a!=null&&a.node_id)||a.node_id===t);return n.length?n[n.length-1]:e[e.length-1]},mo=e=>`${(e*100).toFixed(1)}%`,$T=({nodeId:e,sourceId:t,hasReachableSource:n,previewState:a,onRefreshPreview:i,config:l,parameters:u,renderParameterField:d,formatMetricValue:m,canResetNode:v,onResetNode:p})=>{var ee,le;const _=a.data,y=a.status,w=Array.isArray((ee=_==null?void 0:_.signals)==null?void 0:ee.train_test_split)?(le=_==null?void 0:_.signals)==null?void 0:le.train_test_split:[],x=TT(w,e),S=(l==null?void 0:l.test_size)??.2,k=(l==null?void 0:l.validation_size)??0,M=l==null?void 0:l.random_state;l==null||l.shuffle;const P=(l==null?void 0:l.stratify)??!1,T=(l==null?void 0:l.target_column)??"",j=k>0,O=f.useMemo(()=>x?{trainSize:x.train_size??0,validationSize:x.validation_size??0,testSize:x.test_size??0,totalSize:x.total_size??0,trainRatio:x.train_size&&x.total_size?x.train_size/x.total_size:0,validationRatio:x.validation_ratio??0,testRatio:x.test_ratio??0}:{trainSize:0,validationSize:0,testSize:0,totalSize:0,trainRatio:1-S-k,validationRatio:k,testRatio:S},[x,S,k]),A=u.find(D=>D.name==="test_size"),z=u.find(D=>D.name==="validation_size"),$=u.find(D=>D.name==="random_state"),q=u.find(D=>D.name==="shuffle"),V=u.find(D=>D.name==="stratify"),R=u.find(D=>D.name==="target_column");return r.jsxs("div",{className:"node-settings__section",children:[r.jsxs("div",{className:"node-settings__section-header",children:[r.jsx("h3",{children:"Train/Test Split Configuration"}),v&&p&&r.jsx("button",{type:"button",onClick:p,className:"node-settings__reset-button",title:"Reset node configuration",children:"Reset"})]}),r.jsxs("div",{className:"node-settings__field-group",children:[A&&d(A),z&&d(z),$&&d($),q&&d(q),V&&d(V),P&&R&&d(R)]}),y==="success"&&x&&r.jsxs("div",{className:"node-settings__info-panel",children:[r.jsx("h4",{className:"node-settings__info-title",children:"Split Summary"}),r.jsx("div",{className:"node-settings__split-visualization",children:r.jsxs("div",{className:"split-bar",children:[r.jsx("div",{className:"split-bar__segment split-bar__segment--train",style:{width:mo(O.trainRatio)},title:`Training: ${O.trainSize} rows (${mo(O.trainRatio)})`,children:r.jsx("span",{className:"split-bar__label",children:"Train"})}),j&&r.jsx("div",{className:"split-bar__segment split-bar__segment--validation",style:{width:mo(O.validationRatio)},title:`Validation: ${O.validationSize} rows (${mo(O.validationRatio)})`,children:r.jsx("span",{className:"split-bar__label",children:"Val"})}),r.jsx("div",{className:"split-bar__segment split-bar__segment--test",style:{width:mo(O.testRatio)},title:`Test: ${O.testSize} rows (${mo(O.testRatio)})`,children:r.jsx("span",{className:"split-bar__label",children:"Test"})})]})}),r.jsxs("div",{className:"node-settings__stats-grid",children:[r.jsxs("div",{className:"node-settings__stat-item",children:[r.jsx("span",{className:"node-settings__stat-label",children:"Total rows:"}),r.jsx("span",{className:"node-settings__stat-value",children:m(O.totalSize,0)})]}),r.jsxs("div",{className:"node-settings__stat-item",children:[r.jsx("span",{className:"node-settings__stat-label",children:"Training:"}),r.jsxs("span",{className:"node-settings__stat-value",children:[m(O.trainSize,0)," (",mo(O.trainRatio),")"]})]}),j&&r.jsxs("div",{className:"node-settings__stat-item",children:[r.jsx("span",{className:"node-settings__stat-label",children:"Validation:"}),r.jsxs("span",{className:"node-settings__stat-value",children:[m(O.validationSize,0)," (",mo(O.validationRatio),")"]})]}),r.jsxs("div",{className:"node-settings__stat-item",children:[r.jsx("span",{className:"node-settings__stat-label",children:"Test:"}),r.jsxs("span",{className:"node-settings__stat-value",children:[m(O.testSize,0)," (",mo(O.testRatio),")"]})]}),P&&T&&r.jsxs("div",{className:"node-settings__stat-item",children:[r.jsx("span",{className:"node-settings__stat-label",children:"Stratified by:"}),r.jsx("span",{className:"node-settings__stat-value",children:T})]}),M!==void 0&&r.jsxs("div",{className:"node-settings__stat-item",children:[r.jsx("span",{className:"node-settings__stat-label",children:"Random state:"}),r.jsx("span",{className:"node-settings__stat-value",children:M})]})]})]}),!n&&r.jsxs("div",{className:"node-settings__warning",children:[r.jsx("span",{className:"node-settings__warning-icon",children:""}),"Connect this node to a data source to configure the split."]}),y==="loading"&&r.jsx("div",{className:"node-settings__loading",children:"Loading preview..."}),y==="error"&&r.jsxs("div",{className:"node-settings__error",children:[r.jsx("span",{className:"node-settings__error-icon",children:""}),"Failed to load preview. Try refreshing."]})]})},LT={classification:"Classification",regression:"Regression"},DT=e=>e==="numeric"||e==="integer",zT=e=>{if(!e)return!1;const t=e.toLowerCase();return t.includes("int")||t.includes("float")||t.includes("double")||t.includes("decimal")||t.includes("number")},Vg=(e,t=3)=>e.length===0?"":e.length<=t?e.join(", "):`${e.slice(0,t).join(", ")}, ...`,RT=e=>{for(let t=e.length-1;t>=0;t-=1){const n=e[t];if(typeof n=="string"&&n.toLowerCase().startsWith("train model draft"))return n}return null},FT=({sourceId:e,hasReachableSource:t,previewState:n,onRefreshPreview:a,config:i,targetColumnParameter:l,problemTypeParameter:u,renderParameterField:d,formatMetricValue:m,formatMissingPercentage:v,schemaColumns:p})=>{var H;const _=n.data,y=n.status,w=Array.isArray(_==null?void 0:_.applied_steps)?_.applied_steps:[],x=Array.isArray(_==null?void 0:_.column_stats)?_.column_stats:[],S=(_==null?void 0:_.metrics)??null,k=f.useMemo(()=>Array.isArray(_==null?void 0:_.columns)?_.columns.filter(Z=>typeof Z=="string"&&Z.trim().length>0):[],[_==null?void 0:_.columns]),M=f.useMemo(()=>{var Z;return p.length?p:Array.isArray((Z=_==null?void 0:_.schema)==null?void 0:Z.columns)?_.schema.columns:k.length>0?k.map(ne=>({name:ne,pandas_dtype:null,logical_family:"unknown",nullable:!0})):[]},[(H=_==null?void 0:_.schema)==null?void 0:H.columns,k,p]),P=f.useMemo(()=>{const Z=new Map;return M.forEach(ne=>{ne!=null&&ne.name&&Z.set(ne.name,ne)}),Z},[M]),T=(i==null?void 0:i.targetColumn)??"",j=(i==null?void 0:i.problemType)??"classification",O=T?x.find(Z=>(Z==null?void 0:Z.name)===T)??null:null,z=!!(T?P.get(T)??null:null),$=f.useMemo(()=>{const Z=new Set;return x.forEach(ne=>{ne!=null&&ne.name&&ne.name!==T&&Z.add(ne.name)}),M.forEach(ne=>{ne!=null&&ne.name&&ne.name!==T&&Z.add(ne.name)}),Array.from(Z).sort()},[x,M,T]),q=f.useMemo(()=>$.filter(Z=>{const ne=P.get(Z);if(ne&&DT(ne.logical_family))return!0;const fe=x.find(ae=>ae.name===Z);return zT((fe==null?void 0:fe.dtype)??null)}),[x,$,P]),V=f.useMemo(()=>new Set(q),[q]),R=f.useMemo(()=>$.filter(Z=>!V.has(Z)),[$,V]),ee=f.useMemo(()=>x.filter(Z=>(Z==null?void 0:Z.name)&&Z.name!==T&&(Z.missing_count??0)>0).map(Z=>Z.name),[x,T]),le=typeof(S==null?void 0:S.row_count)=="number"?S.row_count:null,D=typeof(O==null?void 0:O.distinct_count)=="number"&&Number.isFinite(O.distinct_count)?O.distinct_count:null,X=typeof(O==null?void 0:O.missing_count)=="number"?O.missing_count:0,Y=typeof(O==null?void 0:O.missing_percentage)=="number"?O.missing_percentage:null,K=f.useMemo(()=>{const Z=[];return T?y!=="success"?Z:!O&&!z&&!$.length?(Z.push(`Target column "${T}" is not present in the preview output, and no feature columns were found.`),Z):($.length||Z.push("Add at least one feature column in addition to the target before training."),O&&X>0&&Z.push(`Target column includes ${X} missing value${X===1?"":"s"}.`),j==="classification"&&O&&(D??0)<2&&Z.push("Classification tasks require at least two distinct target classes."),j==="regression"&&q.length===0&&Z.push("Regression tasks need at least one numeric feature column."),ee.length>0&&Z.push(`Feature columns with missing values: ${Vg(ee)}.`),le!==null&&le===0&&Z.push("Preview returned zero rows after upstream transformations."),Z):(Z.push("Set a target column to evaluate downstream modeling constraints."),Z)},[ee,$.length,X,q.length,le,y,j,T,D,O,z]),U=f.useMemo(()=>LT[j],[j]),te=f.useMemo(()=>{const Z=[{label:"Problem type",value:U},{label:"Target column",value:T||"Not set"}];if(y==="success"){if(D!==null&&Z.push({label:"Target distinct values",value:m(D)}),O){const ne=m(X),fe=Y!==null?v(Y):null;Z.push({label:"Target missing values",value:fe?`${ne} (${fe})`:ne})}ee.length>0&&Z.push({label:"Features with missing values",value:m(ee.length)})}return Z},[U,ee.length,m,v,X,y,T,D,Y,O]),W=f.useMemo(()=>e?t?null:"Link this node to upstream transforms to analyse the feature set that reaches it.":"Connect this node to a dataset to validate training readiness.",[t,e]),I=f.useMemo(()=>!e||!t?null:y==="idle"?"Refresh the preview to surface downstream modeling checks.":null,[t,y,e]),Q=f.useMemo(()=>RT(w),[w]),me=!!e&&t&&y!=="loading",J=f.useMemo(()=>!T||y!=="success"||K.length>0?null:"No critical blockers detected in the preview. Proceed with downstream training when ready.",[y,K.length,T]);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Train model readiness"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:a,disabled:!me,children:y==="loading"?"Refreshing":"Refresh preview"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Validate that the pipeline output is ready for lightweight training by checking the target column, feature balance, and missing values against the cached preview."}),W&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:W}),n.error&&y==="error"&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:n.error}),I&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:I}),K.map((Z,ne)=>r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:Z},`train-model-issue-${ne}`)),J&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:J}),Q&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:Q}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[l&&d(l),u&&d(u)]}),te.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:te.map(Z=>r.jsxs("li",{children:[Z.label,": ",r.jsx("strong",{children:Z.value})]},`train-model-summary-${Z.label}`))}),y==="success"&&ee.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Features with missing values: ",Vg(ee),"."]}),y==="success"&&j==="regression"&&R.length>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Non-numeric features detected: ",Vg(R),". Consider encoding or casting them before training regression models."]})]})},aw=e=>{if(e==null)return"";if(typeof e=="number")return Number.isFinite(e)?$r(e,Math.abs(e)>=1?2:4):String(e);if(typeof e=="string")return e;if(typeof e=="boolean")return e?"True":"False";if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.length?JSON.stringify(e):"[]";if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},IT=e=>e||"Unknown",BT=e=>{if(!e)return null;let t=e.trim();if(!t)return null;/^\d{4}-\d{2}-\d{2}\s+\d/.test(t)&&(t=t.replace(" ","T")),/(Z|z|[+-]\d{2}:?\d{2})$/.test(t)||(t=`${t}Z`);const n=new Date(t);return Number.isNaN(n.getTime())?null:n},Cs=e=>{const t=BT(e);if(!t)return null;const n=Math.round((Date.now()-t.getTime())/6e4);if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;const a=Math.round(n/60);if(a===1)return"1 hour ago";if(a<24)return`${a} hours ago`;const i=Math.round(a/24);return i===1?"1 day ago":`${i} days ago`},ow=e=>typeof e!="number"||!Number.isFinite(e)?"":Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3),UT=({presets:e,isOpen:t,onClose:n,onApply:a,activePresetId:i,fieldMetadata:l})=>{const[u,d]=f.useState(null);f.useEffect(()=>{var _;if(!t){d(null);return}u&&e.some(y=>y.id===u)||d(((_=e[0])==null?void 0:_.id)??null)},[t,e,u]),f.useEffect(()=>{if(!t)return;const _=y=>{y.key==="Escape"&&n()};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[t,n]);const m=f.useMemo(()=>u?e.find(_=>_.id===u)??e[0]??null:e[0]??null,[e,u]),v=f.useMemo(()=>!i||!m?!1:i===m.id,[i,m]),p=f.useMemo(()=>{var k,M;if(!t||!e.length)return null;const _=((k=m==null?void 0:m.modelType)==null?void 0:k.toLowerCase())==="logistic_regression"?(M=m==null?void 0:m.params)==null?void 0:M.solver:null,y=typeof _=="string"?_.trim().toLowerCase():null,w=y&&(y==="sag"||y==="saga")?"SAG and SAGA solvers expect standardized features. Scale inputs before training to improve convergence and avoid repeated warnings.":null,x=m?Object.entries(m.params??{}).sort(([P],[T])=>P.localeCompare(T)).map(([P,T])=>{const j=l==null?void 0:l[P],O=R=>{var ee;return(ee=j==null?void 0:j.options)!=null&&ee.length?j.options.find(le=>{const D=le.value;return R==null?D===null||typeof D=="string"&&D.trim().toLowerCase()==="none":typeof R=="string"&&typeof D=="string"?D===R?!0:D.trim().toLowerCase()===R.trim().toLowerCase():String(D)===String(R)})??null:null},A=R=>{if(R===null)return j!=null&&j.nullable?"None":"";if(R===void 0)return"";if(typeof R=="boolean")return R?"true":"false";if(typeof R=="number")return Number.isFinite(R)?R.toString():String(R);if(R&&typeof R=="object")try{return JSON.stringify(R)}catch{return"[object]"}return String(R??"")},z=R=>{var X;if(!R)return null;const ee=R.value,le=(X=R.label)==null?void 0:X.trim(),D=A(ee);return le&&D&&le!==D?`${le} (${D})`:le||D},$=()=>{if(j&&j.default!==void 0){const R=q(j.default,!1);if(R.text)return{text:R.text,note:"Using estimator default"}}return{text:"",note:"Using estimator default"}},q=(R,ee=!0)=>{const le=O(R);return le?{text:z(le)??"",note:null}:Array.isArray(R)?R.length===0?ee?$():{text:"",note:null}:{text:R.map(X=>q(X,!1)).map(X=>X.text).filter(Boolean).join(", "),note:null}:R===void 0||typeof R=="string"&&R.trim()===""?ee?$():{text:"",note:null}:R===null?j!=null&&j.nullable?{text:"None",note:null}:ee?$():{text:"",note:null}:{text:A(R),note:null}},V=q(T);return{key:P,label:(j==null?void 0:j.label)??P,description:(j==null?void 0:j.description)??null,value:V.text,note:V.note}}):[],S=m!=null&&m.finishedAt?Cs(m.finishedAt):null;return r.jsxs("div",{className:"canvas-modal best-param-modal",role:"dialog","aria-modal":"true",children:[r.jsx("div",{className:"canvas-modal__backdrop",onClick:n}),r.jsxs("div",{className:"canvas-modal__panel best-param-modal__panel",role:"document",children:[r.jsxs("header",{className:"best-param-modal__header",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"best-param-modal__title",children:"Tuned Hyperparameter Presets"}),r.jsx("p",{className:"best-param-modal__subtitle",children:"Review hyperparameter sets discovered by recent tuning runs and apply them to the current model."})]}),r.jsx("button",{type:"button",className:"best-param-modal__close",onClick:n,children:"Close"})]}),r.jsxs("div",{className:"best-param-modal__layout",children:[r.jsx("aside",{className:"best-param-modal__list","aria-label":"Tuned presets",children:e.map(P=>{const T=P.id===(m==null?void 0:m.id),j=P.finishedAt?Cs(P.finishedAt):null;return r.jsxs("button",{type:"button",className:`best-param-modal__list-button${T?" best-param-modal__list-button--active":""}`,onClick:()=>d(P.id),children:[r.jsx("span",{className:"best-param-modal__list-title",children:P.label}),r.jsxs("span",{className:"best-param-modal__list-meta",children:[P.runNumber?`Run ${P.runNumber}`:"Tuning run",j?`  ${j}`:""]}),P.scoring&&r.jsxs("span",{className:"best-param-modal__list-score",children:[P.scoring,": ",ow(P.score)]}),P.targetColumn&&r.jsxs("span",{className:"best-param-modal__list-target",children:["Target: ",P.targetColumn]})]},P.id)})}),r.jsx("section",{className:"best-param-modal__details",children:m?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"best-param-modal__summary",children:[r.jsxs("div",{className:"best-param-modal__summary-main",children:[r.jsx("h4",{children:m.label}),r.jsxs("p",{children:[m.runNumber?`Run ${m.runNumber}`:"Tuning run",S?`  ${S}`:"",m.searchStrategy?`  ${m.searchStrategy}`:""]}),r.jsxs("p",{children:["Model: ",r.jsx("strong",{children:m.modelType}),m.targetColumn?r.jsxs(r.Fragment,{children:[" "," Target: ",r.jsx("strong",{children:m.targetColumn})]}):null,m.scoring?r.jsxs(r.Fragment,{children:[" "," ",m.scoring,": ",r.jsx("strong",{children:ow(m.score)})]}):null]})]}),r.jsx("div",{className:"best-param-modal__summary-actions",children:r.jsx("button",{type:"button",className:"best-param-modal__apply",onClick:()=>a(m),disabled:!x.length,children:v?"Already applied":"Apply preset"})})]}),m.description&&r.jsx("p",{className:"best-param-modal__note",children:m.description}),w&&r.jsxs("div",{className:"best-param-modal__notice best-param-modal__notice--warning",children:[r.jsx("strong",{children:"Tip:"})," ",w]}),r.jsx("div",{className:"best-param-modal__param-grid",role:"table",children:x.length?x.map(P=>r.jsxs("div",{className:"best-param-modal__param-row",role:"row",children:[r.jsxs("div",{className:"best-param-modal__param-name",role:"cell",children:[r.jsxs("div",{className:"best-param-modal__param-label",children:[P.label,P.label!==P.key&&r.jsx("span",{className:"best-param-modal__param-key",children:r.jsx("code",{children:P.key})})]}),P.description&&r.jsx("div",{className:"best-param-modal__param-description",children:P.description})]}),r.jsxs("div",{className:"best-param-modal__param-value",role:"cell",children:[r.jsx("code",{children:P.value}),P.note&&r.jsx("span",{className:"best-param-modal__param-note",children:P.note})]})]},P.key)):r.jsx("p",{className:"best-param-modal__empty",children:"No hyperparameters available for this preset."})})]}):r.jsx("p",{className:"best-param-modal__empty",children:"Select a tuning run to inspect its hyperparameters."})})]})]})]})},[i,v,l,t,a,n,e,m]);return p?uv.createPortal(p,document.body):null},qT=new Set(["scale_numeric_features","scaling","scale_numeric"]),HT=[/convergencewarning/i,/failed to converge/i,/did not converge/i,/optimizer failed to converge/i,/increase the number of iterations/i,/scale your features/i,/standardize your features/i,/consider scaling your (data|features)/i,/feature scaling is (recommended|required)/i],VT=["forest","tree","boost","xgboost","lightgbm","catboost","gradient","histgradient","bagging"],WT=["bayes","naive_bayes","gaussian_nb"],KT=e=>{const t=e.trim().toLowerCase();return t?VT.some(a=>t.includes(a))?{required:!1,reason:null}:WT.some(a=>t.includes(a))?{required:!1,reason:null}:t.includes("logistic")?{required:!0,reason:"logistic"}:t.includes("svm")||t.includes("svc")||t.includes("svr")?{required:!0,reason:"svm"}:t.includes("knn")||t.includes("nearest")?{required:!0,reason:"knn"}:t.includes("sgd")||t.includes("perceptron")?{required:!0,reason:"sgd"}:["linear","ridge","lasso","elastic","regression"].some(a=>t.includes(a))?{required:!0,reason:"linear"}:{required:!1,reason:null}:{required:!1,reason:null}},YT=(e,t)=>{const n=new Set;if(!e||!t)return n;const a=Array.isArray(e.edges)?e.edges:[],i=[t];for(;i.length;){const l=i.pop();if(l)for(const u of a){if(!u)continue;const d=typeof u.source=="string"?u.source.trim():"",m=typeof u.target=="string"?u.target.trim():"";!d||!m||m===l&&!n.has(d)&&(n.add(d),i.push(d))}}return n},QT=(e,t)=>{if(!e||!t)return!1;const n=YT(e,t);return n.size?(Array.isArray(e.nodes)?e.nodes:[]).some(i=>{var u;if(!i||typeof i.id!="string"||!n.has(i.id))return!1;const l=String(((u=i==null?void 0:i.data)==null?void 0:u.catalogType)??(i==null?void 0:i.type)??"").toLowerCase();return l?qT.has(l)?!0:l.includes("scale")&&l.includes("numeric"):!1}):!1},GT=(e,t)=>{const n=t.find(a=>(a==null?void 0:a.value)===e);return n!=null&&n.label?n.label:e.replace(/_/g," ").replace(/\s+/g," ").trim()},Wg=(e,t=new Set,n=0)=>{if(e==null)return[];if(typeof e=="string")return[e];if(typeof e=="number"||typeof e=="boolean")return[];if(n>3)return[];if(Array.isArray(e)){if(!e.length)return[];const a=32,i=[];for(let l=0;l<e.length&&l<a;l+=1)i.push(...Wg(e[l],t,n+1));return i}if(typeof e=="object"){if(t.has(e))return[];t.add(e);const a=Object.values(e);if(!a.length)return[];const i=32,l=[];for(let u=0;u<a.length&&u<i;u+=1)l.push(...Wg(a[u],t,n+1));return l}return[]},Pc=e=>{if(!e)return!1;const t=Wg(e);return t.length?t.some(n=>HT.some(a=>a.test(n))):!1},Ed=e=>{var n,a,i,l,u,d,m,v,p,_,y,w,x,S;if(!e)return!1;const t=[e.error_message,e.warning_message,e.message,e.details,e.notes,e.status_reason,e.status_message,e.error,(n=e.metadata)==null?void 0:n.warnings,(a=e.metadata)==null?void 0:a.warning,(i=e.metadata)==null?void 0:i.notes,(l=e.metadata)==null?void 0:l.messages,(u=e.metadata)==null?void 0:u.message,(d=e.metadata)==null?void 0:d.errors,(m=e.metrics)==null?void 0:m.warnings,(v=e.metrics)==null?void 0:v.warning,(p=e.metrics)==null?void 0:p.messages,(_=e.metrics)==null?void 0:_.message,(y=e.job_metadata)==null?void 0:y.warnings,(w=e.job_metadata)==null?void 0:w.warning,(x=e.job_metadata)==null?void 0:x.messages,(S=e.job_metadata)==null?void 0:S.notes];for(const k of t)if(Pc(k))return!0;return!!(Pc(e.metadata)||Pc(e.metrics))},XT=(e,t,n)=>{const a=t||"This model";switch(e){case"logistic":return{headline:`${a} needs scaled numeric features`,summary:'Standardize numeric inputs before launching jobs to keep the logistic solver stable and avoid repeated "scale your features" warnings.',details:["Insert a Scale numeric features step before this node or reuse an upstream scaler.","StandardScaler works for most datasets; RobustScaler can help when outliers dominate.","Once scaling is in place, re-run tuning or training so the solver converges cleanly."]};case"svm":return{headline:`${a} is sensitive to feature scale`,summary:"Support Vector Machines depend on distance calculations. Keep numeric features on comparable scales to preserve margin geometry.",details:["Add the Scale numeric features step upstream of this node.","Try StandardScaler or MinMaxScaler depending on the kernel and expected ranges.","Retrain after scaling to refresh support vectors and hyperparameters."]};case"knn":return{headline:`${a} uses distance-based comparisons`,summary:"k-NN models weigh distances directly, so unscaled columns dominate neighbors. Scale numeric fields to keep votes balanced.",details:["Drop in a Scale numeric features step before launching jobs.","MinMaxScaler keeps features in [0, 1]; StandardScaler works when values are roughly normal.","Requeue jobs after scaling so neighbor search reflects the new feature space."]};case"sgd":return{headline:`${a} benefits from normalized inputs`,summary:"Stochastic gradient models converge faster and produce steadier coefficients when numeric inputs share a common scale.",details:["Insert a Scale numeric features node prior to this step.","StandardScaler plus optional RobustScaler for heavy-tailed features keeps gradients stable.","Re-run jobs after scaling to avoid exploding or vanishing updates."]};default:return{headline:`${a} prefers standardized numeric features`,summary:n==="regression"?"Linear regression families rely on comparable feature magnitudes. Scaling keeps coefficients well-conditioned and improves R stability.":"Linear classification models respond better when numeric inputs share a common scale. Scaling prevents any single column from dominating the loss.",details:["Add the Scale numeric features step ahead of this node or reuse an existing scaler.","StandardScaler is a safe default; RobustScaler helps when outliers skew distributions.","Re-launch jobs once scaling is applied so coefficients represent the standardized space."]}}},iw=({graph:e,nodeId:t,modelType:n,problemType:a,modelTypeOptions:i,enabled:l})=>f.useMemo(()=>{if(!l||!n||!n.trim()||QT(e,t))return null;const u=n.trim().toLowerCase(),{required:d,reason:m}=KT(u);if(!d||!m)return null;const v=GT(n,i);return XT(m,v,a)},[l,e,n,i,t,a]),JT={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},Tc={classification:["accuracy","f1_weighted","roc_auc","precision_weighted","recall_weighted"],regression:["rmse","mae","r2"],fallback:["rmse","mae","r2","accuracy","f1_weighted","roc_auc"]},Kg=(e,t)=>{if(!e)return{};const n={};return Object.entries(e).forEach(([a,i])=>{t.has(a)&&(n[a]=i)}),n},lw=(e,t)=>{if(e===t||typeof e=="number"&&typeof t=="number"&&Number.isNaN(e)&&Number.isNaN(t))return!0;if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?!1:e.every((n,a)=>lw(n,t[a]));if(e&&t&&typeof e=="object"&&typeof t=="object")try{return JSON.stringify(e)===JSON.stringify(t)}catch{return!1}return!1},ZT=(e,t,n)=>{if(!e)return{};const a={};return Object.entries(e).forEach(([i,l])=>{if(!t.has(i)||l===""||l===null||l===void 0)return;const u=n==null?void 0:n[i];let d=l;if(u){if(typeof d=="string"){const m=d.trim();if(!m)return;u.type==="select"&&(d=m)}if(u.name==="multi_class"&&typeof d=="string"){const m=d.trim().toLowerCase();if(m==="auto")return;(m==="ovr"||m==="multinomial")&&(d=m)}if(u.default!==void 0){if(typeof u.default=="string"&&typeof d=="string"){const m=u.default.trim(),v=d.trim();if(m===v)return}else if(lw(u.default,d))return}}a[i]=d}),a},cw=e=>!!e&&typeof e=="object"&&!Array.isArray(e),kd=e=>{try{return JSON.parse(JSON.stringify(e))}catch{return e}},e2=e=>{if(!e)return Tc.fallback;const t=String(e.model_type??e.modelType??"").toLowerCase();if(t.includes("regressor"))return Tc.regression;if(t.includes("classifier")||t.includes("classification"))return Tc.classification;const n=String(e.problem_type??e.problemType??"").toLowerCase();return n==="regression"?Tc.regression:n==="classification"?Tc.classification:Tc.fallback},t2=e=>{var l,u,d;if(!e)return null;const t=[],n=(u=(l=e==null?void 0:e.cross_validation)==null?void 0:l.metrics)==null?void 0:u.mean;cw(n)&&((d=e==null?void 0:e.cross_validation)==null?void 0:d.status)==="completed"&&t.push({dataset:n,labelPrefix:"CV mean "});const a=[e.test,e.validation,e.train];for(const m of a)cw(m)&&t.push({dataset:m,labelPrefix:""});const i=e2(e);for(const m of t)for(const v of i){const p=m.dataset[v];if(typeof p=="number"&&Number.isFinite(p))return{label:m.labelPrefix?`${m.labelPrefix}${v}`:v,value:p}}for(const m of t)for(const[v,p]of Object.entries(m.dataset))if(typeof p=="number"&&Number.isFinite(p))return{label:m.labelPrefix?`${m.labelPrefix}${v}`:v,value:p};return null},uw=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",n2=({nodeId:e,sourceId:t,graph:n,config:a,runtimeConfig:i,cvConfig:l,draftConfigState:u,renderParameterField:d,modelTypeParameter:m,modelTypeOptions:v,hyperparametersParameter:p,cvEnabledParameter:_,cvStrategyParameter:y,cvFoldsParameter:w,cvShuffleParameter:x,cvRandomStateParameter:S,cvRefitStrategyParameter:k,onSaveDraftConfig:M})=>{var _s,Fr,Rs,_a;const P=gc(),[T,j]=f.useState(null),[O,A]=f.useState(null),[z,$]=f.useState(null),[q,V]=f.useState(0),[R,ee]=f.useState({}),[le,D]=f.useState(!1),X=f.useRef(!1),[Y,K]=f.useState(null),[U,te]=f.useState(!1),[W,I]=f.useState(!1),[Q,me]=f.useState(null),[J,H]=f.useState(null),[Z,ne]=f.useState(!1),fe=((a==null?void 0:a.targetColumn)??"").trim(),ae=(a==null?void 0:a.problemType)==="regression"?"regression":"classification",pe=((i==null?void 0:i.modelType)??"").trim(),Ve=(i==null?void 0:i.hyperparameters)??null,st=(i==null?void 0:i.hyperparametersError)??null,Ke=!!(l!=null&&l.enabled),mt=(l==null?void 0:l.strategy)??"auto",yt=typeof(l==null?void 0:l.folds)=="number"?l.folds:0,Te=!!(l!=null&&l.shuffle),at=(l==null?void 0:l.randomState)??null,it=(l==null?void 0:l.refitStrategy)??"train_plus_validation",be=f.useMemo(()=>m?v.length?{...m,options:v}:m:null,[v,m]),Pe=Ar({queryKey:["model-hyperparameters",pe],queryFn:()=>Tf(pe),enabled:!!pe,staleTime:5*60*1e3}),G=Ar({queryKey:["best-hyperparameters",pe,Y,t],queryFn:()=>Px(pe,{pipelineId:Y||void 0,datasetSourceId:t||void 0}),enabled:!!(pe&&t),staleTime:30*1e3,retry:1}),ke=((_s=Pe.data)==null?void 0:_s.fields)??[],Ae=((Fr=Pe.data)==null?void 0:Fr.defaults)??{},Ge=f.useMemo(()=>ke.length?new Set(ke.map(_e=>_e.name)):new Set,[ke]),ft=f.useMemo(()=>ke.length?ke.reduce((_e,De)=>(De!=null&&De.name&&(_e[De.name]=De),_e),{}):{},[ke]),zt=f.useMemo(()=>{if(!pe||!Ve||Ge.size===0)return null;const _e=Kg(Ve,Ge);return Object.keys(_e).length>0?_e:null},[Ge,Ve,pe]);f.useEffect(()=>{ee({}),D(!1),X.current=!1},[pe]),f.useEffect(()=>{zt&&(ee(_e=>{const De=Object.keys(_e),et=Object.keys(zt);return De.length===et.length&&et.every(Be=>Object.is(_e[Be],zt[Be]))?_e:zt}),X.current||(D(!0),X.current=!0))},[zt]),f.useEffect(()=>{if(!pe||zt||Ge.size===0||!Ae||Object.keys(Ae).length===0)return;const _e=Kg(Ae,Ge);Object.keys(_e).length!==0&&ee(De=>Object.keys(De).length>0?De:_e)},[Ge,zt,Ae,pe]);const ve=f.useMemo(()=>{if(Ge.size===0)return null;const _e=ZT(R,Ge,ft);return Object.keys(_e).length>0?_e:null},[Ge,R]),xe=f.useCallback(()=>{D(_e=>{const De=!_e;return De&&(X.current=!0),De})},[]),Se=f.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),$e=f.useMemo(()=>{if(!Se)return null;if(!u||Object.keys(u).length===0)return Se;const _e=kd(Se);return!_e||!Array.isArray(_e.nodes)||(_e.nodes=_e.nodes.map(De=>{if(!De||De.id!==e)return De;const et=(De==null?void 0:De.data)??{},Be={...(et==null?void 0:et.config)??{},...u};return{...De,data:{...et,config:Be,isConfigured:!0}}})),_e},[u,Se,e]);f.useEffect(()=>{let _e=!1;return!t||!Se?(K(null),()=>{_e=!0}):(al(t,Se).then(De=>{_e||K(De)}).catch(()=>{_e||K(null)}),()=>{_e=!0})},[Se,t]),f.useEffect(()=>{let _e=!1;A(null);const De=$e??Se;return!t||!De?(j(null),()=>{_e=!0}):(al(t,De).then(et=>{_e||j(et)}).catch(et=>{_e||(A((et==null?void 0:et.message)??"Unable to compute pipeline ID"),j(null))}),()=>{_e=!0})},[Se,$e,t]),f.useEffect(()=>{if(!T||!Y){te(!1);return}te(T!==Y)},[T,Y]);const Ye=f.useMemo(()=>["feature-canvas","training-jobs",t??"none",T??"pending",e],[e,T,t]),Ue=f.useMemo(()=>["feature-canvas","tuning-jobs",t??"none",T??"pending",e],[e,T,t]),Ze=!!(t&&e),Nt=Ar({queryKey:Ue,queryFn:async()=>{var De;const _e={datasetSourceId:t||void 0,limit:5};if(T){const et=await _d({..._e,pipelineId:T});if((((De=et==null?void 0:et.jobs)==null?void 0:De.length)??0)>0)return et}return _d(_e)},enabled:Ze,retry:(_e,De)=>De.message.includes("Sign in")?!1:_e<2,refetchInterval:_e=>{const De=_e.state.data;return((De==null?void 0:De.jobs)??[]).some(Be=>Be.status==="queued"||Be.status==="running")?5e3:!1}}),Et=Ar({queryKey:Ye,queryFn:async()=>{var De;const _e={datasetSourceId:t||void 0,nodeId:e,limit:5};if(T){const et=await gd({..._e,pipelineId:T});if((((De=et==null?void 0:et.jobs)==null?void 0:De.length)??0)>0)return et}return gd(_e)},enabled:Ze,retry:(_e,De)=>De.message.includes("Sign in")?!1:_e<2,refetchInterval:_e=>{const De=_e.state.data;return((De==null?void 0:De.jobs)??[]).some(Be=>Be.status==="queued"||Be.status==="running")?5e3:!1}}),{mutateAsync:qt,isPending:Ht,error:Pt}=Xm({mutationFn:Ex,onSuccess:_e=>{const De=Array.isArray(_e.jobs)?_e.jobs.length:0,et=De>0?_e.jobs[0]:null;$(et),V(De),P.invalidateQueries({queryKey:Ye})}}),pt=Nt.error,Jt=Nt.isLoading||Nt.isFetching,Gt=((Rs=Nt.data)==null?void 0:Rs.jobs)??[],Ct=G.data,Dn=f.useCallback(_e=>{if(!_e)return null;const De=Object.keys(_e);if(De.length===0)return null;if(Ge.size===0)return{params:_e,hasUnmapped:!1};const et=Kg(_e,Ge),Yt=Object.keys(et);return Yt.length>0?{params:et,hasUnmapped:Yt.length!==De.length}:{params:_e,hasUnmapped:!0}},[Ge]),wn=f.useMemo(()=>Gt.length?Gt.filter(_e=>_e.status==="succeeded"):[],[Gt]),pn=f.useMemo(()=>{if(!pe)return[];const _e=[],De=new Set,et=fe?fe.trim().toLowerCase():"",Yt=Be=>!et||!Be?!0:Be.trim().toLowerCase()===et;if(Ct!=null&&Ct.available&&Ct.best_params&&(!Ct.model_type||Ct.model_type===pe)){const Be=Dn(Ct.best_params);if(Be){const kt=Ct.job_id??null;if(!kt||!De.has(kt)){const $t=["Most recent tuned run"];Ct.run_number&&$t.push(`#${Ct.run_number}`);const rn=`best-api-${kt??pe}`;_e.push({id:rn,label:$t.join(" "),source:"best-api",modelType:Ct.model_type??pe,params:Be.params,jobId:kt,nodeId:Ct.node_id??null,runNumber:Ct.run_number??null,score:Ct.best_score??null,scoring:Ct.scoring??null,finishedAt:Ct.finished_at??null,searchStrategy:Ct.search_strategy??null,nIterations:Ct.n_iterations??null,targetColumn:fe||null,pipelineId:Ct.pipeline_id??null,datasetSourceId:t??null,description:Be.hasUnmapped?"Includes parameters outside the current template. They will be stored as custom overrides.":null}),kt&&De.add(kt)}}}return wn.forEach(Be=>{var Rn,mr,Ms,Zn,is;if(!Be.best_params||Be.model_type!==pe||t&&Be.dataset_source_id&&Be.dataset_source_id!==t||De.has(Be.id))return;const kt=Dn(Be.best_params);if(!kt)return;const $t=typeof((Rn=Be.metadata)==null?void 0:Rn.target_column)=="string"?Be.metadata.target_column:typeof((mr=Be.metadata)==null?void 0:mr.targetColumn)=="string"?Be.metadata.targetColumn:null;if(!Yt($t))return;const rn=`job-${Be.id}`,Zt=(()=>{var As;const Fs=typeof((As=Be.metadata)==null?void 0:As.label)=="string"?Be.metadata.label.trim():"";return Fs||(Be.run_number?`Run ${Be.run_number}`:`Job ${Be.id.slice(0,6)}`)})(),On=typeof((Ms=Be.metadata)==null?void 0:Ms.scoring)=="string"?Be.metadata.scoring:typeof((Zn=Be.metrics)==null?void 0:Zn.scoring)=="string"?Be.metrics.scoring:null,gn=typeof((is=Be.metadata)==null?void 0:is.n_iterations)=="number"?Be.metadata.n_iterations:null;_e.push({id:rn,label:Zt,source:"tuning-job",modelType:Be.model_type,params:kt.params,jobId:Be.id,nodeId:Be.node_id,runNumber:Be.run_number??null,score:Be.best_score??null,scoring:On,finishedAt:Be.updated_at??Be.created_at??null,searchStrategy:Be.search_strategy??null,nIterations:gn,targetColumn:$t??(fe||null),pipelineId:Be.pipeline_id??null,datasetSourceId:Be.dataset_source_id??null,description:kt.hasUnmapped?"Some tuned parameters fall outside the current template and will be saved as custom overrides.":null}),De.add(Be.id)}),_e.sort((Be,kt)=>{const $t=Be.finishedAt?Date.parse(Be.finishedAt):0,rn=kt.finishedAt?Date.parse(kt.finishedAt):0;return $t!==rn?rn-$t:(kt.runNumber??0)-(Be.runNumber??0)}),_e},[Ct,Dn,pe,t,fe,wn]),Tt=pn[0]??null,hs=pn.length>0,sn=!Tt,ht=!hs,_t=f.useMemo(()=>wn.length?wn.slice().sort((_e,De)=>{const et=Date.parse(_e.updated_at||_e.created_at||"0");return Date.parse(De.updated_at||De.created_at||"0")-et})[0]:Gt.length?Gt.slice().sort((_e,De)=>{const et=Date.parse(_e.updated_at||_e.created_at||"0");return Date.parse(De.updated_at||De.created_at||"0")-et})[0]:null,[wn,Gt]),zn=_t&&(_t.updated_at||_t.created_at)||null,Gn=zn?Cs(zn):null,ps=(_t==null?void 0:_t.run_number)??null,Xn=Tt!=null&&Tt.finishedAt?Cs(Tt.finishedAt):null,Es=Tt&&Tt.scoring&&typeof Tt.score=="number"&&Number.isFinite(Tt.score)?`${Tt.scoring}: ${uw(Tt.score)}`:null;f.useEffect(()=>{if(!pn.length){Q&&me(null),(J==null?void 0:J.tone)==="success"&&H(null);return}Q&&!pn.some(_e=>_e.id===Q)&&(me(null),H(null))},[J,pn,Q]);const Jn=f.useCallback((_e,De)=>{if(!_e||Object.keys(_e.params??{}).length===0){H({message:"Selected preset does not include any hyperparameters to apply.",tone:"warning"});return}ee(()=>kd(_e.params)),D(!0),X.current=!0,me(_e.id),H({message:De??`Applied tuned parameters from ${_e.label}.`,tone:"success"})},[ee,D,H,me]),dr=f.useCallback(()=>{if(!Tt){const De=_t&&_t.model_type&&_t.model_type!==pe?`Latest tuning run targeted ${_t.model_type}. Switch the model template to reuse its parameters.`:"No tuning job results available to apply.";H({message:De,tone:"warning"});return}const _e=Tt.runNumber?`Applied tuned parameters from run ${Tt.runNumber}.`:`Applied tuned parameters from ${Tt.label}.`;Jn(Tt,_e)},[Jn,_t,pe,Tt,H]),bn=f.useMemo(()=>{if(!J)return"rgba(148, 163, 184, 0.75)";switch(J.tone){case"success":return"rgba(134, 239, 172, 0.9)";case"warning":return"rgba(253, 186, 116, 0.95)";default:return"rgba(148, 163, 184, 0.85)"}},[J]),zs=f.useMemo(()=>{const _e=[];return t||_e.push("Select a dataset before launching training jobs."),(!Se||!Se.nodes.length)&&_e.push("Connect this node to an upstream pipeline before training."),fe||_e.push("Set a target column in the Train model readiness section."),pe||_e.push("Choose a model type before enqueuing training jobs."),Ke&&yt<2&&_e.push("Cross-validation requires at least 2 folds."),O&&_e.push(O),st&&_e.push(st),_e},[Ke,yt,Se,st,pe,O,t,fe]),ks=((_a=Et.data)==null?void 0:_a.jobs)??[],gs=f.useMemo(()=>{if(!ks.length)return ks;const _e=ae==null?void 0:ae.toLowerCase();return ks.filter(De=>{if(!_e)return!0;const et=(()=>{var rn,Zt,On,gn;const Be=typeof De.problem_type=="string"?De.problem_type:null,kt=typeof((rn=De.metadata)==null?void 0:rn.problem_type)=="string"?(Zt=De.metadata)==null?void 0:Zt.problem_type:null,$t=typeof((On=De.metadata)==null?void 0:On.resolved_problem_type)=="string"?(gn=De.metadata)==null?void 0:gn.resolved_problem_type:null;return(Be||$t||kt||"").toLowerCase()})();if(et)return et===_e;const Yt=String(De.model_type||"").toLowerCase();return _e==="regression"?Yt.includes("regress"):_e==="classification"?Yt.includes("classif"):!0})},[ks,ae]),Ba=f.useMemo(()=>!!(Pt instanceof Error&&Pc(Pt.message)||z&&Ed(z)||ks.some(_e=>Ed(_e))||Gt.some(_e=>Ed(_e))),[Pt,ks,z,Gt]),Xs=iw({graph:n,nodeId:e,modelType:pe,problemType:ae,modelTypeOptions:v,enabled:Ba});f.useEffect(()=>{Xs||ne(!1)},[Xs]);const pa=Math.max(ks.length-gs.length,0),zr=Et.isLoading||Et.isFetching,Rr=Et.error,ga=zs.length>0||!T||!t||!Se||Ht,Js=f.useCallback((_e,De)=>{ee(et=>({...et,[_e]:De}))},[]),bo=f.useCallback(_e=>{var Yt;const De=R[_e.name]??_e.default,et=`hyperparam-${e}-${_e.name}`;return r.jsxs("div",{className:"canvas-modal__parameter",children:[r.jsxs("label",{htmlFor:et,className:"canvas-modal__parameter-label",children:[_e.label,_e.description&&r.jsx("span",{className:"canvas-modal__parameter-description",children:_e.description})]}),_e.type==="number"&&r.jsx("input",{id:et,type:"number",className:"canvas-modal__parameter-input",value:De??"",onChange:Be=>{const kt=Be.target.value;if(kt===""&&_e.nullable)Js(_e.name,null);else{const $t=parseFloat(kt);isNaN($t)||Js(_e.name,$t)}},min:_e.min,max:_e.max,step:_e.step,placeholder:_e.nullable?"Empty = default":""}),_e.type==="select"&&r.jsx("select",{id:et,className:"canvas-modal__parameter-select",value:De??"",onChange:Be=>Js(_e.name,Be.target.value),children:(Yt=_e.options)==null?void 0:Yt.map(Be=>r.jsx("option",{value:Be.value,children:Be.label},Be.value))}),_e.type==="boolean"&&r.jsx("input",{id:et,type:"checkbox",className:"canvas-modal__parameter-checkbox",checked:!!De,onChange:Be=>Js(_e.name,Be.target.checked)}),_e.type==="text"&&r.jsx("input",{id:et,type:"text",className:"canvas-modal__parameter-input",value:De??"",onChange:Be=>Js(_e.name,Be.target.value),placeholder:_e.nullable?"Empty = default":""})]},_e.name)},[R,Js,e]),Ua=f.useCallback(async()=>{if(!T||!t||!pe)return;if(U&&M){try{const $t=M({closeModal:!1});$t&&typeof $t.then=="function"&&await $t,te(!1)}catch{}await new Promise($t=>setTimeout($t,100))}const _e=$e??Se;if(!_e)return;const De={};fe&&(De.target_column=fe),De.problem_type=ae,De.cross_validation={enabled:Ke,strategy:mt,folds:yt,shuffle:Te,random_state:at,refit_strategy:it};const et=Object.keys(De).length?De:void 0,Yt=kd(_e);Yt&&Array.isArray(Yt.nodes)&&(Yt.nodes=Yt.nodes.map($t=>{if(!$t||$t.id!==e)return $t;const rn=($t==null?void 0:$t.data)??{},Zt=(rn==null?void 0:rn.config)??{},On=u?{...Zt,...u}:Zt;return{...$t,data:{...rn,config:On,isConfigured:!0}}}));const Be=pe?[pe]:[],kt={dataset_source_id:t,pipeline_id:T,node_id:e,model_type:pe||void 0,model_types:Be.length?Be:void 0,hyperparameters:le&&ve?kd(ve):void 0,metadata:et,job_metadata:et,run_training:!0,graph:Yt??kd(_e),target_node_id:e};try{await qt(kt)}catch{}},[Ke,yt,at,it,Te,mt,u,qt,Se,$e,U,pe,e,M,T,ae,ve,le,t,fe]),fn=f.useCallback(()=>{Ze&&Et.refetch()},[Ze,Et]),Xr=_e=>{var Rn,mr,Ms,Zn;const De=t2(_e.metrics??null),et=_e.updated_at?Cs(_e.updated_at):null,Yt=_e.updated_at||_e.created_at,Be=Yt?et??new Date(Yt).toLocaleString():null,kt=JT[_e.status]??_e.status,$t=(_e.problem_type||((Rn=_e.metadata)==null?void 0:Rn.resolved_problem_type)||((mr=_e.metadata)==null?void 0:mr.problem_type)||"").toString(),rn=((Ms=_e.metadata)==null?void 0:Ms.cross_validation)??null,Zt=((Zn=_e.metrics)==null?void 0:Zn.cross_validation)??null,On=typeof _e.error_message=="string"?_e.error_message.trim():"",gn=[];if(gn.push(`Model ${_e.model_type}`),$t&&gn.push($t.charAt(0).toUpperCase()+$t.slice(1)),rn!=null&&rn.enabled){const is=String(rn.strategy??"auto"),Fs=is==="stratified_kfold"?"Stratified KFold":is==="kfold"?"KFold":"Auto CV",As=typeof rn.folds=="number"?`${rn.folds} folds`:"CV enabled";if(gn.push(`${Fs} (${As})`),(Zt==null?void 0:Zt.status)==="skipped"){const di=String((Zt==null?void 0:Zt.reason)??"unknown reason").replace(/_/g," ");gn.push(`CV skipped (${di})`)}}else if((Zt==null?void 0:Zt.status)==="skipped"){const is=String((Zt==null?void 0:Zt.reason)??"unknown reason").replace(/_/g," ");gn.push(`CV skipped (${is})`)}if(De&&gn.push(`${De.label}: ${uw(De.value)}`),_e.status==="failed"&&On){const is=On.replace(/\s+/g," ");gn.push(`Error: ${is}`)}return Be&&gn.push(`Updated ${Be}`),r.jsxs("li",{children:[r.jsxs("strong",{children:["v",_e.version]}),"  ",kt,gn.length>0?`  ${gn.join("  ")}`:""]},_e.id)};return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Background training jobs"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:fn,disabled:!Ze||zr,children:zr?"Refreshing":"Refresh jobs"})})]}),r.jsx("p",{className:"canvas-modal__note",children:"Enqueue a background training job for this node. Jobs run via Celery, versioned per pipeline, and report metrics when finished."}),T&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Pipeline ID: ",r.jsx("code",{children:T})]}),U&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{background:"rgba(251, 146, 60, 0.1)",borderLeft:"3px solid rgba(251, 146, 60, 0.8)",padding:"0.75rem 1rem",margin:"0.75rem 0"},children:[r.jsx("strong",{children:" Unsaved Configuration Changes"}),r.jsx("br",{}),"Your changes will create a new training pipeline. Previous jobs remain under the old configuration. Jobs will auto-save when you launch training."]}),zs.map((_e,De)=>r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:_e},`training-prereq-${De}`)),Pt instanceof Error&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:Pt.message}),Rr&&!(Pt instanceof Error)&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:Rr.message||"Unable to load training jobs."}),pt&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:pt.message||"Unable to load tuning jobs."}),z&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:q>1?r.jsxs("span",{children:["Queued ",q," training jobs. Latest job ",z.id," (version ",z.version,")."]}):r.jsxs("span",{children:["Training job ",z.id," queued (version ",z.version,")."]})}),Jt&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading tuning jobs"}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[be&&d(be),_&&d(_),Ke&&r.jsxs(r.Fragment,{children:[y&&d(y),w&&d(w),x&&d(x),S&&d(S),k&&d(k)]}),pe&&ke.length>0&&r.jsx("div",{className:"canvas-modal__parameter",style:{gridColumn:"1 / -1"},children:r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem",marginBottom:"0.75rem",padding:"0.75rem 1rem",background:"rgba(15, 23, 42, 0.35)",borderRadius:"6px",border:"1px solid rgba(148, 163, 184, 0.25)"},children:[r.jsxs("div",{style:{flex:"1 1 260px"},children:[r.jsx("strong",{style:{fontSize:"0.95rem",color:"#e2e8f0"},children:"Model Configuration"}),r.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:le?"Fine-tune hyperparameters or use defaults for quick training":"Using default hyperparameters  toggle Advanced to customize"}),(Tt||_t)&&r.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",color:"rgba(148, 163, 184, 0.8)"},children:Tt?r.jsxs(r.Fragment,{children:[" Tuned parameters available for ",r.jsx("strong",{children:Tt.modelType}),Tt.runNumber?` (run ${Tt.runNumber})`:"",Xn?`  ${Xn}`:"",Tt.targetColumn?`  Target: ${Tt.targetColumn}`:"",Es?`  ${Es}`:""]}):r.jsxs(r.Fragment,{children:["Latest tuning run ",ps||"N/A",Gn?`  ${Gn}`:"",_t!=null&&_t.model_type&&_t.model_type!==pe?` targeted ${_t.model_type}.`:" did not produce reusable parameters for this configuration yet."]})}),J&&r.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",color:bn},children:J.message})]}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center",justifyContent:"flex-end"},children:[r.jsx("button",{type:"button",onClick:dr,disabled:sn,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:sn?"rgba(148, 163, 184, 0.55)":"#0c4a6e",background:sn?"rgba(15, 23, 42, 0.35)":"rgba(191, 219, 254, 0.9)",border:sn?"1px solid rgba(148, 163, 184, 0.35)":"1px solid rgba(147, 197, 253, 0.9)",borderRadius:"4px",cursor:sn?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"130px",boxShadow:sn?"none":"0 3px 10px rgba(14, 116, 144, 0.25)"},children:"Apply tuned params"}),r.jsx("button",{type:"button",onClick:()=>I(!0),disabled:ht,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:ht?"rgba(148, 163, 184, 0.55)":"rgba(168, 85, 247, 0.95)",background:ht?"rgba(15, 23, 42, 0.35)":"rgba(76, 29, 149, 0.18)",border:ht?"1px solid rgba(148, 163, 184, 0.35)":"1px solid rgba(168, 85, 247, 0.45)",borderRadius:"4px",cursor:ht?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"150px"},children:"Browse tuned params"}),r.jsx("button",{type:"button",onClick:xe,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:"500",color:le?"#fff":"rgba(148, 163, 184, 0.85)",background:le?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(15, 23, 42, 0.6)",border:le?"none":"1px solid rgba(148, 163, 184, 0.45)",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s ease",minWidth:"100px",boxShadow:le?"0 4px 12px rgba(118, 75, 162, 0.25)":"none"},onMouseEnter:_e=>{le?_e.currentTarget.style.boxShadow="0 6px 16px rgba(118, 75, 162, 0.35)":(_e.currentTarget.style.borderColor="rgba(148, 163, 184, 0.65)",_e.currentTarget.style.background="rgba(15, 23, 42, 0.8)")},onMouseLeave:_e=>{le?_e.currentTarget.style.boxShadow="0 4px 12px rgba(118, 75, 162, 0.25)":(_e.currentTarget.style.borderColor="rgba(148, 163, 184, 0.45)",_e.currentTarget.style.background="rgba(15, 23, 42, 0.6)")},children:le?" Advanced":"Default"})]})]})}),pe&&Pe.isLoading&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading hyperparameters"}),pe&&Pe.error&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--error",children:["Failed to load hyperparameters: ",Pe.error.message]}),pe&&le&&ke.length>0&&r.jsxs("div",{style:{gridColumn:"1 / -1",padding:"1.25rem",background:"rgba(15, 23, 42, 0.25)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px",marginTop:"0.5rem"},children:[r.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"2px solid rgba(102, 126, 234, 0.3)"},children:[r.jsx("h4",{style:{margin:"0 0 0.5rem 0",fontSize:"1rem",fontWeight:"600",color:"#e2e8f0"},children:"Advanced Hyperparameters"}),r.jsxs("p",{style:{margin:"0",fontSize:"0.875rem",color:"rgba(148, 163, 184, 0.85)",lineHeight:"1.5"},children:["Configure ",pe.replace(/_/g," ")," hyperparameters. Leave empty to use recommended defaults."]})]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:ke.map(bo)})]}),!pe&&p&&d(p)]}),Ke&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Cross-validation runs ",yt," folds before refitting on"," ",it==="train_plus_validation"?"training plus validation data.":"training data only."]}),Xs&&r.jsxs("div",{className:"canvas-modal__note canvas-modal__note--warning",style:{margin:"0.75rem 0",borderLeft:"3px solid rgba(251, 191, 36, 0.9)",background:"rgba(251, 191, 36, 0.12)",padding:"0.75rem 1rem"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"0.75rem"},children:[r.jsxs("div",{children:[r.jsxs("strong",{children:[" ",Xs.headline]}),r.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem"},children:Xs.summary})]}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>ne(_e=>!_e),style:{whiteSpace:"nowrap"},children:Z?"Hide tips":"Show tips"})]}),Z&&r.jsx("ul",{style:{margin:"0.75rem 0 0 1rem",padding:0,listStyle:"disc",fontSize:"0.85rem"},children:Xs.details.map((_e,De)=>r.jsx("li",{style:{marginBottom:"0.35rem"},children:_e},`scaling-tip-${De}`))})]}),r.jsx("div",{className:"canvas-modal__actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:Ua,disabled:ga,children:Ht?"Queuing":"Launch training job"})}),zr&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading recent jobs"}),pa>0&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:pa===1?"1 training job uses a different problem type. Switch the problem type to view it.":`${pa} training jobs use a different problem type. Switch the problem type to view them.`}),!zr&&gs.length===0&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No training jobs found for this node."}),gs.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:gs.map(Xr)}),r.jsx(UT,{presets:pn,isOpen:W,onClose:()=>I(!1),onApply:_e=>{Jn(_e),I(!1)},activePresetId:Q,fieldMetadata:ft})]})},s2=new Set(["true","1","yes","on"]),r2=new Set(["false","0","no","off"]),a2=["auto_detect","autoDetect","auto_detect_columns","auto","auto_detect_text"],dw=new Set(["true","1","yes","y","on","t"]),mw=new Set(["false","0","no","n","off","f"]),ll=e=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:null:null;if(typeof e=="string"){const t=e.trim().toLowerCase();if(!t)return null;if(s2.has(t))return!0;if(r2.has(t))return!1}return null},$c=e=>{if(!(!e||typeof e!="object")){for(const t of a2)if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}},Yg=e=>{if(e==null)return{};try{return JSON.parse(JSON.stringify(e))}catch{return Array.isArray(e)?[...e]:typeof e=="object"?{...e}:e}},Qg=e=>Array.isArray(e)?e.map(t=>Qg(t)):e&&typeof e=="object"?Object.keys(e).sort().reduce((t,n)=>(t[n]=Qg(e[n]),t),{}):e,Md=e=>e===void 0?"":JSON.stringify(Qg(e)),fw=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0},o2=(e,t)=>{const n=[],a=_=>{n.includes(_)||n.push(_)},i=(e??"").toLowerCase();if(!t.length)return n;const l=t.filter(_=>_!=null);if(!l.length)return n;const u=l.reduce((_,y)=>{if(typeof y=="number"&&Number.isFinite(y))return _+1;if(typeof y=="string"){const w=y.trim();if(!w)return _;const x=Number(w);if(!Number.isNaN(x)&&Number.isFinite(x))return _+1}return _},0),d=l.reduce((_,y)=>{const w=String(y).trim().toLowerCase();return w&&(dw.has(w)||mw.has(w))?_+1:_},0),m=(()=>{const _=new Set;return l.forEach(y=>{_.add(String(y).trim().toLowerCase())}),_.size})(),v=u/l.length,p=d/l.length;if(i.includes("object")||i.includes("string"))return p>=.7&&a("boolean"),v>=.7&&a("float64"),m>0&&m<=20&&a("category"),n;if(i.includes("float")){const _=l.reduce((y,w)=>{if(typeof w=="number")return Number.isInteger(w)?y+1:y;if(typeof w=="string"){const x=w.trim();if(!x)return y;const S=Number(x);if(!Number.isNaN(S)&&Number.isFinite(S)&&Number.isInteger(S))return y+1}return y},0);return p>=.8&&a("boolean"),l.length>0&&_/l.length>=.9&&a("Int64"),n}return i.includes("int")&&p>=.7&&a("boolean"),n},Hf=[{value:"train",label:"Train",accent:"train"},{value:"test",label:"Test",accent:"test"},{value:"validation",label:"Validation",accent:"validation"}],Vf={train:0,test:1,validation:2},i2=["train","test","validation"],Gg=e=>Array.isArray(e)?e.map(t=>typeof t=="string"?t:String(t??"")).map(t=>t.trim().toLowerCase()).filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim().toLowerCase()).filter(Boolean):[],Ad=e=>{const t=new Set(Hf.map(i=>i.value)),n=[];e.forEach(i=>{if(i){if(i==="training"&&(i="train"),i==="valid"||i==="val"){n.push("validation");return}t.has(i)&&n.push(i)}});const a=new Set;return n.filter(i=>a.has(i)?!1:(a.add(i),!0)).sort((i,l)=>Vf[i]-Vf[l])},l2=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0},Xg=(e,t)=>{const n=ll(e);return n===null?t:n},hw=(e,t)=>{if(typeof e=="number"&&Number.isFinite(e)&&e>0)return Math.round(e);if(typeof e=="string"&&e.trim()){const n=Number(e);if(Number.isFinite(n)&&n>0)return Math.round(n)}return t},pw=e=>{if(!e)return 0;const t=Date.parse(e);return Number.isFinite(t)?t:0},gw=e=>{const t=Hf.find(n=>n.value===e);return t?t.label:e.charAt(0).toUpperCase()+e.slice(1)},c2=e=>{const t=e.replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1)},u2=e=>{const t=[];e.model_type&&t.push(e.model_type),typeof e.version=="number"&&t.push(`v${e.version}`),t.push(` ${c2(e.status)}`);const n=Cs(e.updated_at??e.created_at);return n&&t.push(`(${n})`),t.join(" ")},Wf=e=>!Number.isFinite(e)||e<0?0:e>1?1:e,_w=e=>{if(!e||typeof e!="object")return[];const t=[];return Object.entries(e).forEach(([n,a])=>{typeof a=="number"&&Number.isFinite(a)&&t.push({key:n,value:a})}),t.sort((n,a)=>n.key.localeCompare(a.key)),t},vw=(e,t)=>{if(!Number.isFinite(e))return"";const n=t(e*100,Math.abs(e)>=.1?1:2);return n?`${n}%`:""},d2=({nodeId:e,sourceId:t,graph:n,config:a,setConfigState:i,renderParameterField:l,formatMetricValue:u,connectedSplitHandles:d,canResetNode:m=!1,onResetNode:v})=>{var it;const p=gc(),_=f.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),y=f.useMemo(()=>{if(!_)return[];const be=new Map;_.nodes.forEach(G=>{G!=null&&G.id&&be.set(G.id,G)});const Pe=new Set;return _.edges.forEach(G=>{var Ae;if(!G||G.target!==e)return;const ke=be.get(G.source);((Ae=ke==null?void 0:ke.data)==null?void 0:Ae.catalogType)==="train_model_draft"&&Pe.add(ke.id)}),Pe.size>0?Array.from(Pe):_.nodes.filter(G=>{var ke;return((ke=G==null?void 0:G.data)==null?void 0:ke.catalogType)==="train_model_draft"}).map(G=>G.id)},[_,e]),w=f.useMemo(()=>y.length?y.slice().sort().join("|"):"all",[y]),[x,S]=f.useState(null),[k,M]=f.useState(null);f.useEffect(()=>{let be=!1;return M(null),!t||!_?(S(null),()=>{be=!0}):(al(t,_).then(Pe=>{be||S(Pe)}).catch(Pe=>{be||(M((Pe==null?void 0:Pe.message)??"Unable to compute pipeline signature."),S(null))}),()=>{be=!0})},[_,t]);const P=f.useMemo(()=>{const be=a==null?void 0:a.training_job_id;return typeof be=="string"?be.trim():typeof be=="number"?String(be):""},[a==null?void 0:a.training_job_id]),T=f.useMemo(()=>Ad(Gg(a==null?void 0:a.splits)),[a==null?void 0:a.splits]),j=f.useMemo(()=>T.length?T:i2,[T]);f.useEffect(()=>{d&&i(be=>{const Pe=be??{},G=Ad(Gg(Pe.splits)),ke=G.filter(Ge=>d[Ge]!==!1);if(ke.length===G.length&&ke.every((Ge,ft)=>Ge===G[ft]))return be;const Ae={...Pe};return ke.length?Ae.splits=ke:delete Ae.splits,Ae})},[d,i]);const O=f.useMemo(()=>d?j.filter(be=>d[be]!==!1):j,[d,j]),A=f.useMemo(()=>d?Hf.filter(be=>d[be.value]===!1).map(be=>be.label):[],[d]),z=f.useMemo(()=>{if(!A.length)return"";if(A.length===1)return A[0];if(A.length===2)return`${A[0]} and ${A[1]}`;const be=A[A.length-1];return`${A.slice(0,-1).join(", ")}, and ${be}`},[A]),$=O.length>0,q=Xg(a==null?void 0:a.include_confusion,!0),V=Xg(a==null?void 0:a.include_curves,!0),R=Xg(a==null?void 0:a.include_residuals,!0),ee=hw(a==null?void 0:a.max_curve_points,500),le=hw(a==null?void 0:a.max_scatter_points,750),D=typeof(a==null?void 0:a.last_evaluated_at)=="string"?a.last_evaluated_at:null,[X,Y]=f.useState(null),[K,U]=f.useState("details"),te=f.useRef(!1);f.useEffect(()=>{Y(null),te.current=!1},[P]),f.useEffect(()=>{U("details")},[X==null?void 0:X.job_id]);const W=f.useMemo(()=>["feature-canvas","model-evaluation",t??"none",x??"pending",w],[x,t,w]),I=Ar({queryKey:W,queryFn:async()=>{const be={datasetSourceId:t||void 0,limit:50},Pe=new Map,G=[];let ke=null;const Ae=ve=>{Array.isArray(ve)&&ve.forEach(xe=>{xe&&!Pe.has(xe.id)&&Pe.set(xe.id,xe)})},Ge=async ve=>{try{const xe=await gd(ve);return Ae(xe==null?void 0:xe.jobs),xe}catch(xe){return xe instanceof Error&&G.push(xe),null}};if(x&&await Ge({...be,pipelineId:x}),y.length&&await Promise.all(y.map(ve=>Ge({...be,nodeId:ve}))),ke=await Ge(be),!Pe.size){if(ke)return ke;if(G.length)throw G[0];return{jobs:[],total:0}}const ft=Array.from(Pe.values());ft.sort((ve,xe)=>pw(xe.updated_at??xe.created_at)-pw(ve.updated_at??ve.created_at));const zt=(ke==null?void 0:ke.total)??ft.length;return{jobs:ft,total:zt}},enabled:!!t,staleTime:30*1e3,retry:(be,Pe)=>Pe.message.includes("Sign in")?!1:be<2,refetchInterval:be=>{const Pe=be.state.data;return((Pe==null?void 0:Pe.jobs)??[]).some(Ae=>Ae.status==="queued"||Ae.status==="running")?5e3:!1}}),Q=((it=I.data)==null?void 0:it.jobs)??[],me=f.useMemo(()=>{const be=new Map;return Q.forEach(Pe=>{be.set(Pe.id,Pe)}),be},[Q]),J=f.useMemo(()=>Q.filter(be=>be.status==="succeeded"),[Q]),H=f.useMemo(()=>J.map(be=>({value:be.id,label:u2(be)})),[J]),Z=P?me.get(P)??null:null,ne=Ar({queryKey:["feature-canvas","training-job",P||"none"],queryFn:()=>kx(P),enabled:!!P,staleTime:30*1e3});f.useEffect(()=>{var ve,xe;const be=ne.data;if(!be)return;const Pe=(ve=be.metrics)==null?void 0:ve.evaluation;if(!Pe||typeof Pe!="object")return;const G=Pe.splits;if(!G||typeof G!="object")return;const ke={};Object.entries(G).forEach(([Se,$e])=>{$e&&typeof $e=="object"&&(ke[Se]=$e)});const Ae=typeof Pe.generated_at=="string"?Pe.generated_at:D??be.updated_at??be.created_at??new Date().toISOString(),Ge=Pe.problem_type==="regression"?"regression":"classification",ft={job_id:be.id,pipeline_id:be.pipeline_id,node_id:be.node_id,generated_at:Ae,problem_type:Ge,target_column:Pe.target_column??((xe=be.metadata)==null?void 0:xe.target_column)??null,splits:ke};Y(ft),Ae&&Ae!==D&&i(Se=>({...Se??{},last_evaluated_at:Ae}));const zt=Ad(Object.keys(ke));zt.length&&!te.current&&!l2(T,zt)&&i(Se=>({...Se??{},splits:zt}))},[ne.data,D,i,T]);const fe=Xm({mutationFn:async be=>{if(!P)throw new Error("Select a training job before running evaluation.");return Mx(P,be)},onSuccess:be=>{Y(be),i(Pe=>({...Pe??{},training_job_id:P,splits:be.splits?Object.keys(be.splits):O,include_confusion:q,include_curves:V,include_residuals:R,max_curve_points:ee,max_scatter_points:le,last_evaluated_at:be.generated_at})),p.invalidateQueries({queryKey:["feature-canvas","training-job",P]})}}),ae=f.useCallback(be=>{const Pe=be.target.value;fe.reset(),i(G=>{const ke={...G??{}};return Pe?ke.training_job_id=Pe:delete ke.training_job_id,ke})},[fe,i]),pe=f.useCallback(be=>{d&&d[be]===!1||(fe.reset(),te.current=!0,i(Pe=>{const G=Ad(Gg(Pe==null?void 0:Pe.splits)),ke=G.includes(be);let Ae;if(ke){if(G.length<=1)return Pe??{};Ae=G.filter(Ge=>Ge!==be)}else Ae=Ad([...G,be]);return{...Pe??{},splits:Ae}}))},[d,fe,i]),Ve=f.useCallback((be,Pe)=>{fe.reset(),i(G=>({...G??{},[be]:Pe}))},[fe,i]),st=f.useCallback(()=>{if(!P)return;const be={splits:O,include_confusion:q,include_curves:V,include_residuals:R,max_curve_points:V?ee:void 0,max_scatter_points:R?le:void 0};fe.mutate(be)},[fe,q,V,R,ee,le,P,O]),Ke=X?Cs(X.generated_at):D?Cs(D):null,mt=f.useMemo(()=>X?Object.entries(X.splits).sort((be,Pe)=>{const[G]=be,[ke]=Pe,Ae=Vf[G]??99,Ge=Vf[ke]??99;return Ae-Ge}):[],[X]),yt=f.useMemo(()=>{if(!X||!mt.length)return null;const be=mt.map(([G,ke])=>{const Ae=_w(ke.metrics).reduce((Ge,ft)=>(Ge[ft.key]=ft.value,Ge),{});return{key:G,label:gw(G),rowCount:typeof ke.row_count=="number"?ke.row_count:null,metrics:Ae}}),Pe=Array.from(new Set(be.flatMap(G=>Object.keys(G.metrics)))).sort((G,ke)=>G.localeCompare(ke));return{splits:be,metricKeys:Pe}},[mt,X]),Te=f.useMemo(()=>yt?yt.splits.length<=1?"Connect at least two splits to compare results.":yt.metricKeys.length?null:"No numeric metrics available for comparison yet.":"Run an evaluation to compare metrics.",[yt]);f.useEffect(()=>{K==="comparison"&&Te&&U("details")},[K,Te]);const at=f.useCallback(be=>{be==="comparison"&&Te||U(be)},[Te]);return r.jsxs("div",{className:"node-settings__section node-settings__evaluation",children:[r.jsxs("div",{className:"node-settings__section-header",children:[r.jsx("h3",{children:"Model Evaluation"}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[Ke&&r.jsxs("span",{className:"evaluation-status",children:["Last ran ",Ke]}),m&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:v,disabled:!v,title:"Reset evaluation node to defaults",children:"Reset node"})]})]}),r.jsxs("div",{className:"evaluation-controls",children:[r.jsxs("label",{className:"evaluation-control",children:[r.jsx("span",{className:"evaluation-control__label",children:"Training job"}),r.jsxs("select",{className:"evaluation-control__select",value:P,onChange:ae,disabled:I.isLoading||I.isFetching,children:[r.jsx("option",{value:"",children:"Select a trained model"}),H.map(be=>r.jsx("option",{value:be.value,children:be.label},be.value))]}),I.isLoading&&r.jsx("span",{className:"evaluation-hint",children:"Loading training jobs"}),I.error&&r.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:I.error.message}),!I.isLoading&&!H.length&&r.jsx("span",{className:"evaluation-hint",children:"No successful training jobs detected yet."}),k&&r.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:k})]}),r.jsxs("div",{className:"evaluation-control",children:[r.jsx("span",{className:"evaluation-control__label",children:"Dataset splits"}),r.jsx("div",{className:"evaluation-split-toggle",children:Hf.map(be=>{const Pe=d?d[be.value]!==!1:!0,G=Pe&&O.includes(be.value);return r.jsxs("label",{className:`evaluation-chip evaluation-chip--${be.accent} ${G?"evaluation-chip--active":""}`,"aria-disabled":!Pe,title:Pe?void 0:`${be.label} split is not connected`,style:Pe?void 0:{opacity:.45,cursor:"not-allowed",borderStyle:"dashed"},children:[r.jsx("input",{type:"checkbox",checked:G,disabled:!Pe,onChange:()=>pe(be.value)}),r.jsx("span",{children:be.label})]},be.value)})}),A.length>0&&r.jsxs("span",{className:"evaluation-hint evaluation-hint--warning",children:["Connect ",z," split",A.length>1?"s":""," to enable diagnostics."]}),!$&&r.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"No dataset splits are available. Attach a train, validation, or test split to run evaluation."})]}),r.jsxs("div",{className:"evaluation-control evaluation-control--toggles",children:[r.jsxs("label",{className:"evaluation-toggle",children:[r.jsx("input",{type:"checkbox",checked:q,onChange:be=>Ve("include_confusion",be.target.checked)}),r.jsx("span",{children:"Confusion matrix"})]}),r.jsxs("label",{className:"evaluation-toggle",children:[r.jsx("input",{type:"checkbox",checked:V,onChange:be=>Ve("include_curves",be.target.checked)}),r.jsx("span",{children:"ROC / PR curves"})]}),r.jsxs("label",{className:"evaluation-toggle",children:[r.jsx("input",{type:"checkbox",checked:R,onChange:be=>Ve("include_residuals",be.target.checked)}),r.jsx("span",{children:"Residual diagnostics"})]})]})]}),r.jsxs("div",{className:"evaluation-actions",children:[r.jsx("button",{type:"button",className:"evaluation-button",onClick:st,disabled:!P||fe.isPending||!$,children:fe.isPending?"Running":"Run evaluation"}),Z&&Z.status!=="succeeded"&&r.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"Selected job is not marked as succeeded; results may be incomplete."}),!$&&r.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"Connect at least one dataset split to run evaluation diagnostics."}),fe.isError&&r.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:fe.error.message}),fe.isSuccess&&X&&r.jsxs("span",{className:"evaluation-hint evaluation-hint--success",children:["Diagnostics generated ",Cs(X.generated_at),"."]}),ne.error&&r.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:ne.error.message})]}),X?r.jsxs("div",{className:"node-settings__evaluation-results",children:[r.jsxs("div",{className:"evaluation-summary",children:[r.jsxs("div",{children:[r.jsx("span",{className:"evaluation-summary__label",children:"Problem type"}),r.jsx("span",{className:"evaluation-summary__value",children:X.problem_type==="regression"?"Regression":"Classification"})]}),X.target_column&&r.jsxs("div",{children:[r.jsx("span",{className:"evaluation-summary__label",children:"Target column"}),r.jsx("span",{className:"evaluation-summary__value",children:X.target_column})]}),r.jsxs("div",{children:[r.jsx("span",{className:"evaluation-summary__label",children:"Evaluation time"}),r.jsx("span",{className:"evaluation-summary__value",children:Cs(X.generated_at)??X.generated_at})]})]}),r.jsxs("div",{className:"evaluation-tabs",role:"tablist","aria-label":"Evaluation views",children:[r.jsx("button",{type:"button",className:`evaluation-tab ${K==="details"?"evaluation-tab--active":""}`,role:"tab","aria-selected":K==="details",onClick:()=>at("details"),children:"Split details"}),r.jsx("button",{type:"button",className:`evaluation-tab ${K==="comparison"?"evaluation-tab--active":""}`,role:"tab","aria-selected":K==="comparison","aria-disabled":!!Te,disabled:!!Te,title:Te??void 0,onClick:()=>at("comparison"),children:"Split comparison"})]}),K==="comparison"&&yt?r.jsx(m2,{comparison:yt,formatMetricValue:u}):mt.map(([be,Pe])=>r.jsx(f2,{splitKey:be,payload:Pe,problemType:X.problem_type,formatMetricValue:u},be))]}):r.jsx("div",{className:"evaluation-placeholder",children:P?r.jsx("p",{children:"Run the evaluation to generate metrics and diagnostics for the selected model."}):r.jsx("p",{children:"Select a completed training job to enable the evaluation workflow."})})]})},m2=({comparison:e,formatMetricValue:t})=>e.metricKeys.length?r.jsx("section",{className:"evaluation-comparison",children:r.jsx("div",{className:"evaluation-comparison__table-wrapper",children:r.jsxs("table",{className:"evaluation-comparison__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"Metric"}),e.splits.map(n=>r.jsx("th",{children:n.label},n.key))]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{className:"evaluation-comparison__row evaluation-comparison__row--muted",children:[r.jsx("td",{children:"Rows evaluated"}),e.splits.map(n=>r.jsx("td",{children:typeof n.rowCount=="number"?n.rowCount.toLocaleString():""},`${n.key}-rows`))]}),e.metricKeys.map(n=>r.jsxs("tr",{className:"evaluation-comparison__row",children:[r.jsx("td",{children:n}),e.splits.map(a=>r.jsx("td",{children:typeof a.metrics[n]=="number"?t(a.metrics[n]):""},`${a.key}-${n}`))]},n))]})]})})}):r.jsx("div",{className:"evaluation-placeholder",children:r.jsx("p",{children:"No numeric metrics were reported across splits for comparison."})}),f2=({splitKey:e,payload:t,problemType:n,formatMetricValue:a})=>{const i=_w(t.metrics),l=i.length>0,u=Array.isArray(t.notes)?t.notes.filter(Boolean):[];return r.jsxs("section",{className:"evaluation-split",children:[r.jsx("header",{className:"evaluation-split__header",children:r.jsxs("div",{children:[r.jsxs("h4",{children:[gw(e)," split"]}),r.jsxs("span",{className:"evaluation-split__rows",children:[t.row_count," rows"]})]})}),r.jsxs("div",{className:"evaluation-split__content",children:[r.jsxs("div",{className:"evaluation-metrics",children:[r.jsx("h5",{children:"Metrics"}),l?r.jsx("div",{className:"evaluation-metrics__grid",children:i.map(d=>r.jsxs("div",{className:"evaluation-metrics__item",children:[r.jsx("span",{className:"evaluation-metrics__label",children:d.key}),r.jsx("span",{className:"evaluation-metrics__value",children:a(d.value)})]},d.key))}):r.jsx("p",{className:"evaluation-hint",children:"No numeric metrics reported for this split."})]}),n==="classification"&&t.confusion_matrix&&r.jsx(h2,{matrix:t.confusion_matrix,formatMetricValue:a}),n==="classification"&&t.roc_curves.length>0&&r.jsxs("div",{className:"evaluation-curves",children:[t.roc_curves.map(d=>r.jsx(p2,{curve:d,formatMetricValue:a},`roc-${d.label}`)),t.pr_curves.map(d=>r.jsx(g2,{curve:d,formatMetricValue:a},`pr-${d.label}`))]}),n==="regression"&&t.residuals&&r.jsx(v2,{residuals:t.residuals,formatMetricValue:a})]}),u.length>0&&r.jsx("ul",{className:"evaluation-notes",children:u.map((d,m)=>r.jsx("li",{children:d},`${e}-note-${m}`))})]})},h2=({matrix:e,formatMetricValue:t})=>{const n=Array.isArray(e.labels)?e.labels:[],a=Array.isArray(e.totals)?e.totals:[],i=Array.isArray(e.normalized)?e.normalized:[],l=typeof e.accuracy=="number"?e.accuracy:null;return r.jsxs("div",{className:"evaluation-confusion",children:[r.jsx("h5",{children:"Confusion matrix"}),l!==null&&r.jsxs("span",{className:"evaluation-confusion__accuracy",children:["Accuracy ",vw(l,t)]}),r.jsxs("table",{children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"Actual \\ Predicted"}),n.map((u,d)=>r.jsx("th",{children:u},`pred-${d}`)),r.jsx("th",{children:"Total"})]})}),r.jsx("tbody",{children:e.matrix.map((u,d)=>{const m=i[d]??[],v=a[d]??u.reduce((p,_)=>p+_,0);return r.jsxs("tr",{children:[r.jsx("th",{children:n[d]??`Class ${d}`}),u.map((p,_)=>{const y=typeof m[_]=="number"?m[_]:null;return r.jsxs("td",{children:[r.jsx("span",{className:"evaluation-confusion__count",children:p}),y!==null&&r.jsx("span",{className:"evaluation-confusion__percentage",children:vw(y,t)})]},`cell-${d}-${_}`)}),r.jsx("td",{children:v})]},`row-${d}`)})})]})]})},p2=({curve:e,formatMetricValue:t})=>{if(!Array.isArray(e.fpr)||!Array.isArray(e.tpr)||!e.fpr.length||e.fpr.length!==e.tpr.length)return null;const n=240,a=240,i=28,l=n-i*2,u=a-i*2,d=e.fpr.map((m,v)=>{const p=i+Wf(m)*l,_=a-i-Wf(e.tpr[v])*u;return`${v===0?"M":"L"}${p} ${_}`}).join(" ");return r.jsxs("div",{className:"evaluation-chart",children:[r.jsxs("svg",{viewBox:`0 0 ${n} ${a}`,role:"img","aria-label":`ROC curve for ${e.label}`,children:[r.jsx("rect",{x:i,y:i,width:l,height:u,className:"evaluation-chart__frame"}),r.jsx("line",{x1:i,y1:a-i,x2:n-i,y2:i,className:"evaluation-curve__baseline"}),r.jsx("line",{x1:i,y1:i,x2:i,y2:a-i,className:"evaluation-chart__axis"}),r.jsx("line",{x1:i,y1:a-i,x2:n-i,y2:a-i,className:"evaluation-chart__axis"}),r.jsx("path",{d,className:"evaluation-curve__path"}),r.jsx("text",{x:n/2,y:a-4,className:"evaluation-chart__tick",textAnchor:"middle",children:"False positive rate"}),r.jsx("text",{x:-120,y:12,transform:"rotate(-90)",className:"evaluation-chart__tick",textAnchor:"middle",children:"True positive rate"})]}),r.jsxs("div",{className:"evaluation-chart__caption",children:[r.jsx("span",{children:e.label}),typeof e.auc=="number"&&r.jsxs("span",{children:["AUC ",t(e.auc)]})]})]})},g2=({curve:e,formatMetricValue:t})=>{if(!Array.isArray(e.recall)||!Array.isArray(e.precision)||!e.recall.length||e.recall.length!==e.precision.length)return null;const n=240,a=240,i=28,l=n-i*2,u=a-i*2,d=e.recall.map((m,v)=>{const p=i+Wf(m)*l,_=a-i-Wf(e.precision[v])*u;return`${v===0?"M":"L"}${p} ${_}`}).join(" ");return r.jsxs("div",{className:"evaluation-chart",children:[r.jsxs("svg",{viewBox:`0 0 ${n} ${a}`,role:"img","aria-label":`Precision/recall for ${e.label}`,children:[r.jsx("rect",{x:i,y:i,width:l,height:u,className:"evaluation-chart__frame"}),r.jsx("line",{x1:i,y1:i,x2:i,y2:a-i,className:"evaluation-chart__axis"}),r.jsx("line",{x1:i,y1:a-i,x2:n-i,y2:a-i,className:"evaluation-chart__axis"}),r.jsx("path",{d,className:"evaluation-curve__path"}),r.jsx("text",{x:n/2,y:a-4,className:"evaluation-chart__tick",textAnchor:"middle",children:"Recall"}),r.jsx("text",{x:-120,y:12,transform:"rotate(-90)",className:"evaluation-chart__tick",textAnchor:"middle",children:"Precision"})]}),r.jsxs("div",{className:"evaluation-chart__caption",children:[r.jsx("span",{children:e.label}),typeof e.average_precision=="number"&&r.jsxs("span",{children:["AP ",t(e.average_precision)]})]})]})},_2={residual_min:"Residual min",residual_max:"Residual max",residual_mean:"Residual mean",residual_std:"Residual std"},v2=({residuals:e,formatMetricValue:t})=>{const n=Object.entries(e.summary??{}).filter(a=>typeof a[1]=="number"&&Number.isFinite(a[1]));return r.jsxs("div",{className:"evaluation-regression",children:[r.jsx("h5",{children:"Residual analysis"}),n.length>0&&r.jsx("div",{className:"evaluation-summary evaluation-summary--compact",children:n.map(([a,i])=>r.jsxs("div",{children:[r.jsx("span",{className:"evaluation-summary__label",children:_2[a]??a}),r.jsx("span",{className:"evaluation-summary__value",children:t(i)})]},a))}),r.jsx(y2,{histogram:e.histogram}),e.scatter&&e.scatter.length>0&&r.jsx(b2,{points:e.scatter})]})},y2=({histogram:e})=>{const t=Array.isArray(e.counts)?e.counts:[],n=Array.isArray(e.bin_edges)?e.bin_edges:[];if(!t.length||n.length!==t.length+1)return null;const a=t.reduce((i,l)=>Math.max(i,l),0)||1;return r.jsx("div",{className:"evaluation-histogram","aria-label":"Residual histogram",children:t.map((i,l)=>{const u=i/a*100;return r.jsx("div",{className:"evaluation-histogram__bin",title:`${i} rows`,children:r.jsx("div",{className:"evaluation-histogram__bar",style:{height:`${u}%`}})},`bin-${l}`)})})},b2=({points:e})=>{if(!Array.isArray(e)||!e.length)return null;const t=320,n=260,a=36,i=e.map(y=>y.actual),l=e.map(y=>y.predicted),u=Math.min(...i,...l),d=Math.max(...i,...l),m=d-u||1,v=y=>(y-u)/m,p=y=>a+v(y)*(t-a*2),_=y=>n-a-v(y)*(n-a*2);return r.jsx("div",{className:"evaluation-scatter","aria-label":"Actual vs predicted scatter",children:r.jsxs("svg",{viewBox:`0 0 ${t} ${n}`,children:[r.jsx("rect",{x:a,y:a,width:t-a*2,height:n-a*2,className:"evaluation-chart__frame"}),r.jsx("line",{x1:a,y1:n-a,x2:t-a,y2:n-a,className:"evaluation-chart__axis"}),r.jsx("line",{x1:a,y1:a,x2:a,y2:n-a,className:"evaluation-chart__axis"}),r.jsx("line",{x1:p(u),y1:_(u),x2:p(d),y2:_(d),className:"evaluation-curve__baseline"}),e.map((y,w)=>r.jsx("circle",{cx:p(y.actual),cy:_(y.predicted),r:2.1,className:"evaluation-scatter__point"},`scatter-${w}`))]})})},x2={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},w2={queued:"info",running:"info",succeeded:"success",failed:"danger",cancelled:"neutral"},Lc={classification:["accuracy","f1_weighted","roc_auc","roc_auc_weighted","precision_weighted","recall_weighted","pr_auc","pr_auc_weighted","g_score"],regression:["rmse","mae","r2","mape"],fallback:["rmse","mae","r2","accuracy","f1_weighted","roc_auc"]},yw=["accuracy","f1_weighted","precision_weighted","recall_weighted","roc_auc","roc_auc_weighted"],bw=["rmse","mae","r2","mape"],xw=new Set(["rmse","mae","mape","mse"]),ww={logistic_regression:"Logistic Regression",random_forest_classifier:"Random Forest (Classifier)",random_forest_regressor:"Random Forest (Regressor)",ridge_regression:"Ridge Regression"},Dr=e=>!!e&&typeof e=="object"&&!Array.isArray(e),j2=(e,t)=>{if(e==null)return t;if(typeof e=="boolean")return e;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(["true","1","yes","on","enabled"].includes(n))return!0;if(["false","0","no","off","disabled"].includes(n))return!1}return typeof e=="number"?Number.isFinite(e)?e!==0:t:!!e},Jg=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",N2=e=>{if(!e)return Lc.fallback;const t=String(e.model_type??e.modelType??"").toLowerCase();if(t.includes("regress"))return Lc.regression;if(t.includes("class")||t.includes("classification"))return Lc.classification;const n=String(e.problem_type??e.problemType??"").toLowerCase();return n==="regression"?Lc.regression:n==="classification"?Lc.classification:Lc.fallback},S2=e=>{var i,l,u;if(!Dr(e))return null;const t=[],n=(l=(i=e==null?void 0:e.cross_validation)==null?void 0:i.metrics)==null?void 0:l.mean;Dr(n)&&((u=e==null?void 0:e.cross_validation)==null?void 0:u.status)==="completed"&&t.push({values:n,labelPrefix:"CV mean "}),Dr(e.test)&&t.push({values:e.test,labelPrefix:""}),Dr(e.validation)&&t.push({values:e.validation,labelPrefix:""}),Dr(e.train)&&t.push({values:e.train,labelPrefix:""});const a=N2(e);for(const d of t)for(const m of a){const v=d.values[m];if(typeof v=="number"&&Number.isFinite(v))return{label:d.labelPrefix?`${d.labelPrefix}${m}`:m,value:v}}for(const d of t)for(const[m,v]of Object.entries(d.values))if(typeof v=="number"&&Number.isFinite(v))return{label:d.labelPrefix?`${d.labelPrefix}${m}`:m,value:v};return null},C2=e=>{var n,a;if(!Dr(e))return{label:null,values:{}};if(Dr(e.test))return{label:"Test",values:e.test};if(Dr(e.validation))return{label:"Validation",values:e.validation};const t=(a=(n=e==null?void 0:e.cross_validation)==null?void 0:n.metrics)==null?void 0:a.mean;return Dr(t)?{label:"CV mean",values:t}:Dr(e.train)?{label:"Train",values:e.train}:{label:null,values:{}}},jw=e=>{if(!e)return"Unknown model";const t=e.trim();return ww[t]?ww[t]:t.split("_").filter(Boolean).map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")},E2=e=>{var l,u;const t=e.metadata??{},n=[e.problem_type,t==null?void 0:t.resolved_problem_type,t==null?void 0:t.problem_type];for(const d of n)if(typeof d=="string"){const m=d.trim().toLowerCase();if(m==="classification"||m==="regression")return m}const a=typeof e.model_type=="string"?e.model_type.toLowerCase():"";if(a.includes("classifier")||a.includes("classification"))return"classification";if(a.includes("regress")||a.includes("regression"))return"regression";const i=e.metrics;if(Dr(i)){const d=new Set,m=y=>{Dr(y)&&Object.keys(y).forEach(w=>d.add(w.toLowerCase()))};m(i.test),m(i.validation),m(i.train);const v=(u=(l=i==null?void 0:i.cross_validation)==null?void 0:l.metrics)==null?void 0:u.mean;Dr(v)&&m(v);const p=yw.some(y=>d.has(y)),_=bw.some(y=>d.has(y));if(p&&!_)return"classification";if(_&&!p)return"regression"}return"unknown"},k2=e=>e.map(t=>{const n=t.metrics??null;return{job:t,problemType:E2(t),modelLabel:jw(t.model_type),primaryMetric:S2(n),metricBucket:C2(n)}}),Nw=e=>{if(!e||!Number.isFinite(e.value))return null;const t=e.label.toLowerCase();return xw.has(t)||xw.has(t.replace(/^cv mean\s+/i,""))?-e.value:e.value},M2=({nodeId:e,sourceId:t,graph:n,parameters:a,config:i,renderParameterField:l})=>{var J;const u=f.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),d=f.useMemo(()=>{if(!u)return[];const H=new Map;u.nodes.forEach(fe=>{fe&&fe.id&&H.set(fe.id,fe)});const Z=new Set;return u.edges.forEach(fe=>{var pe;if(!fe||fe.target!==e)return;const ae=H.get(fe.source);((pe=ae==null?void 0:ae.data)==null?void 0:pe.catalogType)==="train_model_draft"&&Z.add(ae.id)}),Z.size>0?Array.from(Z):u.nodes.filter(fe=>{var ae;return((ae=fe==null?void 0:fe.data)==null?void 0:ae.catalogType)==="train_model_draft"}).map(fe=>fe.id)},[u,e]),m=f.useMemo(()=>d.length?d.slice().sort().join("|"):"all",[d]),[v,p]=f.useState(null),[_,y]=f.useState(null);f.useEffect(()=>{let H=!1;return y(null),!t||!u?(p(null),()=>{H=!0}):(al(t,u).then(Z=>{H||p(Z)}).catch(Z=>{H||(y((Z==null?void 0:Z.message)??"Unable to compute pipeline ID"),p(null))}),()=>{H=!0})},[u,t]);const w=j2(i==null?void 0:i.show_non_success,!0),x=f.useMemo(()=>["feature-canvas","model-registry",t??"none",v??"pending",m,w?"all-statuses":"succeeded"],[v,w,t,m]),S=Ar({queryKey:x,queryFn:async()=>{const H={datasetSourceId:t||void 0,limit:50},Z=new Map,ne=[];let fe=null;const ae=Ke=>{!Array.isArray(Ke)||!Ke.length||Ke.forEach(mt=>{mt&&!Z.has(mt.id)&&Z.set(mt.id,mt)})},pe=async Ke=>{try{const mt=await gd(Ke);return ae(mt==null?void 0:mt.jobs),mt}catch(mt){return mt instanceof Error&&ne.push(mt),null}};if(v&&await pe({...H,pipelineId:v}),d.length===1){const[Ke]=d;await pe({...H,nodeId:Ke})}if(fe=await pe(H),!Z.size){if(fe)return fe;if(ne.length)throw ne[0];return{jobs:[],total:0}}const Ve=Array.from(Z.values()),st=(fe==null?void 0:fe.total)??Ve.length;return{jobs:Ve,total:st}},enabled:!!t,staleTime:30*1e3,retry:(H,Z)=>Z.message.includes("Sign in")?!1:H<2,refetchInterval:H=>{const Z=H.state.data;return((Z==null?void 0:Z.jobs)??[]).some(ae=>ae.status==="queued"||ae.status==="running")?5e3:!1}}),k=((J=S.data)==null?void 0:J.jobs)??[],M=f.useMemo(()=>{if(!k.length)return[];if(!d.length)return k;const H=k.filter(Z=>d.includes(Z.node_id));return H.length?H:k},[k,d]),P=f.useMemo(()=>k2(M),[M]),T=f.useMemo(()=>w?P:P.filter(H=>H.job.status==="succeeded"),[P,w]),j=f.useMemo(()=>T.filter(H=>H.problemType==="classification"),[T]),O=f.useMemo(()=>T.filter(H=>H.problemType==="regression"),[T]),A=f.useMemo(()=>!j.length&&!O.length?"classification":j.length?O.length?j.length>=O.length?"classification":"regression":"classification":"regression",[j.length,O.length]),z=typeof(i==null?void 0:i.default_problem_type)=="string"?i.default_problem_type.trim().toLowerCase():"auto",$=z==="classification"||z==="regression"?z:A,[q,V]=f.useState($);f.useEffect(()=>{V($)},[$]);const R=q==="classification"?j:O,ee=f.useMemo(()=>{const H=new Map;return R.forEach(Z=>{const ne=Z.job.model_type,fe=H.get(ne)??{label:Z.modelLabel,count:0};fe.count+=1,H.set(ne,fe)}),Array.from(H.entries()).map(([Z,ne])=>({value:Z,label:ne.label,count:ne.count})).sort((Z,ne)=>Z.label.localeCompare(ne.label))},[R]),le=typeof(i==null?void 0:i.default_method)=="string"?i.default_method.trim().toLowerCase():"",[D,X]=f.useState("all");f.useEffect(()=>{if(!ee.length){X("all");return}const H=ee.find(Z=>Z.value.toLowerCase()===le);X(H?H.value:"all")},[le,ee,q]);const Y=f.useMemo(()=>D==="all"?R:R.filter(H=>H.job.model_type===D),[D,R]),K=f.useMemo(()=>Y.slice().sort((H,Z)=>{if(Z.job.version!==H.job.version)return Z.job.version-H.job.version;const ne=Date.parse(H.job.updated_at??H.job.created_at??"");return Date.parse(Z.job.updated_at??Z.job.created_at??"")-ne}),[Y]),U=f.useMemo(()=>{if(!R.length)return[];const H=new Map;R.forEach(ne=>{const fe=ne.job.model_type,ae=H.get(fe)??[];ae.push(ne),H.set(fe,ae)});const Z=[];return H.forEach((ne,fe)=>{const ae=ne.reduce((pe,Ve)=>{const st=Nw(Ve.primaryMetric);if(st===null)return pe;if(!pe)return Ve;const Ke=Nw(pe.primaryMetric);return Ke===null||st>Ke?Ve:pe},null);Z.push({modelType:fe,label:jw(fe),bestJob:ae})}),Z.sort((ne,fe)=>ne.label.localeCompare(fe.label))},[R]),te=f.useMemo(()=>a.filter(H=>["default_problem_type","show_non_success"].includes(H.name)),[a]),W=q==="classification"?yw:bw,I=S.isLoading||S.isFetching,Q=S.error??null,me=K.length>0;return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Model registry"}),v&&r.jsxs("span",{className:"model-registry__pipeline",children:["Pipeline ID: ",v]})]}),_&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:_}),!d.length&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to a Train model step to populate the registry."}),te.length>0&&r.jsx("div",{className:"canvas-modal__parameter-grid model-registry__parameters",children:te.map(H=>r.jsx(Oe.Fragment,{children:l(H)},H.name))}),r.jsxs("div",{className:"model-registry__toolbar",children:[r.jsx("div",{className:"model-registry__tabs",role:"tablist","aria-label":"Problem type",children:["classification","regression"].map(H=>r.jsxs("button",{type:"button",role:"tab","data-active":q===H,className:"model-registry__tab",onClick:()=>V(H),disabled:H==="classification"&&!j.length||H==="regression"&&!O.length,children:[H==="classification"?"Classification":"Regression",r.jsx("span",{className:"model-registry__tab-count",children:H==="classification"?j.length:O.length})]},H))}),r.jsxs("div",{className:"model-registry__methods","aria-label":"Model template filter",children:[r.jsxs("button",{type:"button",className:"model-registry__method","data-active":D==="all",onClick:()=>X("all"),children:["All methods",r.jsx("span",{className:"model-registry__method-count",children:R.length})]}),ee.map(H=>r.jsxs("button",{type:"button",className:"model-registry__method","data-active":D===H.value,onClick:()=>X(H.value),children:[H.label,r.jsx("span",{className:"model-registry__method-count",children:H.count})]},H.value))]})]}),U.length>0&&r.jsx("div",{className:"model-registry__summary",children:U.map(H=>{const Z=H.bestJob,ne=Z!=null&&Z.primaryMetric?Z.primaryMetric.label:null,fe=Z!=null&&Z.primaryMetric?Jg(Z.primaryMetric.value):"";return r.jsxs("div",{className:"model-registry__summary-card",children:[r.jsx("span",{className:"model-registry__summary-title",children:H.label}),r.jsxs("span",{className:"model-registry__summary-metric",children:[ne||"No metrics",ne&&r.jsx("strong",{children:fe})]}),(Z==null?void 0:Z.job)&&r.jsxs("span",{className:"model-registry__summary-version",children:["v",Z.job.version]})]},H.modelType)})}),I&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading model history"}),Q&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:Q.message}),!I&&!Q&&!me&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No model versions available for the current filters."}),me&&r.jsx("div",{className:"model-registry__table-wrapper",children:r.jsxs("table",{className:"model-registry__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Version"}),r.jsx("th",{scope:"col",children:"Status"}),r.jsx("th",{scope:"col",children:"Model"}),r.jsx("th",{scope:"col",children:"Primary metric"}),W.map(H=>r.jsx("th",{scope:"col",children:H.replace(/_/g," ")},H)),r.jsx("th",{scope:"col",children:"Evaluated"}),r.jsx("th",{scope:"col",children:"Updated"})]})}),r.jsx("tbody",{children:K.map(H=>{const{job:Z,primaryMetric:ne,metricBucket:fe}=H,ae=fe.values||{},pe=fe.label??"",Ve=Z.updated_at??Z.created_at??null;return r.jsxs("tr",{children:[r.jsxs("td",{children:["v",Z.version]}),r.jsx("td",{children:r.jsx("span",{className:`model-registry__status model-registry__status--${w2[Z.status]}`,children:x2[Z.status]})}),r.jsx("td",{children:H.modelLabel}),r.jsx("td",{children:ne?r.jsxs("span",{className:"model-registry__metric",children:[r.jsx("span",{className:"model-registry__metric-label",children:ne.label}),r.jsx("span",{className:"model-registry__metric-value",children:Jg(ne.value)})]}):""}),W.map(st=>{const Ke=ae[st];return r.jsx("td",{children:typeof Ke=="number"&&Number.isFinite(Ke)?Jg(Ke):""},`${Z.id}-${st}`)}),r.jsx("td",{children:pe}),r.jsx("td",{children:Ve?Cs(Ve)??Ve:""})]},Z.id)})})]})})]})},A2={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},cl="__tuning_strategies",ul="__active_tuning_strategy_id",dl="__expanded_tuning_strategy_ids",Zg=["random","grid","halving","optuna"],Kf=(e,t)=>{if(typeof e!="string")return null;const n=e.trim();if(!n.length)return null;const a=n.toLowerCase();if(t&&t.length>0){const l=t.find(u=>u.toLowerCase()===a);if(l)return l}const i=Zg.find(l=>l.toLowerCase()===a);return i||n},ma=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Ds=e=>{try{return JSON.parse(JSON.stringify(e))}catch{return e}},Zo=e=>{if(e==null)return{value:null,error:null};if(typeof e=="string"){const t=e.trim();if(!t.length)return{value:null,error:null};try{const n=JSON.parse(t);return ma(n)?{value:n,error:null}:{value:null,error:"JSON must evaluate to an object."}}catch{return{value:null,error:"Invalid JSON. Provide a valid JSON object."}}}return ma(e)?{value:e,error:null}:{value:null,error:"Provide a JSON object for this field."}},e_=e=>{if(!e)return{value:null,error:null};const t={};return Object.entries(e).forEach(([n,a])=>{if(n){if(Array.isArray(a)){const i=a.filter(l=>l!=null);i.length>0&&(t[n]=i.map(l=>Ds(l)));return}a==null||a===""||(t[n]=[Ds(a)])}}),Object.keys(e).length?Object.keys(t).length===0?{value:null,error:"Search space must list candidate values for at least one hyperparameter."}:{value:t,error:null}:{value:null,error:"Populate the search space with at least one hyperparameter."}},O2=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",P2=new Set(["train","test","validation"]),Sw=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(n=>{if(typeof n=="string"){const a=n.trim().toLowerCase();P2.has(a)&&t.add(a)}}),Array.from(t)},t_=(e,t)=>{if(!e||t.size===0)return{};const n={};return Object.entries(e).forEach(([a,i])=>{t.has(a)&&(n[a]=i)}),n},n_=(e,t)=>{if(!e||t.size===0)return{};const n={};return Object.entries(e).forEach(([a,i])=>{if(t.has(a)){if(Array.isArray(i)){const l=i.map(u=>Ds(u)).filter(u=>u!=null&&u!=="");l.length>0&&(n[a]=l);return}i!=null&&i!==""&&(n[a]=[Ds(i)])}}),n},T2=(e,t)=>{const n=t.split(/[\n,]+/).map(m=>m.trim()).filter(m=>m.length>0);if(n.length===0)return{values:[],error:null};const a=[],i=[],l=Array.isArray(e.options)?new Set(e.options.map(m=>m.value)):null;n.forEach(m=>{if(e.type==="number"){const v=Number(m);Number.isFinite(v)?a.push(v):i.push(m);return}if(e.type==="boolean"){const v=m.toLowerCase();if(["true","1","yes","y"].includes(v)){a.push(!0);return}if(["false","0","no","n"].includes(v)){a.push(!1);return}i.push(m);return}if(e.type==="select"){if(l&&!l.has(m)){i.push(m);return}a.push(m);return}a.push(m)});const u=[],d=new Set;if(a.forEach(m=>{const v=typeof m=="object"?JSON.stringify(m):String(m);d.has(v)||(d.add(v),u.push(m))}),i.length>0){const m=i.slice(0,3).join(", "),v=i.length>3?"":"";return{values:u,error:`Invalid value${i.length>1?"s":""}: ${m}${v}`}}return{values:u,error:null}},Cw=(e,t)=>t==null?"":typeof t=="number"?Number.isFinite(t)?t.toString():"":typeof t=="boolean"?t?"true":"false":e.type==="select"&&typeof t=="string"?t:String(t),Yf=e=>{if(e==null)return"";if(typeof e=="number")return Number.isFinite(e)?e.toString():"";if(typeof e=="boolean")return e?"True":"False";if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}},Qf=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim().length){const t=Number(e);return Number.isFinite(t)?t:null}return null},Od=(e,t,n)=>{let a=e;return typeof t=="number"&&Number.isFinite(t)&&(a=Math.max(a,t)),typeof n=="number"&&Number.isFinite(n)&&(a=Math.min(a,n)),a},$2=(e,t)=>{const n={},a=e.find(m=>(m==null?void 0:m.name)==="solver"),i=e.find(m=>(m==null?void 0:m.name)==="penalty"),l=!!(a&&i&&Array.isArray(a.options)&&a.options.some(m=>(m==null?void 0:m.value)==="liblinear")&&Array.isArray(i.options)&&i.options.some(m=>(m==null?void 0:m.value)==="elasticnet")),u=new Set(["lbfgs","saga"]),d=new Set(["l2","none"]);return e.forEach(m=>{if(!(m!=null&&m.name))return;const v=new Map,p=w=>{if(w==null||typeof w=="number"&&!Number.isFinite(w))return;const x=typeof w=="object"?JSON.stringify(w):`${typeof w}:${String(w)}`;v.has(x)||v.set(x,Ds(w))},_=t==null?void 0:t[m.name];if(l&&m.name==="solver")(Array.isArray(m.options)?m.options:[]).forEach(x=>{x!=null&&x.value&&u.has(String(x.value))&&p(x.value)}),!v.size&&typeof _=="string"&&u.has(_)&&p(_),v.size||u.forEach(x=>p(x));else if(l&&m.name==="penalty")(Array.isArray(m.options)?m.options:[]).forEach(x=>{x!=null&&x.value&&d.has(String(x.value))&&p(x.value)}),!v.size&&typeof _=="string"&&d.has(_)&&p(_),v.size||d.forEach(x=>p(x));else if(m.type==="number"){const w=Qf(_),x=Qf(m.min),S=Qf(m.max);if(x!==null&&p(x),w!==null&&p(Od(w,x,S)),S!==null&&p(S),v.size<=1&&w!==null){const k=Qf(m.step);k!==null&&k>0?(p(Od(w+k,x,S)),p(Od(w-k,x,S))):(p(Od(w*1.5,x,S)),p(Od(w*.5,x,S)))}}else m.type==="boolean"?(p(!0),p(!1),typeof _=="boolean"&&p(_)):(m.type==="select"&&(m.options??[]).slice(0,6).forEach(w=>{(w==null?void 0:w.value)!==void 0&&p(w.value)}),typeof _=="string"&&_.trim().length&&p(_.trim()));const y=Array.from(v.values());y.length>0&&(n[m.name]=y)}),n},L2={classification:[{value:"accuracy",label:"Accuracy"},{value:"balanced_accuracy",label:"Balanced accuracy"},{value:"f1",label:"F1"},{value:"f1_macro",label:"F1 macro"},{value:"f1_weighted",label:"F1 weighted"},{value:"precision",label:"Precision"},{value:"recall",label:"Recall"},{value:"roc_auc",label:"ROC AUC (binary)"},{value:"roc_auc_ovr",label:"ROC AUC (one-vs-rest)"}],regression:[{value:"neg_mean_squared_error",label:"Negative MSE"},{value:"neg_root_mean_squared_error",label:"Negative RMSE"},{value:"neg_mean_absolute_error",label:"Negative MAE"},{value:"neg_median_absolute_error",label:"Negative MedAE"},{value:"r2",label:"R"}]},s_=()=>`strategy-${Math.random().toString(36).slice(2,10)}`,Pd=e=>{if(!ma(e))return{};const t=Ds(e);return ma(t)?(delete t[cl],delete t[ul],delete t[dl],t):{}},Dc=e=>Pd(e),D2=(e,t,n)=>({id:s_(),label:e,config:Dc(t),searchSpaceTexts:n!=null&&n.searchSpaceTexts?{...n.searchSpaceTexts}:{},searchSpaceFieldErrors:n!=null&&n.searchSpaceFieldErrors?{...n.searchSpaceFieldErrors}:{},hasAutoFilledSearchSpace:(n==null?void 0:n.hasAutoFilledSearchSpace)??!1,searchSpaceManuallyCleared:(n==null?void 0:n.searchSpaceManuallyCleared)??!1}),ei=e=>`Strategy ${e}`,Ew=e=>ma(e)?Object.keys(e).filter(t=>typeof e[t]=="string").sort().reduce((t,n)=>(t[n]=String(e[n]),t),{}):{},kw=e=>ma(e)?Object.keys(e).filter(t=>e[t]===null||typeof e[t]=="string").sort().reduce((t,n)=>{const a=e[n];return t[n]=a===null?null:String(a),t},{}):{},z2=e=>{if(!ma(e))return{};const t={};return Object.prototype.hasOwnProperty.call(e,cl)&&(t[cl]=Ds(e[cl])),Object.prototype.hasOwnProperty.call(e,ul)&&(t[ul]=e[ul]),Object.prototype.hasOwnProperty.call(e,dl)&&(t[dl]=Ds(e[dl])),t},R2=()=>({strategies:[],activeId:null,expandedIds:[]}),r_=e=>{var m;const t=R2();if(!ma(e))return t;const n=e[cl];if(Array.isArray(n)){const v=new Set;n.forEach(p=>{if(!ma(p))return;let _=typeof p.id=="string"?p.id.trim():"";(!_||v.has(_))&&(_=s_()),v.add(_);const y=typeof p.label=="string"?p.label.trim():"",w=y.length?y:ei(t.strategies.length+1),x=ma(p.config)?p.config:{},S={id:_,label:w,config:Pd(x),searchSpaceTexts:Ew(p.searchSpaceTexts),searchSpaceFieldErrors:kw(p.searchSpaceFieldErrors),hasAutoFilledSearchSpace:!!p.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:!!p.searchSpaceManuallyCleared};t.strategies.push(S)})}const a=new Set(t.strategies.map(v=>v.id)),i=e[ul],l=typeof i=="string"?i.trim():"";t.activeId=l&&a.has(l)?l:((m=t.strategies[0])==null?void 0:m.id)??null;const u=e[dl],d=Array.isArray(u)?u.map(v=>typeof v=="string"?v.trim():"").filter(v=>!!v&&a.has(v)):[];return t.activeId&&!d.includes(t.activeId)&&d.push(t.activeId),t.expandedIds=Array.from(new Set(d)).sort(),t},Mw=e=>({id:e.id,label:e.label,config:Dc(e.config),searchSpaceTexts:{...e.searchSpaceTexts},searchSpaceFieldErrors:{...e.searchSpaceFieldErrors},hasAutoFilledSearchSpace:e.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:e.searchSpaceManuallyCleared}),F2=(e,t,n)=>{var d;const a=e.map((m,v)=>({id:typeof m.id=="string"&&m.id.trim().length?m.id:s_(),label:typeof m.label=="string"&&m.label.trim().length?m.label:ei(v+1),config:Pd(m.config),searchSpaceTexts:Ew(m.searchSpaceTexts),searchSpaceFieldErrors:kw(m.searchSpaceFieldErrors),hasAutoFilledSearchSpace:!!m.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:!!m.searchSpaceManuallyCleared})),i=new Set(a.map(m=>m.id)),l=typeof t=="string"&&i.has(t)?t:((d=a[0])==null?void 0:d.id)??null,u=Array.from(n??new Set).filter(m=>i.has(m));return l&&!u.includes(l)&&u.push(l),{strategies:a,activeId:l,expandedIds:Array.from(new Set(u)).sort()}},Aw=(e,t)=>{var n;return t&&e.some(a=>a.id===t)?t:((n=e[0])==null?void 0:n.id)??""},Ow=(e,t)=>{const n=new Set(e.map(i=>i.id)),a=t.filter(i=>n.has(i));return!a.length&&e[0]&&a.push(e[0].id),new Set(a)},Gf=e=>Md(e),Pw=(e,t)=>{const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(const i of n)if(e[i]!==t[i])return!1;return!0},I2=({nodeId:e,sourceId:t,graph:n,config:a,runtimeConfig:i,cvConfig:l,draftConfigState:u,renderParameterField:d,modelTypeParameter:m,modelTypeOptions:v,searchStrategyParameter:p,searchIterationsParameter:_,searchRandomStateParameter:y,scoringMetricParameter:w,setDraftConfigState:x,onSaveDraftConfig:S})=>{var va,mi,xo,Ir;const k=gc(),[M,P]=f.useState(null),[T,j]=f.useState(null),[O,A]=f.useState(null),[z,$]=f.useState(0),[q,V]=f.useState(null),[R,ee]=f.useState(!1),[le,D]=f.useState(null),[X,Y]=f.useState(!1),K=((a==null?void 0:a.targetColumn)??"").trim(),U=(a==null?void 0:a.problemType)==="regression"?"regression":"classification",te=(m==null?void 0:m.name)??"model_type",W=(p==null?void 0:p.name)??"search_strategy",I=(_==null?void 0:_.name)??"search_iterations",Q=(y==null?void 0:y.name)??"search_random_state",me=(w==null?void 0:w.name)??"scoring_metric",J=u==null?void 0:u[te],H=typeof J=="string"&&J.trim().length?J.trim():((i==null?void 0:i.modelType)??"").trim(),Z=Ar({queryKey:["model-hyperparameters",H],queryFn:()=>Tf(H),enabled:!!H,staleTime:5*60*1e3}),ne=((va=Z.data)==null?void 0:va.fields)??[],fe=((mi=Z.data)==null?void 0:mi.defaults)??{},ae=f.useMemo(()=>{if(!ne.length)return new Set;const se=new Set;return ne.forEach(Me=>{Me!=null&&Me.name&&se.add(Me.name)}),se},[ne]),pe=!!(l!=null&&l.enabled),Ve=(l==null?void 0:l.strategy)??"auto",st=typeof(l==null?void 0:l.folds)=="number"?l.folds:5,Ke=!!(l!=null&&l.shuffle),mt=(l==null?void 0:l.randomState)??null,yt=f.useMemo(()=>{const se=[];return((p==null?void 0:p.options)??[]).forEach(Me=>{if(!Me||typeof Me.value!="string")return;const Ce=Me.value.trim();if(!Ce.length)return;const Qe=Ce.toLowerCase();se.some(He=>He.toLowerCase()===Qe)||se.push(Ce)}),se},[p]),Te=f.useMemo(()=>yt.length>0?[...yt]:[...Zg],[yt]),at=Kf(p==null?void 0:p.default,yt),be=Kf(u==null?void 0:u[W],yt)??at??Te[0]??Zg[0],Pe=u==null?void 0:u[I];let G=null;if(typeof Pe=="number"&&Number.isFinite(Pe))G=Math.max(1,Math.floor(Pe));else if(typeof Pe=="string"){const se=Number(Pe.trim());Number.isFinite(se)&&se>0&&(G=Math.max(1,Math.floor(se)))}const ke=u==null?void 0:u[Q];let Ae=null;if(typeof ke=="number"&&Number.isFinite(ke))Ae=Math.trunc(ke);else if(typeof ke=="string"){const se=Number(ke.trim());Number.isFinite(se)&&(Ae=Math.trunc(se))}const Ge=typeof(_==null?void 0:_.default)=="number"&&Number.isFinite(_.default)?Math.max(1,Math.floor(_.default)):null,ft=typeof(y==null?void 0:y.default)=="number"&&Number.isFinite(y.default)?Math.trunc(y.default):null,zt=typeof(u==null?void 0:u[me])=="string"?String(u[me]).trim():"",ve=zt.length?zt:null,xe=f.useMemo(()=>Zo(u==null?void 0:u.baseline_hyperparameters),[u==null?void 0:u.baseline_hyperparameters]),Se=f.useMemo(()=>Zo(u==null?void 0:u.search_space),[u==null?void 0:u.search_space]),$e=f.useMemo(()=>e_(Se.value),[Se.value]),Ye=xe.value,Ue=xe.error,Ze=$e.value,Nt=Se.error??$e.error,Et=f.useMemo(()=>t_(Ye,ae),[ae,Ye]),qt=f.useMemo(()=>n_(Ze,ae),[ae,Ze]),Ht=f.useMemo(()=>Object.keys(Et).length,[Et]),Pt=f.useMemo(()=>Object.keys(qt).length,[qt]),pt=Pt>0,[Jt,Gt]=f.useState({}),[Ct,Dn]=f.useState({}),[wn,pn]=f.useState(!1),[Tt,hs]=f.useState(!1),sn=f.useRef(null);if(!sn.current){const se=r_(u);let Qe=se.strategies.length>0?se.strategies.map(Mw):[];const He=Aw(Qe,se.activeId),Re=Ow(Qe,se.expandedIds);He&&!Re.has(He)&&Qe.length&&Re.add(He);const St=Gf(se);sn.current={strategies:Qe,activeId:He,expanded:Re,signature:St}}const[ht,_t]=f.useState(()=>sn.current?sn.current.strategies:[]),[zn,Gn]=f.useState(()=>new Set(sn.current?Array.from(sn.current.expanded):[])),[ps,Xn]=f.useState(()=>{var se;return((se=sn.current)==null?void 0:se.activeId)??""}),Es=f.useRef(((xo=sn.current)==null?void 0:xo.signature)??""),Jn=f.useRef(null),dr=f.useRef(null),bn=f.useMemo(()=>ht.length?ht.find(Me=>Me.id===ps)??ht[0]:null,[ps,ht]),zs=f.useMemo(()=>r_(u),[u]),ks=f.useMemo(()=>Gf(zs),[zs]);f.useEffect(()=>{if(ks===Es.current)return;const se=zs.strategies.length?zs.strategies.map(Mw):[],Me=Aw(se,zs.activeId),Ce=Ow(se,zs.expandedIds);Me&&!Ce.has(Me)&&se.length&&Ce.add(Me),Jn.current=null,_t(se),Xn(Me),Gn(Ce),Es.current=ks},[ks,zs,u]),f.useEffect(()=>{if(!ht.length)return;ht.some(Me=>Me.id===ps)||Xn(ht[0].id)},[ps,ht]),f.useEffect(()=>{const se=F2(ht,ps,zn),Me=Gf(se);Es.current!==Me&&x(Ce=>{const Qe=r_(Ce),He=Gf(Qe);if(He===Me)return Es.current=He,Ce??{};const Re=Ce?{...Ce}:{};return se.strategies.length?Re[cl]=se.strategies.map(St=>({...St,config:Ds(St.config),searchSpaceTexts:{...St.searchSpaceTexts},searchSpaceFieldErrors:{...St.searchSpaceFieldErrors}})):delete Re[cl],se.activeId?Re[ul]=se.activeId:delete Re[ul],se.expandedIds.length?Re[dl]=[...se.expandedIds]:delete Re[dl],Es.current=Me,Re})},[ps,zn,x,ht]),f.useEffect(()=>{if(!bn||Jn.current===bn.id)return;Jn.current=bn.id;const se=Dc(bn.config);x(Ce=>({...z2(Ce),...se})),Gt(bn.searchSpaceTexts??{}),Dn(bn.searchSpaceFieldErrors??{}),pn(bn.hasAutoFilledSearchSpace??!1),hs(bn.searchSpaceManuallyCleared??!1);const Me=typeof(se==null?void 0:se[te])=="string"?String(se[te]):(i==null?void 0:i.modelType)??"";dr.current=Me},[bn,te,i==null?void 0:i.modelType,x]),f.useEffect(()=>{if(!bn)return;const se=Dc(u),Me=JSON.stringify(se)!==JSON.stringify(bn.config??{}),Ce=!Pw(Jt,bn.searchSpaceTexts),Qe=!Pw(Ct,bn.searchSpaceFieldErrors),He=bn.hasAutoFilledSearchSpace!==wn,Re=bn.searchSpaceManuallyCleared!==Tt;!Me&&!Ce&&!Qe&&!He&&!Re||_t(St=>St.map(ot=>ot.id!==bn.id?ot:{...ot,config:se,searchSpaceTexts:{...Jt},searchSpaceFieldErrors:{...Ct},hasAutoFilledSearchSpace:wn,searchSpaceManuallyCleared:Tt}))},[bn,u,wn,Ct,Tt,Jt]);const gs=f.useCallback(()=>{const se=ht.length+1,Me=Dc(u),Ce=new Set;ht.forEach(ot=>{var Mt;const Dt=Kf((Mt=ot.config)==null?void 0:Mt[W],Te);Dt&&Ce.add(Dt)});const Qe=Te.find(ot=>!Ce.has(ot))??be,He=Ds(Me),Re=ma(He)?He:{};if(Re[W]=Qe,Qe==="random"||Qe==="optuna"){const ot=G!==null?G:Ge;ot!==null?Re[I]=ot:delete Re[I];const Dt=Ae!==null?Ae:ft;Dt!==null?Re[Q]=Dt:delete Re[Q]}else delete Re[I],delete Re[Q];const St=D2(ei(se),Re,{searchSpaceTexts:{...Jt},searchSpaceFieldErrors:{},hasAutoFilledSearchSpace:wn,searchSpaceManuallyCleared:Tt});_t(ot=>[...ot,St]),Gn(ot=>new Set([...ot,St.id])),Jn.current=null,Xn(St.id)},[Te,u,wn,G,Ge,Ae,ft,Tt,Jt,be,W,I,Q,_t,Xn,Gn,ht]),Ba=f.useCallback(se=>{Gn(Me=>{const Ce=new Set(Me);return Ce.has(se)?Ce.delete(se):Ce.add(se),Ce})},[]),Xs=f.useCallback(se=>{!se||se===ps||(Jn.current=null,Xn(se),Gn(Me=>{const Ce=new Set(Me);return Ce.add(se),Ce}))},[ps]),pa=f.useCallback(se=>{let Me=null;_t(Ce=>{if(Ce.length<=1)return Ce;const Qe=Ce.filter(Re=>Re.id!==se);if(!Qe.length)return Ce;const He=Qe.map((Re,St)=>({...Re,label:ei(St+1)}));if(se===ps){Jn.current=null;const Re=He[0].id;Me=Re,Xn(Re)}return He}),Gn(Ce=>{const Qe=new Set(Ce);return Qe.delete(se),Me&&Qe.add(Me),Qe})},[ps]),zr=f.useMemo(()=>ht.map((se,Me)=>{var qa,Jr;const Ce=se.config??{},Qe=Ce==null?void 0:Ce[te],He=typeof Qe=="string"?Qe.trim():"",Re=((qa=v.find(Os=>Os.value===He))==null?void 0:qa.label)??He,St=Ce==null?void 0:Ce[W],ot=typeof St=="string"?St.trim():"",Dt=(Jr=((p==null?void 0:p.options)??[]).find(Os=>Os.value===ot))==null?void 0:Jr.label,Mt=Ce==null?void 0:Ce[me],bt=typeof Mt=="string"?Mt.trim():"",ls=Zo(Ce==null?void 0:Ce.baseline_hyperparameters).error,_n=Zo(Ce==null?void 0:Ce.search_space),es=e_(_n.value),fr=es.value?Object.keys(es.value).length:0,hr=es.value?Object.values(es.value).reduce((Os,Zs)=>Os+(Array.isArray(Zs)?Zs.length:0),0):0,Br=ls!==null||Object.values(se.searchSpaceFieldErrors).some(Os=>!!Os);return{id:se.id,label:se.label||ei(Me+1),modelLabel:Re||"Select model",searchStrategyLabel:Dt??(ot||"Random search"),scoringLabel:bt||"Estimator default",parameterCount:fr,candidateCount:hr,hasErrors:Br}}),[v,te,me,p,W,ht]);f.useEffect(()=>{const se=dr.current;if(se===null){dr.current=H;return}se!==H&&(dr.current=H,Gt({}),Dn({}),pn(!1),hs(!1))},[H]),f.useEffect(()=>{!H||!ne.length||Gt(se=>{const Me={...se};let Ce=!1;return ne.forEach(Qe=>{if(Ct[Qe.name])return;const He=qt[Qe.name],Re=Array.isArray(He)&&He.length>0?He.map(St=>Cw(Qe,St)).join(", "):"";Me[Qe.name]!==Re&&(Me[Qe.name]=Re,Ce=!0)}),Ce?Me:se})},[qt,ne,H,Ct]),f.useEffect(()=>{if(!H||!ne.length||Tt)return;if(pt){wn||pn(!0);return}if(wn)return;const se=$2(ne,fe);Object.keys(se).length&&(pn(!0),Dn({}),Gt(()=>{const Me={};return ne.forEach(Ce=>{if(!se[Ce.name])return;const Qe=se[Ce.name].map(He=>Cw(Ce,He)).filter(He=>He.length>0).join(", ");Me[Ce.name]=Qe}),Me}),x(Me=>{const Ce=Me?{...Me}:{};return Ce.search_space=se,Ce}))},[wn,fe,ne,H,pt,Tt,x]);const[Rr,ga]=f.useState(ve??"");f.useEffect(()=>{ga(ve??"")},[ve]);const Js=f.useMemo(()=>L2[U==="regression"?"regression":"classification"],[U]),bo=(w==null?void 0:w.label)??"Scoring metric",Ua=(w==null?void 0:w.description)??"Pick the evaluation metric used to rank candidates.",fn=f.useMemo(()=>`tuning-${e}-scoring-metric`,[e]),Xr=f.useMemo(()=>Object.values(Ct).some(se=>!!se),[Ct]),_s=f.useCallback((se,Me)=>{ae.has(se)&&x(Ce=>{const Qe={...Ce},He=Zo(Ce==null?void 0:Ce.baseline_hyperparameters).value??{},St={...t_(He,ae)};return Me===void 0?delete St[se]:St[se]=Me,Object.keys(St).length>0?Qe.baseline_hyperparameters=St:delete Qe.baseline_hyperparameters,Qe})},[ae,x]),Fr=f.useCallback((se,Me)=>{Gt(He=>({...He,[se.name]:Me}));const{values:Ce,error:Qe}=T2(se,Me);Dn(He=>({...He,[se.name]:Qe})),!Qe&&x(He=>{const Re={...He},St=Zo(He==null?void 0:He.search_space).value??{},Dt={...n_(St,ae)};return Ce.length>0?Dt[se.name]=Ce.map(Mt=>Ds(Mt)):delete Dt[se.name],Object.keys(Dt).length>0?Re.search_space=Dt:delete Re.search_space,Re})},[ae,x]),Rs=f.useCallback(se=>{_s(se,void 0)},[_s]),_a=f.useCallback(()=>{x(se=>{if(!se||!se.baseline_hyperparameters)return se??{};const Me={...se};return delete Me.baseline_hyperparameters,Me})},[x]),_e=f.useCallback(()=>{hs(!0),pn(!0),Gt({}),Dn({}),x(se=>{if(!se||!se.search_space)return se??{};const Me={...se};return delete Me.search_space,Me})},[x]),De=f.useCallback(se=>{ga(se);const Me=se.trim();x(Ce=>{const Qe={...Ce};return Me.length>0?Qe.scoring_metric=Me:delete Qe.scoring_metric,Qe})},[x]),et=f.useCallback(se=>{if(!(se!=null&&se.name)||!ae.has(se.name))return null;const Me=`baseline-${e}-${se.name}`,Ce=Et[se.name],Qe=Ce!==void 0,He=fe==null?void 0:fe[se.name],Re=se.label??se.name,St=se.description,ot=He!==void 0?`Default: ${Yf(He)}`:"Default: estimator setting";let Dt;if(se.type==="number"){const Mt=typeof Ce=="number"?String(Ce):"";Dt=r.jsx("input",{id:Me,type:"number",className:"canvas-modal__parameter-input",value:Mt,onChange:bt=>{const Wt=bt.target.value;if(!Wt.length){Rs(se.name);return}const ls=Number(Wt);Number.isFinite(ls)&&_s(se.name,ls)},min:se.min,max:se.max,step:se.step,placeholder:"Leave blank to use default"})}else if(se.type==="select"){const Mt=Qe?String(Ce):"";Dt=r.jsxs("select",{id:Me,className:"canvas-modal__parameter-select",value:Mt,onChange:bt=>{const Wt=bt.target.value;if(!Wt.length){Rs(se.name);return}_s(se.name,Wt)},children:[r.jsx("option",{value:"",children:"Use default"}),(se.options??[]).map(bt=>r.jsx("option",{value:bt.value,children:bt.label},bt.value))]})}else if(se.type==="boolean"){const Mt=Qe?Ce?"true":"false":"";Dt=r.jsxs("select",{id:Me,className:"canvas-modal__parameter-select",value:Mt,onChange:bt=>{const Wt=bt.target.value;if(!Wt.length){Rs(se.name);return}_s(se.name,Wt==="true")},children:[r.jsx("option",{value:"",children:"Use default"}),r.jsx("option",{value:"true",children:"True"}),r.jsx("option",{value:"false",children:"False"})]})}else{const Mt=typeof Ce=="string"?Ce:"";Dt=r.jsx("input",{id:Me,type:"text",className:"canvas-modal__parameter-input",value:Mt,onChange:bt=>{const Wt=bt.target.value;if(!Wt.length){Rs(se.name);return}_s(se.name,Wt)},placeholder:"Leave blank to use default"})}return r.jsxs("div",{className:"canvas-modal__parameter",children:[r.jsxs("label",{htmlFor:Me,className:"canvas-modal__parameter-label",children:[Re,St&&r.jsx("span",{className:"canvas-modal__parameter-description",children:St})]}),Dt,r.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.4rem",gap:"0.75rem"},children:r.jsx("small",{style:{color:"rgba(148, 163, 184, 0.85)"},children:Qe?`Override: ${Yf(Ce)}`:ot})})]},se.name)},[ae,Et,fe,e,_s]),Yt=f.useCallback(se=>{if(!(se!=null&&se.name)||!ae.has(se.name))return null;const Me=`search-${e}-${se.name}`,Ce=Jt[se.name]??"",Qe=qt[se.name],He=Array.isArray(Qe)?Qe.length:0,Re=Ct[se.name],St=fe==null?void 0:fe[se.name],ot=se.type==="number"?"Comma or newline separated numbers (e.g. 0.01, 0.1, 1)":se.type==="boolean"?"Enter true/false values, separated by commas or new lines":se.type==="select"?"Comma or newline separated option values":"Comma or newline separated values",Dt=Array.isArray(Qe)?Qe.slice(0,3).map(Mt=>Yf(Mt)).join(", "):"";return r.jsxs("div",{className:"canvas-modal__parameter",children:[r.jsxs("label",{htmlFor:Me,className:"canvas-modal__parameter-label",children:[se.label??se.name,se.description&&r.jsx("span",{className:"canvas-modal__parameter-description",children:se.description})]}),r.jsx("textarea",{id:Me,className:"canvas-modal__parameter-input",rows:3,value:Ce,onChange:Mt=>Fr(se,Mt.target.value),placeholder:ot,style:{minHeight:"92px",resize:"vertical"}}),r.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.4rem",gap:"0.75rem",flexWrap:"wrap"},children:r.jsx("small",{style:{color:"rgba(148, 163, 184, 0.85)"},children:He>0?`Configured ${He} value${He===1?"":"s"}${Dt?` (${Dt}${He>3?"":""})`:""}`:`Default: ${Yf(St)}`})}),Re&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.5rem"},children:Re})]},se.name)},[ae,qt,Fr,fe,e,Ct,Jt]),Be=f.useMemo(()=>{if(!pt)return{parameterCount:0,candidateProduct:null};const se=Object.values(qt),Me=se.length;let Ce=null;if(se.length>0){let Qe=1,He=!1;se.forEach(Re=>{Qe*=Math.max(Re.length,1),(!Number.isFinite(Qe)||Qe>1e6)&&(He=!0)}),Ce=He?null:Qe}return{parameterCount:Me,candidateProduct:Ce}},[qt,pt]),kt=f.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),$t=f.useCallback(se=>{if(!kt)return null;const Me=Ds(kt);if(!Me||!Array.isArray(Me.nodes))return kt;const Ce=Pd(se),Qe=Object.keys(Ce).length>0;return Me.nodes=Me.nodes.map(He=>{if(!He||He.id!==e)return He;const Re=(He==null?void 0:He.data)??{},St=(Re==null?void 0:Re.config)??{},ot=Pd(St),Dt=Qe?{...ot,...Ce}:ot;return{...He,data:{...Re,config:Dt,isConfigured:!0}}}),Me},[kt,e]),rn=f.useMemo(()=>{const se=$t(u);return se||kt},[u,kt,$t]),Zt=f.useMemo(()=>{if(!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges))return null;const se=n.nodes,Me=n.edges;return(()=>{var St;const Re=se.find(ot=>(ot==null?void 0:ot.id)===e);return Re?Sw((St=Re==null?void 0:Re.data)==null?void 0:St.connectedSplits):[]})().includes("validation")||Me.some(Re=>!Re||(typeof Re.target=="string"?Re.target:null)!==e?!1:(typeof Re.sourceHandle=="string"?Re.sourceHandle.toLowerCase():"").includes("validation"))?!0:Me.some(Re=>{var bt;if(!Re||(typeof Re.target=="string"?Re.target:null)!==e)return!1;const ot=typeof Re.source=="string"?Re.source:null;if(!ot)return!1;const Dt=se.find(Wt=>(Wt==null?void 0:Wt.id)===ot);return Dt?Sw((bt=Dt==null?void 0:Dt.data)==null?void 0:bt.activeSplits).includes("validation"):!1})?!1:null},[n,e]);f.useEffect(()=>{let se=!1;return!t||!kt?(V(null),()=>{se=!0}):(al(t,kt).then(Me=>{se||V(Me)}).catch(()=>{se||V(null)}),()=>{se=!0})},[kt,t]),f.useEffect(()=>{let se=!1;j(null);const Me=rn??kt;return!t||!Me?(P(null),()=>{se=!0}):(al(t,Me).then(Ce=>{se||P(Ce)}).catch(Ce=>{se||(j((Ce==null?void 0:Ce.message)??"Unable to compute pipeline ID"),P(null))}),()=>{se=!0})},[kt,rn,t]),f.useEffect(()=>{if(!M||!q){ee(!1);return}ee(M!==q)},[M,q]);const On=!!(t&&e),gn=f.useMemo(()=>["feature-canvas","hyperparameter-tuning-jobs",t??"none",M??"pending",e],[e,M,t]),Rn=Ar({queryKey:gn,queryFn:async()=>{var Me;const se={datasetSourceId:t||void 0,nodeId:e,limit:5};if(M){const Ce=await _d({...se,pipelineId:M});if((((Me=Ce==null?void 0:Ce.jobs)==null?void 0:Me.length)??0)>0)return Ce}return _d(se)},enabled:On,retry:(se,Me)=>Me.message.includes("Sign in")?!1:se<2,refetchInterval:se=>{const Me=se.state.data;return((Me==null?void 0:Me.jobs)??[]).some(He=>He.status==="queued"||He.status==="running")?5e3:!1}}),{mutateAsync:mr,isPending:Ms,error:Zn}=Xm({mutationFn:Ax,onSuccess:se=>{const Me=Array.isArray(se.jobs)?se.jobs.length:0,Ce=Me>0?se.jobs[0]:null;A(Ce),$(Me),k.invalidateQueries({queryKey:gn})}}),is=f.useMemo(()=>{const se=[];return t||se.push("Select a dataset before launching tuning jobs."),(!kt||!kt.nodes.length)&&se.push("Connect this node to an upstream pipeline before tuning."),K||se.push("Set a target column before tuning."),Zt===!1&&se.push("Connect the validation split to this node to enable tuning."),H||se.push("Choose a model type before enqueuing tuning jobs."),ht.length===0&&se.push("Add a tuning strategy before launching tuning jobs."),pt||se.push("Define at least one hyperparameter in the search space."),Ue&&se.push(Ue),Nt&&se.push(Nt),Xr&&se.push("Resolve invalid candidate values in the search space."),(be==="random"||be==="optuna")&&!G&&se.push("Provide the maximum iterations for random or Optuna search."),pe&&st<2&&se.push("Cross-validation requires at least 2 folds."),T&&se.push(T),se},[Ue,pe,st,kt,pt,Xr,H,T,G,Nt,be,t,K,Zt,ht.length]),Fs=((Ir=Rn.data)==null?void 0:Ir.jobs)??[],As=Rn.isLoading||Rn.isFetching,di=Rn.error,jl=f.useMemo(()=>!!(Zn instanceof Error&&Pc(Zn.message)||le&&Pc(le)||O&&Ed(O)||Fs.some(se=>Ed(se))),[le,Zn,O,Fs]),Bt=iw({graph:n,nodeId:e,modelType:H,problemType:U,modelTypeOptions:v,enabled:jl});f.useEffect(()=>{Bt||Y(!1)},[Bt]);const Qc=is.length>0||Xr||!M||!t||!kt||ht.length===0||!pt||Ms,Nl=f.useMemo(()=>m?v.length?{...m,options:v}:m:null,[v,m]),Sl=f.useCallback(async()=>{if(!M||!t||!kt||ht.length===0)return;if(S){try{const He=S({closeModal:!1});ee(!1),He&&typeof He.then=="function"&&await He}catch{}await new Promise(He=>setTimeout(He,100))}const se=async()=>{const He=[],Re=[],St=async ot=>{if(!ot)return new Set;if(ot===H)return ae;const Dt=["model-hyperparameters",ot],Mt=k.getQueryData(Dt),bt=Wt=>{const ls=new Set;return(Wt??[]).forEach(_n=>{_n!=null&&_n.name&&ls.add(_n.name)}),ls};if(Mt)return bt(Mt.fields);try{const Wt=await k.fetchQuery({queryKey:Dt,queryFn:()=>Tf(ot)});return bt(Wt==null?void 0:Wt.fields)}catch{return new Set}};for(let ot=0;ot<ht.length;ot+=1){const Dt=ht[ot],Mt=Dt.label||ei(ot+1),bt=Dc(Dt.config),Wt=bt==null?void 0:bt[te],ls=typeof Wt=="string"&&Wt.trim().length?Wt.trim():H;if(!ls){Re.push(`${Mt} is missing a model selection.`);continue}const _n=Kf(bt==null?void 0:bt[W],Te)??at??"random",es=await St(ls),hr=Zo(bt==null?void 0:bt.baseline_hyperparameters).value??{},Br=es.size>0?t_(hr,es):Ds(hr),qa=Zo(bt==null?void 0:bt.search_space);if(qa.error){Re.push(`${Mt} has invalid search space: ${qa.error}`);continue}const Jr=e_(qa.value);if(Jr.error){Re.push(`${Mt} has invalid search space: ${Jr.error}`);continue}const Os=Jr.value??{},Zs=es.size>0?n_(Os,es):Ds(Os);if(!Zs||Object.keys(Zs).length===0){Re.push(`${Mt} requires at least one hyperparameter in the search space.`);continue}if(Object.values(Dt.searchSpaceFieldErrors??{}).some(An=>!!An)){Re.push(`${Mt} has search space entries that need attention.`);continue}const fi=Object.keys(Zs).length;let pr=null;if(fi>0){let An=1,ts=!1;Object.values(Zs).forEach(Is=>{const bi=Array.isArray(Is)?Is.length:0;An*=Math.max(bi,1),(!Number.isFinite(An)||An>1e6)&&(ts=!0)}),pr=ts?null:An}const hi=bt==null?void 0:bt[me],wo=typeof hi=="string"?hi.trim():"",pi=wo.length?wo:null,gi=()=>{const An=bt==null?void 0:bt[I];let ts=null;if(typeof An=="number"&&Number.isFinite(An))ts=Math.max(1,Math.floor(An));else if(typeof An=="string"){const Is=Number(An.trim());Number.isFinite(Is)&&Is>0&&(ts=Math.max(1,Math.floor(Is)))}return ts===null&&(_n==="random"||_n==="optuna")?Ge!==null?Ge:null:ts},_i=()=>{const An=bt==null?void 0:bt[Q];let ts=null;if(typeof An=="number"&&Number.isFinite(An))ts=Math.trunc(An);else if(typeof An=="string"){const Is=Number(An.trim());Number.isFinite(Is)&&(ts=Math.trunc(Is))}return ts===null&&(_n==="random"||_n==="optuna")?ft!==null?ft:null:ts},vi=gi(),cs=_i(),Mn={};K&&(Mn.target_column=K),Mn.problem_type=U,Mn.strategy_id=Dt.id,Mn.strategy_label=Mt,Mn.strategy_index=ot+1,Mn.search_strategy=_n,vi!==null&&(_n==="random"||_n==="optuna")&&(Mn.max_iterations=vi),pi&&(Mn.scoring_metric=pi),cs!==null&&(Mn.random_state=cs),Mn.search_space_keys=Object.keys(Zs),fi>0&&(Mn.search_space_parameters=fi),pr!==null&&(Mn.search_space_candidates=pr),Mn.cross_validation={enabled:pe,strategy:Ve,folds:st,shuffle:Ke,random_state:mt};const yi=$t(bt)??kt;if(!yi){Re.push(`Unable to build pipeline graph for ${Mt}.`);continue}const jo=Br&&Object.keys(Br).length>0?Ds(Br):void 0,qd=Ds(Zs),Cl={dataset_source_id:t,pipeline_id:M,node_id:e,model_type:ls,model_types:[ls],search_strategy:_n,search_space:qd,baseline_hyperparameters:jo,n_iterations:_n==="random"||_n==="optuna"?vi??void 0:void 0,scoring:pi??void 0,random_state:cs??void 0,cross_validation:{enabled:pe,strategy:Ve,folds:st,shuffle:Ke,random_state:mt},metadata:Mn,job_metadata:Mn,run_tuning:!0,graph:yi,target_node_id:e};He.push({payload:Cl,label:Mt})}return{plans:He,issues:Re}};D(null);const{plans:Me,issues:Ce}=await se();if(!Me.length){Ce.length&&D(Ce.join(" "));return}const Qe=[];for(const{payload:He}of Me)try{const Re=await mr(He);Array.isArray(Re==null?void 0:Re.jobs)&&Re.jobs.length&&Qe.push(...Re.jobs)}catch(Re){Re instanceof Error&&Re.message?D(Re.message):D("Failed to enqueue one or more tuning jobs.");return}if(Qe.length){const He=Qe[Qe.length-1];A(He),$(Qe.length)}},[ae,pe,st,mt,Ke,Ve,mr,kt,$t,H,te,e,S,at,k,M,U,me,Ge,I,ft,Q,W,D,ee,t,ht,K]),Gc=f.useCallback(()=>{On&&Rn.refetch()},[On,Rn]),Xc=se=>{var ls,_n,es,fr,hr;const Me=A2[se.status]??se.status,Qe=(((ls=v.find(Br=>Br.value===se.model_type))==null?void 0:ls.label)??se.model_type??"").trim(),He=(()=>{switch(se.search_strategy){case"grid":return"Grid search";case"halving":return"Successive halving";case"halving_random":return"Successive halving (randomized)";case"optuna":return"Optuna search";default:return"Random search"}})(),Re=se.updated_at?Cs(se.updated_at):null,St=se.updated_at||se.created_at,ot=St?Re??new Date(St).toLocaleString():null,Dt=typeof se.error_message=="string"?se.error_message.trim():"",Mt=[];Qe&&Mt.push(`Model ${Qe}`),Mt.push(He),Array.isArray(se.results)&&se.results.length>0&&Mt.push(`${se.results.length} candidates`);const bt=typeof se.best_score=="number"&&Number.isFinite(se.best_score)?se.best_score:typeof((_n=se.metrics)==null?void 0:_n.best_score)=="number"?se.metrics.best_score:null;bt!==null&&Mt.push(`Best score ${O2(bt)}`);const Wt=String(((es=se.metrics)==null?void 0:es.scoring)??((fr=se.metrics)==null?void 0:fr.scorer)??((hr=se.metadata)==null?void 0:hr.scoring_metric)??"").trim();if(Wt&&Mt.push(`Scoring ${Wt}`),se.status==="failed"&&Dt){const Br=Dt.replace(/\s+/g," ");Mt.push(`Error: ${Br}`)}return ot&&Mt.push(`Updated ${ot}`),r.jsxs("li",{children:[r.jsxs("strong",{children:["Run ",se.run_number]}),"  ",Me,Mt.length?`  ${Mt.join("  ")}`:""]},se.id)};return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Hyperparameter tuning jobs"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:gs,children:"Add strategy"}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Gc,disabled:!On||As,children:As?"Refreshing":"Refresh jobs"})]})]}),r.jsx("p",{className:"canvas-modal__note",children:"Launch background tuning jobs that evaluate candidate hyperparameters via cross-validation. Jobs are versioned per pipeline and surface the best configuration when finished."}),M&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Pipeline ID: ",r.jsx("code",{children:M})]}),R&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{background:"rgba(251, 146, 60, 0.1)",borderLeft:"3px solid rgba(251, 146, 60, 0.8)",padding:"0.75rem 1rem",margin:"0.75rem 0"},children:[r.jsx("strong",{children:" Unsaved Configuration Changes"}),r.jsx("br",{}),"Enqueuing a tuning job saves the current configuration so results align with this pipeline snapshot."]}),is.map((se,Me)=>r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:se},`tuning-prereq-${Me}`)),Zn instanceof Error&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:Zn.message}),le&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:le}),di&&!(Zn instanceof Error)&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:di.message||"Unable to load tuning jobs."}),O&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:z>1?r.jsxs("span",{children:["Queued ",z," tuning jobs. Latest job ",O.id," (run ",O.run_number,")."]}):r.jsxs("span",{children:["Tuning job ",O.id," queued (run ",O.run_number,")."]})}),pt&&Be.parameterCount>0&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Search space covers ",Be.parameterCount," hyperparameter",Be.parameterCount===1?"":"s",Be.candidateProduct!==null?`  up to ${Be.candidateProduct.toLocaleString()} combinations`:"","."]}),r.jsxs("div",{className:"canvas-imputer__list",style:{marginTop:"1.25rem"},children:[ht.length===0&&r.jsx("p",{style:{margin:"0",padding:"1rem 1.25rem",border:"1px dashed rgba(148, 163, 184, 0.4)",borderRadius:"6px",color:"rgba(148, 163, 184, 0.85)",background:"rgba(15, 23, 42, 0.35)"},children:'No tuning strategies configured yet. Use "Add strategy" to define your search plan.'}),ht.map((se,Me)=>{const Ce=zr[Me],Qe=!!(bn&&bn.id===se.id),He=zn.has(se.id),Re=[];if(Ce!=null&&Ce.modelLabel&&Re.push(Ce.modelLabel),Ce!=null&&Ce.searchStrategyLabel&&Re.push(Ce.searchStrategyLabel),Ce!=null&&Ce.scoringLabel&&Re.push(`Scoring ${Ce.scoringLabel}`),Ce!=null&&Ce.parameterCount){const ot=Ce.candidateCount?`${Ce.parameterCount} param${Ce.parameterCount===1?"":"s"}  ${Ce.candidateCount} candidate${Ce.candidateCount===1?"":"s"}`:`${Ce.parameterCount} param${Ce.parameterCount===1?"":"s"}`;Re.push(ot)}else Re.includes("Needs attention")||Re.push("No search values");Ce!=null&&Ce.hasErrors&&Re.push("Needs attention");const St=Re.length>0?Re.join("  "):"Configure strategy settings";return r.jsxs("div",{className:"canvas-imputer__card",children:[r.jsxs("div",{className:"canvas-imputer__card-header",children:[r.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>{Ba(se.id),Qe||Xs(se.id)},"aria-expanded":He,"aria-controls":`tuning-strategy-body-${se.id}`,children:[r.jsx("span",{className:`canvas-imputer__toggle-icon${He?" canvas-imputer__toggle-icon--open":""}`,"aria-hidden":"true"}),r.jsxs("span",{className:"canvas-imputer__card-text",children:[r.jsx("span",{className:"canvas-imputer__card-title",children:(Ce==null?void 0:Ce.label)??ei(Me+1)}),r.jsx("span",{className:"canvas-imputer__card-summary",children:St})]})]}),ht.length>1&&r.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>pa(se.id),"aria-label":`Remove ${(Ce==null?void 0:Ce.label)??ei(Me+1)}`,children:"Remove"})]}),He&&Qe&&r.jsxs("div",{className:"canvas-imputer__card-body",id:`tuning-strategy-body-${se.id}`,children:[r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[Nl&&d(Nl),p&&d(p),(be==="random"||be==="optuna")&&_&&d(_),(be==="random"||be==="optuna")&&y&&d(y)]}),r.jsxs("div",{style:{marginTop:"1rem",padding:"1rem 1.25rem",background:"rgba(15, 23, 42, 0.25)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[r.jsx("div",{style:{fontWeight:600,color:"#e2e8f0",display:"block"},children:bo}),r.jsx("p",{style:{margin:"0.4rem 0 0.75rem",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:Ua}),r.jsxs("div",{id:fn,style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.4rem 0.75rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",fontSize:"0.85rem",maxWidth:"320px",marginBottom:"0.75rem"},children:[r.jsx("span",{style:{opacity:.75},children:"Selected:"}),r.jsx("strong",{style:{color:"#e2e8f0"},children:Rr||"Estimator default"})]}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.75rem"},children:[Js.map(ot=>r.jsx("button",{type:"button",onClick:()=>De(ot.value),style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:Rr===ot.value?"rgba(59, 130, 246, 0.2)":"rgba(15, 23, 42, 0.35)",color:Rr===ot.value?"#bfdbfe":"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:ot.label},ot.value)),r.jsx("button",{type:"button",onClick:()=>De(""),style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:"Reset to default"})]})]}),H&&ne.length>0&&r.jsxs("div",{style:{marginTop:"1.25rem",padding:"1.25rem",background:"rgba(15, 23, 42, 0.2)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"0.75rem"},children:[r.jsxs("div",{children:[r.jsx("h4",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#e2e8f0"},children:"Baseline hyperparameter overrides"}),r.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:"Pre-fill model defaults before the search runs. Leave fields blank to keep the template values."})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.5rem"},children:[r.jsx("span",{style:{fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:Ht>0?`${Ht} override${Ht===1?"":"s"} configured`:"Using template defaults"}),Ht>0&&r.jsx("button",{type:"button",onClick:_a,style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:"Reset overrides"})]})]}),Ue&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.75rem"},children:Ue}),r.jsx("div",{style:{marginTop:"1rem",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:ne.map(et)})]}),H&&ne.length>0&&r.jsxs("div",{style:{marginTop:"1.25rem",padding:"1.25rem",background:"rgba(15, 23, 42, 0.2)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"0.75rem"},children:[r.jsxs("div",{children:[r.jsx("h4",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#e2e8f0"},children:"Search space"}),r.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:"Provide candidate values for each hyperparameter. Separate entries with commas or new lines."})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.5rem"},children:[r.jsx("span",{style:{fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:Pt>0?`${Pt} parameter${Pt===1?"":"s"} targeted`:"No parameters queued for tuning yet"}),r.jsx("button",{type:"button",onClick:_e,disabled:Pt===0,style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:Pt===0?"rgba(15, 23, 42, 0.2)":"rgba(15, 23, 42, 0.35)",color:Pt===0?"rgba(148, 163, 184, 0.5)":"rgba(203, 213, 225, 0.9)",cursor:Pt===0?"not-allowed":"pointer"},children:"Clear search space"})]})]}),Nt&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.75rem"},children:Nt}),Xr&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{marginTop:"0.75rem"},children:"Fix the highlighted search entries before launching tuning jobs."}),r.jsx("div",{style:{marginTop:"1rem",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:"1rem"},children:ne.map(Yt)})]})]})]},se.id)})]}),pe&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Cross-validation evaluates each candidate with ",st," folds before reporting aggregate metrics."]}),Bt&&r.jsxs("div",{className:"canvas-modal__note canvas-modal__note--warning",style:{margin:"0.75rem 0",borderLeft:"3px solid rgba(251, 191, 36, 0.9)",background:"rgba(251, 191, 36, 0.12)",padding:"0.75rem 1rem"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"0.75rem"},children:[r.jsxs("div",{children:[r.jsxs("strong",{children:[" ",Bt.headline]}),r.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem"},children:Bt.summary})]}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Y(se=>!se),style:{whiteSpace:"nowrap"},children:X?"Hide tips":"Show tips"})]}),X&&r.jsx("ul",{style:{margin:"0.75rem 0 0 1rem",padding:0,listStyle:"disc",fontSize:"0.85rem"},children:Bt.details.map((se,Me)=>r.jsx("li",{style:{marginBottom:"0.35rem"},children:se},`tuning-scaling-tip-${Me}`))})]}),r.jsx("div",{className:"canvas-modal__actions",children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:Sl,disabled:Qc,children:Ms?"Queuing":"Launch tuning job"})}),As&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading recent jobs"}),!As&&Fs.length===0&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No tuning jobs found for this node."}),Fs.length>0&&r.jsx("ul",{className:"canvas-modal__note-list",children:Fs.map(Xc)})]})},a_={undersampling:{auto:"auto (match majority to the smallest class)",majority:"majority (down-sample only the majority class)","not minority":"not minority (down-sample all but the minority class)","not majority":"not majority (down-sample every class except the majority)",all:"all (down-sample every class)"},oversampling:{auto:"auto (boost minority class to majority size)",minority:"minority (only over-sample the minority class)","not minority":"not minority (over-sample every class except the minority)","not majority":"not majority (avoid synthesising the majority class)",all:"all (over-sample all classes equally)"}},B2=(e,t)=>{if(e==null||e==="")return a_[t].auto;if(typeof e=="number"){if(!Number.isFinite(e))return a_[t].auto;const a=Math.max(Math.min(e,1),0),i=a*100,l=a.toFixed(a>=.1||a===0?2:3),u=t==="undersampling"?"majority":"majority baseline";return`${l} ratio (${i.toFixed(1)}% of ${u})`}const n=e.trim().toLowerCase();return a_[t][n]??n},U2=(e,t)=>{const n=t==="oversampling"?["over-sampling","oversampling","smote","adasyn","tomek","svm smote","kmeans smote","borderline smote"]:["under-sampling","undersampling","resampling"];for(let a=e.length-1;a>=0;a-=1){const i=e[a];if(typeof i!="string")continue;const l=i.toLowerCase();if(n.some(u=>l.includes(u)))return i}return null},q2=(e,t)=>t?"Missing":e.length?e:"Empty string",H2=({mode:e="undersampling",sourceId:t,hasReachableSource:n,previewState:a,onRefreshPreview:i,config:l,methodParameter:u,targetColumnParameter:d,samplingStrategyParameter:m,randomStateParameter:v,replacementParameter:p,kNeighborsParameter:_,renderParameterField:y,formatMetricValue:w,formatMissingPercentage:x,schemaGuard:S})=>{var I;const k=a.data,M=a.status,P=Array.isArray(k==null?void 0:k.applied_steps)?k==null?void 0:k.applied_steps:[],T=f.useMemo(()=>U2(P,e),[P,e]),j=(l==null?void 0:l.targetColumn)??"",O=(l==null?void 0:l.method)||(typeof(u==null?void 0:u.default)=="string"?u.default:""),A=f.useMemo(()=>{const Q=Array.isArray(u==null?void 0:u.options)?u==null?void 0:u.options:[];if(O){const me=Q.find(J=>J.value===O);return me!=null&&me.label?me.label:O.replace(/_/g," ")}return Q.length>0?Q[0].label??Q[0].value:e==="undersampling"?"Random under-sampling":"Synthetic over-sampling"},[O,u==null?void 0:u.options,e]),z=f.useMemo(()=>B2(l==null?void 0:l.samplingStrategy,e),[l==null?void 0:l.samplingStrategy,e]),$=f.useMemo(()=>(l==null?void 0:l.randomState)===null||(l==null?void 0:l.randomState)===void 0?"Not set":Number.isFinite(l.randomState)?String(l.randomState):"Not set",[l==null?void 0:l.randomState]),q=f.useMemo(()=>{if(e!=="oversampling")return null;const Q=l==null?void 0:l.kNeighbors;if(typeof Q=="number"&&Number.isFinite(Q))return String(Math.max(1,Math.round(Q)));if(_&&typeof _.default=="number"){const me=_.default;if(Number.isFinite(me))return String(Math.max(1,Math.round(me)))}return"Default"},[l==null?void 0:l.kNeighbors,_,e]),V=(l==null?void 0:l.replacement)===null||(l==null?void 0:l.replacement)===void 0?null:l.replacement?"With replacement":"Without replacement",R=f.useMemo(()=>{if(M!=="success"||!k||!j)return{rows:[],total:0,truncated:!1};const Q=Array.isArray(k.sample_rows)?k.sample_rows:[];if(!Q.length)return{rows:[],total:0,truncated:!1};const me=new Map;Q.forEach(pe=>{if(!pe||typeof pe!="object")return;const Ve=pe[j],st=Ve==null,Ke=st?"__missing__":String(Ve),mt=q2(st?"":Ke,st),yt=me.get(Ke);yt?yt.count+=1:me.set(Ke,{label:mt,count:1,percentage:0,isMissing:st})});const J=Array.from(me.values()).sort((pe,Ve)=>Ve.count-pe.count),H=J.reduce((pe,Ve)=>pe+Ve.count,0),Z=8,ne=J.length>Z;return{rows:(ne?J.slice(0,Z):J).map(pe=>({...pe,percentage:H>0?pe.count/H*100:0})),total:H,truncated:ne}},[k,M,j]),ee=((I=k==null?void 0:k.metrics)==null?void 0:I.row_count)??null,le=!!t&&n&&M!=="loading"&&!(S!=null&&S.blocked),D=f.useMemo(()=>t?n?null:"Link this node to the dataset input to evaluate class balance.":"Connect to a dataset to preview class distributions.",[n,t]),X=f.useMemo(()=>!(S!=null&&S.blocked)||!S.details.length?"":S.details.map(Q=>Q.logical_family?`${Q.name} (${Q.logical_family})`:Q.name).join(", "),[S]),Y=!j,K=!!j&&Array.isArray(k==null?void 0:k.columns)&&!(k!=null&&k.columns.includes(j)),U=e==="undersampling"?"Class undersampling":"Class oversampling",te=e==="undersampling"?"Random under-sampling trims majority-class examples to mitigate imbalance before training downstream models. It preserves minority class signals but can discard information from majority classes when ratios are aggressive.":"Synthetic over-sampling boosts minority representation by generating new samples. Integer feature columns are temporarily cast to float so synthesized values can include decimals, which helps models learn rare classes while requiring careful preprocessing to avoid noise.",W=e==="undersampling"?"enable undersampling":"enable oversampling";return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:U}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:i,disabled:!le,children:M==="loading"?"Refreshing":"Refresh preview"})})]}),r.jsx("p",{className:"canvas-modal__note",children:te}),D&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:D}),Y&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Specify a target column to compute class ratios and ",W,"."]}),(S==null?void 0:S.blocked)&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[S.message,X&&r.jsxs(r.Fragment,{children:[" ","Columns: ",X,"."]})]}),M==="error"&&a.error&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:a.error}),K&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Target column ",j," is not present in the current preview. Check upstream nodes or refresh the dataset snapshot."]}),T&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:T}),r.jsxs("ul",{className:"canvas-modal__note-list",children:[r.jsxs("li",{children:["Method: ",r.jsx("strong",{children:A})]}),r.jsxs("li",{children:["Sampling strategy: ",r.jsx("strong",{children:z})]}),e==="oversampling"&&q&&r.jsxs("li",{children:["k-neighbors: ",r.jsx("strong",{children:q})]}),V&&r.jsxs("li",{children:["Replacement: ",r.jsx("strong",{children:V})]}),r.jsxs("li",{children:["Random state: ",r.jsx("strong",{children:$})]})]}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&y(u),m&&y(m),e==="oversampling"&&_&&y(_),v&&y(v),p&&y(p)]}),d&&r.jsx("div",{className:"canvas-modal__parameter-list",children:y(d)}),j&&M==="success"&&!K&&(R.rows.length?r.jsxs("div",{className:"canvas-cast__table-wrapper",children:[r.jsxs("table",{className:"canvas-cast__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Class"}),r.jsx("th",{scope:"col",children:"Sample count"}),r.jsx("th",{scope:"col",children:"Share"})]})}),r.jsx("tbody",{children:R.rows.map(Q=>r.jsxs("tr",{children:[r.jsx("th",{scope:"row",children:Q.label}),r.jsx("td",{children:w(Q.count)}),r.jsx("td",{children:x(Q.percentage)})]},`resampling-class-${Q.label}`))})]}),r.jsxs("p",{className:"canvas-modal__note",children:["Analysed ",w(R.total)," row",R.total===1?"":"s"," from the preview.",R.truncated?" Showing top classes by frequency.":""]}),ee!==null&&r.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Preview rows after resampling: ",w(ee),"."]})]}):r.jsx("p",{className:"canvas-modal__note",children:"No class distribution available in the preview sample. Refresh after configuring the node or increasing the sample size."}))]})},V2=e=>{var t;return!!((t=e==null?void 0:e.data)!=null&&t.isDataset||(e==null?void 0:e.id)==="dataset-source")},W2=new Set(["binned_distribution","data_preview","outlier_monitor","skewness_distribution","dataset_profile","transformer_audit"]),K2=new Set(["trim_whitespace","normalize_text_case","replace_aliases_typos","standardize_date_formats","remove_special_characters","replace_invalid_values","regex_replace_fix"]),Y2=e=>{var n;const t=((n=e==null?void 0:e.data)==null?void 0:n.catalogType)??"";return f.useMemo(()=>{const a=V2(e),i=t==="imputation_methods"||t==="advanced_imputer"||t==="simple_imputer",l=t==="missing_value_indicator",u=t==="replace_aliases_typos",d=t==="trim_whitespace",m=t==="remove_special_characters",v=t==="replace_invalid_values",p=t==="regex_replace_fix",_=t==="normalize_text_case",y=t==="standardize_date_formats",w=t==="label_encoding",x=t==="target_encoding",S=t==="hash_encoding",k=t==="train_model_draft",M=t==="model_evaluation",P=t==="model_registry_overview",T=t==="hyperparameter_tuning",j=t==="feature_target_split",O=t==="train_test_split",A=t==="class_undersampling",z=t==="class_oversampling",$=t==="ordinal_encoding",q=t==="dummy_encoding",V=t==="one_hot_encoding",R=t==="feature_math",ee=t==="cast_column_types",le=t==="binning_discretization",D=t==="scale_numeric_features",X=t==="polynomial_features",Y=t==="feature_selection",K=t==="transformer_audit",U=t==="outlier_removal",te=t==="skewness_transform",W=t==="skewness_distribution",I=t==="binned_distribution",Q=K2.has(t),me=W2.has(t),J=t==="remove_duplicates",H=t==="drop_missing_columns",Z=t==="drop_missing_rows";return{catalogType:t,isDataset:a,isImputerNode:i,isMissingIndicatorNode:l,isReplaceAliasesNode:u,isTrimWhitespaceNode:d,isRemoveSpecialCharsNode:m,isReplaceInvalidValuesNode:v,isRegexCleanupNode:p,isNormalizeTextCaseNode:_,isStandardizeDatesNode:y,isLabelEncodingNode:w,isTargetEncodingNode:x,isHashEncodingNode:S,isTrainModelDraftNode:k,isModelEvaluationNode:M,isModelRegistryNode:P,isHyperparameterTuningNode:T,isFeatureTargetSplitNode:j,isTrainTestSplitNode:O,isClassUndersamplingNode:A,isClassOversamplingNode:z,isOrdinalEncodingNode:$,isDummyEncodingNode:q,isOneHotEncodingNode:V,isFeatureMathNode:R,isCastNode:ee,isBinningNode:le,isScalingNode:D,isPolynomialFeaturesNode:X,isFeatureSelectionNode:Y,isTransformerAuditNode:K,isOutlierNode:U,isSkewnessNode:te,isSkewnessDistributionNode:W,isBinnedDistributionNode:I,isDataConsistencyNode:Q,isInspectionNode:me,isRemoveDuplicatesNode:J,isDropMissingColumnsNode:H,isDropMissingRowsNode:Z,isDropMissingNode:H||Z}},[t,e])},Q2=({isScalingNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(null),[d,m]=f.useState(null),[v,p]=f.useState(!1),[_,y]=f.useState(0),w=f.useCallback(()=>{y(x=>x+1)},[]);return f.useEffect(()=>{let x=!0;return e?t?n?(p(!0),m(null),gx(t,{graph:a,targetNodeId:i}).then(S=>{x&&u(S??null)}).catch(S=>{x&&(u(null),m((S==null?void 0:S.message)??"Unable to load scaling insights"))}).finally(()=>{x&&p(!1)}),()=>{x=!1}):(u(null),m("Connect this step to an upstream output to load scaling insights."),p(!1),()=>{x=!1}):(u(null),m("Select a dataset to load scaling insights."),p(!1),()=>{x=!1}):(u(null),m(null),p(!1),()=>{x=!1})},[a,n,e,_,t,i]),{scalingData:l,scalingError:d,isFetchingScaling:v,refreshScaling:w}},G2=({isBinningNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(null),[d,m]=f.useState(null),[v,p]=f.useState(!1),[_,y]=f.useState(0),w=f.useCallback(()=>{y(x=>x+1)},[]);return f.useEffect(()=>{let x=!0;return e?t?n?(p(!0),m(null),_x(t,{graph:a,targetNodeId:i}).then(S=>{x&&u(S??null)}).catch(S=>{x&&(u(null),m((S==null?void 0:S.message)??"Unable to load binning insights"))}).finally(()=>{x&&p(!1)}),()=>{x=!1}):(u(null),m("Connect this step to an upstream output to analyse numeric columns."),p(!1),()=>{x=!1}):(u(null),m("Select a dataset to load binning insights."),p(!1),()=>{x=!1}):(u(null),m(null),p(!1),()=>{x=!1})},[a,n,e,_,t,i]),{binningData:l,binningError:d,isFetchingBinning:v,refreshBinning:w}},X2=({shouldLoad:e,sourceId:t,graphContext:n,targetNodeId:a,transformations:i})=>{const[l,u]=f.useState(null),[d,m]=f.useState(null),[v,p]=f.useState(!1),[_,y]=f.useState(0),w=f.useRef(null),x=f.useCallback(()=>{y(S=>S+1)},[]);return f.useEffect(()=>{let S=!0;return e?t?(w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{if(!S)return;p(!0),m(null);let k;i.length>0&&(k=i.map(M=>({column:M.column,method:M.method}))),px(t,{transformations:k,graph:n,targetNodeId:a}).then(M=>{S&&u(M??null)}).catch(M=>{S&&(u(null),m((M==null?void 0:M.message)??"Unable to load skewness insights"))}).finally(()=>{S&&p(!1)})},300),()=>{S=!1,w.current&&clearTimeout(w.current)}):(u(null),m("Select a dataset to load skewness insights."),p(!1),w.current&&(clearTimeout(w.current),w.current=null),()=>{S=!1}):(u(null),m(null),p(!1),w.current&&(clearTimeout(w.current),w.current=null),()=>{S=!1})},[n,_,e,t,a,i]),{skewnessData:l,skewnessError:d,isFetchingSkewness:v,refreshSkewness:x}},J2=({isBinnedDistributionNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i,samplePreset:l})=>{const[u,d]=f.useState(null),[m,v]=f.useState(null),[p,_]=f.useState(!1),[y,w]=f.useState(0),x=f.useCallback(()=>{w(S=>S+1)},[]);return f.useEffect(()=>{let S=!0;if(!e)return d(null),v(null),_(!1),()=>{S=!1};if(!t)return d(null),v("Select a dataset to load binned column distributions."),_(!1),()=>{S=!1};if(!n)return d(null),v("Connect this step to an upstream output to load binned column distributions."),_(!1),()=>{S=!1};_(!0),v(null);const k=yd.find(P=>P.value===l)??yd[0],M=k.value==="all"?"all":Number(k.value);return yx(t,{sampleSize:M,graph:a,targetNodeId:i}).then(P=>{S&&d(P??null)}).catch(P=>{S&&(d(null),v((P==null?void 0:P.message)??"Unable to load binned column distributions"))}).finally(()=>{S&&_(!1)}),()=>{S=!1}},[a,n,e,y,l,t,i]),{binnedDistributionData:u,binnedDistributionError:m,isFetchingBinnedDistribution:p,refreshBinnedDistribution:x}},Td={status:"idle",data:null,error:null},Z2=1e3,e$=({shouldFetchPreview:e,sourceId:t,canTriggerPreview:n,graphSnapshot:a,isPreviewNode:i,targetNodeId:l,previewSignature:u,skipPreview:d=!1,requestPreviewRows:m,includeSignals:v})=>{const[p,_]=f.useState(Td),[y,w]=f.useState(0),x=f.useRef(null),S=f.useRef(-1),k=f.useCallback(()=>{w(M=>M+1)},[]);return f.useEffect(()=>{if(!e){_(Td),x.current=null,S.current=-1;return}if(d)return;if(!t){_(i?{status:"error",data:null,error:"Select a dataset to generate previews."}:Td);return}if(!n){_(i?{status:"error",data:null,error:"Add nodes to the canvas before generating a snapshot."}:Td);return}if(!a)return;const M=(()=>{const q=Array.isArray(a.nodes)?a.nodes.map(R=>R&&typeof R.id=="string"?R.id:null).filter(R=>!!R).sort():[],V=Array.isArray(a.edges)?a.edges.map(R=>{const ee=R&&typeof R.source=="string"?R.source.trim():"",le=R&&typeof R.target=="string"?R.target.trim():"";return ee&&le?`${ee}->${le}`:null}).filter(R=>!!R).sort():[];return JSON.stringify({sourceId:t??null,targetNodeId:l??null,nodeIds:q,edgePairs:V})})(),P=u??M,T=P!==x.current;if(!(S.current!==y)&&!T)return;x.current=P,S.current=y;let O=!0;_(q=>({status:"loading",data:q.data??null,error:null}));const A=m??i,z=v??A,$={dataset_source_id:t,graph:{nodes:a.nodes,edges:a.edges},target_node_id:l??void 0,include_preview_rows:A,include_signals:z};return A&&($.sample_size=Z2),Cx($).then(q=>{O&&_({status:"success",data:q,error:null})}).catch(q=>{O&&_(i?{status:"error",data:null,error:(q==null?void 0:q.message)??"Unable to generate preview."}:Td)}),()=>{O=!1}},[n,a,i,d,u,y,e,t,l]),{previewState:p,refreshPreview:k}},t$=({shouldLoad:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i,setAvailableColumns:l,setColumnMissingMap:u})=>{const[d,m]=f.useState(!1),[v,p]=f.useState(null),[_,y]=f.useState(0),w=f.useCallback(()=>{!e||!t||!n||y(x=>x+1)},[n,e,t]);return f.useEffect(()=>{let x=!0;return e?t?n?(m(!0),p(null),Og(t,{graph:a,targetNodeId:i}).then(S=>{if(!x)return;const k={};S&&typeof S=="object"&&(S!=null&&S.column_missing_map)&&typeof S.column_missing_map=="object"&&Object.entries(S.column_missing_map).forEach(([T,j])=>{const O=String(T??"").trim();if(!O)return;const A=Number(j);Number.isNaN(A)||A<0||(k[O]=Number(A))});const M=new Set;Array.isArray(S==null?void 0:S.all_columns)&&S.all_columns.forEach(T=>{const j=String(T??"").trim();j&&M.add(j)}),Object.keys(k).forEach(T=>M.add(T));const P=Array.from(M).sort((T,j)=>T.localeCompare(j));P.forEach(T=>{Object.prototype.hasOwnProperty.call(k,T)||(k[T]=0)}),P.length&&l(P),Object.keys(k).length&&u(T=>({...T,...k}))}).catch(S=>{x&&p((S==null?void 0:S.message)??"Unable to load column metrics.")}).finally(()=>{x&&m(!1)}),()=>{x=!1}):(p("Connect this step to an upstream output to load column metrics."),m(!1),()=>{x=!1}):(p("Select a dataset to load column metrics."),m(!1),()=>{x=!1}):()=>{x=!1}},[a,n,_,l,u,e,t,i]),{isFetching:d,error:v,refreshDropColumnRecommendations:w}},Tw={enabled:!1,explicit:!1},n$={selectedColumns:[],nonTextSelected:[],autoDetectionActive:!1,recommendedColumns:[],textColumnCount:0,textColumns:[]},s$={totalPairs:0,previewPairs:[],previewOverflow:0,duplicates:[],duplicateOverflow:0,invalidEntries:[],invalidOverflow:0},r$={},a$=[],o$=({isReplaceAliasesNode:e,configState:t,nodeConfig:n,availableColumns:a,columnTypeMap:i,previewSampleRows:l})=>{const u=f.useMemo(()=>{if(!e)return Tw;const S=$c(t);if(S!==void 0)return{enabled:!!ll(S),explicit:!0};if(n&&typeof n=="object"){const k=$c(n);if(k!==void 0)return{enabled:!!ll(k),explicit:!0}}return Tw},[t,e,n]),d=f.useMemo(()=>{if(!e)return[];const S=ut((t==null?void 0:t.columns)??(n==null?void 0:n.columns)),k=Df(e?t==null?void 0:t.mode:void 0,e?n==null?void 0:n.mode:void 0),M=(()=>{const T=$c(t);if(T!==void 0){const j=ll(T);if(j!==null)return j}if(n&&typeof n=="object"){const j=$c(n);if(j!==void 0){const O=ll(j);if(O!==null)return O}}return S.length===0})(),P=(t==null?void 0:t.alias_strategies)??(t==null?void 0:t.strategies)??(n==null?void 0:n.alias_strategies)??(n==null?void 0:n.strategies);return Jx(P,{mode:k,columns:S,autoDetect:M})},[t,e,n]),m=f.useMemo(()=>e?d.length?Array.from(new Set(d.flatMap(S=>S.columns.map(k=>k.trim()).filter(Boolean)))).sort((S,k)=>S.localeCompare(k)):ut(t==null?void 0:t.columns):[],[d,t==null?void 0:t.columns,e]),v=f.useMemo(()=>e?d.length?d.some(S=>S.autoDetect):u.explicit?u.enabled:m.length===0:!1,[u.enabled,u.explicit,m.length,d,e]),p=f.useMemo(()=>{if(e)return t==null?void 0:t.custom_pairs},[t==null?void 0:t.custom_pairs,e]),_=f.useMemo(()=>e?EA(l):r$,[e,l]),y=f.useMemo(()=>e?xA({selectedColumns:m,availableColumns:a,columnTypeMap:i,autoDetectEnabled:v}):n$,[v,m,a,i,e]),w=f.useMemo(()=>e?jA(p):s$,[e,p]),x=f.useMemo(()=>{if(!e)return a$;const S=new Set(y.recommendedColumns),k=new Set(y.textColumns);return a.map(M=>{const P=i[M]??null,T=_[M]??[];return{name:M,dtype:P,samples:T.slice(0,3),isRecommended:S.has(M),isTextLike:k.has(M)}})},[y.recommendedColumns,y.textColumns,_,a,i,e]);return{aliasAutoDetectMeta:u,aliasStrategies:d,aliasStrategyCount:d.length,aliasSelectedColumns:m,aliasAutoDetectEnabled:v,replaceAliasesCustomPairsValue:p,aliasColumnSummary:y,aliasCustomPairSummary:w,aliasSampleMap:_,aliasColumnOptions:x}},i$=({isOutlierNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(null),[d,m]=f.useState(null),[v,p]=f.useState(!1),[_,y]=f.useState(0),w=f.useCallback(()=>{y(x=>x+1)},[]);return f.useEffect(()=>{let x=!0;return e?t?n?(p(!0),m(null),vx(t,{graph:a,targetNodeId:i}).then(S=>{x&&u(S??null)}).catch(S=>{x&&(u(null),m((S==null?void 0:S.message)??"Unable to load outlier insights"))}).finally(()=>{x&&p(!1)}),()=>{x=!1}):(u(null),m("Connect this step to an upstream output to load outlier insights."),p(!1),()=>{x=!1}):(u(null),m("Select a dataset to load outlier insights."),p(!1),()=>{x=!1}):(u(null),m(null),p(!1),()=>{x=!1})},[a,n,e,_,t,i]),{outlierData:l,outlierError:d,isFetchingOutliers:v,refreshOutliers:w}},l$=["int","float","double","decimal","number","numeric","long","short"],c$=["datetime","date","time","timestamp"],u$=["object","string","text","category","categorical","char"],d$=({shouldAnalyze:e,availableColumns:t,columnTypeMap:n,previewSampleRows:a})=>{const i=f.useMemo(()=>{if(!e)return{excluded:new Set,reasons:new Map};const l=new Set,u=new Map;return t.forEach(d=>{const m=(n[d]??"").toLowerCase(),v=l$.some(M=>m.includes(M)),p=c$.some(M=>m.includes(M)),_=u$.some(M=>m.includes(M));if(m.includes("bool")){l.add(d),u.set(d,"Boolean dtype");return}if((p||_)&&!v){l.add(d),u.set(d,"Non-numeric dtype");return}const y=a.map(M=>M&&Object.prototype.hasOwnProperty.call(M,d)?M[d]:void 0).filter(M=>M!=null);if(!y.length){v||(l.add(d),u.set(d,"No numeric samples"));return}let w=!0,x=!1,S=!1;const k=new Set;for(const M of y){if(typeof M=="boolean"){k.add(M?"1":"0");continue}if(typeof M=="number"){if(!Number.isFinite(M)){w=!1;break}x=!0,Math.abs(M)<1e-9?k.add("0"):Math.abs(M-1)<1e-9?k.add("1"):S=!0;continue}if(typeof M=="string"){const P=M.trim();if(!P)continue;const T=P.toLowerCase();if(dw.has(T)){k.add("1");continue}if(mw.has(T)){k.add("0");continue}const j=Number(P);if(!Number.isNaN(j)&&Number.isFinite(j)){x=!0,Math.abs(j)<1e-9?k.add("0"):Math.abs(j-1)<1e-9?k.add("1"):S=!0;continue}w=!1;break}w=!1;break}if(!w||!x&&!v){l.add(d),u.set(d,"Non-numeric values");return}!S&&k.size>0&&Array.from(k).every(P=>P==="0"||P==="1")&&(l.add(d),u.set(d,"Binary/bool-like values"))}),{excluded:l,reasons:u}},[t,n,a,e]);return{numericExcludedColumns:i.excluded,numericExclusionReasons:i.reasons}},m$=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const t=Number(e);if(Number.isFinite(t))return t}return null},f$=({isBinningNode:e,numericExcludedColumns:t,selectedColumns:n,previewSampleRows:a,availableColumns:i,recommendedColumns:l})=>{const u=f.useMemo(()=>{if(!l)return null;const p=new Set;for(const _ of l){const y=typeof _=="string"?_.trim():"";y&&p.add(y)}return p.size>0?p:null},[l]),d=f.useMemo(()=>{if(!Array.isArray(n)||!n.length)return null;const p=new Set;return n.forEach(_=>{const y=typeof _=="string"?_.trim():"";y&&p.add(y)}),p.size>0?p:null},[n]),m=f.useMemo(()=>{if(!e)return new Set;if(!t.size||!u&&!d)return t;const p=new Set;return t.forEach(_=>{u!=null&&u.has(_)||d!=null&&d.has(_)||p.add(_)}),p},[e,t,u,d]),v=f.useMemo(()=>{if(!e||!a.length)return{};const p={};return i.forEach(_=>{if(m.has(_))return;let y=null,w=null;const x=new Set;if(a.forEach(S=>{if(!S||!Object.prototype.hasOwnProperty.call(S,_))return;const k=m$(S[_]);k!==null&&((y===null||k<y)&&(y=k),(w===null||k>w)&&(w=k),x.size<=1e3&&x.add(k))}),y!==null||w!==null){const S=x.size>0?x.size:null;p[_]={min:y,max:w,distinct:S}}}),p},[i,m,e,a]);return{binningExcludedColumns:m,binningColumnPreviewMap:v,manualBoundColumns:[],manualRangeFallbackMap:{}}},lr=["iqr","zscore","elliptic_envelope","winsorize","manual"],ml={iqr:"IQR filter",zscore:"Z-score filter",elliptic_envelope:"Elliptic Envelope",winsorize:"Winsorize",manual:"Manual bounds"},Xf={iqr:["multiplier"],zscore:["threshold"],elliptic_envelope:["contamination"],winsorize:["lower_percentile","upper_percentile"],manual:["lower_bound","upper_bound"]},ti={iqr:{multiplier:1.5},zscore:{threshold:3},elliptic_envelope:{contamination:.01},winsorize:{lower_percentile:5,upper_percentile:95},manual:{}},Jf=(e,{min:t,max:n}={})=>{const a=typeof e=="number"?e:Number(e);if(!Number.isFinite(a))return null;let i=a;return typeof t=="number"&&Number.isFinite(t)&&i<t&&(i=t),typeof n=="number"&&Number.isFinite(n)&&i>n&&(i=n),i},$w=e=>{const t=[];return Array.isArray(e)?e.forEach(n=>{const a=String(n??"").trim();a&&t.push(a)}):typeof e=="string"&&e.split(",").map(n=>n.trim()).forEach(n=>{n&&t.push(n)}),Array.from(new Set(t)).sort((n,a)=>n.localeCompare(a))},h$=e=>{const t={iqr:{...ti.iqr},zscore:{...ti.zscore},elliptic_envelope:{...ti.elliptic_envelope},winsorize:{...ti.winsorize},manual:{}};return!e||typeof e!="object"||Array.isArray(e)||Object.entries(e).forEach(([n,a])=>{const i=n.trim().toLowerCase();if(!lr.includes(i))return;const l=t[i]??{};if(!(!a||typeof a!="object"||Array.isArray(a))){if(Object.entries(a).forEach(([u,d])=>{const m=u.trim().toLowerCase();if(!Xf[i].includes(m))return;let v={};m==="threshold"?v={min:.1}:m==="multiplier"?v={min:.1}:(m==="lower_percentile"||m==="upper_percentile")&&(v={min:0,max:100});const p=Jf(d,v);p!==null&&(l[m]=p)}),i==="winsorize"){const u=Jf(l.lower_percentile,{min:0,max:100}),d=Jf(l.upper_percentile,{min:0,max:100});typeof u=="number"&&typeof d=="number"&&u>=d?(l.lower_percentile=ti.winsorize.lower_percentile,l.upper_percentile=ti.winsorize.upper_percentile):(typeof u=="number"&&(l.lower_percentile=u),typeof d=="number"&&(l.upper_percentile=d))}t[i]=l}}),t},p$=e=>{if(!e||typeof e!="object"||Array.isArray(e))return{};const t={};return Object.entries(e).forEach(([n,a])=>{const i=String(n??"").trim();if(!i||!a||typeof a!="object"||Array.isArray(a))return;const l={};Object.entries(a).forEach(([u,d])=>{const m=u.trim().toLowerCase();if(!Object.values(Xf).some(y=>y.includes(m)))return;let p={};m==="threshold"?p={min:.1}:m==="multiplier"?p={min:.1}:m==="contamination"?p={min:1e-4,max:.49}:(m==="lower_percentile"||m==="upper_percentile")&&(p={min:0,max:100});const _=Jf(d,p);_!==null&&(l[m]=_)}),Object.keys(l).length&&(t[i]=l)}),t},g$=e=>{const t=e&&typeof e=="object"&&!Array.isArray(e)?e:{},n=$w(t.columns),a=typeof t.default_method=="string"?t.default_method.trim().toLowerCase():"",i=lr.includes(a)?a:"iqr",l={};t.column_methods&&typeof t.column_methods=="object"&&!Array.isArray(t.column_methods)&&Object.entries(t.column_methods).forEach(([p,_])=>{const y=String(p??"").trim(),w=typeof _=="string"?_.trim().toLowerCase():"";y&&lr.includes(w)&&(l[y]=w)});const u=typeof t.auto_detect=="boolean"?t.auto_detect:!0,d=$w(t.skipped_columns),m=h$(t.method_parameters),v=p$(t.column_parameters);return{columns:n,defaultMethod:i,columnMethods:l,autoDetect:u,skippedColumns:d,methodParameters:m,columnParameters:v}},_$=e=>{const t={...ml};return Array.isArray(e)&&e.forEach(n=>{const a=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null,i=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";a&&i&&lr.includes(a)&&(t[a]=i)}),t},v$=e=>{const t=new Map;return Array.isArray(e)&&e.forEach(n=>{const a=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null;a&&lr.includes(a)&&t.set(a,n)}),t},y$=e=>lr.map(t=>({value:t,label:e[t]??ml[t]??t})),b$=({insights:e,outlierConfig:t,labelMap:n,selectedColumns:a,skippedColumns:i,excludedColumns:l})=>{if(!e.length)return[];const u=[];return e.forEach(d=>{const m=String((d==null?void 0:d.column)??"").trim();if(!m)return;const v={};Array.isArray(d==null?void 0:d.method_summaries)&&d.method_summaries.forEach(T=>{const j=T==null?void 0:T.method;j&&lr.includes(j)&&(v[j]=T)});const p=d!=null&&d.recommended_method&&lr.includes(d.recommended_method)?d.recommended_method:null,_=p?n[p]??ml[p]??p:null,y=t.columnMethods[m]??null,w=y??t.defaultMethod,x=n[w]??ml[w]??w,S=i.has(m),k=l.has(m),M=a.has(m),P=!!(d!=null&&d.has_missing);u.push({column:m,dtype:typeof(d==null?void 0:d.dtype)=="string"?d.dtype:null,stats:(d==null?void 0:d.stats)??{},recommendedMethod:p,recommendedLabel:_,recommendedReason:typeof(d==null?void 0:d.recommended_reason)=="string"?d.recommended_reason:null,methodSummaries:v,currentOverride:y,currentMethod:w,currentMethodLabel:x,isOverrideApplied:y!==null,isSelected:M,isSkipped:S,isExcluded:k,hasMissing:P})}),u.sort((d,m)=>d.column.localeCompare(m.column)),u},x$=(e,t,n,a)=>{if(!e.length)return null;const i=e.map(l=>{const u=t[l],d=u?n[u]??ml[u]??u:null;return d?`${l} -> ${d}`:l});return a>e.length&&i.push(""),i.join(", ")},w$=({isScalingNode:e,isBinningNode:t,isOutlierNode:n,scalingExcludedColumns:a,binningExcludedColumns:i,outlierExcludedColumns:l,setConfigState:u})=>{f.useEffect(()=>{!e||a.size===0||u(d=>{if(!d||typeof d!="object")return d;const m=ut(d.columns);if(!m.length)return d;const v=m.filter(_=>!a.has(_));if(v.length===m.length||!v.length)return d;const p={...d,columns:v};if(d.column_methods&&typeof d.column_methods=="object"&&!Array.isArray(d.column_methods)){const _={};let y=!1;Object.entries(d.column_methods).forEach(([w,x])=>{const S=String(w??"").trim();if(!S)return;if(a.has(S)){y=!0;return}const k=typeof x=="string"?x.trim():null;k&&Lr.includes(k)&&(_[S]=k)}),y?Object.keys(_).length?p.column_methods=_:p.column_methods={}:p.column_methods=d.column_methods}return p})},[e,a,u]),f.useEffect(()=>{!t||i.size===0||u(d=>{if(!d||typeof d!="object")return d;const m=ut(d.columns);if(!m.length)return d;const v=m.filter(y=>!i.has(y));if(v.length===m.length)return d;const p=new Set(m.filter(y=>i.has(y))),_={...d,columns:v};if(d.custom_bins&&typeof d.custom_bins=="object"&&!Array.isArray(d.custom_bins)){const y={};Object.entries(d.custom_bins).forEach(([w,x])=>{!p.has(w)&&Array.isArray(x)&&x.length&&(y[w]=[...x])}),Object.keys(y).length?_.custom_bins=y:Object.prototype.hasOwnProperty.call(_,"custom_bins")&&delete _.custom_bins}if(d.custom_labels&&typeof d.custom_labels=="object"&&!Array.isArray(d.custom_labels)){const y={};Object.entries(d.custom_labels).forEach(([w,x])=>{!p.has(w)&&Array.isArray(x)&&x.length&&(y[w]=x.map(S=>String(S)))}),Object.keys(y).length?_.custom_labels=y:Object.prototype.hasOwnProperty.call(_,"custom_labels")&&delete _.custom_labels}return _})},[i,t,u]),f.useEffect(()=>{!n||l.size===0||u(d=>{if(!d||typeof d!="object")return d;const m=ut(d.columns),v=m.filter(P=>!l.has(P)),p=v.length!==m.length,_=ut(d.skipped_columns),y=_.filter(P=>!l.has(P)),w=y.length!==_.length,x=P=>P??{...d};let S=null;p&&(S=x(S),S.columns=v.sort((P,T)=>P.localeCompare(T))),w&&(S=x(S),y.length?S.skipped_columns=y.sort((P,T)=>P.localeCompare(T)):Object.prototype.hasOwnProperty.call(S,"skipped_columns")&&delete S.skipped_columns);let k=!1;if(d.column_methods&&typeof d.column_methods=="object"&&!Array.isArray(d.column_methods)){const P={};Object.entries(d.column_methods).forEach(([T,j])=>{const O=String(T??"").trim();if(!O||l.has(O)){k=!0;return}const A=typeof j=="string"?j.trim():null;A&&lr.includes(A)?P[O]=A:k=!0}),k&&(S=x(S),Object.keys(P).length?S.column_methods=P:Object.prototype.hasOwnProperty.call(S,"column_methods")&&delete S.column_methods)}let M=!1;if(d.column_parameters&&typeof d.column_parameters=="object"&&!Array.isArray(d.column_parameters)){const P={};Object.entries(d.column_parameters).forEach(([T,j])=>{const O=String(T??"").trim();if(!O||l.has(O)){M=!0;return}if(!j||typeof j!="object"||Array.isArray(j)){M=!0;return}P[O]={...j}}),M&&(S=x(S),Object.keys(P).length?S.column_parameters=P:Object.prototype.hasOwnProperty.call(S,"column_parameters")&&delete S.column_parameters)}return S||d})},[n,l,u])},j$=({isTrimWhitespaceNode:e,isRemoveSpecialCharsNode:t,isRegexCleanupNode:n,isNormalizeTextCaseNode:a,configState:i,nodeConfig:l,availableColumns:u,columnTypeMap:d,previewSampleRows:m})=>{const v=f.useMemo(()=>rO(e?i==null?void 0:i.mode:void 0,e?l==null?void 0:l.mode:void 0),[i==null?void 0:i.mode,e,l==null?void 0:l.mode]),p=f.useMemo(()=>e?ut(i==null?void 0:i.columns):[],[i==null?void 0:i.columns,e]),_=f.useMemo(()=>e?dO(m):{},[e,m]),y=f.useMemo(()=>e?iO({selectedColumns:p,availableColumns:u,columnTypeMap:d,sampleMap:_}):fO,[u,d,e,p,_]),w=f.useMemo(()=>aO(v),[v]),x=f.useMemo(()=>SO(t?i==null?void 0:i.mode:void 0,t?l==null?void 0:l.mode:void 0),[i==null?void 0:i.mode,t,l==null?void 0:l.mode]),S=f.useMemo(()=>t?ut(i==null?void 0:i.columns):[],[i==null?void 0:i.columns,t]),k=f.useMemo(()=>t?AO(m):{},[t,m]),M=f.useMemo(()=>t?kO({selectedColumns:S,availableColumns:u,columnTypeMap:d,sampleMap:k}):PO,[u,d,t,S,k]),P=f.useMemo(()=>CO(x),[x]),T=f.useMemo(()=>rP(n?i==null?void 0:i.mode:void 0,n?l==null?void 0:l.mode:void 0),[i==null?void 0:i.mode,n,l==null?void 0:l.mode]),j=f.useMemo(()=>n?ut(i==null?void 0:i.columns):[],[i==null?void 0:i.columns,n]),O=f.useMemo(()=>n?cP(m):{},[n,m]),A=f.useMemo(()=>n?iP({selectedColumns:j,availableColumns:u,columnTypeMap:d,sampleMap:O}):mP,[u,d,n,j,O]),z=f.useMemo(()=>aP(T),[T]),$=f.useMemo(()=>{if(!n)return null;const D=(i==null?void 0:i.replacement)??(l==null?void 0:l.replacement)??null;return typeof D=="string"?D:null},[i==null?void 0:i.replacement,n,l==null?void 0:l.replacement]),q=f.useMemo(()=>UO(a?i==null?void 0:i.mode:void 0,a?l==null?void 0:l.mode:void 0),[i==null?void 0:i.mode,a,l==null?void 0:l.mode]),V=f.useMemo(()=>a?ut(i==null?void 0:i.columns):[],[i==null?void 0:i.columns,a]),R=f.useMemo(()=>a?KO(m):{},[a,m]),ee=f.useMemo(()=>a?VO({selectedColumns:V,availableColumns:u,columnTypeMap:d,sampleMap:R,mode:q}):QO,[u,d,a,V,q,R]),le=f.useMemo(()=>qO(q),[q]);return{trimWhitespace:{columnSummary:y,sampleMap:_,modeDetails:w},removeSpecial:{columnSummary:M,sampleMap:k,modeDetails:P,selectedMode:x},regexCleanup:{columnSummary:A,sampleMap:O,modeDetails:z,selectedMode:T,replacementValue:$},normalizeCase:{columnSummary:ee,sampleMap:R,modeDetails:le,selectedMode:q}}},N$={},S$=({isReplaceInvalidValuesNode:e,configState:t,nodeConfig:n,availableColumns:a,columnTypeMap:i,previewSampleRows:l})=>{const u=f.useMemo(()=>jP(e?t==null?void 0:t.mode:void 0,e?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,e,n==null?void 0:n.mode]),d=f.useMemo(()=>e?ut(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,e]),m=f.useMemo(()=>{if(!e)return null;const w=(t==null?void 0:t.min_value)??(n==null?void 0:n.min_value),x=Number(w);return Number.isFinite(x)?x:null},[t==null?void 0:t.min_value,e,n==null?void 0:n.min_value]),v=f.useMemo(()=>{if(!e)return null;const w=(t==null?void 0:t.max_value)??(n==null?void 0:n.max_value),x=Number(w);return Number.isFinite(x)?x:null},[t==null?void 0:t.max_value,e,n==null?void 0:n.max_value]),p=f.useMemo(()=>e?kP(l):N$,[e,l]),_=f.useMemo(()=>e?CP({selectedColumns:d,availableColumns:a,columnTypeMap:i,sampleMap:p}):DP,[a,i,e,p,d]),y=f.useMemo(()=>NP(u),[u]);return{selectedColumns:d,selectedMode:u,modeDetails:y,sampleMap:p,columnSummary:_,minValue:m,maxValue:v}},C$={},E$=({isStandardizeDatesNode:e,configState:t,nodeConfig:n,availableColumns:a,columnTypeMap:i,previewSampleRows:l})=>{const u=f.useMemo(()=>c0(e?t==null?void 0:t.mode:void 0,e?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,e,n==null?void 0:n.mode]),d=f.useMemo(()=>e?ut((t==null?void 0:t.columns)??(n==null?void 0:n.columns)):[],[t==null?void 0:t.columns,e,n==null?void 0:n.columns]),m=f.useMemo(()=>{if(!e)return[];const x={columns:d,mode:u,autoDetect:d.length===0};return u0((t==null?void 0:t.format_strategies)??(n==null?void 0:n.format_strategies),x)},[t==null?void 0:t.format_strategies,e,d,n==null?void 0:n.format_strategies,u]),v=f.useMemo(()=>{if(!e)return[];const x=new Set;return m.forEach(S=>{S.columns.forEach(k=>{const M=k.trim();M&&x.add(M)})}),Array.from(x).sort((S,k)=>S.localeCompare(k))},[e,m]),p=f.useMemo(()=>m.some(x=>x.autoDetect),[m]),_=f.useMemo(()=>e?YA(l):C$,[e,l]),y=f.useMemo(()=>{if(!e)return QA;const x=UA({selectedColumns:v,availableColumns:a,columnTypeMap:i,sampleMap:_});return p?{...x,autoDetectionActive:!0}:x},[a,i,p,e,_,v]),w=f.useMemo(()=>{if(!e)return[];const x=new Set(y.recommendedColumns),S=new Set(y.sampleCandidates);return a.map(k=>{const M=i[k]??null,P=_[k]??[];return{name:k,dtype:M,samples:P.slice(0,3),isRecommended:x.has(k),isSampleCandidate:S.has(k)}})},[a,y,i,e,_]);return{selectedMode:u,strategies:m,sampleMap:_,columnSummary:y,columnOptions:w}},k$=({isScalingNode:e,configState:t,numericExcludedColumns:n,scalingData:a})=>{const i=f.useMemo(()=>Vx(t),[t]),l=f.useMemo(()=>new Set(i.skippedColumns),[i.skippedColumns]),u=f.useMemo(()=>e?n:new Set,[e,n]),d=f.useMemo(()=>e?new Set(i.columns):new Set,[e,i.columns]),m=f.useMemo(()=>new Set(Object.keys(i.columnMethods)),[i.columnMethods]),v=f.useMemo(()=>Array.isArray(a==null?void 0:a.columns)?a.columns.filter(ee=>!!(ee&&ee.column)):[],[a==null?void 0:a.columns]),p=f.useMemo(()=>WM(a==null?void 0:a.methods),[a==null?void 0:a.methods]),_=f.useMemo(()=>KM(a==null?void 0:a.methods),[a==null?void 0:a.methods]),y=f.useMemo(()=>QM({recommendations:v,scalingConfig:i,scalingMethodLabelMap:p,scalingSelectedSet:d,scalingSkippedColumns:l,scalingExcludedColumns:u}),[v,i,p,d,l,u]),w=f.useMemo(()=>Array.from(m).sort((ee,le)=>ee.localeCompare(le)),[m]),x=f.useMemo(()=>w.slice(0,4),[w]),S=y.length,k=m.size,M=d.size,P=i.autoDetect,T=f.useMemo(()=>_.get(i.defaultMethod)??null,[i.defaultMethod,_]),j=f.useMemo(()=>{const ee=i.defaultMethod;return p[ee]??ol[ee]??ee},[i.defaultMethod,p]),O=S>0,A=f.useMemo(()=>y.filter(ee=>!ee.isSkipped&&!ee.isExcluded&&ee.isSelected&&ee.recommendedMethod!==ee.currentMethod).length,[y]),z=f.useMemo(()=>y.filter(ee=>ee.isSelected&&!ee.isSkipped&&!ee.isExcluded).length,[y]),$=f.useMemo(()=>y.filter(ee=>ee.isSkipped&&!ee.isExcluded).length,[y]),q=f.useMemo(()=>y.length?A>0?`${A} column${A===1?"":"s"} need attention. Apply the recommended scalers or override them manually below.`:z>0?"All configured columns align with the recommended scalers.":$>0?"All recommendations are currently skipped.":"Review the recommendations below.":"No scaling recommendations yetselect numeric columns to evaluate.",[A,z,y,$]),V=f.useMemo(()=>YM(p),[p]),R=f.useMemo(()=>GM(x,i.columnMethods,p,k),[x,i.columnMethods,p,k]);return{scalingConfig:i,scalingExcludedColumns:u,scalingMethodDetailMap:_,scalingMethodOptions:V,scalingRecommendations:v,scalingRecommendationRows:y,scalingSelectedCount:M,scalingOverrideCount:k,scalingDefaultDetail:T,scalingDefaultLabel:j,scalingAutoDetectEnabled:P,scalingHasRecommendations:O,scalingStatusMessage:q,scalingOverrideExampleSummary:R}},M$=({isOutlierNode:e,configState:t,numericExcludedColumns:n,outlierData:a})=>{const i=f.useMemo(()=>g$(t),[t]),l=f.useMemo(()=>Array.isArray(a==null?void 0:a.columns)?a.columns.filter(ee=>!!(ee&&ee.column)):[],[a==null?void 0:a.columns]),u=f.useMemo(()=>new Set(i.skippedColumns),[i.skippedColumns]),d=f.useMemo(()=>e?new Set(i.columns):new Set,[e,i.columns]),m=f.useMemo(()=>{if(!e||!n.size)return new Set;const ee=new Set;i.columns.forEach(D=>{const X=String(D??"").trim();X&&ee.add(X)}),l.forEach(D=>{const X=String((D==null?void 0:D.column)??"").trim();X&&ee.add(X)});const le=new Set;return n.forEach(D=>{ee.has(D)||le.add(D)}),le},[e,n,i.columns,l]),v=f.useMemo(()=>new Set(Object.keys(i.columnMethods)),[i.columnMethods]),p=f.useMemo(()=>_$(a==null?void 0:a.methods),[a==null?void 0:a.methods]),_=f.useMemo(()=>v$(a==null?void 0:a.methods),[a==null?void 0:a.methods]),y=f.useMemo(()=>b$({insights:l,outlierConfig:i,labelMap:p,selectedColumns:d,skippedColumns:u,excludedColumns:m}),[l,i,p,d,u,m]),w=f.useMemo(()=>y$(p),[p]),x=f.useMemo(()=>Array.from(v).sort((ee,le)=>ee.localeCompare(le)),[v]),S=f.useMemo(()=>x.slice(0,4),[x]),k=d.size,M=v.size,P=f.useMemo(()=>Object.keys(i.columnParameters).length,[i.columnParameters]),T=i.autoDetect,j=f.useMemo(()=>_.get(i.defaultMethod)??null,[i.defaultMethod,_]),O=f.useMemo(()=>{const ee=i.defaultMethod;return p[ee]??ml[ee]??ee},[i.defaultMethod,p]),A=y.length>0,z=f.useMemo(()=>y.filter(ee=>ee.isSkipped||ee.isExcluded||!ee.isSelected||!ee.recommendedMethod?!1:ee.recommendedMethod!==ee.currentMethod).length,[y]),$=f.useMemo(()=>y.filter(ee=>ee.isSelected&&!ee.isSkipped&&!ee.isExcluded).length,[y]),q=f.useMemo(()=>y.filter(ee=>ee.isSkipped&&!ee.isExcluded).length,[y]),V=f.useMemo(()=>y.length?z>0?`${z} column${z===1?"":"s"} need attention. Apply the recommended strategies or adjust manually below.`:$>0?"All configured columns align with the recommended outlier handling strategies.":q>0?"All outlier recommendations are currently skipped.":"Review the outlier diagnostics below.":"No outlier recommendations yetselect numeric columns to evaluate.",[z,$,y,q]),R=f.useMemo(()=>x$(S,i.columnMethods,p,M),[S,i.columnMethods,p,M]);return{outlierConfig:i,outlierExcludedColumns:m,outlierMethodLabelMap:p,outlierMethodDetailMap:_,outlierMethodOptions:w,outlierRecommendations:l,outlierRecommendationRows:y,outlierSelectedCount:k,outlierOverrideCount:M,outlierParameterOverrideCount:P,outlierDefaultDetail:j,outlierDefaultLabel:O,outlierAutoDetectEnabled:T,outlierHasRecommendations:A,outlierStatusMessage:V,outlierOverrideExampleSummary:R}},A$=({configState:e,nodeId:t})=>{const n=f.useMemo(()=>Rx(e),[e]),a=n.columns.length,i=Tg[n.strategy]??n.strategy,l=f.useMemo(()=>Object.keys(n.columnStrategies).map(x=>x.trim()).filter(Boolean).sort((x,S)=>x.localeCompare(S)),[n.columnStrategies]),u=l.length,d=f.useMemo(()=>{if(!l.length)return null;const x=l.slice(0,4);return AM(x,n.columnStrategies,u)},[n.columnStrategies,l,u]),m=f.useMemo(()=>`binning-${t||"node"}`,[t]),v=f.useMemo(()=>({equalWidth:`${m}-equal-width-bins`,equalFrequency:`${m}-equal-frequency-bins`,precision:`${m}-precision`,suffix:`${m}-suffix`,missingLabel:`${m}-missing-label`,includeLowest:`${m}-include-lowest`,dropOriginal:`${m}-drop-original`,labelFormat:`${m}-label-format`,duplicates:`${m}-duplicates`,kbinsNBins:`${m}-kbins-n-bins`,kbinsEncode:`${m}-kbins-encode`,kbinsStrategy:`${m}-kbins-strategy`}),[m]),[p,_]=f.useState({}),[y,w]=f.useState({});return f.useEffect(()=>{_(x=>{const S=new Set,k={...x};return n.columns.forEach(M=>{const P=String(M??"").trim();if(!P||(S.add(P),Object.prototype.hasOwnProperty.call(k,P)))return;const T=n.customBins[P]??[];k[P]=T.length>=2?T.join(", "):""}),Object.keys(k).forEach(M=>{S.has(M)||delete k[M]}),k})},[n.columns,n.customBins]),f.useEffect(()=>{w(x=>{const S=new Set,k={...x};return n.columns.forEach(M=>{const P=String(M??"").trim();if(!P||(S.add(P),Object.prototype.hasOwnProperty.call(k,P)))return;const T=n.customLabels[P]??[];k[P]=T.length>0?T.join(", "):""}),Object.keys(k).forEach(M=>{S.has(M)||delete k[M]}),k})},[n.columns,n.customLabels]),{binningConfig:n,binningSelectedCount:a,binningDefaultLabel:i,binningOverrideColumns:l,binningOverrideCount:u,binningOverrideSummary:d,fieldIds:v,customEdgeDrafts:p,setCustomEdgeDrafts:_,customLabelDrafts:y,setCustomLabelDrafts:w}},O$=({isImputerNode:e,imputerStrategies:t,availableColumns:n,columnMissingMap:a,previewColumns:i,previewColumnStats:l,nodeColumns:u,imputerMissingFilter:d})=>{const m=f.useMemo(()=>{if(!e)return[];const y=i.length?new Set(i.map(T=>typeof T=="string"?T.trim():"").filter(T=>T.length>0)):null,w=new Set;t.forEach(T=>{T.columns.forEach(j=>{const O=typeof j=="string"?j.trim():"";O&&w.add(O)})}),ut(u).forEach(T=>{T&&w.add(T)});const x=T=>!y||y.size===0?!1:!y.has(T)&&!w.has(T),S=new Map,k=(T,j)=>{const O=typeof T=="string"?T.trim():"";if(!O||x(O))return;const A=S.get(O)??{missingPercentage:null,dtype:void 0,mean:null,median:null,mode:null};j&&(typeof j.missingPercentage=="number"&&!Number.isNaN(j.missingPercentage)&&(A.missingPercentage=Math.max(0,j.missingPercentage)),j.dtype!==void 0&&(A.dtype=j.dtype),typeof j.mean=="number"&&!Number.isNaN(j.mean)&&(A.mean=j.mean),typeof j.median=="number"&&!Number.isNaN(j.median)&&(A.median=j.median),j.mode!==void 0&&j.mode!==null&&j.mode!==""&&(A.mode=j.mode)),S.set(O,A)};n.forEach(T=>{const j=Object.prototype.hasOwnProperty.call(a,T)?a[T]:null;k(T,{missingPercentage:typeof j=="number"?j:null})}),(Array.isArray(l)?l:[]).forEach(T=>{!T||!T.name||k(T.name,{missingPercentage:typeof T.missing_percentage=="number"?T.missing_percentage:null,dtype:T.dtype??null,mean:typeof T.mean=="number"?T.mean:null,median:typeof T.median=="number"?T.median:null,mode:T.mode??null})}),ut(u).forEach(T=>k(T)),t.forEach(T=>{T.columns.forEach(j=>k(j))});const P=Array.from(S.entries()).map(([T,j])=>({name:T,missingPercentage:typeof j.missingPercentage=="number"&&!Number.isNaN(j.missingPercentage)?Math.max(0,j.missingPercentage):null,dtype:j.dtype??null,mean:typeof j.mean=="number"&&!Number.isNaN(j.mean)?j.mean:null,median:typeof j.median=="number"&&!Number.isNaN(j.median)?j.median:null,mode:j.mode!==void 0&&j.mode!==null&&j.mode!==""?j.mode:null}));return P.sort((T,j)=>{const O=typeof T.missingPercentage=="number",A=typeof j.missingPercentage=="number";return O&&A&&T.missingPercentage!==j.missingPercentage?j.missingPercentage-T.missingPercentage:O!==A?O?-1:1:T.name.localeCompare(j.name)}),P},[n,a,t,u,l,i,e]),v=f.useMemo(()=>{if(!m.length)return 100;const y=m.reduce((x,S)=>{const k=typeof S.missingPercentage=="number"?S.missingPercentage:0;return k>x?k:x},0),w=Math.ceil(y/5)*5;return Math.max(100,w||0)},[m]),p=f.useMemo(()=>m.length?m.reduce((y,w)=>{const x=typeof w.missingPercentage=="number"?w.missingPercentage:null;return x!==null?x<=0?y:x>=d?y+1:y:d===0?y+1:y},0):0,[m,d]),_=d>0;return{imputerColumnOptions:m,imputerMissingSliderMax:v,imputerFilteredOptionCount:p,imputerMissingFilterActive:_}},P$=({configState:e,setConfigState:t,isFeatureTargetSplitNode:n,isTrainTestSplitNode:a,isTrainModelDraftNode:i,isHyperparameterTuningNode:l,isClassResamplingNode:u,isClassOversamplingNode:d,isClassUndersamplingNode:m,upstreamTargetColumn:v,nodeId:p,modelTypeOptions:_})=>{const y=i||l,w=f.useMemo(()=>{if(!n)return null;const $=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",q=ut(e==null?void 0:e.feature_columns).map(V=>typeof V=="string"?V.trim():"").filter(V=>!!V);return{targetColumn:$,featureColumns:q}},[e==null?void 0:e.feature_columns,e==null?void 0:e.target_column,n]),x=f.useMemo(()=>{if(!a)return null;const $=typeof(e==null?void 0:e.test_size)=="number"?e.test_size:.2,q=typeof(e==null?void 0:e.validation_size)=="number"?e.validation_size:0,V=typeof(e==null?void 0:e.random_state)=="number"?e.random_state:42,R=typeof(e==null?void 0:e.shuffle)=="boolean"?e.shuffle:!0,ee=typeof(e==null?void 0:e.stratify)=="boolean"?e.stratify:!1,le=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"";return{test_size:$,validation_size:q,random_state:V,shuffle:R,stratify:ee,target_column:le}},[e==null?void 0:e.random_state,e==null?void 0:e.shuffle,e==null?void 0:e.stratify,e==null?void 0:e.target_column,e==null?void 0:e.test_size,e==null?void 0:e.validation_size,a]),S=f.useMemo(()=>{if(!u)return null;const $=typeof(e==null?void 0:e.method)=="string"?e.method.trim():"",q=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",V=e==null?void 0:e.sampling_strategy;let R=null;if(typeof V=="number"&&Number.isFinite(V))R=V;else if(typeof V=="string"){const Y=V.trim();R=Y||null}else V===null&&(R=null);const ee=e==null?void 0:e.random_state;let le=null;if(typeof ee=="number"&&Number.isFinite(ee))le=ee;else if(typeof ee=="string"){const Y=Number(ee);le=Number.isFinite(Y)?Y:null}let D=null;if(m){const Y=e==null?void 0:e.replacement;D=typeof Y=="boolean"?Y:typeof Y=="string"?Y.trim().toLowerCase()==="true":!!Y}let X=null;if(d){const Y=e==null?void 0:e.k_neighbors;if(typeof Y=="number"&&Number.isFinite(Y))X=Math.max(1,Math.round(Y));else if(typeof Y=="string"){const K=Number(Y);Number.isFinite(K)&&(X=Math.max(1,Math.round(K)))}}return{method:$,targetColumn:q,samplingStrategy:R,randomState:le,replacement:D,kNeighbors:X}},[e==null?void 0:e.k_neighbors,e==null?void 0:e.method,e==null?void 0:e.random_state,e==null?void 0:e.replacement,e==null?void 0:e.sampling_strategy,e==null?void 0:e.target_column,d,u,m]),k=typeof(e==null?void 0:e.problem_type)=="string"?e.problem_type.trim().toLowerCase():"",M=k==="regression"?"regression":"classification",P=f.useMemo(()=>Array.isArray(_)?_.filter($=>$&&typeof $.value=="string"):[],[_]),T=f.useMemo(()=>{const $={classification:[],regression:[]};return P.forEach(q=>{var R;const V=String(((R=q==null?void 0:q.metadata)==null?void 0:R.problem_type)??"").trim().toLowerCase();V==="regression"?$.regression.push(q):V==="classification"?$.classification.push(q):($.classification.push(q),$.regression.push(q))}),$},[P]),j=f.useMemo(()=>{if(!P.length)return[];const $=M==="regression"?T.regression:T.classification;return $.length>0?$:P},[P,T,M]),O=f.useMemo(()=>y?{targetColumn:typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",problemType:M}:null,[e==null?void 0:e.target_column,y,M]),A=f.useMemo(()=>{if(!y)return{enabled:!1,strategy:"auto",folds:5,shuffle:!0,randomState:42,refitStrategy:"train_plus_validation"};const $=(e==null?void 0:e.cv_enabled)===void 0?!!l:!!e.cv_enabled,q=typeof(e==null?void 0:e.cv_strategy)=="string"?e.cv_strategy.trim().toLowerCase():"auto",V=["auto","kfold","stratified_kfold"].includes(q)?q:"auto",R=Number(e==null?void 0:e.cv_folds),ee=Number.isFinite(R)&&R>=2?Math.floor(R):5,le=(e==null?void 0:e.cv_shuffle)===void 0?!0:!!e.cv_shuffle;let D=null;if(typeof(e==null?void 0:e.cv_random_state)=="number"&&Number.isFinite(e.cv_random_state))D=Math.trunc(e.cv_random_state);else if(typeof(e==null?void 0:e.cv_random_state)=="string"){const K=Number(e.cv_random_state.trim());D=Number.isFinite(K)?Math.trunc(K):null}const Y=(typeof(e==null?void 0:e.cv_refit_strategy)=="string"?e.cv_refit_strategy.trim().toLowerCase():"train_plus_validation")==="train_only"?"train_only":"train_plus_validation";return{enabled:$,strategy:V,folds:ee,shuffle:le,randomState:D,refitStrategy:Y}},[e==null?void 0:e.cv_enabled,e==null?void 0:e.cv_folds,e==null?void 0:e.cv_random_state,e==null?void 0:e.cv_refit_strategy,e==null?void 0:e.cv_shuffle,e==null?void 0:e.cv_strategy,l,y]);f.useEffect(()=>{y&&k!==M&&t($=>({...$,problem_type:M}))},[y,M,k,t]),f.useEffect(()=>{var R;if(!y||!j.length)return;const $=new Set(j.map(ee=>ee.value)),q=typeof(e==null?void 0:e.model_type)=="string"?e.model_type.trim():"";if(q&&$.has(q))return;const V=((R=j[0])==null?void 0:R.value)??"";V&&t(ee=>{const le=typeof(ee==null?void 0:ee.model_type)=="string"?ee.model_type.trim():"";return le&&$.has(le)||le===V?ee:{...ee,model_type:V}})},[e==null?void 0:e.model_type,j,y,t]);const z=f.useMemo(()=>{if(!y)return null;const $=typeof(e==null?void 0:e.model_type)=="string"?e.model_type.trim():"",q=e==null?void 0:e.hyperparameters;let V=null,R=null;if(q&&typeof q=="string"){const ee=q.trim();if(ee.length)try{const le=JSON.parse(ee);le&&typeof le=="object"&&!Array.isArray(le)?V=le:R="Hyperparameters JSON must be an object."}catch{R="Hyperparameters JSON is invalid. Provide a valid JSON object."}}else q&&typeof q=="object"&&!Array.isArray(q)&&(V=q);return{modelType:$||null,hyperparameters:V,hyperparametersError:R}},[e==null?void 0:e.hyperparameters,e==null?void 0:e.model_type,y]);return f.useEffect(()=>{(a||i||l)&&v&&(a&&(e==null?void 0:e.stratify)!==!0||t($=>(typeof($==null?void 0:$.target_column)=="string"?$.target_column.trim():"")?$:{...$,target_column:v}))},[e==null?void 0:e.stratify,l,i,a,p,t,v]),{featureTargetSplitConfig:w,trainTestSplitConfig:x,resamplingConfig:S,trainModelDraftConfig:O,trainModelRuntimeConfig:z,trainModelCVConfig:A,filteredModelTypeOptions:j}},T$=["int","float","double","numeric","number"],Lw=e=>{if(!e)return!1;const t=e.toLowerCase();return T$.some(n=>t.includes(n))},$$=({skewnessData:e,shouldLoadInsights:t,skewnessTransformations:n,availableColumns:a,previewColumns:i,columnTypeMap:l,updateSkewnessTransformations:u})=>{const[d,m]=f.useState("recommended"),[v,p]=f.useState(!1),[_,y]=f.useState("before"),w=n.length,x=f.useMemo(()=>e!=null&&e.methods?[...e.methods]:[],[e==null?void 0:e.methods]),S=f.useMemo(()=>eA(x),[x]),k=f.useMemo(()=>e!=null&&e.columns?[...e.columns]:[],[e==null?void 0:e.columns]),M=f.useMemo(()=>{const K=new Map;return k.forEach(U=>{U&&U.column&&K.set(U.column,U)}),K},[k]),P=f.useMemo(()=>{const K=new Set;return k.forEach(U=>{U!=null&&U.column&&K.add(U.column)}),a.forEach(U=>{U&&Lw(l[U]??null)&&K.add(U)}),i.forEach(U=>{const te=typeof U=="string"?U.trim():"";te&&Lw(l[te]??null)&&K.add(te)}),Array.from(K).sort((U,te)=>U.localeCompare(te))},[a,i,k,l]);f.useEffect(()=>{d==="recommended"&&k.length===0&&P.length>0&&m("all")},[P.length,k.length,d]);const T=(e==null?void 0:e.skewness_threshold)??null,j=f.useCallback(K=>S[K]??K,[S]),O=f.useCallback((K,U)=>{const te=M.get(K);return!te||!te.method_status?{status:"ready",reason:void 0}:te.method_status[U]??{status:"ready",reason:void 0}},[M]),A=f.useCallback(()=>{const K=k.map(U=>{if(!U||!U.column)return null;const te=Array.isArray(U.recommended_methods)?U.recommended_methods.find(uo):void 0;return te?{column:U.column,method:te}:null}).filter(U=>!!U);K.length&&u(U=>{const te=new Map;return U.forEach(W=>{const I=typeof W.column=="string"?W.column.trim():"";I&&uo(W.method)&&te.set(I,W.method)}),K.forEach(W=>{const I=typeof W.column=="string"?W.column.trim():"";I&&te.set(I,W.method)}),Array.from(te.entries()).map(([W,I])=>({column:W,method:I}))})},[k,u]),z=f.useMemo(()=>{const K=new Map;return n.forEach(U=>{const te=typeof U.column=="string"?U.column.trim():"";!te||K.has(te)||K.set(te,U.method)}),K},[n]),$=f.useCallback((K,U)=>{const te=typeof K=="string"?K.trim():"";te&&u(W=>{const I=W.filter(Q=>Q.column!==te);return U?[...I,{column:te,method:U}]:I})},[u]),q=f.useCallback((K,U)=>{if(K){if(!U){$(K,null);return}uo(U)&&$(K,U)}},[$]),V=f.useCallback(()=>{u(()=>[])},[u]),R=k.length,ee=f.useMemo(()=>k.some(K=>K&&typeof K.column=="string"&&Array.isArray(K.recommended_methods)&&K.recommended_methods.some(uo)),[k]),le=P.length,D=f.useMemo(()=>tA({viewMode:d,recommendations:k,columnOptions:P,recommendationMap:M,transformationMap:z}),[d,k,P,M,z]),X=f.useMemo(()=>t?k.map(K=>{var ne;if(!K||!K.column)return null;const U=K.distribution_before??K.distribution??null;if(!U||!Array.isArray(U.bin_edges)||!Array.isArray(U.counts)||U.counts.length===0||U.bin_edges.length!==U.counts.length+1)return null;let te=K.distribution_after??null;te&&(!Array.isArray(te.bin_edges)||!Array.isArray(te.counts)||te.counts.length===0||te.bin_edges.length!==te.counts.length+1)&&(te=null);const W=((ne=K.recommended_methods)==null?void 0:ne.find(uo))??null,I=K.magnitude?`${K.magnitude.charAt(0).toUpperCase()}${K.magnitude.slice(1)}`:null,Q=K.direction?Kx[K.direction]??K.direction:null,me=K.applied_method&&uo(K.applied_method)?K.applied_method:null,J=z.get(K.column)??null,H=me??J??null,Z=H?j(H):null;return{column:K.column,skewness:typeof K.skewness=="number"?K.skewness:null,magnitudeLabel:I,directionLabel:Q,summary:K.summary??null,recommendedLabel:Z?null:W?j(W):null,appliedLabel:Z,distributionBefore:U,distributionAfter:te}}).filter(K=>!!K).sort((K,U)=>{const te=K.skewness!==null?Math.abs(K.skewness):-1/0,W=U.skewness!==null?Math.abs(U.skewness):-1/0;return te!==W?W-te:K.column.localeCompare(U.column)}):[],[j,t,k,z]),Y=f.useMemo(()=>nA(D,v,j),[D,v,j]);return{skewnessThreshold:T,skewnessViewMode:d,setSkewnessViewMode:m,skewnessGroupByMethod:v,setSkewnessGroupByMethod:p,skewnessDistributionView:_,setSkewnessDistributionView:y,skewnessRecommendedCount:R,skewnessNumericCount:le,skewnessTransformationsCount:w,hasSkewnessAutoRecommendations:ee,skewnessRows:D,skewnessTableGroups:Y,skewnessDistributionCards:X,getSkewnessMethodLabel:j,getSkewnessMethodStatus:O,applySkewnessRecommendations:A,handleSkewnessOverrideChange:q,clearSkewnessTransformations:V}},o_={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,highCardinalityColumns:[],notes:[]},L$=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},i_=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],D$=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const a=L$(t.status),i=typeof t.reason=="string"?t.reason:"",l=typeof t.dtype=="string"?t.dtype:null,u=typeof t.unique_count=="number"?t.unique_count:null,d=typeof t.unique_percentage=="number"?t.unique_percentage:null,m=typeof t.missing_percentage=="number"?t.missing_percentage:null,v=typeof t.text_category=="string"?t.text_category:null,p=i_(t.sample_values),_=typeof t.score=="number"?t.score:0,y=typeof t.selectable=="boolean"?t.selectable:!0;return{column:n,status:a,reason:i,dtype:l,unique_count:u,unique_percentage:d,missing_percentage:m,text_category:v,sample_values:p,score:_,selectable:y}}).filter(t=>!!t),z$=e=>{if(!e||typeof e!="object")return{...o_};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,a=Number(e.total_text_columns??0)||0,i=Number(e.recommended_count??0)||0,l=!!e.auto_detect_default,u=i_(e.high_cardinality_columns),d=i_(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:a,recommendedCount:i,autoDetectDefault:l,highCardinalityColumns:u,notes:d}},R$=({isLabelEncodingNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(!1),[d,m]=f.useState(null),[v,p]=f.useState([]),[_,y]=f.useState({...o_}),[w,x]=f.useState(0);f.useEffect(()=>{let P=!0;const T=j=>{p([]),y({...o_}),u(!1),m(j??null)};return e?t?n?(u(!0),m(null),cx(t,{graph:a??null,targetNodeId:i??null}).then(j=>{P&&(p(D$(j)),y(z$(j)))}).catch(j=>{if(!P)return;const O=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load label encoding suggestions";T(O)}).finally(()=>{P&&u(!1)}),()=>{P=!1}):(T("Connect this node to the dataset input to load suggestions."),()=>{P=!1}):(T(),()=>{P=!1}):(T(),()=>{P=!1})},[a,n,e,w,t,i]);const S=f.useCallback(()=>{!e||!t||!n||x(P=>P+1)},[n,e,t]),k=f.useMemo(()=>_,[_]),M=f.useMemo(()=>v,[v]);return{isFetching:l,error:d,suggestions:M,metadata:k,refresh:S}},l_={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,enableGlobalFallbackDefault:!1,highCardinalityColumns:[],notes:[]},F$=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},c_=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],I$=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const a=F$(t.status),i=typeof t.reason=="string"?t.reason:"",l=typeof t.dtype=="string"?t.dtype:null,u=typeof t.unique_count=="number"?t.unique_count:null,d=typeof t.unique_percentage=="number"?t.unique_percentage:null,m=typeof t.missing_percentage=="number"?t.missing_percentage:null,v=typeof t.text_category=="string"?t.text_category:null,p=c_(t.sample_values),_=typeof t.score=="number"?t.score:0,y=typeof t.selectable=="boolean"?t.selectable:!0,w=typeof t.recommended_use_global_fallback=="boolean"?t.recommended_use_global_fallback:!!(t.missing_percentage&&t.missing_percentage>0);return{column:n,status:a,reason:i,dtype:l,unique_count:u,unique_percentage:d,missing_percentage:m,text_category:v,sample_values:p,score:_,selectable:y,recommended_use_global_fallback:w}}).filter(t=>!!t),B$=e=>{if(!e||typeof e!="object")return{...l_};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,a=Number(e.total_text_columns??0)||0,i=Number(e.recommended_count??0)||0,l=!!e.enable_global_fallback_default,u=c_(e.high_cardinality_columns),d=c_(e.notes),m=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:a,recommendedCount:i,autoDetectDefault:m,enableGlobalFallbackDefault:l,highCardinalityColumns:u,notes:d}},U$=({isTargetEncodingNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(!1),[d,m]=f.useState(null),[v,p]=f.useState([]),[_,y]=f.useState({...l_}),[w,x]=f.useState(0);f.useEffect(()=>{let P=!0;const T=j=>{p([]),y({...l_}),u(!1),m(j??null)};return e?t?n?(u(!0),m(null),dx(t,{graph:a??null,targetNodeId:i??null}).then(j=>{P&&(p(I$(j)),y(B$(j)))}).catch(j=>{if(!P)return;const O=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load target encoding suggestions";T(O)}).finally(()=>{P&&u(!1)}),()=>{P=!1}):(T("Connect this node to the dataset input to load suggestions."),()=>{P=!1}):(T(),()=>{P=!1}):(T(),()=>{P=!1})},[a,n,e,w,t,i]);const S=f.useCallback(()=>{!e||!t||!n||x(P=>P+1)},[n,e,t]),k=f.useMemo(()=>_,[_]),M=f.useMemo(()=>v,[v]);return{isFetching:l,error:d,suggestions:M,metadata:k,refresh:S}},Zf={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,suggestedBucketDefault:0,highCardinalityColumns:[],notes:[]},q$=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},u_=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],H$=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const a=q$(t.status),i=typeof t.reason=="string"?t.reason:"",l=typeof t.dtype=="string"?t.dtype:null,u=typeof t.unique_count=="number"?t.unique_count:null,d=typeof t.unique_percentage=="number"?t.unique_percentage:null,m=typeof t.missing_percentage=="number"?t.missing_percentage:null,v=typeof t.text_category=="string"?t.text_category:null,p=u_(t.sample_values),_=typeof t.score=="number"?t.score:0,y=typeof t.selectable=="boolean"?t.selectable:!0,w=typeof t.recommended_bucket_count=="number"?Math.max(2,Math.round(t.recommended_bucket_count)):0;return{column:n,status:a,reason:i,dtype:l,unique_count:u,unique_percentage:d,missing_percentage:m,text_category:v,sample_values:p,score:_,selectable:y,recommended_bucket_count:w}}).filter(t=>!!t),V$=e=>{if(!e||typeof e!="object")return{...Zf};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,a=Number(e.total_text_columns??0)||0,i=Number(e.recommended_count??0)||0,l=!!e.auto_detect_default,u=Number(e.suggested_bucket_default??0)||0,d=u_(e.high_cardinality_columns),m=u_(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:a,recommendedCount:i,autoDetectDefault:l,suggestedBucketDefault:u,highCardinalityColumns:d,notes:m}},W$=({isHashEncodingNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(!1),[d,m]=f.useState(null),[v,p]=f.useState([]),[_,y]=f.useState({...Zf}),[w,x]=f.useState(0),S=f.useCallback(P=>{p([]),y({...Zf}),u(!1),m(P??null)},[]);f.useEffect(()=>{let P=!0;return e?t?n?(u(!0),m(null),mx(t,{graph:a??null,targetNodeId:i??null}).then(T=>{P&&(p(H$(T)),y(V$(T)))}).catch(T=>{P&&(p([]),y({...Zf}),m(T!=null&&T.message?String(T.message):"Unable to load hash encoding suggestions"))}).finally(()=>{P&&u(!1)}),()=>{P=!1}):(S("Connect this node to the dataset input to load suggestions."),()=>{P=!1}):(S(),()=>{P=!1}):(S(),()=>{P=!1})},[a,n,e,S,t,i,w]);const k=f.useCallback(()=>{x(P=>P+1)},[]);return f.useMemo(()=>({isFetching:l,error:d,suggestions:v,metadata:_,refresh:k}),[d,l,_,k,v])},d_={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,enableUnknownDefault:!1,highCardinalityColumns:[],notes:[]},K$=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},m_=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],Y$=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const a=K$(t.status),i=typeof t.reason=="string"?t.reason:"",l=typeof t.dtype=="string"?t.dtype:null,u=typeof t.unique_count=="number"?t.unique_count:null,d=typeof t.unique_percentage=="number"?t.unique_percentage:null,m=typeof t.missing_percentage=="number"?t.missing_percentage:null,v=typeof t.text_category=="string"?t.text_category:null,p=m_(t.sample_values),_=typeof t.score=="number"?t.score:0,y=typeof t.selectable=="boolean"?t.selectable:!0,w=typeof t.recommended_handle_unknown=="boolean"?t.recommended_handle_unknown:!!(t.missing_percentage&&t.missing_percentage>0);return{column:n,status:a,reason:i,dtype:l,unique_count:u,unique_percentage:d,missing_percentage:m,text_category:v,sample_values:p,score:_,selectable:y,recommended_handle_unknown:w}}).filter(t=>!!t),Q$=e=>{if(!e||typeof e!="object")return{...d_};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,a=Number(e.total_text_columns??0)||0,i=Number(e.recommended_count??0)||0,l=!!e.enable_unknown_default,u=m_(e.high_cardinality_columns),d=m_(e.notes),m=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:a,recommendedCount:i,autoDetectDefault:m,enableUnknownDefault:l,highCardinalityColumns:u,notes:d}},G$=({isOrdinalEncodingNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(!1),[d,m]=f.useState(null),[v,p]=f.useState([]),[_,y]=f.useState({...d_}),[w,x]=f.useState(0);f.useEffect(()=>{let P=!0;const T=j=>{p([]),y({...d_}),u(!1),m(j??null)};return e?t?n?(u(!0),m(null),ux(t,{graph:a??null,targetNodeId:i??null}).then(j=>{P&&(p(Y$(j)),y(Q$(j)))}).catch(j=>{if(!P)return;const O=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load ordinal encoding suggestions";T(O)}).finally(()=>{P&&u(!1)}),()=>{P=!1}):(T("Connect this node to the dataset input to load suggestions."),()=>{P=!1}):(T(),()=>{P=!1}):(T(),()=>{P=!1})},[a,n,e,w,t,i]);const S=f.useCallback(()=>{!e||!t||!n||x(P=>P+1)},[n,e,t]),k=f.useMemo(()=>_,[_]),M=f.useMemo(()=>v,[v]);return{isFetching:l,error:d,suggestions:M,metadata:k,refresh:S}},f_={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,cautionedCount:0,highCardinalityColumns:[],notes:[],autoDetectDefault:!1},X$=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},h_=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],J$=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const a=X$(t.status),i=typeof t.reason=="string"?t.reason:"",l=typeof t.dtype=="string"?t.dtype:null,u=typeof t.unique_count=="number"?t.unique_count:null,d=typeof t.unique_percentage=="number"?t.unique_percentage:null,m=typeof t.missing_percentage=="number"?t.missing_percentage:null,v=typeof t.text_category=="string"?t.text_category:null,p=h_(t.sample_values),_=typeof t.estimated_dummy_columns=="number"?Math.max(0,Math.round(t.estimated_dummy_columns)):0,y=typeof t.score=="number"?t.score:0,w=typeof t.selectable=="boolean"?t.selectable:!0,x=typeof t.recommended_drop_first=="boolean"?t.recommended_drop_first:!0;return{column:n,status:a,reason:i,dtype:l,unique_count:u,unique_percentage:d,missing_percentage:m,text_category:v,sample_values:p,estimated_dummy_columns:_,score:y,selectable:w,recommended_drop_first:x}}).filter(t=>!!t),Z$=e=>{if(!e||typeof e!="object")return{...f_};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,a=Number(e.total_text_columns??0)||0,i=Number(e.recommended_count??0)||0,l=Number(e.cautioned_count??0)||0,u=h_(e.high_cardinality_columns),d=h_(e.notes),m=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:a,recommendedCount:i,cautionedCount:l,highCardinalityColumns:u,notes:d,autoDetectDefault:m}},eL=({isDummyEncodingNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(!1),[d,m]=f.useState(null),[v,p]=f.useState([]),[_,y]=f.useState({...f_}),[w,x]=f.useState(0);f.useEffect(()=>{let P=!0;const T=j=>{p([]),y({...f_}),u(!1),m(j??null)};return e?t?n?(u(!0),m(null),hx(t,{graph:a??null,targetNodeId:i??null}).then(j=>{P&&(p(J$(j)),y(Z$(j)))}).catch(j=>{if(!P)return;const O=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load dummy encoding suggestions";T(O)}).finally(()=>{P&&u(!1)}),()=>{P=!1}):(T("Connect this node to the dataset input to load suggestions."),()=>{P=!1}):(T(),()=>{P=!1}):(T(),()=>{P=!1})},[a,n,e,w,t,i]);const S=f.useCallback(()=>{!e||!t||!n||x(P=>P+1)},[n,e,t]),k=f.useMemo(()=>_,[_]),M=f.useMemo(()=>v,[v]);return{isFetching:l,error:d,suggestions:M,metadata:k,refresh:S}},p_={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,cautionedCount:0,highCardinalityColumns:[],notes:[]},tL=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},g_=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],nL=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const a=tL(t.status),i=typeof t.reason=="string"?t.reason:"",l=typeof t.dtype=="string"?t.dtype:null,u=typeof t.unique_count=="number"?t.unique_count:null,d=typeof t.unique_percentage=="number"?t.unique_percentage:null,m=typeof t.missing_percentage=="number"?t.missing_percentage:null,v=typeof t.text_category=="string"?t.text_category:null,p=g_(t.sample_values),_=typeof t.estimated_dummy_columns=="number"?Math.max(0,Math.round(t.estimated_dummy_columns)):0,y=typeof t.score=="number"?t.score:0,w=typeof t.selectable=="boolean"?t.selectable:!0,x=typeof t.recommended_drop_first=="boolean"?t.recommended_drop_first:!1;return{column:n,status:a,reason:i,dtype:l,unique_count:u,unique_percentage:d,missing_percentage:m,text_category:v,sample_values:p,estimated_dummy_columns:_,score:y,selectable:w,recommended_drop_first:x}}).filter(t=>!!t),sL=e=>{if(!e||typeof e!="object")return{...p_};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,a=Number(e.total_text_columns??0)||0,i=Number(e.recommended_count??0)||0,l=Number(e.cautioned_count??0)||0,u=g_(e.high_cardinality_columns),d=g_(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:a,recommendedCount:i,cautionedCount:l,highCardinalityColumns:u,notes:d}},rL=({isOneHotEncodingNode:e,sourceId:t,hasReachableSource:n,graphContext:a,targetNodeId:i})=>{const[l,u]=f.useState(!1),[d,m]=f.useState(null),[v,p]=f.useState([]),[_,y]=f.useState({...p_}),[w,x]=f.useState(0);f.useEffect(()=>{let P=!0;const T=j=>{p([]),y({...p_}),u(!1),m(j??null)};return e?t?n?(u(!0),m(null),fx(t,{graph:a??null,targetNodeId:i??null}).then(j=>{P&&(p(nL(j)),y(sL(j)))}).catch(j=>{if(!P)return;const O=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load one-hot encoding suggestions";T(O)}).finally(()=>{P&&u(!1)}),()=>{P=!1}):(T("Connect this node to the dataset input to load suggestions."),()=>{P=!1}):(T(),()=>{P=!1}):(T(),()=>{P=!1})},[a,n,e,w,t,i]);const S=f.useCallback(()=>{!e||!t||!n||x(P=>P+1)},[n,e,t]),k=f.useMemo(()=>_,[_]),M=f.useMemo(()=>v,[v]);return{isFetching:l,error:d,suggestions:M,metadata:k,refresh:S}},aL={trim_whitespace:{title:"Use after Dataset snapshot or Missing indicator nodes",body:"Great for cleaning string columns before alias replacement or case normalization. Auto-detects text columns when left blank."},normalize_text_case:{title:"Use after trimming and alias cleanup",body:"Keeps categorical values consistent for joins and grouping. Pair with Dataset profile or Preview to confirm column impacts."},replace_aliases_typos:{title:"Requires Dataset profile insights",body:"Apply after profiling so you can confirm value distributions. Combine with custom pairs to align business-specific labels."},standardize_date_formats:{title:"Run after parsing-friendly nodes",body:"Normalizes mixed date strings into the format you choose. Works best once whitespace and punctuation cleanup nodes have run."},remove_special_characters:{title:"Pair with Trim whitespace or Regex cleanup",body:"Strips punctuation or noise from text fields before alias grouping. Preview to ensure replacements retain the intent of each field."},replace_invalid_values:{title:"Use after Outlier diagnostics or Dataset profile",body:"Flags negative, zero, or out-of-range numeric placeholders and converts them to missing for downstream handling."},regex_replace_fix:{title:"Configure after reviewing Dataset snapshot",body:"Use presets for quick fixes or supply a custom regex. Ideal before date standardization or alias cleanup passes."}},oL=(e,t)=>{var i;const n=(i=e==null?void 0:e.parameter_help)==null?void 0:i[t];if(n)return n;const a=t.replace(/_/g," ").trim();return a.charAt(0).toUpperCase()+a.slice(1)},iL=e=>{if(!e)return null;const t=[];if(e.removed_rows&&e.removed_rows>0&&t.push(`Removed ${e.removed_rows} row${e.removed_rows===1?"":"s"}`),Array.isArray(e.clipped_columns)&&e.clipped_columns.length){const n=Array.from(new Set(e.clipped_columns));t.push(`Winsorized ${n.length} column${n.length===1?"":"s"}`)}if(t.length||t.push("No rows removed or clipped during the last preview"),Array.isArray(e.skipped_columns)&&e.skipped_columns.length){const n=e.skipped_columns.join(", ");t.push(`Skipped columns: ${n}`)}return t.join("  ")},lL=(e,t,n,a,i)=>{var v;const l=n[a]??{};if(Object.prototype.hasOwnProperty.call(l,t)){const p=l[t];if(typeof p=="number"&&Number.isFinite(p))return{value:p,fallback:null}}const d=(i[e]??{})[t];return typeof d=="number"&&Number.isFinite(d)?{value:"",fallback:d}:{value:"",fallback:((v=ti[e])==null?void 0:v[t])??null??null}},Dw=e=>typeof e=="number"&&Number.isFinite(e)?String(e):"",zw={lower_percentile:"%",upper_percentile:"%"},cL=({sourceId:e,hasReachableSource:t,isFetchingOutliers:n,outlierConfig:a,outlierMethodOptions:i,outlierMethodDetailMap:l,outlierDefaultDetail:u,outlierAutoDetectEnabled:d,outlierSelectedCount:m,outlierDefaultLabel:v,outlierOverrideCount:p,outlierParameterOverrideCount:_,outlierOverrideExampleSummary:y,outlierHasOverrides:w,outlierRecommendationRows:x,outlierHasRecommendations:S,outlierStatusMessage:k,outlierError:M,outlierSampleSize:P,relativeOutlierGeneratedAt:T,outlierPreviewSignal:j,formatMetricValue:O,formatNumericStat:A,onApplyAllRecommendations:z,onClearOverrides:$,onDefaultMethodChange:q,onAutoDetectToggle:V,onOverrideSelect:R,onMethodParameterChange:ee,onColumnParameterChange:le})=>{const D=iL(j);return r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Outlier insights"}),r.jsxs("div",{className:"canvas-modal__section-actions",children:[r.jsx("button",{type:"button",className:"btn btn-primary",onClick:z,disabled:!S,children:"Apply recommendations"}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:$,disabled:!w,children:"Clear overrides"})]})]}),r.jsx("p",{className:"canvas-modal__note",children:"Diagnose numeric outliers and configure how to handle them across the dataset. Preview updates immediately, letting you validate the impact before saving this node."}),!e&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface outlier diagnostics."}),e&&!t&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric distributions."}),T&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",T,P!==null?` on ${O(P)} row${P===1?"":"s"}.`:"."]}),!T&&P!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Insights generated on ",O(P)," row",P===1?"":"s","."]}),D&&r.jsxs("p",{className:"canvas-modal__note",children:["Last preview: ",D]}),r.jsxs("div",{className:"canvas-modal__parameter-grid",children:[r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("span",{children:"Default outlier method"})}),r.jsx("div",{className:"canvas-scaling__method-toggle",role:"group","aria-label":"Default outlier method",children:i.map(X=>{const Y=l.get(X.value)??null,K=X.value===a.defaultMethod;return r.jsxs("button",{type:"button",className:`canvas-scaling__method-button${K?" canvas-scaling__method-button--active":""}`,"aria-pressed":K,onClick:()=>q(X.value),children:[r.jsx("span",{className:"canvas-scaling__method-label",children:X.label}),(Y==null?void 0:Y.description)&&r.jsx("span",{className:"canvas-scaling__method-description",children:Y.description})]},X.value)})}),(u==null?void 0:u.description)&&r.jsx("p",{className:"canvas-modal__parameter-description",children:u.description})]}),r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("span",{children:"Auto-detect numeric columns"})}),r.jsxs("label",{className:"canvas-modal__boolean-control",children:[r.jsx("input",{type:"checkbox",checked:d,onChange:X=>V(X.target.checked)}),r.jsx("span",{children:d?"Enabled":"Disabled"})]}),r.jsx("p",{className:"canvas-modal__parameter-description",children:"Auto-detection tracks numeric features so newly profiled columns join the node automatically."})]})]}),r.jsxs("section",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("span",{children:"Global method parameters"})}),r.jsx("p",{className:"canvas-modal__parameter-description canvas-outlier__method-note",children:"Tune default thresholds for each strategy. Column overrides can refine these further."}),r.jsx("div",{className:"canvas-outlier__method-grid",children:lr.map(X=>{const Y=l.get(X)??null,K=Xf[X];if(!K.length)return null;const U=(Y==null?void 0:Y.label)??ml[X]??X;return r.jsxs("article",{className:"canvas-outlier__method-card",children:[r.jsxs("header",{className:"canvas-outlier__method-header",children:[r.jsx("span",{className:"canvas-outlier__method-title",children:U}),(Y==null?void 0:Y.description)&&r.jsx("p",{className:"canvas-outlier__method-summary",children:Y.description})]}),r.jsx("div",{className:"canvas-outlier__parameter-list",children:K.map(te=>{var Q,me;const W=((Q=a.methodParameters[X])==null?void 0:Q[te])??null,I=zw[te]??"";return r.jsxs("label",{className:"canvas-outlier__method-parameter",children:[r.jsx("span",{className:"canvas-outlier__parameter-label",children:oL(Y,te)}),r.jsxs("div",{className:"canvas-outlier__method-input",children:[r.jsx("input",{type:"number",className:"canvas-outlier__method-input-field",value:typeof W=="number"&&Number.isFinite(W)?W:"",placeholder:Dw(((me=ti[X])==null?void 0:me[te])??null),onChange:J=>{const H=J.target.value;if(H==="")ee(X,te,null);else{const Z=Number(H);ee(X,te,Number.isFinite(Z)?Z:null)}}}),I&&r.jsx("span",{className:"canvas-outlier__parameter-suffix",children:I})]})]},`${X}-${te}`)})})]},`outlier-method-${X}`)})})]}),r.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",r.jsx("strong",{children:m})," column",m===1?"":"s","  Default method"," ",r.jsx("strong",{children:v})," ",d?" Auto-detect on":" Auto-detect off",(()=>{if(!(p+_))return"  No overrides yet";const Y=[];return p>0&&Y.push(y?`${p} method override${p===1?"":"s"} (${y})`:`${p} method override${p===1?"":"s"}`),_>0&&Y.push(`${_} parameter override${_===1?"":"s"}`),`  Overrides: ${Y.join("; ")}`})()]}),n&&r.jsx("p",{className:"canvas-modal__note",children:"Loading outlier diagnostics"}),!n&&M&&e&&t&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:M}),!n&&!M&&r.jsxs(r.Fragment,{children:[k&&r.jsx("p",{className:"canvas-modal__note",children:k}),x.length>0&&r.jsx("div",{className:"canvas-cast__body",children:r.jsx("div",{className:"canvas-cast__table-wrapper",children:r.jsxs("table",{className:"canvas-cast__table canvas-scaling__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",children:"Column"}),r.jsx("th",{scope:"col",children:"Recommendation"}),r.jsx("th",{scope:"col",children:"Distribution"}),r.jsx("th",{scope:"col",children:"Configured method"})]})}),r.jsx("tbody",{children:x.map(X=>{const Y=!X.isSkipped&&!X.isExcluded&&X.recommendedMethod&&X.recommendedMethod!==X.currentMethod,K=["canvas-cast__row"];Y&&K.push("canvas-cast__row--attention"),X.isOverrideApplied&&K.push("canvas-cast__row--override"),X.isSkipped&&K.push("canvas-cast__row--muted");const U=X.isSkipped?"__skip__":X.isOverrideApplied?X.currentMethod:"__default__",te=X.isOverrideApplied?`Override -> ${X.currentMethodLabel}`:X.isSkipped?"Skipped (column will not be altered)":X.isSelected?`Inheriting ${v}`:"Pending inclusion",W=X.stats,I=[];typeof W.valid_count=="number"&&Number.isFinite(W.valid_count)&&I.push(`${O(W.valid_count)} valid rows`);const Q=typeof W.minimum=="number"&&Number.isFinite(W.minimum),me=typeof W.maximum=="number"&&Number.isFinite(W.maximum);if(Q||me){const ae=Q?A(W.minimum):"",pe=me?A(W.maximum):"";I.push(`Range ${ae}  ${pe}`)}typeof W.mean=="number"&&Number.isFinite(W.mean)&&I.push(`Mean ${A(W.mean)}`),typeof W.median=="number"&&Number.isFinite(W.median)&&I.push(`Median ${A(W.median)}`),typeof W.stddev=="number"&&Number.isFinite(W.stddev)&&I.push(` ${A(W.stddev)}`);const J=I.length?I.join("  "):null,H=!X.recommendedMethod||!X.recommendedLabel?X.recommendedReason||"No outlier risk detected":X.recommendedReason?`${X.recommendedLabel}  ${X.recommendedReason}`:X.recommendedLabel,Z=a.columnParameters,ne=a.methodParameters,fe=Xf[X.currentMethod]??[];return r.jsxs("tr",{className:K.join(" "),children:[r.jsx("th",{scope:"row",children:r.jsxs("div",{className:"canvas-cast__column-cell",children:[r.jsx("span",{className:"canvas-cast__column-name",children:X.column}),r.jsxs("div",{className:"canvas-cast__column-meta",children:[X.dtype&&r.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",X.dtype]}),X.isExcluded&&r.jsx("span",{className:"canvas-cast__muted",children:"Excluded from outlier evaluation (non-numeric)"}),X.isSelected&&!X.isExcluded&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),X.isSkipped&&!X.isExcluded&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--skipped",children:"Skipped"}),X.isOverrideApplied&&r.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),X.hasMissing&&r.jsx("span",{className:"canvas-cast__muted",children:"Contains missing values"})]})]})}),r.jsx("td",{children:r.jsxs("div",{className:"canvas-cast__recommendation",children:[X.recommendedLabel?r.jsx("span",{className:`canvas-cast__chip${Y?" canvas-cast__chip--attention":" canvas-cast__chip--applied"}`,children:X.recommendedLabel}):r.jsx("span",{className:"canvas-cast__chip",children:"No action needed"}),H&&r.jsx("span",{className:"canvas-cast__recommendation-note",children:H})]})}),r.jsx("td",{children:J?r.jsx("span",{children:J}):r.jsx("span",{className:"canvas-cast__muted",children:"No distribution summary"})}),r.jsx("td",{children:r.jsxs("div",{className:"canvas-cast__target",children:[r.jsxs("select",{value:U,onChange:ae=>R(X.column,ae.target.value),disabled:X.isExcluded,children:[r.jsxs("option",{value:"__default__",children:["Inherit default (",v,")"]}),r.jsx("option",{value:"__skip__",children:"Skip outlier handling"}),i.map(ae=>r.jsx("option",{value:ae.value,children:ae.label},`${X.column}-${ae.value}`))]}),r.jsx("span",{className:"canvas-cast__target-note",children:te}),fe.length>0&&!X.isExcluded&&r.jsx("div",{className:"canvas-outlier__parameters",children:fe.map(ae=>{const{value:pe,fallback:Ve}=lL(X.currentMethod,ae,Z,X.column,ne),st=zw[ae]??"";return r.jsxs("label",{children:[r.jsx("span",{children:ae.replace(/_/g," ")}),r.jsx("input",{type:"number",value:pe,placeholder:Dw(Ve),onChange:Ke=>{const mt=Ke.target.value;if(mt==="")le(X.column,ae,null);else{const yt=Number(mt);le(X.column,ae,Number.isFinite(yt)?yt:null)}}}),st&&r.jsx("span",{className:"canvas-outlier__parameter-suffix",children:st})]},`${X.column}-${X.currentMethod}-${ae}`)})})]})})]},`outlier-row-${X.column}`)})})]})})})]})]})},Rw=(e,t)=>{if(!t||typeof t!="string")return null;const n=`${e}-`;if(t.startsWith(n))return t.slice(n.length);const a=t.split("-");return a.length>=2?a.slice(-2).join("-"):t},uL=({counts:e,binEdges:t,className:n})=>{const a=f.useId(),i=n??"canvas-skewness__histogram";if(!e||e.length===0||!t||t.length!==e.length+1)return r.jsx("div",{className:i,"aria-hidden":"true"});const l=e.reduce((m,v)=>Math.max(m,v),0),u=l>0?l:1,d=100/e.length;return r.jsx("div",{className:i,role:"img","aria-label":"Histogram sparkline",children:r.jsxs("svg",{viewBox:"0 0 100 60",children:[r.jsx("line",{x1:"0",y1:"58",x2:"100",y2:"58",stroke:"rgba(148, 163, 184, 0.35)",strokeWidth:"0.75"}),e.map((m,v)=>{const p=m/u*52,_=v*d,y=58-p,w=Math.max(d-2,1);return r.jsx("rect",{x:_+1,y,width:w,height:p,rx:1.2,ry:1.2,fill:`url(#${a})`},`hist-bin-${v}`)}),r.jsx("defs",{children:r.jsxs("linearGradient",{id:a,x1:"0",x2:"0",y1:"0",y2:"1",children:[r.jsx("stop",{offset:"0%",stopColor:"rgba(165, 180, 252, 0.95)"}),r.jsx("stop",{offset:"100%",stopColor:"rgba(129, 140, 248, 0.35)"})]})})]})})},dL=new Set(Uf.map(e=>e.value)),$d=e=>!e||!e.length?[]:Array.from(new Set(e.map(t=>t.trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)),Fw=e=>!e||!e.length?[]:e.filter(t=>Number.isFinite(t)),Iw=e=>{const n=$d(e).filter(a=>dL.has(a));return n.length?n:["year","month","day"]},Ld=e=>e==null?null:Number.isFinite(e)?e:null,Bw=e=>{const t=Ld(e);if(t===null)return null;const n=Math.round(t);return Number.isFinite(n)?n:null},Uw=e=>typeof e!="string"?"UTC":e.trim()||"UTC",mL=({node:e,onClose:t,onUpdateConfig:n,onUpdateNodeData:a,sourceId:i,graphSnapshot:l,onResetConfig:u,defaultConfigTemplate:d,isResetAvailable:m=!1})=>{var Ma,uc,Aa,dc,Hi,Hu,mc,fc,ws,Oa,Mr,$s,Fm,Vu,Wu,vp,Pa,Im,Ku,ro,Yu,ao,Bm,Um,Qu,hc,yp,bp,qm,Hm,oo,xp,Ho,Vm,En,wp;const v=f.useMemo(()=>{var N,E,L,F,re,oe;const g=[];return(N=e==null?void 0:e.data)!=null&&N.label&&g.push({label:"Label",value:String(e.data.label)}),(E=e==null?void 0:e.data)!=null&&E.description&&g.push({label:"Description",value:String(e.data.description)}),(L=e==null?void 0:e.data)!=null&&L.category&&g.push({label:"Category",value:String(e.data.category)}),(F=e==null?void 0:e.data)!=null&&F.catalogType&&g.push({label:"Node type",value:String(e.data.catalogType)}),(re=e==null?void 0:e.data)!=null&&re.inputs&&Array.isArray(e.data.inputs)&&e.data.inputs.length&&g.push({label:"Inputs",value:e.data.inputs.join(", ")}),(oe=e==null?void 0:e.data)!=null&&oe.outputs&&Array.isArray(e.data.outputs)&&e.data.outputs.length&&g.push({label:"Outputs",value:e.data.outputs.join(", ")}),g},[e]),p=f.useMemo(()=>{var N;const g=((N=e==null?void 0:e.data)==null?void 0:N.label)??(e==null?void 0:e.id);return typeof g=="string"&&g.trim()?g:`Node ${(e==null?void 0:e.id)??""}`},[e]),{catalogType:_,isDataset:y,isImputerNode:w,isMissingIndicatorNode:x,isReplaceAliasesNode:S,isTrimWhitespaceNode:k,isRemoveSpecialCharsNode:M,isReplaceInvalidValuesNode:P,isRegexCleanupNode:T,isNormalizeTextCaseNode:j,isStandardizeDatesNode:O,isLabelEncodingNode:A,isTargetEncodingNode:z,isHashEncodingNode:$,isFeatureTargetSplitNode:q,isTrainTestSplitNode:V,isTrainModelDraftNode:R,isModelEvaluationNode:ee,isModelRegistryNode:le,isHyperparameterTuningNode:D,isClassUndersamplingNode:X,isClassOversamplingNode:Y,isOrdinalEncodingNode:K,isDummyEncodingNode:U,isOneHotEncodingNode:te,isFeatureMathNode:W,isCastNode:I,isBinningNode:Q,isScalingNode:me,isPolynomialFeaturesNode:J,isFeatureSelectionNode:H,isTransformerAuditNode:Z,isOutlierNode:ne,isSkewnessNode:fe,isSkewnessDistributionNode:ae,isBinnedDistributionNode:pe,isDataConsistencyNode:Ve,isInspectionNode:st,isRemoveDuplicatesNode:Ke,isDropMissingColumnsNode:mt,isDropMissingRowsNode:yt,isDropMissingNode:Te}=Y2(e),at=y,it=X||Y,be=f.useMemo(()=>RM,[]),Pe=f.useMemo(()=>be.map(g=>g.value),[be]),G=f.useMemo(()=>{var N;const g=(N=e==null?void 0:e.data)==null?void 0:N.parameters;return Array.isArray(g)?g.filter(E=>!!(E!=null&&E.name)).map(E=>({...E})):[]},[e]),ke=f.useMemo(()=>aL[_]??null,[_]),Ae=typeof(e==null?void 0:e.id)=="string"?e.id:"",Ge=f.useMemo(()=>{var E;const g=(E=e==null?void 0:e.data)==null?void 0:E.connectionInfo;if(!g)return null;const N=L=>Array.isArray(L)?L.map(F=>({...F})):[];return{inputs:N(g.inputs),outputs:N(g.outputs)}},[e]),ft=((Ma=e==null?void 0:e.data)==null?void 0:Ma.hasRequiredConnections)!==!1,zt=f.useMemo(()=>{if(!Ae||!l||!Array.isArray(l.edges))return new Set;const g=l.edges.filter(N=>(N==null?void 0:N.target)===Ae).map(N=>Rw(Ae,N==null?void 0:N.targetHandle)).filter(N=>!!N);return new Set(g)},[l,Ae]),ve=f.useMemo(()=>{if(!Ae||!l||!Array.isArray(l.edges))return new Set;const g=l.edges.filter(N=>(N==null?void 0:N.source)===Ae).map(N=>Rw(Ae,N==null?void 0:N.sourceHandle)).filter(N=>!!N);return new Set(g)},[l,Ae]),xe=f.useMemo(()=>{if(!(Ge!=null&&Ge.inputs)||Ge.inputs.length===0)return;let g=!1;const N={};return Ge.inputs.forEach(E=>{if(!Array.isArray(E.accepts)||E.accepts.length===0)return;const L=zt.has(E.key);E.accepts.forEach(F=>{(F==="train"||F==="validation"||F==="test")&&(N[F]=L,g=!0)})}),g?N:void 0},[Ge==null?void 0:Ge.inputs,zt]),Se=f.useMemo(()=>{var g;return(g=Ge==null?void 0:Ge.inputs)!=null&&g.length?Ge.inputs.filter(N=>N.required!==!1):[]},[Ge==null?void 0:Ge.inputs]),$e=f.useMemo(()=>Se.length?Se.filter(g=>!zt.has(g.key)):[],[zt,Se]),Ye=ft&&$e.length===0,Ue=f.useMemo(()=>{if(!Ye)return{opacity:.45,pointerEvents:"none",userSelect:"none"}},[Ye]),Ze=Ye?void 0:!0,Nt=f.useMemo(()=>!!(m&&!y&&d),[d,y,m]);f.useMemo(()=>Q?G.find(g=>g.name==="columns")??null:null,[Q,G]),f.useMemo(()=>me?G.find(g=>g.name==="columns")??null:null,[me,G]);const Et=f.useMemo(()=>Ke?G.find(g=>g.name==="columns")??null:null,[Ke,G]),qt=f.useMemo(()=>Ke?G.find(g=>g.name==="keep")??null:null,[Ke,G]),Ht=f.useMemo(()=>S?G.find(g=>g.name==="custom_pairs")??null:null,[S,G]),Pt=f.useMemo(()=>k?G.find(g=>g.name==="columns")??null:null,[k,G]),pt=f.useMemo(()=>k?G.find(g=>g.name==="mode")??null:null,[k,G]),Jt=f.useMemo(()=>M?G.find(g=>g.name==="columns")??null:null,[M,G]),Gt=f.useMemo(()=>M?G.find(g=>g.name==="mode")??null:null,[M,G]),Ct=f.useMemo(()=>M?G.find(g=>g.name==="replacement")??null:null,[M,G]),Dn=f.useMemo(()=>P?G.find(g=>g.name==="columns")??null:null,[P,G]),wn=f.useMemo(()=>P?G.find(g=>g.name==="mode")??null:null,[P,G]),pn=f.useMemo(()=>P?G.find(g=>g.name==="min_value")??null:null,[P,G]),Tt=f.useMemo(()=>P?G.find(g=>g.name==="max_value")??null:null,[P,G]),hs=f.useMemo(()=>T?G.find(g=>g.name==="columns")??null:null,[T,G]),sn=f.useMemo(()=>T?G.find(g=>g.name==="mode")??null:null,[T,G]),ht=f.useMemo(()=>T?G.find(g=>g.name==="pattern")??null:null,[T,G]),_t=f.useMemo(()=>T?G.find(g=>g.name==="replacement")??null:null,[T,G]),zn=f.useMemo(()=>j?G.find(g=>g.name==="columns")??null:null,[j,G]),Gn=f.useMemo(()=>j?G.find(g=>g.name==="mode")??null:null,[j,G]),ps=f.useMemo(()=>A?G.find(g=>g.name==="columns")??null:null,[A,G]),Xn=f.useMemo(()=>A?G.find(g=>g.name==="auto_detect")??null:null,[A,G]),Es=f.useMemo(()=>A?G.find(g=>g.name==="max_unique_values")??null:null,[A,G]),Jn=f.useMemo(()=>A?G.find(g=>g.name==="output_suffix")??null:null,[A,G]),dr=f.useMemo(()=>A?G.find(g=>g.name==="drop_original")??null:null,[A,G]),bn=f.useMemo(()=>A?G.find(g=>g.name==="missing_strategy")??null:null,[A,G]),zs=f.useMemo(()=>A?G.find(g=>g.name==="missing_code")??null:null,[A,G]),ks=f.useMemo(()=>$?G.find(g=>g.name==="columns")??null:null,[$,G]),gs=f.useMemo(()=>$?G.find(g=>g.name==="auto_detect")??null:null,[$,G]),Ba=f.useMemo(()=>$?G.find(g=>g.name==="max_categories")??null:null,[$,G]),Xs=f.useMemo(()=>$?G.find(g=>g.name==="n_buckets")??null:null,[$,G]),pa=f.useMemo(()=>$?G.find(g=>g.name==="output_suffix")??null:null,[$,G]),zr=f.useMemo(()=>$?G.find(g=>g.name==="drop_original")??null:null,[$,G]),Rr=f.useMemo(()=>$?G.find(g=>g.name==="encode_missing")??null:null,[$,G]),ga=f.useMemo(()=>J?G.find(g=>g.name==="columns")??null:null,[J,G]),Js=f.useMemo(()=>J?G.find(g=>g.name==="auto_detect")??null:null,[J,G]),bo=f.useMemo(()=>J?G.find(g=>g.name==="degree")??null:null,[J,G]),Ua=f.useMemo(()=>J?G.find(g=>g.name==="include_bias")??null:null,[J,G]),fn=f.useMemo(()=>J?G.find(g=>g.name==="interaction_only")??null:null,[J,G]),Xr=f.useMemo(()=>J?G.find(g=>g.name==="include_input_features")??null:null,[J,G]),_s=f.useMemo(()=>J?G.find(g=>g.name==="output_prefix")??null:null,[J,G]),Fr=f.useMemo(()=>H?G.find(g=>g.name==="columns")??null:null,[H,G]),Rs=f.useMemo(()=>H?G.find(g=>g.name==="auto_detect")??null:null,[H,G]),_a=f.useMemo(()=>H?G.find(g=>g.name==="target_column")??null:null,[H,G]),_e=f.useMemo(()=>H?G.find(g=>g.name==="method")??null:null,[H,G]),De=f.useMemo(()=>H?G.find(g=>g.name==="score_func")??null:null,[H,G]),et=f.useMemo(()=>H?G.find(g=>g.name==="problem_type")??null:null,[H,G]),Yt=f.useMemo(()=>H?G.find(g=>g.name==="k")??null:null,[H,G]),Be=f.useMemo(()=>H?G.find(g=>g.name==="percentile")??null:null,[H,G]),kt=f.useMemo(()=>H?G.find(g=>g.name==="alpha")??null:null,[H,G]),$t=f.useMemo(()=>H?G.find(g=>g.name==="threshold")??null:null,[H,G]),rn=f.useMemo(()=>H?G.find(g=>g.name==="mode")??null:null,[H,G]),Zt=f.useMemo(()=>H?G.find(g=>g.name==="estimator")??null:null,[H,G]),On=f.useMemo(()=>H?G.find(g=>g.name==="step")??null:null,[H,G]),gn=f.useMemo(()=>H?G.find(g=>g.name==="min_features")??null:null,[H,G]),Rn=f.useMemo(()=>H?G.find(g=>g.name==="max_features")??null:null,[H,G]),mr=f.useMemo(()=>H?G.find(g=>g.name==="drop_unselected")??null:null,[H,G]),Ms=f.useMemo(()=>W?G.find(g=>g.name==="error_handling")??null:null,[W,G]),Zn=f.useMemo(()=>W?G.find(g=>g.name==="allow_overwrite")??null:null,[W,G]),is=f.useMemo(()=>W?G.find(g=>g.name==="default_timezone")??null:null,[W,G]),Fs=f.useMemo(()=>W?G.find(g=>g.name==="epsilon")??null:null,[W,G]),As=f.useMemo(()=>it?G.find(g=>g.name==="method")??null:null,[it,G]),di=f.useMemo(()=>it?G.find(g=>g.name==="target_column")??null:null,[it,G]),jl=f.useMemo(()=>it?G.find(g=>g.name==="sampling_strategy")??null:null,[it,G]),Bt=f.useMemo(()=>it?G.find(g=>g.name==="random_state")??null:null,[it,G]),Qc=f.useMemo(()=>Y?G.find(g=>g.name==="k_neighbors")??null:null,[Y,G]),Nl=f.useMemo(()=>X?G.find(g=>g.name==="replacement")??null:null,[X,G]),Sl=f.useMemo(()=>q?G.find(g=>g.name==="target_column")??null:null,[q,G]),Gc=f.useMemo(()=>R||D?G.find(g=>g.name==="target_column")??null:null,[D,R,G]),Xc=f.useMemo(()=>R||D?G.find(g=>g.name==="problem_type")??null:null,[D,R,G]),va=f.useMemo(()=>R||D?G.find(g=>g.name==="model_type")??null:null,[D,R,G]),mi=f.useMemo(()=>R?G.find(g=>g.name==="hyperparameters")??null:null,[R,G]),xo=f.useMemo(()=>D?G.find(g=>g.name==="search_strategy")??null:null,[D,G]),Ir=f.useMemo(()=>D?G.find(g=>g.name==="search_iterations")??null:null,[D,G]),se=f.useMemo(()=>D?G.find(g=>g.name==="search_random_state")??null:null,[D,G]),Me=f.useMemo(()=>D?G.find(g=>g.name==="scoring_metric")??null:null,[D,G]),Ce=f.useMemo(()=>R||D?G.find(g=>g.name==="cv_enabled")??null:null,[D,R,G]),Qe=f.useMemo(()=>R||D?G.find(g=>g.name==="cv_strategy")??null:null,[D,R,G]),He=f.useMemo(()=>R||D?G.find(g=>g.name==="cv_folds")??null:null,[D,R,G]),Re=f.useMemo(()=>R||D?G.find(g=>g.name==="cv_shuffle")??null:null,[D,R,G]),St=f.useMemo(()=>R||D?G.find(g=>g.name==="cv_random_state")??null:null,[D,R,G]),ot=f.useMemo(()=>R?G.find(g=>g.name==="cv_refit_strategy")??null:null,[R,G]),Dt=f.useMemo(()=>z?G.find(g=>g.name==="columns")??null:null,[z,G]),Mt=f.useMemo(()=>z?G.find(g=>g.name==="target_column")??null:null,[z,G]),bt=f.useMemo(()=>z?G.find(g=>g.name==="auto_detect")??null:null,[z,G]),Wt=f.useMemo(()=>z?G.find(g=>g.name==="max_categories")??null:null,[z,G]),ls=f.useMemo(()=>z?G.find(g=>g.name==="output_suffix")??null:null,[z,G]),_n=f.useMemo(()=>z?G.find(g=>g.name==="drop_original")??null:null,[z,G]),es=f.useMemo(()=>z?G.find(g=>g.name==="smoothing")??null:null,[z,G]),fr=f.useMemo(()=>z?G.find(g=>g.name==="encode_missing")??null:null,[z,G]),hr=f.useMemo(()=>z?G.find(g=>g.name==="handle_unknown")??null:null,[z,G]),Br=f.useMemo(()=>K?G.find(g=>g.name==="columns")??null:null,[K,G]),qa=f.useMemo(()=>K?G.find(g=>g.name==="auto_detect")??null:null,[K,G]),Jr=f.useMemo(()=>K?G.find(g=>g.name==="max_categories")??null:null,[K,G]),Os=f.useMemo(()=>K?G.find(g=>g.name==="output_suffix")??null:null,[K,G]),Zs=f.useMemo(()=>K?G.find(g=>g.name==="drop_original")??null:null,[K,G]),fi=f.useMemo(()=>K?G.find(g=>g.name==="encode_missing")??null:null,[K,G]),pr=f.useMemo(()=>K?G.find(g=>g.name==="handle_unknown")??null:null,[K,G]),hi=f.useMemo(()=>K?G.find(g=>g.name==="unknown_value")??null:null,[K,G]),wo=f.useMemo(()=>U?G.find(g=>g.name==="columns")??null:null,[U,G]),pi=f.useMemo(()=>U?G.find(g=>g.name==="auto_detect")??null:null,[U,G]),gi=f.useMemo(()=>U?G.find(g=>g.name==="max_categories")??null:null,[U,G]),_i=f.useMemo(()=>U?G.find(g=>g.name==="drop_first")??null:null,[U,G]),vi=f.useMemo(()=>U?G.find(g=>g.name==="include_missing")??null:null,[U,G]),cs=f.useMemo(()=>U?G.find(g=>g.name==="drop_original")??null:null,[U,G]),Mn=f.useMemo(()=>U?G.find(g=>g.name==="prefix_separator")??null:null,[U,G]),yi=f.useMemo(()=>te?G.find(g=>g.name==="columns")??null:null,[te,G]),jo=f.useMemo(()=>te?G.find(g=>g.name==="auto_detect")??null:null,[te,G]),qd=f.useMemo(()=>te?G.find(g=>g.name==="max_categories")??null:null,[te,G]),Cl=f.useMemo(()=>te?G.find(g=>g.name==="drop_first")??null:null,[te,G]),An=f.useMemo(()=>te?G.find(g=>g.name==="include_missing")??null:null,[te,G]),ts=f.useMemo(()=>te?G.find(g=>g.name==="drop_original")??null:null,[te,G]),Is=f.useMemo(()=>te?G.find(g=>g.name==="prefix_separator")??null:null,[te,G]),bi=f.useMemo(()=>x?G.find(g=>g.name==="columns")??null:null,[x,G]),Hd=f.useMemo(()=>x?G.find(g=>g.name==="flag_suffix")??null:null,[x,G]);f.useMemo(()=>me?G.find(g=>g.name==="default_method")??null:null,[me,G]),f.useMemo(()=>me?G.find(g=>g.name==="auto_detect")??null:null,[me,G]);const Jc=f.useMemo(()=>G.some(g=>{var N;return(g==null?void 0:g.type)==="multi_select"&&((N=g==null?void 0:g.source)==null?void 0:N.type)!=="drop_column_recommendations"}),[G]),Vd=f.useMemo(()=>G.find(g=>{var N;return((N=g==null?void 0:g.source)==null?void 0:N.type)==="drop_column_recommendations"})??null,[G]),Zc=f.useMemo(()=>G.find(g=>g.name==="drop_if_any_missing")??null,[G]),rh=f.useMemo(()=>{let g=G;return g=g.filter(N=>{var E;return((E=N==null?void 0:N.source)==null?void 0:E.type)!=="drop_column_recommendations"}),(mt||yt)&&(g=g.filter(N=>N.name!=="missing_threshold")),yt&&(g=g.filter(N=>N.name!=="drop_if_any_missing")),w&&(g=g.filter(N=>N.name!=="strategies")),fe&&(g=g.filter(N=>N.name!=="transformations")),I&&(g=g.filter(N=>N.name!=="column_overrides")),Q&&(g=g.filter(N=>N.name!=="columns")),me&&(g=g.filter(N=>!["columns","default_method","auto_detect"].includes(N.name))),Ke&&(g=g.filter(N=>N.name!=="columns"&&N.name!=="keep")),x&&(g=g.filter(N=>N.name!=="columns"&&N.name!=="flag_suffix")),S&&(g=g.filter(N=>!["columns","mode","custom_pairs"].includes(N.name))),k&&(g=g.filter(N=>!["columns","mode"].includes(N.name))),M&&(g=g.filter(N=>!["columns","mode","replacement"].includes(N.name))),P&&(g=g.filter(N=>!["columns","mode","min_value","max_value"].includes(N.name))),T&&(g=g.filter(N=>!["columns","mode","pattern","replacement"].includes(N.name))),j&&(g=g.filter(N=>!["columns","mode"].includes(N.name))),O&&(g=g.filter(N=>!["columns","mode"].includes(N.name))),X&&(g=g.filter(N=>!["method","target_column","sampling_strategy","random_state","replacement"].includes(N.name))),R&&(g=g.filter(N=>!["target_column","problem_type","cv_enabled","cv_strategy","cv_folds","cv_shuffle","cv_random_state","cv_refit_strategy"].includes(N.name))),Y&&(g=g.filter(N=>!["method","target_column","sampling_strategy","random_state"].includes(N.name))),q&&(g=g.filter(N=>N.name!=="target_column")),A&&(g=g.filter(N=>!["columns","auto_detect","max_unique_values","output_suffix","drop_original","missing_strategy","missing_code"].includes(N.name))),K&&(g=g.filter(N=>!["columns","auto_detect","max_categories","output_suffix","drop_original","encode_missing","handle_unknown","unknown_value"].includes(N.name))),U&&(g=g.filter(N=>!["columns","auto_detect","max_categories","drop_first","include_missing","drop_original","prefix_separator"].includes(N.name))),te&&(g=g.filter(N=>!["columns","auto_detect","max_categories","drop_first","include_missing","drop_original","prefix_separator"].includes(N.name))),g},[Q,I,mt,yt,w,x,S,k,M,P,T,j,O,X,Y,R,A,K,U,te,Ke,fe,q,G]),ah=f.useMemo(()=>Ve?rh:[],[rh,Ve]),oh=fe||ae,eu=f.useMemo(()=>{var N;const g=Yg(((N=e==null?void 0:e.data)==null?void 0:N.config)??{});return!g||typeof g!="object"||Array.isArray(g)?{}:((!g.column_overrides||typeof g.column_overrides!="object"||Array.isArray(g.column_overrides))&&(g.column_overrides={}),g)},[e==null?void 0:e.id,(uc=e==null?void 0:e.data)==null?void 0:uc.config]),[ye,Ie]=f.useState(eu),ya=f.useRef(!1),ih=f.useMemo(()=>Md(eu),[eu]),x_=f.useMemo(()=>Md(ye),[ye]),w_=f.useMemo(()=>le?ye?{...ye}:{}:null,[ye,le]),Ha=f.useMemo(()=>Ux(ye==null?void 0:ye.strategies,Pe),[ye==null?void 0:ye.strategies,Pe]),lh=Ha.length,ch=f.useMemo(()=>$g(Wx(ye==null?void 0:ye.transformations)),[ye==null?void 0:ye.transformations]),Pn=f.useMemo(()=>{if(!l)return null;const g=Array.isArray(l.nodes)?l.nodes:[],N=Array.isArray(l.edges)?l.edges:[];return{nodes:g,edges:N}},[l]),Va=f.useMemo(()=>l&&Array.isArray(l.nodes)?l.nodes:[],[l]),xi=f.useMemo(()=>l&&Array.isArray(l.edges)?l.edges:[],[l]),tu=Va.length,Wa=f.useMemo(()=>{if(!Ae||!xi.length)return[];const g=new Set,N=[Ae];for(;N.length;){const L=N.pop();L&&xi.forEach(F=>{const re=F&&typeof F.source=="string"?F.source.trim():"",oe=F&&typeof F.target=="string"?F.target.trim():"";!re||!oe||oe===L&&!g.has(re)&&(g.add(re),N.push(re))})}const E=Array.from(g);return E.sort(),E},[xi,Ae]),nu=f.useMemo(()=>{var E,L,F,re,oe;if(!Wa.length)return"";let g="",N="";for(const ue of Wa){const ce=Va.find(Le=>(Le==null?void 0:Le.id)===ue);if(!ce)continue;const je=String(((E=ce==null?void 0:ce.data)==null?void 0:E.catalogType)??"").toLowerCase().trim();if(je==="feature_target_split"){const Le=(F=(L=ce==null?void 0:ce.data)==null?void 0:L.config)==null?void 0:F.target_column;typeof Le=="string"&&Le.trim()&&(g=Le.trim())}else if(je==="train_test_split"){const Le=(oe=(re=ce==null?void 0:ce.data)==null?void 0:re.config)==null?void 0:oe.target_column;typeof Le=="string"&&Le.trim()&&(N=Le.trim())}}return g||N||""},[Va,Wa]),{featureTargetSplitConfig:j_,trainTestSplitConfig:N_,resamplingConfig:No,trainModelDraftConfig:El,trainModelRuntimeConfig:wi,trainModelCVConfig:uh,filteredModelTypeOptions:Wd}=P$({configState:ye,setConfigState:Ie,isFeatureTargetSplitNode:q,isTrainTestSplitNode:V,isTrainModelDraftNode:R,isHyperparameterTuningNode:D,isClassResamplingNode:it,isClassOversamplingNode:Y,isClassUndersamplingNode:X,upstreamTargetColumn:nu,nodeId:Ae,modelTypeOptions:(va==null?void 0:va.options)??null}),ji=f.useMemo(()=>W?V0((ye==null?void 0:ye.operations)??[]):[],[ye==null?void 0:ye.operations,W]),Kd=f.useMemo(()=>{if(!Wa.length)return{};const g={};return Wa.forEach(N=>{var F;const E=Va.find(re=>re&&typeof re.id=="string"&&re.id===N);if(!E)return;const L=((F=E==null?void 0:E.data)==null?void 0:F.config)??null;g[N]=L}),g},[Va,Wa]),Yd=f.useMemo(()=>Md({sourceId:i??null,nodeId:Ae||null,config:ye,upstreamIds:Wa,upstreamConfig:Kd}),[ye,Ae,i,Kd,Wa]),[kl,ba]=f.useState(null),So=f.useMemo(()=>(kl==null?void 0:kl.columns)??[],[kl]),Qd=f.useMemo(()=>{const g=new Set;return Va.forEach(N=>{if(!N)return;const E=typeof N.id=="string"?N.id.trim():String((N==null?void 0:N.id)??"").trim();if(!E)return;const L=(N==null?void 0:N.data)??{};(E==="dataset-source"||(L==null?void 0:L.isDataset)===!0||(L==null?void 0:L.catalogType)==="dataset")&&g.add(E)}),g.size||g.add("dataset-source"),Array.from(g)},[Va]),xt=f.useMemo(()=>{if(!Ae)return!1;if(y)return!0;if(!xi.length)return Qd.includes(Ae);const g=new Map;xi.forEach(L=>{const F=L==null?void 0:L.source,re=L==null?void 0:L.target,oe=typeof F=="string"?F.trim():String(F??"").trim(),ue=typeof re=="string"?re.trim():String(re??"").trim();if(!oe||!ue)return;const ce=g.get(oe);ce?ce.push(ue):g.set(oe,[ue])});const N=new Set,E=[...Qd];for(;E.length;){const L=E.pop();if(!L||N.has(L))continue;N.add(L);const F=g.get(L);F&&F.forEach(re=>{re&&!N.has(re)&&E.push(re)})}return N.has(Ae)},[Qd,xi,y,Ae]),Ml=f.useMemo(()=>{if(!Y||!So.length)return null;const g=No==null?void 0:No.targetColumn;if(!g)return null;const N=new Set(["numeric","integer","boolean"]),E=So.filter(L=>L&&L.name!==g).filter(L=>!N.has(String(L.logical_family??"unknown"))).map(L=>({name:L.name,logical_family:String(L.logical_family??"unknown")}));return E.length?{blocked:!0,message:"Class oversampling requires numeric feature columns. Encode or cast the listed fields before refreshing the preview.",columns:E.map(L=>L.name),details:E}:null},[So,Y,No==null?void 0:No.targetColumn]),Al=f.useMemo(()=>{if(!w||!So.length||!Ha.length)return null;const g=new Set(["numeric","integer"]),N=new Map(So.map(L=>[L.name,L])),E=[];return Ha.forEach((L,F)=>{if(!Ix(L.method)||!Array.isArray(L.columns)||!L.columns.length)return;const re=L.columns.map(oe=>N.get(oe)).filter(oe=>!!oe).filter(oe=>!g.has(String(oe.logical_family??"unknown"))).map(oe=>({name:oe.name,logical_family:String(oe.logical_family??"unknown")}));re.length&&E.push({index:F,columns:re.map(oe=>oe.name),details:re})}),E.length?{blocked:!0,message:"Numeric imputation methods can only target numeric columns. Recast or adjust the highlighted fields before running the preview.",entries:E}:null},[So,Ha,w]),Ol=!!(Ml!=null&&Ml.blocked||Al!=null&&Al.blocked),[an,su]=f.useState([]),[Co,ru]=f.useState(""),[Eo,Ni]=f.useState({}),[gr,Pl]=f.useState({}),[Tl,$l]=f.useState({}),[dh,Gd]=f.useState(0),S_=!!Vd,{hasDropColumnSource:C_,availableFilters:mh,activeFilterId:_r,setActiveFilterId:Si,recommendations:ko,filteredRecommendations:Xd,formatSignalName:Jd,isFetchingRecommendations:xa,recommendationsError:au,recommendationsGeneratedAt:E_,suggestedThreshold:ou,refreshRecommendations:Mo}=G1({hasDropColumnSource:S_,sourceId:i,nodeId:Ae,graphContext:Pn,hasReachableSource:xt,columnTypeMap:gr,setAvailableColumns:su,setColumnSearch:ru,setColumnMissingMap:Ni,setColumnTypeMap:Pl,setColumnSuggestions:$l});t$({shouldLoad:w,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null,setAvailableColumns:su,setColumnMissingMap:Ni});const{isFetching:Zd,error:Ll,suggestions:em,metadata:iu}=R$({isLabelEncodingNode:A,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null}),{isFetching:lu,error:Ci,suggestions:Dl,metadata:Ka}=U$({isTargetEncodingNode:z,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null}),{isFetching:Ao,error:fh,suggestions:cu,metadata:Ei}=W$({isHashEncodingNode:$,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null}),{isFetching:hh,error:ph,suggestions:uu,metadata:vr}=G$({isOrdinalEncodingNode:K,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null}),{isFetching:tm,error:nm,suggestions:sm,metadata:rm}=eL({isDummyEncodingNode:U,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null}),{isFetching:zl,error:k_,suggestions:du,metadata:gh}=rL({isOneHotEncodingNode:te,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null});f.useEffect(()=>{A&&iu.autoDetectDefault&&(ye==null?void 0:ye.auto_detect)!==!0&&(ye==null?void 0:ye.auto_detect)!==!1&&Ie(g=>(g==null?void 0:g.auto_detect)!==void 0&&g.auto_detect!==null?g:{...g,auto_detect:!0})},[ye==null?void 0:ye.auto_detect,A,iu.autoDetectDefault,Ie]),f.useEffect(()=>{z&&Ka.autoDetectDefault&&(ye==null?void 0:ye.auto_detect)!==!0&&(ye==null?void 0:ye.auto_detect)!==!1&&Ie(g=>(g==null?void 0:g.auto_detect)!==void 0&&g.auto_detect!==null?g:{...g,auto_detect:!0})},[ye==null?void 0:ye.auto_detect,z,Ie,Ka.autoDetectDefault]),f.useEffect(()=>{$&&Ei.autoDetectDefault&&(ye==null?void 0:ye.auto_detect)!==!0&&(ye==null?void 0:ye.auto_detect)!==!1&&Ie(g=>(g==null?void 0:g.auto_detect)!==void 0&&g.auto_detect!==null?g:{...g,auto_detect:!0})},[ye==null?void 0:ye.auto_detect,Ei.autoDetectDefault,$,Ie]),f.useEffect(()=>{if(!$)return;const g=Ei.suggestedBucketDefault;if(!g||!Number.isFinite(g))return;const N=Math.max(2,Math.round(g));Ie(E=>{if(!E||typeof E!="object"||Array.isArray(E))return E;const L=E.n_buckets;if(L!=null){const F=Number(L);if(Number.isFinite(F)&&Math.round(F)>0)return E}return{...E,n_buckets:N}})},[Ei.suggestedBucketDefault,$,Ie]),f.useEffect(()=>{if(!z||!Ka.enableGlobalFallbackDefault)return;const g=typeof(ye==null?void 0:ye.encode_missing)=="boolean"?ye.encode_missing:null,N=typeof(ye==null?void 0:ye.handle_unknown)=="string"?ye.handle_unknown.trim().toLowerCase():"";g===!0&&N==="global_mean"||Ie(E=>{const L=typeof(E==null?void 0:E.encode_missing)=="boolean"?E.encode_missing:null,F=typeof(E==null?void 0:E.handle_unknown)=="string"?E.handle_unknown.trim().toLowerCase():"";if(L===!0&&F==="global_mean")return E;const re={...E};return L!==!0&&(re.encode_missing=!0),F!=="global_mean"&&(re.handle_unknown="global_mean"),re})},[ye==null?void 0:ye.encode_missing,ye==null?void 0:ye.handle_unknown,z,Ie,Ka.enableGlobalFallbackDefault]),f.useEffect(()=>{K&&vr.autoDetectDefault&&(ye==null?void 0:ye.auto_detect)!==!0&&(ye==null?void 0:ye.auto_detect)!==!1&&Ie(g=>(g==null?void 0:g.auto_detect)!==void 0&&g.auto_detect!==null?g:{...g,auto_detect:!0})},[ye==null?void 0:ye.auto_detect,K,vr.autoDetectDefault,Ie]),f.useEffect(()=>{!K||!vr.enableUnknownDefault||typeof(ye==null?void 0:ye.handle_unknown)=="string"&&ye.handle_unknown.trim().toLowerCase()||Ie(N=>(typeof(N==null?void 0:N.handle_unknown)=="string"?N.handle_unknown.trim().toLowerCase():"")?N:{...N,handle_unknown:"use_encoded_value"})},[ye==null?void 0:ye.handle_unknown,K,vr.enableUnknownDefault,Ie]),f.useEffect(()=>{U&&rm.autoDetectDefault&&(ye==null?void 0:ye.auto_detect)!==!0&&(ye==null?void 0:ye.auto_detect)!==!1&&Ie(g=>(g==null?void 0:g.auto_detect)!==void 0&&g.auto_detect!==null?g:{...g,auto_detect:!0})},[ye==null?void 0:ye.auto_detect,rm.autoDetectDefault,U,Ie]),f.useEffect(()=>{!Jc&&!w||i&&xt||(su([]),Ni({}),Pl({}),$l({}),ru(""))},[xt,w,Jc,i]);const on=e==null?void 0:e.id,mu=f.useRef(on);f.useEffect(()=>{mu.current!==on&&(mu.current=on,Ie(eu),ya.current=!1)},[on]),f.useEffect(()=>{Gd(0)},[w,e==null?void 0:e.id]);const[Rl,Fl]=f.useState("500"),[fu,vs]=f.useState(()=>new Set),[Il,yr]=f.useState(()=>new Set);f.useEffect(()=>{vs(new Set)},[ih]),f.useEffect(()=>{if(!z){ya.current=!1;return}if(!Ka.enableGlobalFallbackDefault||ya.current)return;const g=typeof(ye==null?void 0:ye.encode_missing)=="boolean"?ye.encode_missing:null,N=typeof(ye==null?void 0:ye.handle_unknown)=="string"?ye.handle_unknown.trim().toLowerCase():"";if(g===!0&&N==="global_mean"){ya.current=!0;return}Ie(E=>{const L=typeof(E==null?void 0:E.encode_missing)=="boolean"?E.encode_missing:null,F=typeof(E==null?void 0:E.handle_unknown)=="string"?E.handle_unknown.trim().toLowerCase():"";if(L===!0&&F==="global_mean")return ya.current=!0,E;const re={...E};return L!==!0&&(re.encode_missing=!0),F!=="global_mean"&&(re.handle_unknown="global_mean"),ya.current=!0,re})},[ye==null?void 0:ye.encode_missing,ye==null?void 0:ye.handle_unknown,z,Ie,Ka.enableGlobalFallbackDefault]);const Ur=f.useMemo(()=>{var g;return((g=e==null?void 0:e.data)==null?void 0:g.catalogType)==="data_preview"},[(Aa=e==null?void 0:e.data)==null?void 0:Aa.catalogType]),am=f.useMemo(()=>{var g;return((g=e==null?void 0:e.data)==null?void 0:g.catalogType)==="dataset_profile"},[(dc=e==null?void 0:e.data)==null?void 0:dc.catalogType]),M_=f.useMemo(()=>Pn?Md(Pn):"",[Pn]),_h=fM({node:e,isDatasetProfileNode:am,sourceId:i,hasReachableSource:xt,graphContext:Pn,profilingGraphSignature:M_,formatRelativeTime:Cs}),{profileState:vh}=_h,hu=f.useMemo(()=>!(!l||!tu||!xt),[tu,l,xt,i]),Bl=f.useMemo(()=>!l||!i||!xt?!1:tu>0,[tu,l,xt,i]),om=Ur||W||J||H||V||ne||Z,{previewState:Lt,refreshPreview:pu}=e$({shouldFetchPreview:hu,sourceId:i,canTriggerPreview:Bl,graphSnapshot:l??null,isPreviewNode:Ur,targetNodeId:(e==null?void 0:e.id)??null,previewSignature:Yd,skipPreview:Ol,requestPreviewRows:Ur,includeSignals:om}),Ul=f.useMemo(()=>{var N,E;if(!W)return[];const g=(E=(N=Lt.data)==null?void 0:N.signals)==null?void 0:E.feature_math;return Array.isArray(g)?g:[]},[W,(Hu=(Hi=Lt.data)==null?void 0:Hi.signals)==null?void 0:Hu.feature_math]),A_=f.useMemo(()=>{var E,L;if(!J)return null;const g=(L=(E=Lt.data)==null?void 0:E.signals)==null?void 0:L.polynomial_features;return!Array.isArray(g)||g.length===0?null:(Ae?g.find(F=>F&&typeof F.node_id=="string"&&F.node_id===Ae):null)??g[0]??null},[J,Ae,(fc=(mc=Lt.data)==null?void 0:mc.signals)==null?void 0:fc.polynomial_features]),jn=f.useMemo(()=>{var E,L;if(!H)return null;const g=(L=(E=Lt.data)==null?void 0:E.signals)==null?void 0:L.feature_selection;return!Array.isArray(g)||g.length===0?null:(Ae?g.find(F=>F&&typeof F.node_id=="string"&&F.node_id===Ae):null)??g[0]??null},[H,Ae,(Oa=(ws=Lt.data)==null?void 0:ws.signals)==null?void 0:Oa.feature_selection]);f.useEffect(()=>{if(!H)return;const g=typeof(jn==null?void 0:jn.target_column)=="string"?jn.target_column.trim():"",N=typeof nu=="string"?nu.trim():"",E=g||N;E&&Ie(L=>(typeof(L==null?void 0:L.target_column)=="string"?L.target_column.trim():"")?L:{...L,target_column:E})},[jn==null?void 0:jn.target_column,H,Ie,nu]),f.useEffect(()=>{if(!H)return;const g=typeof(jn==null?void 0:jn.k)=="number"&&Number.isFinite(jn.k)?Math.max(0,Math.trunc(jn.k)):null,N=Array.isArray(jn==null?void 0:jn.selected_columns)?jn.selected_columns.length:null,E=g??N??null;E===null||E<=0||Ie(L=>{const F=L==null?void 0:L.k;let re=null;if(typeof F=="number"&&Number.isFinite(F))re=Math.trunc(F);else if(typeof F=="string"){const oe=Number(F);Number.isFinite(oe)&&(re=Math.trunc(oe))}return re!==null&&re<=E?L:{...L,k:E}})},[jn==null?void 0:jn.k,jn==null?void 0:jn.selected_columns,H,Ie]);const O_=f.useMemo(()=>W?YP(ji,Ul):[],[ji,Ul,W]);f.useEffect(()=>{if(!W){yr(()=>new Set);return}yr(g=>{if(!g.size)return g;const N=new Set(ji.map(L=>L.id)),E=new Set;return g.forEach(L=>{N.has(L)&&E.add(L)}),E.size===g.size?g:E})},[ji,W]);const{outlierData:ql,outlierError:im,isFetchingOutliers:Ya,refreshOutliers:lm}=i$({isOutlierNode:ne,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:Ae||null}),{scalingData:br,scalingError:Zr,isFetchingScaling:Qa,refreshScaling:ea}=Q2({isScalingNode:me,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null}),{binningData:Fn,binningError:P_,isFetchingBinning:gu,refreshBinning:Ga}=G2({isBinningNode:Q,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null}),ta=f.useCallback(()=>{ba(null),pu(),me&&ea(),Q&&Ga(),ne&&lm()},[Q,ne,me,Ga,lm,pu,ea]);f.useEffect(()=>{var N;const g=((N=Lt.data)==null?void 0:N.schema)??null;g&&ba(E=>E!=null&&E.signature&&g.signature&&E.signature===g.signature?E:g)},[(Mr=Lt.data)==null?void 0:Mr.schema]),f.useEffect(()=>{ba(null)},[i]),f.useEffect(()=>{ba(null)},[Yd]);const{binnedDistributionData:ns,binnedDistributionError:_u,isFetchingBinnedDistribution:ki,refreshBinnedDistribution:Oo}=J2({isBinnedDistributionNode:pe,sourceId:i,hasReachableSource:xt,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null,samplePreset:Rl}),{skewnessData:Xa,skewnessError:ln,isFetchingSkewness:en}=X2({shouldLoad:oh,sourceId:i,graphContext:Pn,targetNodeId:(e==null?void 0:e.id)??null,transformations:ch}),na=f.useMemo(()=>{var N;const g=(N=Lt.data)==null?void 0:N.columns;return Array.isArray(g)?g.filter(E=>typeof E=="string"):[]},[($s=Lt.data)==null?void 0:$s.columns]),ys=f.useMemo(()=>{var N;const g=(N=Lt.data)==null?void 0:N.column_stats;return Array.isArray(g)?g:[]},[(Fm=Lt.data)==null?void 0:Fm.column_stats]),cn=f.useMemo(()=>{var g,N;return x?aA(ye==null?void 0:ye.flag_suffix,(N=(g=e==null?void 0:e.data)==null?void 0:g.config)==null?void 0:N.flag_suffix):""},[ye==null?void 0:ye.flag_suffix,x,(Wu=(Vu=e==null?void 0:e.data)==null?void 0:Vu.config)==null?void 0:Wu.flag_suffix]),Ja=f.useMemo(()=>x?ut(ye==null?void 0:ye.columns):[],[ye==null?void 0:ye.columns,x]),Mi=f.useMemo(()=>x?iA({selectedColumns:Ja,availableColumns:an,columnMissingMap:Eo,suffix:cn}):{rows:[],flaggedColumnsInDataset:[],conflictCount:0},[cn,an,Eo,x,Ja]),Tn=f.useMemo(()=>{var g;return Array.isArray((g=Lt.data)==null?void 0:g.sample_rows)?Lt.data.sample_rows:[]},[(vp=Lt.data)==null?void 0:vp.sample_rows]),{aliasStrategies:vu,aliasStrategyCount:cm,aliasColumnSummary:yu,aliasCustomPairSummary:bu,aliasSampleMap:yh,aliasColumnOptions:wa}=o$({isReplaceAliasesNode:S,configState:ye,nodeConfig:((Pa=e==null?void 0:e.data)==null?void 0:Pa.config)??null,availableColumns:an,columnTypeMap:gr,previewSampleRows:Tn}),{trimWhitespace:{columnSummary:xu,sampleMap:um,modeDetails:bh},removeSpecial:{columnSummary:T_,sampleMap:Za,modeDetails:Ai},regexCleanup:{columnSummary:Oi,sampleMap:wu,modeDetails:ju,selectedMode:xr,replacementValue:wr},normalizeCase:{columnSummary:Po,sampleMap:ja,modeDetails:Na,selectedMode:To}}=j$({isTrimWhitespaceNode:k,isRemoveSpecialCharsNode:M,isRegexCleanupNode:T,isNormalizeTextCaseNode:j,configState:ye,nodeConfig:((Im=e==null?void 0:e.data)==null?void 0:Im.config)??null,availableColumns:an,columnTypeMap:gr,previewSampleRows:Tn}),{selectedMode:xh,modeDetails:dm,sampleMap:mm,columnSummary:er,minValue:tr,maxValue:Nn}=S$({isReplaceInvalidValuesNode:P,configState:ye,nodeConfig:((Ku=e==null?void 0:e.data)==null?void 0:Ku.config)??null,availableColumns:an,columnTypeMap:gr,previewSampleRows:Tn}),{selectedMode:jr,strategies:Nu,sampleMap:wh,columnSummary:Hl,columnOptions:fm}=E$({isStandardizeDatesNode:O,configState:ye,nodeConfig:((ro=e==null?void 0:e.data)==null?void 0:ro.config)??null,availableColumns:an,columnTypeMap:gr,previewSampleRows:Tn}),jh=Q||me||ne,{numericExcludedColumns:qr}=d$({shouldAnalyze:jh,availableColumns:an,columnTypeMap:gr,previewSampleRows:Tn}),{scalingConfig:Su,scalingExcludedColumns:us,scalingMethodDetailMap:hm,scalingMethodOptions:$_,scalingRecommendations:$o,scalingRecommendationRows:Cu,scalingSelectedCount:Nh,scalingOverrideCount:Sh,scalingDefaultDetail:Pi,scalingDefaultLabel:Ch,scalingAutoDetectEnabled:Eu,scalingHasRecommendations:ku,scalingStatusMessage:Ti,scalingOverrideExampleSummary:pm}=k$({isScalingNode:me,configState:ye,numericExcludedColumns:qr,scalingData:br}),{outlierConfig:Lo,outlierExcludedColumns:Vl,outlierMethodDetailMap:gm,outlierMethodOptions:$i,outlierRecommendationRows:Ps,outlierSelectedCount:Do,outlierOverrideCount:Li,outlierParameterOverrideCount:zo,outlierDefaultDetail:Sa,outlierDefaultLabel:eo,outlierAutoDetectEnabled:_m,outlierHasRecommendations:Eh,outlierStatusMessage:Ca,outlierOverrideExampleSummary:Ea}=M$({isOutlierNode:ne,configState:ye,numericExcludedColumns:qr,outlierData:ql}),Mu=typeof(ql==null?void 0:ql.sample_size)=="number"?ql.sample_size:null,kh=null,Au=Li>0||zo>0,Mh=f.useMemo(()=>Li>0?Ea:zo>0?`${zo} column${zo===1?"":"s"} with parameter overrides`:null,[Li,zo,Ea]),{binningConfig:ss,binningDefaultLabel:sa,binningOverrideCount:Wl,binningOverrideSummary:Kl,fieldIds:Ro,customEdgeDrafts:vm,setCustomEdgeDrafts:Fo,customLabelDrafts:Ah,setCustomLabelDrafts:Ou}=A$({configState:ye,nodeId:Ae}),Sn=`${Ae||"node"}-remove-duplicates-keep`,vn=f.useMemo(()=>me?Su.columns:Q?ss.columns:ne?Lo.columns:ut(ye==null?void 0:ye.columns),[ss.columns,ye,Q,ne,me,Lo.columns,Su.columns]),Hr=f.useMemo(()=>{const g=Fn==null?void 0:Fn.columns;return Array.isArray(g)?g.filter(N=>!N||typeof N.column!="string"?!1:!!N.column.trim()):[]},[Fn==null?void 0:Fn.columns]),Nr=f.useMemo(()=>{if(!Hr.length)return new Set;const g=new Set;return Hr.forEach(N=>{const E=typeof N.column=="string"?N.column.trim():"";E&&g.add(E)}),g},[Hr]),Sr=f.useMemo(()=>{if(!Q)return[];const g=new Set;return an.forEach(N=>{if(qr.has(N))return;const E=N.trim();E&&g.add(E)}),Hr.forEach(N=>{const E=typeof N.column=="string"?N.column.trim():"";E&&(!qr.has(E)||Nr.has(E))&&g.add(E)}),vn.forEach(N=>{const E=typeof N=="string"?N.trim():"";E&&(!qr.has(E)||Nr.has(E))&&g.add(E)}),Array.from(g).sort((N,E)=>N.localeCompare(E))},[an,Hr,Nr,Q,qr,vn]),Io=f.useMemo(()=>!Q||!Sr.length?[]:Sr.filter(g=>!vn.includes(g)),[Sr,Q,vn]).length>0,Cn=f.useMemo(()=>{const g=typeof(ye==null?void 0:ye.keep)=="string"?ye.keep.trim().toLowerCase():"";return g==="last"||g==="none"?g:Z1},[ye==null?void 0:ye.keep]),{binningExcludedColumns:un,binningColumnPreviewMap:Hn}=f$({isBinningNode:Q,numericExcludedColumns:qr,selectedColumns:vn,previewSampleRows:Tn,availableColumns:an,recommendedColumns:Nr}),Pu=f.useMemo(()=>{const g=Fn==null?void 0:Fn.excluded_columns;return Array.isArray(g)?g.filter(N=>!N||typeof N.column!="string"?!1:!!N.column.trim()):[]},[Fn==null?void 0:Fn.excluded_columns]);w$({isScalingNode:me,isBinningNode:Q,isOutlierNode:ne,scalingExcludedColumns:us,binningExcludedColumns:un,outlierExcludedColumns:Vl,setConfigState:Ie});const Yl=f.useMemo(()=>{var E,L;if(!ne)return null;const g=(L=(E=Lt.data)==null?void 0:E.signals)==null?void 0:L.outlier_removal;return!Array.isArray(g)||!g.length?null:Ae?g.find(F=>F&&F.node_id===Ae)??g[g.length-1]??null:g[g.length-1]??null},[ne,Ae,(ao=(Yu=Lt.data)==null?void 0:Yu.signals)==null?void 0:ao.outlier_removal]),Ql=f.useMemo(()=>{var E,L;if(!Z)return null;const g=(L=(E=Lt.data)==null?void 0:E.signals)==null?void 0:L.transformer_audit;return!Array.isArray(g)||!g.length?null:Ae?g.find(F=>F&&F.node_id===Ae)??g[g.length-1]??null:g[g.length-1]??null},[Z,Ae,(Um=(Bm=Lt.data)==null?void 0:Bm.signals)==null?void 0:Um.transformer_audit]);f.useEffect(()=>{var L;const g=Array.isArray((L=Lt.data)==null?void 0:L.column_stats)?Lt.data.column_stats:[];if(!g.length){if(Lt.status==="loading")return;Pl(F=>Object.keys(F).length?{}:F),$l(F=>Object.keys(F).length?{}:F);return}const N={},E={};g.forEach(F=>{if(!F||!F.name)return;const re=String(F.name).trim();if(!re||cn&&re.endsWith(cn))return;const oe=typeof F.dtype=="string"?F.dtype:null;oe&&(N[re]=oe);const ue=Tn.map(je=>je&&Object.prototype.hasOwnProperty.call(je,re)?je[re]:void 0),ce=o2(oe,ue);ce.length&&(E[re]=ce)}),Pl(F=>{const re=Object.entries(F),oe=Object.entries(N);return re.length===oe.length&&re.every(([ue,ce])=>Object.prototype.hasOwnProperty.call(N,ue)&&N[ue]===ce)?F:N}),$l(F=>{const re=Object.keys(F),oe=Object.keys(E);return re.length===oe.length&&re.every(ue=>{if(!Object.prototype.hasOwnProperty.call(E,ue))return!1;const ce=F[ue]??[],je=E[ue]??[];return fw(ce,je)})?F:E})},[cn,Tn,(Qu=Lt.data)==null?void 0:Qu.column_stats,Lt.status]),f.useEffect(()=>{var re,oe,ue;if(!Jc||!xt)return;const g=new Set;(Array.isArray((re=Lt.data)==null?void 0:re.columns)?Lt.data.columns:[]).forEach(ce=>{const je=typeof ce=="string"?ce.trim():"";je&&(cn&&je.endsWith(cn)||g.add(je))});const E=Array.isArray((oe=Lt.data)==null?void 0:oe.column_stats)?Lt.data.column_stats:[],L={};if(E.forEach(ce=>{if(!ce||!ce.name)return;const je=String(ce.name).trim();if(!je||cn&&je.endsWith(cn))return;g.add(je);const Le=Number(ce.missing_percentage);!Number.isNaN(Le)&&Le>=0&&(L[je]=Le)}),ut((ue=e==null?void 0:e.data)==null?void 0:ue.columns).forEach(ce=>{ce&&!(cn&&ce.endsWith(cn))&&g.add(ce)}),vn.forEach(ce=>{ce&&!(cn&&ce.endsWith(cn))&&g.add(ce)}),g.size===0)return;const F=Array.from(g).sort((ce,je)=>ce.localeCompare(je));su(ce=>fw(ce,F)?ce:F),Object.keys(L).length>0&&Ni(ce=>({...ce,...L}))},[cn,xt,(hc=e==null?void 0:e.data)==null?void 0:hc.columns,(yp=Lt.data)==null?void 0:yp.column_stats,(bp=Lt.data)==null?void 0:bp.columns,Jc,vn]);const Di=f.useMemo(()=>Co.trim().toLowerCase(),[Co]),rs=f.useMemo(()=>Di?an.filter(g=>g.toLowerCase().includes(Di)):an,[an,Di]),ym=f.useCallback(g=>{Ie(N=>{const E=$g(Wx(N==null?void 0:N.transformations)),L=$g(g(E));return{...N,transformations:L.map(F=>({...F}))}})},[]),{skewnessThreshold:Gl,skewnessViewMode:bm,setSkewnessViewMode:ra,skewnessGroupByMethod:Cr,setSkewnessGroupByMethod:Xl,skewnessDistributionView:to,setSkewnessDistributionView:Tu,skewnessRecommendedCount:Ph,skewnessNumericCount:Th,skewnessTransformationsCount:$h,hasSkewnessAutoRecommendations:Lh,skewnessRows:Dh,skewnessTableGroups:zh,skewnessDistributionCards:Bo,getSkewnessMethodLabel:Rh,getSkewnessMethodStatus:Jl,applySkewnessRecommendations:Fh,handleSkewnessOverrideChange:$u,clearSkewnessTransformations:Lu}=$$({skewnessData:Xa,shouldLoadInsights:oh,skewnessTransformations:ch,availableColumns:an,previewColumns:na,columnTypeMap:gr,updateSkewnessTransformations:ym}),{imputerColumnOptions:Ih,imputerMissingSliderMax:xm,imputerFilteredOptionCount:Bh,imputerMissingFilterActive:Uh}=O$({isImputerNode:w,imputerStrategies:Ha,availableColumns:an,columnMissingMap:Eo,previewColumns:na,previewColumnStats:ys,nodeColumns:(qm=e==null?void 0:e.data)==null?void 0:qm.columns,imputerMissingFilter:dh}),no=f.useMemo(()=>G.find(g=>g.name==="missing_threshold"),[G]),ka=(no==null?void 0:no.name)??null,Er=f.useMemo(()=>{if(ou===null||Number.isNaN(Number(ou)))return null;const g=Number(ou);return Math.round(g*10)/10},[ou]),Du=f.useMemo(()=>{if(ka===null||Er===null)return!1;const g=Number(ye==null?void 0:ye[ka]);return!Number.isNaN(g)&&g===Er},[ye,Er,ka]),qh=yt&&!!(no||Zc),nr=f.useCallback((g,N)=>{g&&Ie(E=>{const L={...E};return N===void 0?delete L[g]:L[g]=N,L})},[]),Hh=f.useCallback((g,N)=>{if(!g)return;if(N===""){nr(g,void 0);return}const E=Number(N);Number.isNaN(E)||nr(g,E)},[nr]);f.useCallback((g,N)=>{if(!g)return;if(N===""){nr(g,void 0);return}const E=Number(N);if(!Number.isFinite(E))return;const L=Math.min(Math.max(E,0),100);nr(g,L)},[nr]),f.useCallback((g,N,E)=>{const L=String(g??"").trim();L&&Ie(F=>{const re=F.manual_bounds&&typeof F.manual_bounds=="object"&&!Array.isArray(F.manual_bounds)?{...F.manual_bounds}:{},oe=re[L]&&typeof re[L]=="object"?{...re[L]}:{lower:null,upper:null};if(E==="")N==="lower"?oe.lower=null:oe.upper=null;else{const je=Number(E);if(!Number.isFinite(je))return F;N==="lower"?oe.lower=je:oe.upper=je}const ue=oe.lower??null,ce=oe.upper??null;return ue===null&&ce===null?delete re[L]:re[L]={lower:ue,upper:ce},{...F,manual_bounds:re}})},[]),f.useCallback(g=>{const N=String(g??"").trim();N&&Ie(E=>{const L=E.manual_bounds&&typeof E.manual_bounds=="object"&&!Array.isArray(E.manual_bounds)?E.manual_bounds:null;if(!L||!Object.prototype.hasOwnProperty.call(L,N))return E;const F={...L};return delete F[N],{...E,manual_bounds:F}})},[]);const wm=f.useCallback((g,N)=>{nr(g,N)},[nr]),Zl=f.useCallback((g,N)=>{nr(g,N)},[nr]),L_=f.useCallback((g,N,E,L)=>{Ie(F=>{const re=typeof(F==null?void 0:F[g])=="number"&&Number.isFinite(F[g])?F[g]:void 0;if(N===""){if(re===void 0)return F;const ce={...F};return delete ce[g],ce}const oe=Number(N);if(!Number.isFinite(oe))return F;const ue=Math.min(Math.max(Math.round(oe),E),L);return re===ue?F:{...F,[g]:ue}})},[]),Vh=f.useCallback((g,N)=>{Ie(E=>!!(E!=null&&E[g])===N?E:{...E,[g]:N})},[]),Wh=f.useCallback(g=>{const N=g.trim();Ie(E=>{const L=typeof(E==null?void 0:E.output_suffix)=="string"?E.output_suffix:"";if(!N){if(!L)return E;const F={...E};return delete F.output_suffix,F}return L===N?E:{...E,output_suffix:N}})},[]),Kh=f.useCallback(g=>{Ie(N=>{const E=typeof(N==null?void 0:N.label_format)=="string"?N.label_format:"";return(["range","bin_index","ordinal","column_suffix"].includes(E)?E:"range")===g?N:{...N,label_format:g}})},[]),zu=f.useCallback(g=>{Ie(N=>{if(((N==null?void 0:N.missing_strategy)==="label"?"label":"keep")===g)return N;const L={...N,missing_strategy:g};return g!=="label"&&Object.prototype.hasOwnProperty.call(L,"missing_label")&&delete L.missing_label,L})},[]),D_=f.useCallback(g=>{const N=g.trim();Ie(E=>{const L=typeof(E==null?void 0:E.missing_label)=="string"?E.missing_label:"";if(!N){if(!L)return E;const F={...E};return delete F.missing_label,F}return L===N?E:{...E,missing_label:N}})},[]),z_=f.useCallback((g,N)=>{const E=String(g??"").trim();E&&(Fo(L=>({...L,[E]:N})),Ie(L=>{const F=L==null?void 0:L.custom_bins,re=F&&typeof F=="object"&&!Array.isArray(F)?F:{},oe=Array.isArray(re[E])?re[E]:void 0,ce=N.split(/[,\n]/).map(vt=>vt.trim()).filter(Boolean).map(vt=>Number(vt)).filter(vt=>Number.isFinite(vt)).sort((vt,Ft)=>vt-Ft).filter((vt,Ft,xn)=>Ft===0||vt!==xn[Ft-1]),je=ce.length>=2;if(je&&oe&&oe.length===ce.length&&oe.every((vt,Ft)=>vt===ce[Ft])||!je&&!oe)return L;const Le={...L},lt={...re};return je?lt[E]=ce:delete lt[E],Object.keys(lt).length>0?Le.custom_bins=lt:delete Le.custom_bins,Le}))},[]),R_=f.useCallback((g,N)=>{const E=String(g??"").trim();E&&(Ou(L=>({...L,[E]:N})),Ie(L=>{const F=L==null?void 0:L.custom_labels,re=F&&typeof F=="object"&&!Array.isArray(F)?F:{},oe=Array.isArray(re[E])?re[E]:void 0,ue=N.split(/[,\n]/).map(Le=>Le.trim()).filter(Boolean);if(ue.length>0&&oe&&oe.length===ue.length&&oe.every((Le,lt)=>Le===ue[lt])||ue.length===0&&!oe)return L;const ce={...L},je={...re};return ue.length>0?je[E]=ue:delete je[E],Object.keys(je).length>0?ce.custom_labels=je:delete ce.custom_labels,ce}))},[]),as=f.useCallback(g=>{const N=String(g??"").trim();N&&(Fo(E=>{if(!Object.prototype.hasOwnProperty.call(E,N))return E;const L={...E};return delete L[N],L}),Ou(E=>{if(!Object.prototype.hasOwnProperty.call(E,N))return E;const L={...E};return delete L[N],L}),Ie(E=>{let L=!1;const F={...E};if(E!=null&&E.custom_bins&&typeof E.custom_bins=="object"&&!Array.isArray(E.custom_bins)&&Object.prototype.hasOwnProperty.call(E.custom_bins,N)){const re={...E.custom_bins};delete re[N],Object.keys(re).length>0?F.custom_bins=re:delete F.custom_bins,L=!0}if(E!=null&&E.custom_labels&&typeof E.custom_labels=="object"&&!Array.isArray(E.custom_labels)&&Object.prototype.hasOwnProperty.call(E.custom_labels,N)){const re={...E.custom_labels};delete re[N],Object.keys(re).length>0?F.custom_labels=re:delete F.custom_labels,L=!0}return L?F:E}))},[]),sr=f.useCallback((g,N)=>{const E=String(g??"").trim();E&&Ie(L=>{const re={...L!=null&&L.column_strategies&&typeof L.column_strategies=="object"&&!Array.isArray(L.column_strategies)?L.column_strategies:L!=null&&L.column_overrides&&typeof L.column_overrides=="object"&&!Array.isArray(L.column_overrides)?L.column_overrides:{}},oe=re[E],ue=oe&&typeof oe=="object"&&!Array.isArray(oe)?{...oe}:{},ce=N(ue),je=!!(ce&&Object.keys(ce).length);je?re[E]=ce:delete re[E];const Le={...L};if(je){const lt=new Set(ut(L==null?void 0:L.columns));lt.has(E)||(lt.add(E),Le.columns=Array.from(lt).sort((vt,Ft)=>vt.localeCompare(Ft)))}return Object.keys(re).length?(Le.column_overrides=re,Le.column_strategies=re):(Object.prototype.hasOwnProperty.call(Le,"column_overrides")&&delete Le.column_overrides,Object.prototype.hasOwnProperty.call(Le,"column_strategies")&&delete Le.column_strategies),Le})},[Ie]),zi=f.useCallback((g,N,E)=>{const L=String(g??"").trim();if(!L)return;if(N==="__default__"){as(L),sr(L,()=>null);return}const F=Number.isFinite(E==null?void 0:E.recommendedBins)?Math.round(E.recommendedBins):null;sr(L,re=>{const oe={...re};oe.strategy=N;const ue=ce=>Math.min(200,Math.max(2,Math.round(F??ce)));return N==="equal_width"?(oe.equal_width_bins=ue(ss.equalWidthBins),delete oe.equal_frequency_bins,delete oe.kbins_n_bins,delete oe.kbins_encode,delete oe.kbins_strategy):N==="equal_frequency"?(oe.equal_frequency_bins=ue(ss.equalFrequencyBins),delete oe.equal_width_bins,delete oe.kbins_n_bins,delete oe.kbins_encode,delete oe.kbins_strategy):N==="kbins"?(oe.kbins_n_bins=ue(ss.kbinsNBins),oe.kbins_encode=ss.kbinsEncode,oe.kbins_strategy=ss.kbinsStrategy,delete oe.equal_width_bins,delete oe.equal_frequency_bins):N==="custom"&&(delete oe.equal_width_bins,delete oe.equal_frequency_bins,delete oe.kbins_n_bins,delete oe.kbins_encode,delete oe.kbins_strategy),Object.keys(oe).length?oe:null}),N!=="custom"&&as(L)},[ss.equalFrequencyBins,ss.equalWidthBins,ss.kbinsEncode,ss.kbinsNBins,ss.kbinsStrategy,as,sr]),Yh=f.useCallback((g,N,E)=>{const L=String(g??"").trim();L&&(sr(L,F=>{const re={...F};if(!E.trim())delete re[N];else{const oe=Number(E);if(!Number.isFinite(oe))return F;const ue=Math.min(200,Math.max(2,Math.round(oe)));re[N]=ue,N==="equal_width_bins"?(re.strategy="equal_width",delete re.equal_frequency_bins,delete re.kbins_n_bins,delete re.kbins_encode,delete re.kbins_strategy):N==="equal_frequency_bins"?(re.strategy="equal_frequency",delete re.equal_width_bins,delete re.kbins_n_bins,delete re.kbins_encode,delete re.kbins_strategy):N==="kbins_n_bins"&&(re.strategy="kbins",delete re.equal_width_bins,delete re.equal_frequency_bins)}return Object.keys(re).length?re:null}),as(L))},[as,sr]),Qh=f.useCallback((g,N)=>{const E=String(g??"").trim();E&&sr(E,L=>{const F={...L};return N?(F.strategy="kbins",F.kbins_encode=N):delete F.kbins_encode,Object.keys(F).length?F:null})},[sr]),Gh=f.useCallback((g,N)=>{const E=String(g??"").trim();E&&sr(E,L=>{const F={...L};return N?(F.strategy="kbins",F.kbins_strategy=N):delete F.kbins_strategy,Object.keys(F).length?F:null})},[sr]),jm=f.useCallback(g=>{const N=String(g??"").trim();N&&(as(N),sr(N,()=>null))},[as,sr]),Ri=f.useCallback(()=>{Ie(g=>{if(!((g==null?void 0:g.column_strategies)&&typeof g.column_strategies=="object"&&!Array.isArray(g.column_strategies)&&Object.keys(g.column_strategies).length>0||(g==null?void 0:g.column_overrides)&&typeof g.column_overrides=="object"&&!Array.isArray(g.column_overrides)&&Object.keys(g.column_overrides).length>0))return g;const E={...g};return Object.prototype.hasOwnProperty.call(E,"column_overrides")&&delete E.column_overrides,Object.prototype.hasOwnProperty.call(E,"column_strategies")&&delete E.column_strategies,E})},[Ie]),Nm=f.useCallback(()=>{Hr.length&&Hr.forEach(g=>{const N=typeof(g==null?void 0:g.column)=="string"?g.column.trim():"";if(!N)return;const E=g.recommended_strategy??"equal_width";zi(N,E,{recommendedBins:Number.isFinite(g==null?void 0:g.recommended_bins)?g.recommended_bins:null})})},[Hr,zi]),Fi=f.useCallback(g=>{if(!g)return;const N=[];for(const E of g){const L=typeof E=="string"?E.trim():"";L&&N.push(L)}N.length&&Ie(E=>{const L=E&&typeof E=="object"?E:{},F=new Set(ut(L.columns));let re=!1;if(N.forEach(ue=>{F.has(ue)||(F.add(ue),re=!0)}),!re)return E;const oe={...L};return oe.columns=Array.from(F).sort((ue,ce)=>ue.localeCompare(ce)),oe})},[]),F_=f.useCallback(()=>{Sr.length&&Fi(Sr)},[Sr,Fi]),aa=f.useCallback(g=>{const N=String(g??"").trim();N&&Ie(E=>{const L=ut(E.columns),F=L.includes(N),re=F?L.filter(je=>je!==N):[...L,N];let oe=!1,ue=E.manual_bounds;F&&ue&&typeof ue=="object"&&!Array.isArray(ue)&&Object.prototype.hasOwnProperty.call(ue,N)&&(ue={...ue},delete ue[N],oe=!0);const ce={...E,columns:re};if(oe&&(ce.manual_bounds=ue),Q){const je=new Set(re);if(E.custom_bins&&typeof E.custom_bins=="object"&&!Array.isArray(E.custom_bins)){const Le={};Object.entries(E.custom_bins).forEach(([lt,vt])=>{je.has(lt)&&Array.isArray(vt)&&vt.length&&(Le[lt]=[...vt])}),Object.keys(Le).length?ce.custom_bins=Le:"custom_bins"in ce&&delete ce.custom_bins}else"custom_bins"in ce&&delete ce.custom_bins;if(E.custom_labels&&typeof E.custom_labels=="object"&&!Array.isArray(E.custom_labels)){const Le={};Object.entries(E.custom_labels).forEach(([lt,vt])=>{je.has(lt)&&Array.isArray(vt)&&vt.length&&(Le[lt]=vt.map(Ft=>String(Ft)))}),Object.keys(Le).length?ce.custom_labels=Le:"custom_labels"in ce&&delete ce.custom_labels}else"custom_labels"in ce&&delete ce.custom_labels;if(E.column_overrides&&typeof E.column_overrides=="object"&&!Array.isArray(E.column_overrides)){const Le={};Object.entries(E.column_overrides).forEach(([lt,vt])=>{je.has(lt)&&vt&&typeof vt=="object"&&!Array.isArray(vt)&&(Le[lt]={...vt})}),Object.keys(Le).length?(ce.column_overrides=Le,ce.column_strategies=Le):("column_overrides"in ce&&delete ce.column_overrides,"column_strategies"in ce&&delete ce.column_strategies)}else"column_overrides"in ce&&delete ce.column_overrides,"column_strategies"in ce&&delete ce.column_strategies}if(me){let je=null;E.column_methods&&typeof E.column_methods=="object"&&!Array.isArray(E.column_methods)&&(je={},Object.entries(E.column_methods).forEach(([Le,lt])=>{const vt=typeof lt=="string"?lt.trim():null;!vt||!Lr.includes(vt)||F&&Le===N||(je[Le]=vt)})),je&&Object.keys(je).length?ce.column_methods=je:F&&Object.prototype.hasOwnProperty.call(ce,"column_methods")&&delete ce.column_methods}return ce})},[Q,me]),Sm=f.useCallback(()=>{ko.length&&Ie(g=>{const N=new Set(ut(g.columns));return ko.forEach(E=>{E!=null&&E.name&&N.add(String(E.name))}),{...g,columns:Array.from(N)}})},[ko]),Xh=f.useCallback(g=>{g.length&&Ie(N=>{const E=new Set(ut(N.columns));g.forEach(F=>{const re=String(F??"").trim();re&&E.add(re)});const L=Array.from(E).sort((F,re)=>F.localeCompare(re));return{...N,columns:L}})},[]),Jh=f.useCallback(g=>{g.length&&Ie(N=>{const E=new Set(ut(N.columns));let L=!1;g.forEach(oe=>{const ue=String(oe??"").trim();if(ue&&(E.add(ue),!L)){const ce=Dl.find(je=>je.column===ue);ce!=null&&ce.recommended_use_global_fallback&&(L=!0)}});const F=Array.from(E).sort((oe,ue)=>oe.localeCompare(ue)),re={...N,columns:F};return L&&(ya.current=!0,re.encode_missing=!0,re.handle_unknown="global_mean"),re})},[Dl]),Zh=f.useCallback(g=>{g.length&&Ie(N=>{const E=new Set(ut(N.columns));let L=0;g.forEach(oe=>{const ue=String(oe??"").trim();if(!ue)return;E.add(ue);const ce=cu.find(je=>je.column===ue);ce&&ce.recommended_bucket_count>L&&(L=ce.recommended_bucket_count)});const F=Array.from(E).sort((oe,ue)=>oe.localeCompare(ue)),re={...N,columns:F};if(L>0){const oe=Number(N==null?void 0:N.n_buckets);(!Number.isFinite(oe)||oe<=0)&&(re.n_buckets=L)}return re})},[cu]),I_=f.useCallback(g=>{g.length&&Ie(N=>{const E=new Set(ut(N.columns));let L=!1,F=!1;g.forEach(ue=>{const ce=String(ue??"").trim();if(ce&&(E.add(ce),!L||!F)){const je=uu.find(Le=>Le.column===ce);je!=null&&je.recommended_handle_unknown&&(L=!0),((je==null?void 0:je.missing_percentage)??0)>0&&(F=!0)}});const re=Array.from(E).sort((ue,ce)=>ue.localeCompare(ce)),oe={...N,columns:re};return L&&(oe.handle_unknown="use_encoded_value"),F&&(oe.encode_missing=!0),oe})},[uu]),Bs=f.useCallback(g=>{g.length&&Ie(N=>{const E=new Set(ut(N.columns));let L=(N==null?void 0:N.drop_first)===!0;g.forEach(oe=>{const ue=String(oe??"").trim();if(ue&&(E.add(ue),!L)){const ce=sm.find(je=>je.column===ue);ce!=null&&ce.recommended_drop_first&&(L=!0)}});const F=Array.from(E).sort((oe,ue)=>oe.localeCompare(ue)),re={...N,columns:F};return L&&(re.drop_first=!0),re})},[sm]),Ts=f.useCallback(g=>{g.length&&Ie(N=>{const E=new Set(ut(N.columns));let L=!1;g.forEach(oe=>{const ue=String(oe??"").trim();if(ue&&(E.add(ue),!L)){const ce=du.find(je=>je.column===ue);ce!=null&&ce.recommended_drop_first&&(L=!0)}});const F=Array.from(E).sort((oe,ue)=>oe.localeCompare(ue)),re={...N,columns:F};return L&&(re.drop_first=!0),re})},[du]),Cm=f.useCallback(()=>{an.length&&Ie(g=>{const N=new Set(ut(g.columns));return an.filter(L=>Q?!un.has(L):me?!us.has(L):!0).forEach(L=>N.add(L)),{...g,columns:Array.from(N).sort((L,F)=>L.localeCompare(F))}})},[an,un,Q,me,us]),ep=f.useCallback(g=>{lr.includes(g)&&Ie(N=>(N==null?void 0:N.default_method)===g?N:{...N,default_method:g})},[Ie]),tp=f.useCallback(g=>{Ie(N=>(typeof(N==null?void 0:N.auto_detect)=="boolean"?N.auto_detect:!0)===g?N:{...N,auto_detect:g})},[Ie]),Ru=f.useCallback((g,N)=>{const E=String(g??"").trim();E&&Ie(L=>{if(!L||typeof L!="object")return L;const F=ut(L.columns),re=new Set(F),oe=L.column_methods&&typeof L.column_methods=="object"&&!Array.isArray(L.column_methods)?{...L.column_methods}:{};let ue=!1;if(N){if(!lr.includes(N))return L;oe[E]!==N&&(oe[E]=N,ue=!0),re.has(E)||(re.add(E),ue=!0)}else Object.prototype.hasOwnProperty.call(oe,E)&&(delete oe[E],ue=!0);if(!ue)return L;const ce={...L};return ce.columns=Array.from(re).sort((je,Le)=>je.localeCompare(Le)),Object.keys(oe).length?ce.column_methods=oe:Object.prototype.hasOwnProperty.call(ce,"column_methods")&&delete ce.column_methods,ce})},[Ie]),np=f.useCallback(()=>{Ie(g=>{if(!g||typeof g!="object")return g;const N=g.column_methods&&typeof g.column_methods=="object"&&!Array.isArray(g.column_methods)&&Object.keys(g.column_methods).length>0,E=g.column_parameters&&typeof g.column_parameters=="object"&&!Array.isArray(g.column_parameters)&&Object.keys(g.column_parameters).length>0;if(!N&&!E)return g;const L={...g};return N&&delete L.column_methods,E&&delete L.column_parameters,L})},[Ie]),Em=f.useCallback(()=>{Ps.length&&Ie(g=>{if(!g||typeof g!="object")return g;const N=new Set(ut(g.columns)),E=new Set(ut(g.skipped_columns)),L=g.column_methods&&typeof g.column_methods=="object"&&!Array.isArray(g.column_methods)?{...g.column_methods}:{},F=g.column_parameters&&typeof g.column_parameters=="object"&&!Array.isArray(g.column_parameters)?{...g.column_parameters}:{};let re=!1;if(Ps.forEach(ue=>{if(!ue||ue.isExcluded||!ue.recommendedMethod)return;const ce=String(ue.column??"").trim();if(!ce||Vl.has(ce))return;const je=ue.recommendedMethod;lr.includes(je)&&(E.has(ce)&&(E.delete(ce),re=!0),N.has(ce)||(N.add(ce),re=!0),je===Lo.defaultMethod?Object.prototype.hasOwnProperty.call(L,ce)&&(delete L[ce],re=!0):L[ce]!==je&&(L[ce]=je,re=!0),Object.prototype.hasOwnProperty.call(F,ce)&&(delete F[ce],re=!0))}),!re)return g;const oe={...g,columns:Array.from(N).sort((ue,ce)=>ue.localeCompare(ce))};return E.size?oe.skipped_columns=Array.from(E).sort((ue,ce)=>ue.localeCompare(ce)):Object.prototype.hasOwnProperty.call(oe,"skipped_columns")&&delete oe.skipped_columns,Object.keys(L).length?oe.column_methods=L:Object.prototype.hasOwnProperty.call(oe,"column_methods")&&delete oe.column_methods,Object.keys(F).length?oe.column_parameters=F:Object.prototype.hasOwnProperty.call(oe,"column_parameters")&&delete oe.column_parameters,oe})},[Lo.defaultMethod,Vl,Ps,Ie]),km=f.useCallback(g=>{const N=String(g??"").trim();N&&Ie(E=>{if(!E||typeof E!="object")return E;const L=ut(E.columns),F=L.filter(xn=>xn!==N),re=new Set(ut(E.skipped_columns)),oe=re.size;re.add(N);const ue=oe!==re.size,ce=E.column_methods&&typeof E.column_methods=="object"&&!Array.isArray(E.column_methods)?{...E.column_methods}:{},je=Object.prototype.hasOwnProperty.call(ce,N);je&&delete ce[N];const Le=E.column_parameters&&typeof E.column_parameters=="object"&&!Array.isArray(E.column_parameters)?{...E.column_parameters}:{},lt=Object.prototype.hasOwnProperty.call(Le,N);if(lt&&delete Le[N],!(F.length!==L.length)&&!ue&&!je&&!lt)return E;const Ft={...E,columns:F.sort((xn,Bn)=>xn.localeCompare(Bn)),skipped_columns:Array.from(re).sort((xn,Bn)=>xn.localeCompare(Bn))};return Object.keys(ce).length?Ft.column_methods=ce:Object.prototype.hasOwnProperty.call(Ft,"column_methods")&&delete Ft.column_methods,Object.keys(Le).length?Ft.column_parameters=Le:Object.prototype.hasOwnProperty.call(Ft,"column_parameters")&&delete Ft.column_parameters,Ft})},[Ie]),ec=f.useCallback(g=>{const N=String(g??"").trim();N&&Ie(E=>{if(!E||typeof E!="object")return E;const L=ut(E.skipped_columns);if(!L.includes(N))return E;const F=L.filter(ue=>ue!==N),re=new Set(ut(E.columns));re.has(N)||re.add(N);const oe={...E,columns:Array.from(re).sort((ue,ce)=>ue.localeCompare(ce))};return F.length?oe.skipped_columns=F.sort((ue,ce)=>ue.localeCompare(ce)):Object.prototype.hasOwnProperty.call(oe,"skipped_columns")&&delete oe.skipped_columns,oe})},[Ie]),sp=f.useCallback((g,N)=>{if(N==="__skip__"){km(g);return}if(N==="__default__"){ec(g),Ru(g,null);return}lr.includes(N)&&(ec(g),Ru(g,N))},[km,ec,Ru]),rp=f.useCallback((g,N,E)=>{const L=String(N??"").trim().toLowerCase();Ie(F=>{if(!F||typeof F!="object")return F;const re=F.method_parameters&&typeof F.method_parameters=="object"&&!Array.isArray(F.method_parameters)?{...F.method_parameters}:{},oe={...re[g]??{}},ue=typeof E=="number"&&Number.isFinite(E)?E:null;let ce=!1;if(ue===null?Object.prototype.hasOwnProperty.call(oe,L)&&(delete oe[L],ce=!0):oe[L]!==ue&&(oe[L]=ue,ce=!0),!ce)return F;if(Object.keys(oe).length?re[g]=oe:delete re[g],!Object.keys(re).length){const je={...F};return Object.prototype.hasOwnProperty.call(je,"method_parameters")&&delete je.method_parameters,je}return{...F,method_parameters:re}})},[Ie]),Mm=f.useCallback((g,N,E)=>{const L=String(g??"").trim();if(!L)return;const F=String(N??"").trim().toLowerCase();Ie(re=>{if(!re||typeof re!="object")return re;const oe=re.column_parameters&&typeof re.column_parameters=="object"&&!Array.isArray(re.column_parameters)?{...re.column_parameters}:{},ue={...oe[L]??{}},ce=typeof E=="number"&&Number.isFinite(E)?E:null;let je=!1;if(ce===null?Object.prototype.hasOwnProperty.call(ue,F)&&(delete ue[F],je=!0):ue[F]!==ce&&(ue[F]=ce,je=!0),!je)return re;if(Object.keys(ue).length?oe[L]=ue:delete oe[L],!Object.keys(oe).length){const Le={...re};return Object.prototype.hasOwnProperty.call(Le,"column_parameters")&&delete Le.column_parameters,Le}return{...re,column_parameters:oe}})},[Ie]),Am=f.useCallback(g=>{Lr.includes(g)&&Ie(N=>(N==null?void 0:N.default_method)===g?N:{...N,default_method:g})},[Ie]),ap=f.useCallback(g=>{Ie(N=>(typeof(N==null?void 0:N.auto_detect)=="boolean"?N.auto_detect:!0)===g?N:{...N,auto_detect:g})},[Ie]),tc=f.useCallback((g,N)=>{const E=String(g??"").trim();E&&Ie(L=>{const F=ut(L.columns),re=F.includes(E),oe=L.column_methods&&typeof L.column_methods=="object"&&!Array.isArray(L.column_methods)?{...L.column_methods}:{};if(N){if(!Lr.includes(N))return L;const je=(oe[E]??null)!==N,Le=!re;if(!je&&!Le)return L;oe[E]=N;const lt=Le?[...F,E].sort((vt,Ft)=>vt.localeCompare(Ft)):F;return{...L,columns:lt,column_methods:oe}}if(!Object.prototype.hasOwnProperty.call(oe,E))return L;if(delete oe[E],Object.keys(oe).length)return{...L,column_methods:oe};const ue={...L};return Object.prototype.hasOwnProperty.call(ue,"column_methods")&&delete ue.column_methods,ue})},[Ie]),Fu=f.useCallback(()=>{Ie(g=>{if(!g.column_methods||typeof g.column_methods!="object"||Array.isArray(g.column_methods)||!Object.keys(g.column_methods).length)return g;const N={...g};return delete N.column_methods,N})},[Ie]),B_=f.useCallback(()=>{$o.length&&Ie(g=>{const N=ut(g.columns),E=new Set(N),L=new Set(ut(g.skipped_columns)),F=g.column_methods&&typeof g.column_methods=="object"&&!Array.isArray(g.column_methods)?{...g.column_methods}:{};let re=!1;if($o.forEach(ue=>{const ce=String(ue.column??"").trim(),je=ue.recommended_method;!ce||!Lr.includes(je)||L.has(ce)||(F[ce]!==je&&(F[ce]=je,re=!0),E.has(ce)||(E.add(ce),re=!0))}),!re)return g;const oe=Array.from(E).sort((ue,ce)=>ue.localeCompare(ce));return{...g,columns:oe,column_methods:F}})},[$o,Ie]),Om=f.useCallback(g=>{const N=String(g??"").trim();N&&Ie(E=>{const L=ut(E.columns),F=L.filter(Le=>Le!==N),re=new Set(ut(E.skipped_columns)),oe=re.size;re.add(N);const ue=re.size!==oe,ce=E.column_methods&&typeof E.column_methods=="object"&&!Array.isArray(E.column_methods)?{...E.column_methods}:{},je=Object.prototype.hasOwnProperty.call(ce,N);return je&&delete ce[N],!ue&&F.length===L.length&&!je?E:{...E,columns:F.sort((Le,lt)=>Le.localeCompare(lt)),column_methods:ce,skipped_columns:Array.from(re).sort((Le,lt)=>Le.localeCompare(lt))}})},[Ie]),nc=f.useCallback(g=>{const N=String(g??"").trim();N&&Ie(E=>{const L=ut(E.skipped_columns);if(!L.includes(N))return E;const F=new Set(L);F.delete(N);const re=new Set(ut(E.columns));return re.has(N)||re.add(N),{...E,columns:Array.from(re).sort((ue,ce)=>ue.localeCompare(ce)),skipped_columns:Array.from(F).sort((ue,ce)=>ue.localeCompare(ce))}})},[Ie]),op=f.useCallback((g,N)=>{if(N==="__skip__"){Om(g);return}if(N==="__default__"){nc(g),tc(g,null);return}Lr.includes(N)&&(nc(g),tc(g,N))},[Om,nc,tc]),sc=f.useCallback(()=>{Ie(g=>{const N={...g,columns:[]};return g!=null&&g.manual_bounds&&typeof g.manual_bounds=="object"&&!Array.isArray(g.manual_bounds)&&Object.keys(g.manual_bounds).length&&(N.manual_bounds={}),Q&&("custom_bins"in N&&delete N.custom_bins,"custom_labels"in N&&delete N.custom_labels,"column_overrides"in N&&delete N.column_overrides,"column_strategies"in N&&delete N.column_strategies),me&&"column_methods"in N&&delete N.column_methods,N})},[Q,me]),oa=f.useCallback(g=>{const N=String(g??"").trim();N&&Ie(E=>{const L=ut(E.columns);if(!L.includes(N))return E;const F=L.filter(ce=>ce!==N);let re=!1,oe=E.manual_bounds;oe&&typeof oe=="object"&&!Array.isArray(oe)&&Object.prototype.hasOwnProperty.call(oe,N)&&(oe={...oe},delete oe[N],re=!0);const ue={...E,columns:F};if(re&&(ue.manual_bounds=oe),Q){if(E.custom_bins&&typeof E.custom_bins=="object"&&!Array.isArray(E.custom_bins)){const ce={};Object.entries(E.custom_bins).forEach(([je,Le])=>{je!==N&&Array.isArray(Le)&&Le.length&&(ce[je]=[...Le])}),Object.keys(ce).length?ue.custom_bins=ce:"custom_bins"in ue&&delete ue.custom_bins}else"custom_bins"in ue&&delete ue.custom_bins;if(E.custom_labels&&typeof E.custom_labels=="object"&&!Array.isArray(E.custom_labels)){const ce={};Object.entries(E.custom_labels).forEach(([je,Le])=>{je!==N&&Array.isArray(Le)&&Le.length&&(ce[je]=Le.map(lt=>String(lt)))}),Object.keys(ce).length?ue.custom_labels=ce:"custom_labels"in ue&&delete ue.custom_labels}else"custom_labels"in ue&&delete ue.custom_labels;if(E.column_overrides&&typeof E.column_overrides=="object"&&!Array.isArray(E.column_overrides)){const ce={};Object.entries(E.column_overrides).forEach(([je,Le])=>{je!==N&&Le&&typeof Le=="object"&&!Array.isArray(Le)&&(ce[je]={...Le})}),Object.keys(ce).length?(ue.column_overrides=ce,ue.column_strategies=ce):("column_overrides"in ue&&delete ue.column_overrides,"column_strategies"in ue&&delete ue.column_strategies)}else"column_overrides"in ue&&delete ue.column_overrides,"column_strategies"in ue&&delete ue.column_strategies}if(me)if(E.column_methods&&typeof E.column_methods=="object"&&!Array.isArray(E.column_methods)){const ce={};Object.entries(E.column_methods).forEach(([je,Le])=>{const lt=typeof Le=="string"?Le.trim():null;!lt||!Lr.includes(lt)||je!==N&&(ce[je]=lt)}),Object.keys(ce).length?ue.column_methods=ce:Object.prototype.hasOwnProperty.call(ue,"column_methods")&&delete ue.column_methods}else Object.prototype.hasOwnProperty.call(ue,"column_methods")&&delete ue.column_methods;return ue})},[Q,me]),ip=f.useCallback(()=>{Er===null||!ka||nr(ka,Er)},[nr,Er,ka]),Vr=f.useCallback(()=>{if(!Nt||!Ae)return;const g=Yg(d??{});z&&(ya.current=!1),Ie(g),u==null||u(Ae,g)},[Nt,d,z,Ae,u,ya]),rc=f.useCallback(g=>{let N=Yg(ye);if(Q){const E=Rx(N);N={...N,strategy:E.strategy,columns:E.columns,equal_width_bins:E.equalWidthBins,equal_frequency_bins:E.equalFrequencyBins,include_lowest:E.includeLowest,precision:E.precision,duplicates:E.duplicates,output_suffix:E.outputSuffix,drop_original:E.dropOriginal,label_format:E.labelFormat,missing_strategy:E.missingStrategy},E.missingStrategy==="label"?N.missing_label=E.missingLabel:Object.prototype.hasOwnProperty.call(N,"missing_label")&&delete N.missing_label,Object.keys(E.customBins).length?N.custom_bins=E.customBins:Object.prototype.hasOwnProperty.call(N,"custom_bins")&&delete N.custom_bins,Object.keys(E.customLabels).length?N.custom_labels=E.customLabels:Object.prototype.hasOwnProperty.call(N,"custom_labels")&&delete N.custom_labels}if(me){const E=Vx(N);N={...N,columns:E.columns,default_method:E.defaultMethod,auto_detect:E.autoDetect,skipped_columns:E.skippedColumns},Object.keys(E.columnMethods).length>0?N.column_methods=E.columnMethods:Object.prototype.hasOwnProperty.call(N,"column_methods")&&delete N.column_methods}n(e.id,N),(g==null?void 0:g.closeModal)!==!1&&t(),i&&l&&!st&&(a&&a(e.id,{backgroundExecutionStatus:"loading"}),Ox({dataset_source_id:i,graph:{nodes:l.nodes||[],edges:l.edges||[]},target_node_id:e.id}).then(()=>{a&&a(e.id,{backgroundExecutionStatus:"success"})}).catch(E=>{a&&a(e.id,{backgroundExecutionStatus:"error"}),console.warn("Background full dataset execution failed:",E)}))},[ye,Q,e.id,t,n,a,i,l,st]),Pm=Er!==null&&!Du,Iu=vn.length,Ii=Cs(E_),bs=Cs((br==null?void 0:br.generated_at)??null),U_=Cs((Fn==null?void 0:Fn.generated_at)??null),q_=Cs((ns==null?void 0:ns.generated_at)??null),ac=Number(br==null?void 0:br.sample_size),xs=Number.isFinite(ac)?Math.max(0,Math.round(ac)):null,lp=Number(Fn==null?void 0:Fn.sample_size),nt=Number.isFinite(lp)?Math.max(0,Math.round(lp)):null,Uo=Number(ns==null?void 0:ns.sample_size),Tm=Number.isFinite(Uo)?Math.max(0,Math.round(Uo)):null,Bu=C_&&!!i&&xt,cp=!at&&!st,oc=cp&&ih!==x_,Bi=vh.status==="loading",ic=Lt.status==="loading",$m=Bi||ic||Qa||gu||Ao||ki||xa,up=f.useMemo(()=>Bi?"Generating dataset profile":Qa?"Loading scaling insights":gu?"Loading binning insights":Ao?"Loading hash encoding insights":ki?"Computing binned distributions":xa?"Fetching column recommendations":ic?Ur?"Loading dataset preview":"Analyzing node outputs":null,[ki,xa,Qa,gu,Ao,en,ic,Bi,Ur])??($m?"Processing":null),Us=f.useCallback(g=>{Ie(N=>{const E=Ux(N==null?void 0:N.strategies,Pe),L=g(E).map(F=>({...F,options:bd(F.method,F.options)}));return{...N,strategies:HM(L)}})},[Pe]),qs=f.useCallback(g=>{S&&Ie(N=>{var vt,Ft,xn,Bn,Vs,Yr,Ws,At,kn;if(!S)return N;const E=ut((N==null?void 0:N.columns)??((Ft=(vt=e==null?void 0:e.data)==null?void 0:vt.config)==null?void 0:Ft.columns)),L=Df(N==null?void 0:N.mode,(Bn=(xn=e==null?void 0:e.data)==null?void 0:xn.config)==null?void 0:Bn.mode),F=(()=>{var Ks;const Un=$c(N);if(Un!==void 0){const la=ll(Un);if(la!==null)return la}const mn=$c((Ks=e==null?void 0:e.data)==null?void 0:Ks.config);if(mn!==void 0){const la=ll(mn);if(la!==null)return la}return E.length===0})(),re=(N==null?void 0:N.alias_strategies)??(N==null?void 0:N.strategies)??((Yr=(Vs=e==null?void 0:e.data)==null?void 0:Vs.config)==null?void 0:Yr.alias_strategies)??((At=(Ws=e==null?void 0:e.data)==null?void 0:Ws.config)==null?void 0:At.strategies),oe=Jx(re,{mode:L,columns:E,autoDetect:F}),ue=g(oe).map(Un=>({mode:Df(Un.mode,L),columns:Array.from(new Set(Un.columns.map(mn=>mn.trim()).filter(Boolean))).sort((mn,Ks)=>mn.localeCompare(Ks)),autoDetect:!!Un.autoDetect})),ce=vA(ue),je=Array.from(new Set(ue.flatMap(Un=>Un.columns))).sort((Un,mn)=>Un.localeCompare(mn)),Le=((kn=ue[0])==null?void 0:kn.mode)??L,lt=ue.length?ue.some(Un=>Un.autoDetect):F;return{...N,alias_strategies:ce,columns:je,mode:Le,auto_detect:lt}})},[S,(Hm=e==null?void 0:e.data)==null?void 0:Hm.config]),dn=f.useCallback(g=>{Ie(N=>{var Le,lt,vt,Ft,xn,Bn,Vs;if(!O)return N;const E=ut((N==null?void 0:N.columns)??((lt=(Le=e==null?void 0:e.data)==null?void 0:Le.config)==null?void 0:lt.columns)),L=c0(N==null?void 0:N.mode,(Ft=(vt=e==null?void 0:e.data)==null?void 0:vt.config)==null?void 0:Ft.mode),F=E.length===0,re=u0((N==null?void 0:N.format_strategies)??((Bn=(xn=e==null?void 0:e.data)==null?void 0:xn.config)==null?void 0:Bn.format_strategies),{columns:E,mode:L,autoDetect:F}),oe=g(re),ue=VA(oe),ce=Array.from(new Set(oe.flatMap(Yr=>Yr.columns.map(Ws=>Ws.trim()).filter(Boolean)))).sort((Yr,Ws)=>Yr.localeCompare(Ws)),je=((Vs=oe[0])==null?void 0:Vs.mode)??L;return{...N,format_strategies:ue,columns:ce,mode:je}})},[O,(xp=(oo=e==null?void 0:e.data)==null?void 0:oo.config)==null?void 0:xp.columns,(Vm=(Ho=e==null?void 0:e.data)==null?void 0:Ho.config)==null?void 0:Vm.format_strategies,(wp=(En=e==null?void 0:e.data)==null?void 0:En.config)==null?void 0:wp.mode]),Wr=f.useCallback(()=>{i&&Oo()},[Oo,i]),so=f.useMemo(()=>{if(!pe)return[];const N=(Array.isArray(ns==null?void 0:ns.columns)?ns==null?void 0:ns.columns:[]).map(E=>{if(!E||!E.column)return null;const L=Number(E.total_rows),F=Number.isFinite(L)?Math.max(0,Math.round(L)):0;if(F<=0)return null;const oe=(Array.isArray(E.bins)?E.bins:[]).map(mn=>{if(!mn)return null;const la=(typeof mn.label=="string"?mn.label.trim():String(mn.label??""))||(mn.is_missing?"Missing":"Unlabeled bin"),qn=Number(mn.count);if(!Number.isFinite(qn))return null;const Vi=Math.max(0,Math.round(qn)),Ta=Number(mn.percentage),Vo=Number.isFinite(Ta)?Math.min(100,Math.max(0,Ta)):0,Wo=Number(Vo.toFixed(2));return{label:la,count:Vi,percentage:Wo,isMissing:!!mn.is_missing}}).filter(mn=>!!mn);if(!oe.length)return null;oe.sort((mn,Ks)=>mn.isMissing!==Ks.isMissing?mn.isMissing?1:-1:mn.count!==Ks.count?Ks.count-mn.count:mn.label.localeCompare(Ks.label));const ue=oe.length,ce=12,je=ue>ce,Le=je?oe.slice(0,ce):oe,lt=Number(E.missing_rows),vt=Number.isFinite(lt)?Math.max(0,Math.round(lt)):0,Ft=Number(E.distinct_bins),xn=Number.isFinite(Ft)?Math.max(0,Math.round(Ft)):oe.length,Bn=E.top_label;let Vs=typeof Bn=="string"?Bn.trim()||null:Bn??null;const Yr=Number(E.top_count);let Ws=Number.isFinite(Yr)?Math.max(0,Math.round(Yr)):null;const At=Number(E.top_percentage);let kn=Number.isFinite(At)?Number(Math.min(100,Math.max(0,At)).toFixed(2)):null;(Vs===null||Ws===null||kn===null)&&Le.length&&(Vs=Le[0].label,Ws=Le[0].count,kn=Le[0].percentage);const Un=typeof E.source_column=="string"?E.source_column.trim()||null:E.source_column??null;return{column:E.column,sourceColumn:Un,totalRows:F,missingRows:vt,distinctBins:xn,topLabel:Vs,topCount:Ws,topPercentage:kn,bins:Le,hasMoreBins:je,totalBinCount:ue}}).filter(E=>!!E);return N.sort((E,L)=>{const F=(L.topCount??0)-(E.topCount??0);return F!==0?F:E.column.localeCompare(L.column)}),N},[ns,pe]),dp=f.useCallback(()=>{var E;const g=lh,N=((E=be[0])==null?void 0:E.value)??"mean";Us(L=>[...L,{method:N,columns:[],options:bd(N,Bx(N))}]),vs(L=>{const F=new Set(L);return F.delete(g),F})},[be,lh,Us]),mp=f.useCallback(g=>{Us(N=>N.filter((E,L)=>L!==g)),vs(N=>{const E=new Set;return N.forEach(L=>{L!==g&&E.add(L>g?L-1:L)}),E})},[Us]),Kr=f.useCallback(g=>{vs(N=>{const E=new Set(N);return E.has(g)?E.delete(g):E.add(g),E})},[]),fp=f.useCallback((g,N)=>{Us(E=>E.map((L,F)=>F===g?{...L,method:N,options:bd(N,L.options)}:L))},[Us]),ia=f.useCallback((g,N,E)=>{Us(L=>L.map((F,re)=>{if(re!==g)return F;const oe={...F.options??{}};if(E==="")delete oe[N];else{const ue=Number(E);if(!Number.isFinite(ue))return F;oe[N]=ue}return{...F,options:bd(F.method,oe)}}))},[Us]),V_=f.useCallback((g,N)=>{const E=N.split(",").map(L=>L.trim()).filter(Boolean);Us(L=>L.map((F,re)=>re===g?{...F,columns:E}:F))},[Us]),hp=f.useCallback((g,N)=>{const E=N.trim();E&&Us(L=>L.map((F,re)=>{if(re!==g)return F;const ue=F.columns.includes(E)?F.columns.filter(ce=>ce!==E):[...F.columns,E];return ue.sort((ce,je)=>ce.localeCompare(je)),{...F,columns:ue}}))},[Us]),pp=f.useCallback(g=>{Gd(g)},[Gd]),gp=f.useCallback(()=>{const g=Nu.length;dn(N=>{var oe;const E=new Set;N.forEach(ue=>{ue.columns.forEach(ce=>{const je=ce.trim();je&&E.add(je)})});const L=Hl.recommendedColumns.find(ue=>!E.has(ue)),re={mode:N.length?N[N.length-1].mode:((oe=Fg[0])==null?void 0:oe.value)??jr,columns:L?[L]:[],autoDetect:!L};return[...N,re]}),vs(N=>{const E=new Set(N);return E.delete(g),E})},[Nu.length,vs,Hl.recommendedColumns,jr,dn]),_p=f.useCallback(g=>{dn(N=>N.filter((E,L)=>L!==g)),vs(N=>{const E=new Set;return N.forEach(L=>{L!==g&&E.add(L>g?L-1:L)}),E})},[vs,dn]),W_=f.useCallback(g=>{vs(N=>{const E=new Set(N);return E.has(g)?E.delete(g):E.add(g),E})},[]),Uu=f.useCallback((g,N)=>{dn(E=>E.map((L,F)=>F===g?{...L,mode:N}:L))},[dn]),Lm=f.useCallback((g,N)=>{const E=N.split(",").map(L=>L.trim()).filter(Boolean).sort((L,F)=>L.localeCompare(F));dn(L=>L.map((F,re)=>re===g?{...F,columns:E}:F))},[dn]),kr=f.useCallback((g,N)=>{const E=N.trim();E&&dn(L=>L.map((F,re)=>{if(re!==g)return F;const ue=F.columns.includes(E)?F.columns.filter(ce=>ce!==E):[...F.columns,E];return ue.sort((ce,je)=>ce.localeCompare(je)),{...F,columns:ue}}))},[dn]),Kt=f.useCallback((g,N)=>{dn(E=>E.map((L,F)=>F===g?{...L,autoDetect:N}:L))},[dn]),hn=f.useCallback(g=>{Ie(N=>{if(!W)return N;const E=N&&typeof N=="object"&&!Array.isArray(N)?{...N}:{},L=V0(Array.isArray(N==null?void 0:N.operations)?N.operations:[]),F=g(L);return E.operations=WP(F),E})},[W,Ie]),In=f.useCallback(g=>{if(!W)return;let N="";hn(E=>{const L=new Set(E.map(re=>re.id)),F=W0(g,L);return N=F.id,[...E,F]}),N&&yr(E=>{const L=new Set(E);return L.delete(N),L})},[W,yr,hn]),ds=f.useCallback(g=>{if(!W)return;let N="";hn(E=>{const L=E.findIndex(je=>je.id===g);if(L===-1)return E;const F=E[L],re=new Set(E.map(je=>je.id)),oe=W0(F.type,re);N=oe.id;const ue={...F,id:oe.id,inputColumns:[...F.inputColumns],secondaryColumns:[...F.secondaryColumns],constants:[...F.constants],datetimeFeatures:[...F.datetimeFeatures],outputColumn:F.outputColumn?`${F.outputColumn}_copy`:""},ce=[...E];return ce.splice(L+1,0,ue),ce}),N&&yr(E=>{const L=new Set(E);return L.delete(N),L})},[W,yr,hn]),rr=f.useCallback(g=>{W&&(hn(N=>N.filter(E=>E.id!==g)),yr(N=>{const E=new Set(N);return E.delete(g),E}))},[W,yr,hn]),Ui=f.useCallback((g,N)=>{W&&hn(E=>{const L=E.findIndex(ue=>ue.id===g);if(L===-1)return E;const F=N==="up"?L-1:L+1;if(F<0||F>=E.length)return E;const re=[...E],[oe]=re.splice(L,1);return re.splice(F,0,oe),re})},[W,hn]),Vn=f.useCallback(g=>{yr(N=>{const E=new Set(N);return E.has(g)?E.delete(g):E.add(g),E})},[]),lc=f.useCallback((g,N)=>{W&&hn(E=>E.map(L=>{if(L.id!==g)return L;let F={...L};if(N.type&&(F.type=N.type),N.method!==void 0&&(F.method=N.method),N.inputColumns!==void 0&&(F.inputColumns=$d(N.inputColumns)),N.secondaryColumns!==void 0&&(F.secondaryColumns=$d(N.secondaryColumns)),N.constants!==void 0&&(F.constants=Fw(N.constants)),N.outputColumn!==void 0&&(F.outputColumn=N.outputColumn.trim()),N.outputPrefix!==void 0&&(F.outputPrefix=N.outputPrefix.trim()),N.datetimeFeatures!==void 0&&(F.datetimeFeatures=Iw(N.datetimeFeatures)),N.timezone!==void 0&&(F.timezone=Uw(N.timezone)),N.fillna!==void 0&&(F.fillna=Ld(N.fillna)),N.roundDigits!==void 0&&(F.roundDigits=Bw(N.roundDigits)),N.normalize!==void 0&&(F.normalize=N.normalize),N.epsilon!==void 0&&(F.epsilon=Ld(N.epsilon)),N.allowOverwrite!==void 0&&(F.allowOverwrite=N.allowOverwrite),N.description!==void 0){const ue=typeof N.description=="string"?N.description.trim():"";F.description=ue||void 0}const re=F.type,oe=K0(re);return oe.length?new Set(oe.map(ce=>ce.value)).has(F.method)||(F.method=oe[0].value):re==="ratio"?F.method="ratio":re==="datetime_extract"&&(F.method="datetime_extract"),F.inputColumns=$d(F.inputColumns),re==="ratio"||re==="similarity"?F.secondaryColumns=$d(F.secondaryColumns):F.secondaryColumns=[],F.constants=Fw(F.constants),F.fillna=Ld(F.fillna),F.roundDigits=Bw(F.roundDigits),F.epsilon=Ld(F.epsilon),re==="datetime_extract"?(F.datetimeFeatures=Iw(F.datetimeFeatures),F.timezone=Uw(F.timezone)):(F.datetimeFeatures=[],F.timezone="UTC"),re!=="similarity"?F.normalize=!1:F.normalize=!!F.normalize,typeof F.allowOverwrite!="boolean"&&(F.allowOverwrite=null),F.outputColumn=F.outputColumn.trim(),F.outputPrefix=F.outputPrefix.trim(),F}))},[W,hn]),qo=f.useCallback(()=>{if(!S)return;const g=cm;qs(N=>{var oe;const E=new Set;N.forEach(ue=>{ue.columns.forEach(ce=>{const je=ce.trim();je&&E.add(je)})});const L=yu.recommendedColumns.find(ue=>!E.has(ue)),re={mode:N.length?N[N.length-1].mode:((oe=Gx[0])==null?void 0:oe.value)??Lg,columns:L?[L]:[],autoDetect:!L};return[...N,re]}),vs(N=>{const E=new Set(N);return E.delete(g),E})},[yu.recommendedColumns,cm,S,vs,qs]),qu=f.useCallback(g=>{qs(N=>N.filter((E,L)=>L!==g)),vs(N=>{const E=new Set;return N.forEach(L=>{L!==g&&E.add(L>g?L-1:L)}),E})},[vs,qs]),Dm=f.useCallback(g=>{vs(N=>{const E=new Set(N);return E.has(g)?E.delete(g):E.add(g),E})},[]),cc=f.useCallback((g,N)=>{qs(E=>E.map((L,F)=>F===g?{...L,mode:N}:L))},[qs]),Hs=f.useCallback((g,N)=>{const E=N.trim();E&&qs(L=>L.map((F,re)=>{if(re!==g)return F;const ue=F.columns.includes(E)?F.columns.filter(ce=>ce!==E):[...F.columns,E];return ue.sort((ce,je)=>ce.localeCompare(je)),{...F,columns:ue}}))},[qs]),zm=f.useCallback((g,N)=>{const E=N.split(",").map(F=>F.trim()).filter(Boolean),L=Array.from(new Set(E)).sort((F,re)=>F.localeCompare(re));qs(F=>F.map((re,oe)=>oe===g?{...re,columns:L}:re))},[qs]),qi=f.useCallback((g,N)=>{qs(E=>E.map((L,F)=>F===g?{...L,autoDetect:N}:L))},[qs]),ms=f.useCallback(g=>{var Ws;const N=((Ws=g==null?void 0:g.source)==null?void 0:Ws.type)==="drop_column_recommendations",E=!N,L=E&&Lt.status==="loading",F=Q&&g.name==="columns",re=me&&g.name==="columns",oe=(()=>{if(!F)return[];const At=[...Sr];return Nr.size>0&&Nr.forEach(kn=>{At.includes(kn)||At.push(kn)}),vn.forEach(kn=>{kn&&!At.includes(kn)&&At.push(kn)}),At})(),ue=F?oe:re?an.filter(At=>!us.has(At)):an,ce=F?Di?oe.filter(At=>At.toLowerCase().includes(Di)):oe:re?rs.filter(At=>!us.has(At)):rs,je=F?vn.filter(At=>!un.has(At)).length:re?vn.filter(At=>!us.has(At)).length:Iu,Le=E&&ue.length>0&&je>=ue.length,lt=N||w,vt=new Set(ue),Ft=I&&E?Object.entries(Tl).filter(([At,kn])=>vt.has(At)&&kn.length>0).map(([At,kn])=>`${At}: ${kn.join(", ")}`).slice(0,4):[],xn=F?Array.from(un).slice(0,4):[],Bn=re?Array.from(us).slice(0,4):[],Vs=F&&Nr.size>0,Yr=Vs?Array.from(Nr).some(At=>!vn.includes(At)):!1;return r.jsxs("div",{className:"canvas-modal__parameter-field canvas-modal__parameter-field--multiselect",children:[r.jsxs("div",{className:"canvas-modal__parameter-label",children:[r.jsx("span",{children:g.label}),N&&i&&r.jsx("div",{className:"canvas-modal__parameter-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Mo,disabled:xa||!xt,children:xa?"Refreshing":"Refresh suggestions"})})]}),g.description&&r.jsx("p",{className:"canvas-modal__parameter-description",children:g.description}),Ft.length>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Smart suggestions: ",Ft.join("; ")]}),F&&un.size>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipping ",un.size," non-numeric column",un.size===1?"":"s",xn.length?` (examples: ${xn.join(", ")}${un.size>xn.length?", ":""})`:""," binning only supports numeric inputs."]}),re&&us.size>0&&r.jsxs("p",{className:"canvas-modal__note",children:["Skipping ",us.size," non-numeric column",us.size===1?"":"s",Bn.length?` (examples: ${Bn.join(", ")}${us.size>Bn.length?", ":""})`:""," scaling only supports numeric inputs."]}),N&&r.jsx(X1,{sourceId:i,availableFilters:mh,activeFilterId:_r,setActiveFilterId:Si,recommendations:ko,filteredRecommendations:Xd,isFetchingRecommendations:xa,recommendationsError:au,relativeGeneratedAt:Ii,formatSignalName:Jd,formatMissingPercentage:Ss,getPriorityClass:vM,getPriorityLabel:yM,handleToggleColumn:aa,selectedColumns:vn}),r.jsxs("div",{className:"canvas-modal__note",children:["Selected columns: ",r.jsx("strong",{children:je})]}),je>0&&r.jsxs("div",{className:"canvas-modal__selection-summary",children:[r.jsx("h4",{children:"Selected columns"}),r.jsx("div",{className:"canvas-modal__selection-chips",children:vn.map(At=>r.jsxs("span",{className:"canvas-modal__selection-chip",children:[At,r.jsx("button",{type:"button",onClick:()=>oa(At),"aria-label":`Remove ${At}`,children:""})]},At))})]}),r.jsxs("div",{className:"canvas-modal__multi-select-actions",children:[N&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Sm,disabled:!ko.length,children:"Use all recommendations"}),Vs&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Fi(Nr),disabled:!Yr,children:"Add recommended columns"}),E&&r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Cm,disabled:!ue.length||Le,children:"Select all columns"}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:sc,disabled:!Iu,children:"Clear selection"})]}),r.jsxs("div",{className:"canvas-modal__all-columns",children:[r.jsx("h4",{children:"All columns"}),r.jsx("div",{className:"canvas-modal__all-columns-search",children:r.jsx("input",{type:"text",className:"canvas-modal__custom-input",value:Co,onChange:At=>ru(At.target.value),placeholder:"Search columns","aria-label":"Search columns"})}),r.jsx("div",{className:"canvas-modal__all-columns-list",role:"group","aria-label":"All columns",children:ce.length?ce.map(At=>{const kn=vn.includes(At),Un=Object.prototype.hasOwnProperty.call(Eo,At)?Eo[At]:void 0,mn=Ss(typeof Un=="number"?Un:null),Ks=gr[At]??null,la=Tl[At]??[],qn=F?Hn[At]:void 0,Vi=!!(qn&&(qn.min!==null&&qn.min!==void 0||qn.max!==null&&qn.max!==void 0)),Ta=F?(qn==null?void 0:qn.distinct)??null:null,Vo=F&&Ta!==null&&Number.isFinite(Ta),Wo=Vo?Ta:null,Gu=!F,K_=Gu||lt||Vi||Vo,Xu=Gu&&la.length>0;return r.jsxs("label",{className:`canvas-modal__checkbox-item canvas-modal__checkbox-item--compact${kn?" canvas-modal__checkbox-item--selected":""}`,children:[r.jsx("input",{type:"checkbox",checked:kn,onChange:()=>aa(At)}),r.jsxs("div",{className:"canvas-modal__column-option",children:[r.jsx("span",{className:"canvas-modal__column-option-name",children:At}),K_&&r.jsxs("div",{className:"canvas-modal__column-option-meta",children:[Gu&&r.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Type: ",IT(Ks)]}),lt&&r.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Missing: ",mn]}),Vi&&r.jsxs("span",{className:"canvas-modal__column-option-metric",children:[F?"Sample range":"Range",":"," ",qn&&qn.min!==null&&qn.min!==void 0?ir(qn.min):""," ",""," ",qn&&qn.max!==null&&qn.max!==void 0?ir(qn.max):""]}),Vo&&Wo!==null&&r.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Distinct sample values: ",$r(Wo)]})]}),Xu&&r.jsxs("span",{className:"canvas-modal__column-option-hint",children:["Suggested: ",la.join(", ")]})]})]},At)}):r.jsx("p",{className:"canvas-modal__note",children:an.length?F&&ue.length===0?"No eligible columns for binning (non-numeric fields are skipped).":"No columns match your search.":L?"Loading column catalog":i?xt?"Column catalog unavailable for this dataset.":"Connect this step to an upstream output to load column catalog.":"Select a dataset to load column catalog."})})]})]},g.name)},[_r,an,mh,Eo,Co,Tl,gr,Sr,qr,rs,Xd,Jd,Sm,Fi,sc,oa,Cm,aa,xt,I,xa,Q,Nr,Hn,w,me,un,Lt.status,ko,au,Ii,vn,Iu,Si,ru,us,Bu,i,Mo,Di]),Xt=f.useCallback(g=>{var L;if(!(g!=null&&g.name))return null;if(g.type==="multi_select")return ms(g);if(g.type==="number"){const F=`node-${e.id}-${g.name}`,re=ye==null?void 0:ye[g.name],oe=typeof re=="number"?re:re??"";return r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsxs("label",{htmlFor:F,className:"canvas-modal__parameter-label",children:[r.jsx("span",{children:g.label}),g.unit&&r.jsx("span",{className:"canvas-modal__parameter-unit",children:g.unit})]}),g.description&&r.jsx("p",{className:"canvas-modal__parameter-description",children:g.description}),r.jsxs("div",{className:"canvas-modal__parameter-control",children:[r.jsx("input",{id:F,type:"number",className:"canvas-modal__input",value:oe,min:g.min!==void 0?g.min:void 0,max:g.max!==void 0?g.max:void 0,step:g.step!==void 0?g.step:"any",onChange:ue=>Hh(g.name,ue.target.value)}),g.unit&&r.jsx("span",{className:"canvas-modal__parameter-unit",children:g.unit})]}),ka===g.name&&Er!==null&&Bu&&r.jsxs("div",{className:"canvas-modal__note",children:["Suggested threshold from EDA:"," ",r.jsx("strong",{children:Ss(Er)}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:ip,disabled:!Pm,children:Du?"Applied":"Apply suggestion"})]})]},g.name)}if(g.type==="boolean"){const F=`node-${e.id}-${g.name}`,re=!!(ye!=null&&ye[g.name]);return r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("div",{className:"canvas-modal__parameter-label",children:r.jsx("label",{htmlFor:F,children:g.label})}),g.description&&r.jsx("p",{className:"canvas-modal__parameter-description",children:g.description}),r.jsxs("label",{className:"canvas-modal__boolean-control",children:[r.jsx("input",{id:F,type:"checkbox",checked:re,onChange:oe=>wm(g.name,oe.target.checked)}),r.jsx("span",{children:re?"Enabled":"Disabled"})]})]},g.name)}if(g.type==="select"){const F=`node-${e.id}-${g.name}`,re=Array.isArray(g.options)?g.options:[],oe=ye==null?void 0:ye[g.name],ue=typeof g.default=="string"?g.default:((L=re.find(je=>je&&typeof je.value=="string"))==null?void 0:L.value)??"",ce=typeof oe=="string"&&oe.trim().length?oe:ue;return r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:F,className:"canvas-modal__parameter-label",children:g.label}),g.description&&r.jsx("p",{className:"canvas-modal__parameter-description",children:g.description}),r.jsx("select",{id:F,className:"canvas-modal__input",value:ce,onChange:je=>Zl(g.name,je.target.value),children:re.map(je=>r.jsx("option",{value:je.value,title:je.description??void 0,children:je.label??je.value},je.value))})]},g.name)}if(g.type==="textarea"){const F=`node-${e.id}-${g.name}`;if(g.name==="hyperparameters"){let oe="",ue=ye==null?void 0:ye[g.name];if(typeof ue=="string"&&ue.trim())try{const ce=JSON.parse(ue);ce&&typeof ce=="object"&&!Array.isArray(ce)?oe=Object.entries(ce).map(([je,Le])=>`${je}: ${JSON.stringify(Le)}`).join(`
`):oe=ue}catch{oe=ue}else ue&&typeof ue=="object"&&!Array.isArray(ue)&&(oe=Object.entries(ue).map(([ce,je])=>`${ce}: ${JSON.stringify(je)}`).join(`
`));return r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:F,className:"canvas-modal__parameter-label",children:g.label}),r.jsx("p",{className:"canvas-modal__parameter-description",children:g.description||"Enter parameters as key: value pairs (one per line)"}),r.jsx("textarea",{id:F,className:"canvas-modal__input canvas-modal__input--wide",value:oe,placeholder:`n_estimators: 100
max_depth: 10
learning_rate: 0.01`,onChange:ce=>{const Le=ce.target.value.split(`
`).filter(vt=>vt.trim()),lt={};for(const vt of Le){const Ft=vt.indexOf(":");if(Ft===-1)continue;const xn=vt.substring(0,Ft).trim(),Bn=vt.substring(Ft+1).trim();if(xn)try{lt[xn]=JSON.parse(Bn)}catch{lt[xn]=Bn}}Zl(g.name,JSON.stringify(lt,null,2))},rows:6})]},g.name)}const re=typeof(ye==null?void 0:ye[g.name])=="string"?ye==null?void 0:ye[g.name]:"";return r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:F,className:"canvas-modal__parameter-label",children:g.label}),g.description&&r.jsx("p",{className:"canvas-modal__parameter-description",children:g.description}),r.jsx("textarea",{id:F,className:"canvas-modal__input canvas-modal__input--wide",value:re,placeholder:g.placeholder??"",onChange:oe=>Zl(g.name,oe.target.value),rows:4})]},g.name)}const N=`node-${e.id}-${g.name}`,E=(ye==null?void 0:ye[g.name])??"";return r.jsxs("div",{className:"canvas-modal__parameter-field",children:[r.jsx("label",{htmlFor:N,className:"canvas-modal__parameter-label",children:g.label}),g.description&&r.jsx("p",{className:"canvas-modal__parameter-description",children:g.description}),r.jsx("input",{id:N,type:"text",className:"canvas-modal__input canvas-modal__input--wide",value:E,placeholder:g.placeholder??"",onChange:F=>Zl(g.name,F.target.value)})]},g.name)},[Pm,ye,ip,wm,Hh,Zl,e.id,Er,ms,Bu,Du,ka]),Rm=f.useCallback(g=>{Ie(N=>({...N,keep:g}))},[Ie]);return r.jsxs("div",{className:"canvas-modal",role:"dialog","aria-modal":"true","aria-labelledby":"node-settings-title",children:[r.jsx("div",{className:"canvas-modal__backdrop",onClick:t}),r.jsxs("div",{className:"canvas-modal__panel",children:[r.jsx(gM,{title:p,isDataset:at,onClose:t,canResetNode:Nt,onResetNode:Vr}),r.jsxs("div",{className:"canvas-modal__body",children:[Ge&&r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Connection requirements"})}),r.jsxs("p",{className:Ye?"canvas-modal__note":"canvas-modal__note canvas-modal__note--warning",children:[r.jsx("strong",{children:Ye?"Ready to execute.":"Missing required connections."})," ",Ye?"All required inputs are connected; you can continue configuring this node.":"Connect the required inputs listed below before running training or evaluation workflows."]}),Ge.inputs&&Ge.inputs.length>0&&r.jsxs("div",{className:"canvas-modal__note",children:[r.jsx("strong",{children:"Inputs"}),r.jsx("ul",{children:Ge.inputs.map(g=>{const N=zt.has(g.key),E=g.required!==!1;return r.jsxs("li",{children:[r.jsx("span",{children:g.label}),r.jsx("span",{children:" - "}),r.jsx("span",{children:N?"Connected":E?"Missing":"Optional"})]},`inputs-${g.key}`)})})]}),Ge.outputs&&Ge.outputs.length>0&&r.jsxs("div",{className:"canvas-modal__note",children:[r.jsx("strong",{children:"Outputs"}),r.jsx("ul",{children:Ge.outputs.map(g=>{const N=ve.has(g.key),E=g.required!==!1;return r.jsxs("li",{children:[r.jsx("span",{children:g.label}),r.jsx("span",{children:" - "}),r.jsx("span",{children:N?"Connected":E?"Unlinked":"Optional"})]},`outputs-${g.key}`)})})]})]}),qh&&r.jsx(J1,{thresholdParameter:no??null,dropIfAnyParameter:Zc,renderParameterField:Xt}),Vd&&r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Missingness recommendations"})}),no&&Xt(no),ms(Vd)]}),x&&r.jsxs(r.Fragment,{children:[r.jsx(lA,{suffix:cn,insights:Mi,formatMissingPercentage:Ss}),(bi||Hd)&&r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("div",{className:"canvas-modal__section-header",children:r.jsx("h3",{children:"Missing indicator settings"})}),r.jsxs("div",{className:"canvas-modal__parameter-list",children:[bi?Xt(bi):null,Hd?Xt(Hd):null]})]})]}),Ur&&r.jsx(mM,{previewState:Lt,datasetSourceId:i??null,canTriggerPreview:Bl,onRefresh:ta,formatCellValue:aw,formatMetricValue:$r,formatMissingPercentage:Ss,formatNumericStat:ir,formatModeStat:Dx}),r.jsx(hM,{isDatasetProfileNode:am,controller:_h,formatCellValue:aw,formatNumericStat:ir,formatMissingPercentage:Ss}),ke&&r.jsx("section",{className:"canvas-modal__section",children:r.jsxs("p",{className:"canvas-modal__note",children:[r.jsxs("strong",{children:[ke.title,"."]})," ",ke.body]})}),k&&r.jsx(hO,{sourceId:i,hasReachableSource:xt,columnsParameter:Pt,modeParameter:pt,renderMultiSelectField:ms,renderParameterField:Xt,columnSummary:xu,modeDetails:bh,sampleMap:um}),M&&r.jsx(TO,{sourceId:i,hasReachableSource:xt,columnsParameter:Jt,modeParameter:Gt,replacementParameter:Ct,renderMultiSelectField:ms,renderParameterField:Xt,columnSummary:T_,modeDetails:Ai,sampleMap:Za}),P&&r.jsx(RP,{sourceId:i,hasReachableSource:xt,columnsParameter:Dn,modeParameter:wn,minValueParameter:pn,maxValueParameter:Tt,renderMultiSelectField:ms,renderParameterField:Xt,columnSummary:er,modeDetails:dm,sampleMap:mm,selectedMode:xh,minValue:tr,maxValue:Nn}),T&&r.jsx(hP,{sourceId:i,hasReachableSource:xt,columnsParameter:hs,modeParameter:sn,patternParameter:ht,replacementParameter:_t,renderMultiSelectField:ms,renderParameterField:Xt,columnSummary:Oi,modeDetails:ju,sampleMap:wu,selectedMode:xr,replacementValue:wr}),j&&r.jsx(GO,{sourceId:i,hasReachableSource:xt,columnsParameter:zn,modeParameter:Gn,renderMultiSelectField:ms,renderParameterField:Xt,columnSummary:Po,modeDetails:Na,sampleMap:ja,selectedMode:To}),W&&r.jsx(sT,{operations:ji,summaries:O_,collapsed:Il,onToggleCollapsed:Vn,onAddOperation:In,onDuplicateOperation:ds,onRemoveOperation:rr,onReorderOperation:Ui,onOperationChange:lc,availableColumns:an,signals:Ul,previewStatus:Lt.status,errorHandlingParameter:Ms,allowOverwriteParameter:Zn,defaultTimezoneParameter:is,epsilonParameter:Fs,renderParameterField:Xt,canResetNode:Nt,onResetNode:Vr}),K&&r.jsx(vT,{sourceId:i,hasReachableSource:xt,isFetching:hh,error:ph,suggestions:uu,metadata:vr,columnsParameter:Br,autoDetectParameter:qa,maxCategoriesParameter:Jr,outputSuffixParameter:Os,dropOriginalParameter:Zs,encodeMissingParameter:fi,handleUnknownParameter:pr,unknownValueParameter:hi,selectedColumns:vn,renderParameterField:Xt,onToggleColumn:aa,onApplyRecommended:I_,formatMissingPercentage:Ss}),z&&r.jsx(cT,{sourceId:i,hasReachableSource:xt,isFetching:lu,error:Ci,suggestions:Dl,metadata:Ka,columnsParameter:Dt,targetColumnParameter:Mt,autoDetectParameter:bt,maxCategoriesParameter:Wt,outputSuffixParameter:ls,dropOriginalParameter:_n,smoothingParameter:es,encodeMissingParameter:fr,handleUnknownParameter:hr,selectedColumns:vn,renderParameterField:Xt,onToggleColumn:aa,onApplyRecommended:Jh,formatMissingPercentage:Ss}),U&&r.jsx(xT,{sourceId:i,hasReachableSource:xt,isFetching:tm,error:nm,suggestions:sm,metadata:rm,columnsParameter:wo,autoDetectParameter:pi,maxCategoriesParameter:gi,dropFirstParameter:_i,includeMissingParameter:vi,dropOriginalParameter:cs,prefixSeparatorParameter:Mn,selectedColumns:vn,renderParameterField:Xt,onToggleColumn:aa,onApplyRecommended:Bs,formatMissingPercentage:Ss}),te&&r.jsx(NT,{sourceId:i,hasReachableSource:xt,isFetching:zl,error:k_,suggestions:du,metadata:gh,columnsParameter:yi,autoDetectParameter:jo,maxCategoriesParameter:qd,dropFirstParameter:Cl,includeMissingParameter:An,dropOriginalParameter:ts,prefixSeparatorParameter:Is,selectedColumns:vn,renderParameterField:Xt,onToggleColumn:aa,onApplyRecommended:Ts,formatMissingPercentage:Ss}),q&&r.jsx(PT,{nodeId:Ae,sourceId:i,hasReachableSource:xt,previewState:Lt,onRefreshPreview:ta,config:j_,targetColumnParameter:Sl,renderParameterField:Xt,formatMetricValue:$r,formatMissingPercentage:Ss,canResetNode:Nt,onResetNode:Vr}),V&&r.jsx($T,{nodeId:Ae,sourceId:i,hasReachableSource:xt,previewState:Lt,onRefreshPreview:ta,config:N_,parameters:G,renderParameterField:Xt,formatMetricValue:$r,canResetNode:Nt,onResetNode:Vr}),it&&r.jsx(H2,{mode:Y?"oversampling":"undersampling",sourceId:i,hasReachableSource:xt,previewState:Lt,onRefreshPreview:ta,config:No,methodParameter:As,targetColumnParameter:di,samplingStrategyParameter:jl,randomStateParameter:Bt,kNeighborsParameter:Y?Qc:null,replacementParameter:X?Nl:null,renderParameterField:Xt,formatMetricValue:$r,formatMissingPercentage:Ss,schemaGuard:Ml}),(R||D)&&r.jsx(FT,{sourceId:i,hasReachableSource:xt,previewState:Lt,onRefreshPreview:ta,config:El,targetColumnParameter:Gc,problemTypeParameter:Xc,renderParameterField:Xt,formatMetricValue:$r,formatMissingPercentage:Ss,schemaColumns:So}),R&&r.jsx("div",{style:Ue,"aria-disabled":Ze,children:r.jsx(n2,{nodeId:Ae,sourceId:i,graph:Pn,config:El,runtimeConfig:wi,cvConfig:uh,draftConfigState:ye,renderParameterField:Xt,modelTypeParameter:va,modelTypeOptions:Wd,hyperparametersParameter:mi,cvEnabledParameter:Ce,cvStrategyParameter:Qe,cvFoldsParameter:He,cvShuffleParameter:Re,cvRandomStateParameter:St,cvRefitStrategyParameter:ot,onSaveDraftConfig:rc})}),ee&&r.jsx("div",{style:Ue,"aria-disabled":Ze,children:r.jsx(d2,{nodeId:Ae,sourceId:i,graph:Pn,config:ye,setConfigState:Ie,renderParameterField:Xt,formatMetricValue:$r,connectedSplitHandles:xe,canResetNode:Nt,onResetNode:Vr})}),le&&r.jsx("div",{style:Ue,"aria-disabled":Ze,children:r.jsx(M2,{nodeId:Ae,sourceId:i,graph:Pn,parameters:G,config:w_,renderParameterField:Xt})}),D&&r.jsx("div",{style:Ue,"aria-disabled":Ze,children:r.jsx(I2,{nodeId:Ae,sourceId:i,graph:Pn,config:El,runtimeConfig:wi,cvConfig:uh,draftConfigState:ye,renderParameterField:Xt,modelTypeParameter:va,modelTypeOptions:Wd,searchStrategyParameter:xo,searchIterationsParameter:Ir,searchRandomStateParameter:se,scoringMetricParameter:Me,setDraftConfigState:Ie,onSaveDraftConfig:rc})}),A&&r.jsx(oT,{sourceId:i,hasReachableSource:xt,isFetching:Zd,error:Ll,suggestions:em,metadata:iu,columnsParameter:ps,autoDetectParameter:Xn,maxUniqueParameter:Es,outputSuffixParameter:Jn,dropOriginalParameter:dr,missingStrategyParameter:bn,missingCodeParameter:zs,selectedColumns:vn,renderParameterField:Xt,onToggleColumn:aa,onApplyRecommended:Xh,formatMissingPercentage:Ss}),$&&r.jsx(mT,{sourceId:i,hasReachableSource:xt,isFetching:Ao,error:fh,suggestions:cu,metadata:Ei,columnsParameter:ks,autoDetectParameter:gs,maxCategoriesParameter:Ba,bucketsParameter:Xs,outputSuffixParameter:pa,dropOriginalParameter:zr,encodeMissingParameter:Rr,selectedColumns:vn,renderParameterField:Xt,onToggleColumn:aa,onApplyRecommended:Zh,canResetNode:Nt,onResetNode:Vr,formatMissingPercentage:Ss}),J&&r.jsx(fT,{columnsParameter:ga,autoDetectParameter:Js,degreeParameter:bo,includeBiasParameter:Ua,interactionOnlyParameter:fn,includeInputFeaturesParameter:Xr,outputPrefixParameter:_s,renderParameterField:Xt,signal:A_,canResetNode:Nt,onResetNode:Vr}),H&&r.jsx(pT,{columnsParameter:Fr,autoDetectParameter:Rs,targetColumnParameter:_a,methodParameter:_e,scoreFuncParameter:De,problemTypeParameter:et,kParameter:Yt,percentileParameter:Be,alphaParameter:kt,thresholdParameter:$t,modeParameter:rn,estimatorParameter:Zt,stepParameter:On,minFeaturesParameter:gn,maxFeaturesParameter:Rn,dropUnselectedParameter:mr,renderParameterField:Xt,signal:jn,canResetNode:Nt,onResetNode:Vr}),O&&r.jsx(GA,{hasSource:!!i,hasReachableSource:xt,strategies:Nu,columnSummary:Hl,columnOptions:fm,sampleMap:wh,collapsedStrategies:fu,onToggleStrategy:W_,onRemoveStrategy:_p,onAddStrategy:gp,onModeChange:Uu,onColumnToggle:kr,onColumnsChange:Lm,onAutoDetectToggle:Kt,modeOptions:Fg}),S&&r.jsx(LA,{hasSource:!!i,hasReachableSource:xt,strategies:vu,columnSummary:yu,columnOptions:wa,sampleMap:yh,customPairSummary:bu,customPairsParameter:Ht,collapsedStrategies:fu,onToggleStrategy:Dm,onRemoveStrategy:qu,onAddStrategy:qo,onModeChange:cc,onAutoDetectToggle:qi,onColumnToggle:Hs,onColumnsChange:zm,renderParameterField:Xt}),w&&r.jsx(VM,{hasSource:!!i,hasReachableSource:xt,strategies:Ha,columnOptions:Ih,methodOptions:be,missingFilter:dh,missingFilterMax:xm,missingFilterActive:Uh,filteredOptionCount:Bh,collapsedStrategies:fu,onToggleStrategy:Kr,onRemoveStrategy:mp,onAddStrategy:dp,onMethodChange:fp,onOptionNumberChange:ia,onColumnsChange:V_,onColumnToggle:hp,onMissingFilterChange:pp,formatMissingPercentage:Ss,formatNumericStat:ir,formatModeStat:Dx,schemaDiagnostics:Al}),I&&r.jsx(sM,{configState:ye,setConfigState:Ie,availableColumns:an,columnTypeMap:gr,columnSuggestions:Tl,selectedColumns:vn,previewColumns:na,previewStatus:Lt.status,sourceId:i,hasReachableSource:xt}),ne&&r.jsx(cL,{sourceId:i,hasReachableSource:xt,isFetchingOutliers:Ya,outlierConfig:Lo,outlierMethodOptions:$i,outlierMethodDetailMap:gm,outlierDefaultDetail:Sa,outlierAutoDetectEnabled:_m,outlierSelectedCount:Do,outlierDefaultLabel:eo,outlierOverrideCount:Li,outlierParameterOverrideCount:zo,outlierOverrideExampleSummary:Mh,outlierHasOverrides:Au,outlierRecommendationRows:Ps,outlierHasRecommendations:Eh,outlierStatusMessage:Ca,outlierError:im,outlierSampleSize:Mu,relativeOutlierGeneratedAt:kh,outlierPreviewSignal:Yl,formatMetricValue:$r,formatNumericStat:ir,onApplyAllRecommendations:Em,onClearOverrides:np,onDefaultMethodChange:ep,onAutoDetectToggle:tp,onOverrideSelect:sp,onMethodParameterChange:rp,onColumnParameterChange:Mm}),me&&r.jsx(XM,{sourceId:i,hasReachableSource:xt,isFetchingScaling:Qa,scalingConfig:Su,scalingMethodOptions:$_,scalingMethodDetailMap:hm,scalingDefaultDetail:Pi,scalingAutoDetectEnabled:Eu,scalingSelectedCount:Nh,scalingDefaultLabel:Ch,scalingOverrideCount:Sh,scalingOverrideExampleSummary:pm,scalingRecommendationRows:Cu,scalingHasRecommendations:ku,scalingStatusMessage:Ti,scalingError:Zr,scalingSampleSize:xs,relativeScalingGeneratedAt:bs,formatMetricValue:$r,formatNumericStat:ir,formatMissingPercentage:Ss,onApplyAllRecommendations:B_,onClearOverrides:Fu,onDefaultMethodChange:Am,onAutoDetectToggle:ap,onOverrideSelect:op}),Q&&r.jsxs(r.Fragment,{children:[r.jsx($M,{hasSource:!!i,hasReachableSource:xt,isFetching:gu,error:P_,relativeGeneratedAt:U_,sampleSize:nt,binningConfig:ss,binningDefaultLabel:sa,binningOverrideCount:Wl,binningOverrideSummary:Kl,recommendations:Hr,excludedColumns:Pu,numericColumnCount:Sr.length,canApplyAllNumeric:Io,onApplyAllNumeric:F_,onApplyStrategies:Nm,onClearOverrides:Ri,customEdgeDrafts:vm,customLabelDrafts:Ah,onOverrideStrategyChange:zi,onOverrideNumberChange:Yh,onOverrideKbinsEncodeChange:Qh,onOverrideKbinsStrategyChange:Gh,onOverrideClear:jm,onCustomBinsChange:z_,onCustomLabelsChange:R_,onClearCustomColumn:as,formatMetricValue:$r,formatNumericStat:ir}),r.jsx(OM,{config:ss,fieldIds:Ro,onIntegerChange:L_,onBooleanToggle:Vh,onSuffixChange:Wh,onLabelFormatChange:Kh,onMissingStrategyChange:zu,onMissingLabelChange:D_})]}),fe&&r.jsx(sA,{sourceId:i,hasReachableSource:xt,isFetchingSkewness:en,skewnessThreshold:Gl,skewnessError:ln,skewnessViewMode:bm,skewnessRecommendedCount:Ph,skewnessNumericCount:Th,skewnessGroupByMethod:Cr,skewnessRows:Dh,skewnessTableGroups:zh,hasSkewnessAutoRecommendations:Lh,skewnessTransformationsCount:$h,isFetchingRecommendations:xa,getSkewnessMethodLabel:Rh,getSkewnessMethodStatus:Jl,onApplyRecommendations:Fh,onViewModeChange:ra,onGroupByToggle:Xl,onOverrideChange:$u,onClearSelections:Lu}),ae&&r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Skewness distributions"}),r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsxs("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Distribution view",children:[r.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":to==="before",onClick:()=>Tu("before"),disabled:!Bo.length,children:"Before"}),r.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":to==="after",onClick:()=>Tu("after"),disabled:!Bo.length,children:"After"})]})})]}),Gl!==null&&r.jsxs("p",{className:"canvas-modal__note",children:["Columns with |skewness|  ",Gl.toFixed(2)," are visualized below."]}),en&&Bo.length===0&&r.jsx("p",{className:"canvas-modal__note",children:"Loading skewness distributions"}),!en&&ln&&r.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:ln}),(!en||Bo.length>0)&&!ln&&(Bo.length?r.jsx("div",{className:"canvas-skewness__distribution-grid",children:Bo.map(g=>{const N=(ue,ce,je)=>{const Le=Math.max(0,ue.sample_size||0),lt=Math.max(0,ue.missing_count||0);return r.jsxs("div",{className:"canvas-skewness__distribution-block",children:[r.jsxs("div",{className:"canvas-skewness__distribution-block-title",children:[r.jsx("span",{children:ce}),je?r.jsx("span",{className:"canvas-skewness__distribution-block-method",children:je}):null]}),r.jsx(uL,{counts:ue.counts,binEdges:ue.bin_edges,className:"canvas-skewness__histogram"}),r.jsxs("div",{className:"canvas-skewness__distribution-stats",children:[r.jsxs("div",{children:[r.jsx("span",{className:"canvas-skewness__stat-label",children:"Min"}),r.jsx("span",{className:"canvas-skewness__stat-value",children:ir(ue.minimum)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-skewness__stat-label",children:"Median"}),r.jsx("span",{className:"canvas-skewness__stat-value",children:ir(ue.median)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-skewness__stat-label",children:"Max"}),r.jsx("span",{className:"canvas-skewness__stat-value",children:ir(ue.maximum)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-skewness__stat-label",children:"Mean"}),r.jsx("span",{className:"canvas-skewness__stat-value",children:ir(ue.mean)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-skewness__stat-label",children:"Std dev"}),r.jsx("span",{className:"canvas-skewness__stat-value",children:ir(ue.stddev)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-skewness__stat-label",children:"Valid"}),r.jsx("span",{className:"canvas-skewness__stat-value",children:Le.toLocaleString()})]}),r.jsxs("div",{children:[r.jsx("span",{className:"canvas-skewness__stat-label",children:"Missing"}),r.jsx("span",{className:"canvas-skewness__stat-value",children:lt.toLocaleString()})]})]})]},ce)},E=g.distributionAfter,L=to==="before",F=to==="after"&&!!E,re=to==="after"&&!E,oe=to==="before"?"Showing the original distribution returned by the skewness analysis.":E?"Showing the recomputed distribution after the applied transform.":"A transformed distribution is not available yet for this column.";return r.jsxs("article",{className:"canvas-skewness__distribution-card","aria-label":`Distribution for ${g.column}`,children:[r.jsxs("header",{className:"canvas-skewness__distribution-header",children:[r.jsxs("div",{children:[r.jsx("h4",{children:g.column}),r.jsxs("div",{className:"canvas-skewness__distribution-tags",children:[g.directionLabel&&r.jsx("span",{className:"canvas-skewness__chip canvas-skewness__chip--muted",children:g.directionLabel}),g.magnitudeLabel&&r.jsx("span",{className:"canvas-skewness__chip canvas-skewness__chip--muted",children:g.magnitudeLabel}),g.recommendedLabel&&r.jsxs("span",{className:"canvas-skewness__chip canvas-skewness__chip--recommended",children:["Suggested: ",g.recommendedLabel]}),g.appliedLabel&&r.jsxs("span",{className:"canvas-skewness__chip canvas-skewness__chip--applied",children:["Applied: ",g.appliedLabel]})]})]}),r.jsxs("div",{className:"canvas-skewness__distribution-skew",children:[r.jsx("span",{children:"Skewness"}),r.jsx("strong",{children:g.skewness!==null?$r(g.skewness,2):""})]})]}),g.summary&&r.jsx("p",{className:"canvas-skewness__distribution-summary",children:g.summary}),r.jsxs("div",{className:"canvas-skewness__distribution-comparison",children:[L?N(g.distributionBefore,"Before transform"):null,F&&E?N(E,"After transform",g.appliedLabel):null,re?r.jsx("div",{className:"canvas-skewness__distribution-empty",children:"After transform data isnt available yet. Apply a skewness method and rerun the node to generate this view."}):null]}),r.jsxs("footer",{className:"canvas-skewness__distribution-footnote",children:["Histogram bins are based on the sampled rows returned by the skewness analysis. ",oe]})]},`skewness-dist-${g.column}`)})}):r.jsx("p",{className:"canvas-modal__note",children:"No columns met the skewness threshold for visualization. Refresh with a larger sample if needed."}))]}),pe&&r.jsx(LM,{cards:so,selectedPreset:Rl,onSelectPreset:g=>Fl(g),isFetching:ki,sampleSize:Tm,relativeGeneratedAt:q_,error:_u,onRefresh:Wr,canRefresh:!!i}),Ke&&r.jsx(tM,{sourceId:i,hasReachableSource:xt,removeDuplicatesColumnsParameter:Et,removeDuplicatesKeepParameter:qt,renderMultiSelectField:ms,removeDuplicatesKeepSelectId:Sn,removeDuplicatesKeep:Cn,onKeepChange:Rm}),Ve&&ah.length>0&&r.jsxs("section",{className:"canvas-modal__section",children:[r.jsxs("div",{className:"canvas-modal__section-header",children:[r.jsx("h3",{children:"Data consistency settings"}),Nt&&r.jsx("div",{className:"canvas-modal__section-actions",children:r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Vr,children:"Reset node"})})]}),r.jsx("div",{className:"canvas-modal__parameter-list",children:ah.map(g=>Xt(g))})]}),Z&&r.jsx(MT,{signal:Ql,previewStatus:Lt.status,hasSource:!!i,hasReachableSource:xt,onRefreshPreview:ta}),r.jsxs("section",{className:"canvas-modal__section",children:[r.jsx("h3",{children:"Node details"}),v.length?r.jsx("dl",{className:"canvas-modal__metadata",children:v.map((g,N)=>r.jsxs("div",{className:"canvas-modal__metadata-row",children:[r.jsx("dt",{children:g.label}),r.jsx("dd",{children:g.value})]},`${g.label}-${N}`))}):r.jsx("p",{className:"canvas-modal__empty",children:"No metadata available for this node."})]})]}),r.jsx(_M,{onClose:t,canResetNode:Nt,onResetNode:Vr,showSaveButton:cp,canSave:oc,onSave:rc,isBusy:$m,busyLabel:up})]})]})},qw=[{key:"train",label:"Train"},{key:"test",label:"Test"},{key:"validation",label:"Validation"}],fo=qw.map(e=>e.key),fL=qw.reduce((e,t)=>({...e,[t.key]:t.label}),{}),hL=e=>typeof e=="string"&&fo.includes(e),Hw=28,Vw=320,pL=170,Ww="Removes columns whose missing percentage exceeds a configurable threshold and applies EDA-backed column drop recommendations.",Kw="Drop columns",Dd=e=>{if(e==null)return{};try{return JSON.parse(JSON.stringify(e))}catch{return{...e}}},fl="__pending_confirmation__",eh=e=>e&&typeof e=="object"&&!Array.isArray(e),gL=[/^columns?$/i,/_columns$/i,/_features$/i,/_list$/i,/_ids$/i,/^selected_/i,/^target_/i,/^include_/i,/^exclude_/i,/^skipped_/i,/_rules$/i,/_transformations$/i,/^strategies$/i,/^recommendations$/i],_L=[/methods$/i,/overrides$/i,/mapping$/i,/weights$/i,/assignments$/i],vL={train:e=>e.endsWith("-train"),validation:e=>e.endsWith("-validation"),test:e=>e.endsWith("-test"),model:e=>e.endsWith("-model-out"),params:e=>e.endsWith("-best-params-out")},zd={hyperparameter_tuning:{inputs:[{key:"train-in",label:"Train Split",position:35,required:!0,accepts:["train"]},{key:"validation-in",label:"Validation Split",position:65,required:!0,accepts:["validation"]}],outputs:[{key:"best-params-out",label:"Best Params",position:50}]},train_model_draft:{inputs:[{key:"train-in",label:"Train Split",position:40,required:!0,accepts:["train"]},{key:"params-in",label:"Best Params",position:60,required:!1,accepts:["params"]}],outputs:[{key:"model-out",label:"Model",position:50}]},model_evaluation:{inputs:[{key:"train-in",label:"Train Split",position:20,required:!1,accepts:["train"]},{key:"test-in",label:"Test Split",position:40,required:!1,accepts:["test"]},{key:"validation-in",label:"Validation Split",position:60,required:!1,accepts:["validation"]},{key:"models-in",label:"Model",position:80,required:!0,accepts:["model"]}]},model_registry_overview:{inputs:[{key:"models-in",label:"Model",position:50,required:!0,accepts:["model"]}]}},ho=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(n=>{hL(n)&&t.add(n)}),fo.filter(n=>t.has(n))},Yw=(e,t)=>{const n=ho(e),a=ho(t);return n.length!==a.length?!1:n.every((i,l)=>i===a[l])},Qw=e=>!e||typeof e!="string"?null:fo.find(t=>e.endsWith(`-${t}`))??null,Gw=(e,t)=>{if(t<=1)return"50%";const n=100/(t+1);return`${Math.round((e+1)*n)}%`},Xw=(e,t,n)=>typeof e.position=="number"&&Number.isFinite(e.position)?`${Math.min(Math.max(e.position,5),95)}%`:Gw(t,n),yL=e=>e.required===!1?`${e.label} (optional)`:`${e.label} (required)`,bL=e=>e.required===!1?`${e.label} (optional)`:`${e.label} (required)`,Jw=(e,t)=>{if(!t||typeof t!="string")return null;const n=`${e}-`;if(t.startsWith(n))return t.slice(n.length);const a=t.split("-");return a.length>=2?a.slice(-2).join("-"):t},xL=new Set(["train_model_draft","model_registry_overview","model_evaluation","hyperparameter_tuning"]),wL=(e,t)=>{const n=new Map,a=new Set;e.forEach(m=>{var p;const v=(p=m==null?void 0:m.data)==null?void 0:p.catalogType;if(v&&xL.has(v)){a.add(m.id);return}v==="train_test_split"&&n.set(m.id,new Set(fo))});let i=!0,l=0;const u=e.length*3;for(;i&&l<u;)i=!1,l++,t.forEach(m=>{if(a.has(m.source)||a.has(m.target))return;const v=n.get(m.source),p=Qw(m.sourceHandle);if(!v||v.size===0)return;n.has(m.target)||n.set(m.target,new Set);const _=n.get(m.target),y=_.size;p?v.has(p)&&_.add(p):v.forEach(w=>_.add(w)),_.size>y&&(i=!0)});const d=new Map;return n.forEach((m,v)=>{!m.size||a.has(v)||d.set(v,fo.filter(p=>m.has(p)))}),d},jL=e=>{const t=new Map;e.forEach(a=>{const i=Qw(a.sourceHandle);i&&(t.has(a.source)||t.set(a.source,new Set),t.get(a.source).add(i))});const n=new Map;return t.forEach((a,i)=>{n.set(i,fo.filter(l=>a.has(l)))}),n},NL=e=>{var n;const t=e?zd[e]:void 0;return(n=t==null?void 0:t.inputs)!=null&&n.length?t.inputs.filter(a=>a.required!==!1).map(a=>a.key):[]},SL=(e,t,n)=>{const a=NL(t);if(a.length===0)return!0;const i=n.filter(u=>u.target===e),l=new Set(i.map(u=>Jw(e,u.targetHandle)).filter(u=>!!u));return a.every(u=>l.has(u))},CL=new Set(["binned_distribution","skewness_distribution","skewness_transform","binning_discretization","label_encoding","target_encoding","ordinal_encoding","dummy_encoding","one_hot_encoding","hash_encoding","scale_numeric_features","polynomial_features","feature_selection","feature_math","missing_value_indicator","trim_whitespace","normalize_text_case","replace_aliases_typos","standardize_date_formats","remove_special_characters","replace_invalid_values","regex_replace_fix","class_undersampling","class_oversampling","feature_target_split","train_test_split","train_model_draft","model_evaluation","hyperparameter_tuning"]),Zw=new Set(["transformer_audit"]),th=e=>typeof e=="string"&&Zw.has(e),nh=e=>{const t=e==null?void 0:e.default_config,n=(e==null?void 0:e.type)??"",a=!Zw.has(n),i=u=>(a?u[fl]=!0:delete u[fl],u);if(t==null)return i({});const l=Dd(t);if(!eh(l))return i(l&&typeof l=="object"?l:{});switch(Object.entries(l).forEach(([u,d])=>{Array.isArray(d)?gL.some(v=>v.test(u))&&(l[u]=[]):eh(d)&&_L.some(v=>v.test(u))&&(l[u]={})}),"auto_detect"in l&&(l.auto_detect=!1),e==null?void 0:e.type){case"scale_numeric_features":l.columns=Array.isArray(l.columns)?l.columns:[],l.column_methods=eh(l.column_methods)?l.column_methods:{},l.skipped_columns=Array.isArray(l.skipped_columns)?l.skipped_columns:[],l.default_method=typeof l.default_method=="string"&&l.default_method.trim()?l.default_method:"standard";break;case"polynomial_features":l.columns=Array.isArray(l.columns)?l.columns:[],l.auto_detect=!!l.auto_detect,l.include_bias=!!l.include_bias,l.interaction_only=!!l.interaction_only,l.include_input_features=!!l.include_input_features,l.degree=typeof l.degree=="number"&&Number.isFinite(l.degree)?l.degree:2,l.output_prefix=typeof l.output_prefix=="string"&&l.output_prefix.trim()?l.output_prefix:"poly";break;case"drop_missing_columns":"missing_threshold"in l&&(l.missing_threshold=null),l.columns=Array.isArray(l.columns)?l.columns:[];break;case"drop_missing_rows":"missing_threshold"in l&&(l.missing_threshold=null),"drop_if_any_missing"in l&&(l.drop_if_any_missing=!1);break;case"outlier_removal":l.method="manual",l.columns=Array.isArray(l.columns)?l.columns:[],l.manual_bounds=eh(l.manual_bounds)?l.manual_bounds:{};break;case"missing_value_indicator":l.columns=Array.isArray(l.columns)?l.columns:[];break;case"remove_duplicates":if(l.columns=Array.isArray(l.columns)?l.columns:[],typeof l.keep=="string"){const u=l.keep.trim().toLowerCase();l.keep=u==="last"||u==="none"?u:"first"}else l.keep="first";break}return i(l)},EL=e=>({width:`${Hw}px`,height:`${Hw}px`,borderRadius:"999px",border:e==="target"?"1px solid rgba(148, 163, 184, 0.55)":"1px solid rgba(45, 212, 191, 0.55)",background:e==="target"?"rgba(148, 163, 184, 0.22)":"rgba(45, 212, 191, 0.18)",boxShadow:e==="target"?"0 0 0 3px rgba(148, 163, 184, 0.18)":"0 0 0 3px rgba(45, 212, 191, 0.18)",backdropFilter:"blur(2px)"}),kL=({id:e,data:t,selected:n})=>{var j;const a=(t==null?void 0:t.label)??e,i=!!((t==null?void 0:t.isDataset)??e==="dataset-source"),l=(t==null?void 0:t.isRemovable)??!i,u=(t==null?void 0:t.catalogType)==="train_test_split",d=i?"Primary dataset input":void 0,m=(t==null?void 0:t.description)??d,p=(t==null?void 0:t.catalogType)==="drop_missing_columns"||m===Ww?Kw:m,_=(t==null?void 0:t.backgroundExecutionStatus)??"idle",w=!((t==null?void 0:t.hasRequiredConnections)??!0),x=(t==null?void 0:t.catalogType)??"",S=["hyperparameter_tuning","train_model_draft","model_evaluation","model_registry_overview"].includes(x),k=f.useCallback(O=>{var A;O.stopPropagation(),(A=t==null?void 0:t.onRemoveNode)==null||A.call(t,e)},[t,e]),M=f.useMemo(()=>{if(i)return[];const O=(t==null?void 0:t.catalogType)??"",A=O?zd[O]:void 0;if(A!=null&&A.inputs&&A.inputs.length){const z=A.inputs.length;return A.inputs.map(($,q)=>({position:Xe.Left,id:`${e}-${$.key}`,label:yL($),style:{top:Xw($,q,z)}}))}return[{position:Xe.Left,id:`${e}-target`},{position:Xe.Top,id:`${e}-target-top`}]},[t==null?void 0:t.catalogType,e,i]),P=f.useMemo(()=>{if(i)return[{position:Xe.Left,id:`${e}-source-left`},{position:Xe.Right,id:`${e}-source`},{position:Xe.Top,id:`${e}-source-top`},{position:Xe.Bottom,id:`${e}-source-bottom`}];const O=(t==null?void 0:t.catalogType)??"",A=O?zd[O]:void 0;if(A!=null&&A.outputs&&A.outputs.length){const q=A.outputs.length;return A.outputs.map((V,R)=>({position:Xe.Right,id:`${e}-${V.key}`,label:V.label,style:{top:Xw(V,R,q)}}))}const z=u?fo:ho((t==null?void 0:t.activeSplits)??[]),$=ho((t==null?void 0:t.connectedSplits)??[]);if(z.length){const q=z.length;return z.map((V,R)=>({position:Xe.Right,id:`${e}-${V}`,style:{top:Gw(R,q)},label:(()=>{var le;const ee=fL[V];if(u){if(V==="validation"&&!(Number(((le=t==null?void 0:t.config)==null?void 0:le.validation_size)??0)>0))return`${ee} (disabled)`;if(!$.includes(V))return`${ee} (not set)`}return ee})()}))}return[{position:Xe.Right,id:`${e}-source`},{position:Xe.Bottom,id:`${e}-source-bottom`}]},[t==null?void 0:t.activeSplits,t==null?void 0:t.catalogType,t==null?void 0:t.connectedSplits,(j=t==null?void 0:t.config)==null?void 0:j.validation_size,e,i,u]),T=f.useCallback((O,A)=>{const{position:z,id:$,style:q,label:V}=O,R=$.includes("-train")||$.includes("-test")||$.includes("-validation");return r.jsxs(Oe.Fragment,{children:[r.jsx(hd,{type:A,position:z,id:$,className:`feature-node__handle feature-node__handle--${A}`,style:{...EL(A),...q??{},...R?{opacity:1,visibility:"visible",pointerEvents:"all"}:{}}}),V&&A==="source"&&r.jsx("div",{className:"feature-node__handle-label",style:{position:"absolute",right:"-8px",top:(q==null?void 0:q.top)||"50%",transform:"translate(100%, calc(-100% - 8px))",fontSize:"0.7rem",fontWeight:"600",color:"rgba(148, 163, 184, 0.9)",background:"rgba(15, 23, 42, 0.95)",padding:"3px 8px",borderRadius:"4px",whiteSpace:"nowrap",pointerEvents:"none",zIndex:100,border:"1px solid rgba(71, 85, 105, 0.5)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:V}),V&&A==="target"&&r.jsx("div",{className:"feature-node__handle-label",style:{position:"absolute",left:"-8px",top:(q==null?void 0:q.top)||"50%",transform:"translate(-100%, calc(-100% - 8px))",fontSize:"0.7rem",fontWeight:"600",color:"rgba(148, 163, 184, 0.9)",background:"rgba(15, 23, 42, 0.95)",padding:"3px 8px",borderRadius:"4px",whiteSpace:"nowrap",pointerEvents:"none",zIndex:100,border:"1px solid rgba(71, 85, 105, 0.5)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:V})]},$)},[]);return r.jsxs("div",{className:`feature-node${n?" feature-node--selected":""}${i?" feature-node--dataset":""}`,children:[M.map(O=>T(O,"target")),r.jsxs("div",{className:"feature-node__header",children:[r.jsxs("div",{className:"feature-node__title-group",children:[r.jsx("span",{className:"feature-node__drag-handle","aria-hidden":"true",children:""}),r.jsx("span",{className:"feature-node__title",children:a})]}),r.jsxs("div",{className:"feature-node__controls",children:[w&&S&&r.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--warning",title:"Required connections missing",style:{background:"rgba(251, 191, 36, 0.2)",color:"rgb(245, 158, 11)",border:"1px solid rgba(245, 158, 11, 0.3)"},children:""}),_==="loading"&&r.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--loading",title:"Loading full dataset in background...",children:r.jsx("svg",{className:"feature-node__spinner",viewBox:"0 0 24 24",children:r.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",fill:"none",strokeDasharray:"60",strokeDashoffset:"30",strokeLinecap:"round"})})}),_==="success"&&r.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--success",title:"Full dataset ready",children:""}),_==="error"&&r.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--error",title:"Background execution failed",children:"!"}),l&&r.jsx("button",{className:"feature-node__control feature-node__control--danger",type:"button",onClick:k,title:"Remove node",children:""})]})]}),p&&r.jsx("p",{className:"feature-node__description",children:p}),P.map(O=>T(O,"source"))]})},ML=[{id:"dataset-source",type:"featureNode",position:{x:-200,y:0},data:{label:"Dataset input",description:"Start from the currently selected dataset",isDataset:!0,isRemovable:!1,isConfigured:!0},style:{background:"linear-gradient(165deg, rgba(30, 64, 175, 0.9), rgba(59, 130, 246, 0.85))",border:"1px solid rgba(59, 130, 246, 0.55)",color:"#e0f2fe",fontWeight:600}}],AL=[],OL=e=>({...e,data:{...e.data??{}}}),sh=()=>ML.map(e=>OL(e)),PL=()=>AL.map(e=>({...e})),TL=12,$L=e=>{const n=`Dataset input
(${e&&e.trim()?e.trim():"Demo dataset"})`;return{nodes:[{id:"dataset-source",type:"featureNode",position:{x:-200,y:40},data:{label:n,isDataset:!0,isRemovable:!1},style:{whiteSpace:"pre-line",background:"#eef2ff",border:"1px solid rgba(99, 102, 241, 0.35)",color:"#312e81",fontWeight:600}},{id:"node-1",type:"featureNode",position:{x:260,y:40},data:{label:`Profile columns
(assess types & nulls)`},style:{whiteSpace:"pre-line",background:"linear-gradient(165deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.85))"}},{id:"node-4",type:"featureNode",position:{x:600,y:60},data:{label:`Feature preview
(sample rows)`},style:{whiteSpace:"pre-line",background:"linear-gradient(165deg, rgba(8, 145, 178, 0.42), rgba(2, 132, 199, 0.32))"}}],edges:[{id:"edge-dataset-profile",source:"dataset-source",target:"node-1",animated:!0,type:"animatedEdge",sourceHandle:"dataset-source-source",targetHandle:"node-1-target"},{id:"edge-profile-preview",source:"node-1",target:"node-4",animated:!0,type:"animatedEdge",sourceHandle:"node-1-source",targetHandle:"node-4-target"}]}},ej=e=>{if(!e)return null;let t=e.trim();if(!t)return null;/^\d{4}-\d{2}-\d{2}\s+\d/.test(t)&&(t=t.replace(" ","T")),/(Z|z|[+-]\d{2}:?\d{2})$/.test(t)||(t=`${t}Z`);const n=new Date(t);return Number.isNaN(n.getTime())?null:n},__=e=>{const t=ej(e);return t?t.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"Unknown time"},v_=e=>{const t=ej(e);if(!t)return null;const n=t.getTime(),a=Date.now()-n,i=Math.round(a/6e4);if(i<1)return"just now";if(i===1)return"1 minute ago";if(i<60)return`${i} minutes ago`;const l=Math.round(i/60);if(l===1)return"1 hour ago";if(l<24)return`${l} hours ago`;const u=Math.round(l/24);if(u===1)return"1 day ago";if(u<7)return`${u} days ago`;const d=Math.round(u/7);return d===1?"1 week ago":`${d} weeks ago`},LL=f.forwardRef(({sourceId:e,datasetName:t,onGraphChange:n,onPipelineHydrated:a,onPipelineError:i},l)=>{var zt;const u=f.useMemo(()=>({featureNode:kL}),[]),d=f.useMemo(()=>({animatedEdge:F1}),[]),[m,v,p]=L1(sh().map(ve=>({...ve,type:"featureNode"}))),[_,y,w]=D1(PL()),x=f.useRef(!1),[S,k]=f.useState(!1),[M,P]=f.useState(null),[T,j]=f.useState(!1),O=f.useRef(0),A=f.useRef(null),z=f.useRef(null),$=f.useRef(!1),q=f.useRef(new Map),V=t??e??"Demo dataset",R=pk(),ee=f.useCallback(ve=>{const xe=(Array.isArray(ve)?ve:[ve]).filter(Boolean);if(!xe.length)return;const Se=Array.from(new Set(xe));console.debug(" Scheduling node internals update for:",Se),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Se.forEach($e=>{R($e)})})})},[R]),le=f.useCallback(ve=>{const xe=ve.reduce((Se,$e)=>{if(typeof $e.id=="string"&&$e.id.startsWith("node-")){const Ye=Number($e.id.replace("node-",""));if(!Number.isNaN(Ye))return Math.max(Se,Ye)}return Se},0);xe>O.current&&(O.current=xe)},[]);f.useEffect(()=>{le(m)},[m,le]),f.useEffect(()=>{const ve=[];v(xe=>{const Se=wL(xe,_),$e=jL(_);let Ye=!1;const Ue=xe.map(Ze=>{var Tt,hs,sn,ht,_t;const Et=((Tt=Ze==null?void 0:Ze.data)==null?void 0:Tt.catalogType)==="train_test_split"?[...fo]:Se.get(Ze.id)??[],qt=ho((hs=Ze.data)==null?void 0:hs.activeSplits),Ht=ho($e.get(Ze.id)),Pt=ho((sn=Ze.data)==null?void 0:sn.connectedSplits),pt=((ht=Ze==null?void 0:Ze.data)==null?void 0:ht.catalogType)??"",Jt=SL(Ze.id,pt,_),Gt=((_t=Ze.data)==null?void 0:_t.hasRequiredConnections)??!0,Ct=!Yw(qt,Et),Dn=!Yw(Pt,Ht);if(!Ct&&!Dn&&!(Jt!==Gt))return Ze;const pn={...Ze.data,hasRequiredConnections:Jt};return Et.length?pn.activeSplits=Et:delete pn.activeSplits,Ht.length?pn.connectedSplits=Ht:delete pn.connectedSplits,Ye=!0,(Ct||Dn)&&ve.push(Ze.id),{...Ze,data:pn}});return Ye?Ue:xe}),ve.length&&ee(ve)},[_,ee,v]);const D=f.useMemo(()=>m.find(ve=>ve.id===M)??null,[m,M]),X=f.useMemo(()=>{const ve=m.map(Se=>{const{data:$e,...Ye}=Se,Ue=$e?{...$e}:void 0;return Ue&&(delete Ue.onRemoveNode,delete Ue.onOpenSettings),JSON.parse(JSON.stringify({...Ye,data:Ue}))}),xe=_.map(Se=>JSON.parse(JSON.stringify(Se)));return{nodes:ve,edges:xe}},[_,m]),Y=f.useCallback(ve=>{P(ve),j(!0)},[]),K=f.useCallback(()=>{j(!1),P(null)},[]),U=f.useCallback(()=>{$.current=!0},[]);f.useEffect(()=>{$.current&&($.current=!1,requestAnimationFrame(()=>{var ve;(ve=A.current)==null||ve.fitView({padding:.25,duration:350})}))},[_,m]);const te=f.useCallback(ve=>{ve!=="dataset-source"&&(v(xe=>xe.filter(Se=>Se.id!==ve)),y(xe=>xe.filter(Se=>Se.source!==ve&&Se.target!==ve)),P(xe=>xe===ve?(j(!1),null):xe))},[y,j,v]),W=f.useCallback(ve=>{var Dn,wn,pn,Tt,hs,sn;const xe=ve.data??{},Se=xe.isDataset??ve.id==="dataset-source",$e={...ve.style??{}},Ye=xe.catalogType??xe.type??ve.id;let Ze=Array.isArray(xe.parameters)?xe.parameters:null;if((!Ze||Ze.length===0)&&typeof Ye=="string"){const ht=q.current.get(Ye)??null;(Dn=ht==null?void 0:ht.parameters)!=null&&Dn.length&&(Ze=ht.parameters)}const Nt=Array.isArray(Ze)?Ze.map(ht=>({...ht})):[];let Et;if(Nt.length||xe.config&&typeof xe.config=="object"){const ht=Dd(xe.config);Nt.forEach(_t=>{_t!=null&&_t.name&&ht[_t.name]===void 0&&_t.default!==void 0&&(Array.isArray(_t.default)?ht[_t.name]=[..._t.default]:_t.type==="boolean"?ht[_t.name]=!!_t.default:ht[_t.name]=_t.default)}),Et=ht}$e.width||($e.width=Se?Vw+20:Vw),$e.minHeight||($e.minHeight=pL),$e.padding||($e.padding=12),$e.borderRadius||($e.borderRadius=16),$e.boxSizing=$e.boxSizing??"border-box",$e.whiteSpace=$e.whiteSpace??"pre-line",$e.background||($e.background=Se?"linear-gradient(165deg, rgba(30, 64, 175, 0.9), rgba(59, 130, 246, 0.85))":"linear-gradient(160deg, rgba(30, 41, 59, 0.92), rgba(15, 23, 42, 0.92))"),$e.border||($e.border=Se?"1px solid rgba(59, 130, 246, 0.55)":"1px solid rgba(148, 163, 184, 0.22)"),$e.boxShadow||($e.boxShadow=Se?"0 24px 54px rgba(59, 130, 246, 0.28)":"0 18px 42px rgba(2, 6, 23, 0.45)"),$e.color||($e.color=Se?"#e0f2fe":"#e2e8f0"),$e.fontWeight||($e.fontWeight=Se?600:500);const qt=Ye==="drop_missing_columns"||xe.description===Ww?Kw:xe.description,Ht=th(Ye),Pt=Et??(xe.config&&typeof xe.config=="object"?Dd(xe.config):void 0);Pt&&typeof Pt=="object"&&Ht&&delete Pt[fl];const pt={...xe,label:xe.label??ve.id,description:qt,isDataset:Se,isRemovable:xe.isRemovable??!Se,isConfigured:Se||xe.isConfigured===!0?!0:xe.config&&typeof xe.config=="object"?Ht?!0:!xe.config[fl]:!1,inputs:Array.isArray(xe.inputs)?[...xe.inputs]:xe.inputs,outputs:Array.isArray(xe.outputs)?[...xe.outputs]:xe.outputs,category:xe.category,parameters:Nt,config:Pt,catalogType:Ye,onRemoveNode:te,onOpenSettings:Y},Jt=typeof Ye=="string"?zd[Ye]:void 0;if(Jt){const ht=((wn=Jt.inputs)==null?void 0:wn.map(zn=>bL(zn)))??[],_t=((pn=Jt.outputs)==null?void 0:pn.map(zn=>zn.label))??[];ht.length?pt.inputs=ht:delete pt.inputs,_t.length?pt.outputs=_t:delete pt.outputs,pt.connectionInfo={inputs:((Tt=Jt.inputs)==null?void 0:Tt.map(zn=>({...zn})))??[],outputs:((hs=Jt.outputs)==null?void 0:hs.map(zn=>({...zn})))??[]}}else(!pt.inputs||pt.inputs.length===0)&&delete pt.inputs,(!pt.outputs||pt.outputs.length===0)&&delete pt.outputs,delete pt.connectionInfo;const Gt=ho(pt.activeSplits);Gt.length?pt.activeSplits=Gt:delete pt.activeSplits;const Ct=ho(pt.connectedSplits);return Ct.length?pt.connectedSplits=Ct:delete pt.connectedSplits,Ye==="train_test_split"&&(pt.activeSplits=[...fo],Ct.length||delete pt.connectedSplits),(sn=pt.parameters)!=null&&sn.length||delete pt.parameters,pt.config===void 0&&delete pt.config,{...ve,type:"featureNode",position:ve.position??{x:0,y:0},data:pt,style:$e}},[Y,te]),I=f.useCallback(()=>{v(ve=>{const xe=ve.find($e=>$e.id==="dataset-source");return[W(xe?{...xe,data:{...xe.data??{},label:`Dataset input
(${V})`,isDataset:!0,isRemovable:!1,isConfigured:!0}}:{id:"dataset-source",type:"featureNode",position:{x:-200,y:40},data:{label:`Dataset input
(${V})`,isDataset:!0,isRemovable:!1,isConfigured:!0}})]}),y([]),P(null),j(!1),U()},[V,W,U,y,v,P,j]);f.useImperativeHandle(l,()=>({openCatalog:()=>k(!0),closeCatalog:()=>k(!1),clearGraph:I}),[I]);const Q=f.useCallback(ve=>ve.map(xe=>{const Se={...xe.data??{}};xe.id==="dataset-source"&&(Se.label=`Dataset input
(${V})`,Se.isDataset=!0,Se.isRemovable=!1,Se.isConfigured=!0);const $e=Se.catalogType??Se.type??xe.id;return Se.config&&typeof Se.config=="object"&&th($e)&&delete Se.config[fl],Se.isConfigured===void 0&&(Se.config&&typeof Se.config=="object"?Se.isConfigured=th($e)?!0:!Se.config[fl]:Se.isConfigured=!0),W({...xe,data:Se})}),[V,W]),me=f.useCallback((ve,xe)=>{const Se=O.current+1,$e=`node-${Se}`;O.current=Se;const Ye=xe??{x:160+(Se-1)%4*220,y:40+Math.floor((Se-1)/4)*160},Ue=`Step ${Se}`,Ze=(ve==null?void 0:ve.label)??(ve==null?void 0:ve.type)??Ue,Nt=typeof Ze=="string"&&Ze.trim()?Ze:Ue,Et=nh(ve),qt=th((ve==null?void 0:ve.type)??null);return W({id:$e,type:"featureNode",position:Ye,data:{label:Nt,description:ve==null?void 0:ve.description,inputs:ve==null?void 0:ve.inputs,outputs:ve==null?void 0:ve.outputs,category:ve==null?void 0:ve.category,parameters:ve==null?void 0:ve.parameters,config:Et,catalogType:ve==null?void 0:ve.type,isConfigured:!!qt}})},[W]),J=f.useCallback(ve=>{const xe=A.current,Se=z.current;if(!xe||typeof xe.project!="function"||!Se)return;const $e=Se.getBoundingClientRect(),Ye=xe.project({x:$e.width/2,y:$e.height/2});if(!Ye)return;const Ue=ve.filter(Pt=>Pt.id!=="dataset-source").length,Ze=[{x:0,y:0},{x:220,y:0},{x:-220,y:0},{x:0,y:180},{x:220,y:180},{x:-220,y:180},{x:0,y:-180},{x:220,y:-180},{x:-220,y:-180}],Nt=Ue%Ze.length,Et=Math.floor(Ue/Ze.length),qt=Ze[Nt],Ht=Et+1;return{x:Ye.x+qt.x*Ht,y:Ye.y+qt.y*Ht}},[]),H=Ar({queryKey:["feature-canvas","node-catalog"],queryFn:lx,staleTime:5*60*1e3}),Z=H.data??[],ne=H.isLoading||H.isFetching,fe=H.error?((zt=H.error)==null?void 0:zt.message)??"Unable to load node catalog":null,ae=f.useMemo(()=>{const ve=new Map;return Z.forEach(xe=>{xe&&typeof xe.type=="string"&&xe.type.trim()&&ve.set(xe.type,xe)}),ve},[Z]);f.useEffect(()=>{q.current=ae},[ae]);const pe=f.useCallback(ve=>{if(!ve)return!1;if(CL.has(ve))return!0;const xe=ae.get(ve);return xe?(typeof xe.category=="string"?xe.category.toLowerCase():"").includes("preprocess"):!1},[ae]),Ve=f.useCallback(ve=>{var Se;if(!ve||ve.id==="dataset-source")return!1;const xe=(Se=ve==null?void 0:ve.data)==null?void 0:Se.catalogType;return pe(typeof xe=="string"?xe:null)},[pe]),st=f.useMemo(()=>m.some(ve=>Ve(ve)),[m,Ve]),Ke=Ar({queryKey:["feature-canvas","pipeline",e],queryFn:()=>wx(e),enabled:!!e,staleTime:60*1e3,retry:1}),mt=Ke.isLoading||Ke.isFetching,yt=f.useCallback(ve=>{v(xe=>{const Se=J(xe),$e=me(ve,Se);return[...xe,$e]}),U()},[me,J,U,v]),Te=f.useCallback((ve,xe)=>{v(Se=>Se.map($e=>{if($e.id!==ve)return $e;const Ye=Dd(xe);Ye&&typeof Ye=="object"&&delete Ye[fl];const Ue={...$e.data??{},config:Ye,isConfigured:!0};return W({...$e,data:Ue})}))},[W,v]),at=f.useCallback((ve,xe)=>{v(Se=>Se.map($e=>{if($e.id!==ve)return $e;const Ye={...$e.data??{},...xe};return W({...$e,data:Ye})}))},[W,v]),it=f.useCallback((ve,xe)=>{v(Se=>Se.map($e=>{var Et;if($e.id!==ve)return $e;const Ye=(Et=$e==null?void 0:$e.data)==null?void 0:Et.catalogType,Ue=Ye?ae.get(Ye)??null:null,Ze=xe&&typeof xe=="object"?Dd(xe):nh(Ue??null),Nt={...$e.data??{},config:Ze,isConfigured:!1,backgroundExecutionStatus:"idle"};return W({...$e,data:Nt})}))},[ae,W,v]),be=f.useCallback(()=>{st&&(typeof window<"u"&&!window.confirm("Reset all preprocessing nodes to their default settings?")||v(ve=>ve.map(xe=>{var Ze;if(!Ve(xe))return xe;const Se=(Ze=xe==null?void 0:xe.data)==null?void 0:Ze.catalogType,$e=Se?ae.get(Se)??null:null,Ye=nh($e??null),Ue={...xe.data??{},config:Ye,isConfigured:!1,backgroundExecutionStatus:"idle"};return W({...xe,data:Ue})})))},[ae,st,W,v,Ve]),Pe=f.useCallback(ve=>{var Et,qt;const{source:xe,target:Se,sourceHandle:$e,targetHandle:Ye}=ve;if(!xe||!Se||!Ye||xe===Se)return!1;const Ue=m.find(Ht=>Ht.id===Se);if(!Ue)return!1;const Ze=((Et=Ue==null?void 0:Ue.data)==null?void 0:Et.catalogType)??"",Nt=Ze?zd[Ze]:void 0;if((qt=Nt==null?void 0:Nt.inputs)!=null&&qt.length){const Ht=Jw(Se,Ye);if(!Ht)return!1;const Pt=Nt.inputs.find(pt=>pt.key===Ht);return!Pt||!$e?!1:Pt.accepts&&Pt.accepts.length>0?Pt.accepts.some(pt=>{const Jt=vL[pt];return Jt?Jt($e):!1}):!0}return!0},[m]),G=f.useCallback(ve=>{y(Se=>Ry({...ve,type:"animatedEdge",animated:!0},Se));const xe=[ve.source,ve.target].filter(Se=>!!Se);xe.length&&ee(xe)},[ee,y]);f.useEffect(()=>{if(!e){const ve=`Dataset input
(${V})`;if(x.current)v(xe=>{let Se=!1;const $e=xe.map(Ye=>{var Ze;return Ye.id!=="dataset-source"||(((Ze=Ye==null?void 0:Ye.data)==null?void 0:Ze.label)??"")===ve?Ye:(Se=!0,W({...Ye,data:{...Ye.data??{},label:ve,isDataset:!0,isRemovable:!1}}))});return Se?$e:xe});else{const xe=$L(V),Se=Q(xe.nodes);x.current=!0,v(Se),y(xe.edges),le(Se),U(),a==null||a({nodes:Se,edges:xe.edges,pipeline:null,context:"sample"})}return}if(x.current=!1,Ke.isLoading){const ve=`Dataset input
(${V})`;v(xe=>xe.map(Se=>Se.id==="dataset-source"?W({...Se,data:{...Se.data??{},label:ve,isDataset:!0,isRemovable:!1}}):Se));return}if(Ke.isError){const ve=Ke.error??new Error("Failed to load saved pipeline");console.error("Failed to load saved pipeline",ve),i==null||i(ve);const xe=`Dataset input
(${V})`,Se=sh().map(Ye=>Ye.id==="dataset-source"?{...Ye,data:{...Ye.data??{},label:xe,isDataset:!0,isRemovable:!1}}:Ye),$e=Q(Se);v($e),y([]),le($e),U(),a==null||a({nodes:$e,edges:[],pipeline:null,context:"reset"});return}if(Ke.data){const ve=Ke.data.graph??{},xe=Array.isArray(ve==null?void 0:ve.nodes)&&ve.nodes.length?ve.nodes:sh(),Se=Q(xe),Ye=(Array.isArray(ve==null?void 0:ve.edges)?ve.edges:[]).map(Ue=>{var Jt;const Ze=Ue==null?void 0:Ue.type,Nt=!Ze||Ze==="smoothstep"||Ze==="default"?"animatedEdge":Ze,Et=Ue==null?void 0:Ue.source,qt=Ue==null?void 0:Ue.target,Ht=Se.find(Gt=>Gt.id===qt),Pt=(Ue==null?void 0:Ue.sourceHandle)??(Et?`${Et}-source`:void 0),pt=(Ue==null?void 0:Ue.targetHandle)??((Jt=Ht==null?void 0:Ht.data)!=null&&Jt.isDataset?void 0:qt?`${qt}-target`:void 0);return{...Ue,animated:(Ue==null?void 0:Ue.animated)??!0,type:Nt,sourceHandle:Pt,targetHandle:pt}});v(Se),y(Ye),le(Se),U(),a==null||a({nodes:Se,edges:Ye,pipeline:Ke.data??null,context:"stored"});return}if(Ke.isFetched&&!Ke.data){const ve=`Dataset input
(${V})`,xe=sh().map($e=>$e.id==="dataset-source"?{...$e,data:{...$e.data??{},label:ve,isDataset:!0,isRemovable:!1}}:$e),Se=Q(xe);v(Se),y([]),le(Se),U(),a==null||a({nodes:Se,edges:[],pipeline:null,context:"sample"})}},[V,a,i,Ke.data,Ke.error,Ke.isError,Ke.isFetched,Ke.isLoading,Q,W,U,y,v,e,le]),f.useEffect(()=>{n==null||n(m,_)},[_,m,n]);const ke=f.useMemo(()=>{var Se;if(!D)return null;const ve=(Se=D==null?void 0:D.data)==null?void 0:Se.catalogType;if(!ve)return null;const xe=ae.get(ve);return xe?nh(xe):null},[ae,D]),Ae=f.useMemo(()=>{var xe,Se;if(!D||(xe=D.data)!=null&&xe.isDataset)return!1;const ve=(Se=D==null?void 0:D.data)==null?void 0:Se.catalogType;return pe(typeof ve=="string"?ve:null)},[pe,D]),Ge=f.useMemo(()=>ne?r.jsx("p",{className:"text-muted",children:"Loading node catalog"}):fe?r.jsx("p",{className:"text-danger",children:fe}):Z.length?r.jsx(U1,{nodes:Z,onAddNode:yt}):r.jsx("p",{className:"text-muted",children:"Node catalog unavailable. Define nodes in the backend to continue."}),[fe,yt,ne,Z]),ft=f.useCallback((ve,xe)=>{Y(xe.id)},[Y]);return r.jsxs("div",{className:"canvas-stage",children:[r.jsxs("div",{className:"canvas-stage__viewport","data-pipeline-loading":mt?"true":"false","aria-busy":mt,ref:z,children:[r.jsxs(ax,{style:{width:"100%",height:"100%"},nodes:m,edges:_,nodeTypes:u,edgeTypes:d,onNodesChange:p,onEdgesChange:w,onConnect:G,isValidConnection:Pe,onNodeClick:ft,onInit:ve=>{A.current=ve,requestAnimationFrame(()=>ve.fitView({padding:.25}))},minZoom:.5,maxZoom:1.75,connectionRadius:180,connectionMode:nl.Loose,connectOnClick:!0,nodeDragHandle:".feature-node__drag-handle",proOptions:{hideAttribution:!0},defaultEdgeOptions:{type:"animatedEdge",animated:!0,style:{strokeWidth:3}},connectionLineComponent:B1,elevateEdgesOnSelect:!0,edgesUpdatable:!1,children:[r.jsx(lk,{position:"bottom-left"}),r.jsx(fk,{gap:16})]}),r.jsx("button",{type:"button",className:"canvas-fab canvas-fab--reset",onClick:be,disabled:!st,"aria-label":"Reset preprocessing nodes",title:st?"Reset all preprocessing nodes to defaults":"No preprocessing nodes to reset",children:""}),r.jsx("button",{type:"button",className:"canvas-fab",onClick:()=>k(!0),"aria-label":"Open node catalog",children:"+"})]}),r.jsxs("div",{className:`canvas-drawer${S?" canvas-drawer--open":""}`,children:[r.jsxs("div",{className:"canvas-drawer__header",children:[r.jsx("h2",{children:"Node catalog"}),r.jsx("button",{type:"button",className:"canvas-drawer__close",onClick:()=>k(!1),"aria-label":"Close catalog",children:""})]}),r.jsx("div",{className:"canvas-drawer__body",children:Ge})]}),S&&r.jsx("div",{className:"canvas-drawer__backdrop",onClick:()=>k(!1)}),T&&D&&r.jsx(mL,{node:D,sourceId:e??null,graphSnapshot:X,onClose:K,onUpdateConfig:Te,onUpdateNodeData:at,onResetConfig:it,defaultConfigTemplate:ke,isResetAvailable:Ae})]})}),DL=({sourceId:e})=>{var mt,yt;const t=gc(),n=f.useRef(null),[a,i]=f.useState(e??null),[l,u]=f.useState(null),[d,m]=f.useState(!0),[v,p]=f.useState(!1),[_,y]=f.useState(null),[w,x]=f.useState(null),[S,k]=f.useState(null),[M,P]=f.useState(null),[T,j]=f.useState(!1),O=f.useMemo(()=>["feature-canvas","pipeline",a],[a]),A=f.useRef(null),z=f.useRef({nodes:[],edges:[]}),$=f.useRef(!0),q=Ar({queryKey:["feature-canvas","datasets"],queryFn:()=>xx(12),staleTime:5*60*1e3}),V=q.data??[],R=q.isLoading,ee=q.error?((mt=q.error)==null?void 0:mt.message)??"Unable to load datasets":null,le=f.useMemo(()=>V.filter(Te=>(Te==null?void 0:Te.is_owned)!==!1),[V]);f.useEffect(()=>{if(!V.length){u(null);return}if(a){const at=V.find(it=>it.source_id===a);if(at){u(it=>(it==null?void 0:it.id)===at.id?it:at);return}}const Te=le[0]??V[0];Te&&(a||i(Te.source_id??String(Te.id)),u(Te))},[a,V,le]);const D=Ar({queryKey:["feature-canvas","pipeline-history",a],queryFn:()=>Nx(a,TL),enabled:!!a,staleTime:30*1e3,retry:1}),X=D.data??[],Y=D.isLoading||D.isFetching,K=D.error?((yt=D.error)==null?void 0:yt.message)??"Unable to load history":null,{mutate:U,isPending:te}=Xm({mutationFn:async({sourceId:Te,payload:at})=>jx(Te,at),onSuccess:(Te,at)=>{y({message:"Draft saved successfully.",tone:"success"}),p(!1),x(Te.id??null),P(Te.name??null),k(Te.updated_at??null),A.current=Te.id??null,t.setQueryData(["feature-canvas","pipeline",at.sourceId],Te),t.invalidateQueries({queryKey:["feature-canvas","pipeline-history",at.sourceId],exact:!1})},onError:Te=>{y({message:(Te==null?void 0:Te.message)??"Failed to save pipeline.",tone:"error"})}});f.useEffect(()=>{if(!_||_.tone==="error"||typeof window>"u")return;const Te=window.setTimeout(()=>y(null),_.tone==="success"?4e3:2500);return()=>window.clearTimeout(Te)},[_]);const W=f.useCallback((Te,at)=>{const it={nodes:JSON.parse(JSON.stringify(Te??[])),edges:JSON.parse(JSON.stringify(at??[]))},be=z.current,Pe=JSON.stringify(be.nodes??[])===JSON.stringify(it.nodes??[])&&JSON.stringify(be.edges??[])===JSON.stringify(it.edges??[]);z.current=it;const G=Array.isArray(it.nodes)?it.nodes.some(Ae=>(Ae==null?void 0:Ae.id)&&Ae.id!=="dataset-source"):!1,ke=Array.isArray(it.edges)?it.edges.length>0:!1;j(G||ke),!($.current||Pe)&&(p(!0),y(null))},[]),I=f.useCallback(Te=>{const{nodes:at,edges:it,pipeline:be,context:Pe}=Te,G={nodes:JSON.parse(JSON.stringify(at??[])),edges:JSON.parse(JSON.stringify(it??[]))};z.current=G;const ke=(G.nodes??[]).some(ft=>ft.id!=="dataset-source"),Ae=Array.isArray(G.edges)?G.edges.length>0:!1;j(ke||Ae);const Ge=(be==null?void 0:be.id)??null;if(x(Ge),P((be==null?void 0:be.name)??null),k((be==null?void 0:be.updated_at)??null),Pe==="stored"&&be)if(A.current===be.id){const zt=v_(be.updated_at)??__(be.updated_at);y({message:`Saved revision ${be.name??`#${be.id}`} (${zt})`,tone:"info"}),A.current=null}else $.current&&y(ft=>(ft==null?void 0:ft.tone)==="error"?ft:ke?{message:"Loaded saved pipeline",tone:"info"}:ft);else Pe==="sample"?(A.current=null,y(ft=>(ft==null?void 0:ft.tone)==="error"||ke?ft:{message:`Showing starter pipeline for ${(l==null?void 0:l.name)??(l==null?void 0:l.source_id)??a??"demo dataset"}`,tone:"info"})):Pe==="reset"?A.current=null:be||(A.current=null,y(ft=>(ft==null?void 0:ft.tone)==="error"?ft:null));$.current&&p(!1),be&&A.current&&A.current!==be.id&&(A.current=null),$.current=!1},[a,l,j]),Q=f.useCallback(Te=>{y({message:(Te==null?void 0:Te.message)??"Unable to load saved pipeline. Starting fresh.",tone:"error"})},[]),me=f.useCallback(Te=>{if(!(Te!=null&&Te.graph)){y({message:"Selected revision is missing pipeline data.",tone:"error"});return}v&&typeof window<"u"&&!window.confirm("You have unsaved changes. Replace the canvas with the selected revision?")||(A.current=Te.id??null,$.current=!0,y({message:`Loading revision ${Te.name??`#${Te.id}`}`,tone:"info"}),t.setQueryData(O,Te))},[v,O,t]),J=f.useCallback(()=>{var it;if(!a){y({message:"Select a dataset before saving.",tone:"error"});return}const Te=z.current;if(!Te.nodes||!Te.nodes.length){y({message:"Add nodes to the canvas before saving.",tone:"error"});return}const at={name:l!=null&&l.name?`Draft pipeline for ${l.name}`:`Draft pipeline for ${a}`,graph:{nodes:Te.nodes,edges:(Te.edges??[]).map(be=>{const Pe=be==null?void 0:be.type,G=!Pe||Pe==="smoothstep"||Pe==="default"?"animatedEdge":Pe;return{...be,animated:(be==null?void 0:be.animated)??!0,type:G}})},metadata:{lastClientSave:new Date().toISOString(),nodeCount:Te.nodes.length,edgeCount:((it=Te.edges)==null?void 0:it.length)??0}};y({message:"Saving draft",tone:"info"}),U({sourceId:a,payload:at})},[a,l==null?void 0:l.name,U]),H=f.useCallback(()=>{var Te;T&&(typeof window<"u"&&!window.confirm("Clear all nodes and connections from the canvas? This cannot be undone.")||((Te=n.current)==null||Te.clearGraph(),y(at=>(at==null?void 0:at.tone)==="error"?at:{message:"Canvas cleared. Unsaved edits pending.",tone:"info"})))},[T,n,y]),Z=(_==null?void 0:_.tone)==="success"?"":(_==null?void 0:_.tone)==="error"?"":"",ne=f.useCallback(()=>{m(Te=>!Te)},[]),fe=f.useCallback(Te=>{const at=V.find(it=>it.source_id===Te)??null;if(!at){y({message:"Dataset unavailable. Choose another option.",tone:"error"});return}if(at.is_owned===!1){y({message:"Only datasets you own can be selected.",tone:"error"});return}i(Te),u(at),$.current=!0,p(!1),y(null)},[V]),ae=te?"Saving":v?"Save draft*":"Save draft",pe=!a||te,Ve=_?_.tone==="error"?"text-danger":_.tone==="success"?"text-success":"text-muted":"text-muted",st=V.map(Te=>({value:Te.source_id,label:Te.name??Te.source_id,isOwned:Te.is_owned!==!1})),Ke=le.length>1;return r.jsxs("div",{className:"feature-canvas-app","data-sidepanel-expanded":d?"true":"false",children:[r.jsx("button",{type:"button",className:"canvas-sidepanel__toggle",onClick:ne,"aria-label":d?"Collapse details panel":"Expand details panel","aria-expanded":d,"aria-controls":"feature-canvas-sidepanel",children:d?"":""}),!d&&_&&r.jsxs("div",{className:`canvas-sidepanel__feedback canvas-sidepanel__feedback--floating ${Ve}`,children:[r.jsx("span",{className:"canvas-sidepanel__feedback-icon","aria-hidden":"true",children:Z}),r.jsx("span",{className:"canvas-sidepanel__feedback-text",children:_.message})]}),d&&r.jsxs("aside",{id:"feature-canvas-sidepanel",className:"canvas-sidepanel",role:"complementary","aria-label":"Canvas details",children:[r.jsxs("div",{className:"canvas-sidepanel__content",role:"group","aria-label":"Canvas controls",children:[r.jsxs("section",{className:"canvas-sidepanel__section",children:[r.jsxs("div",{className:"canvas-sidepanel__section-heading",children:[r.jsx("h2",{children:"Dataset"}),S&&r.jsx("span",{className:"canvas-sidepanel__meta",children:v_(S)??__(S)})]}),ee?r.jsx("p",{className:"text-danger",children:ee}):le.length?r.jsx("div",{className:"canvas-sidepanel__select-wrapper",children:r.jsx("select",{className:"canvas-sidepanel__select",value:a??"",onChange:Te=>fe(Te.target.value),disabled:R||!Ke,"aria-label":"Select dataset",children:st.map(Te=>r.jsx("option",{value:Te.value,disabled:!Te.isOwned,children:`${Te.label}${Te.isOwned?"":" (locked)"}`},Te.value))})}):r.jsx("p",{className:"text-muted",children:"Dataset switching is limited to collections you own."}),R&&r.jsx("p",{className:"text-muted",children:"Loading datasets"}),!R&&!V.length&&!ee&&r.jsx("p",{className:"text-muted",children:"No datasets available. Send one from EDA to get started."}),(l==null?void 0:l.description)&&r.jsx("p",{className:"canvas-sidepanel__description",children:l.description}),a&&r.jsxs("p",{className:"canvas-sidepanel__meta",children:["Working with ",r.jsx("strong",{children:(l==null?void 0:l.name)??a})]}),!Ke&&le.length>0&&r.jsx("p",{className:"canvas-sidepanel__hint",children:"Add more owned datasets to switch between them."})]}),r.jsxs("section",{className:"canvas-sidepanel__section",children:[r.jsx("div",{className:"canvas-sidepanel__section-action",children:r.jsxs("button",{type:"button",className:"canvas-sidepanel__action-button",onClick:H,disabled:!T,"aria-label":"Clean all nodes",title:T?"Remove all nodes and edges from the canvas":"Nothing to clean yet",children:[r.jsx("span",{"aria-hidden":"true",children:""}),r.jsx("span",{children:"Clean all nodes"})]})}),r.jsxs("div",{className:"canvas-sidepanel__section-heading",children:[r.jsx("h2",{children:"History"}),r.jsxs("div",{className:"canvas-sidepanel__section-controls",children:[r.jsx("button",{type:"button",className:"canvas-sidepanel__icon-button",onClick:()=>D.refetch(),disabled:Y||!a,"aria-label":"Refresh history",title:"Refresh history",children:""}),r.jsx("button",{type:"button",className:"canvas-sidepanel__icon-button",onClick:J,disabled:pe,"aria-label":ae,title:ae,children:""})]})]}),r.jsx("div",{className:"canvas-sidepanel__history",children:Y?r.jsx("p",{className:"text-muted",children:"Loading history"}):K?r.jsx("p",{className:"text-danger",children:K}):X.length?X.map(Te=>{const it=v_(Te.updated_at)??__(Te.updated_at),be=Te.id===w,Pe=be&&!v;return r.jsxs("button",{type:"button",className:`canvas-sidepanel__history-item${be?" canvas-sidepanel__history-item--active":""}`,onClick:()=>me(Te),disabled:Pe,children:[r.jsx("span",{className:"canvas-sidepanel__history-title",children:Te.name||`Pipeline #${Te.id}`}),r.jsx("span",{className:"canvas-sidepanel__history-meta",children:it}),be&&v&&r.jsx("span",{className:"canvas-sidepanel__history-badge",children:"Unsaved edits"})]},Te.id)}):r.jsx("p",{className:"text-muted",children:"No saved revisions yet. Save a draft to populate history."})})]})]}),_&&r.jsxs("p",{className:`canvas-sidepanel__feedback ${Ve}`,children:[r.jsx("span",{className:"canvas-sidepanel__feedback-icon","aria-hidden":"true",children:Z}),r.jsx("span",{className:"canvas-sidepanel__feedback-text",children:_.message})]})]}),r.jsx("div",{className:"feature-canvas-app__viewport",children:r.jsx(ox,{children:r.jsx(LL,{ref:n,sourceId:a,datasetName:(l==null?void 0:l.name)??(l==null?void 0:l.source_id)??null,onGraphChange:W,onPipelineHydrated:I,onPipelineError:Q})})})]})},zL=new Uj,y_=document.getElementById("ml-workflow-root");if(!y_)throw new Error("ML workflow root element not found");const RL=Cp.createRoot(y_),FL=y_.getAttribute("data-source-id")||void 0;RL.render(r.jsx(Oe.StrictMode,{children:r.jsx(qj,{client:zL,children:r.jsx(DL,{sourceId:FL})})}))})();
//# sourceMappingURL=feature-canvas.js.map
