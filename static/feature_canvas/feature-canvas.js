var MS=un=>{throw TypeError(un)};var N_=(un,kn,An)=>kn.has(un)||MS("Cannot "+An);var re=(un,kn,An)=>(N_(un,kn,"read from private field"),An?An.call(un):kn.get(un)),Ke=(un,kn,An)=>kn.has(un)?MS("Cannot add the same private member more than once"):kn instanceof WeakSet?kn.add(un):kn.set(un,An),Re=(un,kn,An,No)=>(N_(un,kn,"write to private field"),No?No.call(un,An):kn.set(un,An),An),_t=(un,kn,An)=>(N_(un,kn,"access private method"),An);var bf=(un,kn,An,No)=>({set _(gt){Re(un,kn,gt,An)},get _(){return re(un,kn,No)}});(function(){"use strict";var Ta,Kp,zj,Wo,$a,nl,Ij,sl,Pa,rl,Fj,Yo,Bj,Ko,al,ar,Go,Kn,Dc,Xo,br,va,Uj,Ls,wt,zc,xs,Qo,ol,ea,La,Ic,il,ll,Zo,Jo,Ra,cl,It,bu,j_,C_,S_,E_,M_,k_,A_,kS,Hj,Fc,Dr,bs,ei,zr,wo,qj,ta,wr,Bc,Vj,na,Da,Rs,sa,ra,wf,O_,Wj,Ir,Yj,yn,za,Ia,ul,dl,Fa,ml,fl,Kj;function un(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kn={exports:{}},An={},No={exports:{}},gt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T_;function AS(){if(T_)return gt;T_=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function f(I){return I===null||typeof I!="object"?null:(I=m&&I[m]||I["@@iterator"],typeof I=="function"?I:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,_={};function v(I,H,J){this.props=I,this.context=H,this.refs=_,this.updater=J||y}v.prototype.isReactComponent={},v.prototype.setState=function(I,H){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,H,"setState")},v.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function w(){}w.prototype=v.prototype;function M(I,H,J){this.props=I,this.context=H,this.refs=_,this.updater=J||y}var N=M.prototype=new w;N.constructor=M,x(N,v.prototype),N.isPureReactComponent=!0;var C=Array.isArray,j=Object.prototype.hasOwnProperty,E={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function $(I,H,J){var G,Y={},X=null,Z=null;if(H!=null)for(G in H.ref!==void 0&&(Z=H.ref),H.key!==void 0&&(X=""+H.key),H)j.call(H,G)&&!k.hasOwnProperty(G)&&(Y[G]=H[G]);var ee=arguments.length-2;if(ee===1)Y.children=J;else if(1<ee){for(var Q=Array(ee),ne=0;ne<ee;ne++)Q[ne]=arguments[ne+2];Y.children=Q}if(I&&I.defaultProps)for(G in ee=I.defaultProps,ee)Y[G]===void 0&&(Y[G]=ee[G]);return{$$typeof:e,type:I,key:X,ref:Z,props:Y,_owner:E.current}}function T(I,H){return{$$typeof:e,type:I.type,key:H,ref:I.ref,props:I.props,_owner:I._owner}}function P(I){return typeof I=="object"&&I!==null&&I.$$typeof===e}function A(I){var H={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(J){return H[J]})}var D=/\/+/g;function F(I,H){return typeof I=="object"&&I!==null&&I.key!=null?A(""+I.key):H.toString(36)}function R(I,H,J,G,Y){var X=typeof I;(X==="undefined"||X==="boolean")&&(I=null);var Z=!1;if(I===null)Z=!0;else switch(X){case"string":case"number":Z=!0;break;case"object":switch(I.$$typeof){case e:case t:Z=!0}}if(Z)return Z=I,Y=Y(Z),I=G===""?"."+F(Z,0):G,C(Y)?(J="",I!=null&&(J=I.replace(D,"$&/")+"/"),R(Y,H,J,"",function(ne){return ne})):Y!=null&&(P(Y)&&(Y=T(Y,J+(!Y.key||Z&&Z.key===Y.key?"":(""+Y.key).replace(D,"$&/")+"/")+I)),H.push(Y)),1;if(Z=0,G=G===""?".":G+":",C(I))for(var ee=0;ee<I.length;ee++){X=I[ee];var Q=G+F(X,ee);Z+=R(X,H,J,Q,Y)}else if(Q=f(I),typeof Q=="function")for(I=Q.call(I),ee=0;!(X=I.next()).done;)X=X.value,Q=G+F(X,ee++),Z+=R(X,H,J,Q,Y);else if(X==="object")throw H=String(I),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.");return Z}function z(I,H,J){if(I==null)return I;var G=[],Y=0;return R(I,G,"","",function(X){return H.call(J,X,Y++)}),G}function q(I){if(I._status===-1){var H=I._result;H=H(),H.then(function(J){(I._status===0||I._status===-1)&&(I._status=1,I._result=J)},function(J){(I._status===0||I._status===-1)&&(I._status=2,I._result=J)}),I._status===-1&&(I._status=0,I._result=H)}if(I._status===1)return I._result.default;throw I._result}var V={current:null},U={transition:null},W={ReactCurrentDispatcher:V,ReactCurrentBatchConfig:U,ReactCurrentOwner:E};function B(){throw Error("act(...) is not supported in production builds of React.")}return gt.Children={map:z,forEach:function(I,H,J){z(I,function(){H.apply(this,arguments)},J)},count:function(I){var H=0;return z(I,function(){H++}),H},toArray:function(I){return z(I,function(H){return H})||[]},only:function(I){if(!P(I))throw Error("React.Children.only expected to receive a single React element child.");return I}},gt.Component=v,gt.Fragment=n,gt.Profiler=r,gt.PureComponent=M,gt.StrictMode=s,gt.Suspense=d,gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W,gt.act=B,gt.cloneElement=function(I,H,J){if(I==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+I+".");var G=x({},I.props),Y=I.key,X=I.ref,Z=I._owner;if(H!=null){if(H.ref!==void 0&&(X=H.ref,Z=E.current),H.key!==void 0&&(Y=""+H.key),I.type&&I.type.defaultProps)var ee=I.type.defaultProps;for(Q in H)j.call(H,Q)&&!k.hasOwnProperty(Q)&&(G[Q]=H[Q]===void 0&&ee!==void 0?ee[Q]:H[Q])}var Q=arguments.length-2;if(Q===1)G.children=J;else if(1<Q){ee=Array(Q);for(var ne=0;ne<Q;ne++)ee[ne]=arguments[ne+2];G.children=ee}return{$$typeof:e,type:I.type,key:Y,ref:X,props:G,_owner:Z}},gt.createContext=function(I){return I={$$typeof:l,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},I.Provider={$$typeof:i,_context:I},I.Consumer=I},gt.createElement=$,gt.createFactory=function(I){var H=$.bind(null,I);return H.type=I,H},gt.createRef=function(){return{current:null}},gt.forwardRef=function(I){return{$$typeof:u,render:I}},gt.isValidElement=P,gt.lazy=function(I){return{$$typeof:p,_payload:{_status:-1,_result:I},_init:q}},gt.memo=function(I,H){return{$$typeof:h,type:I,compare:H===void 0?null:H}},gt.startTransition=function(I){var H=U.transition;U.transition={};try{I()}finally{U.transition=H}},gt.unstable_act=B,gt.useCallback=function(I,H){return V.current.useCallback(I,H)},gt.useContext=function(I){return V.current.useContext(I)},gt.useDebugValue=function(){},gt.useDeferredValue=function(I){return V.current.useDeferredValue(I)},gt.useEffect=function(I,H){return V.current.useEffect(I,H)},gt.useId=function(){return V.current.useId()},gt.useImperativeHandle=function(I,H,J){return V.current.useImperativeHandle(I,H,J)},gt.useInsertionEffect=function(I,H){return V.current.useInsertionEffect(I,H)},gt.useLayoutEffect=function(I,H){return V.current.useLayoutEffect(I,H)},gt.useMemo=function(I,H){return V.current.useMemo(I,H)},gt.useReducer=function(I,H,J){return V.current.useReducer(I,H,J)},gt.useRef=function(I){return V.current.useRef(I)},gt.useState=function(I){return V.current.useState(I)},gt.useSyncExternalStore=function(I,H,J){return V.current.useSyncExternalStore(I,H,J)},gt.useTransition=function(){return V.current.useTransition()},gt.version="18.3.1",gt}No.exports=AS();var b=No.exports;const ve=un(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $_;function OS(){if($_)return An;$_=1;var e=b,t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(u,d,h){var p,m={},f=null,y=null;h!==void 0&&(f=""+h),d.key!==void 0&&(f=""+d.key),d.ref!==void 0&&(y=d.ref);for(p in d)s.call(d,p)&&!i.hasOwnProperty(p)&&(m[p]=d[p]);if(u&&u.defaultProps)for(p in d=u.defaultProps,d)m[p]===void 0&&(m[p]=d[p]);return{$$typeof:t,type:u,key:f,ref:y,props:m,_owner:r.current}}return An.Fragment=n,An.jsx=l,An.jsxs=l,An}kn.exports=OS();var o=kn.exports,Nf={},P_={exports:{}},Os={},jf={exports:{}},Cf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L_;function TS(){return L_||(L_=1,function(e){function t(U,W){var B=U.length;U.push(W);e:for(;0<B;){var I=B-1>>>1,H=U[I];if(0<r(H,W))U[I]=W,U[B]=H,B=I;else break e}}function n(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var W=U[0],B=U.pop();if(B!==W){U[0]=B;e:for(var I=0,H=U.length,J=H>>>1;I<J;){var G=2*(I+1)-1,Y=U[G],X=G+1,Z=U[X];if(0>r(Y,B))X<H&&0>r(Z,Y)?(U[I]=Z,U[X]=B,I=X):(U[I]=Y,U[G]=B,I=G);else if(X<H&&0>r(Z,B))U[I]=Z,U[X]=B,I=X;else break e}}return W}function r(U,W){var B=U.sortIndex-W.sortIndex;return B!==0?B:U.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var l=Date,u=l.now();e.unstable_now=function(){return l.now()-u}}var d=[],h=[],p=1,m=null,f=3,y=!1,x=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(U){for(var W=n(h);W!==null;){if(W.callback===null)s(h);else if(W.startTime<=U)s(h),W.sortIndex=W.expirationTime,t(d,W);else break;W=n(h)}}function C(U){if(_=!1,N(U),!x)if(n(d)!==null)x=!0,q(j);else{var W=n(h);W!==null&&V(C,W.startTime-U)}}function j(U,W){x=!1,_&&(_=!1,w($),$=-1),y=!0;var B=f;try{for(N(W),m=n(d);m!==null&&(!(m.expirationTime>W)||U&&!A());){var I=m.callback;if(typeof I=="function"){m.callback=null,f=m.priorityLevel;var H=I(m.expirationTime<=W);W=e.unstable_now(),typeof H=="function"?m.callback=H:m===n(d)&&s(d),N(W)}else s(d);m=n(d)}if(m!==null)var J=!0;else{var G=n(h);G!==null&&V(C,G.startTime-W),J=!1}return J}finally{m=null,f=B,y=!1}}var E=!1,k=null,$=-1,T=5,P=-1;function A(){return!(e.unstable_now()-P<T)}function D(){if(k!==null){var U=e.unstable_now();P=U;var W=!0;try{W=k(!0,U)}finally{W?F():(E=!1,k=null)}}else E=!1}var F;if(typeof M=="function")F=function(){M(D)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,z=R.port2;R.port1.onmessage=D,F=function(){z.postMessage(null)}}else F=function(){v(D,0)};function q(U){k=U,E||(E=!0,F())}function V(U,W){$=v(function(){U(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(U){U.callback=null},e.unstable_continueExecution=function(){x||y||(x=!0,q(j))},e.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<U?Math.floor(1e3/U):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(U){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var B=f;f=W;try{return U()}finally{f=B}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(U,W){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var B=f;f=U;try{return W()}finally{f=B}},e.unstable_scheduleCallback=function(U,W,B){var I=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?I+B:I):B=I,U){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=B+H,U={id:p++,callback:W,priorityLevel:U,startTime:B,expirationTime:H,sortIndex:-1},B>I?(U.sortIndex=B,t(h,U),n(d)===null&&U===n(h)&&(_?(w($),$=-1):_=!0,V(C,B-I))):(U.sortIndex=H,t(d,U),x||y||(x=!0,q(j))),U},e.unstable_shouldYield=A,e.unstable_wrapCallback=function(U){var W=f;return function(){var B=f;f=W;try{return U.apply(this,arguments)}finally{f=B}}}}(Cf)),Cf}var R_;function $S(){return R_||(R_=1,jf.exports=TS()),jf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D_;function PS(){if(D_)return Os;D_=1;var e=b,t=$S();function n(a){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+a,g=1;g<arguments.length;g++)c+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function i(a,c){l(a,c),l(a+"Capture",c)}function l(a,c){for(r[a]=c,a=0;a<c.length;a++)s.add(c[a])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(a){return d.call(m,a)?!0:d.call(p,a)?!1:h.test(a)?m[a]=!0:(p[a]=!0,!1)}function y(a,c,g,S){if(g!==null&&g.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return S?!1:g!==null?!g.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function x(a,c,g,S){if(c===null||typeof c>"u"||y(a,c,g,S))return!0;if(S)return!1;if(g!==null)switch(g.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function _(a,c,g,S,O,L,K){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=S,this.attributeNamespace=O,this.mustUseProperty=g,this.propertyName=a,this.type=c,this.sanitizeURL=L,this.removeEmptyString=K}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){v[a]=new _(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var c=a[0];v[c]=new _(c,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){v[a]=new _(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){v[a]=new _(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){v[a]=new _(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){v[a]=new _(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){v[a]=new _(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){v[a]=new _(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){v[a]=new _(a,5,!1,a.toLowerCase(),null,!1,!1)});var w=/[\-:]([a-z])/g;function M(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var c=a.replace(w,M);v[c]=new _(c,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var c=a.replace(w,M);v[c]=new _(c,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var c=a.replace(w,M);v[c]=new _(c,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){v[a]=new _(a,1,!1,a.toLowerCase(),null,!1,!1)}),v.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){v[a]=new _(a,1,!1,a.toLowerCase(),null,!0,!0)});function N(a,c,g,S){var O=v.hasOwnProperty(c)?v[c]:null;(O!==null?O.type!==0:S||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(x(c,g,O,S)&&(g=null),S||O===null?f(c)&&(g===null?a.removeAttribute(c):a.setAttribute(c,""+g)):O.mustUseProperty?a[O.propertyName]=g===null?O.type===3?!1:"":g:(c=O.attributeName,S=O.attributeNamespace,g===null?a.removeAttribute(c):(O=O.type,g=O===3||O===4&&g===!0?"":""+g,S?a.setAttributeNS(S,c,g):a.setAttribute(c,g))))}var C=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),E=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),A=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),V=Symbol.for("react.offscreen"),U=Symbol.iterator;function W(a){return a===null||typeof a!="object"?null:(a=U&&a[U]||a["@@iterator"],typeof a=="function"?a:null)}var B=Object.assign,I;function H(a){if(I===void 0)try{throw Error()}catch(g){var c=g.stack.trim().match(/\n( *(at )?)/);I=c&&c[1]||""}return`
`+I+a}var J=!1;function G(a,c){if(!a||J)return"";J=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(fe){var S=fe}Reflect.construct(a,[],c)}else{try{c.call()}catch(fe){S=fe}a.call(c.prototype)}else{try{throw Error()}catch(fe){S=fe}a()}}catch(fe){if(fe&&S&&typeof fe.stack=="string"){for(var O=fe.stack.split(`
`),L=S.stack.split(`
`),K=O.length-1,se=L.length-1;1<=K&&0<=se&&O[K]!==L[se];)se--;for(;1<=K&&0<=se;K--,se--)if(O[K]!==L[se]){if(K!==1||se!==1)do if(K--,se--,0>se||O[K]!==L[se]){var ae=`
`+O[K].replace(" at new "," at ");return a.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",a.displayName)),ae}while(1<=K&&0<=se);break}}}finally{J=!1,Error.prepareStackTrace=g}return(a=a?a.displayName||a.name:"")?H(a):""}function Y(a){switch(a.tag){case 5:return H(a.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return a=G(a.type,!1),a;case 11:return a=G(a.type.render,!1),a;case 1:return a=G(a.type,!0),a;default:return""}}function X(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case k:return"Fragment";case E:return"Portal";case T:return"Profiler";case $:return"StrictMode";case F:return"Suspense";case R:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case A:return(a.displayName||"Context")+".Consumer";case P:return(a._context.displayName||"Context")+".Provider";case D:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case z:return c=a.displayName||null,c!==null?c:X(a.type)||"Memo";case q:c=a._payload,a=a._init;try{return X(a(c))}catch{}}return null}function Z(a){var c=a.type;switch(a.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=c.render,a=a.displayName||a.name||"",c.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return X(c);case 8:return c===$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function ee(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Q(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function ne(a){var c=Q(a)?"checked":"value",g=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),S=""+a[c];if(!a.hasOwnProperty(c)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var O=g.get,L=g.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return O.call(this)},set:function(K){S=""+K,L.call(this,K)}}),Object.defineProperty(a,c,{enumerable:g.enumerable}),{getValue:function(){return S},setValue:function(K){S=""+K},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function he(a){a._valueTracker||(a._valueTracker=ne(a))}function ye(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var g=c.getValue(),S="";return a&&(S=Q(a)?a.checked?"true":"false":a.value),a=S,a!==g?(c.setValue(a),!0):!1}function ge(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Ee(a,c){var g=c.checked;return B({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:g??a._wrapperState.initialChecked})}function De(a,c){var g=c.defaultValue==null?"":c.defaultValue,S=c.checked!=null?c.checked:c.defaultChecked;g=ee(c.value!=null?c.value:g),a._wrapperState={initialChecked:S,initialValue:g,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function ke(a,c){c=c.checked,c!=null&&N(a,"checked",c,!1)}function le(a,c){ke(a,c);var g=ee(c.value),S=c.type;if(g!=null)S==="number"?(g===0&&a.value===""||a.value!=g)&&(a.value=""+g):a.value!==""+g&&(a.value=""+g);else if(S==="submit"||S==="reset"){a.removeAttribute("value");return}c.hasOwnProperty("value")?be(a,c.type,g):c.hasOwnProperty("defaultValue")&&be(a,c.type,ee(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(a.defaultChecked=!!c.defaultChecked)}function pe(a,c,g){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var S=c.type;if(!(S!=="submit"&&S!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+a._wrapperState.initialValue,g||c===a.value||(a.value=c),a.defaultValue=c}g=a.name,g!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,g!==""&&(a.name=g)}function be(a,c,g){(c!=="number"||ge(a.ownerDocument)!==a)&&(g==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+g&&(a.defaultValue=""+g))}var Te=Array.isArray;function Ie(a,c,g,S){if(a=a.options,c){c={};for(var O=0;O<g.length;O++)c["$"+g[O]]=!0;for(g=0;g<a.length;g++)O=c.hasOwnProperty("$"+a[g].value),a[g].selected!==O&&(a[g].selected=O),O&&S&&(a[g].defaultSelected=!0)}else{for(g=""+ee(g),c=null,O=0;O<a.length;O++){if(a[O].value===g){a[O].selected=!0,S&&(a[O].defaultSelected=!0);return}c!==null||a[O].disabled||(c=a[O])}c!==null&&(c.selected=!0)}}function ue(a,c){if(c.dangerouslySetInnerHTML!=null)throw Error(n(91));return B({},c,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function $e(a,c){var g=c.value;if(g==null){if(g=c.children,c=c.defaultValue,g!=null){if(c!=null)throw Error(n(92));if(Te(g)){if(1<g.length)throw Error(n(93));g=g[0]}c=g}c==null&&(c=""),g=c}a._wrapperState={initialValue:ee(g)}}function Ye(a,c){var g=ee(c.value),S=ee(c.defaultValue);g!=null&&(g=""+g,g!==a.value&&(a.value=g),c.defaultValue==null&&a.defaultValue!==g&&(a.defaultValue=g)),S!=null&&(a.defaultValue=""+S)}function et(a){var c=a.textContent;c===a._wrapperState.initialValue&&c!==""&&c!==null&&(a.value=c)}function We(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mt(a,c){return a==null||a==="http://www.w3.org/1999/xhtml"?We(c):a==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var rt,ft=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,g,S,O){MSApp.execUnsafeLocalFunction(function(){return a(c,g,S,O)})}:a}(function(a,c){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=c;else{for(rt=rt||document.createElement("div"),rt.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=rt.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;c.firstChild;)a.appendChild(c.firstChild)}});function bt(a,c){if(c){var g=a.firstChild;if(g&&g===a.lastChild&&g.nodeType===3){g.nodeValue=c;return}}a.textContent=c}var zt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xe=["Webkit","ms","Moz","O"];Object.keys(zt).forEach(function(a){Xe.forEach(function(c){c=c+a.charAt(0).toUpperCase()+a.substring(1),zt[c]=zt[a]})});function Ft(a,c,g){return c==null||typeof c=="boolean"||c===""?"":g||typeof c!="number"||c===0||zt.hasOwnProperty(a)&&zt[a]?(""+c).trim():c+"px"}function Kt(a,c){a=a.style;for(var g in c)if(c.hasOwnProperty(g)){var S=g.indexOf("--")===0,O=Ft(g,c[g],S);g==="float"&&(g="cssFloat"),S?a.setProperty(g,O):a[g]=O}}var Et=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Qt(a,c){if(c){if(Et[a]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(n(137,a));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(n(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(n(61))}if(c.style!=null&&typeof c.style!="object")throw Error(n(62))}}function wn(a,c){if(a.indexOf("-")===-1)return typeof c.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mt=null;function Zt(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Nn=null,Bt=null,dt=null;function Tn(a){if(a=mi(a)){if(typeof Nn!="function")throw Error(n(280));var c=a.stateNode;c&&(c=Cl(c),Nn(a.stateNode,a.type,c))}}function Xt(a){Bt?dt?dt.push(a):dt=[a]:Bt=a}function Nt(){if(Bt){var a=Bt,c=dt;if(dt=Bt=null,Tn(a),c)for(a=0;a<c.length;a++)Tn(c[a])}}function at(a,c){return a(c)}function os(){}var Vt=!1;function pt(a,c,g){if(Vt)return a(c,g);Vt=!0;try{return at(a,c,g)}finally{Vt=!1,(Bt!==null||dt!==null)&&(os(),Nt())}}function yt(a,c){var g=a.stateNode;if(g===null)return null;var S=Cl(g);if(S===null)return null;g=S[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(a=a.type,S=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!S;break e;default:a=!1}if(a)return null;if(g&&typeof g!="function")throw Error(n(231,c,typeof g));return g}var Gn=!1;if(u)try{var mn={};Object.defineProperty(mn,"passive",{get:function(){Gn=!0}}),window.addEventListener("test",mn,mn),window.removeEventListener("test",mn,mn)}catch{Gn=!1}function vn(a,c,g,S,O,L,K,se,ae){var fe=Array.prototype.slice.call(arguments,3);try{c.apply(g,fe)}catch(je){this.onError(je)}}var nn=!1,jn=null,Jt=!1,Xn=null,$t={onError:function(a){nn=!0,jn=a}};function $n(a,c,g,S,O,L,K,se,ae){nn=!1,jn=null,vn.apply($t,arguments)}function xn(a,c,g,S,O,L,K,se,ae){if($n.apply(this,arguments),nn){if(nn){var fe=jn;nn=!1,jn=null}else throw Error(n(198));Jt||(Jt=!0,Xn=fe)}}function fn(a){var c=a,g=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,c.flags&4098&&(g=c.return),a=c.return;while(a)}return c.tag===3?g:null}function ws(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function Pn(a){if(fn(a)!==a)throw Error(n(188))}function Ns(a){var c=a.alternate;if(!c){if(c=fn(a),c===null)throw Error(n(188));return c!==a?null:a}for(var g=a,S=c;;){var O=g.return;if(O===null)break;var L=O.alternate;if(L===null){if(S=O.return,S!==null){g=S;continue}break}if(O.child===L.child){for(L=O.child;L;){if(L===g)return Pn(O),a;if(L===S)return Pn(O),c;L=L.sibling}throw Error(n(188))}if(g.return!==S.return)g=O,S=L;else{for(var K=!1,se=O.child;se;){if(se===g){K=!0,g=O,S=L;break}if(se===S){K=!0,S=O,g=L;break}se=se.sibling}if(!K){for(se=L.child;se;){if(se===g){K=!0,g=L,S=O;break}if(se===S){K=!0,S=L,g=O;break}se=se.sibling}if(!K)throw Error(n(189))}}if(g.alternate!==S)throw Error(n(190))}if(g.tag!==3)throw Error(n(188));return g.stateNode.current===g?a:c}function Qn(a){return a=Ns(a),a!==null?is(a):null}function is(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var c=is(a);if(c!==null)return c;a=a.sibling}return null}var js=t.unstable_scheduleCallback,Fn=t.unstable_cancelCallback,Zn=t.unstable_shouldYield,Ht=t.unstable_requestPaint,Qe=t.unstable_now,Ue=t.unstable_getCurrentPriorityLevel,Ln=t.unstable_ImmediatePriority,Cs=t.unstable_UserBlockingPriority,Jn=t.unstable_NormalPriority,Ss=t.unstable_LowPriority,ie=t.unstable_IdlePriority,xe=null,Le=null;function jt(a){if(Le&&typeof Le.onCommitFiberRoot=="function")try{Le.onCommitFiberRoot(xe,a,void 0,(a.current.flags&128)===128)}catch{}}var Ce=Math.clz32?Math.clz32:Rt,ot=Math.log,lt=Math.LN2;function Rt(a){return a>>>=0,a===0?32:31-(ot(a)/lt|0)|0}var kt=64,Ut=4194304;function At(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function sn(a,c){var g=a.pendingLanes;if(g===0)return 0;var S=0,O=a.suspendedLanes,L=a.pingedLanes,K=g&268435455;if(K!==0){var se=K&~O;se!==0?S=At(se):(L&=K,L!==0&&(S=At(L)))}else K=g&~O,K!==0?S=At(K):L!==0&&(S=At(L));if(S===0)return 0;if(c!==0&&c!==S&&!(c&O)&&(O=S&-S,L=c&-c,O>=L||O===16&&(L&4194240)!==0))return c;if(S&4&&(S|=g&16),c=a.entangledLanes,c!==0)for(a=a.entanglements,c&=S;0<c;)g=31-Ce(c),O=1<<g,S|=a[g],c&=~O;return S}function ls(a,c){switch(a){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cn(a,c){for(var g=a.suspendedLanes,S=a.pingedLanes,O=a.expirationTimes,L=a.pendingLanes;0<L;){var K=31-Ce(L),se=1<<K,ae=O[K];ae===-1?(!(se&g)||se&S)&&(O[K]=ls(se,c)):ae<=c&&(a.expiredLanes|=se),L&=~se}}function en(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function rn(){var a=kt;return kt<<=1,!(kt&4194240)&&(kt=64),a}function Bn(a){for(var c=[],g=0;31>g;g++)c.push(a);return c}function Sn(a,c,g){a.pendingLanes|=c,c!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,c=31-Ce(c),a[c]=g}function aa(a,c){var g=a.pendingLanes&~c;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=c,a.mutableReadLanes&=c,a.entangledLanes&=c,c=a.entanglements;var S=a.eventTimes;for(a=a.expirationTimes;0<g;){var O=31-Ce(g),L=1<<O;c[O]=0,S[O]=-1,a[O]=-1,g&=~L}}function Ba(a,c){var g=a.entangledLanes|=c;for(a=a.entanglements;g;){var S=31-Ce(g),O=1<<S;O&c|a[S]&c&&(a[S]|=c),g&=~O}}var vt=0;function hl(a){return a&=-a,1<a?4<a?a&268435455?16:536870912:4:1}var ti,Ua,pl,Ha,qa,Va=!1,oa=[],Xs=null,te=null,_e=null,me=new Map,Ae=new Map,Me=[],we="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function it(a,c){switch(a){case"focusin":case"focusout":Xs=null;break;case"dragenter":case"dragleave":te=null;break;case"mouseover":case"mouseout":_e=null;break;case"pointerover":case"pointerout":me.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ae.delete(c.pointerId)}}function He(a,c,g,S,O,L){return a===null||a.nativeEvent!==L?(a={blockedOn:c,domEventName:g,eventSystemFlags:S,nativeEvent:L,targetContainers:[O]},c!==null&&(c=mi(c),c!==null&&Ua(c)),a):(a.eventSystemFlags|=S,c=a.targetContainers,O!==null&&c.indexOf(O)===-1&&c.push(O),a)}function ht(a,c,g,S,O){switch(c){case"focusin":return Xs=He(Xs,a,c,g,S,O),!0;case"dragenter":return te=He(te,a,c,g,S,O),!0;case"mouseover":return _e=He(_e,a,c,g,S,O),!0;case"pointerover":var L=O.pointerId;return me.set(L,He(me.get(L)||null,a,c,g,S,O)),!0;case"gotpointercapture":return L=O.pointerId,Ae.set(L,He(Ae.get(L)||null,a,c,g,S,O)),!0}return!1}function ct(a){var c=da(a.target);if(c!==null){var g=fn(c);if(g!==null){if(c=g.tag,c===13){if(c=ws(g),c!==null){a.blockedOn=c,qa(a.priority,function(){pl(g)});return}}else if(c===3&&g.stateNode.current.memoizedState.isDehydrated){a.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}a.blockedOn=null}function tt(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var g=Ms(a.domEventName,a.eventSystemFlags,c[0],a.nativeEvent);if(g===null){g=a.nativeEvent;var S=new g.constructor(g.type,g);Mt=S,g.target.dispatchEvent(S),Mt=null}else return c=mi(g),c!==null&&Ua(c),a.blockedOn=g,!1;c.shift()}return!0}function Ct(a,c,g){tt(a)&&g.delete(c)}function Un(){Va=!1,Xs!==null&&tt(Xs)&&(Xs=null),te!==null&&tt(te)&&(te=null),_e!==null&&tt(_e)&&(_e=null),me.forEach(Ct),Ae.forEach(Ct)}function Wt(a,c){a.blockedOn===c&&(a.blockedOn=null,Va||(Va=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Un)))}function Rn(a){function c(O){return Wt(O,a)}if(0<oa.length){Wt(oa[0],a);for(var g=1;g<oa.length;g++){var S=oa[g];S.blockedOn===a&&(S.blockedOn=null)}}for(Xs!==null&&Wt(Xs,a),te!==null&&Wt(te,a),_e!==null&&Wt(_e,a),me.forEach(c),Ae.forEach(c),g=0;g<Me.length;g++)S=Me[g],S.blockedOn===a&&(S.blockedOn=null);for(;0<Me.length&&(g=Me[0],g.blockedOn===null);)ct(g),g.blockedOn===null&&Me.shift()}var Ds=C.ReactCurrentBatchConfig,Es=!0;function Qs(a,c,g,S){var O=vt,L=Ds.transition;Ds.transition=null;try{vt=1,or(a,c,g,S)}finally{vt=O,Ds.transition=L}}function Nr(a,c,g,S){var O=vt,L=Ds.transition;Ds.transition=null;try{vt=4,or(a,c,g,S)}finally{vt=O,Ds.transition=L}}function or(a,c,g,S){if(Es){var O=Ms(a,c,g,S);if(O===null)Am(a,c,S,cs,g),it(a,S);else if(ht(O,a,c,g,S))S.stopPropagation();else if(it(a,S),c&4&&-1<we.indexOf(a)){for(;O!==null;){var L=mi(O);if(L!==null&&ti(L),L=Ms(a,c,g,S),L===null&&Am(a,c,S,cs,g),L===O)break;O=L}O!==null&&S.stopPropagation()}else Am(a,c,S,null,g)}}var cs=null;function Ms(a,c,g,S){if(cs=null,a=Zt(S),a=da(a),a!==null)if(c=fn(a),c===null)a=null;else if(g=c.tag,g===13){if(a=ws(c),a!==null)return a;a=null}else if(g===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null);return cs=a,null}function Wa(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ue()){case Ln:return 1;case Cs:return 4;case Jn:case Ss:return 16;case ie:return 536870912;default:return 16}default:return 16}}var zs=null,Ya=null,ia=null;function Ka(){if(ia)return ia;var a,c=Ya,g=c.length,S,O="value"in zs?zs.value:zs.textContent,L=O.length;for(a=0;a<g&&c[a]===O[a];a++);var K=g-a;for(S=1;S<=K&&c[g-S]===O[L-S];S++);return ia=O.slice(a,1<S?1-S:void 0)}function Ga(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Xa(){return!0}function Qa(){return!1}function En(a){function c(g,S,O,L,K){this._reactName=g,this._targetInst=O,this.type=S,this.nativeEvent=L,this.target=K,this.currentTarget=null;for(var se in a)a.hasOwnProperty(se)&&(g=a[se],this[se]=g?g(L):L[se]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Xa:Qa,this.isPropagationStopped=Qa,this}return B(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=Xa)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=Xa)},persist:function(){},isPersistent:Xa}),c}var an={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Za=En(an),la=B({},an,{view:0,detail:0}),Uc=En(la),Ja,on,Dn,es=B({},la,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hc,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Dn&&(Dn&&a.type==="mousemove"?(Ja=a.screenX-Dn.screenX,on=a.screenY-Dn.screenY):on=Ja=0,Dn=a),Ja)},movementY:function(a){return"movementY"in a?a.movementY:on}}),gl=En(es),Gp=B({},es,{dataTransfer:0}),Xp=En(Gp),Qp=B({},la,{relatedTarget:0}),ca=En(Qp),ni=B({},an,{animationName:0,elapsedTime:0,pseudoElement:0}),eo=En(ni),si=B({},an,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),ri=En(si),ai=B({},an,{data:0}),em=En(ai),Zp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eg(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=tm[a])?!!c[a]:!1}function Hc(){return eg}var nm=B({},la,{key:function(a){if(a.key){var c=Zp[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Ga(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Jp[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hc,charCode:function(a){return a.type==="keypress"?Ga(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Ga(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),sm=En(nm),tg=B({},es,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rm=En(tg),am=B({},la,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hc}),om=En(am),to=B({},an,{propertyName:0,elapsedTime:0,pseudoElement:0}),im=En(to),ng=B({},es,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),lm=En(ng),cm=[9,13,27,32],qc=u&&"CompositionEvent"in window,no=null;u&&"documentMode"in document&&(no=document.documentMode);var um=u&&"TextEvent"in window&&!no,dm=u&&(!qc||no&&8<no&&11>=no),Vc=" ",sg=!1;function mm(a,c){switch(a){case"keyup":return cm.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fm(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var so=!1;function ua(a,c){switch(a){case"compositionend":return fm(c);case"keypress":return c.which!==32?null:(sg=!0,Vc);case"textInput":return a=c.data,a===Vc&&sg?null:a;default:return null}}function Wc(a,c){if(so)return a==="compositionend"||!qc&&mm(a,c)?(a=Ka(),ia=Ya=zs=null,so=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return dm&&c.locale!=="ko"?null:c.data;default:return null}}var Yc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ro(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!Yc[a.type]:c==="textarea"}function oi(a,c,g,S){Xt(S),c=Nl(c,"onChange"),0<c.length&&(g=new Za("onChange","change",null,g,S),a.push({event:g,listeners:c}))}var ir=null,Zs=null;function rg(a){Mm(a,0)}function ln(a){var c=co(a);if(ye(c))return a}function hn(a,c){if(a==="change")return c}var Ot=!1;if(u){var Is;if(u){var _l="oninput"in document;if(!_l){var pn=document.createElement("div");pn.setAttribute("oninput","return;"),_l=typeof pn.oninput=="function"}Is=_l}else Is=!1;Ot=Is&&(!document.documentMode||9<document.documentMode)}function hm(){ir&&(ir.detachEvent("onpropertychange",pm),Zs=ir=null)}function pm(a){if(a.propertyName==="value"&&ln(Zs)){var c=[];oi(c,Zs,a,Zt(a)),pt(rg,c)}}function ag(a,c,g){a==="focusin"?(hm(),ir=c,Zs=g,ir.attachEvent("onpropertychange",pm)):a==="focusout"&&hm()}function og(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return ln(Zs)}function ig(a,c){if(a==="click")return ln(c)}function lg(a,c){if(a==="input"||a==="change")return ln(c)}function cg(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Js=typeof Object.is=="function"?Object.is:cg;function ii(a,c){if(Js(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var g=Object.keys(a),S=Object.keys(c);if(g.length!==S.length)return!1;for(S=0;S<g.length;S++){var O=g[S];if(!d.call(c,O)||!Js(a[O],c[O]))return!1}return!0}function gm(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function _m(a,c){var g=gm(a);a=0;for(var S;g;){if(g.nodeType===3){if(S=a+g.textContent.length,a<=c&&S>=c)return{node:g,offset:c-a};a=S}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=gm(g)}}function ym(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?ym(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function vm(){for(var a=window,c=ge();c instanceof a.HTMLIFrameElement;){try{var g=typeof c.contentWindow.location.href=="string"}catch{g=!1}if(g)a=c.contentWindow;else break;c=ge(a.document)}return c}function Kc(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}function ug(a){var c=vm(),g=a.focusedElem,S=a.selectionRange;if(c!==g&&g&&g.ownerDocument&&ym(g.ownerDocument.documentElement,g)){if(S!==null&&Kc(g)){if(c=S.start,a=S.end,a===void 0&&(a=c),"selectionStart"in g)g.selectionStart=c,g.selectionEnd=Math.min(a,g.value.length);else if(a=(c=g.ownerDocument||document)&&c.defaultView||window,a.getSelection){a=a.getSelection();var O=g.textContent.length,L=Math.min(S.start,O);S=S.end===void 0?L:Math.min(S.end,O),!a.extend&&L>S&&(O=S,S=L,L=O),O=_m(g,L);var K=_m(g,S);O&&K&&(a.rangeCount!==1||a.anchorNode!==O.node||a.anchorOffset!==O.offset||a.focusNode!==K.node||a.focusOffset!==K.offset)&&(c=c.createRange(),c.setStart(O.node,O.offset),a.removeAllRanges(),L>S?(a.addRange(c),a.extend(K.node,K.offset)):(c.setEnd(K.node,K.offset),a.addRange(c)))}}for(c=[],a=g;a=a.parentNode;)a.nodeType===1&&c.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<c.length;g++)a=c[g],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var dg=u&&"documentMode"in document&&11>=document.documentMode,ao=null,xm=null,yl=null,jr=!1;function bm(a,c,g){var S=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;jr||ao==null||ao!==ge(S)||(S=ao,"selectionStart"in S&&Kc(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),yl&&ii(yl,S)||(yl=S,S=Nl(xm,"onSelect"),0<S.length&&(c=new Za("onSelect","select",null,c,g),a.push({event:c,listeners:S}),c.target=ao)))}function vl(a,c){var g={};return g[a.toLowerCase()]=c.toLowerCase(),g["Webkit"+a]="webkit"+c,g["Moz"+a]="moz"+c,g}var oo={animationend:vl("Animation","AnimationEnd"),animationiteration:vl("Animation","AnimationIteration"),animationstart:vl("Animation","AnimationStart"),transitionend:vl("Transition","TransitionEnd")},Gc={},xl={};u&&(xl=document.createElement("div").style,"AnimationEvent"in window||(delete oo.animationend.animation,delete oo.animationiteration.animation,delete oo.animationstart.animation),"TransitionEvent"in window||delete oo.transitionend.transition);function li(a){if(Gc[a])return Gc[a];if(!oo[a])return a;var c=oo[a],g;for(g in c)if(c.hasOwnProperty(g)&&g in xl)return Gc[a]=c[g];return a}var wm=li("animationend"),Nm=li("animationiteration"),Xc=li("animationstart"),jm=li("transitionend"),Cm=new Map,Sm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fr(a,c){Cm.set(a,c),i(c,[a])}for(var Qc=0;Qc<Sm.length;Qc++){var Zc=Sm[Qc],mg=Zc.toLowerCase(),fg=Zc[0].toUpperCase()+Zc.slice(1);Fr(mg,"on"+fg)}Fr(wm,"onAnimationEnd"),Fr(Nm,"onAnimationIteration"),Fr(Xc,"onAnimationStart"),Fr("dblclick","onDoubleClick"),Fr("focusin","onFocus"),Fr("focusout","onBlur"),Fr(jm,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ci="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),hg=new Set("cancel close invalid load scroll toggle".split(" ").concat(ci));function Em(a,c,g){var S=a.type||"unknown-event";a.currentTarget=g,xn(S,c,void 0,a),a.currentTarget=null}function Mm(a,c){c=(c&4)!==0;for(var g=0;g<a.length;g++){var S=a[g],O=S.event;S=S.listeners;e:{var L=void 0;if(c)for(var K=S.length-1;0<=K;K--){var se=S[K],ae=se.instance,fe=se.currentTarget;if(se=se.listener,ae!==L&&O.isPropagationStopped())break e;Em(O,se,fe),L=ae}else for(K=0;K<S.length;K++){if(se=S[K],ae=se.instance,fe=se.currentTarget,se=se.listener,ae!==L&&O.isPropagationStopped())break e;Em(O,se,fe),L=ae}}}if(Jt)throw a=Xn,Jt=!1,Xn=null,a}function Gt(a,c){var g=c[Lm];g===void 0&&(g=c[Lm]=new Set);var S=a+"__bubble";g.has(S)||(km(c,a,2,!1),g.add(S))}function Jc(a,c,g){var S=0;c&&(S|=4),km(g,a,S,c)}var bl="_reactListening"+Math.random().toString(36).slice(2);function wl(a){if(!a[bl]){a[bl]=!0,s.forEach(function(g){g!=="selectionchange"&&(hg.has(g)||Jc(g,!1,a),Jc(g,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[bl]||(c[bl]=!0,Jc("selectionchange",!1,c))}}function km(a,c,g,S){switch(Wa(c)){case 1:var O=Qs;break;case 4:O=Nr;break;default:O=or}g=O.bind(null,c,g,a),O=void 0,!Gn||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(O=!0),S?O!==void 0?a.addEventListener(c,g,{capture:!0,passive:O}):a.addEventListener(c,g,!0):O!==void 0?a.addEventListener(c,g,{passive:O}):a.addEventListener(c,g,!1)}function Am(a,c,g,S,O){var L=S;if(!(c&1)&&!(c&2)&&S!==null)e:for(;;){if(S===null)return;var K=S.tag;if(K===3||K===4){var se=S.stateNode.containerInfo;if(se===O||se.nodeType===8&&se.parentNode===O)break;if(K===4)for(K=S.return;K!==null;){var ae=K.tag;if((ae===3||ae===4)&&(ae=K.stateNode.containerInfo,ae===O||ae.nodeType===8&&ae.parentNode===O))return;K=K.return}for(;se!==null;){if(K=da(se),K===null)return;if(ae=K.tag,ae===5||ae===6){S=L=K;continue e}se=se.parentNode}}S=S.return}pt(function(){var fe=L,je=Zt(g),Se=[];e:{var Ne=Cm.get(a);if(Ne!==void 0){var ze=Za,Be=a;switch(a){case"keypress":if(Ga(g)===0)break e;case"keydown":case"keyup":ze=sm;break;case"focusin":Be="focus",ze=ca;break;case"focusout":Be="blur",ze=ca;break;case"beforeblur":case"afterblur":ze=ca;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ze=gl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ze=Xp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ze=om;break;case wm:case Nm:case Xc:ze=eo;break;case jm:ze=im;break;case"scroll":ze=Uc;break;case"wheel":ze=lm;break;case"copy":case"cut":case"paste":ze=ri;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ze=rm}var qe=(c&4)!==0,Mn=!qe&&a==="scroll",ce=qe?Ne!==null?Ne+"Capture":null:Ne;qe=[];for(var oe=fe,de;oe!==null;){de=oe;var Oe=de.stateNode;if(de.tag===5&&Oe!==null&&(de=Oe,ce!==null&&(Oe=yt(oe,ce),Oe!=null&&qe.push(ui(oe,Oe,de)))),Mn)break;oe=oe.return}0<qe.length&&(Ne=new ze(Ne,Be,null,g,je),Se.push({event:Ne,listeners:qe}))}}if(!(c&7)){e:{if(Ne=a==="mouseover"||a==="pointerover",ze=a==="mouseout"||a==="pointerout",Ne&&g!==Mt&&(Be=g.relatedTarget||g.fromElement)&&(da(Be)||Be[Cr]))break e;if((ze||Ne)&&(Ne=je.window===je?je:(Ne=je.ownerDocument)?Ne.defaultView||Ne.parentWindow:window,ze?(Be=g.relatedTarget||g.toElement,ze=fe,Be=Be?da(Be):null,Be!==null&&(Mn=fn(Be),Be!==Mn||Be.tag!==5&&Be.tag!==6)&&(Be=null)):(ze=null,Be=fe),ze!==Be)){if(qe=gl,Oe="onMouseLeave",ce="onMouseEnter",oe="mouse",(a==="pointerout"||a==="pointerover")&&(qe=rm,Oe="onPointerLeave",ce="onPointerEnter",oe="pointer"),Mn=ze==null?Ne:co(ze),de=Be==null?Ne:co(Be),Ne=new qe(Oe,oe+"leave",ze,g,je),Ne.target=Mn,Ne.relatedTarget=de,Oe=null,da(je)===fe&&(qe=new qe(ce,oe+"enter",Be,g,je),qe.target=de,qe.relatedTarget=Mn,Oe=qe),Mn=Oe,ze&&Be)t:{for(qe=ze,ce=Be,oe=0,de=qe;de;de=io(de))oe++;for(de=0,Oe=ce;Oe;Oe=io(Oe))de++;for(;0<oe-de;)qe=io(qe),oe--;for(;0<de-oe;)ce=io(ce),de--;for(;oe--;){if(qe===ce||ce!==null&&qe===ce.alternate)break t;qe=io(qe),ce=io(ce)}qe=null}else qe=null;ze!==null&&Om(Se,Ne,ze,qe,!1),Be!==null&&Mn!==null&&Om(Se,Mn,Be,qe,!0)}}e:{if(Ne=fe?co(fe):window,ze=Ne.nodeName&&Ne.nodeName.toLowerCase(),ze==="select"||ze==="input"&&Ne.type==="file")var Ve=hn;else if(ro(Ne))if(Ot)Ve=lg;else{Ve=og;var nt=ag}else(ze=Ne.nodeName)&&ze.toLowerCase()==="input"&&(Ne.type==="checkbox"||Ne.type==="radio")&&(Ve=ig);if(Ve&&(Ve=Ve(a,fe))){oi(Se,Ve,g,je);break e}nt&&nt(a,Ne,fe),a==="focusout"&&(nt=Ne._wrapperState)&&nt.controlled&&Ne.type==="number"&&be(Ne,"number",Ne.value)}switch(nt=fe?co(fe):window,a){case"focusin":(ro(nt)||nt.contentEditable==="true")&&(ao=nt,xm=fe,yl=null);break;case"focusout":yl=xm=ao=null;break;case"mousedown":jr=!0;break;case"contextmenu":case"mouseup":case"dragend":jr=!1,bm(Se,g,je);break;case"selectionchange":if(dg)break;case"keydown":case"keyup":bm(Se,g,je)}var st;if(qc)e:{switch(a){case"compositionstart":var ut="onCompositionStart";break e;case"compositionend":ut="onCompositionEnd";break e;case"compositionupdate":ut="onCompositionUpdate";break e}ut=void 0}else so?mm(a,g)&&(ut="onCompositionEnd"):a==="keydown"&&g.keyCode===229&&(ut="onCompositionStart");ut&&(dm&&g.locale!=="ko"&&(so||ut!=="onCompositionStart"?ut==="onCompositionEnd"&&so&&(st=Ka()):(zs=je,Ya="value"in zs?zs.value:zs.textContent,so=!0)),nt=Nl(fe,ut),0<nt.length&&(ut=new em(ut,a,null,g,je),Se.push({event:ut,listeners:nt}),st?ut.data=st:(st=fm(g),st!==null&&(ut.data=st)))),(st=um?ua(a,g):Wc(a,g))&&(fe=Nl(fe,"onBeforeInput"),0<fe.length&&(je=new em("onBeforeInput","beforeinput",null,g,je),Se.push({event:je,listeners:fe}),je.data=st))}Mm(Se,c)})}function ui(a,c,g){return{instance:a,listener:c,currentTarget:g}}function Nl(a,c){for(var g=c+"Capture",S=[];a!==null;){var O=a,L=O.stateNode;O.tag===5&&L!==null&&(O=L,L=yt(a,g),L!=null&&S.unshift(ui(a,L,O)),L=yt(a,c),L!=null&&S.push(ui(a,L,O))),a=a.return}return S}function io(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Om(a,c,g,S,O){for(var L=c._reactName,K=[];g!==null&&g!==S;){var se=g,ae=se.alternate,fe=se.stateNode;if(ae!==null&&ae===S)break;se.tag===5&&fe!==null&&(se=fe,O?(ae=yt(g,L),ae!=null&&K.unshift(ui(g,ae,se))):O||(ae=yt(g,L),ae!=null&&K.push(ui(g,ae,se)))),g=g.return}K.length!==0&&a.push({event:c,listeners:K})}var pg=/\r\n?/g,gg=/\u0000|\uFFFD/g;function Tm(a){return(typeof a=="string"?a:""+a).replace(pg,`
`).replace(gg,"")}function jl(a,c,g){if(c=Tm(c),Tm(a)!==c&&g)throw Error(n(425))}function eu(){}var tu=null,nu=null;function su(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var ru=typeof setTimeout=="function"?setTimeout:void 0,_g=typeof clearTimeout=="function"?clearTimeout:void 0,$m=typeof Promise=="function"?Promise:void 0,yg=typeof queueMicrotask=="function"?queueMicrotask:typeof $m<"u"?function(a){return $m.resolve(null).then(a).catch(Gj)}:ru;function Gj(a){setTimeout(function(){throw a})}function au(a,c){var g=c,S=0;do{var O=g.nextSibling;if(a.removeChild(g),O&&O.nodeType===8)if(g=O.data,g==="/$"){if(S===0){a.removeChild(O),Rn(c);return}S--}else g!=="$"&&g!=="$?"&&g!=="$!"||S++;g=O}while(g);Rn(c)}function Br(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return a}function Pm(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var g=a.data;if(g==="$"||g==="$!"||g==="$?"){if(c===0)return a;c--}else g==="/$"&&c++}a=a.previousSibling}return null}var lo=Math.random().toString(36).slice(2),lr="__reactFiber$"+lo,di="__reactProps$"+lo,Cr="__reactContainer$"+lo,Lm="__reactEvents$"+lo,vg="__reactListeners$"+lo,xg="__reactHandles$"+lo;function da(a){var c=a[lr];if(c)return c;for(var g=a.parentNode;g;){if(c=g[Cr]||g[lr]){if(g=c.alternate,c.child!==null||g!==null&&g.child!==null)for(a=Pm(a);a!==null;){if(g=a[lr])return g;a=Pm(a)}return c}a=g,g=a.parentNode}return null}function mi(a){return a=a[lr]||a[Cr],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function co(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(n(33))}function Cl(a){return a[di]||null}var ou=[],uo=-1;function hs(a){return{current:a}}function Ze(a){0>uo||(a.current=ou[uo],ou[uo]=null,uo--)}function qt(a,c){uo++,ou[uo]=a.current,a.current=c}var Sr={},Hn=hs(Sr),qn=hs(!1),fi=Sr;function Sl(a,c){var g=a.type.contextTypes;if(!g)return Sr;var S=a.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===c)return S.__reactInternalMemoizedMaskedChildContext;var O={},L;for(L in g)O[L]=c[L];return S&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=c,a.__reactInternalMemoizedMaskedChildContext=O),O}function Fs(a){return a=a.childContextTypes,a!=null}function Rm(){Ze(qn),Ze(Hn)}function Xj(a,c,g){if(Hn.current!==Sr)throw Error(n(168));qt(Hn,c),qt(qn,g)}function Qj(a,c,g){var S=a.stateNode;if(c=c.childContextTypes,typeof S.getChildContext!="function")return g;S=S.getChildContext();for(var O in S)if(!(O in c))throw Error(n(108,Z(a)||"Unknown",O));return B({},g,S)}function Dm(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Sr,fi=Hn.current,qt(Hn,a),qt(qn,qn.current),!0}function Zj(a,c,g){var S=a.stateNode;if(!S)throw Error(n(169));g?(a=Qj(a,c,fi),S.__reactInternalMemoizedMergedChildContext=a,Ze(qn),Ze(Hn),qt(Hn,a)):Ze(qn),qt(qn,g)}var ma=null,zm=!1,bg=!1;function Jj(a){ma===null?ma=[a]:ma.push(a)}function v4(a){zm=!0,Jj(a)}function mo(){if(!bg&&ma!==null){bg=!0;var a=0,c=vt;try{var g=ma;for(vt=1;a<g.length;a++){var S=g[a];do S=S(!0);while(S!==null)}ma=null,zm=!1}catch(O){throw ma!==null&&(ma=ma.slice(a+1)),js(Ln,mo),O}finally{vt=c,bg=!1}}return null}var El=[],Ml=0,Im=null,Fm=0,cr=[],ur=0,hi=null,fa=1,ha="";function pi(a,c){El[Ml++]=Fm,El[Ml++]=Im,Im=a,Fm=c}function eC(a,c,g){cr[ur++]=fa,cr[ur++]=ha,cr[ur++]=hi,hi=a;var S=fa;a=ha;var O=32-Ce(S)-1;S&=~(1<<O),g+=1;var L=32-Ce(c)+O;if(30<L){var K=O-O%5;L=(S&(1<<K)-1).toString(32),S>>=K,O-=K,fa=1<<32-Ce(c)+O|g<<O|S,ha=L+a}else fa=1<<L|g<<O|S,ha=a}function wg(a){a.return!==null&&(pi(a,1),eC(a,1,0))}function Ng(a){for(;a===Im;)Im=El[--Ml],El[Ml]=null,Fm=El[--Ml],El[Ml]=null;for(;a===hi;)hi=cr[--ur],cr[ur]=null,ha=cr[--ur],cr[ur]=null,fa=cr[--ur],cr[ur]=null}var er=null,tr=null,cn=!1,Er=null;function tC(a,c){var g=hr(5,null,null,0);g.elementType="DELETED",g.stateNode=c,g.return=a,c=a.deletions,c===null?(a.deletions=[g],a.flags|=16):c.push(g)}function nC(a,c){switch(a.tag){case 5:var g=a.type;return c=c.nodeType!==1||g.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(a.stateNode=c,er=a,tr=Br(c.firstChild),!0):!1;case 6:return c=a.pendingProps===""||c.nodeType!==3?null:c,c!==null?(a.stateNode=c,er=a,tr=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(g=hi!==null?{id:fa,overflow:ha}:null,a.memoizedState={dehydrated:c,treeContext:g,retryLane:1073741824},g=hr(18,null,null,0),g.stateNode=c,g.return=a,a.child=g,er=a,tr=null,!0):!1;default:return!1}}function jg(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Cg(a){if(cn){var c=tr;if(c){var g=c;if(!nC(a,c)){if(jg(a))throw Error(n(418));c=Br(g.nextSibling);var S=er;c&&nC(a,c)?tC(S,g):(a.flags=a.flags&-4097|2,cn=!1,er=a)}}else{if(jg(a))throw Error(n(418));a.flags=a.flags&-4097|2,cn=!1,er=a}}}function sC(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;er=a}function Bm(a){if(a!==er)return!1;if(!cn)return sC(a),cn=!0,!1;var c;if((c=a.tag!==3)&&!(c=a.tag!==5)&&(c=a.type,c=c!=="head"&&c!=="body"&&!su(a.type,a.memoizedProps)),c&&(c=tr)){if(jg(a))throw rC(),Error(n(418));for(;c;)tC(a,c),c=Br(c.nextSibling)}if(sC(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8){var g=a.data;if(g==="/$"){if(c===0){tr=Br(a.nextSibling);break e}c--}else g!=="$"&&g!=="$!"&&g!=="$?"||c++}a=a.nextSibling}tr=null}}else tr=er?Br(a.stateNode.nextSibling):null;return!0}function rC(){for(var a=tr;a;)a=Br(a.nextSibling)}function kl(){tr=er=null,cn=!1}function Sg(a){Er===null?Er=[a]:Er.push(a)}var x4=C.ReactCurrentBatchConfig;function iu(a,c,g){if(a=g.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(n(309));var S=g.stateNode}if(!S)throw Error(n(147,a));var O=S,L=""+a;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===L?c.ref:(c=function(K){var se=O.refs;K===null?delete se[L]:se[L]=K},c._stringRef=L,c)}if(typeof a!="string")throw Error(n(284));if(!g._owner)throw Error(n(290,a))}return a}function Um(a,c){throw a=Object.prototype.toString.call(c),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a))}function aC(a){var c=a._init;return c(a._payload)}function oC(a){function c(ce,oe){if(a){var de=ce.deletions;de===null?(ce.deletions=[oe],ce.flags|=16):de.push(oe)}}function g(ce,oe){if(!a)return null;for(;oe!==null;)c(ce,oe),oe=oe.sibling;return null}function S(ce,oe){for(ce=new Map;oe!==null;)oe.key!==null?ce.set(oe.key,oe):ce.set(oe.index,oe),oe=oe.sibling;return ce}function O(ce,oe){return ce=xo(ce,oe),ce.index=0,ce.sibling=null,ce}function L(ce,oe,de){return ce.index=de,a?(de=ce.alternate,de!==null?(de=de.index,de<oe?(ce.flags|=2,oe):de):(ce.flags|=2,oe)):(ce.flags|=1048576,oe)}function K(ce){return a&&ce.alternate===null&&(ce.flags|=2),ce}function se(ce,oe,de,Oe){return oe===null||oe.tag!==6?(oe=__(de,ce.mode,Oe),oe.return=ce,oe):(oe=O(oe,de),oe.return=ce,oe)}function ae(ce,oe,de,Oe){var Ve=de.type;return Ve===k?je(ce,oe,de.props.children,Oe,de.key):oe!==null&&(oe.elementType===Ve||typeof Ve=="object"&&Ve!==null&&Ve.$$typeof===q&&aC(Ve)===oe.type)?(Oe=O(oe,de.props),Oe.ref=iu(ce,oe,de),Oe.return=ce,Oe):(Oe=ff(de.type,de.key,de.props,null,ce.mode,Oe),Oe.ref=iu(ce,oe,de),Oe.return=ce,Oe)}function fe(ce,oe,de,Oe){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==de.containerInfo||oe.stateNode.implementation!==de.implementation?(oe=y_(de,ce.mode,Oe),oe.return=ce,oe):(oe=O(oe,de.children||[]),oe.return=ce,oe)}function je(ce,oe,de,Oe,Ve){return oe===null||oe.tag!==7?(oe=Ni(de,ce.mode,Oe,Ve),oe.return=ce,oe):(oe=O(oe,de),oe.return=ce,oe)}function Se(ce,oe,de){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return oe=__(""+oe,ce.mode,de),oe.return=ce,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case j:return de=ff(oe.type,oe.key,oe.props,null,ce.mode,de),de.ref=iu(ce,null,oe),de.return=ce,de;case E:return oe=y_(oe,ce.mode,de),oe.return=ce,oe;case q:var Oe=oe._init;return Se(ce,Oe(oe._payload),de)}if(Te(oe)||W(oe))return oe=Ni(oe,ce.mode,de,null),oe.return=ce,oe;Um(ce,oe)}return null}function Ne(ce,oe,de,Oe){var Ve=oe!==null?oe.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return Ve!==null?null:se(ce,oe,""+de,Oe);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case j:return de.key===Ve?ae(ce,oe,de,Oe):null;case E:return de.key===Ve?fe(ce,oe,de,Oe):null;case q:return Ve=de._init,Ne(ce,oe,Ve(de._payload),Oe)}if(Te(de)||W(de))return Ve!==null?null:je(ce,oe,de,Oe,null);Um(ce,de)}return null}function ze(ce,oe,de,Oe,Ve){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return ce=ce.get(de)||null,se(oe,ce,""+Oe,Ve);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case j:return ce=ce.get(Oe.key===null?de:Oe.key)||null,ae(oe,ce,Oe,Ve);case E:return ce=ce.get(Oe.key===null?de:Oe.key)||null,fe(oe,ce,Oe,Ve);case q:var nt=Oe._init;return ze(ce,oe,de,nt(Oe._payload),Ve)}if(Te(Oe)||W(Oe))return ce=ce.get(de)||null,je(oe,ce,Oe,Ve,null);Um(oe,Oe)}return null}function Be(ce,oe,de,Oe){for(var Ve=null,nt=null,st=oe,ut=oe=0,ss=null;st!==null&&ut<de.length;ut++){st.index>ut?(ss=st,st=null):ss=st.sibling;var Dt=Ne(ce,st,de[ut],Oe);if(Dt===null){st===null&&(st=ss);break}a&&st&&Dt.alternate===null&&c(ce,st),oe=L(Dt,oe,ut),nt===null?Ve=Dt:nt.sibling=Dt,nt=Dt,st=ss}if(ut===de.length)return g(ce,st),cn&&pi(ce,ut),Ve;if(st===null){for(;ut<de.length;ut++)st=Se(ce,de[ut],Oe),st!==null&&(oe=L(st,oe,ut),nt===null?Ve=st:nt.sibling=st,nt=st);return cn&&pi(ce,ut),Ve}for(st=S(ce,st);ut<de.length;ut++)ss=ze(st,ce,ut,de[ut],Oe),ss!==null&&(a&&ss.alternate!==null&&st.delete(ss.key===null?ut:ss.key),oe=L(ss,oe,ut),nt===null?Ve=ss:nt.sibling=ss,nt=ss);return a&&st.forEach(function(bo){return c(ce,bo)}),cn&&pi(ce,ut),Ve}function qe(ce,oe,de,Oe){var Ve=W(de);if(typeof Ve!="function")throw Error(n(150));if(de=Ve.call(de),de==null)throw Error(n(151));for(var nt=Ve=null,st=oe,ut=oe=0,ss=null,Dt=de.next();st!==null&&!Dt.done;ut++,Dt=de.next()){st.index>ut?(ss=st,st=null):ss=st.sibling;var bo=Ne(ce,st,Dt.value,Oe);if(bo===null){st===null&&(st=ss);break}a&&st&&bo.alternate===null&&c(ce,st),oe=L(bo,oe,ut),nt===null?Ve=bo:nt.sibling=bo,nt=bo,st=ss}if(Dt.done)return g(ce,st),cn&&pi(ce,ut),Ve;if(st===null){for(;!Dt.done;ut++,Dt=de.next())Dt=Se(ce,Dt.value,Oe),Dt!==null&&(oe=L(Dt,oe,ut),nt===null?Ve=Dt:nt.sibling=Dt,nt=Dt);return cn&&pi(ce,ut),Ve}for(st=S(ce,st);!Dt.done;ut++,Dt=de.next())Dt=ze(st,ce,ut,Dt.value,Oe),Dt!==null&&(a&&Dt.alternate!==null&&st.delete(Dt.key===null?ut:Dt.key),oe=L(Dt,oe,ut),nt===null?Ve=Dt:nt.sibling=Dt,nt=Dt);return a&&st.forEach(function(J4){return c(ce,J4)}),cn&&pi(ce,ut),Ve}function Mn(ce,oe,de,Oe){if(typeof de=="object"&&de!==null&&de.type===k&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case j:e:{for(var Ve=de.key,nt=oe;nt!==null;){if(nt.key===Ve){if(Ve=de.type,Ve===k){if(nt.tag===7){g(ce,nt.sibling),oe=O(nt,de.props.children),oe.return=ce,ce=oe;break e}}else if(nt.elementType===Ve||typeof Ve=="object"&&Ve!==null&&Ve.$$typeof===q&&aC(Ve)===nt.type){g(ce,nt.sibling),oe=O(nt,de.props),oe.ref=iu(ce,nt,de),oe.return=ce,ce=oe;break e}g(ce,nt);break}else c(ce,nt);nt=nt.sibling}de.type===k?(oe=Ni(de.props.children,ce.mode,Oe,de.key),oe.return=ce,ce=oe):(Oe=ff(de.type,de.key,de.props,null,ce.mode,Oe),Oe.ref=iu(ce,oe,de),Oe.return=ce,ce=Oe)}return K(ce);case E:e:{for(nt=de.key;oe!==null;){if(oe.key===nt)if(oe.tag===4&&oe.stateNode.containerInfo===de.containerInfo&&oe.stateNode.implementation===de.implementation){g(ce,oe.sibling),oe=O(oe,de.children||[]),oe.return=ce,ce=oe;break e}else{g(ce,oe);break}else c(ce,oe);oe=oe.sibling}oe=y_(de,ce.mode,Oe),oe.return=ce,ce=oe}return K(ce);case q:return nt=de._init,Mn(ce,oe,nt(de._payload),Oe)}if(Te(de))return Be(ce,oe,de,Oe);if(W(de))return qe(ce,oe,de,Oe);Um(ce,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,oe!==null&&oe.tag===6?(g(ce,oe.sibling),oe=O(oe,de),oe.return=ce,ce=oe):(g(ce,oe),oe=__(de,ce.mode,Oe),oe.return=ce,ce=oe),K(ce)):g(ce,oe)}return Mn}var Al=oC(!0),iC=oC(!1),Hm=hs(null),qm=null,Ol=null,Eg=null;function Mg(){Eg=Ol=qm=null}function kg(a){var c=Hm.current;Ze(Hm),a._currentValue=c}function Ag(a,c,g){for(;a!==null;){var S=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,S!==null&&(S.childLanes|=c)):S!==null&&(S.childLanes&c)!==c&&(S.childLanes|=c),a===g)break;a=a.return}}function Tl(a,c){qm=a,Eg=Ol=null,a=a.dependencies,a!==null&&a.firstContext!==null&&(a.lanes&c&&(Bs=!0),a.firstContext=null)}function dr(a){var c=a._currentValue;if(Eg!==a)if(a={context:a,memoizedValue:c,next:null},Ol===null){if(qm===null)throw Error(n(308));Ol=a,qm.dependencies={lanes:0,firstContext:a}}else Ol=Ol.next=a;return c}var gi=null;function Og(a){gi===null?gi=[a]:gi.push(a)}function lC(a,c,g,S){var O=c.interleaved;return O===null?(g.next=g,Og(c)):(g.next=O.next,O.next=g),c.interleaved=g,pa(a,S)}function pa(a,c){a.lanes|=c;var g=a.alternate;for(g!==null&&(g.lanes|=c),g=a,a=a.return;a!==null;)a.childLanes|=c,g=a.alternate,g!==null&&(g.childLanes|=c),g=a,a=a.return;return g.tag===3?g.stateNode:null}var fo=!1;function Tg(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cC(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function ga(a,c){return{eventTime:a,lane:c,tag:0,payload:null,callback:null,next:null}}function ho(a,c,g){var S=a.updateQueue;if(S===null)return null;if(S=S.shared,Pt&2){var O=S.pending;return O===null?c.next=c:(c.next=O.next,O.next=c),S.pending=c,pa(a,g)}return O=S.interleaved,O===null?(c.next=c,Og(S)):(c.next=O.next,O.next=c),S.interleaved=c,pa(a,g)}function Vm(a,c,g){if(c=c.updateQueue,c!==null&&(c=c.shared,(g&4194240)!==0)){var S=c.lanes;S&=a.pendingLanes,g|=S,c.lanes=g,Ba(a,g)}}function uC(a,c){var g=a.updateQueue,S=a.alternate;if(S!==null&&(S=S.updateQueue,g===S)){var O=null,L=null;if(g=g.firstBaseUpdate,g!==null){do{var K={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};L===null?O=L=K:L=L.next=K,g=g.next}while(g!==null);L===null?O=L=c:L=L.next=c}else O=L=c;g={baseState:S.baseState,firstBaseUpdate:O,lastBaseUpdate:L,shared:S.shared,effects:S.effects},a.updateQueue=g;return}a=g.lastBaseUpdate,a===null?g.firstBaseUpdate=c:a.next=c,g.lastBaseUpdate=c}function Wm(a,c,g,S){var O=a.updateQueue;fo=!1;var L=O.firstBaseUpdate,K=O.lastBaseUpdate,se=O.shared.pending;if(se!==null){O.shared.pending=null;var ae=se,fe=ae.next;ae.next=null,K===null?L=fe:K.next=fe,K=ae;var je=a.alternate;je!==null&&(je=je.updateQueue,se=je.lastBaseUpdate,se!==K&&(se===null?je.firstBaseUpdate=fe:se.next=fe,je.lastBaseUpdate=ae))}if(L!==null){var Se=O.baseState;K=0,je=fe=ae=null,se=L;do{var Ne=se.lane,ze=se.eventTime;if((S&Ne)===Ne){je!==null&&(je=je.next={eventTime:ze,lane:0,tag:se.tag,payload:se.payload,callback:se.callback,next:null});e:{var Be=a,qe=se;switch(Ne=c,ze=g,qe.tag){case 1:if(Be=qe.payload,typeof Be=="function"){Se=Be.call(ze,Se,Ne);break e}Se=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=qe.payload,Ne=typeof Be=="function"?Be.call(ze,Se,Ne):Be,Ne==null)break e;Se=B({},Se,Ne);break e;case 2:fo=!0}}se.callback!==null&&se.lane!==0&&(a.flags|=64,Ne=O.effects,Ne===null?O.effects=[se]:Ne.push(se))}else ze={eventTime:ze,lane:Ne,tag:se.tag,payload:se.payload,callback:se.callback,next:null},je===null?(fe=je=ze,ae=Se):je=je.next=ze,K|=Ne;if(se=se.next,se===null){if(se=O.shared.pending,se===null)break;Ne=se,se=Ne.next,Ne.next=null,O.lastBaseUpdate=Ne,O.shared.pending=null}}while(!0);if(je===null&&(ae=Se),O.baseState=ae,O.firstBaseUpdate=fe,O.lastBaseUpdate=je,c=O.shared.interleaved,c!==null){O=c;do K|=O.lane,O=O.next;while(O!==c)}else L===null&&(O.shared.lanes=0);vi|=K,a.lanes=K,a.memoizedState=Se}}function dC(a,c,g){if(a=c.effects,c.effects=null,a!==null)for(c=0;c<a.length;c++){var S=a[c],O=S.callback;if(O!==null){if(S.callback=null,S=g,typeof O!="function")throw Error(n(191,O));O.call(S)}}}var lu={},Ur=hs(lu),cu=hs(lu),uu=hs(lu);function _i(a){if(a===lu)throw Error(n(174));return a}function $g(a,c){switch(qt(uu,c),qt(cu,a),qt(Ur,lu),a=c.nodeType,a){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:mt(null,"");break;default:a=a===8?c.parentNode:c,c=a.namespaceURI||null,a=a.tagName,c=mt(c,a)}Ze(Ur),qt(Ur,c)}function $l(){Ze(Ur),Ze(cu),Ze(uu)}function mC(a){_i(uu.current);var c=_i(Ur.current),g=mt(c,a.type);c!==g&&(qt(cu,a),qt(Ur,g))}function Pg(a){cu.current===a&&(Ze(Ur),Ze(cu))}var gn=hs(0);function Ym(a){for(var c=a;c!==null;){if(c.tag===13){var g=c.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||g.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if(c.flags&128)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Lg=[];function Rg(){for(var a=0;a<Lg.length;a++)Lg[a]._workInProgressVersionPrimary=null;Lg.length=0}var Km=C.ReactCurrentDispatcher,Dg=C.ReactCurrentBatchConfig,yi=0,_n=null,Vn=null,ts=null,Gm=!1,du=!1,mu=0,b4=0;function ps(){throw Error(n(321))}function zg(a,c){if(c===null)return!1;for(var g=0;g<c.length&&g<a.length;g++)if(!Js(a[g],c[g]))return!1;return!0}function Ig(a,c,g,S,O,L){if(yi=L,_n=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,Km.current=a===null||a.memoizedState===null?C4:S4,a=g(S,O),du){L=0;do{if(du=!1,mu=0,25<=L)throw Error(n(301));L+=1,ts=Vn=null,c.updateQueue=null,Km.current=E4,a=g(S,O)}while(du)}if(Km.current=Zm,c=Vn!==null&&Vn.next!==null,yi=0,ts=Vn=_n=null,Gm=!1,c)throw Error(n(300));return a}function Fg(){var a=mu!==0;return mu=0,a}function Hr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ts===null?_n.memoizedState=ts=a:ts=ts.next=a,ts}function mr(){if(Vn===null){var a=_n.alternate;a=a!==null?a.memoizedState:null}else a=Vn.next;var c=ts===null?_n.memoizedState:ts.next;if(c!==null)ts=c,Vn=a;else{if(a===null)throw Error(n(310));Vn=a,a={memoizedState:Vn.memoizedState,baseState:Vn.baseState,baseQueue:Vn.baseQueue,queue:Vn.queue,next:null},ts===null?_n.memoizedState=ts=a:ts=ts.next=a}return ts}function fu(a,c){return typeof c=="function"?c(a):c}function Bg(a){var c=mr(),g=c.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=a;var S=Vn,O=S.baseQueue,L=g.pending;if(L!==null){if(O!==null){var K=O.next;O.next=L.next,L.next=K}S.baseQueue=O=L,g.pending=null}if(O!==null){L=O.next,S=S.baseState;var se=K=null,ae=null,fe=L;do{var je=fe.lane;if((yi&je)===je)ae!==null&&(ae=ae.next={lane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),S=fe.hasEagerState?fe.eagerState:a(S,fe.action);else{var Se={lane:je,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null};ae===null?(se=ae=Se,K=S):ae=ae.next=Se,_n.lanes|=je,vi|=je}fe=fe.next}while(fe!==null&&fe!==L);ae===null?K=S:ae.next=se,Js(S,c.memoizedState)||(Bs=!0),c.memoizedState=S,c.baseState=K,c.baseQueue=ae,g.lastRenderedState=S}if(a=g.interleaved,a!==null){O=a;do L=O.lane,_n.lanes|=L,vi|=L,O=O.next;while(O!==a)}else O===null&&(g.lanes=0);return[c.memoizedState,g.dispatch]}function Ug(a){var c=mr(),g=c.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=a;var S=g.dispatch,O=g.pending,L=c.memoizedState;if(O!==null){g.pending=null;var K=O=O.next;do L=a(L,K.action),K=K.next;while(K!==O);Js(L,c.memoizedState)||(Bs=!0),c.memoizedState=L,c.baseQueue===null&&(c.baseState=L),g.lastRenderedState=L}return[L,S]}function fC(){}function hC(a,c){var g=_n,S=mr(),O=c(),L=!Js(S.memoizedState,O);if(L&&(S.memoizedState=O,Bs=!0),S=S.queue,Hg(_C.bind(null,g,S,a),[a]),S.getSnapshot!==c||L||ts!==null&&ts.memoizedState.tag&1){if(g.flags|=2048,hu(9,gC.bind(null,g,S,O,c),void 0,null),ns===null)throw Error(n(349));yi&30||pC(g,c,O)}return O}function pC(a,c,g){a.flags|=16384,a={getSnapshot:c,value:g},c=_n.updateQueue,c===null?(c={lastEffect:null,stores:null},_n.updateQueue=c,c.stores=[a]):(g=c.stores,g===null?c.stores=[a]:g.push(a))}function gC(a,c,g,S){c.value=g,c.getSnapshot=S,yC(c)&&vC(a)}function _C(a,c,g){return g(function(){yC(c)&&vC(a)})}function yC(a){var c=a.getSnapshot;a=a.value;try{var g=c();return!Js(a,g)}catch{return!0}}function vC(a){var c=pa(a,1);c!==null&&Or(c,a,1,-1)}function xC(a){var c=Hr();return typeof a=="function"&&(a=a()),c.memoizedState=c.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fu,lastRenderedState:a},c.queue=a,a=a.dispatch=j4.bind(null,_n,a),[c.memoizedState,a]}function hu(a,c,g,S){return a={tag:a,create:c,destroy:g,deps:S,next:null},c=_n.updateQueue,c===null?(c={lastEffect:null,stores:null},_n.updateQueue=c,c.lastEffect=a.next=a):(g=c.lastEffect,g===null?c.lastEffect=a.next=a:(S=g.next,g.next=a,a.next=S,c.lastEffect=a)),a}function bC(){return mr().memoizedState}function Xm(a,c,g,S){var O=Hr();_n.flags|=a,O.memoizedState=hu(1|c,g,void 0,S===void 0?null:S)}function Qm(a,c,g,S){var O=mr();S=S===void 0?null:S;var L=void 0;if(Vn!==null){var K=Vn.memoizedState;if(L=K.destroy,S!==null&&zg(S,K.deps)){O.memoizedState=hu(c,g,L,S);return}}_n.flags|=a,O.memoizedState=hu(1|c,g,L,S)}function wC(a,c){return Xm(8390656,8,a,c)}function Hg(a,c){return Qm(2048,8,a,c)}function NC(a,c){return Qm(4,2,a,c)}function jC(a,c){return Qm(4,4,a,c)}function CC(a,c){if(typeof c=="function")return a=a(),c(a),function(){c(null)};if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function SC(a,c,g){return g=g!=null?g.concat([a]):null,Qm(4,4,CC.bind(null,c,a),g)}function qg(){}function EC(a,c){var g=mr();c=c===void 0?null:c;var S=g.memoizedState;return S!==null&&c!==null&&zg(c,S[1])?S[0]:(g.memoizedState=[a,c],a)}function MC(a,c){var g=mr();c=c===void 0?null:c;var S=g.memoizedState;return S!==null&&c!==null&&zg(c,S[1])?S[0]:(a=a(),g.memoizedState=[a,c],a)}function kC(a,c,g){return yi&21?(Js(g,c)||(g=rn(),_n.lanes|=g,vi|=g,a.baseState=!0),c):(a.baseState&&(a.baseState=!1,Bs=!0),a.memoizedState=g)}function w4(a,c){var g=vt;vt=g!==0&&4>g?g:4,a(!0);var S=Dg.transition;Dg.transition={};try{a(!1),c()}finally{vt=g,Dg.transition=S}}function AC(){return mr().memoizedState}function N4(a,c,g){var S=yo(a);if(g={lane:S,action:g,hasEagerState:!1,eagerState:null,next:null},OC(a))TC(c,g);else if(g=lC(a,c,g,S),g!==null){var O=As();Or(g,a,S,O),$C(g,c,S)}}function j4(a,c,g){var S=yo(a),O={lane:S,action:g,hasEagerState:!1,eagerState:null,next:null};if(OC(a))TC(c,O);else{var L=a.alternate;if(a.lanes===0&&(L===null||L.lanes===0)&&(L=c.lastRenderedReducer,L!==null))try{var K=c.lastRenderedState,se=L(K,g);if(O.hasEagerState=!0,O.eagerState=se,Js(se,K)){var ae=c.interleaved;ae===null?(O.next=O,Og(c)):(O.next=ae.next,ae.next=O),c.interleaved=O;return}}catch{}finally{}g=lC(a,c,O,S),g!==null&&(O=As(),Or(g,a,S,O),$C(g,c,S))}}function OC(a){var c=a.alternate;return a===_n||c!==null&&c===_n}function TC(a,c){du=Gm=!0;var g=a.pending;g===null?c.next=c:(c.next=g.next,g.next=c),a.pending=c}function $C(a,c,g){if(g&4194240){var S=c.lanes;S&=a.pendingLanes,g|=S,c.lanes=g,Ba(a,g)}}var Zm={readContext:dr,useCallback:ps,useContext:ps,useEffect:ps,useImperativeHandle:ps,useInsertionEffect:ps,useLayoutEffect:ps,useMemo:ps,useReducer:ps,useRef:ps,useState:ps,useDebugValue:ps,useDeferredValue:ps,useTransition:ps,useMutableSource:ps,useSyncExternalStore:ps,useId:ps,unstable_isNewReconciler:!1},C4={readContext:dr,useCallback:function(a,c){return Hr().memoizedState=[a,c===void 0?null:c],a},useContext:dr,useEffect:wC,useImperativeHandle:function(a,c,g){return g=g!=null?g.concat([a]):null,Xm(4194308,4,CC.bind(null,c,a),g)},useLayoutEffect:function(a,c){return Xm(4194308,4,a,c)},useInsertionEffect:function(a,c){return Xm(4,2,a,c)},useMemo:function(a,c){var g=Hr();return c=c===void 0?null:c,a=a(),g.memoizedState=[a,c],a},useReducer:function(a,c,g){var S=Hr();return c=g!==void 0?g(c):c,S.memoizedState=S.baseState=c,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:c},S.queue=a,a=a.dispatch=N4.bind(null,_n,a),[S.memoizedState,a]},useRef:function(a){var c=Hr();return a={current:a},c.memoizedState=a},useState:xC,useDebugValue:qg,useDeferredValue:function(a){return Hr().memoizedState=a},useTransition:function(){var a=xC(!1),c=a[0];return a=w4.bind(null,a[1]),Hr().memoizedState=a,[c,a]},useMutableSource:function(){},useSyncExternalStore:function(a,c,g){var S=_n,O=Hr();if(cn){if(g===void 0)throw Error(n(407));g=g()}else{if(g=c(),ns===null)throw Error(n(349));yi&30||pC(S,c,g)}O.memoizedState=g;var L={value:g,getSnapshot:c};return O.queue=L,wC(_C.bind(null,S,L,a),[a]),S.flags|=2048,hu(9,gC.bind(null,S,L,g,c),void 0,null),g},useId:function(){var a=Hr(),c=ns.identifierPrefix;if(cn){var g=ha,S=fa;g=(S&~(1<<32-Ce(S)-1)).toString(32)+g,c=":"+c+"R"+g,g=mu++,0<g&&(c+="H"+g.toString(32)),c+=":"}else g=b4++,c=":"+c+"r"+g.toString(32)+":";return a.memoizedState=c},unstable_isNewReconciler:!1},S4={readContext:dr,useCallback:EC,useContext:dr,useEffect:Hg,useImperativeHandle:SC,useInsertionEffect:NC,useLayoutEffect:jC,useMemo:MC,useReducer:Bg,useRef:bC,useState:function(){return Bg(fu)},useDebugValue:qg,useDeferredValue:function(a){var c=mr();return kC(c,Vn.memoizedState,a)},useTransition:function(){var a=Bg(fu)[0],c=mr().memoizedState;return[a,c]},useMutableSource:fC,useSyncExternalStore:hC,useId:AC,unstable_isNewReconciler:!1},E4={readContext:dr,useCallback:EC,useContext:dr,useEffect:Hg,useImperativeHandle:SC,useInsertionEffect:NC,useLayoutEffect:jC,useMemo:MC,useReducer:Ug,useRef:bC,useState:function(){return Ug(fu)},useDebugValue:qg,useDeferredValue:function(a){var c=mr();return Vn===null?c.memoizedState=a:kC(c,Vn.memoizedState,a)},useTransition:function(){var a=Ug(fu)[0],c=mr().memoizedState;return[a,c]},useMutableSource:fC,useSyncExternalStore:hC,useId:AC,unstable_isNewReconciler:!1};function Mr(a,c){if(a&&a.defaultProps){c=B({},c),a=a.defaultProps;for(var g in a)c[g]===void 0&&(c[g]=a[g]);return c}return c}function Vg(a,c,g,S){c=a.memoizedState,g=g(S,c),g=g==null?c:B({},c,g),a.memoizedState=g,a.lanes===0&&(a.updateQueue.baseState=g)}var Jm={isMounted:function(a){return(a=a._reactInternals)?fn(a)===a:!1},enqueueSetState:function(a,c,g){a=a._reactInternals;var S=As(),O=yo(a),L=ga(S,O);L.payload=c,g!=null&&(L.callback=g),c=ho(a,L,O),c!==null&&(Or(c,a,O,S),Vm(c,a,O))},enqueueReplaceState:function(a,c,g){a=a._reactInternals;var S=As(),O=yo(a),L=ga(S,O);L.tag=1,L.payload=c,g!=null&&(L.callback=g),c=ho(a,L,O),c!==null&&(Or(c,a,O,S),Vm(c,a,O))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var g=As(),S=yo(a),O=ga(g,S);O.tag=2,c!=null&&(O.callback=c),c=ho(a,O,S),c!==null&&(Or(c,a,S,g),Vm(c,a,S))}};function PC(a,c,g,S,O,L,K){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(S,L,K):c.prototype&&c.prototype.isPureReactComponent?!ii(g,S)||!ii(O,L):!0}function LC(a,c,g){var S=!1,O=Sr,L=c.contextType;return typeof L=="object"&&L!==null?L=dr(L):(O=Fs(c)?fi:Hn.current,S=c.contextTypes,L=(S=S!=null)?Sl(a,O):Sr),c=new c(g,L),a.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Jm,a.stateNode=c,c._reactInternals=a,S&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=O,a.__reactInternalMemoizedMaskedChildContext=L),c}function RC(a,c,g,S){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(g,S),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(g,S),c.state!==a&&Jm.enqueueReplaceState(c,c.state,null)}function Wg(a,c,g,S){var O=a.stateNode;O.props=g,O.state=a.memoizedState,O.refs={},Tg(a);var L=c.contextType;typeof L=="object"&&L!==null?O.context=dr(L):(L=Fs(c)?fi:Hn.current,O.context=Sl(a,L)),O.state=a.memoizedState,L=c.getDerivedStateFromProps,typeof L=="function"&&(Vg(a,c,L,g),O.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof O.getSnapshotBeforeUpdate=="function"||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(c=O.state,typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount(),c!==O.state&&Jm.enqueueReplaceState(O,O.state,null),Wm(a,g,O,S),O.state=a.memoizedState),typeof O.componentDidMount=="function"&&(a.flags|=4194308)}function Pl(a,c){try{var g="",S=c;do g+=Y(S),S=S.return;while(S);var O=g}catch(L){O=`
Error generating stack: `+L.message+`
`+L.stack}return{value:a,source:c,stack:O,digest:null}}function Yg(a,c,g){return{value:a,source:null,stack:g??null,digest:c??null}}function Kg(a,c){try{console.error(c.value)}catch(g){setTimeout(function(){throw g})}}var M4=typeof WeakMap=="function"?WeakMap:Map;function DC(a,c,g){g=ga(-1,g),g.tag=3,g.payload={element:null};var S=c.value;return g.callback=function(){of||(of=!0,c_=S),Kg(a,c)},g}function zC(a,c,g){g=ga(-1,g),g.tag=3;var S=a.type.getDerivedStateFromError;if(typeof S=="function"){var O=c.value;g.payload=function(){return S(O)},g.callback=function(){Kg(a,c)}}var L=a.stateNode;return L!==null&&typeof L.componentDidCatch=="function"&&(g.callback=function(){Kg(a,c),typeof S!="function"&&(go===null?go=new Set([this]):go.add(this));var K=c.stack;this.componentDidCatch(c.value,{componentStack:K!==null?K:""})}),g}function IC(a,c,g){var S=a.pingCache;if(S===null){S=a.pingCache=new M4;var O=new Set;S.set(c,O)}else O=S.get(c),O===void 0&&(O=new Set,S.set(c,O));O.has(g)||(O.add(g),a=U4.bind(null,a,c,g),c.then(a,a))}function FC(a){do{var c;if((c=a.tag===13)&&(c=a.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return a;a=a.return}while(a!==null);return null}function BC(a,c,g,S,O){return a.mode&1?(a.flags|=65536,a.lanes=O,a):(a===c?a.flags|=65536:(a.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(c=ga(-1,1),c.tag=2,ho(g,c,1))),g.lanes|=1),a)}var k4=C.ReactCurrentOwner,Bs=!1;function ks(a,c,g,S){c.child=a===null?iC(c,null,g,S):Al(c,a.child,g,S)}function UC(a,c,g,S,O){g=g.render;var L=c.ref;return Tl(c,O),S=Ig(a,c,g,S,L,O),g=Fg(),a!==null&&!Bs?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~O,_a(a,c,O)):(cn&&g&&wg(c),c.flags|=1,ks(a,c,S,O),c.child)}function HC(a,c,g,S,O){if(a===null){var L=g.type;return typeof L=="function"&&!g_(L)&&L.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(c.tag=15,c.type=L,qC(a,c,L,S,O)):(a=ff(g.type,null,S,c,c.mode,O),a.ref=c.ref,a.return=c,c.child=a)}if(L=a.child,!(a.lanes&O)){var K=L.memoizedProps;if(g=g.compare,g=g!==null?g:ii,g(K,S)&&a.ref===c.ref)return _a(a,c,O)}return c.flags|=1,a=xo(L,S),a.ref=c.ref,a.return=c,c.child=a}function qC(a,c,g,S,O){if(a!==null){var L=a.memoizedProps;if(ii(L,S)&&a.ref===c.ref)if(Bs=!1,c.pendingProps=S=L,(a.lanes&O)!==0)a.flags&131072&&(Bs=!0);else return c.lanes=a.lanes,_a(a,c,O)}return Gg(a,c,g,S,O)}function VC(a,c,g){var S=c.pendingProps,O=S.children,L=a!==null?a.memoizedState:null;if(S.mode==="hidden")if(!(c.mode&1))c.memoizedState={baseLanes:0,cachePool:null,transitions:null},qt(Rl,nr),nr|=g;else{if(!(g&1073741824))return a=L!==null?L.baseLanes|g:g,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:a,cachePool:null,transitions:null},c.updateQueue=null,qt(Rl,nr),nr|=a,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=L!==null?L.baseLanes:g,qt(Rl,nr),nr|=S}else L!==null?(S=L.baseLanes|g,c.memoizedState=null):S=g,qt(Rl,nr),nr|=S;return ks(a,c,O,g),c.child}function WC(a,c){var g=c.ref;(a===null&&g!==null||a!==null&&a.ref!==g)&&(c.flags|=512,c.flags|=2097152)}function Gg(a,c,g,S,O){var L=Fs(g)?fi:Hn.current;return L=Sl(c,L),Tl(c,O),g=Ig(a,c,g,S,L,O),S=Fg(),a!==null&&!Bs?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~O,_a(a,c,O)):(cn&&S&&wg(c),c.flags|=1,ks(a,c,g,O),c.child)}function YC(a,c,g,S,O){if(Fs(g)){var L=!0;Dm(c)}else L=!1;if(Tl(c,O),c.stateNode===null)tf(a,c),LC(c,g,S),Wg(c,g,S,O),S=!0;else if(a===null){var K=c.stateNode,se=c.memoizedProps;K.props=se;var ae=K.context,fe=g.contextType;typeof fe=="object"&&fe!==null?fe=dr(fe):(fe=Fs(g)?fi:Hn.current,fe=Sl(c,fe));var je=g.getDerivedStateFromProps,Se=typeof je=="function"||typeof K.getSnapshotBeforeUpdate=="function";Se||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(se!==S||ae!==fe)&&RC(c,K,S,fe),fo=!1;var Ne=c.memoizedState;K.state=Ne,Wm(c,S,K,O),ae=c.memoizedState,se!==S||Ne!==ae||qn.current||fo?(typeof je=="function"&&(Vg(c,g,je,S),ae=c.memoizedState),(se=fo||PC(c,g,se,S,Ne,ae,fe))?(Se||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount()),typeof K.componentDidMount=="function"&&(c.flags|=4194308)):(typeof K.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=S,c.memoizedState=ae),K.props=S,K.state=ae,K.context=fe,S=se):(typeof K.componentDidMount=="function"&&(c.flags|=4194308),S=!1)}else{K=c.stateNode,cC(a,c),se=c.memoizedProps,fe=c.type===c.elementType?se:Mr(c.type,se),K.props=fe,Se=c.pendingProps,Ne=K.context,ae=g.contextType,typeof ae=="object"&&ae!==null?ae=dr(ae):(ae=Fs(g)?fi:Hn.current,ae=Sl(c,ae));var ze=g.getDerivedStateFromProps;(je=typeof ze=="function"||typeof K.getSnapshotBeforeUpdate=="function")||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(se!==Se||Ne!==ae)&&RC(c,K,S,ae),fo=!1,Ne=c.memoizedState,K.state=Ne,Wm(c,S,K,O);var Be=c.memoizedState;se!==Se||Ne!==Be||qn.current||fo?(typeof ze=="function"&&(Vg(c,g,ze,S),Be=c.memoizedState),(fe=fo||PC(c,g,fe,S,Ne,Be,ae)||!1)?(je||typeof K.UNSAFE_componentWillUpdate!="function"&&typeof K.componentWillUpdate!="function"||(typeof K.componentWillUpdate=="function"&&K.componentWillUpdate(S,Be,ae),typeof K.UNSAFE_componentWillUpdate=="function"&&K.UNSAFE_componentWillUpdate(S,Be,ae)),typeof K.componentDidUpdate=="function"&&(c.flags|=4),typeof K.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof K.componentDidUpdate!="function"||se===a.memoizedProps&&Ne===a.memoizedState||(c.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||se===a.memoizedProps&&Ne===a.memoizedState||(c.flags|=1024),c.memoizedProps=S,c.memoizedState=Be),K.props=S,K.state=Be,K.context=ae,S=fe):(typeof K.componentDidUpdate!="function"||se===a.memoizedProps&&Ne===a.memoizedState||(c.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||se===a.memoizedProps&&Ne===a.memoizedState||(c.flags|=1024),S=!1)}return Xg(a,c,g,S,L,O)}function Xg(a,c,g,S,O,L){WC(a,c);var K=(c.flags&128)!==0;if(!S&&!K)return O&&Zj(c,g,!1),_a(a,c,L);S=c.stateNode,k4.current=c;var se=K&&typeof g.getDerivedStateFromError!="function"?null:S.render();return c.flags|=1,a!==null&&K?(c.child=Al(c,a.child,null,L),c.child=Al(c,null,se,L)):ks(a,c,se,L),c.memoizedState=S.state,O&&Zj(c,g,!0),c.child}function KC(a){var c=a.stateNode;c.pendingContext?Xj(a,c.pendingContext,c.pendingContext!==c.context):c.context&&Xj(a,c.context,!1),$g(a,c.containerInfo)}function GC(a,c,g,S,O){return kl(),Sg(O),c.flags|=256,ks(a,c,g,S),c.child}var Qg={dehydrated:null,treeContext:null,retryLane:0};function Zg(a){return{baseLanes:a,cachePool:null,transitions:null}}function XC(a,c,g){var S=c.pendingProps,O=gn.current,L=!1,K=(c.flags&128)!==0,se;if((se=K)||(se=a!==null&&a.memoizedState===null?!1:(O&2)!==0),se?(L=!0,c.flags&=-129):(a===null||a.memoizedState!==null)&&(O|=1),qt(gn,O&1),a===null)return Cg(c),a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?(c.mode&1?a.data==="$!"?c.lanes=8:c.lanes=1073741824:c.lanes=1,null):(K=S.children,a=S.fallback,L?(S=c.mode,L=c.child,K={mode:"hidden",children:K},!(S&1)&&L!==null?(L.childLanes=0,L.pendingProps=K):L=hf(K,S,0,null),a=Ni(a,S,g,null),L.return=c,a.return=c,L.sibling=a,c.child=L,c.child.memoizedState=Zg(g),c.memoizedState=Qg,a):Jg(c,K));if(O=a.memoizedState,O!==null&&(se=O.dehydrated,se!==null))return A4(a,c,K,S,se,O,g);if(L){L=S.fallback,K=c.mode,O=a.child,se=O.sibling;var ae={mode:"hidden",children:S.children};return!(K&1)&&c.child!==O?(S=c.child,S.childLanes=0,S.pendingProps=ae,c.deletions=null):(S=xo(O,ae),S.subtreeFlags=O.subtreeFlags&14680064),se!==null?L=xo(se,L):(L=Ni(L,K,g,null),L.flags|=2),L.return=c,S.return=c,S.sibling=L,c.child=S,S=L,L=c.child,K=a.child.memoizedState,K=K===null?Zg(g):{baseLanes:K.baseLanes|g,cachePool:null,transitions:K.transitions},L.memoizedState=K,L.childLanes=a.childLanes&~g,c.memoizedState=Qg,S}return L=a.child,a=L.sibling,S=xo(L,{mode:"visible",children:S.children}),!(c.mode&1)&&(S.lanes=g),S.return=c,S.sibling=null,a!==null&&(g=c.deletions,g===null?(c.deletions=[a],c.flags|=16):g.push(a)),c.child=S,c.memoizedState=null,S}function Jg(a,c){return c=hf({mode:"visible",children:c},a.mode,0,null),c.return=a,a.child=c}function ef(a,c,g,S){return S!==null&&Sg(S),Al(c,a.child,null,g),a=Jg(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function A4(a,c,g,S,O,L,K){if(g)return c.flags&256?(c.flags&=-257,S=Yg(Error(n(422))),ef(a,c,K,S)):c.memoizedState!==null?(c.child=a.child,c.flags|=128,null):(L=S.fallback,O=c.mode,S=hf({mode:"visible",children:S.children},O,0,null),L=Ni(L,O,K,null),L.flags|=2,S.return=c,L.return=c,S.sibling=L,c.child=S,c.mode&1&&Al(c,a.child,null,K),c.child.memoizedState=Zg(K),c.memoizedState=Qg,L);if(!(c.mode&1))return ef(a,c,K,null);if(O.data==="$!"){if(S=O.nextSibling&&O.nextSibling.dataset,S)var se=S.dgst;return S=se,L=Error(n(419)),S=Yg(L,S,void 0),ef(a,c,K,S)}if(se=(K&a.childLanes)!==0,Bs||se){if(S=ns,S!==null){switch(K&-K){case 4:O=2;break;case 16:O=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:O=32;break;case 536870912:O=268435456;break;default:O=0}O=O&(S.suspendedLanes|K)?0:O,O!==0&&O!==L.retryLane&&(L.retryLane=O,pa(a,O),Or(S,a,O,-1))}return p_(),S=Yg(Error(n(421))),ef(a,c,K,S)}return O.data==="$?"?(c.flags|=128,c.child=a.child,c=H4.bind(null,a),O._reactRetry=c,null):(a=L.treeContext,tr=Br(O.nextSibling),er=c,cn=!0,Er=null,a!==null&&(cr[ur++]=fa,cr[ur++]=ha,cr[ur++]=hi,fa=a.id,ha=a.overflow,hi=c),c=Jg(c,S.children),c.flags|=4096,c)}function QC(a,c,g){a.lanes|=c;var S=a.alternate;S!==null&&(S.lanes|=c),Ag(a.return,c,g)}function e_(a,c,g,S,O){var L=a.memoizedState;L===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:S,tail:g,tailMode:O}:(L.isBackwards=c,L.rendering=null,L.renderingStartTime=0,L.last=S,L.tail=g,L.tailMode=O)}function ZC(a,c,g){var S=c.pendingProps,O=S.revealOrder,L=S.tail;if(ks(a,c,S.children,g),S=gn.current,S&2)S=S&1|2,c.flags|=128;else{if(a!==null&&a.flags&128)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&QC(a,g,c);else if(a.tag===19)QC(a,g,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}S&=1}if(qt(gn,S),!(c.mode&1))c.memoizedState=null;else switch(O){case"forwards":for(g=c.child,O=null;g!==null;)a=g.alternate,a!==null&&Ym(a)===null&&(O=g),g=g.sibling;g=O,g===null?(O=c.child,c.child=null):(O=g.sibling,g.sibling=null),e_(c,!1,O,g,L);break;case"backwards":for(g=null,O=c.child,c.child=null;O!==null;){if(a=O.alternate,a!==null&&Ym(a)===null){c.child=O;break}a=O.sibling,O.sibling=g,g=O,O=a}e_(c,!0,g,null,L);break;case"together":e_(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function tf(a,c){!(c.mode&1)&&a!==null&&(a.alternate=null,c.alternate=null,c.flags|=2)}function _a(a,c,g){if(a!==null&&(c.dependencies=a.dependencies),vi|=c.lanes,!(g&c.childLanes))return null;if(a!==null&&c.child!==a.child)throw Error(n(153));if(c.child!==null){for(a=c.child,g=xo(a,a.pendingProps),c.child=g,g.return=c;a.sibling!==null;)a=a.sibling,g=g.sibling=xo(a,a.pendingProps),g.return=c;g.sibling=null}return c.child}function O4(a,c,g){switch(c.tag){case 3:KC(c),kl();break;case 5:mC(c);break;case 1:Fs(c.type)&&Dm(c);break;case 4:$g(c,c.stateNode.containerInfo);break;case 10:var S=c.type._context,O=c.memoizedProps.value;qt(Hm,S._currentValue),S._currentValue=O;break;case 13:if(S=c.memoizedState,S!==null)return S.dehydrated!==null?(qt(gn,gn.current&1),c.flags|=128,null):g&c.child.childLanes?XC(a,c,g):(qt(gn,gn.current&1),a=_a(a,c,g),a!==null?a.sibling:null);qt(gn,gn.current&1);break;case 19:if(S=(g&c.childLanes)!==0,a.flags&128){if(S)return ZC(a,c,g);c.flags|=128}if(O=c.memoizedState,O!==null&&(O.rendering=null,O.tail=null,O.lastEffect=null),qt(gn,gn.current),S)break;return null;case 22:case 23:return c.lanes=0,VC(a,c,g)}return _a(a,c,g)}var JC,t_,eS,tS;JC=function(a,c){for(var g=c.child;g!==null;){if(g.tag===5||g.tag===6)a.appendChild(g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===c)break;for(;g.sibling===null;){if(g.return===null||g.return===c)return;g=g.return}g.sibling.return=g.return,g=g.sibling}},t_=function(){},eS=function(a,c,g,S){var O=a.memoizedProps;if(O!==S){a=c.stateNode,_i(Ur.current);var L=null;switch(g){case"input":O=Ee(a,O),S=Ee(a,S),L=[];break;case"select":O=B({},O,{value:void 0}),S=B({},S,{value:void 0}),L=[];break;case"textarea":O=ue(a,O),S=ue(a,S),L=[];break;default:typeof O.onClick!="function"&&typeof S.onClick=="function"&&(a.onclick=eu)}Qt(g,S);var K;g=null;for(fe in O)if(!S.hasOwnProperty(fe)&&O.hasOwnProperty(fe)&&O[fe]!=null)if(fe==="style"){var se=O[fe];for(K in se)se.hasOwnProperty(K)&&(g||(g={}),g[K]="")}else fe!=="dangerouslySetInnerHTML"&&fe!=="children"&&fe!=="suppressContentEditableWarning"&&fe!=="suppressHydrationWarning"&&fe!=="autoFocus"&&(r.hasOwnProperty(fe)?L||(L=[]):(L=L||[]).push(fe,null));for(fe in S){var ae=S[fe];if(se=O!=null?O[fe]:void 0,S.hasOwnProperty(fe)&&ae!==se&&(ae!=null||se!=null))if(fe==="style")if(se){for(K in se)!se.hasOwnProperty(K)||ae&&ae.hasOwnProperty(K)||(g||(g={}),g[K]="");for(K in ae)ae.hasOwnProperty(K)&&se[K]!==ae[K]&&(g||(g={}),g[K]=ae[K])}else g||(L||(L=[]),L.push(fe,g)),g=ae;else fe==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,se=se?se.__html:void 0,ae!=null&&se!==ae&&(L=L||[]).push(fe,ae)):fe==="children"?typeof ae!="string"&&typeof ae!="number"||(L=L||[]).push(fe,""+ae):fe!=="suppressContentEditableWarning"&&fe!=="suppressHydrationWarning"&&(r.hasOwnProperty(fe)?(ae!=null&&fe==="onScroll"&&Gt("scroll",a),L||se===ae||(L=[])):(L=L||[]).push(fe,ae))}g&&(L=L||[]).push("style",g);var fe=L;(c.updateQueue=fe)&&(c.flags|=4)}},tS=function(a,c,g,S){g!==S&&(c.flags|=4)};function pu(a,c){if(!cn)switch(a.tailMode){case"hidden":c=a.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?a.tail=null:g.sibling=null;break;case"collapsed":g=a.tail;for(var S=null;g!==null;)g.alternate!==null&&(S=g),g=g.sibling;S===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:S.sibling=null}}function gs(a){var c=a.alternate!==null&&a.alternate.child===a.child,g=0,S=0;if(c)for(var O=a.child;O!==null;)g|=O.lanes|O.childLanes,S|=O.subtreeFlags&14680064,S|=O.flags&14680064,O.return=a,O=O.sibling;else for(O=a.child;O!==null;)g|=O.lanes|O.childLanes,S|=O.subtreeFlags,S|=O.flags,O.return=a,O=O.sibling;return a.subtreeFlags|=S,a.childLanes=g,c}function T4(a,c,g){var S=c.pendingProps;switch(Ng(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gs(c),null;case 1:return Fs(c.type)&&Rm(),gs(c),null;case 3:return S=c.stateNode,$l(),Ze(qn),Ze(Hn),Rg(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(a===null||a.child===null)&&(Bm(c)?c.flags|=4:a===null||a.memoizedState.isDehydrated&&!(c.flags&256)||(c.flags|=1024,Er!==null&&(m_(Er),Er=null))),t_(a,c),gs(c),null;case 5:Pg(c);var O=_i(uu.current);if(g=c.type,a!==null&&c.stateNode!=null)eS(a,c,g,S,O),a.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!S){if(c.stateNode===null)throw Error(n(166));return gs(c),null}if(a=_i(Ur.current),Bm(c)){S=c.stateNode,g=c.type;var L=c.memoizedProps;switch(S[lr]=c,S[di]=L,a=(c.mode&1)!==0,g){case"dialog":Gt("cancel",S),Gt("close",S);break;case"iframe":case"object":case"embed":Gt("load",S);break;case"video":case"audio":for(O=0;O<ci.length;O++)Gt(ci[O],S);break;case"source":Gt("error",S);break;case"img":case"image":case"link":Gt("error",S),Gt("load",S);break;case"details":Gt("toggle",S);break;case"input":De(S,L),Gt("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!L.multiple},Gt("invalid",S);break;case"textarea":$e(S,L),Gt("invalid",S)}Qt(g,L),O=null;for(var K in L)if(L.hasOwnProperty(K)){var se=L[K];K==="children"?typeof se=="string"?S.textContent!==se&&(L.suppressHydrationWarning!==!0&&jl(S.textContent,se,a),O=["children",se]):typeof se=="number"&&S.textContent!==""+se&&(L.suppressHydrationWarning!==!0&&jl(S.textContent,se,a),O=["children",""+se]):r.hasOwnProperty(K)&&se!=null&&K==="onScroll"&&Gt("scroll",S)}switch(g){case"input":he(S),pe(S,L,!0);break;case"textarea":he(S),et(S);break;case"select":case"option":break;default:typeof L.onClick=="function"&&(S.onclick=eu)}S=O,c.updateQueue=S,S!==null&&(c.flags|=4)}else{K=O.nodeType===9?O:O.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=We(g)),a==="http://www.w3.org/1999/xhtml"?g==="script"?(a=K.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof S.is=="string"?a=K.createElement(g,{is:S.is}):(a=K.createElement(g),g==="select"&&(K=a,S.multiple?K.multiple=!0:S.size&&(K.size=S.size))):a=K.createElementNS(a,g),a[lr]=c,a[di]=S,JC(a,c,!1,!1),c.stateNode=a;e:{switch(K=wn(g,S),g){case"dialog":Gt("cancel",a),Gt("close",a),O=S;break;case"iframe":case"object":case"embed":Gt("load",a),O=S;break;case"video":case"audio":for(O=0;O<ci.length;O++)Gt(ci[O],a);O=S;break;case"source":Gt("error",a),O=S;break;case"img":case"image":case"link":Gt("error",a),Gt("load",a),O=S;break;case"details":Gt("toggle",a),O=S;break;case"input":De(a,S),O=Ee(a,S),Gt("invalid",a);break;case"option":O=S;break;case"select":a._wrapperState={wasMultiple:!!S.multiple},O=B({},S,{value:void 0}),Gt("invalid",a);break;case"textarea":$e(a,S),O=ue(a,S),Gt("invalid",a);break;default:O=S}Qt(g,O),se=O;for(L in se)if(se.hasOwnProperty(L)){var ae=se[L];L==="style"?Kt(a,ae):L==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ae!=null&&ft(a,ae)):L==="children"?typeof ae=="string"?(g!=="textarea"||ae!=="")&&bt(a,ae):typeof ae=="number"&&bt(a,""+ae):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(r.hasOwnProperty(L)?ae!=null&&L==="onScroll"&&Gt("scroll",a):ae!=null&&N(a,L,ae,K))}switch(g){case"input":he(a),pe(a,S,!1);break;case"textarea":he(a),et(a);break;case"option":S.value!=null&&a.setAttribute("value",""+ee(S.value));break;case"select":a.multiple=!!S.multiple,L=S.value,L!=null?Ie(a,!!S.multiple,L,!1):S.defaultValue!=null&&Ie(a,!!S.multiple,S.defaultValue,!0);break;default:typeof O.onClick=="function"&&(a.onclick=eu)}switch(g){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return gs(c),null;case 6:if(a&&c.stateNode!=null)tS(a,c,a.memoizedProps,S);else{if(typeof S!="string"&&c.stateNode===null)throw Error(n(166));if(g=_i(uu.current),_i(Ur.current),Bm(c)){if(S=c.stateNode,g=c.memoizedProps,S[lr]=c,(L=S.nodeValue!==g)&&(a=er,a!==null))switch(a.tag){case 3:jl(S.nodeValue,g,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&jl(S.nodeValue,g,(a.mode&1)!==0)}L&&(c.flags|=4)}else S=(g.nodeType===9?g:g.ownerDocument).createTextNode(S),S[lr]=c,c.stateNode=S}return gs(c),null;case 13:if(Ze(gn),S=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(cn&&tr!==null&&c.mode&1&&!(c.flags&128))rC(),kl(),c.flags|=98560,L=!1;else if(L=Bm(c),S!==null&&S.dehydrated!==null){if(a===null){if(!L)throw Error(n(318));if(L=c.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(n(317));L[lr]=c}else kl(),!(c.flags&128)&&(c.memoizedState=null),c.flags|=4;gs(c),L=!1}else Er!==null&&(m_(Er),Er=null),L=!0;if(!L)return c.flags&65536?c:null}return c.flags&128?(c.lanes=g,c):(S=S!==null,S!==(a!==null&&a.memoizedState!==null)&&S&&(c.child.flags|=8192,c.mode&1&&(a===null||gn.current&1?Wn===0&&(Wn=3):p_())),c.updateQueue!==null&&(c.flags|=4),gs(c),null);case 4:return $l(),t_(a,c),a===null&&wl(c.stateNode.containerInfo),gs(c),null;case 10:return kg(c.type._context),gs(c),null;case 17:return Fs(c.type)&&Rm(),gs(c),null;case 19:if(Ze(gn),L=c.memoizedState,L===null)return gs(c),null;if(S=(c.flags&128)!==0,K=L.rendering,K===null)if(S)pu(L,!1);else{if(Wn!==0||a!==null&&a.flags&128)for(a=c.child;a!==null;){if(K=Ym(a),K!==null){for(c.flags|=128,pu(L,!1),S=K.updateQueue,S!==null&&(c.updateQueue=S,c.flags|=4),c.subtreeFlags=0,S=g,g=c.child;g!==null;)L=g,a=S,L.flags&=14680066,K=L.alternate,K===null?(L.childLanes=0,L.lanes=a,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=K.childLanes,L.lanes=K.lanes,L.child=K.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=K.memoizedProps,L.memoizedState=K.memoizedState,L.updateQueue=K.updateQueue,L.type=K.type,a=K.dependencies,L.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),g=g.sibling;return qt(gn,gn.current&1|2),c.child}a=a.sibling}L.tail!==null&&Qe()>Dl&&(c.flags|=128,S=!0,pu(L,!1),c.lanes=4194304)}else{if(!S)if(a=Ym(K),a!==null){if(c.flags|=128,S=!0,g=a.updateQueue,g!==null&&(c.updateQueue=g,c.flags|=4),pu(L,!0),L.tail===null&&L.tailMode==="hidden"&&!K.alternate&&!cn)return gs(c),null}else 2*Qe()-L.renderingStartTime>Dl&&g!==1073741824&&(c.flags|=128,S=!0,pu(L,!1),c.lanes=4194304);L.isBackwards?(K.sibling=c.child,c.child=K):(g=L.last,g!==null?g.sibling=K:c.child=K,L.last=K)}return L.tail!==null?(c=L.tail,L.rendering=c,L.tail=c.sibling,L.renderingStartTime=Qe(),c.sibling=null,g=gn.current,qt(gn,S?g&1|2:g&1),c):(gs(c),null);case 22:case 23:return h_(),S=c.memoizedState!==null,a!==null&&a.memoizedState!==null!==S&&(c.flags|=8192),S&&c.mode&1?nr&1073741824&&(gs(c),c.subtreeFlags&6&&(c.flags|=8192)):gs(c),null;case 24:return null;case 25:return null}throw Error(n(156,c.tag))}function $4(a,c){switch(Ng(c),c.tag){case 1:return Fs(c.type)&&Rm(),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return $l(),Ze(qn),Ze(Hn),Rg(),a=c.flags,a&65536&&!(a&128)?(c.flags=a&-65537|128,c):null;case 5:return Pg(c),null;case 13:if(Ze(gn),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(n(340));kl()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return Ze(gn),null;case 4:return $l(),null;case 10:return kg(c.type._context),null;case 22:case 23:return h_(),null;case 24:return null;default:return null}}var nf=!1,_s=!1,P4=typeof WeakSet=="function"?WeakSet:Set,Fe=null;function Ll(a,c){var g=a.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(S){bn(a,c,S)}else g.current=null}function n_(a,c,g){try{g()}catch(S){bn(a,c,S)}}var nS=!1;function L4(a,c){if(tu=Es,a=vm(),Kc(a)){if("selectionStart"in a)var g={start:a.selectionStart,end:a.selectionEnd};else e:{g=(g=a.ownerDocument)&&g.defaultView||window;var S=g.getSelection&&g.getSelection();if(S&&S.rangeCount!==0){g=S.anchorNode;var O=S.anchorOffset,L=S.focusNode;S=S.focusOffset;try{g.nodeType,L.nodeType}catch{g=null;break e}var K=0,se=-1,ae=-1,fe=0,je=0,Se=a,Ne=null;t:for(;;){for(var ze;Se!==g||O!==0&&Se.nodeType!==3||(se=K+O),Se!==L||S!==0&&Se.nodeType!==3||(ae=K+S),Se.nodeType===3&&(K+=Se.nodeValue.length),(ze=Se.firstChild)!==null;)Ne=Se,Se=ze;for(;;){if(Se===a)break t;if(Ne===g&&++fe===O&&(se=K),Ne===L&&++je===S&&(ae=K),(ze=Se.nextSibling)!==null)break;Se=Ne,Ne=Se.parentNode}Se=ze}g=se===-1||ae===-1?null:{start:se,end:ae}}else g=null}g=g||{start:0,end:0}}else g=null;for(nu={focusedElem:a,selectionRange:g},Es=!1,Fe=c;Fe!==null;)if(c=Fe,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,Fe=a;else for(;Fe!==null;){c=Fe;try{var Be=c.alternate;if(c.flags&1024)switch(c.tag){case 0:case 11:case 15:break;case 1:if(Be!==null){var qe=Be.memoizedProps,Mn=Be.memoizedState,ce=c.stateNode,oe=ce.getSnapshotBeforeUpdate(c.elementType===c.type?qe:Mr(c.type,qe),Mn);ce.__reactInternalSnapshotBeforeUpdate=oe}break;case 3:var de=c.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Oe){bn(c,c.return,Oe)}if(a=c.sibling,a!==null){a.return=c.return,Fe=a;break}Fe=c.return}return Be=nS,nS=!1,Be}function gu(a,c,g){var S=c.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var O=S=S.next;do{if((O.tag&a)===a){var L=O.destroy;O.destroy=void 0,L!==void 0&&n_(c,g,L)}O=O.next}while(O!==S)}}function sf(a,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var g=c=c.next;do{if((g.tag&a)===a){var S=g.create;g.destroy=S()}g=g.next}while(g!==c)}}function s_(a){var c=a.ref;if(c!==null){var g=a.stateNode;switch(a.tag){case 5:a=g;break;default:a=g}typeof c=="function"?c(a):c.current=a}}function sS(a){var c=a.alternate;c!==null&&(a.alternate=null,sS(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&(delete c[lr],delete c[di],delete c[Lm],delete c[vg],delete c[xg])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function rS(a){return a.tag===5||a.tag===3||a.tag===4}function aS(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||rS(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function r_(a,c,g){var S=a.tag;if(S===5||S===6)a=a.stateNode,c?g.nodeType===8?g.parentNode.insertBefore(a,c):g.insertBefore(a,c):(g.nodeType===8?(c=g.parentNode,c.insertBefore(a,g)):(c=g,c.appendChild(a)),g=g._reactRootContainer,g!=null||c.onclick!==null||(c.onclick=eu));else if(S!==4&&(a=a.child,a!==null))for(r_(a,c,g),a=a.sibling;a!==null;)r_(a,c,g),a=a.sibling}function a_(a,c,g){var S=a.tag;if(S===5||S===6)a=a.stateNode,c?g.insertBefore(a,c):g.appendChild(a);else if(S!==4&&(a=a.child,a!==null))for(a_(a,c,g),a=a.sibling;a!==null;)a_(a,c,g),a=a.sibling}var us=null,kr=!1;function po(a,c,g){for(g=g.child;g!==null;)oS(a,c,g),g=g.sibling}function oS(a,c,g){if(Le&&typeof Le.onCommitFiberUnmount=="function")try{Le.onCommitFiberUnmount(xe,g)}catch{}switch(g.tag){case 5:_s||Ll(g,c);case 6:var S=us,O=kr;us=null,po(a,c,g),us=S,kr=O,us!==null&&(kr?(a=us,g=g.stateNode,a.nodeType===8?a.parentNode.removeChild(g):a.removeChild(g)):us.removeChild(g.stateNode));break;case 18:us!==null&&(kr?(a=us,g=g.stateNode,a.nodeType===8?au(a.parentNode,g):a.nodeType===1&&au(a,g),Rn(a)):au(us,g.stateNode));break;case 4:S=us,O=kr,us=g.stateNode.containerInfo,kr=!0,po(a,c,g),us=S,kr=O;break;case 0:case 11:case 14:case 15:if(!_s&&(S=g.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){O=S=S.next;do{var L=O,K=L.destroy;L=L.tag,K!==void 0&&(L&2||L&4)&&n_(g,c,K),O=O.next}while(O!==S)}po(a,c,g);break;case 1:if(!_s&&(Ll(g,c),S=g.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=g.memoizedProps,S.state=g.memoizedState,S.componentWillUnmount()}catch(se){bn(g,c,se)}po(a,c,g);break;case 21:po(a,c,g);break;case 22:g.mode&1?(_s=(S=_s)||g.memoizedState!==null,po(a,c,g),_s=S):po(a,c,g);break;default:po(a,c,g)}}function iS(a){var c=a.updateQueue;if(c!==null){a.updateQueue=null;var g=a.stateNode;g===null&&(g=a.stateNode=new P4),c.forEach(function(S){var O=q4.bind(null,a,S);g.has(S)||(g.add(S),S.then(O,O))})}}function Ar(a,c){var g=c.deletions;if(g!==null)for(var S=0;S<g.length;S++){var O=g[S];try{var L=a,K=c,se=K;e:for(;se!==null;){switch(se.tag){case 5:us=se.stateNode,kr=!1;break e;case 3:us=se.stateNode.containerInfo,kr=!0;break e;case 4:us=se.stateNode.containerInfo,kr=!0;break e}se=se.return}if(us===null)throw Error(n(160));oS(L,K,O),us=null,kr=!1;var ae=O.alternate;ae!==null&&(ae.return=null),O.return=null}catch(fe){bn(O,c,fe)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)lS(c,a),c=c.sibling}function lS(a,c){var g=a.alternate,S=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Ar(c,a),qr(a),S&4){try{gu(3,a,a.return),sf(3,a)}catch(qe){bn(a,a.return,qe)}try{gu(5,a,a.return)}catch(qe){bn(a,a.return,qe)}}break;case 1:Ar(c,a),qr(a),S&512&&g!==null&&Ll(g,g.return);break;case 5:if(Ar(c,a),qr(a),S&512&&g!==null&&Ll(g,g.return),a.flags&32){var O=a.stateNode;try{bt(O,"")}catch(qe){bn(a,a.return,qe)}}if(S&4&&(O=a.stateNode,O!=null)){var L=a.memoizedProps,K=g!==null?g.memoizedProps:L,se=a.type,ae=a.updateQueue;if(a.updateQueue=null,ae!==null)try{se==="input"&&L.type==="radio"&&L.name!=null&&ke(O,L),wn(se,K);var fe=wn(se,L);for(K=0;K<ae.length;K+=2){var je=ae[K],Se=ae[K+1];je==="style"?Kt(O,Se):je==="dangerouslySetInnerHTML"?ft(O,Se):je==="children"?bt(O,Se):N(O,je,Se,fe)}switch(se){case"input":le(O,L);break;case"textarea":Ye(O,L);break;case"select":var Ne=O._wrapperState.wasMultiple;O._wrapperState.wasMultiple=!!L.multiple;var ze=L.value;ze!=null?Ie(O,!!L.multiple,ze,!1):Ne!==!!L.multiple&&(L.defaultValue!=null?Ie(O,!!L.multiple,L.defaultValue,!0):Ie(O,!!L.multiple,L.multiple?[]:"",!1))}O[di]=L}catch(qe){bn(a,a.return,qe)}}break;case 6:if(Ar(c,a),qr(a),S&4){if(a.stateNode===null)throw Error(n(162));O=a.stateNode,L=a.memoizedProps;try{O.nodeValue=L}catch(qe){bn(a,a.return,qe)}}break;case 3:if(Ar(c,a),qr(a),S&4&&g!==null&&g.memoizedState.isDehydrated)try{Rn(c.containerInfo)}catch(qe){bn(a,a.return,qe)}break;case 4:Ar(c,a),qr(a);break;case 13:Ar(c,a),qr(a),O=a.child,O.flags&8192&&(L=O.memoizedState!==null,O.stateNode.isHidden=L,!L||O.alternate!==null&&O.alternate.memoizedState!==null||(l_=Qe())),S&4&&iS(a);break;case 22:if(je=g!==null&&g.memoizedState!==null,a.mode&1?(_s=(fe=_s)||je,Ar(c,a),_s=fe):Ar(c,a),qr(a),S&8192){if(fe=a.memoizedState!==null,(a.stateNode.isHidden=fe)&&!je&&a.mode&1)for(Fe=a,je=a.child;je!==null;){for(Se=Fe=je;Fe!==null;){switch(Ne=Fe,ze=Ne.child,Ne.tag){case 0:case 11:case 14:case 15:gu(4,Ne,Ne.return);break;case 1:Ll(Ne,Ne.return);var Be=Ne.stateNode;if(typeof Be.componentWillUnmount=="function"){S=Ne,g=Ne.return;try{c=S,Be.props=c.memoizedProps,Be.state=c.memoizedState,Be.componentWillUnmount()}catch(qe){bn(S,g,qe)}}break;case 5:Ll(Ne,Ne.return);break;case 22:if(Ne.memoizedState!==null){dS(Se);continue}}ze!==null?(ze.return=Ne,Fe=ze):dS(Se)}je=je.sibling}e:for(je=null,Se=a;;){if(Se.tag===5){if(je===null){je=Se;try{O=Se.stateNode,fe?(L=O.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none"):(se=Se.stateNode,ae=Se.memoizedProps.style,K=ae!=null&&ae.hasOwnProperty("display")?ae.display:null,se.style.display=Ft("display",K))}catch(qe){bn(a,a.return,qe)}}}else if(Se.tag===6){if(je===null)try{Se.stateNode.nodeValue=fe?"":Se.memoizedProps}catch(qe){bn(a,a.return,qe)}}else if((Se.tag!==22&&Se.tag!==23||Se.memoizedState===null||Se===a)&&Se.child!==null){Se.child.return=Se,Se=Se.child;continue}if(Se===a)break e;for(;Se.sibling===null;){if(Se.return===null||Se.return===a)break e;je===Se&&(je=null),Se=Se.return}je===Se&&(je=null),Se.sibling.return=Se.return,Se=Se.sibling}}break;case 19:Ar(c,a),qr(a),S&4&&iS(a);break;case 21:break;default:Ar(c,a),qr(a)}}function qr(a){var c=a.flags;if(c&2){try{e:{for(var g=a.return;g!==null;){if(rS(g)){var S=g;break e}g=g.return}throw Error(n(160))}switch(S.tag){case 5:var O=S.stateNode;S.flags&32&&(bt(O,""),S.flags&=-33);var L=aS(a);a_(a,L,O);break;case 3:case 4:var K=S.stateNode.containerInfo,se=aS(a);r_(a,se,K);break;default:throw Error(n(161))}}catch(ae){bn(a,a.return,ae)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function R4(a,c,g){Fe=a,cS(a)}function cS(a,c,g){for(var S=(a.mode&1)!==0;Fe!==null;){var O=Fe,L=O.child;if(O.tag===22&&S){var K=O.memoizedState!==null||nf;if(!K){var se=O.alternate,ae=se!==null&&se.memoizedState!==null||_s;se=nf;var fe=_s;if(nf=K,(_s=ae)&&!fe)for(Fe=O;Fe!==null;)K=Fe,ae=K.child,K.tag===22&&K.memoizedState!==null?mS(O):ae!==null?(ae.return=K,Fe=ae):mS(O);for(;L!==null;)Fe=L,cS(L),L=L.sibling;Fe=O,nf=se,_s=fe}uS(a)}else O.subtreeFlags&8772&&L!==null?(L.return=O,Fe=L):uS(a)}}function uS(a){for(;Fe!==null;){var c=Fe;if(c.flags&8772){var g=c.alternate;try{if(c.flags&8772)switch(c.tag){case 0:case 11:case 15:_s||sf(5,c);break;case 1:var S=c.stateNode;if(c.flags&4&&!_s)if(g===null)S.componentDidMount();else{var O=c.elementType===c.type?g.memoizedProps:Mr(c.type,g.memoizedProps);S.componentDidUpdate(O,g.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var L=c.updateQueue;L!==null&&dC(c,L,S);break;case 3:var K=c.updateQueue;if(K!==null){if(g=null,c.child!==null)switch(c.child.tag){case 5:g=c.child.stateNode;break;case 1:g=c.child.stateNode}dC(c,K,g)}break;case 5:var se=c.stateNode;if(g===null&&c.flags&4){g=se;var ae=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":ae.autoFocus&&g.focus();break;case"img":ae.src&&(g.src=ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var fe=c.alternate;if(fe!==null){var je=fe.memoizedState;if(je!==null){var Se=je.dehydrated;Se!==null&&Rn(Se)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}_s||c.flags&512&&s_(c)}catch(Ne){bn(c,c.return,Ne)}}if(c===a){Fe=null;break}if(g=c.sibling,g!==null){g.return=c.return,Fe=g;break}Fe=c.return}}function dS(a){for(;Fe!==null;){var c=Fe;if(c===a){Fe=null;break}var g=c.sibling;if(g!==null){g.return=c.return,Fe=g;break}Fe=c.return}}function mS(a){for(;Fe!==null;){var c=Fe;try{switch(c.tag){case 0:case 11:case 15:var g=c.return;try{sf(4,c)}catch(ae){bn(c,g,ae)}break;case 1:var S=c.stateNode;if(typeof S.componentDidMount=="function"){var O=c.return;try{S.componentDidMount()}catch(ae){bn(c,O,ae)}}var L=c.return;try{s_(c)}catch(ae){bn(c,L,ae)}break;case 5:var K=c.return;try{s_(c)}catch(ae){bn(c,K,ae)}}}catch(ae){bn(c,c.return,ae)}if(c===a){Fe=null;break}var se=c.sibling;if(se!==null){se.return=c.return,Fe=se;break}Fe=c.return}}var D4=Math.ceil,rf=C.ReactCurrentDispatcher,o_=C.ReactCurrentOwner,fr=C.ReactCurrentBatchConfig,Pt=0,ns=null,zn=null,ds=0,nr=0,Rl=hs(0),Wn=0,_u=null,vi=0,af=0,i_=0,yu=null,Us=null,l_=0,Dl=1/0,ya=null,of=!1,c_=null,go=null,lf=!1,_o=null,cf=0,vu=0,u_=null,uf=-1,df=0;function As(){return Pt&6?Qe():uf!==-1?uf:uf=Qe()}function yo(a){return a.mode&1?Pt&2&&ds!==0?ds&-ds:x4.transition!==null?(df===0&&(df=rn()),df):(a=vt,a!==0||(a=window.event,a=a===void 0?16:Wa(a.type)),a):1}function Or(a,c,g,S){if(50<vu)throw vu=0,u_=null,Error(n(185));Sn(a,g,S),(!(Pt&2)||a!==ns)&&(a===ns&&(!(Pt&2)&&(af|=g),Wn===4&&vo(a,ds)),Hs(a,S),g===1&&Pt===0&&!(c.mode&1)&&(Dl=Qe()+500,zm&&mo()))}function Hs(a,c){var g=a.callbackNode;Cn(a,c);var S=sn(a,a===ns?ds:0);if(S===0)g!==null&&Fn(g),a.callbackNode=null,a.callbackPriority=0;else if(c=S&-S,a.callbackPriority!==c){if(g!=null&&Fn(g),c===1)a.tag===0?v4(hS.bind(null,a)):Jj(hS.bind(null,a)),yg(function(){!(Pt&6)&&mo()}),g=null;else{switch(hl(S)){case 1:g=Ln;break;case 4:g=Cs;break;case 16:g=Jn;break;case 536870912:g=ie;break;default:g=Jn}g=wS(g,fS.bind(null,a))}a.callbackPriority=c,a.callbackNode=g}}function fS(a,c){if(uf=-1,df=0,Pt&6)throw Error(n(327));var g=a.callbackNode;if(zl()&&a.callbackNode!==g)return null;var S=sn(a,a===ns?ds:0);if(S===0)return null;if(S&30||S&a.expiredLanes||c)c=mf(a,S);else{c=S;var O=Pt;Pt|=2;var L=gS();(ns!==a||ds!==c)&&(ya=null,Dl=Qe()+500,bi(a,c));do try{F4();break}catch(se){pS(a,se)}while(!0);Mg(),rf.current=L,Pt=O,zn!==null?c=0:(ns=null,ds=0,c=Wn)}if(c!==0){if(c===2&&(O=en(a),O!==0&&(S=O,c=d_(a,O))),c===1)throw g=_u,bi(a,0),vo(a,S),Hs(a,Qe()),g;if(c===6)vo(a,S);else{if(O=a.current.alternate,!(S&30)&&!z4(O)&&(c=mf(a,S),c===2&&(L=en(a),L!==0&&(S=L,c=d_(a,L))),c===1))throw g=_u,bi(a,0),vo(a,S),Hs(a,Qe()),g;switch(a.finishedWork=O,a.finishedLanes=S,c){case 0:case 1:throw Error(n(345));case 2:wi(a,Us,ya);break;case 3:if(vo(a,S),(S&130023424)===S&&(c=l_+500-Qe(),10<c)){if(sn(a,0)!==0)break;if(O=a.suspendedLanes,(O&S)!==S){As(),a.pingedLanes|=a.suspendedLanes&O;break}a.timeoutHandle=ru(wi.bind(null,a,Us,ya),c);break}wi(a,Us,ya);break;case 4:if(vo(a,S),(S&4194240)===S)break;for(c=a.eventTimes,O=-1;0<S;){var K=31-Ce(S);L=1<<K,K=c[K],K>O&&(O=K),S&=~L}if(S=O,S=Qe()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*D4(S/1960))-S,10<S){a.timeoutHandle=ru(wi.bind(null,a,Us,ya),S);break}wi(a,Us,ya);break;case 5:wi(a,Us,ya);break;default:throw Error(n(329))}}}return Hs(a,Qe()),a.callbackNode===g?fS.bind(null,a):null}function d_(a,c){var g=yu;return a.current.memoizedState.isDehydrated&&(bi(a,c).flags|=256),a=mf(a,c),a!==2&&(c=Us,Us=g,c!==null&&m_(c)),a}function m_(a){Us===null?Us=a:Us.push.apply(Us,a)}function z4(a){for(var c=a;;){if(c.flags&16384){var g=c.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var S=0;S<g.length;S++){var O=g[S],L=O.getSnapshot;O=O.value;try{if(!Js(L(),O))return!1}catch{return!1}}}if(g=c.child,c.subtreeFlags&16384&&g!==null)g.return=c,c=g;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function vo(a,c){for(c&=~i_,c&=~af,a.suspendedLanes|=c,a.pingedLanes&=~c,a=a.expirationTimes;0<c;){var g=31-Ce(c),S=1<<g;a[g]=-1,c&=~S}}function hS(a){if(Pt&6)throw Error(n(327));zl();var c=sn(a,0);if(!(c&1))return Hs(a,Qe()),null;var g=mf(a,c);if(a.tag!==0&&g===2){var S=en(a);S!==0&&(c=S,g=d_(a,S))}if(g===1)throw g=_u,bi(a,0),vo(a,c),Hs(a,Qe()),g;if(g===6)throw Error(n(345));return a.finishedWork=a.current.alternate,a.finishedLanes=c,wi(a,Us,ya),Hs(a,Qe()),null}function f_(a,c){var g=Pt;Pt|=1;try{return a(c)}finally{Pt=g,Pt===0&&(Dl=Qe()+500,zm&&mo())}}function xi(a){_o!==null&&_o.tag===0&&!(Pt&6)&&zl();var c=Pt;Pt|=1;var g=fr.transition,S=vt;try{if(fr.transition=null,vt=1,a)return a()}finally{vt=S,fr.transition=g,Pt=c,!(Pt&6)&&mo()}}function h_(){nr=Rl.current,Ze(Rl)}function bi(a,c){a.finishedWork=null,a.finishedLanes=0;var g=a.timeoutHandle;if(g!==-1&&(a.timeoutHandle=-1,_g(g)),zn!==null)for(g=zn.return;g!==null;){var S=g;switch(Ng(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&Rm();break;case 3:$l(),Ze(qn),Ze(Hn),Rg();break;case 5:Pg(S);break;case 4:$l();break;case 13:Ze(gn);break;case 19:Ze(gn);break;case 10:kg(S.type._context);break;case 22:case 23:h_()}g=g.return}if(ns=a,zn=a=xo(a.current,null),ds=nr=c,Wn=0,_u=null,i_=af=vi=0,Us=yu=null,gi!==null){for(c=0;c<gi.length;c++)if(g=gi[c],S=g.interleaved,S!==null){g.interleaved=null;var O=S.next,L=g.pending;if(L!==null){var K=L.next;L.next=O,S.next=K}g.pending=S}gi=null}return a}function pS(a,c){do{var g=zn;try{if(Mg(),Km.current=Zm,Gm){for(var S=_n.memoizedState;S!==null;){var O=S.queue;O!==null&&(O.pending=null),S=S.next}Gm=!1}if(yi=0,ts=Vn=_n=null,du=!1,mu=0,o_.current=null,g===null||g.return===null){Wn=1,_u=c,zn=null;break}e:{var L=a,K=g.return,se=g,ae=c;if(c=ds,se.flags|=32768,ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var fe=ae,je=se,Se=je.tag;if(!(je.mode&1)&&(Se===0||Se===11||Se===15)){var Ne=je.alternate;Ne?(je.updateQueue=Ne.updateQueue,je.memoizedState=Ne.memoizedState,je.lanes=Ne.lanes):(je.updateQueue=null,je.memoizedState=null)}var ze=FC(K);if(ze!==null){ze.flags&=-257,BC(ze,K,se,L,c),ze.mode&1&&IC(L,fe,c),c=ze,ae=fe;var Be=c.updateQueue;if(Be===null){var qe=new Set;qe.add(ae),c.updateQueue=qe}else Be.add(ae);break e}else{if(!(c&1)){IC(L,fe,c),p_();break e}ae=Error(n(426))}}else if(cn&&se.mode&1){var Mn=FC(K);if(Mn!==null){!(Mn.flags&65536)&&(Mn.flags|=256),BC(Mn,K,se,L,c),Sg(Pl(ae,se));break e}}L=ae=Pl(ae,se),Wn!==4&&(Wn=2),yu===null?yu=[L]:yu.push(L),L=K;do{switch(L.tag){case 3:L.flags|=65536,c&=-c,L.lanes|=c;var ce=DC(L,ae,c);uC(L,ce);break e;case 1:se=ae;var oe=L.type,de=L.stateNode;if(!(L.flags&128)&&(typeof oe.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(go===null||!go.has(de)))){L.flags|=65536,c&=-c,L.lanes|=c;var Oe=zC(L,se,c);uC(L,Oe);break e}}L=L.return}while(L!==null)}yS(g)}catch(Ve){c=Ve,zn===g&&g!==null&&(zn=g=g.return);continue}break}while(!0)}function gS(){var a=rf.current;return rf.current=Zm,a===null?Zm:a}function p_(){(Wn===0||Wn===3||Wn===2)&&(Wn=4),ns===null||!(vi&268435455)&&!(af&268435455)||vo(ns,ds)}function mf(a,c){var g=Pt;Pt|=2;var S=gS();(ns!==a||ds!==c)&&(ya=null,bi(a,c));do try{I4();break}catch(O){pS(a,O)}while(!0);if(Mg(),Pt=g,rf.current=S,zn!==null)throw Error(n(261));return ns=null,ds=0,Wn}function I4(){for(;zn!==null;)_S(zn)}function F4(){for(;zn!==null&&!Zn();)_S(zn)}function _S(a){var c=bS(a.alternate,a,nr);a.memoizedProps=a.pendingProps,c===null?yS(a):zn=c,o_.current=null}function yS(a){var c=a;do{var g=c.alternate;if(a=c.return,c.flags&32768){if(g=$4(g,c),g!==null){g.flags&=32767,zn=g;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Wn=6,zn=null;return}}else if(g=T4(g,c,nr),g!==null){zn=g;return}if(c=c.sibling,c!==null){zn=c;return}zn=c=a}while(c!==null);Wn===0&&(Wn=5)}function wi(a,c,g){var S=vt,O=fr.transition;try{fr.transition=null,vt=1,B4(a,c,g,S)}finally{fr.transition=O,vt=S}return null}function B4(a,c,g,S){do zl();while(_o!==null);if(Pt&6)throw Error(n(327));g=a.finishedWork;var O=a.finishedLanes;if(g===null)return null;if(a.finishedWork=null,a.finishedLanes=0,g===a.current)throw Error(n(177));a.callbackNode=null,a.callbackPriority=0;var L=g.lanes|g.childLanes;if(aa(a,L),a===ns&&(zn=ns=null,ds=0),!(g.subtreeFlags&2064)&&!(g.flags&2064)||lf||(lf=!0,wS(Jn,function(){return zl(),null})),L=(g.flags&15990)!==0,g.subtreeFlags&15990||L){L=fr.transition,fr.transition=null;var K=vt;vt=1;var se=Pt;Pt|=4,o_.current=null,L4(a,g),lS(g,a),ug(nu),Es=!!tu,nu=tu=null,a.current=g,R4(g),Ht(),Pt=se,vt=K,fr.transition=L}else a.current=g;if(lf&&(lf=!1,_o=a,cf=O),L=a.pendingLanes,L===0&&(go=null),jt(g.stateNode),Hs(a,Qe()),c!==null)for(S=a.onRecoverableError,g=0;g<c.length;g++)O=c[g],S(O.value,{componentStack:O.stack,digest:O.digest});if(of)throw of=!1,a=c_,c_=null,a;return cf&1&&a.tag!==0&&zl(),L=a.pendingLanes,L&1?a===u_?vu++:(vu=0,u_=a):vu=0,mo(),null}function zl(){if(_o!==null){var a=hl(cf),c=fr.transition,g=vt;try{if(fr.transition=null,vt=16>a?16:a,_o===null)var S=!1;else{if(a=_o,_o=null,cf=0,Pt&6)throw Error(n(331));var O=Pt;for(Pt|=4,Fe=a.current;Fe!==null;){var L=Fe,K=L.child;if(Fe.flags&16){var se=L.deletions;if(se!==null){for(var ae=0;ae<se.length;ae++){var fe=se[ae];for(Fe=fe;Fe!==null;){var je=Fe;switch(je.tag){case 0:case 11:case 15:gu(8,je,L)}var Se=je.child;if(Se!==null)Se.return=je,Fe=Se;else for(;Fe!==null;){je=Fe;var Ne=je.sibling,ze=je.return;if(sS(je),je===fe){Fe=null;break}if(Ne!==null){Ne.return=ze,Fe=Ne;break}Fe=ze}}}var Be=L.alternate;if(Be!==null){var qe=Be.child;if(qe!==null){Be.child=null;do{var Mn=qe.sibling;qe.sibling=null,qe=Mn}while(qe!==null)}}Fe=L}}if(L.subtreeFlags&2064&&K!==null)K.return=L,Fe=K;else e:for(;Fe!==null;){if(L=Fe,L.flags&2048)switch(L.tag){case 0:case 11:case 15:gu(9,L,L.return)}var ce=L.sibling;if(ce!==null){ce.return=L.return,Fe=ce;break e}Fe=L.return}}var oe=a.current;for(Fe=oe;Fe!==null;){K=Fe;var de=K.child;if(K.subtreeFlags&2064&&de!==null)de.return=K,Fe=de;else e:for(K=oe;Fe!==null;){if(se=Fe,se.flags&2048)try{switch(se.tag){case 0:case 11:case 15:sf(9,se)}}catch(Ve){bn(se,se.return,Ve)}if(se===K){Fe=null;break e}var Oe=se.sibling;if(Oe!==null){Oe.return=se.return,Fe=Oe;break e}Fe=se.return}}if(Pt=O,mo(),Le&&typeof Le.onPostCommitFiberRoot=="function")try{Le.onPostCommitFiberRoot(xe,a)}catch{}S=!0}return S}finally{vt=g,fr.transition=c}}return!1}function vS(a,c,g){c=Pl(g,c),c=DC(a,c,1),a=ho(a,c,1),c=As(),a!==null&&(Sn(a,1,c),Hs(a,c))}function bn(a,c,g){if(a.tag===3)vS(a,a,g);else for(;c!==null;){if(c.tag===3){vS(c,a,g);break}else if(c.tag===1){var S=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(go===null||!go.has(S))){a=Pl(g,a),a=zC(c,a,1),c=ho(c,a,1),a=As(),c!==null&&(Sn(c,1,a),Hs(c,a));break}}c=c.return}}function U4(a,c,g){var S=a.pingCache;S!==null&&S.delete(c),c=As(),a.pingedLanes|=a.suspendedLanes&g,ns===a&&(ds&g)===g&&(Wn===4||Wn===3&&(ds&130023424)===ds&&500>Qe()-l_?bi(a,0):i_|=g),Hs(a,c)}function xS(a,c){c===0&&(a.mode&1?(c=Ut,Ut<<=1,!(Ut&130023424)&&(Ut=4194304)):c=1);var g=As();a=pa(a,c),a!==null&&(Sn(a,c,g),Hs(a,g))}function H4(a){var c=a.memoizedState,g=0;c!==null&&(g=c.retryLane),xS(a,g)}function q4(a,c){var g=0;switch(a.tag){case 13:var S=a.stateNode,O=a.memoizedState;O!==null&&(g=O.retryLane);break;case 19:S=a.stateNode;break;default:throw Error(n(314))}S!==null&&S.delete(c),xS(a,g)}var bS;bS=function(a,c,g){if(a!==null)if(a.memoizedProps!==c.pendingProps||qn.current)Bs=!0;else{if(!(a.lanes&g)&&!(c.flags&128))return Bs=!1,O4(a,c,g);Bs=!!(a.flags&131072)}else Bs=!1,cn&&c.flags&1048576&&eC(c,Fm,c.index);switch(c.lanes=0,c.tag){case 2:var S=c.type;tf(a,c),a=c.pendingProps;var O=Sl(c,Hn.current);Tl(c,g),O=Ig(null,c,S,a,O,g);var L=Fg();return c.flags|=1,typeof O=="object"&&O!==null&&typeof O.render=="function"&&O.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,Fs(S)?(L=!0,Dm(c)):L=!1,c.memoizedState=O.state!==null&&O.state!==void 0?O.state:null,Tg(c),O.updater=Jm,c.stateNode=O,O._reactInternals=c,Wg(c,S,a,g),c=Xg(null,c,S,!0,L,g)):(c.tag=0,cn&&L&&wg(c),ks(null,c,O,g),c=c.child),c;case 16:S=c.elementType;e:{switch(tf(a,c),a=c.pendingProps,O=S._init,S=O(S._payload),c.type=S,O=c.tag=W4(S),a=Mr(S,a),O){case 0:c=Gg(null,c,S,a,g);break e;case 1:c=YC(null,c,S,a,g);break e;case 11:c=UC(null,c,S,a,g);break e;case 14:c=HC(null,c,S,Mr(S.type,a),g);break e}throw Error(n(306,S,""))}return c;case 0:return S=c.type,O=c.pendingProps,O=c.elementType===S?O:Mr(S,O),Gg(a,c,S,O,g);case 1:return S=c.type,O=c.pendingProps,O=c.elementType===S?O:Mr(S,O),YC(a,c,S,O,g);case 3:e:{if(KC(c),a===null)throw Error(n(387));S=c.pendingProps,L=c.memoizedState,O=L.element,cC(a,c),Wm(c,S,null,g);var K=c.memoizedState;if(S=K.element,L.isDehydrated)if(L={element:S,isDehydrated:!1,cache:K.cache,pendingSuspenseBoundaries:K.pendingSuspenseBoundaries,transitions:K.transitions},c.updateQueue.baseState=L,c.memoizedState=L,c.flags&256){O=Pl(Error(n(423)),c),c=GC(a,c,S,g,O);break e}else if(S!==O){O=Pl(Error(n(424)),c),c=GC(a,c,S,g,O);break e}else for(tr=Br(c.stateNode.containerInfo.firstChild),er=c,cn=!0,Er=null,g=iC(c,null,S,g),c.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(kl(),S===O){c=_a(a,c,g);break e}ks(a,c,S,g)}c=c.child}return c;case 5:return mC(c),a===null&&Cg(c),S=c.type,O=c.pendingProps,L=a!==null?a.memoizedProps:null,K=O.children,su(S,O)?K=null:L!==null&&su(S,L)&&(c.flags|=32),WC(a,c),ks(a,c,K,g),c.child;case 6:return a===null&&Cg(c),null;case 13:return XC(a,c,g);case 4:return $g(c,c.stateNode.containerInfo),S=c.pendingProps,a===null?c.child=Al(c,null,S,g):ks(a,c,S,g),c.child;case 11:return S=c.type,O=c.pendingProps,O=c.elementType===S?O:Mr(S,O),UC(a,c,S,O,g);case 7:return ks(a,c,c.pendingProps,g),c.child;case 8:return ks(a,c,c.pendingProps.children,g),c.child;case 12:return ks(a,c,c.pendingProps.children,g),c.child;case 10:e:{if(S=c.type._context,O=c.pendingProps,L=c.memoizedProps,K=O.value,qt(Hm,S._currentValue),S._currentValue=K,L!==null)if(Js(L.value,K)){if(L.children===O.children&&!qn.current){c=_a(a,c,g);break e}}else for(L=c.child,L!==null&&(L.return=c);L!==null;){var se=L.dependencies;if(se!==null){K=L.child;for(var ae=se.firstContext;ae!==null;){if(ae.context===S){if(L.tag===1){ae=ga(-1,g&-g),ae.tag=2;var fe=L.updateQueue;if(fe!==null){fe=fe.shared;var je=fe.pending;je===null?ae.next=ae:(ae.next=je.next,je.next=ae),fe.pending=ae}}L.lanes|=g,ae=L.alternate,ae!==null&&(ae.lanes|=g),Ag(L.return,g,c),se.lanes|=g;break}ae=ae.next}}else if(L.tag===10)K=L.type===c.type?null:L.child;else if(L.tag===18){if(K=L.return,K===null)throw Error(n(341));K.lanes|=g,se=K.alternate,se!==null&&(se.lanes|=g),Ag(K,g,c),K=L.sibling}else K=L.child;if(K!==null)K.return=L;else for(K=L;K!==null;){if(K===c){K=null;break}if(L=K.sibling,L!==null){L.return=K.return,K=L;break}K=K.return}L=K}ks(a,c,O.children,g),c=c.child}return c;case 9:return O=c.type,S=c.pendingProps.children,Tl(c,g),O=dr(O),S=S(O),c.flags|=1,ks(a,c,S,g),c.child;case 14:return S=c.type,O=Mr(S,c.pendingProps),O=Mr(S.type,O),HC(a,c,S,O,g);case 15:return qC(a,c,c.type,c.pendingProps,g);case 17:return S=c.type,O=c.pendingProps,O=c.elementType===S?O:Mr(S,O),tf(a,c),c.tag=1,Fs(S)?(a=!0,Dm(c)):a=!1,Tl(c,g),LC(c,S,O),Wg(c,S,O,g),Xg(null,c,S,!0,a,g);case 19:return ZC(a,c,g);case 22:return VC(a,c,g)}throw Error(n(156,c.tag))};function wS(a,c){return js(a,c)}function V4(a,c,g,S){this.tag=a,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hr(a,c,g,S){return new V4(a,c,g,S)}function g_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function W4(a){if(typeof a=="function")return g_(a)?1:0;if(a!=null){if(a=a.$$typeof,a===D)return 11;if(a===z)return 14}return 2}function xo(a,c){var g=a.alternate;return g===null?(g=hr(a.tag,c,a.key,a.mode),g.elementType=a.elementType,g.type=a.type,g.stateNode=a.stateNode,g.alternate=a,a.alternate=g):(g.pendingProps=c,g.type=a.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=a.flags&14680064,g.childLanes=a.childLanes,g.lanes=a.lanes,g.child=a.child,g.memoizedProps=a.memoizedProps,g.memoizedState=a.memoizedState,g.updateQueue=a.updateQueue,c=a.dependencies,g.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},g.sibling=a.sibling,g.index=a.index,g.ref=a.ref,g}function ff(a,c,g,S,O,L){var K=2;if(S=a,typeof a=="function")g_(a)&&(K=1);else if(typeof a=="string")K=5;else e:switch(a){case k:return Ni(g.children,O,L,c);case $:K=8,O|=8;break;case T:return a=hr(12,g,c,O|2),a.elementType=T,a.lanes=L,a;case F:return a=hr(13,g,c,O),a.elementType=F,a.lanes=L,a;case R:return a=hr(19,g,c,O),a.elementType=R,a.lanes=L,a;case V:return hf(g,O,L,c);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case P:K=10;break e;case A:K=9;break e;case D:K=11;break e;case z:K=14;break e;case q:K=16,S=null;break e}throw Error(n(130,a==null?a:typeof a,""))}return c=hr(K,g,c,O),c.elementType=a,c.type=S,c.lanes=L,c}function Ni(a,c,g,S){return a=hr(7,a,S,c),a.lanes=g,a}function hf(a,c,g,S){return a=hr(22,a,S,c),a.elementType=V,a.lanes=g,a.stateNode={isHidden:!1},a}function __(a,c,g){return a=hr(6,a,null,c),a.lanes=g,a}function y_(a,c,g){return c=hr(4,a.children!==null?a.children:[],a.key,c),c.lanes=g,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}function Y4(a,c,g,S,O){this.tag=c,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bn(0),this.expirationTimes=Bn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bn(0),this.identifierPrefix=S,this.onRecoverableError=O,this.mutableSourceEagerHydrationData=null}function v_(a,c,g,S,O,L,K,se,ae){return a=new Y4(a,c,g,se,ae),c===1?(c=1,L===!0&&(c|=8)):c=0,L=hr(3,null,null,c),a.current=L,L.stateNode=a,L.memoizedState={element:S,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},Tg(L),a}function K4(a,c,g){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:S==null?null:""+S,children:a,containerInfo:c,implementation:g}}function NS(a){if(!a)return Sr;a=a._reactInternals;e:{if(fn(a)!==a||a.tag!==1)throw Error(n(170));var c=a;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(Fs(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(n(171))}if(a.tag===1){var g=a.type;if(Fs(g))return Qj(a,g,c)}return c}function jS(a,c,g,S,O,L,K,se,ae){return a=v_(g,S,!0,a,O,L,K,se,ae),a.context=NS(null),g=a.current,S=As(),O=yo(g),L=ga(S,O),L.callback=c??null,ho(g,L,O),a.current.lanes=O,Sn(a,O,S),Hs(a,S),a}function pf(a,c,g,S){var O=c.current,L=As(),K=yo(O);return g=NS(g),c.context===null?c.context=g:c.pendingContext=g,c=ga(L,K),c.payload={element:a},S=S===void 0?null:S,S!==null&&(c.callback=S),a=ho(O,c,K),a!==null&&(Or(a,O,K,L),Vm(a,O,K)),K}function gf(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function CS(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var g=a.retryLane;a.retryLane=g!==0&&g<c?g:c}}function x_(a,c){CS(a,c),(a=a.alternate)&&CS(a,c)}function G4(){return null}var SS=typeof reportError=="function"?reportError:function(a){console.error(a)};function b_(a){this._internalRoot=a}_f.prototype.render=b_.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(n(409));pf(a,c,null,null)},_f.prototype.unmount=b_.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;xi(function(){pf(null,a,null,null)}),c[Cr]=null}};function _f(a){this._internalRoot=a}_f.prototype.unstable_scheduleHydration=function(a){if(a){var c=Ha();a={blockedOn:null,target:a,priority:c};for(var g=0;g<Me.length&&c!==0&&c<Me[g].priority;g++);Me.splice(g,0,a),g===0&&ct(a)}};function w_(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function yf(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function ES(){}function X4(a,c,g,S,O){if(O){if(typeof S=="function"){var L=S;S=function(){var fe=gf(K);L.call(fe)}}var K=jS(c,S,a,0,null,!1,!1,"",ES);return a._reactRootContainer=K,a[Cr]=K.current,wl(a.nodeType===8?a.parentNode:a),xi(),K}for(;O=a.lastChild;)a.removeChild(O);if(typeof S=="function"){var se=S;S=function(){var fe=gf(ae);se.call(fe)}}var ae=v_(a,0,!1,null,null,!1,!1,"",ES);return a._reactRootContainer=ae,a[Cr]=ae.current,wl(a.nodeType===8?a.parentNode:a),xi(function(){pf(c,ae,g,S)}),ae}function vf(a,c,g,S,O){var L=g._reactRootContainer;if(L){var K=L;if(typeof O=="function"){var se=O;O=function(){var ae=gf(K);se.call(ae)}}pf(c,K,a,O)}else K=X4(g,c,a,O,S);return gf(K)}ti=function(a){switch(a.tag){case 3:var c=a.stateNode;if(c.current.memoizedState.isDehydrated){var g=At(c.pendingLanes);g!==0&&(Ba(c,g|1),Hs(c,Qe()),!(Pt&6)&&(Dl=Qe()+500,mo()))}break;case 13:xi(function(){var S=pa(a,1);if(S!==null){var O=As();Or(S,a,1,O)}}),x_(a,1)}},Ua=function(a){if(a.tag===13){var c=pa(a,134217728);if(c!==null){var g=As();Or(c,a,134217728,g)}x_(a,134217728)}},pl=function(a){if(a.tag===13){var c=yo(a),g=pa(a,c);if(g!==null){var S=As();Or(g,a,c,S)}x_(a,c)}},Ha=function(){return vt},qa=function(a,c){var g=vt;try{return vt=a,c()}finally{vt=g}},Nn=function(a,c,g){switch(c){case"input":if(le(a,g),c=g.name,g.type==="radio"&&c!=null){for(g=a;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<g.length;c++){var S=g[c];if(S!==a&&S.form===a.form){var O=Cl(S);if(!O)throw Error(n(90));ye(S),le(S,O)}}}break;case"textarea":Ye(a,g);break;case"select":c=g.value,c!=null&&Ie(a,!!g.multiple,c,!1)}},at=f_,os=xi;var Q4={usingClientEntryPoint:!1,Events:[mi,co,Cl,Xt,Nt,f_]},xu={findFiberByHostInstance:da,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Z4={bundleType:xu.bundleType,version:xu.version,rendererPackageName:xu.rendererPackageName,rendererConfig:xu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Qn(a),a===null?null:a.stateNode},findFiberByHostInstance:xu.findFiberByHostInstance||G4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xf.isDisabled&&xf.supportsFiber)try{xe=xf.inject(Z4),Le=xf}catch{}}return Os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q4,Os.createPortal=function(a,c){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!w_(c))throw Error(n(200));return K4(a,c,null,g)},Os.createRoot=function(a,c){if(!w_(a))throw Error(n(299));var g=!1,S="",O=SS;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(S=c.identifierPrefix),c.onRecoverableError!==void 0&&(O=c.onRecoverableError)),c=v_(a,1,!1,null,null,g,!1,S,O),a[Cr]=c.current,wl(a.nodeType===8?a.parentNode:a),new b_(c)},Os.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=Qn(c),a=a===null?null:a.stateNode,a},Os.flushSync=function(a){return xi(a)},Os.hydrate=function(a,c,g){if(!yf(c))throw Error(n(200));return vf(null,a,c,!0,g)},Os.hydrateRoot=function(a,c,g){if(!w_(a))throw Error(n(405));var S=g!=null&&g.hydratedSources||null,O=!1,L="",K=SS;if(g!=null&&(g.unstable_strictMode===!0&&(O=!0),g.identifierPrefix!==void 0&&(L=g.identifierPrefix),g.onRecoverableError!==void 0&&(K=g.onRecoverableError)),c=jS(c,null,a,1,g??null,O,!1,L,K),a[Cr]=c.current,wl(a),S)for(a=0;a<S.length;a++)g=S[a],O=g._getVersion,O=O(g._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[g,O]:c.mutableSourceEagerHydrationData.push(g,O);return new _f(c)},Os.render=function(a,c,g){if(!yf(c))throw Error(n(200));return vf(null,a,c,!1,g)},Os.unmountComponentAtNode=function(a){if(!yf(a))throw Error(n(40));return a._reactRootContainer?(xi(function(){vf(null,null,a,!1,function(){a._reactRootContainer=null,a[Cr]=null})}),!0):!1},Os.unstable_batchedUpdates=f_,Os.unstable_renderSubtreeIntoContainer=function(a,c,g,S){if(!yf(g))throw Error(n(200));if(a==null||a._reactInternals===void 0)throw Error(n(38));return vf(a,c,g,!1,S)},Os.version="18.3.1-next-f1338f8080-20240426",Os}function z_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(z_)}catch(e){console.error(e)}}z_(),P_.exports=PS();var I_=P_.exports,F_=I_;Nf.createRoot=F_.createRoot,Nf.hydrateRoot=F_.hydrateRoot;var ji=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},LS={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},RS=(zj=class{constructor(){Ke(this,Ta,LS);Ke(this,Kp,!1)}setTimeoutProvider(e){Re(this,Ta,e)}setTimeout(e,t){return re(this,Ta).setTimeout(e,t)}clearTimeout(e){re(this,Ta).clearTimeout(e)}setInterval(e,t){return re(this,Ta).setInterval(e,t)}clearInterval(e){re(this,Ta).clearInterval(e)}},Ta=new WeakMap,Kp=new WeakMap,zj),jo=new RS;function DS(e){setTimeout(e,0)}var Co=typeof window>"u"||"Deno"in globalThis;function ys(){}function zS(e,t){return typeof e=="function"?e(t):e}function Sf(e){return typeof e=="number"&&e>=0&&e!==1/0}function B_(e,t){return Math.max(e+(t||0)-Date.now(),0)}function xa(e,t){return typeof e=="function"?e(t):e}function sr(e,t){return typeof e=="function"?e(t):e}function U_(e,t){const{type:n="all",exact:s,fetchStatus:r,predicate:i,queryKey:l,stale:u}=e;if(l){if(s){if(t.queryHash!==Ef(l,t.options))return!1}else if(!Il(t.queryKey,l))return!1}if(n!=="all"){const d=t.isActive();if(n==="active"&&!d||n==="inactive"&&d)return!1}return!(typeof u=="boolean"&&t.isStale()!==u||r&&r!==t.state.fetchStatus||i&&!i(t))}function H_(e,t){const{exact:n,status:s,predicate:r,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(n){if(So(t.options.mutationKey)!==So(i))return!1}else if(!Il(t.options.mutationKey,i))return!1}return!(s&&t.state.status!==s||r&&!r(t))}function Ef(e,t){return((t==null?void 0:t.queryKeyHashFn)||So)(e)}function So(e){return JSON.stringify(e,(t,n)=>Mf(n)?Object.keys(n).sort().reduce((s,r)=>(s[r]=n[r],s),{}):n)}function Il(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Il(e[n],t[n])):!1}var IS=Object.prototype.hasOwnProperty;function q_(e,t){if(e===t)return e;const n=V_(e)&&V_(t);if(!n&&!(Mf(e)&&Mf(t)))return t;const r=(n?e:Object.keys(e)).length,i=n?t:Object.keys(t),l=i.length,u=n?new Array(l):{};let d=0;for(let h=0;h<l;h++){const p=n?h:i[h],m=e[p],f=t[p];if(m===f){u[p]=m,(n?h<r:IS.call(e,p))&&d++;continue}if(m===null||f===null||typeof m!="object"||typeof f!="object"){u[p]=f;continue}const y=q_(m,f);u[p]=y,y===m&&d++}return r===l&&d===r?e:u}function wu(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function V_(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Mf(e){if(!W_(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!W_(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function W_(e){return Object.prototype.toString.call(e)==="[object Object]"}function FS(e){return new Promise(t=>{jo.setTimeout(t,e)})}function kf(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?q_(e,t):t}function BS(e,t,n=0){const s=[...e,t];return n&&s.length>n?s.slice(1):s}function US(e,t,n=0){const s=[t,...e];return n&&s.length>n?s.slice(0,-1):s}var Af=Symbol();function Y_(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===Af?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function K_(e,t){return typeof e=="function"?e(...t):!!e}var HS=(Ij=class extends ji{constructor(){super();Ke(this,Wo);Ke(this,$a);Ke(this,nl);Re(this,nl,t=>{if(!Co&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){re(this,$a)||this.setEventListener(re(this,nl))}onUnsubscribe(){var t;this.hasListeners()||((t=re(this,$a))==null||t.call(this),Re(this,$a,void 0))}setEventListener(t){var n;Re(this,nl,t),(n=re(this,$a))==null||n.call(this),Re(this,$a,t(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(t){re(this,Wo)!==t&&(Re(this,Wo,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof re(this,Wo)=="boolean"?re(this,Wo):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Wo=new WeakMap,$a=new WeakMap,nl=new WeakMap,Ij),Of=new HS;function Tf(){let e,t;const n=new Promise((r,i)=>{e=r,t=i});n.status="pending",n.catch(()=>{});function s(r){Object.assign(n,r),delete n.resolve,delete n.reject}return n.resolve=r=>{s({status:"fulfilled",value:r}),e(r)},n.reject=r=>{s({status:"rejected",reason:r}),t(r)},n}var qS=DS;function VS(){let e=[],t=0,n=u=>{u()},s=u=>{u()},r=qS;const i=u=>{t?e.push(u):r(()=>{n(u)})},l=()=>{const u=e;e=[],u.length&&r(()=>{s(()=>{u.forEach(d=>{n(d)})})})};return{batch:u=>{let d;t++;try{d=u()}finally{t--,t||l()}return d},batchCalls:u=>(...d)=>{i(()=>{u(...d)})},schedule:i,setNotifyFunction:u=>{n=u},setBatchNotifyFunction:u=>{s=u},setScheduler:u=>{r=u}}}var In=VS(),WS=(Fj=class extends ji{constructor(){super();Ke(this,sl,!0);Ke(this,Pa);Ke(this,rl);Re(this,rl,t=>{if(!Co&&window.addEventListener){const n=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",s)}}})}onSubscribe(){re(this,Pa)||this.setEventListener(re(this,rl))}onUnsubscribe(){var t;this.hasListeners()||((t=re(this,Pa))==null||t.call(this),Re(this,Pa,void 0))}setEventListener(t){var n;Re(this,rl,t),(n=re(this,Pa))==null||n.call(this),Re(this,Pa,t(this.setOnline.bind(this)))}setOnline(t){re(this,sl)!==t&&(Re(this,sl,t),this.listeners.forEach(s=>{s(t)}))}isOnline(){return re(this,sl)}},sl=new WeakMap,Pa=new WeakMap,rl=new WeakMap,Fj),Nu=new WS;function YS(e){return Math.min(1e3*2**e,3e4)}function G_(e){return(e??"online")==="online"?Nu.isOnline():!0}var $f=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function X_(e){let t=!1,n=0,s;const r=Tf(),i=()=>r.status!=="pending",l=_=>{var v;if(!i()){const w=new $f(_);f(w),(v=e.onCancel)==null||v.call(e,w)}},u=()=>{t=!0},d=()=>{t=!1},h=()=>Of.isFocused()&&(e.networkMode==="always"||Nu.isOnline())&&e.canRun(),p=()=>G_(e.networkMode)&&e.canRun(),m=_=>{i()||(s==null||s(),r.resolve(_))},f=_=>{i()||(s==null||s(),r.reject(_))},y=()=>new Promise(_=>{var v;s=w=>{(i()||h())&&_(w)},(v=e.onPause)==null||v.call(e)}).then(()=>{var _;s=void 0,i()||(_=e.onContinue)==null||_.call(e)}),x=()=>{if(i())return;let _;const v=n===0?e.initialPromise:void 0;try{_=v??e.fn()}catch(w){_=Promise.reject(w)}Promise.resolve(_).then(m).catch(w=>{var E;if(i())return;const M=e.retry??(Co?0:3),N=e.retryDelay??YS,C=typeof N=="function"?N(n,w):N,j=M===!0||typeof M=="number"&&n<M||typeof M=="function"&&M(n,w);if(t||!j){f(w);return}n++,(E=e.onFail)==null||E.call(e,n,w),FS(C).then(()=>h()?void 0:y()).then(()=>{t?f(w):x()})})};return{promise:r,status:()=>r.status,cancel:l,continue:()=>(s==null||s(),r),cancelRetry:u,continueRetry:d,canStart:p,start:()=>(p()?x():y().then(x),r)}}var Q_=(Bj=class{constructor(){Ke(this,Yo)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Sf(this.gcTime)&&Re(this,Yo,jo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Co?1/0:5*60*1e3))}clearGcTimeout(){re(this,Yo)&&(jo.clearTimeout(re(this,Yo)),Re(this,Yo,void 0))}},Yo=new WeakMap,Bj),KS={NODE_ENV:"production"},GS=(Uj=class extends Q_{constructor(t){super();Ke(this,br);Ke(this,Ko);Ke(this,al);Ke(this,ar);Ke(this,Go);Ke(this,Kn);Ke(this,Dc);Ke(this,Xo);Re(this,Xo,!1),Re(this,Dc,t.defaultOptions),this.setOptions(t.options),this.observers=[],Re(this,Go,t.client),Re(this,ar,re(this,Go).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Re(this,Ko,J_(this.options)),this.state=t.state??re(this,Ko),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=re(this,Kn))==null?void 0:t.promise}setOptions(t){if(this.options={...re(this,Dc),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=J_(this.options);n.data!==void 0&&(this.setData(n.data,{updatedAt:n.dataUpdatedAt,manual:!0}),Re(this,Ko,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&re(this,ar).remove(this)}setData(t,n){const s=kf(this.state.data,t,this.options);return _t(this,br,va).call(this,{data:s,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),s}setState(t,n){_t(this,br,va).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var s,r;const n=(s=re(this,Kn))==null?void 0:s.promise;return(r=re(this,Kn))==null||r.cancel(t),n?n.then(ys).catch(ys):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(re(this,Ko))}isActive(){return this.observers.some(t=>sr(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Af||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>xa(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!B_(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=re(this,Kn))==null||n.continue()}onOnline(){var n;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=re(this,Kn))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),re(this,ar).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(re(this,Kn)&&(re(this,Xo)?re(this,Kn).cancel({revert:!0}):re(this,Kn).cancelRetry()),this.scheduleGc()),re(this,ar).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||_t(this,br,va).call(this,{type:"invalidate"})}async fetch(t,n){var d,h,p,m,f,y,x,_,v,w,M,N;if(this.state.fetchStatus!=="idle"&&((d=re(this,Kn))==null?void 0:d.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(re(this,Kn))return re(this,Kn).continueRetry(),re(this,Kn).promise}if(t&&this.setOptions(t),!this.options.queryFn){const C=this.observers.find(j=>j.options.queryFn);C&&this.setOptions(C.options)}const s=new AbortController,r=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(Re(this,Xo,!0),s.signal)})},i=()=>{const C=Y_(this.options,n),E=(()=>{const k={client:re(this,Go),queryKey:this.queryKey,meta:this.meta};return r(k),k})();return Re(this,Xo,!1),this.options.persister?this.options.persister(C,E,this):C(E)},u=(()=>{const C={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:re(this,Go),state:this.state,fetchFn:i};return r(C),C})();(h=this.options.behavior)==null||h.onFetch(u,this),Re(this,al,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((p=u.fetchOptions)==null?void 0:p.meta))&&_t(this,br,va).call(this,{type:"fetch",meta:(m=u.fetchOptions)==null?void 0:m.meta}),Re(this,Kn,X_({initialPromise:n==null?void 0:n.initialPromise,fn:u.fetchFn,onCancel:C=>{C instanceof $f&&C.revert&&this.setState({...re(this,al),fetchStatus:"idle"}),s.abort()},onFail:(C,j)=>{_t(this,br,va).call(this,{type:"failed",failureCount:C,error:j})},onPause:()=>{_t(this,br,va).call(this,{type:"pause"})},onContinue:()=>{_t(this,br,va).call(this,{type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0}));try{const C=await re(this,Kn).start();if(C===void 0)throw KS.NODE_ENV,new Error(`${this.queryHash} data is undefined`);return this.setData(C),(y=(f=re(this,ar).config).onSuccess)==null||y.call(f,C,this),(_=(x=re(this,ar).config).onSettled)==null||_.call(x,C,this.state.error,this),C}catch(C){if(C instanceof $f){if(C.silent)return re(this,Kn).promise;if(C.revert){if(this.state.data===void 0)throw C;return this.state.data}}throw _t(this,br,va).call(this,{type:"error",error:C}),(w=(v=re(this,ar).config).onError)==null||w.call(v,C,this),(N=(M=re(this,ar).config).onSettled)==null||N.call(M,this.state.data,C,this),C}finally{this.scheduleGc()}}},Ko=new WeakMap,al=new WeakMap,ar=new WeakMap,Go=new WeakMap,Kn=new WeakMap,Dc=new WeakMap,Xo=new WeakMap,br=new WeakSet,va=function(t){const n=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...Z_(s.data,this.options),fetchMeta:t.meta??null};case"success":const r={...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Re(this,al,t.manual?r:void 0),r;case"error":const i=t.error;return{...s,error:i,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=n(this.state),In.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),re(this,ar).notify({query:this,type:"updated",action:t})})},Uj);function Z_(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:G_(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function J_(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,s=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var XS=(Hj=class extends ji{constructor(t,n){super();Ke(this,It);Ke(this,Ls);Ke(this,wt);Ke(this,zc);Ke(this,xs);Ke(this,Qo);Ke(this,ol);Ke(this,ea);Ke(this,La);Ke(this,Ic);Ke(this,il);Ke(this,ll);Ke(this,Zo);Ke(this,Jo);Ke(this,Ra);Ke(this,cl,new Set);this.options=n,Re(this,Ls,t),Re(this,La,null),Re(this,ea,Tf()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(re(this,wt).addObserver(this),ey(re(this,wt),this.options)?_t(this,It,bu).call(this):this.updateResult(),_t(this,It,E_).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Pf(re(this,wt),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Pf(re(this,wt),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,_t(this,It,M_).call(this),_t(this,It,k_).call(this),re(this,wt).removeObserver(this)}setOptions(t){const n=this.options,s=re(this,wt);if(this.options=re(this,Ls).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof sr(this.options.enabled,re(this,wt))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");_t(this,It,A_).call(this),re(this,wt).setOptions(this.options),n._defaulted&&!wu(this.options,n)&&re(this,Ls).getQueryCache().notify({type:"observerOptionsUpdated",query:re(this,wt),observer:this});const r=this.hasListeners();r&&ty(re(this,wt),s,this.options,n)&&_t(this,It,bu).call(this),this.updateResult(),r&&(re(this,wt)!==s||sr(this.options.enabled,re(this,wt))!==sr(n.enabled,re(this,wt))||xa(this.options.staleTime,re(this,wt))!==xa(n.staleTime,re(this,wt)))&&_t(this,It,j_).call(this);const i=_t(this,It,C_).call(this);r&&(re(this,wt)!==s||sr(this.options.enabled,re(this,wt))!==sr(n.enabled,re(this,wt))||i!==re(this,Ra))&&_t(this,It,S_).call(this,i)}getOptimisticResult(t){const n=re(this,Ls).getQueryCache().build(re(this,Ls),t),s=this.createResult(n,t);return ZS(this,s)&&(Re(this,xs,s),Re(this,ol,this.options),Re(this,Qo,re(this,wt).state)),s}getCurrentResult(){return re(this,xs)}trackResult(t,n){return new Proxy(t,{get:(s,r)=>(this.trackProp(r),n==null||n(r),r==="promise"&&!this.options.experimental_prefetchInRender&&re(this,ea).status==="pending"&&re(this,ea).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(s,r))})}trackProp(t){re(this,cl).add(t)}getCurrentQuery(){return re(this,wt)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=re(this,Ls).defaultQueryOptions(t),s=re(this,Ls).getQueryCache().build(re(this,Ls),n);return s.fetch().then(()=>this.createResult(s,n))}fetch(t){return _t(this,It,bu).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),re(this,xs)))}createResult(t,n){var T;const s=re(this,wt),r=this.options,i=re(this,xs),l=re(this,Qo),u=re(this,ol),h=t!==s?t.state:re(this,zc),{state:p}=t;let m={...p},f=!1,y;if(n._optimisticResults){const P=this.hasListeners(),A=!P&&ey(t,n),D=P&&ty(t,s,n,r);(A||D)&&(m={...m,...Z_(p.data,t.options)}),n._optimisticResults==="isRestoring"&&(m.fetchStatus="idle")}let{error:x,errorUpdatedAt:_,status:v}=m;y=m.data;let w=!1;if(n.placeholderData!==void 0&&y===void 0&&v==="pending"){let P;i!=null&&i.isPlaceholderData&&n.placeholderData===(u==null?void 0:u.placeholderData)?(P=i.data,w=!0):P=typeof n.placeholderData=="function"?n.placeholderData((T=re(this,ll))==null?void 0:T.state.data,re(this,ll)):n.placeholderData,P!==void 0&&(v="success",y=kf(i==null?void 0:i.data,P,n),f=!0)}if(n.select&&y!==void 0&&!w)if(i&&y===(l==null?void 0:l.data)&&n.select===re(this,Ic))y=re(this,il);else try{Re(this,Ic,n.select),y=n.select(y),y=kf(i==null?void 0:i.data,y,n),Re(this,il,y),Re(this,La,null)}catch(P){Re(this,La,P)}re(this,La)&&(x=re(this,La),y=re(this,il),_=Date.now(),v="error");const M=m.fetchStatus==="fetching",N=v==="pending",C=v==="error",j=N&&M,E=y!==void 0,$={status:v,fetchStatus:m.fetchStatus,isPending:N,isSuccess:v==="success",isError:C,isInitialLoading:j,isLoading:j,data:y,dataUpdatedAt:m.dataUpdatedAt,error:x,errorUpdatedAt:_,failureCount:m.fetchFailureCount,failureReason:m.fetchFailureReason,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>h.dataUpdateCount||m.errorUpdateCount>h.errorUpdateCount,isFetching:M,isRefetching:M&&!N,isLoadingError:C&&!E,isPaused:m.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:C&&E,isStale:Lf(t,n),refetch:this.refetch,promise:re(this,ea),isEnabled:sr(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const P=F=>{$.status==="error"?F.reject($.error):$.data!==void 0&&F.resolve($.data)},A=()=>{const F=Re(this,ea,$.promise=Tf());P(F)},D=re(this,ea);switch(D.status){case"pending":t.queryHash===s.queryHash&&P(D);break;case"fulfilled":($.status==="error"||$.data!==D.value)&&A();break;case"rejected":($.status!=="error"||$.error!==D.reason)&&A();break}}return $}updateResult(){const t=re(this,xs),n=this.createResult(re(this,wt),this.options);if(Re(this,Qo,re(this,wt).state),Re(this,ol,this.options),re(this,Qo).data!==void 0&&Re(this,ll,re(this,wt)),wu(n,t))return;Re(this,xs,n);const s=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!re(this,cl).size)return!0;const l=new Set(i??re(this,cl));return this.options.throwOnError&&l.add("error"),Object.keys(re(this,xs)).some(u=>{const d=u;return re(this,xs)[d]!==t[d]&&l.has(d)})};_t(this,It,kS).call(this,{listeners:s()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&_t(this,It,E_).call(this)}},Ls=new WeakMap,wt=new WeakMap,zc=new WeakMap,xs=new WeakMap,Qo=new WeakMap,ol=new WeakMap,ea=new WeakMap,La=new WeakMap,Ic=new WeakMap,il=new WeakMap,ll=new WeakMap,Zo=new WeakMap,Jo=new WeakMap,Ra=new WeakMap,cl=new WeakMap,It=new WeakSet,bu=function(t){_t(this,It,A_).call(this);let n=re(this,wt).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(ys)),n},j_=function(){_t(this,It,M_).call(this);const t=xa(this.options.staleTime,re(this,wt));if(Co||re(this,xs).isStale||!Sf(t))return;const s=B_(re(this,xs).dataUpdatedAt,t)+1;Re(this,Zo,jo.setTimeout(()=>{re(this,xs).isStale||this.updateResult()},s))},C_=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(re(this,wt)):this.options.refetchInterval)??!1},S_=function(t){_t(this,It,k_).call(this),Re(this,Ra,t),!(Co||sr(this.options.enabled,re(this,wt))===!1||!Sf(re(this,Ra))||re(this,Ra)===0)&&Re(this,Jo,jo.setInterval(()=>{(this.options.refetchIntervalInBackground||Of.isFocused())&&_t(this,It,bu).call(this)},re(this,Ra)))},E_=function(){_t(this,It,j_).call(this),_t(this,It,S_).call(this,_t(this,It,C_).call(this))},M_=function(){re(this,Zo)&&(jo.clearTimeout(re(this,Zo)),Re(this,Zo,void 0))},k_=function(){re(this,Jo)&&(jo.clearInterval(re(this,Jo)),Re(this,Jo,void 0))},A_=function(){const t=re(this,Ls).getQueryCache().build(re(this,Ls),this.options);if(t===re(this,wt))return;const n=re(this,wt);Re(this,wt,t),Re(this,zc,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},kS=function(t){In.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(re(this,xs))}),re(this,Ls).getQueryCache().notify({query:re(this,wt),type:"observerResultsUpdated"})})},Hj);function QS(e,t){return sr(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function ey(e,t){return QS(e,t)||e.state.data!==void 0&&Pf(e,t,t.refetchOnMount)}function Pf(e,t,n){if(sr(t.enabled,e)!==!1&&xa(t.staleTime,e)!=="static"){const s=typeof n=="function"?n(e):n;return s==="always"||s!==!1&&Lf(e,t)}return!1}function ty(e,t,n,s){return(e!==t||sr(s.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&Lf(e,n)}function Lf(e,t){return sr(t.enabled,e)!==!1&&e.isStaleByTime(xa(t.staleTime,e))}function ZS(e,t){return!wu(e.getCurrentResult(),t)}function ny(e){return{onFetch:(t,n)=>{var p,m,f,y,x;const s=t.options,r=(f=(m=(p=t.fetchOptions)==null?void 0:p.meta)==null?void 0:m.fetchMore)==null?void 0:f.direction,i=((y=t.state.data)==null?void 0:y.pages)||[],l=((x=t.state.data)==null?void 0:x.pageParams)||[];let u={pages:[],pageParams:[]},d=0;const h=async()=>{let _=!1;const v=N=>{Object.defineProperty(N,"signal",{enumerable:!0,get:()=>(t.signal.aborted?_=!0:t.signal.addEventListener("abort",()=>{_=!0}),t.signal)})},w=Y_(t.options,t.fetchOptions),M=async(N,C,j)=>{if(_)return Promise.reject();if(C==null&&N.pages.length)return Promise.resolve(N);const k=(()=>{const A={client:t.client,queryKey:t.queryKey,pageParam:C,direction:j?"backward":"forward",meta:t.options.meta};return v(A),A})(),$=await w(k),{maxPages:T}=t.options,P=j?US:BS;return{pages:P(N.pages,$,T),pageParams:P(N.pageParams,C,T)}};if(r&&i.length){const N=r==="backward",C=N?JS:sy,j={pages:i,pageParams:l},E=C(s,j);u=await M(j,E,N)}else{const N=e??i.length;do{const C=d===0?l[0]??s.initialPageParam:sy(s,u);if(d>0&&C==null)break;u=await M(u,C),d++}while(d<N)}return u};t.options.persister?t.fetchFn=()=>{var _,v;return(v=(_=t.options).persister)==null?void 0:v.call(_,h,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=h}}}function sy(e,{pages:t,pageParams:n}){const s=t.length-1;return t.length>0?e.getNextPageParam(t[s],t,n[s],n):void 0}function JS(e,{pages:t,pageParams:n}){var s;return t.length>0?(s=e.getPreviousPageParam)==null?void 0:s.call(e,t[0],t,n[0],n):void 0}var eE=(qj=class extends Q_{constructor(t){super();Ke(this,zr);Ke(this,Fc);Ke(this,Dr);Ke(this,bs);Ke(this,ei);Re(this,Fc,t.client),this.mutationId=t.mutationId,Re(this,bs,t.mutationCache),Re(this,Dr,[]),this.state=t.state||ry(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){re(this,Dr).includes(t)||(re(this,Dr).push(t),this.clearGcTimeout(),re(this,bs).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Re(this,Dr,re(this,Dr).filter(n=>n!==t)),this.scheduleGc(),re(this,bs).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){re(this,Dr).length||(this.state.status==="pending"?this.scheduleGc():re(this,bs).remove(this))}continue(){var t;return((t=re(this,ei))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var l,u,d,h,p,m,f,y,x,_,v,w,M,N,C,j,E,k,$,T;const n=()=>{_t(this,zr,wo).call(this,{type:"continue"})},s={client:re(this,Fc),meta:this.options.meta,mutationKey:this.options.mutationKey};Re(this,ei,X_({fn:()=>this.options.mutationFn?this.options.mutationFn(t,s):Promise.reject(new Error("No mutationFn found")),onFail:(P,A)=>{_t(this,zr,wo).call(this,{type:"failed",failureCount:P,error:A})},onPause:()=>{_t(this,zr,wo).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>re(this,bs).canRun(this)}));const r=this.state.status==="pending",i=!re(this,ei).canStart();try{if(r)n();else{_t(this,zr,wo).call(this,{type:"pending",variables:t,isPaused:i}),await((u=(l=re(this,bs).config).onMutate)==null?void 0:u.call(l,t,this,s));const A=await((h=(d=this.options).onMutate)==null?void 0:h.call(d,t,s));A!==this.state.context&&_t(this,zr,wo).call(this,{type:"pending",context:A,variables:t,isPaused:i})}const P=await re(this,ei).start();return await((m=(p=re(this,bs).config).onSuccess)==null?void 0:m.call(p,P,t,this.state.context,this,s)),await((y=(f=this.options).onSuccess)==null?void 0:y.call(f,P,t,this.state.context,s)),await((_=(x=re(this,bs).config).onSettled)==null?void 0:_.call(x,P,null,this.state.variables,this.state.context,this,s)),await((w=(v=this.options).onSettled)==null?void 0:w.call(v,P,null,t,this.state.context,s)),_t(this,zr,wo).call(this,{type:"success",data:P}),P}catch(P){try{throw await((N=(M=re(this,bs).config).onError)==null?void 0:N.call(M,P,t,this.state.context,this,s)),await((j=(C=this.options).onError)==null?void 0:j.call(C,P,t,this.state.context,s)),await((k=(E=re(this,bs).config).onSettled)==null?void 0:k.call(E,void 0,P,this.state.variables,this.state.context,this,s)),await((T=($=this.options).onSettled)==null?void 0:T.call($,void 0,P,t,this.state.context,s)),P}finally{_t(this,zr,wo).call(this,{type:"error",error:P})}}finally{re(this,bs).runNext(this)}}},Fc=new WeakMap,Dr=new WeakMap,bs=new WeakMap,ei=new WeakMap,zr=new WeakSet,wo=function(t){const n=s=>{switch(t.type){case"failed":return{...s,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),In.batch(()=>{re(this,Dr).forEach(s=>{s.onMutationUpdate(t)}),re(this,bs).notify({mutation:this,type:"updated",action:t})})},qj);function ry(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var tE=(Vj=class extends ji{constructor(t={}){super();Ke(this,ta);Ke(this,wr);Ke(this,Bc);this.config=t,Re(this,ta,new Set),Re(this,wr,new Map),Re(this,Bc,0)}build(t,n,s){const r=new eE({client:t,mutationCache:this,mutationId:++bf(this,Bc)._,options:t.defaultMutationOptions(n),state:s});return this.add(r),r}add(t){re(this,ta).add(t);const n=ju(t);if(typeof n=="string"){const s=re(this,wr).get(n);s?s.push(t):re(this,wr).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(re(this,ta).delete(t)){const n=ju(t);if(typeof n=="string"){const s=re(this,wr).get(n);if(s)if(s.length>1){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}else s[0]===t&&re(this,wr).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=ju(t);if(typeof n=="string"){const s=re(this,wr).get(n),r=s==null?void 0:s.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){var s;const n=ju(t);if(typeof n=="string"){const r=(s=re(this,wr).get(n))==null?void 0:s.find(i=>i!==t&&i.state.isPaused);return(r==null?void 0:r.continue())??Promise.resolve()}else return Promise.resolve()}clear(){In.batch(()=>{re(this,ta).forEach(t=>{this.notify({type:"removed",mutation:t})}),re(this,ta).clear(),re(this,wr).clear()})}getAll(){return Array.from(re(this,ta))}find(t){const n={exact:!0,...t};return this.getAll().find(s=>H_(n,s))}findAll(t={}){return this.getAll().filter(n=>H_(t,n))}notify(t){In.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return In.batch(()=>Promise.all(t.map(n=>n.continue().catch(ys))))}},ta=new WeakMap,wr=new WeakMap,Bc=new WeakMap,Vj);function ju(e){var t;return(t=e.options.scope)==null?void 0:t.id}var nE=(Wj=class extends ji{constructor(t,n){super();Ke(this,ra);Ke(this,na);Ke(this,Da);Ke(this,Rs);Ke(this,sa);Re(this,na,t),this.setOptions(n),this.bindMethods(),_t(this,ra,wf).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const n=this.options;this.options=re(this,na).defaultMutationOptions(t),wu(this.options,n)||re(this,na).getMutationCache().notify({type:"observerOptionsUpdated",mutation:re(this,Rs),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&So(n.mutationKey)!==So(this.options.mutationKey)?this.reset():((s=re(this,Rs))==null?void 0:s.state.status)==="pending"&&re(this,Rs).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=re(this,Rs))==null||t.removeObserver(this)}onMutationUpdate(t){_t(this,ra,wf).call(this),_t(this,ra,O_).call(this,t)}getCurrentResult(){return re(this,Da)}reset(){var t;(t=re(this,Rs))==null||t.removeObserver(this),Re(this,Rs,void 0),_t(this,ra,wf).call(this),_t(this,ra,O_).call(this)}mutate(t,n){var s;return Re(this,sa,n),(s=re(this,Rs))==null||s.removeObserver(this),Re(this,Rs,re(this,na).getMutationCache().build(re(this,na),this.options)),re(this,Rs).addObserver(this),re(this,Rs).execute(t)}},na=new WeakMap,Da=new WeakMap,Rs=new WeakMap,sa=new WeakMap,ra=new WeakSet,wf=function(){var n;const t=((n=re(this,Rs))==null?void 0:n.state)??ry();Re(this,Da,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},O_=function(t){In.batch(()=>{var n,s,r,i,l,u,d,h;if(re(this,sa)&&this.hasListeners()){const p=re(this,Da).variables,m=re(this,Da).context,f={client:re(this,na),meta:this.options.meta,mutationKey:this.options.mutationKey};(t==null?void 0:t.type)==="success"?((s=(n=re(this,sa)).onSuccess)==null||s.call(n,t.data,p,m,f),(i=(r=re(this,sa)).onSettled)==null||i.call(r,t.data,null,p,m,f)):(t==null?void 0:t.type)==="error"&&((u=(l=re(this,sa)).onError)==null||u.call(l,t.error,p,m,f),(h=(d=re(this,sa)).onSettled)==null||h.call(d,void 0,t.error,p,m,f))}this.listeners.forEach(p=>{p(re(this,Da))})})},Wj),sE=(Yj=class extends ji{constructor(t={}){super();Ke(this,Ir);this.config=t,Re(this,Ir,new Map)}build(t,n,s){const r=n.queryKey,i=n.queryHash??Ef(r,n);let l=this.get(i);return l||(l=new GS({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(n),state:s,defaultOptions:t.getQueryDefaults(r)}),this.add(l)),l}add(t){re(this,Ir).has(t.queryHash)||(re(this,Ir).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=re(this,Ir).get(t.queryHash);n&&(t.destroy(),n===t&&re(this,Ir).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){In.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return re(this,Ir).get(t)}getAll(){return[...re(this,Ir).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(s=>U_(n,s))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(s=>U_(t,s)):n}notify(t){In.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){In.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){In.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Ir=new WeakMap,Yj),rE=(Kj=class{constructor(e={}){Ke(this,yn);Ke(this,za);Ke(this,Ia);Ke(this,ul);Ke(this,dl);Ke(this,Fa);Ke(this,ml);Ke(this,fl);Re(this,yn,e.queryCache||new sE),Re(this,za,e.mutationCache||new tE),Re(this,Ia,e.defaultOptions||{}),Re(this,ul,new Map),Re(this,dl,new Map),Re(this,Fa,0)}mount(){bf(this,Fa)._++,re(this,Fa)===1&&(Re(this,ml,Of.subscribe(async e=>{e&&(await this.resumePausedMutations(),re(this,yn).onFocus())})),Re(this,fl,Nu.subscribe(async e=>{e&&(await this.resumePausedMutations(),re(this,yn).onOnline())})))}unmount(){var e,t;bf(this,Fa)._--,re(this,Fa)===0&&((e=re(this,ml))==null||e.call(this),Re(this,ml,void 0),(t=re(this,fl))==null||t.call(this),Re(this,fl,void 0))}isFetching(e){return re(this,yn).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return re(this,za).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=re(this,yn).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=re(this,yn).build(this,t),s=n.state.data;return s===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(xa(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return re(this,yn).findAll(e).map(({queryKey:t,state:n})=>{const s=n.data;return[t,s]})}setQueryData(e,t,n){const s=this.defaultQueryOptions({queryKey:e}),r=re(this,yn).get(s.queryHash),i=r==null?void 0:r.state.data,l=zS(t,i);if(l!==void 0)return re(this,yn).build(this,s).setData(l,{...n,manual:!0})}setQueriesData(e,t,n){return In.batch(()=>re(this,yn).findAll(e).map(({queryKey:s})=>[s,this.setQueryData(s,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=re(this,yn).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=re(this,yn);In.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=re(this,yn);return In.batch(()=>(n.findAll(e).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},s=In.batch(()=>re(this,yn).findAll(e).map(r=>r.cancel(n)));return Promise.all(s).then(ys).catch(ys)}invalidateQueries(e,t={}){return In.batch(()=>(re(this,yn).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},s=In.batch(()=>re(this,yn).findAll(e).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let i=r.fetch(void 0,n);return n.throwOnError||(i=i.catch(ys)),r.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(s).then(ys)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=re(this,yn).build(this,t);return n.isStaleByTime(xa(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(ys).catch(ys)}fetchInfiniteQuery(e){return e.behavior=ny(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(ys).catch(ys)}ensureInfiniteQueryData(e){return e.behavior=ny(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Nu.isOnline()?re(this,za).resumePausedMutations():Promise.resolve()}getQueryCache(){return re(this,yn)}getMutationCache(){return re(this,za)}getDefaultOptions(){return re(this,Ia)}setDefaultOptions(e){Re(this,Ia,e)}setQueryDefaults(e,t){re(this,ul).set(So(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...re(this,ul).values()],n={};return t.forEach(s=>{Il(e,s.queryKey)&&Object.assign(n,s.defaultOptions)}),n}setMutationDefaults(e,t){re(this,dl).set(So(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...re(this,dl).values()],n={};return t.forEach(s=>{Il(e,s.mutationKey)&&Object.assign(n,s.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...re(this,Ia).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Ef(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Af&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...re(this,Ia).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){re(this,yn).clear(),re(this,za).clear()}},yn=new WeakMap,za=new WeakMap,Ia=new WeakMap,ul=new WeakMap,dl=new WeakMap,Fa=new WeakMap,ml=new WeakMap,fl=new WeakMap,Kj),ay=b.createContext(void 0),Eo=e=>{const t=b.useContext(ay);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},aE=({client:e,children:t})=>(b.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),o.jsx(ay.Provider,{value:e,children:t})),oy=b.createContext(!1),oE=()=>b.useContext(oy);oy.Provider;function iE(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var lE=b.createContext(iE()),cE=()=>b.useContext(lE),uE=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},dE=e=>{b.useEffect(()=>{e.clearReset()},[e])},mE=({result:e,errorResetBoundary:t,throwOnError:n,query:s,suspense:r})=>e.isError&&!t.isReset()&&!e.isFetching&&s&&(r&&e.data===void 0||K_(n,[e.error,s])),fE=e=>{if(e.suspense){const n=r=>r==="static"?r:Math.max(r??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...r)=>n(s(...r)):n(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},hE=(e,t)=>e.isLoading&&e.isFetching&&!t,pE=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,iy=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function gE(e,t,n){var m,f,y,x,_;const s=oE(),r=cE(),i=Eo(),l=i.defaultQueryOptions(e);(f=(m=i.getDefaultOptions().queries)==null?void 0:m._experimental_beforeQuery)==null||f.call(m,l),l._optimisticResults=s?"isRestoring":"optimistic",fE(l),uE(l,r),dE(r);const u=!i.getQueryCache().get(l.queryHash),[d]=b.useState(()=>new t(i,l)),h=d.getOptimisticResult(l),p=!s&&e.subscribed!==!1;if(b.useSyncExternalStore(b.useCallback(v=>{const w=p?d.subscribe(In.batchCalls(v)):ys;return d.updateResult(),w},[d,p]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),b.useEffect(()=>{d.setOptions(l)},[l,d]),pE(l,h))throw iy(l,d,r);if(mE({result:h,errorResetBoundary:r,throwOnError:l.throwOnError,query:i.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw h.error;if((x=(y=i.getDefaultOptions().queries)==null?void 0:y._experimental_afterQuery)==null||x.call(y,l,h),l.experimental_prefetchInRender&&!Co&&hE(h,s)){const v=u?iy(l,d,r):(_=i.getQueryCache().get(l.queryHash))==null?void 0:_.promise;v==null||v.catch(ys).finally(()=>{d.updateResult()})}return l.notifyOnChangeProps?h:d.trackResult(h)}function Ts(e,t){return gE(e,XS)}function Cu(e,t){const n=Eo(),[s]=b.useState(()=>new nE(n,e));b.useEffect(()=>{s.setOptions(e)},[s,e]);const r=b.useSyncExternalStore(b.useCallback(l=>s.subscribe(In.batchCalls(l)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),i=b.useCallback((l,u)=>{s.mutate(l,u).catch(ys)},[s]);if(r.error&&K_(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:i,mutateAsync:r.mutate}}function _E(e){let t;const n=new Set,s=(h,p)=>{const m=typeof h=="function"?h(t):h;if(m!==t){const f=t;t=p?m:Object.assign({},t,m),n.forEach(y=>y(t,f))}},r=()=>t,i=(h,p=r,m=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let f=p(t);function y(){const x=p(t);if(!m(f,x)){const _=f;h(f=x,_)}}return n.add(y),()=>n.delete(y)},d={setState:s,getState:r,subscribe:(h,p,m)=>p||m?i(h,p,m):(n.add(h),()=>n.delete(h)),destroy:()=>n.clear()};return t=e(s,r,d),d}const ly=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?b.useEffect:b.useLayoutEffect;function yE(e){const t=typeof e=="function"?_E(e):e,n=(s=t.getState,r=Object.is)=>{const[,i]=b.useReducer(v=>v+1,0),l=t.getState(),u=b.useRef(l),d=b.useRef(s),h=b.useRef(r),p=b.useRef(!1),m=b.useRef();m.current===void 0&&(m.current=s(l));let f,y=!1;(u.current!==l||d.current!==s||h.current!==r||p.current)&&(f=s(l),y=!r(m.current,f)),ly(()=>{y&&(m.current=f),u.current=l,d.current=s,h.current=r,p.current=!1});const x=b.useRef(l);ly(()=>{const v=()=>{try{const M=t.getState(),N=d.current(M);h.current(m.current,N)||(u.current=M,m.current=N,i())}catch{p.current=!0,i()}},w=t.subscribe(v);return t.getState()!==x.current&&v(),w},[]);const _=y?f:m.current;return b.useDebugValue(_),_};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[n,t];return{next(){const r=s.length<=0;return{value:s.shift(),done:r}}}},n}function vE(){const e=b.createContext(void 0);return{Provider:({initialStore:r,createStore:i,children:l})=>{const u=b.useRef();return u.current||(r&&(console.warn("Provider initialStore is deprecated and will be removed in the next version."),i||(i=()=>r)),u.current=i()),b.createElement(e.Provider,{value:u.current},l)},useStore:(r,i=Object.is)=>{const l=b.useContext(e);if(!l)throw new Error("Seems like you have not used zustand provider as an ancestor.");return l(r,i)},useStoreApi:()=>{const r=b.useContext(e);if(!r)throw new Error("Seems like you have not used zustand provider as an ancestor.");return b.useMemo(()=>({getState:r.getState,setState:r.setState,subscribe:r.subscribe,destroy:r.destroy}),[r])}}}var xE={value:()=>{}};function Su(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new Eu(n)}function Eu(e){this._=e}function bE(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",r=n.indexOf(".");if(r>=0&&(s=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}Eu.prototype=Su.prototype={constructor:Eu,on:function(e,t){var n=this._,s=bE(e+"",n),r,i=-1,l=s.length;if(arguments.length<2){for(;++i<l;)if((r=(e=s[i]).type)&&(r=wE(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<l;)if(r=(e=s[i]).type)n[r]=cy(n[r],e.name,t);else if(t==null)for(r in n)n[r]=cy(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Eu(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),s=0,r,i;s<r;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],s=0,r=i.length;s<r;++s)i[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)}};function wE(e,t){for(var n=0,s=e.length,r;n<s;++n)if((r=e[n]).name===t)return r.value}function cy(e,t,n){for(var s=0,r=e.length;s<r;++s)if(e[s].name===t){e[s]=xE,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var Rf="http://www.w3.org/1999/xhtml";const uy={svg:"http://www.w3.org/2000/svg",xhtml:Rf,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Mu(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),uy.hasOwnProperty(t)?{space:uy[t],local:e}:e}function NE(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Rf&&t.documentElement.namespaceURI===Rf?t.createElement(e):t.createElementNS(n,e)}}function jE(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function dy(e){var t=Mu(e);return(t.local?jE:NE)(t)}function CE(){}function Df(e){return e==null?CE:function(){return this.querySelector(e)}}function SE(e){typeof e!="function"&&(e=Df(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],l=i.length,u=s[r]=new Array(l),d,h,p=0;p<l;++p)(d=i[p])&&(h=e.call(d,d.__data__,p,i))&&("__data__"in d&&(h.__data__=d.__data__),u[p]=h);return new qs(s,this._parents)}function EE(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ME(){return[]}function my(e){return e==null?ME:function(){return this.querySelectorAll(e)}}function kE(e){return function(){return EE(e.apply(this,arguments))}}function AE(e){typeof e=="function"?e=kE(e):e=my(e);for(var t=this._groups,n=t.length,s=[],r=[],i=0;i<n;++i)for(var l=t[i],u=l.length,d,h=0;h<u;++h)(d=l[h])&&(s.push(e.call(d,d.__data__,h,l)),r.push(d));return new qs(s,r)}function fy(e){return function(){return this.matches(e)}}function hy(e){return function(t){return t.matches(e)}}var OE=Array.prototype.find;function TE(e){return function(){return OE.call(this.children,e)}}function $E(){return this.firstElementChild}function PE(e){return this.select(e==null?$E:TE(typeof e=="function"?e:hy(e)))}var LE=Array.prototype.filter;function RE(){return Array.from(this.children)}function DE(e){return function(){return LE.call(this.children,e)}}function zE(e){return this.selectAll(e==null?RE:DE(typeof e=="function"?e:hy(e)))}function IE(e){typeof e!="function"&&(e=fy(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],l=i.length,u=s[r]=[],d,h=0;h<l;++h)(d=i[h])&&e.call(d,d.__data__,h,i)&&u.push(d);return new qs(s,this._parents)}function py(e){return new Array(e.length)}function FE(){return new qs(this._enter||this._groups.map(py),this._parents)}function ku(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ku.prototype={constructor:ku,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function BE(e){return function(){return e}}function UE(e,t,n,s,r,i){for(var l=0,u,d=t.length,h=i.length;l<h;++l)(u=t[l])?(u.__data__=i[l],s[l]=u):n[l]=new ku(e,i[l]);for(;l<d;++l)(u=t[l])&&(r[l]=u)}function HE(e,t,n,s,r,i,l){var u,d,h=new Map,p=t.length,m=i.length,f=new Array(p),y;for(u=0;u<p;++u)(d=t[u])&&(f[u]=y=l.call(d,d.__data__,u,t)+"",h.has(y)?r[u]=d:h.set(y,d));for(u=0;u<m;++u)y=l.call(e,i[u],u,i)+"",(d=h.get(y))?(s[u]=d,d.__data__=i[u],h.delete(y)):n[u]=new ku(e,i[u]);for(u=0;u<p;++u)(d=t[u])&&h.get(f[u])===d&&(r[u]=d)}function qE(e){return e.__data__}function VE(e,t){if(!arguments.length)return Array.from(this,qE);var n=t?HE:UE,s=this._parents,r=this._groups;typeof e!="function"&&(e=BE(e));for(var i=r.length,l=new Array(i),u=new Array(i),d=new Array(i),h=0;h<i;++h){var p=s[h],m=r[h],f=m.length,y=WE(e.call(p,p&&p.__data__,h,s)),x=y.length,_=u[h]=new Array(x),v=l[h]=new Array(x),w=d[h]=new Array(f);n(p,m,_,v,w,y,t);for(var M=0,N=0,C,j;M<x;++M)if(C=_[M]){for(M>=N&&(N=M+1);!(j=v[N])&&++N<x;);C._next=j||null}}return l=new qs(l,s),l._enter=u,l._exit=d,l}function WE(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function YE(){return new qs(this._exit||this._groups.map(py),this._parents)}function KE(e,t,n){var s=this.enter(),r=this,i=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?i.remove():n(i),s&&r?s.merge(r).order():r}function GE(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,r=n.length,i=s.length,l=Math.min(r,i),u=new Array(r),d=0;d<l;++d)for(var h=n[d],p=s[d],m=h.length,f=u[d]=new Array(m),y,x=0;x<m;++x)(y=h[x]||p[x])&&(f[x]=y);for(;d<r;++d)u[d]=n[d];return new qs(u,this._parents)}function XE(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],r=s.length-1,i=s[r],l;--r>=0;)(l=s[r])&&(i&&l.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(l,i),i=l);return this}function QE(e){e||(e=ZE);function t(m,f){return m&&f?e(m.__data__,f.__data__):!m-!f}for(var n=this._groups,s=n.length,r=new Array(s),i=0;i<s;++i){for(var l=n[i],u=l.length,d=r[i]=new Array(u),h,p=0;p<u;++p)(h=l[p])&&(d[p]=h);d.sort(t)}return new qs(r,this._parents).order()}function ZE(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function JE(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function e1(){return Array.from(this)}function t1(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length;r<i;++r){var l=s[r];if(l)return l}return null}function n1(){let e=0;for(const t of this)++e;return e}function s1(){return!this.node()}function r1(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var r=t[n],i=0,l=r.length,u;i<l;++i)(u=r[i])&&e.call(u,u.__data__,i,r);return this}function a1(e){return function(){this.removeAttribute(e)}}function o1(e){return function(){this.removeAttributeNS(e.space,e.local)}}function i1(e,t){return function(){this.setAttribute(e,t)}}function l1(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function c1(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function u1(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function d1(e,t){var n=Mu(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?o1:a1:typeof t=="function"?n.local?u1:c1:n.local?l1:i1)(n,t))}function gy(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function m1(e){return function(){this.style.removeProperty(e)}}function f1(e,t,n){return function(){this.style.setProperty(e,t,n)}}function h1(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function p1(e,t,n){return arguments.length>1?this.each((t==null?m1:typeof t=="function"?h1:f1)(e,t,n??"")):Ci(this.node(),e)}function Ci(e,t){return e.style.getPropertyValue(t)||gy(e).getComputedStyle(e,null).getPropertyValue(t)}function g1(e){return function(){delete this[e]}}function _1(e,t){return function(){this[e]=t}}function y1(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function v1(e,t){return arguments.length>1?this.each((t==null?g1:typeof t=="function"?y1:_1)(e,t)):this.node()[e]}function _y(e){return e.trim().split(/^|\s+/)}function zf(e){return e.classList||new yy(e)}function yy(e){this._node=e,this._names=_y(e.getAttribute("class")||"")}yy.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function vy(e,t){for(var n=zf(e),s=-1,r=t.length;++s<r;)n.add(t[s])}function xy(e,t){for(var n=zf(e),s=-1,r=t.length;++s<r;)n.remove(t[s])}function x1(e){return function(){vy(this,e)}}function b1(e){return function(){xy(this,e)}}function w1(e,t){return function(){(t.apply(this,arguments)?vy:xy)(this,e)}}function N1(e,t){var n=_y(e+"");if(arguments.length<2){for(var s=zf(this.node()),r=-1,i=n.length;++r<i;)if(!s.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?w1:t?x1:b1)(n,t))}function j1(){this.textContent=""}function C1(e){return function(){this.textContent=e}}function S1(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function E1(e){return arguments.length?this.each(e==null?j1:(typeof e=="function"?S1:C1)(e)):this.node().textContent}function M1(){this.innerHTML=""}function k1(e){return function(){this.innerHTML=e}}function A1(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function O1(e){return arguments.length?this.each(e==null?M1:(typeof e=="function"?A1:k1)(e)):this.node().innerHTML}function T1(){this.nextSibling&&this.parentNode.appendChild(this)}function $1(){return this.each(T1)}function P1(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function L1(){return this.each(P1)}function R1(e){var t=typeof e=="function"?e:dy(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function D1(){return null}function z1(e,t){var n=typeof e=="function"?e:dy(e),s=t==null?D1:typeof t=="function"?t:Df(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function I1(){var e=this.parentNode;e&&e.removeChild(this)}function F1(){return this.each(I1)}function B1(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function U1(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function H1(e){return this.select(e?U1:B1)}function q1(e){return arguments.length?this.property("__data__",e):this.node().__data__}function V1(e){return function(t){e.call(this,t,this.__data__)}}function W1(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function Y1(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++s]=i;++s?t.length=s:delete this.__on}}}function K1(e,t,n){return function(){var s=this.__on,r,i=V1(t);if(s){for(var l=0,u=s.length;l<u;++l)if((r=s[l]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},s?s.push(r):this.__on=[r]}}function G1(e,t,n){var s=W1(e+""),r,i=s.length,l;if(arguments.length<2){var u=this.node().__on;if(u){for(var d=0,h=u.length,p;d<h;++d)for(r=0,p=u[d];r<i;++r)if((l=s[r]).type===p.type&&l.name===p.name)return p.value}return}for(u=t?K1:Y1,r=0;r<i;++r)this.each(u(s[r],t,n));return this}function by(e,t,n){var s=gy(e),r=s.CustomEvent;typeof r=="function"?r=new r(t,n):(r=s.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function X1(e,t){return function(){return by(this,e,t)}}function Q1(e,t){return function(){return by(this,e,t.apply(this,arguments))}}function Z1(e,t){return this.each((typeof t=="function"?Q1:X1)(e,t))}function*J1(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length,l;r<i;++r)(l=s[r])&&(yield l)}var wy=[null];function qs(e,t){this._groups=e,this._parents=t}function Fl(){return new qs([[document.documentElement]],wy)}function eM(){return this}qs.prototype=Fl.prototype={constructor:qs,select:SE,selectAll:AE,selectChild:PE,selectChildren:zE,filter:IE,data:VE,enter:FE,exit:YE,join:KE,merge:GE,selection:eM,order:XE,sort:QE,call:JE,nodes:e1,node:t1,size:n1,empty:s1,each:r1,attr:d1,style:p1,property:v1,classed:N1,text:E1,html:O1,raise:$1,lower:L1,append:R1,insert:z1,remove:F1,clone:H1,datum:q1,on:G1,dispatch:Z1,[Symbol.iterator]:J1};function vs(e){return typeof e=="string"?new qs([[document.querySelector(e)]],[document.documentElement]):new qs([[e]],wy)}function tM(e){let t;for(;t=e.sourceEvent;)e=t;return e}function rr(e,t){if(e=tM(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const nM={passive:!1},Bl={capture:!0,passive:!1};function If(e){e.stopImmediatePropagation()}function Si(e){e.preventDefault(),e.stopImmediatePropagation()}function Ny(e){var t=e.document.documentElement,n=vs(e).on("dragstart.drag",Si,Bl);"onselectstart"in t?n.on("selectstart.drag",Si,Bl):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function jy(e,t){var n=e.document.documentElement,s=vs(e).on("dragstart.drag",null);t&&(s.on("click.drag",Si,Bl),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Au=e=>()=>e;function Ff(e,{sourceEvent:t,subject:n,target:s,identifier:r,active:i,x:l,y:u,dx:d,dy:h,dispatch:p}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:l,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:d,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:p}})}Ff.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function sM(e){return!e.ctrlKey&&!e.button}function rM(){return this.parentNode}function aM(e,t){return t??{x:e.x,y:e.y}}function oM(){return navigator.maxTouchPoints||"ontouchstart"in this}function Bf(){var e=sM,t=rM,n=aM,s=oM,r={},i=Su("start","drag","end"),l=0,u,d,h,p,m=0;function f(C){C.on("mousedown.drag",y).filter(s).on("touchstart.drag",v).on("touchmove.drag",w,nM).on("touchend.drag touchcancel.drag",M).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(C,j){if(!(p||!e.call(this,C,j))){var E=N(this,t.call(this,C,j),C,j,"mouse");E&&(vs(C.view).on("mousemove.drag",x,Bl).on("mouseup.drag",_,Bl),Ny(C.view),If(C),h=!1,u=C.clientX,d=C.clientY,E("start",C))}}function x(C){if(Si(C),!h){var j=C.clientX-u,E=C.clientY-d;h=j*j+E*E>m}r.mouse("drag",C)}function _(C){vs(C.view).on("mousemove.drag mouseup.drag",null),jy(C.view,h),Si(C),r.mouse("end",C)}function v(C,j){if(e.call(this,C,j)){var E=C.changedTouches,k=t.call(this,C,j),$=E.length,T,P;for(T=0;T<$;++T)(P=N(this,k,C,j,E[T].identifier,E[T]))&&(If(C),P("start",C,E[T]))}}function w(C){var j=C.changedTouches,E=j.length,k,$;for(k=0;k<E;++k)($=r[j[k].identifier])&&(Si(C),$("drag",C,j[k]))}function M(C){var j=C.changedTouches,E=j.length,k,$;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),k=0;k<E;++k)($=r[j[k].identifier])&&(If(C),$("end",C,j[k]))}function N(C,j,E,k,$,T){var P=i.copy(),A=rr(T||E,j),D,F,R;if((R=n.call(C,new Ff("beforestart",{sourceEvent:E,target:f,identifier:$,active:l,x:A[0],y:A[1],dx:0,dy:0,dispatch:P}),k))!=null)return D=R.x-A[0]||0,F=R.y-A[1]||0,function z(q,V,U){var W=A,B;switch(q){case"start":r[$]=z,B=l++;break;case"end":delete r[$],--l;case"drag":A=rr(U||V,j),B=l;break}P.call(q,C,new Ff(q,{sourceEvent:V,subject:R,target:f,identifier:$,active:B,x:A[0]+D,y:A[1]+F,dx:A[0]-W[0],dy:A[1]-W[1],dispatch:P}),k)}}return f.filter=function(C){return arguments.length?(e=typeof C=="function"?C:Au(!!C),f):e},f.container=function(C){return arguments.length?(t=typeof C=="function"?C:Au(C),f):t},f.subject=function(C){return arguments.length?(n=typeof C=="function"?C:Au(C),f):n},f.touchable=function(C){return arguments.length?(s=typeof C=="function"?C:Au(!!C),f):s},f.on=function(){var C=i.on.apply(i,arguments);return C===i?f:C},f.clickDistance=function(C){return arguments.length?(m=(C=+C)*C,f):Math.sqrt(m)},f}function Uf(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Cy(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function Ul(){}var Hl=.7,Ou=1/Hl,Ei="\\s*([+-]?\\d+)\\s*",ql="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Tr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",iM=/^#([0-9a-f]{3,8})$/,lM=new RegExp(`^rgb\\(${Ei},${Ei},${Ei}\\)$`),cM=new RegExp(`^rgb\\(${Tr},${Tr},${Tr}\\)$`),uM=new RegExp(`^rgba\\(${Ei},${Ei},${Ei},${ql}\\)$`),dM=new RegExp(`^rgba\\(${Tr},${Tr},${Tr},${ql}\\)$`),mM=new RegExp(`^hsl\\(${ql},${Tr},${Tr}\\)$`),fM=new RegExp(`^hsla\\(${ql},${Tr},${Tr},${ql}\\)$`),Sy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Uf(Ul,Mo,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Ey,formatHex:Ey,formatHex8:hM,formatHsl:pM,formatRgb:My,toString:My});function Ey(){return this.rgb().formatHex()}function hM(){return this.rgb().formatHex8()}function pM(){return $y(this).formatHsl()}function My(){return this.rgb().formatRgb()}function Mo(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=iM.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?ky(t):n===3?new $s(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Tu(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Tu(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=lM.exec(e))?new $s(t[1],t[2],t[3],1):(t=cM.exec(e))?new $s(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=uM.exec(e))?Tu(t[1],t[2],t[3],t[4]):(t=dM.exec(e))?Tu(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=mM.exec(e))?Ty(t[1],t[2]/100,t[3]/100,1):(t=fM.exec(e))?Ty(t[1],t[2]/100,t[3]/100,t[4]):Sy.hasOwnProperty(e)?ky(Sy[e]):e==="transparent"?new $s(NaN,NaN,NaN,0):null}function ky(e){return new $s(e>>16&255,e>>8&255,e&255,1)}function Tu(e,t,n,s){return s<=0&&(e=t=n=NaN),new $s(e,t,n,s)}function gM(e){return e instanceof Ul||(e=Mo(e)),e?(e=e.rgb(),new $s(e.r,e.g,e.b,e.opacity)):new $s}function Hf(e,t,n,s){return arguments.length===1?gM(e):new $s(e,t,n,s??1)}function $s(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}Uf($s,Hf,Cy(Ul,{brighter(e){return e=e==null?Ou:Math.pow(Ou,e),new $s(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Hl:Math.pow(Hl,e),new $s(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new $s(ko(this.r),ko(this.g),ko(this.b),$u(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ay,formatHex:Ay,formatHex8:_M,formatRgb:Oy,toString:Oy}));function Ay(){return`#${Ao(this.r)}${Ao(this.g)}${Ao(this.b)}`}function _M(){return`#${Ao(this.r)}${Ao(this.g)}${Ao(this.b)}${Ao((isNaN(this.opacity)?1:this.opacity)*255)}`}function Oy(){const e=$u(this.opacity);return`${e===1?"rgb(":"rgba("}${ko(this.r)}, ${ko(this.g)}, ${ko(this.b)}${e===1?")":`, ${e})`}`}function $u(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ko(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ao(e){return e=ko(e),(e<16?"0":"")+e.toString(16)}function Ty(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new pr(e,t,n,s)}function $y(e){if(e instanceof pr)return new pr(e.h,e.s,e.l,e.opacity);if(e instanceof Ul||(e=Mo(e)),!e)return new pr;if(e instanceof pr)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,r=Math.min(t,n,s),i=Math.max(t,n,s),l=NaN,u=i-r,d=(i+r)/2;return u?(t===i?l=(n-s)/u+(n<s)*6:n===i?l=(s-t)/u+2:l=(t-n)/u+4,u/=d<.5?i+r:2-i-r,l*=60):u=d>0&&d<1?0:l,new pr(l,u,d,e.opacity)}function yM(e,t,n,s){return arguments.length===1?$y(e):new pr(e,t,n,s??1)}function pr(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}Uf(pr,yM,Cy(Ul,{brighter(e){return e=e==null?Ou:Math.pow(Ou,e),new pr(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Hl:Math.pow(Hl,e),new pr(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,r=2*n-s;return new $s(qf(e>=240?e-240:e+120,r,s),qf(e,r,s),qf(e<120?e+240:e-120,r,s),this.opacity)},clamp(){return new pr(Py(this.h),Pu(this.s),Pu(this.l),$u(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=$u(this.opacity);return`${e===1?"hsl(":"hsla("}${Py(this.h)}, ${Pu(this.s)*100}%, ${Pu(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Py(e){return e=(e||0)%360,e<0?e+360:e}function Pu(e){return Math.max(0,Math.min(1,e||0))}function qf(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Vf=e=>()=>e;function vM(e,t){return function(n){return e+n*t}}function xM(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function bM(e){return(e=+e)==1?Ly:function(t,n){return n-t?xM(t,n,e):Vf(isNaN(t)?n:t)}}function Ly(e,t){var n=t-e;return n?vM(e,n):Vf(isNaN(e)?t:e)}const Lu=function e(t){var n=bM(t);function s(r,i){var l=n((r=Hf(r)).r,(i=Hf(i)).r),u=n(r.g,i.g),d=n(r.b,i.b),h=Ly(r.opacity,i.opacity);return function(p){return r.r=l(p),r.g=u(p),r.b=d(p),r.opacity=h(p),r+""}}return s.gamma=e,s}(1);function wM(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),r;return function(i){for(r=0;r<n;++r)s[r]=e[r]*(1-i)+t[r]*i;return s}}function NM(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function jM(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,r=new Array(s),i=new Array(n),l;for(l=0;l<s;++l)r[l]=Vl(e[l],t[l]);for(;l<n;++l)i[l]=t[l];return function(u){for(l=0;l<s;++l)i[l]=r[l](u);return i}}function CM(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function $r(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function SM(e,t){var n={},s={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Vl(e[r],t[r]):s[r]=t[r];return function(i){for(r in n)s[r]=n[r](i);return s}}var Wf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yf=new RegExp(Wf.source,"g");function EM(e){return function(){return e}}function MM(e){return function(t){return e(t)+""}}function Ry(e,t){var n=Wf.lastIndex=Yf.lastIndex=0,s,r,i,l=-1,u=[],d=[];for(e=e+"",t=t+"";(s=Wf.exec(e))&&(r=Yf.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),u[l]?u[l]+=i:u[++l]=i),(s=s[0])===(r=r[0])?u[l]?u[l]+=r:u[++l]=r:(u[++l]=null,d.push({i:l,x:$r(s,r)})),n=Yf.lastIndex;return n<t.length&&(i=t.slice(n),u[l]?u[l]+=i:u[++l]=i),u.length<2?d[0]?MM(d[0].x):EM(t):(t=d.length,function(h){for(var p=0,m;p<t;++p)u[(m=d[p]).i]=m.x(h);return u.join("")})}function Vl(e,t){var n=typeof t,s;return t==null||n==="boolean"?Vf(t):(n==="number"?$r:n==="string"?(s=Mo(t))?(t=s,Lu):Ry:t instanceof Mo?Lu:t instanceof Date?CM:NM(t)?wM:Array.isArray(t)?jM:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?SM:$r)(e,t)}var Dy=180/Math.PI,Kf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function zy(e,t,n,s,r,i){var l,u,d;return(l=Math.sqrt(e*e+t*t))&&(e/=l,t/=l),(d=e*n+t*s)&&(n-=e*d,s-=t*d),(u=Math.sqrt(n*n+s*s))&&(n/=u,s/=u,d/=u),e*s<t*n&&(e=-e,t=-t,d=-d,l=-l),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Dy,skewX:Math.atan(d)*Dy,scaleX:l,scaleY:u}}var Ru;function kM(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Kf:zy(t.a,t.b,t.c,t.d,t.e,t.f)}function AM(e){return e==null||(Ru||(Ru=document.createElementNS("http://www.w3.org/2000/svg","g")),Ru.setAttribute("transform",e),!(e=Ru.transform.baseVal.consolidate()))?Kf:(e=e.matrix,zy(e.a,e.b,e.c,e.d,e.e,e.f))}function Iy(e,t,n,s){function r(h){return h.length?h.pop()+" ":""}function i(h,p,m,f,y,x){if(h!==m||p!==f){var _=y.push("translate(",null,t,null,n);x.push({i:_-4,x:$r(h,m)},{i:_-2,x:$r(p,f)})}else(m||f)&&y.push("translate("+m+t+f+n)}function l(h,p,m,f){h!==p?(h-p>180?p+=360:p-h>180&&(h+=360),f.push({i:m.push(r(m)+"rotate(",null,s)-2,x:$r(h,p)})):p&&m.push(r(m)+"rotate("+p+s)}function u(h,p,m,f){h!==p?f.push({i:m.push(r(m)+"skewX(",null,s)-2,x:$r(h,p)}):p&&m.push(r(m)+"skewX("+p+s)}function d(h,p,m,f,y,x){if(h!==m||p!==f){var _=y.push(r(y)+"scale(",null,",",null,")");x.push({i:_-4,x:$r(h,m)},{i:_-2,x:$r(p,f)})}else(m!==1||f!==1)&&y.push(r(y)+"scale("+m+","+f+")")}return function(h,p){var m=[],f=[];return h=e(h),p=e(p),i(h.translateX,h.translateY,p.translateX,p.translateY,m,f),l(h.rotate,p.rotate,m,f),u(h.skewX,p.skewX,m,f),d(h.scaleX,h.scaleY,p.scaleX,p.scaleY,m,f),h=p=null,function(y){for(var x=-1,_=f.length,v;++x<_;)m[(v=f[x]).i]=v.x(y);return m.join("")}}}var OM=Iy(kM,"px, ","px)","deg)"),TM=Iy(AM,", ",")",")"),$M=1e-12;function Fy(e){return((e=Math.exp(e))+1/e)/2}function PM(e){return((e=Math.exp(e))-1/e)/2}function LM(e){return((e=Math.exp(2*e))-1)/(e+1)}const Du=function e(t,n,s){function r(i,l){var u=i[0],d=i[1],h=i[2],p=l[0],m=l[1],f=l[2],y=p-u,x=m-d,_=y*y+x*x,v,w;if(_<$M)w=Math.log(f/h)/t,v=function(k){return[u+k*y,d+k*x,h*Math.exp(t*k*w)]};else{var M=Math.sqrt(_),N=(f*f-h*h+s*_)/(2*h*n*M),C=(f*f-h*h-s*_)/(2*f*n*M),j=Math.log(Math.sqrt(N*N+1)-N),E=Math.log(Math.sqrt(C*C+1)-C);w=(E-j)/t,v=function(k){var $=k*w,T=Fy(j),P=h/(n*M)*(T*LM(t*$+j)-PM(j));return[u+P*y,d+P*x,h*T/Fy(t*$+j)]}}return v.duration=w*1e3*t/Math.SQRT2,v}return r.rho=function(i){var l=Math.max(.001,+i),u=l*l,d=u*u;return e(l,u,d)},r}(Math.SQRT2,2,4);var Mi=0,Wl=0,Yl=0,By=1e3,zu,Kl,Iu=0,Oo=0,Fu=0,Gl=typeof performance=="object"&&performance.now?performance:Date,Uy=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Gf(){return Oo||(Uy(RM),Oo=Gl.now()+Fu)}function RM(){Oo=0}function Bu(){this._call=this._time=this._next=null}Bu.prototype=Hy.prototype={constructor:Bu,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Gf():+n)+(t==null?0:+t),!this._next&&Kl!==this&&(Kl?Kl._next=this:zu=this,Kl=this),this._call=e,this._time=n,Xf()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xf())}};function Hy(e,t,n){var s=new Bu;return s.restart(e,t,n),s}function DM(){Gf(),++Mi;for(var e=zu,t;e;)(t=Oo-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Mi}function qy(){Oo=(Iu=Gl.now())+Fu,Mi=Wl=0;try{DM()}finally{Mi=0,IM(),Oo=0}}function zM(){var e=Gl.now(),t=e-Iu;t>By&&(Fu-=t,Iu=e)}function IM(){for(var e,t=zu,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:zu=n);Kl=e,Xf(s)}function Xf(e){if(!Mi){Wl&&(Wl=clearTimeout(Wl));var t=e-Oo;t>24?(e<1/0&&(Wl=setTimeout(qy,e-Gl.now()-Fu)),Yl&&(Yl=clearInterval(Yl))):(Yl||(Iu=Gl.now(),Yl=setInterval(zM,By)),Mi=1,Uy(qy))}}function Vy(e,t,n){var s=new Bu;return t=t==null?0:+t,s.restart(r=>{s.stop(),e(r+t)},t,n),s}var FM=Su("start","end","cancel","interrupt"),BM=[],Wy=0,Yy=1,Qf=2,Uu=3,Ky=4,Zf=5,Hu=6;function qu(e,t,n,s,r,i){var l=e.__transition;if(!l)e.__transition={};else if(n in l)return;UM(e,n,{name:t,index:s,group:r,on:FM,tween:BM,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Wy})}function Jf(e,t){var n=gr(e,t);if(n.state>Wy)throw new Error("too late; already scheduled");return n}function Pr(e,t){var n=gr(e,t);if(n.state>Uu)throw new Error("too late; already running");return n}function gr(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function UM(e,t,n){var s=e.__transition,r;s[t]=n,n.timer=Hy(i,0,n.time);function i(h){n.state=Yy,n.timer.restart(l,n.delay,n.time),n.delay<=h&&l(h-n.delay)}function l(h){var p,m,f,y;if(n.state!==Yy)return d();for(p in s)if(y=s[p],y.name===n.name){if(y.state===Uu)return Vy(l);y.state===Ky?(y.state=Hu,y.timer.stop(),y.on.call("interrupt",e,e.__data__,y.index,y.group),delete s[p]):+p<t&&(y.state=Hu,y.timer.stop(),y.on.call("cancel",e,e.__data__,y.index,y.group),delete s[p])}if(Vy(function(){n.state===Uu&&(n.state=Ky,n.timer.restart(u,n.delay,n.time),u(h))}),n.state=Qf,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Qf){for(n.state=Uu,r=new Array(f=n.tween.length),p=0,m=-1;p<f;++p)(y=n.tween[p].value.call(e,e.__data__,n.index,n.group))&&(r[++m]=y);r.length=m+1}}function u(h){for(var p=h<n.duration?n.ease.call(null,h/n.duration):(n.timer.restart(d),n.state=Zf,1),m=-1,f=r.length;++m<f;)r[m].call(e,p);n.state===Zf&&(n.on.call("end",e,e.__data__,n.index,n.group),d())}function d(){n.state=Hu,n.timer.stop(),delete s[t];for(var h in s)return;delete e.__transition}}function Vu(e,t){var n=e.__transition,s,r,i=!0,l;if(n){t=t==null?null:t+"";for(l in n){if((s=n[l]).name!==t){i=!1;continue}r=s.state>Qf&&s.state<Zf,s.state=Hu,s.timer.stop(),s.on.call(r?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[l]}i&&delete e.__transition}}function HM(e){return this.each(function(){Vu(this,e)})}function qM(e,t){var n,s;return function(){var r=Pr(this,e),i=r.tween;if(i!==n){s=n=i;for(var l=0,u=s.length;l<u;++l)if(s[l].name===t){s=s.slice(),s.splice(l,1);break}}r.tween=s}}function VM(e,t,n){var s,r;if(typeof n!="function")throw new Error;return function(){var i=Pr(this,e),l=i.tween;if(l!==s){r=(s=l).slice();for(var u={name:t,value:n},d=0,h=r.length;d<h;++d)if(r[d].name===t){r[d]=u;break}d===h&&r.push(u)}i.tween=r}}function WM(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=gr(this.node(),n).tween,r=0,i=s.length,l;r<i;++r)if((l=s[r]).name===e)return l.value;return null}return this.each((t==null?qM:VM)(n,e,t))}function eh(e,t,n){var s=e._id;return e.each(function(){var r=Pr(this,s);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return gr(r,s).value[t]}}function Gy(e,t){var n;return(typeof t=="number"?$r:t instanceof Mo?Lu:(n=Mo(t))?(t=n,Lu):Ry)(e,t)}function YM(e){return function(){this.removeAttribute(e)}}function KM(e){return function(){this.removeAttributeNS(e.space,e.local)}}function GM(e,t,n){var s,r=n+"",i;return function(){var l=this.getAttribute(e);return l===r?null:l===s?i:i=t(s=l,n)}}function XM(e,t,n){var s,r=n+"",i;return function(){var l=this.getAttributeNS(e.space,e.local);return l===r?null:l===s?i:i=t(s=l,n)}}function QM(e,t,n){var s,r,i;return function(){var l,u=n(this),d;return u==null?void this.removeAttribute(e):(l=this.getAttribute(e),d=u+"",l===d?null:l===s&&d===r?i:(r=d,i=t(s=l,u)))}}function ZM(e,t,n){var s,r,i;return function(){var l,u=n(this),d;return u==null?void this.removeAttributeNS(e.space,e.local):(l=this.getAttributeNS(e.space,e.local),d=u+"",l===d?null:l===s&&d===r?i:(r=d,i=t(s=l,u)))}}function JM(e,t){var n=Mu(e),s=n==="transform"?TM:Gy;return this.attrTween(e,typeof t=="function"?(n.local?ZM:QM)(n,s,eh(this,"attr."+e,t)):t==null?(n.local?KM:YM)(n):(n.local?XM:GM)(n,s,t))}function ek(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function tk(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function nk(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&tk(e,i)),n}return r._value=t,r}function sk(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&ek(e,i)),n}return r._value=t,r}function rk(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=Mu(e);return this.tween(n,(s.local?nk:sk)(s,t))}function ak(e,t){return function(){Jf(this,e).delay=+t.apply(this,arguments)}}function ok(e,t){return t=+t,function(){Jf(this,e).delay=t}}function ik(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ak:ok)(t,e)):gr(this.node(),t).delay}function lk(e,t){return function(){Pr(this,e).duration=+t.apply(this,arguments)}}function ck(e,t){return t=+t,function(){Pr(this,e).duration=t}}function uk(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?lk:ck)(t,e)):gr(this.node(),t).duration}function dk(e,t){if(typeof t!="function")throw new Error;return function(){Pr(this,e).ease=t}}function mk(e){var t=this._id;return arguments.length?this.each(dk(t,e)):gr(this.node(),t).ease}function fk(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Pr(this,e).ease=n}}function hk(e){if(typeof e!="function")throw new Error;return this.each(fk(this._id,e))}function pk(e){typeof e!="function"&&(e=fy(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],l=i.length,u=s[r]=[],d,h=0;h<l;++h)(d=i[h])&&e.call(d,d.__data__,h,i)&&u.push(d);return new Vr(s,this._parents,this._name,this._id)}function gk(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,r=n.length,i=Math.min(s,r),l=new Array(s),u=0;u<i;++u)for(var d=t[u],h=n[u],p=d.length,m=l[u]=new Array(p),f,y=0;y<p;++y)(f=d[y]||h[y])&&(m[y]=f);for(;u<s;++u)l[u]=t[u];return new Vr(l,this._parents,this._name,this._id)}function _k(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function yk(e,t,n){var s,r,i=_k(t)?Jf:Pr;return function(){var l=i(this,e),u=l.on;u!==s&&(r=(s=u).copy()).on(t,n),l.on=r}}function vk(e,t){var n=this._id;return arguments.length<2?gr(this.node(),n).on.on(e):this.each(yk(n,e,t))}function xk(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function bk(){return this.on("end.remove",xk(this._id))}function wk(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Df(e));for(var s=this._groups,r=s.length,i=new Array(r),l=0;l<r;++l)for(var u=s[l],d=u.length,h=i[l]=new Array(d),p,m,f=0;f<d;++f)(p=u[f])&&(m=e.call(p,p.__data__,f,u))&&("__data__"in p&&(m.__data__=p.__data__),h[f]=m,qu(h[f],t,n,f,h,gr(p,n)));return new Vr(i,this._parents,t,n)}function Nk(e){var t=this._name,n=this._id;typeof e!="function"&&(e=my(e));for(var s=this._groups,r=s.length,i=[],l=[],u=0;u<r;++u)for(var d=s[u],h=d.length,p,m=0;m<h;++m)if(p=d[m]){for(var f=e.call(p,p.__data__,m,d),y,x=gr(p,n),_=0,v=f.length;_<v;++_)(y=f[_])&&qu(y,t,n,_,f,x);i.push(f),l.push(p)}return new Vr(i,l,t,n)}var jk=Fl.prototype.constructor;function Ck(){return new jk(this._groups,this._parents)}function Sk(e,t){var n,s,r;return function(){var i=Ci(this,e),l=(this.style.removeProperty(e),Ci(this,e));return i===l?null:i===n&&l===s?r:r=t(n=i,s=l)}}function Xy(e){return function(){this.style.removeProperty(e)}}function Ek(e,t,n){var s,r=n+"",i;return function(){var l=Ci(this,e);return l===r?null:l===s?i:i=t(s=l,n)}}function Mk(e,t,n){var s,r,i;return function(){var l=Ci(this,e),u=n(this),d=u+"";return u==null&&(d=u=(this.style.removeProperty(e),Ci(this,e))),l===d?null:l===s&&d===r?i:(r=d,i=t(s=l,u))}}function kk(e,t){var n,s,r,i="style."+t,l="end."+i,u;return function(){var d=Pr(this,e),h=d.on,p=d.value[i]==null?u||(u=Xy(t)):void 0;(h!==n||r!==p)&&(s=(n=h).copy()).on(l,r=p),d.on=s}}function Ak(e,t,n){var s=(e+="")=="transform"?OM:Gy;return t==null?this.styleTween(e,Sk(e,s)).on("end.style."+e,Xy(e)):typeof t=="function"?this.styleTween(e,Mk(e,s,eh(this,"style."+e,t))).each(kk(this._id,e)):this.styleTween(e,Ek(e,s,t),n).on("end.style."+e,null)}function Ok(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function Tk(e,t,n){var s,r;function i(){var l=t.apply(this,arguments);return l!==r&&(s=(r=l)&&Ok(e,l,n)),s}return i._value=t,i}function $k(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,Tk(e,t,n??""))}function Pk(e){return function(){this.textContent=e}}function Lk(e){return function(){var t=e(this);this.textContent=t??""}}function Rk(e){return this.tween("text",typeof e=="function"?Lk(eh(this,"text",e)):Pk(e==null?"":e+""))}function Dk(e){return function(t){this.textContent=e.call(this,t)}}function zk(e){var t,n;function s(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Dk(r)),t}return s._value=e,s}function Ik(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,zk(e))}function Fk(){for(var e=this._name,t=this._id,n=Qy(),s=this._groups,r=s.length,i=0;i<r;++i)for(var l=s[i],u=l.length,d,h=0;h<u;++h)if(d=l[h]){var p=gr(d,t);qu(d,e,n,h,l,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new Vr(s,this._parents,e,n)}function Bk(){var e,t,n=this,s=n._id,r=n.size();return new Promise(function(i,l){var u={value:l},d={value:function(){--r===0&&i()}};n.each(function(){var h=Pr(this,s),p=h.on;p!==e&&(t=(e=p).copy(),t._.cancel.push(u),t._.interrupt.push(u),t._.end.push(d)),h.on=t}),r===0&&i()})}var Uk=0;function Vr(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function Qy(){return++Uk}var Wr=Fl.prototype;Vr.prototype={constructor:Vr,select:wk,selectAll:Nk,selectChild:Wr.selectChild,selectChildren:Wr.selectChildren,filter:pk,merge:gk,selection:Ck,transition:Fk,call:Wr.call,nodes:Wr.nodes,node:Wr.node,size:Wr.size,empty:Wr.empty,each:Wr.each,on:vk,attr:JM,attrTween:rk,style:Ak,styleTween:$k,text:Rk,textTween:Ik,remove:bk,tween:WM,delay:ik,duration:uk,ease:mk,easeVarying:hk,end:Bk,[Symbol.iterator]:Wr[Symbol.iterator]};function Hk(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var qk={time:null,delay:0,duration:250,ease:Hk};function Vk(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Wk(e){var t,n;e instanceof Vr?(t=e._id,e=e._name):(t=Qy(),(n=qk).time=Gf(),e=e==null?null:e+"");for(var s=this._groups,r=s.length,i=0;i<r;++i)for(var l=s[i],u=l.length,d,h=0;h<u;++h)(d=l[h])&&qu(d,e,t,h,l,n||Vk(d,t));return new Vr(s,this._parents,e,t)}Fl.prototype.interrupt=HM,Fl.prototype.transition=Wk;const Wu=e=>()=>e;function Yk(e,{sourceEvent:t,target:n,transform:s,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:r}})}function Yr(e,t,n){this.k=e,this.x=t,this.y=n}Yr.prototype={constructor:Yr,scale:function(e){return e===1?this:new Yr(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Yr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Kr=new Yr(1,0,0);Zy.prototype=Yr.prototype;function Zy(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Kr;return e.__zoom}function th(e){e.stopImmediatePropagation()}function Xl(e){e.preventDefault(),e.stopImmediatePropagation()}function Kk(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Gk(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Jy(){return this.__zoom||Kr}function Xk(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Qk(){return navigator.maxTouchPoints||"ontouchstart"in this}function Zk(e,t,n){var s=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],l=e.invertY(t[1][1])-n[1][1];return e.translate(r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r),l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l))}function nh(){var e=Kk,t=Gk,n=Zk,s=Xk,r=Qk,i=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,d=Du,h=Su("start","zoom","end"),p,m,f,y=500,x=150,_=0,v=10;function w(R){R.property("__zoom",Jy).on("wheel.zoom",$,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",P).filter(r).on("touchstart.zoom",A).on("touchmove.zoom",D).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(R,z,q,V){var U=R.selection?R.selection():R;U.property("__zoom",Jy),R!==U?j(R,z,q,V):U.interrupt().each(function(){E(this,arguments).event(V).start().zoom(null,typeof z=="function"?z.apply(this,arguments):z).end()})},w.scaleBy=function(R,z,q,V){w.scaleTo(R,function(){var U=this.__zoom.k,W=typeof z=="function"?z.apply(this,arguments):z;return U*W},q,V)},w.scaleTo=function(R,z,q,V){w.transform(R,function(){var U=t.apply(this,arguments),W=this.__zoom,B=q==null?C(U):typeof q=="function"?q.apply(this,arguments):q,I=W.invert(B),H=typeof z=="function"?z.apply(this,arguments):z;return n(N(M(W,H),B,I),U,l)},q,V)},w.translateBy=function(R,z,q,V){w.transform(R,function(){return n(this.__zoom.translate(typeof z=="function"?z.apply(this,arguments):z,typeof q=="function"?q.apply(this,arguments):q),t.apply(this,arguments),l)},null,V)},w.translateTo=function(R,z,q,V,U){w.transform(R,function(){var W=t.apply(this,arguments),B=this.__zoom,I=V==null?C(W):typeof V=="function"?V.apply(this,arguments):V;return n(Kr.translate(I[0],I[1]).scale(B.k).translate(typeof z=="function"?-z.apply(this,arguments):-z,typeof q=="function"?-q.apply(this,arguments):-q),W,l)},V,U)};function M(R,z){return z=Math.max(i[0],Math.min(i[1],z)),z===R.k?R:new Yr(z,R.x,R.y)}function N(R,z,q){var V=z[0]-q[0]*R.k,U=z[1]-q[1]*R.k;return V===R.x&&U===R.y?R:new Yr(R.k,V,U)}function C(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function j(R,z,q,V){R.on("start.zoom",function(){E(this,arguments).event(V).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(V).end()}).tween("zoom",function(){var U=this,W=arguments,B=E(U,W).event(V),I=t.apply(U,W),H=q==null?C(I):typeof q=="function"?q.apply(U,W):q,J=Math.max(I[1][0]-I[0][0],I[1][1]-I[0][1]),G=U.__zoom,Y=typeof z=="function"?z.apply(U,W):z,X=d(G.invert(H).concat(J/G.k),Y.invert(H).concat(J/Y.k));return function(Z){if(Z===1)Z=Y;else{var ee=X(Z),Q=J/ee[2];Z=new Yr(Q,H[0]-ee[0]*Q,H[1]-ee[1]*Q)}B.zoom(null,Z)}})}function E(R,z,q){return!q&&R.__zooming||new k(R,z)}function k(R,z){this.that=R,this.args=z,this.active=0,this.sourceEvent=null,this.extent=t.apply(R,z),this.taps=0}k.prototype={event:function(R){return R&&(this.sourceEvent=R),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,z){return this.mouse&&R!=="mouse"&&(this.mouse[1]=z.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=z.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=z.invert(this.touch1[0])),this.that.__zoom=z,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){var z=vs(this.that).datum();h.call(R,this.that,new Yk(R,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:h}),z)}};function $(R,...z){if(!e.apply(this,arguments))return;var q=E(this,z).event(R),V=this.__zoom,U=Math.max(i[0],Math.min(i[1],V.k*Math.pow(2,s.apply(this,arguments)))),W=rr(R);if(q.wheel)(q.mouse[0][0]!==W[0]||q.mouse[0][1]!==W[1])&&(q.mouse[1]=V.invert(q.mouse[0]=W)),clearTimeout(q.wheel);else{if(V.k===U)return;q.mouse=[W,V.invert(W)],Vu(this),q.start()}Xl(R),q.wheel=setTimeout(B,x),q.zoom("mouse",n(N(M(V,U),q.mouse[0],q.mouse[1]),q.extent,l));function B(){q.wheel=null,q.end()}}function T(R,...z){if(f||!e.apply(this,arguments))return;var q=R.currentTarget,V=E(this,z,!0).event(R),U=vs(R.view).on("mousemove.zoom",H,!0).on("mouseup.zoom",J,!0),W=rr(R,q),B=R.clientX,I=R.clientY;Ny(R.view),th(R),V.mouse=[W,this.__zoom.invert(W)],Vu(this),V.start();function H(G){if(Xl(G),!V.moved){var Y=G.clientX-B,X=G.clientY-I;V.moved=Y*Y+X*X>_}V.event(G).zoom("mouse",n(N(V.that.__zoom,V.mouse[0]=rr(G,q),V.mouse[1]),V.extent,l))}function J(G){U.on("mousemove.zoom mouseup.zoom",null),jy(G.view,V.moved),Xl(G),V.event(G).end()}}function P(R,...z){if(e.apply(this,arguments)){var q=this.__zoom,V=rr(R.changedTouches?R.changedTouches[0]:R,this),U=q.invert(V),W=q.k*(R.shiftKey?.5:2),B=n(N(M(q,W),V,U),t.apply(this,z),l);Xl(R),u>0?vs(this).transition().duration(u).call(j,B,V,R):vs(this).call(w.transform,B,V,R)}}function A(R,...z){if(e.apply(this,arguments)){var q=R.touches,V=q.length,U=E(this,z,R.changedTouches.length===V).event(R),W,B,I,H;for(th(R),B=0;B<V;++B)I=q[B],H=rr(I,this),H=[H,this.__zoom.invert(H),I.identifier],U.touch0?!U.touch1&&U.touch0[2]!==H[2]&&(U.touch1=H,U.taps=0):(U.touch0=H,W=!0,U.taps=1+!!p);p&&(p=clearTimeout(p)),W&&(U.taps<2&&(m=H[0],p=setTimeout(function(){p=null},y)),Vu(this),U.start())}}function D(R,...z){if(this.__zooming){var q=E(this,z).event(R),V=R.changedTouches,U=V.length,W,B,I,H;for(Xl(R),W=0;W<U;++W)B=V[W],I=rr(B,this),q.touch0&&q.touch0[2]===B.identifier?q.touch0[0]=I:q.touch1&&q.touch1[2]===B.identifier&&(q.touch1[0]=I);if(B=q.that.__zoom,q.touch1){var J=q.touch0[0],G=q.touch0[1],Y=q.touch1[0],X=q.touch1[1],Z=(Z=Y[0]-J[0])*Z+(Z=Y[1]-J[1])*Z,ee=(ee=X[0]-G[0])*ee+(ee=X[1]-G[1])*ee;B=M(B,Math.sqrt(Z/ee)),I=[(J[0]+Y[0])/2,(J[1]+Y[1])/2],H=[(G[0]+X[0])/2,(G[1]+X[1])/2]}else if(q.touch0)I=q.touch0[0],H=q.touch0[1];else return;q.zoom("touch",n(N(B,I,H),q.extent,l))}}function F(R,...z){if(this.__zooming){var q=E(this,z).event(R),V=R.changedTouches,U=V.length,W,B;for(th(R),f&&clearTimeout(f),f=setTimeout(function(){f=null},y),W=0;W<U;++W)B=V[W],q.touch0&&q.touch0[2]===B.identifier?delete q.touch0:q.touch1&&q.touch1[2]===B.identifier&&delete q.touch1;if(q.touch1&&!q.touch0&&(q.touch0=q.touch1,delete q.touch1),q.touch0)q.touch0[1]=this.__zoom.invert(q.touch0[0]);else if(q.end(),q.taps===2&&(B=rr(B,this),Math.hypot(m[0]-B[0],m[1]-B[1])<v)){var I=vs(this).on("dblclick.zoom");I&&I.apply(this,arguments)}}}return w.wheelDelta=function(R){return arguments.length?(s=typeof R=="function"?R:Wu(+R),w):s},w.filter=function(R){return arguments.length?(e=typeof R=="function"?R:Wu(!!R),w):e},w.touchable=function(R){return arguments.length?(r=typeof R=="function"?R:Wu(!!R),w):r},w.extent=function(R){return arguments.length?(t=typeof R=="function"?R:Wu([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),w):t},w.scaleExtent=function(R){return arguments.length?(i[0]=+R[0],i[1]=+R[1],w):[i[0],i[1]]},w.translateExtent=function(R){return arguments.length?(l[0][0]=+R[0][0],l[1][0]=+R[1][0],l[0][1]=+R[0][1],l[1][1]=+R[1][1],w):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},w.constrain=function(R){return arguments.length?(n=R,w):n},w.duration=function(R){return arguments.length?(u=+R,w):u},w.interpolate=function(R){return arguments.length?(d=R,w):d},w.on=function(){var R=h.on.apply(h,arguments);return R===h?w:R},w.clickDistance=function(R){return arguments.length?(_=(R=+R)*R,w):Math.sqrt(_)},w.tapDistance=function(R){return arguments.length?(v=+R,w):v},w}function Tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sh(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function ev(e,t){if(e){if(typeof e=="string")return sh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sh(e,t)}}function Jk(e){if(Array.isArray(e))return e}function eA(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],r=!0,i=!1,l,u;try{for(n=n.call(e);!(r=(l=n.next()).done)&&(s.push(l.value),!(t&&s.length===t));r=!0);}catch(d){i=!0,u=d}finally{try{!r&&n.return!=null&&n.return()}finally{if(i)throw u}}return s}}function tA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xt(e,t){return Jk(e)||eA(e,t)||ev(e,t)||tA()}var To;(function(e){e.Strict="strict",e.Loose="loose"})(To||(To={}));var ki;(function(e){e.Lines="lines",e.Dots="dots"})(ki||(ki={}));var Ai;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Ai||(Ai={}));var ba;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(ba||(ba={}));var Yu;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Yu||(Yu={}));var Pe;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Pe||(Pe={}));var rh=function(t){return{width:t.offsetWidth,height:t.offsetHeight}},Oi=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(Math.max(t,n),s)},tv=function(t,n){return{x:Oi(t.x,n[0][0],n[1][0]),y:Oi(t.y,n[0][1],n[1][1])}},nv=function(t){var n,s;return((n=t.getRootNode)===null||n===void 0?void 0:n.call(t))||((s=window)===null||s===void 0?void 0:s.document)},nA=function(t,n){return{x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x2,n.x2),y2:Math.max(t.y2,n.y2)}},Ku=function(t){var n=t.x,s=t.y,r=t.width,i=t.height;return{x:n,y:s,x2:n+r,y2:s+i}},sA=function(t){var n=t.x,s=t.y,r=t.x2,i=t.y2;return{x:n,y:s,width:r-n,height:i-s}},sv=function(t){return!isNaN(t)&&isFinite(t)},rs=Symbol("internals");function rv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Ql(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function av(e,t){var n=e.find(function(h){return h.id===t.parentNode});if(n){var s=t.position.x+t.width-n.width,r=t.position.y+t.height-n.height;if(s>0||r>0||t.position.x<0||t.position.y<0){var i,l;if(n.style=Ql({},n.style)||{},n.style.width=(i=n.style.width)!==null&&i!==void 0?i:n.width,n.style.height=(l=n.style.height)!==null&&l!==void 0?l:n.height,s>0&&(n.style.width+=s),r>0&&(n.style.height+=r),t.position.x<0){var u=Math.abs(t.position.x);n.position.x=n.position.x-u,n.style.width+=u,t.position.x=0}if(t.position.y<0){var d=Math.abs(t.position.y);n.position.y=n.position.y-d,n.style.height+=d,t.position.y=0}n.width=n.style.width,n.height=n.style.height}}}function ov(e,t){if(e.some(function(s){return s.type==="reset"}))return e.filter(function(s){return s.type==="reset"}).map(function(s){return s.item});var n=e.filter(function(s){return s.type==="add"}).map(function(s){return s.item});return t.reduce(function(s,r){var i=e.find(function(d){return d.id===r.id});if(i)switch(i.type){case"select":return s.push(Ql(Ql({},r),{},{selected:i.selected})),s;case"position":{var l=Ql({},r);return typeof i.position<"u"&&(l.position=i.position),typeof i.positionAbsolute<"u"&&(l.positionAbsolute=i.positionAbsolute),typeof i.dragging<"u"&&(l.dragging=i.dragging),l.expandParent&&av(s,l),s.push(l),s}case"dimensions":{var u=Ql({},r);return typeof i.dimensions<"u"&&(u.width=i.dimensions.width,u.height=i.dimensions.height),u.expandParent&&av(s,u),s.push(u),s}case"remove":return s}return s.push(r),s},n)}function iv(e,t){return ov(e,t)}function rA(e,t){return ov(e,t)}var wa=function(t,n){return{id:t,type:"select",selected:n}};function Ti(e,t){return e.reduce(function(n,s){var r=t.includes(s.id);return!s.selected&&r?(s.selected=!0,n.push(wa(s.id,!0))):s.selected&&!r&&(s.selected=!1,n.push(wa(s.id,!1))),n},[])}function lv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function cv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var uv=function(t,n,s){var r=n.querySelectorAll(t);if(!r||!r.length)return null;var i=Array.from(r),l=n.getBoundingClientRect();return i.map(function(u){var d=u.getBoundingClientRect();return cv({id:u.getAttribute("data-handleid"),position:u.getAttribute("data-handlepos"),x:(d.left-l.left)/s,y:(d.top-l.top)/s},rh(u))})};function Zl(e,t,n){return n===void 0?n:function(s){var r=t().nodeInternals.get(e);n(s,cv({},r))}}function dv(e){var t=e.id,n=e.store,s=n.getState(),r=s.addSelectedNodes,i=s.unselectNodesAndEdges,l=s.multiSelectionActive,u=s.nodeInternals,d=u.get(t);n.setState({nodesSelectionActive:!1}),d.selected?d.selected&&l&&i({nodes:[d]}):r([t])}function mv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Jl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var aA=function(t){return"id"in t&&"source"in t&&"target"in t},oA=function(t){var n=t.source,s=t.sourceHandle,r=t.target,i=t.targetHandle;return"reactflow__edge-".concat(n).concat(s||"","-").concat(r).concat(i||"")},ah=function(t,n){if(typeof t>"u")return"";if(typeof t=="string")return t;var s=n?"".concat(n,"__"):"";return"".concat(s).concat(Object.keys(t).sort().map(function(r){return"".concat(r,"=").concat(t[r])}).join("&"))},iA=function(t,n){return n.some(function(s){return s.source===t.source&&s.target===t.target&&(s.sourceHandle===t.sourceHandle||!s.sourceHandle&&!t.sourceHandle)&&(s.targetHandle===t.targetHandle||!s.targetHandle&&!t.targetHandle)})},fv=function(t,n){if(!t.source||!t.target)return n;var s;return aA(t)?s=Jl({},t):s=Jl(Jl({},t),{},{id:oA(t)}),iA(s,n)?n:n.concat(s)},hv=function(t,n,s,r){var i=t.x,l=t.y,u=xt(n,3),d=u[0],h=u[1],p=u[2],m=xt(r,2),f=m[0],y=m[1],x={x:(i-d)/p,y:(l-h)/p};return s?{x:f*Math.round(x.x/f),y:y*Math.round(x.y/y)}:x},oh=function(t){if(t.length===0)return{x:0,y:0,width:0,height:0};var n=t.reduce(function(s,r){var i=r.positionAbsolute,l=r.position,u=r.width,d=r.height;return nA(s,Ku({x:i?i.x:l.x,y:i?i.y:l.y,width:u||0,height:d||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return sA(n)},pv=function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,1],r=xt(s,3),i=r[0],l=r[1],u=r[2],d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,p=Ku({x:(n.x-i)/u,y:(n.y-l)/u,width:n.width/u,height:n.height/u}),m=[];return t.forEach(function(f){var y=f.positionAbsolute,x=f.width,_=f.height,v=f.selectable,w=v===void 0?!0:v;if(h&&!w)return!1;var M=Ku(Jl(Jl({},y),{},{width:x||0,height:_||0})),N=Math.max(0,Math.min(p.x2,M.x2)-Math.max(p.x,M.x)),C=Math.max(0,Math.min(p.y2,M.y2)-Math.max(p.y,M.y)),j=Math.ceil(N*C),E=typeof x>"u"||typeof _>"u"||x===null||_===null,k=d&&j>0,$=(x||0)*(_||0),T=E||k||j>=$;T&&m.push(f)}),m},gv=function(t,n){var s=t.map(function(r){return r.id});return n.filter(function(r){return s.includes(r.source)||s.includes(r.target)})},_v=function(t,n,s,r,i){var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:.1,u=n/(t.width*(1+l)),d=s/(t.height*(1+l)),h=Math.min(u,d),p=Oi(h,r,i),m=t.x+t.width/2,f=t.y+t.height/2,y=n/2-m*p,x=s/2-f*p;return[y,x,p]},$o=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.transition().duration(n)};function yv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function $i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function vv(e,t,n,s){var r,i,l,u,d,h,p,m,f,y,x,_;if(!e.parentNode)return s;var v=t.get(e.parentNode);return vv(v,t,n,{x:((r=s.x)!==null&&r!==void 0?r:0)+((i=(l=v.position)===null||l===void 0?void 0:l.x)!==null&&i!==void 0?i:0),y:((u=s.y)!==null&&u!==void 0?u:0)+((d=(h=v.position)===null||h===void 0?void 0:h.y)!==null&&d!==void 0?d:0),z:((p=(m=v[rs])===null||m===void 0?void 0:m.z)!==null&&p!==void 0?p:0)>((f=s.z)!==null&&f!==void 0?f:0)?(y=(x=v[rs])===null||x===void 0?void 0:x.z)!==null&&y!==void 0?y:0:(_=s.z)!==null&&_!==void 0?_:0})}function ih(e,t){var n=new Map,s={};return e.forEach(function(r){var i,l=sv(r.zIndex)?r.zIndex:r.selected?1e3:0,u=t.get(r.id),d=$i($i({width:u==null?void 0:u.width,height:u==null?void 0:u.height},r),{},{positionAbsolute:{x:r.position.x,y:r.position.y}});r.parentNode&&(d.parentNode=r.parentNode,s[r.parentNode]=!0),Object.defineProperty(d,rs,{enumerable:!1,value:{handleBounds:u==null||(i=u[rs])===null||i===void 0?void 0:i.handleBounds,z:l}}),n.set(r.id,d)}),n.forEach(function(r){if(r.parentNode&&!n.has(r.parentNode))throw new Error("Parent node ".concat(r.parentNode," not found"));if(r.parentNode||s[r.id]){var i,l,u=vv(r,n,s,$i($i({},r.position),{},{z:(i=(l=r[rs])===null||l===void 0?void 0:l.z)!==null&&i!==void 0?i:0})),d=u.x,h=u.y,p=u.z;r.positionAbsolute={x:d,y:h},r[rs].z=p,s[r.id]&&(r[rs].isParent=!0)}}),n}function xv(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e(),s=n.nodeInternals,r=n.width,i=n.height,l=n.minZoom,u=n.maxZoom,d=n.d3Zoom,h=n.d3Selection,p=n.fitViewOnInitDone,m=n.fitViewOnInit;if((t.initial&&!p&&m||!t.initial)&&d&&h){var f=Array.from(s.values()).filter(function($){return t.includeHiddenNodes?$.width&&$.height:!$.hidden}),y=f.every(function($){return $.width&&$.height});if(f.length>0&&y){var x,_,v,w=oh(f),M=_v(w,r,i,(x=t.minZoom)!==null&&x!==void 0?x:l,(_=t.maxZoom)!==null&&_!==void 0?_:u,(v=t.padding)!==null&&v!==void 0?v:.1),N=xt(M,3),C=N[0],j=N[1],E=N[2],k=Kr.translate(C,j).scale(E);return typeof t.duration=="number"&&t.duration>0?d.transform($o(h,t.duration),k):d.transform(h,k),!0}}return!1}function lA(e,t){return e.forEach(function(n){var s=t.get(n.id);if(s){var r;t.set(s.id,$i($i({},s),{},(r={},Tt(r,rs,s[rs]),Tt(r,"selected",n.selected),r)))}}),new Map(t)}function cA(e,t){return t.map(function(n){var s=e.find(function(r){return r.id===n.id});return s&&(n.selected=s.selected),n})}function Gu(e){var t=e.changedNodes,n=e.changedEdges,s=e.get,r=e.set,i=s(),l=i.nodeInternals,u=i.edges,d=i.onNodesChange,h=i.onEdgesChange,p=i.hasDefaultNodes,m=i.hasDefaultEdges;t!=null&&t.length&&(p&&r({nodeInternals:lA(t,l)}),d==null||d(t)),n!=null&&n.length&&(m&&r({edges:cA(n,u)}),h==null||h(n))}var lh=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],bv={width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:lh,nodeExtent:lh,nodesSelectionActive:!1,userSelectionActive:!1,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionMode:To.Strict,domNode:null,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,multiSelectionActive:!1,reactFlowVersion:"10.3.17",connectionStartHandle:null,connectOnClick:!0};function wv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Lr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var ch=vE(),Nv=ch.Provider,On=ch.useStore,ms=ch.useStoreApi,jv=function(){return yE(function(t,n){return Lr(Lr({},bv),{},{setNodes:function(r){t({nodeInternals:ih(r,n().nodeInternals)})},setEdges:function(r){var i=n(),l=i.defaultEdgeOptions,u=l===void 0?{}:l;t({edges:r.map(function(d){return Lr(Lr({},u),d)})})},setDefaultNodesAndEdges:function(r,i){var l=typeof r<"u",u=typeof i<"u",d=l?ih(r,new Map):new Map,h=u?i:[];t({nodeInternals:d,edges:h,hasDefaultNodes:l,hasDefaultEdges:u})},updateNodeDimensions:function(r){var i=n(),l=i.onNodesChange,u=i.nodeInternals,d=i.fitViewOnInit,h=i.fitViewOnInitDone,p=i.fitViewOnInitOptions,m=i.domNode,f=m==null?void 0:m.querySelector(".react-flow__viewport");if(f){var y=window.getComputedStyle(f),x=new window.DOMMatrixReadOnly(y.transform),_=x.m22,v=r.reduce(function(M,N){var C=u.get(N.id);if(C){var j=rh(N.nodeElement),E=!!(j.width&&j.height&&(C.width!==j.width||C.height!==j.height||N.forceUpdate));E&&(u.set(C.id,Lr(Lr({},C),{},Tt({},rs,Lr(Lr({},C[rs]),{},{handleBounds:{source:uv(".source",N.nodeElement,_),target:uv(".target",N.nodeElement,_)}})),j)),M.push({id:C.id,type:"dimensions",dimensions:j}))}return M},[]),w=h||d&&!h&&xv(n,Lr({initial:!0},p));t({nodeInternals:new Map(u),fitViewOnInitDone:w}),(v==null?void 0:v.length)>0&&(l==null||l(v))}},updateNodePositions:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,u=n(),d=u.onNodesChange,h=u.nodeInternals,p=u.hasDefaultNodes;if(p||d){var m=r.map(function(x){var _={id:x.id,type:"position",dragging:l};return i&&(_.positionAbsolute=x.positionAbsolute,_.position=x.position),_});if(m!=null&&m.length){if(p){var f=iv(m,Array.from(h.values())),y=ih(f,h);t({nodeInternals:y})}d==null||d(m)}}},addSelectedNodes:function(r){var i=n(),l=i.multiSelectionActive,u=i.nodeInternals,d=i.edges,h,p=null;l?h=r.map(function(m){return wa(m,!0)}):(h=Ti(Array.from(u.values()),r),p=Ti(d,[])),Gu({changedNodes:h,changedEdges:p,get:n,set:t})},addSelectedEdges:function(r){var i=n(),l=i.multiSelectionActive,u=i.edges,d=i.nodeInternals,h,p=null;l?h=r.map(function(m){return wa(m,!0)}):(h=Ti(u,r),p=Ti(Array.from(d.values()),[])),Gu({changedNodes:p,changedEdges:h,get:n,set:t})},unselectNodesAndEdges:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r.nodes,l=r.edges,u=n(),d=u.nodeInternals,h=u.edges,p=i||Array.from(d.values()),m=l||h,f=p.map(function(x){return x.selected=!1,wa(x.id,!1)}),y=m.map(function(x){return wa(x.id,!1)});Gu({changedNodes:f,changedEdges:y,get:n,set:t})},setMinZoom:function(r){var i=n(),l=i.d3Zoom,u=i.maxZoom;l==null||l.scaleExtent([r,u]),t({minZoom:r})},setMaxZoom:function(r){var i=n(),l=i.d3Zoom,u=i.minZoom;l==null||l.scaleExtent([u,r]),t({maxZoom:r})},setTranslateExtent:function(r){var i=n(),l=i.d3Zoom;l==null||l.translateExtent(r),t({translateExtent:r})},resetSelectedElements:function(){var r=n(),i=r.nodeInternals,l=r.edges,u=Array.from(i.values()),d=u.filter(function(p){return p.selected}).map(function(p){return wa(p.id,!1)}),h=l.filter(function(p){return p.selected}).map(function(p){return wa(p.id,!1)});Gu({changedNodes:d,changedEdges:h,get:n,set:t})},setNodeExtent:function(r){var i=n(),l=i.nodeInternals;l.forEach(function(u){u.positionAbsolute=tv(u.position,r)}),t({nodeExtent:r,nodeInternals:new Map(l)})},reset:function(){return t(Lr({},bv))}})})};function Lt(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,s;n<e.length;n++)(s=Lt(e[n]))!==""&&(t+=(t&&" ")+s);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}function Vs(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let s=0;s<n.length;s++)if(!Object.prototype.hasOwnProperty.call(t,n[s])||!Object.is(e[n[s]],t[n[s]]))return!1;return!0}function uA(e){if(Array.isArray(e))return sh(e)}function dA(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function mA(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Po(e){return uA(e)||dA(e)||ev(e)||mA()}var fA={zoomIn:function(){},zoomOut:function(){},zoomTo:function(t){},getZoom:function(){return 1},setViewport:function(t){},getViewport:function(){return{x:0,y:0,zoom:1}},fitView:function(){},setCenter:function(t,n){},fitBounds:function(t){},project:function(t){return t},viewportInitialized:!1},hA=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection}},pA=function(){var t=ms(),n=On(hA,Vs),s=n.d3Zoom,r=n.d3Selection,i=b.useMemo(function(){return r&&s?{zoomIn:function(u){return s.scaleBy($o(r,u==null?void 0:u.duration),1.2)},zoomOut:function(u){return s.scaleBy($o(r,u==null?void 0:u.duration),1/1.2)},zoomTo:function(u,d){return s.scaleTo($o(r,d==null?void 0:d.duration),u)},getZoom:function(){return t.getState().transform[2]},setViewport:function(u,d){var h,p,m,f=xt(t.getState().transform,3),y=f[0],x=f[1],_=f[2],v=Kr.translate((h=u.x)!==null&&h!==void 0?h:y,(p=u.y)!==null&&p!==void 0?p:x).scale((m=u.zoom)!==null&&m!==void 0?m:_);s.transform($o(r,d==null?void 0:d.duration),v)},getViewport:function(){var u=xt(t.getState().transform,3),d=u[0],h=u[1],p=u[2];return{x:d,y:h,zoom:p}},fitView:function(u){return xv(t.getState,u)},setCenter:function(u,d,h){var p=t.getState(),m=p.width,f=p.height,y=p.maxZoom,x=typeof(h==null?void 0:h.zoom)<"u"?h.zoom:y,_=m/2-u*x,v=f/2-d*x,w=Kr.translate(_,v).scale(x);s.transform($o(r,h==null?void 0:h.duration),w)},fitBounds:function(u,d){var h,p=t.getState(),m=p.width,f=p.height,y=p.minZoom,x=p.maxZoom,_=_v(u,m,f,y,x,(h=d==null?void 0:d.padding)!==null&&h!==void 0?h:.1),v=xt(_,3),w=v[0],M=v[1],N=v[2],C=Kr.translate(w,M).scale(N);s.transform($o(r,d==null?void 0:d.duration),C)},project:function(u){var d=t.getState(),h=d.transform,p=d.snapToGrid,m=d.snapGrid;return hv(u,h,p,m)},viewportInitialized:!0}:fA},[s,r]);return i};function Cv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Pi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Cv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function uh(){var e=pA(),t=ms(),n=b.useCallback(function(){var m=t.getState(),f=m.nodeInternals,y=Array.from(f.values());return y.map(function(x){return Pi({},x)})},[]),s=b.useCallback(function(m){var f=t.getState(),y=f.nodeInternals;return y.get(m)},[]),r=b.useCallback(function(){var m=t.getState(),f=m.edges,y=f===void 0?[]:f;return y.map(function(x){return Pi({},x)})},[]),i=b.useCallback(function(m){var f=t.getState(),y=f.edges,x=y===void 0?[]:y;return x.find(function(_){return _.id===m})},[]),l=b.useCallback(function(m){var f=t.getState(),y=f.nodeInternals,x=f.setNodes,_=f.hasDefaultNodes,v=f.onNodesChange,w=Array.from(y.values()),M=typeof m=="function"?m(w):m;if(_)x(M);else if(v){var N=M.length===0?w.map(function(C){return{type:"remove",id:C.id}}):M.map(function(C){return{item:C,type:"reset"}});v(N)}},[]),u=b.useCallback(function(m){var f=t.getState(),y=f.edges,x=y===void 0?[]:y,_=f.setEdges,v=f.hasDefaultEdges,w=f.onEdgesChange,M=typeof m=="function"?m(x):m;if(v)_(M);else if(w){var N=M.length===0?x.map(function(C){return{type:"remove",id:C.id}}):M.map(function(C){return{item:C,type:"reset"}});w(N)}},[]),d=b.useCallback(function(m){var f=Array.isArray(m)?m:[m],y=t.getState(),x=y.nodeInternals,_=y.setNodes,v=y.hasDefaultNodes,w=y.onNodesChange;if(v){var M=Array.from(x.values()),N=[].concat(M,Po(f));_(N)}else if(w){var C=f.map(function(j){return{item:j,type:"add"}});w(C)}},[]),h=b.useCallback(function(m){var f=Array.isArray(m)?m:[m],y=t.getState(),x=y.edges,_=x===void 0?[]:x,v=y.setEdges,w=y.hasDefaultEdges,M=y.onEdgesChange;if(w)v([].concat(Po(_),Po(f)));else if(M){var N=f.map(function(C){return{item:C,type:"add"}});M(N)}},[]),p=b.useCallback(function(){var m=t.getState(),f=m.nodeInternals,y=m.edges,x=y===void 0?[]:y,_=m.transform,v=Array.from(f.values()),w=xt(_,3),M=w[0],N=w[1],C=w[2];return{nodes:v.map(function(j){return Pi({},j)}),edges:x.map(function(j){return Pi({},j)}),viewport:{x:M,y:N,zoom:C}}},[]);return b.useMemo(function(){return Pi(Pi({},e),{},{getNodes:n,getNode:s,getEdges:r,getEdge:i,setNodes:l,setEdges:u,addNodes:d,addEdges:h,toObject:p})},[e,n,s,r,i,l,u,d,h,p])}function gA(e,t){if(e==null)return{};var n={},s=Object.keys(e),r,i;for(i=0;i<s.length;i++)r=s[i],!(t.indexOf(r)>=0)&&(n[r]=e[r]);return n}function Xu(e,t){if(e==null)return{};var n=gA(e,t),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function _A(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},ve.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function yA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},ve.createElement("path",{d:"M0 0h32v4.2H0z"}))}function vA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},ve.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function xA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ve.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function bA(){return ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ve.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}var wA=["children","className"];function Sv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function NA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Sv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Qu=function(t){var n=t.children,s=t.className,r=Xu(t,wA);return ve.createElement("button",NA({type:"button",className:Lt(["react-flow__controls-button",s])},r),n)},jA=function(t){return t.nodesDraggable&&t.nodesConnectable&&t.elementsSelectable},Ev=function(t){var n=t.style,s=t.showZoom,r=s===void 0?!0:s,i=t.showFitView,l=i===void 0?!0:i,u=t.showInteractive,d=u===void 0?!0:u,h=t.fitViewOptions,p=t.onZoomIn,m=t.onZoomOut,f=t.onFitView,y=t.onInteractiveChange,x=t.className,_=t.children,v=ms(),w=b.useState(!1),M=xt(w,2),N=M[0],C=M[1],j=On(jA),E=uh(),k=E.zoomIn,$=E.zoomOut,T=E.fitView;if(b.useEffect(function(){C(!0)},[]),!N)return null;var P=function(){k==null||k(),p==null||p()},A=function(){$==null||$(),m==null||m()},D=function(){T==null||T(h),f==null||f()},F=function(){v.setState({nodesDraggable:!j,nodesConnectable:!j,elementsSelectable:!j}),y==null||y(!j)};return ve.createElement("div",{className:Lt(["react-flow__controls",x]),style:n},r&&ve.createElement(ve.Fragment,null,ve.createElement(Qu,{onClick:P,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in"},ve.createElement(_A,null)),ve.createElement(Qu,{onClick:A,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out"},ve.createElement(yA,null))),l&&ve.createElement(Qu,{className:"react-flow__controls-fitview",onClick:D,title:"fit view","aria-label":"fit view"},ve.createElement(vA,null)),d&&ve.createElement(Qu,{className:"react-flow__controls-interactive",onClick:F,title:"toggle interactivity","aria-label":"toggle interactivity"},j?ve.createElement(bA,null):ve.createElement(xA,null)),_)};Ev.displayName="Controls";var CA=b.memo(Ev),SA=function(t,n,s){return ve.createElement("path",{stroke:s,strokeWidth:n,d:"M".concat(t/2," 0 V").concat(t," M0 ").concat(t/2," H").concat(t)})},EA=function(t,n){return ve.createElement("circle",{cx:t,cy:t,r:t,fill:n})},Zu;function Mv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function kv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Mv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var MA=(Zu={},Tt(Zu,ki.Dots,"#81818a"),Tt(Zu,ki.Lines,"#eee"),Zu),kA=function(t){return t.transform},Av=function(t){var n=t.variant,s=n===void 0?ki.Dots:n,r=t.gap,i=r===void 0?15:r,l=t.size,u=l===void 0?.4:l,d=t.color,h=t.style,p=t.className,m=b.useRef(null),f=b.useState(null),y=xt(f,2),x=y[0],_=y[1],v=On(kA),w=xt(v,3),M=w[0],N=w[1],C=w[2];b.useEffect(function(){var A=document.querySelectorAll(".react-flow__background"),D=Array.from(A).findIndex(function(F){return F===m.current});_("pattern-".concat(D))},[]);var j=i*C||1,E=M%j,k=N%j,$=s===ki.Lines,T=d||MA[s],P=$?SA(j,u,T):EA(u*C,T);return ve.createElement("svg",{className:Lt(["react-flow__background","react-flow__container",p]),style:kv(kv({},h),{},{width:"100%",height:"100%"}),ref:m},x&&ve.createElement(ve.Fragment,null,ve.createElement("pattern",{id:x,x:E,y:k,width:j,height:j,patternUnits:"userSpaceOnUse"},P),ve.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#".concat(x,")")})))};Av.displayName="Background";var AA=b.memo(Av),OA=function(t){return t.updateNodeDimensions};function TA(){var e=ms(),t=On(OA);return b.useCallback(function(n){var s,r=(s=e.getState().domNode)===null||s===void 0?void 0:s.querySelector('.react-flow__node[data-id="'.concat(n,'"]'));r&&requestAnimationFrame(function(){return t([{id:n,nodeElement:r,forceUpdate:!0}])})},[])}var $A=["paid-pro","paid-sponsor","paid-enterprise","paid-custom"];function PA(e){var t=e.proOptions,n=e.position,s=n===void 0?"bottom-right":n;if(t!=null&&t.account&&$A.includes(t==null?void 0:t.account)&&t!==null&&t!==void 0&&t.hideAttribution)return null;var r="".concat(s).split("-");return ve.createElement("div",{className:Lt(["react-flow__attribution"].concat(Po(r))),"data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev/pricing"},ve.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer"},"React Flow"))}var LA=["x","y","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","children","className"];function Ov(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function RA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ov(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ov(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var DA=function(t){var n=t.x,s=t.y,r=t.label,i=t.labelStyle,l=i===void 0?{}:i,u=t.labelShowBg,d=u===void 0?!0:u,h=t.labelBgStyle,p=h===void 0?{}:h,m=t.labelBgPadding,f=m===void 0?[2,4]:m,y=t.labelBgBorderRadius,x=y===void 0?2:y,_=t.children,v=t.className,w=Xu(t,LA),M=b.useRef(null),N=b.useState({x:0,y:0,width:0,height:0}),C=xt(N,2),j=C[0],E=C[1],k=Lt(["react-flow__edge-textwrapper",v]);return b.useEffect(function(){if(M.current){var $=M.current.getBBox();E({x:$.x,y:$.y,width:$.width,height:$.height})}},[r]),typeof r>"u"||!r?null:ve.createElement("g",RA({transform:"translate(".concat(n-j.width/2," ").concat(s-j.height/2,")"),className:k},w),d&&ve.createElement("rect",{width:j.width+2*f[0],x:-f[0],y:-f[1],height:j.height+2*f[1],className:"react-flow__edge-textbg",style:p,rx:x,ry:x}),ve.createElement("text",{className:"react-flow__edge-text",y:j.height/2,dy:"0.3em",ref:M,style:l},r),_)},zA=b.memo(DA),Ju=function(e){var t=e.path,n=e.centerX,s=e.centerY,r=e.label,i=e.labelStyle,l=e.labelShowBg,u=e.labelBgStyle,d=e.labelBgPadding,h=e.labelBgBorderRadius,p=e.style,m=e.markerEnd,f=e.markerStart,y=r?ve.createElement(zA,{x:n,y:s,label:r,labelStyle:i,labelShowBg:l,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:h}):null;return ve.createElement(ve.Fragment,null,ve.createElement("path",{style:p,d:t,className:"react-flow__edge-path",markerEnd:m,markerStart:f}),y)};function ed(e){var t=e.pos,n=e.x1,s=e.y1,r=e.x2,i=e.y2,l,u;switch(t){case Pe.Left:case Pe.Right:l=.5*(n+r),u=s;break;case Pe.Top:case Pe.Bottom:l=n,u=.5*(s+i);break}return[l,u]}function Tv(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Pe.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Pe.Top:u,h=ed({pos:r,x1:t,y1:n,x2:i,y2:l}),p=xt(h,2),m=p[0],f=p[1],y=ed({pos:d,x1:i,y1:l,x2:t,y2:n}),x=xt(y,2),_=x[0],v=x[1];return"M".concat(t,",").concat(n," C").concat(m,",").concat(f," ").concat(_,",").concat(v," ").concat(i,",").concat(l)}function IA(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Pe.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Pe.Top:u,h=ed({pos:r,x1:t,y1:n,x2:i,y2:l}),p=xt(h,2),m=p[0],f=p[1],y=ed({pos:d,x1:i,y1:l,x2:t,y2:n}),x=xt(y,2),_=x[0],v=x[1],w=t*.125+m*.375+_*.375+i*.125,M=n*.125+f*.375+v*.375+l*.125,N=Math.abs(w-t),C=Math.abs(M-n);return[w,M,N,C]}var $v=b.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.sourcePosition,l=i===void 0?Pe.Bottom:i,u=e.targetPosition,d=u===void 0?Pe.Top:u,h=e.label,p=e.labelStyle,m=e.labelShowBg,f=e.labelBgStyle,y=e.labelBgPadding,x=e.labelBgBorderRadius,_=e.style,v=e.markerEnd,w=e.markerStart,M={sourceX:t,sourceY:n,sourcePosition:l,targetX:s,targetY:r,targetPosition:d},N=Tv(M),C=IA(M),j=xt(C,2),E=j[0],k=j[1];return ve.createElement(Ju,{path:N,centerX:E,centerY:k,label:h,labelStyle:p,labelShowBg:m,labelBgStyle:f,labelBgPadding:y,labelBgBorderRadius:x,style:_,markerEnd:v,markerStart:w})});function Pv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function FA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Pv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Lv=[Pe.Left,Pe.Right],Rv=function(t){var n=t.sourceX,s=t.sourceY,r=t.targetX,i=t.targetY,l=t.sourcePosition,u=l===void 0?Pe.Bottom:l,d=t.targetPosition,h=d===void 0?Pe.Top:d,p=Lv.includes(u),m=Lv.includes(h),f=p&&!m||m&&!p;if(f){var y=p?Math.abs(r-n):0,x=n>r?n-y:n+y,_=p?0:Math.abs(i-s),v=s<i?s+_:s-_;return[x,v,y,_]}var w=Math.abs(r-n)/2,M=r<n?r+w:r-w,N=Math.abs(i-s)/2,C=i<s?i+N:i-N;return[M,C,w,N]};function ec(e,t,n){return n===void 0?n:function(s){var r=t().edges.find(function(i){return i.id===e});n(s,FA({},r))}}var dh=function(t,n,s){return"L ".concat(t,",").concat(n-s,"Q ").concat(t,",").concat(n," ").concat(t+s,",").concat(n)},mh=function(t,n,s){return"L ".concat(t+s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n-s)},fh=function(t,n,s){return"L ".concat(t,",").concat(n-s,"Q ").concat(t,",").concat(n," ").concat(t-s,",").concat(n)},hh=function(t,n,s){return"L ".concat(t-s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n-s)},ph=function(t,n,s){return"L ".concat(t+s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n+s)},gh=function(t,n,s){return"L ".concat(t,",").concat(n+s,"Q ").concat(t,",").concat(n," ").concat(t+s,",").concat(n)},_h=function(t,n,s){return"L ".concat(t,",").concat(n+s,"Q ").concat(t,",").concat(n," ").concat(t-s,",").concat(n)},yh=function(t,n,s){return"L ".concat(t-s,",").concat(n,"Q ").concat(t,",").concat(n," ").concat(t,",").concat(n+s)};function vh(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Pe.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Pe.Top:u,h=e.borderRadius,p=h===void 0?5:h,m=e.centerX,f=e.centerY,y=Rv({sourceX:t,sourceY:n,targetX:i,targetY:l}),x=xt(y,4),_=x[0],v=x[1],w=x[2],M=x[3],N=Math.min(p,Math.abs(i-t)),C=Math.min(p,Math.abs(l-n)),j=Math.min(N,C,w,M),E=[Pe.Left,Pe.Right],k=typeof m<"u"?m:_,$=typeof f<"u"?f:v,T=null,P=null;return t<=i?(T=n<=l?dh(t,$,j):gh(t,$,j),P=n<=l?yh(i,$,j):hh(i,$,j)):(T=n<l?fh(t,$,j):_h(t,$,j),P=n<l?ph(i,$,j):mh(i,$,j)),E.includes(r)&&E.includes(d)?t<=i?(T=n<=l?yh(k,n,j):hh(k,n,j),P=n<=l?dh(k,l,j):gh(k,l,j)):(r===Pe.Right&&d===Pe.Left||r===Pe.Left&&d===Pe.Right||r===Pe.Left&&d===Pe.Left)&&(T=n<=l?ph(k,n,j):mh(k,n,j),P=n<=l?fh(k,l,j):_h(k,l,j)):E.includes(r)&&!E.includes(d)?(t<=i?T=n<=l?yh(i,n,j):hh(i,n,j):T=n<=l?ph(i,n,j):mh(i,n,j),P=""):!E.includes(r)&&E.includes(d)&&(t<=i?T=n<=l?dh(t,l,j):gh(t,l,j):T=n<=l?fh(t,l,j):_h(t,l,j),P=""),"M ".concat(t,",").concat(n).concat(T).concat(P,"L ").concat(i,",").concat(l)}var xh=b.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.label,l=e.labelStyle,u=e.labelShowBg,d=e.labelBgStyle,h=e.labelBgPadding,p=e.labelBgBorderRadius,m=e.style,f=e.sourcePosition,y=f===void 0?Pe.Bottom:f,x=e.targetPosition,_=x===void 0?Pe.Top:x,v=e.markerEnd,w=e.markerStart,M=e.borderRadius,N=M===void 0?5:M,C=Rv({sourceX:t,sourceY:n,targetX:s,targetY:r,sourcePosition:y,targetPosition:_}),j=xt(C,2),E=j[0],k=j[1],$=vh({sourceX:t,sourceY:n,sourcePosition:y,targetX:s,targetY:r,targetPosition:_,borderRadius:N});return ve.createElement(Ju,{path:$,centerX:E,centerY:k,label:i,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:v,markerStart:w})});function Dv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function zv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Dv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Iv=b.memo(function(e){return ve.createElement(xh,zv(zv({},e),{},{borderRadius:0}))}),Fv=b.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.label,l=e.labelStyle,u=e.labelShowBg,d=e.labelBgStyle,h=e.labelBgPadding,p=e.labelBgBorderRadius,m=e.style,f=e.markerEnd,y=e.markerStart,x=Math.abs(r-n)/2,_=r<n?r+x:r-x,v=Math.abs(s-t)/2,w=s<t?s+v:s-v,M="M ".concat(t,",").concat(n,"L ").concat(s,",").concat(r);return ve.createElement(Ju,{path:M,centerX:w,centerY:_,label:i,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:y})});function td(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function nd(e){var t=e.pos,n=e.x1,s=e.y1,r=e.x2,i=e.y2,l=e.c,u,d;switch(t){case Pe.Left:u=n-td(n-r,l),d=s;break;case Pe.Right:u=n+td(r-n,l),d=s;break;case Pe.Top:u=n,d=s-td(s-i,l);break;case Pe.Bottom:u=n,d=s+td(i-s,l);break}return[u,d]}function Bv(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Pe.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Pe.Top:u,h=e.curvature,p=h===void 0?.25:h,m=nd({pos:r,x1:t,y1:n,x2:i,y2:l,c:p}),f=xt(m,2),y=f[0],x=f[1],_=nd({pos:d,x1:i,y1:l,x2:t,y2:n,c:p}),v=xt(_,2),w=v[0],M=v[1];return"M".concat(t,",").concat(n," C").concat(y,",").concat(x," ").concat(w,",").concat(M," ").concat(i,",").concat(l)}function BA(e){var t=e.sourceX,n=e.sourceY,s=e.sourcePosition,r=s===void 0?Pe.Bottom:s,i=e.targetX,l=e.targetY,u=e.targetPosition,d=u===void 0?Pe.Top:u,h=e.curvature,p=h===void 0?.25:h,m=nd({pos:r,x1:t,y1:n,x2:i,y2:l,c:p}),f=xt(m,2),y=f[0],x=f[1],_=nd({pos:d,x1:i,y1:l,x2:t,y2:n,c:p}),v=xt(_,2),w=v[0],M=v[1],N=t*.125+y*.375+w*.375+i*.125,C=n*.125+x*.375+M*.375+l*.125,j=Math.abs(N-t),E=Math.abs(C-n);return[N,C,j,E]}var bh=b.memo(function(e){var t=e.sourceX,n=e.sourceY,s=e.targetX,r=e.targetY,i=e.sourcePosition,l=i===void 0?Pe.Bottom:i,u=e.targetPosition,d=u===void 0?Pe.Top:u,h=e.label,p=e.labelStyle,m=e.labelShowBg,f=e.labelBgStyle,y=e.labelBgPadding,x=e.labelBgBorderRadius,_=e.style,v=e.markerEnd,w=e.markerStart,M=e.curvature,N={sourceX:t,sourceY:n,sourcePosition:l,targetX:s,targetY:r,targetPosition:d,curvature:M},C=Bv(N),j=BA(N),E=xt(j,2),k=E[0],$=E[1];return ve.createElement(Ju,{path:C,centerX:k,centerY:$,label:h,labelStyle:p,labelShowBg:m,labelBgStyle:f,labelBgPadding:y,labelBgBorderRadius:x,style:_,markerEnd:v,markerStart:w})}),wh=b.createContext(null),UA=wh.Provider;wh.Consumer;function Nh(e,t,n,s,r,i,l){var u=l.elementFromPoint(e.clientX,e.clientY),d=(u==null?void 0:u.classList.contains("target"))||!1,h=(u==null?void 0:u.classList.contains("source"))||!1,p={elementBelow:u,isValid:!1,connection:{source:null,target:null,sourceHandle:null,targetHandle:null},isHoveringHandle:!1};if(u&&(d||h)){p.isHoveringHandle=!0;var m=u.getAttribute("data-nodeid"),f=u.getAttribute("data-handleid"),y=n?{source:m,sourceHandle:f,target:s,targetHandle:r}:{source:s,sourceHandle:r,target:m,targetHandle:f};p.connection=y;var x=t===To.Strict?n&&h||!n&&d:!0;x&&(p.isValid=i(y))}return p}function jh(e){e==null||e.classList.remove("react-flow__handle-valid"),e==null||e.classList.remove("react-flow__handle-connecting")}function Uv(e){var t=e.event,n=e.handleId,s=e.nodeId,r=e.onConnect,i=e.isTarget,l=e.getState,u=e.setState,d=e.isValidConnection,h=e.elementEdgeUpdaterType,p=e.onEdgeUpdateEnd,m=t.target.closest(".react-flow"),f=nv(t.target);if(!f)return;var y=f.elementFromPoint(t.clientX,t.clientY),x=y==null?void 0:y.classList.contains("target"),_=y==null?void 0:y.classList.contains("source");if(!m||!x&&!_&&!h)return;var v=l(),w=v.onConnectStart,M=v.connectionMode,N=h||(x?"target":"source"),C=m.getBoundingClientRect(),j;u({connectionPosition:{x:t.clientX-C.left,y:t.clientY-C.top},connectionNodeId:s,connectionHandleId:n,connectionHandleType:N}),w==null||w(t,{nodeId:s,handleId:n,handleType:N});function E($){u({connectionPosition:{x:$.clientX-C.left,y:$.clientY-C.top}});var T=Nh($,M,i,s,n,d,f),P=T.connection,A=T.elementBelow,D=T.isValid,F=T.isHoveringHandle;if(!F)return jh(j);P.source!==P.target&&A&&(jh(j),j=A,A.classList.add("react-flow__handle-connecting"),A.classList.toggle("react-flow__handle-valid",D))}function k($){var T=l(),P=T.onConnectStop,A=T.onConnectEnd,D=Nh($,M,i,s,n,d,f),F=D.connection,R=D.isValid;P==null||P($),R&&(r==null||r(F)),A==null||A($),h&&p&&p($),jh(j),u({connectionNodeId:null,connectionHandleId:null,connectionHandleType:null}),f.removeEventListener("mousemove",E),f.removeEventListener("mouseup",k)}f.addEventListener("mousemove",E),f.addEventListener("mouseup",k)}var HA=["type","position","isValidConnection","isConnectable","id","onConnect","children","className","onMouseDown"];function Hv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Ch(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Hv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var qA=function(){return!0},VA=function(t){return{connectionStartHandle:t.connectionStartHandle,connectOnClick:t.connectOnClick}},qv=b.forwardRef(function(e,t){var n=e.type,s=n===void 0?"source":n,r=e.position,i=r===void 0?Pe.Top:r,l=e.isValidConnection,u=l===void 0?qA:l,d=e.isConnectable,h=d===void 0?!0:d,p=e.id,m=e.onConnect,f=e.children,y=e.className,x=e.onMouseDown,_=Xu(e,HA),v=ms(),w=b.useContext(wh),M=On(VA,Vs),N=M.connectionStartHandle,C=M.connectOnClick,j=p||null,E=s==="target",k=function(A){var D=v.getState(),F=D.defaultEdgeOptions,R=D.onConnect,z=D.hasDefaultEdges,q=Ch(Ch({},F),A);if(z){var V=v.getState(),U=V.edges;v.setState({edges:fv(q,U)})}R==null||R(q),m==null||m(q)},$=function(A){A.button===0&&Uv({event:A,handleId:j,nodeId:w,onConnect:k,isTarget:E,getState:v.getState,setState:v.setState,isValidConnection:u}),x==null||x(A)},T=function(A){var D=v.getState(),F=D.onClickConnectStart,R=D.onClickConnectStop,z=D.onClickConnectEnd,q=D.connectionMode;if(!N){F==null||F(A,{nodeId:w,handleId:j,handleType:s}),v.setState({connectionStartHandle:{nodeId:w,type:s,handleId:j}});return}var V=nv(A.target),U=Nh(A,q,N.type==="target",N.nodeId,N.handleId||null,u,V),W=U.connection,B=U.isValid;R==null||R(A),B&&k(W),z==null||z(A),v.setState({connectionStartHandle:null})};return ve.createElement("div",Ch({"data-handleid":j,"data-nodeid":w,"data-handlepos":i,className:Lt(["react-flow__handle","react-flow__handle-".concat(i),"nodrag",y,{source:!E,target:E,connectable:h,connecting:(N==null?void 0:N.nodeId)===w&&(N==null?void 0:N.handleId)===j&&(N==null?void 0:N.type)===s}]),onMouseDown:$,onClick:C?T:void 0,ref:t},_),f)});qv.displayName="Handle";var tc=b.memo(qv),Vv=function(t){var n=t.data,s=t.isConnectable,r=t.targetPosition,i=r===void 0?Pe.Top:r,l=t.sourcePosition,u=l===void 0?Pe.Bottom:l;return ve.createElement(ve.Fragment,null,ve.createElement(tc,{type:"target",position:i,isConnectable:s}),n==null?void 0:n.label,ve.createElement(tc,{type:"source",position:u,isConnectable:s}))};Vv.displayName="DefaultNode";var Sh=b.memo(Vv),Wv=function(t){var n=t.data,s=t.isConnectable,r=t.sourcePosition,i=r===void 0?Pe.Bottom:r;return ve.createElement(ve.Fragment,null,n==null?void 0:n.label,ve.createElement(tc,{type:"source",position:i,isConnectable:s}))};Wv.displayName="InputNode";var Yv=b.memo(Wv),Kv=function(t){var n=t.data,s=t.isConnectable,r=t.targetPosition,i=r===void 0?Pe.Top:r;return ve.createElement(ve.Fragment,null,ve.createElement(tc,{type:"target",position:i,isConnectable:s}),n==null?void 0:n.label)};Kv.displayName="OutputNode";var Gv=b.memo(Kv),WA=function(t){return{selectedNodes:Array.from(t.nodeInternals.values()).filter(function(n){return n.selected}),selectedEdges:t.edges.filter(function(n){return n.selected})}},YA=function(t,n){var s=t.selectedNodes.map(function(u){return u.id}),r=n.selectedNodes.map(function(u){return u.id}),i=t.selectedEdges.map(function(u){return u.id}),l=n.selectedEdges.map(function(u){return u.id});return Vs(s,r)&&Vs(i,l)};function KA(e){var t=e.onSelectionChange,n=On(WA,YA),s=n.selectedNodes,r=n.selectedEdges;return b.useEffect(function(){t({nodes:s,edges:r})},[s,r]),null}var GA=b.memo(KA),XA=function(t){return{setNodes:t.setNodes,setEdges:t.setEdges,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset}};function Na(e,t){b.useEffect(function(){typeof e<"u"&&t(e)},[e])}function Yt(e,t,n){b.useEffect(function(){typeof t<"u"&&n(Tt({},e,t))},[t])}var QA=function(t){var n=t.nodes,s=t.edges,r=t.defaultNodes,i=t.defaultEdges,l=t.onConnect,u=t.onConnectStart,d=t.onConnectStop,h=t.onConnectEnd,p=t.onClickConnectStart,m=t.onClickConnectStop,f=t.onClickConnectEnd,y=t.nodesDraggable,x=t.nodesConnectable,_=t.minZoom,v=t.maxZoom,w=t.nodeExtent,M=t.onNodesChange,N=t.onEdgesChange,C=t.elementsSelectable,j=t.connectionMode,E=t.snapGrid,k=t.snapToGrid,$=t.translateExtent,T=t.connectOnClick,P=t.defaultEdgeOptions,A=t.fitView,D=t.fitViewOptions,F=t.onNodesDelete,R=t.onEdgesDelete,z=t.onNodeDrag,q=t.onNodeDragStart,V=t.onNodeDragStop,U=t.onSelectionDrag,W=t.onSelectionDragStart,B=t.onSelectionDragStop,I=On(XA,Vs),H=I.setNodes,J=I.setEdges,G=I.setDefaultNodesAndEdges,Y=I.setMinZoom,X=I.setMaxZoom,Z=I.setTranslateExtent,ee=I.setNodeExtent,Q=I.reset,ne=ms();return b.useEffect(function(){return G(r,i),function(){Q()}},[]),Yt("defaultEdgeOptions",P,ne.setState),Yt("connectionMode",j,ne.setState),Yt("onConnect",l,ne.setState),Yt("onConnectStart",u,ne.setState),Yt("onConnectStop",d,ne.setState),Yt("onConnectEnd",h,ne.setState),Yt("onClickConnectStart",p,ne.setState),Yt("onClickConnectStop",m,ne.setState),Yt("onClickConnectEnd",f,ne.setState),Yt("nodesDraggable",y,ne.setState),Yt("nodesConnectable",x,ne.setState),Yt("elementsSelectable",C,ne.setState),Yt("snapToGrid",k,ne.setState),Yt("snapGrid",E,ne.setState),Yt("onNodesChange",M,ne.setState),Yt("onEdgesChange",N,ne.setState),Yt("connectOnClick",T,ne.setState),Yt("fitViewOnInit",A,ne.setState),Yt("fitViewOnInitOptions",D,ne.setState),Yt("onNodesDelete",F,ne.setState),Yt("onEdgesDelete",R,ne.setState),Yt("onNodeDrag",z,ne.setState),Yt("onNodeDragStart",q,ne.setState),Yt("onNodeDragStop",V,ne.setState),Yt("onSelectionDrag",U,ne.setState),Yt("onSelectionDragStart",W,ne.setState),Yt("onSelectionDragStop",B,ne.setState),Na(n,H),Na(s,J),Na(r,H),Na(i,J),Na(_,Y),Na(v,X),Na($,Z),Na(w,ee),null},ZA=".react-flow{height:100%;overflow:hidden;position:relative;width:100%}.react-flow__container{height:100%;left:0;position:absolute;top:0;width:100%}.react-flow__pane{z-index:1}.react-flow__viewport{pointer-events:none;transform-origin:0 0;z-index:2}.react-flow__renderer{z-index:4}.react-flow__selectionpane{z-index:5}.react-flow .react-flow__edges{overflow:visible;pointer-events:none}.react-flow .react-flow__connectionline{z-index:1001}.react-flow__edge{pointer-events:visibleStroke}.react-flow__edge.inactive{pointer-events:none}@-webkit-keyframes dashdraw{0%{stroke-dashoffset:10}}@keyframes dashdraw{0%{stroke-dashoffset:10}}.react-flow__edge-path{fill:none}.react-flow__edge-textwrapper{pointer-events:all}.react-flow__edge-text{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__connection{pointer-events:none}.react-flow__connection .animated{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__connection-path{fill:none}.react-flow__nodes{pointer-events:none;transform-origin:0 0}.react-flow__node{box-sizing:border-box;pointer-events:all;position:absolute;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__nodesselection{pointer-events:none;transform-origin:left top;z-index:3}.react-flow__nodesselection-rect{cursor:-webkit-grab;cursor:grab;pointer-events:all;position:absolute}.react-flow__handle{pointer-events:none;position:absolute}.react-flow__handle.connectable{pointer-events:all}.react-flow__handle-bottom{bottom:-4px;left:50%;top:auto;transform:translate(-50%)}.react-flow__handle-top{left:50%;top:-4px;transform:translate(-50%)}.react-flow__handle-left{left:-4px;top:50%;transform:translateY(-50%)}.react-flow__handle-right{right:-4px;top:50%;transform:translateY(-50%)}.react-flow__edgeupdater{cursor:move;pointer-events:all}.react-flow__controls{bottom:20px;left:15px;position:absolute;z-index:5}.react-flow__controls-button{border:none;height:24px;width:24px}.react-flow__controls-button svg{width:100%}.react-flow__minimap{bottom:20px;position:absolute;right:15px;z-index:5}.react-flow__attribution{background:hsla(0,0%,100%,.5);color:#999;font-size:10px;padding:2px 3px;position:absolute;z-index:1000}.react-flow__attribution a{color:#555;text-decoration:none}.react-flow__attribution.top{top:0}.react-flow__attribution.bottom{bottom:0}.react-flow__attribution.left{left:0}.react-flow__attribution.right{right:0}.react-flow__attribution.center{left:50%;transform:translateX(-50%)}",JA=ZA,eO=".react-flow__edge.selected .react-flow__edge-path{stroke:#555}.react-flow__edge.animated path{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__edge.updating .react-flow__edge-path{stroke:#777}.react-flow__edge-path{stroke:#b1b1b7;stroke-width:1}.react-flow__edge-text{font-size:10px}.react-flow__edge-textbg{fill:#fff}.react-flow__connection-path{stroke:#b1b1b7;stroke-width:1}.react-flow__node{cursor:-webkit-grab;cursor:grab}.react-flow__node-default,.react-flow__node-group,.react-flow__node-input,.react-flow__node-output{background:#fff;border:1px solid #1a192b;border-radius:3px;color:#222;font-size:12px;padding:10px;text-align:center;width:150px}.react-flow__node-default.selected,.react-flow__node-group.selected,.react-flow__node-input.selected,.react-flow__node-output.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-default .react-flow__handle,.react-flow__node-group .react-flow__handle,.react-flow__node-input .react-flow__handle,.react-flow__node-output .react-flow__handle{background:#1a192b}.react-flow__node-default.selectable:hover,.react-flow__node-group.selectable:hover,.react-flow__node-input.selectable:hover,.react-flow__node-output.selectable:hover{box-shadow:0 1px 4px 1px rgba(0,0,0,.08)}.react-flow__node-default.selectable.selected,.react-flow__node-group.selectable.selected,.react-flow__node-input.selectable.selected,.react-flow__node-output.selectable.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-group{background:hsla(0,0%,94%,.25);border-color:#1a192b}.react-flow__nodesselection-rect,.react-flow__selection{background:rgba(0,89,220,.08);border:1px dotted rgba(0,89,220,.8)}.react-flow__handle{background:#555;border:1px solid #fff;border-radius:100%;height:6px;width:6px}.react-flow__handle.connectable{cursor:crosshair}.react-flow__minimap{background-color:#fff}.react-flow__controls{box-shadow:0 0 2px 1px rgba(0,0,0,.08)}.react-flow__controls-button{align-items:center;background:#fefefe;border-bottom:1px solid #eee;box-sizing:content-box;cursor:pointer;display:flex;height:16px;justify-content:center;padding:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:16px}.react-flow__controls-button svg{max-height:12px;max-width:12px}.react-flow__controls-button:hover{background:#f4f4f4}",tO=eO,nO=function(t,n,s){return s===Pe.Left?t-n:s===Pe.Right?t+n:t},sO=function(t,n,s){return s===Pe.Top?t-n:s===Pe.Bottom?t+n:t},Xv=function(t){var n=t.className,s=t.position,r=t.centerX,i=t.centerY,l=t.radius,u=l===void 0?10:l;return ve.createElement("circle",{className:Lt(["react-flow__edgeupdater",n]),cx:nO(r,u,s),cy:sO(i,u,s),r:u,stroke:"transparent",fill:"transparent"})},Li=function(e){var t=function(s){var r=s.id,i=s.className,l=s.type,u=s.data,d=s.onClick,h=s.onEdgeDoubleClick,p=s.selected,m=s.animated,f=s.label,y=s.labelStyle,x=s.labelShowBg,_=s.labelBgStyle,v=s.labelBgPadding,w=s.labelBgBorderRadius,M=s.style,N=s.source,C=s.target,j=s.sourceX,E=s.sourceY,k=s.targetX,$=s.targetY,T=s.sourcePosition,P=s.targetPosition,A=s.elementsSelectable,D=s.hidden,F=s.sourceHandleId,R=s.targetHandleId,z=s.onContextMenu,q=s.onMouseEnter,V=s.onMouseMove,U=s.onMouseLeave,W=s.edgeUpdaterRadius,B=s.onEdgeUpdate,I=s.onEdgeUpdateStart,H=s.onEdgeUpdateEnd,J=s.markerEnd,G=s.markerStart,Y=s.rfId,X=b.useState(!1),Z=xt(X,2),ee=Z[0],Q=Z[1],ne=ms(),he=function(rt){var ft=ne.getState(),bt=ft.edges,zt=ft.addSelectedEdges,Xe=bt.find(function(Ft){return Ft.id===r});A&&(ne.setState({nodesSelectionActive:!1}),zt([r])),d==null||d(rt,Xe)},ye=ec(r,ne.getState,h),ge=ec(r,ne.getState,z),Ee=ec(r,ne.getState,q),De=ec(r,ne.getState,V),ke=ec(r,ne.getState,U),le=function(rt,ft){var bt=ft?C:N,zt=(ft?R:F)||null,Xe=ft?"target":"source",Ft=function(){return!0},Kt=ft,Et=ne.getState().edges.find(function(Mt){return Mt.id===r});I==null||I(rt,Et,Xe);var Qt=H?function(Mt){return H(Mt,Et,Xe)}:void 0,wn=function(Zt){return B==null?void 0:B(Et,Zt)};Uv({event:rt,handleId:zt,nodeId:bt,onConnect:wn,isTarget:Kt,getState:ne.getState,setState:ne.setState,isValidConnection:Ft,elementEdgeUpdaterType:Xe,onEdgeUpdateEnd:Qt})},pe=function(rt){return le(rt,!0)},be=function(rt){return le(rt,!1)},Te=function(){return Q(!0)},Ie=function(){return Q(!1)},ue=b.useMemo(function(){return"url(#".concat(ah(G,Y),")")},[G,Y]),$e=b.useMemo(function(){return"url(#".concat(ah(J,Y),")")},[J,Y]);if(D)return null;var Ye=!A&&!d,et=typeof B<"u",We=Lt(["react-flow__edge","react-flow__edge-".concat(l),i,{selected:p,animated:m,inactive:Ye,updating:ee}]);return ve.createElement("g",{className:We,onClick:he,onDoubleClick:ye,onContextMenu:ge,onMouseEnter:Ee,onMouseMove:De,onMouseLeave:ke},ve.createElement(e,{id:r,source:N,target:C,selected:p,animated:m,label:f,labelStyle:y,labelShowBg:x,labelBgStyle:_,labelBgPadding:v,labelBgBorderRadius:w,data:u,style:M,sourceX:j,sourceY:E,targetX:k,targetY:$,sourcePosition:T,targetPosition:P,sourceHandleId:F,targetHandleId:R,markerStart:ue,markerEnd:$e,"data-testid":"rf__edge-".concat(r)}),et&&ve.createElement("g",{onMouseDown:pe,onMouseEnter:Te,onMouseOut:Ie},ve.createElement(Xv,{position:T,centerX:j,centerY:E,radius:W})),et&&ve.createElement("g",{onMouseDown:be,onMouseEnter:Te,onMouseOut:Ie},ve.createElement(Xv,{position:P,centerX:k,centerY:$,radius:W})))};return t.displayName="EdgeWrapper",b.memo(t)};function Qv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Zv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qv(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function rO(e){var t={default:Li(e.default||bh),straight:Li(e.bezier||Fv),step:Li(e.step||Iv),smoothstep:Li(e.step||xh),simplebezier:Li(e.simplebezier||$v)},n={},s=Object.keys(e).filter(function(r){return!["default","bezier"].includes(r)}).reduce(function(r,i){return r[i]=Li(e[i]||bh),r},n);return Zv(Zv({},t),s)}function Jv(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,s=((n==null?void 0:n.x)||0)+t.x,r=((n==null?void 0:n.y)||0)+t.y,i=(n==null?void 0:n.width)||t.width,l=(n==null?void 0:n.height)||t.height;switch(e){case Pe.Top:return{x:s+i/2,y:r};case Pe.Right:return{x:s+i,y:r+l/2};case Pe.Bottom:return{x:s+i/2,y:r+l};case Pe.Left:return{x:s,y:r+l/2}}}function ex(e,t){if(!e)return null;var n=null;return e.length===1||!t?n=e[0]:t&&(n=e.find(function(s){return s.id===t})),typeof n>"u"?null:n}var aO=function(t,n,s,r,i,l){var u=Jv(s,t,n),d=Jv(l,r,i);return{sourceX:u.x,sourceY:u.y,targetX:d.x,targetY:d.y}};function oO(e){var t=e.sourcePos,n=e.targetPos,s=e.sourceWidth,r=e.sourceHeight,i=e.targetWidth,l=e.targetHeight,u=e.width,d=e.height,h=e.transform,p={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x+s,n.x+i),y2:Math.max(t.y+r,n.y+l)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);var m=Ku({x:(0-h[0])/h[2],y:(0-h[1])/h[2],width:u/h[2],height:d/h[2]}),f=Math.max(0,Math.min(m.x2,p.x2)-Math.max(m.x,p.x)),y=Math.max(0,Math.min(m.y2,p.y2)-Math.max(m.y,p.y)),x=Math.ceil(f*y);return x>0}function tx(e,t){var n,s,r,i,l,u=e.get(t),d=(u==null||(n=u[rs])===null||n===void 0?void 0:n.handleBounds)||null,h=!u||!d||!u.width||!u.height||typeof((s=u.positionAbsolute)===null||s===void 0?void 0:s.x)>"u"||typeof((r=u.positionAbsolute)===null||r===void 0?void 0:r.y)>"u";return[{x:(u==null||(i=u.positionAbsolute)===null||i===void 0?void 0:i.x)||0,y:(u==null||(l=u.positionAbsolute)===null||l===void 0?void 0:l.y)||0,width:(u==null?void 0:u.width)||0,height:(u==null?void 0:u.height)||0},d,!h]}var iO=typeof document<"u"?document:null,sd=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:iO},n=b.useState(!1),s=xt(n,2),r=s[0],i=s[1],l=b.useRef(new Set([])),u=b.useMemo(function(){if(e!==null){var m=Array.isArray(e)?e:[e],f=m.filter(function(x){return typeof x=="string"}).map(function(x){return x.split("+")}),y=f.reduce(function(x,_){return x.concat.apply(x,Po(_))},[]);return[f,y]}return[[],[]]},[e]),d=xt(u,2),h=d[0],p=d[1];return b.useEffect(function(){if(e!==null){var m,f,y=function(w){if(rx(w))return!1;var M=sx(w.code,p);l.current.add(w[M]),nx(h,l.current,!1)&&(w.preventDefault(),i(!0))},x=function(w){if(rx(w))return!1;var M=sx(w.code,p);nx(h,l.current,!0)?(i(!1),l.current.clear()):l.current.delete(w[M])},_=function(){l.current.clear(),i(!1)};return t==null||(m=t.target)===null||m===void 0||m.addEventListener("keydown",y),t==null||(f=t.target)===null||f===void 0||f.addEventListener("keyup",x),window.addEventListener("blur",_),function(){var v,w;t==null||(v=t.target)===null||v===void 0||v.removeEventListener("keydown",y),t==null||(w=t.target)===null||w===void 0||w.removeEventListener("keyup",x),window.removeEventListener("blur",_)}}},[e,i]),r};function nx(e,t,n){return e.filter(function(s){return n||s.length===t.size}).some(function(s){return s.every(function(r){return t.has(r)})})}function sx(e,t){return t.includes(e)?"code":"key"}function rx(e){var t,n=((t=e.composedPath)===null||t===void 0?void 0:t.call(e)[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n==null?void 0:n.nodeName)||(n==null?void 0:n.hasAttribute("contenteditable"))}var lO=function(t){return{onNodesChange:t.onNodesChange,onEdgesChange:t.onEdgesChange}},cO=function(e){var t=e.deleteKeyCode,n=e.multiSelectionKeyCode,s=ms(),r=On(lO,Vs),i=r.onNodesChange,l=r.onEdgesChange,u=sd(t),d=sd(n);b.useEffect(function(){var h=s.getState(),p=h.nodeInternals,m=h.edges,f=h.hasDefaultNodes,y=h.hasDefaultEdges,x=h.onNodesDelete,_=h.onEdgesDelete,v=Array.from(p.values()),w=v.reduce(function($,T){return(!T.selected&&T.parentNode&&$.find(function(P){return P.id===T.parentNode})||T.selected)&&$.push(T),$},[]),M=m.filter(function($){return $.selected});if(u&&(w||M)){var N=gv(w,m),C=[].concat(Po(M),Po(N)),j=C.reduce(function($,T){return $.includes(T.id)||$.push(T.id),$},[]);if((y||f)&&(y&&s.setState({edges:m.filter(function($){return!j.includes($.id)})}),f&&(w.forEach(function($){p.delete($.id)}),s.setState({nodeInternals:new Map(p)}))),j.length>0&&(_==null||_(C),l)){var E=j.map(function($){return{id:$,type:"remove"}});l(E)}if(w.length>0&&(x==null||x(w),i)){var k=w.map(function($){return{id:$.id,type:"remove"}});i(k)}s.setState({nodesSelectionActive:!1})}},[u,i,l]),b.useEffect(function(){s.setState({multiSelectionActive:d})},[d])};function uO(e){var t=ms();b.useEffect(function(){var n,s=function(){if(e.current){var i=rh(e.current);t.setState({width:i.width||500,height:i.height||500})}};return s(),window.onresize=s,e.current&&(n=new ResizeObserver(function(){return s()}),n.observe(e.current)),function(){window.onresize=null,n&&e.current&&n.unobserve(e.current)}},[])}var dO=function(t,n){return t.x!==n.x||t.y!==n.y||t.zoom!==n.k},Eh=function(t){return{x:t.x,y:t.y,zoom:t.k}},rd=function(t,n){return t.target.closest(".".concat(n))},mO=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection,d3ZoomHandler:t.d3ZoomHandler}},fO=function(t){var n=t.onMove,s=t.onMoveStart,r=t.onMoveEnd,i=t.zoomOnScroll,l=i===void 0?!0:i,u=t.zoomOnPinch,d=u===void 0?!0:u,h=t.panOnScroll,p=h===void 0?!1:h,m=t.panOnScrollSpeed,f=m===void 0?.5:m,y=t.panOnScrollMode,x=y===void 0?Ai.Free:y,_=t.zoomOnDoubleClick,v=_===void 0?!0:_,w=t.selectionKeyPressed,M=t.elementsSelectable,N=t.panOnDrag,C=N===void 0?!0:N,j=t.translateExtent,E=t.minZoom,k=t.maxZoom,$=t.defaultZoom,T=$===void 0?1:$,P=t.defaultPosition,A=P===void 0?[0,0]:P,D=t.zoomActivationKeyCode,F=t.preventScrolling,R=F===void 0?!0:F,z=t.children,q=t.noWheelClassName,V=t.noPanClassName,U=ms(),W=b.useRef(!1),B=b.useRef(null),I=b.useRef({x:0,y:0,zoom:0}),H=On(mO,Vs),J=H.d3Zoom,G=H.d3Selection,Y=H.d3ZoomHandler,X=sd(D);return uO(B),b.useEffect(function(){if(B.current){var Z,ee=nh().scaleExtent([E,k]).translateExtent(j),Q=vs(B.current).call(ee),ne=Oi(A[0],j[0][0],j[1][0]),he=Oi(A[1],j[0][1],j[1][1]),ye=Oi(T,E,k),ge=Kr.translate(ne,he).scale(ye);ee.transform(Q,ge),U.setState({d3Zoom:ee,d3Selection:Q,d3ZoomHandler:Q.on("wheel.zoom"),transform:[ne,he,ye],domNode:(Z=Q.node())===null||Z===void 0?void 0:Z.closest(".react-flow")})}},[]),b.useEffect(function(){G&&J&&(p&&!X?G.on("wheel",function(Z){if(rd(Z,q))return!1;Z.preventDefault(),Z.stopImmediatePropagation();var ee=G.property("__zoom").k||1;if(Z.ctrlKey&&d){var Q=rr(Z),ne=-Z.deltaY*(Z.deltaMode===1?.05:Z.deltaMode?1:.002)*10,he=ee*Math.pow(2,ne);J.scaleTo(G,he,Q);return}var ye=Z.deltaMode===1?20:1,ge=x===Ai.Vertical?0:Z.deltaX*ye,Ee=x===Ai.Horizontal?0:Z.deltaY*ye;J.translateBy(G,-(ge/ee)*f,-(Ee/ee)*f)}).on("wheel.zoom",null):typeof Y<"u"&&G.on("wheel",function(Z){if(!R||rd(Z,q))return null;Z.preventDefault()}).on("wheel.zoom",Y))},[p,x,G,J,Y,X,d,R,q]),b.useEffect(function(){J&&(w&&!W.current?J.on("zoom",null):w||J.on("zoom",function(Z){if(U.setState({transform:[Z.transform.x,Z.transform.y,Z.transform.k]}),n){var ee=Eh(Z.transform);n(Z.sourceEvent,ee)}}))},[w,J,n]),b.useEffect(function(){J&&J.on("start",function(Z){if(W.current=!0,s){var ee=Eh(Z.transform);I.current=ee,s(Z.sourceEvent,ee)}})},[J,s]),b.useEffect(function(){J&&J.on("end",function(Z){if(W.current=!1,r&&dO(I.current,Z.transform)){var ee=Eh(Z.transform);I.current=ee,r(Z.sourceEvent,ee)}})},[J,r]),b.useEffect(function(){J&&J.filter(function(Z){var ee=X||l,Q=d&&Z.ctrlKey;return!C&&!ee&&!p&&!v&&!d||w||!v&&Z.type==="dblclick"||rd(Z,q)&&Z.type==="wheel"||rd(Z,V)&&Z.type!=="wheel"||!d&&Z.ctrlKey&&Z.type==="wheel"||!ee&&!p&&!Q&&Z.type==="wheel"||!C&&(Z.type==="mousedown"||Z.type==="touchstart")?!1:(!Z.ctrlKey||Z.type==="wheel")&&!Z.button})},[J,l,d,p,v,C,w,M,X]),ve.createElement("div",{className:"react-flow__renderer react-flow__container",ref:B},z)};function ax(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function ox(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ax(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ax(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function ix(e,t){return{x:e.clientX-t.left,y:e.clientY-t.top}}var hO=function(t){return{userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable}},lx={startX:0,startY:0,x:0,y:0,width:0,height:0,draw:!1},pO=b.memo(function(e){var t=e.selectionKeyPressed,n=ms(),s=b.useRef(0),r=b.useRef(0),i=b.useRef(),l=b.useState(lx),u=xt(l,2),d=u[0],h=u[1],p=On(hO,Vs),m=p.userSelectionActive,f=p.elementsSelectable,y=m||t;if(!f||!y)return null;var x=function(){h(lx),n.setState({userSelectionActive:!1}),s.current=0,r.current=0},_=function(C){var j=C.target.closest(".react-flow");i.current=j.getBoundingClientRect();var E=ix(C,i.current);h({width:0,height:0,startX:E.x,startY:E.y,x:E.x,y:E.y,draw:!0}),n.setState({userSelectionActive:!0,nodesSelectionActive:!1})},v=function(C){var j,E;if(!(!t||!d.draw||!i.current)){var k=ix(C,i.current),$=(j=d.startX)!==null&&j!==void 0?j:0,T=(E=d.startY)!==null&&E!==void 0?E:0,P=ox(ox({},d),{},{x:k.x<$?k.x:$,y:k.y<T?k.y:T,width:Math.abs(k.x-$),height:Math.abs(k.y-T)}),A=n.getState(),D=A.nodeInternals,F=A.edges,R=A.transform,z=A.onNodesChange,q=A.onEdgesChange,V=Array.from(D.values()),U=pv(D,P,R,!1,!0),W=gv(U,F).map(function(J){return J.id}),B=U.map(function(J){return J.id});if(s.current!==B.length){s.current=B.length;var I=Ti(V,B);I.length&&(z==null||z(I))}if(r.current!==W.length){r.current=W.length;var H=Ti(F,W);H.length&&(q==null||q(H))}h(P)}},w=function(){n.setState({nodesSelectionActive:s.current>0}),x()},M=function(){n.setState({nodesSelectionActive:!1}),x()};return ve.createElement("div",{className:"react-flow__selectionpane react-flow__container",onMouseDown:_,onMouseMove:v,onMouseUp:w,onMouseLeave:M},d.draw&&ve.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:d.width,height:d.height,transform:"translate(".concat(d.x,"px, ").concat(d.y,"px)")}}))});function cx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function ux(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cx(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function dx(e,t){if(!e.parentNode)return!1;var n=t.get(e.parentNode);return n?n.selected?!0:dx(n,t):!1}function mx(e,t,n){var s=e;do{var r;if((r=s)!==null&&r!==void 0&&r.matches(t))return!0;if(s===n.current)return!1;s=s.parentElement}while(s);return!1}function gO(e,t,n){return Array.from(e.values()).filter(function(s){return(s.selected||s.id===n)&&(!s.parentNode||!dx(s,e))}).map(function(s){var r,i,l,u;return{id:s.id,position:s.position||{x:0,y:0},positionAbsolute:s.positionAbsolute||{x:0,y:0},distance:{x:t.x-((r=(i=s.positionAbsolute)===null||i===void 0?void 0:i.x)!==null&&r!==void 0?r:0),y:t.y-((l=(u=s.positionAbsolute)===null||u===void 0?void 0:u.y)!==null&&l!==void 0?l:0)},delta:{x:0,y:0},extent:s.extent,parentNode:s.parentNode,width:s.width,height:s.height}})}function _O(e,t,n,s,r,i){var l=xt(s,2),u=l[0],d=l[1],h=e.extent||i,p={x:t.x-e.distance.x,y:t.y-e.distance.y};if(n&&(p.x=u*Math.round(p.x/u),p.y=d*Math.round(p.y/d)),e.extent==="parent")if(e.parentNode&&e.width&&e.height){var m=r.get(e.parentNode);h=m!=null&&m.positionAbsolute&&m!==null&&m!==void 0&&m.width&&m!==null&&m!==void 0&&m.height?[[m.positionAbsolute.x,m.positionAbsolute.y],[m.positionAbsolute.x+m.width-e.width,m.positionAbsolute.y+m.height-e.height]]:h}else h=i;else if(e.extent&&e.parentNode){var f,y,x,_,v=r.get(e.parentNode),w=(f=v==null||(y=v.positionAbsolute)===null||y===void 0?void 0:y.x)!==null&&f!==void 0?f:0,M=(x=v==null||(_=v.positionAbsolute)===null||_===void 0?void 0:_.y)!==null&&x!==void 0?x:0;h=[[e.extent[0][0]+w,e.extent[0][1]+M],[e.extent[1][0]+w,e.extent[1][1]+M]]}var N={x:0,y:0};if(e.parentNode){var C,j,E,k,$=r.get(e.parentNode);N={x:(C=$==null||(j=$.positionAbsolute)===null||j===void 0?void 0:j.x)!==null&&C!==void 0?C:0,y:(E=$==null||(k=$.positionAbsolute)===null||k===void 0?void 0:k.y)!==null&&E!==void 0?E:0}}return e.positionAbsolute=h?tv(p,h):p,e.position={x:e.positionAbsolute.x-N.x,y:e.positionAbsolute.y-N.y},e}function Mh(e){var t=e.nodeId,n=e.dragItems,s=e.nodeInternals,r=n.map(function(i){var l=s.get(i.id);return ux(ux({},l),{},{position:i.position,positionAbsolute:i.positionAbsolute})});return[t?r.find(function(i){return i.id===t}):r[0],r]}function kh(e){return function(t,n,s){return e==null?void 0:e(t,s)}}function fx(e){var t=e.nodeRef,n=e.disabled,s=n===void 0?!1:n,r=e.noDragClassName,i=e.handleSelector,l=e.nodeId,u=e.isSelectable,d=e.selectNodesOnDrag,h=b.useState(!1),p=xt(h,2),m=p[0],f=p[1],y=ms(),x=b.useRef(),_=b.useRef({x:null,y:null}),v=b.useCallback(function(w){var M=w.sourceEvent,N=y.getState(),C=N.transform,j=N.snapGrid,E=N.snapToGrid,k=M.touches?M.touches[0].clientX:M.clientX,$=M.touches?M.touches[0].clientY:M.clientY,T=hv({x:k,y:$},C,E,j);return T},[]);return b.useEffect(function(){if(t!=null&&t.current){var w=vs(t.current);if(s)w.on(".drag",null);else{var M=Bf().on("start",function(N){var C=y.getState(),j=C.nodeInternals,E=C.multiSelectionActive,k=C.unselectNodesAndEdges,$=C.onNodeDragStart,T=C.onSelectionDragStart,P=l?$:kh(T);if(!d&&!E&&l){var A;(A=j.get(l))!==null&&A!==void 0&&A.selected||k()}l&&u&&d&&dv({id:l,store:y});var D=v(N);if(_.current=D,x.current=gO(j,D,l),P&&x.current){var F=Mh({nodeId:l,dragItems:x.current,nodeInternals:j}),R=xt(F,2),z=R[0],q=R[1];P(N.sourceEvent,z,q)}}).on("drag",function(N){var C=y.getState(),j=C.updateNodePositions,E=C.snapToGrid,k=C.snapGrid,$=C.nodeInternals,T=C.nodeExtent,P=C.onNodeDrag,A=C.onSelectionDrag,D=v(N);if((_.current.x!==D.x||_.current.y!==D.y)&&x.current){_.current=D,x.current=x.current.map(function(U){return _O(U,D,E,k,$,T)});var F=l?P:kh(A);if(j(x.current,!0,!0),f(!0),F){var R=Mh({nodeId:l,dragItems:x.current,nodeInternals:$}),z=xt(R,2),q=z[0],V=z[1];F(N.sourceEvent,q,V)}}N.on("end",function(U){if(f(!1),x.current){var W=y.getState(),B=W.updateNodePositions,I=W.nodeInternals,H=W.onNodeDragStop,J=W.onSelectionDragStop,G=l?H:kh(J);if(B(x.current,!1,!1),G){var Y=Mh({nodeId:l,dragItems:x.current,nodeInternals:I}),X=xt(Y,2),Z=X[0],ee=X[1];G(U.sourceEvent,Z,ee)}}})}).filter(function(N){var C=N.target,j=!N.button&&(!r||!mx(C,".".concat(r),t))&&(!i||mx(C,i,t));return j});return w.call(M),function(){w.on(".drag",null)}}}},[t,s,r,i,u,y,l,d,v]),m}function hx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function yO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hx(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var vO=function(t){return yO({transformString:"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")"),userSelectionActive:t.userSelectionActive},oh(Array.from(t.nodeInternals.values()).filter(function(n){return n.selected})))},xO=function(t){var n=Array.from(t.nodeInternals.values()).filter(function(s){return s.selected});return oh(n)};function bO(e){var t=e.onSelectionContextMenu,n=e.noPanClassName,s=ms(),r=On(vO,Vs),i=r.transformString,l=r.userSelectionActive,u=On(xO,Vs),d=u.width,h=u.height,p=u.x,m=u.y,f=b.useRef(null);if(fx({nodeRef:f}),l||!d||!h)return null;var y=t?function(x){var _=Array.from(s.getState().nodeInternals.values()).filter(function(v){return v.selected});t(x,_)}:void 0;return ve.createElement("div",{className:Lt(["react-flow__nodesselection","react-flow__container",n]),style:{transform:i}},ve.createElement("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:y,style:{width:d,height:h,top:m,left:p}}))}var wO=b.memo(bO),NO=function(t){return t.nodesSelectionActive},px=function(t){var n=t.children,s=t.onPaneClick,r=t.onPaneContextMenu,i=t.onPaneScroll,l=t.deleteKeyCode,u=t.onMove,d=t.onMoveStart,h=t.onMoveEnd,p=t.selectionKeyCode,m=t.multiSelectionKeyCode,f=t.zoomActivationKeyCode,y=t.elementsSelectable,x=t.zoomOnScroll,_=t.zoomOnPinch,v=t.panOnScroll,w=t.panOnScrollSpeed,M=t.panOnScrollMode,N=t.zoomOnDoubleClick,C=t.panOnDrag,j=t.translateExtent,E=t.minZoom,k=t.maxZoom,$=t.defaultZoom,T=t.defaultPosition,P=t.preventScrolling,A=t.onSelectionContextMenu,D=t.noWheelClassName,F=t.noPanClassName,R=ms(),z=On(NO),q=sd(p);cO({deleteKeyCode:l,multiSelectionKeyCode:m});var V=function(I){s==null||s(I),R.getState().resetSelectedElements(),R.setState({nodesSelectionActive:!1})},U=r?function(B){return r(B)}:void 0,W=i?function(B){return i(B)}:void 0;return ve.createElement(fO,{onMove:u,onMoveStart:d,onMoveEnd:h,selectionKeyPressed:q,elementsSelectable:y,zoomOnScroll:x,zoomOnPinch:_,panOnScroll:v,panOnScrollSpeed:w,panOnScrollMode:M,zoomOnDoubleClick:N,panOnDrag:C,translateExtent:j,minZoom:E,maxZoom:k,defaultZoom:$,defaultPosition:T,zoomActivationKeyCode:f,preventScrolling:P,noWheelClassName:D,noPanClassName:F},n,ve.createElement(pO,{selectionKeyPressed:q}),z&&ve.createElement(wO,{onSelectionContextMenu:A,noPanClassName:F}),ve.createElement("div",{className:"react-flow__pane react-flow__container",onClick:V,onContextMenu:U,onWheel:W}))};px.displayName="FlowRenderer";var jO=b.memo(px);function CO(e){var t=On(b.useCallback(function(n){return e?pv(n.nodeInternals,{x:0,y:0,width:n.width,height:n.height},n.transform,!0):Array.from(n.nodeInternals.values())},[e]));return t}var SO=function(t){return{nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,updateNodeDimensions:t.updateNodeDimensions}},gx=function(t){var n=On(SO,Vs),s=n.nodesDraggable,r=n.nodesConnectable,i=n.elementsSelectable,l=n.updateNodeDimensions,u=CO(t.onlyRenderVisibleElements),d=b.useRef(),h=b.useMemo(function(){if(typeof ResizeObserver>"u")return null;var p=new ResizeObserver(function(m){var f=m.map(function(y){return{id:y.target.getAttribute("data-id"),nodeElement:y.target,forceUpdate:!0}});l(f)});return d.current=p,p},[]);return b.useEffect(function(){return function(){var p;d==null||(p=d.current)===null||p===void 0||p.disconnect()}},[]),ve.createElement("div",{className:"react-flow__nodes react-flow__container"},u.map(function(p){var m,f,y,x,_,v,w,M=p.type||"default";t.nodeTypes[M]||(M="default");var N=t.nodeTypes[M]||t.nodeTypes.default,C=!!(p.draggable||s&&typeof p.draggable>"u"),j=!!(p.selectable||i&&typeof p.selectable>"u"),E=!!(p.connectable||r&&typeof p.connectable>"u");return ve.createElement(N,{key:p.id,id:p.id,className:p.className,style:p.style,type:M,data:p.data,sourcePosition:p.sourcePosition||Pe.Bottom,targetPosition:p.targetPosition||Pe.Top,hidden:p.hidden,xPos:(m=(f=p.positionAbsolute)===null||f===void 0?void 0:f.x)!==null&&m!==void 0?m:0,yPos:(y=(x=p.positionAbsolute)===null||x===void 0?void 0:x.y)!==null&&y!==void 0?y:0,selectNodesOnDrag:t.selectNodesOnDrag,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,selected:!!p.selected,isDraggable:C,isSelectable:j,isConnectable:E,resizeObserver:h,dragHandle:p.dragHandle,zIndex:(_=(v=p[rs])===null||v===void 0?void 0:v.z)!==null&&_!==void 0?_:0,isParent:!!((w=p[rs])!==null&&w!==void 0&&w.isParent),noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,initialized:!!p.width&&!!p.height})}))};gx.displayName="NodeRenderer";var EO=b.memo(gx),Ri;function _x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function yx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_x(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_x(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var MO=(Ri={},Tt(Ri,Pe.Left,Pe.Right),Tt(Ri,Pe.Right,Pe.Left),Tt(Ri,Pe.Top,Pe.Bottom),Tt(Ri,Pe.Bottom,Pe.Top),Ri),kO=function(e){var t,n,s,r,i,l=e.connectionNodeId,u=e.connectionHandleType,d=e.connectionLineStyle,h=e.connectionLineType,p=h===void 0?ba.Bezier:h,m=e.isConnectable,f=e.CustomConnectionLineComponent,y=On(b.useCallback(function(W){return{fromNode:W.nodeInternals.get(l),handleId:W.connectionHandleId,toX:(W.connectionPosition.x-W.transform[0])/W.transform[2],toY:(W.connectionPosition.y-W.transform[1])/W.transform[2]}},[l]),Vs),x=y.fromNode,_=y.handleId,v=y.toX,w=y.toY,M=x==null||(t=x[rs])===null||t===void 0?void 0:t.handleBounds;if(!x||!m||!(M!=null&&M[u]))return null;var N=M[u],C=_?N.find(function(W){return W.id===_}):N[0],j=C?C.x+C.width/2:((n=x==null?void 0:x.width)!==null&&n!==void 0?n:0)/2,E=C?C.y+C.height/2:(s=x==null?void 0:x.height)!==null&&s!==void 0?s:0,k=((x==null||(r=x.positionAbsolute)===null||r===void 0?void 0:r.x)||0)+j,$=((x==null||(i=x.positionAbsolute)===null||i===void 0?void 0:i.y)||0)+E,T=C==null?void 0:C.position;if(!T)return null;var P=MO[T],A,D,F,R,z,q;switch(u){case"source":A=k,D=$,F=T,R=v,z=w,q=P;break;case"target":A=v,D=w,F=P,R=k,z=$,q=T;break}if(f)return ve.createElement("g",{className:"react-flow__connection"},ve.createElement(f,{connectionLineType:p,connectionLineStyle:d,fromNode:x,fromHandle:C,fromX:k,fromY:$,toX:v,toY:w,fromPosition:T,toPosition:P,sourcePosition:F,targetPosition:q,sourceNode:x,sourceHandle:C,targetX:R,targetY:z,sourceX:A,sourceY:D}));var V="",U={sourceX:A,sourceY:D,sourcePosition:F,targetX:R,targetY:z,targetPosition:q};return p===ba.Bezier?V=Bv(U):p===ba.Step?V=vh(yx(yx({},U),{},{borderRadius:0})):p===ba.SmoothStep?V=vh(U):p===ba.SimpleBezier?V=Tv(U):V="M".concat(A,",").concat(D," ").concat(R,",").concat(z),ve.createElement("g",{className:"react-flow__connection"},ve.createElement("path",{d:V,className:"react-flow__connection-path",style:d}))};function Ah(e){"@babel/helpers - typeof";return Ah=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ah(e)}var ad,AO=function(t){var n=t.color,s=n===void 0?"none":n,r=t.strokeWidth,i=r===void 0?1:r;return ve.createElement("polyline",{stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:i,fill:"none",points:"-5,-4 0,0 -5,4"})},OO=function(t){var n=t.color,s=n===void 0?"none":n,r=t.strokeWidth,i=r===void 0?1:r;return ve.createElement("polyline",{stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:i,fill:s,points:"-5,-4 0,0 -5,4 -5,-4"})},vx=(ad={},Tt(ad,Yu.Arrow,AO),Tt(ad,Yu.ArrowClosed,OO),ad);function TO(e){var t=b.useMemo(function(){var n=vx.hasOwnProperty(e);return n?vx[e]:function(){return null}},[e]);return t}function xx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function $O(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xx(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var PO=function(t){var n=t.id,s=t.type,r=t.color,i=t.width,l=i===void 0?12.5:i,u=t.height,d=u===void 0?12.5:u,h=t.markerUnits,p=h===void 0?"strokeWidth":h,m=t.strokeWidth,f=t.orient,y=f===void 0?"auto":f,x=TO(s);return ve.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:"".concat(l),markerHeight:"".concat(d),viewBox:"-10 -10 20 20",markerUnits:p,orient:y,refX:"0",refY:"0"},ve.createElement(x,{color:r,strokeWidth:m}))},LO=function(t){var n=t.defaultColor,s=t.rfId;return function(r){var i=[];return r.edges.reduce(function(l,u){return[u.markerStart,u.markerEnd].forEach(function(d){if(d&&Ah(d)==="object"){var h=ah(d,s);i.includes(h)||(l.push($O({id:h,color:d.color||n},d)),i.push(h))}}),l},[]).sort(function(l,u){return l.id.localeCompare(u.id)})}},bx=function(t){var n=t.defaultColor,s=t.rfId,r=On(b.useCallback(LO({defaultColor:n,rfId:s}),[n,s]),function(i,l){return!(i.length!==l.length||i.some(function(u,d){return u.id!==l[d].id}))});return ve.createElement("defs",null,r.map(function(i){return ve.createElement(PO,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})}))};bx.displayName="MarkerDefinitions";var RO=b.memo(bx),DO=[{level:0,isMaxLevel:!0,edges:[]}];function zO(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=-1,r=e.reduce(function(l,u){var d=sv(u.zIndex),h=d?u.zIndex:0;if(n){var p,m,f,y;h=d?u.zIndex:Math.max(((p=t.get(u.source))===null||p===void 0||(m=p[rs])===null||m===void 0?void 0:m.z)||0,((f=t.get(u.target))===null||f===void 0||(y=f[rs])===null||y===void 0?void 0:y.z)||0)}return l[h]?l[h].push(u):l[h]=[u],s=h>s?h:s,l},{}),i=Object.entries(r).map(function(l){var u=xt(l,2),d=u[0],h=u[1],p=+d;return{edges:h,level:p,isMaxLevel:p===s}});return i.length===0?DO:i}function IO(e,t,n){var s=On(b.useCallback(function(r){return e?r.edges.filter(function(i){var l=t.get(i.source),u=t.get(i.target);return(l==null?void 0:l.width)&&(l==null?void 0:l.height)&&(u==null?void 0:u.width)&&(u==null?void 0:u.height)&&oO({sourcePos:l.positionAbsolute||{x:0,y:0},targetPos:u.positionAbsolute||{x:0,y:0},sourceWidth:l.width,sourceHeight:l.height,targetWidth:u.width,targetHeight:u.height,width:r.width,height:r.height,transform:r.transform})}):r.edges},[e,t]));return zO(s,t,n)}var FO=function(t){return{connectionNodeId:t.connectionNodeId,connectionHandleType:t.connectionHandleType,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,width:t.width,height:t.height,connectionMode:t.connectionMode,nodeInternals:t.nodeInternals}},wx=function(t){var n=On(FO,Vs),s=n.connectionNodeId,r=n.connectionHandleType,i=n.nodesConnectable,l=n.elementsSelectable,u=n.width,d=n.height,h=n.connectionMode,p=n.nodeInternals,m=IO(t.onlyRenderVisibleElements,p,t.elevateEdgesOnSelect);if(!u)return null;var f=t.connectionLineType,y=t.defaultMarkerColor,x=t.connectionLineStyle,_=t.connectionLineComponent,v=t.connectionLineContainerStyle,w=s&&r;return ve.createElement(ve.Fragment,null,m.map(function(M){var N=M.level,C=M.edges,j=M.isMaxLevel;return ve.createElement("svg",{key:N,style:{zIndex:N},width:u,height:d,className:"react-flow__edges react-flow__container"},j&&ve.createElement(RO,{defaultColor:y,rfId:t.rfId}),ve.createElement("g",null,C.map(function(E){var k=tx(p,E.source),$=xt(k,3),T=$[0],P=$[1],A=$[2],D=tx(p,E.target),F=xt(D,3),R=F[0],z=F[1],q=F[2];if(!A||!q)return null;var V=E.type||"default";t.edgeTypes[V]||(console.warn('[React Flow]: Edge type "'.concat(V,'" not found. Using fallback type "default". Help: https://reactflow.dev/error#300')),V="default");var U=t.edgeTypes[V]||t.edgeTypes.default,W=h===To.Strict?z.target:z.target||z.source,B=ex(P.source,E.sourceHandle||null),I=ex(W,E.targetHandle||null),H=(B==null?void 0:B.position)||Pe.Bottom,J=(I==null?void 0:I.position)||Pe.Top;if(!B||!I)return null;var G=aO(T,B,H,R,I,J),Y=G.sourceX,X=G.sourceY,Z=G.targetX,ee=G.targetY;return ve.createElement(U,{key:E.id,id:E.id,className:Lt([E.className,t.noPanClassName]),type:V,data:E.data,selected:!!E.selected,animated:!!E.animated,hidden:!!E.hidden,label:E.label,labelStyle:E.labelStyle,labelShowBg:E.labelShowBg,labelBgStyle:E.labelBgStyle,labelBgPadding:E.labelBgPadding,labelBgBorderRadius:E.labelBgBorderRadius,style:E.style,source:E.source,target:E.target,sourceHandleId:E.sourceHandle,targetHandleId:E.targetHandle,markerEnd:E.markerEnd,markerStart:E.markerStart,sourceX:Y,sourceY:X,targetX:Z,targetY:ee,sourcePosition:H,targetPosition:J,elementsSelectable:l,onEdgeUpdate:t.onEdgeUpdate,onContextMenu:t.onEdgeContextMenu,onMouseEnter:t.onEdgeMouseEnter,onMouseMove:t.onEdgeMouseMove,onMouseLeave:t.onEdgeMouseLeave,onClick:t.onEdgeClick,edgeUpdaterRadius:t.edgeUpdaterRadius,onEdgeDoubleClick:t.onEdgeDoubleClick,onEdgeUpdateStart:t.onEdgeUpdateStart,onEdgeUpdateEnd:t.onEdgeUpdateEnd,rfId:t.rfId})})))}),w&&ve.createElement("svg",{style:v,width:u,height:d,className:"react-flow__edges react-flow__connectionline react-flow__container"},ve.createElement(kO,{connectionNodeId:s,connectionHandleType:r,connectionLineStyle:x,connectionLineType:f,isConnectable:i,CustomConnectionLineComponent:_})))};wx.displayName="EdgeRenderer";var BO=b.memo(wx),UO=function(t){return"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")")};function HO(e){var t=e.children,n=On(UO);return ve.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:n}},t)}function qO(e){var t=uh(),n=b.useRef(!1);b.useEffect(function(){!n.current&&t.viewportInitialized&&e&&(setTimeout(function(){return e(t)},1),n.current=!0)},[e,t.viewportInitialized])}var Nx=function(t){var n=t.nodeTypes,s=t.edgeTypes,r=t.onMove,i=t.onMoveStart,l=t.onMoveEnd,u=t.onInit,d=t.onNodeClick,h=t.onEdgeClick,p=t.onNodeDoubleClick,m=t.onEdgeDoubleClick,f=t.onNodeMouseEnter,y=t.onNodeMouseMove,x=t.onNodeMouseLeave,_=t.onNodeContextMenu,v=t.onSelectionContextMenu,w=t.connectionLineType,M=t.connectionLineStyle,N=t.connectionLineComponent,C=t.connectionLineContainerStyle,j=t.selectionKeyCode,E=t.multiSelectionKeyCode,k=t.zoomActivationKeyCode,$=t.deleteKeyCode,T=t.onlyRenderVisibleElements,P=t.elementsSelectable,A=t.selectNodesOnDrag,D=t.translateExtent,F=t.minZoom,R=t.maxZoom,z=t.defaultZoom,q=t.defaultPosition,V=t.preventScrolling,U=t.defaultMarkerColor,W=t.zoomOnScroll,B=t.zoomOnPinch,I=t.panOnScroll,H=t.panOnScrollSpeed,J=t.panOnScrollMode,G=t.zoomOnDoubleClick,Y=t.panOnDrag,X=t.onPaneClick,Z=t.onPaneScroll,ee=t.onPaneContextMenu,Q=t.onEdgeUpdate,ne=t.onEdgeContextMenu,he=t.onEdgeMouseEnter,ye=t.onEdgeMouseMove,ge=t.onEdgeMouseLeave,Ee=t.edgeUpdaterRadius,De=t.onEdgeUpdateStart,ke=t.onEdgeUpdateEnd,le=t.noDragClassName,pe=t.noWheelClassName,be=t.noPanClassName,Te=t.elevateEdgesOnSelect,Ie=t.id;return qO(u),ve.createElement(jO,{onPaneClick:X,onPaneContextMenu:ee,onPaneScroll:Z,deleteKeyCode:$,selectionKeyCode:j,multiSelectionKeyCode:E,zoomActivationKeyCode:k,elementsSelectable:P,onMove:r,onMoveStart:i,onMoveEnd:l,zoomOnScroll:W,zoomOnPinch:B,zoomOnDoubleClick:G,panOnScroll:I,panOnScrollSpeed:H,panOnScrollMode:J,panOnDrag:Y,translateExtent:D,minZoom:F,maxZoom:R,defaultZoom:z,defaultPosition:q,onSelectionContextMenu:v,preventScrolling:V,noDragClassName:le,noWheelClassName:pe,noPanClassName:be},ve.createElement(HO,null,ve.createElement(BO,{edgeTypes:s,onEdgeClick:h,onEdgeDoubleClick:m,connectionLineType:w,connectionLineStyle:M,connectionLineComponent:N,connectionLineContainerStyle:C,onEdgeUpdate:Q,onlyRenderVisibleElements:T,onEdgeContextMenu:ne,onEdgeMouseEnter:he,onEdgeMouseMove:ye,onEdgeMouseLeave:ge,onEdgeUpdateStart:De,onEdgeUpdateEnd:ke,edgeUpdaterRadius:Ee,defaultMarkerColor:U,noPanClassName:be,elevateEdgesOnSelect:!!Te,rfId:Ie}),ve.createElement(EO,{nodeTypes:n,onNodeClick:d,onNodeDoubleClick:p,onNodeMouseEnter:f,onNodeMouseMove:y,onNodeMouseLeave:x,onNodeContextMenu:_,selectNodesOnDrag:A,onlyRenderVisibleElements:T,noPanClassName:be,noDragClassName:le})))};Nx.displayName="GraphView";var VO=b.memo(Nx),jx=function(){return null};jx.displayName="GroupNode";function Cx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Sx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Cx(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var nc=function(e){var t=function(s){var r=s.id,i=s.type,l=s.data,u=s.xPos,d=s.yPos,h=s.selected,p=s.onClick,m=s.onMouseEnter,f=s.onMouseMove,y=s.onMouseLeave,x=s.onContextMenu,_=s.onDoubleClick,v=s.style,w=s.className,M=s.isDraggable,N=s.isSelectable,C=s.isConnectable,j=s.selectNodesOnDrag,E=s.sourcePosition,k=s.targetPosition,$=s.hidden,T=s.resizeObserver,P=s.dragHandle,A=s.zIndex,D=s.isParent,F=s.noPanClassName,R=s.noDragClassName,z=s.initialized,q=ms(),V=b.useRef(null),U=b.useRef(E),W=b.useRef(k),B=b.useRef(i),I=N||M||p||m||f||y,H=Zl(r,q.getState,m),J=Zl(r,q.getState,f),G=Zl(r,q.getState,y),Y=Zl(r,q.getState,x),X=Zl(r,q.getState,_),Z=function(ne){if(N&&(!j||!M)&&dv({id:r,store:q}),p){var he=q.getState().nodeInternals.get(r);p(ne,Sx({},he))}};b.useEffect(function(){if(V.current&&!$){var Q=V.current;return T==null||T.observe(Q),function(){return T==null?void 0:T.unobserve(Q)}}},[$]),b.useEffect(function(){var Q=B.current!==i,ne=U.current!==E,he=W.current!==k;V.current&&(Q||ne||he)&&(Q&&(B.current=i),ne&&(U.current=E),he&&(W.current=k),q.getState().updateNodeDimensions([{id:r,nodeElement:V.current,forceUpdate:!0}]))},[r,i,E,k]);var ee=fx({nodeRef:V,disabled:$||!M,noDragClassName:R,handleSelector:P,nodeId:r,isSelectable:N,selectNodesOnDrag:j});return $?null:ve.createElement("div",{className:Lt(["react-flow__node","react-flow__node-".concat(i),F,w,{selected:h,selectable:N,parent:D}]),ref:V,style:Sx({zIndex:A,transform:"translate(".concat(u,"px,").concat(d,"px)"),pointerEvents:I?"all":"none",visibility:z?"visible":"hidden"},v),onMouseEnter:H,onMouseMove:J,onMouseLeave:G,onContextMenu:Y,onClick:Z,onDoubleClick:X,"data-testid":"rf__node-".concat(r),"data-id":r},ve.createElement(UA,{value:r},ve.createElement(e,{id:r,data:l,type:i,xPos:u,yPos:d,selected:h,isConnectable:C,sourcePosition:E,targetPosition:k,dragging:ee,dragHandle:P,zIndex:A})))};return t.displayName="NodeWrapper",b.memo(t)};function Ex(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Mx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ex(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ex(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function WO(e){var t={input:nc(e.input||Yv),default:nc(e.default||Sh),output:nc(e.output||Gv),group:nc(e.group||jx)},n={},s=Object.keys(e).filter(function(r){return!["input","default","output","group"].includes(r)}).reduce(function(r,i){return r[i]=nc(e[i]||Sh),r},n);return Mx(Mx({},t),s)}function kx(e,t){b.useRef(null);var n=b.useMemo(function(){return t(e)},[e]);return n}function Ax(e){if(!(!e||typeof document>"u")){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");t.appendChild(n),n.appendChild(document.createTextNode(e))}}var Ox=function(t){var n=t.children,s=!0;try{ms()}catch{s=!1}return s?ve.createElement(ve.Fragment,null,n):ve.createElement(Nv,{createStore:jv},n)};Ox.displayName="ReactFlowWrapper";var YO=["nodes","edges","defaultNodes","defaultEdges","className","nodeTypes","edgeTypes","onNodeClick","onEdgeClick","onInit","onMove","onMoveStart","onMoveEnd","onConnect","onConnectStart","onConnectStop","onConnectEnd","onClickConnectStart","onClickConnectStop","onClickConnectEnd","onNodeMouseEnter","onNodeMouseMove","onNodeMouseLeave","onNodeContextMenu","onNodeDoubleClick","onNodeDragStart","onNodeDrag","onNodeDragStop","onNodesDelete","onEdgesDelete","onSelectionChange","onSelectionDragStart","onSelectionDrag","onSelectionDragStop","onSelectionContextMenu","connectionMode","connectionLineType","connectionLineStyle","connectionLineComponent","connectionLineContainerStyle","deleteKeyCode","selectionKeyCode","multiSelectionKeyCode","zoomActivationKeyCode","snapToGrid","snapGrid","onlyRenderVisibleElements","selectNodesOnDrag","nodesDraggable","nodesConnectable","elementsSelectable","minZoom","maxZoom","defaultZoom","defaultPosition","translateExtent","preventScrolling","nodeExtent","defaultMarkerColor","zoomOnScroll","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnScrollMode","zoomOnDoubleClick","panOnDrag","onPaneClick","onPaneScroll","onPaneContextMenu","children","onEdgeUpdate","onEdgeContextMenu","onEdgeDoubleClick","onEdgeMouseEnter","onEdgeMouseMove","onEdgeMouseLeave","onEdgeUpdateStart","onEdgeUpdateEnd","edgeUpdaterRadius","onNodesChange","onEdgesChange","noDragClassName","noWheelClassName","noPanClassName","fitView","fitViewOptions","connectOnClick","attributionPosition","proOptions","defaultEdgeOptions","elevateEdgesOnSelect"];function Tx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function $x(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Tx(Object(n),!0).forEach(function(s){Tt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tx(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}Ax(JA),Ax(tO);var KO={input:Yv,default:Sh,output:Gv},GO={default:bh,straight:Fv,step:Iv,smoothstep:xh,simplebezier:$v},XO=[15,15],QO=[0,0],Px=b.forwardRef(function(e,t){var n=e.nodes,s=e.edges,r=e.defaultNodes,i=e.defaultEdges,l=e.className,u=e.nodeTypes,d=u===void 0?KO:u,h=e.edgeTypes,p=h===void 0?GO:h,m=e.onNodeClick,f=e.onEdgeClick,y=e.onInit,x=e.onMove,_=e.onMoveStart,v=e.onMoveEnd,w=e.onConnect,M=e.onConnectStart,N=e.onConnectStop,C=e.onConnectEnd,j=e.onClickConnectStart,E=e.onClickConnectStop,k=e.onClickConnectEnd,$=e.onNodeMouseEnter,T=e.onNodeMouseMove,P=e.onNodeMouseLeave,A=e.onNodeContextMenu,D=e.onNodeDoubleClick,F=e.onNodeDragStart,R=e.onNodeDrag,z=e.onNodeDragStop,q=e.onNodesDelete,V=e.onEdgesDelete,U=e.onSelectionChange,W=e.onSelectionDragStart,B=e.onSelectionDrag,I=e.onSelectionDragStop,H=e.onSelectionContextMenu,J=e.connectionMode,G=J===void 0?To.Strict:J,Y=e.connectionLineType,X=Y===void 0?ba.Bezier:Y,Z=e.connectionLineStyle,ee=e.connectionLineComponent,Q=e.connectionLineContainerStyle,ne=e.deleteKeyCode,he=ne===void 0?"Backspace":ne,ye=e.selectionKeyCode,ge=ye===void 0?"Shift":ye,Ee=e.multiSelectionKeyCode,De=Ee===void 0?"Meta":Ee,ke=e.zoomActivationKeyCode,le=ke===void 0?"Meta":ke,pe=e.snapToGrid,be=pe===void 0?!1:pe,Te=e.snapGrid,Ie=Te===void 0?XO:Te,ue=e.onlyRenderVisibleElements,$e=ue===void 0?!1:ue,Ye=e.selectNodesOnDrag,et=Ye===void 0?!0:Ye,We=e.nodesDraggable,mt=e.nodesConnectable,rt=e.elementsSelectable,ft=e.minZoom,bt=ft===void 0?.5:ft,zt=e.maxZoom,Xe=zt===void 0?2:zt,Ft=e.defaultZoom,Kt=Ft===void 0?1:Ft,Et=e.defaultPosition,Qt=Et===void 0?QO:Et,wn=e.translateExtent,Mt=wn===void 0?lh:wn,Zt=e.preventScrolling,Nn=Zt===void 0?!0:Zt,Bt=e.nodeExtent,dt=e.defaultMarkerColor,Tn=dt===void 0?"#b1b1b7":dt,Xt=e.zoomOnScroll,Nt=Xt===void 0?!0:Xt,at=e.zoomOnPinch,os=at===void 0?!0:at,Vt=e.panOnScroll,pt=Vt===void 0?!1:Vt,yt=e.panOnScrollSpeed,Gn=yt===void 0?.5:yt,mn=e.panOnScrollMode,vn=mn===void 0?Ai.Free:mn,nn=e.zoomOnDoubleClick,jn=nn===void 0?!0:nn,Jt=e.panOnDrag,Xn=Jt===void 0?!0:Jt,$t=e.onPaneClick,$n=e.onPaneScroll,xn=e.onPaneContextMenu,fn=e.children,ws=e.onEdgeUpdate,Pn=e.onEdgeContextMenu,Ns=e.onEdgeDoubleClick,Qn=e.onEdgeMouseEnter,is=e.onEdgeMouseMove,js=e.onEdgeMouseLeave,Fn=e.onEdgeUpdateStart,Zn=e.onEdgeUpdateEnd,Ht=e.edgeUpdaterRadius,Qe=Ht===void 0?10:Ht,Ue=e.onNodesChange,Ln=e.onEdgesChange,Cs=e.noDragClassName,Jn=Cs===void 0?"nodrag":Cs,Ss=e.noWheelClassName,ie=Ss===void 0?"nowheel":Ss,xe=e.noPanClassName,Le=xe===void 0?"nopan":xe,jt=e.fitView,Ce=jt===void 0?!1:jt,ot=e.fitViewOptions,lt=e.connectOnClick,Rt=lt===void 0?!0:lt,kt=e.attributionPosition,Ut=e.proOptions,At=e.defaultEdgeOptions,sn=e.elevateEdgesOnSelect,ls=sn===void 0?!1:sn,Cn=Xu(e,YO),en=kx(d,WO),rn=kx(p,rO);return ve.createElement("div",$x($x({},Cn),{},{ref:t,className:Lt(["react-flow",l])}),ve.createElement(Ox,null,ve.createElement(VO,{onInit:y,onMove:x,onMoveStart:_,onMoveEnd:v,onNodeClick:m,onEdgeClick:f,onNodeMouseEnter:$,onNodeMouseMove:T,onNodeMouseLeave:P,onNodeContextMenu:A,onNodeDoubleClick:D,nodeTypes:en,edgeTypes:rn,connectionLineType:X,connectionLineStyle:Z,connectionLineComponent:ee,connectionLineContainerStyle:Q,selectionKeyCode:ge,deleteKeyCode:he,multiSelectionKeyCode:De,zoomActivationKeyCode:le,onlyRenderVisibleElements:$e,selectNodesOnDrag:et,translateExtent:Mt,minZoom:bt,maxZoom:Xe,defaultZoom:Kt,defaultPosition:Qt,preventScrolling:Nn,zoomOnScroll:Nt,zoomOnPinch:os,zoomOnDoubleClick:jn,panOnScroll:pt,panOnScrollSpeed:Gn,panOnScrollMode:vn,panOnDrag:Xn,onPaneClick:$t,onPaneScroll:$n,onPaneContextMenu:xn,onSelectionContextMenu:H,onEdgeUpdate:ws,onEdgeContextMenu:Pn,onEdgeDoubleClick:Ns,onEdgeMouseEnter:Qn,onEdgeMouseMove:is,onEdgeMouseLeave:js,onEdgeUpdateStart:Fn,onEdgeUpdateEnd:Zn,edgeUpdaterRadius:Qe,defaultMarkerColor:Tn,noDragClassName:Jn,noWheelClassName:ie,noPanClassName:Le,elevateEdgesOnSelect:ls,id:Cn==null?void 0:Cn.id}),ve.createElement(QA,{nodes:n,edges:s,defaultNodes:r,defaultEdges:i,onConnect:w,onConnectStart:M,onConnectStop:N,onConnectEnd:C,onClickConnectStart:j,onClickConnectStop:E,onClickConnectEnd:k,nodesDraggable:We,nodesConnectable:mt,elementsSelectable:rt,minZoom:bt,maxZoom:Xe,nodeExtent:Bt,onNodesChange:Ue,onEdgesChange:Ln,snapToGrid:be,snapGrid:Ie,connectionMode:G,translateExtent:Mt,connectOnClick:Rt,defaultEdgeOptions:At,fitView:Ce,fitViewOptions:ot,onNodesDelete:q,onEdgesDelete:V,onNodeDragStart:F,onNodeDrag:R,onNodeDragStop:z,onSelectionDrag:B,onSelectionDragStart:W,onSelectionDragStop:I}),U&&ve.createElement(GA,{onSelectionChange:U}),fn,ve.createElement(PA,{proOptions:Ut,position:kt})))});Px.displayName="ReactFlow";var Lx=function(t){var n=t.children;return ve.createElement(Nv,{createStore:jv},n)};Lx.displayName="ReactFlowProvider";function Rx(e){return function(t){var n=b.useState(t),s=xt(n,2),r=s[0],i=s[1],l=b.useCallback(function(u){return i(function(d){return e(u,d)})},[]);return[r,i,l]}}var ZO=Rx(iv),JO=Rx(rA);const Rr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:s})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:s}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},sc=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Dx=["Enter"," ","Escape"],zx={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Di;(function(e){e.Strict="strict",e.Loose="loose"})(Di||(Di={}));var Lo;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Lo||(Lo={}));var rc;(function(e){e.Partial="partial",e.Full="full"})(rc||(rc={}));const Ix={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var ja;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(ja||(ja={}));var od;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(od||(od={}));var Je;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Je||(Je={}));const Fx={[Je.Left]:Je.Right,[Je.Right]:Je.Left,[Je.Top]:Je.Bottom,[Je.Bottom]:Je.Top};function Bx(e){return e===null?null:e?"valid":"invalid"}const Ux=e=>"id"in e&&"source"in e&&"target"in e,eT=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Oh=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),ac=(e,t=[0,0])=>{const{width:n,height:s}=Gr(e),r=e.origin??t,i=n*r[0],l=s*r[1];return{x:e.position.x-i,y:e.position.y-l}},tT=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,r)=>{const i=typeof r=="string";let l=!t.nodeLookup&&!i?r:void 0;t.nodeLookup&&(l=i?t.nodeLookup.get(r):Oh(r)?r:t.nodeLookup.get(r.id));const u=l?cd(l,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return id(s,u)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ld(n)},oc=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return e.forEach(r=>{(t.filter===void 0||t.filter(r))&&(n=id(n,cd(r)),s=!0)}),s?ld(n):{x:0,y:0,width:0,height:0}},Th=(e,t,[n,s,r]=[0,0,1],i=!1,l=!1)=>{const u={...cc(t,[n,s,r]),width:t.width/r,height:t.height/r},d=[];for(const h of e.values()){const{measured:p,selectable:m=!0,hidden:f=!1}=h;if(l&&!m||f)continue;const y=p.width??h.width??h.initialWidth??null,x=p.height??h.height??h.initialHeight??null,_=ic(u,Ii(h)),v=(y??0)*(x??0),w=i&&_>0;(!h.internals.handleBounds||w||_>=v||h.dragging)&&d.push(h)}return d},nT=(e,t)=>{const n=new Set;return e.forEach(s=>{n.add(s.id)}),t.filter(s=>n.has(s.source)||n.has(s.target))};function sT(e,t){const n=new Map,s=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!s||s.has(r.id))&&n.set(r.id,r)}),n}async function rT({nodes:e,width:t,height:n,panZoom:s,minZoom:r,maxZoom:i},l){if(e.size===0)return Promise.resolve(!0);const u=sT(e,l),d=oc(u),h=Ph(d,t,n,(l==null?void 0:l.minZoom)??r,(l==null?void 0:l.maxZoom)??i,(l==null?void 0:l.padding)??.1);return await s.setViewport(h,{duration:l==null?void 0:l.duration,ease:l==null?void 0:l.ease,interpolate:l==null?void 0:l.interpolate}),Promise.resolve(!0)}function Hx({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:s=[0,0],nodeExtent:r,onError:i}){const l=n.get(e),u=l.parentId?n.get(l.parentId):void 0,{x:d,y:h}=u?u.internals.positionAbsolute:{x:0,y:0},p=l.origin??s;let m=l.extent||r;if(l.extent==="parent"&&!l.expandParent)if(!u)i==null||i("005",Rr.error005());else{const y=u.measured.width,x=u.measured.height;y&&x&&(m=[[d,h],[d+y,h+x]])}else u&&Bi(l.extent)&&(m=[[l.extent[0][0]+d,l.extent[0][1]+h],[l.extent[1][0]+d,l.extent[1][1]+h]]);const f=Bi(m)?Ro(t,m,l.measured):t;return(l.measured.width===void 0||l.measured.height===void 0)&&(i==null||i("015",Rr.error015())),{position:{x:f.x-d+(l.measured.width??0)*p[0],y:f.y-h+(l.measured.height??0)*p[1]},positionAbsolute:f}}async function aT({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:s,onBeforeDelete:r}){const i=new Set(e.map(f=>f.id)),l=[];for(const f of n){if(f.deletable===!1)continue;const y=i.has(f.id),x=!y&&f.parentId&&l.find(_=>_.id===f.parentId);(y||x)&&l.push(f)}const u=new Set(t.map(f=>f.id)),d=s.filter(f=>f.deletable!==!1),p=nT(l,d);for(const f of d)u.has(f.id)&&!p.find(x=>x.id===f.id)&&p.push(f);if(!r)return{edges:p,nodes:l};const m=await r({nodes:l,edges:p});return typeof m=="boolean"?m?{edges:p,nodes:l}:{edges:[],nodes:[]}:m}const zi=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),Ro=(e={x:0,y:0},t,n)=>({x:zi(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:zi(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function qx(e,t,n){const{width:s,height:r}=Gr(n),{x:i,y:l}=n.internals.positionAbsolute;return Ro(e,[[i,l],[i+s,l+r]],t)}const Vx=(e,t,n)=>e<t?zi(Math.abs(e-t),1,t)/t:e>n?-zi(Math.abs(e-n),1,t)/t:0,Wx=(e,t,n=15,s=40)=>{const r=Vx(e.x,s,t.width-s)*n,i=Vx(e.y,s,t.height-s)*n;return[r,i]},id=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),$h=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),ld=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),Ii=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=Oh(e)?e.internals.positionAbsolute:ac(e,t);return{x:n,y:s,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},cd=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=Oh(e)?e.internals.positionAbsolute:ac(e,t);return{x:n,y:s,x2:n+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:s+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},Yx=(e,t)=>ld(id($h(e),$h(t))),ic=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},Kx=e=>_r(e.width)&&_r(e.height)&&_r(e.x)&&_r(e.y),_r=e=>!isNaN(e)&&isFinite(e),oT=(e,t)=>{},lc=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),cc=({x:e,y:t},[n,s,r],i=!1,l=[1,1])=>{const u={x:(e-n)/r,y:(t-s)/r};return i?lc(u,l):u},ud=({x:e,y:t},[n,s,r])=>({x:e*r+n,y:t*r+s});function Fi(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function iT(e,t,n){if(typeof e=="string"||typeof e=="number"){const s=Fi(e,n),r=Fi(e,t);return{top:s,right:r,bottom:s,left:r,x:r*2,y:s*2}}if(typeof e=="object"){const s=Fi(e.top??e.y??0,n),r=Fi(e.bottom??e.y??0,n),i=Fi(e.left??e.x??0,t),l=Fi(e.right??e.x??0,t);return{top:s,right:l,bottom:r,left:i,x:i+l,y:s+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function lT(e,t,n,s,r,i){const{x:l,y:u}=ud(e,[t,n,s]),{x:d,y:h}=ud({x:e.x+e.width,y:e.y+e.height},[t,n,s]),p=r-d,m=i-h;return{left:Math.floor(l),top:Math.floor(u),right:Math.floor(p),bottom:Math.floor(m)}}const Ph=(e,t,n,s,r,i)=>{const l=iT(i,t,n),u=(t-l.x)/e.width,d=(n-l.y)/e.height,h=Math.min(u,d),p=zi(h,s,r),m=e.x+e.width/2,f=e.y+e.height/2,y=t/2-m*p,x=n/2-f*p,_=lT(e,y,x,p,t,n),v={left:Math.min(_.left-l.left,0),top:Math.min(_.top-l.top,0),right:Math.min(_.right-l.right,0),bottom:Math.min(_.bottom-l.bottom,0)};return{x:y-v.left+v.right,y:x-v.top+v.bottom,zoom:p}},uc=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Bi(e){return e!=null&&e!=="parent"}function Gr(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function Gx(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function Xx(e,t={width:0,height:0},n,s,r){const i={...e},l=s.get(n);if(l){const u=l.origin||r;i.x+=l.internals.positionAbsolute.x-(t.width??0)*u[0],i.y+=l.internals.positionAbsolute.y-(t.height??0)*u[1]}return i}function Qx(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function cT(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}function uT(e){return{...zx,...e||{}}}function dc(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:s,containerBounds:r}){const{x:i,y:l}=yr(e),u=cc({x:i-((r==null?void 0:r.left)??0),y:l-((r==null?void 0:r.top)??0)},s),{x:d,y:h}=n?lc(u,t):u;return{xSnapped:d,ySnapped:h,...u}}const Lh=e=>({width:e.offsetWidth,height:e.offsetHeight}),Zx=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},dT=["INPUT","SELECT","TEXTAREA"];function Jx(e){var s,r;const t=((r=(s=e.composedPath)==null?void 0:s.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:dT.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const eb=e=>"clientX"in e,yr=(e,t)=>{var i,l;const n=eb(e),s=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,r=n?e.clientY:(l=e.touches)==null?void 0:l[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},tb=(e,t,n,s,r)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(l=>{const u=l.getBoundingClientRect();return{id:l.getAttribute("data-handleid"),type:e,nodeId:r,position:l.getAttribute("data-handlepos"),x:(u.left-n.left)/s,y:(u.top-n.top)/s,...Lh(l)}})};function nb({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:r,sourceControlY:i,targetControlX:l,targetControlY:u}){const d=e*.125+r*.375+l*.375+n*.125,h=t*.125+i*.375+u*.375+s*.125,p=Math.abs(d-e),m=Math.abs(h-t);return[d,h,p,m]}function dd(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function sb({pos:e,x1:t,y1:n,x2:s,y2:r,c:i}){switch(e){case Je.Left:return[t-dd(t-s,i),n];case Je.Right:return[t+dd(s-t,i),n];case Je.Top:return[t,n-dd(n-r,i)];case Je.Bottom:return[t,n+dd(r-n,i)]}}function rb({sourceX:e,sourceY:t,sourcePosition:n=Je.Bottom,targetX:s,targetY:r,targetPosition:i=Je.Top,curvature:l=.25}){const[u,d]=sb({pos:n,x1:e,y1:t,x2:s,y2:r,c:l}),[h,p]=sb({pos:i,x1:s,y1:r,x2:e,y2:t,c:l}),[m,f,y,x]=nb({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:u,sourceControlY:d,targetControlX:h,targetControlY:p});return[`M${e},${t} C${u},${d} ${h},${p} ${s},${r}`,m,f,y,x]}function ab({sourceX:e,sourceY:t,targetX:n,targetY:s}){const r=Math.abs(n-e)/2,i=n<e?n+r:n-r,l=Math.abs(s-t)/2,u=s<t?s+l:s-l;return[i,u,r,l]}function mT({sourceNode:e,targetNode:t,selected:n=!1,zIndex:s,elevateOnSelect:r=!1}){if(s!==void 0)return s;const i=r&&n?1e3:0,l=Math.max(e.parentId||r&&e.selected?e.internals.z:0,t.parentId||r&&t.selected?t.internals.z:0);return i+l}function fT({sourceNode:e,targetNode:t,width:n,height:s,transform:r}){const i=id(cd(e),cd(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const l={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:s/r[2]};return ic(l,ld(i))>0}const hT=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`xy-edge__${e}${t||""}-${n}${s||""}`,pT=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),gT=(e,t)=>{if(!e.source||!e.target)return t;let n;return Ux(e)?n={...e}:n={...e,id:hT(e)},pT(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function ob({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[r,i,l,u]=ab({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,r,i,l,u]}const ib={[Je.Left]:{x:-1,y:0},[Je.Right]:{x:1,y:0},[Je.Top]:{x:0,y:-1},[Je.Bottom]:{x:0,y:1}},_T=({source:e,sourcePosition:t=Je.Bottom,target:n})=>t===Je.Left||t===Je.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},lb=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function yT({source:e,sourcePosition:t=Je.Bottom,target:n,targetPosition:s=Je.Top,center:r,offset:i,stepPosition:l}){const u=ib[t],d=ib[s],h={x:e.x+u.x*i,y:e.y+u.y*i},p={x:n.x+d.x*i,y:n.y+d.y*i},m=_T({source:h,sourcePosition:t,target:p}),f=m.x!==0?"x":"y",y=m[f];let x=[],_,v;const w={x:0,y:0},M={x:0,y:0},[,,N,C]=ab({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(u[f]*d[f]===-1){f==="x"?(_=r.x??h.x+(p.x-h.x)*l,v=r.y??(h.y+p.y)/2):(_=r.x??(h.x+p.x)/2,v=r.y??h.y+(p.y-h.y)*l);const E=[{x:_,y:h.y},{x:_,y:p.y}],k=[{x:h.x,y:v},{x:p.x,y:v}];u[f]===y?x=f==="x"?E:k:x=f==="x"?k:E}else{const E=[{x:h.x,y:p.y}],k=[{x:p.x,y:h.y}];if(f==="x"?x=u.x===y?k:E:x=u.y===y?E:k,t===s){const D=Math.abs(e[f]-n[f]);if(D<=i){const F=Math.min(i-1,i-D);u[f]===y?w[f]=(h[f]>e[f]?-1:1)*F:M[f]=(p[f]>n[f]?-1:1)*F}}if(t!==s){const D=f==="x"?"y":"x",F=u[f]===d[D],R=h[D]>p[D],z=h[D]<p[D];(u[f]===1&&(!F&&R||F&&z)||u[f]!==1&&(!F&&z||F&&R))&&(x=f==="x"?E:k)}const $={x:h.x+w.x,y:h.y+w.y},T={x:p.x+M.x,y:p.y+M.y},P=Math.max(Math.abs($.x-x[0].x),Math.abs(T.x-x[0].x)),A=Math.max(Math.abs($.y-x[0].y),Math.abs(T.y-x[0].y));P>=A?(_=($.x+T.x)/2,v=x[0].y):(_=x[0].x,v=($.y+T.y)/2)}return[[e,{x:h.x+w.x,y:h.y+w.y},...x,{x:p.x+M.x,y:p.y+M.y},n],_,v,N,C]}function vT(e,t,n,s){const r=Math.min(lb(e,t)/2,lb(t,n)/2,s),{x:i,y:l}=t;if(e.x===i&&i===n.x||e.y===l&&l===n.y)return`L${i} ${l}`;if(e.y===l){const h=e.x<n.x?-1:1,p=e.y<n.y?1:-1;return`L ${i+r*h},${l}Q ${i},${l} ${i},${l+r*p}`}const u=e.x<n.x?1:-1,d=e.y<n.y?-1:1;return`L ${i},${l+r*d}Q ${i},${l} ${i+r*u},${l}`}function Rh({sourceX:e,sourceY:t,sourcePosition:n=Je.Bottom,targetX:s,targetY:r,targetPosition:i=Je.Top,borderRadius:l=5,centerX:u,centerY:d,offset:h=20,stepPosition:p=.5}){const[m,f,y,x,_]=yT({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:r},targetPosition:i,center:{x:u,y:d},offset:h,stepPosition:p});return[m.reduce((w,M,N)=>{let C="";return N>0&&N<m.length-1?C=vT(m[N-1],M,m[N+1],l):C=`${N===0?"M":"L"}${M.x} ${M.y}`,w+=C,w},""),f,y,x,_]}function cb(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function xT(e){var m;const{sourceNode:t,targetNode:n}=e;if(!cb(t)||!cb(n))return null;const s=t.internals.handleBounds||ub(t.handles),r=n.internals.handleBounds||ub(n.handles),i=db((s==null?void 0:s.source)??[],e.sourceHandle),l=db(e.connectionMode===Di.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!i||!l)return(m=e.onError)==null||m.call(e,"008",Rr.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const u=(i==null?void 0:i.position)||Je.Bottom,d=(l==null?void 0:l.position)||Je.Top,h=mc(t,i,u),p=mc(n,l,d);return{sourceX:h.x,sourceY:h.y,targetX:p.x,targetY:p.y,sourcePosition:u,targetPosition:d}}function ub(e){if(!e)return null;const t=[],n=[];for(const s of e)s.width=s.width??1,s.height=s.height??1,s.type==="source"?t.push(s):s.type==="target"&&n.push(s);return{source:t,target:n}}function mc(e,t,n=Je.Left,s=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:l,height:u}=t??Gr(e);if(s)return{x:r+l/2,y:i+u/2};switch((t==null?void 0:t.position)??n){case Je.Top:return{x:r+l/2,y:i};case Je.Right:return{x:r+l,y:i+u/2};case Je.Bottom:return{x:r+l/2,y:i+u};case Je.Left:return{x:r,y:i+u/2}}}function db(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Dh(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`:""}function bT(e,{id:t,defaultColor:n,defaultMarkerStart:s,defaultMarkerEnd:r}){const i=new Set;return e.reduce((l,u)=>([u.markerStart||s,u.markerEnd||r].forEach(d=>{if(d&&typeof d=="object"){const h=Dh(d,t);i.has(h)||(l.push({id:h,color:d.color||n,...d}),i.add(h))}}),l),[]).sort((l,u)=>l.id.localeCompare(u.id))}const mb=1e3,wT=10,zh={nodeOrigin:[0,0],nodeExtent:sc,elevateNodesOnSelect:!0,defaults:{}},NT={...zh,checkEquality:!0};function Ih(e,t){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}function jT(e,t,n){const s=Ih(zh,n);for(const r of e.values())if(r.parentId)Bh(r,e,t,s);else{const i=ac(r,s.nodeOrigin),l=Bi(r.extent)?r.extent:s.nodeExtent,u=Ro(i,l,Gr(r));r.internals.positionAbsolute=u}}function CT(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],s=[];for(const r of e.handles){const i={id:r.id,width:r.width??1,height:r.height??1,nodeId:e.id,x:r.x,y:r.y,position:r.position,type:r.type};r.type==="source"?n.push(i):r.type==="target"&&s.push(i)}return{source:n,target:s}}function Fh(e,t,n,s){var h,p;const r=Ih(NT,s);let i={i:-1},l=e.length>0;const u=new Map(t),d=r!=null&&r.elevateNodesOnSelect?mb:0;t.clear(),n.clear();for(const m of e){let f=u.get(m.id);if(r.checkEquality&&m===(f==null?void 0:f.internals.userNode))t.set(m.id,f);else{const y=ac(m,r.nodeOrigin),x=Bi(m.extent)?m.extent:r.nodeExtent,_=Ro(y,x,Gr(m));f={...r.defaults,...m,measured:{width:(h=m.measured)==null?void 0:h.width,height:(p=m.measured)==null?void 0:p.height},internals:{positionAbsolute:_,handleBounds:CT(m,f),z:fb(m,d),userNode:m}},t.set(m.id,f)}(f.measured===void 0||f.measured.width===void 0||f.measured.height===void 0)&&!f.hidden&&(l=!1),m.parentId&&Bh(f,t,n,s,i)}return l}function ST(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Bh(e,t,n,s,r){const{elevateNodesOnSelect:i,nodeOrigin:l,nodeExtent:u}=Ih(zh,s),d=e.parentId,h=t.get(d);if(!h){console.warn(`Parent node ${d} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}ST(e,n),r&&!h.parentId&&h.internals.rootParentIndex===void 0&&(h.internals.rootParentIndex=++r.i,h.internals.z=h.internals.z+r.i*wT),r&&h.internals.rootParentIndex!==void 0&&(r.i=h.internals.rootParentIndex);const p=i?mb:0,{x:m,y:f,z:y}=ET(e,h,l,u,p),{positionAbsolute:x}=e.internals,_=m!==x.x||f!==x.y;(_||y!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:_?{x:m,y:f}:x,z:y}})}function fb(e,t){return(_r(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function ET(e,t,n,s,r){const{x:i,y:l}=t.internals.positionAbsolute,u=Gr(e),d=ac(e,n),h=Bi(e.extent)?Ro(d,e.extent,u):d;let p=Ro({x:i+h.x,y:l+h.y},s,u);e.extent==="parent"&&(p=qx(p,u,t));const m=fb(e,r),f=t.internals.z??0;return{x:p.x,y:p.y,z:f>=m?f+1:m}}function Uh(e,t,n,s=[0,0]){var l;const r=[],i=new Map;for(const u of e){const d=t.get(u.parentId);if(!d)continue;const h=((l=i.get(u.parentId))==null?void 0:l.expandedRect)??Ii(d),p=Yx(h,u.rect);i.set(u.parentId,{expandedRect:p,parent:d})}return i.size>0&&i.forEach(({expandedRect:u,parent:d},h)=>{var N;const p=d.internals.positionAbsolute,m=Gr(d),f=d.origin??s,y=u.x<p.x?Math.round(Math.abs(p.x-u.x)):0,x=u.y<p.y?Math.round(Math.abs(p.y-u.y)):0,_=Math.max(m.width,Math.round(u.width)),v=Math.max(m.height,Math.round(u.height)),w=(_-m.width)*f[0],M=(v-m.height)*f[1];(y>0||x>0||w||M)&&(r.push({id:h,type:"position",position:{x:d.position.x-y+w,y:d.position.y-x+M}}),(N=n.get(h))==null||N.forEach(C=>{e.some(j=>j.id===C.id)||r.push({id:C.id,type:"position",position:{x:C.position.x+y,y:C.position.y+x}})})),(m.width<u.width||m.height<u.height||y||x)&&r.push({id:h,type:"dimensions",setAttributes:!0,dimensions:{width:_+(y?f[0]*y-w:0),height:v+(x?f[1]*x-M:0)}})}),r}function MT(e,t,n,s,r,i){const l=s==null?void 0:s.querySelector(".xyflow__viewport");let u=!1;if(!l)return{changes:[],updatedInternals:u};const d=[],h=window.getComputedStyle(l),{m22:p}=new window.DOMMatrixReadOnly(h.transform),m=[];for(const f of e.values()){const y=t.get(f.id);if(!y)continue;if(y.hidden){t.set(y.id,{...y,internals:{...y.internals,handleBounds:void 0}}),u=!0;continue}const x=Lh(f.nodeElement),_=y.measured.width!==x.width||y.measured.height!==x.height;if(!!(x.width&&x.height&&(_||!y.internals.handleBounds||f.force))){const w=f.nodeElement.getBoundingClientRect(),M=Bi(y.extent)?y.extent:i;let{positionAbsolute:N}=y.internals;y.parentId&&y.extent==="parent"?N=qx(N,x,t.get(y.parentId)):M&&(N=Ro(N,M,x));const C={...y,measured:x,internals:{...y.internals,positionAbsolute:N,handleBounds:{source:tb("source",f.nodeElement,w,p,y.id),target:tb("target",f.nodeElement,w,p,y.id)}}};t.set(y.id,C),y.parentId&&Bh(C,t,n,{nodeOrigin:r}),u=!0,_&&(d.push({id:y.id,type:"dimensions",dimensions:x}),y.expandParent&&y.parentId&&m.push({id:y.id,parentId:y.parentId,rect:Ii(C,r)}))}}if(m.length>0){const f=Uh(m,t,n,r);d.push(...f)}return{changes:d,updatedInternals:u}}async function kT({delta:e,panZoom:t,transform:n,translateExtent:s,width:r,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const l=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,i]],s),u=!!l&&(l.x!==n[0]||l.y!==n[1]||l.k!==n[2]);return Promise.resolve(u)}function hb(e,t,n,s,r,i){let l=r;const u=s.get(l)||new Map;s.set(l,u.set(n,t)),l=`${r}-${e}`;const d=s.get(l)||new Map;if(s.set(l,d.set(n,t)),i){l=`${r}-${e}-${i}`;const h=s.get(l)||new Map;s.set(l,h.set(n,t))}}function pb(e,t,n){e.clear(),t.clear();for(const s of n){const{source:r,target:i,sourceHandle:l=null,targetHandle:u=null}=s,d={edgeId:s.id,source:r,target:i,sourceHandle:l,targetHandle:u},h=`${r}-${l}--${i}-${u}`,p=`${i}-${u}--${r}-${l}`;hb("source",d,p,e,r,l),hb("target",d,h,e,i,u),t.set(s.id,s)}}function gb(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:gb(n,t):!1}function _b(e,t,n){var r;let s=e;do{if((r=s==null?void 0:s.matches)!=null&&r.call(s,t))return!0;if(s===n)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function AT(e,t,n,s){const r=new Map;for(const[i,l]of e)if((l.selected||l.id===s)&&(!l.parentId||!gb(l,e))&&(l.draggable||t&&typeof l.draggable>"u")){const u=e.get(i);u&&r.set(i,{id:i,position:u.position||{x:0,y:0},distance:{x:n.x-u.internals.positionAbsolute.x,y:n.y-u.internals.positionAbsolute.y},extent:u.extent,parentId:u.parentId,origin:u.origin,expandParent:u.expandParent,internals:{positionAbsolute:u.internals.positionAbsolute||{x:0,y:0}},measured:{width:u.measured.width??0,height:u.measured.height??0}})}return r}function Hh({nodeId:e,dragItems:t,nodeLookup:n,dragging:s=!0}){var l,u,d;const r=[];for(const[h,p]of t){const m=(l=n.get(h))==null?void 0:l.internals.userNode;m&&r.push({...m,position:p.position,dragging:s})}if(!e)return[r[0],r];const i=(u=n.get(e))==null?void 0:u.internals.userNode;return[i?{...i,position:((d=t.get(e))==null?void 0:d.position)||i.position,dragging:s}:r[0],r]}function OT({dragItems:e,snapGrid:t,x:n,y:s}){const r=e.values().next().value;if(!r)return null;const i={x:n-r.distance.x,y:s-r.distance.y},l=lc(i,t);return{x:l.x-i.x,y:l.y-i.y}}function TT({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:s,onDragStop:r}){let i={x:null,y:null},l=0,u=new Map,d=!1,h={x:0,y:0},p=null,m=!1,f=null,y=!1,x=!1,_=null;function v({noDragClassName:M,handleSelector:N,domNode:C,isSelectable:j,nodeId:E,nodeClickDistance:k=0}){f=vs(C);function $({x:D,y:F}){const{nodeLookup:R,nodeExtent:z,snapGrid:q,snapToGrid:V,nodeOrigin:U,onNodeDrag:W,onSelectionDrag:B,onError:I,updateNodePositions:H}=t();i={x:D,y:F};let J=!1;const G=u.size>1,Y=G&&z?$h(oc(u)):null,X=G&&V?OT({dragItems:u,snapGrid:q,x:D,y:F}):null;for(const[Z,ee]of u){if(!R.has(Z))continue;let Q={x:D-ee.distance.x,y:F-ee.distance.y};V&&(Q=X?{x:Math.round(Q.x+X.x),y:Math.round(Q.y+X.y)}:lc(Q,q));let ne=null;if(G&&z&&!ee.extent&&Y){const{positionAbsolute:ge}=ee.internals,Ee=ge.x-Y.x+z[0][0],De=ge.x+ee.measured.width-Y.x2+z[1][0],ke=ge.y-Y.y+z[0][1],le=ge.y+ee.measured.height-Y.y2+z[1][1];ne=[[Ee,ke],[De,le]]}const{position:he,positionAbsolute:ye}=Hx({nodeId:Z,nextPosition:Q,nodeLookup:R,nodeExtent:ne||z,nodeOrigin:U,onError:I});J=J||ee.position.x!==he.x||ee.position.y!==he.y,ee.position=he,ee.internals.positionAbsolute=ye}if(x=x||J,!!J&&(H(u,!0),_&&(s||W||!E&&B))){const[Z,ee]=Hh({nodeId:E,dragItems:u,nodeLookup:R});s==null||s(_,u,Z,ee),W==null||W(_,Z,ee),E||B==null||B(_,ee)}}async function T(){if(!p)return;const{transform:D,panBy:F,autoPanSpeed:R,autoPanOnNodeDrag:z}=t();if(!z){d=!1,cancelAnimationFrame(l);return}const[q,V]=Wx(h,p,R);(q!==0||V!==0)&&(i.x=(i.x??0)-q/D[2],i.y=(i.y??0)-V/D[2],await F({x:q,y:V})&&$(i)),l=requestAnimationFrame(T)}function P(D){var G;const{nodeLookup:F,multiSelectionActive:R,nodesDraggable:z,transform:q,snapGrid:V,snapToGrid:U,selectNodesOnDrag:W,onNodeDragStart:B,onSelectionDragStart:I,unselectNodesAndEdges:H}=t();m=!0,(!W||!j)&&!R&&E&&((G=F.get(E))!=null&&G.selected||H()),j&&W&&E&&(e==null||e(E));const J=dc(D.sourceEvent,{transform:q,snapGrid:V,snapToGrid:U,containerBounds:p});if(i=J,u=AT(F,z,J,E),u.size>0&&(n||B||!E&&I)){const[Y,X]=Hh({nodeId:E,dragItems:u,nodeLookup:F});n==null||n(D.sourceEvent,u,Y,X),B==null||B(D.sourceEvent,Y,X),E||I==null||I(D.sourceEvent,X)}}const A=Bf().clickDistance(k).on("start",D=>{const{domNode:F,nodeDragThreshold:R,transform:z,snapGrid:q,snapToGrid:V}=t();p=(F==null?void 0:F.getBoundingClientRect())||null,y=!1,x=!1,_=D.sourceEvent,R===0&&P(D),i=dc(D.sourceEvent,{transform:z,snapGrid:q,snapToGrid:V,containerBounds:p}),h=yr(D.sourceEvent,p)}).on("drag",D=>{const{autoPanOnNodeDrag:F,transform:R,snapGrid:z,snapToGrid:q,nodeDragThreshold:V,nodeLookup:U}=t(),W=dc(D.sourceEvent,{transform:R,snapGrid:z,snapToGrid:q,containerBounds:p});if(_=D.sourceEvent,(D.sourceEvent.type==="touchmove"&&D.sourceEvent.touches.length>1||E&&!U.has(E))&&(y=!0),!y){if(!d&&F&&m&&(d=!0,T()),!m){const B=yr(D.sourceEvent,p),I=B.x-h.x,H=B.y-h.y;Math.sqrt(I*I+H*H)>V&&P(D)}(i.x!==W.xSnapped||i.y!==W.ySnapped)&&u&&m&&(h=yr(D.sourceEvent,p),$(W))}}).on("end",D=>{if(!(!m||y)&&(d=!1,m=!1,cancelAnimationFrame(l),u.size>0)){const{nodeLookup:F,updateNodePositions:R,onNodeDragStop:z,onSelectionDragStop:q}=t();if(x&&(R(u,!1),x=!1),r||z||!E&&q){const[V,U]=Hh({nodeId:E,dragItems:u,nodeLookup:F,dragging:!1});r==null||r(D.sourceEvent,u,V,U),z==null||z(D.sourceEvent,V,U),E||q==null||q(D.sourceEvent,U)}}}).filter(D=>{const F=D.target;return!D.button&&(!M||!_b(F,`.${M}`,C))&&(!N||_b(F,N,C))});f.call(A)}function w(){f==null||f.on(".drag",null)}return{update:v,destroy:w}}function $T(e,t,n){const s=[],r={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())ic(r,Ii(i))>0&&s.push(i);return s}const PT=250;function LT(e,t,n,s){var u,d;let r=[],i=1/0;const l=$T(e,n,t+PT);for(const h of l){const p=[...((u=h.internals.handleBounds)==null?void 0:u.source)??[],...((d=h.internals.handleBounds)==null?void 0:d.target)??[]];for(const m of p){if(s.nodeId===m.nodeId&&s.type===m.type&&s.id===m.id)continue;const{x:f,y}=mc(h,m,m.position,!0),x=Math.sqrt(Math.pow(f-e.x,2)+Math.pow(y-e.y,2));x>t||(x<i?(r=[{...m,x:f,y}],i=x):x===i&&r.push({...m,x:f,y}))}}if(!r.length)return null;if(r.length>1){const h=s.type==="source"?"target":"source";return r.find(p=>p.type===h)??r[0]}return r[0]}function yb(e,t,n,s,r,i=!1){var h,p,m;const l=s.get(e);if(!l)return null;const u=r==="strict"?(h=l.internals.handleBounds)==null?void 0:h[t]:[...((p=l.internals.handleBounds)==null?void 0:p.source)??[],...((m=l.internals.handleBounds)==null?void 0:m.target)??[]],d=(n?u==null?void 0:u.find(f=>f.id===n):u==null?void 0:u[0])??null;return d&&i?{...d,...mc(l,d,d.position,!0)}:d}function vb(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function RT(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const xb=()=>!0;function DT(e,{connectionMode:t,connectionRadius:n,handleId:s,nodeId:r,edgeUpdaterType:i,isTarget:l,domNode:u,nodeLookup:d,lib:h,autoPanOnConnect:p,flowId:m,panBy:f,cancelConnection:y,onConnectStart:x,onConnect:_,onConnectEnd:v,isValidConnection:w=xb,onReconnectEnd:M,updateConnection:N,getTransform:C,getFromHandle:j,autoPanSpeed:E,dragThreshold:k=1,handleDomNode:$}){const T=Zx(e.target);let P=0,A;const{x:D,y:F}=yr(e),R=vb(i,$),z=u==null?void 0:u.getBoundingClientRect();let q=!1;if(!z||!R)return;const V=yb(r,R,s,d,t);if(!V)return;let U=yr(e,z),W=!1,B=null,I=!1,H=null;function J(){if(!p||!z)return;const[he,ye]=Wx(U,z,E);f({x:he,y:ye}),P=requestAnimationFrame(J)}const G={...V,nodeId:r,type:R,position:V.position},Y=d.get(r);let Z={inProgress:!0,isValid:null,from:mc(Y,G,Je.Left,!0),fromHandle:G,fromPosition:G.position,fromNode:Y,to:U,toHandle:null,toPosition:Fx[G.position],toNode:null,pointer:U};function ee(){q=!0,N(Z),x==null||x(e,{nodeId:r,handleId:s,handleType:R})}k===0&&ee();function Q(he){if(!q){const{x:De,y:ke}=yr(he),le=De-D,pe=ke-F;if(!(le*le+pe*pe>k*k))return;ee()}if(!j()||!G){ne(he);return}const ye=C();U=yr(he,z),A=LT(cc(U,ye,!1,[1,1]),n,d,G),W||(J(),W=!0);const ge=bb(he,{handle:A,connectionMode:t,fromNodeId:r,fromHandleId:s,fromType:l?"target":"source",isValidConnection:w,doc:T,lib:h,flowId:m,nodeLookup:d});H=ge.handleDomNode,B=ge.connection,I=RT(!!A,ge.isValid);const Ee={...Z,isValid:I,to:ge.toHandle&&I?ud({x:ge.toHandle.x,y:ge.toHandle.y},ye):U,toHandle:ge.toHandle,toPosition:I&&ge.toHandle?ge.toHandle.position:Fx[G.position],toNode:ge.toHandle?d.get(ge.toHandle.nodeId):null,pointer:U};N(Ee),Z=Ee}function ne(he){if(!("touches"in he&&he.touches.length>0)){if(q){(A||H)&&B&&I&&(_==null||_(B));const{inProgress:ye,...ge}=Z,Ee={...ge,toPosition:Z.toHandle?Z.toPosition:null};v==null||v(he,Ee),i&&(M==null||M(he,Ee))}y(),cancelAnimationFrame(P),W=!1,I=!1,B=null,H=null,T.removeEventListener("mousemove",Q),T.removeEventListener("mouseup",ne),T.removeEventListener("touchmove",Q),T.removeEventListener("touchend",ne)}}T.addEventListener("mousemove",Q),T.addEventListener("mouseup",ne),T.addEventListener("touchmove",Q),T.addEventListener("touchend",ne)}function bb(e,{handle:t,connectionMode:n,fromNodeId:s,fromHandleId:r,fromType:i,doc:l,lib:u,flowId:d,isValidConnection:h=xb,nodeLookup:p}){const m=i==="target",f=t?l.querySelector(`.${u}-flow__handle[data-id="${d}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:y,y:x}=yr(e),_=l.elementFromPoint(y,x),v=_!=null&&_.classList.contains(`${u}-flow__handle`)?_:f,w={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const M=vb(void 0,v),N=v.getAttribute("data-nodeid"),C=v.getAttribute("data-handleid"),j=v.classList.contains("connectable"),E=v.classList.contains("connectableend");if(!N||!M)return w;const k={source:m?N:s,sourceHandle:m?C:r,target:m?s:N,targetHandle:m?r:C};w.connection=k;const T=j&&E&&(n===Di.Strict?m&&M==="source"||!m&&M==="target":N!==s||C!==r);w.isValid=T&&h(k),w.toHandle=yb(N,M,C,p,n,!0)}return w}const qh={onPointerDown:DT,isValid:bb};function zT({domNode:e,panZoom:t,getTransform:n,getViewScale:s}){const r=vs(e);function i({translateExtent:u,width:d,height:h,zoomStep:p=1,pannable:m=!0,zoomable:f=!0,inversePan:y=!1}){const x=N=>{if(N.sourceEvent.type!=="wheel"||!t)return;const C=n(),j=N.sourceEvent.ctrlKey&&uc()?10:1,E=-N.sourceEvent.deltaY*(N.sourceEvent.deltaMode===1?.05:N.sourceEvent.deltaMode?1:.002)*p,k=C[2]*Math.pow(2,E*j);t.scaleTo(k)};let _=[0,0];const v=N=>{(N.sourceEvent.type==="mousedown"||N.sourceEvent.type==="touchstart")&&(_=[N.sourceEvent.clientX??N.sourceEvent.touches[0].clientX,N.sourceEvent.clientY??N.sourceEvent.touches[0].clientY])},w=N=>{const C=n();if(N.sourceEvent.type!=="mousemove"&&N.sourceEvent.type!=="touchmove"||!t)return;const j=[N.sourceEvent.clientX??N.sourceEvent.touches[0].clientX,N.sourceEvent.clientY??N.sourceEvent.touches[0].clientY],E=[j[0]-_[0],j[1]-_[1]];_=j;const k=s()*Math.max(C[2],Math.log(C[2]))*(y?-1:1),$={x:C[0]-E[0]*k,y:C[1]-E[1]*k},T=[[0,0],[d,h]];t.setViewportConstrained({x:$.x,y:$.y,zoom:C[2]},T,u)},M=nh().on("start",v).on("zoom",m?w:null).on("zoom.wheel",f?x:null);r.call(M,{})}function l(){r.on("zoom",null)}return{update:i,destroy:l,pointer:rr}}const md=e=>({x:e.x,y:e.y,zoom:e.k}),Vh=({x:e,y:t,zoom:n})=>Kr.translate(e,t).scale(n),Ui=(e,t)=>e.target.closest(`.${t}`),wb=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),IT=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Wh=(e,t=0,n=IT,s=()=>{})=>{const r=typeof t=="number"&&t>0;return r||s(),r?e.transition().duration(t).ease(n).on("end",s):e},Nb=e=>{const t=e.ctrlKey&&uc()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function FT({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:s,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:l,onPanZoomStart:u,onPanZoom:d,onPanZoomEnd:h}){return p=>{if(Ui(p,t))return p.ctrlKey&&p.preventDefault(),!1;p.preventDefault(),p.stopImmediatePropagation();const m=n.property("__zoom").k||1;if(p.ctrlKey&&l){const v=rr(p),w=Nb(p),M=m*Math.pow(2,w);s.scaleTo(n,M,v,p);return}const f=p.deltaMode===1?20:1;let y=r===Lo.Vertical?0:p.deltaX*f,x=r===Lo.Horizontal?0:p.deltaY*f;!uc()&&p.shiftKey&&r!==Lo.Vertical&&(y=p.deltaY*f,x=0),s.translateBy(n,-(y/m)*i,-(x/m)*i,{internal:!0});const _=md(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(d==null||d(p,_),e.panScrollTimeout=setTimeout(()=>{h==null||h(p,_),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,u==null||u(p,_))}}function BT({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(s,r){const i=s.type==="wheel",l=!t&&i&&!s.ctrlKey,u=Ui(s,e);if(s.ctrlKey&&i&&u&&s.preventDefault(),l||u)return null;s.preventDefault(),n.call(this,s,r)}}function UT({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return s=>{var i,l,u;if((i=s.sourceEvent)!=null&&i.internal)return;const r=md(s.transform);e.mouseButton=((l=s.sourceEvent)==null?void 0:l.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((u=s.sourceEvent)==null?void 0:u.type)==="mousedown"&&t(!0),n&&(n==null||n(s.sourceEvent,r))}}function HT({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:s,onPanZoom:r}){return i=>{var l,u;e.usedRightMouseButton=!!(n&&wb(t,e.mouseButton??0)),(l=i.sourceEvent)!=null&&l.sync||s([i.transform.x,i.transform.y,i.transform.k]),r&&!((u=i.sourceEvent)!=null&&u.internal)&&(r==null||r(i.sourceEvent,md(i.transform)))}}function qT({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:s,onPanZoomEnd:r,onPaneContextMenu:i}){return l=>{var u;if(!((u=l.sourceEvent)!=null&&u.internal)&&(e.isZoomingOrPanning=!1,i&&wb(t,e.mouseButton??0)&&!e.usedRightMouseButton&&l.sourceEvent&&i(l.sourceEvent),e.usedRightMouseButton=!1,s(!1),r)){const d=md(l.transform);e.prevViewport=d,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(l.sourceEvent,d)},n?150:0)}}}function VT({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:s,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:l,noWheelClassName:u,noPanClassName:d,lib:h,connectionInProgress:p}){return m=>{var v;const f=e||t,y=n&&m.ctrlKey,x=m.type==="wheel";if(m.button===1&&m.type==="mousedown"&&(Ui(m,`${h}-flow__node`)||Ui(m,`${h}-flow__edge`)))return!0;if(!s&&!f&&!r&&!i&&!n||l||p&&!x||Ui(m,u)&&x||Ui(m,d)&&(!x||r&&x&&!e)||!n&&m.ctrlKey&&x)return!1;if(!n&&m.type==="touchstart"&&((v=m.touches)==null?void 0:v.length)>1)return m.preventDefault(),!1;if(!f&&!r&&!y&&x||!s&&(m.type==="mousedown"||m.type==="touchstart")||Array.isArray(s)&&!s.includes(m.button)&&m.type==="mousedown")return!1;const _=Array.isArray(s)&&s.includes(m.button)||!m.button||m.button<=1;return(!m.ctrlKey||x)&&_}}function WT({domNode:e,minZoom:t,maxZoom:n,translateExtent:s,viewport:r,onPanZoom:i,onPanZoomStart:l,onPanZoomEnd:u,onDraggingChange:d}){const h={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},p=e.getBoundingClientRect(),m=nh().scaleExtent([t,n]).translateExtent(s),f=vs(e).call(m);M({x:r.x,y:r.y,zoom:zi(r.zoom,t,n)},[[0,0],[p.width,p.height]],s);const y=f.on("wheel.zoom"),x=f.on("dblclick.zoom");m.wheelDelta(Nb);function _(A,D){return f?new Promise(F=>{m==null||m.interpolate((D==null?void 0:D.interpolate)==="linear"?Vl:Du).transform(Wh(f,D==null?void 0:D.duration,D==null?void 0:D.ease,()=>F(!0)),A)}):Promise.resolve(!1)}function v({noWheelClassName:A,noPanClassName:D,onPaneContextMenu:F,userSelectionActive:R,panOnScroll:z,panOnDrag:q,panOnScrollMode:V,panOnScrollSpeed:U,preventScrolling:W,zoomOnPinch:B,zoomOnScroll:I,zoomOnDoubleClick:H,zoomActivationKeyPressed:J,lib:G,onTransformChange:Y,connectionInProgress:X,paneClickDistance:Z,selectionOnDrag:ee}){R&&!h.isZoomingOrPanning&&w();const Q=z&&!J&&!R;m.clickDistance(ee?1/0:!_r(Z)||Z<0?0:Z);const ne=Q?FT({zoomPanValues:h,noWheelClassName:A,d3Selection:f,d3Zoom:m,panOnScrollMode:V,panOnScrollSpeed:U,zoomOnPinch:B,onPanZoomStart:l,onPanZoom:i,onPanZoomEnd:u}):BT({noWheelClassName:A,preventScrolling:W,d3ZoomHandler:y});if(f.on("wheel.zoom",ne,{passive:!1}),!R){const ye=UT({zoomPanValues:h,onDraggingChange:d,onPanZoomStart:l});m.on("start",ye);const ge=HT({zoomPanValues:h,panOnDrag:q,onPaneContextMenu:!!F,onPanZoom:i,onTransformChange:Y});m.on("zoom",ge);const Ee=qT({zoomPanValues:h,panOnDrag:q,panOnScroll:z,onPaneContextMenu:F,onPanZoomEnd:u,onDraggingChange:d});m.on("end",Ee)}const he=VT({zoomActivationKeyPressed:J,panOnDrag:q,zoomOnScroll:I,panOnScroll:z,zoomOnDoubleClick:H,zoomOnPinch:B,userSelectionActive:R,noPanClassName:D,noWheelClassName:A,lib:G,connectionInProgress:X});m.filter(he),H?f.on("dblclick.zoom",x):f.on("dblclick.zoom",null)}function w(){m.on("zoom",null)}async function M(A,D,F){const R=Vh(A),z=m==null?void 0:m.constrain()(R,D,F);return z&&await _(z),new Promise(q=>q(z))}async function N(A,D){const F=Vh(A);return await _(F,D),new Promise(R=>R(F))}function C(A){if(f){const D=Vh(A),F=f.property("__zoom");(F.k!==A.zoom||F.x!==A.x||F.y!==A.y)&&(m==null||m.transform(f,D,null,{sync:!0}))}}function j(){const A=f?Zy(f.node()):{x:0,y:0,k:1};return{x:A.x,y:A.y,zoom:A.k}}function E(A,D){return f?new Promise(F=>{m==null||m.interpolate((D==null?void 0:D.interpolate)==="linear"?Vl:Du).scaleTo(Wh(f,D==null?void 0:D.duration,D==null?void 0:D.ease,()=>F(!0)),A)}):Promise.resolve(!1)}function k(A,D){return f?new Promise(F=>{m==null||m.interpolate((D==null?void 0:D.interpolate)==="linear"?Vl:Du).scaleBy(Wh(f,D==null?void 0:D.duration,D==null?void 0:D.ease,()=>F(!0)),A)}):Promise.resolve(!1)}function $(A){m==null||m.scaleExtent(A)}function T(A){m==null||m.translateExtent(A)}function P(A){const D=!_r(A)||A<0?0:A;m==null||m.clickDistance(D)}return{update:v,destroy:w,setViewport:N,setViewportConstrained:M,getViewport:j,scaleTo:E,scaleBy:k,setScaleExtent:$,setTranslateExtent:T,syncViewport:C,setClickDistance:P}}var Hi;(function(e){e.Line="line",e.Handle="handle"})(Hi||(Hi={}));function YT({width:e,prevWidth:t,height:n,prevHeight:s,affectsX:r,affectsY:i}){const l=e-t,u=n-s,d=[l>0?1:l<0?-1:0,u>0?1:u<0?-1:0];return l&&r&&(d[0]=d[0]*-1),u&&i&&(d[1]=d[1]*-1),d}function jb(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),s=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:s,affectsY:r}}function Ca(e,t){return Math.max(0,t-e)}function Sa(e,t){return Math.max(0,e-t)}function fd(e,t,n){return Math.max(0,t-e,e-n)}function Cb(e,t){return e?!t:t}function KT(e,t,n,s,r,i,l,u){let{affectsX:d,affectsY:h}=t;const{isHorizontal:p,isVertical:m}=t,f=p&&m,{xSnapped:y,ySnapped:x}=n,{minWidth:_,maxWidth:v,minHeight:w,maxHeight:M}=s,{x:N,y:C,width:j,height:E,aspectRatio:k}=e;let $=Math.floor(p?y-e.pointerX:0),T=Math.floor(m?x-e.pointerY:0);const P=j+(d?-$:$),A=E+(h?-T:T),D=-i[0]*j,F=-i[1]*E;let R=fd(P,_,v),z=fd(A,w,M);if(l){let U=0,W=0;d&&$<0?U=Ca(N+$+D,l[0][0]):!d&&$>0&&(U=Sa(N+P+D,l[1][0])),h&&T<0?W=Ca(C+T+F,l[0][1]):!h&&T>0&&(W=Sa(C+A+F,l[1][1])),R=Math.max(R,U),z=Math.max(z,W)}if(u){let U=0,W=0;d&&$>0?U=Sa(N+$,u[0][0]):!d&&$<0&&(U=Ca(N+P,u[1][0])),h&&T>0?W=Sa(C+T,u[0][1]):!h&&T<0&&(W=Ca(C+A,u[1][1])),R=Math.max(R,U),z=Math.max(z,W)}if(r){if(p){const U=fd(P/k,w,M)*k;if(R=Math.max(R,U),l){let W=0;!d&&!h||d&&!h&&f?W=Sa(C+F+P/k,l[1][1])*k:W=Ca(C+F+(d?$:-$)/k,l[0][1])*k,R=Math.max(R,W)}if(u){let W=0;!d&&!h||d&&!h&&f?W=Ca(C+P/k,u[1][1])*k:W=Sa(C+(d?$:-$)/k,u[0][1])*k,R=Math.max(R,W)}}if(m){const U=fd(A*k,_,v)/k;if(z=Math.max(z,U),l){let W=0;!d&&!h||h&&!d&&f?W=Sa(N+A*k+D,l[1][0])/k:W=Ca(N+(h?T:-T)*k+D,l[0][0])/k,z=Math.max(z,W)}if(u){let W=0;!d&&!h||h&&!d&&f?W=Ca(N+A*k,u[1][0])/k:W=Sa(N+(h?T:-T)*k,u[0][0])/k,z=Math.max(z,W)}}}T=T+(T<0?z:-z),$=$+($<0?R:-R),r&&(f?P>A*k?T=(Cb(d,h)?-$:$)/k:$=(Cb(d,h)?-T:T)*k:p?(T=$/k,h=d):($=T*k,d=h));const q=d?N+$:N,V=h?C+T:C;return{width:j+(d?-$:$),height:E+(h?-T:T),x:i[0]*$*(d?-1:1)+q,y:i[1]*T*(h?-1:1)+V}}const Sb={width:0,height:0,x:0,y:0},GT={...Sb,pointerX:0,pointerY:0,aspectRatio:1};function XT(e){return[[0,0],[e.measured.width,e.measured.height]]}function QT(e,t,n){const s=t.position.x+e.position.x,r=t.position.y+e.position.y,i=e.measured.width??0,l=e.measured.height??0,u=n[0]*i,d=n[1]*l;return[[s-u,r-d],[s+i-u,r+l-d]]}function ZT({domNode:e,nodeId:t,getStoreItems:n,onChange:s,onEnd:r}){const i=vs(e);let l={controlDirection:jb("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function u({controlPosition:h,boundaries:p,keepAspectRatio:m,resizeDirection:f,onResizeStart:y,onResize:x,onResizeEnd:_,shouldResize:v}){let w={...Sb},M={...GT};l={boundaries:p,resizeDirection:f,keepAspectRatio:m,controlDirection:jb(h)};let N,C=null,j=[],E,k,$,T=!1;const P=Bf().on("start",A=>{const{nodeLookup:D,transform:F,snapGrid:R,snapToGrid:z,nodeOrigin:q,paneDomNode:V}=n();if(N=D.get(t),!N)return;C=(V==null?void 0:V.getBoundingClientRect())??null;const{xSnapped:U,ySnapped:W}=dc(A.sourceEvent,{transform:F,snapGrid:R,snapToGrid:z,containerBounds:C});w={width:N.measured.width??0,height:N.measured.height??0,x:N.position.x??0,y:N.position.y??0},M={...w,pointerX:U,pointerY:W,aspectRatio:w.width/w.height},E=void 0,N.parentId&&(N.extent==="parent"||N.expandParent)&&(E=D.get(N.parentId),k=E&&N.extent==="parent"?XT(E):void 0),j=[],$=void 0;for(const[B,I]of D)if(I.parentId===t&&(j.push({id:B,position:{...I.position},extent:I.extent}),I.extent==="parent"||I.expandParent)){const H=QT(I,N,I.origin??q);$?$=[[Math.min(H[0][0],$[0][0]),Math.min(H[0][1],$[0][1])],[Math.max(H[1][0],$[1][0]),Math.max(H[1][1],$[1][1])]]:$=H}y==null||y(A,{...w})}).on("drag",A=>{const{transform:D,snapGrid:F,snapToGrid:R,nodeOrigin:z}=n(),q=dc(A.sourceEvent,{transform:D,snapGrid:F,snapToGrid:R,containerBounds:C}),V=[];if(!N)return;const{x:U,y:W,width:B,height:I}=w,H={},J=N.origin??z,{width:G,height:Y,x:X,y:Z}=KT(M,l.controlDirection,q,l.boundaries,l.keepAspectRatio,J,k,$),ee=G!==B,Q=Y!==I,ne=X!==U&&ee,he=Z!==W&&Q;if(!ne&&!he&&!ee&&!Q)return;if((ne||he||J[0]===1||J[1]===1)&&(H.x=ne?X:w.x,H.y=he?Z:w.y,w.x=H.x,w.y=H.y,j.length>0)){const De=X-U,ke=Z-W;for(const le of j)le.position={x:le.position.x-De+J[0]*(G-B),y:le.position.y-ke+J[1]*(Y-I)},V.push(le)}if((ee||Q)&&(H.width=ee&&(!l.resizeDirection||l.resizeDirection==="horizontal")?G:w.width,H.height=Q&&(!l.resizeDirection||l.resizeDirection==="vertical")?Y:w.height,w.width=H.width,w.height=H.height),E&&N.expandParent){const De=J[0]*(H.width??0);H.x&&H.x<De&&(w.x=De,M.x=M.x-(H.x-De));const ke=J[1]*(H.height??0);H.y&&H.y<ke&&(w.y=ke,M.y=M.y-(H.y-ke))}const ye=YT({width:w.width,prevWidth:B,height:w.height,prevHeight:I,affectsX:l.controlDirection.affectsX,affectsY:l.controlDirection.affectsY}),ge={...w,direction:ye};(v==null?void 0:v(A,ge))!==!1&&(T=!0,x==null||x(A,ge),s(H,V))}).on("end",A=>{T&&(_==null||_(A,{...w}),r==null||r({...w}),T=!1)});i.call(P)}function d(){i.on(".drag",null)}return{update:u,destroy:d}}var Eb={exports:{}},Yh={},Kh={exports:{}},Gh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mb;function JT(){if(Mb)return Gh;Mb=1;var e=b;function t(m,f){return m===f&&(m!==0||1/m===1/f)||m!==m&&f!==f}var n=typeof Object.is=="function"?Object.is:t,s=e.useState,r=e.useEffect,i=e.useLayoutEffect,l=e.useDebugValue;function u(m,f){var y=f(),x=s({inst:{value:y,getSnapshot:f}}),_=x[0].inst,v=x[1];return i(function(){_.value=y,_.getSnapshot=f,d(_)&&v({inst:_})},[m,y,f]),r(function(){return d(_)&&v({inst:_}),m(function(){d(_)&&v({inst:_})})},[m]),l(y),y}function d(m){var f=m.getSnapshot;m=m.value;try{var y=f();return!n(m,y)}catch{return!0}}function h(m,f){return f()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?h:u;return Gh.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:p,Gh}var kb;function e$(){return kb||(kb=1,Kh.exports=JT()),Kh.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ab;function t$(){if(Ab)return Yh;Ab=1;var e=b,t=e$();function n(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var s=typeof Object.is=="function"?Object.is:n,r=t.useSyncExternalStore,i=e.useRef,l=e.useEffect,u=e.useMemo,d=e.useDebugValue;return Yh.useSyncExternalStoreWithSelector=function(h,p,m,f,y){var x=i(null);if(x.current===null){var _={hasValue:!1,value:null};x.current=_}else _=x.current;x=u(function(){function w(E){if(!M){if(M=!0,N=E,E=f(E),y!==void 0&&_.hasValue){var k=_.value;if(y(k,E))return C=k}return C=E}if(k=C,s(N,E))return k;var $=f(E);return y!==void 0&&y(k,$)?(N=E,k):(N=E,C=$)}var M=!1,N,C,j=m===void 0?null:m;return[function(){return w(p())},j===null?void 0:function(){return w(j())}]},[p,m,f,y]);var v=r(h,x[0],x[1]);return l(function(){_.hasValue=!0,_.value=v},[v]),d(v),v},Yh}Eb.exports=t$();var n$=Eb.exports;const s$=un(n$),r$={},Ob=e=>{let t;const n=new Set,s=(p,m)=>{const f=typeof p=="function"?p(t):p;if(!Object.is(f,t)){const y=t;t=m??(typeof f!="object"||f===null)?f:Object.assign({},t,f),n.forEach(x=>x(t,y))}},r=()=>t,d={setState:s,getState:r,getInitialState:()=>h,subscribe:p=>(n.add(p),()=>n.delete(p)),destroy:()=>{(r$?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},h=t=e(s,r,d);return d},a$=e=>e?Ob(e):Ob,{useDebugValue:o$}=ve,{useSyncExternalStoreWithSelector:i$}=s$,l$=e=>e;function Tb(e,t=l$,n){const s=i$(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return o$(s),s}const $b=(e,t)=>{const n=a$(e),s=(r,i=t)=>Tb(n,r,i);return Object.assign(s,n),s},c$=(e,t)=>e?$b(e,t):$b;function dn(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,r]of e)if(!Object.is(r,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const hd=b.createContext(null),u$=hd.Provider,Pb=Rr.error001();function St(e,t){const n=b.useContext(hd);if(n===null)throw new Error(Pb);return Tb(n,e,t)}function tn(){const e=b.useContext(hd);if(e===null)throw new Error(Pb);return b.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Lb={display:"none"},d$={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Rb="react-flow__node-desc",Db="react-flow__edge-desc",m$="react-flow__aria-live",f$=e=>e.ariaLiveMessage,h$=e=>e.ariaLabelConfig;function p$({rfId:e}){const t=St(f$);return o.jsx("div",{id:`${m$}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:d$,children:t})}function g$({rfId:e,disableKeyboardA11y:t}){const n=St(h$);return o.jsxs(o.Fragment,{children:[o.jsx("div",{id:`${Rb}-${e}`,style:Lb,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),o.jsx("div",{id:`${Db}-${e}`,style:Lb,children:n["edge.a11yDescription.default"]}),!t&&o.jsx(p$,{rfId:e})]})}const pd=b.forwardRef(({position:e="top-left",children:t,className:n,style:s,...r},i)=>{const l=`${e}`.split("-");return o.jsx("div",{className:Lt(["react-flow__panel",n,...l]),style:s,ref:i,...r,children:t})});pd.displayName="Panel";function _$({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:o.jsx(pd,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:o.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const y$=e=>{const t=[],n=[];for(const[,s]of e.nodeLookup)s.selected&&t.push(s.internals.userNode);for(const[,s]of e.edgeLookup)s.selected&&n.push(s);return{selectedNodes:t,selectedEdges:n}},gd=e=>e.id;function v$(e,t){return dn(e.selectedNodes.map(gd),t.selectedNodes.map(gd))&&dn(e.selectedEdges.map(gd),t.selectedEdges.map(gd))}function x$({onSelectionChange:e}){const t=tn(),{selectedNodes:n,selectedEdges:s}=St(y$,v$);return b.useEffect(()=>{const r={nodes:n,edges:s};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(i=>i(r))},[n,s,e]),null}const b$=e=>!!e.onSelectionChangeHandlers;function w$({onSelectionChange:e}){const t=St(b$);return e||t?o.jsx(x$,{onSelectionChange:e}):null}const zb=[0,0],N$={x:0,y:0,zoom:1},Ib=[...["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig"],"rfId"],j$=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Fb={translateExtent:sc,nodeOrigin:zb,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function C$(e){const{setNodes:t,setEdges:n,setMinZoom:s,setMaxZoom:r,setTranslateExtent:i,setNodeExtent:l,reset:u,setDefaultNodesAndEdges:d}=St(j$,dn),h=tn();b.useEffect(()=>(d(e.defaultNodes,e.defaultEdges),()=>{p.current=Fb,u()}),[]);const p=b.useRef(Fb);return b.useEffect(()=>{for(const m of Ib){const f=e[m],y=p.current[m];f!==y&&(typeof e[m]>"u"||(m==="nodes"?t(f):m==="edges"?n(f):m==="minZoom"?s(f):m==="maxZoom"?r(f):m==="translateExtent"?i(f):m==="nodeExtent"?l(f):m==="ariaLabelConfig"?h.setState({ariaLabelConfig:uT(f)}):m==="fitView"?h.setState({fitViewQueued:f}):m==="fitViewOptions"?h.setState({fitViewOptions:f}):h.setState({[m]:f})))}p.current=e},Ib.map(m=>e[m])),null}function Bb(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function S$(e){var s;const[t,n]=b.useState(e==="system"?null:e);return b.useEffect(()=>{if(e!=="system"){n(e);return}const r=Bb(),i=()=>n(r!=null&&r.matches?"dark":"light");return i(),r==null||r.addEventListener("change",i),()=>{r==null||r.removeEventListener("change",i)}},[e]),t!==null?t:(s=Bb())!=null&&s.matches?"dark":"light"}const Ub=typeof document<"u"?document:null;function fc(e=null,t={target:Ub,actInsideInputWithModifier:!0}){const[n,s]=b.useState(!1),r=b.useRef(!1),i=b.useRef(new Set([])),[l,u]=b.useMemo(()=>{if(e!==null){const h=(Array.isArray(e)?e:[e]).filter(m=>typeof m=="string").map(m=>m.replace("+",`
`).replace(`

`,`
+`).split(`
`)),p=h.reduce((m,f)=>m.concat(...f),[]);return[h,p]}return[[],[]]},[e]);return b.useEffect(()=>{const d=(t==null?void 0:t.target)??Ub,h=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const p=y=>{var v,w;if(r.current=y.ctrlKey||y.metaKey||y.shiftKey||y.altKey,(!r.current||r.current&&!h)&&Jx(y))return!1;const _=qb(y.code,u);if(i.current.add(y[_]),Hb(l,i.current,!1)){const M=((w=(v=y.composedPath)==null?void 0:v.call(y))==null?void 0:w[0])||y.target,N=(M==null?void 0:M.nodeName)==="BUTTON"||(M==null?void 0:M.nodeName)==="A";t.preventDefault!==!1&&(r.current||!N)&&y.preventDefault(),s(!0)}},m=y=>{const x=qb(y.code,u);Hb(l,i.current,!0)?(s(!1),i.current.clear()):i.current.delete(y[x]),y.key==="Meta"&&i.current.clear(),r.current=!1},f=()=>{i.current.clear(),s(!1)};return d==null||d.addEventListener("keydown",p),d==null||d.addEventListener("keyup",m),window.addEventListener("blur",f),window.addEventListener("contextmenu",f),()=>{d==null||d.removeEventListener("keydown",p),d==null||d.removeEventListener("keyup",m),window.removeEventListener("blur",f),window.removeEventListener("contextmenu",f)}}},[e,s]),n}function Hb(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(r=>t.has(r)))}function qb(e,t){return t.includes(e)?"code":"key"}const E$=()=>{const e=tn();return b.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:s}=e.getState();return s?s.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[s,r,i],panZoom:l}=e.getState();return l?(await l.setViewport({x:t.x??s,y:t.y??r,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,s]=e.getState().transform;return{x:t,y:n,zoom:s}},setCenter:async(t,n,s)=>e.getState().setCenter(t,n,s),fitBounds:async(t,n)=>{const{width:s,height:r,minZoom:i,maxZoom:l,panZoom:u}=e.getState(),d=Ph(t,s,r,i,l,(n==null?void 0:n.padding)??.1);return u?(await u.setViewport(d,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:s,snapGrid:r,snapToGrid:i,domNode:l}=e.getState();if(!l)return t;const{x:u,y:d}=l.getBoundingClientRect(),h={x:t.x-u,y:t.y-d},p=n.snapGrid??r,m=n.snapToGrid??i;return cc(h,s,m,p)},flowToScreenPosition:t=>{const{transform:n,domNode:s}=e.getState();if(!s)return t;const{x:r,y:i}=s.getBoundingClientRect(),l=ud(t,n);return{x:l.x+r,y:l.y+i}}}),[])};function Vb(e,t){const n=[],s=new Map,r=[];for(const i of e)if(i.type==="add"){r.push(i);continue}else if(i.type==="remove"||i.type==="replace")s.set(i.id,[i]);else{const l=s.get(i.id);l?l.push(i):s.set(i.id,[i])}for(const i of t){const l=s.get(i.id);if(!l){n.push(i);continue}if(l[0].type==="remove")continue;if(l[0].type==="replace"){n.push({...l[0].item});continue}const u={...i};for(const d of l)M$(d,u);n.push(u)}return r.length&&r.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function M$(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function k$(e,t){return Vb(e,t)}function A$(e,t){return Vb(e,t)}function Do(e,t){return{id:e,type:"select",selected:t}}function qi(e,t=new Set,n=!1){const s=[];for(const[r,i]of e){const l=t.has(r);!(i.selected===void 0&&!l)&&i.selected!==l&&(n&&(i.selected=l),s.push(Do(i.id,l)))}return s}function Wb({items:e=[],lookup:t}){var r;const n=[],s=new Map(e.map(i=>[i.id,i]));for(const[i,l]of e.entries()){const u=t.get(l.id),d=((r=u==null?void 0:u.internals)==null?void 0:r.userNode)??u;d!==void 0&&d!==l&&n.push({id:l.id,item:l,type:"replace"}),d===void 0&&n.push({item:l,type:"add",index:i})}for(const[i]of t)s.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function Yb(e){return{id:e.id,type:"remove"}}const Kb=e=>eT(e),O$=e=>Ux(e);function Gb(e){return b.forwardRef(e)}const T$=typeof window<"u"?b.useLayoutEffect:b.useEffect;function Xb(e){const[t,n]=b.useState(BigInt(0)),[s]=b.useState(()=>$$(()=>n(r=>r+BigInt(1))));return T$(()=>{const r=s.get();r.length&&(e(r),s.reset())},[t]),s}function $$(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Qb=b.createContext(null);function P$({children:e}){const t=tn(),n=b.useCallback(u=>{const{nodes:d=[],setNodes:h,hasDefaultNodes:p,onNodesChange:m,nodeLookup:f,fitViewQueued:y}=t.getState();let x=d;for(const v of u)x=typeof v=="function"?v(x):v;const _=Wb({items:x,lookup:f});p&&h(x),_.length>0?m==null||m(_):y&&window.requestAnimationFrame(()=>{const{fitViewQueued:v,nodes:w,setNodes:M}=t.getState();v&&M(w)})},[]),s=Xb(n),r=b.useCallback(u=>{const{edges:d=[],setEdges:h,hasDefaultEdges:p,onEdgesChange:m,edgeLookup:f}=t.getState();let y=d;for(const x of u)y=typeof x=="function"?x(y):x;p?h(y):m&&m(Wb({items:y,lookup:f}))},[]),i=Xb(r),l=b.useMemo(()=>({nodeQueue:s,edgeQueue:i}),[]);return o.jsx(Qb.Provider,{value:l,children:e})}function L$(){const e=b.useContext(Qb);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const R$=e=>!!e.panZoom;function Xh(){const e=E$(),t=tn(),n=L$(),s=St(R$),r=b.useMemo(()=>{const i=m=>t.getState().nodeLookup.get(m),l=m=>{n.nodeQueue.push(m)},u=m=>{n.edgeQueue.push(m)},d=m=>{var w,M;const{nodeLookup:f,nodeOrigin:y}=t.getState(),x=Kb(m)?m:f.get(m.id),_=x.parentId?Xx(x.position,x.measured,x.parentId,f,y):x.position,v={...x,position:_,width:((w=x.measured)==null?void 0:w.width)??x.width,height:((M=x.measured)==null?void 0:M.height)??x.height};return Ii(v)},h=(m,f,y={replace:!1})=>{l(x=>x.map(_=>{if(_.id===m){const v=typeof f=="function"?f(_):f;return y.replace&&Kb(v)?v:{..._,...v}}return _}))},p=(m,f,y={replace:!1})=>{u(x=>x.map(_=>{if(_.id===m){const v=typeof f=="function"?f(_):f;return y.replace&&O$(v)?v:{..._,...v}}return _}))};return{getNodes:()=>t.getState().nodes.map(m=>({...m})),getNode:m=>{var f;return(f=i(m))==null?void 0:f.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:m=[]}=t.getState();return m.map(f=>({...f}))},getEdge:m=>t.getState().edgeLookup.get(m),setNodes:l,setEdges:u,addNodes:m=>{const f=Array.isArray(m)?m:[m];n.nodeQueue.push(y=>[...y,...f])},addEdges:m=>{const f=Array.isArray(m)?m:[m];n.edgeQueue.push(y=>[...y,...f])},toObject:()=>{const{nodes:m=[],edges:f=[],transform:y}=t.getState(),[x,_,v]=y;return{nodes:m.map(w=>({...w})),edges:f.map(w=>({...w})),viewport:{x,y:_,zoom:v}}},deleteElements:async({nodes:m=[],edges:f=[]})=>{const{nodes:y,edges:x,onNodesDelete:_,onEdgesDelete:v,triggerNodeChanges:w,triggerEdgeChanges:M,onDelete:N,onBeforeDelete:C}=t.getState(),{nodes:j,edges:E}=await aT({nodesToRemove:m,edgesToRemove:f,nodes:y,edges:x,onBeforeDelete:C}),k=E.length>0,$=j.length>0;if(k){const T=E.map(Yb);v==null||v(E),M(T)}if($){const T=j.map(Yb);_==null||_(j),w(T)}return($||k)&&(N==null||N({nodes:j,edges:E})),{deletedNodes:j,deletedEdges:E}},getIntersectingNodes:(m,f=!0,y)=>{const x=Kx(m),_=x?m:d(m),v=y!==void 0;return _?(y||t.getState().nodes).filter(w=>{const M=t.getState().nodeLookup.get(w.id);if(M&&!x&&(w.id===m.id||!M.internals.positionAbsolute))return!1;const N=Ii(v?w:M),C=ic(N,_);return f&&C>0||C>=N.width*N.height||C>=_.width*_.height}):[]},isNodeIntersecting:(m,f,y=!0)=>{const _=Kx(m)?m:d(m);if(!_)return!1;const v=ic(_,f);return y&&v>0||v>=f.width*f.height||v>=_.width*_.height},updateNode:h,updateNodeData:(m,f,y={replace:!1})=>{h(m,x=>{const _=typeof f=="function"?f(x):f;return y.replace?{...x,data:_}:{...x,data:{...x.data,..._}}},y)},updateEdge:p,updateEdgeData:(m,f,y={replace:!1})=>{p(m,x=>{const _=typeof f=="function"?f(x):f;return y.replace?{...x,data:_}:{...x,data:{...x.data,..._}}},y)},getNodesBounds:m=>{const{nodeLookup:f,nodeOrigin:y}=t.getState();return tT(m,{nodeLookup:f,nodeOrigin:y})},getHandleConnections:({type:m,id:f,nodeId:y})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${y}-${m}${f?`-${f}`:""}`))==null?void 0:x.values())??[])},getNodeConnections:({type:m,handleId:f,nodeId:y})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${y}${m?f?`-${m}-${f}`:`-${m}`:""}`))==null?void 0:x.values())??[])},fitView:async m=>{const f=t.getState().fitViewResolver??cT();return t.setState({fitViewQueued:!0,fitViewOptions:m,fitViewResolver:f}),n.nodeQueue.push(y=>[...y]),f.promise}}},[]);return b.useMemo(()=>({...r,...e,viewportInitialized:s}),[s])}const Zb=e=>e.selected,D$=typeof window<"u"?window:void 0;function z$({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=tn(),{deleteElements:s}=Xh(),r=fc(e,{actInsideInputWithModifier:!1}),i=fc(t,{target:D$});b.useEffect(()=>{if(r){const{edges:l,nodes:u}=n.getState();s({nodes:u.filter(Zb),edges:l.filter(Zb)}),n.setState({nodesSelectionActive:!1})}},[r]),b.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function I$(e){const t=tn();b.useEffect(()=>{const n=()=>{var r,i,l,u;if(!e.current||!(((i=(r=e.current).checkVisibility)==null?void 0:i.call(r))??!0))return!1;const s=Lh(e.current);(s.height===0||s.width===0)&&((u=(l=t.getState()).onError)==null||u.call(l,"004",Rr.error004())),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const s=new ResizeObserver(()=>n());return s.observe(e.current),()=>{window.removeEventListener("resize",n),s&&e.current&&s.unobserve(e.current)}}},[])}const _d={position:"absolute",width:"100%",height:"100%",top:0,left:0},F$=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function B$({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:s=!1,panOnScrollSpeed:r=.5,panOnScrollMode:i=Lo.Free,zoomOnDoubleClick:l=!0,panOnDrag:u=!0,defaultViewport:d,translateExtent:h,minZoom:p,maxZoom:m,zoomActivationKeyCode:f,preventScrolling:y=!0,children:x,noWheelClassName:_,noPanClassName:v,onViewportChange:w,isControlledViewport:M,paneClickDistance:N,selectionOnDrag:C}){const j=tn(),E=b.useRef(null),{userSelectionActive:k,lib:$,connectionInProgress:T}=St(F$,dn),P=fc(f),A=b.useRef();I$(E);const D=b.useCallback(F=>{w==null||w({x:F[0],y:F[1],zoom:F[2]}),M||j.setState({transform:F})},[w,M]);return b.useEffect(()=>{if(E.current){A.current=WT({domNode:E.current,minZoom:p,maxZoom:m,translateExtent:h,viewport:d,onDraggingChange:q=>j.setState({paneDragging:q}),onPanZoomStart:(q,V)=>{const{onViewportChangeStart:U,onMoveStart:W}=j.getState();W==null||W(q,V),U==null||U(V)},onPanZoom:(q,V)=>{const{onViewportChange:U,onMove:W}=j.getState();W==null||W(q,V),U==null||U(V)},onPanZoomEnd:(q,V)=>{const{onViewportChangeEnd:U,onMoveEnd:W}=j.getState();W==null||W(q,V),U==null||U(V)}});const{x:F,y:R,zoom:z}=A.current.getViewport();return j.setState({panZoom:A.current,transform:[F,R,z],domNode:E.current.closest(".react-flow")}),()=>{var q;(q=A.current)==null||q.destroy()}}},[]),b.useEffect(()=>{var F;(F=A.current)==null||F.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:s,panOnScrollSpeed:r,panOnScrollMode:i,zoomOnDoubleClick:l,panOnDrag:u,zoomActivationKeyPressed:P,preventScrolling:y,noPanClassName:v,userSelectionActive:k,noWheelClassName:_,lib:$,onTransformChange:D,connectionInProgress:T,selectionOnDrag:C,paneClickDistance:N})},[e,t,n,s,r,i,l,u,P,y,v,k,_,$,D,T,C,N]),o.jsx("div",{className:"react-flow__renderer",ref:E,style:_d,children:x})}const U$=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function H$(){const{userSelectionActive:e,userSelectionRect:t}=St(U$,dn);return e&&t?o.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Qh=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},q$=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function V$({isSelecting:e,selectionKeyPressed:t,selectionMode:n=rc.Full,panOnDrag:s,paneClickDistance:r,selectionOnDrag:i,onSelectionStart:l,onSelectionEnd:u,onPaneClick:d,onPaneContextMenu:h,onPaneScroll:p,onPaneMouseEnter:m,onPaneMouseMove:f,onPaneMouseLeave:y,children:x}){const _=tn(),{userSelectionActive:v,elementsSelectable:w,dragging:M,connectionInProgress:N}=St(q$,dn),C=w&&(e||v),j=b.useRef(null),E=b.useRef(),k=b.useRef(new Set),$=b.useRef(new Set),T=b.useRef(!1),P=U=>{if(T.current||N){T.current=!1;return}d==null||d(U),_.getState().resetSelectedElements(),_.setState({nodesSelectionActive:!1})},A=U=>{if(Array.isArray(s)&&(s!=null&&s.includes(2))){U.preventDefault();return}h==null||h(U)},D=p?U=>p(U):void 0,F=U=>{T.current&&(U.stopPropagation(),T.current=!1)},R=U=>{var Y,X;const{domNode:W}=_.getState();if(E.current=W==null?void 0:W.getBoundingClientRect(),!E.current)return;const B=U.target===j.current;if(!B&&!!U.target.closest(".nokey")||!e||!(i&&B||t)||U.button!==0||!U.isPrimary)return;(X=(Y=U.target)==null?void 0:Y.setPointerCapture)==null||X.call(Y,U.pointerId),T.current=!1;const{x:J,y:G}=yr(U.nativeEvent,E.current);_.setState({userSelectionRect:{width:0,height:0,startX:J,startY:G,x:J,y:G}}),B||(U.stopPropagation(),U.preventDefault())},z=U=>{const{userSelectionRect:W,transform:B,nodeLookup:I,edgeLookup:H,connectionLookup:J,triggerNodeChanges:G,triggerEdgeChanges:Y,defaultEdgeOptions:X,resetSelectedElements:Z}=_.getState();if(!E.current||!W)return;const{x:ee,y:Q}=yr(U.nativeEvent,E.current),{startX:ne,startY:he}=W;if(!T.current){const ke=t?0:r;if(Math.hypot(ee-ne,Q-he)<=ke)return;Z(),l==null||l(U)}T.current=!0;const ye={startX:ne,startY:he,x:ee<ne?ee:ne,y:Q<he?Q:he,width:Math.abs(ee-ne),height:Math.abs(Q-he)},ge=k.current,Ee=$.current;k.current=new Set(Th(I,ye,B,n===rc.Partial,!0).map(ke=>ke.id)),$.current=new Set;const De=(X==null?void 0:X.selectable)??!0;for(const ke of k.current){const le=J.get(ke);if(le)for(const{edgeId:pe}of le.values()){const be=H.get(pe);be&&(be.selectable??De)&&$.current.add(pe)}}if(!Qx(ge,k.current)){const ke=qi(I,k.current,!0);G(ke)}if(!Qx(Ee,$.current)){const ke=qi(H,$.current);Y(ke)}_.setState({userSelectionRect:ye,userSelectionActive:!0,nodesSelectionActive:!1})},q=U=>{var W,B;U.button===0&&((B=(W=U.target)==null?void 0:W.releasePointerCapture)==null||B.call(W,U.pointerId),!v&&U.target===j.current&&_.getState().userSelectionRect&&(P==null||P(U)),_.setState({userSelectionActive:!1,userSelectionRect:null}),T.current&&(u==null||u(U),_.setState({nodesSelectionActive:k.current.size>0})))},V=s===!0||Array.isArray(s)&&s.includes(0);return o.jsxs("div",{className:Lt(["react-flow__pane",{draggable:V,dragging:M,selection:e}]),onClick:C?void 0:Qh(P,j),onContextMenu:Qh(A,j),onWheel:Qh(D,j),onPointerEnter:C?void 0:m,onPointerMove:C?z:f,onPointerUp:C?q:void 0,onPointerDownCapture:C?R:void 0,onClickCapture:C?F:void 0,onPointerLeave:y,ref:j,style:_d,children:[x,o.jsx(H$,{})]})}function Zh({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:l,nodeLookup:u,onError:d}=t.getState(),h=u.get(e);if(!h){d==null||d("012",Rr.error012(e));return}t.setState({nodesSelectionActive:!1}),h.selected?(n||h.selected&&l)&&(i({nodes:[h],edges:[]}),requestAnimationFrame(()=>{var p;return(p=s==null?void 0:s.current)==null?void 0:p.blur()})):r([e])}function Jb({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:r,isSelectable:i,nodeClickDistance:l}){const u=tn(),[d,h]=b.useState(!1),p=b.useRef();return b.useEffect(()=>{p.current=TT({getStoreItems:()=>u.getState(),onNodeMouseDown:m=>{Zh({id:m,store:u,nodeRef:e})},onDragStart:()=>{h(!0)},onDragStop:()=>{h(!1)}})},[]),b.useEffect(()=>{var m,f;if(t)(m=p.current)==null||m.destroy();else if(e.current)return(f=p.current)==null||f.update({noDragClassName:n,handleSelector:s,domNode:e.current,isSelectable:i,nodeId:r,nodeClickDistance:l}),()=>{var y;(y=p.current)==null||y.destroy()}},[n,s,t,i,e,r]),d}const W$=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function e0(){const e=tn();return b.useCallback(n=>{const{nodeExtent:s,snapToGrid:r,snapGrid:i,nodesDraggable:l,onError:u,updateNodePositions:d,nodeLookup:h,nodeOrigin:p}=e.getState(),m=new Map,f=W$(l),y=r?i[0]:5,x=r?i[1]:5,_=n.direction.x*y*n.factor,v=n.direction.y*x*n.factor;for(const[,w]of h){if(!f(w))continue;let M={x:w.internals.positionAbsolute.x+_,y:w.internals.positionAbsolute.y+v};r&&(M=lc(M,i));const{position:N,positionAbsolute:C}=Hx({nodeId:w.id,nextPosition:M,nodeLookup:h,nodeExtent:s,nodeOrigin:p,onError:u});w.position=N,w.internals.positionAbsolute=C,m.set(w.id,w)}d(m)},[])}const Jh=b.createContext(null),Y$=Jh.Provider;Jh.Consumer;const t0=()=>b.useContext(Jh),K$=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),G$=(e,t,n)=>s=>{const{connectionClickStartHandle:r,connectionMode:i,connection:l}=s,{fromHandle:u,toHandle:d,isValid:h}=l,p=(d==null?void 0:d.nodeId)===e&&(d==null?void 0:d.id)===t&&(d==null?void 0:d.type)===n;return{connectingFrom:(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.id)===t&&(u==null?void 0:u.type)===n,connectingTo:p,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===n,isPossibleEndHandle:i===Di.Strict?(u==null?void 0:u.type)!==n:e!==(u==null?void 0:u.nodeId)||t!==(u==null?void 0:u.id),connectionInProcess:!!u,clickConnectionInProcess:!!r,valid:p&&h}};function X$({type:e="source",position:t=Je.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:r=!0,isConnectableEnd:i=!0,id:l,onConnect:u,children:d,className:h,onMouseDown:p,onTouchStart:m,...f},y){var z,q;const x=l||null,_=e==="target",v=tn(),w=t0(),{connectOnClick:M,noPanClassName:N,rfId:C}=St(K$,dn),{connectingFrom:j,connectingTo:E,clickConnecting:k,isPossibleEndHandle:$,connectionInProcess:T,clickConnectionInProcess:P,valid:A}=St(G$(w,x,e),dn);w||(q=(z=v.getState()).onError)==null||q.call(z,"010",Rr.error010());const D=V=>{const{defaultEdgeOptions:U,onConnect:W,hasDefaultEdges:B}=v.getState(),I={...U,...V};if(B){const{edges:H,setEdges:J}=v.getState();J(gT(I,H))}W==null||W(I),u==null||u(I)},F=V=>{if(!w)return;const U=eb(V.nativeEvent);if(r&&(U&&V.button===0||!U)){const W=v.getState();qh.onPointerDown(V.nativeEvent,{handleDomNode:V.currentTarget,autoPanOnConnect:W.autoPanOnConnect,connectionMode:W.connectionMode,connectionRadius:W.connectionRadius,domNode:W.domNode,nodeLookup:W.nodeLookup,lib:W.lib,isTarget:_,handleId:x,nodeId:w,flowId:W.rfId,panBy:W.panBy,cancelConnection:W.cancelConnection,onConnectStart:W.onConnectStart,onConnectEnd:W.onConnectEnd,updateConnection:W.updateConnection,onConnect:D,isValidConnection:n||W.isValidConnection,getTransform:()=>v.getState().transform,getFromHandle:()=>v.getState().connection.fromHandle,autoPanSpeed:W.autoPanSpeed,dragThreshold:W.connectionDragThreshold})}U?p==null||p(V):m==null||m(V)},R=V=>{const{onClickConnectStart:U,onClickConnectEnd:W,connectionClickStartHandle:B,connectionMode:I,isValidConnection:H,lib:J,rfId:G,nodeLookup:Y,connection:X}=v.getState();if(!w||!B&&!r)return;if(!B){U==null||U(V.nativeEvent,{nodeId:w,handleId:x,handleType:e}),v.setState({connectionClickStartHandle:{nodeId:w,type:e,id:x}});return}const Z=Zx(V.target),ee=n||H,{connection:Q,isValid:ne}=qh.isValid(V.nativeEvent,{handle:{nodeId:w,id:x,type:e},connectionMode:I,fromNodeId:B.nodeId,fromHandleId:B.id||null,fromType:B.type,isValidConnection:ee,flowId:G,doc:Z,lib:J,nodeLookup:Y});ne&&Q&&D(Q);const he=structuredClone(X);delete he.inProgress,he.toPosition=he.toHandle?he.toHandle.position:null,W==null||W(V,he),v.setState({connectionClickStartHandle:null})};return o.jsx("div",{"data-handleid":x,"data-nodeid":w,"data-handlepos":t,"data-id":`${C}-${w}-${x}-${e}`,className:Lt(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",N,h,{source:!_,target:_,connectable:s,connectablestart:r,connectableend:i,clickconnecting:k,connectingfrom:j,connectingto:E,valid:A,connectionindicator:s&&(!T||$)&&(T||P?i:r)}]),onMouseDown:F,onTouchStart:F,onClick:M?R:void 0,ref:y,...f,children:d})}const yd=b.memo(Gb(X$));function Q$({data:e,isConnectable:t,sourcePosition:n=Je.Bottom}){return o.jsxs(o.Fragment,{children:[e==null?void 0:e.label,o.jsx(yd,{type:"source",position:n,isConnectable:t})]})}function Z$({data:e,isConnectable:t,targetPosition:n=Je.Top,sourcePosition:s=Je.Bottom}){return o.jsxs(o.Fragment,{children:[o.jsx(yd,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,o.jsx(yd,{type:"source",position:s,isConnectable:t})]})}function J$(){return null}function e2({data:e,isConnectable:t,targetPosition:n=Je.Top}){return o.jsxs(o.Fragment,{children:[o.jsx(yd,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const vd={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},n0={input:Q$,default:Z$,output:e2,group:J$};function t2(e){var t,n,s,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((s=e.style)==null?void 0:s.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const n2=e=>{const{width:t,height:n,x:s,y:r}=oc(e.nodeLookup,{filter:i=>!!i.selected});return{width:_r(t)?t:null,height:_r(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${s}px,${r}px)`}};function s2({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=tn(),{width:r,height:i,transformString:l,userSelectionActive:u}=St(n2,dn),d=e0(),h=b.useRef(null);if(b.useEffect(()=>{var f;n||(f=h.current)==null||f.focus({preventScroll:!0})},[n]),Jb({nodeRef:h}),u||!r||!i)return null;const p=e?f=>{const y=s.getState().nodes.filter(x=>x.selected);e(f,y)}:void 0,m=f=>{Object.prototype.hasOwnProperty.call(vd,f.key)&&(f.preventDefault(),d({direction:vd[f.key],factor:f.shiftKey?4:1}))};return o.jsx("div",{className:Lt(["react-flow__nodesselection","react-flow__container",t]),style:{transform:l},children:o.jsx("div",{ref:h,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:n?void 0:-1,onKeyDown:n?void 0:m,style:{width:r,height:i}})})}const s0=typeof window<"u"?window:void 0,r2=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function r0({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:l,paneClickDistance:u,deleteKeyCode:d,selectionKeyCode:h,selectionOnDrag:p,selectionMode:m,onSelectionStart:f,onSelectionEnd:y,multiSelectionKeyCode:x,panActivationKeyCode:_,zoomActivationKeyCode:v,elementsSelectable:w,zoomOnScroll:M,zoomOnPinch:N,panOnScroll:C,panOnScrollSpeed:j,panOnScrollMode:E,zoomOnDoubleClick:k,panOnDrag:$,defaultViewport:T,translateExtent:P,minZoom:A,maxZoom:D,preventScrolling:F,onSelectionContextMenu:R,noWheelClassName:z,noPanClassName:q,disableKeyboardA11y:V,onViewportChange:U,isControlledViewport:W}){const{nodesSelectionActive:B,userSelectionActive:I}=St(r2),H=fc(h,{target:s0}),J=fc(_,{target:s0}),G=J||$,Y=J||C,X=p&&G!==!0,Z=H||I||X;return z$({deleteKeyCode:d,multiSelectionKeyCode:x}),o.jsx(B$,{onPaneContextMenu:i,elementsSelectable:w,zoomOnScroll:M,zoomOnPinch:N,panOnScroll:Y,panOnScrollSpeed:j,panOnScrollMode:E,zoomOnDoubleClick:k,panOnDrag:!H&&G,defaultViewport:T,translateExtent:P,minZoom:A,maxZoom:D,zoomActivationKeyCode:v,preventScrolling:F,noWheelClassName:z,noPanClassName:q,onViewportChange:U,isControlledViewport:W,paneClickDistance:u,selectionOnDrag:X,children:o.jsxs(V$,{onSelectionStart:f,onSelectionEnd:y,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:l,panOnDrag:G,isSelecting:!!Z,selectionMode:m,selectionKeyPressed:H,paneClickDistance:u,selectionOnDrag:X,children:[e,B&&o.jsx(s2,{onSelectionContextMenu:R,noPanClassName:q,disableKeyboardA11y:V})]})})}r0.displayName="FlowRenderer";const a2=b.memo(r0),o2=e=>t=>e?Th(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function i2(e){return St(b.useCallback(o2(e),[e]),dn)}const l2=e=>e.updateNodeInternals;function c2(){const e=St(l2),[t]=b.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const s=new Map;n.forEach(r=>{const i=r.target.getAttribute("data-id");s.set(i,{id:i,nodeElement:r.target,force:!0})}),e(s)}));return b.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function u2({node:e,nodeType:t,hasDimensions:n,resizeObserver:s}){const r=tn(),i=b.useRef(null),l=b.useRef(null),u=b.useRef(e.sourcePosition),d=b.useRef(e.targetPosition),h=b.useRef(t),p=n&&!!e.internals.handleBounds;return b.useEffect(()=>{i.current&&!e.hidden&&(!p||l.current!==i.current)&&(l.current&&(s==null||s.unobserve(l.current)),s==null||s.observe(i.current),l.current=i.current)},[p,e.hidden]),b.useEffect(()=>()=>{l.current&&(s==null||s.unobserve(l.current),l.current=null)},[]),b.useEffect(()=>{if(i.current){const m=h.current!==t,f=u.current!==e.sourcePosition,y=d.current!==e.targetPosition;(m||f||y)&&(h.current=t,u.current=e.sourcePosition,d.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function d2({id:e,onClick:t,onMouseEnter:n,onMouseMove:s,onMouseLeave:r,onContextMenu:i,onDoubleClick:l,nodesDraggable:u,elementsSelectable:d,nodesConnectable:h,nodesFocusable:p,resizeObserver:m,noDragClassName:f,noPanClassName:y,disableKeyboardA11y:x,rfId:_,nodeTypes:v,nodeClickDistance:w,onError:M}){const{node:N,internals:C,isParent:j}=St(ee=>{const Q=ee.nodeLookup.get(e),ne=ee.parentLookup.has(e);return{node:Q,internals:Q.internals,isParent:ne}},dn);let E=N.type||"default",k=(v==null?void 0:v[E])||n0[E];k===void 0&&(M==null||M("003",Rr.error003(E)),E="default",k=(v==null?void 0:v.default)||n0.default);const $=!!(N.draggable||u&&typeof N.draggable>"u"),T=!!(N.selectable||d&&typeof N.selectable>"u"),P=!!(N.connectable||h&&typeof N.connectable>"u"),A=!!(N.focusable||p&&typeof N.focusable>"u"),D=tn(),F=Gx(N),R=u2({node:N,nodeType:E,hasDimensions:F,resizeObserver:m}),z=Jb({nodeRef:R,disabled:N.hidden||!$,noDragClassName:f,handleSelector:N.dragHandle,nodeId:e,isSelectable:T,nodeClickDistance:w}),q=e0();if(N.hidden)return null;const V=Gr(N),U=t2(N),W=T||$||t||n||s||r,B=n?ee=>n(ee,{...C.userNode}):void 0,I=s?ee=>s(ee,{...C.userNode}):void 0,H=r?ee=>r(ee,{...C.userNode}):void 0,J=i?ee=>i(ee,{...C.userNode}):void 0,G=l?ee=>l(ee,{...C.userNode}):void 0,Y=ee=>{const{selectNodesOnDrag:Q,nodeDragThreshold:ne}=D.getState();T&&(!Q||!$||ne>0)&&Zh({id:e,store:D,nodeRef:R}),t&&t(ee,{...C.userNode})},X=ee=>{if(!(Jx(ee.nativeEvent)||x)){if(Dx.includes(ee.key)&&T){const Q=ee.key==="Escape";Zh({id:e,store:D,unselect:Q,nodeRef:R})}else if($&&N.selected&&Object.prototype.hasOwnProperty.call(vd,ee.key)){ee.preventDefault();const{ariaLabelConfig:Q}=D.getState();D.setState({ariaLiveMessage:Q["node.a11yDescription.ariaLiveMessage"]({direction:ee.key.replace("Arrow","").toLowerCase(),x:~~C.positionAbsolute.x,y:~~C.positionAbsolute.y})}),q({direction:vd[ee.key],factor:ee.shiftKey?4:1})}}},Z=()=>{var Ee;if(x||!((Ee=R.current)!=null&&Ee.matches(":focus-visible")))return;const{transform:ee,width:Q,height:ne,autoPanOnNodeFocus:he,setCenter:ye}=D.getState();if(!he)return;Th(new Map([[e,N]]),{x:0,y:0,width:Q,height:ne},ee,!0).length>0||ye(N.position.x+V.width/2,N.position.y+V.height/2,{zoom:ee[2]})};return o.jsx("div",{className:Lt(["react-flow__node",`react-flow__node-${E}`,{[y]:$},N.className,{selected:N.selected,selectable:T,parent:j,draggable:$,dragging:z}]),ref:R,style:{zIndex:C.z,transform:`translate(${C.positionAbsolute.x}px,${C.positionAbsolute.y}px)`,pointerEvents:W?"all":"none",visibility:F?"visible":"hidden",...N.style,...U},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:B,onMouseMove:I,onMouseLeave:H,onContextMenu:J,onClick:Y,onDoubleClick:G,onKeyDown:A?X:void 0,tabIndex:A?0:void 0,onFocus:A?Z:void 0,role:N.ariaRole??(A?"group":void 0),"aria-roledescription":"node","aria-describedby":x?void 0:`${Rb}-${_}`,"aria-label":N.ariaLabel,...N.domAttributes,children:o.jsx(Y$,{value:e,children:o.jsx(k,{id:e,data:N.data,type:E,positionAbsoluteX:C.positionAbsolute.x,positionAbsoluteY:C.positionAbsolute.y,selected:N.selected??!1,selectable:T,draggable:$,deletable:N.deletable??!0,isConnectable:P,sourcePosition:N.sourcePosition,targetPosition:N.targetPosition,dragging:z,dragHandle:N.dragHandle,zIndex:C.z,parentId:N.parentId,...V})})})}var m2=b.memo(d2);const f2=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function a0(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,onError:i}=St(f2,dn),l=i2(e.onlyRenderVisibleElements),u=c2();return o.jsx("div",{className:"react-flow__nodes",style:_d,children:l.map(d=>o.jsx(m2,{id:d,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:u,nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:i},d))})}a0.displayName="NodeRenderer";const h2=b.memo(a0);function p2(e){return St(b.useCallback(n=>{if(!e)return n.edges.map(r=>r.id);const s=[];if(n.width&&n.height)for(const r of n.edges){const i=n.nodeLookup.get(r.source),l=n.nodeLookup.get(r.target);i&&l&&fT({sourceNode:i,targetNode:l,width:n.width,height:n.height,transform:n.transform})&&s.push(r.id)}return s},[e]),dn)}const g2=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return o.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},_2=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return o.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},o0={[od.Arrow]:g2,[od.ArrowClosed]:_2};function y2(e){const t=tn();return b.useMemo(()=>{var r,i;return Object.prototype.hasOwnProperty.call(o0,e)?o0[e]:((i=(r=t.getState()).onError)==null||i.call(r,"009",Rr.error009(e)),null)},[e])}const v2=({id:e,type:t,color:n,width:s=12.5,height:r=12.5,markerUnits:i="strokeWidth",strokeWidth:l,orient:u="auto-start-reverse"})=>{const d=y2(t);return d?o.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:u,refX:"0",refY:"0",children:o.jsx(d,{color:n,strokeWidth:l})}):null},i0=({defaultColor:e,rfId:t})=>{const n=St(i=>i.edges),s=St(i=>i.defaultEdgeOptions),r=b.useMemo(()=>bT(n,{id:t,defaultColor:e,defaultMarkerStart:s==null?void 0:s.markerStart,defaultMarkerEnd:s==null?void 0:s.markerEnd}),[n,s,t,e]);return r.length?o.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:o.jsx("defs",{children:r.map(i=>o.jsx(v2,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};i0.displayName="MarkerDefinitions";var x2=b.memo(i0);function l0({x:e,y:t,label:n,labelStyle:s,labelShowBg:r=!0,labelBgStyle:i,labelBgPadding:l=[2,4],labelBgBorderRadius:u=2,children:d,className:h,...p}){const[m,f]=b.useState({x:1,y:0,width:0,height:0}),y=Lt(["react-flow__edge-textwrapper",h]),x=b.useRef(null);return b.useEffect(()=>{if(x.current){const _=x.current.getBBox();f({x:_.x,y:_.y,width:_.width,height:_.height})}},[n]),n?o.jsxs("g",{transform:`translate(${e-m.width/2} ${t-m.height/2})`,className:y,visibility:m.width?"visible":"hidden",...p,children:[r&&o.jsx("rect",{width:m.width+2*l[0],x:-l[0],y:-l[1],height:m.height+2*l[1],className:"react-flow__edge-textbg",style:i,rx:u,ry:u}),o.jsx("text",{className:"react-flow__edge-text",y:m.height/2,dy:"0.3em",ref:x,style:s,children:n}),d]}):null}l0.displayName="EdgeText";const b2=b.memo(l0);function xd({path:e,labelX:t,labelY:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,interactionWidth:h=20,...p}){return o.jsxs(o.Fragment,{children:[o.jsx("path",{...p,d:e,fill:"none",className:Lt(["react-flow__edge-path",p.className])}),h?o.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:h,className:"react-flow__edge-interaction"}):null,s&&_r(t)&&_r(n)?o.jsx(b2,{x:t,y:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d}):null]})}function c0({pos:e,x1:t,y1:n,x2:s,y2:r}){return e===Je.Left||e===Je.Right?[.5*(t+s),n]:[t,.5*(n+r)]}function u0({sourceX:e,sourceY:t,sourcePosition:n=Je.Bottom,targetX:s,targetY:r,targetPosition:i=Je.Top}){const[l,u]=c0({pos:n,x1:e,y1:t,x2:s,y2:r}),[d,h]=c0({pos:i,x1:s,y1:r,x2:e,y2:t}),[p,m,f,y]=nb({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:l,sourceControlY:u,targetControlX:d,targetControlY:h});return[`M${e},${t} C${l},${u} ${d},${h} ${s},${r}`,p,m,f,y]}function d0(e){return b.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:l,targetPosition:u,label:d,labelStyle:h,labelShowBg:p,labelBgStyle:m,labelBgPadding:f,labelBgBorderRadius:y,style:x,markerEnd:_,markerStart:v,interactionWidth:w})=>{const[M,N,C]=u0({sourceX:n,sourceY:s,sourcePosition:l,targetX:r,targetY:i,targetPosition:u}),j=e.isInternal?void 0:t;return o.jsx(xd,{id:j,path:M,labelX:N,labelY:C,label:d,labelStyle:h,labelShowBg:p,labelBgStyle:m,labelBgPadding:f,labelBgBorderRadius:y,style:x,markerEnd:_,markerStart:v,interactionWidth:w})})}const w2=d0({isInternal:!1}),m0=d0({isInternal:!0});w2.displayName="SimpleBezierEdge",m0.displayName="SimpleBezierEdgeInternal";function f0(e){return b.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:m,style:f,sourcePosition:y=Je.Bottom,targetPosition:x=Je.Top,markerEnd:_,markerStart:v,pathOptions:w,interactionWidth:M})=>{const[N,C,j]=Rh({sourceX:n,sourceY:s,sourcePosition:y,targetX:r,targetY:i,targetPosition:x,borderRadius:w==null?void 0:w.borderRadius,offset:w==null?void 0:w.offset,stepPosition:w==null?void 0:w.stepPosition}),E=e.isInternal?void 0:t;return o.jsx(xd,{id:E,path:N,labelX:C,labelY:j,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:m,style:f,markerEnd:_,markerStart:v,interactionWidth:M})})}const h0=f0({isInternal:!1}),p0=f0({isInternal:!0});h0.displayName="SmoothStepEdge",p0.displayName="SmoothStepEdgeInternal";function g0(e){return b.memo(({id:t,...n})=>{var r;const s=e.isInternal?void 0:t;return o.jsx(h0,{...n,id:s,pathOptions:b.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(r=n.pathOptions)==null?void 0:r.offset])})})}const N2=g0({isInternal:!1}),_0=g0({isInternal:!0});N2.displayName="StepEdge",_0.displayName="StepEdgeInternal";function y0(e){return b.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:m,style:f,markerEnd:y,markerStart:x,interactionWidth:_})=>{const[v,w,M]=ob({sourceX:n,sourceY:s,targetX:r,targetY:i}),N=e.isInternal?void 0:t;return o.jsx(xd,{id:N,path:v,labelX:w,labelY:M,label:l,labelStyle:u,labelShowBg:d,labelBgStyle:h,labelBgPadding:p,labelBgBorderRadius:m,style:f,markerEnd:y,markerStart:x,interactionWidth:_})})}const j2=y0({isInternal:!1}),v0=y0({isInternal:!0});j2.displayName="StraightEdge",v0.displayName="StraightEdgeInternal";function x0(e){return b.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:l=Je.Bottom,targetPosition:u=Je.Top,label:d,labelStyle:h,labelShowBg:p,labelBgStyle:m,labelBgPadding:f,labelBgBorderRadius:y,style:x,markerEnd:_,markerStart:v,pathOptions:w,interactionWidth:M})=>{const[N,C,j]=rb({sourceX:n,sourceY:s,sourcePosition:l,targetX:r,targetY:i,targetPosition:u,curvature:w==null?void 0:w.curvature}),E=e.isInternal?void 0:t;return o.jsx(xd,{id:E,path:N,labelX:C,labelY:j,label:d,labelStyle:h,labelShowBg:p,labelBgStyle:m,labelBgPadding:f,labelBgBorderRadius:y,style:x,markerEnd:_,markerStart:v,interactionWidth:M})})}const C2=x0({isInternal:!1}),b0=x0({isInternal:!0});C2.displayName="BezierEdge",b0.displayName="BezierEdgeInternal";const w0={default:b0,straight:v0,step:_0,smoothstep:p0,simplebezier:m0},N0={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},S2=(e,t,n)=>n===Je.Left?e-t:n===Je.Right?e+t:e,E2=(e,t,n)=>n===Je.Top?e-t:n===Je.Bottom?e+t:e,j0="react-flow__edgeupdater";function C0({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:r,onMouseEnter:i,onMouseOut:l,type:u}){return o.jsx("circle",{onMouseDown:r,onMouseEnter:i,onMouseOut:l,className:Lt([j0,`${j0}-${u}`]),cx:S2(t,s,e),cy:E2(n,s,e),r:s,stroke:"transparent",fill:"transparent"})}function M2({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:s,sourceY:r,targetX:i,targetY:l,sourcePosition:u,targetPosition:d,onReconnect:h,onReconnectStart:p,onReconnectEnd:m,setReconnecting:f,setUpdateHover:y}){const x=tn(),_=(C,j)=>{if(C.button!==0)return;const{autoPanOnConnect:E,domNode:k,isValidConnection:$,connectionMode:T,connectionRadius:P,lib:A,onConnectStart:D,onConnectEnd:F,cancelConnection:R,nodeLookup:z,rfId:q,panBy:V,updateConnection:U}=x.getState(),W=j.type==="target",B=(J,G)=>{f(!1),m==null||m(J,n,j.type,G)},I=J=>h==null?void 0:h(n,J),H=(J,G)=>{f(!0),p==null||p(C,n,j.type),D==null||D(J,G)};qh.onPointerDown(C.nativeEvent,{autoPanOnConnect:E,connectionMode:T,connectionRadius:P,domNode:k,handleId:j.id,nodeId:j.nodeId,nodeLookup:z,isTarget:W,edgeUpdaterType:j.type,lib:A,flowId:q,cancelConnection:R,panBy:V,isValidConnection:$,onConnect:I,onConnectStart:H,onConnectEnd:F,onReconnectEnd:B,updateConnection:U,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,dragThreshold:x.getState().connectionDragThreshold,handleDomNode:C.currentTarget})},v=C=>_(C,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),w=C=>_(C,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),M=()=>y(!0),N=()=>y(!1);return o.jsxs(o.Fragment,{children:[(e===!0||e==="source")&&o.jsx(C0,{position:u,centerX:s,centerY:r,radius:t,onMouseDown:v,onMouseEnter:M,onMouseOut:N,type:"source"}),(e===!0||e==="target")&&o.jsx(C0,{position:d,centerX:i,centerY:l,radius:t,onMouseDown:w,onMouseEnter:M,onMouseOut:N,type:"target"})]})}function k2({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:s,onClick:r,onDoubleClick:i,onContextMenu:l,onMouseEnter:u,onMouseMove:d,onMouseLeave:h,reconnectRadius:p,onReconnect:m,onReconnectStart:f,onReconnectEnd:y,rfId:x,edgeTypes:_,noPanClassName:v,onError:w,disableKeyboardA11y:M}){let N=St(ye=>ye.edgeLookup.get(e));const C=St(ye=>ye.defaultEdgeOptions);N=C?{...C,...N}:N;let j=N.type||"default",E=(_==null?void 0:_[j])||w0[j];E===void 0&&(w==null||w("011",Rr.error011(j)),j="default",E=(_==null?void 0:_.default)||w0.default);const k=!!(N.focusable||t&&typeof N.focusable>"u"),$=typeof m<"u"&&(N.reconnectable||n&&typeof N.reconnectable>"u"),T=!!(N.selectable||s&&typeof N.selectable>"u"),P=b.useRef(null),[A,D]=b.useState(!1),[F,R]=b.useState(!1),z=tn(),{zIndex:q,sourceX:V,sourceY:U,targetX:W,targetY:B,sourcePosition:I,targetPosition:H}=St(b.useCallback(ye=>{const ge=ye.nodeLookup.get(N.source),Ee=ye.nodeLookup.get(N.target);if(!ge||!Ee)return{zIndex:N.zIndex,...N0};const De=xT({id:e,sourceNode:ge,targetNode:Ee,sourceHandle:N.sourceHandle||null,targetHandle:N.targetHandle||null,connectionMode:ye.connectionMode,onError:w});return{zIndex:mT({selected:N.selected,zIndex:N.zIndex,sourceNode:ge,targetNode:Ee,elevateOnSelect:ye.elevateEdgesOnSelect}),...De||N0}},[N.source,N.target,N.sourceHandle,N.targetHandle,N.selected,N.zIndex]),dn),J=b.useMemo(()=>N.markerStart?`url('#${Dh(N.markerStart,x)}')`:void 0,[N.markerStart,x]),G=b.useMemo(()=>N.markerEnd?`url('#${Dh(N.markerEnd,x)}')`:void 0,[N.markerEnd,x]);if(N.hidden||V===null||U===null||W===null||B===null)return null;const Y=ye=>{var ke;const{addSelectedEdges:ge,unselectNodesAndEdges:Ee,multiSelectionActive:De}=z.getState();T&&(z.setState({nodesSelectionActive:!1}),N.selected&&De?(Ee({nodes:[],edges:[N]}),(ke=P.current)==null||ke.blur()):ge([e])),r&&r(ye,N)},X=i?ye=>{i(ye,{...N})}:void 0,Z=l?ye=>{l(ye,{...N})}:void 0,ee=u?ye=>{u(ye,{...N})}:void 0,Q=d?ye=>{d(ye,{...N})}:void 0,ne=h?ye=>{h(ye,{...N})}:void 0,he=ye=>{var ge;if(!M&&Dx.includes(ye.key)&&T){const{unselectNodesAndEdges:Ee,addSelectedEdges:De}=z.getState();ye.key==="Escape"?((ge=P.current)==null||ge.blur(),Ee({edges:[N]})):De([e])}};return o.jsx("svg",{style:{zIndex:q},children:o.jsxs("g",{className:Lt(["react-flow__edge",`react-flow__edge-${j}`,N.className,v,{selected:N.selected,animated:N.animated,inactive:!T&&!r,updating:A,selectable:T}]),onClick:Y,onDoubleClick:X,onContextMenu:Z,onMouseEnter:ee,onMouseMove:Q,onMouseLeave:ne,onKeyDown:k?he:void 0,tabIndex:k?0:void 0,role:N.ariaRole??(k?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":N.ariaLabel===null?void 0:N.ariaLabel||`Edge from ${N.source} to ${N.target}`,"aria-describedby":k?`${Db}-${x}`:void 0,ref:P,...N.domAttributes,children:[!F&&o.jsx(E,{id:e,source:N.source,target:N.target,type:N.type,selected:N.selected,animated:N.animated,selectable:T,deletable:N.deletable??!0,label:N.label,labelStyle:N.labelStyle,labelShowBg:N.labelShowBg,labelBgStyle:N.labelBgStyle,labelBgPadding:N.labelBgPadding,labelBgBorderRadius:N.labelBgBorderRadius,sourceX:V,sourceY:U,targetX:W,targetY:B,sourcePosition:I,targetPosition:H,data:N.data,style:N.style,sourceHandleId:N.sourceHandle,targetHandleId:N.targetHandle,markerStart:J,markerEnd:G,pathOptions:"pathOptions"in N?N.pathOptions:void 0,interactionWidth:N.interactionWidth}),$&&o.jsx(M2,{edge:N,isReconnectable:$,reconnectRadius:p,onReconnect:m,onReconnectStart:f,onReconnectEnd:y,sourceX:V,sourceY:U,targetX:W,targetY:B,sourcePosition:I,targetPosition:H,setUpdateHover:D,setReconnecting:R})]})})}var A2=b.memo(k2);const O2=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function S0({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:s,noPanClassName:r,onReconnect:i,onEdgeContextMenu:l,onEdgeMouseEnter:u,onEdgeMouseMove:d,onEdgeMouseLeave:h,onEdgeClick:p,reconnectRadius:m,onEdgeDoubleClick:f,onReconnectStart:y,onReconnectEnd:x,disableKeyboardA11y:_}){const{edgesFocusable:v,edgesReconnectable:w,elementsSelectable:M,onError:N}=St(O2,dn),C=p2(t);return o.jsxs("div",{className:"react-flow__edges",children:[o.jsx(x2,{defaultColor:e,rfId:n}),C.map(j=>o.jsx(A2,{id:j,edgesFocusable:v,edgesReconnectable:w,elementsSelectable:M,noPanClassName:r,onReconnect:i,onContextMenu:l,onMouseEnter:u,onMouseMove:d,onMouseLeave:h,onClick:p,reconnectRadius:m,onDoubleClick:f,onReconnectStart:y,onReconnectEnd:x,rfId:n,onError:N,edgeTypes:s,disableKeyboardA11y:_},j))]})}S0.displayName="EdgeRenderer";const T2=b.memo(S0),$2=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function P2({children:e}){const t=St($2);return o.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function L2(e){const t=Xh(),n=b.useRef(!1);b.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const R2=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function D2(e){const t=St(R2),n=tn();return b.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function z2(e){return e.connection.inProgress?{...e.connection,to:cc(e.connection.to,e.transform)}:{...e.connection}}function I2(e){return z2}function F2(e){const t=I2();return St(t,dn)}const B2=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function U2({containerStyle:e,style:t,type:n,component:s}){const{nodesConnectable:r,width:i,height:l,isValid:u,inProgress:d}=St(B2,dn);return!(i&&r&&d)?null:o.jsx("svg",{style:e,width:i,height:l,className:"react-flow__connectionline react-flow__container",children:o.jsx("g",{className:Lt(["react-flow__connection",Bx(u)]),children:o.jsx(E0,{style:t,type:n,CustomComponent:s,isValid:u})})})}const E0=({style:e,type:t=ja.Bezier,CustomComponent:n,isValid:s})=>{const{inProgress:r,from:i,fromNode:l,fromHandle:u,fromPosition:d,to:h,toNode:p,toHandle:m,toPosition:f,pointer:y}=F2();if(!r)return;if(n)return o.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:l,fromHandle:u,fromX:i.x,fromY:i.y,toX:h.x,toY:h.y,fromPosition:d,toPosition:f,connectionStatus:Bx(s),toNode:p,toHandle:m,pointer:y});let x="";const _={sourceX:i.x,sourceY:i.y,sourcePosition:d,targetX:h.x,targetY:h.y,targetPosition:f};switch(t){case ja.Bezier:[x]=rb(_);break;case ja.SimpleBezier:[x]=u0(_);break;case ja.Step:[x]=Rh({..._,borderRadius:0});break;case ja.SmoothStep:[x]=Rh(_);break;default:[x]=ob(_)}return o.jsx("path",{d:x,fill:"none",className:"react-flow__connection-path",style:e})};E0.displayName="ConnectionLine";const H2={};function M0(e=H2){b.useRef(e),tn(),b.useEffect(()=>{},[e])}function q2(){tn(),b.useRef(!1),b.useEffect(()=>{},[])}function k0({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:s,onEdgeClick:r,onNodeDoubleClick:i,onEdgeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:p,onSelectionContextMenu:m,onSelectionStart:f,onSelectionEnd:y,connectionLineType:x,connectionLineStyle:_,connectionLineComponent:v,connectionLineContainerStyle:w,selectionKeyCode:M,selectionOnDrag:N,selectionMode:C,multiSelectionKeyCode:j,panActivationKeyCode:E,zoomActivationKeyCode:k,deleteKeyCode:$,onlyRenderVisibleElements:T,elementsSelectable:P,defaultViewport:A,translateExtent:D,minZoom:F,maxZoom:R,preventScrolling:z,defaultMarkerColor:q,zoomOnScroll:V,zoomOnPinch:U,panOnScroll:W,panOnScrollSpeed:B,panOnScrollMode:I,zoomOnDoubleClick:H,panOnDrag:J,onPaneClick:G,onPaneMouseEnter:Y,onPaneMouseMove:X,onPaneMouseLeave:Z,onPaneScroll:ee,onPaneContextMenu:Q,paneClickDistance:ne,nodeClickDistance:he,onEdgeContextMenu:ye,onEdgeMouseEnter:ge,onEdgeMouseMove:Ee,onEdgeMouseLeave:De,reconnectRadius:ke,onReconnect:le,onReconnectStart:pe,onReconnectEnd:be,noDragClassName:Te,noWheelClassName:Ie,noPanClassName:ue,disableKeyboardA11y:$e,nodeExtent:Ye,rfId:et,viewport:We,onViewportChange:mt}){return M0(e),M0(t),q2(),L2(n),D2(We),o.jsx(a2,{onPaneClick:G,onPaneMouseEnter:Y,onPaneMouseMove:X,onPaneMouseLeave:Z,onPaneContextMenu:Q,onPaneScroll:ee,paneClickDistance:ne,deleteKeyCode:$,selectionKeyCode:M,selectionOnDrag:N,selectionMode:C,onSelectionStart:f,onSelectionEnd:y,multiSelectionKeyCode:j,panActivationKeyCode:E,zoomActivationKeyCode:k,elementsSelectable:P,zoomOnScroll:V,zoomOnPinch:U,zoomOnDoubleClick:H,panOnScroll:W,panOnScrollSpeed:B,panOnScrollMode:I,panOnDrag:J,defaultViewport:A,translateExtent:D,minZoom:F,maxZoom:R,onSelectionContextMenu:m,preventScrolling:z,noDragClassName:Te,noWheelClassName:Ie,noPanClassName:ue,disableKeyboardA11y:$e,onViewportChange:mt,isControlledViewport:!!We,children:o.jsxs(P2,{children:[o.jsx(T2,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:l,onReconnect:le,onReconnectStart:pe,onReconnectEnd:be,onlyRenderVisibleElements:T,onEdgeContextMenu:ye,onEdgeMouseEnter:ge,onEdgeMouseMove:Ee,onEdgeMouseLeave:De,reconnectRadius:ke,defaultMarkerColor:q,noPanClassName:ue,disableKeyboardA11y:$e,rfId:et}),o.jsx(U2,{style:_,type:x,component:v,containerStyle:w}),o.jsx("div",{className:"react-flow__edgelabel-renderer"}),o.jsx(h2,{nodeTypes:e,onNodeClick:s,onNodeDoubleClick:i,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:p,nodeClickDistance:he,onlyRenderVisibleElements:T,noPanClassName:ue,noDragClassName:Te,disableKeyboardA11y:$e,nodeExtent:Ye,rfId:et}),o.jsx("div",{className:"react-flow__viewport-portal"})]})})}k0.displayName="GraphView";const V2=b.memo(k0),A0=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:l,fitViewOptions:u,minZoom:d=.5,maxZoom:h=2,nodeOrigin:p,nodeExtent:m}={})=>{const f=new Map,y=new Map,x=new Map,_=new Map,v=s??t??[],w=n??e??[],M=p??[0,0],N=m??sc;pb(x,_,v);const C=Fh(w,f,y,{nodeOrigin:M,nodeExtent:N,elevateNodesOnSelect:!1});let j=[0,0,1];if(l&&r&&i){const E=oc(f,{filter:P=>!!((P.width||P.initialWidth)&&(P.height||P.initialHeight))}),{x:k,y:$,zoom:T}=Ph(E,r,i,d,h,(u==null?void 0:u.padding)??.1);j=[k,$,T]}return{rfId:"1",width:r??0,height:i??0,transform:j,nodes:w,nodesInitialized:C,nodeLookup:f,parentLookup:y,edges:v,edgeLookup:_,connectionLookup:x,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:s!==void 0,panZoom:null,minZoom:d,maxZoom:h,translateExtent:sc,nodeExtent:N,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Di.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:M,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:l??!1,fitViewOptions:u,fitViewResolver:null,connection:{...Ix},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:oT,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:zx}},W2=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:l,fitViewOptions:u,minZoom:d,maxZoom:h,nodeOrigin:p,nodeExtent:m})=>c$((f,y)=>{async function x(){const{nodeLookup:_,panZoom:v,fitViewOptions:w,fitViewResolver:M,width:N,height:C,minZoom:j,maxZoom:E}=y();v&&(await rT({nodes:_,width:N,height:C,panZoom:v,minZoom:j,maxZoom:E},w),M==null||M.resolve(!0),f({fitViewResolver:null}))}return{...A0({nodes:e,edges:t,width:r,height:i,fitView:l,fitViewOptions:u,minZoom:d,maxZoom:h,nodeOrigin:p,nodeExtent:m,defaultNodes:n,defaultEdges:s}),setNodes:_=>{const{nodeLookup:v,parentLookup:w,nodeOrigin:M,elevateNodesOnSelect:N,fitViewQueued:C}=y(),j=Fh(_,v,w,{nodeOrigin:M,nodeExtent:m,elevateNodesOnSelect:N,checkEquality:!0});C&&j?(x(),f({nodes:_,nodesInitialized:j,fitViewQueued:!1,fitViewOptions:void 0})):f({nodes:_,nodesInitialized:j})},setEdges:_=>{const{connectionLookup:v,edgeLookup:w}=y();pb(v,w,_),f({edges:_})},setDefaultNodesAndEdges:(_,v)=>{if(_){const{setNodes:w}=y();w(_),f({hasDefaultNodes:!0})}if(v){const{setEdges:w}=y();w(v),f({hasDefaultEdges:!0})}},updateNodeInternals:_=>{const{triggerNodeChanges:v,nodeLookup:w,parentLookup:M,domNode:N,nodeOrigin:C,nodeExtent:j,debug:E,fitViewQueued:k}=y(),{changes:$,updatedInternals:T}=MT(_,w,M,N,C,j);T&&(jT(w,M,{nodeOrigin:C,nodeExtent:j}),k?(x(),f({fitViewQueued:!1,fitViewOptions:void 0})):f({}),($==null?void 0:$.length)>0&&(E&&console.log("React Flow: trigger node changes",$),v==null||v($)))},updateNodePositions:(_,v=!1)=>{const w=[],M=[],{nodeLookup:N,triggerNodeChanges:C}=y();for(const[j,E]of _){const k=N.get(j),$=!!(k!=null&&k.expandParent&&(k!=null&&k.parentId)&&(E!=null&&E.position)),T={id:j,type:"position",position:$?{x:Math.max(0,E.position.x),y:Math.max(0,E.position.y)}:E.position,dragging:v};$&&k.parentId&&w.push({id:j,parentId:k.parentId,rect:{...E.internals.positionAbsolute,width:E.measured.width??0,height:E.measured.height??0}}),M.push(T)}if(w.length>0){const{parentLookup:j,nodeOrigin:E}=y(),k=Uh(w,N,j,E);M.push(...k)}C(M)},triggerNodeChanges:_=>{const{onNodesChange:v,setNodes:w,nodes:M,hasDefaultNodes:N,debug:C}=y();if(_!=null&&_.length){if(N){const j=k$(_,M);w(j)}C&&console.log("React Flow: trigger node changes",_),v==null||v(_)}},triggerEdgeChanges:_=>{const{onEdgesChange:v,setEdges:w,edges:M,hasDefaultEdges:N,debug:C}=y();if(_!=null&&_.length){if(N){const j=A$(_,M);w(j)}C&&console.log("React Flow: trigger edge changes",_),v==null||v(_)}},addSelectedNodes:_=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:M,triggerNodeChanges:N,triggerEdgeChanges:C}=y();if(v){const j=_.map(E=>Do(E,!0));N(j);return}N(qi(M,new Set([..._]),!0)),C(qi(w))},addSelectedEdges:_=>{const{multiSelectionActive:v,edgeLookup:w,nodeLookup:M,triggerNodeChanges:N,triggerEdgeChanges:C}=y();if(v){const j=_.map(E=>Do(E,!0));C(j);return}C(qi(w,new Set([..._]))),N(qi(M,new Set,!0))},unselectNodesAndEdges:({nodes:_,edges:v}={})=>{const{edges:w,nodes:M,nodeLookup:N,triggerNodeChanges:C,triggerEdgeChanges:j}=y(),E=_||M,k=v||w,$=E.map(P=>{const A=N.get(P.id);return A&&(A.selected=!1),Do(P.id,!1)}),T=k.map(P=>Do(P.id,!1));C($),j(T)},setMinZoom:_=>{const{panZoom:v,maxZoom:w}=y();v==null||v.setScaleExtent([_,w]),f({minZoom:_})},setMaxZoom:_=>{const{panZoom:v,minZoom:w}=y();v==null||v.setScaleExtent([w,_]),f({maxZoom:_})},setTranslateExtent:_=>{var v;(v=y().panZoom)==null||v.setTranslateExtent(_),f({translateExtent:_})},resetSelectedElements:()=>{const{edges:_,nodes:v,triggerNodeChanges:w,triggerEdgeChanges:M,elementsSelectable:N}=y();if(!N)return;const C=v.reduce((E,k)=>k.selected?[...E,Do(k.id,!1)]:E,[]),j=_.reduce((E,k)=>k.selected?[...E,Do(k.id,!1)]:E,[]);w(C),M(j)},setNodeExtent:_=>{const{nodes:v,nodeLookup:w,parentLookup:M,nodeOrigin:N,elevateNodesOnSelect:C,nodeExtent:j}=y();_[0][0]===j[0][0]&&_[0][1]===j[0][1]&&_[1][0]===j[1][0]&&_[1][1]===j[1][1]||(Fh(v,w,M,{nodeOrigin:N,nodeExtent:_,elevateNodesOnSelect:C,checkEquality:!1}),f({nodeExtent:_}))},panBy:_=>{const{transform:v,width:w,height:M,panZoom:N,translateExtent:C}=y();return kT({delta:_,panZoom:N,transform:v,translateExtent:C,width:w,height:M})},setCenter:async(_,v,w)=>{const{width:M,height:N,maxZoom:C,panZoom:j}=y();if(!j)return Promise.resolve(!1);const E=typeof(w==null?void 0:w.zoom)<"u"?w.zoom:C;return await j.setViewport({x:M/2-_*E,y:N/2-v*E,zoom:E},{duration:w==null?void 0:w.duration,ease:w==null?void 0:w.ease,interpolate:w==null?void 0:w.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{f({connection:{...Ix}})},updateConnection:_=>{f({connection:_})},reset:()=>f({...A0()})}},Object.is);function Y2({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:s,initialWidth:r,initialHeight:i,initialMinZoom:l,initialMaxZoom:u,initialFitViewOptions:d,fitView:h,nodeOrigin:p,nodeExtent:m,children:f}){const[y]=b.useState(()=>W2({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:h,minZoom:l,maxZoom:u,fitViewOptions:d,nodeOrigin:p,nodeExtent:m}));return o.jsx(u$,{value:y,children:o.jsx(P$,{children:f})})}function K2({children:e,nodes:t,edges:n,defaultNodes:s,defaultEdges:r,width:i,height:l,fitView:u,fitViewOptions:d,minZoom:h,maxZoom:p,nodeOrigin:m,nodeExtent:f}){return b.useContext(hd)?o.jsx(o.Fragment,{children:e}):o.jsx(Y2,{initialNodes:t,initialEdges:n,defaultNodes:s,defaultEdges:r,initialWidth:i,initialHeight:l,fitView:u,initialFitViewOptions:d,initialMinZoom:h,initialMaxZoom:p,nodeOrigin:m,nodeExtent:f,children:e})}const G2={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function X2({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:r,nodeTypes:i,edgeTypes:l,onNodeClick:u,onEdgeClick:d,onInit:h,onMove:p,onMoveStart:m,onMoveEnd:f,onConnect:y,onConnectStart:x,onConnectEnd:_,onClickConnectStart:v,onClickConnectEnd:w,onNodeMouseEnter:M,onNodeMouseMove:N,onNodeMouseLeave:C,onNodeContextMenu:j,onNodeDoubleClick:E,onNodeDragStart:k,onNodeDrag:$,onNodeDragStop:T,onNodesDelete:P,onEdgesDelete:A,onDelete:D,onSelectionChange:F,onSelectionDragStart:R,onSelectionDrag:z,onSelectionDragStop:q,onSelectionContextMenu:V,onSelectionStart:U,onSelectionEnd:W,onBeforeDelete:B,connectionMode:I,connectionLineType:H=ja.Bezier,connectionLineStyle:J,connectionLineComponent:G,connectionLineContainerStyle:Y,deleteKeyCode:X="Backspace",selectionKeyCode:Z="Shift",selectionOnDrag:ee=!1,selectionMode:Q=rc.Full,panActivationKeyCode:ne="Space",multiSelectionKeyCode:he=uc()?"Meta":"Control",zoomActivationKeyCode:ye=uc()?"Meta":"Control",snapToGrid:ge,snapGrid:Ee,onlyRenderVisibleElements:De=!1,selectNodesOnDrag:ke,nodesDraggable:le,autoPanOnNodeFocus:pe,nodesConnectable:be,nodesFocusable:Te,nodeOrigin:Ie=zb,edgesFocusable:ue,edgesReconnectable:$e,elementsSelectable:Ye=!0,defaultViewport:et=N$,minZoom:We=.5,maxZoom:mt=2,translateExtent:rt=sc,preventScrolling:ft=!0,nodeExtent:bt,defaultMarkerColor:zt="#b1b1b7",zoomOnScroll:Xe=!0,zoomOnPinch:Ft=!0,panOnScroll:Kt=!1,panOnScrollSpeed:Et=.5,panOnScrollMode:Qt=Lo.Free,zoomOnDoubleClick:wn=!0,panOnDrag:Mt=!0,onPaneClick:Zt,onPaneMouseEnter:Nn,onPaneMouseMove:Bt,onPaneMouseLeave:dt,onPaneScroll:Tn,onPaneContextMenu:Xt,paneClickDistance:Nt=1,nodeClickDistance:at=0,children:os,onReconnect:Vt,onReconnectStart:pt,onReconnectEnd:yt,onEdgeContextMenu:Gn,onEdgeDoubleClick:mn,onEdgeMouseEnter:vn,onEdgeMouseMove:nn,onEdgeMouseLeave:jn,reconnectRadius:Jt=10,onNodesChange:Xn,onEdgesChange:$t,noDragClassName:$n="nodrag",noWheelClassName:xn="nowheel",noPanClassName:fn="nopan",fitView:ws,fitViewOptions:Pn,connectOnClick:Ns,attributionPosition:Qn,proOptions:is,defaultEdgeOptions:js,elevateNodesOnSelect:Fn,elevateEdgesOnSelect:Zn,disableKeyboardA11y:Ht=!1,autoPanOnConnect:Qe,autoPanOnNodeDrag:Ue,autoPanSpeed:Ln,connectionRadius:Cs,isValidConnection:Jn,onError:Ss,style:ie,id:xe,nodeDragThreshold:Le,connectionDragThreshold:jt,viewport:Ce,onViewportChange:ot,width:lt,height:Rt,colorMode:kt="light",debug:Ut,onScroll:At,ariaLabelConfig:sn,...ls},Cn){const en=xe||"1",rn=S$(kt),Bn=b.useCallback(Sn=>{Sn.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),At==null||At(Sn)},[At]);return o.jsx("div",{"data-testid":"rf__wrapper",...ls,onScroll:Bn,style:{...ie,...G2},ref:Cn,className:Lt(["react-flow",r,rn]),id:xe,role:"application",children:o.jsxs(K2,{nodes:e,edges:t,width:lt,height:Rt,fitView:ws,fitViewOptions:Pn,minZoom:We,maxZoom:mt,nodeOrigin:Ie,nodeExtent:bt,children:[o.jsx(V2,{onInit:h,onNodeClick:u,onEdgeClick:d,onNodeMouseEnter:M,onNodeMouseMove:N,onNodeMouseLeave:C,onNodeContextMenu:j,onNodeDoubleClick:E,nodeTypes:i,edgeTypes:l,connectionLineType:H,connectionLineStyle:J,connectionLineComponent:G,connectionLineContainerStyle:Y,selectionKeyCode:Z,selectionOnDrag:ee,selectionMode:Q,deleteKeyCode:X,multiSelectionKeyCode:he,panActivationKeyCode:ne,zoomActivationKeyCode:ye,onlyRenderVisibleElements:De,defaultViewport:et,translateExtent:rt,minZoom:We,maxZoom:mt,preventScrolling:ft,zoomOnScroll:Xe,zoomOnPinch:Ft,zoomOnDoubleClick:wn,panOnScroll:Kt,panOnScrollSpeed:Et,panOnScrollMode:Qt,panOnDrag:Mt,onPaneClick:Zt,onPaneMouseEnter:Nn,onPaneMouseMove:Bt,onPaneMouseLeave:dt,onPaneScroll:Tn,onPaneContextMenu:Xt,paneClickDistance:Nt,nodeClickDistance:at,onSelectionContextMenu:V,onSelectionStart:U,onSelectionEnd:W,onReconnect:Vt,onReconnectStart:pt,onReconnectEnd:yt,onEdgeContextMenu:Gn,onEdgeDoubleClick:mn,onEdgeMouseEnter:vn,onEdgeMouseMove:nn,onEdgeMouseLeave:jn,reconnectRadius:Jt,defaultMarkerColor:zt,noDragClassName:$n,noWheelClassName:xn,noPanClassName:fn,rfId:en,disableKeyboardA11y:Ht,nodeExtent:bt,viewport:Ce,onViewportChange:ot}),o.jsx(C$,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:y,onConnectStart:x,onConnectEnd:_,onClickConnectStart:v,onClickConnectEnd:w,nodesDraggable:le,autoPanOnNodeFocus:pe,nodesConnectable:be,nodesFocusable:Te,edgesFocusable:ue,edgesReconnectable:$e,elementsSelectable:Ye,elevateNodesOnSelect:Fn,elevateEdgesOnSelect:Zn,minZoom:We,maxZoom:mt,nodeExtent:bt,onNodesChange:Xn,onEdgesChange:$t,snapToGrid:ge,snapGrid:Ee,connectionMode:I,translateExtent:rt,connectOnClick:Ns,defaultEdgeOptions:js,fitView:ws,fitViewOptions:Pn,onNodesDelete:P,onEdgesDelete:A,onDelete:D,onNodeDragStart:k,onNodeDrag:$,onNodeDragStop:T,onSelectionDrag:z,onSelectionDragStart:R,onSelectionDragStop:q,onMove:p,onMoveStart:m,onMoveEnd:f,noPanClassName:fn,nodeOrigin:Ie,rfId:en,autoPanOnConnect:Qe,autoPanOnNodeDrag:Ue,autoPanSpeed:Ln,onError:Ss,connectionRadius:Cs,isValidConnection:Jn,selectNodesOnDrag:ke,nodeDragThreshold:Le,connectionDragThreshold:jt,onBeforeDelete:B,debug:Ut,ariaLabelConfig:sn}),o.jsx(w$,{onSelectionChange:F}),os,o.jsx(_$,{proOptions:is,position:Qn}),o.jsx(g$,{rfId:en,disableKeyboardA11y:Ht})]})})}Gb(X2);function Q2({dimensions:e,lineWidth:t,variant:n,className:s}){return o.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:Lt(["react-flow__background-pattern",n,s])})}function Z2({radius:e,className:t}){return o.jsx("circle",{cx:e,cy:e,r:e,className:Lt(["react-flow__background-pattern","dots",t])})}var Ea;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ea||(Ea={}));const J2={[Ea.Dots]:1,[Ea.Lines]:1,[Ea.Cross]:6},eP=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function O0({id:e,variant:t=Ea.Dots,gap:n=20,size:s,lineWidth:r=1,offset:i=0,color:l,bgColor:u,style:d,className:h,patternClassName:p}){const m=b.useRef(null),{transform:f,patternId:y}=St(eP,dn),x=s||J2[t],_=t===Ea.Dots,v=t===Ea.Cross,w=Array.isArray(n)?n:[n,n],M=[w[0]*f[2]||1,w[1]*f[2]||1],N=x*f[2],C=Array.isArray(i)?i:[i,i],j=v?[N,N]:M,E=[C[0]*f[2]||1+j[0]/2,C[1]*f[2]||1+j[1]/2],k=`${y}${e||""}`;return o.jsxs("svg",{className:Lt(["react-flow__background",h]),style:{...d,..._d,"--xy-background-color-props":u,"--xy-background-pattern-color-props":l},ref:m,"data-testid":"rf__background",children:[o.jsx("pattern",{id:k,x:f[0]%M[0],y:f[1]%M[1],width:M[0],height:M[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:_?o.jsx(Z2,{radius:N/2,className:p}):o.jsx(Q2,{dimensions:j,lineWidth:r,variant:t,className:p})}),o.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${k})`})]})}O0.displayName="Background",b.memo(O0);function tP(){return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:o.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function nP(){return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:o.jsx("path",{d:"M0 0h32v4.2H0z"})})}function sP(){return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:o.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function rP(){return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:o.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function aP(){return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:o.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function bd({children:e,className:t,...n}){return o.jsx("button",{type:"button",className:Lt(["react-flow__controls-button",t]),...n,children:e})}const oP=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function T0({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:r,onZoomIn:i,onZoomOut:l,onFitView:u,onInteractiveChange:d,className:h,children:p,position:m="bottom-left",orientation:f="vertical","aria-label":y}){const x=tn(),{isInteractive:_,minZoomReached:v,maxZoomReached:w,ariaLabelConfig:M}=St(oP,dn),{zoomIn:N,zoomOut:C,fitView:j}=Xh(),E=()=>{N(),i==null||i()},k=()=>{C(),l==null||l()},$=()=>{j(r),u==null||u()},T=()=>{x.setState({nodesDraggable:!_,nodesConnectable:!_,elementsSelectable:!_}),d==null||d(!_)},P=f==="horizontal"?"horizontal":"vertical";return o.jsxs(pd,{className:Lt(["react-flow__controls",P,h]),position:m,style:e,"data-testid":"rf__controls","aria-label":y??M["controls.ariaLabel"],children:[t&&o.jsxs(o.Fragment,{children:[o.jsx(bd,{onClick:E,className:"react-flow__controls-zoomin",title:M["controls.zoomIn.ariaLabel"],"aria-label":M["controls.zoomIn.ariaLabel"],disabled:w,children:o.jsx(tP,{})}),o.jsx(bd,{onClick:k,className:"react-flow__controls-zoomout",title:M["controls.zoomOut.ariaLabel"],"aria-label":M["controls.zoomOut.ariaLabel"],disabled:v,children:o.jsx(nP,{})})]}),n&&o.jsx(bd,{className:"react-flow__controls-fitview",onClick:$,title:M["controls.fitView.ariaLabel"],"aria-label":M["controls.fitView.ariaLabel"],children:o.jsx(sP,{})}),s&&o.jsx(bd,{className:"react-flow__controls-interactive",onClick:T,title:M["controls.interactive.ariaLabel"],"aria-label":M["controls.interactive.ariaLabel"],children:_?o.jsx(aP,{}):o.jsx(rP,{})}),p]})}T0.displayName="Controls",b.memo(T0);function iP({id:e,x:t,y:n,width:s,height:r,style:i,color:l,strokeColor:u,strokeWidth:d,className:h,borderRadius:p,shapeRendering:m,selected:f,onClick:y}){const{background:x,backgroundColor:_}=i||{},v=l||x||_;return o.jsx("rect",{className:Lt(["react-flow__minimap-node",{selected:f},h]),x:t,y:n,rx:p,ry:p,width:s,height:r,style:{fill:v,stroke:u,strokeWidth:d},shapeRendering:m,onClick:y?w=>y(w,e):void 0})}const lP=b.memo(iP),cP=e=>e.nodes.map(t=>t.id),ep=e=>e instanceof Function?e:()=>e;function uP({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:r,nodeComponent:i=lP,onClick:l}){const u=St(cP,dn),d=ep(t),h=ep(e),p=ep(n),m=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return o.jsx(o.Fragment,{children:u.map(f=>o.jsx(mP,{id:f,nodeColorFunc:d,nodeStrokeColorFunc:h,nodeClassNameFunc:p,nodeBorderRadius:s,nodeStrokeWidth:r,NodeComponent:i,onClick:l,shapeRendering:m},f))})}function dP({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:s,nodeBorderRadius:r,nodeStrokeWidth:i,shapeRendering:l,NodeComponent:u,onClick:d}){const{node:h,x:p,y:m,width:f,height:y}=St(x=>{const{internals:_}=x.nodeLookup.get(e),v=_.userNode,{x:w,y:M}=_.positionAbsolute,{width:N,height:C}=Gr(v);return{node:v,x:w,y:M,width:N,height:C}},dn);return!h||h.hidden||!Gx(h)?null:o.jsx(u,{x:p,y:m,width:f,height:y,style:h.style,selected:!!h.selected,className:s(h),color:t(h),borderRadius:r,strokeColor:n(h),strokeWidth:i,shapeRendering:l,onClick:d,id:h.id})}const mP=b.memo(dP);var fP=b.memo(uP);const hP=200,pP=150,gP=e=>!e.hidden,_P=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?Yx(oc(e.nodeLookup,{filter:gP}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},yP="react-flow__minimap-desc";function $0({style:e,className:t,nodeStrokeColor:n,nodeColor:s,nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:l,nodeComponent:u,bgColor:d,maskColor:h,maskStrokeColor:p,maskStrokeWidth:m,position:f="bottom-right",onClick:y,onNodeClick:x,pannable:_=!1,zoomable:v=!1,ariaLabel:w,inversePan:M,zoomStep:N=1,offsetScale:C=5}){const j=tn(),E=b.useRef(null),{boundingRect:k,viewBB:$,rfId:T,panZoom:P,translateExtent:A,flowWidth:D,flowHeight:F,ariaLabelConfig:R}=St(_P,dn),z=(e==null?void 0:e.width)??hP,q=(e==null?void 0:e.height)??pP,V=k.width/z,U=k.height/q,W=Math.max(V,U),B=W*z,I=W*q,H=C*W,J=k.x-(B-k.width)/2-H,G=k.y-(I-k.height)/2-H,Y=B+H*2,X=I+H*2,Z=`${yP}-${T}`,ee=b.useRef(0),Q=b.useRef();ee.current=W,b.useEffect(()=>{if(E.current&&P)return Q.current=zT({domNode:E.current,panZoom:P,getTransform:()=>j.getState().transform,getViewScale:()=>ee.current}),()=>{var ge;(ge=Q.current)==null||ge.destroy()}},[P]),b.useEffect(()=>{var ge;(ge=Q.current)==null||ge.update({translateExtent:A,width:D,height:F,inversePan:M,pannable:_,zoomStep:N,zoomable:v})},[_,v,M,N,A,D,F]);const ne=y?ge=>{var ke;const[Ee,De]=((ke=Q.current)==null?void 0:ke.pointer(ge))||[0,0];y(ge,{x:Ee,y:De})}:void 0,he=x?b.useCallback((ge,Ee)=>{const De=j.getState().nodeLookup.get(Ee).internals.userNode;x(ge,De)},[]):void 0,ye=w??R["minimap.ariaLabel"];return o.jsx(pd,{position:f,style:{...e,"--xy-minimap-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-background-color-props":typeof h=="string"?h:void 0,"--xy-minimap-mask-stroke-color-props":typeof p=="string"?p:void 0,"--xy-minimap-mask-stroke-width-props":typeof m=="number"?m*W:void 0,"--xy-minimap-node-background-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof l=="number"?l:void 0},className:Lt(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:o.jsxs("svg",{width:z,height:q,viewBox:`${J} ${G} ${Y} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Z,ref:E,onClick:ne,children:[ye&&o.jsx("title",{id:Z,children:ye}),o.jsx(fP,{onClick:he,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:r,nodeStrokeWidth:l,nodeComponent:u}),o.jsx("path",{className:"react-flow__minimap-mask",d:`M${J-H},${G-H}h${Y+H*2}v${X+H*2}h${-Y-H*2}z
        M${$.x},${$.y}h${$.width}v${$.height}h${-$.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}$0.displayName="MiniMap",b.memo($0);const vP=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,xP={[Hi.Line]:"right",[Hi.Handle]:"bottom-right"};function bP({nodeId:e,position:t,variant:n=Hi.Handle,className:s,style:r=void 0,children:i,color:l,minWidth:u=10,minHeight:d=10,maxWidth:h=Number.MAX_VALUE,maxHeight:p=Number.MAX_VALUE,keepAspectRatio:m=!1,resizeDirection:f,autoScale:y=!0,shouldResize:x,onResizeStart:_,onResize:v,onResizeEnd:w}){const M=t0(),N=typeof e=="string"?e:M,C=tn(),j=b.useRef(null),E=n===Hi.Handle,k=St(b.useCallback(vP(E&&y),[E,y]),dn),$=b.useRef(null),T=t??xP[n];b.useEffect(()=>{if(!(!j.current||!N))return $.current||($.current=ZT({domNode:j.current,nodeId:N,getStoreItems:()=>{const{nodeLookup:A,transform:D,snapGrid:F,snapToGrid:R,nodeOrigin:z,domNode:q}=C.getState();return{nodeLookup:A,transform:D,snapGrid:F,snapToGrid:R,nodeOrigin:z,paneDomNode:q}},onChange:(A,D)=>{const{triggerNodeChanges:F,nodeLookup:R,parentLookup:z,nodeOrigin:q}=C.getState(),V=[],U={x:A.x,y:A.y},W=R.get(N);if(W&&W.expandParent&&W.parentId){const B=W.origin??q,I=A.width??W.measured.width??0,H=A.height??W.measured.height??0,J={id:W.id,parentId:W.parentId,rect:{width:I,height:H,...Xx({x:A.x??W.position.x,y:A.y??W.position.y},{width:I,height:H},W.parentId,R,B)}},G=Uh([J],R,z,q);V.push(...G),U.x=A.x?Math.max(B[0]*I,A.x):void 0,U.y=A.y?Math.max(B[1]*H,A.y):void 0}if(U.x!==void 0&&U.y!==void 0){const B={id:N,type:"position",position:{...U}};V.push(B)}if(A.width!==void 0&&A.height!==void 0){const I={id:N,type:"dimensions",resizing:!0,setAttributes:f?f==="horizontal"?"width":"height":!0,dimensions:{width:A.width,height:A.height}};V.push(I)}for(const B of D){const I={...B,type:"position"};V.push(I)}F(V)},onEnd:({width:A,height:D})=>{const F={id:N,type:"dimensions",resizing:!1,dimensions:{width:A,height:D}};C.getState().triggerNodeChanges([F])}})),$.current.update({controlPosition:T,boundaries:{minWidth:u,minHeight:d,maxWidth:h,maxHeight:p},keepAspectRatio:m,resizeDirection:f,onResizeStart:_,onResize:v,onResizeEnd:w,shouldResize:x}),()=>{var A;(A=$.current)==null||A.destroy()}},[T,u,d,h,p,m,_,v,w,x]);const P=T.split("-");return o.jsx("div",{className:Lt(["react-flow__resize-control","nodrag",...P,n,s]),ref:j,style:{...r,scale:k,...l&&{[E?"backgroundColor":"borderColor"]:l}},children:i})}b.memo(bP);const wP=(e,t,n)=>{var r;const s=new Array(t);for(let i=0;i<t;i++){const l=new Array(e);for(let u=0;u<e;u++){const d=!!(n&&(r=n[i])!=null&&r[u]),h=n?!d:!0;l[u]={x:u,y:i,walkable:h}}s[i]=l}return s},tp=(e,t,n,s)=>n>=0&&n<e&&s>=0&&s<t,P0=(e,t,n)=>{const s=wP(e,t,n),r=(l,u)=>s[u][l],i=(l,u)=>tp(e,t,l,u)&&s[u][l].walkable;return{width:e,height:t,nodes:s,getNodeAt:r,isWalkableAt:i,setWalkableAt:(l,u,d)=>{tp(e,t,l,u)&&(s[u][l].walkable=d)},getNeighbors:(l,u)=>{const d=l.x,h=l.y,p=[],m=i(d,h-1),f=i(d+1,h),y=i(d,h+1),x=i(d-1,h);m&&p.push(r(d,h-1)),f&&p.push(r(d+1,h)),y&&p.push(r(d,h+1)),x&&p.push(r(d-1,h));const _=i(d+1,h-1),v=i(d+1,h+1),w=i(d-1,h+1),M=i(d-1,h-1);return u==="Never"||(_&&p.push(r(d+1,h-1)),v&&p.push(r(d+1,h+1)),w&&p.push(r(d-1,h+1)),M&&p.push(r(d-1,h-1))),p},isInside:(l,u)=>tp(e,t,l,u),clone:()=>{const l=s.map(u=>u.map(d=>d.walkable?0:1));return P0(e,t,l)}}},np=(e,t)=>{switch(t){case"top":return{x:e.x,y:e.y-1};case"bottom":return{x:e.x,y:e.y+1};case"left":return{x:e.x-1,y:e.y};case"right":return{x:e.x+1,y:e.y}}},L0=(e,t,n)=>{let s=e.getNodeAt(t.x,t.y);for(;!s.walkable;){e.setWalkableAt(s.x,s.y,!0);const r=np(s,n);s=e.getNodeAt(r.x,r.y)}},wd=(e,t,n,s)=>{const r=(e.x-t)/s+1,i=(e.y-n)/s+1;return{x:r,y:i}},R0=(e,t,n,s)=>{const r=(e.x-1)*s+t,i=(e.y-1)*s+n;return{x:r,y:i}},Nd=(e,t=10)=>Math.round(e/t)*t,Vi=(e,t=10)=>Math.floor(e/t)*t,Ma=(e,t=10)=>Math.ceil(e/t)*t,D0=(e,t=0)=>{let n=Math.max(Math.round(e),t);return n=Number.isInteger(n)?n:t,n=n>=t?n:t,n},NP=(e,t,n,s,r=2)=>{const{xMin:i,yMin:l,width:u,height:d}=e,h=Ma(u,r)/r+1,p=Ma(d,r)/r+1,m=P0(h,p);t.forEach(M=>{const N=wd(M.topLeft,i,l,r),C=wd(M.bottomRight,i,l,r);for(let j=N.x;j<C.x;j++)for(let E=N.y;E<C.y;E++)m.setWalkableAt(j,E,!1)});const f=wd({x:Nd(n.x,r),y:Nd(n.y,r)},i,l,r),y=wd({x:Nd(s.x,r),y:Nd(s.y,r)},i,l,r),x=m.getNodeAt(f.x,f.y);L0(m,x,n.position);const _=m.getNodeAt(y.x,y.y);L0(m,_,s.position);const v=np(x,n.position),w=np(_,s.position);return{grid:m,start:v,end:w}},jP=(e,t,n)=>{const s=[[e.x,e.y],...n,[t.x,t.y]];return CP(s)},CP=e=>{let t=e[0];const n=e[0];let s=`M${String(n[0])},${String(n[1])}M`;for(const i of e){const l=SP(t[0],t[1],i[0],i[1]);s+=` ${String(l[0])},${String(l[1])}`,s+=`Q${String(i[0])},${String(i[1])}`,t=i}const r=e[e.length-1];return s+=` ${String(r[0])},${String(r[1])}`,s},SP=(e,t,n,s)=>{const r=(e-n)/2+n,i=(t-s)/2+s;return[r,i]},EP=(e,t)=>e+t,MP=(e,t)=>{const n=Math.SQRT2-1;return e<t?n*e+t:n*t+e},kP=e=>{const t=[];let n=e;for(;n;)t.push([n.x,n.y]),n=n.parent;return t.reverse()},AP=e=>e==="Never"?EP:MP,OP=e=>{let t=0;for(let n=1;n<e.length;n++)(e[n].estimatedTotalCost??1/0)<(e[t].estimatedTotalCost??1/0)&&(t=n);return e.splice(t,1)[0]},TP=(e,t,n,s,r,i)=>{if(e.closed)return;const l=Math.abs(e.x-t.x),u=Math.abs(e.y-t.y),d=(t.costFromStart??0)+(l===0||u===0?1:Math.SQRT2);(!e.opened||d<(e.costFromStart??1/0))&&(e.costFromStart=d,e.heuristicCostToGoal=e.heuristicCostToGoal??i*r(Math.abs(e.x-n.x),Math.abs(e.y-n.y)),e.estimatedTotalCost=(e.costFromStart??0)+(e.heuristicCostToGoal??0),e.parent=t,e.opened||(e.opened=!0,s.push(e)))},$P=(e={})=>{const t=e.diagonalMovement??"Never",n=e.heuristic??AP(t),s=e.weight??1;return{findPath:(r,i,l,u,d)=>{const h=d.getNodeAt(r,i),p=d.getNodeAt(l,u),m=[];for(h.costFromStart=0,h.heuristicCostToGoal=0,h.estimatedTotalCost=0,h.opened=!0,m.push(h);m.length>0;){const f=OP(m);if(f.closed=!0,f===p)return kP(p);const y=d.getNeighbors(f,t);for(const x of y)TP(x,f,p,m,n,s)}return[]}}},PP=(e,t,n)=>{try{const s=$P({diagonalMovement:"Always"}).findPath(t.x,t.y,n.x,n.y,e);if(s.length===0)throw new Error("No path found");return s}catch(s){throw s instanceof Error?s:new Error(`Unknown error: ${String(s)}`)}},LP=(e,t=2,n=2)=>{let s=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;const u=e.map(_=>{var k,$;const v=Math.max(((k=_.measured)==null?void 0:k.width)??0,1),w=Math.max((($=_.measured)==null?void 0:$.height)??0,1),M={x:_.position.x,y:_.position.y},N={x:M.x-t,y:M.y-t},C={x:M.x-t,y:M.y+w+t},j={x:M.x+v+t,y:M.y-t},E={x:M.x+v+t,y:M.y+w+t};return n>0&&(N.x=Vi(N.x,n),N.y=Vi(N.y,n),C.x=Vi(C.x,n),C.y=Ma(C.y,n),j.x=Ma(j.x,n),j.y=Vi(j.y,n),E.x=Ma(E.x,n),E.y=Ma(E.y,n)),N.y<l&&(l=N.y),N.x<i&&(i=N.x),E.y>r&&(r=E.y),E.x>s&&(s=E.x),{id:_.id,width:v,height:w,topLeft:N,bottomLeft:C,topRight:j,bottomRight:E}}),d=t*2;s=Ma(s+d,n),r=Ma(r+d,n),i=Vi(i-d,n),l=Vi(l-d,n);const h={x:i,y:l},p={x:i,y:r},m={x:s,y:l},f={x:s,y:r},y=Math.abs(h.x-m.x),x=Math.abs(h.y-p.y);return{nodeBoxes:u,graphBox:{topLeft:h,bottomLeft:p,topRight:m,bottomRight:f,width:y,height:x,xMax:s,yMax:r,xMin:i,yMin:l}}},RP=({options:e={},nodes:t=[],sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:l,targetPosition:u})=>{var d;try{const{drawEdge:h=jP,generatePath:p=PP}=e;let{gridRatio:m=10,nodePadding:f=10}=e;m=D0(m),f=D0(f);const{graphBox:y,nodeBoxes:x}=LP(t,f,m);(d=e.debug)!=null&&d.enabled&&e.debug.setGraphBox&&e.debug.setGraphBox({x:y.topLeft.x,y:y.topLeft.y,width:y.width,height:y.height});const _={x:n,y:s,position:l},v={x:r,y:i,position:u},{grid:w,start:M,end:N}=NP(y,x,_,v,m),C=p(w,M,N),j=C.map(F=>{const[R,z]=F,q=R0({x:R,y:z},y.xMin,y.yMin,m);return[q.x,q.y]}),E=h(_,v,j),k=Math.floor(C.length/2),$=C[k],[T,P]=$,{x:A,y:D}=R0({x:T,y:P},y.xMin,y.yMin,m);return{svgPathString:E,edgeCenterX:A,edgeCenterY:D}}catch(h){return h instanceof Error?h:new Error(`Unknown error: ${String(h)}`)}};b.createContext({enabled:!1,graphBox:null,setGraphBox:()=>{}});const DP=e=>Number.isFinite(e),jd=e=>Math.round(e*100)/100,zP=(e,t,n,s)=>{if(e===n&&t===s)return`M ${e},${t}`;const r=Math.abs(n-e),i=Math.abs(s-t),l=Math.sqrt(r*r+i*i),u=Math.max(80,Math.min(l*.4,280)),d=Number.isFinite(u)?u:120,h=n>=e?1:-1,p=Math.min(Math.abs(s-t)*.2,50),m=e+h*d,f=t+(s>t?p:-p),y=n-h*d,x=s-(s>t?p:-p);return`M ${e},${t} C ${m},${f} ${y},${x} ${n},${s}`},IP=({id:e,sourceX:t,sourceY:n,targetX:s,targetY:r,sourcePosition:i=Pe.Bottom,targetPosition:l=Pe.Top,markerEnd:u,style:d})=>{const{setEdges:h,getNodes:p}=uh(),[m,f]=b.useState(!1),y=b.useCallback(()=>{f(!0)},[]),x=b.useCallback(()=>{f(!1)},[]),_=b.useMemo(()=>[t,n,s,r].every(R=>DP(R))?{sourceX:jd(t),sourceY:jd(n),targetX:jd(s),targetY:jd(r)}:(console.error(` Edge ${e}: Invalid coordinates`,{sourceX:t,sourceY:n,targetX:s,targetY:r}),null),[t,n,s,r,e]),v=b.useMemo(()=>{if(!_)return null;const{sourceX:R,sourceY:z,targetX:q,targetY:V}=_;try{const I=p().map(J=>({...J,width:J.width&&J.width>0?J.width:320,height:J.height&&J.height>0?J.height:170})),H=RP({sourcePosition:i,targetPosition:l,sourceX:R,sourceY:z,targetX:q,targetY:V,nodes:I,options:{nodePadding:40,gridRatio:10}});if(H&&"svgPathString"in H){const{svgPathString:J,edgeCenterX:G,edgeCenterY:Y}=H;return{path:J,labelX:G,labelY:Y}}}catch{}const U=zP(R,z,q,V),W=(R+q)/2,B=(z+V)/2;return{path:U,labelX:W,labelY:B}},[_,i,l,p]),w=b.useMemo(()=>`animated-edge-gradient-${e}`,[e]);if(!_||!v)return null;const{sourceX:M,sourceY:N,targetX:C,targetY:j}=_,{path:E,labelX:k,labelY:$}=v,T=40,P=k-T/2,A=$-T/2,D=`animated-edge${m?" animated-edge--hovered":""}`,F=`canvas-edge-remove${m?" canvas-edge-remove--visible":""}`;return o.jsxs("g",{className:D,onMouseEnter:y,onMouseLeave:x,children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:w,gradientUnits:"userSpaceOnUse",x1:M,y1:N,x2:C,y2:j,children:[o.jsx("stop",{offset:"0%",stopColor:"#38bdf8",stopOpacity:.85}),o.jsx("stop",{offset:"50%",stopColor:"#6366f1",stopOpacity:.95}),o.jsx("stop",{offset:"100%",stopColor:"#a855f7",stopOpacity:.9})]}),o.jsxs("filter",{id:`edge-glow-${e}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[o.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),o.jsx("path",{d:E,fill:"none",stroke:"transparent",strokeWidth:40,style:{cursor:"pointer"},className:"animated-edge__interaction"}),o.jsx("path",{d:E,fill:"none",stroke:`url(#${w})`,strokeWidth:6,strokeOpacity:.2,strokeLinecap:"round",strokeLinejoin:"round",style:{filter:`url(#edge-glow-${e})`}}),o.jsx("path",{d:E,fill:"none",stroke:`url(#${w})`,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",markerEnd:u,className:"animated-edge__base",style:{...d,transition:"stroke-width 0.2s ease"}}),o.jsx("path",{d:E,fill:"none",stroke:`url(#${w})`,strokeWidth:m?3.5:3,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"16 12",className:"animated-edge__trail",style:{transition:"stroke-width 0.2s ease"}}),o.jsx("path",{d:E,fill:"none",stroke:"rgba(248, 250, 252, 0.4)",strokeWidth:1.5,strokeDasharray:"3 8",strokeLinecap:"round",strokeLinejoin:"round",className:"animated-edge__spark"}),o.jsx("foreignObject",{className:F,x:P,y:A,width:T,height:T,requiredExtensions:"http://www.w3.org/1999/xhtml",children:o.jsx("div",{className:"canvas-edge-remove__wrapper",children:o.jsx("button",{type:"button",className:"canvas-edge-remove__button",onClick:R=>{R.stopPropagation(),h(z=>z.filter(q=>q.id!==e))},"aria-label":"Remove connection",children:""})})})]})},FP=({thresholdParameter:e,dropColumnParameter:t,renderParameterField:n,renderMultiSelectField:s})=>o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Missingness recommendations"})}),e&&n(e),s(t)]}),BP=({thresholdParameter:e,dropIfAnyParameter:t,renderParameterField:n})=>!e&&!t?null:o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Row missingness"})}),e&&n(e),t&&n(t)]}),z0="first",UP=[{value:"first",label:"Keep first occurrence"},{value:"last",label:"Keep last occurrence"},{value:"none",label:"Drop all duplicates"}],HP=({sourceId:e,hasReachableSource:t,removeDuplicatesColumnsParameter:n,removeDuplicatesKeepParameter:s,renderMultiSelectField:r,removeDuplicatesKeepSelectId:i,removeDuplicatesKeep:l,onKeepChange:u})=>{if(!n&&!s)return null;const d=h=>{const p=h.target.value;u(p==="last"||p==="none"?p:"first")};return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Duplicate handling"})}),o.jsx("p",{className:"canvas-modal__note",children:"Choose comparison columns and decide whether to keep the first row, last row, or drop all duplicates."}),e?t?null:o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to inspect its columns."}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to load the available columns for duplicate checks."}),n&&o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Columns to compare"}),r(n)]}),s&&o.jsxs("div",{className:"canvas-modal__parameter-field",children:[o.jsx("label",{htmlFor:i,className:"canvas-modal__parameter-label",children:s.label??"Keep strategy"}),s.description&&o.jsx("p",{className:"canvas-modal__parameter-description",children:s.description}),o.jsx("div",{className:"canvas-modal__parameter-control",children:o.jsx("select",{id:i,value:l,onChange:d,children:UP.map(h=>o.jsx("option",{value:h.value,children:h.label},h.value))})})]})]})},Ge=e=>Array.isArray(e)?e.map(t=>String(t??"").trim()).filter(t=>t.length>0):[],qP=["float64","Int64","boolean","string","category","datetime64[ns]","object"],VP=({configState:e,setConfigState:t,availableColumns:n,columnTypeMap:s,columnSuggestions:r,selectedColumns:i,previewColumns:l,previewStatus:u,sourceId:d,hasReachableSource:h})=>{const p=b.useMemo(()=>{const C=e==null?void 0:e.column_overrides;if(!C||typeof C!="object"||Array.isArray(C))return{};const j={};return Object.entries(C).forEach(([E,k])=>{const $=String(E??"").trim();if(!$||typeof k!="string")return;const T=k.trim();T&&(j[$]=T)}),j},[e==null?void 0:e.column_overrides]),m=b.useMemo(()=>{const C=e==null?void 0:e.target_dtype;return typeof C=="string"?C.trim():""},[e==null?void 0:e.target_dtype]),f=b.useMemo(()=>{const C=new Set;return n.forEach(E=>C.add(E)),Object.keys(s).forEach(E=>C.add(E)),Object.keys(r).forEach(E=>C.add(E)),Object.keys(p).forEach(E=>C.add(E)),i.forEach(E=>C.add(E)),l.forEach(E=>{typeof E=="string"&&C.add(E)}),Array.from(C).sort((E,k)=>E.localeCompare(k)).map(E=>{const k=s[E]??"Unknown",$=r[E]??[],T=$.length?$[0]:null,P=Object.prototype.hasOwnProperty.call(p,E),A=P?p[E]:null,D=typeof A=="string"?A.trim():"",F=P?D:m,R=new Set;F&&R.add(F),$.forEach(B=>R.add(B)),k&&k!=="Unknown"&&R.add(k),m&&R.add(m),qP.forEach(B=>R.add(B));const z=F??"",q=!!(T&&T!==z),V=!!(T&&T===z),U=i.includes(E),W=Array.from(R).sort((B,I)=>B.localeCompare(I));return{column:E,originalType:k,recommended:T,currentTarget:F,suggestions:$,options:W,hasRecommendationGap:q,hasOverride:P,usesDefaultTarget:!P,isRecommendationApplied:V,isSelected:U}})},[n,m,p,r,s,l,i]),y=b.useMemo(()=>{const C=f.filter(k=>k.hasRecommendationGap),j=f.filter(k=>!k.hasRecommendationGap),E=[];return C.length&&E.push({key:"needs-attention",label:"Needs attention",rows:C}),j.length&&E.push({key:"all-columns",label:C.length?"Other columns":"All columns",rows:j}),E},[f]),x=b.useMemo(()=>f.filter(C=>C.hasRecommendationGap).length,[f]),_=b.useMemo(()=>x>0,[x]),v=b.useMemo(()=>f.filter(C=>C.isSelected).length,[f]),w=b.useCallback((C,j)=>{const E=C.trim();E&&t(k=>{const $=k.column_overrides&&typeof k.column_overrides=="object"&&!Array.isArray(k.column_overrides)?{...k.column_overrides}:{},T=typeof j=="string"?j.trim():"",P=new Set(Ge(k.columns)),A=new Set(Ge(k.skipped_columns)),D=A.delete(E);T?($[E]=T,P.add(E)):delete $[E];const F={...k,columns:Array.from(P).sort((R,z)=>R.localeCompare(z)),column_overrides:$};return D&&(F.skipped_columns=Array.from(A).sort((R,z)=>R.localeCompare(z))),F})},[t]),M=b.useCallback(()=>{const C=Object.entries(r).filter(([,j])=>j.length>0);C.length&&t(j=>{const E=new Set(Ge(j.columns)),k=j.column_overrides&&typeof j.column_overrides=="object"&&!Array.isArray(j.column_overrides)?{...j.column_overrides}:{};return C.forEach(([$,T])=>{const P=$.trim();P&&(E.add(P),T.length&&(k[P]=T[0]))}),{...j,columns:Array.from(E).sort(($,T)=>$.localeCompare(T)),column_overrides:k}})},[r,t]),N=b.useCallback((C,j)=>{j==="__default__"?w(C,null):w(C,j)},[w]);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Column dtype alignment"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:M,disabled:!_,children:"Apply recommendations"})})]}),!d&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to analyse current column dtypes and suggestions."}),d&&!h&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to load dtype insights."}),m?o.jsxs("p",{className:"canvas-modal__note",children:["Global target dtype: ",o.jsx("strong",{children:m}),". Columns inherit this unless an override is set."]}):o.jsx("p",{className:"canvas-modal__note",children:"Set a global target dtype or override individual columns below."}),f.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",f.length," column",f.length===1?"":"s","  ",v," mapped in node selection."]}),_?o.jsxs("p",{className:"canvas-modal__note",children:[x," column",x===1?"":"s"," need attention. Apply them in bulk or adjust individually."]}):f.length>0&&o.jsx("p",{className:"canvas-modal__note",children:"All recommendations are in sync. Fine-tune overrides per column as needed."}),u==="loading"&&!f.length&&o.jsx("p",{className:"canvas-modal__note",children:"Loading column type insights"}),f.length===0?o.jsx("p",{className:"canvas-modal__note",children:"Add columns or refresh the dataset preview to surface dtype intelligence."}):o.jsx("div",{className:"canvas-cast__body",children:y.map(C=>o.jsxs("div",{className:"canvas-cast__group",children:[C.label&&o.jsxs("div",{className:"canvas-cast__group-header",children:[o.jsx("h4",{children:C.label}),o.jsxs("span",{children:[C.rows.length," column",C.rows.length===1?"":"s"]})]}),o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Original dtype"}),o.jsx("th",{scope:"col",children:"Recommended"}),o.jsx("th",{scope:"col",children:"Target dtype"})]})}),o.jsx("tbody",{children:C.rows.map(j=>{const E=["canvas-cast__row"];j.hasRecommendationGap&&E.push("canvas-cast__row--attention"),j.hasOverride&&E.push("canvas-cast__row--override");const k=j.hasOverride?j.currentTarget||"":"__default__",$=j.isRecommendationApplied,T=j.suggestions.slice(1,4),P=j.hasOverride?j.currentTarget?`Override  ${j.currentTarget}`:"Override cleared (uses original dtype)":m?`Inheriting ${m}`:"Retains original dtype until a target is set";return o.jsxs("tr",{className:E.join(" "),children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:j.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[j.isSelected&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),j.hasOverride&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),!j.isSelected&&!j.hasOverride&&o.jsx("span",{className:"canvas-cast__muted",children:"Not yet in node"})]})]})}),o.jsx("td",{children:o.jsx("span",{className:"canvas-cast__muted",children:j.originalType})}),o.jsx("td",{children:j.recommended?o.jsxs("div",{className:"canvas-cast__recommendation",children:[o.jsx("span",{className:`canvas-cast__chip${j.hasRecommendationGap?" canvas-cast__chip--attention":""}${$?" canvas-cast__chip--applied":""}`,children:j.recommended}),o.jsx("span",{className:"canvas-cast__recommendation-note",children:$?"Aligned with target":"Not applied yet"}),T.length>0&&o.jsxs("span",{className:"canvas-cast__suggestions",children:["Other options: ",T.join(", ")]})]}):o.jsx("span",{className:"canvas-cast__muted",children:"No recommendation"})}),o.jsx("td",{children:o.jsxs("div",{className:"canvas-cast__target",children:[o.jsxs("select",{value:k,onChange:A=>N(j.column,A.target.value),children:[o.jsx("option",{value:"__default__",children:m?`Inherit global (${m})`:"No override (use original)"}),j.options.map(A=>o.jsx("option",{value:A,children:A},`${j.column}-${A}`))]}),o.jsx("span",{className:"canvas-cast__target-note",children:P})]})})]},`cast-row-${j.column}`)})})]})})]},`cast-group-${C.key}`))})]})};async function sp(){const e=await fetch("/ml-workflow/api/node-catalog");if(!e.ok)throw new Error("Failed to load node catalog");return e.json()}async function I0(e=8){const t=await fetch(`/ml-workflow/api/datasets?limit=${encodeURIComponent(String(e))}`);if(!t.ok)throw new Error("Failed to load datasets");return t.json()}async function F0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/label-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load label encoding recommendations");return l.json()}async function B0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/ordinal-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load ordinal encoding suggestions");return l.json()}async function U0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/target-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load target encoding recommendations");return l.json()}async function H0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/hash-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load hash encoding recommendations");return l.json()}async function q0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/one-hot-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load one-hot encoding recommendations");return l.json()}async function V0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/dummy-encoding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load dummy encoding recommendations");return l.json()}async function rp(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/drop-columns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load column drop recommendations");return l.json()}async function W0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i=typeof n=="number"&&Number.isFinite(n)?Math.min(5e3,Math.max(50,Math.round(n))):500,l={dataset_source_id:e,sample_size:i};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(l.graph={nodes:s.nodes,edges:s.edges}),r&&(l.target_node_id=r);const u=await fetch("/ml-workflow/api/recommendations/outliers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load outlier recommendations");return u.json()}async function Y0(e,t={}){const{sampleSize:n=500,transformations:s,graph:r,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:n};Array.isArray(s)?s.length>0&&(l.transformations=JSON.stringify(s)):s&&typeof s=="object"&&Object.keys(s).length>0&&(l.transformations=JSON.stringify(s)),r&&Array.isArray(r.nodes)&&Array.isArray(r.edges)&&(l.graph={nodes:r.nodes,edges:r.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/recommendations/skewness",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw new Error("Failed to load skewness recommendations");return u.json()}async function K0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/scaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load scaling recommendations");return l.json()}async function G0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i={dataset_source_id:e,sample_size:n};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(i.graph={nodes:s.nodes,edges:s.edges}),r&&(i.target_node_id=r);const l=await fetch("/ml-workflow/api/recommendations/binning",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error("Failed to load binning recommendations");return l.json()}async function X0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i=n==="all"?0:typeof n=="number"&&Number.isFinite(n)?Math.max(0,Math.round(n)):500,l={dataset_source_id:e,sample_size:i};s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&(l.graph={nodes:s.nodes,edges:s.edges}),r&&(l.target_node_id=r);const u=await fetch("/ml-workflow/api/analytics/binned-distribution",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok){let d="Failed to load binned column distributions";try{const h=await u.clone().json(),p=typeof(h==null?void 0:h.detail)=="string"&&h.detail.trim()?h.detail.trim():typeof(h==null?void 0:h.error)=="string"&&h.error.trim()?h.error.trim():typeof(h==null?void 0:h.message)=="string"&&h.message.trim()?h.message.trim():null;p&&(d=p)}catch{try{const p=(await u.text()).trim();p&&(d=p)}catch{}}throw new Error(d)}return u.json()}async function Q0(e,t={}){const{sampleSize:n=500,graph:s,targetNodeId:r}=t,i=n==="all"?0:typeof n=="number"&&Number.isFinite(n)?Math.max(0,Math.round(n)):500,l=new URLSearchParams({dataset_source_id:e,sample_size:String(i)});s&&Array.isArray(s.nodes)&&Array.isArray(s.edges)&&l.set("graph",JSON.stringify({nodes:s.nodes,edges:s.edges})),r&&l.set("target_node_id",r);const u=await fetch(`/ml-workflow/api/analytics/quick-profile?${l.toString()}`);if(!u.ok){let d="Failed to generate dataset profile";try{const h=await u.clone().json(),p=typeof(h==null?void 0:h.detail)=="string"&&h.detail.trim()?h.detail.trim():typeof(h==null?void 0:h.error)=="string"&&h.error.trim()?h.error.trim():typeof(h==null?void 0:h.message)=="string"&&h.message.trim()?h.message.trim():null;p&&(d=p)}catch{try{const p=(await u.text()).trim();p&&(d=p)}catch{}}throw new Error(d)}return u.json()}async function WP(e,t={}){const{config:n,sampleSize:s,graph:r,targetNodeId:i}=t,l={dataset_source_id:e,sample_size:s==="all"?0:typeof s=="number"&&Number.isFinite(s)?s:300};if(n&&typeof n=="object"){const d=(f,y)=>{const x=Number(f);return Number.isFinite(x)?x<0?0:x>100?100:x:y},h=f=>{if(!f||typeof f!="object")return{};const y={};return Object.entries(f).forEach(([x,_])=>{const v=String(x??"").trim();if(!v)return;let w=null,M=null;if(_&&typeof _=="object"){const N=_.lower??_.min??_.minimum??null,C=_.upper??_.max??_.maximum??null,j=Number(N);Number.isFinite(j)&&(w=j);const E=Number(C);Number.isFinite(E)&&(M=E)}if(!(w===null&&M===null)){if(w!==null&&M!==null&&w>M){const N=w;w=M,M=N}y[v]={lower:w,upper:M}}}),y},p=d(n.lower_percentile,5),m=d(n.upper_percentile,95);l.config={...n,method:n.method??"z_score",columns:Array.isArray(n.columns)?n.columns:[],z_threshold:typeof n.z_threshold=="number"&&Number.isFinite(n.z_threshold)?n.z_threshold:3,iqr_multiplier:typeof n.iqr_multiplier=="number"&&Number.isFinite(n.iqr_multiplier)?n.iqr_multiplier:1.5,lower_percentile:p,upper_percentile:m<=p?Math.min(p+1,100):m,manual_bounds:h(n.manual_bounds)}}r&&Array.isArray(r.nodes)&&Array.isArray(r.edges)&&(l.graph={nodes:r.nodes,edges:r.edges}),i&&(l.target_node_id=i);const u=await fetch("/ml-workflow/api/analytics/outliers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok){const d=await u.text();throw new Error(d||"Failed to load outlier diagnostics")}return u.json()}async function Z0(e){const t=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}`);if(t.status===404)return null;if(!t.ok)throw new Error("Failed to load saved pipeline");return t.json()}async function J0(e,t){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to save pipeline");return n.json()}async function ew(e,t=10){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/history?limit=${encodeURIComponent(String(t))}`);if(n.status===404)return[];if(!n.ok)throw new Error("Failed to load pipeline history");return n.json()}async function tw(e,t={}){const{offset:n,limit:s,mode:r}=t,i=new URLSearchParams;typeof n=="number"&&Number.isFinite(n)&&i.set("offset",String(n)),typeof s=="number"&&Number.isFinite(s)&&i.set("limit",String(s)),r&&i.set("mode",r);const l=i.toString(),u=`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/preview/rows${l?`?${l}`:""}`,d=await fetch(u);if(!d.ok){const h=await d.text();throw new Error(h||"Failed to load preview rows")}return d.json()}async function nw(e){const t=await fetch("/ml-workflow/api/pipelines/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const n=await t.text();throw new Error(n||"Failed to load pipeline preview")}return t.json()}async function sw(e){const t={...e,sample_size:0},n=await fetch("/ml-workflow/api/pipelines/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const s=await n.text();throw new Error(s||"Failed to trigger full dataset execution")}return n.json()}async function YP(e,t){const n=await fetch(`/ml-workflow/api/pipelines/${encodeURIComponent(e)}/full-execution/${encodeURIComponent(t)}`);if(!n.ok){const s=await n.text();throw new Error(s||"Failed to fetch full execution status")}return n.json()}async function rw(e){const t=await fetch("/ml-workflow/api/training-jobs",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to launch training jobs.");const s=await t.text();throw new Error(s||"Failed to enqueue training job")}const n=await t.json();if(n&&Array.isArray(n==null?void 0:n.jobs)){const s=n.jobs,r=typeof n.total=="number"?n.total:s.length;return{jobs:s,total:r}}return n&&n.id?{jobs:[n],total:1}:{jobs:[],total:0}}async function aw(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/training-jobs/${encodeURIComponent(e)}`,{credentials:"include"});if(t.status===404)throw new Error("Training job not found");if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to view this training job.");const n=await t.text();throw new Error(n||"Failed to load training job")}return t.json()}async function hc(e={}){const t=new URLSearchParams;e.datasetSourceId&&t.set("dataset_source_id",e.datasetSourceId),e.pipelineId&&t.set("pipeline_id",e.pipelineId),e.nodeId&&t.set("node_id",e.nodeId),typeof e.limit=="number"&&Number.isFinite(e.limit)&&t.set("limit",String(e.limit));const n=t.toString(),s=await fetch(`/ml-workflow/api/training-jobs${n?`?${n}`:""}`,{credentials:"include"});if(!s.ok){if(s.status===401||s.status===403)throw new Error("Sign in to view training jobs.");const r=await s.text();throw new Error(r||"Failed to load training jobs")}return s.json()}async function ow(e,t){if(!e)throw new Error("jobId is required for evaluation");const n=await fetch(`/ml-workflow/api/training-jobs/${encodeURIComponent(e)}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t??{})});if(!n.ok){if(n.status===401||n.status===403)throw new Error("Sign in to evaluate this model.");const s=await n.text();throw new Error(s||"Failed to evaluate model")}return n.json()}async function iw(e){const t=await fetch("/ml-workflow/api/hyperparameter-tuning-jobs",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to launch tuning jobs.");const s=await t.text();throw new Error(s||"Failed to enqueue tuning job")}const n=await t.json();if(n&&Array.isArray(n==null?void 0:n.jobs)){const s=n.jobs,r=typeof n.total=="number"?n.total:s.length;return{jobs:s,total:r}}return n&&n.id?{jobs:[n],total:1}:{jobs:[],total:0}}async function KP(e){if(!e)throw new Error("jobId is required");const t=await fetch(`/ml-workflow/api/hyperparameter-tuning-jobs/${encodeURIComponent(e)}`,{credentials:"include"});if(t.status===404)throw new Error("Tuning job not found");if(!t.ok){if(t.status===401||t.status===403)throw new Error("Sign in to view this tuning job.");const n=await t.text();throw new Error(n||"Failed to load tuning job")}return t.json()}async function pc(e={}){const t=new URLSearchParams;e.datasetSourceId&&t.set("dataset_source_id",e.datasetSourceId),e.pipelineId&&t.set("pipeline_id",e.pipelineId),e.nodeId&&t.set("node_id",e.nodeId),typeof e.limit=="number"&&Number.isFinite(e.limit)&&t.set("limit",String(e.limit));const n=t.toString(),s=await fetch(`/ml-workflow/api/hyperparameter-tuning-jobs${n?`?${n}`:""}`,{credentials:"include"});if(!s.ok){if(s.status===401||s.status===403)throw new Error("Sign in to view tuning jobs.");const r=await s.text();throw new Error(r||"Failed to load tuning jobs")}return s.json()}async function Cd(e){const t=await fetch(`/ml-workflow/api/model-hyperparameters/${encodeURIComponent(e)}`);if(!t.ok){if(t.status===404)throw new Error(`Model type '${e}' not found`);const n=await t.text();throw new Error(n||"Failed to load model hyperparameters")}return t.json()}async function lw(e,t={}){const n=new URLSearchParams;t.pipelineId&&n.set("pipeline_id",t.pipelineId),t.datasetSourceId&&n.set("dataset_source_id",t.datasetSourceId);const s=n.toString(),r=await fetch(`/ml-workflow/api/hyperparameter-tuning/best-params/${encodeURIComponent(e)}${s?`?${s}`:""}`,{credentials:"include"});if(!r.ok){if(r.status===404)throw new Error(`Model type '${e}' not found`);const i=await r.text();throw new Error(i||"Failed to fetch best hyperparameters")}return r.json()}const ap=e=>{if(Array.isArray(e))return e.map(t=>ap(t));if(e&&typeof e=="object"){const t=Object.keys(e).sort(),n={};return t.forEach(s=>{n[s]=ap(e[s])}),n}return e},GP=e=>Array.from(new Uint8Array(e)).map(t=>t.toString(16).padStart(2,"0")).join(""),XP=async e=>{if(!globalThis.crypto||!globalThis.crypto.subtle)throw new Error("Secure hashing is not available in this environment");const t=new TextEncoder,n=await globalThis.crypto.subtle.digest("SHA-256",t.encode(e));return GP(n)},QP=e=>{const t=e&&Array.isArray(e.nodes)?e.nodes:[],n=e&&Array.isArray(e.edges)?e.edges:[],s=t.map(i=>{let l=null;if(i&&i.data&&typeof i.data=="object"){const u=i.data.config;if(u!==void 0)try{l=JSON.parse(JSON.stringify(u))}catch{l=u}}return{id:i&&Object.prototype.hasOwnProperty.call(i,"id")?i.id??null:null,type:i&&Object.prototype.hasOwnProperty.call(i,"type")?i.type??null:null,catalogType:i&&i.data&&Object.prototype.hasOwnProperty.call(i.data,"catalogType")?i.data.catalogType??null:null,config:l}}).sort((i,l)=>{const u=typeof i.id=="string"?i.id:String(i.id??""),d=typeof l.id=="string"?l.id:String(l.id??"");return u.localeCompare(d)}),r=n.map(i=>({source:i&&Object.prototype.hasOwnProperty.call(i,"source")?i.source??null:null,target:i&&Object.prototype.hasOwnProperty.call(i,"target")?i.target??null:null,sourceHandle:i&&Object.prototype.hasOwnProperty.call(i,"sourceHandle")?i.sourceHandle??null:null,targetHandle:i&&Object.prototype.hasOwnProperty.call(i,"targetHandle")?i.targetHandle??null:null})).sort((i,l)=>{const u=String(i.source??"").localeCompare(String(l.source??""));return u!==0?u:String(i.target??"").localeCompare(String(l.target??""))});return{nodes:s,edges:r}};async function zo(e,t){if(!e)throw new Error("datasetSourceId is required to compute pipeline ID");const n=QP(t),s=JSON.stringify(ap(n)),r=await XP(s);return`${e}_${r.slice(0,8)}`}const ZP=Object.freeze(Object.defineProperty({__proto__:null,createHyperparameterTuningJob:iw,createTrainingJob:rw,evaluateTrainingJob:ow,fetchBestHyperparameters:lw,fetchBinnedDistribution:X0,fetchBinningRecommendations:G0,fetchDatasets:I0,fetchDropColumnRecommendations:rp,fetchDummyEncodingRecommendations:V0,fetchFullExecutionStatus:YP,fetchHashEncodingRecommendations:H0,fetchHyperparameterTuningJob:KP,fetchHyperparameterTuningJobs:pc,fetchLabelEncodingRecommendations:F0,fetchModelHyperparameters:Cd,fetchNodeCatalog:sp,fetchOneHotEncodingRecommendations:q0,fetchOrdinalEncodingRecommendations:B0,fetchOutlierDiagnostics:WP,fetchOutlierRecommendations:W0,fetchPipeline:Z0,fetchPipelineHistory:ew,fetchPipelinePreview:nw,fetchPipelinePreviewRows:tw,fetchQuickProfile:Q0,fetchScalingRecommendations:K0,fetchSkewnessRecommendations:Y0,fetchTargetEncodingRecommendations:U0,fetchTrainingJob:aw,fetchTrainingJobs:hc,generatePipelineId:zo,savePipeline:J0,triggerFullDatasetExecution:sw},Symbol.toStringTag,{value:"Module"})),gc=100,JP=12,eL={limited_full_sample_for_large_dataset:"Preview limited because the dataset is large.",capped_sample_for_large_dataset:"Requested sample size capped for a large dataset.",switched_to_first_last_for_large_dataset:"Using first and last rows to summarize the large dataset.",default_offset:"Offset fallback applied; starting from the beginning.",normalized_negative_offset:"Negative offset normalized to zero.",default_limit:"Using the default preview window size.",normalized_non_positive_limit:"Requested preview size too small; using the minimum window.",capped_limit_for_sample:"Preview window capped to stay within safe limits."},cw={succeeded:"Completed",deferred:"Deferred",queued:"Queued",running:"In progress",failed:"Failed",skipped:"Skipped",cancelled:"Cancelled"},tL={dataset_too_large:"Full dataset run is executing in the background for large datasets.",memory_error:"Full dataset execution failed because the server ran out of memory.",background_failure:"Background job ended unexpectedly. Check server logs for details."},nL={queued:"Queued",running:"Running",succeeded:"Completed",failed:"Failed",cancelled:"Cancelled"},sL=e=>{switch(e){case"succeeded":case"deferred":case"queued":case"running":case"failed":case"skipped":case"cancelled":return e;default:return"deferred"}},rL=e=>{if(!e)return"";const t=tL[e];if(t)return t;const n=e.replace(/_/g," ").trim();return n?n.charAt(0).toUpperCase()+n.slice(1):e},uw=(e,t)=>{if(!e)return null;const n=e.job_status??null,s=sL(n??e.status??null),r=cw[n??e.status??s]??cw[s],i=typeof e.processed_rows=="number"&&e.processed_rows>=0?t(e.processed_rows):null,l=typeof e.total_rows=="number"&&e.total_rows>=0?t(e.total_rows):null;let u=`Full dataset run: ${r}`;s==="running"&&i&&l?u=`Full dataset run: In progress (${i}/${l})`:s==="running"&&i?u=`Full dataset run: In progress (${i} rows)`:s==="succeeded"&&i?u=`Full dataset run: Completed (${i} rows)`:s==="succeeded"&&l&&(u=`Full dataset run: Completed (${l} rows)`);const d=[],h=[],p=n?nL[n]??n:null;if(n==="running"?i&&l?d.push(`Processed ${i} of ${l} rows.`):i?d.push(`Processed ${i} rows.`):l&&d.push(`Processing ${l} rows.`):i?d.push(`Processed ${i} rows.`):l&&d.push(`Total rows ${l}.`),e.reason&&d.push(e.reason),p&&h.push({label:"Background job",value:p}),e.job_id&&h.push({label:"Background job ID",value:e.job_id}),l&&h.push({label:"Dataset rows",value:l}),i&&s!=="queued"&&s!=="skipped"&&h.push({label:"Processed rows",value:i}),typeof e.poll_after_seconds=="number"&&e.poll_after_seconds>0&&h.push({label:"Next status check",value:`${e.poll_after_seconds}s`}),e.last_updated)try{const y=new Date(e.last_updated).toLocaleString();h.push({label:"Last updated",value:y})}catch{h.push({label:"Last updated",value:String(e.last_updated)})}const m=Array.isArray(e.warnings)?e.warnings.map(rL).map(y=>y.trim()).filter(Boolean):[];let f=null;switch(s){case"queued":f=e.reason?e.reason:"Full dataset run queued in background.";break;case"running":f=e.reason?e.reason:"Full dataset run in progress.";break;case"succeeded":if(i){const y=e.processed_rows===1?"":"s";f=`Full dataset run processed ${i} row${y}.`}else l?f=`Full dataset run completed (${l} rows).`:f="Full dataset run completed.";break;case"failed":f=e.reason?`Full dataset run failed: ${e.reason}`:"Full dataset run failed.";break;case"cancelled":f="Full dataset run cancelled.";break;case"skipped":f=e.reason?`Full dataset run skipped: ${e.reason}`:"Full dataset run skipped.";break;case"deferred":f=e.reason?e.reason:"Full dataset run deferred to background processing.";break;default:f=null;break}return{label:u,tone:s,details:d,metadata:h,warnings:m,stepLabel:f,isActive:n==="queued"||n==="running"}},dw=()=>({status:"idle",columns:[],rows:[],nextOffset:null,hasMore:!1,totalRows:null,samplingAdjustments:[],largeDataset:!1,error:null}),aL=e=>{if(!e)return"";if(e.startsWith("window_mode_fallback:")){const s=e.split(":",2)[1]??"";return s?`Preview mode "${s}" is not supported; falling back to head sampling.`:"Preview mode fallback applied."}const t=eL[e];if(t)return t;const n=e.replace(/_/g," ").trim();return n?n.charAt(0).toUpperCase()+n.slice(1):e},oL=({preview:e,columns:t,rows:n,tableNote:s,formatCellValue:r,formatMetricValue:i,formatMissingPercentage:l,formatNumericStat:u,formatModeStat:d,fullExecutionStepLabel:h,fullExecutionWarnings:p})=>{const m=e==null?void 0:e.metrics,f=Array.isArray(e==null?void 0:e.column_stats)?e.column_stats:[],y=Array.isArray(e==null?void 0:e.row_missing_stats)?e.row_missing_stats:[],x=Array.isArray(e==null?void 0:e.applied_steps)?e.applied_steps:[];let _=x;const v=h||null;if(v){const C=x.findIndex(j=>typeof j=="string"&&j.toLowerCase().startsWith("full dataset run"));C>=0?_=[...x.slice(0,C),v,...x.slice(C+1)]:x.includes(v)||(_=[...x,v])}const w=Array.isArray(e==null?void 0:e.sample_rows)?e.sample_rows:[],M=y.reduce((C,j)=>(j&&typeof j.index=="number"&&(C[j.index]=typeof j.missing_percentage=="number"?j.missing_percentage:0),C),{}),N=w.slice(0,JP);return o.jsxs("div",{className:"canvas-preview",children:[m&&o.jsxs("div",{className:"canvas-preview__metrics",role:"list",children:[o.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[o.jsx("span",{className:"canvas-preview__metric-label",children:"Rows"}),o.jsx("span",{className:"canvas-preview__metric-value",children:i(m.row_count)})]}),o.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[o.jsx("span",{className:"canvas-preview__metric-label",children:"Columns"}),o.jsx("span",{className:"canvas-preview__metric-value",children:i(m.column_count)})]}),o.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[o.jsx("span",{className:"canvas-preview__metric-label",children:"Duplicate rows"}),o.jsx("span",{className:"canvas-preview__metric-value",children:i(m.duplicate_rows)})]}),o.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[o.jsx("span",{className:"canvas-preview__metric-label",children:"Missing cells"}),o.jsx("span",{className:"canvas-preview__metric-value",children:i(m.missing_cells)})]}),o.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[o.jsx("span",{className:"canvas-preview__metric-label",children:"Rows sampled"}),o.jsx("span",{className:"canvas-preview__metric-value",children:i(m.preview_rows)})]}),o.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[o.jsx("span",{className:"canvas-preview__metric-label",children:"Dataset rows"}),o.jsx("span",{className:"canvas-preview__metric-value",children:i(m.total_rows)})]}),o.jsxs("div",{className:"canvas-preview__metric",role:"listitem",children:[o.jsx("span",{className:"canvas-preview__metric-label",children:"Sample request"}),o.jsx("span",{className:"canvas-preview__metric-value",children:m.requested_sample_size===0?"Full dataset":i(m.requested_sample_size)})]})]}),_.length>0&&o.jsxs("div",{className:"canvas-preview__steps",children:[o.jsx("h4",{children:"Applied steps"}),o.jsx("ol",{children:_.map((C,j)=>o.jsx("li",{children:C},`${C}-${j}`))})]}),t.length>0&&n.length>0?o.jsxs("div",{className:"canvas-preview__table-wrapper",role:"region","aria-label":"Sample rows",children:[o.jsxs("table",{className:"canvas-preview__table",children:[o.jsx("thead",{children:o.jsx("tr",{children:t.map(C=>o.jsx("th",{children:C},C))})}),o.jsx("tbody",{children:n.map((C,j)=>o.jsx("tr",{children:t.map(E=>o.jsx("td",{children:r(C==null?void 0:C[E])},`${j}-${E}`))},`row-${j}`))})]}),s?o.jsx("p",{className:"canvas-modal__note",children:s}):null]}):o.jsx("p",{className:"canvas-modal__note",children:"No sample rows available after applying the upstream steps."}),y.length>0&&N.length>0&&o.jsxs("div",{className:"canvas-preview__row-stats",children:[o.jsx("h4",{children:"Row missingness"}),o.jsx("div",{className:"canvas-preview__row-grid",children:N.map((C,j)=>{const E=M[j]??0,k=E%1===0?0:1;return o.jsxs("div",{className:"canvas-preview__row-chip",children:[o.jsxs("span",{children:["Row ",j+1]}),o.jsxs("strong",{children:[i(E,k),"%"]})]},`row-missing-${j}`)})})]}),f.length>0&&o.jsxs("div",{className:"canvas-preview__column-stats",children:[o.jsx("h4",{children:"Column summary"}),o.jsx("div",{className:"canvas-preview__column-grid",children:f.map(C=>o.jsxs("div",{className:"canvas-preview__column-card",children:[o.jsx("div",{className:"canvas-preview__column-name",children:C.name}),C.dtype&&o.jsxs("div",{className:"canvas-preview__column-detail",children:["Type: ",C.dtype]}),o.jsxs("div",{className:"canvas-preview__column-detail",children:["Missing: ",l(C.missing_percentage)," (",i(C.missing_count),")"]}),typeof C.mean=="number"&&!Number.isNaN(C.mean)&&o.jsxs("div",{className:"canvas-preview__column-detail",children:["Mean: ",u(C.mean)]}),typeof C.median=="number"&&!Number.isNaN(C.median)&&o.jsxs("div",{className:"canvas-preview__column-detail",children:["Median: ",u(C.median)]}),C.mode!==void 0&&C.mode!==null&&C.mode!==""&&o.jsxs("div",{className:"canvas-preview__column-detail",children:["Mode: ",d(C.mode)]}),typeof C.distinct_count=="number"&&o.jsxs("div",{className:"canvas-preview__column-detail",children:["Distinct values: ",i(C.distinct_count)]})]},C.name))})]}),p&&p.length>0&&o.jsxs("div",{className:"canvas-preview__full-execution-warnings",children:[o.jsx("strong",{children:"Full execution notes:"}),o.jsx("ul",{children:p.map((C,j)=>o.jsx("li",{children:C},`${C}-${j}`))})]})]})},iL=({previewState:e,datasetSourceId:t,canTriggerPreview:n,onRefresh:s,formatCellValue:r,formatMetricValue:i,formatMissingPercentage:l,formatNumericStat:u,formatModeStat:d})=>{var V,U,W,B,I;const[h,p]=b.useState(()=>dw()),[m,f]=b.useState(null),[y,x]=b.useState(!1),_=e.status==="loading",v=_||!n,w=b.useMemo(()=>{var J;const H=(J=e.data)==null?void 0:J.columns;return Array.isArray(H)?H.filter(G=>typeof G=="string"):[]},[(V=e.data)==null?void 0:V.columns]),M=b.useMemo(()=>{var H;return Array.isArray((H=e.data)==null?void 0:H.sample_rows)?e.data.sample_rows.slice(0,gc):[]},[(U=e.data)==null?void 0:U.sample_rows]),N=M.length,C=Array.isArray((W=e.data)==null?void 0:W.sample_rows)?e.data.sample_rows.length:0,j=(B=e.data)==null?void 0:B.metrics,E=b.useMemo(()=>j?C>N||typeof j.total_rows=="number"&&j.total_rows>C:!1,[j,N,C]);b.useEffect(()=>{var J;if(e.status!=="success"||!e.data){p(G=>G.status==="idle"?G:dw()),f(null);return}const H=uw((J=e.data.signals)==null?void 0:J.full_execution,i);f(H),p({status:"ready",columns:[...w],rows:[...M],nextOffset:N,hasMore:E,totalRows:typeof(j==null?void 0:j.total_rows)=="number"?j.total_rows:null,samplingAdjustments:[],largeDataset:!1,error:null})},[w,M,N,E,i,j==null?void 0:j.total_rows,e.data,e.status]),b.useEffect(()=>{var Y,X;if(!m||!m.isActive)return;const H=(X=(Y=e.data)==null?void 0:Y.signals)==null?void 0:X.full_execution;if(!H||!H.job_id||!t)return;const J=typeof H.poll_after_seconds=="number"&&H.poll_after_seconds>0?H.poll_after_seconds*1e3:5e3,G=setTimeout(()=>{Promise.resolve().then(()=>ZP).then(Z=>Z.fetchFullExecutionStatus(t,H.job_id)).then(Z=>{const ee=uw(Z,i);f(ee),e.data&&{...e.data,signals:{...e.data.signals}}}).catch(Z=>{console.error("Failed to poll background job status:",Z)})},J);return()=>clearTimeout(G)},[m,t,i,e.data]);const k=h.columns.length>0?h.columns:w,$=h.rows.length>0?h.rows:M,T=h.totalRows??(typeof(j==null?void 0:j.total_rows)=="number"?j.total_rows:null),P=h.status==="idle"?E:h.hasMore,A=h.status==="loading",D=$.length,F=b.useMemo(()=>{if(!D)return null;const H=i(D);if(T!==null&&T>=0){const J=i(T),G=`Loaded ${H} of ${J} rows.`;return P&&D<T?`${G} Load more rows to continue.`:!P&&D<T?`${G} Preview limited by backend settings.`:G}return P?`Loaded ${H} rows. Additional rows available.`:`Loaded ${H} rows.`},[P,i,D,T]),R=b.useMemo(()=>(h.status==="idle"?[]:h.samplingAdjustments).map(aL).map(J=>J.trim()).filter(Boolean),[h.samplingAdjustments,h.status]),z=h.status==="idle"?!1:h.largeDataset,q=b.useCallback(()=>{var Y;if(!t||!P||h.status==="loading")return;const H=h.rows.length>0?h.rows:M,J=h.status==="idle"?H.length:h.nextOffset??H.length,G=Array.isArray((Y=e.data)==null?void 0:Y.sample_rows)?e.data.sample_rows:[];if(J<G.length){const X=G.slice(J,J+gc),Z=H.concat(X),ee=J+X.length,Q=ee<G.length||typeof(j==null?void 0:j.total_rows)=="number"&&j.total_rows>G.length;p({status:"ready",columns:h.columns.length>0?h.columns:w,rows:Z,nextOffset:Q?ee:null,hasMore:Q,totalRows:typeof(j==null?void 0:j.total_rows)=="number"?j.total_rows:null,samplingAdjustments:h.samplingAdjustments,largeDataset:h.largeDataset,error:null});return}p(X=>({...X,status:"loading",error:null})),tw(t,{offset:J,limit:gc}).then(X=>{p(Z=>{const ee=Z.rows.length>0?Z.rows:H,Q=Array.isArray(X.columns)&&X.columns.length>0?X.columns.map(Te=>String(Te)):Z.columns.length>0?Z.columns:w,ne=typeof X.offset=="number"&&X.offset>=0?X.offset:0,he=Array.isArray(X.rows)?X.rows:[],ye=ne<=ee.length?ee.slice(0,ne):ee.slice(),ge=ne<=ee.length?ye.concat(he):ee.concat(he),Ee=he.length,De=!!X.has_more,ke=typeof X.next_offset=="number"?X.next_offset:De?ne+Ee:null,le=typeof X.total_rows=="number"?X.total_rows:null,pe=De?null:ge.length,be=le!==null?le:Z.totalRows!==null?Z.totalRows:pe;return{status:"ready",columns:[...Q],rows:ge,nextOffset:ke,hasMore:De,totalRows:be,samplingAdjustments:Array.isArray(X.sampling_adjustments)?X.sampling_adjustments:[],largeDataset:!!X.large_dataset,error:null}})}).catch(X=>{p(Z=>({...Z,status:"error",error:(X==null?void 0:X.message)??"Unable to load additional rows."}))})},[w,M,t,P,h,(I=e.data)==null?void 0:I.sample_rows,j]);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsxs("div",{className:"canvas-modal__section-title",children:[o.jsx("h3",{children:"Dataset snapshot"}),m&&o.jsx("div",{className:`canvas-preview__full-execution-badge canvas-preview__full-execution--${m.tone}`,role:"status","aria-live":m.isActive?"polite":"off",title:m.details.length>0?m.details.join(" "):void 0,children:m.label})]}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:s,disabled:v,children:_?"Refreshing":"Refresh"})})]}),m&&o.jsxs("div",{className:"canvas-preview__full-execution-context",children:[m.details.length>0&&o.jsx("ul",{className:"canvas-preview__full-execution-details",children:m.details.map((H,J)=>o.jsx("li",{children:H},`${H}-${J}`))}),m.metadata.length>0&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{type:"button",className:"canvas-preview__full-execution-toggle",onClick:()=>x(!y),"aria-expanded":y,children:[y?"":""," ",y?"Hide":"Show"," job details"]}),y&&o.jsx("dl",{className:"canvas-preview__full-execution-meta",children:m.metadata.map((H,J)=>o.jsxs("div",{className:"canvas-preview__full-execution-meta-item",children:[o.jsx("dt",{children:H.label}),o.jsx("dd",{children:H.value})]},`${H.label}-${H.value}-${J}`))})]})]}),_&&o.jsx("p",{className:"canvas-modal__note",children:"Generating preview"}),e.status==="error"&&e.error&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:e.error}),e.status==="success"&&e.data&&o.jsx(oL,{preview:e.data,columns:k,rows:$,tableNote:F,formatCellValue:r,formatMetricValue:i,formatMissingPercentage:l,formatNumericStat:u,formatModeStat:d,fullExecutionStepLabel:(m==null?void 0:m.stepLabel)??null,fullExecutionWarnings:(m==null?void 0:m.warnings)??[]}),h.error&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:h.error}),z&&o.jsxs("p",{className:"canvas-modal__note",children:["Large dataset detected. Preview windows are capped at ",i(gc)," rows to stay responsive."]}),R.length>0&&o.jsxs("div",{className:"canvas-modal__note",children:[o.jsx("strong",{children:"Sampling adjustments:"}),o.jsx("ul",{children:R.map((H,J)=>o.jsx("li",{children:H},`${H}-${J}`))})]}),P&&t&&o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:q,disabled:A,children:A?"Loading rows":`Load next ${i(gc)} rows`})}),!P&&!_&&T!==null&&D>=T&&D>0&&o.jsx("p",{className:"canvas-modal__note",children:"All available rows have been loaded."})]})},Wi=[{value:"200",label:"200 rows"},{value:"500",label:"500 rows"},{value:"1000",label:"1,000 rows"},{value:"all",label:"Full dataset"}],lL=({node:e,isDatasetProfileNode:t,sourceId:n,hasReachableSource:s,graphContext:r,profilingGraphSignature:i,formatRelativeTime:l})=>{var q;const[u,d]=b.useState({status:"idle",data:null,error:null}),[h,p]=b.useState(0),[m,f]=b.useState({}),[y,x]=b.useState("500"),[_,v]=b.useState("summary"),[w,M]=b.useState(!1),N=b.useMemo(()=>!t||!n?null:`${n}::${(e==null?void 0:e.id)??""}::${y}::${i}`,[t,e==null?void 0:e.id,i,y,n]),C=b.useMemo(()=>N?m[N]??null:null,[m,N]);b.useEffect(()=>{x("500"),d({status:"idle",data:null,error:null})},[t,e==null?void 0:e.id]),b.useEffect(()=>{if(!t){d({status:"idle",data:null,error:null});return}if(!n){d({status:"error",data:null,error:"Select a dataset to generate a lightweight profile."});return}if(!s){d({status:"error",data:null,error:"Connect this step to an upstream output to generate a profile."});return}if(C){d({status:"success",data:C,error:null});return}let V=!0;d({status:"loading",data:null,error:null});const U=Wi.find(B=>B.value===y)??Wi[1]??Wi[0],W=U.value==="all"?"all":Number(U.value);return Q0(n,{sampleSize:W,graph:r,targetNodeId:(e==null?void 0:e.id)??null}).then(B=>{V&&(N&&B&&f(I=>({...I,[N]:B})),d({status:"success",data:B??null,error:null}))}).catch(B=>{V&&d({status:"error",data:null,error:(B==null?void 0:B.message)??"Unable to generate dataset profile"})}),()=>{V=!1}},[C,r,s,t,e==null?void 0:e.id,h,N,y,n]);const j=u.data,E=(j==null?void 0:j.generated_at)??null,k=((q=j==null?void 0:j.correlations)==null?void 0:q.length)??0;b.useEffect(()=>{M(!1),v("summary")},[t,E]),b.useEffect(()=>{_==="correlations"&&k===0&&v("summary")},[_,k]);const $=b.useCallback(()=>{N&&f(V=>{if(!Object.prototype.hasOwnProperty.call(V,N))return V;const U={...V};return delete U[N],U}),p(V=>V+1)},[N]),T=b.useMemo(()=>e!=null&&e.id?`profiling-warnings-${e.id}`:"profiling-warnings",[e==null?void 0:e.id]),P=b.useMemo(()=>e!=null&&e.id?`profiling-summary-${e.id}`:"profiling-summary",[e==null?void 0:e.id]),A=b.useMemo(()=>e!=null&&e.id?`profiling-correlations-${e.id}`:"profiling-correlations",[e==null?void 0:e.id]),D=b.useMemo(()=>e!=null&&e.id?`profiling-summary-tab-${e.id}`:"profiling-summary-tab",[e==null?void 0:e.id]),F=b.useMemo(()=>e!=null&&e.id?`profiling-correlations-tab-${e.id}`:"profiling-correlations-tab",[e==null?void 0:e.id]),R=b.useMemo(()=>Wi.find(V=>V.value===y)??Wi[0],[y]),z=b.useMemo(()=>l((j==null?void 0:j.generated_at)??null),[l,j==null?void 0:j.generated_at]);return{profileState:u,profileData:j,profilingSamplePreset:y,setProfilingSamplePreset:x,profilingActiveTab:_,setProfilingActiveTab:v,isProfilingWarningsOpen:w,setIsProfilingWarningsOpen:M,handleRefreshDatasetProfile:$,activeProfilingSamplePreset:R,profilingWarningsListId:T,profilingSummaryPanelId:P,profilingCorrelationsPanelId:A,profilingSummaryTabId:D,profilingCorrelationsTabId:F,profilingCorrelationCount:k,relativeProfilingGeneratedAt:z}},cL=({isDatasetProfileNode:e,controller:t,formatCellValue:n,formatNumericStat:s,formatMissingPercentage:r})=>{if(!e)return null;const{profileState:i,profileData:l,profilingSamplePreset:u,setProfilingSamplePreset:d,profilingActiveTab:h,setProfilingActiveTab:p,isProfilingWarningsOpen:m,setIsProfilingWarningsOpen:f,handleRefreshDatasetProfile:y,activeProfilingSamplePreset:x,profilingWarningsListId:_,profilingSummaryPanelId:v,profilingCorrelationsPanelId:w,profilingSummaryTabId:M,profilingCorrelationsTabId:N,profilingCorrelationCount:C,relativeProfilingGeneratedAt:j}=t,E=i.status==="success"&&!!l;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Dataset profile"}),o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsxs("div",{className:"canvas-sample__group",children:[o.jsx("span",{className:"canvas-sample__label",children:"Sample"}),o.jsx("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Profile sampling presets",children:Wi.map(k=>o.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":k.value===u,onClick:()=>d(k.value),disabled:i.status==="loading",children:k.label},k.value))})]}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:y,disabled:i.status==="loading",children:i.status==="loading"?"Refreshing":"Refresh"})]})]}),j&&o.jsxs("span",{className:"canvas-modal__meta",children:["Updated ",j]}),o.jsxs("p",{className:"canvas-modal__note",children:["Sampling preset: ",o.jsx("strong",{children:x.label}),"."]}),i.status==="loading"&&o.jsx("p",{className:"canvas-modal__note",children:"Generating dataset profile"}),i.status==="error"&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:i.error}),E&&l&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"canvas-profiling__meta",children:[o.jsxs("span",{children:["Rows analysed: ",l.rows_analyzed.toLocaleString()]}),o.jsxs("span",{children:["Columns: ",l.columns_analyzed.toLocaleString()]}),o.jsxs("span",{children:["Sample size: ",l.sample_size.toLocaleString()," rows"]}),o.jsxs("span",{children:["Missing cells: ",l.metrics.missing_cells.toLocaleString()]}),o.jsxs("span",{children:["Duplicate rows: ",l.metrics.duplicate_rows.toLocaleString()]})]}),o.jsxs("div",{className:"canvas-profiling__tabs",role:"tablist","aria-label":"Dataset profile views",children:[o.jsx("button",{type:"button",className:"canvas-profiling__tab",id:M,role:"tab","data-active":h==="summary","aria-selected":h==="summary","aria-controls":v,onClick:()=>p("summary"),children:"Summary"}),o.jsx("button",{type:"button",className:"canvas-profiling__tab",id:N,role:"tab","data-active":h==="correlations","aria-selected":h==="correlations","aria-controls":w,onClick:()=>p("correlations"),disabled:!C,children:"Correlations"})]}),h==="summary"&&o.jsxs("div",{className:"canvas-profiling__panel",id:v,role:"tabpanel","aria-labelledby":M,children:[l.warnings&&l.warnings.length>0?o.jsxs("div",{className:"canvas-profiling__warnings",children:[o.jsx("button",{type:"button",className:"canvas-profiling__warnings-toggle",onClick:()=>f(k=>!k),"aria-expanded":m,"aria-controls":_,children:m?"Hide warnings":`Show warnings (${l.warnings.length})`}),m&&o.jsx("ul",{className:"canvas-profiling__warnings-list",id:_,children:l.warnings.map((k,$)=>o.jsx("li",{children:k},`profiling-warning-${$}`))})]}):null,o.jsx("div",{className:"canvas-quick-profile__columns",children:l.columns.map(k=>{const $=k.numeric_summary,T=!!$,P=Array.isArray(k.top_values)?k.top_values:[],A=Array.isArray(k.sample_values)?k.sample_values:[];return o.jsxs("article",{className:"canvas-quick-profile__column","aria-label":`${k.name} summary`,children:[o.jsxs("header",{className:"canvas-quick-profile__column-header",children:[o.jsx("h4",{children:k.name}),o.jsx("span",{className:"canvas-quick-profile__dtype",children:k.semantic_type??k.dtype??"Unknown"})]}),o.jsxs("dl",{className:"canvas-quick-profile__stats",children:[o.jsxs("div",{children:[o.jsx("dt",{children:"Missing"}),o.jsx("dd",{children:`${r(k.missing_percentage)} (${k.missing_count.toLocaleString()})`})]}),o.jsxs("div",{children:[o.jsx("dt",{children:"Distinct"}),o.jsx("dd",{children:k.distinct_count!==null?k.distinct_count.toLocaleString():""})]})]}),T?o.jsxs("div",{className:"canvas-quick-profile__numeric",children:[o.jsx("h5",{children:"Distribution"}),o.jsxs("div",{className:"canvas-quick-profile__numeric-grid",children:[o.jsxs("span",{children:[o.jsx("strong",{children:"Mean"})," ",s($==null?void 0:$.mean)]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Std dev"})," ",s($==null?void 0:$.std)]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Min"})," ",s($==null?void 0:$.minimum)]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Max"})," ",s($==null?void 0:$.maximum)]}),o.jsxs("span",{children:[o.jsx("strong",{children:"P25"})," ",s($==null?void 0:$.percentile_25)]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Median"})," ",s($==null?void 0:$.percentile_50)]}),o.jsxs("span",{children:[o.jsx("strong",{children:"P75"})," ",s($==null?void 0:$.percentile_75)]})]})]}):null,P.length>0?o.jsxs("div",{className:"canvas-quick-profile__top-values",children:[o.jsx("h5",{children:"Top values"}),o.jsx("ul",{children:P.map((D,F)=>o.jsxs("li",{children:[o.jsx("span",{className:"canvas-quick-profile__value",children:n(D.value)}),o.jsxs("span",{className:"canvas-quick-profile__count",children:[D.count.toLocaleString()," (",D.percentage.toFixed(1),"%)"]})]},`${k.name}-top-${F}`))})]}):null,A.length>0?o.jsxs("div",{className:"canvas-quick-profile__samples",children:[o.jsx("h5",{children:"Sample values"}),o.jsx("ul",{children:A.slice(0,5).map((D,F)=>o.jsx("li",{children:n(D)},`${k.name}-sample-${F}`))})]}):null]},k.name)})})]}),h==="correlations"&&o.jsx("div",{className:"canvas-profiling__panel",id:w,role:"tabpanel","aria-labelledby":N,children:o.jsxs("div",{className:"canvas-quick-profile__correlations",children:[o.jsx("h4",{children:"Top correlations"}),l.correlations&&l.correlations.length>0?o.jsxs("table",{className:"canvas-quick-profile__correlation-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column A"}),o.jsx("th",{scope:"col",children:"Column B"}),o.jsx("th",{scope:"col",children:"Coefficient"})]})}),o.jsx("tbody",{children:l.correlations.map((k,$)=>{const T=Math.abs(k.coefficient);let P="low";T>=.85?P="extreme":T>=.7?P="strong":T>=.55&&(P="moderate");const A=k.coefficient>=0?"positive":"negative";return o.jsxs("tr",{children:[o.jsx("td",{children:k.column_a}),o.jsx("td",{children:k.column_b}),o.jsx("td",{className:"canvas-quick-profile__correlation-coefficient","data-strength":P,"data-sign":A,children:k.coefficient.toFixed(2)})]},`profile-correlation-${$}`)})})]}):o.jsx("p",{className:"canvas-quick-profile__correlations-empty",children:"Not enough numeric columns to compute correlations yet."})]})})]})]})},uL=({type:e})=>o.jsx("span",{"aria-hidden":"true",className:`canvas-modal__title-glyph${e==="dataset"?" canvas-modal__title-glyph--dataset":""}`,children:e==="dataset"?"":""}),dL=({title:e,isDataset:t,onClose:n,canResetNode:s=!1,onResetNode:r})=>o.jsxs("div",{className:"canvas-modal__header",children:[o.jsxs("div",{className:"canvas-modal__title-group",children:[o.jsx(uL,{type:t?"dataset":"default"}),o.jsxs("div",{children:[o.jsx("h2",{className:"canvas-modal__title",id:"node-settings-title",children:e}),o.jsx("p",{className:"canvas-modal__subtitle",children:t?"Configure how this dataset feeds the pipeline.":"Adjust parameters to control this transformation."})]})]}),o.jsxs("div",{className:"canvas-modal__header-actions",children:[s&&r&&o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,children:"Reset node"}),o.jsx("button",{type:"button",className:"canvas-modal__close",onClick:n,"aria-label":"Close settings",children:""})]})]}),mL=({onClose:e,canResetNode:t,onResetNode:n,showSaveButton:s,canSave:r,onSave:i,isBusy:l,busyLabel:u})=>o.jsxs("div",{className:"canvas-modal__footer",children:[o.jsx("div",{className:"canvas-modal__footer-status",role:"status","aria-live":"polite","aria-busy":l,children:l&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"canvas-modal__footer-spinner","aria-hidden":"true"}),o.jsx("span",{children:u??"Processing"})]})}),o.jsxs("div",{className:"canvas-modal__footer-actions",children:[o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:e,children:"Close"}),t&&o.jsx("button",{type:"button",className:"btn btn-outline-secondary canvas-modal__reset",onClick:n,children:"Reset node"}),s&&o.jsx("button",{type:"button",className:"btn btn-primary",onClick:i,disabled:!r,children:"Save changes"})]})]}),fL=({metadata:e})=>o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("h3",{children:"Node details"}),e.length?o.jsx("dl",{className:"canvas-modal__metadata",children:e.map((t,n)=>o.jsxs("div",{className:"canvas-modal__metadata-row",children:[o.jsx("dt",{children:t.label}),o.jsx("dd",{children:t.value})]},`${t.label}-${n}`))}):o.jsx("p",{className:"canvas-modal__empty",children:"No metadata available for this node."})]}),Ws=(e,t=0)=>e==null?"":new Intl.NumberFormat(void 0,{maximumFractionDigits:t}).format(e),as=e=>{if(e==null)return"";const t=Number(e);if(Number.isNaN(t))return"";const n=t%1===0?0:1;return`${t.toFixed(n)}%`},Ps=e=>{if(e==null)return"";const t=Number(e);if(Number.isNaN(t))return"";const n=Math.abs(t)>=1?2:4;return Ws(t,n)},mw=e=>e==null||e===""?"":typeof e=="number"?Ps(e):String(e),hL=e=>{if(!e)return null;const t=e.toLowerCase();return t==="critical"?"critical":t==="high"?"high":t==="medium"?"medium":null},pL=e=>{if(!e)return null;const t=e.toLowerCase();return t==="critical"?"Critical":t==="high"?"High":t==="medium"?"Medium":e.charAt(0).toUpperCase()+e.slice(1)},vr=({label:e,htmlFor:t,description:n,children:s,className:r=""})=>o.jsxs("div",{className:`canvas-modal__parameter-field ${r}`,children:[o.jsx("label",{htmlFor:t,className:"canvas-modal__parameter-label",children:e}),o.jsx("div",{className:"canvas-modal__parameter-control",children:s}),n&&o.jsx("p",{className:"canvas-modal__parameter-description",children:n})]}),op=({className:e="",...t})=>o.jsx("input",{type:"text",className:`canvas-modal__input ${e}`,...t}),Yi=({className:e="",...t})=>o.jsx("input",{type:"number",className:`canvas-modal__input ${e}`,...t}),Sd=({className:e="",options:t,children:n,...s})=>o.jsxs("select",{className:`canvas-modal__select ${e}`,...s,children:[t.map(r=>o.jsx("option",{value:r.value,children:r.label},r.value)),n]}),Ki=({label:e,fieldLabel:t,description:n,className:s="",...r})=>o.jsxs("div",{className:`canvas-modal__parameter-field ${s}`,children:[t&&o.jsx("div",{className:"canvas-modal__parameter-label",children:o.jsx("label",{htmlFor:r.id,children:t})}),o.jsxs("label",{className:"canvas-modal__boolean-control",children:[o.jsx("input",{type:"checkbox",...r}),e]}),n&&o.jsx("p",{className:"canvas-modal__parameter-description",children:n})]}),gL=({className:e="",...t})=>o.jsx("input",{type:"range",className:`canvas-imputer__filter-range ${e}`,...t}),fw=({className:e="",...t})=>o.jsx("textarea",{className:`canvas-modal__input ${e}`,...t}),_L=5,yL=4,vL=3,xL="_binned",hw="Missing",bL=5,wL="ordinal",NL="quantile",jL=[{value:"equal_width",label:"Equal-width",description:"Uniform bin widths based on min/max range."},{value:"equal_frequency",label:"Equal-frequency",description:"Quantile-based bins with similar row counts in each bucket."},{value:"custom",label:"Custom edges",description:"Provide explicit thresholds and optional labels per column."},{value:"kbins",label:"KBins (sklearn)",description:"Use sklearn KBinsDiscretizer with uniform, quantile, or k-means strategies."}],CL=[{value:"range",label:"Numeric interval (default)"},{value:"bin_index",label:"Index (bin_0, bin_1, )"},{value:"ordinal",label:"Ordinal (Bin 1, Bin 2, )"},{value:"column_suffix",label:"Column suffix (col_binned_1, )"}],ip={equal_width:"Equal-width",equal_frequency:"Equal-frequency",custom:"Custom edges",kbins:"KBins (sklearn)"},SL=[{value:"keep",label:"Leave as missing"},{value:"label",label:"Replace with label"}],_c=[{value:"500",label:"500 rows (default)"},{value:"10000",label:"10000 rows (detailed)"},{value:"all",label:"Full dataset"}],pw=e=>{const t=typeof(e==null?void 0:e.strategy)=="string"?e.strategy.trim().toLowerCase():"",n=["equal_width","equal_frequency","custom","kbins"].includes(t)?t:"equal_width",s=Ge(e==null?void 0:e.columns),r=(z,q,V,U)=>{const W=Number(z);if(!Number.isFinite(W))return q;const B=Math.round(W);return Math.max(V,Math.min(U,B))},i=r(e==null?void 0:e.equal_width_bins,_L,2,200),l=r(e==null?void 0:e.equal_frequency_bins,yL,2,200),u=r(e==null?void 0:e.precision,vL,0,8),d=(e==null?void 0:e.duplicates)==="drop"?"drop":"raise",h=!!((e==null?void 0:e.include_lowest)??!0),p=!!((e==null?void 0:e.drop_original)??!1),f=(typeof(e==null?void 0:e.output_suffix)=="string"?e.output_suffix.trim():"")||xL,y=typeof(e==null?void 0:e.label_format)=="string"?e.label_format.trim().toLowerCase():"",x=["range","bin_index","ordinal","column_suffix"].includes(y)?y:"range",v=(typeof(e==null?void 0:e.missing_strategy)=="string"?e.missing_strategy.trim().toLowerCase():"")==="label"?"label":"keep",w=typeof(e==null?void 0:e.missing_label)=="string"?e.missing_label.trim():"",M=v==="label"&&w||hw,N=r(e==null?void 0:e.kbins_n_bins,bL,2,200),C=typeof(e==null?void 0:e.kbins_encode)=="string"?e.kbins_encode.trim().toLowerCase():"",j=["ordinal","onehot","onehot-dense"].includes(C)?C:wL,E=typeof(e==null?void 0:e.kbins_strategy)=="string"?e.kbins_strategy.trim().toLowerCase():"",k=["uniform","quantile","kmeans"].includes(E)?E:NL,$=z=>{if(!Array.isArray(z))return[];const V=z.map(U=>{if(typeof U=="number")return U;if(U==null)return Number.NaN;const W=String(U).trim();return W?Number(W):Number.NaN}).filter(U=>Number.isFinite(U)).sort((U,W)=>U-W).filter((U,W,B)=>W===0||U!==B[W-1]);return V.length>=2?V:[]},T=z=>Array.isArray(z)?z.map(q=>String(q).trim()).filter(Boolean):typeof z=="string"?z.split(/[\,\n]/).map(q=>q.trim()).filter(Boolean):[],P=(z,q,V)=>{if(z==null)return null;const U=Number(z);if(!Number.isFinite(U))return null;const W=Math.round(U);return Math.max(q,Math.min(V,W))},A={};e!=null&&e.custom_bins&&typeof e.custom_bins=="object"&&!Array.isArray(e.custom_bins)&&Object.entries(e.custom_bins).forEach(([z,q])=>{const V=String(z??"").trim();if(!V)return;const U=$(q);U.length>=2&&(A[V]=U)});const D={};e!=null&&e.custom_labels&&typeof e.custom_labels=="object"&&!Array.isArray(e.custom_labels)&&Object.entries(e.custom_labels).forEach(([z,q])=>{const V=String(z??"").trim();if(!V)return;const U=T(q);U.length&&(D[V]=U)});const F={},R=e!=null&&e.column_strategies&&typeof e.column_strategies=="object"&&!Array.isArray(e.column_strategies)?e.column_strategies:e!=null&&e.column_overrides&&typeof e.column_overrides=="object"&&!Array.isArray(e.column_overrides)?e.column_overrides:null;return R&&Object.entries(R).forEach(([z,q])=>{const V=String(z??"").trim();if(!V||!q||typeof q!="object"||Array.isArray(q))return;const U=q,W={},B=typeof U.strategy=="string"?U.strategy.trim().toLowerCase():"";["equal_width","equal_frequency","custom","kbins"].includes(B)&&(W.strategy=B);const I=P(U.equal_width_bins,2,200);I!==null&&(W.equalWidthBins=I);const H=P(U.equal_frequency_bins,2,200);H!==null&&(W.equalFrequencyBins=H);const J=P(U.kbins_n_bins,2,200);J!==null&&(W.kbinsNBins=J);const G=typeof U.kbins_encode=="string"?U.kbins_encode.trim().toLowerCase():"";["ordinal","onehot","onehot-dense"].includes(G)&&(W.kbinsEncode=G);const Y=typeof U.kbins_strategy=="string"?U.kbins_strategy.trim().toLowerCase():"";["uniform","quantile","kmeans"].includes(Y)&&(W.kbinsStrategy=Y);const X=$(U.custom_bins);X.length>=2&&(W.customBins=X);const Z=T(U.custom_labels);Z.length>0&&(W.customLabels=Z),Object.keys(W).length>0&&(F[V]=W)}),{strategy:n,columns:s,equalWidthBins:i,equalFrequencyBins:l,includeLowest:h,precision:u,duplicates:d,outputSuffix:f,dropOriginal:p,labelFormat:x,missingStrategy:v,missingLabel:M,customBins:A,customLabels:D,columnStrategies:F,kbinsNBins:N,kbinsEncode:j,kbinsStrategy:k}},EL=(e,t,n,s=ip)=>{if(!e.length)return null;const r=e.map(i=>{const l=t[i],u=(l==null?void 0:l.strategy)??null;if(!u)return i;const d=s[u]??u,h=[];u==="equal_width"&&(l!=null&&l.equalWidthBins)?h.push(`${l.equalWidthBins} bins`):u==="equal_frequency"&&(l!=null&&l.equalFrequencyBins)?h.push(`${l.equalFrequencyBins} bins`):u==="kbins"&&(l!=null&&l.kbinsNBins&&h.push(`${l.kbinsNBins} bins`),l!=null&&l.kbinsStrategy&&h.push(l.kbinsStrategy),l!=null&&l.kbinsEncode&&h.push(l.kbinsEncode));const p=h.length?` (${h.join(", ")})`:"";return`${i} -> ${d}${p}`});return n>e.length&&r.push(""),r.join(", ")},ML=({config:e,fieldIds:t,onIntegerChange:n,onBooleanToggle:s,onSuffixChange:r,onLabelFormatChange:i,onMissingStrategyChange:l,onMissingLabelChange:u})=>o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Global output & labeling"}),o.jsx("p",{className:"canvas-modal__note",children:"Applies to every selected column unless custom bins or labels override the defaults."}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[o.jsx(vr,{label:"Output suffix",htmlFor:t.suffix,children:o.jsx(op,{id:t.suffix,value:e.outputSuffix,onChange:d=>r(d.target.value),placeholder:"e.g. _binned"})}),o.jsx(vr,{label:"Label format",htmlFor:t.labelFormat,description:"Controls how new bin values are named when custom labels arent provided.",children:o.jsx(Sd,{id:t.labelFormat,value:e.labelFormat,onChange:d=>i(d.target.value??"range"),options:CL})}),o.jsx(vr,{label:"Decimal precision",htmlFor:t.precision,description:"Sets rounding precision for interval labels.",children:o.jsx(Yi,{id:t.precision,min:0,max:8,step:1,value:e.precision,onChange:d=>n("precision",d.target.value,0,8)})})]}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[o.jsx(Ki,{id:t.includeLowest,label:"Include the minimum value in the first bin",checked:e.includeLowest,onChange:d=>s("include_lowest",d.target.checked)}),o.jsx(Ki,{id:t.dropOriginal,label:"Remove source columns after binning",checked:e.dropOriginal,onChange:d=>s("drop_original",d.target.checked)})]})]}),o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Missing values"}),o.jsx("div",{className:"canvas-skewness__segmented",role:"radiogroup","aria-label":"Missing value handling",children:SL.map(d=>o.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":e.missingStrategy===d.value,onClick:()=>l(d.value),children:d.label},d.value))}),e.missingStrategy==="label"&&o.jsxs("div",{className:"canvas-modal__parameter-field",children:[o.jsx("label",{htmlFor:t.missingLabel,className:"canvas-modal__parameter-label",children:"Missing label"}),o.jsx("div",{className:"canvas-modal__parameter-control",children:o.jsx("input",{id:t.missingLabel,type:"text",className:"canvas-modal__input",value:e.missingLabel,onChange:d=>u(d.target.value),placeholder:"e.g. Missing"})})]})]})]}),gw=e=>ip[e]??e.replace(/_/g," "),kL=e=>{switch(e){case"high":return"High confidence";case"medium":return"Medium confidence";case"low":return"Low confidence";default:return"Confidence unknown"}},AL=(e,t,n)=>{if(!e||typeof e!="object")return"No distribution summary";const s=[];typeof e.valid_count=="number"&&Number.isFinite(e.valid_count)&&s.push(`${t(e.valid_count)} valid rows`),typeof e.distinct_count=="number"&&Number.isFinite(e.distinct_count)&&s.push(`${t(e.distinct_count)} distinct values`);const r=typeof e.minimum=="number"&&Number.isFinite(e.minimum),i=typeof e.maximum=="number"&&Number.isFinite(e.maximum);if(r||i){const l=r?n(e.minimum):"",u=i?n(e.maximum):"";s.push(`Range ${l}  ${u}`)}return typeof e.skewness=="number"&&Number.isFinite(e.skewness)&&s.push(`Skew ${n(e.skewness)}`),s.length?s.join("  "):"No distribution summary"},OL=({hasSource:e,hasReachableSource:t,isFetching:n,error:s,relativeGeneratedAt:r,sampleSize:i,binningConfig:l,binningDefaultLabel:u,binningOverrideCount:d,binningOverrideSummary:h,recommendations:p,excludedColumns:m,numericColumnCount:f,canApplyAllNumeric:y,onApplyAllNumeric:x,onApplyStrategies:_,onClearOverrides:v,customEdgeDrafts:w,customLabelDrafts:M,onOverrideStrategyChange:N,onOverrideNumberChange:C,onOverrideKbinsEncodeChange:j,onOverrideKbinsStrategyChange:E,onOverrideClear:k,onCustomBinsChange:$,onCustomLabelsChange:T,onClearCustomColumn:P,formatMetricValue:A,formatNumericStat:D})=>{const F=b.useMemo(()=>e?t?n?"Diagnostics are loading":s?"Diagnostics are unavailable at the moment.":f>0?`Detected ${f} numeric column${f===1?"":"s"} in the current sample.`:m.length>0?`Diagnostics skipped ${m.length} column${m.length===1?"":"s"} (see details).`:"No additional diagnostics were produced for the current sample.":"Connect this step to an upstream output to surface diagnostics.":"Select a dataset to surface diagnostics.",[s,m.length,t,e,n,f]),R=b.useMemo(()=>{const B=m.slice(0,6),I=Math.max(0,m.length-B.length);return{preview:B,remaining:I}},[m]),z=b.useMemo(()=>{const B=new Map;return p.forEach(I=>{const H=typeof(I==null?void 0:I.column)=="string"?I.column.trim():"";H&&B.set(H,I)}),B},[p]),q=b.useMemo(()=>{const B=new Set;return l.columns.forEach(I=>{const H=String(I??"").trim();H&&B.add(H)}),Object.keys(l.columnStrategies).forEach(I=>{const H=String(I??"").trim();H&&B.add(H)}),p.forEach(I=>{const H=typeof(I==null?void 0:I.column)=="string"?I.column.trim():"";H&&B.add(H)}),Array.from(B).sort((I,H)=>I.localeCompare(H))},[l.columnStrategies,l.columns,p]),V=(B,I)=>{var H;return!B||Object.keys(B).length===0?"__default__":B.strategy?B.strategy:(H=B.customBins)!=null&&H.length?"custom":B.kbinsNBins||B.kbinsEncode||B.kbinsStrategy?"kbins":B.equalFrequencyBins?"equal_frequency":B.equalWidthBins?"equal_width":I},U=e&&t,W=B=>{var H,J;if(!B)return[];const I=[];return typeof B.equalWidthBins=="number"&&I.push(`${B.equalWidthBins} bins`),typeof B.equalFrequencyBins=="number"&&I.push(`${B.equalFrequencyBins} bins`),typeof B.kbinsNBins=="number"&&I.push(`${B.kbinsNBins} bins`),B.kbinsStrategy&&I.push(B.kbinsStrategy),B.kbinsEncode&&I.push(B.kbinsEncode),(H=B.customBins)!=null&&H.length&&I.push("Custom bins"),(J=B.customLabels)!=null&&J.length&&I.push("Custom labels"),I};return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Binning diagnostics"}),o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:v,disabled:!d,children:"Clear"}),_&&o.jsx("button",{type:"button",className:"btn btn-primary",onClick:_,disabled:!p.length,children:"Quick apply"})]})]}),o.jsx("p",{className:"canvas-modal__note",children:F}),o.jsxs("p",{className:"canvas-modal__note",children:["Default strategy ",o.jsx("strong",{children:u}),d>0?`  Overrides: ${d}${h?` (${h})`:""}`:"  No column overrides yet"]}),o.jsxs("div",{className:"canvas-modal__collapsible",children:[!e&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface binning insights and column diagnostics."}),e&&!t&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric feature distributions."}),U&&o.jsxs(o.Fragment,{children:[r&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",r,i!==null?` on ${A(i)} row${i===1?"":"s"}.`:"."]}),x&&f>0&&o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:x,disabled:!y,children:`Add all numeric columns (${f})`})}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading binning diagnostics"}),s&&!n&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s}),!s&&o.jsxs(o.Fragment,{children:[q.length>0&&o.jsx("div",{className:"canvas-cast__body",children:o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Suggested strategy"}),o.jsx("th",{scope:"col",children:"Configured strategy"}),o.jsx("th",{scope:"col",children:"Distribution highlights"})]})}),o.jsx("tbody",{children:q.map(B=>{var mt,rt,ft,bt,zt;const I=z.get(B)??null,H=l.columnStrategies[B],J=V(H,l.strategy),G=J==="__default__"?l.strategy:J,Y=(I==null?void 0:I.recommended_strategy)??null,X=!!(Y&&Y!==G),Z=!!(H&&Object.keys(H).length),ee=l.columns.includes(B),Q=I==null?void 0:I.recommended_bins,ne=typeof Q=="number"?Q:Q!=null?Number(Q):null,he=typeof ne=="number"&&Number.isFinite(ne)&&ne>0?ne:null,ye=(H==null?void 0:H.equalWidthBins)??l.equalWidthBins,ge=(H==null?void 0:H.equalFrequencyBins)??l.equalFrequencyBins,Ee=(H==null?void 0:H.kbinsNBins)??l.kbinsNBins,De=(H==null?void 0:H.kbinsEncode)??"__default__",ke=(H==null?void 0:H.kbinsStrategy)??"__default__",le=["canvas-cast__row"];X&&le.push("canvas-cast__row--attention"),Z&&le.push("canvas-cast__row--override"),ee||le.push("canvas-cast__row--muted");const pe=AL(I==null?void 0:I.stats,A,D),be=((mt=I==null?void 0:I.reasons)==null?void 0:mt.filter(Xe=>Xe&&Xe.trim()))??[],Te=(()=>{const Xe=W(H),Ft=Array.isArray(l.customBins[B])?l.customBins[B].length>=2:!1,Kt=Array.isArray(l.customLabels[B])?l.customLabels[B].length>0:!1,Et=[...Xe];return Ft&&!Et.includes("Custom bins")&&Et.push("Custom bins"),Kt&&!Et.includes("Custom labels")&&Et.push("Custom labels"),Et})(),Ie=J==="__default__"?`Inheriting ${u}`:`Override  ${gw(G)}${Te.length?` (${Te.join(", ")})`:""}`,ue=(I==null?void 0:I.dtype)??null,$e=I?kL(I.confidence):null,Ye=Object.prototype.hasOwnProperty.call(w,B)?w[B]:((rt=l.customBins[B])==null?void 0:rt.join(", "))??"",et=Object.prototype.hasOwnProperty.call(M,B)?M[B]:((ft=l.customLabels[B])==null?void 0:ft.join(", "))??"",We=(((bt=l.customBins[B])==null?void 0:bt.length)??0)>=2||(((zt=l.customLabels[B])==null?void 0:zt.length)??0)>0;return o.jsxs("tr",{className:le.join(" "),children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:B}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[ue&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",ue]}),!ee&&o.jsx("span",{className:"canvas-cast__muted",children:"Not currently in node"}),Z&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),X&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--attention",children:"Needs review"})]})]})}),o.jsx("td",{children:o.jsx("div",{className:"canvas-cast__recommendation",children:I?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"canvas-cast__chip canvas-cast__chip--applied",children:gw(I.recommended_strategy)}),o.jsxs("span",{className:"canvas-cast__recommendation-note",children:[he!==null?`${he} bin${he===1?"":"s"}`:"Bins not provided",$e?`  ${$e}`:""]}),be.length>0&&o.jsx("span",{className:"canvas-cast__recommendation-note",children:be.join("; ")})]}):o.jsx("span",{className:"canvas-cast__muted",children:"No recommendation"})})}),o.jsx("td",{children:o.jsxs("div",{className:"canvas-cast__target",children:[o.jsxs("select",{value:J,onChange:Xe=>N(B,Xe.target.value,{recommendedBins:he}),children:[o.jsxs("option",{value:"__default__",children:["Inherit default (",u,")"]}),jL.map(Xe=>o.jsx("option",{value:Xe.value,children:Xe.label},`${B}-${Xe.value}`))]}),o.jsx("span",{className:"canvas-cast__target-note",children:Ie}),J==="equal_width"&&o.jsx("div",{className:"canvas-cast__target-note",children:o.jsxs("label",{children:["Integer bins",o.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:ye??"",onChange:Xe=>C(B,"equal_width_bins",Xe.target.value)})]})}),J==="equal_frequency"&&o.jsx("div",{className:"canvas-cast__target-note",children:o.jsxs("label",{children:["Integer bins",o.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:ge??"",onChange:Xe=>C(B,"equal_frequency_bins",Xe.target.value)})]})}),J==="kbins"&&o.jsxs("div",{className:"canvas-cast__target-note",children:[o.jsxs("label",{children:["Max bins",o.jsx("input",{type:"number",min:2,max:200,className:"canvas-modal__input",value:Ee??"",onChange:Xe=>C(B,"kbins_n_bins",Xe.target.value)})]}),o.jsxs("label",{children:["Encode",o.jsxs("select",{value:De,onChange:Xe=>j(B,Xe.target.value==="__default__"?null:Xe.target.value),children:[o.jsxs("option",{value:"__default__",children:["Default (",l.kbinsEncode,")"]}),o.jsx("option",{value:"ordinal",children:"Ordinal"}),o.jsx("option",{value:"onehot",children:"One-hot (sparse)"}),o.jsx("option",{value:"onehot-dense",children:"One-hot (dense)"})]})]}),o.jsxs("label",{children:["Strategy",o.jsxs("select",{value:ke,onChange:Xe=>E(B,Xe.target.value==="__default__"?null:Xe.target.value),children:[o.jsxs("option",{value:"__default__",children:["Default (",l.kbinsStrategy,")"]}),o.jsx("option",{value:"uniform",children:"Uniform"}),o.jsx("option",{value:"quantile",children:"Quantile"}),o.jsx("option",{value:"kmeans",children:"K-means"})]})]})]}),J==="custom"&&o.jsxs("div",{className:"canvas-cast__target-note",children:[o.jsxs("label",{children:["Custom edges",o.jsx("input",{type:"text",className:"canvas-modal__input",value:Ye,placeholder:"e.g. 0, 50, 100",onChange:Xe=>$(B,Xe.target.value)})]}),o.jsxs("label",{children:["Optional labels",o.jsx("input",{type:"text",className:"canvas-modal__input",value:et,placeholder:"e.g. Low, Medium, High",onChange:Xe=>T(B,Xe.target.value)})]}),We&&o.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>P(B),children:"Clear custom edges"})]}),Z&&o.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>k(B),children:"Clear"})]})}),o.jsx("td",{children:o.jsx("span",{children:pe})})]},`binning-insight-${B}`)})})]})})}),!n&&q.length===0&&o.jsx("p",{className:"canvas-modal__note",children:"No columns met the sampling requirements for binning recommendations."}),m.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",m.length," column",m.length===1?"":"s"," due to non-numeric values or limited variance",R.preview.length>0&&o.jsxs(o.Fragment,{children:[":"," ",R.preview.map(B=>`${B.column}${B.reason?` (${B.reason})`:""}`).join(", "),R.remaining>0?`,  (+${R.remaining} more)`:""]}),"."]})]})]})]})]})},TL=({cards:e,selectedPreset:t,onSelectPreset:n,isFetching:s,sampleSize:r,relativeGeneratedAt:i,error:l,onRefresh:u,canRefresh:d})=>{const h=b.useMemo(()=>_c.find(p=>p.value===t)??_c[0],[t]);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Binned column distributions"}),o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsxs("div",{className:"canvas-sample__group",children:[o.jsx("span",{className:"canvas-sample__label",children:"Sample"}),o.jsx("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Binned sampling presets",children:_c.map(p=>o.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":p.value===t,onClick:()=>n(p.value),disabled:s,children:p.label},p.value))})]}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:u,disabled:s||!d,children:s?"Refreshing":"Refresh"})]})]}),r!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Sampling preset: ",o.jsx("strong",{children:h.label}),"."," ",h.value==="all"?`Summaries computed from the full dataset (${r.toLocaleString()} rows).`:`Summaries computed from ${r.toLocaleString()} sampled rows.`]}),i&&o.jsxs("p",{className:"canvas-modal__note",children:["Updated ",i]}),s&&o.jsx("p",{className:"canvas-modal__note",children:"Loading binned distributions"}),!s&&l&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:l}),!s&&!l&&(e.length?o.jsx("div",{className:"canvas-binning__grid",children:e.map(p=>{const m=p.topPercentage!==null?`${p.topPercentage.toFixed(1)}%`:null,f=p.topCount!==null?`${p.topCount.toLocaleString()}${m?`  ${m}`:""}`:m??"";return o.jsxs("article",{className:"canvas-binning__card",children:[o.jsxs("header",{className:"canvas-binning__header",children:[o.jsxs("div",{children:[o.jsx("h4",{children:p.column}),p.sourceColumn&&p.sourceColumn!==p.column&&o.jsxs("p",{className:"canvas-binning__subtitle",children:["Derived from ",o.jsx("strong",{children:p.sourceColumn})]})]}),o.jsxs("div",{className:"canvas-binning__summary","aria-label":"Top bin summary",children:[o.jsx("span",{className:"canvas-binning__summary-label",children:"Top bin"}),o.jsx("span",{className:"canvas-binning__summary-value",children:p.topLabel??""}),o.jsx("span",{className:"canvas-binning__summary-meta",children:f})]})]}),o.jsxs("div",{className:"canvas-binning__meta",children:[o.jsxs("div",{children:[o.jsx("span",{className:"canvas-binning__meta-label",children:"Sample size"}),o.jsx("span",{className:"canvas-binning__meta-value",children:p.totalRows.toLocaleString()})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-binning__meta-label",children:"Distinct bins"}),o.jsx("span",{className:"canvas-binning__meta-value",children:p.distinctBins.toLocaleString()})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-binning__meta-label",children:"Missing rows"}),o.jsx("span",{className:"canvas-binning__meta-value",children:p.missingRows.toLocaleString()})]})]}),o.jsx("div",{className:"canvas-binning__bins",children:p.bins.map(y=>{const x=y.isMissing?"canvas-binning__bin-label canvas-binning__bin-label--missing":"canvas-binning__bin-label",_=Math.min(100,Math.max(0,y.percentage));return o.jsxs("div",{className:"canvas-binning__bin-row",children:[o.jsx("div",{className:x,children:y.label}),o.jsx("div",{className:"canvas-binning__bin-bar","aria-hidden":"true",children:o.jsx("div",{className:"canvas-binning__bin-bar-fill",style:{width:`${_}%`}})}),o.jsxs("div",{className:"canvas-binning__bin-stats",children:[o.jsx("span",{children:y.count.toLocaleString()}),o.jsxs("span",{children:[y.percentage.toFixed(1),"%"]})]})]},`${p.column}-${y.label}`)})}),p.hasMoreBins&&o.jsxs("p",{className:"canvas-binning__note",children:["Showing top ",p.bins.length," of ",p.totalBinCount," bins."]})]},`binned-card-${p.column}`)})}):o.jsx("p",{className:"canvas-modal__note",children:"No binned columns detected upstream. Connect this node after a binning step to view category distributions."}))]})},$L=[{value:"mean",label:"Mean (numeric)"},{value:"median",label:"Median (numeric)"},{value:"mode",label:"Mode (most frequent)"}],PL=[{value:"knn",label:"K-Nearest Neighbors (KNN)"},{value:"regression",label:"Iterative regression"},{value:"mice",label:"MICE (multivariate)"}],LL=[...$L,...PL],RL=[0,5,10,20,40,60],DL=["float","double","int","uint","long","short","byte","number","decimal"],zL=["bool","boolean"],IL=["object","string","category","datetime","date","time"],FL=e=>{const t=typeof e.dtype=="string"?e.dtype.trim().toLowerCase():"";return typeof e.mean=="number"||typeof e.median=="number"||!t?!0:IL.some(n=>t.includes(n))?!1:!!(DL.some(n=>t.includes(n))||zL.some(n=>t.includes(n)))},_w=e=>e!=="mode",yw=e=>{if(e==="knn")return{neighbors:5};if(e==="regression"||e==="mice")return{max_iter:10}},yc=(e,t)=>{if(e==="knn"){const n=t==null?void 0:t.neighbors,s=Number(n);return{neighbors:Number.isFinite(s)?Math.max(1,Math.round(s)):5}}if(e==="regression"||e==="mice"){const n=t==null?void 0:t.max_iter,s=Number(n);return{max_iter:Number.isFinite(s)?Math.max(1,Math.round(s)):10}}},vw=(e,t)=>{if(!Array.isArray(e))return[];const n=t[0]??"mean",s=new Set(t);return e.map(r=>{if(!r||typeof r!="object")return null;const i=typeof r.method=="string"?r.method.trim().toLowerCase():n,l=s.has(i)?i:n;let u=[];Array.isArray(r.columns)?u=r.columns.map(m=>String(m).trim()).filter(Boolean):typeof r.columns=="string"&&(u=r.columns.split(",").map(m=>m.trim()).filter(Boolean));const d=r.options&&typeof r.options=="object"?r.options:{};let h;if(l==="knn"){const m=d.neighbors??r.neighbors,f=Number(m);h={neighbors:Number.isFinite(f)?Math.max(1,Math.round(f)):5}}else if(l==="regression"||l==="mice"){const m=d.max_iter??d.maxIter??r.max_iter??r.maxIter,f=Number(m);h={max_iter:Number.isFinite(f)?Math.max(1,Math.round(f)):10}}const p=yc(l,h??yw(l));return{method:l,columns:u,options:p}}).filter(r=>!!r)},BL=e=>e.map(t=>{const n={method:t.method,columns:t.columns};return t.options&&Object.keys(t.options).length&&(n.options={...t.options}),n}),UL=({hasSource:e,hasReachableSource:t,strategies:n,columnOptions:s,methodOptions:r,missingFilter:i,missingFilterMax:l,missingFilterActive:u,filteredOptionCount:d,collapsedStrategies:h,onToggleStrategy:p,onRemoveStrategy:m,onAddStrategy:f,onMethodChange:y,onOptionNumberChange:x,onColumnsChange:_,onColumnToggle:v,onMissingFilterChange:w,formatMissingPercentage:M,formatNumericStat:N,formatModeStat:C,schemaDiagnostics:j})=>{const E=ve.useMemo(()=>{var P;return(P=j==null?void 0:j.entries)!=null&&P.length?new Map(j.entries.map(A=>[A.index,A])):new Map},[j]),k=Math.max(l,i||0),$=s.length>0,T=P=>{var D,F,R;const A=((D=r.find(z=>z.value===P.method))==null?void 0:D.label)??P.method;return P.method==="knn"&&((F=P.options)!=null&&F.neighbors)?`${A}  k=${P.options.neighbors}`:(P.method==="regression"||P.method==="mice")&&((R=P.options)!=null&&R.max_iter)?`${A}  ${P.options.max_iter} iter`:A};return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Imputation strategies"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:f,children:"Add strategy"})})]}),!e&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface missingness insights and recommended columns."}),e&&!t&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to load missingness insights."}),(j==null?void 0:j.blocked)&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:j.message}),s.length>0&&o.jsxs("div",{className:"canvas-imputer__filter",role:"group","aria-label":"Filter columns by missing percentage",children:[o.jsxs("div",{className:"canvas-imputer__filter-top",children:[o.jsx("label",{htmlFor:"imputer-missing-filter",children:"Minimum missing percentage"}),o.jsxs("span",{className:"canvas-imputer__filter-summary",children:["Showing ",d," of ",s.length," column",s.length===1?"":"s"]})]}),o.jsxs("div",{className:"canvas-imputer__filter-controls",children:[o.jsx(gL,{id:"imputer-missing-filter",min:0,max:k,step:1,value:i,onChange:P=>w(Number(P.target.value))}),o.jsxs("span",{className:"canvas-imputer__filter-value",children:["",o.jsxs("strong",{children:[i,"%"]})," missing"]}),o.jsx("button",{type:"button",className:"canvas-imputer__filter-reset",onClick:()=>w(0),disabled:!i,children:"Clear"})]}),o.jsx("div",{className:"canvas-imputer__filter-presets",children:RL.map(P=>o.jsxs("button",{type:"button",className:`canvas-imputer__filter-button${i===P?" canvas-imputer__filter-button--active":""}`,onClick:()=>w(P),children:["",P,"%"]},`imputer-missing-preset-${P}`))})]}),n.length?o.jsx("div",{className:"canvas-imputer__list",children:n.map((P,A)=>{var H,J,G;const D=P.columns.join(", "),F=_w(P.method),R=s.filter(Y=>{if(P.columns.includes(Y.name))return!0;if(F&&!FL(Y))return!1;const X=typeof Y.missingPercentage=="number"?Y.missingPercentage:null;return X!==null?X<=0?!1:X>=i:i===0}),z=T(P),q=P.columns.length?`${P.columns.length} column${P.columns.length===1?"":"s"}`:"No columns yet",V=h.has(A),U=R.filter(Y=>!P.columns.includes(Y.name)),W=E.get(A),B=(H=W==null?void 0:W.details)!=null&&H.length?W.details.map(Y=>Y.logical_family?`${Y.name} (${Y.logical_family})`:Y.name).join(", "):"",I=()=>{if(!R.length)return;const Y=[...P.columns];R.forEach(X=>{Y.includes(X.name)||Y.push(X.name)}),_(A,Y.join(", "))};return o.jsxs("div",{className:"canvas-imputer__card",children:[o.jsxs("div",{className:"canvas-imputer__card-header",children:[o.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>p(A),"aria-expanded":!V,"aria-controls":`imputer-strategy-body-${A}`,children:[o.jsx("span",{className:`canvas-imputer__toggle-icon${V?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),o.jsxs("span",{className:"canvas-imputer__card-text",children:[o.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",A+1]}),o.jsxs("span",{className:"canvas-imputer__card-summary",children:[z,"  ",q]})]})]}),o.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>m(A),"aria-label":`Remove strategy ${A+1}`,children:"Remove"})]}),!V&&o.jsxs("div",{className:"canvas-imputer__card-body",id:`imputer-strategy-body-${A}`,children:[o.jsx(vr,{label:"Method",children:o.jsx(Sd,{value:P.method,onChange:Y=>y(A,Y.target.value??"mean"),options:r})}),P.method==="knn"&&o.jsx(vr,{label:"Neighbors (k)",children:o.jsx(Yi,{min:1,max:50,step:1,value:((J=P.options)==null?void 0:J.neighbors)??5,onChange:Y=>x(A,"neighbors",Y.target.value)})}),(P.method==="regression"||P.method==="mice")&&o.jsx(vr,{label:"Max iterations",children:o.jsx(Yi,{min:1,max:100,step:1,value:((G=P.options)==null?void 0:G.max_iter)??10,onChange:Y=>x(A,"max_iter",Y.target.value)})}),P.method==="mice"&&o.jsx("p",{className:"canvas-modal__note",children:"MICE performs chained regressions with posterior sampling for robust imputations."}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{children:"Columns"}),B&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Remove or recast columns before applying this strategy: ",B,"."]}),R.length>0&&U.length>0&&o.jsx("button",{type:"button",className:"btn btn-link",onClick:I,children:"Select all columns"}),R.length?o.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Columns eligible for imputation",children:R.map(Y=>{const X=P.columns.includes(Y.name),Z=M(Y.missingPercentage),ee=typeof Y.mean=="number",Q=typeof Y.median=="number",ne=Y.mode!==null&&Y.mode!==void 0&&Y.mode!=="",he=ee||Q||ne;return o.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${X?" canvas-imputer__column-pill--selected":""}`,onClick:()=>v(A,Y.name),"aria-pressed":X,children:[o.jsx("span",{className:"canvas-imputer__column-pill-name",children:Y.name}),o.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[o.jsxs("span",{className:"canvas-imputer__column-pill-metric",children:["Missing: ",Z]}),Y.dtype&&o.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:Y.dtype})]}),he&&o.jsxs("div",{className:"canvas-imputer__column-pill-stats",children:[ee&&o.jsxs("span",{children:["Mean: ",N(Y.mean)]}),Q&&o.jsxs("span",{children:["Median: ",N(Y.median)]}),ne&&o.jsxs("span",{children:["Mode: ",C(Y.mode)]})]})]},Y.name)})}):o.jsx("p",{className:"canvas-modal__note",children:$?u?"No columns meet the current missingness filter. Lower the threshold or add manual columns below.":"No columns with missing values detected. Add columns manually or adjust upstream steps.":"Column catalog unavailable; enter names manually below."})]}),o.jsx("div",{className:`canvas-imputer__selected${P.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:P.columns.length?P.columns.map(Y=>o.jsx("span",{className:"canvas-imputer__selected-chip",children:Y},Y)):o.jsx("span",{children:"No columns selected yet."})}),o.jsx(vr,{label:"Manual columns (optional)",children:o.jsx(op,{value:D,onChange:Y=>_(A,Y.target.value),placeholder:"Add custom columns, separated by commas","aria-label":"Manual column entry"})}),o.jsx("p",{className:"canvas-modal__note",children:"Tap columns above to toggle them. Missing % reflects the latest row-level preview, and manual entry lets you include custom fields."})]})]},`imputer-strategy-${A}`)})}):o.jsx("p",{className:"canvas-modal__note",children:"Define one or more strategies to fill missing values. Each strategy targets a set of columns and a method."})]})},HL=({sourceId:e,hasReachableSource:t,isFetchingScaling:n,scalingConfig:s,scalingMethodOptions:r,scalingMethodDetailMap:i,scalingDefaultDetail:l,scalingAutoDetectEnabled:u,scalingSelectedCount:d,scalingDefaultLabel:h,scalingOverrideCount:p,scalingOverrideExampleSummary:m,scalingRecommendationRows:f,scalingHasRecommendations:y,scalingStatusMessage:x,scalingError:_,scalingSampleSize:v,relativeScalingGeneratedAt:w,formatMetricValue:M,formatNumericStat:N,formatMissingPercentage:C,onApplyAllRecommendations:j,onClearOverrides:E,onDefaultMethodChange:k,onAutoDetectToggle:$,onOverrideSelect:T})=>{const P=l??i.get(s.defaultMethod)??null;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Scaling insights"}),o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsx("button",{type:"button",className:"btn btn-primary",onClick:j,disabled:!y,children:"Apply recommendations"}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:E,disabled:!p,children:"Clear overrides"})]})]}),o.jsxs("p",{className:"canvas-modal__note",children:["Automatically select scaling strategies for numeric features to keep model inputs in comparable ranges. Edits here refresh the preview immediately so you can inspect the effect, but nothing is committed to your pipeline until you click ",o.jsx("strong",{children:"Save changes"})," at the bottom of this modal."]}),!e&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface scaling insights and column recommendations."}),e&&!t&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric feature distributions."}),w&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",w,v!==null?` on ${M(v)} row${v===1?"":"s"}.`:"."]}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[o.jsxs("div",{className:"canvas-modal__parameter-field",children:[o.jsx("div",{className:"canvas-modal__parameter-label",children:o.jsx("span",{children:"Default scaling method"})}),o.jsx("div",{className:"canvas-scaling__method-toggle",role:"group","aria-label":"Default scaling method",children:r.map(A=>{const D=i.get(A.value)??null,F=A.value===s.defaultMethod;return o.jsxs("button",{type:"button",className:`canvas-scaling__method-button${F?" canvas-scaling__method-button--active":""}`,"aria-pressed":F,onClick:()=>k(A.value),children:[o.jsx("span",{className:"canvas-scaling__method-label",children:A.label}),(D==null?void 0:D.description)&&o.jsx("span",{className:"canvas-scaling__method-description",children:D.description})]},A.value)})}),(P==null?void 0:P.description)&&o.jsx("p",{className:"canvas-modal__parameter-description",children:P.description})]}),o.jsx(Ki,{fieldLabel:"Auto-detect numeric columns",label:u?"Enabled":"Disabled",checked:u,onChange:A=>$(A.target.checked),description:"When enabled, recommended numeric features join this node automatically after each refresh."})]}),o.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",o.jsx("strong",{children:d})," column",d===1?"":"s"," in this node  Default method"," ",o.jsx("strong",{children:h})," ",u?" Auto-detect on":" Auto-detect off",p>0?`  Overrides: ${p}${m?` (${m})`:""}`:"  No column overrides yet"]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading scaling diagnostics"}),!n&&_&&e&&t&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:_}),!n&&!_&&o.jsxs(o.Fragment,{children:[x&&o.jsx("p",{className:"canvas-modal__note",children:x}),f.length>0&&o.jsx("div",{className:"canvas-cast__body",children:o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table canvas-scaling__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Recommendation"}),o.jsx("th",{scope:"col",children:"Distribution"}),o.jsx("th",{scope:"col",children:"Configured method"})]})}),o.jsx("tbody",{children:f.map(A=>{const D=!A.isSkipped&&A.recommendedMethod!==A.currentMethod,F=["canvas-cast__row"];D&&F.push("canvas-cast__row--attention"),A.isOverrideApplied&&F.push("canvas-cast__row--override"),A.isSkipped&&F.push("canvas-cast__row--muted");const R=A.isSkipped?"__skip__":A.isOverrideApplied?A.currentMethod:"__default__",z=A.isOverrideApplied?`Override -> ${A.currentMethodLabel}`:A.isSkipped?"Skipped (column will not be scaled)":A.isSelected?`Inheriting ${h}`:"Pending inclusion",q=A.stats,V=[];typeof q.valid_count=="number"&&Number.isFinite(q.valid_count)&&V.push(`${M(q.valid_count)} valid rows`),typeof q.mean=="number"&&Number.isFinite(q.mean)&&V.push(`Mean ${N(q.mean)}`),typeof q.median=="number"&&Number.isFinite(q.median)&&V.push(`Median ${N(q.median)}`),typeof q.stddev=="number"&&Number.isFinite(q.stddev)&&V.push(` ${N(q.stddev)}`),typeof q.iqr=="number"&&Number.isFinite(q.iqr)&&V.push(`IQR ${N(q.iqr)}`);const U=typeof q.minimum=="number"&&Number.isFinite(q.minimum),W=typeof q.maximum=="number"&&Number.isFinite(q.maximum);if(U||W){const I=U?N(q.minimum):"",H=W?N(q.maximum):"";V.push(`Range ${I}  ${H}`)}typeof q.skewness=="number"&&Number.isFinite(q.skewness)&&V.push(`Skew ${N(q.skewness)}`),typeof q.outlier_ratio=="number"&&Number.isFinite(q.outlier_ratio)&&q.outlier_ratio>0&&V.push(`${C(q.outlier_ratio*100)} outliers`);const B=V.length?V.join("  "):null;return o.jsxs("tr",{className:F.join(" "),children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:A.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[A.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",A.dtype]}),A.isExcluded&&o.jsx("span",{className:"canvas-cast__muted",children:"Excluded from scaling (non-numeric)"}),A.isSelected&&!A.isExcluded&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),A.isSkipped&&!A.isExcluded&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--skipped",children:"Skipped"}),A.isOverrideApplied&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"})]})]})}),o.jsx("td",{children:o.jsxs("div",{className:"canvas-cast__recommendation",children:[o.jsx("span",{className:`canvas-cast__chip${D?" canvas-cast__chip--attention":" canvas-cast__chip--applied"}`,children:A.recommendedLabel}),o.jsx("span",{className:"canvas-cast__recommendation-note",children:A.confidenceLabel}),A.reasons.length>0&&o.jsx("span",{className:"canvas-cast__recommendation-note",children:A.reasons.join("; ")})]})}),o.jsx("td",{children:B?o.jsx("span",{children:B}):o.jsx("span",{className:"canvas-cast__muted",children:"No distribution summary"})}),o.jsx("td",{children:o.jsxs("div",{className:"canvas-cast__target",children:[o.jsxs("select",{value:R,onChange:I=>T(A.column,I.target.value),children:[o.jsxs("option",{value:"__default__",children:["Inherit default (",h,")"]}),o.jsx("option",{value:"__skip__",children:"Skip scaling for this column"}),r.map(I=>o.jsx("option",{value:I.value,children:I.label},`${A.column}-${I.value}`))]}),o.jsx("span",{className:"canvas-cast__target-note",children:z})]})})]},`scaling-row-${A.column}`)})})]})})})]})]})},Ed=["log","square_root","cube_root","reciprocal","square","exponential","box_cox","yeo_johnson"],qL="log",Xr=e=>typeof e=="string"&&Ed.includes(e),xw=e=>Array.isArray(e)?e.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"",s=typeof t.method=="string"?t.method.trim():"";if(!n)return null;const r=Xr(s)?s:qL;return{column:n,method:r}}).filter(t=>!!t):[],lp=e=>{const t=new Set,n=[];return e.forEach(s=>{const r=`${s.column}__${s.method}`;t.has(r)||(t.add(r),n.push(s))}),n},bw={left:"Left skew",right:"Right skew"},VL={log:"Logarithmic",square_root:"Square Root",cube_root:"Cube Root",reciprocal:"Reciprocal (Inverse)",square:"Square",exponential:"Exponential",box_cox:"BoxCox",yeo_johnson:"YeoJohnson"},WL=e=>{const t={...VL};return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():"",r=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";!s||!r||Xr(s)&&(t[s]=r)}),t},YL=({viewMode:e,recommendations:t,columnOptions:n,recommendationMap:s,transformationMap:r})=>{const i=e==="recommended"?t.map(d=>d!=null&&d.column?d.column:null).filter(d=>!!d):n,l=new Set,u=[];return i.forEach(d=>{const h=typeof d=="string"?d.trim():"";if(!h||l.has(h))return;l.add(h);const p=s.get(h)??null,m=p?p.recommended_methods.filter(Xr):[],f=m.length?m[0]:null,y=p!=null&&p.direction?bw[p.direction]??p.direction:null,x=p!=null&&p.magnitude?`${p.magnitude.charAt(0).toUpperCase()}${p.magnitude.slice(1)}`:null,_=p&&typeof p.skewness=="number"&&Number.isFinite(p.skewness)?p.skewness:null,v=(p==null?void 0:p.summary)??null,w=r.get(h)??null;u.push({column:h,recommendedMethods:m,primaryMethod:f,directionLabel:y,magnitudeLabel:x,skewnessValue:_,summary:v,selectedMethod:w})}),u.sort((d,h)=>{const p=typeof d.skewnessValue=="number"?Math.abs(d.skewnessValue):-1/0,m=typeof h.skewnessValue=="number"?Math.abs(h.skewnessValue):-1/0;if(p!==m)return m-p;const f=!!d.primaryMethod,y=!!h.primaryMethod;return f!==y?f?-1:1:d.column.localeCompare(h.column)}),u},KL=(e,t,n)=>{if(!t)return[{key:"all",label:null,method:null,rows:e}];const s="no-recommendation",r=new Map;e.forEach(l=>{const u=l.primaryMethod??null,d=u??s,h=u?n(u):"No recommended action",p=r.get(d)??{key:d,label:h,method:u,rows:[]};p.rows.push(l),r.set(d,p)});const i=Array.from(r.values());return i.sort((l,u)=>{const d=f=>f?Ed.indexOf(f):Ed.length,h=d(l.method)-d(u.method);if(h!==0)return h;if(l.rows.length!==u.rows.length)return u.rows.length-l.rows.length;const p=l.label??"",m=u.label??"";return p.localeCompare(m)}),i},GL=({sourceId:e,hasReachableSource:t,isFetchingSkewness:n,skewnessThreshold:s,skewnessError:r,skewnessViewMode:i,skewnessRecommendedCount:l,skewnessNumericCount:u,skewnessGroupByMethod:d,skewnessRows:h,skewnessTableGroups:p,hasSkewnessAutoRecommendations:m,skewnessTransformationsCount:f,isFetchingRecommendations:y,getSkewnessMethodLabel:x,getSkewnessMethodStatus:_,onApplyRecommendations:v,onViewModeChange:w,onGroupByToggle:M,onOverrideChange:N,onClearSelections:C})=>o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Skewness insights"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:v,disabled:y||!m,children:"Apply recommendations"})})]}),s!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns with |skewness|  ",s.toFixed(2)," are surfaced below."]}),n&&h.length===0&&o.jsx("p",{className:"canvas-modal__note",children:"Loading skewness diagnostics"}),!n&&r&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:r}),(!n||h.length>0)&&!r&&o.jsxs("div",{className:"canvas-skewness__body",children:[o.jsxs("div",{className:"canvas-skewness__toolbar",children:[o.jsxs("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Skewness view",children:[o.jsxs("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":i==="recommended",onClick:()=>w("recommended"),disabled:!l,children:["Recommended (",l,")"]}),o.jsxs("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":i==="all",onClick:()=>w("all"),disabled:!u,children:["All numeric (",u,")"]})]}),o.jsx(Ki,{label:"Group columns by recommended action",checked:d,onChange:j=>M(j.target.checked),className:"canvas-skewness__toggle"})]}),h.length===0?o.jsx("p",{className:"canvas-modal__note",children:i==="recommended"?"No columns met the skewness threshold for recommendations. Switch to All numeric to configure overrides manually.":"No numeric columns available for skewness review."}):o.jsx("div",{className:"canvas-skewness__table-wrapper",children:p.map(j=>o.jsxs("div",{className:"canvas-skewness__group",children:[j.label&&o.jsxs("div",{className:"canvas-skewness__group-header",children:[o.jsx("h4",{children:j.label}),o.jsxs("span",{children:[j.rows.length," column",j.rows.length===1?"":"s"]})]}),o.jsx("div",{className:"canvas-skewness__table-scroll",children:o.jsxs("table",{className:"canvas-skewness__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Suggested transform"}),o.jsx("th",{scope:"col",children:"Skewness level"}),o.jsx("th",{scope:"col",children:"Override"})]})}),o.jsx("tbody",{children:j.rows.map(E=>{const k=[];E.directionLabel&&k.push(E.directionLabel),E.skewnessValue!==null&&k.push(`(${E.skewnessValue.toFixed(2)})`),E.magnitudeLabel&&k.push(` ${E.magnitudeLabel}`);const $=k.length?k.join(" "):"",T=E.selectedMethod??"",P=new Set(E.recommendedMethods),A=[{value:"",label:"No transform",status:null,reason:null}];E.recommendedMethods.forEach(R=>{const z=_(E.column,R);A.push({value:R,label:`${x(R)}${R===E.primaryMethod?" (recommended)":""}`,status:z,reason:(z==null?void 0:z.reason)??null})}),Ed.forEach(R=>{if(P.has(R))return;const z=_(E.column,R);A.push({value:R,label:x(R),status:z,reason:(z==null?void 0:z.reason)??null})});const D=E.selectedMethod?_(E.column,E.selectedMethod):null,F=!E.selectedMethod&&E.primaryMethod?_(E.column,E.primaryMethod):null;return o.jsxs("tr",{className:`canvas-skewness__row${E.selectedMethod?" canvas-skewness__row--active":""}`,children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-skewness__column-cell",children:[o.jsx("span",{className:"canvas-skewness__column-name",children:E.column}),E.summary&&o.jsx("span",{className:"canvas-skewness__column-summary",children:E.summary})]})}),o.jsx("td",{children:E.recommendedMethods.length?o.jsx("span",{className:`canvas-skewness__chip${E.primaryMethod?" canvas-skewness__chip--recommended":""}`,children:E.primaryMethod?x(E.primaryMethod):x(E.recommendedMethods[0])}):o.jsx("span",{className:"canvas-skewness__muted",children:"No recommendation"})}),o.jsx("td",{children:o.jsx("span",{className:"canvas-skewness__metric",children:$})}),o.jsx("td",{children:o.jsxs("div",{className:"canvas-skewness__override",children:[o.jsx(Sd,{value:T,onChange:R=>N(E.column,R.target.value),disabled:y||!t,options:[],children:A.map(R=>{var V;const z=R.reason?`${R.label} (caution: ${R.reason})`:R.label,q=((V=R.status)==null?void 0:V.status)??"ready";return o.jsx("option",{value:R.value,"data-status":q,children:z},`skewness-option-${E.column}-${R.value||"none"}`)})}),D&&D.status!=="ready"&&D.reason&&o.jsxs("span",{className:"canvas-skewness__status canvas-skewness__status--error",children:["Selected transform may be incompatible: ",D.reason]}),!E.selectedMethod&&F&&F.status!=="ready"&&F.reason&&o.jsxs("span",{className:"canvas-skewness__status",children:["Recommended transform flagged: ",F.reason]})]})})]},`skewness-row-${E.column}`)})})]})})]},`skewness-group-${j.key}`))}),o.jsxs("div",{className:"canvas-skewness__footer",children:[o.jsx("span",{children:f?`${f} transformation${f===1?"":"s"} configured`:"No transformations configured yet."}),f>0&&o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:C,children:"Clear selections"})]})]})]}),XL=({counts:e,binEdges:t,className:n})=>{const s=b.useId(),r=n??"canvas-skewness__histogram";if(!e||e.length===0||!t||t.length!==e.length+1)return o.jsx("div",{className:r,"aria-hidden":"true"});const i=e.reduce((d,h)=>Math.max(d,h),0),l=i>0?i:1,u=100/e.length;return o.jsx("div",{className:r,role:"img","aria-label":"Histogram sparkline",children:o.jsxs("svg",{viewBox:"0 0 100 60",children:[o.jsx("line",{x1:"0",y1:"58",x2:"100",y2:"58",stroke:"rgba(148, 163, 184, 0.35)",strokeWidth:"0.75"}),e.map((d,h)=>{const p=d/l*52,m=h*u,f=58-p,y=Math.max(u-2,1);return o.jsx("rect",{x:m+1,y:f,width:y,height:p,rx:1.2,ry:1.2,fill:`url(#${s})`},`hist-bin-${h}`)}),o.jsx("defs",{children:o.jsxs("linearGradient",{id:s,x1:"0",x2:"0",y1:"0",y2:"1",children:[o.jsx("stop",{offset:"0%",stopColor:"rgba(165, 180, 252, 0.95)"}),o.jsx("stop",{offset:"100%",stopColor:"rgba(129, 140, 248, 0.35)"})]})})]})})},QL=({skewnessThreshold:e,isFetchingSkewness:t,skewnessError:n,skewnessDistributionCards:s,skewnessDistributionView:r,setSkewnessDistributionView:i,onRefresh:l,canRefresh:u})=>{const d=(h,p,m)=>{const f=Math.max(0,h.sample_size||0),y=Math.max(0,h.missing_count||0);return o.jsxs("div",{className:"canvas-skewness__distribution-block",children:[o.jsxs("div",{className:"canvas-skewness__distribution-block-title",children:[o.jsx("span",{children:p}),m?o.jsx("span",{className:"canvas-skewness__distribution-block-method",children:m}):null]}),o.jsx(XL,{counts:h.counts,binEdges:h.bin_edges,className:"canvas-skewness__histogram"}),o.jsxs("div",{className:"canvas-skewness__distribution-stats",children:[o.jsxs("div",{children:[o.jsx("span",{className:"canvas-skewness__stat-label",children:"Min"}),o.jsx("span",{className:"canvas-skewness__stat-value",children:Ps(h.minimum)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-skewness__stat-label",children:"Median"}),o.jsx("span",{className:"canvas-skewness__stat-value",children:Ps(h.median)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-skewness__stat-label",children:"Max"}),o.jsx("span",{className:"canvas-skewness__stat-value",children:Ps(h.maximum)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-skewness__stat-label",children:"Mean"}),o.jsx("span",{className:"canvas-skewness__stat-value",children:Ps(h.mean)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-skewness__stat-label",children:"Std dev"}),o.jsx("span",{className:"canvas-skewness__stat-value",children:Ps(h.stddev)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-skewness__stat-label",children:"Valid"}),o.jsx("span",{className:"canvas-skewness__stat-value",children:f.toLocaleString()})]}),o.jsxs("div",{children:[o.jsx("span",{className:"canvas-skewness__stat-label",children:"Missing"}),o.jsx("span",{className:"canvas-skewness__stat-value",children:y.toLocaleString()})]})]})]},p)};return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Skewness distributions"}),o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsxs("div",{className:"canvas-skewness__segmented",role:"group","aria-label":"Distribution view",children:[o.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":r==="before",onClick:()=>i("before"),disabled:!s.length,children:"Before"}),o.jsx("button",{type:"button",className:"canvas-skewness__segmented-button","data-active":r==="after",onClick:()=>i("after"),disabled:!s.length,children:"After"})]}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:l,disabled:t||!u,children:t?"Refreshing":"Refresh"})]})]}),e!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns with |skewness|  ",e.toFixed(2)," are visualized below."]}),t&&s.length===0&&o.jsx("p",{className:"canvas-modal__note",children:"Loading skewness distributions"}),!t&&n&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:n}),(!t||s.length>0)&&!n&&(s.length?o.jsx("div",{className:"canvas-skewness__distribution-grid",children:s.map(h=>{const p=h.distributionAfter,m=r==="before",f=r==="after"&&!!p,y=r==="after"&&!p,x=r==="before"?"Showing the original distribution returned by the skewness analysis.":p?"Showing the recomputed distribution after the applied transform.":"A transformed distribution is not available yet for this column.";return o.jsxs("article",{className:"canvas-skewness__distribution-card","aria-label":`Distribution for ${h.column}`,children:[o.jsxs("header",{className:"canvas-skewness__distribution-header",children:[o.jsxs("div",{children:[o.jsx("h4",{children:h.column}),o.jsxs("div",{className:"canvas-skewness__distribution-tags",children:[h.directionLabel&&o.jsx("span",{className:"canvas-skewness__chip canvas-skewness__chip--muted",children:h.directionLabel}),h.magnitudeLabel&&o.jsx("span",{className:"canvas-skewness__chip canvas-skewness__chip--muted",children:h.magnitudeLabel}),h.recommendedLabel&&o.jsxs("span",{className:"canvas-skewness__chip canvas-skewness__chip--recommended",children:["Suggested: ",h.recommendedLabel]}),h.appliedLabel&&o.jsxs("span",{className:"canvas-skewness__chip canvas-skewness__chip--applied",children:["Applied: ",h.appliedLabel]})]})]}),o.jsxs("div",{className:"canvas-skewness__distribution-skew",children:[o.jsx("span",{children:"Skewness"}),o.jsx("strong",{children:h.skewness!==null?Ws(h.skewness,2):""})]})]}),h.summary&&o.jsx("p",{className:"canvas-skewness__distribution-summary",children:h.summary}),o.jsxs("div",{className:"canvas-skewness__distribution-comparison",children:[m?d(h.distributionBefore,"Before transform"):null,f&&p?d(p,"After transform",h.appliedLabel):null,y?o.jsx("div",{className:"canvas-skewness__distribution-empty",children:"After transform data isnt available yet. Apply a skewness method and rerun the node to generate this view."}):null]}),o.jsxs("footer",{className:"canvas-skewness__distribution-footnote",children:["Histogram bins are based on the sampled rows returned by the skewness analysis. ",x]})]},`skewness-dist-${h.column}`)})}):o.jsx("p",{className:"canvas-modal__note",children:"No columns met the skewness threshold for visualization. Refresh with a larger sample if needed."}))]})},ZL=({suffix:e,insights:t,formatMissingPercentage:n})=>{const{rows:s,flaggedColumnsInDataset:r,conflictCount:i}=t,l=s.length>0,u=e||"(no suffix)",d=r.slice(0,4),h=Math.max(r.length-d.length,0);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Missing indicator summary"})}),o.jsxs("p",{className:"canvas-modal__note",children:["Generates ",o.jsx("strong",{children:s.length})," flag column",s.length===1?"":"s"," using suffix"," ",o.jsx("strong",{children:u}),"."]}),r.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Detected ",r.length," existing flag column",r.length===1?"":"s"," ","with this suffix",d.length>0?` (examples: ${d.join(", ")}${h>0?", ":""})`:"","."]}),i>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[i," generated flag column",i===1?" has":"s have"," naming conflicts. Adjust the suffix or remove conflicting columns."]}),l?o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Missing %"}),o.jsx("th",{scope:"col",children:"Flag column"}),o.jsx("th",{scope:"col",children:"Status"})]})}),o.jsx("tbody",{children:s.map(p=>{const m=[];p.conflicts.alreadyExists&&m.push("Already exists"),p.conflicts.duplicateFlag&&m.push("Duplicate name");const f=m.length>0,y=f?m.join("  "):"Ready",x=f?"canvas-cast__chip canvas-cast__chip--attention":"canvas-cast__chip canvas-cast__chip--applied",_=f?"canvas-cast__row canvas-cast__row--attention":"canvas-cast__row";return o.jsxs("tr",{className:_,children:[o.jsx("th",{scope:"row",children:p.column}),o.jsx("td",{children:n(p.missingPercentage)}),o.jsx("td",{children:p.flagColumn}),o.jsx("td",{children:o.jsx("span",{className:x,children:y})})]},`missing-indicator-${p.column}`)})})]})}):o.jsx("p",{className:"canvas-modal__note",children:"Select columns below to create missing-value flags."})]})},JL=({columnsParameter:e,suffixParameter:t,renderParameterField:n})=>!e&&!t?null:o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Missing indicator settings"})}),o.jsxs("div",{className:"canvas-modal__parameter-list",children:[e?n(e):null,t?n(t):null]})]}),ww=["canonicalize_country_codes","normalize_boolean","punctuation","custom"],cp="canonicalize_country_codes",eR=new Set(ww),tR=["string","object","text","category","mixed","varchar","char"],nR=4,sR=6,Io=4,rR=3,Nw=36,aR=5,up={canonicalize_country_codes:{label:"Country aliases",guidance:'Maps abbreviations such as "UK" or "UAE" to canonical country names.',examples:["UK => United Kingdom","UAE => United Arab Emirates"]},normalize_boolean:{label:"Boolean tokens",guidance:"Standardizes yes/no style values so downstream logic sees consistent tokens.",examples:["y => Yes","0 => No"]},punctuation:{label:"Punctuation cleanup",guidance:"Strips punctuation and squeezes whitespace to simplify fuzzy matching.",examples:["C.R.M. => CRM","Part - Time => Part Time"]},custom:{label:"Custom mappings",guidance:"Applies the alias pairs you provide. Each entry should follow alias => replacement.",examples:["st => Street","rd => Road"]}},jw=ww.map(e=>{var t;return{value:e,label:((t=up[e])==null?void 0:t.label)??e}}),oR=new Set(["true","1","yes","y","on"]),iR=new Set(["false","0","no","n","off"]),lR=(e,t)=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:t:t;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(oR.has(n))return!0;if(iR.has(n))return!1}return t},dp=e=>Array.isArray(e)?Array.from(new Set(e.map(t=>typeof t=="string"?t.trim():String(t??"").trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?dp(e.split(",")):[],Cw=(e,t)=>{if(!e||typeof e!="object")return null;const n=e,s=dp(n.columns),r=lR(n.auto_detect??n.autoDetect??n.auto,t.autoDetect),i=kd(typeof n.mode=="string"?n.mode:void 0,t.mode);return!s.length&&!r?null:{mode:i,columns:s,autoDetect:r}},Sw=(e,t)=>{const n={mode:t.mode,columns:dp(t.columns),autoDetect:!!t.autoDetect};if(!e)return!n.columns.length&&!n.autoDetect&&(n.autoDetect=!0),[n];if(!Array.isArray(e)){const r=Cw(e,n);return r?[r]:[n]}const s=[];return e.forEach(r=>{const i=Cw(r,n);i&&s.push(i)}),s.length===0?(!n.columns.length&&!n.autoDetect&&(n.autoDetect=!0),[n]):s},cR=e=>e.map(t=>({mode:t.mode,columns:[...t.columns],auto_detect:!!t.autoDetect})),uR=e=>e.replace(/[\s\W_]+/g,"").toLowerCase(),Md=e=>e.length<=Nw?e:`${e.slice(0,Nw-1)}...`,Ew=e=>eR.has(e),Mw=e=>{if(!e)return!1;const t=e.toLowerCase();return tR.some(n=>t.includes(n))},kd=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Ew(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&Ew(s)?s:cp},dR=e=>{const t=up[e]??up[cp];return{mode:e,label:t.label,guidance:t.guidance,examples:t.examples}},mR=({selectedColumns:e,availableColumns:t,columnTypeMap:n,autoDetectEnabled:s})=>{const r=Array.from(new Set(Ge(e))),i=new Set(r),l=t.filter(p=>Mw(n[p]??null)),u=l.filter(p=>!i.has(p)),d=r.filter(p=>!Mw(n[p]??null)),h=typeof s=="boolean"?s:r.length===0;return{selectedColumns:r,nonTextSelected:d,autoDetectionActive:h,recommendedColumns:u,textColumnCount:l.length,textColumns:l}},fR=/[\n;,]+/,Gi=(e,t)=>e.slice(0,t),Ad=(e,t)=>{const n=e.split(t);if(n.length<2)return null;const[s,...r]=n,i=r.join(t);return[s,i]},hR=e=>{if(!e)return{totalPairs:0,previewPairs:[],previewOverflow:0,duplicates:[],duplicateOverflow:0,invalidEntries:[],invalidOverflow:0};const t=new Set,n=[],s=[],r=new Map;let i=0;const l=(p,m)=>{const f=String(p??"").trim(),y=String(m??"").trim();if(!f||!y){(f||y)&&n.push(`${f} => ${y}`.trim());return}const x=uR(f);if(!x){n.push(`${f} => ${y}`);return}r.has(x)?t.add(f):(r.set(x,y),s.length<nR&&s.push(`${f} => ${y}`)),i+=1};if(typeof e=="string"){e.split(fR).forEach(x=>{const _=x.trim();if(_){if(_.includes("=>")){const v=Ad(_,"=>");v?l(v[0],v[1]):n.push(_);return}if(_.includes(":")){const v=Ad(_,":");v?l(v[0],v[1]):n.push(_);return}n.push(_)}});const m=Array.from(t),f=Gi(m,Io),y=Gi(n,Io);return{totalPairs:i,previewPairs:s,previewOverflow:Math.max(i-s.length,0),duplicates:f,duplicateOverflow:Math.max(m.length-f.length,0),invalidEntries:y,invalidOverflow:Math.max(n.length-y.length,0)}}if(Array.isArray(e)){e.forEach(y=>{if(y){if(typeof y=="string"){const x=y.trim();if(!x)return;if(x.includes("=>")){const _=Ad(x,"=>");_?l(_[0],_[1]):n.push(x)}else if(x.includes(":")){const _=Ad(x,":");_?l(_[0],_[1]):n.push(x)}else n.push(x);return}if(typeof y=="object"){const{alias:x,replacement:_}=y;l(x,_);return}n.push(String(y))}});const p=Array.from(t),m=Gi(p,Io),f=Gi(n,Io);return{totalPairs:i,previewPairs:s,previewOverflow:Math.max(i-s.length,0),duplicates:m,duplicateOverflow:Math.max(p.length-m.length,0),invalidEntries:f,invalidOverflow:Math.max(n.length-f.length,0)}}typeof e=="object"&&Object.entries(e).forEach(([p,m])=>{l(p,m)});const u=Array.from(t),d=Gi(u,Io),h=Gi(n,Io);return{totalPairs:i,previewPairs:s,previewOverflow:Math.max(i-s.length,0),duplicates:d,duplicateOverflow:Math.max(u.length-d.length,0),invalidEntries:h,invalidOverflow:Math.max(n.length-h.length,0)}},pR=e=>{const t=e.slice(0,sR);return{preview:t,remaining:Math.max(e.length-t.length,0)}},gR=e=>{const t=e.slice(0,Io);return{preview:t,remaining:Math.max(e.length-t.length,0)}},_R=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?Md(String(e)):null;if(typeof e=="boolean")return e?"True":"False";if(typeof e=="string"){const t=e.trim();return t?Md(t):null}try{const t=JSON.stringify(e);return t?Md(t):null}catch{return Md(String(e))}},yR=(e,t=rR)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;const u=_R(i);if(!u)return;const d=n[l]??[];d.includes(u)||d.length>=t||(n[l]=[...d,u])})}),n},vR=(e,t,n=aR)=>{if(!t.length)return[];const s=[];for(const r of t){if(s.length>=n)break;const i=e[r];!i||!i.length||s.push({column:r,values:i,overflow:0})}return s},mp=e=>e.replace(/[^0-9a-zA-Z]+/g,"").toLowerCase(),kw=[["UK","United Kingdom"],["UAE","United Arab Emirates"],["USA","United States"],["PRC","China"],["KSA","Saudi Arabia"],["Brasil","Brazil"]],Aw=new Set(["us","usa","unitedstates","unitedstatesofamerica","uk","unitedkingdom","greatbritain","england","uae","unitedarabemirates","prc","china","southkorea","republicofkorea","ksa","saudiarabia","brasil","brazil","de","germany","fr","france","es","spain","ca","canada","mx","mexico","country","state","province"]);kw.forEach(e=>{e.forEach(t=>Aw.add(mp(t)))});const Ow=[["Y","Yes"],["1","Yes"],["ON","Yes"],["N","No"],["0","No"],["OFF","No"]],Tw=new Set(["yes","y","true","t","1","on","enable","enabled","no","n","false","f","0","off","disable","disabled","active","inactive","flag"]);Ow.forEach(e=>{e.forEach(t=>Tw.add(mp(t)))});const xR=[["C.R.M.","CRM"],["Part - Time","Part Time"],["end-to-end","end to end"]],bR=/^[A-Za-z]{2,3}$/,wR=/[^0-9A-Za-z\s]/,NR=/[^0-9A-Za-z]+/,Od={canonicalize_country_codes:{title:"Country alias map",description:"Common country abbreviations resolve to canonical names or ISO codes.",preview:kw},normalize_boolean:{title:"Boolean token map",description:"Typical yes / no style values are standardized.",preview:Ow},punctuation:{title:"Punctuation cleanup",description:"Removes punctuation and condenses whitespace for easier matching.",preview:xR},custom:{title:"Custom mappings",description:"Define your own alias => replacement pairs below."}},jR=e=>{const t=[];return e.forEach(n=>{n.split(NR).filter(Boolean).forEach(r=>{t.push(r)})}),t},CR=(e,t)=>{if(!t.length)return!1;if(e==="punctuation")return t.some(s=>wR.test(s));const n=jR(t).map(s=>mp(s));return n.length?e==="canonicalize_country_codes"?n.some(s=>Aw.has(s))||t.some(s=>bR.test(s.trim())):e==="normalize_boolean"?n.some(s=>Tw.has(s)):!1:!1},$w=e=>{if(!e.length)return null;const t=e.slice(0,3);return e.length-t.length>0?`${t.join(", ")} ...`:t.join(", ")},SR=({hasSource:e,hasReachableSource:t,strategies:n,columnSummary:s,columnOptions:r,sampleMap:i,modeOptions:l=jw,customPairSummary:u,customPairsParameter:d,collapsedStrategies:h,onToggleStrategy:p,onRemoveStrategy:m,onAddStrategy:f,onModeChange:y,onAutoDetectToggle:x,onColumnToggle:_,onColumnsChange:v,renderParameterField:w})=>{const M=n.length>0,N=s.selectedColumns.length,C=b.useMemo(()=>pR(s.recommendedColumns),[s.recommendedColumns]),j=b.useMemo(()=>gR(s.nonTextSelected),[s.nonTextSelected]),E=b.useMemo(()=>vR(i,s.selectedColumns),[s.selectedColumns,i]),k=!e||!t,$=u.duplicates.length+u.duplicateOverflow,T=u.invalidEntries.length+u.invalidOverflow,P=u.duplicates.join(", "),A=u.invalidEntries.join(", "),D=b.useMemo(()=>n.some(G=>G.mode==="custom"),[n]),F=b.useMemo(()=>{const G=new Map;return n.forEach(Y=>{Y.columns.forEach(X=>{const Z=X.trim();Z&&G.set(Z,(G.get(Z)??0)+1)})}),G},[n]),[R,z]=b.useState(()=>new Set),q=b.useCallback(G=>{z(Y=>{const X=new Set(Y);return X.has(G)?X.delete(G):X.add(G),X})},[]);b.useEffect(()=>{z(G=>{const Y=new Set;return G.forEach(X=>{X<n.length&&Y.add(X)}),Y.size===G.size?G:Y})},[n.length]);const[V,U]=b.useState(()=>({index:null,mode:null})),W=b.useMemo(()=>{const G=new Map;return r.forEach(Y=>{const X=Array.isArray(Y.samples)?Y.samples:[],Z=Array.isArray(i[Y.name])?i[Y.name]:[],ee=[...X,...Z].map(Q=>String(Q??"").trim()).filter(Q=>Q.length>0);G.set(Y.name,ee.slice(0,12))}),G},[r,i]),B=b.useMemo(()=>{const G=new Map;return r.forEach(Y=>{const X=W.get(Y.name)??[],Z=X.length?X:[Y.name];["canonicalize_country_codes","normalize_boolean","punctuation"].forEach(ee=>{CR(ee,Z)&&(G.has(ee)||G.set(ee,new Set),G.get(ee).add(Y.name))})}),G},[r,W]);b.useEffect(()=>{if(V.index===null)return;const G=n[V.index];(!G||G.mode!==V.mode)&&U({index:null,mode:null})},[V.index,V.mode,n]);const I=b.useCallback((G,Y)=>{U({index:G,mode:Y})},[]),H=b.useCallback(()=>{U({index:null,mode:null})},[]);let J=!1;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Alias cleanup strategies"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:f,children:"Add strategy"})})]}),s.autoDetectionActive?o.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is enabled; any remaining text-like columns will be swept into the strategies when this node runs."}):o.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",o.jsx("strong",{children:N})," column",N===1?"":"s"," across all strategies."]}),E.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",E.map(G=>`${G.column} (${G.values.join(", ")})`).join("; "),"."]}),s.textColumnCount>0&&C.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",C.preview.join(", "),C.remaining>0?`, ... (${C.remaining} more)`:"","."]}),j.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[j.preview.join(", ")," ",j.preview.length===1?"is":"are"," not text-like.",j.remaining>0?` ${j.remaining} more column${j.remaining===1?" is":"s are"} also non-text.`:" Remove them or double-check the data."]}),k?e?o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to inspect available columns."}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to load available columns for alias cleanup."}):null,!M&&o.jsx("p",{className:"canvas-modal__note",children:"No strategies configured yet. Combine presets (countries, booleans, punctuation) or add custom maps to standardize aliases."}),M&&o.jsx("div",{className:"canvas-imputer__list",children:n.map((G,Y)=>{var Ie;const X=dR(G.mode),Z=((Ie=l.find(ue=>ue.value===G.mode))==null?void 0:Ie.label)??X.label,ee=G.columns.length,Q=ee?`${ee} column${ee===1?"":"s"}`:G.autoDetect?"Auto-detecting columns":"No columns yet",ne=h.has(Y),he=R.has(Y),ye=G.columns.join(", "),ge=B.get(G.mode)??new Set,Ee=G.mode==="custom"&&!!d&&!J,De=G.mode==="custom"&&!!d&&J;Ee&&(J=!0);const ke=r.map(ue=>{const $e=G.columns.includes(ue.name),Ye=ge.has(ue.name),et=$e?0:Ye?1:ue.isRecommended?2:ue.isTextLike?3:4;return{option:ue,priority:et}}).sort((ue,$e)=>ue.priority!==$e.priority?ue.priority-$e.priority:ue.option.name.localeCompare($e.option.name)).map(ue=>ue.option),le=ge.size>0,pe=ke.filter(ue=>G.columns.includes(ue.name)?!0:le?ge.has(ue.name):ue.isRecommended||ue.isTextLike),be=new Set(pe.map(ue=>ue.name)),Te=ke.filter(ue=>!be.has(ue.name));return o.jsxs("div",{className:"canvas-imputer__card",children:[o.jsxs("div",{className:"canvas-imputer__card-header",children:[o.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>p(Y),"aria-expanded":!ne,"aria-controls":`alias-strategy-body-${Y}`,children:[o.jsx("span",{className:`canvas-imputer__toggle-icon${ne?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),o.jsxs("span",{className:"canvas-imputer__card-text",children:[o.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",Y+1]}),o.jsxs("span",{className:"canvas-imputer__card-summary",children:[Z,G.autoDetect?"  auto-detect":"",Q?`  ${Q}`:""]})]})]}),o.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>m(Y),"aria-label":`Remove alias strategy ${Y+1}`,children:"Remove"})]}),!ne&&o.jsxs("div",{className:"canvas-imputer__card-body",id:`alias-strategy-body-${Y}`,children:[o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{children:"Replacement strategy"}),o.jsxs("div",{className:"canvas-imputer__mode-toggle",role:"radiogroup","aria-label":"Alias replacement strategy",children:[l.map(ue=>{const $e=ue.value===G.mode;return o.jsx("button",{type:"button",className:`btn btn-outline-secondary canvas-imputer__mode-button${$e?" canvas-imputer__mode-button--active active":""}`,role:"radio","aria-checked":$e,onClick:()=>y(Y,ue.value),children:ue.label},ue.value)}),o.jsx("button",{type:"button",className:"btn btn-link canvas-imputer__mode-info",onClick:()=>I(Y,G.mode),children:"View examples"})]}),o.jsx("p",{className:"canvas-modal__meta",children:X.guidance})]}),V.index===Y&&V.mode===G.mode&&o.jsxs("div",{className:"canvas-modal__note canvas-modal__note--info",children:[o.jsxs("div",{children:[o.jsx("strong",{children:Od[G.mode].title}),o.jsx("button",{type:"button",className:"btn btn-link",onClick:H,children:"Close"})]}),o.jsx("p",{children:Od[G.mode].description}),Od[G.mode].preview&&o.jsx("ul",{children:Od[G.mode].preview.map(([ue,$e])=>o.jsxs("li",{children:[ue," ",o.jsx("span",{"aria-hidden":"true",children:"->"})," ",$e]},`${ue}-${$e}`))})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`alias-strategy-${Y}-auto-detect`,children:"Detection"}),o.jsxs("div",{className:"canvas-modal__boolean-control",children:[o.jsx("input",{id:`alias-strategy-${Y}-auto-detect`,type:"checkbox",checked:G.autoDetect,onChange:ue=>x(Y,ue.target.checked)}),o.jsx("label",{htmlFor:`alias-strategy-${Y}-auto-detect`,children:"Auto-detect additional text columns"})]}),o.jsx("p",{className:"canvas-modal__note",children:"Detected text-like columns not assigned elsewhere will be appended to this strategy."})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{children:"Columns"}),r.length?o.jsxs(o.Fragment,{children:[ge.size>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Highlighting columns that resemble ",Z.toLowerCase()," entries."]}),pe.length?o.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":`Columns assigned to alias strategy ${Y+1}`,children:pe.map(ue=>{const $e=G.columns.includes(ue.name),Ye=$w(ue.samples.length?ue.samples:i[ue.name]??[]),We=(F.get(ue.name)??0)-($e?1:0)>0,mt=ge.has(ue.name);return o.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${$e?" canvas-imputer__column-pill--selected":""}`,onClick:()=>_(Y,ue.name),"aria-pressed":$e,children:[o.jsx("span",{className:"canvas-imputer__column-pill-name",children:ue.name}),o.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[ue.dtype&&o.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:ue.dtype}),ue.isRecommended&&o.jsx("span",{className:"canvas-modal__meta",children:"Suggested"}),!ue.isTextLike&&o.jsx("span",{className:"canvas-modal__meta",children:"Non-text"}),mt&&o.jsx("span",{className:"canvas-modal__meta",children:"Likely match"}),We&&o.jsx("span",{className:"canvas-modal__meta",children:"Used elsewhere"})]}),Ye&&o.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",Ye]})]},ue.name)})}):o.jsx("p",{className:"canvas-modal__note",children:"No detected or selected columns yet. Expand other columns below to assign manually."}),Te.length>0&&o.jsxs("div",{className:"canvas-imputer__more-columns",children:[o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>q(Y),"aria-expanded":he,"aria-controls":`alias-strategy-${Y}-other-columns`,children:he?"Hide other columns":`Show other columns (${Te.length})`}),he&&o.jsx("div",{id:`alias-strategy-${Y}-other-columns`,className:"canvas-imputer__columns-list",role:"listbox","aria-label":`Other available columns for alias strategy ${Y+1}`,children:Te.map(ue=>{const $e=G.columns.includes(ue.name),Ye=$w(ue.samples.length?ue.samples:i[ue.name]??[]),We=(F.get(ue.name)??0)-($e?1:0)>0,mt=ge.has(ue.name);return o.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${$e?" canvas-imputer__column-pill--selected":""}`,onClick:()=>_(Y,ue.name),"aria-pressed":$e,children:[o.jsx("span",{className:"canvas-imputer__column-pill-name",children:ue.name}),o.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[ue.dtype&&o.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:ue.dtype}),!ue.isTextLike&&o.jsx("span",{className:"canvas-modal__meta",children:"Non-text"}),mt&&o.jsx("span",{className:"canvas-modal__meta",children:"Likely match"}),We&&o.jsx("span",{className:"canvas-modal__meta",children:"Used elsewhere"})]}),Ye&&o.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",Ye]})]},ue.name)})})]})]}):o.jsx("p",{className:"canvas-modal__note",children:"No catalogued columns yet. Add column names manually below or enable auto-detect to populate this list."})]}),o.jsx("div",{className:`canvas-imputer__selected${G.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:G.columns.length?G.columns.map(ue=>o.jsx("span",{className:"canvas-imputer__selected-chip",children:ue},ue)):o.jsx("span",{children:"No manual columns selected yet."})}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`alias-strategy-${Y}-manual-columns`,children:"Manual columns (optional)"}),o.jsx("input",{id:`alias-strategy-${Y}-manual-columns`,type:"text",className:"canvas-imputer__columns-input",value:ye,onChange:ue=>v(Y,ue.target.value),placeholder:"Add custom columns, separated by commas"})]}),o.jsx("p",{className:"canvas-modal__note",children:"Tap suggestions to toggle columns. Manual entries let you set custom fields that are not listed above."}),G.mode==="custom"&&d&&o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{children:"Custom pairs"}),o.jsx("p",{className:"canvas-modal__meta",children:"Enter one alias => replacement per line. These mappings apply to every custom strategy in this node."}),o.jsx("div",{className:"canvas-modal__parameter-list",children:Ee?w(d):De?o.jsx("p",{className:"canvas-modal__note",children:"Edit the custom pairs above to update this strategy."}):null})]})]})]},`alias-strategy-${Y}`)})}),u.totalPairs>0&&o.jsxs("p",{className:"canvas-modal__note",children:[u.totalPairs," custom pair",u.totalPairs===1?"":"s"," captured.",D?" They will be applied during execution.":" Switch a strategy to Custom mappings to apply them.",u.previewPairs.length>0?` Examples: ${u.previewPairs.join("; ")}${u.previewOverflow>0?"...":""}`:""]}),u.totalPairs===0&&D&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"At least one strategy is set to Custom mappings, but no valid alias pairs were detected."}),$>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Duplicate alias entries",P?`: ${P}`:"",u.duplicateOverflow>0?"...":"",". Only the first entry for each alias will be used."]}),T>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Ignored ",T," incomplete pair",T===1?"":"s",".",A?` Examples: ${A}${u.invalidOverflow>0?"...":""}`:""]})]})},Td=["iso_date","iso_datetime","month_day_year","day_month_year"],ER="iso_date",MR=["date","time","timestamp","datetime"],kR=3,Pw=36,vc={iso_date:{label:"ISO date",guidance:"Formats values as YYYY-MM-DD. Ideal for analytics layers expecting canonical dates.",example:"2024-03-19"},iso_datetime:{label:"ISO datetime",guidance:"Preserves date and time with second precision (YYYY-MM-DD HH:MM:SS).",example:"2024-03-19 14:05:42"},month_day_year:{label:"MM/DD/YYYY",guidance:"Aligns with US-style date formats. Use when downstream tooling expects month/day ordering.",example:"03/19/2024"},day_month_year:{label:"DD/MM/YYYY",guidance:"Suitable for EU-style day-first formats.",example:"19/03/2024"}},fp=Td.map(e=>({value:e,label:vc[e].label,guidance:vc[e].guidance,example:vc[e].example})),AR=[/^\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/,/^\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4}/,/^[A-Za-z]{3,9}\s+\d{1,2},\s*\d{2,4}/,/^\d{1,2}\s+[A-Za-z]{3,9}\s+\d{2,4}/,/^\d{4}\d{2}\d{2}$/],Lw=e=>e.length<=Pw?e:`${e.slice(0,Pw-1)}...`,Rw=e=>{if(!e)return!1;const t=e.toLowerCase();return MR.some(n=>t.includes(n))},OR=e=>AR.some(t=>t.test(e)),Dw=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Td.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&Td.includes(s)?s:ER},TR=e=>{const t=[];return Object.entries(e).forEach(([n,s])=>{if(!s||!s.length)return;const r=s.length;let i=0;if(s.forEach(u=>{OR(u)&&(i+=1)}),!r)return;i/r>=.6&&i>=2&&t.push(n)}),t.sort((n,s)=>n.localeCompare(s)),t},$R=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((f,y)=>f.localeCompare(y));const i=new Set(r),l=t.filter(f=>Rw(n[f]??null)),u=TR(s),d=new Set;l.forEach(f=>{i.has(f)||d.add(f)}),u.forEach(f=>{i.has(f)||d.add(f)});const h=Array.from(d);h.sort((f,y)=>f.localeCompare(y));const p=r.filter(f=>!(Rw(n[f]??null)||u.includes(f))),m=u.slice().sort((f,y)=>f.localeCompare(y));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:h,nonDateSelected:p,dateColumnCount:l.length,sampleCandidateCount:u.length,sampleCandidates:m}},PR=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";return n&&Td.includes(n)?n:t},LR=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="true"||t==="1"||t==="yes")return!0;if(t==="false"||t==="0"||t==="no")return!1}return typeof e=="number"?e!==0:!1},zw=(e,t)=>{if(!Array.isArray(e))return t.columns.length||t.autoDetect?[{mode:t.mode,columns:[...t.columns],autoDetect:t.autoDetect}]:[];const n=new Set,s=e.map(r=>{if(!r||typeof r!="object")return null;const i=Ge(r.columns),l=Array.from(new Set(i.map(p=>p.trim()).filter(Boolean))).sort((p,m)=>p.localeCompare(m)),u=PR(r.mode,t.mode),d=LR(r.auto_detect??r.autoDetect??r.auto),h=`${u}|${l.join(",")}|${d?"auto":"manual"}`;return n.has(h)?null:(n.add(h),{mode:u,columns:l,autoDetect:d})}).filter(r=>!!r);return s.length?s:t.columns.length||t.autoDetect?[{mode:t.mode,columns:[...t.columns],autoDetect:t.autoDetect}]:[]},RR=e=>e.map(t=>{const n={mode:t.mode,columns:[...t.columns]};return t.autoDetect&&(n.auto_detect=!0),n}),DR=e=>{var t;return((t=vc[e])==null?void 0:t.label)??vc.iso_date.label},zR=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?Lw(String(e)):null;if(typeof e=="boolean")return e?"True":"False";const t=String(e).trim();return t?Lw(t):null},IR=(e,t=kR)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;const u=zR(i);if(!u)return;const d=n[l]??[];d.includes(u)||d.length>=t||(n[l]=[...d,u])})}),n},FR={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonDateSelected:[],dateColumnCount:0,sampleCandidateCount:0,sampleCandidates:[]},Iw=e=>{if(!e.length)return null;const t=e.slice(0,3);return e.length-t.length>0?`${t.join(", ")} `:t.join(", ")},BR=({hasSource:e,hasReachableSource:t,strategies:n,columnSummary:s,columnOptions:r,sampleMap:i,collapsedStrategies:l,onToggleStrategy:u,onRemoveStrategy:d,onAddStrategy:h,onModeChange:p,onColumnToggle:m,onColumnsChange:f,onAutoDetectToggle:y,modeOptions:x=fp})=>{const _=n.length>0,v=b.useMemo(()=>n.some($=>$.autoDetect),[n]),[w,M]=b.useState(()=>new Set),N=b.useCallback($=>{M(T=>{const P=new Set(T);return P.has($)?P.delete($):P.add($),P})},[]);b.useEffect(()=>{M($=>{const T=new Set;return $.forEach(P=>{P<n.length&&T.add(P)}),T.size===$.size?$:T})},[n.length]);const C=b.useMemo(()=>{const $=new Map;return n.forEach(T=>{T.columns.forEach(P=>{const A=P.trim();A&&$.set(A,($.get(A)??0)+1)})}),$},[n]),j=b.useMemo(()=>{const $=s.recommendedColumns.slice(0,6),T=Math.max(s.recommendedColumns.length-$.length,0);return{preview:$,remaining:T}},[s.recommendedColumns]),E=b.useMemo(()=>{const $=s.nonDateSelected.slice(0,4),T=Math.max(s.nonDateSelected.length-$.length,0);return{preview:$,remaining:T}},[s.nonDateSelected]),k=!e||!t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Date formatting strategies"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:h,children:"Add strategy"})})]}),k&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:e?"Connect this step to an upstream output to explore detected date columns.":"Select a dataset to load column samples and suggestions."}),j.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Suggested columns: ",j.preview.join(", "),j.remaining>0?`,  (${j.remaining} more)`:"",".",v?" Auto-detect strategies will automatically include remaining date-like columns.":""]}),s.sampleCandidates.length===0&&!j.preview.length&&o.jsx("p",{className:"canvas-modal__note",children:"No clear date candidates yet. Add columns manually or enable auto-detect to sweep for timestamps."}),E.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[E.preview.join(", ")," ",E.preview.length===1?"looks":"look"," non-date-like.",E.remaining>0?` ${E.remaining} more selected column${E.remaining===1?"":"s"} may require double-checking.`:" Double-check that these values represent consistent dates."]}),v&&o.jsxs("p",{className:"canvas-modal__note",children:["Auto-detect gathers from ",s.sampleCandidateCount||s.dateColumnCount," date-like columns that are not already assigned."]}),_?o.jsx("div",{className:"canvas-imputer__list",children:n.map(($,T)=>{var H,J;const P=((H=x.find(G=>G.value===$.mode))==null?void 0:H.label)??DR($.mode),A=$.columns.length,D=A?`${A} column${A===1?"":"s"}`:$.autoDetect?"Auto-detecting columns":"No columns yet",F=l.has(T),R=$.columns.join(", "),z=`date-strategy-${T}-toggle`,q=`date-strategy-${T}-auto-detect`,V=r.map(G=>({option:G,priority:G.isRecommended?0:G.isSampleCandidate?1:2})).sort((G,Y)=>G.priority!==Y.priority?G.priority-Y.priority:G.option.name.localeCompare(Y.option.name)).map(G=>G.option),U=V.filter(G=>$.columns.includes(G.name)?!0:G.isRecommended||G.isSampleCandidate),W=new Set(U.map(G=>G.name)),B=V.filter(G=>!W.has(G.name)),I=w.has(T);return o.jsxs("div",{className:"canvas-imputer__card",children:[o.jsxs("div",{className:"canvas-imputer__card-header",children:[o.jsxs("button",{type:"button",id:z,className:"canvas-imputer__card-toggle",onClick:()=>u(T),"aria-expanded":!F,"aria-controls":`date-strategy-body-${T}`,children:[o.jsx("span",{className:`canvas-imputer__toggle-icon${F?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),o.jsxs("span",{className:"canvas-imputer__card-text",children:[o.jsxs("span",{className:"canvas-imputer__card-title",children:["Strategy ",T+1]}),o.jsxs("span",{className:"canvas-imputer__card-summary",children:[P,$.autoDetect?"  auto-detect":"",D?`  ${D}`:""]})]})]}),o.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>d(T),"aria-label":`Remove date formatting strategy ${T+1}`,children:"Remove"})]}),!F&&o.jsxs("div",{className:"canvas-imputer__card-body",id:`date-strategy-body-${T}`,children:[o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`date-strategy-${T}-mode`,children:"Format"}),o.jsx("select",{id:`date-strategy-${T}-mode`,value:$.mode,onChange:G=>p(T,G.target.value),children:x.map(G=>o.jsx("option",{value:G.value,children:G.label},G.value))}),o.jsxs("p",{className:"canvas-modal__meta",children:["Example: ",((J=x.find(G=>G.value===$.mode))==null?void 0:J.example)??"2024-01-23"]})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:q,children:"Detection"}),o.jsxs("div",{className:"canvas-modal__boolean-control",children:[o.jsx("input",{id:q,type:"checkbox",checked:$.autoDetect,onChange:G=>y(T,G.target.checked)}),o.jsx("label",{htmlFor:q,children:"Auto-detect additional date columns"})]}),o.jsx("p",{className:"canvas-modal__note",children:"We will append detected date-like fields that are not assigned to other strategies."})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{children:"Columns"}),V.length?o.jsxs(o.Fragment,{children:[U.length?o.jsx("div",{className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Detected or selected columns for date formatting",children:U.map(G=>{const Y=$.columns.includes(G.name),X=Iw(G.samples.length?G.samples:i[G.name]??[]),ee=(C.get(G.name)??0)-(Y?1:0)>0;return o.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${Y?" canvas-imputer__column-pill--selected":""}`,onClick:()=>m(T,G.name),"aria-pressed":Y,children:[o.jsx("span",{className:"canvas-imputer__column-pill-name",children:G.name}),o.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[G.dtype&&o.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:G.dtype}),G.isRecommended&&o.jsx("span",{className:"canvas-modal__meta",children:"Suggested"}),!G.isRecommended&&G.isSampleCandidate&&o.jsx("span",{className:"canvas-modal__meta",children:"Detected"}),ee&&o.jsx("span",{className:"canvas-modal__meta",children:"Used in another strategy"})]}),X&&o.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",X]})]},G.name)})}):o.jsx("p",{className:"canvas-modal__note",children:"No detected or selected columns yet. Expand other columns below to assign manually."}),B.length>0&&o.jsxs("div",{className:"canvas-imputer__more-columns",children:[o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>N(T),"aria-expanded":I,"aria-controls":`date-strategy-${T}-other-columns`,children:I?"Hide other columns":`Show other columns (${B.length})`}),I&&o.jsx("div",{id:`date-strategy-${T}-other-columns`,className:"canvas-imputer__columns-list",role:"listbox","aria-label":"Other available columns for date formatting",children:B.map(G=>{const Y=$.columns.includes(G.name),X=Iw(G.samples.length?G.samples:i[G.name]??[]),ee=(C.get(G.name)??0)-(Y?1:0)>0;return o.jsxs("button",{type:"button",className:`canvas-imputer__column-pill${Y?" canvas-imputer__column-pill--selected":""}`,onClick:()=>m(T,G.name),"aria-pressed":Y,children:[o.jsx("span",{className:"canvas-imputer__column-pill-name",children:G.name}),o.jsxs("div",{className:"canvas-imputer__column-pill-meta",children:[G.dtype&&o.jsx("span",{className:"canvas-imputer__column-pill-dtype",children:G.dtype}),ee&&o.jsx("span",{className:"canvas-modal__meta",children:"Used in another strategy"})]}),X&&o.jsxs("span",{className:"canvas-modal__meta",children:["e.g. ",X]})]},G.name)})})]})]}):o.jsx("p",{className:"canvas-modal__note",children:"No catalogued columns yet. Add column names manually below or enable auto-detect to populate this list."})]}),o.jsx("div",{className:`canvas-imputer__selected${$.columns.length?"":" canvas-imputer__selected--empty"}`,"aria-live":"polite",children:$.columns.length?$.columns.map(G=>o.jsx("span",{className:"canvas-imputer__selected-chip",children:G},G)):o.jsx("span",{children:"No manual columns selected yet."})}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`date-strategy-${T}-manual-columns`,children:"Manual columns (optional)"}),o.jsx("input",{id:`date-strategy-${T}-manual-columns`,type:"text",className:"canvas-imputer__columns-input",value:R,onChange:G=>f(T,G.target.value),placeholder:"Add custom columns, separated by commas"})]}),o.jsx("p",{className:"canvas-modal__note",children:"Tap suggestions to toggle columns. Manual entries let you set custom fields that are not listed above."})]})]},`date-strategy-${T}`)})}):o.jsx("p",{className:"canvas-modal__note",children:"Add a strategy to standardize one or more columns. You can combine manual selection with auto-detect for any remaining date-like fields."})]})},Fw=["both","leading","trailing"],Bw="both",UR=["string","object","text","category","mixed","varchar","char"],HR=3,Uw=36,Hw=6,qR=4,VR=5,qw={both:{label:"Trim both sides",guidance:"Removes whitespace on the left and right side of values. Safe default for messy strings.",example:"' ACME '  'ACME'"},leading:{label:"Trim leading whitespace",guidance:"Strips whitespace at the beginning of values while preserving trailing spacing.",example:"' 123 Main'  '123 Main'"},trailing:{label:"Trim trailing whitespace",guidance:"Removes whitespace at the end of values while keeping leading spacing intact.",example:"'Suite B  '  'Suite B'"}},WR=e=>e.length<=Uw?e:`${e.slice(0,Uw-1)}...`,Vw=e=>{if(!e)return!1;const t=e.toLowerCase();return UR.some(n=>t.includes(n))},YR=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${WR(t)}'`},KR=e=>e.length?!!(e.trim()!==e||e.includes("  ")||e.includes(`
`)||e.includes("	")||e.includes("\r")):!1,GR=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Fw.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&Fw.includes(s)?s:Bw},XR=e=>{const t=qw[e]??qw[Bw];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},QR=e=>{const t=[];return Object.entries(e).forEach(([n,s])=>{if(!s.length)return;const r=s.reduce((l,u)=>u.hasIssue?l+1:l,0);if(!r)return;const i=r/s.length;(r>=2||i>=.5)&&t.push(n)}),t.sort((n,s)=>n.localeCompare(s)),t},ZR=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((m,f)=>m.localeCompare(f));const i=new Set(r),l=t.filter(m=>Vw(n[m]??null)),u=QR(s),d=new Set;l.forEach(m=>{i.has(m)||d.add(m)}),u.forEach(m=>{i.has(m)||d.add(m)});const h=Array.from(d).sort((m,f)=>m.localeCompare(f)),p=r.filter(m=>!Vw(n[m]??null));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:h,nonTextSelected:p,textColumnCount:l.length,whitespaceCandidateCount:u.length,whitespaceCandidates:u}},hp=(e,t)=>e.slice(0,t),JR=e=>{const t=hp(e,Hw);return{preview:t,remaining:Math.max(e.length-t.length,0)}},eD=e=>{const t=hp(e,qR);return{preview:t,remaining:Math.max(e.length-t.length,0)}},tD=e=>{const t=hp(e,Hw);return{preview:t,remaining:Math.max(e.length-t.length,0)}},nD=(e,t=HR)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=KR(u),h=YR(u),p=n[l]??[];p.find(m=>m.value===h)||p.length>=t||(n[l]=[...p,{value:h,hasIssue:d}])})}),n},sD=(e,t,n=VR)=>{if(!t.length)return[];const s=[];for(const r of t){if(s.length>=n)break;const i=e[r];!i||!i.length||s.push({column:r,values:i.map(l=>l.value),overflow:0})}return s},rD={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,whitespaceCandidateCount:0,whitespaceCandidates:[]},aD=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,renderMultiSelectField:r,renderParameterField:i,columnSummary:l,modeDetails:u,sampleMap:d})=>{if(!n&&!s)return null;const h=l.selectedColumns.length,p=JR(l.recommendedColumns),m=eD(l.nonTextSelected),f=tD(l.whitespaceCandidates),y=sD(d,l.selectedColumns),x=!e||!t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Whitespace trimming"})}),o.jsxs("p",{className:"canvas-modal__note",children:[o.jsx("strong",{children:u.label})," mode. ",u.guidance," Example: ",u.example,"."]}),l.autoDetectionActive?o.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):o.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",o.jsx("strong",{children:h})," column",h===1?"":"s"," for trimming."]}),y.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",y.map(_=>`${_.column} (${_.values.join(", ")})`).join("; "),"."]}),f.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns with leading/trailing whitespace detected: ",f.preview.join(", "),f.remaining>0?`, ... (${f.remaining} more)`:"","."]}),p.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",p.preview.join(", "),p.remaining>0?`, ... (${p.remaining} more)`:"","."]}),m.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[m.preview.join(", ")," ",m.preview.length===1?"is":"are"," not text-like.",m.remaining>0?` ${m.remaining} more column${m.remaining===1?" is":"s are"} also non-text.`:" Consider removing them or confirming whitespace cleanup is intentional."]}),x?e?o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples for trimming opportunities."}):null,n&&o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Columns to trim"}),r(n)]}),s&&o.jsx("div",{className:"canvas-modal__parameter-list",children:i(s)})]})},Ww=["keep_alphanumeric","keep_alphanumeric_space","letters_only","digits_only"],Yw="keep_alphanumeric",oD=["string","object","text","category","mixed","varchar","char"],iD=3,Kw=36,lD=6,cD=4,uD=5,Gw={keep_alphanumeric:{label:"Letters & digits",guidance:"Removes punctuation and symbols, leaving only letters and numbers.",example:"ACME-Co.  ACMEC o"},keep_alphanumeric_space:{label:"Letters, digits & spaces",guidance:"Strips punctuation while preserving spaces for readability.",example:"ACME-Co.  ACME Co"},letters_only:{label:"Letters only",guidance:"Keeps alphabetic characters and removes digits, punctuation, and symbols.",example:"R2-D2  RD"},digits_only:{label:"Digits only",guidance:"Preserves numbers while removing letters, punctuation, and symbols.",example:"Order #123A  123"}},dD=e=>e.length<=Kw?e:`${e.slice(0,Kw-1)}...`,mD=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${dD(t)}'`},Xw=e=>{if(!e)return!1;const t=e.toLowerCase();return oD.some(n=>t.includes(n))},fD=e=>/[^0-9A-Za-z\s]/.test(e),hD=e=>/[A-Za-z]/.test(e),pD=e=>/[0-9]/.test(e),gD=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Ww.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&Ww.includes(s)?s:Yw},_D=e=>{const t=Gw[e]??Gw[Yw];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},yD=e=>{const t=new Set,n=new Set,s=new Set;Object.entries(e).forEach(([u,d])=>{if(!d.length)return;let h=0,p=0,m=0;d.forEach(f=>{f.hasSpecial&&(h+=1),f.hasDigits&&(p+=1),f.hasLetters&&(m+=1)}),h>0&&t.add(u),p>0&&m===0&&n.add(u),m>0&&p===0&&s.add(u)});const r=Array.from(t).sort((u,d)=>u.localeCompare(d)),i=Array.from(n).sort((u,d)=>u.localeCompare(d)),l=Array.from(s).sort((u,d)=>u.localeCompare(d));return{specialCandidates:r,digitsOnlyCandidates:i,lettersOnlyCandidates:l}},vD=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((y,x)=>y.localeCompare(x));const i=new Set(r),l=t.filter(y=>Xw(n[y]??null)),{specialCandidates:u,digitsOnlyCandidates:d,lettersOnlyCandidates:h}=yD(s),p=new Set;l.forEach(y=>{i.has(y)||p.add(y)}),u.forEach(y=>{i.has(y)||p.add(y)});const m=Array.from(p).sort((y,x)=>y.localeCompare(x)),f=r.filter(y=>!Xw(n[y]??null));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:m,nonTextSelected:f,textColumnCount:l.length,specialCandidateCount:u.length,specialCandidates:u,digitsOnlyCandidates:d,lettersOnlyCandidates:h}},Qw=(e,t)=>e.slice(0,t),xD=e=>{const t=Qw(e,lD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},$d=e=>{const t=Qw(e,cD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},bD=(e,t=iD)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=mD(u),h=fD(u),p={value:d,hasSpecial:h,hasDigits:pD(u),hasLetters:hD(u)},m=n[l]??[];m.find(f=>f.value===d)||m.length>=t||(n[l]=[...m,p])})}),n},wD=(e,t,n=uD)=>{if(!t.length)return[];const s=[];for(const r of t){if(s.length>=n)break;const i=e[r];!i||!i.length||s.push({column:r,values:i.map(l=>l.value),overflow:0})}return s},ND={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,specialCandidateCount:0,specialCandidates:[],digitsOnlyCandidates:[],lettersOnlyCandidates:[]},jD=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,replacementParameter:r,renderMultiSelectField:i,renderParameterField:l,columnSummary:u,modeDetails:d,sampleMap:h})=>{if(!n&&!s&&!r)return null;const p=u.selectedColumns.length,m=xD(u.recommendedColumns),f=$d(u.specialCandidates),y=$d(u.digitsOnlyCandidates),x=$d(u.lettersOnlyCandidates),_=$d(u.nonTextSelected),v=wD(h,u.selectedColumns),w=!e||!t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Special character cleanup"})}),o.jsxs("p",{className:"canvas-modal__note",children:[o.jsx("strong",{children:d.label})," mode. ",d.guidance," Example: ",d.example,"."]}),u.autoDetectionActive?o.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):o.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",o.jsx("strong",{children:p})," column",p===1?"":"s"," for cleanup."]}),v.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",v.map(M=>`${M.column} (${M.values.join(", ")})`).join("; "),"."]}),f.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns containing punctuation or symbols: ",f.preview.join(", "),f.remaining>0?`, ... (${f.remaining} more)`:"","."]}),y.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Numeric-only samples detected in: ",y.preview.join(", "),y.remaining>0?`, ... (${y.remaining} more)`:"",". Consider `digits only` mode."]}),x.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Letter-only samples detected in: ",x.preview.join(", "),x.remaining>0?`, ... (${x.remaining} more)`:"",". Consider `letters only` mode."]}),m.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",m.preview.join(", "),m.remaining>0?`, ... (${m.remaining} more)`:"","."]}),_.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[_.preview.join(", ")," ",_.preview.length===1?"is":"are"," not text-like.",_.remaining>0?` ${_.remaining} more column${_.remaining===1?" is":"s are"} also non-text.`:" Double-check that symbol stripping is necessary for these fields."]}),w?e?o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before removing characters."}):null,n&&o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Columns to sanitize"}),i(n)]}),(s||r)&&o.jsxs("div",{className:"canvas-modal__parameter-list",children:[s?l(s):null,r?l(r):null]})]})},Zw=["lower","upper","title","sentence"],Jw="lower",CD=["string","object","text","category","mixed","varchar","char"],SD=3,eN=60,ED=6,MD=4,kD=5,tN={lower:{label:"Lowercase",guidance:"Converts values to lowercase for consistent comparisons.",example:"Acme Corp  acme corp"},upper:{label:"Uppercase",guidance:"Transforms text to uppercase, useful for codes or standard identifiers.",example:"Acme Corp  ACME CORP"},title:{label:"Title case",guidance:"Capitalizes the first letter of each word, ideal for names or titles.",example:"ACME CORP  Acme Corp"},sentence:{label:"Sentence case",guidance:"Capitalizes the first letter of each sentence while lowercasing the rest.",example:"ACME CORP. DELIVERS.  Acme corp. delivers."}},AD=e=>e.length<=eN?e:`${e.slice(0,eN-1)}...`,nN=e=>{if(!e)return!1;const t=e.toLowerCase();return CD.some(n=>t.includes(n))},xc=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${AD(t)}'`},OD=e=>e.toLowerCase().split(/([\s\-_/]+)/).map(t=>!t.length||/[\s\-_/]+/.test(t)?t:t.charAt(0).toUpperCase()+t.slice(1)).join(""),TD=e=>e.toLowerCase().replace(/(^\s*[a-z])|([\.\!\?]\s*[a-z])/g,n=>n.toUpperCase()),$D=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&Zw.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&Zw.includes(s)?s:Jw},PD=e=>{const t=tN[e]??tN[Jw];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},LD=(e,t)=>{const n=[];return Object.entries(e).forEach(([s,r])=>{if(!r.length)return;r.some(l=>{const u=l[t];return l.original!==u})&&n.push(s)}),n.sort((s,r)=>s.localeCompare(r)),n},RD=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s,mode:r})=>{const i=Array.from(new Set(Ge(e)));i.sort((f,y)=>f.localeCompare(y));const l=new Set(i),u=t.filter(f=>nN(n[f]??null)),d=LD(s,r),h=new Set;u.forEach(f=>{l.has(f)||h.add(f)}),d.forEach(f=>{l.has(f)||h.add(f)});const p=Array.from(h).sort((f,y)=>f.localeCompare(y)),m=i.filter(f=>!nN(n[f]??null));return{selectedColumns:i,autoDetectionActive:i.length===0,recommendedColumns:p,nonTextSelected:m,textColumnCount:u.length,inconsistentColumns:d}},sN=(e,t)=>e.slice(0,t),DD=e=>{const t=sN(e,ED);return{preview:t,remaining:Math.max(e.length-t.length,0)}},rN=e=>{const t=sN(e,MD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},zD=(e,t=SD)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=xc(u),h={original:d,lower:xc(u.toLowerCase()),upper:xc(u.toUpperCase()),title:xc(OD(u)),sentence:xc(TD(u))},p=n[l]??[];p.find(m=>m.original===d)||p.length>=t||(n[l]=[...p,h])})}),n},ID=(e,t,n,s=kD)=>{if(!t.length)return[];const r=[];for(const i of t){if(r.length>=s)break;const l=e[i];if(!l||!l.length)continue;const u=l.map(d=>`${d.original}  ${d[n]}`);r.push({column:i,values:u,overflow:0})}return r},FD={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,inconsistentColumns:[]},BD=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,renderMultiSelectField:r,renderParameterField:i,columnSummary:l,modeDetails:u,sampleMap:d,selectedMode:h})=>{if(!n&&!s)return null;const p=l.selectedColumns.length,m=DD(l.recommendedColumns),f=rN(l.inconsistentColumns),y=rN(l.nonTextSelected),x=ID(d,l.selectedColumns,h),_=!e||!t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Text case normalization"})}),o.jsxs("p",{className:"canvas-modal__note",children:[o.jsx("strong",{children:u.label})," mode. ",u.guidance," Example: ",u.example,"."]}),l.autoDetectionActive?o.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):o.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",o.jsx("strong",{children:p})," column",p===1?"":"s"," for case normalization."]}),x.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",x.map(v=>`${v.column} (${v.values.join("; ")})`).join(" | "),"."]}),f.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns with mixed casing: ",f.preview.join(", "),f.remaining>0?`, ... (${f.remaining} more)`:"","."]}),m.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",m.preview.join(", "),m.remaining>0?`, ... (${m.remaining} more)`:"","."]}),y.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[y.preview.join(", ")," ",y.preview.length===1?"is":"are"," not text-like.",y.remaining>0?` ${y.remaining} more column${y.remaining===1?" is":"s are"} also non-text.`:" Confirm case normalization is necessary for these values."]}),_?e?o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before adjusting case."}):null,n&&o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Columns to normalize"}),r(n)]}),s&&o.jsx("div",{className:"canvas-modal__parameter-list",children:i(s)})]})},aN=["preset_digits_only","preset_letters_only","preset_whitespace_collapse","custom"],oN="preset_digits_only",UD=["string","object","text","category","mixed","varchar","char"],HD=3,iN=60,qD=6,VD=4,WD=5,lN={preset_digits_only:{label:"Digits only preset",guidance:"Keeps digits while stripping other characters. Useful for IDs or numeric codes.",example:"Order #123A  123"},preset_letters_only:{label:"Letters only preset",guidance:"Removes digits and symbols, retaining alphabetical characters.",example:"SKU-45X  SKUX"},preset_whitespace_collapse:{label:"Collapse whitespace preset",guidance:"Replaces runs of whitespace with a single space, trimming leading/trailing spacing.",example:`ACME	Corp
 ACME Corp`},custom:{label:"Custom regex",guidance:"Applies your regex and replacement text. Supports JavaScript-style regular expressions.",example:'Pattern: /d+/g Replacement: "#"'}},YD=e=>e.length<=iN?e:`${e.slice(0,iN-1)}...`,bc=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return`'${YD(t)}'`},cN=e=>{if(!e)return!1;const t=e.toLowerCase();return UD.some(n=>t.includes(n))},KD=e=>e.replace(/\s+/g," ").trim(),GD=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&aN.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&aN.includes(s)?s:oN},XD=e=>{const t=lN[e]??lN[oN];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},QD=e=>{const t=new Set,n=new Set,s=new Set;Object.entries(e).forEach(([i,l])=>{l.length&&l.forEach(u=>{u.hasDigits&&t.add(i),u.hasLetters&&n.add(i),u.hasWhitespaceRuns&&s.add(i)})});const r=i=>Array.from(i).sort((l,u)=>l.localeCompare(u));return{digits:r(t),letters:r(n),whitespace:r(s)}},ZD=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e)));r.sort((y,x)=>y.localeCompare(x));const i=new Set(r),l=t.filter(y=>cN(n[y]??null)),{digits:u,letters:d,whitespace:h}=QD(s),p=new Set;l.forEach(y=>{i.has(y)||p.add(y)}),[...u,...d,...h].forEach(y=>{i.has(y)||p.add(y)});const m=Array.from(p).sort((y,x)=>y.localeCompare(x)),f=r.filter(y=>!cN(n[y]??null));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:m,nonTextSelected:f,textColumnCount:l.length,digitsCandidates:u,lettersCandidates:d,whitespaceCandidates:h}},uN=(e,t)=>e.slice(0,t),JD=e=>{const t=uN(e,qD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},Pd=e=>{const t=uN(e,VD);return{preview:t,remaining:Math.max(e.length-t.length,0)}},ez=(e,t=HD)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;let u="";if(i==null)u="";else if(typeof i=="string")u=i;else if(typeof i=="number"||typeof i=="boolean")u=String(i);else try{u=JSON.stringify(i)}catch{u=String(i)}if(!u.length)return;const d=bc(u),h={original:d,presetDigits:bc(u.replace(/\D+/g,"")),presetLetters:bc(u.replace(/[^A-Za-z]+/g,"")),presetWhitespace:bc(KD(u)),hasDigits:/\d/.test(u),hasLetters:/[A-Za-z]/.test(u),hasWhitespaceRuns:/\s{2,}/.test(u)||/\t|\n|\r/.test(u)},p=n[l]??[];p.find(m=>m.original===d)||p.length>=t||(n[l]=[...p,h])})}),n},tz=(e,t,n)=>{const s=n??"",r=i=>i.length?i:"''";switch(t){case"preset_letters_only":return`${r(e.original)}  ${r(e.presetLetters)}`;case"preset_whitespace_collapse":return`${r(e.original)}  ${r(e.presetWhitespace)}`;case"custom":try{const i=new RegExp(s.split("|||")[0]??"",s.split("|||")[1]??""),l=bc(e.original.replace(i,s.split("|||")[2]??""));return`${r(e.original)}  ${r(l)}`}catch{return`${r(e.original)}  (invalid regex)`}case"preset_digits_only":default:return`${r(e.original)}  ${r(e.presetDigits)}`}},nz=(e,t,n,s,r=WD)=>{if(!t.length)return[];const i=[];for(const l of t){if(i.length>=r)break;const u=e[l];if(!u||!u.length)continue;const d=u.map(h=>tz(h,n,s));i.push({column:l,values:d,overflow:0})}return i},sz={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonTextSelected:[],textColumnCount:0,digitsCandidates:[],lettersCandidates:[],whitespaceCandidates:[]},rz=e=>{if(!e)return null;const t=e.split("|||"),n=t[0]??"",s=t[1]??"",r=t[2]??"";return!n.trim()&&!r.trim()?null:`Pattern: /${n||"(empty)"}/${s||"(none)"} Replacement: ${r||"''"}`},az=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,patternParameter:r,replacementParameter:i,renderMultiSelectField:l,renderParameterField:u,columnSummary:d,modeDetails:h,sampleMap:p,selectedMode:m,replacementValue:f})=>{if(!n&&!s&&!r&&!i)return null;const y=d.selectedColumns.length,x=JD(d.recommendedColumns),_=Pd(d.digitsCandidates),v=Pd(d.lettersCandidates),w=Pd(d.whitespaceCandidates),M=Pd(d.nonTextSelected),N=rz(f),C=nz(p,d.selectedColumns,m,f),j=!e||!t,E=m==="custom";return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Regex cleanup"})}),o.jsxs("p",{className:"canvas-modal__note",children:[o.jsx("strong",{children:h.label})," mode. ",h.guidance," Example: ",h.example,"."]}),N&&o.jsx("p",{className:"canvas-modal__note",children:N}),d.autoDetectionActive?o.jsx("p",{className:"canvas-modal__note",children:"No columns selectedtext columns will be auto-detected when the node runs."}):o.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",o.jsx("strong",{children:y})," column",y===1?"":"s"," for regex cleanup."]}),C.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",C.map(k=>`${k.column} (${k.values.join("; ")})`).join(" | "),"."]}),_.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns containing digits: ",_.preview.join(", "),_.remaining>0?`, ... (${_.remaining} more)`:"","."]}),v.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns containing letters: ",v.preview.join(", "),v.remaining>0?`, ... (${v.remaining} more)`:"","."]}),w.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns with repeated whitespace: ",w.preview.join(", "),w.remaining>0?`, ... (${w.remaining} more)`:"","."]}),x.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Other text columns: ",x.preview.join(", "),x.remaining>0?`, ... (${x.remaining} more)`:"","."]}),M.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[M.preview.join(", ")," ",M.preview.length===1?"is":"are"," not text-like.",M.remaining>0?` ${M.remaining} more column${M.remaining===1?" is":"s are"} also non-text.`:" Confirm regex cleanup is appropriate for these values."]}),E&&!N&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Custom regex mode is enabled, but no pattern or replacement details were detected. Provide both to avoid no-ops."}),j?e?o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review column insights."}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect column samples before applying regex transformations."}):null,n&&o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Columns to clean"}),l(n)]}),(s||r||i)&&o.jsxs("div",{className:"canvas-modal__parameter-list",children:[s?u(s):null,r?u(r):null,i?u(i):null]})]})},dN=["negative_to_nan","zero_to_nan","percentage_bounds","age_bounds","custom_range"],mN="negative_to_nan",oz=["int","float","double","numeric","number","decimal","real","long"],iz=3,lz=6,cz=4,uz=5,fN={negative_to_nan:{label:"Negative to missing",guidance:"Sets negative readings to missing. Useful for metrics that cannot drop below zero.",example:"Inventory change 3  missing"},zero_to_nan:{label:"Zero to missing",guidance:"Treats placeholder zeros as missing values.",example:"Temperature 0  missing"},percentage_bounds:{label:"Percentage bounds",guidance:"Keeps readings within 0-100% unless you provide custom bounds.",example:"Completion 135%  missing"},age_bounds:{label:"Age bounds",guidance:"Flags implausible ages outside a typical 0-120 range unless overridden.",example:"Customer age 212  missing"},custom_range:{label:"Custom bounds",guidance:"Applies your minimum/maximum limits to selected columns.",example:"Metric < 10 or > 75  missing"}},dz=e=>{const t=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t");return t.length<=60?t:`${t.slice(0,59)}`},mz=e=>{if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="boolean")return e?1:0;if(typeof e=="string"){const t=e.trim();if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null},fz=e=>{if(!e)return!1;const t=e.toLowerCase();return oz.some(n=>t.includes(n))},hz=(e,t)=>{const n=typeof e=="string"?e.trim().toLowerCase():"";if(n&&dN.includes(n))return n;const s=typeof t=="string"?t.trim().toLowerCase():"";return s&&dN.includes(s)?s:mN},pz=e=>{const t=fN[e]??fN[mN];return{mode:e,label:t.label,guidance:t.guidance,example:t.example}},gz=e=>{const t=new Set,n=new Set,s=new Set,r=new Set;Object.entries(e).forEach(([l,u])=>{u.forEach(d=>{d.isNegative&&t.add(l),d.isZero&&n.add(l),(d.numericValue<0||d.numericValue>100)&&s.add(l),(d.numericValue<0||d.numericValue>120)&&r.add(l)})});const i=l=>Array.from(l).sort((u,d)=>u.localeCompare(d));return{negative:i(t),zeros:i(n),percentage:i(s),age:i(r)}},_z=({selectedColumns:e,availableColumns:t,columnTypeMap:n,sampleMap:s})=>{const r=Array.from(new Set(Ge(e))).sort((x,_)=>x.localeCompare(_)),i=new Set(r),l=t.filter(x=>fz(n[x]??null)),u=new Set(l),{negative:d,zeros:h,percentage:p,age:m}=gz(s),f=new Set;l.forEach(x=>{i.has(x)||f.add(x)}),[...d,...h,...p,...m].forEach(x=>{i.has(x)||f.add(x)});const y=r.filter(x=>!u.has(x));return{selectedColumns:r,autoDetectionActive:r.length===0,recommendedColumns:Array.from(f).sort((x,_)=>x.localeCompare(_)),nonNumericSelected:y,numericColumnCount:l.length,negativeCandidates:d,zeroCandidates:h,percentageOutliers:p,ageOutliers:m}},yz=e=>{const t=e.slice(0,lz);return{preview:t,remaining:Math.max(e.length-t.length,0)}},wc=e=>{const t=e.slice(0,cz);return{preview:t,remaining:Math.max(e.length-t.length,0)}},vz=(e,t=iz)=>{if(!Array.isArray(e)||!e.length)return{};const n={};return e.forEach(s=>{!s||typeof s!="object"||Object.entries(s).forEach(([r,i])=>{const l=typeof r=="string"?r.trim():"";if(!l)return;const u=mz(i);if(u===null)return;const d=dz(String(i)),h={originalDisplay:d,numericValue:u,isNegative:u<0,isZero:Math.abs(u)<=1e-9},p=n[l]??[];p.find(m=>m.originalDisplay===d)||p.length>=t||(n[l]=[...p,h])})}),n},xz=0,bz=100,wz=0,Nz=120,jz=(e,t,n,s)=>{switch(t){case"negative_to_nan":{const r=n??0;return e.numericValue<r?{flagged:!0,reason:`value < ${r}`}:s!==null&&e.numericValue>s?{flagged:!0,reason:`value > ${s}`}:{flagged:!1,reason:null}}case"zero_to_nan":return{flagged:e.isZero,reason:e.isZero?"zero placeholder":null};case"percentage_bounds":{const r=n??xz,i=s??bz;return e.numericValue<r?{flagged:!0,reason:`value < ${r}`}:e.numericValue>i?{flagged:!0,reason:`value > ${i}`}:{flagged:!1,reason:null}}case"age_bounds":{const r=n??wz,i=s??Nz;return e.numericValue<r?{flagged:!0,reason:`value < ${r}`}:e.numericValue>i?{flagged:!0,reason:`value > ${i}`}:{flagged:!1,reason:null}}case"custom_range":default:{const r=n!=null,i=s!=null;return!r&&!i?{flagged:!1,reason:null}:r&&e.numericValue<n?{flagged:!0,reason:`value < ${n}`}:i&&e.numericValue>s?{flagged:!0,reason:`value > ${s}`}:{flagged:!1,reason:null}}}},Cz=(e,t,n,s)=>{const{flagged:r,reason:i}=jz(e,t,n,s);return r?`${e.originalDisplay}  flagged (${i??"rule match"})`:`${e.originalDisplay}  ok`},Sz=(e,t,n,s,r,i=uz)=>{if(!t.length)return[];const l=[];for(const u of t){if(l.length>=i)break;const d=e[u];!d||!d.length||l.push({column:u,values:d.map(h=>Cz(h,n,s,r)),overflow:0})}return l},Ez={selectedColumns:[],autoDetectionActive:!0,recommendedColumns:[],nonNumericSelected:[],numericColumnCount:0,negativeCandidates:[],zeroCandidates:[],percentageOutliers:[],ageOutliers:[]},Mz=(e,t,n)=>{if(e==="custom_range"){if(t===null&&n===null)return"Specify a minimum and/or maximum to enable the custom range rule.";const s=t===null?"-":String(t),r=n===null?"":String(n);return`Custom bounds active: [${s}, ${r}].`}if(e==="percentage_bounds")return`Using percentage bounds ${t??0}${n??100}.`;if(e==="age_bounds")return`Using age bounds ${t??0}${n??120}.`;if(e==="negative_to_nan"&&(t!==null||n!==null)){const s=t??0;return n===null?`Negative-to-missing rule overrides values below ${s}.`:`Negative-to-missing rule overrides values < ${s} or > ${n}.`}return null},kz=({sourceId:e,hasReachableSource:t,columnsParameter:n,modeParameter:s,minValueParameter:r,maxValueParameter:i,renderMultiSelectField:l,renderParameterField:u,columnSummary:d,modeDetails:h,sampleMap:p,selectedMode:m,minValue:f,maxValue:y})=>{if(!n&&!s&&!r&&!i)return null;const{selectedColumns:x,autoDetectionActive:_}=d,v=x.length,w=yz(d.recommendedColumns),M=wc(d.negativeCandidates),N=wc(d.zeroCandidates),C=wc(d.percentageOutliers),j=wc(d.ageOutliers),E=wc(d.nonNumericSelected),k=Sz(p,x,m,f,y),$=Mz(m,f,y),T=!e||!t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Replace invalid numeric values"})}),o.jsxs("p",{className:"canvas-modal__note",children:[o.jsx("strong",{children:h.label})," rule. ",h.guidance," Example: ",h.example,"."]}),$&&o.jsx("p",{className:"canvas-modal__note",children:$}),_?o.jsx("p",{className:"canvas-modal__note",children:"No columns selectednumeric columns will be auto-detected when the node runs."}):o.jsxs("p",{className:"canvas-modal__note",children:["Targeting ",o.jsx("strong",{children:v})," column",v===1?"":"s"," for invalid value cleanup."]}),k.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Samples: ",k.map(P=>`${P.column} (${P.values.join("; ")})`).join(" | "),"."]}),M.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns with negative values: ",M.preview.join(", "),M.remaining>0?`, ... (${M.remaining} more)`:"","."]}),N.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Columns with placeholder zeros: ",N.preview.join(", "),N.remaining>0?`, ... (${N.remaining} more)`:"","."]}),C.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Percentage candidates with values outside 0-100: ",C.preview.join(", "),C.remaining>0?`, ... (${C.remaining} more)`:"","."]}),j.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Age-like values outside 0-120: ",j.preview.join(", "),j.remaining>0?`, ... (${j.remaining} more)`:"","."]}),w.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Other numeric columns: ",w.preview.join(", "),w.remaining>0?`, ... (${w.remaining} more)`:"","."]}),E.preview.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[E.preview.join(", ")," ",E.preview.length===1?"is":"are"," not numeric-type columns.",E.remaining>0?` ${E.remaining} more column${E.remaining===1?" is":"s are"} also non-numeric.`:" Verify the selection or adjust the rule."]}),T?e?o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream output to review numeric insights."}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to inspect numeric samples before applying replacements."}):null,n&&o.jsxs("div",{className:"canvas-modal__subsection",children:[o.jsx("h4",{children:"Columns to clean"}),l(n)]}),(s||r||i)&&o.jsxs("div",{className:"canvas-modal__parameter-list",children:[s?u(s):null,r?u(r):null,i?u(i):null]})]})};let Az="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",hN=(e=21)=>{let t="",n=e|0;for(;n--;)t+=Az[Math.random()*64|0];return t};const pN=[{value:"add",label:"Addition (+)"},{value:"subtract",label:"Subtraction ()"},{value:"multiply",label:"Multiplication ()"},{value:"divide",label:"Division ()"}],gN=[{value:"sum",label:"Sum"},{value:"mean",label:"Mean"},{value:"min",label:"Minimum"},{value:"max",label:"Maximum"},{value:"std",label:"Standard deviation"},{value:"median",label:"Median"},{value:"count",label:"Count (non-missing)"},{value:"range",label:"Range (max - min)"}],pp=[{value:"token_sort_ratio",label:"Token Sort  Same words, ignore order",description:"Split into words, sort alphabetically, then compare. Great when the same words appear in different order."},{value:"token_set_ratio",label:"Token Set  Unique words, ignore extras",description:"Focus on overlapping unique words and down-weight extras. Best when one string has additional words."},{value:"ratio",label:"Character Ratio  Raw string similarity",description:"Compare characters in order using edit distance. Sensitive to spelling differences."}],Ld=[{value:"year",label:"Year"},{value:"quarter",label:"Quarter"},{value:"month",label:"Month"},{value:"month_name",label:"Month name"},{value:"week",label:"ISO week number"},{value:"day",label:"Day of month"},{value:"day_name",label:"Day name"},{value:"weekday",label:"Weekday index (Mon=0)"},{value:"is_weekend",label:"Is weekend"},{value:"hour",label:"Hour"},{value:"minute",label:"Minute"},{value:"second",label:"Second"},{value:"season",label:"Season"},{value:"time_of_day",label:"Time of day bucket"}],Oz=new Set(Ld.map(e=>e.value)),Nc=[{value:"arithmetic",label:"Arithmetic",description:"Combine columns and constants using addition, subtraction, multiplication, or division.",defaultMethod:"add"},{value:"ratio",label:"Ratio",description:"Divide one column or group of columns by another with safe zero handling.",defaultMethod:"ratio"},{value:"stat",label:"Statistics",description:"Compute sums, averages, min/max, or dispersion metrics across columns.",defaultMethod:"mean"},{value:"similarity",label:"Text similarity",description:"Score two text columns using rapidfuzz token-based similarity.",defaultMethod:"token_sort_ratio"},{value:"datetime_extract",label:"Datetime extraction",description:"Expand datetime columns into year, month, weekday, season and similar features.",defaultMethod:"datetime_extract"}],jc="UTC",Rd=e=>e?Array.isArray(e)?Array.from(new Set(e.map(t=>typeof t=="string"?t.trim():String(t??"").trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?Rd(e.split(",")):[]:[],_N=e=>{if(!e)return[];if(Array.isArray(e)){const n=[];return e.forEach(s=>{const r=Number(s);Number.isFinite(r)&&n.push(r)}),n}if(typeof e=="string")return _N(e.split(/[;,]+/));const t=Number(e);return Number.isFinite(t)?[t]:[]},gp=e=>{const t=Number(e);return Number.isFinite(t)?t:null},yN=(e,t)=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e!==0:t;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(["true","1","yes","y","on"].includes(n))return!0;if(["false","0","no","n","off"].includes(n))return!1}return t},Tz=(e,t)=>{var s,r,i,l,u;if(typeof t!="string")return((s=Nc.find(d=>d.value===e))==null?void 0:s.defaultMethod)??"";const n=t.trim().toLowerCase();return n?e==="arithmetic"?((i=pN.find(d=>d.value===n))==null?void 0:i.value)??"add":e==="stat"?((l=gN.find(d=>d.value===n))==null?void 0:l.value)??"mean":e==="similarity"?((u=pp.find(d=>d.value===n))==null?void 0:u.value)??"token_sort_ratio":e==="ratio"?"ratio":e==="datetime_extract"?"datetime_extract":n:((r=Nc.find(d=>d.value===e))==null?void 0:r.defaultMethod)??""},$z=e=>{if(typeof e!="string")return"arithmetic";const t=e.trim().toLowerCase();return t==="arithmetic"||t==="ratio"||t==="stat"||t==="similarity"||t==="datetime_extract"?t:"arithmetic"},Pz=e=>{const t=Rd(e);return t.length?t.filter(n=>Oz.has(n)):["year","month","day"]},Lz=e=>typeof e!="string"?jc:e.trim()||jc,vN=e=>{if(!Array.isArray(e))return[];const t=[];return e.forEach((n,s)=>{if(!n||typeof n!="object")return;const r=n,i=$z(r.operation_type??r.type),l=r.operation_id??r.id??`feature_math_${s+1}`,u=typeof l=="string"&&l.trim()?l.trim():`feature_math_${s+1}`,d=Tz(i,r.method),h=Rd(r.input_columns??r.inputs??r.inputColumns),p=Rd(r.secondary_columns??r.denominator??r.secondaryColumns),m=_N(r.constants),f=typeof r.output_column=="string"?r.output_column.trim():"",y=typeof r.output_prefix=="string"?r.output_prefix.trim():"",x=i==="datetime_extract"?Pz(r.datetime_features):[],_=i==="datetime_extract"?Lz(r.timezone):jc,v=gp(r.fillna),w=(()=>{const E=gp(r.round??r.round_digits);return Number.isInteger(E??NaN),E})(),M=gp(r.epsilon),N=i==="similarity"?yN(r.normalize,!1):!1,C=r.allow_overwrite===void 0?null:yN(r.allow_overwrite,!1),j=typeof r.description=="string"?r.description:void 0;t.push({id:u,type:i,method:d,inputColumns:h,secondaryColumns:p,constants:m,outputColumn:f,outputPrefix:y,datetimeFeatures:x,timezone:_,fillna:v,roundDigits:w,normalize:N,epsilon:M,allowOverwrite:C,description:j})}),t},Rz=e=>{const t={id:e.id,operation_id:e.id,type:e.type,operation_type:e.type,method:e.method,input_columns:e.inputColumns,secondary_columns:e.secondaryColumns,constants:e.constants,output_column:e.outputColumn,output_prefix:e.outputPrefix};return e.type==="datetime_extract"?(t.datetime_features=e.datetimeFeatures.length?e.datetimeFeatures:["year","month","day"],t.timezone=e.timezone||jc):e.datetimeFeatures.length&&(t.datetime_features=e.datetimeFeatures),e.type==="similarity"&&(t.normalize=e.normalize),e.fillna!==null&&Number.isFinite(e.fillna)&&(t.fillna=e.fillna),e.roundDigits!==null&&Number.isFinite(e.roundDigits)&&(t.round=e.roundDigits,t.round_digits=e.roundDigits),e.epsilon!==null&&Number.isFinite(e.epsilon)&&(t.epsilon=e.epsilon),e.allowOverwrite!==null&&(t.allow_overwrite=e.allowOverwrite),e.description&&e.description.trim()&&(t.description=e.description.trim()),t},Dz=e=>e.map(t=>Rz(t)),zz={arithmetic:{method:"add",constants:[]},ratio:{method:"ratio",constants:[]},stat:{method:"mean",constants:[]},similarity:{method:"token_sort_ratio",constants:[],normalize:!1},datetime_extract:{method:"datetime_extract",datetimeFeatures:["year","month","day"]}},xN=(e,t)=>{var r;const n=zz[e]??{};let s=`math_${e}_${hN(6)}`;for(;t.has(s);)s=`math_${e}_${hN(6)}`;return{id:s,type:e,method:n.method??((r=Nc.find(i=>i.value===e))==null?void 0:r.defaultMethod)??"add",inputColumns:[],secondaryColumns:[],constants:n.constants??[],outputColumn:"",outputPrefix:"",datetimeFeatures:e==="datetime_extract"?n.datetimeFeatures??["year","month","day"]:[],timezone:jc,fillna:null,roundDigits:null,normalize:n.normalize??!1,epsilon:null,allowOverwrite:null,description:void 0}},Iz=(e,t)=>{const n=new Map;return t==null||t.forEach(s=>{s.operations.forEach(r=>{n.has(r.operation_id)||n.set(r.operation_id,r)})}),e.map((s,r)=>{const i=n.get(s.id),l=`${r+1}. ${s.type.replace("_"," ")}${s.method?`  ${s.method}`:""}`;return{id:s.id,label:l,status:i==null?void 0:i.status,message:(i==null?void 0:i.message)??void 0,outputColumns:(i==null?void 0:i.output_columns)??[]}})},bN=e=>e==="arithmetic"?pN:e==="stat"?gN:e==="similarity"?pp:e==="ratio"?[{value:"ratio",label:"Ratio (numerator / denominator)"}]:[{value:"datetime_extract",label:"Extract datetime parts"}],Fz=e=>{const t=pp.find(n=>n.value===e);return t!=null&&t.description?t.description:"Compare the input text columns using the selected similarity technique."},Bz={applied:"Applied",skipped:"Skipped",failed:"Failed"},Uz={applied:"canvas-cast__chip--applied",skipped:"canvas-cast__chip--muted",failed:"canvas-cast__chip--attention"},Hz=new Set(Ld.map(e=>e.value)),qz=(e,t=4)=>{if(!e.length)return"No columns yet";const n=e.slice(0,t),s=e.length-n.length;return s>0?`${n.join(", ")}  (${s} more)`:n.join(", ")},wN=e=>e.trim()?Array.from(new Set(e.split(",").map(t=>t.trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)):[],Vz=e=>e.trim()?e.split(",").map(t=>Number(t.trim())).filter(t=>Number.isFinite(t)):[],Wz=e=>e==="failed"?"canvas-modal__note canvas-modal__note--error":e==="skipped"?"canvas-modal__note canvas-modal__note--warning":"canvas-modal__note canvas-modal__note--info",Yz=({index:e,total:t,operation:n,summary:s,availableColumns:r,isCollapsed:i,onToggleCollapsed:l,onDuplicate:u,onRemove:d,onReorder:h,onChange:p})=>{var ee;const m=b.useMemo(()=>bN(n.type),[n.type]),f=b.useMemo(()=>{var Q;return((Q=Nc.find(ne=>ne.value===n.type))==null?void 0:Q.label)??n.type},[n.type]),y=b.useMemo(()=>{var Q;return((Q=m.find(ne=>ne.value===n.method))==null?void 0:Q.label)??n.method},[m,n.method]),x=b.useMemo(()=>n.type==="similarity"?Fz(n.method):"",[n.method,n.type]),[_,v]=b.useState(n.inputColumns.join(", ")),[w,M]=b.useState(n.secondaryColumns.join(", ")),[N,C]=b.useState(n.constants.join(", "));b.useEffect(()=>{v(n.inputColumns.join(", "))},[n.inputColumns]),b.useEffect(()=>{M(n.secondaryColumns.join(", "))},[n.secondaryColumns]),b.useEffect(()=>{C(n.constants.join(", "))},[n.constants]);const j=()=>{p(n.id,{inputColumns:wN(_)})},E=()=>{p(n.id,{secondaryColumns:wN(w)})},k=()=>{p(n.id,{constants:Vz(N)})},$=`feature-math-toggle-${n.id}`,T=`feature-math-body-${n.id}`,P=`feature-math-input-columns-${n.id}`,A=`feature-math-secondary-columns-${n.id}`,D=s==null?void 0:s.status,F=D?o.jsx("span",{className:`canvas-cast__chip ${Uz[D]??""}`,style:{marginLeft:"0.5rem"},children:Bz[D]}):null,R=s!=null&&s.message?s.message.trim():"",z=Wz(D),q=(ee=s==null?void 0:s.outputColumns)!=null&&ee.length?s.outputColumns.join(", "):"",V=qz(n.inputColumns),U=n.type==="ratio"||n.type==="similarity",W=n.type==="arithmetic"||n.type==="stat"||n.type==="ratio",B=n.type==="arithmetic"||n.type==="stat"||n.type==="ratio",I=n.type==="similarity",H=n.type==="datetime_extract",J=n.type==="stat"||n.type==="datetime_extract",G=b.useMemo(()=>{if(!r.length)return"";const Q=r.slice(0,6),ne=r.length-Q.length;return ne>0?`${Q.join(", ")}  (${ne} more)`:Q.join(", ")},[r]),Y=Q=>{if(!Q||!Hz.has(Q))return;const ne=new Set(n.datetimeFeatures);ne.has(Q)?ne.delete(Q):ne.add(Q),p(n.id,{datetimeFeatures:Array.from(ne)})},X=Q=>ne=>{const he=ne.target.value;if(he===""){p(n.id,{[Q]:null});return}const ye=Number(he);Number.isFinite(ye)&&(Q==="roundDigits"?p(n.id,{roundDigits:Math.round(ye)}):Q==="fillna"?p(n.id,{fillna:ye}):p(n.id,{epsilon:ye}))},Z=n.allowOverwrite===null?"inherit":n.allowOverwrite?"allow":"prevent";return o.jsxs("div",{className:"canvas-imputer__card",children:[o.jsxs("div",{className:"canvas-imputer__card-header",children:[o.jsxs("button",{type:"button",id:$,className:"canvas-imputer__card-toggle",onClick:()=>l(n.id),"aria-expanded":!i,"aria-controls":T,children:[o.jsx("span",{className:`canvas-imputer__toggle-icon${i?"":" canvas-imputer__toggle-icon--open"}`,"aria-hidden":"true"}),o.jsxs("span",{className:"canvas-imputer__card-text",children:[o.jsxs("span",{className:"canvas-imputer__card-title",children:["Operation ",e+1]}),o.jsxs("span",{className:"canvas-imputer__card-summary",children:[f,y?`  ${y}`:"",n.outputColumn?`   ${n.outputColumn}`:"",F]}),o.jsxs("span",{className:"canvas-modal__meta",children:["Inputs: ",V]})]})]}),o.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>d(n.id),"aria-label":`Remove operation ${e+1}`,children:"Remove"})]}),!i&&o.jsxs("div",{className:"canvas-imputer__card-body",id:T,children:[o.jsx("div",{className:"canvas-imputer__row",children:o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>u(n.id),children:"Duplicate"}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>h(n.id,"up"),disabled:e===0,children:"Move up"}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>h(n.id,"down"),disabled:e>=t-1,children:"Move down"})]})}),R&&o.jsx("p",{className:z,children:R}),q&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Outputs: ",q]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-type`,children:"Operation type"}),o.jsx("select",{id:`feature-math-${n.id}-type`,value:n.type,onChange:Q=>p(n.id,{type:Q.target.value}),children:Nc.map(Q=>o.jsx("option",{value:Q.value,children:Q.label},Q.value))})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-method`,children:"Method"}),o.jsx("select",{id:`feature-math-${n.id}-method`,value:n.method,onChange:Q=>p(n.id,{method:Q.target.value}),children:m.map(Q=>o.jsx("option",{value:Q.value,children:Q.label},Q.value))})]}),n.type==="similarity"&&x&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:x}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-input-columns`,children:"Input columns"}),o.jsx("input",{id:`feature-math-${n.id}-input-columns`,type:"text",value:_,onChange:Q=>v(Q.target.value),onBlur:j,onKeyDown:Q=>{Q.key==="Enter"&&(Q.preventDefault(),j())},placeholder:"col_a, col_b",list:P}),o.jsx("datalist",{id:P,children:r.map(Q=>o.jsx("option",{value:Q},`${n.id}-input-option-${Q}`))}),G&&o.jsxs("p",{className:"canvas-modal__meta",children:["Available: ",G]})]}),U&&o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-secondary-columns`,children:n.type==="ratio"?"Denominator columns":"Compare against"}),o.jsx("input",{id:`feature-math-${n.id}-secondary-columns`,type:"text",value:w,onChange:Q=>M(Q.target.value),onBlur:E,onKeyDown:Q=>{Q.key==="Enter"&&(Q.preventDefault(),E())},placeholder:n.type==="ratio"?"denominator_col":"comparison column",list:A}),o.jsx("datalist",{id:A,children:r.map(Q=>o.jsx("option",{value:Q},`${n.id}-secondary-option-${Q}`))}),o.jsx("p",{className:"canvas-modal__meta",children:"Comma separated list"})]}),W&&o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-constants`,children:"Constants (optional)"}),o.jsx("input",{id:`feature-math-${n.id}-constants`,type:"text",value:N,onChange:Q=>C(Q.target.value),onBlur:k,onKeyDown:Q=>{Q.key==="Enter"&&(Q.preventDefault(),k())},placeholder:"0.0, 1.5"}),o.jsx("p",{className:"canvas-modal__meta",children:"Numbers separated by commas are added alongside the selected columns."})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-output-column`,children:"Output column (optional)"}),o.jsx("input",{id:`feature-math-${n.id}-output-column`,type:"text",value:n.outputColumn,onChange:Q=>p(n.id,{outputColumn:Q.target.value}),placeholder:"custom_feature_name"}),o.jsx("p",{className:"canvas-modal__meta",children:"Leave blank to derive a name automatically."})]}),J&&o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-output-prefix`,children:"Output prefix"}),o.jsx("input",{id:`feature-math-${n.id}-output-prefix`,type:"text",value:n.outputPrefix,onChange:Q=>p(n.id,{outputPrefix:Q.target.value}),placeholder:"prefix_"}),o.jsx("p",{className:"canvas-modal__meta",children:"Applied to generated column names (statistics or datetime features)."})]}),B&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-fillna`,children:"Fill missing result with"}),o.jsx("input",{id:`feature-math-${n.id}-fillna`,type:"number",value:n.fillna??"",onChange:X("fillna"),placeholder:"none"}),o.jsx("p",{className:"canvas-modal__meta",children:"Applies after computing the operation."})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-round`,children:"Round digits"}),o.jsx("input",{id:`feature-math-${n.id}-round`,type:"number",value:n.roundDigits??"",onChange:X("roundDigits"),placeholder:"none",step:1}),o.jsx("p",{className:"canvas-modal__meta",children:"Leave blank for no rounding."})]})]}),n.type==="ratio"&&o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-epsilon`,children:"Division epsilon"}),o.jsx("input",{id:`feature-math-${n.id}-epsilon`,type:"number",value:n.epsilon??"",onChange:X("epsilon"),placeholder:"inherit",step:"any"}),o.jsx("p",{className:"canvas-modal__meta",children:"Overrides the node-level epsilon for this ratio."})]}),I&&o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsxs("label",{htmlFor:`feature-math-${n.id}-normalize`,className:"canvas-modal__boolean-control",children:[o.jsx("input",{id:`feature-math-${n.id}-normalize`,type:"checkbox",checked:n.normalize,onChange:Q=>p(n.id,{normalize:Q.target.checked})}),o.jsx("span",{children:"Normalize scores to the [0, 1] range"})]}),o.jsx("p",{className:"canvas-modal__meta",children:"Useful when chaining similarity outputs into downstream calculations."})]}),H&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"canvas-imputer__row canvas-imputer__row--wrap",children:o.jsxs("fieldset",{children:[o.jsx("legend",{children:"Datetime features"}),o.jsx("div",{className:"canvas-modal__checkbox-grid",children:Ld.map(Q=>{const ne=`feature-math-${n.id}-datetime-${Q.value}`,he=n.datetimeFeatures.includes(Q.value);return o.jsxs("label",{className:"canvas-modal__checkbox-item",htmlFor:ne,children:[o.jsx("input",{id:ne,type:"checkbox",checked:he,onChange:()=>Y(Q.value)}),o.jsx("span",{className:"canvas-modal__checkbox-label",children:Q.label})]},Q.value)})})]})}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-timezone`,children:"Timezone override"}),o.jsx("input",{id:`feature-math-${n.id}-timezone`,type:"text",value:n.timezone,onChange:Q=>p(n.id,{timezone:Q.target.value}),placeholder:"UTC"}),o.jsx("p",{className:"canvas-modal__meta",children:"Use an IANA timezone identifier, e.g. America/New_York."})]})]}),o.jsxs("div",{className:"canvas-imputer__row",children:[o.jsx("label",{htmlFor:`feature-math-${n.id}-allow-overwrite`,children:"Overwrite behavior"}),o.jsxs("select",{id:`feature-math-${n.id}-allow-overwrite`,value:Z,onChange:Q=>{const ne=Q.target.value;ne==="inherit"?p(n.id,{allowOverwrite:null}):p(n.id,{allowOverwrite:ne==="allow"})},children:[o.jsx("option",{value:"inherit",children:"Inherit node default"}),o.jsx("option",{value:"allow",children:"Always overwrite existing columns"}),o.jsx("option",{value:"prevent",children:"Never overwrite existing columns"})]})]})]})]})},Kz=({operations:e,summaries:t,collapsed:n,onToggleCollapsed:s,onAddOperation:r,onDuplicateOperation:i,onRemoveOperation:l,onReorderOperation:u,onOperationChange:d,availableColumns:h,signals:p,previewStatus:m,errorHandlingParameter:f,allowOverwriteParameter:y,defaultTimezoneParameter:x,epsilonParameter:_,renderParameterField:v})=>{const[w,M]=b.useState("arithmetic"),N=b.useMemo(()=>{const $=new Map;return t.forEach(T=>{$.set(T.id,T)}),$},[t]),C=b.useMemo(()=>p.length?p[p.length-1]:null,[p]),j=(C==null?void 0:C.warnings)??[],E=C&&C.failed_operations>0?"canvas-modal__note canvas-modal__note--warning":"canvas-modal__note canvas-modal__note--info",k=()=>{r(w)};return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Feature math operations"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:k,children:"Add operation"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Blend columns using arithmetic formulas, ratios, statistics, similarity scores, or datetime extractions. Configure each operation below  they execute in order."}),m==="loading"&&o.jsx("p",{className:"canvas-modal__note",children:"Preview updating"}),C&&o.jsxs("p",{className:E,children:["Preview applied ",C.applied_operations," of ",C.total_operations," operation",C.total_operations===1?"":"s"," (",C.skipped_operations," skipped, ",C.failed_operations," failed)."]}),j.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:j.map(($,T)=>o.jsx("li",{children:$},`feature-math-warning-${T}`))}),e.length===0&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"No feature math steps configured yet. Add an operation to create engineered columns."}),e.map(($,T)=>o.jsx(Yz,{index:T,total:e.length,operation:$,summary:N.get($.id),availableColumns:h,isCollapsed:n.has($.id),onToggleCollapsed:s,onDuplicate:i,onRemove:l,onReorder:u,onChange:d},$.id)),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[f&&v(f),y&&v(y),x&&v(x),_&&v(_)]})]})},Gz={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},Xz={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},NN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),Qz=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxUniqueParameter:d,outputSuffixParameter:h,dropOriginalParameter:p,missingStrategyParameter:m,missingCodeParameter:f,selectedColumns:y,renderParameterField:x,onToggleColumn:_,onApplyRecommended:v,formatMissingPercentage:w})=>{const M=b.useMemo(()=>{if(!r.length)return[];const E=new Set;return r.forEach(k=>{k.status==="recommended"&&k.selectable&&E.add(k.column)}),Array.from(E)},[r]),N=b.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface label encoding suggestions.",[t,e]),C=r.length>0,j=!n&&!!s&&!!e&&t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Label encoding suggestions"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(M),disabled:!M.length,children:"Add recommended"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Convert short-form categorical text into integer labels. Suggestions come from EDA heuristics and the current pipeline preview."}),N&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:N}),i.generatedAt&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.autoDetectDefault&&o.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),i.notes.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((E,k)=>o.jsx("li",{children:E},`label-encoding-note-${k}`))}),i.highCardinalityColumns.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading label encoding insights"}),j&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!C&&e&&t&&o.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&C&&o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Distinct"}),o.jsx("th",{scope:"col",children:"Missing"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Select"})]})}),o.jsx("tbody",{children:r.map(E=>{const k=y.includes(E.column),$=Gz[E.status],T=Xz[E.status]??"canvas-cast__chip--muted",P=E.sample_values.length?E.sample_values.join(", "):"",A=E.unique_count!==void 0&&E.unique_count!==null?`${NN(E.unique_count)} (${NN(E.unique_percentage)}%)`:"",D=w(E.missing_percentage);return o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:E.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[E.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",E.dtype]}),E.text_category&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:E.text_category})]}),o.jsx("div",{className:"canvas-cast__column-meta",children:o.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",P]})}),o.jsx("p",{className:"canvas-cast__recommendation-note",children:E.reason})]})}),o.jsx("td",{children:A}),o.jsx("td",{children:D}),o.jsx("td",{children:o.jsx("span",{className:`canvas-cast__chip ${T}`,children:$})}),o.jsx("td",{children:o.jsxs("label",{className:"canvas-modal__checkbox-item",children:[o.jsx("input",{type:"checkbox",checked:k,onChange:()=>_(E.column),disabled:!E.selectable}),o.jsx("span",{className:"canvas-modal__checkbox-label",children:E.selectable?k?"In node":"Add column":"Not eligible"})]})})]},`label-encoding-row-${E.column}`)})})]})}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),h&&x(h),p&&x(p),m&&x(m),f&&x(f)]}),l&&o.jsxs("div",{children:[o.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},Zz={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},Jz={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},jN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),eI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,targetColumnParameter:u,autoDetectParameter:d,maxCategoriesParameter:h,outputSuffixParameter:p,dropOriginalParameter:m,smoothingParameter:f,encodeMissingParameter:y,handleUnknownParameter:x,selectedColumns:_,renderParameterField:v,onToggleColumn:w,onApplyRecommended:M,formatMissingPercentage:N})=>{const C=b.useMemo(()=>{if(!r.length)return[];const $=new Set;return r.forEach(T=>{T.status==="recommended"&&T.selectable&&$.add(T.column)}),Array.from($)},[r]),j=b.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface target encoding suggestions.",[t,e]),E=r.length>0,k=!n&&!!s&&!!e&&t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Target encoding suggestions"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>M(C),disabled:!C.length,children:"Add recommended"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Encode categorical columns by replacing each category with the smoothed mean of a numeric target column. This is useful for high-cardinality features when a label or ordinal encoding is too coarse."}),j&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:j}),!u&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Add a target column parameter to unlock target encoding. The backend requires a numeric target to compute averages."}),i.autoDetectDefault&&o.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),i.enableGlobalFallbackDefault&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Enable the global mean fallback so unseen categories and nulls do not break downstream transforms."}),i.generatedAt&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.notes.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map(($,T)=>o.jsx("li",{children:$},`target-encoding-note-${T}`))}),i.highCardinalityColumns.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading target encoding insights"}),k&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!E&&e&&t&&o.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&E&&o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Distinct"}),o.jsx("th",{scope:"col",children:"Missing"}),o.jsx("th",{scope:"col",children:"Fallback"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Select"})]})}),o.jsx("tbody",{children:r.map($=>{const T=_.includes($.column),P=Zz[$.status],A=Jz[$.status]??"canvas-cast__chip--muted",D=$.sample_values.length?$.sample_values.join(", "):"",F=$.unique_count!==void 0&&$.unique_count!==null?`${jN($.unique_count)} (${jN($.unique_percentage)}%)`:"",R=N($.missing_percentage),z=$.recommended_use_global_fallback?"Use global mean":"";return o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:$.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[$.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",$.dtype]}),$.text_category&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:$.text_category})]}),o.jsx("div",{className:"canvas-cast__column-meta",children:o.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",D]})}),o.jsx("p",{className:"canvas-cast__recommendation-note",children:$.reason})]})}),o.jsx("td",{children:F}),o.jsx("td",{children:R}),o.jsx("td",{children:z}),o.jsx("td",{children:o.jsx("span",{className:`canvas-cast__chip ${A}`,children:P})}),o.jsx("td",{children:o.jsxs("label",{className:"canvas-modal__checkbox-item",children:[o.jsx("input",{type:"checkbox",checked:T,onChange:()=>w($.column),disabled:!$.selectable}),o.jsx("span",{className:"canvas-modal__checkbox-label",children:$.selectable?T?"In node":"Add column":"Not eligible"})]})})]},`target-encoding-row-${$.column}`)})})]})}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&v(u),d&&v(d),h&&v(h),p&&v(p),m&&v(m),f&&v(f),y&&v(y),x&&v(x)]}),l&&o.jsxs("div",{children:[o.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),v(l)]})]})},tI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},nI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},CN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),sI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,bucketsParameter:h,outputSuffixParameter:p,dropOriginalParameter:m,encodeMissingParameter:f,selectedColumns:y,renderParameterField:x,onToggleColumn:_,onApplyRecommended:v,formatMissingPercentage:w})=>{const M=b.useMemo(()=>{if(!r.length)return[];const k=new Set;return r.forEach($=>{$.status==="recommended"&&$.selectable&&k.add($.column)}),Array.from(k)},[r]),N=b.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface hash encoding suggestions.",[t,e]),C=r.length>0,j=i.suggestedBucketDefault>0?`Default bucket suggestion: ${i.suggestedBucketDefault.toLocaleString()}.`:null,E=!n&&!!s&&!!e&&t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Hash encoding suggestions"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(M),disabled:!M.length,children:"Add recommended"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Hash encoding maps categorical labels into a fixed number of numeric buckets, keeping feature width bounded even when categories grow over time. Collisions are acceptable for tree models and regularised linear models that can tolerate sparse overlaps."}),N&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:N}),i.autoDetectDefault&&o.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so newly ingested categorical columns pick up hashing without manual edits."}),j&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:j}),i.generatedAt&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.notes.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((k,$)=>o.jsx("li",{children:k},`hash-encoding-note-${$}`))}),i.highCardinalityColumns.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["High-cardinality columns highlighted:"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading hash encoding insights"}),E&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!C&&e&&t&&o.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&C&&o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Distinct"}),o.jsx("th",{scope:"col",children:"Missing"}),o.jsx("th",{scope:"col",children:"Suggested buckets"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Select"})]})}),o.jsx("tbody",{children:r.map(k=>{const $=y.includes(k.column),T=tI[k.status],P=nI[k.status]??"canvas-cast__chip--muted",A=k.sample_values.length?k.sample_values.join(", "):"",D=k.unique_count!==void 0&&k.unique_count!==null?`${CN(k.unique_count)} (${CN(k.unique_percentage)}%)`:"",F=w(k.missing_percentage),R=k.recommended_bucket_count?k.recommended_bucket_count.toLocaleString():"";return o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:k.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[k.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",k.dtype]}),k.text_category&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:k.text_category})]}),o.jsx("div",{className:"canvas-cast__column-meta",children:o.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",A]})}),o.jsx("p",{className:"canvas-cast__recommendation-note",children:k.reason})]})}),o.jsx("td",{children:D}),o.jsx("td",{children:F}),o.jsx("td",{children:R}),o.jsx("td",{children:o.jsx("span",{className:`canvas-cast__chip ${P}`,children:T})}),o.jsx("td",{children:o.jsxs("label",{className:"canvas-modal__checkbox-item",children:[o.jsx("input",{type:"checkbox",checked:$,onChange:()=>_(k.column),disabled:!k.selectable}),o.jsx("span",{className:"canvas-modal__checkbox-label",children:k.selectable?$?"In node":"Add column":"Not eligible"})]})})]},`hash-encoding-row-${k.column}`)})})]})}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),h&&x(h),p&&x(p),m&&x(m),f&&x(f)]}),l&&o.jsxs("div",{children:[o.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},rI=({columnsParameter:e,autoDetectParameter:t,degreeParameter:n,includeBiasParameter:s,interactionOnlyParameter:r,includeInputFeaturesParameter:i,outputPrefixParameter:l,renderParameterField:u,signal:d})=>{const h=b.useMemo(()=>[e,t,n,s,r,i,l].filter(v=>!!v),[e,t,n,s,r,i,l]),p=(d==null?void 0:d.generated_features)??[],m=(d==null?void 0:d.skipped_columns)??[],f=(d==null?void 0:d.filled_columns)??{},y=(d==null?void 0:d.notes)??[],x=(d==null?void 0:d.feature_count)??0,_=b.useMemo(()=>{const v=Object.entries(f);return v.length?v.map(([w,M])=>`${w} (${M.toLocaleString()} missing)`).join(", "):null},[f]);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Polynomial feature settings"})}),o.jsx("p",{className:"canvas-modal__note",children:"Expand numeric features with polynomial powers and interaction terms to capture non-linear relations. Preview the node to inspect generated columns and adjust degree or interaction options as needed."}),h.length>0&&o.jsx("div",{className:"canvas-modal__parameter-grid",children:h.map(v=>u(v))}),m.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Skipped columns: ",m.join(", "),"."]}),_&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Filled missing values with 0 for ",_," before generating features."]}),x>0?o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Feature column"}),o.jsx("th",{scope:"col",children:"Expression"}),o.jsx("th",{scope:"col",children:"Degree"})]})}),o.jsx("tbody",{children:p.map(v=>o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:v.column}),o.jsx("td",{children:v.expression||(v.terms.length?v.terms.join("  "):"1")}),o.jsx("td",{children:v.degree})]},`poly-feature-${v.column}`))})]})}):o.jsx("p",{className:"canvas-modal__note",children:"No derived features yet. Run a preview to generate polynomial terms for the current configuration."}),y.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:y.map((v,w)=>o.jsx("li",{children:v},`polynomial-note-${w}`))})]})},SN=e=>!!e,Cc=(e,t=4)=>{if(e==null)return"";const n=Number(e);return Number.isFinite(n)?n.toLocaleString(void 0,{maximumFractionDigits:t}):""},aI=e=>{if(e==null)return"";const t=Number(e);return Number.isFinite(t)?t===0?"< 1e-12":t<1e-4?t.toExponential(2):t.toLocaleString(void 0,{maximumFractionDigits:6}):""},EN=(e,t=8)=>{if(!e.length)return"None";const n=e.slice(0,t),s=e.length-n.length;return s>0?`${n.join(", ")}  (${s} more)`:n.join(", ")},oI=({columnsParameter:e,autoDetectParameter:t,targetColumnParameter:n,methodParameter:s,scoreFuncParameter:r,problemTypeParameter:i,kParameter:l,percentileParameter:u,alphaParameter:d,thresholdParameter:h,modeParameter:p,estimatorParameter:m,stepParameter:f,minFeaturesParameter:y,maxFeaturesParameter:x,dropUnselectedParameter:_,renderParameterField:v,signal:w})=>{const M=b.useMemo(()=>[e,t,n,s,r,i].filter(SN),[e,t,n,s,r,i]),N=b.useMemo(()=>[l,u,d,h,p,m,f,y,x,_].filter(SN),[l,u,d,h,p,m,f,y,x,_]),C=(w==null?void 0:w.configured_columns)??[],j=(w==null?void 0:w.evaluated_columns)??[],E=(w==null?void 0:w.selected_columns)??[],k=(w==null?void 0:w.dropped_columns)??[],$=(w==null?void 0:w.feature_summaries)??[],T=(w==null?void 0:w.notes)??[],P=(w==null?void 0:w.drop_unselected)??!1,A=b.useMemo(()=>{if(!j.length&&!C.length)return null;if(j.length===C.length)return`Evaluated ${j.length.toLocaleString()} column(s).`;if(!C.length)return`Evaluated ${j.length.toLocaleString()} column(s) via auto-detect.`;const z=Math.max(j.length-C.length,0);return z>0?`Evaluated ${j.length.toLocaleString()} column(s) (${z.toLocaleString()} auto-detected).`:`Evaluated ${j.length.toLocaleString()} of ${C.length.toLocaleString()} configured column(s).`},[C,j]),D=b.useMemo(()=>{if(!w)return null;const z=[];return w.method&&z.push(`Method: ${w.method}`),w.score_func&&z.push(`Score: ${w.score_func}`),w.estimator&&z.push(`Estimator: ${w.estimator}`),w.problem_type&&w.problem_type!=="auto"&&z.push(`Problem: ${w.problem_type}`),w.target_column&&z.push(`Target: ${w.target_column}`),typeof w.k=="number"&&Number.isFinite(w.k)&&z.push(`k = ${w.k.toLocaleString()}`),typeof w.percentile=="number"&&Number.isFinite(w.percentile)&&z.push(`percentile = ${Cc(w.percentile,2)}`),typeof w.alpha=="number"&&Number.isFinite(w.alpha)&&z.push(`alpha = ${Cc(w.alpha,4)}`),w.threshold!==null&&w.threshold!==void 0&&Number.isFinite(w.threshold)&&z.push(`threshold = ${Cc(w.threshold,4)}`),w.auto_detect&&z.push("Auto-detect enabled"),z.length?z.join("  "):null},[w]),F=b.useMemo(()=>EN(E),[E]),R=b.useMemo(()=>EN(k),[k]);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Feature selection settings"})}),o.jsx("p",{className:"canvas-modal__note",children:"Score candidate predictors and retain the most informative columns using statistical tests or model-based selectors. Run a preview after adjusting parameters to refresh rankings."}),D&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:D}),A&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:A}),M.length>0&&o.jsx("div",{className:"canvas-modal__parameter-grid",children:M.map(z=>v(z))}),N.length>0&&o.jsx("div",{className:"canvas-modal__parameter-grid",style:{marginTop:"1rem"},children:N.map(z=>v(z))}),o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:P?"Unselected columns will be dropped from the dataset when this node runs.":"Unselected columns will remain in the dataset for downstream steps."}),E.length>0?o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Selected ",E.length.toLocaleString()," column(s): ",F]}):o.jsx("p",{className:"canvas-modal__note",children:"No columns selected yet. Run a preview to compute selection scores."}),k.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Dropped ",k.length.toLocaleString()," column(s): ",R]}),$.length>0?o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Feature column"}),o.jsx("th",{scope:"col",children:"Score"}),o.jsx("th",{scope:"col",children:"p-value"}),o.jsx("th",{scope:"col",children:"Rank"}),o.jsx("th",{scope:"col",children:"Importance"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Note"})]})}),o.jsx("tbody",{children:$.map(z=>{const q=["canvas-cast__row"];return z.selected||q.push("canvas-cast__row--muted"),o.jsxs("tr",{className:q.join(" "),children:[o.jsx("th",{scope:"row",children:z.column}),o.jsx("td",{children:Cc(z.score)}),o.jsx("td",{children:aI(z.p_value)}),o.jsx("td",{children:z.rank??""}),o.jsx("td",{children:Cc(z.importance,4)}),o.jsx("td",{children:z.selected?"Selected":"Dropped"}),o.jsx("td",{children:z.note??""})]},`feature-selection-summary-${z.column}`)})})]})}):o.jsx("p",{className:"canvas-modal__note",children:"Preview results will display per-column scores, ranks, and selection outcomes here."}),T.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:T.map((z,q)=>o.jsx("li",{children:z},`feature-selection-note-${q}`))})]})},iI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},lI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},MN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),cI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,outputSuffixParameter:h,dropOriginalParameter:p,encodeMissingParameter:m,handleUnknownParameter:f,unknownValueParameter:y,selectedColumns:x,renderParameterField:_,onToggleColumn:v,onApplyRecommended:w,formatMissingPercentage:M})=>{const N=b.useMemo(()=>{if(!r.length)return[];const k=new Set;return r.forEach($=>{$.status==="recommended"&&$.selectable&&k.add($.column)}),Array.from(k)},[r]),C=b.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface ordinal encoding suggestions.",[t,e]),j=r.length>0,E=!n&&!!s&&!!e&&t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Ordinal encoding suggestions"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>w(N),disabled:!N.length,children:"Add recommended"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Convert categorical columns into ordered integer codes. Use the fallback controls to keep pipelines stable when unexpected categories or missing values appear."}),C&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:C}),i.autoDetectDefault&&o.jsx("p",{className:"canvas-modal__note",children:"Auto-detect is suggested so future categorical columns join without manual updates."}),i.enableUnknownDefault&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Enable the fallback code so unseen categories and nulls do not break downstream transforms."}),i.generatedAt&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.notes.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((k,$)=>o.jsx("li",{children:k},`ordinal-encoding-note-${$}`))}),i.highCardinalityColumns.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading ordinal encoding insights"}),E&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!j&&e&&t&&o.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&j&&o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Distinct"}),o.jsx("th",{scope:"col",children:"Missing"}),o.jsx("th",{scope:"col",children:"Unknowns"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Select"})]})}),o.jsx("tbody",{children:r.map(k=>{const $=x.includes(k.column),T=iI[k.status],P=lI[k.status]??"canvas-cast__chip--muted",A=k.sample_values.length?k.sample_values.join(", "):"",D=k.unique_count!==void 0&&k.unique_count!==null?`${MN(k.unique_count)} (${MN(k.unique_percentage)}%)`:"",F=M(k.missing_percentage),R=k.recommended_handle_unknown?"Enable fallback":"";return o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:k.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[k.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",k.dtype]}),k.text_category&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:k.text_category})]}),o.jsx("div",{className:"canvas-cast__column-meta",children:o.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",A]})}),o.jsx("p",{className:"canvas-cast__recommendation-note",children:k.reason})]})}),o.jsx("td",{children:D}),o.jsx("td",{children:F}),o.jsx("td",{children:R}),o.jsx("td",{children:o.jsx("span",{className:`canvas-cast__chip ${P}`,children:T})}),o.jsx("td",{children:o.jsxs("label",{className:"canvas-modal__checkbox-item",children:[o.jsx("input",{type:"checkbox",checked:$,onChange:()=>v(k.column),disabled:!k.selectable}),o.jsx("span",{className:"canvas-modal__checkbox-label",children:k.selectable?$?"In node":"Add column":"Not eligible"})]})})]},`ordinal-encoding-row-${k.column}`)})})]})}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&_(u),d&&_(d),h&&_(h),p&&_(p),m&&_(m),f&&_(f),y&&_(y)]}),l&&o.jsxs("div",{children:[o.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),_(l)]})]})},uI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},dI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},kN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),mI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,dropFirstParameter:h,includeMissingParameter:p,dropOriginalParameter:m,prefixSeparatorParameter:f,selectedColumns:y,renderParameterField:x,onToggleColumn:_,onApplyRecommended:v,formatMissingPercentage:w})=>{const M=b.useMemo(()=>{if(!r.length)return[];const E=new Set;return r.forEach(k=>{k.status==="recommended"&&k.selectable&&E.add(k.column)}),Array.from(E)},[r]),N=b.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface dummy encoding suggestions.",[t,e]),C=r.length>0,j=!n&&!!s&&!!e&&t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Dummy encoding suggestions"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(M),disabled:!M.length,children:"Add recommended"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Create dummy variables while automatically dropping a reference category. This mirrors one-hot encoding but keeps feature matrices full rank."}),N&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:N}),i.autoDetectDefault&&u&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:"Auto-detection is recommended here so new categorical columns are captured by default."}),i.generatedAt&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.cautionedCount>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[i.cautionedCount," column",i.cautionedCount===1?"":"s"," could expand heavily  consider alternate encodings."]}),i.notes.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((E,k)=>o.jsx("li",{children:E},`dummy-note-${k}`))}),i.highCardinalityColumns.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading dummy encoding insights"}),j&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!C&&e&&t&&o.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&C&&o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Distinct"}),o.jsx("th",{scope:"col",children:"Missing"}),o.jsx("th",{scope:"col",children:"Dummy cols"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Select"})]})}),o.jsx("tbody",{children:r.map(E=>{const k=y.includes(E.column),$=uI[E.status],T=dI[E.status]??"canvas-cast__chip--muted",P=E.sample_values.length?E.sample_values.join(", "):"",A=E.unique_count!==void 0&&E.unique_count!==null?`${kN(E.unique_count)} (${kN(E.unique_percentage)}%)`:"",D=w(E.missing_percentage),F=E.estimated_dummy_columns?E.estimated_dummy_columns.toLocaleString():"";return o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:E.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[E.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",E.dtype]}),E.text_category&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:E.text_category}),E.recommended_drop_first&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--info",children:"Drop first suggested"})]}),o.jsx("div",{className:"canvas-cast__column-meta",children:o.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",P]})}),o.jsx("p",{className:"canvas-cast__recommendation-note",children:E.reason})]})}),o.jsx("td",{children:A}),o.jsx("td",{children:D}),o.jsx("td",{children:F}),o.jsx("td",{children:o.jsx("span",{className:`canvas-cast__chip ${T}`,children:$})}),o.jsx("td",{children:o.jsxs("label",{className:"canvas-modal__checkbox-item",children:[o.jsx("input",{type:"checkbox",checked:k,onChange:()=>_(E.column),disabled:!E.selectable}),o.jsx("span",{className:"canvas-modal__checkbox-label",children:E.selectable?k?"In node":"Add column":"Not eligible"})]})})]},`dummy-encoding-row-${E.column}`)})})]})}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),h&&x(h),p&&x(p),m&&x(m),f&&x(f)]}),l&&o.jsxs("div",{children:[o.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},fI={recommended:"Recommended",high_cardinality:"High cardinality",identifier:"Identifier-like",free_text:"Free text",single_category:"Single category",too_many_categories:"Too many categories"},hI={recommended:"canvas-cast__chip--applied",high_cardinality:"canvas-cast__chip--attention",identifier:"canvas-cast__chip--muted",free_text:"canvas-cast__chip--muted",single_category:"canvas-cast__chip--muted",too_many_categories:"canvas-cast__chip--muted"},AN=e=>e==null||Number.isNaN(e)?"":e.toLocaleString(void 0,{maximumFractionDigits:2}),pI=({sourceId:e,hasReachableSource:t,isFetching:n,error:s,suggestions:r,metadata:i,columnsParameter:l,autoDetectParameter:u,maxCategoriesParameter:d,dropFirstParameter:h,includeMissingParameter:p,dropOriginalParameter:m,prefixSeparatorParameter:f,selectedColumns:y,renderParameterField:x,onToggleColumn:_,onApplyRecommended:v,formatMissingPercentage:w})=>{const M=b.useMemo(()=>{if(!r.length)return[];const E=new Set;return r.forEach(k=>{k.status==="recommended"&&k.selectable&&E.add(k.column)}),Array.from(E)},[r]),N=b.useMemo(()=>e?t?null:"Connect this node to the dataset input to analyse categorical features.":"Choose a dataset to surface one-hot encoding suggestions.",[t,e]),C=r.length>0,j=!n&&!!s&&!!e&&t;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"One-hot encoding suggestions"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>v(M),disabled:!M.length,children:"Add recommended"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Expand categorical text into binary indicator columns. Suggestions factor in estimated dummy counts so encodings stay tractable."}),N&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:N}),i.generatedAt&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",new Date(i.generatedAt).toLocaleString()," on"," ",i.sampleSize===null?"sampled rows":`${i.sampleSize.toLocaleString()} row${i.sampleSize===1?"":"s"}`,"."]}),!i.generatedAt&&i.sampleSize!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Evaluated ",i.sampleSize.toLocaleString()," row",i.sampleSize===1?"":"s"," for categorical trends."]}),i.totalTextColumns>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Found ",i.totalTextColumns," text column",i.totalTextColumns===1?"":"s","; recommendations cover"," ",i.recommendedCount," candidate",i.recommendedCount===1?"":"s","."]}),i.cautionedCount>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[i.cautionedCount," column",i.cautionedCount===1?"":"s"," could explode in width  consider alternate encodings."]}),i.notes.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:i.notes.map((E,k)=>o.jsx("li",{children:E},`one-hot-note-${k}`))}),i.highCardinalityColumns.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipped ",i.highCardinalityColumns.length," high-cardinality column",i.highCardinalityColumns.length===1?"":"s",":"," ",i.highCardinalityColumns.slice(0,4).join(", "),i.highCardinalityColumns.length>4?", ":"","."]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading one-hot encoding insights"}),j&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s??""}),!n&&!s&&!C&&e&&t&&o.jsx("p",{className:"canvas-modal__note",children:"No categorical text candidates detected in the current preview."}),!n&&!s&&C&&o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Distinct"}),o.jsx("th",{scope:"col",children:"Missing"}),o.jsx("th",{scope:"col",children:"Dummy cols"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Select"})]})}),o.jsx("tbody",{children:r.map(E=>{const k=y.includes(E.column),$=fI[E.status],T=hI[E.status]??"canvas-cast__chip--muted",P=E.sample_values.length?E.sample_values.join(", "):"",A=E.unique_count!==void 0&&E.unique_count!==null?`${AN(E.unique_count)} (${AN(E.unique_percentage)}%)`:"",D=w(E.missing_percentage),F=E.estimated_dummy_columns?E.estimated_dummy_columns.toLocaleString():"";return o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:E.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[E.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",E.dtype]}),E.text_category&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--category",children:E.text_category}),E.recommended_drop_first&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--info",children:"Drop first suggested"})]}),o.jsx("div",{className:"canvas-cast__column-meta",children:o.jsxs("span",{className:"canvas-cast__muted",children:["Examples: ",P]})}),o.jsx("p",{className:"canvas-cast__recommendation-note",children:E.reason})]})}),o.jsx("td",{children:A}),o.jsx("td",{children:D}),o.jsx("td",{children:F}),o.jsx("td",{children:o.jsx("span",{className:`canvas-cast__chip ${T}`,children:$})}),o.jsx("td",{children:o.jsxs("label",{className:"canvas-modal__checkbox-item",children:[o.jsx("input",{type:"checkbox",checked:k,onChange:()=>_(E.column),disabled:!E.selectable}),o.jsx("span",{className:"canvas-modal__checkbox-label",children:E.selectable?k?"In node":"Add column":"Not eligible"})]})})]},`one-hot-row-${E.column}`)})})]})}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[u&&x(u),d&&x(d),h&&x(h),p&&x(p),m&&x(m),f&&x(f)]}),l&&o.jsxs("div",{children:[o.jsx("h4",{className:"canvas-modal__subheading",children:"Manual column selection"}),x(l)]})]})},ON={fit_transform:"Fit + transform",transform:"Transform",not_applied:"Not applied",not_available:""},gI=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()},TN=e=>{if(e==null||Number.isNaN(e)||e<=0)return null;const t=Math.round(e);return`${t.toLocaleString()} row${t===1?"":"s"}`},_I=(e,t)=>Array.isArray(e.split_activity)?e.split_activity.find(s=>s&&s.split===t)??null:null,_p=(e,t)=>{const n=_I(e,t);if(!n||n.action==="not_available")return o.jsx("span",{children:""});const s=ON[n.action]??n.action,r=TN(n.rows??null);return o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{children:s}),r&&o.jsx("span",{className:"canvas-cast__muted",children:r})]})},yI=e=>{if(!Array.isArray(e.split_activity))return null;const t=e.split_activity.filter(s=>s&&!["train","test","validation"].includes(s.split));return t.length&&t.map(s=>{const r=s.label||s.split,i=ON[s.action]??s.action,l=TN(s.rows??null);return l?`${r}: ${i} (${l})`:`${r}: ${i}`}).join("; ")||null},vI=e=>!e.metadata||typeof e.metadata!="object"?null:e.metadata.method_label?String(e.metadata.method_label):e.metadata.method?String(e.metadata.method):null,xI=({signal:e,previewStatus:t,hasSource:n,hasReachableSource:s,onRefreshPreview:r})=>{const i=b.useMemo(()=>(e==null?void 0:e.transformers)??[],[e==null?void 0:e.transformers]),l=(e==null?void 0:e.total_transformers)??i.length,u=Array.isArray(e==null?void 0:e.notes)?e==null?void 0:e.notes:[],d=t==="loading",h=l?`Tracking ${l.toLocaleString()} transformer${l===1?"":"s"}.`:null,p=d||!n||!s;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Transformer activity"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,disabled:p,children:d?"Refreshing":"Refresh preview"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Review whether split-aware transformers (e.g. one-hot encoders) fit on training data and propagated to test/validation splits."}),h&&o.jsx("p",{className:"canvas-modal__note",children:h}),!n&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface transformer activity."}),n&&!s&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to an upstream branch to inspect transformer history."}),u.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:u.map((m,f)=>o.jsx("li",{children:m},`transformer-audit-note-${f}`))}),d&&o.jsx("p",{className:"canvas-modal__note",children:"Loading transformer activity"}),!d&&t==="error"&&n&&s&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:"Unable to load transformer activity. Try refreshing the preview."}),!d&&n&&s&&!i.length&&o.jsx("p",{className:"canvas-modal__note",children:"No transformer activity recorded yet. Run a preview after executing split-aware transformation nodes."}),!d&&i.length>0&&o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Node"}),o.jsx("th",{scope:"col",children:"Transformer"}),o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Method"}),o.jsx("th",{scope:"col",children:"Train"}),o.jsx("th",{scope:"col",children:"Test"}),o.jsx("th",{scope:"col",children:"Validation"}),o.jsx("th",{scope:"col",children:"Updated"})]})}),o.jsx("tbody",{children:i.map((m,f)=>{const y=m.storage_key??`${m.transformer_name}-${m.column_name??"all"}-${f}`,x=yI(m),_=m.source_node_label||m.source_node_id||"",v=gI(m.updated_at??m.created_at??null),w=m.column_name??"",M=vI(m);return o.jsxs(ve.Fragment,{children:[o.jsxs("tr",{className:"canvas-cast__row",children:[o.jsx("th",{scope:"row",children:o.jsx("div",{className:"canvas-cast__column-cell",children:o.jsx("span",{className:"canvas-cast__column-name",children:_})})}),o.jsx("td",{children:m.transformer_name}),o.jsx("td",{children:w}),o.jsx("td",{children:M||""}),o.jsx("td",{children:_p(m,"train")}),o.jsx("td",{children:_p(m,"test")}),o.jsx("td",{children:_p(m,"validation")}),o.jsx("td",{children:v})]}),x&&o.jsx("tr",{className:"canvas-cast__row canvas-cast__row--subtle",children:o.jsx("td",{colSpan:8,children:o.jsxs("span",{className:"canvas-cast__muted",children:["Additional splits: ",x]})})})]},y)})})]})})]})},bI=({parameters:e,renderParameterField:t})=>e.length===0?null:o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Data consistency settings"})}),o.jsx("div",{className:"canvas-modal__parameter-list",children:e.map(n=>t(n))})]}),yp=(e,t=5)=>e.length?e.length<=t?e.join(", "):`${e.slice(0,t).join(", ")}, ...`:"",wI=e=>{for(let t=e.length-1;t>=0;t-=1){const n=e[t];if(typeof n!="string")continue;if(n.toLowerCase().includes("feature/target split"))return n}return null},NI=(e,t)=>{if(!e.length)return null;const n=e.filter(s=>!(s!=null&&s.node_id)||s.node_id===t);return n.length?n[n.length-1]:e[e.length-1]},jI=({nodeId:e,sourceId:t,hasReachableSource:n,previewState:s,onRefreshPreview:r,config:i,targetColumnParameter:l,renderParameterField:u,formatMetricValue:d,formatMissingPercentage:h})=>{var J,G,Y,X;const p=s.data,m=s.status,f=Array.isArray(p==null?void 0:p.applied_steps)?p.applied_steps:[],y=Array.isArray(p==null?void 0:p.columns)?p==null?void 0:p.columns:[],x=Array.isArray((J=p==null?void 0:p.signals)==null?void 0:J.feature_target_split)?(G=p==null?void 0:p.signals)==null?void 0:G.feature_target_split:[],_=NI(x,e),v=(i==null?void 0:i.targetColumn)??"",w=(_==null?void 0:_.target_column)??v,M=(i==null?void 0:i.featureColumns)??[],N=b.useMemo(()=>Array.isArray(p==null?void 0:p.column_stats)?p==null?void 0:p.column_stats:[],[p==null?void 0:p.column_stats]),C=b.useMemo(()=>{const Z=new Map;return N.forEach(ee=>{ee!=null&&ee.name&&Z.set(ee.name,ee)}),Z},[N]),j=b.useMemo(()=>{var Z;return(Z=_==null?void 0:_.feature_columns)!=null&&Z.length?_.feature_columns:M.length?M:w?y.filter(ee=>ee!==w):y.slice()},[_==null?void 0:_.feature_columns,M,y,w]),E=(_==null?void 0:_.auto_included_columns)??[],k=(_==null?void 0:_.missing_feature_columns)??[],$=(_==null?void 0:_.excluded_columns)??[],T=(_==null?void 0:_.target_missing_count)??0,P=typeof(_==null?void 0:_.target_missing_percentage)=="number"?_.target_missing_percentage:null,A=(_==null?void 0:_.target_dtype)??(w?((Y=C.get(w))==null?void 0:Y.dtype)??null:null),D=typeof((X=p==null?void 0:p.metrics)==null?void 0:X.row_count)=="number"?p.metrics.row_count:null,F=j.length,R=E.length,z=$.length,q=k.length,V=b.useMemo(()=>wI(f),[f]),U=b.useMemo(()=>{const Z=[];if(Z.push({label:"Target column",value:w||"Not set"}),Z.push({label:"Feature columns",value:d(F)}),D!==null&&Z.push({label:"Preview rows",value:d(D)}),R&&Z.push({label:"Auto-selected features",value:d(R)}),q&&Z.push({label:"Configured features missing",value:d(q)}),z&&Z.push({label:"Excluded columns",value:d(z)}),T){const ee=d(T),Q=P!==null?h(P):null;Z.push({label:"Target missing values",value:Q?`${ee} (${Q})`:ee})}return Z},[R,z,F,d,h,q,D,w,T,P]),W=b.useMemo(()=>t?n?null:"Link this node to the upstream dataset to resolve feature columns.":"Connect this node to a dataset to confirm feature and target mappings.",[n,t]),B=b.useMemo(()=>!t||!n?null:m==="idle"?"Refresh the preview to surface feature/target diagnostics.":null,[n,m,t]),I=b.useMemo(()=>w?m==="success"&&w&&!y.includes(w)?`Target column "${w}" is not present in the current preview output.`:null:"Set a target column so downstream nodes understand the supervised objective.",[y,m,w]),H=!!t&&n&&m!=="loading";return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Feature/target separation"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,disabled:!H,children:m==="loading"?"Refreshing...":"Refresh preview"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Confirm which columns feed the feature matrix (X) and which column serves as the supervised target (y). This metadata helps downstream modeling nodes stay aligned with the configured training objective."}),W&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:W}),s.error&&m==="error"&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s.error}),B&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:B}),I&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:I}),q>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Missing configured feature columns: ",yp(k),"."]}),z>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Columns excluded from the feature matrix: ",yp($),"."]}),R>0&&M.length===0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--info",children:["Auto-selected feature columns: ",yp(E),"."]}),V&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:V}),U.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:U.map(Z=>o.jsxs("li",{children:[Z.label,": ",o.jsx("strong",{children:Z.value})]},`feature-target-summary-${Z.label}`))}),o.jsx("div",{className:"canvas-modal__parameter-grid",children:l&&u(l)}),m==="success"&&F===0&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"No feature columns detected. Confirm that the dataset includes columns other than the target."}),w&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Target dtype: ",A?o.jsx("strong",{children:A}):o.jsx("span",{children:"Unknown"}),T?` - Missing rows flagged for review: ${d(T)}.`:""]})]})},CI=(e,t)=>{if(!e.length)return null;const n=e.filter(s=>!(s!=null&&s.node_id)||s.node_id===t);return n.length?n[n.length-1]:e[e.length-1]},Qr=e=>`${(e*100).toFixed(1)}%`,SI=({nodeId:e,sourceId:t,hasReachableSource:n,previewState:s,onRefreshPreview:r,config:i,parameters:l,renderParameterField:u,formatMetricValue:d})=>{var P,A;const h=s.data,p=s.status,m=Array.isArray((P=h==null?void 0:h.signals)==null?void 0:P.train_test_split)?(A=h==null?void 0:h.signals)==null?void 0:A.train_test_split:[],f=CI(m,e),y=(i==null?void 0:i.test_size)??.2,x=(i==null?void 0:i.validation_size)??0,_=i==null?void 0:i.random_state;i==null||i.shuffle;const v=(i==null?void 0:i.stratify)??!1,w=(i==null?void 0:i.target_column)??"",M=x>0,N=b.useMemo(()=>f?{trainSize:f.train_size??0,validationSize:f.validation_size??0,testSize:f.test_size??0,totalSize:f.total_size??0,trainRatio:f.train_size&&f.total_size?f.train_size/f.total_size:0,validationRatio:f.validation_ratio??0,testRatio:f.test_ratio??0}:{trainSize:0,validationSize:0,testSize:0,totalSize:0,trainRatio:1-y-x,validationRatio:x,testRatio:y},[f,y,x]),C=l.find(D=>D.name==="test_size"),j=l.find(D=>D.name==="validation_size"),E=l.find(D=>D.name==="random_state"),k=l.find(D=>D.name==="shuffle"),$=l.find(D=>D.name==="stratify"),T=l.find(D=>D.name==="target_column");return o.jsxs("div",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Train/Test Split Configuration"})}),o.jsxs("div",{className:"node-settings__field-group",children:[C&&u(C),j&&u(j),E&&u(E),k&&u(k),$&&u($),v&&T&&u(T)]}),p==="success"&&f&&o.jsxs("div",{className:"node-settings__info-panel",children:[o.jsx("h4",{className:"node-settings__info-title",children:"Split Summary"}),o.jsx("div",{className:"node-settings__split-visualization",children:o.jsxs("div",{className:"split-bar",children:[o.jsx("div",{className:"split-bar__segment split-bar__segment--train",style:{width:Qr(N.trainRatio)},title:`Training: ${N.trainSize} rows (${Qr(N.trainRatio)})`,children:o.jsx("span",{className:"split-bar__label",children:"Train"})}),M&&o.jsx("div",{className:"split-bar__segment split-bar__segment--validation",style:{width:Qr(N.validationRatio)},title:`Validation: ${N.validationSize} rows (${Qr(N.validationRatio)})`,children:o.jsx("span",{className:"split-bar__label",children:"Val"})}),o.jsx("div",{className:"split-bar__segment split-bar__segment--test",style:{width:Qr(N.testRatio)},title:`Test: ${N.testSize} rows (${Qr(N.testRatio)})`,children:o.jsx("span",{className:"split-bar__label",children:"Test"})})]})}),o.jsxs("div",{className:"node-settings__stats-grid",children:[o.jsxs("div",{className:"node-settings__stat-item",children:[o.jsx("span",{className:"node-settings__stat-label",children:"Total rows:"}),o.jsx("span",{className:"node-settings__stat-value",children:d(N.totalSize,0)})]}),o.jsxs("div",{className:"node-settings__stat-item",children:[o.jsx("span",{className:"node-settings__stat-label",children:"Training:"}),o.jsxs("span",{className:"node-settings__stat-value",children:[d(N.trainSize,0)," (",Qr(N.trainRatio),")"]})]}),M&&o.jsxs("div",{className:"node-settings__stat-item",children:[o.jsx("span",{className:"node-settings__stat-label",children:"Validation:"}),o.jsxs("span",{className:"node-settings__stat-value",children:[d(N.validationSize,0)," (",Qr(N.validationRatio),")"]})]}),o.jsxs("div",{className:"node-settings__stat-item",children:[o.jsx("span",{className:"node-settings__stat-label",children:"Test:"}),o.jsxs("span",{className:"node-settings__stat-value",children:[d(N.testSize,0)," (",Qr(N.testRatio),")"]})]}),v&&w&&o.jsxs("div",{className:"node-settings__stat-item",children:[o.jsx("span",{className:"node-settings__stat-label",children:"Stratified by:"}),o.jsx("span",{className:"node-settings__stat-value",children:w})]}),_!==void 0&&o.jsxs("div",{className:"node-settings__stat-item",children:[o.jsx("span",{className:"node-settings__stat-label",children:"Random state:"}),o.jsx("span",{className:"node-settings__stat-value",children:_})]})]})]}),!n&&o.jsxs("div",{className:"node-settings__warning",children:[o.jsx("span",{className:"node-settings__warning-icon",children:""}),"Connect this node to a data source to configure the split."]}),p==="loading"&&o.jsx("div",{className:"node-settings__loading",children:"Loading preview..."}),p==="error"&&o.jsxs("div",{className:"node-settings__error",children:[o.jsx("span",{className:"node-settings__error-icon",children:""}),"Failed to load preview. Try refreshing."]})]})},EI={classification:"Classification",regression:"Regression"},MI=e=>e==="numeric"||e==="integer",kI=e=>{if(!e)return!1;const t=e.toLowerCase();return t.includes("int")||t.includes("float")||t.includes("double")||t.includes("decimal")||t.includes("number")},vp=(e,t=3)=>e.length===0?"":e.length<=t?e.join(", "):`${e.slice(0,t).join(", ")}, ...`,AI=e=>{for(let t=e.length-1;t>=0;t-=1){const n=e[t];if(typeof n=="string"&&n.toLowerCase().startsWith("train model draft"))return n}return null},OI=({sourceId:e,hasReachableSource:t,previewState:n,onRefreshPreview:s,config:r,targetColumnParameter:i,problemTypeParameter:l,renderParameterField:u,formatMetricValue:d,formatMissingPercentage:h,schemaColumns:p})=>{var Y;const m=n.data,f=n.status,y=Array.isArray(m==null?void 0:m.applied_steps)?m.applied_steps:[],x=Array.isArray(m==null?void 0:m.column_stats)?m.column_stats:[],_=(m==null?void 0:m.metrics)??null,v=b.useMemo(()=>Array.isArray(m==null?void 0:m.columns)?m.columns.filter(X=>typeof X=="string"&&X.trim().length>0):[],[m==null?void 0:m.columns]),w=b.useMemo(()=>{var X;return p.length?p:Array.isArray((X=m==null?void 0:m.schema)==null?void 0:X.columns)?m.schema.columns:v.length>0?v.map(Z=>({name:Z,pandas_dtype:null,logical_family:"unknown",nullable:!0})):[]},[(Y=m==null?void 0:m.schema)==null?void 0:Y.columns,v,p]),M=b.useMemo(()=>{const X=new Map;return w.forEach(Z=>{Z!=null&&Z.name&&X.set(Z.name,Z)}),X},[w]),N=(r==null?void 0:r.targetColumn)??"",C=(r==null?void 0:r.problemType)??"classification",j=N?x.find(X=>(X==null?void 0:X.name)===N)??null:null,k=!!(N?M.get(N)??null:null),$=b.useMemo(()=>{const X=new Set;return x.forEach(Z=>{Z!=null&&Z.name&&Z.name!==N&&X.add(Z.name)}),w.forEach(Z=>{Z!=null&&Z.name&&Z.name!==N&&X.add(Z.name)}),Array.from(X).sort()},[x,w,N]),T=b.useMemo(()=>$.filter(X=>{const Z=M.get(X);if(Z&&MI(Z.logical_family))return!0;const ee=x.find(Q=>Q.name===X);return kI((ee==null?void 0:ee.dtype)??null)}),[x,$,M]),P=b.useMemo(()=>new Set(T),[T]),A=b.useMemo(()=>$.filter(X=>!P.has(X)),[$,P]),D=b.useMemo(()=>x.filter(X=>(X==null?void 0:X.name)&&X.name!==N&&(X.missing_count??0)>0).map(X=>X.name),[x,N]),F=typeof(_==null?void 0:_.row_count)=="number"?_.row_count:null,R=typeof(j==null?void 0:j.distinct_count)=="number"&&Number.isFinite(j.distinct_count)?j.distinct_count:null,z=typeof(j==null?void 0:j.missing_count)=="number"?j.missing_count:0,q=typeof(j==null?void 0:j.missing_percentage)=="number"?j.missing_percentage:null,V=b.useMemo(()=>{const X=[];return N?f!=="success"?X:!j&&!k&&!$.length?(X.push(`Target column "${N}" is not present in the preview output, and no feature columns were found.`),X):($.length||X.push("Add at least one feature column in addition to the target before training."),j&&z>0&&X.push(`Target column includes ${z} missing value${z===1?"":"s"}.`),C==="classification"&&j&&(R??0)<2&&X.push("Classification tasks require at least two distinct target classes."),C==="regression"&&T.length===0&&X.push("Regression tasks need at least one numeric feature column."),D.length>0&&X.push(`Feature columns with missing values: ${vp(D)}.`),F!==null&&F===0&&X.push("Preview returned zero rows after upstream transformations."),X):(X.push("Set a target column to evaluate downstream modeling constraints."),X)},[D,$.length,z,T.length,F,f,C,N,R,j,k]),U=b.useMemo(()=>EI[C],[C]),W=b.useMemo(()=>{const X=[{label:"Problem type",value:U},{label:"Target column",value:N||"Not set"}];if(f==="success"){if(R!==null&&X.push({label:"Target distinct values",value:d(R)}),j){const Z=d(z),ee=q!==null?h(q):null;X.push({label:"Target missing values",value:ee?`${Z} (${ee})`:Z})}D.length>0&&X.push({label:"Features with missing values",value:d(D.length)})}return X},[U,D.length,d,h,z,f,N,R,q,j]),B=b.useMemo(()=>e?t?null:"Link this node to upstream transforms to analyse the feature set that reaches it.":"Connect this node to a dataset to validate training readiness.",[t,e]),I=b.useMemo(()=>!e||!t?null:f==="idle"?"Refresh the preview to surface downstream modeling checks.":null,[t,f,e]),H=b.useMemo(()=>AI(y),[y]),J=!!e&&t&&f!=="loading",G=b.useMemo(()=>!N||f!=="success"||V.length>0?null:"No critical blockers detected in the preview. Proceed with downstream training when ready.",[f,V.length,N]);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Train model readiness"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:s,disabled:!J,children:f==="loading"?"Refreshing":"Refresh preview"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Validate that the pipeline output is ready for lightweight training by checking the target column, feature balance, and missing values against the cached preview."}),B&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:B}),n.error&&f==="error"&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:n.error}),I&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:I}),V.map((X,Z)=>o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:X},`train-model-issue-${Z}`)),G&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:G}),H&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:H}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[i&&u(i),l&&u(l)]}),W.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:W.map(X=>o.jsxs("li",{children:[X.label,": ",o.jsx("strong",{children:X.value})]},`train-model-summary-${X.label}`))}),f==="success"&&D.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Features with missing values: ",vp(D),"."]}),f==="success"&&C==="regression"&&A.length>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Non-numeric features detected: ",vp(A),". Consider encoding or casting them before training regression models."]})]})},$N=e=>{if(e==null)return"";if(typeof e=="number")return Number.isFinite(e)?Ws(e,Math.abs(e)>=1?2:4):String(e);if(typeof e=="string")return e;if(typeof e=="boolean")return e?"True":"False";if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.length?JSON.stringify(e):"[]";if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},TI=e=>e||"Unknown",$I=e=>{if(!e)return null;let t=e.trim();if(!t)return null;/^\d{4}-\d{2}-\d{2}\s+\d/.test(t)&&(t=t.replace(" ","T")),/(Z|z|[+-]\d{2}:?\d{2})$/.test(t)||(t=`${t}Z`);const n=new Date(t);return Number.isNaN(n.getTime())?null:n},Yn=e=>{const t=$I(e);if(!t)return null;const n=Math.round((Date.now()-t.getTime())/6e4);if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;const s=Math.round(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;const r=Math.round(s/24);return r===1?"1 day ago":`${r} days ago`},PN=e=>typeof e!="number"||!Number.isFinite(e)?"":Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3),PI=({presets:e,isOpen:t,onClose:n,onApply:s,activePresetId:r,fieldMetadata:i})=>{const[l,u]=b.useState(null);b.useEffect(()=>{var m;if(!t){u(null);return}l&&e.some(f=>f.id===l)||u(((m=e[0])==null?void 0:m.id)??null)},[t,e,l]),b.useEffect(()=>{if(!t)return;const m=f=>{f.key==="Escape"&&n()};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[t,n]);const d=b.useMemo(()=>l?e.find(m=>m.id===l)??e[0]??null:e[0]??null,[e,l]),h=b.useMemo(()=>!r||!d?!1:r===d.id,[r,d]),p=b.useMemo(()=>{var v,w;if(!t||!e.length)return null;const m=((v=d==null?void 0:d.modelType)==null?void 0:v.toLowerCase())==="logistic_regression"?(w=d==null?void 0:d.params)==null?void 0:w.solver:null,f=typeof m=="string"?m.trim().toLowerCase():null,y=f&&(f==="sag"||f==="saga")?"SAG and SAGA solvers expect standardized features. Scale inputs before training to improve convergence and avoid repeated warnings.":null,x=d?Object.entries(d.params??{}).sort(([M],[N])=>M.localeCompare(N)).map(([M,N])=>{const C=i==null?void 0:i[M],j=A=>{var D;return(D=C==null?void 0:C.options)!=null&&D.length?C.options.find(F=>{const R=F.value;return A==null?R===null||typeof R=="string"&&R.trim().toLowerCase()==="none":typeof A=="string"&&typeof R=="string"?R===A?!0:R.trim().toLowerCase()===A.trim().toLowerCase():String(R)===String(A)})??null:null},E=A=>{if(A===null)return C!=null&&C.nullable?"None":"";if(A===void 0)return"";if(typeof A=="boolean")return A?"true":"false";if(typeof A=="number")return Number.isFinite(A)?A.toString():String(A);if(A&&typeof A=="object")try{return JSON.stringify(A)}catch{return"[object]"}return String(A??"")},k=A=>{var z;if(!A)return null;const D=A.value,F=(z=A.label)==null?void 0:z.trim(),R=E(D);return F&&R&&F!==R?`${F} (${R})`:F||R},$=()=>{if(C&&C.default!==void 0){const A=T(C.default,!1);if(A.text)return{text:A.text,note:"Using estimator default"}}return{text:"",note:"Using estimator default"}},T=(A,D=!0)=>{const F=j(A);return F?{text:k(F)??"",note:null}:Array.isArray(A)?A.length===0?D?$():{text:"",note:null}:{text:A.map(z=>T(z,!1)).map(z=>z.text).filter(Boolean).join(", "),note:null}:A===void 0||typeof A=="string"&&A.trim()===""?D?$():{text:"",note:null}:A===null?C!=null&&C.nullable?{text:"None",note:null}:D?$():{text:"",note:null}:{text:E(A),note:null}},P=T(N);return{key:M,label:(C==null?void 0:C.label)??M,description:(C==null?void 0:C.description)??null,value:P.text,note:P.note}}):[],_=d!=null&&d.finishedAt?Yn(d.finishedAt):null;return o.jsxs("div",{className:"canvas-modal best-param-modal",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"canvas-modal__backdrop",onClick:n}),o.jsxs("div",{className:"canvas-modal__panel best-param-modal__panel",role:"document",children:[o.jsxs("header",{className:"best-param-modal__header",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"best-param-modal__title",children:"Tuned Hyperparameter Presets"}),o.jsx("p",{className:"best-param-modal__subtitle",children:"Review hyperparameter sets discovered by recent tuning runs and apply them to the current model."})]}),o.jsx("button",{type:"button",className:"best-param-modal__close",onClick:n,children:"Close"})]}),o.jsxs("div",{className:"best-param-modal__layout",children:[o.jsx("aside",{className:"best-param-modal__list","aria-label":"Tuned presets",children:e.map(M=>{const N=M.id===(d==null?void 0:d.id),C=M.finishedAt?Yn(M.finishedAt):null;return o.jsxs("button",{type:"button",className:`best-param-modal__list-button${N?" best-param-modal__list-button--active":""}`,onClick:()=>u(M.id),children:[o.jsx("span",{className:"best-param-modal__list-title",children:M.label}),o.jsxs("span",{className:"best-param-modal__list-meta",children:[M.runNumber?`Run ${M.runNumber}`:"Tuning run",C?`  ${C}`:""]}),M.scoring&&o.jsxs("span",{className:"best-param-modal__list-score",children:[M.scoring,": ",PN(M.score)]}),M.targetColumn&&o.jsxs("span",{className:"best-param-modal__list-target",children:["Target: ",M.targetColumn]})]},M.id)})}),o.jsx("section",{className:"best-param-modal__details",children:d?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"best-param-modal__summary",children:[o.jsxs("div",{className:"best-param-modal__summary-main",children:[o.jsx("h4",{children:d.label}),o.jsxs("p",{children:[d.runNumber?`Run ${d.runNumber}`:"Tuning run",_?`  ${_}`:"",d.searchStrategy?`  ${d.searchStrategy}`:""]}),o.jsxs("p",{children:["Model: ",o.jsx("strong",{children:d.modelType}),d.targetColumn?o.jsxs(o.Fragment,{children:[" "," Target: ",o.jsx("strong",{children:d.targetColumn})]}):null,d.scoring?o.jsxs(o.Fragment,{children:[" "," ",d.scoring,": ",o.jsx("strong",{children:PN(d.score)})]}):null]})]}),o.jsx("div",{className:"best-param-modal__summary-actions",children:o.jsx("button",{type:"button",className:"best-param-modal__apply",onClick:()=>s(d),disabled:!x.length,children:h?"Already applied":"Apply preset"})})]}),d.description&&o.jsx("p",{className:"best-param-modal__note",children:d.description}),y&&o.jsxs("div",{className:"best-param-modal__notice best-param-modal__notice--warning",children:[o.jsx("strong",{children:"Tip:"})," ",y]}),o.jsx("div",{className:"best-param-modal__param-grid",role:"table",children:x.length?x.map(M=>o.jsxs("div",{className:"best-param-modal__param-row",role:"row",children:[o.jsxs("div",{className:"best-param-modal__param-name",role:"cell",children:[o.jsxs("div",{className:"best-param-modal__param-label",children:[M.label,M.label!==M.key&&o.jsx("span",{className:"best-param-modal__param-key",children:o.jsx("code",{children:M.key})})]}),M.description&&o.jsx("div",{className:"best-param-modal__param-description",children:M.description})]}),o.jsxs("div",{className:"best-param-modal__param-value",role:"cell",children:[o.jsx("code",{children:M.value}),M.note&&o.jsx("span",{className:"best-param-modal__param-note",children:M.note})]})]},M.key)):o.jsx("p",{className:"best-param-modal__empty",children:"No hyperparameters available for this preset."})})]}):o.jsx("p",{className:"best-param-modal__empty",children:"Select a tuning run to inspect its hyperparameters."})})]})]})]})},[r,h,i,t,s,n,e,d]);return p?I_.createPortal(p,document.body):null},LI=new Set(["scale_numeric_features","scaling","scale_numeric"]),RI=[/convergencewarning/i,/failed to converge/i,/did not converge/i,/optimizer failed to converge/i,/increase the number of iterations/i,/scale your features/i,/standardize your features/i,/consider scaling your (data|features)/i,/feature scaling is (recommended|required)/i],DI=["forest","tree","boost","xgboost","lightgbm","catboost","gradient","histgradient","bagging"],zI=["bayes","naive_bayes","gaussian_nb"],II=e=>{const t=e.trim().toLowerCase();return t?DI.some(s=>t.includes(s))?{required:!1,reason:null}:zI.some(s=>t.includes(s))?{required:!1,reason:null}:t.includes("logistic")?{required:!0,reason:"logistic"}:t.includes("svm")||t.includes("svc")||t.includes("svr")?{required:!0,reason:"svm"}:t.includes("knn")||t.includes("nearest")?{required:!0,reason:"knn"}:t.includes("sgd")||t.includes("perceptron")?{required:!0,reason:"sgd"}:["linear","ridge","lasso","elastic","regression"].some(s=>t.includes(s))?{required:!0,reason:"linear"}:{required:!1,reason:null}:{required:!1,reason:null}},FI=(e,t)=>{const n=new Set;if(!e||!t)return n;const s=Array.isArray(e.edges)?e.edges:[],r=[t];for(;r.length;){const i=r.pop();if(i)for(const l of s){if(!l)continue;const u=typeof l.source=="string"?l.source.trim():"",d=typeof l.target=="string"?l.target.trim():"";!u||!d||d===i&&!n.has(u)&&(n.add(u),r.push(u))}}return n},BI=(e,t)=>{if(!e||!t)return!1;const n=FI(e,t);return n.size?(Array.isArray(e.nodes)?e.nodes:[]).some(r=>{var l;if(!r||typeof r.id!="string"||!n.has(r.id))return!1;const i=String(((l=r==null?void 0:r.data)==null?void 0:l.catalogType)??(r==null?void 0:r.type)??"").toLowerCase();return i?LI.has(i)?!0:i.includes("scale")&&i.includes("numeric"):!1}):!1},UI=(e,t)=>{const n=t.find(s=>(s==null?void 0:s.value)===e);return n!=null&&n.label?n.label:e.replace(/_/g," ").replace(/\s+/g," ").trim()},xp=(e,t=new Set,n=0)=>{if(e==null)return[];if(typeof e=="string")return[e];if(typeof e=="number"||typeof e=="boolean")return[];if(n>3)return[];if(Array.isArray(e)){if(!e.length)return[];const s=32,r=[];for(let i=0;i<e.length&&i<s;i+=1)r.push(...xp(e[i],t,n+1));return r}if(typeof e=="object"){if(t.has(e))return[];t.add(e);const s=Object.values(e);if(!s.length)return[];const r=32,i=[];for(let l=0;l<s.length&&l<r;l+=1)i.push(...xp(s[l],t,n+1));return i}return[]},Xi=e=>{if(!e)return!1;const t=xp(e);return t.length?t.some(n=>RI.some(s=>s.test(n))):!1},Sc=e=>{var n,s,r,i,l,u,d,h,p,m,f,y,x,_;if(!e)return!1;const t=[e.error_message,e.warning_message,e.message,e.details,e.notes,e.status_reason,e.status_message,e.error,(n=e.metadata)==null?void 0:n.warnings,(s=e.metadata)==null?void 0:s.warning,(r=e.metadata)==null?void 0:r.notes,(i=e.metadata)==null?void 0:i.messages,(l=e.metadata)==null?void 0:l.message,(u=e.metadata)==null?void 0:u.errors,(d=e.metrics)==null?void 0:d.warnings,(h=e.metrics)==null?void 0:h.warning,(p=e.metrics)==null?void 0:p.messages,(m=e.metrics)==null?void 0:m.message,(f=e.job_metadata)==null?void 0:f.warnings,(y=e.job_metadata)==null?void 0:y.warning,(x=e.job_metadata)==null?void 0:x.messages,(_=e.job_metadata)==null?void 0:_.notes];for(const v of t)if(Xi(v))return!0;return!!(Xi(e.metadata)||Xi(e.metrics))},HI=(e,t,n)=>{const s=t||"This model";switch(e){case"logistic":return{headline:`${s} needs scaled numeric features`,summary:'Standardize numeric inputs before launching jobs to keep the logistic solver stable and avoid repeated "scale your features" warnings.',details:["Insert a Scale numeric features step before this node or reuse an upstream scaler.","StandardScaler works for most datasets; RobustScaler can help when outliers dominate.","Once scaling is in place, re-run tuning or training so the solver converges cleanly."]};case"svm":return{headline:`${s} is sensitive to feature scale`,summary:"Support Vector Machines depend on distance calculations. Keep numeric features on comparable scales to preserve margin geometry.",details:["Add the Scale numeric features step upstream of this node.","Try StandardScaler or MinMaxScaler depending on the kernel and expected ranges.","Retrain after scaling to refresh support vectors and hyperparameters."]};case"knn":return{headline:`${s} uses distance-based comparisons`,summary:"k-NN models weigh distances directly, so unscaled columns dominate neighbors. Scale numeric fields to keep votes balanced.",details:["Drop in a Scale numeric features step before launching jobs.","MinMaxScaler keeps features in [0, 1]; StandardScaler works when values are roughly normal.","Requeue jobs after scaling so neighbor search reflects the new feature space."]};case"sgd":return{headline:`${s} benefits from normalized inputs`,summary:"Stochastic gradient models converge faster and produce steadier coefficients when numeric inputs share a common scale.",details:["Insert a Scale numeric features node prior to this step.","StandardScaler plus optional RobustScaler for heavy-tailed features keeps gradients stable.","Re-run jobs after scaling to avoid exploding or vanishing updates."]};default:return{headline:`${s} prefers standardized numeric features`,summary:n==="regression"?"Linear regression families rely on comparable feature magnitudes. Scaling keeps coefficients well-conditioned and improves R stability.":"Linear classification models respond better when numeric inputs share a common scale. Scaling prevents any single column from dominating the loss.",details:["Add the Scale numeric features step ahead of this node or reuse an existing scaler.","StandardScaler is a safe default; RobustScaler helps when outliers skew distributions.","Re-launch jobs once scaling is applied so coefficients represent the standardized space."]}}},LN=({graph:e,nodeId:t,modelType:n,problemType:s,modelTypeOptions:r,enabled:i})=>b.useMemo(()=>{if(!i||!n||!n.trim()||BI(e,t))return null;const l=n.trim().toLowerCase(),{required:u,reason:d}=II(l);if(!u||!d)return null;const h=UI(n,r);return HI(d,h,s)},[i,e,n,r,t,s]),qI={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},Qi={classification:["accuracy","f1_weighted","roc_auc","precision_weighted","recall_weighted"],regression:["rmse","mae","r2"],fallback:["rmse","mae","r2","accuracy","f1_weighted","roc_auc"]},bp=(e,t)=>{if(!e)return{};const n={};return Object.entries(e).forEach(([s,r])=>{t.has(s)&&(n[s]=r)}),n},RN=(e,t)=>{if(e===t||typeof e=="number"&&typeof t=="number"&&Number.isNaN(e)&&Number.isNaN(t))return!0;if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?!1:e.every((n,s)=>RN(n,t[s]));if(e&&t&&typeof e=="object"&&typeof t=="object")try{return JSON.stringify(e)===JSON.stringify(t)}catch{return!1}return!1},VI=(e,t,n)=>{if(!e)return{};const s={};return Object.entries(e).forEach(([r,i])=>{if(!t.has(r)||i===""||i===null||i===void 0)return;const l=n==null?void 0:n[r];let u=i;if(l){if(typeof u=="string"){const d=u.trim();if(!d)return;l.type==="select"&&(u=d)}if(l.name==="multi_class"&&typeof u=="string"){const d=u.trim().toLowerCase();if(d==="auto")return;(d==="ovr"||d==="multinomial")&&(u=d)}if(l.default!==void 0){if(typeof l.default=="string"&&typeof u=="string"){const d=l.default.trim(),h=u.trim();if(d===h)return}else if(RN(l.default,u))return}}s[r]=u}),s},DN=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Ec=e=>{try{return JSON.parse(JSON.stringify(e))}catch{return e}},WI=e=>{if(!e)return Qi.fallback;const t=String(e.model_type??e.modelType??"").toLowerCase();if(t.includes("regressor"))return Qi.regression;if(t.includes("classifier")||t.includes("classification"))return Qi.classification;const n=String(e.problem_type??e.problemType??"").toLowerCase();return n==="regression"?Qi.regression:n==="classification"?Qi.classification:Qi.fallback},YI=e=>{var i,l,u;if(!e)return null;const t=[],n=(l=(i=e==null?void 0:e.cross_validation)==null?void 0:i.metrics)==null?void 0:l.mean;DN(n)&&((u=e==null?void 0:e.cross_validation)==null?void 0:u.status)==="completed"&&t.push({dataset:n,labelPrefix:"CV mean "});const s=[e.test,e.validation,e.train];for(const d of s)DN(d)&&t.push({dataset:d,labelPrefix:""});const r=WI(e);for(const d of t)for(const h of r){const p=d.dataset[h];if(typeof p=="number"&&Number.isFinite(p))return{label:d.labelPrefix?`${d.labelPrefix}${h}`:h,value:p}}for(const d of t)for(const[h,p]of Object.entries(d.dataset))if(typeof p=="number"&&Number.isFinite(p))return{label:d.labelPrefix?`${d.labelPrefix}${h}`:h,value:p};return null},zN=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",KI=({nodeId:e,sourceId:t,graph:n,config:s,runtimeConfig:r,cvConfig:i,draftConfigState:l,renderParameterField:u,modelTypeParameter:d,modelTypeOptions:h,hyperparametersParameter:p,cvEnabledParameter:m,cvStrategyParameter:f,cvFoldsParameter:y,cvShuffleParameter:x,cvRandomStateParameter:_,cvRefitStrategyParameter:v,onSaveDraftConfig:w})=>{var Ln,Cs,Jn,Ss;const M=Eo(),[N,C]=b.useState(null),[j,E]=b.useState(null),[k,$]=b.useState(null),[T,P]=b.useState(0),[A,D]=b.useState({}),[F,R]=b.useState(!1),z=b.useRef(!1),[q,V]=b.useState(null),[U,W]=b.useState(!1),[B,I]=b.useState(!1),[H,J]=b.useState(null),[G,Y]=b.useState(null),[X,Z]=b.useState(!1),ee=((s==null?void 0:s.targetColumn)??"").trim(),Q=(s==null?void 0:s.problemType)==="regression"?"regression":"classification",ne=((r==null?void 0:r.modelType)??"").trim(),he=(r==null?void 0:r.hyperparameters)??null,ye=(r==null?void 0:r.hyperparametersError)??null,ge=!!(i!=null&&i.enabled),Ee=(i==null?void 0:i.strategy)??"auto",De=typeof(i==null?void 0:i.folds)=="number"?i.folds:0,ke=!!(i!=null&&i.shuffle),le=(i==null?void 0:i.randomState)??null,pe=(i==null?void 0:i.refitStrategy)??"train_plus_validation",be=b.useMemo(()=>d?h.length?{...d,options:h}:d:null,[h,d]),Te=Ts({queryKey:["model-hyperparameters",ne],queryFn:()=>Cd(ne),enabled:!!ne,staleTime:5*60*1e3}),Ie=Ts({queryKey:["best-hyperparameters",ne,q,t],queryFn:()=>lw(ne,{pipelineId:q||void 0,datasetSourceId:t||void 0}),enabled:!!(ne&&t),staleTime:30*1e3,retry:1}),ue=((Ln=Te.data)==null?void 0:Ln.fields)??[],$e=((Cs=Te.data)==null?void 0:Cs.defaults)??{},Ye=b.useMemo(()=>ue.length?new Set(ue.map(ie=>ie.name)):new Set,[ue]),et=b.useMemo(()=>ue.length?ue.reduce((ie,xe)=>(xe!=null&&xe.name&&(ie[xe.name]=xe),ie),{}):{},[ue]),We=b.useMemo(()=>{if(!ne||!he||Ye.size===0)return null;const ie=bp(he,Ye);return Object.keys(ie).length>0?ie:null},[Ye,he,ne]);b.useEffect(()=>{D({}),R(!1),z.current=!1},[ne]),b.useEffect(()=>{We&&(D(ie=>{const xe=Object.keys(ie),Le=Object.keys(We);return xe.length===Le.length&&Le.every(Ce=>Object.is(ie[Ce],We[Ce]))?ie:We}),z.current||(R(!0),z.current=!0))},[We]),b.useEffect(()=>{if(!ne||We||Ye.size===0||!$e||Object.keys($e).length===0)return;const ie=bp($e,Ye);Object.keys(ie).length!==0&&D(xe=>Object.keys(xe).length>0?xe:ie)},[Ye,We,$e,ne]);const mt=b.useMemo(()=>{if(Ye.size===0)return null;const ie=VI(A,Ye,et);return Object.keys(ie).length>0?ie:null},[Ye,A]),rt=b.useCallback(()=>{R(ie=>{const xe=!ie;return xe&&(z.current=!0),xe})},[]),ft=b.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),bt=b.useMemo(()=>{if(!ft)return null;if(!l||Object.keys(l).length===0)return ft;const ie=Ec(ft);return!ie||!Array.isArray(ie.nodes)||(ie.nodes=ie.nodes.map(xe=>{if(!xe||xe.id!==e)return xe;const Le=(xe==null?void 0:xe.data)??{},Ce={...(Le==null?void 0:Le.config)??{},...l};return{...xe,data:{...Le,config:Ce,isConfigured:!0}}})),ie},[l,ft,e]);b.useEffect(()=>{let ie=!1;return!t||!ft?(V(null),()=>{ie=!0}):(zo(t,ft).then(xe=>{ie||V(xe)}).catch(()=>{ie||V(null)}),()=>{ie=!0})},[ft,t]),b.useEffect(()=>{let ie=!1;E(null);const xe=bt??ft;return!t||!xe?(C(null),()=>{ie=!0}):(zo(t,xe).then(Le=>{ie||C(Le)}).catch(Le=>{ie||(E((Le==null?void 0:Le.message)??"Unable to compute pipeline ID"),C(null))}),()=>{ie=!0})},[ft,bt,t]),b.useEffect(()=>{if(!N||!q){W(!1);return}W(N!==q)},[N,q]);const zt=b.useMemo(()=>["feature-canvas","training-jobs",t??"none",N??"pending",e],[e,N,t]),Xe=b.useMemo(()=>["feature-canvas","tuning-jobs",t??"none",N??"pending",e],[e,N,t]),Ft=!!(t&&e),Kt=Ts({queryKey:Xe,queryFn:async()=>{var xe;const ie={datasetSourceId:t||void 0,limit:5};if(N){const Le=await pc({...ie,pipelineId:N});if((((xe=Le==null?void 0:Le.jobs)==null?void 0:xe.length)??0)>0)return Le}return pc(ie)},enabled:Ft,retry:(ie,xe)=>xe.message.includes("Sign in")?!1:ie<2,refetchInterval:ie=>{const xe=ie.state.data;return((xe==null?void 0:xe.jobs)??[]).some(Ce=>Ce.status==="queued"||Ce.status==="running")?5e3:!1}}),Et=Ts({queryKey:zt,queryFn:async()=>{var xe;const ie={datasetSourceId:t||void 0,nodeId:e,limit:5};if(N){const Le=await hc({...ie,pipelineId:N});if((((xe=Le==null?void 0:Le.jobs)==null?void 0:xe.length)??0)>0)return Le}return hc(ie)},enabled:Ft,retry:(ie,xe)=>xe.message.includes("Sign in")?!1:ie<2,refetchInterval:ie=>{const xe=ie.state.data;return((xe==null?void 0:xe.jobs)??[]).some(Ce=>Ce.status==="queued"||Ce.status==="running")?5e3:!1}}),{mutateAsync:Qt,isPending:wn,error:Mt}=Cu({mutationFn:rw,onSuccess:ie=>{const xe=Array.isArray(ie.jobs)?ie.jobs.length:0,Le=xe>0?ie.jobs[0]:null;$(Le),P(xe),M.invalidateQueries({queryKey:zt})}}),Zt=Kt.error,Nn=Kt.isLoading||Kt.isFetching,Bt=((Jn=Kt.data)==null?void 0:Jn.jobs)??[],dt=Ie.data,Tn=b.useCallback(ie=>{if(!ie)return null;const xe=Object.keys(ie);if(xe.length===0)return null;if(Ye.size===0)return{params:ie,hasUnmapped:!1};const Le=bp(ie,Ye),jt=Object.keys(Le);return jt.length>0?{params:Le,hasUnmapped:jt.length!==xe.length}:{params:ie,hasUnmapped:!0}},[Ye]),Xt=b.useMemo(()=>Bt.length?Bt.filter(ie=>ie.status==="succeeded"):[],[Bt]),Nt=b.useMemo(()=>{if(!ne)return[];const ie=[],xe=new Set,Le=ee?ee.trim().toLowerCase():"",jt=Ce=>!Le||!Ce?!0:Ce.trim().toLowerCase()===Le;if(dt!=null&&dt.available&&dt.best_params&&(!dt.model_type||dt.model_type===ne)){const Ce=Tn(dt.best_params);if(Ce){const ot=dt.job_id??null;if(!ot||!xe.has(ot)){const lt=["Most recent tuned run"];dt.run_number&&lt.push(`#${dt.run_number}`);const Rt=`best-api-${ot??ne}`;ie.push({id:Rt,label:lt.join(" "),source:"best-api",modelType:dt.model_type??ne,params:Ce.params,jobId:ot,nodeId:dt.node_id??null,runNumber:dt.run_number??null,score:dt.best_score??null,scoring:dt.scoring??null,finishedAt:dt.finished_at??null,searchStrategy:dt.search_strategy??null,nIterations:dt.n_iterations??null,targetColumn:ee||null,pipelineId:dt.pipeline_id??null,datasetSourceId:t??null,description:Ce.hasUnmapped?"Includes parameters outside the current template. They will be stored as custom overrides.":null}),ot&&xe.add(ot)}}}return Xt.forEach(Ce=>{var sn,ls,Cn,en,rn;if(!Ce.best_params||Ce.model_type!==ne||t&&Ce.dataset_source_id&&Ce.dataset_source_id!==t||xe.has(Ce.id))return;const ot=Tn(Ce.best_params);if(!ot)return;const lt=typeof((sn=Ce.metadata)==null?void 0:sn.target_column)=="string"?Ce.metadata.target_column:typeof((ls=Ce.metadata)==null?void 0:ls.targetColumn)=="string"?Ce.metadata.targetColumn:null;if(!jt(lt))return;const Rt=`job-${Ce.id}`,kt=(()=>{var Sn;const Bn=typeof((Sn=Ce.metadata)==null?void 0:Sn.label)=="string"?Ce.metadata.label.trim():"";return Bn||(Ce.run_number?`Run ${Ce.run_number}`:`Job ${Ce.id.slice(0,6)}`)})(),Ut=typeof((Cn=Ce.metadata)==null?void 0:Cn.scoring)=="string"?Ce.metadata.scoring:typeof((en=Ce.metrics)==null?void 0:en.scoring)=="string"?Ce.metrics.scoring:null,At=typeof((rn=Ce.metadata)==null?void 0:rn.n_iterations)=="number"?Ce.metadata.n_iterations:null;ie.push({id:Rt,label:kt,source:"tuning-job",modelType:Ce.model_type,params:ot.params,jobId:Ce.id,nodeId:Ce.node_id,runNumber:Ce.run_number??null,score:Ce.best_score??null,scoring:Ut,finishedAt:Ce.updated_at??Ce.created_at??null,searchStrategy:Ce.search_strategy??null,nIterations:At,targetColumn:lt??(ee||null),pipelineId:Ce.pipeline_id??null,datasetSourceId:Ce.dataset_source_id??null,description:ot.hasUnmapped?"Some tuned parameters fall outside the current template and will be saved as custom overrides.":null}),xe.add(Ce.id)}),ie.sort((Ce,ot)=>{const lt=Ce.finishedAt?Date.parse(Ce.finishedAt):0,Rt=ot.finishedAt?Date.parse(ot.finishedAt):0;return lt!==Rt?Rt-lt:(ot.runNumber??0)-(Ce.runNumber??0)}),ie},[dt,Tn,ne,t,ee,Xt]),at=Nt[0]??null,os=Nt.length>0,Vt=!at,pt=!os,yt=b.useMemo(()=>Xt.length?Xt.slice().sort((ie,xe)=>{const Le=Date.parse(ie.updated_at||ie.created_at||"0");return Date.parse(xe.updated_at||xe.created_at||"0")-Le})[0]:Bt.length?Bt.slice().sort((ie,xe)=>{const Le=Date.parse(ie.updated_at||ie.created_at||"0");return Date.parse(xe.updated_at||xe.created_at||"0")-Le})[0]:null,[Xt,Bt]),Gn=yt&&(yt.updated_at||yt.created_at)||null,mn=Gn?Yn(Gn):null,vn=(yt==null?void 0:yt.run_number)??null,nn=at!=null&&at.finishedAt?Yn(at.finishedAt):null,jn=at&&at.scoring&&typeof at.score=="number"&&Number.isFinite(at.score)?`${at.scoring}: ${zN(at.score)}`:null;b.useEffect(()=>{if(!Nt.length){H&&J(null),(G==null?void 0:G.tone)==="success"&&Y(null);return}H&&!Nt.some(ie=>ie.id===H)&&(J(null),Y(null))},[G,Nt,H]);const Jt=b.useCallback((ie,xe)=>{if(!ie||Object.keys(ie.params??{}).length===0){Y({message:"Selected preset does not include any hyperparameters to apply.",tone:"warning"});return}D(()=>Ec(ie.params)),R(!0),z.current=!0,J(ie.id),Y({message:xe??`Applied tuned parameters from ${ie.label}.`,tone:"success"})},[D,R,Y,J]),Xn=b.useCallback(()=>{if(!at){const xe=yt&&yt.model_type&&yt.model_type!==ne?`Latest tuning run targeted ${yt.model_type}. Switch the model template to reuse its parameters.`:"No tuning job results available to apply.";Y({message:xe,tone:"warning"});return}const ie=at.runNumber?`Applied tuned parameters from run ${at.runNumber}.`:`Applied tuned parameters from ${at.label}.`;Jt(at,ie)},[Jt,yt,ne,at,Y]),$t=b.useMemo(()=>{if(!G)return"rgba(148, 163, 184, 0.75)";switch(G.tone){case"success":return"rgba(134, 239, 172, 0.9)";case"warning":return"rgba(253, 186, 116, 0.95)";default:return"rgba(148, 163, 184, 0.85)"}},[G]),$n=b.useMemo(()=>{const ie=[];return t||ie.push("Select a dataset before launching training jobs."),(!ft||!ft.nodes.length)&&ie.push("Connect this node to an upstream pipeline before training."),ee||ie.push("Set a target column in the Train model readiness section."),ne||ie.push("Choose a model type before enqueuing training jobs."),ge&&De<2&&ie.push("Cross-validation requires at least 2 folds."),j&&ie.push(j),ye&&ie.push(ye),ie},[ge,De,ft,ye,ne,j,t,ee]),xn=((Ss=Et.data)==null?void 0:Ss.jobs)??[],fn=b.useMemo(()=>{if(!xn.length)return xn;const ie=Q==null?void 0:Q.toLowerCase();return xn.filter(xe=>{if(!ie)return!0;const Le=(()=>{var Rt,kt,Ut,At;const Ce=typeof xe.problem_type=="string"?xe.problem_type:null,ot=typeof((Rt=xe.metadata)==null?void 0:Rt.problem_type)=="string"?(kt=xe.metadata)==null?void 0:kt.problem_type:null,lt=typeof((Ut=xe.metadata)==null?void 0:Ut.resolved_problem_type)=="string"?(At=xe.metadata)==null?void 0:At.resolved_problem_type:null;return(Ce||lt||ot||"").toLowerCase()})();if(Le)return Le===ie;const jt=String(xe.model_type||"").toLowerCase();return ie==="regression"?jt.includes("regress"):ie==="classification"?jt.includes("classif"):!0})},[xn,Q]),ws=b.useMemo(()=>!!(Mt instanceof Error&&Xi(Mt.message)||k&&Sc(k)||xn.some(ie=>Sc(ie))||Bt.some(ie=>Sc(ie))),[Mt,xn,k,Bt]),Pn=LN({graph:n,nodeId:e,modelType:ne,problemType:Q,modelTypeOptions:h,enabled:ws});b.useEffect(()=>{Pn||Z(!1)},[Pn]);const Ns=Math.max(xn.length-fn.length,0),Qn=Et.isLoading||Et.isFetching,is=Et.error,js=$n.length>0||!N||!t||!ft||wn,Fn=b.useCallback((ie,xe)=>{D(Le=>({...Le,[ie]:xe}))},[]),Zn=b.useCallback(ie=>{var jt;const xe=A[ie.name]??ie.default,Le=`hyperparam-${e}-${ie.name}`;return o.jsxs("div",{className:"canvas-modal__parameter",children:[o.jsxs("label",{htmlFor:Le,className:"canvas-modal__parameter-label",children:[ie.label,ie.description&&o.jsx("span",{className:"canvas-modal__parameter-description",children:ie.description})]}),ie.type==="number"&&o.jsx("input",{id:Le,type:"number",className:"canvas-modal__parameter-input",value:xe??"",onChange:Ce=>{const ot=Ce.target.value;if(ot===""&&ie.nullable)Fn(ie.name,null);else{const lt=parseFloat(ot);isNaN(lt)||Fn(ie.name,lt)}},min:ie.min,max:ie.max,step:ie.step,placeholder:ie.nullable?"Empty = default":""}),ie.type==="select"&&o.jsx("select",{id:Le,className:"canvas-modal__parameter-select",value:xe??"",onChange:Ce=>Fn(ie.name,Ce.target.value),children:(jt=ie.options)==null?void 0:jt.map(Ce=>o.jsx("option",{value:Ce.value,children:Ce.label},Ce.value))}),ie.type==="boolean"&&o.jsx("input",{id:Le,type:"checkbox",className:"canvas-modal__parameter-checkbox",checked:!!xe,onChange:Ce=>Fn(ie.name,Ce.target.checked)}),ie.type==="text"&&o.jsx("input",{id:Le,type:"text",className:"canvas-modal__parameter-input",value:xe??"",onChange:Ce=>Fn(ie.name,Ce.target.value),placeholder:ie.nullable?"Empty = default":""})]},ie.name)},[A,Fn,e]),Ht=b.useCallback(async()=>{if(!N||!t||!ne)return;if(U&&w){try{const lt=w({closeModal:!1});lt&&typeof lt.then=="function"&&await lt,W(!1)}catch{}await new Promise(lt=>setTimeout(lt,100))}const ie=bt??ft;if(!ie)return;const xe={};ee&&(xe.target_column=ee),xe.problem_type=Q,xe.cross_validation={enabled:ge,strategy:Ee,folds:De,shuffle:ke,random_state:le,refit_strategy:pe};const Le=Object.keys(xe).length?xe:void 0,jt=Ec(ie);jt&&Array.isArray(jt.nodes)&&(jt.nodes=jt.nodes.map(lt=>{if(!lt||lt.id!==e)return lt;const Rt=(lt==null?void 0:lt.data)??{},kt=(Rt==null?void 0:Rt.config)??{},Ut=l?{...kt,...l}:kt;return{...lt,data:{...Rt,config:Ut,isConfigured:!0}}}));const Ce=ne?[ne]:[],ot={dataset_source_id:t,pipeline_id:N,node_id:e,model_type:ne||void 0,model_types:Ce.length?Ce:void 0,hyperparameters:F&&mt?Ec(mt):void 0,metadata:Le,job_metadata:Le,run_training:!0,graph:jt??Ec(ie),target_node_id:e};try{await Qt(ot)}catch{}},[ge,De,le,pe,ke,Ee,l,Qt,ft,bt,U,ne,e,w,N,Q,mt,F,t,ee]),Qe=b.useCallback(()=>{Ft&&Et.refetch()},[Ft,Et]),Ue=ie=>{var sn,ls,Cn,en;const xe=YI(ie.metrics??null),Le=ie.updated_at?Yn(ie.updated_at):null,jt=ie.updated_at||ie.created_at,Ce=jt?Le??new Date(jt).toLocaleString():null,ot=qI[ie.status]??ie.status,lt=(ie.problem_type||((sn=ie.metadata)==null?void 0:sn.resolved_problem_type)||((ls=ie.metadata)==null?void 0:ls.problem_type)||"").toString(),Rt=((Cn=ie.metadata)==null?void 0:Cn.cross_validation)??null,kt=((en=ie.metrics)==null?void 0:en.cross_validation)??null,Ut=typeof ie.error_message=="string"?ie.error_message.trim():"",At=[];if(At.push(`Model ${ie.model_type}`),lt&&At.push(lt.charAt(0).toUpperCase()+lt.slice(1)),Rt!=null&&Rt.enabled){const rn=String(Rt.strategy??"auto"),Bn=rn==="stratified_kfold"?"Stratified KFold":rn==="kfold"?"KFold":"Auto CV",Sn=typeof Rt.folds=="number"?`${Rt.folds} folds`:"CV enabled";if(At.push(`${Bn} (${Sn})`),(kt==null?void 0:kt.status)==="skipped"){const aa=String((kt==null?void 0:kt.reason)??"unknown reason").replace(/_/g," ");At.push(`CV skipped (${aa})`)}}else if((kt==null?void 0:kt.status)==="skipped"){const rn=String((kt==null?void 0:kt.reason)??"unknown reason").replace(/_/g," ");At.push(`CV skipped (${rn})`)}if(xe&&At.push(`${xe.label}: ${zN(xe.value)}`),ie.status==="failed"&&Ut){const rn=Ut.replace(/\s+/g," ");At.push(`Error: ${rn}`)}return Ce&&At.push(`Updated ${Ce}`),o.jsxs("li",{children:[o.jsxs("strong",{children:["v",ie.version]}),"  ",ot,At.length>0?`  ${At.join("  ")}`:""]},ie.id)};return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Background training jobs"}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:Qe,disabled:!Ft||Qn,children:Qn?"Refreshing":"Refresh jobs"})})]}),o.jsx("p",{className:"canvas-modal__note",children:"Enqueue a background training job for this node. Jobs run via Celery, versioned per pipeline, and report metrics when finished."}),N&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Pipeline ID: ",o.jsx("code",{children:N})]}),U&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{background:"rgba(251, 146, 60, 0.1)",borderLeft:"3px solid rgba(251, 146, 60, 0.8)",padding:"0.75rem 1rem",margin:"0.75rem 0"},children:[o.jsx("strong",{children:" Unsaved Configuration Changes"}),o.jsx("br",{}),"Your changes will create a new training pipeline. Previous jobs remain under the old configuration. Jobs will auto-save when you launch training."]}),$n.map((ie,xe)=>o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:ie},`training-prereq-${xe}`)),Mt instanceof Error&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:Mt.message}),is&&!(Mt instanceof Error)&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:is.message||"Unable to load training jobs."}),Zt&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:Zt.message||"Unable to load tuning jobs."}),k&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:T>1?o.jsxs("span",{children:["Queued ",T," training jobs. Latest job ",k.id," (version ",k.version,")."]}):o.jsxs("span",{children:["Training job ",k.id," queued (version ",k.version,")."]})}),Nn&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading tuning jobs"}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[be&&u(be),m&&u(m),ge&&o.jsxs(o.Fragment,{children:[f&&u(f),y&&u(y),x&&u(x),_&&u(_),v&&u(v)]}),ne&&ue.length>0&&o.jsx("div",{className:"canvas-modal__parameter",style:{gridColumn:"1 / -1"},children:o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem",marginBottom:"0.75rem",padding:"0.75rem 1rem",background:"rgba(15, 23, 42, 0.35)",borderRadius:"6px",border:"1px solid rgba(148, 163, 184, 0.25)"},children:[o.jsxs("div",{style:{flex:"1 1 260px"},children:[o.jsx("strong",{style:{fontSize:"0.95rem",color:"#e2e8f0"},children:"Model Configuration"}),o.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:F?"Fine-tune hyperparameters or use defaults for quick training":"Using default hyperparameters  toggle Advanced to customize"}),(at||yt)&&o.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",color:"rgba(148, 163, 184, 0.8)"},children:at?o.jsxs(o.Fragment,{children:[" Tuned parameters available for ",o.jsx("strong",{children:at.modelType}),at.runNumber?` (run ${at.runNumber})`:"",nn?`  ${nn}`:"",at.targetColumn?`  Target: ${at.targetColumn}`:"",jn?`  ${jn}`:""]}):o.jsxs(o.Fragment,{children:["Latest tuning run ",vn||"N/A",mn?`  ${mn}`:"",yt!=null&&yt.model_type&&yt.model_type!==ne?` targeted ${yt.model_type}.`:" did not produce reusable parameters for this configuration yet."]})}),G&&o.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",color:$t},children:G.message})]}),o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center",justifyContent:"flex-end"},children:[o.jsx("button",{type:"button",onClick:Xn,disabled:Vt,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:Vt?"rgba(148, 163, 184, 0.55)":"#0c4a6e",background:Vt?"rgba(15, 23, 42, 0.35)":"rgba(191, 219, 254, 0.9)",border:Vt?"1px solid rgba(148, 163, 184, 0.35)":"1px solid rgba(147, 197, 253, 0.9)",borderRadius:"4px",cursor:Vt?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"130px",boxShadow:Vt?"none":"0 3px 10px rgba(14, 116, 144, 0.25)"},children:"Apply tuned params"}),o.jsx("button",{type:"button",onClick:()=>I(!0),disabled:pt,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:pt?"rgba(148, 163, 184, 0.55)":"rgba(168, 85, 247, 0.95)",background:pt?"rgba(15, 23, 42, 0.35)":"rgba(76, 29, 149, 0.18)",border:pt?"1px solid rgba(148, 163, 184, 0.35)":"1px solid rgba(168, 85, 247, 0.45)",borderRadius:"4px",cursor:pt?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"150px"},children:"Browse tuned params"}),o.jsx("button",{type:"button",onClick:rt,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:"500",color:F?"#fff":"rgba(148, 163, 184, 0.85)",background:F?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(15, 23, 42, 0.6)",border:F?"none":"1px solid rgba(148, 163, 184, 0.45)",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s ease",minWidth:"100px",boxShadow:F?"0 4px 12px rgba(118, 75, 162, 0.25)":"none"},onMouseEnter:ie=>{F?ie.currentTarget.style.boxShadow="0 6px 16px rgba(118, 75, 162, 0.35)":(ie.currentTarget.style.borderColor="rgba(148, 163, 184, 0.65)",ie.currentTarget.style.background="rgba(15, 23, 42, 0.8)")},onMouseLeave:ie=>{F?ie.currentTarget.style.boxShadow="0 4px 12px rgba(118, 75, 162, 0.25)":(ie.currentTarget.style.borderColor="rgba(148, 163, 184, 0.45)",ie.currentTarget.style.background="rgba(15, 23, 42, 0.6)")},children:F?" Advanced":"Default"})]})]})}),ne&&Te.isLoading&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading hyperparameters"}),ne&&Te.error&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--error",children:["Failed to load hyperparameters: ",Te.error.message]}),ne&&F&&ue.length>0&&o.jsxs("div",{style:{gridColumn:"1 / -1",padding:"1.25rem",background:"rgba(15, 23, 42, 0.25)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px",marginTop:"0.5rem"},children:[o.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"2px solid rgba(102, 126, 234, 0.3)"},children:[o.jsx("h4",{style:{margin:"0 0 0.5rem 0",fontSize:"1rem",fontWeight:"600",color:"#e2e8f0"},children:"Advanced Hyperparameters"}),o.jsxs("p",{style:{margin:"0",fontSize:"0.875rem",color:"rgba(148, 163, 184, 0.85)",lineHeight:"1.5"},children:["Configure ",ne.replace(/_/g," ")," hyperparameters. Leave empty to use recommended defaults."]})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:ue.map(Zn)})]}),!ne&&p&&u(p)]}),ge&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Cross-validation runs ",De," folds before refitting on"," ",pe==="train_plus_validation"?"training plus validation data.":"training data only."]}),Pn&&o.jsxs("div",{className:"canvas-modal__note canvas-modal__note--warning",style:{margin:"0.75rem 0",borderLeft:"3px solid rgba(251, 191, 36, 0.9)",background:"rgba(251, 191, 36, 0.12)",padding:"0.75rem 1rem"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"0.75rem"},children:[o.jsxs("div",{children:[o.jsxs("strong",{children:[" ",Pn.headline]}),o.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem"},children:Pn.summary})]}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>Z(ie=>!ie),style:{whiteSpace:"nowrap"},children:X?"Hide tips":"Show tips"})]}),X&&o.jsx("ul",{style:{margin:"0.75rem 0 0 1rem",padding:0,listStyle:"disc",fontSize:"0.85rem"},children:Pn.details.map((ie,xe)=>o.jsx("li",{style:{marginBottom:"0.35rem"},children:ie},`scaling-tip-${xe}`))})]}),o.jsx("div",{className:"canvas-modal__actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:Ht,disabled:js,children:wn?"Queuing":"Launch training job"})}),Qn&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading recent jobs"}),Ns>0&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:Ns===1?"1 training job uses a different problem type. Switch the problem type to view it.":`${Ns} training jobs use a different problem type. Switch the problem type to view them.`}),!Qn&&fn.length===0&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No training jobs found for this node."}),fn.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:fn.map(Ue)}),o.jsx(PI,{presets:Nt,isOpen:B,onClose:()=>I(!1),onApply:ie=>{Jt(ie),I(!1)},activePresetId:H,fieldMetadata:et})]})},GI=new Set(["true","1","yes","on"]),XI=new Set(["false","0","no","off"]),QI=["auto_detect","autoDetect","auto_detect_columns","auto","auto_detect_text"],IN=new Set(["true","1","yes","y","on","t"]),FN=new Set(["false","0","no","n","off","f"]),Fo=e=>{if(typeof e=="boolean")return e;if(typeof e=="number")return Number.isFinite(e)?e===1?!0:e===0?!1:null:null;if(typeof e=="string"){const t=e.trim().toLowerCase();if(!t)return null;if(GI.has(t))return!0;if(XI.has(t))return!1}return null},Zi=e=>{if(!(!e||typeof e!="object")){for(const t of QI)if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}},wp=e=>{if(e==null)return{};try{return JSON.parse(JSON.stringify(e))}catch{return Array.isArray(e)?[...e]:typeof e=="object"?{...e}:e}},Np=e=>Array.isArray(e)?e.map(t=>Np(t)):e&&typeof e=="object"?Object.keys(e).sort().reduce((t,n)=>(t[n]=Np(e[n]),t),{}):e,Mc=e=>e===void 0?"":JSON.stringify(Np(e)),BN=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0},ZI=(e,t)=>{const n=[],s=m=>{n.includes(m)||n.push(m)},r=(e??"").toLowerCase();if(!t.length)return n;const i=t.filter(m=>m!=null);if(!i.length)return n;const l=i.reduce((m,f)=>{if(typeof f=="number"&&Number.isFinite(f))return m+1;if(typeof f=="string"){const y=f.trim();if(!y)return m;const x=Number(y);if(!Number.isNaN(x)&&Number.isFinite(x))return m+1}return m},0),u=i.reduce((m,f)=>{const y=String(f).trim().toLowerCase();return y&&(IN.has(y)||FN.has(y))?m+1:m},0),d=(()=>{const m=new Set;return i.forEach(f=>{m.add(String(f).trim().toLowerCase())}),m.size})(),h=l/i.length,p=u/i.length;if(r.includes("object")||r.includes("string"))return p>=.7&&s("boolean"),h>=.7&&s("float64"),d>0&&d<=20&&s("category"),n;if(r.includes("float")){const m=i.reduce((f,y)=>{if(typeof y=="number")return Number.isInteger(y)?f+1:f;if(typeof y=="string"){const x=y.trim();if(!x)return f;const _=Number(x);if(!Number.isNaN(_)&&Number.isFinite(_)&&Number.isInteger(_))return f+1}return f},0);return p>=.8&&s("boolean"),i.length>0&&m/i.length>=.9&&s("Int64"),n}return r.includes("int")&&p>=.7&&s("boolean"),n},Dd=[{value:"train",label:"Train",accent:"train"},{value:"test",label:"Test",accent:"test"},{value:"validation",label:"Validation",accent:"validation"}],zd={train:0,test:1,validation:2},JI=["train","test","validation"],jp=e=>Array.isArray(e)?e.map(t=>typeof t=="string"?t:String(t??"")).map(t=>t.trim().toLowerCase()).filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim().toLowerCase()).filter(Boolean):[],kc=e=>{const t=new Set(Dd.map(r=>r.value)),n=[];e.forEach(r=>{if(r){if(r==="training"&&(r="train"),r==="valid"||r==="val"){n.push("validation");return}t.has(r)&&n.push(r)}});const s=new Set;return n.filter(r=>s.has(r)?!1:(s.add(r),!0)).sort((r,i)=>zd[r]-zd[i])},eF=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0},Cp=(e,t)=>{const n=Fo(e);return n===null?t:n},UN=(e,t)=>{if(typeof e=="number"&&Number.isFinite(e)&&e>0)return Math.round(e);if(typeof e=="string"&&e.trim()){const n=Number(e);if(Number.isFinite(n)&&n>0)return Math.round(n)}return t},HN=e=>{if(!e)return 0;const t=Date.parse(e);return Number.isFinite(t)?t:0},qN=e=>{const t=Dd.find(n=>n.value===e);return t?t.label:e.charAt(0).toUpperCase()+e.slice(1)},tF=e=>{const t=e.replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1)},nF=e=>{const t=[];e.model_type&&t.push(e.model_type),typeof e.version=="number"&&t.push(`v${e.version}`),t.push(` ${tF(e.status)}`);const n=Yn(e.updated_at??e.created_at);return n&&t.push(`(${n})`),t.join(" ")},Id=e=>!Number.isFinite(e)||e<0?0:e>1?1:e,VN=e=>{if(!e||typeof e!="object")return[];const t=[];return Object.entries(e).forEach(([n,s])=>{typeof s=="number"&&Number.isFinite(s)&&t.push({key:n,value:s})}),t.sort((n,s)=>n.key.localeCompare(s.key)),t},WN=(e,t)=>{if(!Number.isFinite(e))return"";const n=t(e*100,Math.abs(e)>=.1?1:2);return n?`${n}%`:""},sF=({nodeId:e,sourceId:t,graph:n,config:s,setConfigState:r,renderParameterField:i,formatMetricValue:l,connectedSplitHandles:u})=>{var ke;const d=Eo(),h=b.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),p=b.useMemo(()=>{if(!h)return[];const le=new Map;h.nodes.forEach(be=>{be!=null&&be.id&&le.set(be.id,be)});const pe=new Set;return h.edges.forEach(be=>{var Ie;if(!be||be.target!==e)return;const Te=le.get(be.source);((Ie=Te==null?void 0:Te.data)==null?void 0:Ie.catalogType)==="train_model_draft"&&pe.add(Te.id)}),pe.size>0?Array.from(pe):h.nodes.filter(be=>{var Te;return((Te=be==null?void 0:be.data)==null?void 0:Te.catalogType)==="train_model_draft"}).map(be=>be.id)},[h,e]),m=b.useMemo(()=>p.length?p.slice().sort().join("|"):"all",[p]),[f,y]=b.useState(null),[x,_]=b.useState(null);b.useEffect(()=>{let le=!1;return _(null),!t||!h?(y(null),()=>{le=!0}):(zo(t,h).then(pe=>{le||y(pe)}).catch(pe=>{le||(_((pe==null?void 0:pe.message)??"Unable to compute pipeline signature."),y(null))}),()=>{le=!0})},[h,t]);const v=b.useMemo(()=>{const le=s==null?void 0:s.training_job_id;return typeof le=="string"?le.trim():typeof le=="number"?String(le):""},[s==null?void 0:s.training_job_id]),w=b.useMemo(()=>kc(jp(s==null?void 0:s.splits)),[s==null?void 0:s.splits]),M=b.useMemo(()=>w.length?w:JI,[w]);b.useEffect(()=>{u&&r(le=>{const pe=le??{},be=kc(jp(pe.splits)),Te=be.filter(ue=>u[ue]!==!1);if(Te.length===be.length&&Te.every((ue,$e)=>ue===be[$e]))return le;const Ie={...pe};return Te.length?Ie.splits=Te:delete Ie.splits,Ie})},[u,r]);const N=b.useMemo(()=>u?M.filter(le=>u[le]!==!1):M,[u,M]),C=b.useMemo(()=>u?Dd.filter(le=>u[le.value]===!1).map(le=>le.label):[],[u]),j=b.useMemo(()=>{if(!C.length)return"";if(C.length===1)return C[0];if(C.length===2)return`${C[0]} and ${C[1]}`;const le=C[C.length-1];return`${C.slice(0,-1).join(", ")}, and ${le}`},[C]),E=N.length>0,k=Cp(s==null?void 0:s.include_confusion,!0),$=Cp(s==null?void 0:s.include_curves,!0),T=Cp(s==null?void 0:s.include_residuals,!0),P=UN(s==null?void 0:s.max_curve_points,500),A=UN(s==null?void 0:s.max_scatter_points,750),D=typeof(s==null?void 0:s.last_evaluated_at)=="string"?s.last_evaluated_at:null,[F,R]=b.useState(null),[z,q]=b.useState("details"),V=b.useRef(!1);b.useEffect(()=>{R(null),V.current=!1},[v]),b.useEffect(()=>{q("details")},[F==null?void 0:F.job_id]);const U=b.useMemo(()=>["feature-canvas","model-evaluation",t??"none",f??"pending",m],[f,t,m]),W=Ts({queryKey:U,queryFn:async()=>{const le={datasetSourceId:t||void 0,limit:50},pe=new Map,be=[];let Te=null;const Ie=et=>{Array.isArray(et)&&et.forEach(We=>{We&&!pe.has(We.id)&&pe.set(We.id,We)})},ue=async et=>{try{const We=await hc(et);return Ie(We==null?void 0:We.jobs),We}catch(We){return We instanceof Error&&be.push(We),null}};if(f&&await ue({...le,pipelineId:f}),p.length&&await Promise.all(p.map(et=>ue({...le,nodeId:et}))),Te=await ue(le),!pe.size){if(Te)return Te;if(be.length)throw be[0];return{jobs:[],total:0}}const $e=Array.from(pe.values());$e.sort((et,We)=>HN(We.updated_at??We.created_at)-HN(et.updated_at??et.created_at));const Ye=(Te==null?void 0:Te.total)??$e.length;return{jobs:$e,total:Ye}},enabled:!!t,staleTime:30*1e3,retry:(le,pe)=>pe.message.includes("Sign in")?!1:le<2,refetchInterval:le=>{const pe=le.state.data;return((pe==null?void 0:pe.jobs)??[]).some(Ie=>Ie.status==="queued"||Ie.status==="running")?5e3:!1}}),B=((ke=W.data)==null?void 0:ke.jobs)??[],I=b.useMemo(()=>{const le=new Map;return B.forEach(pe=>{le.set(pe.id,pe)}),le},[B]),H=b.useMemo(()=>B.filter(le=>le.status==="succeeded"),[B]),J=b.useMemo(()=>H.map(le=>({value:le.id,label:nF(le)})),[H]),G=v?I.get(v)??null:null,Y=Ts({queryKey:["feature-canvas","training-job",v||"none"],queryFn:()=>aw(v),enabled:!!v,staleTime:30*1e3});b.useEffect(()=>{var et,We;const le=Y.data;if(!le)return;const pe=(et=le.metrics)==null?void 0:et.evaluation;if(!pe||typeof pe!="object")return;const be=pe.splits;if(!be||typeof be!="object")return;const Te={};Object.entries(be).forEach(([mt,rt])=>{rt&&typeof rt=="object"&&(Te[mt]=rt)});const Ie=typeof pe.generated_at=="string"?pe.generated_at:D??le.updated_at??le.created_at??new Date().toISOString(),ue=pe.problem_type==="regression"?"regression":"classification",$e={job_id:le.id,pipeline_id:le.pipeline_id,node_id:le.node_id,generated_at:Ie,problem_type:ue,target_column:pe.target_column??((We=le.metadata)==null?void 0:We.target_column)??null,splits:Te};R($e),Ie&&Ie!==D&&r(mt=>({...mt??{},last_evaluated_at:Ie}));const Ye=kc(Object.keys(Te));Ye.length&&!V.current&&!eF(w,Ye)&&r(mt=>({...mt??{},splits:Ye}))},[Y.data,D,r,w]);const X=Cu({mutationFn:async le=>{if(!v)throw new Error("Select a training job before running evaluation.");return ow(v,le)},onSuccess:le=>{R(le),r(pe=>({...pe??{},training_job_id:v,splits:le.splits?Object.keys(le.splits):N,include_confusion:k,include_curves:$,include_residuals:T,max_curve_points:P,max_scatter_points:A,last_evaluated_at:le.generated_at})),d.invalidateQueries({queryKey:["feature-canvas","training-job",v]})}}),Z=b.useCallback(le=>{const pe=le.target.value;X.reset(),r(be=>{const Te={...be??{}};return pe?Te.training_job_id=pe:delete Te.training_job_id,Te})},[X,r]),ee=b.useCallback(le=>{u&&u[le]===!1||(X.reset(),V.current=!0,r(pe=>{const be=kc(jp(pe==null?void 0:pe.splits)),Te=be.includes(le);let Ie;if(Te){if(be.length<=1)return pe??{};Ie=be.filter(ue=>ue!==le)}else Ie=kc([...be,le]);return{...pe??{},splits:Ie}}))},[u,X,r]),Q=b.useCallback((le,pe)=>{X.reset(),r(be=>({...be??{},[le]:pe}))},[X,r]),ne=b.useCallback(()=>{if(!v)return;const le={splits:N,include_confusion:k,include_curves:$,include_residuals:T,max_curve_points:$?P:void 0,max_scatter_points:T?A:void 0};X.mutate(le)},[X,k,$,T,P,A,v,N]),he=F?Yn(F.generated_at):D?Yn(D):null,ye=b.useMemo(()=>F?Object.entries(F.splits).sort((le,pe)=>{const[be]=le,[Te]=pe,Ie=zd[be]??99,ue=zd[Te]??99;return Ie-ue}):[],[F]),ge=b.useMemo(()=>{if(!F||!ye.length)return null;const le=ye.map(([be,Te])=>{const Ie=VN(Te.metrics).reduce((ue,$e)=>(ue[$e.key]=$e.value,ue),{});return{key:be,label:qN(be),rowCount:typeof Te.row_count=="number"?Te.row_count:null,metrics:Ie}}),pe=Array.from(new Set(le.flatMap(be=>Object.keys(be.metrics)))).sort((be,Te)=>be.localeCompare(Te));return{splits:le,metricKeys:pe}},[ye,F]),Ee=b.useMemo(()=>ge?ge.splits.length<=1?"Connect at least two splits to compare results.":ge.metricKeys.length?null:"No numeric metrics available for comparison yet.":"Run an evaluation to compare metrics.",[ge]);b.useEffect(()=>{z==="comparison"&&Ee&&q("details")},[z,Ee]);const De=b.useCallback(le=>{le==="comparison"&&Ee||q(le)},[Ee]);return o.jsxs("div",{className:"canvas-modal__section node-settings__evaluation",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Model Evaluation"}),o.jsx("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:he&&o.jsxs("span",{className:"evaluation-status",children:["Last ran ",he]})})]}),o.jsxs("div",{className:"evaluation-controls",children:[o.jsxs("label",{className:"evaluation-control",children:[o.jsx("span",{className:"evaluation-control__label",children:"Training job"}),o.jsxs("select",{className:"evaluation-control__select",value:v,onChange:Z,disabled:W.isLoading||W.isFetching,children:[o.jsx("option",{value:"",children:"Select a trained model"}),J.map(le=>o.jsx("option",{value:le.value,children:le.label},le.value))]}),W.isLoading&&o.jsx("span",{className:"evaluation-hint",children:"Loading training jobs"}),W.error&&o.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:W.error.message}),!W.isLoading&&!J.length&&o.jsx("span",{className:"evaluation-hint",children:"No successful training jobs detected yet."}),x&&o.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:x})]}),o.jsxs("div",{className:"evaluation-control",children:[o.jsx("span",{className:"evaluation-control__label",children:"Dataset splits"}),o.jsx("div",{className:"evaluation-split-toggle",children:Dd.map(le=>{const pe=u?u[le.value]!==!1:!0,be=pe&&N.includes(le.value);return o.jsxs("label",{className:`evaluation-chip evaluation-chip--${le.accent} ${be?"evaluation-chip--active":""}`,"aria-disabled":!pe,title:pe?void 0:`${le.label} split is not connected`,style:pe?void 0:{opacity:.45,cursor:"not-allowed",borderStyle:"dashed"},children:[o.jsx("input",{type:"checkbox",checked:be,disabled:!pe,onChange:()=>ee(le.value)}),o.jsx("span",{children:le.label})]},le.value)})}),C.length>0&&o.jsxs("span",{className:"evaluation-hint evaluation-hint--warning",children:["Connect ",j," split",C.length>1?"s":""," to enable diagnostics."]}),!E&&o.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"No dataset splits are available. Attach a train, validation, or test split to run evaluation."})]}),o.jsxs("div",{className:"evaluation-control evaluation-control--toggles",children:[o.jsxs("label",{className:"evaluation-toggle",children:[o.jsx("input",{type:"checkbox",checked:k,onChange:le=>Q("include_confusion",le.target.checked)}),o.jsx("span",{children:"Confusion matrix"})]}),o.jsxs("label",{className:"evaluation-toggle",children:[o.jsx("input",{type:"checkbox",checked:$,onChange:le=>Q("include_curves",le.target.checked)}),o.jsx("span",{children:"ROC / PR curves"})]}),o.jsxs("label",{className:"evaluation-toggle",children:[o.jsx("input",{type:"checkbox",checked:T,onChange:le=>Q("include_residuals",le.target.checked)}),o.jsx("span",{children:"Residual diagnostics"})]})]})]}),o.jsxs("div",{className:"evaluation-actions",children:[o.jsx("button",{type:"button",className:"evaluation-button",onClick:ne,disabled:!v||X.isPending||!E,children:X.isPending?"Running":"Run evaluation"}),G&&G.status!=="succeeded"&&o.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"Selected job is not marked as succeeded; results may be incomplete."}),!E&&o.jsx("span",{className:"evaluation-hint evaluation-hint--warning",children:"Connect at least one dataset split to run evaluation diagnostics."}),X.isError&&o.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:X.error.message}),X.isSuccess&&F&&o.jsxs("span",{className:"evaluation-hint evaluation-hint--success",children:["Diagnostics generated ",Yn(F.generated_at),"."]}),Y.error&&o.jsx("span",{className:"evaluation-hint evaluation-hint--error",children:Y.error.message})]}),F?o.jsxs("div",{className:"node-settings__evaluation-results",children:[o.jsxs("div",{className:"evaluation-summary",children:[o.jsxs("div",{children:[o.jsx("span",{className:"evaluation-summary__label",children:"Problem type"}),o.jsx("span",{className:"evaluation-summary__value",children:F.problem_type==="regression"?"Regression":"Classification"})]}),F.target_column&&o.jsxs("div",{children:[o.jsx("span",{className:"evaluation-summary__label",children:"Target column"}),o.jsx("span",{className:"evaluation-summary__value",children:F.target_column})]}),o.jsxs("div",{children:[o.jsx("span",{className:"evaluation-summary__label",children:"Evaluation time"}),o.jsx("span",{className:"evaluation-summary__value",children:Yn(F.generated_at)??F.generated_at})]})]}),o.jsxs("div",{className:"evaluation-tabs",role:"tablist","aria-label":"Evaluation views",children:[o.jsx("button",{type:"button",className:`evaluation-tab ${z==="details"?"evaluation-tab--active":""}`,role:"tab","aria-selected":z==="details",onClick:()=>De("details"),children:"Split details"}),o.jsx("button",{type:"button",className:`evaluation-tab ${z==="comparison"?"evaluation-tab--active":""}`,role:"tab","aria-selected":z==="comparison","aria-disabled":!!Ee,disabled:!!Ee,title:Ee??void 0,onClick:()=>De("comparison"),children:"Split comparison"})]}),z==="comparison"&&ge?o.jsx(rF,{comparison:ge,formatMetricValue:l}):ye.map(([le,pe])=>o.jsx(aF,{splitKey:le,payload:pe,problemType:F.problem_type,formatMetricValue:l},le))]}):o.jsx("div",{className:"evaluation-placeholder",children:v?o.jsx("p",{children:"Run the evaluation to generate metrics and diagnostics for the selected model."}):o.jsx("p",{children:"Select a completed training job to enable the evaluation workflow."})})]})},rF=({comparison:e,formatMetricValue:t})=>e.metricKeys.length?o.jsx("section",{className:"evaluation-comparison",children:o.jsx("div",{className:"evaluation-comparison__table-wrapper",children:o.jsxs("table",{className:"evaluation-comparison__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Metric"}),e.splits.map(n=>o.jsx("th",{children:n.label},n.key))]})}),o.jsxs("tbody",{children:[o.jsxs("tr",{className:"evaluation-comparison__row evaluation-comparison__row--muted",children:[o.jsx("td",{children:"Rows evaluated"}),e.splits.map(n=>o.jsx("td",{children:typeof n.rowCount=="number"?n.rowCount.toLocaleString():""},`${n.key}-rows`))]}),e.metricKeys.map(n=>o.jsxs("tr",{className:"evaluation-comparison__row",children:[o.jsx("td",{children:n}),e.splits.map(s=>o.jsx("td",{children:typeof s.metrics[n]=="number"?t(s.metrics[n]):""},`${s.key}-${n}`))]},n))]})]})})}):o.jsx("div",{className:"evaluation-placeholder",children:o.jsx("p",{children:"No numeric metrics were reported across splits for comparison."})}),aF=({splitKey:e,payload:t,problemType:n,formatMetricValue:s})=>{const r=VN(t.metrics),i=r.length>0,l=Array.isArray(t.notes)?t.notes.filter(Boolean):[];return o.jsxs("section",{className:"evaluation-split",children:[o.jsx("header",{className:"evaluation-split__header",children:o.jsxs("div",{children:[o.jsxs("h4",{children:[qN(e)," split"]}),o.jsxs("span",{className:"evaluation-split__rows",children:[t.row_count," rows"]})]})}),o.jsxs("div",{className:"evaluation-split__content",children:[o.jsxs("div",{className:"evaluation-metrics",children:[o.jsx("h5",{children:"Metrics"}),i?o.jsx("div",{className:"evaluation-metrics__grid",children:r.map(u=>o.jsxs("div",{className:"evaluation-metrics__item",children:[o.jsx("span",{className:"evaluation-metrics__label",children:u.key}),o.jsx("span",{className:"evaluation-metrics__value",children:s(u.value)})]},u.key))}):o.jsx("p",{className:"evaluation-hint",children:"No numeric metrics reported for this split."})]}),n==="classification"&&t.confusion_matrix&&o.jsx(oF,{matrix:t.confusion_matrix,formatMetricValue:s}),n==="classification"&&t.roc_curves.length>0&&o.jsxs("div",{className:"evaluation-curves",children:[t.roc_curves.map(u=>o.jsx(iF,{curve:u,formatMetricValue:s},`roc-${u.label}`)),t.pr_curves.map(u=>o.jsx(lF,{curve:u,formatMetricValue:s},`pr-${u.label}`))]}),n==="regression"&&t.residuals&&o.jsx(uF,{residuals:t.residuals,formatMetricValue:s})]}),l.length>0&&o.jsx("ul",{className:"evaluation-notes",children:l.map((u,d)=>o.jsx("li",{children:u},`${e}-note-${d}`))})]})},oF=({matrix:e,formatMetricValue:t})=>{const n=Array.isArray(e.labels)?e.labels:[],s=Array.isArray(e.totals)?e.totals:[],r=Array.isArray(e.normalized)?e.normalized:[],i=typeof e.accuracy=="number"?e.accuracy:null;return o.jsxs("div",{className:"evaluation-confusion",children:[o.jsx("h5",{children:"Confusion matrix"}),i!==null&&o.jsxs("span",{className:"evaluation-confusion__accuracy",children:["Accuracy ",WN(i,t)]}),o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Actual \\ Predicted"}),n.map((l,u)=>o.jsx("th",{children:l},`pred-${u}`)),o.jsx("th",{children:"Total"})]})}),o.jsx("tbody",{children:e.matrix.map((l,u)=>{const d=r[u]??[],h=s[u]??l.reduce((p,m)=>p+m,0);return o.jsxs("tr",{children:[o.jsx("th",{children:n[u]??`Class ${u}`}),l.map((p,m)=>{const f=typeof d[m]=="number"?d[m]:null;return o.jsxs("td",{children:[o.jsx("span",{className:"evaluation-confusion__count",children:p}),f!==null&&o.jsx("span",{className:"evaluation-confusion__percentage",children:WN(f,t)})]},`cell-${u}-${m}`)}),o.jsx("td",{children:h})]},`row-${u}`)})})]})]})},iF=({curve:e,formatMetricValue:t})=>{if(!Array.isArray(e.fpr)||!Array.isArray(e.tpr)||!e.fpr.length||e.fpr.length!==e.tpr.length)return null;const n=240,s=240,r=28,i=n-r*2,l=s-r*2,u=e.fpr.map((d,h)=>{const p=r+Id(d)*i,m=s-r-Id(e.tpr[h])*l;return`${h===0?"M":"L"}${p} ${m}`}).join(" ");return o.jsxs("div",{className:"evaluation-chart",children:[o.jsxs("svg",{viewBox:`0 0 ${n} ${s}`,role:"img","aria-label":`ROC curve for ${e.label}`,children:[o.jsx("rect",{x:r,y:r,width:i,height:l,className:"evaluation-chart__frame"}),o.jsx("line",{x1:r,y1:s-r,x2:n-r,y2:r,className:"evaluation-curve__baseline"}),o.jsx("line",{x1:r,y1:r,x2:r,y2:s-r,className:"evaluation-chart__axis"}),o.jsx("line",{x1:r,y1:s-r,x2:n-r,y2:s-r,className:"evaluation-chart__axis"}),o.jsx("path",{d:u,className:"evaluation-curve__path"}),o.jsx("text",{x:n/2,y:s-4,className:"evaluation-chart__tick",textAnchor:"middle",children:"False positive rate"}),o.jsx("text",{x:-120,y:12,transform:"rotate(-90)",className:"evaluation-chart__tick",textAnchor:"middle",children:"True positive rate"})]}),o.jsxs("div",{className:"evaluation-chart__caption",children:[o.jsx("span",{children:e.label}),typeof e.auc=="number"&&o.jsxs("span",{children:["AUC ",t(e.auc)]})]})]})},lF=({curve:e,formatMetricValue:t})=>{if(!Array.isArray(e.recall)||!Array.isArray(e.precision)||!e.recall.length||e.recall.length!==e.precision.length)return null;const n=240,s=240,r=28,i=n-r*2,l=s-r*2,u=e.recall.map((d,h)=>{const p=r+Id(d)*i,m=s-r-Id(e.precision[h])*l;return`${h===0?"M":"L"}${p} ${m}`}).join(" ");return o.jsxs("div",{className:"evaluation-chart",children:[o.jsxs("svg",{viewBox:`0 0 ${n} ${s}`,role:"img","aria-label":`Precision/recall for ${e.label}`,children:[o.jsx("rect",{x:r,y:r,width:i,height:l,className:"evaluation-chart__frame"}),o.jsx("line",{x1:r,y1:r,x2:r,y2:s-r,className:"evaluation-chart__axis"}),o.jsx("line",{x1:r,y1:s-r,x2:n-r,y2:s-r,className:"evaluation-chart__axis"}),o.jsx("path",{d:u,className:"evaluation-curve__path"}),o.jsx("text",{x:n/2,y:s-4,className:"evaluation-chart__tick",textAnchor:"middle",children:"Recall"}),o.jsx("text",{x:-120,y:12,transform:"rotate(-90)",className:"evaluation-chart__tick",textAnchor:"middle",children:"Precision"})]}),o.jsxs("div",{className:"evaluation-chart__caption",children:[o.jsx("span",{children:e.label}),typeof e.average_precision=="number"&&o.jsxs("span",{children:["AP ",t(e.average_precision)]})]})]})},cF={residual_min:"Residual min",residual_max:"Residual max",residual_mean:"Residual mean",residual_std:"Residual std"},uF=({residuals:e,formatMetricValue:t})=>{const n=Object.entries(e.summary??{}).filter(s=>typeof s[1]=="number"&&Number.isFinite(s[1]));return o.jsxs("div",{className:"evaluation-regression",children:[o.jsx("h5",{children:"Residual analysis"}),n.length>0&&o.jsx("div",{className:"evaluation-summary evaluation-summary--compact",children:n.map(([s,r])=>o.jsxs("div",{children:[o.jsx("span",{className:"evaluation-summary__label",children:cF[s]??s}),o.jsx("span",{className:"evaluation-summary__value",children:t(r)})]},s))}),o.jsx(dF,{histogram:e.histogram}),e.scatter&&e.scatter.length>0&&o.jsx(mF,{points:e.scatter})]})},dF=({histogram:e})=>{const t=Array.isArray(e.counts)?e.counts:[],n=Array.isArray(e.bin_edges)?e.bin_edges:[];if(!t.length||n.length!==t.length+1)return null;const s=t.reduce((r,i)=>Math.max(r,i),0)||1;return o.jsx("div",{className:"evaluation-histogram","aria-label":"Residual histogram",children:t.map((r,i)=>{const l=r/s*100;return o.jsx("div",{className:"evaluation-histogram__bin",title:`${r} rows`,children:o.jsx("div",{className:"evaluation-histogram__bar",style:{height:`${l}%`}})},`bin-${i}`)})})},mF=({points:e})=>{if(!Array.isArray(e)||!e.length)return null;const t=320,n=260,s=36,r=e.map(f=>f.actual),i=e.map(f=>f.predicted),l=Math.min(...r,...i),u=Math.max(...r,...i),d=u-l||1,h=f=>(f-l)/d,p=f=>s+h(f)*(t-s*2),m=f=>n-s-h(f)*(n-s*2);return o.jsx("div",{className:"evaluation-scatter","aria-label":"Actual vs predicted scatter",children:o.jsxs("svg",{viewBox:`0 0 ${t} ${n}`,children:[o.jsx("rect",{x:s,y:s,width:t-s*2,height:n-s*2,className:"evaluation-chart__frame"}),o.jsx("line",{x1:s,y1:n-s,x2:t-s,y2:n-s,className:"evaluation-chart__axis"}),o.jsx("line",{x1:s,y1:s,x2:s,y2:n-s,className:"evaluation-chart__axis"}),o.jsx("line",{x1:p(l),y1:m(l),x2:p(u),y2:m(u),className:"evaluation-curve__baseline"}),e.map((f,y)=>o.jsx("circle",{cx:p(f.actual),cy:m(f.predicted),r:2.1,className:"evaluation-scatter__point"},`scatter-${y}`))]})})},fF={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},hF={queued:"info",running:"info",succeeded:"success",failed:"danger",cancelled:"neutral"},Ji={classification:["accuracy","f1_weighted","roc_auc","roc_auc_weighted","precision_weighted","recall_weighted","pr_auc","pr_auc_weighted","g_score"],regression:["rmse","mae","r2","mape"],fallback:["rmse","mae","r2","accuracy","f1_weighted","roc_auc"]},YN=["accuracy","f1_weighted","precision_weighted","recall_weighted","roc_auc","roc_auc_weighted"],KN=["rmse","mae","r2","mape"],GN=new Set(["rmse","mae","mape","mse"]),XN={logistic_regression:"Logistic Regression",random_forest_classifier:"Random Forest (Classifier)",random_forest_regressor:"Random Forest (Regressor)",ridge_regression:"Ridge Regression"},Ys=e=>!!e&&typeof e=="object"&&!Array.isArray(e),pF=(e,t)=>{if(e==null)return t;if(typeof e=="boolean")return e;if(typeof e=="string"){const n=e.trim().toLowerCase();if(!n)return t;if(["true","1","yes","on","enabled"].includes(n))return!0;if(["false","0","no","off","disabled"].includes(n))return!1}return typeof e=="number"?Number.isFinite(e)?e!==0:t:!!e},Sp=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",gF=e=>{if(!e)return Ji.fallback;const t=String(e.model_type??e.modelType??"").toLowerCase();if(t.includes("regress"))return Ji.regression;if(t.includes("class")||t.includes("classification"))return Ji.classification;const n=String(e.problem_type??e.problemType??"").toLowerCase();return n==="regression"?Ji.regression:n==="classification"?Ji.classification:Ji.fallback},_F=e=>{var r,i,l;if(!Ys(e))return null;const t=[],n=(i=(r=e==null?void 0:e.cross_validation)==null?void 0:r.metrics)==null?void 0:i.mean;Ys(n)&&((l=e==null?void 0:e.cross_validation)==null?void 0:l.status)==="completed"&&t.push({values:n,labelPrefix:"CV mean "}),Ys(e.test)&&t.push({values:e.test,labelPrefix:""}),Ys(e.validation)&&t.push({values:e.validation,labelPrefix:""}),Ys(e.train)&&t.push({values:e.train,labelPrefix:""});const s=gF(e);for(const u of t)for(const d of s){const h=u.values[d];if(typeof h=="number"&&Number.isFinite(h))return{label:u.labelPrefix?`${u.labelPrefix}${d}`:d,value:h}}for(const u of t)for(const[d,h]of Object.entries(u.values))if(typeof h=="number"&&Number.isFinite(h))return{label:u.labelPrefix?`${u.labelPrefix}${d}`:d,value:h};return null},yF=e=>{var n,s;if(!Ys(e))return{label:null,values:{}};if(Ys(e.test))return{label:"Test",values:e.test};if(Ys(e.validation))return{label:"Validation",values:e.validation};const t=(s=(n=e==null?void 0:e.cross_validation)==null?void 0:n.metrics)==null?void 0:s.mean;return Ys(t)?{label:"CV mean",values:t}:Ys(e.train)?{label:"Train",values:e.train}:{label:null,values:{}}},QN=e=>{if(!e)return"Unknown model";const t=e.trim();return XN[t]?XN[t]:t.split("_").filter(Boolean).map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")},vF=e=>{var i,l;const t=e.metadata??{},n=[e.problem_type,t==null?void 0:t.resolved_problem_type,t==null?void 0:t.problem_type];for(const u of n)if(typeof u=="string"){const d=u.trim().toLowerCase();if(d==="classification"||d==="regression")return d}const s=typeof e.model_type=="string"?e.model_type.toLowerCase():"";if(s.includes("classifier")||s.includes("classification"))return"classification";if(s.includes("regress")||s.includes("regression"))return"regression";const r=e.metrics;if(Ys(r)){const u=new Set,d=f=>{Ys(f)&&Object.keys(f).forEach(y=>u.add(y.toLowerCase()))};d(r.test),d(r.validation),d(r.train);const h=(l=(i=r==null?void 0:r.cross_validation)==null?void 0:i.metrics)==null?void 0:l.mean;Ys(h)&&d(h);const p=YN.some(f=>u.has(f)),m=KN.some(f=>u.has(f));if(p&&!m)return"classification";if(m&&!p)return"regression"}return"unknown"},xF=e=>e.map(t=>{const n=t.metrics??null;return{job:t,problemType:vF(t),modelLabel:QN(t.model_type),primaryMetric:_F(n),metricBucket:yF(n)}}),ZN=e=>{if(!e||!Number.isFinite(e.value))return null;const t=e.label.toLowerCase();return GN.has(t)||GN.has(t.replace(/^cv mean\s+/i,""))?-e.value:e.value},bF=({nodeId:e,sourceId:t,graph:n,parameters:s,config:r,renderParameterField:i})=>{var G;const l=b.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),u=b.useMemo(()=>{if(!l)return[];const Y=new Map;l.nodes.forEach(ee=>{ee&&ee.id&&Y.set(ee.id,ee)});const X=new Set;return l.edges.forEach(ee=>{var ne;if(!ee||ee.target!==e)return;const Q=Y.get(ee.source);((ne=Q==null?void 0:Q.data)==null?void 0:ne.catalogType)==="train_model_draft"&&X.add(Q.id)}),X.size>0?Array.from(X):l.nodes.filter(ee=>{var Q;return((Q=ee==null?void 0:ee.data)==null?void 0:Q.catalogType)==="train_model_draft"}).map(ee=>ee.id)},[l,e]),d=b.useMemo(()=>u.length?u.slice().sort().join("|"):"all",[u]),[h,p]=b.useState(null),[m,f]=b.useState(null);b.useEffect(()=>{let Y=!1;return f(null),!t||!l?(p(null),()=>{Y=!0}):(zo(t,l).then(X=>{Y||p(X)}).catch(X=>{Y||(f((X==null?void 0:X.message)??"Unable to compute pipeline ID"),p(null))}),()=>{Y=!0})},[l,t]);const y=pF(r==null?void 0:r.show_non_success,!0),x=b.useMemo(()=>["feature-canvas","model-registry",t??"none",h??"pending",d,y?"all-statuses":"succeeded"],[h,y,t,d]),_=Ts({queryKey:x,queryFn:async()=>{const Y={datasetSourceId:t||void 0,limit:50},X=new Map,Z=[];let ee=null;const Q=ge=>{!Array.isArray(ge)||!ge.length||ge.forEach(Ee=>{Ee&&!X.has(Ee.id)&&X.set(Ee.id,Ee)})},ne=async ge=>{try{const Ee=await hc(ge);return Q(Ee==null?void 0:Ee.jobs),Ee}catch(Ee){return Ee instanceof Error&&Z.push(Ee),null}};if(h&&await ne({...Y,pipelineId:h}),u.length===1){const[ge]=u;await ne({...Y,nodeId:ge})}if(ee=await ne(Y),!X.size){if(ee)return ee;if(Z.length)throw Z[0];return{jobs:[],total:0}}const he=Array.from(X.values()),ye=(ee==null?void 0:ee.total)??he.length;return{jobs:he,total:ye}},enabled:!!t,staleTime:30*1e3,retry:(Y,X)=>X.message.includes("Sign in")?!1:Y<2,refetchInterval:Y=>{const X=Y.state.data;return((X==null?void 0:X.jobs)??[]).some(Q=>Q.status==="queued"||Q.status==="running")?5e3:!1}}),v=((G=_.data)==null?void 0:G.jobs)??[],w=b.useMemo(()=>{if(!v.length)return[];if(!u.length)return v;const Y=v.filter(X=>u.includes(X.node_id));return Y.length?Y:v},[v,u]),M=b.useMemo(()=>xF(w),[w]),N=b.useMemo(()=>y?M:M.filter(Y=>Y.job.status==="succeeded"),[M,y]),C=b.useMemo(()=>N.filter(Y=>Y.problemType==="classification"),[N]),j=b.useMemo(()=>N.filter(Y=>Y.problemType==="regression"),[N]),E=b.useMemo(()=>!C.length&&!j.length?"classification":C.length?j.length?C.length>=j.length?"classification":"regression":"classification":"regression",[C.length,j.length]),k=typeof(r==null?void 0:r.default_problem_type)=="string"?r.default_problem_type.trim().toLowerCase():"auto",$=k==="classification"||k==="regression"?k:E,[T,P]=b.useState($);b.useEffect(()=>{P($)},[$]);const A=T==="classification"?C:j,D=b.useMemo(()=>{const Y=new Map;return A.forEach(X=>{const Z=X.job.model_type,ee=Y.get(Z)??{label:X.modelLabel,count:0};ee.count+=1,Y.set(Z,ee)}),Array.from(Y.entries()).map(([X,Z])=>({value:X,label:Z.label,count:Z.count})).sort((X,Z)=>X.label.localeCompare(Z.label))},[A]),F=typeof(r==null?void 0:r.default_method)=="string"?r.default_method.trim().toLowerCase():"",[R,z]=b.useState("all");b.useEffect(()=>{if(!D.length){z("all");return}const Y=D.find(X=>X.value.toLowerCase()===F);z(Y?Y.value:"all")},[F,D,T]);const q=b.useMemo(()=>R==="all"?A:A.filter(Y=>Y.job.model_type===R),[R,A]),V=b.useMemo(()=>q.slice().sort((Y,X)=>{if(X.job.version!==Y.job.version)return X.job.version-Y.job.version;const Z=Date.parse(Y.job.updated_at??Y.job.created_at??"");return Date.parse(X.job.updated_at??X.job.created_at??"")-Z}),[q]),U=b.useMemo(()=>{if(!A.length)return[];const Y=new Map;A.forEach(Z=>{const ee=Z.job.model_type,Q=Y.get(ee)??[];Q.push(Z),Y.set(ee,Q)});const X=[];return Y.forEach((Z,ee)=>{const Q=Z.reduce((ne,he)=>{const ye=ZN(he.primaryMetric);if(ye===null)return ne;if(!ne)return he;const ge=ZN(ne.primaryMetric);return ge===null||ye>ge?he:ne},null);X.push({modelType:ee,label:QN(ee),bestJob:Q})}),X.sort((Z,ee)=>Z.label.localeCompare(ee.label))},[A]),W=b.useMemo(()=>s.filter(Y=>["default_problem_type","show_non_success"].includes(Y.name)),[s]),B=T==="classification"?YN:KN,I=_.isLoading||_.isFetching,H=_.error??null,J=V.length>0;return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Model registry"}),h&&o.jsxs("span",{className:"model-registry__pipeline",children:["Pipeline ID: ",h]})]}),m&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:m}),!u.length&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this node to a Train model step to populate the registry."}),W.length>0&&o.jsx("div",{className:"canvas-modal__parameter-grid model-registry__parameters",children:W.map(Y=>o.jsx(ve.Fragment,{children:i(Y)},Y.name))}),o.jsxs("div",{className:"model-registry__toolbar",children:[o.jsx("div",{className:"model-registry__tabs",role:"tablist","aria-label":"Problem type",children:["classification","regression"].map(Y=>o.jsxs("button",{type:"button",role:"tab","data-active":T===Y,className:"model-registry__tab",onClick:()=>P(Y),disabled:Y==="classification"&&!C.length||Y==="regression"&&!j.length,children:[Y==="classification"?"Classification":"Regression",o.jsx("span",{className:"model-registry__tab-count",children:Y==="classification"?C.length:j.length})]},Y))}),o.jsxs("div",{className:"model-registry__methods","aria-label":"Model template filter",children:[o.jsxs("button",{type:"button",className:"model-registry__method","data-active":R==="all",onClick:()=>z("all"),children:["All methods",o.jsx("span",{className:"model-registry__method-count",children:A.length})]}),D.map(Y=>o.jsxs("button",{type:"button",className:"model-registry__method","data-active":R===Y.value,onClick:()=>z(Y.value),children:[Y.label,o.jsx("span",{className:"model-registry__method-count",children:Y.count})]},Y.value))]})]}),U.length>0&&o.jsx("div",{className:"model-registry__summary",children:U.map(Y=>{const X=Y.bestJob,Z=X!=null&&X.primaryMetric?X.primaryMetric.label:null,ee=X!=null&&X.primaryMetric?Sp(X.primaryMetric.value):"";return o.jsxs("div",{className:"model-registry__summary-card",children:[o.jsx("span",{className:"model-registry__summary-title",children:Y.label}),o.jsxs("span",{className:"model-registry__summary-metric",children:[Z||"No metrics",Z&&o.jsx("strong",{children:ee})]}),(X==null?void 0:X.job)&&o.jsxs("span",{className:"model-registry__summary-version",children:["v",X.job.version]})]},Y.modelType)})}),I&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading model history"}),H&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:H.message}),!I&&!H&&!J&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No model versions available for the current filters."}),J&&o.jsx("div",{className:"model-registry__table-wrapper",children:o.jsxs("table",{className:"model-registry__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Version"}),o.jsx("th",{scope:"col",children:"Status"}),o.jsx("th",{scope:"col",children:"Model"}),o.jsx("th",{scope:"col",children:"Primary metric"}),B.map(Y=>o.jsx("th",{scope:"col",children:Y.replace(/_/g," ")},Y)),o.jsx("th",{scope:"col",children:"Evaluated"}),o.jsx("th",{scope:"col",children:"Updated"})]})}),o.jsx("tbody",{children:V.map(Y=>{const{job:X,primaryMetric:Z,metricBucket:ee}=Y,Q=ee.values||{},ne=ee.label??"",he=X.updated_at??X.created_at??null;return o.jsxs("tr",{children:[o.jsxs("td",{children:["v",X.version]}),o.jsx("td",{children:o.jsx("span",{className:`model-registry__status model-registry__status--${hF[X.status]}`,children:fF[X.status]})}),o.jsx("td",{children:Y.modelLabel}),o.jsx("td",{children:Z?o.jsxs("span",{className:"model-registry__metric",children:[o.jsx("span",{className:"model-registry__metric-label",children:Z.label}),o.jsx("span",{className:"model-registry__metric-value",children:Sp(Z.value)})]}):""}),B.map(ye=>{const ge=Q[ye];return o.jsx("td",{children:typeof ge=="number"&&Number.isFinite(ge)?Sp(ge):""},`${X.id}-${ye}`)}),o.jsx("td",{children:ne}),o.jsx("td",{children:he?Yn(he)??he:""})]},X.id)})})]})})]})},wF={queued:"Queued",running:"Running",succeeded:"Succeeded",failed:"Failed",cancelled:"Cancelled"},Bo="__tuning_strategies",Uo="__active_tuning_strategy_id",Ho="__expanded_tuning_strategy_ids",Ep=["random","grid","halving","optuna"],Fd=(e,t)=>{if(typeof e!="string")return null;const n=e.trim();if(!n.length)return null;const s=n.toLowerCase();if(t&&t.length>0){const i=t.find(l=>l.toLowerCase()===s);if(i)return i}const r=Ep.find(i=>i.toLowerCase()===s);return r||n},xr=e=>!!e&&typeof e=="object"&&!Array.isArray(e),fs=e=>{try{return JSON.parse(JSON.stringify(e))}catch{return e}},ka=e=>{if(e==null)return{value:null,error:null};if(typeof e=="string"){const t=e.trim();if(!t.length)return{value:null,error:null};try{const n=JSON.parse(t);return xr(n)?{value:n,error:null}:{value:null,error:"JSON must evaluate to an object."}}catch{return{value:null,error:"Invalid JSON. Provide a valid JSON object."}}}return xr(e)?{value:e,error:null}:{value:null,error:"Provide a JSON object for this field."}},Mp=e=>{if(!e)return{value:null,error:null};const t={};return Object.entries(e).forEach(([n,s])=>{if(n){if(Array.isArray(s)){const r=s.filter(i=>i!=null);r.length>0&&(t[n]=r.map(i=>fs(i)));return}s==null||s===""||(t[n]=[fs(s)])}}),Object.keys(e).length?Object.keys(t).length===0?{value:null,error:"Search space must list candidate values for at least one hyperparameter."}:{value:t,error:null}:{value:null,error:"Populate the search space with at least one hyperparameter."}},NF=e=>Number.isFinite(e)?Math.abs(e)>=1e3?e.toFixed(0):Math.abs(e)>=100?e.toFixed(1):Math.abs(e)>=10?e.toFixed(2):e.toFixed(3):"",jF=new Set(["train","test","validation"]),JN=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(n=>{if(typeof n=="string"){const s=n.trim().toLowerCase();jF.has(s)&&t.add(s)}}),Array.from(t)},kp=(e,t)=>{if(!e||t.size===0)return{};const n={};return Object.entries(e).forEach(([s,r])=>{t.has(s)&&(n[s]=r)}),n},Ap=(e,t)=>{if(!e||t.size===0)return{};const n={};return Object.entries(e).forEach(([s,r])=>{if(t.has(s)){if(Array.isArray(r)){const i=r.map(l=>fs(l)).filter(l=>l!=null&&l!=="");i.length>0&&(n[s]=i);return}r!=null&&r!==""&&(n[s]=[fs(r)])}}),n},CF=(e,t)=>{const n=t.split(/[\n,]+/).map(d=>d.trim()).filter(d=>d.length>0);if(n.length===0)return{values:[],error:null};const s=[],r=[],i=Array.isArray(e.options)?new Set(e.options.map(d=>d.value)):null;n.forEach(d=>{if(e.type==="number"){const h=Number(d);Number.isFinite(h)?s.push(h):r.push(d);return}if(e.type==="boolean"){const h=d.toLowerCase();if(["true","1","yes","y"].includes(h)){s.push(!0);return}if(["false","0","no","n"].includes(h)){s.push(!1);return}r.push(d);return}if(e.type==="select"){if(i&&!i.has(d)){r.push(d);return}s.push(d);return}s.push(d)});const l=[],u=new Set;if(s.forEach(d=>{const h=typeof d=="object"?JSON.stringify(d):String(d);u.has(h)||(u.add(h),l.push(d))}),r.length>0){const d=r.slice(0,3).join(", "),h=r.length>3?"":"";return{values:l,error:`Invalid value${r.length>1?"s":""}: ${d}${h}`}}return{values:l,error:null}},ej=(e,t)=>t==null?"":typeof t=="number"?Number.isFinite(t)?t.toString():"":typeof t=="boolean"?t?"true":"false":e.type==="select"&&typeof t=="string"?t:String(t),Bd=e=>{if(e==null)return"";if(typeof e=="number")return Number.isFinite(e)?e.toString():"";if(typeof e=="boolean")return e?"True":"False";if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}},Ud=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim().length){const t=Number(e);return Number.isFinite(t)?t:null}return null},Ac=(e,t,n)=>{let s=e;return typeof t=="number"&&Number.isFinite(t)&&(s=Math.max(s,t)),typeof n=="number"&&Number.isFinite(n)&&(s=Math.min(s,n)),s},SF=(e,t)=>{const n={},s=e.find(d=>(d==null?void 0:d.name)==="solver"),r=e.find(d=>(d==null?void 0:d.name)==="penalty"),i=!!(s&&r&&Array.isArray(s.options)&&s.options.some(d=>(d==null?void 0:d.value)==="liblinear")&&Array.isArray(r.options)&&r.options.some(d=>(d==null?void 0:d.value)==="elasticnet")),l=new Set(["lbfgs","saga"]),u=new Set(["l2","none"]);return e.forEach(d=>{if(!(d!=null&&d.name))return;const h=new Map,p=y=>{if(y==null||typeof y=="number"&&!Number.isFinite(y))return;const x=typeof y=="object"?JSON.stringify(y):`${typeof y}:${String(y)}`;h.has(x)||h.set(x,fs(y))},m=t==null?void 0:t[d.name];if(i&&d.name==="solver")(Array.isArray(d.options)?d.options:[]).forEach(x=>{x!=null&&x.value&&l.has(String(x.value))&&p(x.value)}),!h.size&&typeof m=="string"&&l.has(m)&&p(m),h.size||l.forEach(x=>p(x));else if(i&&d.name==="penalty")(Array.isArray(d.options)?d.options:[]).forEach(x=>{x!=null&&x.value&&u.has(String(x.value))&&p(x.value)}),!h.size&&typeof m=="string"&&u.has(m)&&p(m),h.size||u.forEach(x=>p(x));else if(d.type==="number"){const y=Ud(m),x=Ud(d.min),_=Ud(d.max);if(x!==null&&p(x),y!==null&&p(Ac(y,x,_)),_!==null&&p(_),h.size<=1&&y!==null){const v=Ud(d.step);v!==null&&v>0?(p(Ac(y+v,x,_)),p(Ac(y-v,x,_))):(p(Ac(y*1.5,x,_)),p(Ac(y*.5,x,_)))}}else d.type==="boolean"?(p(!0),p(!1),typeof m=="boolean"&&p(m)):(d.type==="select"&&(d.options??[]).slice(0,6).forEach(y=>{(y==null?void 0:y.value)!==void 0&&p(y.value)}),typeof m=="string"&&m.trim().length&&p(m.trim()));const f=Array.from(h.values());f.length>0&&(n[d.name]=f)}),n},EF={classification:[{value:"accuracy",label:"Accuracy"},{value:"balanced_accuracy",label:"Balanced accuracy"},{value:"f1",label:"F1"},{value:"f1_macro",label:"F1 macro"},{value:"f1_weighted",label:"F1 weighted"},{value:"precision",label:"Precision"},{value:"recall",label:"Recall"},{value:"roc_auc",label:"ROC AUC (binary)"},{value:"roc_auc_ovr",label:"ROC AUC (one-vs-rest)"}],regression:[{value:"neg_mean_squared_error",label:"Negative MSE"},{value:"neg_root_mean_squared_error",label:"Negative RMSE"},{value:"neg_mean_absolute_error",label:"Negative MAE"},{value:"neg_median_absolute_error",label:"Negative MedAE"},{value:"r2",label:"R"}]},Op=()=>`strategy-${Math.random().toString(36).slice(2,10)}`,Oc=e=>{if(!xr(e))return{};const t=fs(e);return xr(t)?(delete t[Bo],delete t[Uo],delete t[Ho],t):{}},el=e=>Oc(e),MF=(e,t,n)=>({id:Op(),label:e,config:el(t),searchSpaceTexts:n!=null&&n.searchSpaceTexts?{...n.searchSpaceTexts}:{},searchSpaceFieldErrors:n!=null&&n.searchSpaceFieldErrors?{...n.searchSpaceFieldErrors}:{},hasAutoFilledSearchSpace:(n==null?void 0:n.hasAutoFilledSearchSpace)??!1,searchSpaceManuallyCleared:(n==null?void 0:n.searchSpaceManuallyCleared)??!1}),Aa=e=>`Strategy ${e}`,tj=e=>xr(e)?Object.keys(e).filter(t=>typeof e[t]=="string").sort().reduce((t,n)=>(t[n]=String(e[n]),t),{}):{},nj=e=>xr(e)?Object.keys(e).filter(t=>e[t]===null||typeof e[t]=="string").sort().reduce((t,n)=>{const s=e[n];return t[n]=s===null?null:String(s),t},{}):{},kF=e=>{if(!xr(e))return{};const t={};return Object.prototype.hasOwnProperty.call(e,Bo)&&(t[Bo]=fs(e[Bo])),Object.prototype.hasOwnProperty.call(e,Uo)&&(t[Uo]=e[Uo]),Object.prototype.hasOwnProperty.call(e,Ho)&&(t[Ho]=fs(e[Ho])),t},AF=()=>({strategies:[],activeId:null,expandedIds:[]}),Tp=e=>{var d;const t=AF();if(!xr(e))return t;const n=e[Bo];if(Array.isArray(n)){const h=new Set;n.forEach(p=>{if(!xr(p))return;let m=typeof p.id=="string"?p.id.trim():"";(!m||h.has(m))&&(m=Op()),h.add(m);const f=typeof p.label=="string"?p.label.trim():"",y=f.length?f:Aa(t.strategies.length+1),x=xr(p.config)?p.config:{},_={id:m,label:y,config:Oc(x),searchSpaceTexts:tj(p.searchSpaceTexts),searchSpaceFieldErrors:nj(p.searchSpaceFieldErrors),hasAutoFilledSearchSpace:!!p.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:!!p.searchSpaceManuallyCleared};t.strategies.push(_)})}const s=new Set(t.strategies.map(h=>h.id)),r=e[Uo],i=typeof r=="string"?r.trim():"";t.activeId=i&&s.has(i)?i:((d=t.strategies[0])==null?void 0:d.id)??null;const l=e[Ho],u=Array.isArray(l)?l.map(h=>typeof h=="string"?h.trim():"").filter(h=>!!h&&s.has(h)):[];return t.activeId&&!u.includes(t.activeId)&&u.push(t.activeId),t.expandedIds=Array.from(new Set(u)).sort(),t},sj=e=>({id:e.id,label:e.label,config:el(e.config),searchSpaceTexts:{...e.searchSpaceTexts},searchSpaceFieldErrors:{...e.searchSpaceFieldErrors},hasAutoFilledSearchSpace:e.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:e.searchSpaceManuallyCleared}),OF=(e,t,n)=>{var u;const s=e.map((d,h)=>({id:typeof d.id=="string"&&d.id.trim().length?d.id:Op(),label:typeof d.label=="string"&&d.label.trim().length?d.label:Aa(h+1),config:Oc(d.config),searchSpaceTexts:tj(d.searchSpaceTexts),searchSpaceFieldErrors:nj(d.searchSpaceFieldErrors),hasAutoFilledSearchSpace:!!d.hasAutoFilledSearchSpace,searchSpaceManuallyCleared:!!d.searchSpaceManuallyCleared})),r=new Set(s.map(d=>d.id)),i=typeof t=="string"&&r.has(t)?t:((u=s[0])==null?void 0:u.id)??null,l=Array.from(n??new Set).filter(d=>r.has(d));return i&&!l.includes(i)&&l.push(i),{strategies:s,activeId:i,expandedIds:Array.from(new Set(l)).sort()}},rj=(e,t)=>{var n;return t&&e.some(s=>s.id===t)?t:((n=e[0])==null?void 0:n.id)??""},aj=(e,t)=>{const n=new Set(e.map(r=>r.id)),s=t.filter(r=>n.has(r));return!s.length&&e[0]&&s.push(e[0].id),new Set(s)},Hd=e=>Mc(e),oj=(e,t)=>{const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0},TF=({nodeId:e,sourceId:t,graph:n,config:s,runtimeConfig:r,cvConfig:i,draftConfigState:l,renderParameterField:u,modelTypeParameter:d,modelTypeOptions:h,searchStrategyParameter:p,searchIterationsParameter:m,searchRandomStateParameter:f,scoringMetricParameter:y,setDraftConfigState:x,onSaveDraftConfig:_})=>{var qa,Va,oa,Xs;const v=Eo(),[w,M]=b.useState(null),[N,C]=b.useState(null),[j,E]=b.useState(null),[k,$]=b.useState(0),[T,P]=b.useState(null),[A,D]=b.useState(!1),[F,R]=b.useState(null),[z,q]=b.useState(!1),V=((s==null?void 0:s.targetColumn)??"").trim(),U=(s==null?void 0:s.problemType)==="regression"?"regression":"classification",W=(d==null?void 0:d.name)??"model_type",B=(p==null?void 0:p.name)??"search_strategy",I=(m==null?void 0:m.name)??"search_iterations",H=(f==null?void 0:f.name)??"search_random_state",J=(y==null?void 0:y.name)??"scoring_metric",G=l==null?void 0:l[W],Y=typeof G=="string"&&G.trim().length?G.trim():((r==null?void 0:r.modelType)??"").trim(),X=Ts({queryKey:["model-hyperparameters",Y],queryFn:()=>Cd(Y),enabled:!!Y,staleTime:5*60*1e3}),Z=((qa=X.data)==null?void 0:qa.fields)??[],ee=((Va=X.data)==null?void 0:Va.defaults)??{},Q=b.useMemo(()=>{if(!Z.length)return new Set;const te=new Set;return Z.forEach(_e=>{_e!=null&&_e.name&&te.add(_e.name)}),te},[Z]),ne=!!(i!=null&&i.enabled),he=(i==null?void 0:i.strategy)??"auto",ye=typeof(i==null?void 0:i.folds)=="number"?i.folds:5,ge=!!(i!=null&&i.shuffle),Ee=(i==null?void 0:i.randomState)??null,De=b.useMemo(()=>{const te=[];return((p==null?void 0:p.options)??[]).forEach(_e=>{if(!_e||typeof _e.value!="string")return;const me=_e.value.trim();if(!me.length)return;const Ae=me.toLowerCase();te.some(Me=>Me.toLowerCase()===Ae)||te.push(me)}),te},[p]),ke=b.useMemo(()=>De.length>0?[...De]:[...Ep],[De]),le=Fd(p==null?void 0:p.default,De),be=Fd(l==null?void 0:l[B],De)??le??ke[0]??Ep[0],Te=l==null?void 0:l[I];let Ie=null;if(typeof Te=="number"&&Number.isFinite(Te))Ie=Math.max(1,Math.floor(Te));else if(typeof Te=="string"){const te=Number(Te.trim());Number.isFinite(te)&&te>0&&(Ie=Math.max(1,Math.floor(te)))}const ue=l==null?void 0:l[H];let $e=null;if(typeof ue=="number"&&Number.isFinite(ue))$e=Math.trunc(ue);else if(typeof ue=="string"){const te=Number(ue.trim());Number.isFinite(te)&&($e=Math.trunc(te))}const Ye=typeof(m==null?void 0:m.default)=="number"&&Number.isFinite(m.default)?Math.max(1,Math.floor(m.default)):null,et=typeof(f==null?void 0:f.default)=="number"&&Number.isFinite(f.default)?Math.trunc(f.default):null,We=typeof(l==null?void 0:l[J])=="string"?String(l[J]).trim():"",mt=We.length?We:null,rt=b.useMemo(()=>ka(l==null?void 0:l.baseline_hyperparameters),[l==null?void 0:l.baseline_hyperparameters]),ft=b.useMemo(()=>ka(l==null?void 0:l.search_space),[l==null?void 0:l.search_space]),bt=b.useMemo(()=>Mp(ft.value),[ft.value]),zt=rt.value,Xe=rt.error,Ft=bt.value,Kt=ft.error??bt.error,Et=b.useMemo(()=>kp(zt,Q),[Q,zt]),Qt=b.useMemo(()=>Ap(Ft,Q),[Q,Ft]),wn=b.useMemo(()=>Object.keys(Et).length,[Et]),Mt=b.useMemo(()=>Object.keys(Qt).length,[Qt]),Zt=Mt>0,[Nn,Bt]=b.useState({}),[dt,Tn]=b.useState({}),[Xt,Nt]=b.useState(!1),[at,os]=b.useState(!1),Vt=b.useRef(null);if(!Vt.current){const te=Tp(l);let Ae=te.strategies.length>0?te.strategies.map(sj):[];const Me=rj(Ae,te.activeId),we=aj(Ae,te.expandedIds);Me&&!we.has(Me)&&Ae.length&&we.add(Me);const it=Hd(te);Vt.current={strategies:Ae,activeId:Me,expanded:we,signature:it}}const[pt,yt]=b.useState(()=>Vt.current?Vt.current.strategies:[]),[Gn,mn]=b.useState(()=>new Set(Vt.current?Array.from(Vt.current.expanded):[])),[vn,nn]=b.useState(()=>{var te;return((te=Vt.current)==null?void 0:te.activeId)??""}),jn=b.useRef(((oa=Vt.current)==null?void 0:oa.signature)??""),Jt=b.useRef(null),Xn=b.useRef(null),$t=b.useMemo(()=>pt.length?pt.find(_e=>_e.id===vn)??pt[0]:null,[vn,pt]),$n=b.useMemo(()=>Tp(l),[l]),xn=b.useMemo(()=>Hd($n),[$n]);b.useEffect(()=>{if(xn===jn.current)return;const te=$n.strategies.length?$n.strategies.map(sj):[],_e=rj(te,$n.activeId),me=aj(te,$n.expandedIds);_e&&!me.has(_e)&&te.length&&me.add(_e),Jt.current=null,yt(te),nn(_e),mn(me),jn.current=xn},[xn,$n,l]),b.useEffect(()=>{if(!pt.length)return;pt.some(_e=>_e.id===vn)||nn(pt[0].id)},[vn,pt]),b.useEffect(()=>{const te=OF(pt,vn,Gn),_e=Hd(te);jn.current!==_e&&x(me=>{const Ae=Tp(me),Me=Hd(Ae);if(Me===_e)return jn.current=Me,me??{};const we=me?{...me}:{};return te.strategies.length?we[Bo]=te.strategies.map(it=>({...it,config:fs(it.config),searchSpaceTexts:{...it.searchSpaceTexts},searchSpaceFieldErrors:{...it.searchSpaceFieldErrors}})):delete we[Bo],te.activeId?we[Uo]=te.activeId:delete we[Uo],te.expandedIds.length?we[Ho]=[...te.expandedIds]:delete we[Ho],jn.current=_e,we})},[vn,Gn,x,pt]),b.useEffect(()=>{if(!$t||Jt.current===$t.id)return;Jt.current=$t.id;const te=el($t.config);x(me=>({...kF(me),...te})),Bt($t.searchSpaceTexts??{}),Tn($t.searchSpaceFieldErrors??{}),Nt($t.hasAutoFilledSearchSpace??!1),os($t.searchSpaceManuallyCleared??!1);const _e=typeof(te==null?void 0:te[W])=="string"?String(te[W]):(r==null?void 0:r.modelType)??"";Xn.current=_e},[$t,W,r==null?void 0:r.modelType,x]),b.useEffect(()=>{if(!$t)return;const te=el(l),_e=JSON.stringify(te)!==JSON.stringify($t.config??{}),me=!oj(Nn,$t.searchSpaceTexts),Ae=!oj(dt,$t.searchSpaceFieldErrors),Me=$t.hasAutoFilledSearchSpace!==Xt,we=$t.searchSpaceManuallyCleared!==at;!_e&&!me&&!Ae&&!Me&&!we||yt(it=>it.map(He=>He.id!==$t.id?He:{...He,config:te,searchSpaceTexts:{...Nn},searchSpaceFieldErrors:{...dt},hasAutoFilledSearchSpace:Xt,searchSpaceManuallyCleared:at}))},[$t,l,Xt,dt,at,Nn]);const fn=b.useCallback(()=>{const te=pt.length+1,_e=el(l),me=new Set;pt.forEach(He=>{var ct;const ht=Fd((ct=He.config)==null?void 0:ct[B],ke);ht&&me.add(ht)});const Ae=ke.find(He=>!me.has(He))??be,Me=fs(_e),we=xr(Me)?Me:{};if(we[B]=Ae,Ae==="random"||Ae==="optuna"){const He=Ie!==null?Ie:Ye;He!==null?we[I]=He:delete we[I];const ht=$e!==null?$e:et;ht!==null?we[H]=ht:delete we[H]}else delete we[I],delete we[H];const it=MF(Aa(te),we,{searchSpaceTexts:{...Nn},searchSpaceFieldErrors:{},hasAutoFilledSearchSpace:Xt,searchSpaceManuallyCleared:at});yt(He=>[...He,it]),mn(He=>new Set([...He,it.id])),Jt.current=null,nn(it.id)},[ke,l,Xt,Ie,Ye,$e,et,at,Nn,be,B,I,H,yt,nn,mn,pt]),ws=b.useCallback(te=>{mn(_e=>{const me=new Set(_e);return me.has(te)?me.delete(te):me.add(te),me})},[]),Pn=b.useCallback(te=>{!te||te===vn||(Jt.current=null,nn(te),mn(_e=>{const me=new Set(_e);return me.add(te),me}))},[vn]),Ns=b.useCallback(te=>{let _e=null;yt(me=>{if(me.length<=1)return me;const Ae=me.filter(we=>we.id!==te);if(!Ae.length)return me;const Me=Ae.map((we,it)=>({...we,label:Aa(it+1)}));if(te===vn){Jt.current=null;const we=Me[0].id;_e=we,nn(we)}return Me}),mn(me=>{const Ae=new Set(me);return Ae.delete(te),_e&&Ae.add(_e),Ae})},[vn]),Qn=b.useMemo(()=>pt.map((te,_e)=>{var Nr,or;const me=te.config??{},Ae=me==null?void 0:me[W],Me=typeof Ae=="string"?Ae.trim():"",we=((Nr=h.find(cs=>cs.value===Me))==null?void 0:Nr.label)??Me,it=me==null?void 0:me[B],He=typeof it=="string"?it.trim():"",ht=(or=((p==null?void 0:p.options)??[]).find(cs=>cs.value===He))==null?void 0:or.label,ct=me==null?void 0:me[J],tt=typeof ct=="string"?ct.trim():"",Un=ka(me==null?void 0:me.baseline_hyperparameters).error,Wt=ka(me==null?void 0:me.search_space),Rn=Mp(Wt.value),Ds=Rn.value?Object.keys(Rn.value).length:0,Es=Rn.value?Object.values(Rn.value).reduce((cs,Ms)=>cs+(Array.isArray(Ms)?Ms.length:0),0):0,Qs=Un!==null||Object.values(te.searchSpaceFieldErrors).some(cs=>!!cs);return{id:te.id,label:te.label||Aa(_e+1),modelLabel:we||"Select model",searchStrategyLabel:ht??(He||"Random search"),scoringLabel:tt||"Estimator default",parameterCount:Ds,candidateCount:Es,hasErrors:Qs}}),[h,W,J,p,B,pt]);b.useEffect(()=>{const te=Xn.current;if(te===null){Xn.current=Y;return}te!==Y&&(Xn.current=Y,Bt({}),Tn({}),Nt(!1),os(!1))},[Y]),b.useEffect(()=>{!Y||!Z.length||Bt(te=>{const _e={...te};let me=!1;return Z.forEach(Ae=>{if(dt[Ae.name])return;const Me=Qt[Ae.name],we=Array.isArray(Me)&&Me.length>0?Me.map(it=>ej(Ae,it)).join(", "):"";_e[Ae.name]!==we&&(_e[Ae.name]=we,me=!0)}),me?_e:te})},[Qt,Z,Y,dt]),b.useEffect(()=>{if(!Y||!Z.length||at)return;if(Zt){Xt||Nt(!0);return}if(Xt)return;const te=SF(Z,ee);Object.keys(te).length&&(Nt(!0),Tn({}),Bt(()=>{const _e={};return Z.forEach(me=>{if(!te[me.name])return;const Ae=te[me.name].map(Me=>ej(me,Me)).filter(Me=>Me.length>0).join(", ");_e[me.name]=Ae}),_e}),x(_e=>{const me=_e?{..._e}:{};return me.search_space=te,me}))},[Xt,ee,Z,Y,Zt,at,x]);const[is,js]=b.useState(mt??"");b.useEffect(()=>{js(mt??"")},[mt]);const Fn=b.useMemo(()=>EF[U==="regression"?"regression":"classification"],[U]),Zn=(y==null?void 0:y.label)??"Scoring metric",Ht=(y==null?void 0:y.description)??"Pick the evaluation metric used to rank candidates.",Qe=b.useMemo(()=>`tuning-${e}-scoring-metric`,[e]),Ue=b.useMemo(()=>Object.values(dt).some(te=>!!te),[dt]),Ln=b.useCallback((te,_e)=>{Q.has(te)&&x(me=>{const Ae={...me},Me=ka(me==null?void 0:me.baseline_hyperparameters).value??{},it={...kp(Me,Q)};return _e===void 0?delete it[te]:it[te]=_e,Object.keys(it).length>0?Ae.baseline_hyperparameters=it:delete Ae.baseline_hyperparameters,Ae})},[Q,x]),Cs=b.useCallback((te,_e)=>{Bt(Me=>({...Me,[te.name]:_e}));const{values:me,error:Ae}=CF(te,_e);Tn(Me=>({...Me,[te.name]:Ae})),!Ae&&x(Me=>{const we={...Me},it=ka(Me==null?void 0:Me.search_space).value??{},ht={...Ap(it,Q)};return me.length>0?ht[te.name]=me.map(ct=>fs(ct)):delete ht[te.name],Object.keys(ht).length>0?we.search_space=ht:delete we.search_space,we})},[Q,x]),Jn=b.useCallback(te=>{Ln(te,void 0)},[Ln]),Ss=b.useCallback(()=>{x(te=>{if(!te||!te.baseline_hyperparameters)return te??{};const _e={...te};return delete _e.baseline_hyperparameters,_e})},[x]),ie=b.useCallback(()=>{os(!0),Nt(!0),Bt({}),Tn({}),x(te=>{if(!te||!te.search_space)return te??{};const _e={...te};return delete _e.search_space,_e})},[x]),xe=b.useCallback(te=>{js(te);const _e=te.trim();x(me=>{const Ae={...me};return _e.length>0?Ae.scoring_metric=_e:delete Ae.scoring_metric,Ae})},[x]),Le=b.useCallback(te=>{if(!(te!=null&&te.name)||!Q.has(te.name))return null;const _e=`baseline-${e}-${te.name}`,me=Et[te.name],Ae=me!==void 0,Me=ee==null?void 0:ee[te.name],we=te.label??te.name,it=te.description,He=Me!==void 0?`Default: ${Bd(Me)}`:"Default: estimator setting";let ht;if(te.type==="number"){const ct=typeof me=="number"?String(me):"";ht=o.jsx("input",{id:_e,type:"number",className:"canvas-modal__parameter-input",value:ct,onChange:tt=>{const Ct=tt.target.value;if(!Ct.length){Jn(te.name);return}const Un=Number(Ct);Number.isFinite(Un)&&Ln(te.name,Un)},min:te.min,max:te.max,step:te.step,placeholder:"Leave blank to use default"})}else if(te.type==="select"){const ct=Ae?String(me):"";ht=o.jsxs("select",{id:_e,className:"canvas-modal__parameter-select",value:ct,onChange:tt=>{const Ct=tt.target.value;if(!Ct.length){Jn(te.name);return}Ln(te.name,Ct)},children:[o.jsx("option",{value:"",children:"Use default"}),(te.options??[]).map(tt=>o.jsx("option",{value:tt.value,children:tt.label},tt.value))]})}else if(te.type==="boolean"){const ct=Ae?me?"true":"false":"";ht=o.jsxs("select",{id:_e,className:"canvas-modal__parameter-select",value:ct,onChange:tt=>{const Ct=tt.target.value;if(!Ct.length){Jn(te.name);return}Ln(te.name,Ct==="true")},children:[o.jsx("option",{value:"",children:"Use default"}),o.jsx("option",{value:"true",children:"True"}),o.jsx("option",{value:"false",children:"False"})]})}else{const ct=typeof me=="string"?me:"";ht=o.jsx("input",{id:_e,type:"text",className:"canvas-modal__parameter-input",value:ct,onChange:tt=>{const Ct=tt.target.value;if(!Ct.length){Jn(te.name);return}Ln(te.name,Ct)},placeholder:"Leave blank to use default"})}return o.jsxs("div",{className:"canvas-modal__parameter",children:[o.jsxs("label",{htmlFor:_e,className:"canvas-modal__parameter-label",children:[we,it&&o.jsx("span",{className:"canvas-modal__parameter-description",children:it})]}),ht,o.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.4rem",gap:"0.75rem"},children:o.jsx("small",{style:{color:"rgba(148, 163, 184, 0.85)"},children:Ae?`Override: ${Bd(me)}`:He})})]},te.name)},[Q,Et,ee,e,Ln]),jt=b.useCallback(te=>{if(!(te!=null&&te.name)||!Q.has(te.name))return null;const _e=`search-${e}-${te.name}`,me=Nn[te.name]??"",Ae=Qt[te.name],Me=Array.isArray(Ae)?Ae.length:0,we=dt[te.name],it=ee==null?void 0:ee[te.name],He=te.type==="number"?"Comma or newline separated numbers (e.g. 0.01, 0.1, 1)":te.type==="boolean"?"Enter true/false values, separated by commas or new lines":te.type==="select"?"Comma or newline separated option values":"Comma or newline separated values",ht=Array.isArray(Ae)?Ae.slice(0,3).map(ct=>Bd(ct)).join(", "):"";return o.jsxs("div",{className:"canvas-modal__parameter",children:[o.jsxs("label",{htmlFor:_e,className:"canvas-modal__parameter-label",children:[te.label??te.name,te.description&&o.jsx("span",{className:"canvas-modal__parameter-description",children:te.description})]}),o.jsx("textarea",{id:_e,className:"canvas-modal__parameter-input",rows:3,value:me,onChange:ct=>Cs(te,ct.target.value),placeholder:He,style:{minHeight:"92px",resize:"vertical"}}),o.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.4rem",gap:"0.75rem",flexWrap:"wrap"},children:o.jsx("small",{style:{color:"rgba(148, 163, 184, 0.85)"},children:Me>0?`Configured ${Me} value${Me===1?"":"s"}${ht?` (${ht}${Me>3?"":""})`:""}`:`Default: ${Bd(it)}`})}),we&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.5rem"},children:we})]},te.name)},[Q,Qt,Cs,ee,e,dt,Nn]),Ce=b.useMemo(()=>{if(!Zt)return{parameterCount:0,candidateProduct:null};const te=Object.values(Qt),_e=te.length;let me=null;if(te.length>0){let Ae=1,Me=!1;te.forEach(we=>{Ae*=Math.max(we.length,1),(!Number.isFinite(Ae)||Ae>1e6)&&(Me=!0)}),me=Me?null:Ae}return{parameterCount:_e,candidateProduct:me}},[Qt,Zt]),ot=b.useMemo(()=>!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges)?null:{nodes:n.nodes,edges:n.edges},[n]),lt=b.useCallback(te=>{if(!ot)return null;const _e=fs(ot);if(!_e||!Array.isArray(_e.nodes))return ot;const me=Oc(te),Ae=Object.keys(me).length>0;return _e.nodes=_e.nodes.map(Me=>{if(!Me||Me.id!==e)return Me;const we=(Me==null?void 0:Me.data)??{},it=(we==null?void 0:we.config)??{},He=Oc(it),ht=Ae?{...He,...me}:He;return{...Me,data:{...we,config:ht,isConfigured:!0}}}),_e},[ot,e]),Rt=b.useMemo(()=>{const te=lt(l);return te||ot},[l,ot,lt]),kt=b.useMemo(()=>{if(!n||!Array.isArray(n.nodes)||!Array.isArray(n.edges))return null;const te=n.nodes,_e=n.edges;return(()=>{var it;const we=te.find(He=>(He==null?void 0:He.id)===e);return we?JN((it=we==null?void 0:we.data)==null?void 0:it.connectedSplits):[]})().includes("validation")||_e.some(we=>!we||(typeof we.target=="string"?we.target:null)!==e?!1:(typeof we.sourceHandle=="string"?we.sourceHandle.toLowerCase():"").includes("validation"))?!0:_e.some(we=>{var tt;if(!we||(typeof we.target=="string"?we.target:null)!==e)return!1;const He=typeof we.source=="string"?we.source:null;if(!He)return!1;const ht=te.find(Ct=>(Ct==null?void 0:Ct.id)===He);return ht?JN((tt=ht==null?void 0:ht.data)==null?void 0:tt.activeSplits).includes("validation"):!1})?!1:null},[n,e]);b.useEffect(()=>{let te=!1;return!t||!ot?(P(null),()=>{te=!0}):(zo(t,ot).then(_e=>{te||P(_e)}).catch(()=>{te||P(null)}),()=>{te=!0})},[ot,t]),b.useEffect(()=>{let te=!1;C(null);const _e=Rt??ot;return!t||!_e?(M(null),()=>{te=!0}):(zo(t,_e).then(me=>{te||M(me)}).catch(me=>{te||(C((me==null?void 0:me.message)??"Unable to compute pipeline ID"),M(null))}),()=>{te=!0})},[ot,Rt,t]),b.useEffect(()=>{if(!w||!T){D(!1);return}D(w!==T)},[w,T]);const Ut=!!(t&&e),At=b.useMemo(()=>["feature-canvas","hyperparameter-tuning-jobs",t??"none",w??"pending",e],[e,w,t]),sn=Ts({queryKey:At,queryFn:async()=>{var _e;const te={datasetSourceId:t||void 0,nodeId:e,limit:5};if(w){const me=await pc({...te,pipelineId:w});if((((_e=me==null?void 0:me.jobs)==null?void 0:_e.length)??0)>0)return me}return pc(te)},enabled:Ut,retry:(te,_e)=>_e.message.includes("Sign in")?!1:te<2,refetchInterval:te=>{const _e=te.state.data;return((_e==null?void 0:_e.jobs)??[]).some(Me=>Me.status==="queued"||Me.status==="running")?5e3:!1}}),{mutateAsync:ls,isPending:Cn,error:en}=Cu({mutationFn:iw,onSuccess:te=>{const _e=Array.isArray(te.jobs)?te.jobs.length:0,me=_e>0?te.jobs[0]:null;E(me),$(_e),v.invalidateQueries({queryKey:At})}}),rn=b.useMemo(()=>{const te=[];return t||te.push("Select a dataset before launching tuning jobs."),(!ot||!ot.nodes.length)&&te.push("Connect this node to an upstream pipeline before tuning."),V||te.push("Set a target column before tuning."),kt===!1&&te.push("Connect the validation split to this node to enable tuning."),Y||te.push("Choose a model type before enqueuing tuning jobs."),pt.length===0&&te.push("Add a tuning strategy before launching tuning jobs."),Zt||te.push("Define at least one hyperparameter in the search space."),Xe&&te.push(Xe),Kt&&te.push(Kt),Ue&&te.push("Resolve invalid candidate values in the search space."),(be==="random"||be==="optuna")&&!Ie&&te.push("Provide the maximum iterations for random or Optuna search."),ne&&ye<2&&te.push("Cross-validation requires at least 2 folds."),N&&te.push(N),te},[Xe,ne,ye,ot,Zt,Ue,Y,N,Ie,Kt,be,t,V,kt,pt.length]),Bn=((Xs=sn.data)==null?void 0:Xs.jobs)??[],Sn=sn.isLoading||sn.isFetching,aa=sn.error,Ba=b.useMemo(()=>!!(en instanceof Error&&Xi(en.message)||F&&Xi(F)||j&&Sc(j)||Bn.some(te=>Sc(te))),[F,en,j,Bn]),vt=LN({graph:n,nodeId:e,modelType:Y,problemType:U,modelTypeOptions:h,enabled:Ba});b.useEffect(()=>{vt||q(!1)},[vt]);const hl=rn.length>0||Ue||!w||!t||!ot||pt.length===0||!Zt||Cn,ti=b.useMemo(()=>d?h.length?{...d,options:h}:d:null,[h,d]),Ua=b.useCallback(async()=>{if(!w||!t||!ot||pt.length===0)return;if(_){try{const Me=_({closeModal:!1});D(!1),Me&&typeof Me.then=="function"&&await Me}catch{}await new Promise(Me=>setTimeout(Me,100))}const te=async()=>{const Me=[],we=[],it=async He=>{if(!He)return new Set;if(He===Y)return Q;const ht=["model-hyperparameters",He],ct=v.getQueryData(ht),tt=Ct=>{const Un=new Set;return(Ct??[]).forEach(Wt=>{Wt!=null&&Wt.name&&Un.add(Wt.name)}),Un};if(ct)return tt(ct.fields);try{const Ct=await v.fetchQuery({queryKey:ht,queryFn:()=>Cd(He)});return tt(Ct==null?void 0:Ct.fields)}catch{return new Set}};for(let He=0;He<pt.length;He+=1){const ht=pt[He],ct=ht.label||Aa(He+1),tt=el(ht.config),Ct=tt==null?void 0:tt[W],Un=typeof Ct=="string"&&Ct.trim().length?Ct.trim():Y;if(!Un){we.push(`${ct} is missing a model selection.`);continue}const Wt=Fd(tt==null?void 0:tt[B],ke)??le??"random",Rn=await it(Un),Es=ka(tt==null?void 0:tt.baseline_hyperparameters).value??{},Qs=Rn.size>0?kp(Es,Rn):fs(Es),Nr=ka(tt==null?void 0:tt.search_space);if(Nr.error){we.push(`${ct} has invalid search space: ${Nr.error}`);continue}const or=Mp(Nr.value);if(or.error){we.push(`${ct} has invalid search space: ${or.error}`);continue}const cs=or.value??{},Ms=Rn.size>0?Ap(cs,Rn):fs(cs);if(!Ms||Object.keys(Ms).length===0){we.push(`${ct} requires at least one hyperparameter in the search space.`);continue}if(Object.values(ht.searchSpaceFieldErrors??{}).some(on=>!!on)){we.push(`${ct} has search space entries that need attention.`);continue}const Wa=Object.keys(Ms).length;let zs=null;if(Wa>0){let on=1,Dn=!1;Object.values(Ms).forEach(es=>{const gl=Array.isArray(es)?es.length:0;on*=Math.max(gl,1),(!Number.isFinite(on)||on>1e6)&&(Dn=!0)}),zs=Dn?null:on}const Ya=tt==null?void 0:tt[J],ia=typeof Ya=="string"?Ya.trim():"",Ka=ia.length?ia:null,Ga=()=>{const on=tt==null?void 0:tt[I];let Dn=null;if(typeof on=="number"&&Number.isFinite(on))Dn=Math.max(1,Math.floor(on));else if(typeof on=="string"){const es=Number(on.trim());Number.isFinite(es)&&es>0&&(Dn=Math.max(1,Math.floor(es)))}return Dn===null&&(Wt==="random"||Wt==="optuna")?Ye!==null?Ye:null:Dn},Xa=()=>{const on=tt==null?void 0:tt[H];let Dn=null;if(typeof on=="number"&&Number.isFinite(on))Dn=Math.trunc(on);else if(typeof on=="string"){const es=Number(on.trim());Number.isFinite(es)&&(Dn=Math.trunc(es))}return Dn===null&&(Wt==="random"||Wt==="optuna")?et!==null?et:null:Dn},Qa=Ga(),En=Xa(),an={};V&&(an.target_column=V),an.problem_type=U,an.strategy_id=ht.id,an.strategy_label=ct,an.strategy_index=He+1,an.search_strategy=Wt,Qa!==null&&(Wt==="random"||Wt==="optuna")&&(an.max_iterations=Qa),Ka&&(an.scoring_metric=Ka),En!==null&&(an.random_state=En),an.search_space_keys=Object.keys(Ms),Wa>0&&(an.search_space_parameters=Wa),zs!==null&&(an.search_space_candidates=zs),an.cross_validation={enabled:ne,strategy:he,folds:ye,shuffle:ge,random_state:Ee};const Za=lt(tt)??ot;if(!Za){we.push(`Unable to build pipeline graph for ${ct}.`);continue}const la=Qs&&Object.keys(Qs).length>0?fs(Qs):void 0,Uc=fs(Ms),Ja={dataset_source_id:t,pipeline_id:w,node_id:e,model_type:Un,model_types:[Un],search_strategy:Wt,search_space:Uc,baseline_hyperparameters:la,n_iterations:Wt==="random"||Wt==="optuna"?Qa??void 0:void 0,scoring:Ka??void 0,random_state:En??void 0,cross_validation:{enabled:ne,strategy:he,folds:ye,shuffle:ge,random_state:Ee},metadata:an,job_metadata:an,run_tuning:!0,graph:Za,target_node_id:e};Me.push({payload:Ja,label:ct})}return{plans:Me,issues:we}};R(null);const{plans:_e,issues:me}=await te();if(!_e.length){me.length&&R(me.join(" "));return}const Ae=[];for(const{payload:Me}of _e)try{const we=await ls(Me);Array.isArray(we==null?void 0:we.jobs)&&we.jobs.length&&Ae.push(...we.jobs)}catch(we){we instanceof Error&&we.message?R(we.message):R("Failed to enqueue one or more tuning jobs.");return}if(Ae.length){const Me=Ae[Ae.length-1];E(Me),$(Ae.length)}},[Q,ne,ye,Ee,ge,he,ls,ot,lt,Y,W,e,_,le,v,w,U,J,Ye,I,et,H,B,R,D,t,pt,V]),pl=b.useCallback(()=>{Ut&&sn.refetch()},[Ut,sn]),Ha=te=>{var Un,Wt,Rn,Ds,Es;const _e=wF[te.status]??te.status,Ae=(((Un=h.find(Qs=>Qs.value===te.model_type))==null?void 0:Un.label)??te.model_type??"").trim(),Me=(()=>{switch(te.search_strategy){case"grid":return"Grid search";case"halving":return"Successive halving";case"halving_random":return"Successive halving (randomized)";case"optuna":return"Optuna search";default:return"Random search"}})(),we=te.updated_at?Yn(te.updated_at):null,it=te.updated_at||te.created_at,He=it?we??new Date(it).toLocaleString():null,ht=typeof te.error_message=="string"?te.error_message.trim():"",ct=[];Ae&&ct.push(`Model ${Ae}`),ct.push(Me),Array.isArray(te.results)&&te.results.length>0&&ct.push(`${te.results.length} candidates`);const tt=typeof te.best_score=="number"&&Number.isFinite(te.best_score)?te.best_score:typeof((Wt=te.metrics)==null?void 0:Wt.best_score)=="number"?te.metrics.best_score:null;tt!==null&&ct.push(`Best score ${NF(tt)}`);const Ct=String(((Rn=te.metrics)==null?void 0:Rn.scoring)??((Ds=te.metrics)==null?void 0:Ds.scorer)??((Es=te.metadata)==null?void 0:Es.scoring_metric)??"").trim();if(Ct&&ct.push(`Scoring ${Ct}`),te.status==="failed"&&ht){const Qs=ht.replace(/\s+/g," ");ct.push(`Error: ${Qs}`)}return He&&ct.push(`Updated ${He}`),o.jsxs("li",{children:[o.jsxs("strong",{children:["Run ",te.run_number]}),"  ",_e,ct.length?`  ${ct.join("  ")}`:""]},te.id)};return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Hyperparameter tuning jobs"}),o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:fn,children:"Add strategy"}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:pl,disabled:!Ut||Sn,children:Sn?"Refreshing":"Refresh jobs"})]})]}),o.jsx("p",{className:"canvas-modal__note",children:"Launch background tuning jobs that evaluate candidate hyperparameters via cross-validation. Jobs are versioned per pipeline and surface the best configuration when finished."}),w&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Pipeline ID: ",o.jsx("code",{children:w})]}),A&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{background:"rgba(251, 146, 60, 0.1)",borderLeft:"3px solid rgba(251, 146, 60, 0.8)",padding:"0.75rem 1rem",margin:"0.75rem 0"},children:[o.jsx("strong",{children:" Unsaved Configuration Changes"}),o.jsx("br",{}),"Enqueuing a tuning job saves the current configuration so results align with this pipeline snapshot."]}),rn.map((te,_e)=>o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:te},`tuning-prereq-${_e}`)),en instanceof Error&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:en.message}),F&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:F}),aa&&!(en instanceof Error)&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:aa.message||"Unable to load tuning jobs."}),j&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:k>1?o.jsxs("span",{children:["Queued ",k," tuning jobs. Latest job ",j.id," (run ",j.run_number,")."]}):o.jsxs("span",{children:["Tuning job ",j.id," queued (run ",j.run_number,")."]})}),Zt&&Ce.parameterCount>0&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Search space covers ",Ce.parameterCount," hyperparameter",Ce.parameterCount===1?"":"s",Ce.candidateProduct!==null?`  up to ${Ce.candidateProduct.toLocaleString()} combinations`:"","."]}),o.jsxs("div",{className:"canvas-imputer__list",style:{marginTop:"1.25rem"},children:[pt.length===0&&o.jsx("p",{style:{margin:"0",padding:"1rem 1.25rem",border:"1px dashed rgba(148, 163, 184, 0.4)",borderRadius:"6px",color:"rgba(148, 163, 184, 0.85)",background:"rgba(15, 23, 42, 0.35)"},children:'No tuning strategies configured yet. Use "Add strategy" to define your search plan.'}),pt.map((te,_e)=>{const me=Qn[_e],Ae=!!($t&&$t.id===te.id),Me=Gn.has(te.id),we=[];if(me!=null&&me.modelLabel&&we.push(me.modelLabel),me!=null&&me.searchStrategyLabel&&we.push(me.searchStrategyLabel),me!=null&&me.scoringLabel&&we.push(`Scoring ${me.scoringLabel}`),me!=null&&me.parameterCount){const He=me.candidateCount?`${me.parameterCount} param${me.parameterCount===1?"":"s"}  ${me.candidateCount} candidate${me.candidateCount===1?"":"s"}`:`${me.parameterCount} param${me.parameterCount===1?"":"s"}`;we.push(He)}else we.includes("Needs attention")||we.push("No search values");me!=null&&me.hasErrors&&we.push("Needs attention");const it=we.length>0?we.join("  "):"Configure strategy settings";return o.jsxs("div",{className:"canvas-imputer__card",children:[o.jsxs("div",{className:"canvas-imputer__card-header",children:[o.jsxs("button",{type:"button",className:"canvas-imputer__card-toggle",onClick:()=>{ws(te.id),Ae||Pn(te.id)},"aria-expanded":Me,"aria-controls":`tuning-strategy-body-${te.id}`,children:[o.jsx("span",{className:`canvas-imputer__toggle-icon${Me?" canvas-imputer__toggle-icon--open":""}`,"aria-hidden":"true"}),o.jsxs("span",{className:"canvas-imputer__card-text",children:[o.jsx("span",{className:"canvas-imputer__card-title",children:(me==null?void 0:me.label)??Aa(_e+1)}),o.jsx("span",{className:"canvas-imputer__card-summary",children:it})]})]}),pt.length>1&&o.jsx("button",{type:"button",className:"canvas-imputer__remove",onClick:()=>Ns(te.id),"aria-label":`Remove ${(me==null?void 0:me.label)??Aa(_e+1)}`,children:"Remove"})]}),Me&&Ae&&o.jsxs("div",{className:"canvas-imputer__card-body",id:`tuning-strategy-body-${te.id}`,children:[o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[ti&&u(ti),p&&u(p),(be==="random"||be==="optuna")&&m&&u(m),(be==="random"||be==="optuna")&&f&&u(f)]}),o.jsxs("div",{style:{marginTop:"1rem",padding:"1rem 1.25rem",background:"rgba(15, 23, 42, 0.25)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[o.jsx("div",{style:{fontWeight:600,color:"#e2e8f0",display:"block"},children:Zn}),o.jsx("p",{style:{margin:"0.4rem 0 0.75rem",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:Ht}),o.jsxs("div",{id:Qe,style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.4rem 0.75rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",fontSize:"0.85rem",maxWidth:"320px",marginBottom:"0.75rem"},children:[o.jsx("span",{style:{opacity:.75},children:"Selected:"}),o.jsx("strong",{style:{color:"#e2e8f0"},children:is||"Estimator default"})]}),o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.75rem"},children:[Fn.map(He=>o.jsx("button",{type:"button",onClick:()=>xe(He.value),style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:is===He.value?"rgba(59, 130, 246, 0.2)":"rgba(15, 23, 42, 0.35)",color:is===He.value?"#bfdbfe":"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:He.label},He.value)),o.jsx("button",{type:"button",onClick:()=>xe(""),style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:"Reset to default"})]})]}),Y&&Z.length>0&&o.jsxs("div",{style:{marginTop:"1.25rem",padding:"1.25rem",background:"rgba(15, 23, 42, 0.2)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"0.75rem"},children:[o.jsxs("div",{children:[o.jsx("h4",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#e2e8f0"},children:"Baseline hyperparameter overrides"}),o.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:"Pre-fill model defaults before the search runs. Leave fields blank to keep the template values."})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.5rem"},children:[o.jsx("span",{style:{fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:wn>0?`${wn} override${wn===1?"":"s"} configured`:"Using template defaults"}),wn>0&&o.jsx("button",{type:"button",onClick:Ss,style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:"rgba(15, 23, 42, 0.35)",color:"rgba(203, 213, 225, 0.9)",cursor:"pointer"},children:"Reset overrides"})]})]}),Xe&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.75rem"},children:Xe}),o.jsx("div",{style:{marginTop:"1rem",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:Z.map(Le)})]}),Y&&Z.length>0&&o.jsxs("div",{style:{marginTop:"1.25rem",padding:"1.25rem",background:"rgba(15, 23, 42, 0.2)",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:"0.75rem"},children:[o.jsxs("div",{children:[o.jsx("h4",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#e2e8f0"},children:"Search space"}),o.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:"Provide candidate values for each hyperparameter. Separate entries with commas or new lines."})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.5rem"},children:[o.jsx("span",{style:{fontSize:"0.85rem",color:"rgba(148, 163, 184, 0.85)"},children:Mt>0?`${Mt} parameter${Mt===1?"":"s"} targeted`:"No parameters queued for tuning yet"}),o.jsx("button",{type:"button",onClick:ie,disabled:Mt===0,style:{padding:"0.35rem 0.7rem",fontSize:"0.8rem",borderRadius:"999px",border:"1px solid rgba(148, 163, 184, 0.35)",background:Mt===0?"rgba(15, 23, 42, 0.2)":"rgba(15, 23, 42, 0.35)",color:Mt===0?"rgba(148, 163, 184, 0.5)":"rgba(203, 213, 225, 0.9)",cursor:Mt===0?"not-allowed":"pointer"},children:"Clear search space"})]})]}),Kt&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",style:{marginTop:"0.75rem"},children:Kt}),Ue&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",style:{marginTop:"0.75rem"},children:"Fix the highlighted search entries before launching tuning jobs."}),o.jsx("div",{style:{marginTop:"1rem",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:"1rem"},children:Z.map(jt)})]})]})]},te.id)})]}),ne&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Cross-validation evaluates each candidate with ",ye," folds before reporting aggregate metrics."]}),vt&&o.jsxs("div",{className:"canvas-modal__note canvas-modal__note--warning",style:{margin:"0.75rem 0",borderLeft:"3px solid rgba(251, 191, 36, 0.9)",background:"rgba(251, 191, 36, 0.12)",padding:"0.75rem 1rem"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"0.75rem"},children:[o.jsxs("div",{children:[o.jsxs("strong",{children:[" ",vt.headline]}),o.jsx("p",{style:{margin:"0.35rem 0 0",fontSize:"0.85rem"},children:vt.summary})]}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>q(te=>!te),style:{whiteSpace:"nowrap"},children:z?"Hide tips":"Show tips"})]}),z&&o.jsx("ul",{style:{margin:"0.75rem 0 0 1rem",padding:0,listStyle:"disc",fontSize:"0.85rem"},children:vt.details.map((te,_e)=>o.jsx("li",{style:{marginBottom:"0.35rem"},children:te},`tuning-scaling-tip-${_e}`))})]}),o.jsx("div",{className:"canvas-modal__actions",children:o.jsx("button",{type:"button",className:"btn btn-primary",onClick:Ua,disabled:hl,children:Cn?"Queuing":"Launch tuning job"})}),Sn&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"Loading recent jobs"}),!Sn&&Bn.length===0&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--muted",children:"No tuning jobs found for this node."}),Bn.length>0&&o.jsx("ul",{className:"canvas-modal__note-list",children:Bn.map(Ha)})]})},$p={undersampling:{auto:"auto (match majority to the smallest class)",majority:"majority (down-sample only the majority class)","not minority":"not minority (down-sample all but the minority class)","not majority":"not majority (down-sample every class except the majority)",all:"all (down-sample every class)"},oversampling:{auto:"auto (boost minority class to majority size)",minority:"minority (only over-sample the minority class)","not minority":"not minority (over-sample every class except the minority)","not majority":"not majority (avoid synthesising the majority class)",all:"all (over-sample all classes equally)"}},$F=(e,t)=>{if(e==null||e==="")return $p[t].auto;if(typeof e=="number"){if(!Number.isFinite(e))return $p[t].auto;const s=Math.max(Math.min(e,1),0),r=s*100,i=s.toFixed(s>=.1||s===0?2:3),l=t==="undersampling"?"majority":"majority baseline";return`${i} ratio (${r.toFixed(1)}% of ${l})`}const n=e.trim().toLowerCase();return $p[t][n]??n},PF=(e,t)=>{const n=t==="oversampling"?["over-sampling","oversampling","smote","adasyn","tomek","svm smote","kmeans smote","borderline smote"]:["under-sampling","undersampling","resampling"];for(let s=e.length-1;s>=0;s-=1){const r=e[s];if(typeof r!="string")continue;const i=r.toLowerCase();if(n.some(l=>i.includes(l)))return r}return null},LF=(e,t)=>t?"Missing":e.length?e:"Empty string",RF=({mode:e="undersampling",sourceId:t,hasReachableSource:n,previewState:s,onRefreshPreview:r,config:i,methodParameter:l,targetColumnParameter:u,samplingStrategyParameter:d,randomStateParameter:h,replacementParameter:p,kNeighborsParameter:m,renderParameterField:f,formatMetricValue:y,formatMissingPercentage:x,schemaGuard:_})=>{var I;const v=s.data,w=s.status,M=Array.isArray(v==null?void 0:v.applied_steps)?v==null?void 0:v.applied_steps:[],N=b.useMemo(()=>PF(M,e),[M,e]),C=(i==null?void 0:i.targetColumn)??"",j=(i==null?void 0:i.method)||(typeof(l==null?void 0:l.default)=="string"?l.default:""),E=b.useMemo(()=>{const H=Array.isArray(l==null?void 0:l.options)?l==null?void 0:l.options:[];if(j){const J=H.find(G=>G.value===j);return J!=null&&J.label?J.label:j.replace(/_/g," ")}return H.length>0?H[0].label??H[0].value:e==="undersampling"?"Random under-sampling":"Synthetic over-sampling"},[j,l==null?void 0:l.options,e]),k=b.useMemo(()=>$F(i==null?void 0:i.samplingStrategy,e),[i==null?void 0:i.samplingStrategy,e]),$=b.useMemo(()=>(i==null?void 0:i.randomState)===null||(i==null?void 0:i.randomState)===void 0?"Not set":Number.isFinite(i.randomState)?String(i.randomState):"Not set",[i==null?void 0:i.randomState]),T=b.useMemo(()=>{if(e!=="oversampling")return null;const H=i==null?void 0:i.kNeighbors;if(typeof H=="number"&&Number.isFinite(H))return String(Math.max(1,Math.round(H)));if(m&&typeof m.default=="number"){const J=m.default;if(Number.isFinite(J))return String(Math.max(1,Math.round(J)))}return"Default"},[i==null?void 0:i.kNeighbors,m,e]),P=(i==null?void 0:i.replacement)===null||(i==null?void 0:i.replacement)===void 0?null:i.replacement?"With replacement":"Without replacement",A=b.useMemo(()=>{if(w!=="success"||!v||!C)return{rows:[],total:0,truncated:!1};const H=Array.isArray(v.sample_rows)?v.sample_rows:[];if(!H.length)return{rows:[],total:0,truncated:!1};const J=new Map;H.forEach(ne=>{if(!ne||typeof ne!="object")return;const he=ne[C],ye=he==null,ge=ye?"__missing__":String(he),Ee=LF(ye?"":ge,ye),De=J.get(ge);De?De.count+=1:J.set(ge,{label:Ee,count:1,percentage:0,isMissing:ye})});const G=Array.from(J.values()).sort((ne,he)=>he.count-ne.count),Y=G.reduce((ne,he)=>ne+he.count,0),X=8,Z=G.length>X;return{rows:(Z?G.slice(0,X):G).map(ne=>({...ne,percentage:Y>0?ne.count/Y*100:0})),total:Y,truncated:Z}},[v,w,C]),D=((I=v==null?void 0:v.metrics)==null?void 0:I.row_count)??null,F=!!t&&n&&w!=="loading"&&!(_!=null&&_.blocked),R=b.useMemo(()=>t?n?null:"Link this node to the dataset input to evaluate class balance.":"Connect to a dataset to preview class distributions.",[n,t]),z=b.useMemo(()=>!(_!=null&&_.blocked)||!_.details.length?"":_.details.map(H=>H.logical_family?`${H.name} (${H.logical_family})`:H.name).join(", "),[_]),q=!C,V=!!C&&Array.isArray(v==null?void 0:v.columns)&&!(v!=null&&v.columns.includes(C)),U=e==="undersampling"?"Class undersampling":"Class oversampling",W=e==="undersampling"?"Random under-sampling trims majority-class examples to mitigate imbalance before training downstream models. It preserves minority class signals but can discard information from majority classes when ratios are aggressive.":"Synthetic over-sampling boosts minority representation by generating new samples. Integer feature columns are temporarily cast to float so synthesized values can include decimals, which helps models learn rare classes while requiring careful preprocessing to avoid noise.",B=e==="undersampling"?"enable undersampling":"enable oversampling";return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:U}),o.jsx("div",{className:"canvas-modal__section-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:r,disabled:!F,children:w==="loading"?"Refreshing":"Refresh preview"})})]}),o.jsx("p",{className:"canvas-modal__note",children:W}),R&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:R}),q&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Specify a target column to compute class ratios and ",B,"."]}),(_==null?void 0:_.blocked)&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:[_.message,z&&o.jsxs(o.Fragment,{children:[" ","Columns: ",z,"."]})]}),w==="error"&&s.error&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:s.error}),V&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--warning",children:["Target column ",C," is not present in the current preview. Check upstream nodes or refresh the dataset snapshot."]}),N&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--info",children:N}),o.jsxs("ul",{className:"canvas-modal__note-list",children:[o.jsxs("li",{children:["Method: ",o.jsx("strong",{children:E})]}),o.jsxs("li",{children:["Sampling strategy: ",o.jsx("strong",{children:k})]}),e==="oversampling"&&T&&o.jsxs("li",{children:["k-neighbors: ",o.jsx("strong",{children:T})]}),P&&o.jsxs("li",{children:["Replacement: ",o.jsx("strong",{children:P})]}),o.jsxs("li",{children:["Random state: ",o.jsx("strong",{children:$})]})]}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[l&&f(l),d&&f(d),e==="oversampling"&&m&&f(m),h&&f(h),p&&f(p)]}),u&&o.jsx("div",{className:"canvas-modal__parameter-list",children:f(u)}),C&&w==="success"&&!V&&(A.rows.length?o.jsxs("div",{className:"canvas-cast__table-wrapper",children:[o.jsxs("table",{className:"canvas-cast__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Class"}),o.jsx("th",{scope:"col",children:"Sample count"}),o.jsx("th",{scope:"col",children:"Share"})]})}),o.jsx("tbody",{children:A.rows.map(H=>o.jsxs("tr",{children:[o.jsx("th",{scope:"row",children:H.label}),o.jsx("td",{children:y(H.count)}),o.jsx("td",{children:x(H.percentage)})]},`resampling-class-${H.label}`))})]}),o.jsxs("p",{className:"canvas-modal__note",children:["Analysed ",y(A.total)," row",A.total===1?"":"s"," from the preview.",A.truncated?" Showing top classes by frequency.":""]}),D!==null&&o.jsxs("p",{className:"canvas-modal__note canvas-modal__note--muted",children:["Preview rows after resampling: ",y(D),"."]})]}):o.jsx("p",{className:"canvas-modal__note",children:"No class distribution available in the preview sample. Refresh after configuring the node or increasing the sample size."}))]})},DF=["int","float","double","numeric","number"],ij=e=>{if(!e)return!1;const t=e.toLowerCase();return DF.some(n=>t.includes(n))},zF=({catalogFlags:e,skewnessData:t,skewnessTransformations:n,availableColumns:s,previewColumns:r,columnTypeMap:i,updateSkewnessTransformations:l})=>{const{isSkewnessNode:u,isSkewnessDistributionNode:d}=e,h=u||d,[p,m]=b.useState("recommended"),[f,y]=b.useState(!1),[x,_]=b.useState("before"),v=n.length,w=b.useMemo(()=>t!=null&&t.methods?[...t.methods]:[],[t==null?void 0:t.methods]),M=b.useMemo(()=>WL(w),[w]),N=b.useMemo(()=>t!=null&&t.columns?[...t.columns]:[],[t==null?void 0:t.columns]),C=b.useMemo(()=>{const B=new Map;return N.forEach(I=>{I&&I.column&&B.set(I.column,I)}),B},[N]),j=b.useMemo(()=>{const B=new Set;return N.forEach(I=>{I!=null&&I.column&&B.add(I.column)}),s.forEach(I=>{I&&ij(i[I]??null)&&B.add(I)}),r.forEach(I=>{const H=typeof I=="string"?I.trim():"";H&&ij(i[H]??null)&&B.add(H)}),Array.from(B).sort((I,H)=>I.localeCompare(H))},[s,r,N,i]);b.useEffect(()=>{p==="recommended"&&N.length===0&&j.length>0&&m("all")},[j.length,N.length,p]);const E=(t==null?void 0:t.skewness_threshold)??null,k=b.useCallback(B=>M[B]??B,[M]),$=b.useCallback((B,I)=>{const H=C.get(B);return!H||!H.method_status?{status:"ready",reason:void 0}:H.method_status[I]??{status:"ready",reason:void 0}},[C]),T=b.useCallback(()=>{const B=N.map(I=>{if(!I||!I.column)return null;const H=Array.isArray(I.recommended_methods)?I.recommended_methods.find(Xr):void 0;return H?{column:I.column,method:H}:null}).filter(I=>!!I);B.length&&l(I=>{const H=new Map;return I.forEach(J=>{const G=typeof J.column=="string"?J.column.trim():"";G&&Xr(J.method)&&H.set(G,J.method)}),B.forEach(J=>{const G=typeof J.column=="string"?J.column.trim():"";G&&H.set(G,J.method)}),Array.from(H.entries()).map(([J,G])=>({column:J,method:G}))})},[N,l]),P=b.useMemo(()=>{const B=new Map;return n.forEach(I=>{const H=typeof I.column=="string"?I.column.trim():"";!H||B.has(H)||B.set(H,I.method)}),B},[n]),A=b.useCallback((B,I)=>{const H=typeof B=="string"?B.trim():"";H&&l(J=>{const G=J.filter(Y=>Y.column!==H);return I?[...G,{column:H,method:I}]:G})},[l]),D=b.useCallback((B,I)=>{if(B){if(!I){A(B,null);return}Xr(I)&&A(B,I)}},[A]),F=b.useCallback(()=>{l(()=>[])},[l]),R=N.length,z=b.useMemo(()=>N.some(B=>B&&typeof B.column=="string"&&Array.isArray(B.recommended_methods)&&B.recommended_methods.some(Xr)),[N]),q=j.length,V=b.useMemo(()=>YL({viewMode:p,recommendations:N,columnOptions:j,recommendationMap:C,transformationMap:P}),[p,N,j,C,P]),U=b.useMemo(()=>h?N.map(B=>{var ne;if(!B||!B.column)return null;const I=B.distribution_before??B.distribution??null;if(!I||!Array.isArray(I.bin_edges)||!Array.isArray(I.counts)||I.counts.length===0||I.bin_edges.length!==I.counts.length+1)return null;let H=B.distribution_after??null;H&&(!Array.isArray(H.bin_edges)||!Array.isArray(H.counts)||H.counts.length===0||H.bin_edges.length!==H.counts.length+1)&&(H=null);const J=((ne=B.recommended_methods)==null?void 0:ne.find(Xr))??null,G=B.magnitude?`${B.magnitude.charAt(0).toUpperCase()}${B.magnitude.slice(1)}`:null,Y=B.direction?bw[B.direction]??B.direction:null,X=B.applied_method&&Xr(B.applied_method)?B.applied_method:null,Z=P.get(B.column)??null,ee=X??Z??null,Q=ee?k(ee):null;return{column:B.column,skewness:typeof B.skewness=="number"?B.skewness:null,magnitudeLabel:G,directionLabel:Y,summary:B.summary??null,recommendedLabel:Q?null:J?k(J):null,appliedLabel:Q,distributionBefore:I,distributionAfter:H}}).filter(B=>!!B).sort((B,I)=>{const H=B.skewness!==null?Math.abs(B.skewness):-1/0,J=I.skewness!==null?Math.abs(I.skewness):-1/0;return H!==J?J-H:B.column.localeCompare(I.column)}):[],[k,h,N,P]),W=b.useMemo(()=>KL(V,f,k),[V,f,k]);return{state:{threshold:E,viewMode:p,groupByMethod:f,distributionView:x,recommendedCount:R,numericCount:q,transformationsCount:v,hasAutoRecommendations:z,rows:V,tableGroups:W,distributionCards:U},handlers:{setViewMode:m,setGroupByMethod:y,setDistributionView:_,getMethodLabel:k,getMethodStatus:$,applyRecommendations:T,handleOverrideChange:D,clearTransformations:F}}},IF=({catalogFlags:e,imputerStrategies:t,availableColumns:n,columnMissingMap:s,previewColumns:r,previewColumnStats:i,nodeColumns:l,imputerMissingFilter:u})=>{const{isImputerNode:d}=e,h=b.useMemo(()=>{if(!d)return[];const y=r.length?new Set(r.map(C=>typeof C=="string"?C.trim():"").filter(C=>C.length>0)):null,x=new Set;t.forEach(C=>{C.columns.forEach(j=>{const E=typeof j=="string"?j.trim():"";E&&x.add(E)})}),Ge(l).forEach(C=>{C&&x.add(C)});const _=C=>!y||y.size===0?!1:!y.has(C)&&!x.has(C),v=new Map,w=(C,j)=>{const E=typeof C=="string"?C.trim():"";if(!E||_(E))return;const k=v.get(E)??{missingPercentage:null,dtype:void 0,mean:null,median:null,mode:null};j&&(typeof j.missingPercentage=="number"&&!Number.isNaN(j.missingPercentage)&&(k.missingPercentage=Math.max(0,j.missingPercentage)),j.dtype!==void 0&&(k.dtype=j.dtype),typeof j.mean=="number"&&!Number.isNaN(j.mean)&&(k.mean=j.mean),typeof j.median=="number"&&!Number.isNaN(j.median)&&(k.median=j.median),j.mode!==void 0&&j.mode!==null&&j.mode!==""&&(k.mode=j.mode)),v.set(E,k)};n.forEach(C=>{const j=Object.prototype.hasOwnProperty.call(s,C)?s[C]:null;w(C,{missingPercentage:typeof j=="number"?j:null})}),(Array.isArray(i)?i:[]).forEach(C=>{!C||!C.name||w(C.name,{missingPercentage:typeof C.missing_percentage=="number"?C.missing_percentage:null,dtype:C.dtype??null,mean:typeof C.mean=="number"?C.mean:null,median:typeof C.median=="number"?C.median:null,mode:C.mode??null})}),Ge(l).forEach(C=>w(C)),t.forEach(C=>{C.columns.forEach(j=>w(j))});const N=Array.from(v.entries()).map(([C,j])=>({name:C,missingPercentage:typeof j.missingPercentage=="number"&&!Number.isNaN(j.missingPercentage)?Math.max(0,j.missingPercentage):null,dtype:j.dtype??null,mean:typeof j.mean=="number"&&!Number.isNaN(j.mean)?j.mean:null,median:typeof j.median=="number"&&!Number.isNaN(j.median)?j.median:null,mode:j.mode!==void 0&&j.mode!==null&&j.mode!==""?j.mode:null}));return N.sort((C,j)=>{const E=typeof C.missingPercentage=="number",k=typeof j.missingPercentage=="number";return E&&k&&C.missingPercentage!==j.missingPercentage?j.missingPercentage-C.missingPercentage:E!==k?E?-1:1:C.name.localeCompare(j.name)}),N},[n,s,t,l,i,r,d]),p=b.useMemo(()=>{if(!h.length)return 100;const y=h.reduce((_,v)=>{const w=typeof v.missingPercentage=="number"?v.missingPercentage:0;return w>_?w:_},0),x=Math.ceil(y/5)*5;return Math.max(100,x||0)},[h]),m=b.useMemo(()=>h.length?h.reduce((y,x)=>{const _=typeof x.missingPercentage=="number"?x.missingPercentage:null;return _!==null?_<=0?y:_>=u?y+1:y:u===0?y+1:y},0):0,[h,u]),f=u>0;return{imputerColumnOptions:h,imputerMissingSliderMax:p,imputerFilteredOptionCount:m,imputerMissingFilterActive:f}},FF=({suggestedThreshold:e,thresholdParameterName:t,configState:n,handleParameterChange:s})=>{const r=b.useMemo(()=>{if(e===null||Number.isNaN(Number(e)))return null;const d=Number(e);return Math.round(d*10)/10},[e]),i=b.useMemo(()=>{if(t===null||r===null)return!1;const d=Number(n==null?void 0:n[t]);return!Number.isNaN(d)&&d===r},[n,r,t]),l=r!==null&&!i,u=b.useCallback(()=>{r===null||!t||s(t,r)},[s,r,t]);return{normalizedSuggestedThreshold:r,thresholdMatchesSuggestion:i,canApplySuggestedThreshold:l,handleApplySuggestedThreshold:u}},BF=({catalogFlags:e,skewnessData:t,skewnessTransformations:n,availableColumns:s,previewColumns:r,columnTypeMap:i,updateSkewnessTransformations:l,imputerStrategies:u,columnMissingMap:d,previewColumnStats:h,nodeColumns:p,imputerMissingFilter:m,suggestedThreshold:f,thresholdParameterName:y,configState:x,handleParameterChange:_})=>{const v=zF({catalogFlags:e,skewnessData:t,skewnessTransformations:n,availableColumns:s,previewColumns:r,columnTypeMap:i,updateSkewnessTransformations:l}),w=IF({catalogFlags:e,imputerStrategies:u,availableColumns:s,columnMissingMap:d,previewColumns:r,previewColumnStats:h,nodeColumns:p,imputerMissingFilter:m}),M=FF({suggestedThreshold:f,thresholdParameterName:y,configState:x,handleParameterChange:_});return{skewness:v,imputationConfiguration:w,thresholdRecommendations:M}},UF=({graphSnapshot:e,nodeId:t,catalogFlags:n})=>{const{isDataset:s}=n,r=b.useMemo(()=>{if(!e)return null;const f=Array.isArray(e.nodes)?e.nodes:[],y=Array.isArray(e.edges)?e.edges:[];return{nodes:f,edges:y}},[e]),i=b.useMemo(()=>e&&Array.isArray(e.nodes)?e.nodes:[],[e]),l=b.useMemo(()=>e&&Array.isArray(e.edges)?e.edges:[],[e]),u=i.length,d=b.useMemo(()=>{if(!t||!l.length)return[];const f=new Set,y=[t];for(;y.length;){const _=y.pop();_&&l.forEach(v=>{const w=v&&typeof v.source=="string"?v.source.trim():"",M=v&&typeof v.target=="string"?v.target.trim():"";!w||!M||M===_&&!f.has(w)&&(f.add(w),y.push(w))})}const x=Array.from(f);return x.sort(),x},[l,t]),h=b.useMemo(()=>{var x,_,v,w,M;if(!d.length)return"";let f="",y="";for(const N of d){const C=i.find(E=>(E==null?void 0:E.id)===N);if(!C)continue;const j=String(((x=C==null?void 0:C.data)==null?void 0:x.catalogType)??"").toLowerCase().trim();if(j==="feature_target_split"){const E=(v=(_=C==null?void 0:C.data)==null?void 0:_.config)==null?void 0:v.target_column;typeof E=="string"&&E.trim()&&(f=E.trim())}else if(j==="train_test_split"){const E=(M=(w=C==null?void 0:C.data)==null?void 0:w.config)==null?void 0:M.target_column;typeof E=="string"&&E.trim()&&(y=E.trim())}}return f||y||""},[i,d]),p=b.useMemo(()=>{const f=new Set;return i.forEach(y=>{if(!y)return;const x=typeof y.id=="string"?y.id.trim():String((y==null?void 0:y.id)??"").trim();if(!x)return;const _=(y==null?void 0:y.data)??{};(x==="dataset-source"||(_==null?void 0:_.isDataset)===!0||(_==null?void 0:_.catalogType)==="dataset")&&f.add(x)}),f.size||f.add("dataset-source"),Array.from(f)},[i]),m=b.useMemo(()=>{if(!t)return!1;if(s)return!0;if(!l.length)return p.includes(t);const f=new Map;l.forEach(_=>{const v=_==null?void 0:_.source,w=_==null?void 0:_.target,M=typeof v=="string"?v.trim():String(v??"").trim(),N=typeof w=="string"?w.trim():String(w??"").trim();if(!M||!N)return;const C=f.get(M);C?C.push(N):f.set(M,[N])});const y=new Set,x=[...p];for(;x.length;){const _=x.pop();if(!_||y.has(_))continue;y.add(_);const v=f.get(_);v&&v.forEach(w=>{w&&!y.has(w)&&x.push(w)})}return y.has(t)},[p,l,s,t]);return{graphContext:r,graphNodes:i,graphEdges:l,graphNodeCount:u,upstreamNodeIds:d,upstreamTargetColumn:h,hasReachableSource:m}},HF=({configState:e,setConfigState:t,catalogFlags:n,upstreamTargetColumn:s,nodeId:r,modelTypeOptions:i})=>{const{isFeatureTargetSplitNode:l,isTrainTestSplitNode:u,isTrainModelDraftNode:d,isHyperparameterTuningNode:h,isClassOversamplingNode:p,isClassUndersamplingNode:m}=n,f=m||p,y=d||h,x=b.useMemo(()=>{if(!l)return null;const T=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",P=Ge(e==null?void 0:e.feature_columns).map(A=>typeof A=="string"?A.trim():"").filter(A=>!!A);return{targetColumn:T,featureColumns:P}},[e==null?void 0:e.feature_columns,e==null?void 0:e.target_column,l]),_=b.useMemo(()=>{if(!u)return null;const T=typeof(e==null?void 0:e.test_size)=="number"?e.test_size:.2,P=typeof(e==null?void 0:e.validation_size)=="number"?e.validation_size:0,A=typeof(e==null?void 0:e.random_state)=="number"?e.random_state:42,D=typeof(e==null?void 0:e.shuffle)=="boolean"?e.shuffle:!0,F=typeof(e==null?void 0:e.stratify)=="boolean"?e.stratify:!1,R=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"";return{test_size:T,validation_size:P,random_state:A,shuffle:D,stratify:F,target_column:R}},[e==null?void 0:e.random_state,e==null?void 0:e.shuffle,e==null?void 0:e.stratify,e==null?void 0:e.target_column,e==null?void 0:e.test_size,e==null?void 0:e.validation_size,u]),v=b.useMemo(()=>{if(!f)return null;const T=typeof(e==null?void 0:e.method)=="string"?e.method.trim():"",P=typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",A=e==null?void 0:e.sampling_strategy;let D=null;if(typeof A=="number"&&Number.isFinite(A))D=A;else if(typeof A=="string"){const V=A.trim();D=V||null}else A===null&&(D=null);const F=e==null?void 0:e.random_state;let R=null;if(typeof F=="number"&&Number.isFinite(F))R=F;else if(typeof F=="string"){const V=Number(F);R=Number.isFinite(V)?V:null}let z=null;if(m){const V=e==null?void 0:e.replacement;z=typeof V=="boolean"?V:typeof V=="string"?V.trim().toLowerCase()==="true":!!V}let q=null;if(p){const V=e==null?void 0:e.k_neighbors;if(typeof V=="number"&&Number.isFinite(V))q=Math.max(1,Math.round(V));else if(typeof V=="string"){const U=Number(V);Number.isFinite(U)&&(q=Math.max(1,Math.round(U)))}}return{method:T,targetColumn:P,samplingStrategy:D,randomState:R,replacement:z,kNeighbors:q}},[e==null?void 0:e.k_neighbors,e==null?void 0:e.method,e==null?void 0:e.random_state,e==null?void 0:e.replacement,e==null?void 0:e.sampling_strategy,e==null?void 0:e.target_column,p,f,m]),w=typeof(e==null?void 0:e.problem_type)=="string"?e.problem_type.trim().toLowerCase():"",M=w==="regression"?"regression":"classification",N=b.useMemo(()=>Array.isArray(i)?i.filter(T=>T&&typeof T.value=="string"):[],[i]),C=b.useMemo(()=>{const T={classification:[],regression:[]};return N.forEach(P=>{var D;const A=String(((D=P==null?void 0:P.metadata)==null?void 0:D.problem_type)??"").trim().toLowerCase();A==="regression"?T.regression.push(P):A==="classification"?T.classification.push(P):(T.classification.push(P),T.regression.push(P))}),T},[N]),j=b.useMemo(()=>{if(!N.length)return[];const T=M==="regression"?C.regression:C.classification;return T.length>0?T:N},[N,C,M]),E=b.useMemo(()=>y?{targetColumn:typeof(e==null?void 0:e.target_column)=="string"?e.target_column.trim():"",problemType:M}:null,[e==null?void 0:e.target_column,y,M]),k=b.useMemo(()=>{if(!y)return{enabled:!1,strategy:"auto",folds:5,shuffle:!0,randomState:42,refitStrategy:"train_plus_validation"};const T=(e==null?void 0:e.cv_enabled)===void 0?!!h:!!e.cv_enabled,P=typeof(e==null?void 0:e.cv_strategy)=="string"?e.cv_strategy.trim().toLowerCase():"auto",A=["auto","kfold","stratified_kfold"].includes(P)?P:"auto",D=Number(e==null?void 0:e.cv_folds),F=Number.isFinite(D)&&D>=2?Math.floor(D):5,R=(e==null?void 0:e.cv_shuffle)===void 0?!0:!!e.cv_shuffle;let z=null;if(typeof(e==null?void 0:e.cv_random_state)=="number"&&Number.isFinite(e.cv_random_state))z=Math.trunc(e.cv_random_state);else if(typeof(e==null?void 0:e.cv_random_state)=="string"){const U=Number(e.cv_random_state.trim());z=Number.isFinite(U)?Math.trunc(U):null}const V=(typeof(e==null?void 0:e.cv_refit_strategy)=="string"?e.cv_refit_strategy.trim().toLowerCase():"train_plus_validation")==="train_only"?"train_only":"train_plus_validation";return{enabled:T,strategy:A,folds:F,shuffle:R,randomState:z,refitStrategy:V}},[e==null?void 0:e.cv_enabled,e==null?void 0:e.cv_folds,e==null?void 0:e.cv_random_state,e==null?void 0:e.cv_refit_strategy,e==null?void 0:e.cv_shuffle,e==null?void 0:e.cv_strategy,h,y]);b.useEffect(()=>{y&&w!==M&&t(T=>({...T,problem_type:M}))},[y,M,w,t]),b.useEffect(()=>{var D;if(!y||!j.length)return;const T=new Set(j.map(F=>F.value)),P=typeof(e==null?void 0:e.model_type)=="string"?e.model_type.trim():"";if(P&&T.has(P))return;const A=((D=j[0])==null?void 0:D.value)??"";A&&t(F=>{const R=typeof(F==null?void 0:F.model_type)=="string"?F.model_type.trim():"";return R&&T.has(R)||R===A?F:{...F,model_type:A}})},[e==null?void 0:e.model_type,j,y,t]);const $=b.useMemo(()=>{if(!y)return null;const T=typeof(e==null?void 0:e.model_type)=="string"?e.model_type.trim():"",P=e==null?void 0:e.hyperparameters;let A=null,D=null;if(P&&typeof P=="string"){const F=P.trim();if(F.length)try{const R=JSON.parse(F);R&&typeof R=="object"&&!Array.isArray(R)?A=R:D="Hyperparameters JSON must be an object."}catch{D="Hyperparameters JSON is invalid. Provide a valid JSON object."}}else P&&typeof P=="object"&&!Array.isArray(P)&&(A=P);return{modelType:T||null,hyperparameters:A,hyperparametersError:D}},[e==null?void 0:e.hyperparameters,e==null?void 0:e.model_type,y]);return b.useEffect(()=>{(u||d||h)&&s&&(u&&(e==null?void 0:e.stratify)!==!0||t(T=>(typeof(T==null?void 0:T.target_column)=="string"?T.target_column.trim():"")?T:{...T,target_column:s}))},[e==null?void 0:e.stratify,h,d,u,r,t,s]),{featureTargetSplitConfig:x,trainTestSplitConfig:_,resamplingConfig:v,trainModelDraftConfig:E,trainModelRuntimeConfig:$,trainModelCVConfig:k,filteredModelTypeOptions:j}},qF=({nodeId:e,sourceId:t,configState:n,upstreamNodeIds:s,graphNodes:r})=>{const i=b.useMemo(()=>{if(!s.length)return{};const u={};return s.forEach(d=>{var m;const h=r.find(f=>f&&typeof f.id=="string"&&f.id===d);if(!h)return;const p=((m=h==null?void 0:h.data)==null?void 0:m.config)??null;u[d]=p}),u},[r,s]),l=b.useMemo(()=>Mc({sourceId:t??null,nodeId:e||null,config:n,upstreamIds:s,upstreamConfig:i}),[n,e,t,i,s]);return{upstreamConfigFingerprints:i,previewSignature:l}},VF=({cachedPreviewSchema:e,catalogFlags:t,resamplingTargetColumn:n,imputerStrategies:s})=>{const{isClassOversamplingNode:r,isImputerNode:i}=t,l=b.useMemo(()=>(e==null?void 0:e.columns)??[],[e]),u=b.useMemo(()=>{if(!r||!l.length||!n)return null;const p=new Set(["numeric","integer","boolean"]),m=l.filter(f=>f&&f.name!==n).filter(f=>!p.has(String(f.logical_family??"unknown"))).map(f=>({name:f.name,logical_family:String(f.logical_family??"unknown")}));return m.length?{blocked:!0,message:"Class oversampling requires numeric feature columns. Encode or cast the listed fields before refreshing the preview.",columns:m.map(f=>f.name),details:m}:null},[l,r,n]),d=b.useMemo(()=>{if(!i||!l.length||!s.length)return null;const p=new Set(["numeric","integer"]),m=new Map(l.map(y=>[y.name,y])),f=[];return s.forEach((y,x)=>{if(!_w(y.method)||!Array.isArray(y.columns)||!y.columns.length)return;const _=y.columns.map(v=>m.get(v)).filter(v=>!!v).filter(v=>!p.has(String(v.logical_family??"unknown"))).map(v=>({name:v.name,logical_family:String(v.logical_family??"unknown")}));_.length&&f.push({index:x,columns:_.map(v=>v.name),details:_})}),f.length?{blocked:!0,message:"Numeric imputation methods can only target numeric columns. Recast or adjust the highlighted fields before running the preview.",entries:f}:null},[l,s,i]),h=!!(u!=null&&u.blocked||d!=null&&d.blocked);return{cachedSchemaColumns:l,oversamplingSchemaGuard:u,imputationSchemaDiagnostics:d,skipPreview:h}},WF=(e,t,n,s,r)=>{e([]),t({}),n({}),s({}),r("")},YF=({requiresColumnCatalog:e,catalogFlags:t,nodeId:n,sourceId:s,hasReachableSource:r})=>{const{isImputerNode:i}=t,[l,u]=b.useState([]),[d,h]=b.useState(""),[p,m]=b.useState({}),[f,y]=b.useState({}),[x,_]=b.useState({}),[v,w]=b.useState(0);b.useEffect(()=>{!e&&!i||s&&r||WF(u,m,y,_,h)},[r,i,e,s]),b.useEffect(()=>{w(0)},[i,n]);const M=b.useMemo(()=>d.trim().toLowerCase(),[d]),N=b.useMemo(()=>M?l.filter(C=>C.toLowerCase().includes(M)):l,[l,M]);return{availableColumns:l,setAvailableColumns:u,columnSearch:d,setColumnSearch:h,columnMissingMap:p,setColumnMissingMap:m,columnTypeMap:f,setColumnTypeMap:y,columnSuggestions:x,setColumnSuggestions:_,imputerMissingFilter:v,setImputerMissingFilter:w,normalizedColumnSearch:M,filteredColumnOptions:N}},KF=({graphSnapshot:e,nodeId:t,catalogFlags:n,configState:s,setConfigState:r,nodeParams:i,sourceId:l,requiresColumnCatalog:u,imputerStrategies:d})=>{var j;const h=UF({graphSnapshot:e,nodeId:t,catalogFlags:n}),{graphNodes:p,upstreamNodeIds:m,upstreamTargetColumn:f,hasReachableSource:y}=h,x=HF({configState:s,setConfigState:r,catalogFlags:n,upstreamTargetColumn:f,nodeId:t,modelTypeOptions:((j=i.trainModel.modelType)==null?void 0:j.options)??null}),{resamplingConfig:_}=x,v=qF({nodeId:t,sourceId:l,configState:s,upstreamNodeIds:m,graphNodes:p}),[w,M]=b.useState(null),N=VF({cachedPreviewSchema:w,catalogFlags:n,resamplingTargetColumn:(_==null?void 0:_.targetColumn)??null,imputerStrategies:d}),C=YF({requiresColumnCatalog:u,catalogFlags:n,nodeId:t,sourceId:l,hasReachableSource:y});return{graphTopology:h,modelingConfig:x,previewSignatureResult:v,cachedPreviewSchema:w,setCachedPreviewSchema:M,schemaDiagnostics:N,columnCatalogState:C}},GF=({previewState:e,previewSampleRows:t,activeFlagSuffix:n,setColumnTypeMap:s,setColumnSuggestions:r})=>{var i;b.useEffect(()=>{var p;const l=Array.isArray((p=e.data)==null?void 0:p.column_stats)?e.data.column_stats:[],u=e.status;if(!l.length){if(u==="loading")return;s(m=>Object.keys(m).length?{}:m),r(m=>Object.keys(m).length?{}:m);return}const d={},h={};l.forEach(m=>{if(!m||!m.name)return;const f=String(m.name).trim();if(!f||n&&f.endsWith(n))return;const y=typeof m.dtype=="string"?m.dtype:null;y&&(d[f]=y);const x=t.map(v=>v&&Object.prototype.hasOwnProperty.call(v,f)?v[f]:void 0),_=ZI(y,x);_.length&&(h[f]=_)}),s(m=>{const f=Object.entries(m),y=Object.entries(d);return f.length===y.length&&f.every(([x,_])=>Object.prototype.hasOwnProperty.call(d,x)&&d[x]===_)?m:d}),r(m=>{const f=Object.keys(m),y=Object.keys(h);return f.length===y.length&&f.every(x=>{if(!Object.prototype.hasOwnProperty.call(h,x))return!1;const _=m[x]??[],v=h[x]??[];return BN(_,v)})?m:h})},[n,t,(i=e.data)==null?void 0:i.column_stats,e.status,r,s])},XF=({previewState:e,activeFlagSuffix:t,hasReachableSource:n,requiresColumnCatalog:s,nodeColumns:r,selectedColumns:i,setAvailableColumns:l,setColumnMissingMap:u})=>{var d,h;b.useEffect(()=>{var _,v;if(!s||!n)return;const p=new Set;(Array.isArray((_=e.data)==null?void 0:_.columns)?e.data.columns:[]).forEach(w=>{const M=typeof w=="string"?w.trim():"";M&&(t&&M.endsWith(t)||p.add(M))});const f=Array.isArray((v=e.data)==null?void 0:v.column_stats)?e.data.column_stats:[],y={};if(f.forEach(w=>{if(!w||!w.name)return;const M=String(w.name).trim();if(!M||t&&M.endsWith(t))return;p.add(M);const N=Number(w.missing_percentage);!Number.isNaN(N)&&N>=0&&(y[M]=N)}),Ge(r).forEach(w=>{w&&!(t&&w.endsWith(t))&&p.add(w)}),i.forEach(w=>{w&&!(t&&w.endsWith(t))&&p.add(w)}),p.size===0)return;const x=Array.from(p).sort((w,M)=>w.localeCompare(M));l(w=>BN(w,x)?w:x),Object.keys(y).length>0&&u(w=>({...w,...y}))},[t,n,r,(d=e.data)==null?void 0:d.column_stats,(h=e.data)==null?void 0:h.columns,s,i,l,u])},QF=({previewState:e,previewSampleRows:t,activeFlagSuffix:n,setColumnTypeMap:s,setColumnSuggestions:r,hasReachableSource:i,requiresColumnCatalog:l,nodeColumns:u,selectedColumns:d,setAvailableColumns:h,setColumnMissingMap:p})=>{GF({previewState:e,previewSampleRows:t,activeFlagSuffix:n,setColumnTypeMap:s,setColumnSuggestions:r}),XF({previewState:e,activeFlagSuffix:n,hasReachableSource:i,requiresColumnCatalog:l,nodeColumns:u,selectedColumns:d,setAvailableColumns:h,setColumnMissingMap:p})},Ks=["standard","robust","minmax","maxabs"],qo={standard:"Standard scaler",robust:"Robust scaler",minmax:"MinMax scaler",maxabs:"MaxAbs scaler"},lj={high:"High confidence",medium:"Moderate confidence",low:"Exploratory"},cj=e=>Array.isArray(e)?Array.from(new Set(e.map(t=>String(t??"").trim()).filter(Boolean))).sort((t,n)=>t.localeCompare(n)):typeof e=="string"?Array.from(new Set(e.split(",").map(t=>t.trim()).filter(Boolean))).sort((t,n)=>t.localeCompare(n)):[],uj=e=>{const t=e&&typeof e=="object"&&!Array.isArray(e)?e:{},n=cj(t.columns),s=typeof t.default_method=="string"?t.default_method.trim().toLowerCase():"",r=Ks.includes(s)?s:"standard",i={},l=t.column_methods;l&&typeof l=="object"&&!Array.isArray(l)&&Object.entries(l).forEach(([h,p])=>{const m=String(h??"").trim(),f=typeof p=="string"?p.trim().toLowerCase():"";m&&Ks.includes(f)&&(i[m]=f)});const u=typeof t.auto_detect=="boolean"?t.auto_detect:!0,d=cj(t.skipped_columns);return{columns:n,defaultMethod:r,columnMethods:i,autoDetect:u,skippedColumns:d}},ZF=e=>{const t={...qo};return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null,r=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";s&&Ks.includes(s)&&r&&(t[s]=r)}),t},JF=e=>{const t=new Map;return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null;s&&Ks.includes(s)&&t.set(s,n)}),t},e3=e=>Ks.map(t=>({value:t,label:e[t]??qo[t]??t})),t3=({recommendations:e,scalingConfig:t,scalingMethodLabelMap:n,scalingSelectedSet:s,scalingSkippedColumns:r,scalingExcludedColumns:i})=>{if(!e.length)return[];const l=[];return e.forEach(u=>{const d=String((u==null?void 0:u.column)??"").trim();if(!d)return;const h=u.recommended_method,p=n[h]??qo[h]??h,m=Array.isArray(u.fallback_methods)?u.fallback_methods.filter(E=>Ks.includes(E)).map(E=>{const k=E;return n[k]??qo[k]??k}):[],f=u.confidence??"medium",y=lj[f]??lj.medium,_=t.columnMethods[d]??null,v=_??t.defaultMethod,w=n[v]??qo[v]??v,M=i.has(d),N=r.has(d),C=s.has(d),j=u.stats;l.push({column:d,dtype:u.dtype??null,recommendedMethod:h,recommendedLabel:p,confidence:f,confidenceLabel:y,reasons:Array.isArray(u.reasons)?u.reasons:[],fallbackLabels:m,stats:j,hasMissing:!!u.has_missing,currentOverride:_,currentMethod:v,currentMethodLabel:w,isOverrideApplied:_!==null,isSelected:C,isExcluded:M,isSkipped:N})}),l.sort((u,d)=>u.column.localeCompare(d.column)),l},n3=(e,t,n,s)=>{if(!e.length)return null;const r=e.map(i=>{const l=t[i],u=l?n[l]??qo[l]??l:null;return u?`${i} -> ${u}`:i});return s>e.length&&r.push(""),r.join(", ")},qd=e=>String(e??"").trim(),s3=({catalogFlags:e,setConfigState:t,binningExcludedColumns:n,scalingExcludedColumns:s,availableColumns:r,recommendations:i})=>{const{isBinningNode:l,isScalingNode:u}=e,d=b.useCallback((_,v,w)=>{const M=qd(_);M&&t(N=>{const C=N.manual_bounds&&typeof N.manual_bounds=="object"&&!Array.isArray(N.manual_bounds)?{...N.manual_bounds}:{},j=C[M]&&typeof C[M]=="object"?{...C[M]}:{lower:null,upper:null};if(w==="")v==="lower"?j.lower=null:j.upper=null;else{const $=Number(w);if(!Number.isFinite($))return N;v==="lower"?j.lower=$:j.upper=$}const E=j.lower??null,k=j.upper??null;return E===null&&k===null?delete C[M]:C[M]={lower:E,upper:k},{...N,manual_bounds:C}})},[t]),h=b.useCallback(_=>{const v=qd(_);v&&t(w=>{const M=w.manual_bounds&&typeof w.manual_bounds=="object"&&!Array.isArray(w.manual_bounds)?w.manual_bounds:null;if(!M||!Object.prototype.hasOwnProperty.call(M,v))return w;const N={...M};return delete N[v],{...w,manual_bounds:N}})},[t]),p=b.useCallback(_=>{const v=qd(_);v&&t(w=>{const M=Ge(w.columns),N=M.includes(v),C=N?M.filter($=>$!==v):[...M,v];let j=!1,E=w.manual_bounds;N&&E&&typeof E=="object"&&!Array.isArray(E)&&Object.prototype.hasOwnProperty.call(E,v)&&(E={...E},delete E[v],j=!0);const k={...w,columns:C};if(j&&(k.manual_bounds=E),l){const $=new Set(C);if(w.custom_bins&&typeof w.custom_bins=="object"&&!Array.isArray(w.custom_bins)){const T={};Object.entries(w.custom_bins).forEach(([P,A])=>{$.has(P)&&Array.isArray(A)&&A.length&&(T[P]=[...A])}),Object.keys(T).length?k.custom_bins=T:"custom_bins"in k&&delete k.custom_bins}else"custom_bins"in k&&delete k.custom_bins;if(w.custom_labels&&typeof w.custom_labels=="object"&&!Array.isArray(w.custom_labels)){const T={};Object.entries(w.custom_labels).forEach(([P,A])=>{$.has(P)&&Array.isArray(A)&&A.length&&(T[P]=A.map(D=>String(D)))}),Object.keys(T).length?k.custom_labels=T:"custom_labels"in k&&delete k.custom_labels}else"custom_labels"in k&&delete k.custom_labels;if(w.column_overrides&&typeof w.column_overrides=="object"&&!Array.isArray(w.column_overrides)){const T={};Object.entries(w.column_overrides).forEach(([P,A])=>{$.has(P)&&A&&typeof A=="object"&&!Array.isArray(A)&&(T[P]={...A})}),Object.keys(T).length?(k.column_overrides=T,k.column_strategies=T):("column_overrides"in k&&delete k.column_overrides,"column_strategies"in k&&delete k.column_strategies)}else"column_overrides"in k&&delete k.column_overrides,"column_strategies"in k&&delete k.column_strategies}if(u){let $=null;w.column_methods&&typeof w.column_methods=="object"&&!Array.isArray(w.column_methods)&&($={},Object.entries(w.column_methods).forEach(([T,P])=>{const A=typeof P=="string"?P.trim():null;!A||!Ks.includes(A)||N&&T===v||($[T]=A)})),$&&Object.keys($).length?k.column_methods=$:N&&Object.prototype.hasOwnProperty.call(k,"column_methods")&&delete k.column_methods}return k})},[l,u,t]),m=b.useCallback(()=>{i.length&&t(_=>{const v=new Set(Ge(_.columns));return i.forEach(w=>{w!=null&&w.name&&v.add(String(w.name))}),{..._,columns:Array.from(v)}})},[i,t]),f=b.useCallback(()=>{r.length&&t(_=>{const v=new Set(Ge(_.columns));return r.filter(M=>l?!n.has(M):u?!s.has(M):!0).forEach(M=>v.add(M)),{..._,columns:Array.from(v).sort((M,N)=>M.localeCompare(N))}})},[r,n,l,u,s,t]),y=b.useCallback(()=>{t(_=>{const v={..._,columns:[]};return _!=null&&_.manual_bounds&&typeof _.manual_bounds=="object"&&!Array.isArray(_.manual_bounds)&&Object.keys(_.manual_bounds).length&&(v.manual_bounds={}),l&&("custom_bins"in v&&delete v.custom_bins,"custom_labels"in v&&delete v.custom_labels,"column_overrides"in v&&delete v.column_overrides,"column_strategies"in v&&delete v.column_strategies),u&&"column_methods"in v&&delete v.column_methods,v})},[l,u,t]),x=b.useCallback(_=>{const v=qd(_);v&&t(w=>{const M=Ge(w.columns);if(!M.includes(v))return w;const N=M.filter(k=>k!==v);let C=!1,j=w.manual_bounds;j&&typeof j=="object"&&!Array.isArray(j)&&Object.prototype.hasOwnProperty.call(j,v)&&(j={...j},delete j[v],C=!0);const E={...w,columns:N};if(C&&(E.manual_bounds=j),l){if(w.custom_bins&&typeof w.custom_bins=="object"&&!Array.isArray(w.custom_bins)){const k={};Object.entries(w.custom_bins).forEach(([$,T])=>{$!==v&&Array.isArray(T)&&T.length&&(k[$]=[...T])}),Object.keys(k).length?E.custom_bins=k:"custom_bins"in E&&delete E.custom_bins}else"custom_bins"in E&&delete E.custom_bins;if(w.custom_labels&&typeof w.custom_labels=="object"&&!Array.isArray(w.custom_labels)){const k={};Object.entries(w.custom_labels).forEach(([$,T])=>{$!==v&&Array.isArray(T)&&T.length&&(k[$]=T.map(P=>String(P)))}),Object.keys(k).length?E.custom_labels=k:"custom_labels"in E&&delete E.custom_labels}else"custom_labels"in E&&delete E.custom_labels;if(w.column_overrides&&typeof w.column_overrides=="object"&&!Array.isArray(w.column_overrides)){const k={};Object.entries(w.column_overrides).forEach(([$,T])=>{$!==v&&T&&typeof T=="object"&&!Array.isArray(T)&&(k[$]={...T})}),Object.keys(k).length?(E.column_overrides=k,E.column_strategies=k):("column_overrides"in E&&delete E.column_overrides,"column_strategies"in E&&delete E.column_strategies)}else"column_overrides"in E&&delete E.column_overrides,"column_strategies"in E&&delete E.column_strategies}if(u)if(w.column_methods&&typeof w.column_methods=="object"&&!Array.isArray(w.column_methods)){const k={};Object.entries(w.column_methods).forEach(([$,T])=>{const P=typeof T=="string"?T.trim():null;!P||!Ks.includes(P)||$!==v&&(k[$]=P)}),Object.keys(k).length?E.column_methods=k:Object.prototype.hasOwnProperty.call(E,"column_methods")&&delete E.column_methods}else Object.prototype.hasOwnProperty.call(E,"column_methods")&&delete E.column_methods;return E})},[l,u,t]);return{handleManualBoundChange:d,handleClearManualBound:h,handleToggleColumn:p,handleApplyAllRecommended:m,handleSelectAllColumns:f,handleClearColumns:y,handleRemoveColumn:x}},r3=({configState:e,catalogFlags:t,nodeId:n,onUpdateConfig:s,onClose:r,sourceId:i,graphSnapshot:l,onUpdateNodeData:u,setConfigState:d,canResetNode:h,defaultConfigTemplate:p,onResetConfig:m})=>{const{isBinningNode:f,isScalingNode:y,isInspectionNode:x}=t,_=b.useCallback(w=>{if(!n)return;let M=wp(e);if(f){const N=pw(M);M={...M,strategy:N.strategy,columns:N.columns,equal_width_bins:N.equalWidthBins,equal_frequency_bins:N.equalFrequencyBins,include_lowest:N.includeLowest,precision:N.precision,duplicates:N.duplicates,output_suffix:N.outputSuffix,drop_original:N.dropOriginal,label_format:N.labelFormat,missing_strategy:N.missingStrategy},N.missingStrategy==="label"?M.missing_label=N.missingLabel:Object.prototype.hasOwnProperty.call(M,"missing_label")&&delete M.missing_label,Object.keys(N.customBins).length?M.custom_bins=N.customBins:Object.prototype.hasOwnProperty.call(M,"custom_bins")&&delete M.custom_bins,Object.keys(N.customLabels).length?M.custom_labels=N.customLabels:Object.prototype.hasOwnProperty.call(M,"custom_labels")&&delete M.custom_labels}if(y){const N=uj(M);M={...M,columns:N.columns,default_method:N.defaultMethod,auto_detect:N.autoDetect,skipped_columns:N.skippedColumns},Object.keys(N.columnMethods).length>0?M.column_methods=N.columnMethods:Object.prototype.hasOwnProperty.call(M,"column_methods")&&delete M.column_methods}s(n,M),(w==null?void 0:w.closeModal)!==!1&&r(),i&&l&&!x&&(u==null||u(n,{backgroundExecutionStatus:"loading"}),sw({dataset_source_id:i,graph:{nodes:l.nodes||[],edges:l.edges||[]},target_node_id:n}).then(()=>{u==null||u(n,{backgroundExecutionStatus:"success"})}).catch(N=>{u==null||u(n,{backgroundExecutionStatus:"error"}),console.warn("Background full dataset execution failed:",N)}))},[e,l,f,x,y,n,r,s,u,i]),v=b.useCallback(()=>{if(!h||!n)return;const w=wp(p??{});d(w),m==null||m(n,w)},[h,p,n,m,d]);return{handleSave:_,handleResetNode:v}},a3=({setConfigState:e,imputationMethodValues:t,imputationMethodOptions:n,imputerStrategyCount:s,setCollapsedStrategies:r,setImputerMissingFilter:i})=>{const l=b.useCallback(_=>{e(v=>{const w=vw(v==null?void 0:v.strategies,t),M=_(w).map(N=>({...N,options:yc(N.method,N.options)}));return{...v,strategies:BL(M)}})},[t,e]),u=b.useCallback(()=>{var w;const _=s,v=((w=n[0])==null?void 0:w.value)??"mean";l(M=>[...M,{method:v,columns:[],options:yc(v,yw(v))}]),r(M=>{const N=new Set(M);return N.delete(_),N})},[n,s,l,r]),d=b.useCallback(_=>{l(v=>v.filter((w,M)=>M!==_)),r(v=>{const w=new Set;return v.forEach(M=>{M!==_&&w.add(M>_?M-1:M)}),w})},[l,r]),h=b.useCallback(_=>{r(v=>{const w=new Set(v);return w.has(_)?w.delete(_):w.add(_),w})},[r]),p=b.useCallback((_,v)=>{l(w=>w.map((M,N)=>N===_?{...M,method:v,options:yc(v,M.options)}:M))},[l]),m=b.useCallback((_,v,w)=>{l(M=>M.map((N,C)=>{if(C!==_)return N;const j={...N.options??{}};if(w==="")delete j[v];else{const E=Number(w);if(!Number.isFinite(E))return N;j[v]=E}return{...N,options:yc(N.method,j)}}))},[l]),f=b.useCallback((_,v)=>{const w=v.split(",").map(M=>M.trim()).filter(Boolean);l(M=>M.map((N,C)=>C===_?{...N,columns:w}:N))},[l]),y=b.useCallback((_,v)=>{const w=v.trim();w&&l(M=>M.map((N,C)=>{if(C!==_)return N;const E=N.columns.includes(w)?N.columns.filter(k=>k!==w):[...N.columns,w];return E.sort((k,$)=>k.localeCompare($)),{...N,columns:E}}))},[l]),x=b.useCallback(_=>{i(_)},[i]);return{updateImputerStrategies:l,handleAddImputerStrategy:u,handleRemoveImputerStrategy:d,toggleImputerStrategySection:h,handleImputerMethodChange:p,handleImputerOptionNumberChange:m,handleImputerColumnsChange:f,handleImputerColumnToggle:y,handleImputerMissingFilterChange:x}},o3=({catalogFlags:e,node:t,setConfigState:n,setCollapsedStrategies:s,aliasColumnSummary:r,aliasStrategyCount:i})=>{var _;const{isReplaceAliasesNode:l}=e,u=b.useCallback(v=>{l&&n(w=>{var D,F,R,z,q,V,U,W,B;if(!l)return w;const M=Ge((w==null?void 0:w.columns)??((F=(D=t==null?void 0:t.data)==null?void 0:D.config)==null?void 0:F.columns)),N=kd(w==null?void 0:w.mode,(z=(R=t==null?void 0:t.data)==null?void 0:R.config)==null?void 0:z.mode),C=(()=>{var J;const I=Zi(w);if(I!==void 0){const G=Fo(I);if(G!==null)return G}const H=Zi((J=t==null?void 0:t.data)==null?void 0:J.config);if(H!==void 0){const G=Fo(H);if(G!==null)return G}return M.length===0})(),j=(w==null?void 0:w.alias_strategies)??(w==null?void 0:w.strategies)??((V=(q=t==null?void 0:t.data)==null?void 0:q.config)==null?void 0:V.alias_strategies)??((W=(U=t==null?void 0:t.data)==null?void 0:U.config)==null?void 0:W.strategies),E=Sw(j,{mode:N,columns:M,autoDetect:C}),k=v(E).map(I=>({mode:kd(I.mode,N),columns:Array.from(new Set(I.columns.map(H=>H.trim()).filter(Boolean))).sort((H,J)=>H.localeCompare(J)),autoDetect:!!I.autoDetect})),$=cR(k),T=Array.from(new Set(k.flatMap(I=>I.columns))).sort((I,H)=>I.localeCompare(H)),P=((B=k[0])==null?void 0:B.mode)??N,A=k.length?k.some(I=>I.autoDetect):C;return{...w,alias_strategies:$,columns:T,mode:P,auto_detect:A}})},[l,(_=t==null?void 0:t.data)==null?void 0:_.config,n]),d=b.useCallback(()=>{if(!l)return;const v=i;u(w=>{var E;const M=new Set;w.forEach(k=>{k.columns.forEach($=>{const T=$.trim();T&&M.add(T)})});const N=r.recommendedColumns.find(k=>!M.has(k)),j={mode:w.length?w[w.length-1].mode:((E=jw[0])==null?void 0:E.value)??cp,columns:N?[N]:[],autoDetect:!N};return[...w,j]}),s(w=>{const M=new Set(w);return M.delete(v),M})},[r.recommendedColumns,i,l,s,u]),h=b.useCallback(v=>{u(w=>w.filter((M,N)=>N!==v)),s(w=>{const M=new Set;return w.forEach(N=>{N!==v&&M.add(N>v?N-1:N)}),M})},[s,u]),p=b.useCallback(v=>{s(w=>{const M=new Set(w);return M.has(v)?M.delete(v):M.add(v),M})},[s]),m=b.useCallback((v,w)=>{u(M=>M.map((N,C)=>C===v?{...N,mode:w}:N))},[u]),f=b.useCallback((v,w)=>{const M=w.trim();M&&u(N=>N.map((C,j)=>{if(j!==v)return C;const k=C.columns.includes(M)?C.columns.filter($=>$!==M):[...C.columns,M];return k.sort(($,T)=>$.localeCompare(T)),{...C,columns:k}}))},[u]),y=b.useCallback((v,w)=>{const M=w.split(",").map(C=>C.trim()).filter(Boolean),N=Array.from(new Set(M)).sort((C,j)=>C.localeCompare(j));u(C=>C.map((j,E)=>E===v?{...j,columns:N}:j))},[u]),x=b.useCallback((v,w)=>{u(M=>M.map((N,C)=>C===v?{...N,autoDetect:w}:N))},[u]);return{updateAliasStrategies:u,handleAddAliasStrategy:d,handleRemoveAliasStrategy:h,toggleAliasStrategySection:p,handleAliasModeChange:m,handleAliasColumnToggle:f,handleAliasColumnsChange:y,handleAliasAutoDetectToggle:x}},i3=({catalogFlags:e,node:t,setConfigState:n,setCollapsedStrategies:s,dateStrategies:r,standardizeDatesColumnSummary:i,standardizeDatesMode:l})=>{var v,w,M,N,C,j;const{isStandardizeDatesNode:u}=e,d=b.useCallback(E=>{n(k=>{var q,V,U,W,B,I,H;if(!u)return k;const $=Ge((k==null?void 0:k.columns)??((V=(q=t==null?void 0:t.data)==null?void 0:q.config)==null?void 0:V.columns)),T=Dw(k==null?void 0:k.mode,(W=(U=t==null?void 0:t.data)==null?void 0:U.config)==null?void 0:W.mode),P=$.length===0,A=zw((k==null?void 0:k.format_strategies)??((I=(B=t==null?void 0:t.data)==null?void 0:B.config)==null?void 0:I.format_strategies),{columns:$,mode:T,autoDetect:P}),D=E(A),F=RR(D),R=Array.from(new Set(D.flatMap(J=>J.columns.map(G=>G.trim()).filter(Boolean)))).sort((J,G)=>J.localeCompare(G)),z=((H=D[0])==null?void 0:H.mode)??T;return{...k,format_strategies:F,columns:R,mode:z}})},[u,(w=(v=t==null?void 0:t.data)==null?void 0:v.config)==null?void 0:w.columns,(N=(M=t==null?void 0:t.data)==null?void 0:M.config)==null?void 0:N.format_strategies,(j=(C=t==null?void 0:t.data)==null?void 0:C.config)==null?void 0:j.mode,n]),h=b.useCallback(()=>{const E=r.length;d(k=>{var D;const $=new Set;k.forEach(F=>{F.columns.forEach(R=>{const z=R.trim();z&&$.add(z)})});const T=i.recommendedColumns.find(F=>!$.has(F)),A={mode:k.length?k[k.length-1].mode:((D=fp[0])==null?void 0:D.value)??l,columns:T?[T]:[],autoDetect:!T};return[...k,A]}),s(k=>{const $=new Set(k);return $.delete(E),$})},[r.length,s,i.recommendedColumns,l,d]),p=b.useCallback(E=>{d(k=>k.filter(($,T)=>T!==E)),s(k=>{const $=new Set;return k.forEach(T=>{T!==E&&$.add(T>E?T-1:T)}),$})},[s,d]),m=b.useCallback(E=>{s(k=>{const $=new Set(k);return $.has(E)?$.delete(E):$.add(E),$})},[s]),f=b.useCallback((E,k)=>{d($=>$.map((T,P)=>P===E?{...T,mode:k}:T))},[d]),y=b.useCallback((E,k)=>{const $=k.split(",").map(T=>T.trim()).filter(Boolean).sort((T,P)=>T.localeCompare(P));d(T=>T.map((P,A)=>A===E?{...P,columns:$}:P))},[d]),x=b.useCallback((E,k)=>{const $=k.trim();$&&d(T=>T.map((P,A)=>{if(A!==E)return P;const F=P.columns.includes($)?P.columns.filter(R=>R!==$):[...P.columns,$];return F.sort((R,z)=>R.localeCompare(z)),{...P,columns:F}}))},[d]),_=b.useCallback((E,k)=>{d($=>$.map((T,P)=>P===E?{...T,autoDetect:k}:T))},[d]);return{updateDateStrategies:d,handleAddDateStrategy:h,handleRemoveDateStrategy:p,toggleDateStrategySection:m,handleDateStrategyModeChange:f,handleDateStrategyColumnsChange:y,handleDateStrategyColumnToggle:x,handleDateStrategyAutoDetectToggle:_}},l3=new Set(Ld.map(e=>e.value)),Tc=e=>!e||!e.length?[]:Array.from(new Set(e.map(t=>t.trim()).filter(t=>t.length>0))).sort((t,n)=>t.localeCompare(n)),dj=e=>!e||!e.length?[]:e.filter(t=>Number.isFinite(t)),mj=e=>{const n=Tc(e).filter(s=>l3.has(s));return n.length?n:["year","month","day"]},$c=e=>e==null?null:Number.isFinite(e)?e:null,fj=e=>{const t=$c(e);if(t===null)return null;const n=Math.round(t);return Number.isFinite(n)?n:null},hj=e=>typeof e!="string"?"UTC":e.trim()||"UTC",c3=({catalogFlags:e,setConfigState:t,setCollapsedFeatureMath:n})=>{const{isFeatureMathNode:s}=e,r=b.useCallback(m=>{t(f=>{if(!s)return f;const y=f&&typeof f=="object"&&!Array.isArray(f)?{...f}:{},x=vN(Array.isArray(f==null?void 0:f.operations)?f.operations:[]),_=m(x);return y.operations=Dz(_),y})},[s,t]),i=b.useCallback(m=>{if(!s)return;let f="";r(y=>{const x=new Set(y.map(v=>v.id)),_=xN(m,x);return f=_.id,[...y,_]}),f&&n(y=>{const x=new Set(y);return x.delete(f),x})},[s,n,r]),l=b.useCallback(m=>{if(!s)return;let f="";r(y=>{const x=y.findIndex(C=>C.id===m);if(x===-1)return y;const _=y[x],v=new Set(y.map(C=>C.id)),w=xN(_.type,v);f=w.id;const M={..._,id:w.id,inputColumns:[..._.inputColumns],secondaryColumns:[..._.secondaryColumns],constants:[..._.constants],datetimeFeatures:[..._.datetimeFeatures],outputColumn:_.outputColumn?`${_.outputColumn}_copy`:""},N=[...y];return N.splice(x+1,0,M),N}),f&&n(y=>{const x=new Set(y);return x.delete(f),x})},[s,n,r]),u=b.useCallback(m=>{s&&(r(f=>f.filter(y=>y.id!==m)),n(f=>{const y=new Set(f);return y.delete(m),y}))},[s,n,r]),d=b.useCallback((m,f)=>{s&&r(y=>{const x=y.findIndex(M=>M.id===m);if(x===-1)return y;const _=f==="up"?x-1:x+1;if(_<0||_>=y.length)return y;const v=[...y],[w]=v.splice(x,1);return v.splice(_,0,w),v})},[s,r]),h=b.useCallback(m=>{n(f=>{const y=new Set(f);return y.has(m)?y.delete(m):y.add(m),y})},[n]),p=b.useCallback((m,f)=>{s&&r(y=>y.map(x=>{if(x.id!==m)return x;let _={...x};if(f.type&&(_.type=f.type),f.method!==void 0&&(_.method=f.method),f.inputColumns!==void 0&&(_.inputColumns=Tc(f.inputColumns)),f.secondaryColumns!==void 0&&(_.secondaryColumns=Tc(f.secondaryColumns)),f.constants!==void 0&&(_.constants=dj(f.constants)),f.outputColumn!==void 0&&(_.outputColumn=f.outputColumn.trim()),f.outputPrefix!==void 0&&(_.outputPrefix=f.outputPrefix.trim()),f.datetimeFeatures!==void 0&&(_.datetimeFeatures=mj(f.datetimeFeatures)),f.timezone!==void 0&&(_.timezone=hj(f.timezone)),f.fillna!==void 0&&(_.fillna=$c(f.fillna)),f.roundDigits!==void 0&&(_.roundDigits=fj(f.roundDigits)),f.normalize!==void 0&&(_.normalize=f.normalize),f.epsilon!==void 0&&(_.epsilon=$c(f.epsilon)),f.allowOverwrite!==void 0&&(_.allowOverwrite=f.allowOverwrite),f.description!==void 0){const M=typeof f.description=="string"?f.description.trim():"";_.description=M||void 0}const v=_.type,w=bN(v);return w.length?new Set(w.map(N=>N.value)).has(_.method)||(_.method=w[0].value):v==="ratio"?_.method="ratio":v==="datetime_extract"&&(_.method="datetime_extract"),_.inputColumns=Tc(_.inputColumns),v==="ratio"||v==="similarity"?_.secondaryColumns=Tc(_.secondaryColumns):_.secondaryColumns=[],_.constants=dj(_.constants),_.fillna=$c(_.fillna),_.roundDigits=fj(_.roundDigits),_.epsilon=$c(_.epsilon),v==="datetime_extract"?(_.datetimeFeatures=mj(_.datetimeFeatures),_.timezone=hj(_.timezone)):(_.datetimeFeatures=[],_.timezone="UTC"),v!=="similarity"?_.normalize=!1:_.normalize=!!_.normalize,typeof _.allowOverwrite!="boolean"&&(_.allowOverwrite=null),_.outputColumn=_.outputColumn.trim(),_.outputPrefix=_.outputPrefix.trim(),_}))},[s,r]);return{updateFeatureMathOperations:r,handleAddFeatureMathOperation:i,handleDuplicateFeatureMathOperation:l,handleRemoveFeatureMathOperation:u,handleReorderFeatureMathOperation:d,handleToggleFeatureMathOperation:h,handleFeatureMathOperationChange:p}},u3=({catalogFlags:e,setConfigState:t,binningExcludedColumns:n,scalingExcludedColumns:s,availableColumns:r,recommendations:i,nodeId:l,onUpdateConfig:u,onClose:d,sourceId:h,graphSnapshot:p,onUpdateNodeData:m,canResetNode:f,defaultConfigTemplate:y,onResetConfig:x,imputationMethodValues:_,imputationMethodOptions:v,imputerStrategyCount:w,setCollapsedStrategies:M,setImputerMissingFilter:N,node:C,aliasColumnSummary:j,aliasStrategyCount:E,dateStrategies:k,standardizeDatesColumnSummary:$,standardizeDatesMode:T,setCollapsedFeatureMath:P,configState:A})=>{const D=s3({catalogFlags:e,setConfigState:t,binningExcludedColumns:n,scalingExcludedColumns:s,availableColumns:r,recommendations:i}),F=r3({configState:A,catalogFlags:e,nodeId:l,onUpdateConfig:u,onClose:d,sourceId:h,graphSnapshot:p,onUpdateNodeData:m,setConfigState:t,canResetNode:f,defaultConfigTemplate:y,onResetConfig:x}),R=a3({setConfigState:t,imputationMethodValues:_,imputationMethodOptions:v,imputerStrategyCount:w,setCollapsedStrategies:M,setImputerMissingFilter:N}),z=o3({catalogFlags:e,node:C,setConfigState:t,setCollapsedStrategies:M,aliasColumnSummary:j,aliasStrategyCount:E}),q=i3({catalogFlags:e,node:C,setConfigState:t,setCollapsedStrategies:M,dateStrategies:k,standardizeDatesColumnSummary:$,standardizeDatesMode:T}),V=c3({catalogFlags:e,setConfigState:t,setCollapsedFeatureMath:P});return{columnSelectionHandlers:D,nodeSaveHandlers:F,imputationStrategyHandlers:R,aliasStrategyHandlers:z,dateStrategyHandlers:q,featureMathHandlers:V}},d3=({hasDropColumnSource:e,sourceId:t,nodeId:n,graphContext:s,hasReachableSource:r,columnTypeMap:i,setAvailableColumns:l,setColumnSearch:u,setColumnMissingMap:d,setColumnTypeMap:h,setColumnSuggestions:p})=>{const[m,f]=b.useState([]),[y,x]=b.useState(null),[_,v]=b.useState([]),[w,M]=b.useState(null),[N,C]=b.useState(!1),[j,E]=b.useState(null),[k,$]=b.useState(null),[T,P]=b.useState(0),A=b.useRef(i);b.useEffect(()=>{A.current=i},[i]),b.useEffect(()=>{let q=!0;const V=U=>{v([]),M(U??null),E(null),$(null),C(!1),f([]),x(null),l([]),u(""),d({}),h({}),p({})};return e?t?r?(C(!0),M(null),rp(t,{graph:s,targetNodeId:n??null}).then(U=>{if(!q)return;const W=Array.isArray(U==null?void 0:U.candidates)?U.candidates:[];v(W),E((U==null?void 0:U.generated_at)??null),$(typeof(U==null?void 0:U.suggested_threshold)=="number"?Number(U.suggested_threshold):null);const B=Array.isArray(U==null?void 0:U.available_filters)?U.available_filters:[];f(B),x(G=>G&&B.some(Y=>Y.id===G)?G:null);const I={};U&&typeof U=="object"&&(U!=null&&U.column_missing_map)&&typeof U.column_missing_map=="object"&&Object.entries(U.column_missing_map).forEach(([G,Y])=>{const X=String(G??"").trim();if(!X)return;const Z=Number(Y);Number.isFinite(Z)&&(I[X]=Number(Z))});const H=new Set;Array.isArray(U==null?void 0:U.all_columns)&&U.all_columns.forEach(G=>{const Y=String(G??"").trim();Y&&H.add(Y)}),Object.keys(A.current??{}).forEach(G=>H.add(G));const J=Array.from(H).sort((G,Y)=>G.localeCompare(Y));J.forEach(G=>{Object.prototype.hasOwnProperty.call(I,G)||(I[G]=0)}),l(J),u(""),d(I),h(G=>{const Y=U==null?void 0:U.column_type_map;if(!Y||typeof Y!="object")return G;const X={...G};return Object.entries(Y).forEach(([Z,ee])=>{const Q=String(Z??"").trim();if(!Q)return;const ne=String(ee??"").trim();X[Q]=ne||G[Q]||""}),X}),p(G=>{const Y=U==null?void 0:U.column_recommendations;if(!Y||typeof Y!="object")return G;const X={};return Object.entries(Y).forEach(([Z,ee])=>{const Q=String(Z??"").trim();if(!Q)return;const ne=Array.isArray(ee)?ee.map(he=>String(he??"").trim()).filter(Boolean):[];X[Q]=ne}),X})}).catch(U=>{q&&V((U==null?void 0:U.message)??"Unable to load recommendations")}).finally(()=>{q&&C(!1)}),()=>{q=!1}):(V("Connect this step to an upstream output to load recommendations."),()=>{q=!1}):(V(),()=>{q=!1}):(V(),()=>{q=!1})},[A,s,e,r,n,T,l,d,u,p,h,t]);const D=b.useCallback(()=>{!e||!t||!r||P(q=>q+1)},[e,r,t]),F=b.useMemo(()=>{const q=new Map;return m.forEach(V=>{V!=null&&V.id&&q.set(V.id,V.label)}),q},[m]),R=b.useCallback(q=>q?F.has(q)?F.get(q)??null:q.split("_").filter(Boolean).map(U=>U.charAt(0).toUpperCase()+U.slice(1)).join(" ")||q:null,[F]),z=b.useMemo(()=>y?_.filter(q=>Array.isArray(q==null?void 0:q.signals)&&q.signals.includes(y)):_,[y,_]);return{hasDropColumnSource:e,availableFilters:m,activeFilterId:y,setActiveFilterId:x,recommendations:_,filteredRecommendations:z,formatSignalName:R,isFetchingRecommendations:N,recommendationsError:w,recommendationsGeneratedAt:j,suggestedThreshold:k,refreshRecommendations:D}},m3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r,setAvailableColumns:i,setColumnMissingMap:l})=>{const{isImputerNode:u}=e,d=u,[h,p]=b.useState(!1),[m,f]=b.useState(null),[y,x]=b.useState(0),_=b.useCallback(()=>{!d||!t||!n||x(v=>v+1)},[n,d,t]);return b.useEffect(()=>{let v=!0;return d?t?n?(p(!0),f(null),rp(t,{graph:s,targetNodeId:r}).then(w=>{if(!v)return;const M={};w&&typeof w=="object"&&(w!=null&&w.column_missing_map)&&typeof w.column_missing_map=="object"&&Object.entries(w.column_missing_map).forEach(([j,E])=>{const k=String(j??"").trim();if(!k)return;const $=Number(E);Number.isNaN($)||$<0||(M[k]=Number($))});const N=new Set;Array.isArray(w==null?void 0:w.all_columns)&&w.all_columns.forEach(j=>{const E=String(j??"").trim();E&&N.add(E)}),Object.keys(M).forEach(j=>N.add(j));const C=Array.from(N).sort((j,E)=>j.localeCompare(E));C.forEach(j=>{Object.prototype.hasOwnProperty.call(M,j)||(M[j]=0)}),C.length&&i(C),Object.keys(M).length&&l(j=>({...j,...M}))}).catch(w=>{v&&f((w==null?void 0:w.message)??"Unable to load column metrics.")}).finally(()=>{v&&p(!1)}),()=>{v=!1}):(f("Connect this step to an upstream output to load column metrics."),p(!1),()=>{v=!1}):(f("Select a dataset to load column metrics."),p(!1),()=>{v=!1}):()=>{v=!1}},[s,n,y,i,l,d,t,r]),{isFetching:h,error:m,refreshDropColumnRecommendations:_}},Pp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,highCardinalityColumns:[],notes:[]},f3=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Lp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],h3=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=f3(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,h=typeof t.text_category=="string"?t.text_category:null,p=Lp(t.sample_values),m=typeof t.score=="number"?t.score:0,f=typeof t.selectable=="boolean"?t.selectable:!0;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:h,sample_values:p,score:m,selectable:f}}).filter(t=>!!t),p3=e=>{if(!e||typeof e!="object")return{...Pp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.auto_detect_default,l=Lp(e.high_cardinality_columns),u=Lp(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:i,highCardinalityColumns:l,notes:u}},g3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isLabelEncodingNode:i}=e,[l,u]=b.useState(!1),[d,h]=b.useState(null),[p,m]=b.useState([]),[f,y]=b.useState({...Pp}),[x,_]=b.useState(0);b.useEffect(()=>{let N=!0;const C=j=>{m([]),y({...Pp}),u(!1),h(j??null)};return i?t?n?(u(!0),h(null),F0(t,{graph:s??null,targetNodeId:r??null}).then(j=>{N&&(m(h3(j)),y(p3(j)))}).catch(j=>{if(!N)return;const E=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load label encoding suggestions";C(E)}).finally(()=>{N&&u(!1)}),()=>{N=!1}):(C("Connect this node to the dataset input to load suggestions."),()=>{N=!1}):(C(),()=>{N=!1}):(C(),()=>{N=!1})},[s,n,i,x,t,r]);const v=b.useCallback(()=>{!i||!t||!n||_(N=>N+1)},[n,i,t]),w=b.useMemo(()=>f,[f]),M=b.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:M,metadata:w,refresh:v}},Rp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,enableGlobalFallbackDefault:!1,highCardinalityColumns:[],notes:[]},_3=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Dp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],y3=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=_3(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,h=typeof t.text_category=="string"?t.text_category:null,p=Dp(t.sample_values),m=typeof t.score=="number"?t.score:0,f=typeof t.selectable=="boolean"?t.selectable:!0,y=typeof t.recommended_use_global_fallback=="boolean"?t.recommended_use_global_fallback:!!(t.missing_percentage&&t.missing_percentage>0);return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:h,sample_values:p,score:m,selectable:f,recommended_use_global_fallback:y}}).filter(t=>!!t),v3=e=>{if(!e||typeof e!="object")return{...Rp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.enable_global_fallback_default,l=Dp(e.high_cardinality_columns),u=Dp(e.notes),d=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:d,enableGlobalFallbackDefault:i,highCardinalityColumns:l,notes:u}},x3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isTargetEncodingNode:i}=e,[l,u]=b.useState(!1),[d,h]=b.useState(null),[p,m]=b.useState([]),[f,y]=b.useState({...Rp}),[x,_]=b.useState(0);b.useEffect(()=>{let N=!0;const C=j=>{m([]),y({...Rp}),u(!1),h(j??null)};return i?t?n?(u(!0),h(null),U0(t,{graph:s??null,targetNodeId:r??null}).then(j=>{N&&(m(y3(j)),y(v3(j)))}).catch(j=>{if(!N)return;const E=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load target encoding suggestions";C(E)}).finally(()=>{N&&u(!1)}),()=>{N=!1}):(C("Connect this node to the dataset input to load suggestions."),()=>{N=!1}):(C(),()=>{N=!1}):(C(),()=>{N=!1})},[s,n,i,x,t,r]);const v=b.useCallback(()=>{!i||!t||!n||_(N=>N+1)},[n,i,t]),w=b.useMemo(()=>f,[f]),M=b.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:M,metadata:w,refresh:v}},Vd={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,suggestedBucketDefault:0,highCardinalityColumns:[],notes:[]},b3=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},zp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],w3=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=b3(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,h=typeof t.text_category=="string"?t.text_category:null,p=zp(t.sample_values),m=typeof t.score=="number"?t.score:0,f=typeof t.selectable=="boolean"?t.selectable:!0,y=typeof t.recommended_bucket_count=="number"?Math.max(2,Math.round(t.recommended_bucket_count)):0;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:h,sample_values:p,score:m,selectable:f,recommended_bucket_count:y}}).filter(t=>!!t),N3=e=>{if(!e||typeof e!="object")return{...Vd};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.auto_detect_default,l=Number(e.suggested_bucket_default??0)||0,u=zp(e.high_cardinality_columns),d=zp(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:i,suggestedBucketDefault:l,highCardinalityColumns:u,notes:d}},j3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isHashEncodingNode:i}=e,[l,u]=b.useState(!1),[d,h]=b.useState(null),[p,m]=b.useState([]),[f,y]=b.useState({...Vd}),[x,_]=b.useState(0),v=b.useCallback(N=>{m([]),y({...Vd}),u(!1),h(N??null)},[]);b.useEffect(()=>{let N=!0;return i?t?n?(u(!0),h(null),H0(t,{graph:s??null,targetNodeId:r??null}).then(C=>{N&&(m(w3(C)),y(N3(C)))}).catch(C=>{N&&(m([]),y({...Vd}),h(C!=null&&C.message?String(C.message):"Unable to load hash encoding suggestions"))}).finally(()=>{N&&u(!1)}),()=>{N=!1}):(v("Connect this node to the dataset input to load suggestions."),()=>{N=!1}):(v(),()=>{N=!1}):(v(),()=>{N=!1})},[s,n,i,v,t,r,x]);const w=b.useCallback(()=>{_(N=>N+1)},[]);return b.useMemo(()=>({isFetching:l,error:d,suggestions:p,metadata:f,refresh:w}),[d,l,f,w,p])},Ip={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,autoDetectDefault:!1,enableUnknownDefault:!1,highCardinalityColumns:[],notes:[]},C3=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Fp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],S3=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=C3(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,h=typeof t.text_category=="string"?t.text_category:null,p=Fp(t.sample_values),m=typeof t.score=="number"?t.score:0,f=typeof t.selectable=="boolean"?t.selectable:!0,y=typeof t.recommended_handle_unknown=="boolean"?t.recommended_handle_unknown:!!(t.missing_percentage&&t.missing_percentage>0);return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:h,sample_values:p,score:m,selectable:f,recommended_handle_unknown:y}}).filter(t=>!!t),E3=e=>{if(!e||typeof e!="object")return{...Ip};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=!!e.enable_unknown_default,l=Fp(e.high_cardinality_columns),u=Fp(e.notes),d=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,autoDetectDefault:d,enableUnknownDefault:i,highCardinalityColumns:l,notes:u}},M3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isOrdinalEncodingNode:i}=e,[l,u]=b.useState(!1),[d,h]=b.useState(null),[p,m]=b.useState([]),[f,y]=b.useState({...Ip}),[x,_]=b.useState(0);b.useEffect(()=>{let N=!0;const C=j=>{m([]),y({...Ip}),u(!1),h(j??null)};return i?t?n?(u(!0),h(null),B0(t,{graph:s??null,targetNodeId:r??null}).then(j=>{N&&(m(S3(j)),y(E3(j)))}).catch(j=>{if(!N)return;const E=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load ordinal encoding suggestions";C(E)}).finally(()=>{N&&u(!1)}),()=>{N=!1}):(C("Connect this node to the dataset input to load suggestions."),()=>{N=!1}):(C(),()=>{N=!1}):(C(),()=>{N=!1})},[s,n,i,x,t,r]);const v=b.useCallback(()=>{!i||!t||!n||_(N=>N+1)},[n,i,t]),w=b.useMemo(()=>f,[f]),M=b.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:M,metadata:w,refresh:v}},Bp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,cautionedCount:0,highCardinalityColumns:[],notes:[],autoDetectDefault:!1},k3=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},Up=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],A3=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=k3(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,h=typeof t.text_category=="string"?t.text_category:null,p=Up(t.sample_values),m=typeof t.estimated_dummy_columns=="number"?Math.max(0,Math.round(t.estimated_dummy_columns)):0,f=typeof t.score=="number"?t.score:0,y=typeof t.selectable=="boolean"?t.selectable:!0,x=typeof t.recommended_drop_first=="boolean"?t.recommended_drop_first:!0;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:h,sample_values:p,estimated_dummy_columns:m,score:f,selectable:y,recommended_drop_first:x}}).filter(t=>!!t),O3=e=>{if(!e||typeof e!="object")return{...Bp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=Number(e.cautioned_count??0)||0,l=Up(e.high_cardinality_columns),u=Up(e.notes),d=!!e.auto_detect_default;return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,cautionedCount:i,highCardinalityColumns:l,notes:u,autoDetectDefault:d}},T3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isDummyEncodingNode:i}=e,[l,u]=b.useState(!1),[d,h]=b.useState(null),[p,m]=b.useState([]),[f,y]=b.useState({...Bp}),[x,_]=b.useState(0);b.useEffect(()=>{let N=!0;const C=j=>{m([]),y({...Bp}),u(!1),h(j??null)};return i?t?n?(u(!0),h(null),V0(t,{graph:s??null,targetNodeId:r??null}).then(j=>{N&&(m(A3(j)),y(O3(j)))}).catch(j=>{if(!N)return;const E=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load dummy encoding suggestions";C(E)}).finally(()=>{N&&u(!1)}),()=>{N=!1}):(C("Connect this node to the dataset input to load suggestions."),()=>{N=!1}):(C(),()=>{N=!1}):(C(),()=>{N=!1})},[s,n,i,x,t,r]);const v=b.useCallback(()=>{!i||!t||!n||_(N=>N+1)},[n,i,t]),w=b.useMemo(()=>f,[f]),M=b.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:M,metadata:w,refresh:v}},Hp={sampleSize:null,generatedAt:null,totalTextColumns:0,recommendedCount:0,cautionedCount:0,highCardinalityColumns:[],notes:[]},$3=e=>{if(typeof e!="string")return"recommended";const t=e.trim().toLowerCase();switch(t){case"recommended":case"high_cardinality":case"identifier":case"free_text":case"single_category":case"too_many_categories":return t;default:return"recommended"}},qp=e=>Array.isArray(e)?e.map(t=>t==null?"":String(t)).filter(t=>t.trim().length>0):[],P3=e=>!e||!Array.isArray(e.columns)?[]:e.columns.map(t=>{if(!t||typeof t!="object")return null;const n=typeof t.column=="string"?t.column.trim():"";if(!n)return null;const s=$3(t.status),r=typeof t.reason=="string"?t.reason:"",i=typeof t.dtype=="string"?t.dtype:null,l=typeof t.unique_count=="number"?t.unique_count:null,u=typeof t.unique_percentage=="number"?t.unique_percentage:null,d=typeof t.missing_percentage=="number"?t.missing_percentage:null,h=typeof t.text_category=="string"?t.text_category:null,p=qp(t.sample_values),m=typeof t.estimated_dummy_columns=="number"?Math.max(0,Math.round(t.estimated_dummy_columns)):0,f=typeof t.score=="number"?t.score:0,y=typeof t.selectable=="boolean"?t.selectable:!0,x=typeof t.recommended_drop_first=="boolean"?t.recommended_drop_first:!1;return{column:n,status:s,reason:r,dtype:i,unique_count:l,unique_percentage:u,missing_percentage:d,text_category:h,sample_values:p,estimated_dummy_columns:m,score:f,selectable:y,recommended_drop_first:x}}).filter(t=>!!t),L3=e=>{if(!e||typeof e!="object")return{...Hp};const t=typeof e.sample_size=="number"?e.sample_size:null,n=typeof e.generated_at=="string"?e.generated_at:null,s=Number(e.total_text_columns??0)||0,r=Number(e.recommended_count??0)||0,i=Number(e.cautioned_count??0)||0,l=qp(e.high_cardinality_columns),u=qp(e.notes);return{sampleSize:t,generatedAt:n,totalTextColumns:s,recommendedCount:r,cautionedCount:i,highCardinalityColumns:l,notes:u}},R3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isOneHotEncodingNode:i}=e,[l,u]=b.useState(!1),[d,h]=b.useState(null),[p,m]=b.useState([]),[f,y]=b.useState({...Hp}),[x,_]=b.useState(0);b.useEffect(()=>{let N=!0;const C=j=>{m([]),y({...Hp}),u(!1),h(j??null)};return i?t?n?(u(!0),h(null),q0(t,{graph:s??null,targetNodeId:r??null}).then(j=>{N&&(m(P3(j)),y(L3(j)))}).catch(j=>{if(!N)return;const E=typeof(j==null?void 0:j.message)=="string"?j.message:"Unable to load one-hot encoding suggestions";C(E)}).finally(()=>{N&&u(!1)}),()=>{N=!1}):(C("Connect this node to the dataset input to load suggestions."),()=>{N=!1}):(C(),()=>{N=!1}):(C(),()=>{N=!1})},[s,n,i,x,t,r]);const v=b.useCallback(()=>{!i||!t||!n||_(N=>N+1)},[n,i,t]),w=b.useMemo(()=>f,[f]),M=b.useMemo(()=>p,[p]);return{isFetching:l,error:d,suggestions:M,metadata:w,refresh:v}},D3=({catalogFlags:e,enableGlobalFallbackDefault:t,encodeMissing:n,handleUnknown:s,setConfigState:r,nodeChangeVersion:i})=>{const{isTargetEncodingNode:l}=e,u=b.useRef(!1);b.useEffect(()=>{u.current=!1},[i]),b.useEffect(()=>{if(!l||!t||u.current)return;const d=typeof n=="boolean"?n:null,h=typeof s=="string"?s.trim().toLowerCase():"";if(d===!0&&h==="global_mean"){u.current=!0;return}r(p=>{const m=typeof(p==null?void 0:p.encode_missing)=="boolean"?p.encode_missing:null,f=typeof(p==null?void 0:p.handle_unknown)=="string"?p.handle_unknown.trim().toLowerCase():"";if(m===!0&&f==="global_mean")return u.current=!0,p;const y={...p};return m!==!0&&(y.encode_missing=!0),f!=="global_mean"&&(y.handle_unknown="global_mean"),u.current=!0,y})},[n,s,l,t,r])},z3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,node:r,configState:i,setConfigState:l,nodeChangeVersion:u})=>{const{isLabelEncodingNode:d,isTargetEncodingNode:h,isHashEncodingNode:p,isOrdinalEncodingNode:m,isDummyEncodingNode:f,isOneHotEncodingNode:y}=e,x=(r==null?void 0:r.id)??null,{isFetching:_,error:v,suggestions:w,metadata:M}=g3({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:N,error:C,suggestions:j,metadata:E}=x3({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x});D3({catalogFlags:e,enableGlobalFallbackDefault:E.enableGlobalFallbackDefault,encodeMissing:i==null?void 0:i.encode_missing,handleUnknown:i==null?void 0:i.handle_unknown,setConfigState:l,nodeChangeVersion:u});const{isFetching:k,error:$,suggestions:T,metadata:P}=j3({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:A,error:D,suggestions:F,metadata:R}=M3({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:z,error:q,suggestions:V,metadata:U}=T3({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x}),{isFetching:W,error:B,suggestions:I,metadata:H}=R3({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:x});b.useEffect(()=>{d&&(i!=null&&i.auto_detect)&&M.autoDetectDefault&&l(Q=>({...Q,columns:M.autoDetectDefault}))},[i==null?void 0:i.auto_detect,d,M.autoDetectDefault,l]),b.useEffect(()=>{h&&(i!=null&&i.auto_detect)&&E.autoDetectDefault&&l(Q=>({...Q,columns:E.autoDetectDefault}))},[i==null?void 0:i.auto_detect,h,l,E.autoDetectDefault]),b.useEffect(()=>{p&&(i!=null&&i.auto_detect)&&P.autoDetectDefault&&l(Q=>({...Q,columns:P.autoDetectDefault}))},[i==null?void 0:i.auto_detect,P.autoDetectDefault,p,l]),b.useEffect(()=>{p&&P.suggestedBucketDefault&&l(Q=>({...Q,n_buckets:P.suggestedBucketDefault}))},[P.suggestedBucketDefault,p,l]),b.useEffect(()=>{h&&E.enableGlobalFallbackDefault&&l(Q=>{const ne={};return Q.encode_missing===void 0&&(ne.encode_missing=!0),Q.handle_unknown===void 0&&(ne.handle_unknown="value"),Object.keys(ne).length>0?{...Q,...ne}:Q})},[i==null?void 0:i.encode_missing,i==null?void 0:i.handle_unknown,h,l,E.enableGlobalFallbackDefault]),b.useEffect(()=>{m&&(i!=null&&i.auto_detect)&&R.autoDetectDefault&&l(Q=>({...Q,columns:R.autoDetectDefault}))},[i==null?void 0:i.auto_detect,m,R.autoDetectDefault,l]),b.useEffect(()=>{m&&R.enableUnknownDefault&&l(Q=>Q.handle_unknown===void 0?{...Q,handle_unknown:"use_encoded_value",unknown_value:-1}:Q)},[i==null?void 0:i.handle_unknown,m,R.enableUnknownDefault,l]),b.useEffect(()=>{f&&(i!=null&&i.auto_detect)&&U.autoDetectDefault&&l(Q=>({...Q,columns:U.autoDetectDefault}))},[i==null?void 0:i.auto_detect,U.autoDetectDefault,f,l]);const J=b.useCallback(Q=>{l(ne=>({...ne,columns:Q}))},[l]),G=b.useCallback(Q=>{l(ne=>({...ne,columns:Q}))},[l]),Y=b.useCallback(Q=>{l(ne=>({...ne,columns:Q}))},[l]),X=b.useCallback(Q=>{l(ne=>({...ne,columns:Q}))},[l]),Z=b.useCallback(Q=>{l(ne=>({...ne,columns:Q}))},[l]),ee=b.useCallback(Q=>{l(ne=>({...ne,columns:Q}))},[l]);return{labelEncoding:{isFetching:_,error:v,suggestions:w,metadata:M,handleApplyRecommended:J},targetEncoding:{isFetching:N,error:C,suggestions:j,metadata:E,handleApplyRecommended:G},hashEncoding:{isFetching:k,error:$,suggestions:T,metadata:P,handleApplyRecommended:Y},ordinalEncoding:{isFetching:A,error:D,suggestions:F,metadata:R,handleApplyRecommended:X},dummyEncoding:{isFetching:z,error:q,suggestions:V,metadata:U,handleApplyRecommended:Z},oneHotEncoding:{isFetching:W,error:B,suggestions:I,metadata:H,handleApplyRecommended:ee}}},I3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isOutlierNode:i}=e,[l,u]=b.useState(null),[d,h]=b.useState(null),[p,m]=b.useState(!1),[f,y]=b.useState(0),x=b.useCallback(()=>{y(_=>_+1)},[]);return b.useEffect(()=>{let _=!0;return i?t?n?(m(!0),h(null),W0(t,{graph:s,targetNodeId:r}).then(v=>{_&&u(v??null)}).catch(v=>{_&&(u(null),h((v==null?void 0:v.message)??"Unable to load outlier insights"))}).finally(()=>{_&&m(!1)}),()=>{_=!1}):(u(null),h("Connect this step to an upstream output to load outlier insights."),m(!1),()=>{_=!1}):(u(null),h("Select a dataset to load outlier insights."),m(!1),()=>{_=!1}):(u(null),h(null),m(!1),()=>{_=!1})},[s,n,i,f,t,r]),{outlierData:l,outlierError:d,isFetchingOutliers:p,refreshOutliers:x}},F3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isScalingNode:i}=e,[l,u]=b.useState(null),[d,h]=b.useState(null),[p,m]=b.useState(!1),[f,y]=b.useState(0),x=b.useCallback(()=>{y(_=>_+1)},[]);return b.useEffect(()=>{let _=!0;return i?t?n?(m(!0),h(null),K0(t,{graph:s,targetNodeId:r}).then(v=>{_&&u(v??null)}).catch(v=>{_&&(u(null),h((v==null?void 0:v.message)??"Unable to load scaling insights"))}).finally(()=>{_&&m(!1)}),()=>{_=!1}):(u(null),h("Connect this step to an upstream output to load scaling insights."),m(!1),()=>{_=!1}):(u(null),h("Select a dataset to load scaling insights."),m(!1),()=>{_=!1}):(u(null),h(null),m(!1),()=>{_=!1})},[s,n,i,f,t,r]),{scalingData:l,scalingError:d,isFetchingScaling:p,refreshScaling:x}},B3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r})=>{const{isBinningNode:i}=e,[l,u]=b.useState(null),[d,h]=b.useState(null),[p,m]=b.useState(!1),[f,y]=b.useState(0),x=b.useCallback(()=>{y(_=>_+1)},[]);return b.useEffect(()=>{let _=!0;return i?t?n?(m(!0),h(null),G0(t,{graph:s,targetNodeId:r}).then(v=>{_&&u(v??null)}).catch(v=>{_&&(u(null),h((v==null?void 0:v.message)??"Unable to load binning insights"))}).finally(()=>{_&&m(!1)}),()=>{_=!1}):(u(null),h("Connect this step to an upstream output to analyse numeric columns."),m(!1),()=>{_=!1}):(u(null),h("Select a dataset to load binning insights."),m(!1),()=>{_=!1}):(u(null),h(null),m(!1),()=>{_=!1})},[s,n,i,f,t,r]),{binningData:l,binningError:d,isFetchingBinning:p,refreshBinning:x}},U3=({catalogFlags:e,sourceId:t,hasReachableSource:n,graphContext:s,targetNodeId:r,samplePreset:i})=>{const{isBinnedDistributionNode:l}=e,[u,d]=b.useState(null),[h,p]=b.useState(null),[m,f]=b.useState(!1),[y,x]=b.useState(0),_=b.useCallback(()=>{x(v=>v+1)},[]);return b.useEffect(()=>{let v=!0;if(!l)return d(null),p(null),f(!1),()=>{v=!1};if(!t)return d(null),p("Select a dataset to load binned column distributions."),f(!1),()=>{v=!1};if(!n)return d(null),p("Connect this step to an upstream output to load binned column distributions."),f(!1),()=>{v=!1};f(!0),p(null);const w=_c.find(N=>N.value===i)??_c[0],M=w.value==="all"?"all":Number(w.value);return X0(t,{sampleSize:M,graph:s,targetNodeId:r}).then(N=>{v&&d(N??null)}).catch(N=>{v&&(d(null),p((N==null?void 0:N.message)??"Unable to load binned column distributions"))}).finally(()=>{v&&f(!1)}),()=>{v=!1}},[s,n,l,y,i,t,r]),{binnedDistributionData:u,binnedDistributionError:h,isFetchingBinnedDistribution:m,refreshBinnedDistribution:_}},H3=({catalogFlags:e,sourceId:t,graphContext:n,targetNodeId:s,transformations:r})=>{const{isSkewnessNode:i,isSkewnessDistributionNode:l}=e,u=i||l,[d,h]=b.useState(null),[p,m]=b.useState(null),[f,y]=b.useState(!1),[x,_]=b.useState(0),v=b.useRef(null),w=b.useCallback(()=>{_(M=>M+1)},[]);return b.useEffect(()=>{let M=!0;return u?t?(v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{if(!M)return;y(!0),m(null);let N;r.length>0&&(N=r.map(C=>({column:C.column,method:C.method}))),Y0(t,{transformations:N,graph:n,targetNodeId:s}).then(C=>{M&&h(C??null)}).catch(C=>{M&&(h(null),m((C==null?void 0:C.message)??"Unable to load skewness insights"))}).finally(()=>{M&&y(!1)})},300),()=>{M=!1,v.current&&clearTimeout(v.current)}):(h(null),m("Select a dataset to load skewness insights."),y(!1),v.current&&(clearTimeout(v.current),v.current=null),()=>{M=!1}):(h(null),m(null),y(!1),v.current&&(clearTimeout(v.current),v.current=null),()=>{M=!1})},[n,x,u,t,s,r]),{skewnessData:d,skewnessError:p,isFetchingSkewness:f,refreshSkewness:w}},q3="_was_missing",V3=(e,t)=>{const n=typeof e=="string"?e.trim():"";if(n)return n;const s=typeof t=="string"?t.trim():"";return s||q3},W3=(e,t)=>{const n=typeof e=="string"?e.trim():"",s=typeof t=="string"?t:"";return!n||!s?!1:n.endsWith(s)},Y3=({selectedColumns:e,availableColumns:t,columnMissingMap:n,suffix:s})=>{const r=typeof s=="string"?s:"",i=Ge(t),l=new Set(i),u=Array.from(new Set(Ge(e))),d=[];if(u.forEach(m=>{const f=`${m}${r}`,y=n[m],x=typeof y=="number"&&Number.isFinite(y)?Math.max(0,y):null;d.push({column:m,missingPercentage:x,flagColumn:f,conflicts:{alreadyExists:l.has(f),duplicateFlag:!1}})}),d.length>0){const m=new Map;d.forEach(f=>{m.set(f.flagColumn,(m.get(f.flagColumn)??0)+1)}),d.forEach(f=>{f.conflicts.duplicateFlag=(m.get(f.flagColumn)??0)>1})}d.sort((m,f)=>{const y=m.missingPercentage,x=f.missingPercentage,_=typeof y=="number",v=typeof x=="number";return _&&v&&y!==x?x-y:_!==v?_?-1:1:m.column.localeCompare(f.column)});const h=r?Array.from(new Set(i.filter(m=>W3(m,r)))):[],p=d.reduce((m,f)=>f.conflicts.alreadyExists||f.conflicts.duplicateFlag?m+1:m,0);return{rows:d,flaggedColumnsInDataset:h,conflictCount:p}},K3=({catalogFlags:e,configState:t,node:n,availableColumns:s,columnMissingMap:r})=>{var h,p;const{isMissingIndicatorNode:i}=e,l=b.useMemo(()=>{var m,f;return i?V3(t==null?void 0:t.flag_suffix,(f=(m=n==null?void 0:n.data)==null?void 0:m.config)==null?void 0:f.flag_suffix):""},[t==null?void 0:t.flag_suffix,i,(p=(h=n==null?void 0:n.data)==null?void 0:h.config)==null?void 0:p.flag_suffix]),u=b.useMemo(()=>i?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,i]),d=b.useMemo(()=>i?Y3({selectedColumns:u,availableColumns:s,columnMissingMap:r,suffix:l}):{rows:[],flaggedColumnsInDataset:[],conflictCount:0},[l,s,r,i,u]);return{activeFlagSuffix:l,missingIndicatorColumns:u,missingIndicatorInsights:d}},pj={enabled:!1,explicit:!1},G3={selectedColumns:[],nonTextSelected:[],autoDetectionActive:!1,recommendedColumns:[],textColumnCount:0,textColumns:[]},X3={totalPairs:0,previewPairs:[],previewOverflow:0,duplicates:[],duplicateOverflow:0,invalidEntries:[],invalidOverflow:0},Q3={},Z3=[],J3=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isReplaceAliasesNode:l}=e,u=b.useMemo(()=>{if(!l)return pj;const v=Zi(t);if(v!==void 0)return{enabled:!!Fo(v),explicit:!0};if(n&&typeof n=="object"){const w=Zi(n);if(w!==void 0)return{enabled:!!Fo(w),explicit:!0}}return pj},[t,l,n]),d=b.useMemo(()=>{if(!l)return[];const v=Ge((t==null?void 0:t.columns)??(n==null?void 0:n.columns)),w=kd(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),M=(()=>{const C=Zi(t);if(C!==void 0){const j=Fo(C);if(j!==null)return j}if(n&&typeof n=="object"){const j=Zi(n);if(j!==void 0){const E=Fo(j);if(E!==null)return E}}return v.length===0})(),N=(t==null?void 0:t.alias_strategies)??(t==null?void 0:t.strategies)??(n==null?void 0:n.alias_strategies)??(n==null?void 0:n.strategies);return Sw(N,{mode:w,columns:v,autoDetect:M})},[t,l,n]),h=b.useMemo(()=>l?d.length?Array.from(new Set(d.flatMap(v=>v.columns.map(w=>w.trim()).filter(Boolean)))).sort((v,w)=>v.localeCompare(w)):Ge(t==null?void 0:t.columns):[],[d,t==null?void 0:t.columns,l]),p=b.useMemo(()=>l?d.length?d.some(v=>v.autoDetect):u.explicit?u.enabled:h.length===0:!1,[u.enabled,u.explicit,h.length,d,l]),m=b.useMemo(()=>{if(l)return t==null?void 0:t.custom_pairs},[t==null?void 0:t.custom_pairs,l]),f=b.useMemo(()=>l?yR(i):Q3,[l,i]),y=b.useMemo(()=>l?mR({selectedColumns:h,availableColumns:s,columnTypeMap:r,autoDetectEnabled:p}):G3,[p,h,s,r,l]),x=b.useMemo(()=>l?hR(m):X3,[l,m]),_=b.useMemo(()=>{if(!l)return Z3;const v=new Set(y.recommendedColumns),w=new Set(y.textColumns);return s.map(M=>{const N=r[M]??null,C=f[M]??[];return{name:M,dtype:N,samples:C.slice(0,3),isRecommended:v.has(M),isTextLike:w.has(M)}})},[y.recommendedColumns,y.textColumns,f,s,r,l]);return{aliasAutoDetectMeta:u,aliasStrategies:d,aliasStrategyCount:d.length,aliasSelectedColumns:h,aliasAutoDetectEnabled:p,replaceAliasesCustomPairsValue:m,aliasColumnSummary:y,aliasCustomPairSummary:x,aliasSampleMap:f,aliasColumnOptions:_}},eB=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isTrimWhitespaceNode:l,isRemoveSpecialCharsNode:u,isRegexCleanupNode:d,isNormalizeTextCaseNode:h}=e,p=b.useMemo(()=>GR(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,l,n==null?void 0:n.mode]),m=b.useMemo(()=>l?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,l]),f=b.useMemo(()=>l?nD(i):{},[l,i]),y=b.useMemo(()=>l?ZR({selectedColumns:m,availableColumns:s,columnTypeMap:r,sampleMap:f}):rD,[s,r,l,m,f]),x=b.useMemo(()=>XR(p),[p]),_=b.useMemo(()=>gD(u?t==null?void 0:t.mode:void 0,u?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,u,n==null?void 0:n.mode]),v=b.useMemo(()=>u?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,u]),w=b.useMemo(()=>u?bD(i):{},[u,i]),M=b.useMemo(()=>u?vD({selectedColumns:v,availableColumns:s,columnTypeMap:r,sampleMap:w}):ND,[s,r,u,v,w]),N=b.useMemo(()=>_D(_),[_]),C=b.useMemo(()=>GD(d?t==null?void 0:t.mode:void 0,d?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,d,n==null?void 0:n.mode]),j=b.useMemo(()=>d?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,d]),E=b.useMemo(()=>d?ez(i):{},[d,i]),k=b.useMemo(()=>d?ZD({selectedColumns:j,availableColumns:s,columnTypeMap:r,sampleMap:E}):sz,[s,r,d,j,E]),$=b.useMemo(()=>XD(C),[C]),T=b.useMemo(()=>{if(!d)return null;const z=(t==null?void 0:t.replacement)??(n==null?void 0:n.replacement)??null;return typeof z=="string"?z:null},[t==null?void 0:t.replacement,d,n==null?void 0:n.replacement]),P=b.useMemo(()=>$D(h?t==null?void 0:t.mode:void 0,h?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,h,n==null?void 0:n.mode]),A=b.useMemo(()=>h?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,h]),D=b.useMemo(()=>h?zD(i):{},[h,i]),F=b.useMemo(()=>h?RD({selectedColumns:A,availableColumns:s,columnTypeMap:r,sampleMap:D,mode:P}):FD,[s,r,h,A,P,D]),R=b.useMemo(()=>PD(P),[P]);return{trimWhitespace:{columnSummary:y,sampleMap:f,modeDetails:x},removeSpecial:{columnSummary:M,sampleMap:w,modeDetails:N,selectedMode:_},regexCleanup:{columnSummary:k,sampleMap:E,modeDetails:$,selectedMode:C,replacementValue:T},normalizeCase:{columnSummary:F,sampleMap:D,modeDetails:R,selectedMode:P}}},tB={},nB=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isReplaceInvalidValuesNode:l}=e,u=b.useMemo(()=>hz(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,l,n==null?void 0:n.mode]),d=b.useMemo(()=>l?Ge(t==null?void 0:t.columns):[],[t==null?void 0:t.columns,l]),h=b.useMemo(()=>{if(!l)return null;const x=(t==null?void 0:t.min_value)??(n==null?void 0:n.min_value),_=Number(x);return Number.isFinite(_)?_:null},[t==null?void 0:t.min_value,l,n==null?void 0:n.min_value]),p=b.useMemo(()=>{if(!l)return null;const x=(t==null?void 0:t.max_value)??(n==null?void 0:n.max_value),_=Number(x);return Number.isFinite(_)?_:null},[t==null?void 0:t.max_value,l,n==null?void 0:n.max_value]),m=b.useMemo(()=>l?vz(i):tB,[l,i]),f=b.useMemo(()=>l?_z({selectedColumns:d,availableColumns:s,columnTypeMap:r,sampleMap:m}):Ez,[s,r,l,m,d]),y=b.useMemo(()=>pz(u),[u]);return{selectedColumns:d,selectedMode:u,modeDetails:y,sampleMap:m,columnSummary:f,minValue:h,maxValue:p}},sB={},rB=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isStandardizeDatesNode:l}=e,u=b.useMemo(()=>Dw(l?t==null?void 0:t.mode:void 0,l?n==null?void 0:n.mode:void 0),[t==null?void 0:t.mode,l,n==null?void 0:n.mode]),d=b.useMemo(()=>l?Ge((t==null?void 0:t.columns)??(n==null?void 0:n.columns)):[],[t==null?void 0:t.columns,l,n==null?void 0:n.columns]),h=b.useMemo(()=>{if(!l)return[];const _={columns:d,mode:u,autoDetect:d.length===0};return zw((t==null?void 0:t.format_strategies)??(n==null?void 0:n.format_strategies),_)},[t==null?void 0:t.format_strategies,l,d,n==null?void 0:n.format_strategies,u]),p=b.useMemo(()=>{if(!l)return[];const _=new Set;return h.forEach(v=>{v.columns.forEach(w=>{const M=w.trim();M&&_.add(M)})}),Array.from(_).sort((v,w)=>v.localeCompare(w))},[l,h]),m=b.useMemo(()=>h.some(_=>_.autoDetect),[h]),f=b.useMemo(()=>l?IR(i):sB,[l,i]),y=b.useMemo(()=>{if(!l)return FR;const _=$R({selectedColumns:p,availableColumns:s,columnTypeMap:r,sampleMap:f});return m?{..._,autoDetectionActive:!0}:_},[s,r,m,l,f,p]),x=b.useMemo(()=>{if(!l)return[];const _=new Set(y.recommendedColumns),v=new Set(y.sampleCandidates);return s.map(w=>{const M=r[w]??null,N=f[w]??[];return{name:w,dtype:M,samples:N.slice(0,3),isRecommended:_.has(w),isSampleCandidate:v.has(w)}})},[s,y,r,l,f]);return{selectedMode:u,strategies:h,sampleMap:f,columnSummary:y,columnOptions:x}},aB=({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i})=>{const{isReplaceAliasesNode:l,isTrimWhitespaceNode:u,isRemoveSpecialCharsNode:d,isRegexCleanupNode:h,isNormalizeTextCaseNode:p,isReplaceInvalidValuesNode:m,isStandardizeDatesNode:f}=e,{aliasAutoDetectMeta:y,aliasStrategies:x,aliasStrategyCount:_,aliasSelectedColumns:v,aliasAutoDetectEnabled:w,replaceAliasesCustomPairsValue:M,aliasColumnSummary:N,aliasCustomPairSummary:C,aliasSampleMap:j,aliasColumnOptions:E}=J3({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i}),{trimWhitespace:k,removeSpecial:$,regexCleanup:T,normalizeCase:P}=eB({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i}),{selectedMode:A,modeDetails:D,sampleMap:F,columnSummary:R,minValue:z,maxValue:q}=nB({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i}),{selectedMode:V,strategies:U,sampleMap:W,columnSummary:B,columnOptions:I}=rB({catalogFlags:e,configState:t,nodeConfig:n,availableColumns:s,columnTypeMap:r,previewSampleRows:i});return{alias:{autoDetectMeta:y,strategies:x,strategyCount:_,selectedColumns:v,autoDetectEnabled:w,customPairsValue:M,columnSummary:N,customPairSummary:C,sampleMap:j,columnOptions:E},trimWhitespace:k,removeSpecial:$,regexCleanup:T,normalizeCase:P,replaceInvalid:{mode:A,modeDetails:D,sampleMap:F,columnSummary:R,minValue:z,maxValue:q},standardizeDates:{mode:V,strategies:U,sampleMap:W,columnSummary:B,columnOptions:I}}},oB=["int","float","double","decimal","number","numeric","long","short"],iB=["datetime","date","time","timestamp"],lB=["object","string","text","category","categorical","char"],cB=({catalogFlags:e,availableColumns:t,columnTypeMap:n,previewSampleRows:s})=>{const{isBinningNode:r,isScalingNode:i,isOutlierNode:l}=e,u=r||i||l,d=b.useMemo(()=>{if(!u)return{excluded:new Set,reasons:new Map};const h=new Set,p=new Map;return t.forEach(m=>{const f=(n[m]??"").toLowerCase(),y=oB.some(j=>f.includes(j)),x=iB.some(j=>f.includes(j)),_=lB.some(j=>f.includes(j));if(f.includes("bool")){h.add(m),p.set(m,"Boolean dtype");return}if((x||_)&&!y){h.add(m),p.set(m,"Non-numeric dtype");return}const v=s.map(j=>j&&Object.prototype.hasOwnProperty.call(j,m)?j[m]:void 0).filter(j=>j!=null);if(!v.length){y||(h.add(m),p.set(m,"No numeric samples"));return}let w=!0,M=!1,N=!1;const C=new Set;for(const j of v){if(typeof j=="boolean"){C.add(j?"1":"0");continue}if(typeof j=="number"){if(!Number.isFinite(j)){w=!1;break}M=!0,Math.abs(j)<1e-9?C.add("0"):Math.abs(j-1)<1e-9?C.add("1"):N=!0;continue}if(typeof j=="string"){const E=j.trim();if(!E)continue;const k=E.toLowerCase();if(IN.has(k)){C.add("1");continue}if(FN.has(k)){C.add("0");continue}const $=Number(E);if(!Number.isNaN($)&&Number.isFinite($)){M=!0,Math.abs($)<1e-9?C.add("0"):Math.abs($-1)<1e-9?C.add("1"):N=!0;continue}w=!1;break}w=!1;break}if(!w||!M&&!y){h.add(m),p.set(m,"Non-numeric values");return}!N&&C.size>0&&Array.from(C).every(E=>E==="0"||E==="1")&&(h.add(m),p.set(m,"Binary/bool-like values"))}),{excluded:h,reasons:p}},[t,n,s,u]);return{numericExcludedColumns:d.excluded,numericExclusionReasons:d.reasons}},uB=({catalogFlags:e,configState:t,numericExcludedColumns:n,scalingData:s})=>{const{isScalingNode:r}=e,i=b.useMemo(()=>uj(t),[t]),l=b.useMemo(()=>new Set(i.skippedColumns),[i.skippedColumns]),u=b.useMemo(()=>r?n:new Set,[r,n]),d=b.useMemo(()=>r?new Set(i.columns):new Set,[r,i.columns]),h=b.useMemo(()=>new Set(Object.keys(i.columnMethods)),[i.columnMethods]),p=b.useMemo(()=>Array.isArray(s==null?void 0:s.columns)?s.columns.filter(F=>!!(F&&F.column)):[],[s==null?void 0:s.columns]),m=b.useMemo(()=>ZF(s==null?void 0:s.methods),[s==null?void 0:s.methods]),f=b.useMemo(()=>JF(s==null?void 0:s.methods),[s==null?void 0:s.methods]),y=b.useMemo(()=>t3({recommendations:p,scalingConfig:i,scalingMethodLabelMap:m,scalingSelectedSet:d,scalingSkippedColumns:l,scalingExcludedColumns:u}),[p,i,m,d,l,u]),x=b.useMemo(()=>Array.from(h).sort((F,R)=>F.localeCompare(R)),[h]),_=b.useMemo(()=>x.slice(0,4),[x]),v=y.length,w=h.size,M=d.size,N=i.autoDetect,C=b.useMemo(()=>f.get(i.defaultMethod)??null,[i.defaultMethod,f]),j=b.useMemo(()=>{const F=i.defaultMethod;return m[F]??qo[F]??F},[i.defaultMethod,m]),E=v>0,k=b.useMemo(()=>y.filter(F=>!F.isSkipped&&!F.isExcluded&&F.isSelected&&F.recommendedMethod!==F.currentMethod).length,[y]),$=b.useMemo(()=>y.filter(F=>F.isSelected&&!F.isSkipped&&!F.isExcluded).length,[y]),T=b.useMemo(()=>y.filter(F=>F.isSkipped&&!F.isExcluded).length,[y]),P=b.useMemo(()=>y.length?k>0?`${k} column${k===1?"":"s"} need attention. Apply the recommended scalers or override them manually below.`:$>0?"All configured columns align with the recommended scalers.":T>0?"All recommendations are currently skipped.":"Review the recommendations below.":"No scaling recommendations yetselect numeric columns to evaluate.",[k,$,y,T]),A=b.useMemo(()=>e3(m),[m]),D=b.useMemo(()=>n3(_,i.columnMethods,m,w),[_,i.columnMethods,m,w]);return{scalingConfig:i,scalingExcludedColumns:u,scalingMethodDetailMap:f,scalingMethodOptions:A,scalingRecommendations:p,scalingRecommendationRows:y,scalingSelectedCount:M,scalingOverrideCount:w,scalingDefaultDetail:C,scalingDefaultLabel:j,scalingAutoDetectEnabled:N,scalingHasRecommendations:E,scalingStatusMessage:P,scalingOverrideExampleSummary:D}},Gs=["iqr","zscore","elliptic_envelope","winsorize","manual"],tl={iqr:"IQR filter",zscore:"Z-score filter",elliptic_envelope:"Elliptic Envelope",winsorize:"Winsorize",manual:"Manual bounds"},Wd={iqr:["multiplier"],zscore:["threshold"],elliptic_envelope:["contamination"],winsorize:["lower_percentile","upper_percentile"],manual:["lower_bound","upper_bound"]},Oa={iqr:{multiplier:1.5},zscore:{threshold:3},elliptic_envelope:{contamination:.01},winsorize:{lower_percentile:5,upper_percentile:95},manual:{}},Yd=(e,{min:t,max:n}={})=>{const s=typeof e=="number"?e:Number(e);if(!Number.isFinite(s))return null;let r=s;return typeof t=="number"&&Number.isFinite(t)&&r<t&&(r=t),typeof n=="number"&&Number.isFinite(n)&&r>n&&(r=n),r},gj=e=>{const t=[];return Array.isArray(e)?e.forEach(n=>{const s=String(n??"").trim();s&&t.push(s)}):typeof e=="string"&&e.split(",").map(n=>n.trim()).forEach(n=>{n&&t.push(n)}),Array.from(new Set(t)).sort((n,s)=>n.localeCompare(s))},dB=e=>{const t={iqr:{...Oa.iqr},zscore:{...Oa.zscore},elliptic_envelope:{...Oa.elliptic_envelope},winsorize:{...Oa.winsorize},manual:{}};return!e||typeof e!="object"||Array.isArray(e)||Object.entries(e).forEach(([n,s])=>{const r=n.trim().toLowerCase();if(!Gs.includes(r))return;const i=t[r]??{};if(!(!s||typeof s!="object"||Array.isArray(s))){if(Object.entries(s).forEach(([l,u])=>{const d=l.trim().toLowerCase();if(!Wd[r].includes(d))return;let h={};d==="threshold"?h={min:.1}:d==="multiplier"?h={min:.1}:(d==="lower_percentile"||d==="upper_percentile")&&(h={min:0,max:100});const p=Yd(u,h);p!==null&&(i[d]=p)}),r==="winsorize"){const l=Yd(i.lower_percentile,{min:0,max:100}),u=Yd(i.upper_percentile,{min:0,max:100});typeof l=="number"&&typeof u=="number"&&l>=u?(i.lower_percentile=Oa.winsorize.lower_percentile,i.upper_percentile=Oa.winsorize.upper_percentile):(typeof l=="number"&&(i.lower_percentile=l),typeof u=="number"&&(i.upper_percentile=u))}t[r]=i}}),t},mB=e=>{if(!e||typeof e!="object"||Array.isArray(e))return{};const t={};return Object.entries(e).forEach(([n,s])=>{const r=String(n??"").trim();if(!r||!s||typeof s!="object"||Array.isArray(s))return;const i={};Object.entries(s).forEach(([l,u])=>{const d=l.trim().toLowerCase();if(!Object.values(Wd).some(f=>f.includes(d)))return;let p={};d==="threshold"?p={min:.1}:d==="multiplier"?p={min:.1}:d==="contamination"?p={min:1e-4,max:.49}:(d==="lower_percentile"||d==="upper_percentile")&&(p={min:0,max:100});const m=Yd(u,p);m!==null&&(i[d]=m)}),Object.keys(i).length&&(t[r]=i)}),t},fB=e=>{const t=e&&typeof e=="object"&&!Array.isArray(e)?e:{},n=gj(t.columns),s=typeof t.default_method=="string"?t.default_method.trim().toLowerCase():"",r=Gs.includes(s)?s:"iqr",i={};t.column_methods&&typeof t.column_methods=="object"&&!Array.isArray(t.column_methods)&&Object.entries(t.column_methods).forEach(([p,m])=>{const f=String(p??"").trim(),y=typeof m=="string"?m.trim().toLowerCase():"";f&&Gs.includes(y)&&(i[f]=y)});const l=typeof t.auto_detect=="boolean"?t.auto_detect:!0,u=gj(t.skipped_columns),d=dB(t.method_parameters),h=mB(t.column_parameters);return{columns:n,defaultMethod:r,columnMethods:i,autoDetect:l,skippedColumns:u,methodParameters:d,columnParameters:h}},hB=e=>{const t={...tl};return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null,r=typeof(n==null?void 0:n.label)=="string"?n.label.trim():"";s&&r&&Gs.includes(s)&&(t[s]=r)}),t},pB=e=>{const t=new Map;return Array.isArray(e)&&e.forEach(n=>{const s=typeof(n==null?void 0:n.key)=="string"?n.key.trim().toLowerCase():null;s&&Gs.includes(s)&&t.set(s,n)}),t},gB=e=>Gs.map(t=>({value:t,label:e[t]??tl[t]??t})),_B=({insights:e,outlierConfig:t,labelMap:n,selectedColumns:s,skippedColumns:r,excludedColumns:i})=>{if(!e.length)return[];const l=[];return e.forEach(u=>{const d=String((u==null?void 0:u.column)??"").trim();if(!d)return;const h={};Array.isArray(u==null?void 0:u.method_summaries)&&u.method_summaries.forEach(N=>{const C=N==null?void 0:N.method;C&&Gs.includes(C)&&(h[C]=N)});const p=u!=null&&u.recommended_method&&Gs.includes(u.recommended_method)?u.recommended_method:null,m=p?n[p]??tl[p]??p:null,f=t.columnMethods[d]??null,y=f??t.defaultMethod,x=n[y]??tl[y]??y,_=r.has(d),v=i.has(d),w=s.has(d),M=!!(u!=null&&u.has_missing);l.push({column:d,dtype:typeof(u==null?void 0:u.dtype)=="string"?u.dtype:null,stats:(u==null?void 0:u.stats)??{},recommendedMethod:p,recommendedLabel:m,recommendedReason:typeof(u==null?void 0:u.recommended_reason)=="string"?u.recommended_reason:null,methodSummaries:h,currentOverride:f,currentMethod:y,currentMethodLabel:x,isOverrideApplied:f!==null,isSelected:w,isSkipped:_,isExcluded:v,hasMissing:M})}),l.sort((u,d)=>u.column.localeCompare(d.column)),l},yB=(e,t,n,s)=>{if(!e.length)return null;const r=e.map(i=>{const l=t[i],u=l?n[l]??tl[l]??l:null;return u?`${i} -> ${u}`:i});return s>e.length&&r.push(""),r.join(", ")},vB=({catalogFlags:e,configState:t,numericExcludedColumns:n,outlierData:s})=>{const{isOutlierNode:r}=e,i=b.useMemo(()=>fB(t),[t]),l=b.useMemo(()=>Array.isArray(s==null?void 0:s.columns)?s.columns.filter(F=>!!(F&&F.column)):[],[s==null?void 0:s.columns]),u=b.useMemo(()=>new Set(i.skippedColumns),[i.skippedColumns]),d=b.useMemo(()=>r?new Set(i.columns):new Set,[r,i.columns]),h=b.useMemo(()=>{if(!r||!n.size)return new Set;const F=new Set;i.columns.forEach(z=>{const q=String(z??"").trim();q&&F.add(q)}),l.forEach(z=>{const q=String((z==null?void 0:z.column)??"").trim();q&&F.add(q)});const R=new Set;return n.forEach(z=>{F.has(z)||R.add(z)}),R},[r,n,i.columns,l]),p=b.useMemo(()=>new Set(Object.keys(i.columnMethods)),[i.columnMethods]),m=b.useMemo(()=>hB(s==null?void 0:s.methods),[s==null?void 0:s.methods]),f=b.useMemo(()=>pB(s==null?void 0:s.methods),[s==null?void 0:s.methods]),y=b.useMemo(()=>_B({insights:l,outlierConfig:i,labelMap:m,selectedColumns:d,skippedColumns:u,excludedColumns:h}),[l,i,m,d,u,h]),x=b.useMemo(()=>gB(m),[m]),_=b.useMemo(()=>Array.from(p).sort((F,R)=>F.localeCompare(R)),[p]),v=b.useMemo(()=>_.slice(0,4),[_]),w=d.size,M=p.size,N=b.useMemo(()=>Object.keys(i.columnParameters).length,[i.columnParameters]),C=i.autoDetect,j=b.useMemo(()=>f.get(i.defaultMethod)??null,[i.defaultMethod,f]),E=b.useMemo(()=>{const F=i.defaultMethod;return m[F]??tl[F]??F},[i.defaultMethod,m]),k=y.length>0,$=b.useMemo(()=>y.filter(F=>F.isSkipped||F.isExcluded||!F.isSelected||!F.recommendedMethod?!1:F.recommendedMethod!==F.currentMethod).length,[y]),T=b.useMemo(()=>y.filter(F=>F.isSelected&&!F.isSkipped&&!F.isExcluded).length,[y]),P=b.useMemo(()=>y.filter(F=>F.isSkipped&&!F.isExcluded).length,[y]),A=b.useMemo(()=>y.length?$>0?`${$} column${$===1?"":"s"} need attention. Apply the recommended strategies or adjust manually below.`:T>0?"All configured columns align with the recommended outlier handling strategies.":P>0?"All outlier recommendations are currently skipped.":"Review the outlier diagnostics below.":"No outlier recommendations yetselect numeric columns to evaluate.",[$,T,y,P]),D=b.useMemo(()=>yB(v,i.columnMethods,m,M),[v,i.columnMethods,m,M]);return{outlierConfig:i,outlierExcludedColumns:h,outlierMethodLabelMap:m,outlierMethodDetailMap:f,outlierMethodOptions:x,outlierRecommendations:l,outlierRecommendationRows:y,outlierSelectedCount:w,outlierOverrideCount:M,outlierParameterOverrideCount:N,outlierDefaultDetail:j,outlierDefaultLabel:E,outlierAutoDetectEnabled:C,outlierHasRecommendations:k,outlierStatusMessage:A,outlierOverrideExampleSummary:D}},xB=({configState:e,nodeId:t})=>{const n=b.useMemo(()=>pw(e),[e]),s=n.columns.length,r=ip[n.strategy]??n.strategy,i=b.useMemo(()=>Object.keys(n.columnStrategies).map(x=>x.trim()).filter(Boolean).sort((x,_)=>x.localeCompare(_)),[n.columnStrategies]),l=i.length,u=b.useMemo(()=>{if(!i.length)return null;const x=i.slice(0,4);return EL(x,n.columnStrategies,l)},[n.columnStrategies,i,l]),d=b.useMemo(()=>`binning-${t||"node"}`,[t]),h=b.useMemo(()=>({equalWidth:`${d}-equal-width-bins`,equalFrequency:`${d}-equal-frequency-bins`,precision:`${d}-precision`,suffix:`${d}-suffix`,missingLabel:`${d}-missing-label`,includeLowest:`${d}-include-lowest`,dropOriginal:`${d}-drop-original`,labelFormat:`${d}-label-format`,duplicates:`${d}-duplicates`,kbinsNBins:`${d}-kbins-n-bins`,kbinsEncode:`${d}-kbins-encode`,kbinsStrategy:`${d}-kbins-strategy`}),[d]),[p,m]=b.useState({}),[f,y]=b.useState({});return b.useEffect(()=>{m(x=>{const _=new Set,v={...x};return n.columns.forEach(w=>{const M=String(w??"").trim();if(!M||(_.add(M),Object.prototype.hasOwnProperty.call(v,M)))return;const N=n.customBins[M]??[];v[M]=N.length>=2?N.join(", "):""}),Object.keys(v).forEach(w=>{_.has(w)||delete v[w]}),v})},[n.columns,n.customBins]),b.useEffect(()=>{y(x=>{const _=new Set,v={...x};return n.columns.forEach(w=>{const M=String(w??"").trim();if(!M||(_.add(M),Object.prototype.hasOwnProperty.call(v,M)))return;const N=n.customLabels[M]??[];v[M]=N.length>0?N.join(", "):""}),Object.keys(v).forEach(w=>{_.has(w)||delete v[w]}),v})},[n.columns,n.customLabels]),{binningConfig:n,binningSelectedCount:s,binningDefaultLabel:r,binningOverrideColumns:i,binningOverrideCount:l,binningOverrideSummary:u,fieldIds:h,customEdgeDrafts:p,setCustomEdgeDrafts:m,customLabelDrafts:f,setCustomLabelDrafts:y}},bB=({setConfigState:e,setBinningCustomEdgeDrafts:t,setBinningCustomLabelDrafts:n,binningConfig:s,binningInsightsRecommendations:r,binningAllNumericColumns:i})=>{const l=b.useCallback((T,P,A,D)=>{e(F=>{const R=typeof(F==null?void 0:F[T])=="number"&&Number.isFinite(F[T])?F[T]:void 0;if(P===""){if(R===void 0)return F;const V={...F};return delete V[T],V}const z=Number(P);if(!Number.isFinite(z))return F;const q=Math.min(Math.max(Math.round(z),A),D);return R===q?F:{...F,[T]:q}})},[e]),u=b.useCallback((T,P)=>{e(A=>!!(A!=null&&A[T])===P?A:{...A,[T]:P})},[e]),d=b.useCallback(T=>{const P=T.trim();e(A=>{const D=typeof(A==null?void 0:A.output_suffix)=="string"?A.output_suffix:"";if(!P){if(!D)return A;const F={...A};return delete F.output_suffix,F}return D===P?A:{...A,output_suffix:P}})},[e]),h=b.useCallback(T=>{e(P=>{const A=typeof(P==null?void 0:P.label_format)=="string"?P.label_format:"";return(["range","bin_index","ordinal","column_suffix"].includes(A)?A:"range")===T?P:{...P,label_format:T}})},[e]),p=b.useCallback(T=>{e(P=>{if(((P==null?void 0:P.missing_strategy)==="label"?"label":"keep")===T)return P;const D={...P,missing_strategy:T};return T!=="label"&&Object.prototype.hasOwnProperty.call(D,"missing_label")&&delete D.missing_label,D})},[e]),m=b.useCallback(T=>{const P=T.trim();e(A=>{const D=typeof(A==null?void 0:A.missing_label)=="string"?A.missing_label:"";if(!P){if(!D)return A;const F={...A};return delete F.missing_label,F}return D===P?A:{...A,missing_label:P}})},[e]),f=b.useCallback((T,P)=>{const A=String(T??"").trim();A&&(t(D=>({...D,[A]:P})),e(D=>{const F=D==null?void 0:D.custom_bins,R=F&&typeof F=="object"&&!Array.isArray(F)?F:{},z=Array.isArray(R[A])?R[A]:void 0,V=P.split(/[,\n]/).map(I=>I.trim()).filter(Boolean).map(I=>Number(I)).filter(I=>Number.isFinite(I)).sort((I,H)=>I-H).filter((I,H,J)=>H===0||I!==J[H-1]),U=V.length>=2;if(U&&z&&z.length===V.length&&z.every((I,H)=>I===V[H])||!U&&!z)return D;const W={...D},B={...R};return U?B[A]=V:delete B[A],Object.keys(B).length>0?W.custom_bins=B:delete W.custom_bins,W}))},[t,e]),y=b.useCallback((T,P)=>{const A=String(T??"").trim();A&&(n(D=>({...D,[A]:P})),e(D=>{const F=D==null?void 0:D.custom_labels,R=F&&typeof F=="object"&&!Array.isArray(F)?F:{},z=Array.isArray(R[A])?R[A]:void 0,q=P.split(/[,\n]/).map(W=>W.trim()).filter(Boolean);if(q.length>0&&z&&z.length===q.length&&z.every((W,B)=>W===q[B])||q.length===0&&!z)return D;const V={...D},U={...R};return q.length>0?U[A]=q:delete U[A],Object.keys(U).length>0?V.custom_labels=U:delete V.custom_labels,V}))},[n,e]),x=b.useCallback(T=>{const P=String(T??"").trim();P&&(t(A=>{if(!Object.prototype.hasOwnProperty.call(A,P))return A;const D={...A};return delete D[P],D}),n(A=>{if(!Object.prototype.hasOwnProperty.call(A,P))return A;const D={...A};return delete D[P],D}),e(A=>{let D=!1;const F={...A};if(A!=null&&A.custom_bins&&typeof A.custom_bins=="object"&&!Array.isArray(A.custom_bins)&&Object.prototype.hasOwnProperty.call(A.custom_bins,P)){const R={...A.custom_bins};delete R[P],Object.keys(R).length>0?F.custom_bins=R:delete F.custom_bins,D=!0}if(A!=null&&A.custom_labels&&typeof A.custom_labels=="object"&&!Array.isArray(A.custom_labels)&&Object.prototype.hasOwnProperty.call(A.custom_labels,P)){const R={...A.custom_labels};delete R[P],Object.keys(R).length>0?F.custom_labels=R:delete F.custom_labels,D=!0}return D?F:A}))},[t,n,e]),_=b.useCallback((T,P)=>{const A=String(T??"").trim();A&&e(D=>{const R={...D!=null&&D.column_strategies&&typeof D.column_strategies=="object"&&!Array.isArray(D.column_strategies)?D.column_strategies:D!=null&&D.column_overrides&&typeof D.column_overrides=="object"&&!Array.isArray(D.column_overrides)?D.column_overrides:{}},z=R[A],q=z&&typeof z=="object"&&!Array.isArray(z)?{...z}:{},V=P(q),U=!!(V&&Object.keys(V).length);U?R[A]=V:delete R[A];const W={...D};if(U){const B=new Set(Ge(D==null?void 0:D.columns));B.has(A)||(B.add(A),W.columns=Array.from(B).sort((I,H)=>I.localeCompare(H)))}return Object.keys(R).length?(W.column_overrides=R,W.column_strategies=R):(Object.prototype.hasOwnProperty.call(W,"column_overrides")&&delete W.column_overrides,Object.prototype.hasOwnProperty.call(W,"column_strategies")&&delete W.column_strategies),W})},[e]),v=b.useCallback((T,P,A)=>{const D=String(T??"").trim();if(!D)return;if(P==="__default__"){x(D),_(D,()=>null);return}const F=Number.isFinite(A==null?void 0:A.recommendedBins)?Math.round(A.recommendedBins):null;_(D,R=>{const z={...R};z.strategy=P;const q=V=>Math.min(200,Math.max(2,Math.round(F??V)));return P==="equal_width"?(z.equal_width_bins=q(s.equalWidthBins),delete z.equal_frequency_bins,delete z.kbins_n_bins,delete z.kbins_encode,delete z.kbins_strategy):P==="equal_frequency"?(z.equal_frequency_bins=q(s.equalFrequencyBins),delete z.equal_width_bins,delete z.kbins_n_bins,delete z.kbins_encode,delete z.kbins_strategy):P==="kbins"?(z.kbins_n_bins=q(s.kbinsNBins),z.kbins_encode=s.kbinsEncode,z.kbins_strategy=s.kbinsStrategy,delete z.equal_width_bins,delete z.equal_frequency_bins):P==="custom"&&(delete z.equal_width_bins,delete z.equal_frequency_bins,delete z.kbins_n_bins,delete z.kbins_encode,delete z.kbins_strategy),Object.keys(z).length?z:null}),P!=="custom"&&x(D)},[s.equalFrequencyBins,s.equalWidthBins,s.kbinsEncode,s.kbinsNBins,s.kbinsStrategy,x,_]),w=b.useCallback((T,P,A)=>{const D=String(T??"").trim();D&&(_(D,F=>{const R={...F};if(!A.trim())delete R[P];else{const z=Number(A);if(!Number.isFinite(z))return F;const q=Math.min(200,Math.max(2,Math.round(z)));R[P]=q,P==="equal_width_bins"?(R.strategy="equal_width",delete R.equal_frequency_bins,delete R.kbins_n_bins,delete R.kbins_encode,delete R.kbins_strategy):P==="equal_frequency_bins"?(R.strategy="equal_frequency",delete R.equal_width_bins,delete R.kbins_n_bins,delete R.kbins_encode,delete R.kbins_strategy):P==="kbins_n_bins"&&(R.strategy="kbins",delete R.equal_width_bins,delete R.equal_frequency_bins)}return Object.keys(R).length?R:null}),x(D))},[x,_]),M=b.useCallback((T,P)=>{const A=String(T??"").trim();A&&_(A,D=>{const F={...D};return P?(F.strategy="kbins",F.kbins_encode=P):delete F.kbins_encode,Object.keys(F).length?F:null})},[_]),N=b.useCallback((T,P)=>{const A=String(T??"").trim();A&&_(A,D=>{const F={...D};return P?(F.strategy="kbins",F.kbins_strategy=P):delete F.kbins_strategy,Object.keys(F).length?F:null})},[_]),C=b.useCallback(T=>{const P=String(T??"").trim();P&&(x(P),_(P,()=>null))},[x,_]),j=b.useCallback(()=>{e(T=>{if(!((T==null?void 0:T.column_strategies)&&typeof T.column_strategies=="object"&&!Array.isArray(T.column_strategies)&&Object.keys(T.column_strategies).length>0||(T==null?void 0:T.column_overrides)&&typeof T.column_overrides=="object"&&!Array.isArray(T.column_overrides)&&Object.keys(T.column_overrides).length>0))return T;const A={...T};return Object.prototype.hasOwnProperty.call(A,"column_overrides")&&delete A.column_overrides,Object.prototype.hasOwnProperty.call(A,"column_strategies")&&delete A.column_strategies,A})},[e]),E=b.useCallback(()=>{r.length&&r.forEach(T=>{const P=typeof(T==null?void 0:T.column)=="string"?T.column.trim():"";if(!P)return;const A=T.recommended_strategy??"equal_width";v(P,A,{recommendedBins:Number.isFinite(T==null?void 0:T.recommended_bins)?T.recommended_bins:null})})},[r,v]),k=b.useCallback(T=>{if(!T)return;const P=[];for(const A of T){const D=typeof A=="string"?A.trim():"";D&&P.push(D)}P.length&&e(A=>{const D=A&&typeof A=="object"?A:{},F=new Set(Ge(D.columns));let R=!1;if(P.forEach(q=>{F.has(q)||(F.add(q),R=!0)}),!R)return A;const z={...D};return z.columns=Array.from(F).sort((q,V)=>q.localeCompare(V)),z})},[e]),$=b.useCallback(()=>{i.length&&k(i)},[i,k]);return{handleBinningIntegerChange:l,handleBinningBooleanToggle:u,handleBinningSuffixChange:d,handleBinningLabelFormatChange:h,handleBinningMissingStrategyChange:p,handleBinningMissingLabelChange:m,handleBinningCustomBinsChange:f,handleBinningCustomLabelsChange:y,handleBinningClearCustomColumn:x,updateBinningColumnOverride:_,handleBinningOverrideStrategyChange:v,handleBinningOverrideNumberChange:w,handleBinningOverrideKbinsEncodeChange:M,handleBinningOverrideKbinsStrategyChange:N,handleBinningClearOverride:C,handleBinningClearOverrides:j,handleBinningApplyStrategies:E,handleBinningApplyColumns:k,handleApplyAllBinningNumeric:$}},wB=({setConfigState:e,outlierRecommendationRows:t,outlierExcludedColumns:n,outlierConfig:s})=>{const r=b.useCallback(x=>{Gs.includes(x)&&e(_=>(_==null?void 0:_.default_method)===x?_:{..._,default_method:x})},[e]),i=b.useCallback(x=>{e(_=>(typeof(_==null?void 0:_.auto_detect)=="boolean"?_.auto_detect:!0)===x?_:{..._,auto_detect:x})},[e]),l=b.useCallback((x,_)=>{const v=String(x??"").trim();v&&e(w=>{if(!w||typeof w!="object")return w;const M=Ge(w.columns),N=new Set(M),C=w.column_methods&&typeof w.column_methods=="object"&&!Array.isArray(w.column_methods)?{...w.column_methods}:{};let j=!1;if(_){if(!Gs.includes(_))return w;C[v]!==_&&(C[v]=_,j=!0),N.has(v)||(N.add(v),j=!0)}else Object.prototype.hasOwnProperty.call(C,v)&&(delete C[v],j=!0);if(!j)return w;const E={...w};return E.columns=Array.from(N).sort((k,$)=>k.localeCompare($)),Object.keys(C).length?E.column_methods=C:Object.prototype.hasOwnProperty.call(E,"column_methods")&&delete E.column_methods,E})},[e]),u=b.useCallback(()=>{e(x=>{if(!x||typeof x!="object")return x;const _=x.column_methods&&typeof x.column_methods=="object"&&!Array.isArray(x.column_methods)&&Object.keys(x.column_methods).length>0,v=x.column_parameters&&typeof x.column_parameters=="object"&&!Array.isArray(x.column_parameters)&&Object.keys(x.column_parameters).length>0;if(!_&&!v)return x;const w={...x};return _&&delete w.column_methods,v&&delete w.column_parameters,w})},[e]),d=b.useCallback(()=>{t.length&&e(x=>{if(!x||typeof x!="object")return x;const _=new Set(Ge(x.columns)),v=new Set(Ge(x.skipped_columns)),w=x.column_methods&&typeof x.column_methods=="object"&&!Array.isArray(x.column_methods)?{...x.column_methods}:{},M=x.column_parameters&&typeof x.column_parameters=="object"&&!Array.isArray(x.column_parameters)?{...x.column_parameters}:{};let N=!1;if(t.forEach(j=>{if(!j||j.isExcluded||!j.recommendedMethod)return;const E=String(j.column??"").trim();if(!E||n.has(E))return;const k=j.recommendedMethod;Gs.includes(k)&&(v.has(E)&&(v.delete(E),N=!0),_.has(E)||(_.add(E),N=!0),k===s.defaultMethod?Object.prototype.hasOwnProperty.call(w,E)&&(delete w[E],N=!0):w[E]!==k&&(w[E]=k,N=!0),Object.prototype.hasOwnProperty.call(M,E)&&(delete M[E],N=!0))}),!N)return x;const C={...x,columns:Array.from(_).sort((j,E)=>j.localeCompare(E))};return v.size?C.skipped_columns=Array.from(v).sort((j,E)=>j.localeCompare(E)):Object.prototype.hasOwnProperty.call(C,"skipped_columns")&&delete C.skipped_columns,Object.keys(w).length?C.column_methods=w:Object.prototype.hasOwnProperty.call(C,"column_methods")&&delete C.column_methods,Object.keys(M).length?C.column_parameters=M:Object.prototype.hasOwnProperty.call(C,"column_parameters")&&delete C.column_parameters,C})},[s.defaultMethod,n,t,e]),h=b.useCallback(x=>{const _=String(x??"").trim();_&&e(v=>{if(!v||typeof v!="object")return v;const w=Ge(v.columns),M=w.filter(D=>D!==_),N=new Set(Ge(v.skipped_columns)),C=N.size;N.add(_);const j=C!==N.size,E=v.column_methods&&typeof v.column_methods=="object"&&!Array.isArray(v.column_methods)?{...v.column_methods}:{},k=Object.prototype.hasOwnProperty.call(E,_);k&&delete E[_];const $=v.column_parameters&&typeof v.column_parameters=="object"&&!Array.isArray(v.column_parameters)?{...v.column_parameters}:{},T=Object.prototype.hasOwnProperty.call($,_);if(T&&delete $[_],!(M.length!==w.length)&&!j&&!k&&!T)return v;const A={...v,columns:M.sort((D,F)=>D.localeCompare(F)),skipped_columns:Array.from(N).sort((D,F)=>D.localeCompare(F))};return Object.keys(E).length?A.column_methods=E:Object.prototype.hasOwnProperty.call(A,"column_methods")&&delete A.column_methods,Object.keys($).length?A.column_parameters=$:Object.prototype.hasOwnProperty.call(A,"column_parameters")&&delete A.column_parameters,A})},[e]),p=b.useCallback(x=>{const _=String(x??"").trim();_&&e(v=>{if(!v||typeof v!="object")return v;const w=Ge(v.skipped_columns);if(!w.includes(_))return v;const M=w.filter(j=>j!==_),N=new Set(Ge(v.columns));N.has(_)||N.add(_);const C={...v,columns:Array.from(N).sort((j,E)=>j.localeCompare(E))};return M.length?C.skipped_columns=M.sort((j,E)=>j.localeCompare(E)):Object.prototype.hasOwnProperty.call(C,"skipped_columns")&&delete C.skipped_columns,C})},[e]),m=b.useCallback((x,_)=>{if(_==="__skip__"){h(x);return}if(_==="__default__"){p(x),l(x,null);return}Gs.includes(_)&&(p(x),l(x,_))},[h,p,l]),f=b.useCallback((x,_,v)=>{const w=String(_??"").trim().toLowerCase();e(M=>{if(!M||typeof M!="object")return M;const N=M.method_parameters&&typeof M.method_parameters=="object"&&!Array.isArray(M.method_parameters)?{...M.method_parameters}:{},C={...N[x]??{}},j=typeof v=="number"&&Number.isFinite(v)?v:null;let E=!1;if(j===null?Object.prototype.hasOwnProperty.call(C,w)&&(delete C[w],E=!0):C[w]!==j&&(C[w]=j,E=!0),!E)return M;if(Object.keys(C).length?N[x]=C:delete N[x],!Object.keys(N).length){const k={...M};return Object.prototype.hasOwnProperty.call(k,"method_parameters")&&delete k.method_parameters,k}return{...M,method_parameters:N}})},[e]),y=b.useCallback((x,_,v)=>{const w=String(x??"").trim();if(!w)return;const M=String(_??"").trim().toLowerCase();e(N=>{if(!N||typeof N!="object")return N;const C=N.column_parameters&&typeof N.column_parameters=="object"&&!Array.isArray(N.column_parameters)?{...N.column_parameters}:{},j={...C[w]??{}},E=typeof v=="number"&&Number.isFinite(v)?v:null;let k=!1;if(E===null?Object.prototype.hasOwnProperty.call(j,M)&&(delete j[M],k=!0):j[M]!==E&&(j[M]=E,k=!0),!k)return N;if(Object.keys(j).length?C[w]=j:delete C[w],!Object.keys(C).length){const $={...N};return Object.prototype.hasOwnProperty.call($,"column_parameters")&&delete $.column_parameters,$}return{...N,column_parameters:C}})},[e]);return{handleOutlierDefaultMethodChange:r,handleOutlierAutoDetectToggle:i,setOutlierColumnMethod:l,handleOutlierClearOverrides:u,handleOutlierApplyAllRecommendations:d,handleOutlierSkipColumn:h,handleOutlierUnskipColumn:p,handleOutlierOverrideSelect:m,handleOutlierMethodParameterChange:f,handleOutlierColumnParameterChange:y}},NB=({setConfigState:e,scalingRecommendations:t})=>{const n=b.useCallback(p=>{Ks.includes(p)&&e(m=>(m==null?void 0:m.default_method)===p?m:{...m,default_method:p})},[e]),s=b.useCallback(p=>{e(m=>(typeof(m==null?void 0:m.auto_detect)=="boolean"?m.auto_detect:!0)===p?m:{...m,auto_detect:p})},[e]),r=b.useCallback((p,m)=>{const f=String(p??"").trim();f&&e(y=>{const x=Ge(y.columns),_=x.includes(f),v=y.column_methods&&typeof y.column_methods=="object"&&!Array.isArray(y.column_methods)?{...y.column_methods}:{};if(m){if(!Ks.includes(m))return y;const N=(v[f]??null)!==m,C=!_;if(!N&&!C)return y;v[f]=m;const j=C?[...x,f].sort((E,k)=>E.localeCompare(k)):x;return{...y,columns:j,column_methods:v}}if(!Object.prototype.hasOwnProperty.call(v,f))return y;if(delete v[f],Object.keys(v).length)return{...y,column_methods:v};const w={...y};return Object.prototype.hasOwnProperty.call(w,"column_methods")&&delete w.column_methods,w})},[e]),i=b.useCallback(()=>{e(p=>{if(!p.column_methods||typeof p.column_methods!="object"||Array.isArray(p.column_methods)||!Object.keys(p.column_methods).length)return p;const m={...p};return delete m.column_methods,m})},[e]),l=b.useCallback(()=>{t.length&&e(p=>{const m=Ge(p.columns),f=new Set(m),y=new Set(Ge(p.skipped_columns)),x=p.column_methods&&typeof p.column_methods=="object"&&!Array.isArray(p.column_methods)?{...p.column_methods}:{};let _=!1;if(t.forEach(w=>{const M=String(w.column??"").trim(),N=w.recommended_method;!M||!Ks.includes(N)||y.has(M)||(x[M]!==N&&(x[M]=N,_=!0),f.has(M)||(f.add(M),_=!0))}),!_)return p;const v=Array.from(f).sort((w,M)=>w.localeCompare(M));return{...p,columns:v,column_methods:x}})},[t,e]),u=b.useCallback(p=>{const m=String(p??"").trim();m&&e(f=>{const y=Ge(f.columns),x=y.filter(C=>C!==m),_=new Set(Ge(f.skipped_columns)),v=_.size;_.add(m);const w=_.size!==v,M=f.column_methods&&typeof f.column_methods=="object"&&!Array.isArray(f.column_methods)?{...f.column_methods}:{},N=Object.prototype.hasOwnProperty.call(M,m);return N&&delete M[m],!w&&x.length===y.length&&!N?f:{...f,columns:x.sort((C,j)=>C.localeCompare(j)),column_methods:M,skipped_columns:Array.from(_).sort((C,j)=>C.localeCompare(j))}})},[e]),d=b.useCallback(p=>{const m=String(p??"").trim();m&&e(f=>{const y=Ge(f.skipped_columns);if(!y.includes(m))return f;const x=new Set(y);x.delete(m);const _=new Set(Ge(f.columns));return _.has(m)||_.add(m),{...f,columns:Array.from(_).sort((w,M)=>w.localeCompare(M)),skipped_columns:Array.from(x).sort((w,M)=>w.localeCompare(M))}})},[e]),h=b.useCallback((p,m)=>{if(m==="__skip__"){u(p);return}if(m==="__default__"){d(p),r(p,null);return}Ks.includes(m)&&(d(p),r(p,m))},[u,d,r]);return{handleScalingDefaultMethodChange:n,handleScalingAutoDetectToggle:s,setScalingColumnMethod:r,handleScalingClearOverrides:i,handleScalingApplyAllRecommendations:l,handleScalingSkipColumn:u,handleScalingUnskipColumn:d,handleScalingOverrideSelect:h}},jB=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const t=Number(e);if(Number.isFinite(t))return t}return null},CB=({catalogFlags:e,numericExcludedColumns:t,selectedColumns:n,previewSampleRows:s,availableColumns:r,recommendedColumns:i})=>{const{isBinningNode:l}=e,u=b.useMemo(()=>{if(!i)return null;const m=new Set;for(const f of i){const y=typeof f=="string"?f.trim():"";y&&m.add(y)}return m.size>0?m:null},[i]),d=b.useMemo(()=>{if(!Array.isArray(n)||!n.length)return null;const m=new Set;return n.forEach(f=>{const y=typeof f=="string"?f.trim():"";y&&m.add(y)}),m.size>0?m:null},[n]),h=b.useMemo(()=>{if(!l)return new Set;if(!t.size||!u&&!d)return t;const m=new Set;return t.forEach(f=>{u!=null&&u.has(f)||d!=null&&d.has(f)||m.add(f)}),m},[l,t,u,d]),p=b.useMemo(()=>{if(!l||!s.length)return{};const m={};return r.forEach(f=>{if(h.has(f))return;let y=null,x=null;const _=new Set;if(s.forEach(v=>{if(!v||!Object.prototype.hasOwnProperty.call(v,f))return;const w=jB(v[f]);w!==null&&((y===null||w<y)&&(y=w),(x===null||w>x)&&(x=w),_.size<=1e3&&_.add(w))}),y!==null||x!==null){const v=_.size>0?_.size:null;m[f]={min:y,max:x,distinct:v}}}),m},[r,h,l,s]);return{binningExcludedColumns:h,binningColumnPreviewMap:p,manualBoundColumns:[],manualRangeFallbackMap:{}}},SB=({catalogFlags:e,scalingExcludedColumns:t,binningExcludedColumns:n,outlierExcludedColumns:s,setConfigState:r})=>{const{isScalingNode:i,isBinningNode:l,isOutlierNode:u}=e;b.useEffect(()=>{!i||t.size===0||r(d=>{if(!d||typeof d!="object")return d;const h=Ge(d.columns);if(!h.length)return d;const p=h.filter(f=>!t.has(f));if(p.length===h.length||!p.length)return d;const m={...d,columns:p};if(d.column_methods&&typeof d.column_methods=="object"&&!Array.isArray(d.column_methods)){const f={};let y=!1;Object.entries(d.column_methods).forEach(([x,_])=>{const v=String(x??"").trim();if(!v)return;if(t.has(v)){y=!0;return}const w=typeof _=="string"?_.trim():null;w&&Ks.includes(w)&&(f[v]=w)}),y?Object.keys(f).length?m.column_methods=f:m.column_methods={}:m.column_methods=d.column_methods}return m})},[i,t,r]),b.useEffect(()=>{!l||n.size===0||r(d=>{if(!d||typeof d!="object")return d;const h=Ge(d.columns);if(!h.length)return d;const p=h.filter(y=>!n.has(y));if(p.length===h.length)return d;const m=new Set(h.filter(y=>n.has(y))),f={...d,columns:p};if(d.custom_bins&&typeof d.custom_bins=="object"&&!Array.isArray(d.custom_bins)){const y={};Object.entries(d.custom_bins).forEach(([x,_])=>{!m.has(x)&&Array.isArray(_)&&_.length&&(y[x]=[..._])}),Object.keys(y).length?f.custom_bins=y:Object.prototype.hasOwnProperty.call(f,"custom_bins")&&delete f.custom_bins}if(d.custom_labels&&typeof d.custom_labels=="object"&&!Array.isArray(d.custom_labels)){const y={};Object.entries(d.custom_labels).forEach(([x,_])=>{!m.has(x)&&Array.isArray(_)&&_.length&&(y[x]=_.map(v=>String(v)))}),Object.keys(y).length?f.custom_labels=y:Object.prototype.hasOwnProperty.call(f,"custom_labels")&&delete f.custom_labels}return f})},[n,l,r]),b.useEffect(()=>{!u||s.size===0||r(d=>{if(!d||typeof d!="object")return d;const h=Ge(d.columns),p=h.filter(N=>!s.has(N)),m=p.length!==h.length,f=Ge(d.skipped_columns),y=f.filter(N=>!s.has(N)),x=y.length!==f.length,_=N=>N??{...d};let v=null;m&&(v=_(v),v.columns=p.sort((N,C)=>N.localeCompare(C))),x&&(v=_(v),y.length?v.skipped_columns=y.sort((N,C)=>N.localeCompare(C)):Object.prototype.hasOwnProperty.call(v,"skipped_columns")&&delete v.skipped_columns);let w=!1;if(d.column_methods&&typeof d.column_methods=="object"&&!Array.isArray(d.column_methods)){const N={};Object.entries(d.column_methods).forEach(([C,j])=>{const E=String(C??"").trim();if(!E||s.has(E)){w=!0;return}const k=typeof j=="string"?j.trim():null;k&&Gs.includes(k)?N[E]=k:w=!0}),w&&(v=_(v),Object.keys(N).length?v.column_methods=N:Object.prototype.hasOwnProperty.call(v,"column_methods")&&delete v.column_methods)}let M=!1;if(d.column_parameters&&typeof d.column_parameters=="object"&&!Array.isArray(d.column_parameters)){const N={};Object.entries(d.column_parameters).forEach(([C,j])=>{const E=String(C??"").trim();if(!E||s.has(E)){M=!0;return}if(!j||typeof j!="object"||Array.isArray(j)){M=!0;return}N[E]={...j}}),M&&(v=_(v),Object.keys(N).length?v.column_parameters=N:Object.prototype.hasOwnProperty.call(v,"column_parameters")&&delete v.column_parameters)}return v||d})},[u,s,r])},EB=({catalogFlags:e,configState:t,setConfigState:n,nodeId:s,numericExcludedColumns:r,scalingData:i,outlierData:l,binningData:u,availableColumns:d,previewSampleRows:h})=>{const{isScalingNode:p,isOutlierNode:m,isBinningNode:f}=e,{scalingConfig:y,scalingExcludedColumns:x,scalingMethodDetailMap:_,scalingMethodOptions:v,scalingRecommendations:w,scalingRecommendationRows:M,scalingSelectedCount:N,scalingOverrideCount:C,scalingDefaultDetail:j,scalingDefaultLabel:E,scalingAutoDetectEnabled:k,scalingHasRecommendations:$,scalingStatusMessage:T,scalingOverrideExampleSummary:P}=uB({catalogFlags:e,configState:t,numericExcludedColumns:r,scalingData:i}),{outlierConfig:A,outlierExcludedColumns:D,outlierMethodLabelMap:F,outlierMethodDetailMap:R,outlierMethodOptions:z,outlierRecommendations:q,outlierRecommendationRows:V,outlierSelectedCount:U,outlierOverrideCount:W,outlierParameterOverrideCount:B,outlierDefaultDetail:I,outlierDefaultLabel:H,outlierAutoDetectEnabled:J,outlierHasRecommendations:G,outlierStatusMessage:Y,outlierOverrideExampleSummary:X}=vB({catalogFlags:e,configState:t,numericExcludedColumns:r,outlierData:l}),Z=typeof(l==null?void 0:l.sample_size)=="number"?l.sample_size:null,ee=null,Q=W>0||B>0,ne=b.useMemo(()=>W>0?X:B>0?`${B} column${B===1?"":"s"} with parameter overrides`:null,[W,B,X]),{binningConfig:he,binningSelectedCount:ye,binningDefaultLabel:ge,binningOverrideColumns:Ee,binningOverrideCount:De,binningOverrideSummary:ke,fieldIds:le,customEdgeDrafts:pe,setCustomEdgeDrafts:be,customLabelDrafts:Te,setCustomLabelDrafts:Ie}=xB({configState:t,nodeId:s}),ue=b.useMemo(()=>p?y.columns:f?he.columns:m?A.columns:Ge(t==null?void 0:t.columns),[he.columns,t,f,m,p,A.columns,y.columns]),$e=b.useMemo(()=>{const Ht=u==null?void 0:u.columns;return Array.isArray(Ht)?Ht.filter(Qe=>!Qe||typeof Qe.column!="string"?!1:!!Qe.column.trim()):[]},[u==null?void 0:u.columns]),Ye=b.useMemo(()=>{if(!$e.length)return new Set;const Ht=new Set;return $e.forEach(Qe=>{const Ue=typeof Qe.column=="string"?Qe.column.trim():"";Ue&&Ht.add(Ue)}),Ht},[$e]),et=b.useMemo(()=>{if(!f)return[];const Ht=new Set;return d.forEach(Qe=>{if(r.has(Qe))return;const Ue=Qe.trim();Ue&&Ht.add(Ue)}),$e.forEach(Qe=>{const Ue=typeof Qe.column=="string"?Qe.column.trim():"";Ue&&(!r.has(Ue)||Ye.has(Ue))&&Ht.add(Ue)}),ue.forEach(Qe=>{const Ue=typeof Qe=="string"?Qe.trim():"";Ue&&(!r.has(Ue)||Ye.has(Ue))&&Ht.add(Ue)}),Array.from(Ht).sort((Qe,Ue)=>Qe.localeCompare(Ue))},[d,$e,Ye,f,r,ue]),We=b.useMemo(()=>!f||!et.length?[]:et.filter(Ht=>!ue.includes(Ht)),[et,f,ue]),mt=We.length>0,{handleBinningIntegerChange:rt,handleBinningBooleanToggle:ft,handleBinningSuffixChange:bt,handleBinningLabelFormatChange:zt,handleBinningMissingStrategyChange:Xe,handleBinningMissingLabelChange:Ft,handleBinningCustomBinsChange:Kt,handleBinningCustomLabelsChange:Et,handleBinningClearCustomColumn:Qt,updateBinningColumnOverride:wn,handleBinningOverrideStrategyChange:Mt,handleBinningOverrideNumberChange:Zt,handleBinningOverrideKbinsEncodeChange:Nn,handleBinningOverrideKbinsStrategyChange:Bt,handleBinningClearOverride:dt,handleBinningClearOverrides:Tn,handleBinningApplyStrategies:Xt,handleBinningApplyColumns:Nt,handleApplyAllBinningNumeric:at}=bB({setConfigState:n,setBinningCustomEdgeDrafts:be,setBinningCustomLabelDrafts:Ie,binningConfig:he,binningInsightsRecommendations:$e,binningAllNumericColumns:et}),{handleOutlierDefaultMethodChange:os,handleOutlierAutoDetectToggle:Vt,setOutlierColumnMethod:pt,handleOutlierClearOverrides:yt,handleOutlierApplyAllRecommendations:Gn,handleOutlierSkipColumn:mn,handleOutlierUnskipColumn:vn,handleOutlierOverrideSelect:nn,handleOutlierMethodParameterChange:jn,handleOutlierColumnParameterChange:Jt}=wB({setConfigState:n,outlierRecommendationRows:V,outlierExcludedColumns:D,outlierConfig:A}),{handleScalingDefaultMethodChange:Xn,handleScalingAutoDetectToggle:$t,setScalingColumnMethod:$n,handleScalingClearOverrides:xn,handleScalingApplyAllRecommendations:fn,handleScalingSkipColumn:ws,handleScalingUnskipColumn:Pn,handleScalingOverrideSelect:Ns}=NB({setConfigState:n,scalingRecommendations:w}),{binningExcludedColumns:Qn,binningColumnPreviewMap:is,manualBoundColumns:js,manualRangeFallbackMap:Fn}=CB({catalogFlags:e,numericExcludedColumns:r,selectedColumns:ue,previewSampleRows:h,availableColumns:d,recommendedColumns:Ye}),Zn=b.useMemo(()=>{const Ht=u==null?void 0:u.excluded_columns;return Array.isArray(Ht)?Ht.filter(Qe=>!Qe||typeof Qe.column!="string"?!1:!!Qe.column.trim()):[]},[u==null?void 0:u.excluded_columns]);return SB({catalogFlags:e,scalingExcludedColumns:x,binningExcludedColumns:Qn,outlierExcludedColumns:D,setConfigState:n}),{scaling:{config:y,state:{excludedColumns:x,methodDetailMap:_,methodOptions:v,recommendations:w,recommendationRows:M,selectedCount:N,overrideCount:C,defaultDetail:j,defaultLabel:E,autoDetectEnabled:k,hasRecommendations:$,statusMessage:T,overrideExampleSummary:P},handlers:{handleDefaultMethodChange:Xn,handleAutoDetectToggle:$t,setColumnMethod:$n,handleClearOverrides:xn,handleApplyAllRecommendations:fn,handleSkipColumn:ws,handleUnskipColumn:Pn,handleOverrideSelect:Ns}},outlier:{config:A,state:{excludedColumns:D,methodLabelMap:F,methodDetailMap:R,methodOptions:z,recommendations:q,recommendationRows:V,selectedCount:U,overrideCount:W,parameterOverrideCount:B,defaultDetail:I,defaultLabel:H,autoDetectEnabled:J,hasRecommendations:G,statusMessage:Y,overrideExampleSummary:X,sampleSize:Z,relativeGeneratedAt:ee,hasOverrides:Q,overrideSummaryDisplay:ne},handlers:{handleDefaultMethodChange:os,handleAutoDetectToggle:Vt,setColumnMethod:pt,handleClearOverrides:yt,handleApplyAllRecommendations:Gn,handleSkipColumn:mn,handleUnskipColumn:vn,handleOverrideSelect:nn,handleMethodParameterChange:jn,handleColumnParameterChange:Jt}},binning:{config:he,state:{selectedCount:ye,defaultLabel:ge,overrideColumns:Ee,overrideCount:De,overrideSummary:ke,fieldIds:le,customEdgeDrafts:pe,customLabelDrafts:Te,insightsRecommendations:$e,recommendedColumnSet:Ye,allNumericColumns:et,numericColumnsNotSelected:We,canApplyAllNumeric:mt,excludedColumns:Qn,columnPreviewMap:is,manualBoundColumns:js,manualRangeFallbackMap:Fn,insightsExcludedColumns:Zn},handlers:{setCustomEdgeDrafts:be,setCustomLabelDrafts:Ie,handleIntegerChange:rt,handleBooleanToggle:ft,handleSuffixChange:bt,handleLabelFormatChange:zt,handleMissingStrategyChange:Xe,handleMissingLabelChange:Ft,handleCustomBinsChange:Kt,handleCustomLabelsChange:Et,handleClearCustomColumn:Qt,updateColumnOverride:wn,handleOverrideStrategyChange:Mt,handleOverrideNumberChange:Zt,handleOverrideKbinsEncodeChange:Nn,handleOverrideKbinsStrategyChange:Bt,handleClearOverride:dt,handleClearOverrides:Tn,handleApplyStrategies:Xt,handleApplyColumns:Nt,handleApplyAllNumeric:at}},selectedColumns:ue}},MB=e=>{var t;return!!((t=e==null?void 0:e.data)!=null&&t.isDataset||(e==null?void 0:e.id)==="dataset-source")},kB=new Set(["binned_distribution","data_preview","outlier_monitor","skewness_distribution","dataset_profile","transformer_audit"]),AB=new Set(["trim_whitespace","normalize_text_case","replace_aliases_typos","standardize_date_formats","remove_special_characters","replace_invalid_values","regex_replace_fix"]),_j=e=>{var n;const t=((n=e==null?void 0:e.data)==null?void 0:n.catalogType)??"";return b.useMemo(()=>{const s=MB(e),r=t==="data_preview",i=t==="dataset_profile",l=t==="imputation_methods"||t==="advanced_imputer"||t==="simple_imputer",u=t==="missing_value_indicator",d=t==="replace_aliases_typos",h=t==="trim_whitespace",p=t==="remove_special_characters",m=t==="replace_invalid_values",f=t==="regex_replace_fix",y=t==="normalize_text_case",x=t==="standardize_date_formats",_=t==="label_encoding",v=t==="target_encoding",w=t==="hash_encoding",M=t==="train_model_draft",N=t==="model_evaluation",C=t==="model_registry_overview",j=t==="hyperparameter_tuning",E=t==="feature_target_split",k=t==="train_test_split",$=t==="class_undersampling",T=t==="class_oversampling",P=t==="ordinal_encoding",A=t==="dummy_encoding",D=t==="one_hot_encoding",F=t==="feature_math",R=t==="cast_column_types",z=t==="binning_discretization",q=t==="scale_numeric_features",V=t==="polynomial_features",U=t==="feature_selection",W=t==="transformer_audit",B=t==="outlier_removal",I=t==="skewness_transform",H=t==="skewness_distribution",J=t==="binned_distribution",G=AB.has(t),Y=kB.has(t),X=t==="remove_duplicates",Z=t==="drop_missing_columns",ee=t==="drop_missing_rows";return{catalogType:t,isDataset:s,isImputerNode:l,isMissingIndicatorNode:u,isReplaceAliasesNode:d,isTrimWhitespaceNode:h,isRemoveSpecialCharsNode:p,isReplaceInvalidValuesNode:m,isRegexCleanupNode:f,isNormalizeTextCaseNode:y,isStandardizeDatesNode:x,isLabelEncodingNode:_,isTargetEncodingNode:v,isHashEncodingNode:w,isTrainModelDraftNode:M,isModelEvaluationNode:N,isModelRegistryNode:C,isHyperparameterTuningNode:j,isFeatureTargetSplitNode:E,isTrainTestSplitNode:k,isClassUndersamplingNode:$,isClassOversamplingNode:T,isOrdinalEncodingNode:P,isDummyEncodingNode:A,isOneHotEncodingNode:D,isFeatureMathNode:F,isCastNode:R,isBinningNode:z,isScalingNode:q,isPolynomialFeaturesNode:V,isFeatureSelectionNode:U,isTransformerAuditNode:W,isOutlierNode:B,isSkewnessNode:I,isSkewnessDistributionNode:H,isBinnedDistributionNode:J,isDataConsistencyNode:G,isInspectionNode:Y,isRemoveDuplicatesNode:X,isDropMissingColumnsNode:Z,isDropMissingRowsNode:ee,isDropMissingNode:Z||ee,isPreviewNode:r,isDatasetProfileNode:i}},[t,e])},OB=({node:e,nodeId:t,configState:n,setConfigState:s})=>{const{isRemoveDuplicatesNode:r}=_j(e),i=`${t||"node"}-remove-duplicates-keep`,l=b.useMemo(()=>{if(!r)return z0;const d=typeof(n==null?void 0:n.keep)=="string"?n.keep.trim().toLowerCase():"";return d==="last"||d==="none"?d:z0},[n==null?void 0:n.keep,r]),u=b.useCallback(d=>{s(h=>({...h,keep:d}))},[s]);return{removeDuplicatesKeepSelectId:i,removeDuplicatesKeep:l,handleRemoveDuplicatesKeepChange:u}},TB=({catalogFlags:e,sourceId:t,nodeId:n,graphContext:s,hasReachableSource:r,columnTypeMap:i,setAvailableColumns:l,setColumnSearch:u,setColumnMissingMap:d,setColumnTypeMap:h,setColumnSuggestions:p,dropColumnParameter:m,node:f,configState:y,setConfigState:x,nodeChangeVersion:_,binnedSamplePreset:v,skewnessTransformations:w,availableColumns:M,columnMissingMap:N,previewSampleRows:C})=>{var U;const E=d3({hasDropColumnSource:!!m,sourceId:t,nodeId:n,graphContext:s,hasReachableSource:r,columnTypeMap:i,setAvailableColumns:l,setColumnSearch:u,setColumnMissingMap:d,setColumnTypeMap:h,setColumnSuggestions:p});m3({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(f==null?void 0:f.id)??null,setAvailableColumns:l,setColumnMissingMap:d});const k=z3({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,node:f,configState:y,setConfigState:x,nodeChangeVersion:_}),$=I3({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:n||null}),T=F3({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(f==null?void 0:f.id)??null}),P=B3({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(f==null?void 0:f.id)??null}),A=U3({catalogFlags:e,sourceId:t,hasReachableSource:r,graphContext:s,targetNodeId:(f==null?void 0:f.id)??null,samplePreset:v}),D=H3({catalogFlags:e,sourceId:t,graphContext:s,targetNodeId:(f==null?void 0:f.id)??null,transformations:w}),F=K3({catalogFlags:e,configState:y,node:f,availableColumns:M,columnMissingMap:N}),R=aB({catalogFlags:e,configState:y,nodeConfig:((U=f==null?void 0:f.data)==null?void 0:U.config)??null,availableColumns:M,columnTypeMap:i,previewSampleRows:C}),z=cB({catalogFlags:e,availableColumns:M,columnTypeMap:i,previewSampleRows:C}),q=EB({catalogFlags:e,configState:y,setConfigState:x,nodeId:n,numericExcludedColumns:z.numericExcludedColumns,scalingData:T.scalingData,outlierData:$.outlierData,binningData:P.binningData,availableColumns:M,previewSampleRows:C}),V=OB({node:f,nodeId:n,configState:y,setConfigState:x});return{dropMissingColumns:E,encodingRecommendations:k,outlierRecommendations:$,scalingInsights:T,binningInsights:P,binnedDistribution:A,skewnessInsights:D,missingIndicatorState:F,dataCleaningState:R,numericColumnAnalysis:z,numericAnalysisState:q,removeDuplicatesState:V}},Pc={status:"idle",data:null,error:null},$B=1e3,PB=({shouldFetchPreview:e,sourceId:t,canTriggerPreview:n,graphSnapshot:s,catalogFlags:r,targetNodeId:i,previewSignature:l,skipPreview:u=!1,requestPreviewRows:d,includeSignals:h})=>{const{isPreviewNode:p}=r,[m,f]=b.useState(Pc),[y,x]=b.useState(0),_=b.useRef(null),v=b.useRef(-1),w=b.useCallback(()=>{x(M=>M+1)},[]);return b.useEffect(()=>{if(!e){f(Pc),_.current=null,v.current=-1;return}if(u)return;if(!t){f(p?{status:"error",data:null,error:"Select a dataset to generate previews."}:Pc);return}if(!n){f(p?{status:"error",data:null,error:"Add nodes to the canvas before generating a snapshot."}:Pc);return}if(!s)return;const M=(()=>{const P=Array.isArray(s.nodes)?s.nodes.map(D=>D&&typeof D.id=="string"?D.id:null).filter(D=>!!D).sort():[],A=Array.isArray(s.edges)?s.edges.map(D=>{const F=D&&typeof D.source=="string"?D.source.trim():"",R=D&&typeof D.target=="string"?D.target.trim():"";return F&&R?`${F}->${R}`:null}).filter(D=>!!D).sort():[];return JSON.stringify({sourceId:t??null,targetNodeId:i??null,nodeIds:P,edgePairs:A})})(),N=l??M,C=N!==_.current;if(!(v.current!==y)&&!C)return;_.current=N,v.current=y;let E=!0;f(P=>({status:"loading",data:P.data??null,error:null}));const k=d??p,$=h??k,T={dataset_source_id:t,graph:{nodes:s.nodes,edges:s.edges},target_node_id:i??void 0,include_preview_rows:k,include_signals:$};return k&&(T.sample_size=$B),nw(T).then(P=>{E&&f({status:"success",data:P,error:null})}).catch(P=>{E&&f(p?{status:"error",data:null,error:(P==null?void 0:P.message)??"Unable to generate preview."}:Pc)}),()=>{E=!1}},[n,s,p,u,l,y,e,t,i]),{previewState:m,refreshPreview:w}},LB=({graphSnapshot:e,graphNodeCount:t,hasReachableSource:n,sourceId:s,node:r,nodeId:i,previewSignature:l,skipPreview:u,catalogFlags:d,cachedPreviewSchema:h,setCachedPreviewSchema:p})=>{var $;const{isPreviewNode:m,isFeatureMathNode:f,isPolynomialFeaturesNode:y,isFeatureSelectionNode:x,isTrainTestSplitNode:_,isOutlierNode:v,isTransformerAuditNode:w}=d,M=b.useMemo(()=>!(!e||!t||!n),[t,e,n]),N=b.useMemo(()=>!e||!s||!n?!1:t>0,[t,e,n,s]),C=b.useMemo(()=>m||f||y||x||_||v||w,[f,x,v,y,m,_,w]),{previewState:j,refreshPreview:E}=PB({shouldFetchPreview:M,sourceId:s,canTriggerPreview:N,graphSnapshot:e,catalogFlags:d,targetNodeId:(r==null?void 0:r.id)??null,previewSignature:l,skipPreview:u,requestPreviewRows:m,includeSignals:C});b.useEffect(()=>{var P;const T=((P=j.data)==null?void 0:P.schema)??null;T&&p(A=>A!=null&&A.signature&&T.signature&&A.signature===T.signature?A:T)},[($=j.data)==null?void 0:$.schema]),b.useEffect(()=>{p(null)},[s]),b.useEffect(()=>{p(null)},[l]);const k=b.useCallback(()=>{p(null)},[]);return{previewState:j,refreshPreview:E,cachedPreviewSchema:h,clearCachedPreviewSchema:k,canTriggerPreview:N}},RB=({previewState:e,nodeId:t,catalogFlags:n})=>{var y,x,_,v,w,M,N,C,j,E;const{isFeatureMathNode:s,isPolynomialFeaturesNode:r,isFeatureSelectionNode:i,isOutlierNode:l,isTransformerAuditNode:u}=n,d=b.useMemo(()=>{var $,T;if(!s)return[];const k=(T=($=e.data)==null?void 0:$.signals)==null?void 0:T.feature_math;return Array.isArray(k)?k:[]},[s,(x=(y=e.data)==null?void 0:y.signals)==null?void 0:x.feature_math]),h=b.useMemo(()=>{var T,P;if(!r)return null;const k=(P=(T=e.data)==null?void 0:T.signals)==null?void 0:P.polynomial_features;return!Array.isArray(k)||k.length===0?null:(t?k.find(A=>A&&typeof A.node_id=="string"&&A.node_id===t):null)??k[0]??null},[r,t,(v=(_=e.data)==null?void 0:_.signals)==null?void 0:v.polynomial_features]),p=b.useMemo(()=>{var T,P;if(!i)return null;const k=(P=(T=e.data)==null?void 0:T.signals)==null?void 0:P.feature_selection;return!Array.isArray(k)||k.length===0?null:(t?k.find(A=>A&&typeof A.node_id=="string"&&A.node_id===t):null)??k[0]??null},[i,t,(M=(w=e.data)==null?void 0:w.signals)==null?void 0:M.feature_selection]),m=b.useMemo(()=>{var T,P;if(!l)return null;const k=(P=(T=e.data)==null?void 0:T.signals)==null?void 0:P.outlier_removal;return!Array.isArray(k)||!k.length?null:t?k.find(A=>A&&A.node_id===t)??k[k.length-1]??null:k[k.length-1]??null},[l,t,(C=(N=e.data)==null?void 0:N.signals)==null?void 0:C.outlier_removal]),f=b.useMemo(()=>{var T,P;if(!u)return null;const k=(P=(T=e.data)==null?void 0:T.signals)==null?void 0:P.transformer_audit;return!Array.isArray(k)||!k.length?null:t?k.find(A=>A&&A.node_id===t)??k[k.length-1]??null:k[k.length-1]??null},[u,t,(E=(j=e.data)==null?void 0:j.signals)==null?void 0:E.transformer_audit]);return{featureMathSignals:d,polynomialSignal:h,featureSelectionSignal:p,outlierPreviewSignal:m,transformerAuditSignal:f}},DB=({catalogFlags:e,featureSelectionSignal:t,upstreamTargetColumn:n,setConfigState:s})=>{const{isFeatureSelectionNode:r}=e;b.useEffect(()=>{if(!r)return;const i=typeof(t==null?void 0:t.target_column)=="string"?t.target_column.trim():"",l=typeof n=="string"?n.trim():"",u=i||l;u&&s(d=>(typeof(d==null?void 0:d.target_column)=="string"?d.target_column.trim():"")?d:{...d,target_column:u})},[t==null?void 0:t.target_column,r,s,n]),b.useEffect(()=>{if(!r)return;const i=typeof(t==null?void 0:t.k)=="number"&&Number.isFinite(t.k)?Math.max(0,Math.trunc(t.k)):null,l=Array.isArray(t==null?void 0:t.selected_columns)?t.selected_columns.length:null,u=i??l??null;u===null||u<=0||s(d=>{const h=d==null?void 0:d.k;let p=null;if(typeof h=="number"&&Number.isFinite(h))p=Math.trunc(h);else if(typeof h=="string"){const m=Number(h);Number.isFinite(m)&&(p=Math.trunc(m))}return p!==null&&p<=u?d:{...d,k:u}})},[t==null?void 0:t.k,t==null?void 0:t.selected_columns,r,s])},zB=(e,t,n)=>{const{isFeatureMathNode:s}=e,[r,i]=b.useState(()=>new Set),l=b.useMemo(()=>s?vN((t==null?void 0:t.operations)??[]):[],[t==null?void 0:t.operations,s]),u=b.useMemo(()=>s?Iz(l,n):[],[l,n,s]);return b.useEffect(()=>{if(!s){i(()=>new Set);return}i(d=>{if(!d.size)return d;const h=new Set(l.map(m=>m.id)),p=new Set;return d.forEach(m=>{h.has(m)&&p.add(m)}),p.size===d.size?d:p})},[l,s]),{featureMathOperations:l,featureMathSummaries:u,collapsedFeatureMath:r,setCollapsedFeatureMath:i}},IB=e=>{var r,i,l;const t=b.useMemo(()=>{var d;const u=(d=e.data)==null?void 0:d.columns;return Array.isArray(u)?u.filter(h=>typeof h=="string"):[]},[(r=e.data)==null?void 0:r.columns]),n=b.useMemo(()=>{var d;const u=(d=e.data)==null?void 0:d.column_stats;return Array.isArray(u)?u:[]},[(i=e.data)==null?void 0:i.column_stats]),s=b.useMemo(()=>{var u;return Array.isArray((u=e.data)==null?void 0:u.sample_rows)?e.data.sample_rows:[]},[(l=e.data)==null?void 0:l.sample_rows]);return{previewColumns:t,previewColumnStats:n,previewSampleRows:s}},FB=({graphSnapshot:e,graphNodeCount:t,hasReachableSource:n,sourceId:s,node:r,nodeId:i,previewSignature:l,skipPreview:u,cachedPreviewSchema:d,setCachedPreviewSchema:h,catalogFlags:p,upstreamTargetColumn:m,setConfigState:f,configState:y})=>{const x=LB({graphSnapshot:e,graphNodeCount:t,hasReachableSource:n,sourceId:s,node:r,nodeId:i,previewSignature:l,skipPreview:u,cachedPreviewSchema:d,setCachedPreviewSchema:h,catalogFlags:p}),{previewState:_}=x,v=RB({previewState:_,nodeId:i,catalogFlags:p}),{featureSelectionSignal:w,featureMathSignals:M}=v;DB({catalogFlags:p,featureSelectionSignal:w,upstreamTargetColumn:m??"",setConfigState:f});const N=zB(p,y,M),C=IB(_);return{nodePreview:x,previewSignals:v,featureMathState:N,previewData:C}},BB=({sourceId:e,availableFilters:t,activeFilterId:n,setActiveFilterId:s,recommendations:r,filteredRecommendations:i,isFetchingRecommendations:l,recommendationsError:u,relativeGeneratedAt:d,formatSignalName:h,formatMissingPercentage:p,getPriorityClass:m,getPriorityLabel:f,handleToggleColumn:y,selectedColumns:x})=>{const _=v=>{if(!(v!=null&&v.name))return null;const w=String(v.name),M=x.includes(w),N=m(v.priority),C=f(v.priority),j=Array.isArray(v==null?void 0:v.signals)?v.signals.map(E=>h(E)).filter(E=>!!E):[];return o.jsxs("label",{className:"canvas-modal__checkbox-item",children:[o.jsx("input",{type:"checkbox",checked:M,onChange:()=>y(w)}),o.jsxs("div",{className:"canvas-modal__checkbox-content",children:[o.jsx("div",{className:"canvas-modal__recommendation-name",children:w}),o.jsxs("div",{className:"canvas-modal__recommendation-meta",children:[v.missing_percentage!==void 0&&v.missing_percentage!==null&&o.jsx("span",{children:`Missing: ${p(v.missing_percentage)}`}),N&&C&&o.jsx("span",{className:`canvas-modal__priority-badge canvas-modal__priority-badge--${N}`,children:C})]}),j.length>0&&o.jsx("div",{className:"canvas-modal__signal-badges",children:j.map(E=>o.jsx("span",{className:"canvas-modal__signal-badge",children:E},`${w}-${E}`))}),v.reason&&o.jsx("p",{className:"canvas-modal__recommendation-reason",children:v.reason})]})]},w)};return e?o.jsxs(o.Fragment,{children:[t.length>0&&o.jsxs("div",{className:"canvas-modal__filter-row",role:"group","aria-label":"Recommendation filters",children:[o.jsxs("button",{type:"button",className:`canvas-modal__filter-button${n?"":" canvas-modal__filter-button--active"}`,onClick:()=>s(null),children:["All reasons (",r.length,")"]}),t.map(v=>{const w=n===v.id;return o.jsxs("button",{type:"button",className:`canvas-modal__filter-button${w?" canvas-modal__filter-button--active":""}`,onClick:()=>s(M=>M===v.id?null:v.id),title:v.description??void 0,children:[v.label," (",v.count,")"]},v.id)})]}),l&&o.jsx("p",{className:"canvas-modal__note",children:"Loading column recommendations"}),!l&&u&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:u}),!l&&!u&&o.jsxs(o.Fragment,{children:[d&&o.jsxs("p",{className:"canvas-modal__note",children:["Recommendations generated ",d,"."]}),i.length?o.jsx("div",{className:"canvas-modal__checkbox-list",role:"group","aria-label":"Recommended columns",children:i.map(v=>_(v))}):o.jsx("p",{className:"canvas-modal__note",children:n?"No columns matched this filter in the latest quality scan.":"No columns crossed the missingness threshold in the latest quality scan."})]})]}):o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Choose a dataset to load EDA-backed column suggestions."})},UB=({parameter:e,previewStateStatus:t,isBinningNode:n,isScalingNode:s,binningAllNumericColumns:r,binningRecommendedColumnSet:i,selectedColumns:l,availableColumns:u,scalingExcludedColumns:d,normalizedColumnSearch:h,filteredColumnOptions:p,binningExcludedColumns:m,selectionCount:f,isCastNode:y,columnSuggestions:x,sourceId:_,isFetchingRecommendations:v,hasReachableSource:w,refreshRecommendations:M,availableFilters:N,activeFilterId:C,setActiveFilterId:j,recommendations:E,filteredRecommendations:k,recommendationsError:$,relativeGeneratedAt:T,formatSignalName:P,handleToggleColumn:A,handleRemoveColumn:D,handleApplyAllRecommended:F,handleBinningApplyColumns:R,handleSelectAllColumns:z,handleClearColumns:q,columnSearch:V,setColumnSearch:U,columnMissingMap:W,columnTypeMap:B,binningColumnPreviewMap:I,isImputerNode:H,showRecommendations:J})=>{var Ie;const G=((Ie=e==null?void 0:e.source)==null?void 0:Ie.type)==="drop_column_recommendations",Y=!G,X=Y&&t==="loading",Z=n&&e.name==="columns",ee=s&&e.name==="columns",Q=(()=>{if(!Z)return[];const ue=[...r];return i.size>0&&i.forEach($e=>{ue.includes($e)||ue.push($e)}),l.forEach($e=>{$e&&!ue.includes($e)&&ue.push($e)}),ue})(),ne=Z?Q:ee?u.filter(ue=>!d.has(ue)):u,he=Z?h?Q.filter(ue=>ue.toLowerCase().includes(h)):Q:ee?p.filter(ue=>!d.has(ue)):p,ye=Z?l.filter(ue=>!m.has(ue)).length:ee?l.filter(ue=>!d.has(ue)).length:f,ge=Y&&ne.length>0&&ye>=ne.length,Ee=G||H,De=new Set(ne),ke=y&&Y?Object.entries(x).filter(([ue,$e])=>De.has(ue)&&$e.length>0).map(([ue,$e])=>`${ue}: ${$e.join(", ")}`).slice(0,4):[],le=Z?Array.from(m).slice(0,4):[],pe=ee?Array.from(d).slice(0,4):[],be=Z&&i.size>0,Te=be?Array.from(i).some(ue=>!l.includes(ue)):!1;return o.jsxs("div",{className:"canvas-modal__parameter-field canvas-modal__parameter-field--multiselect",children:[o.jsxs("div",{className:"canvas-modal__parameter-label",children:[o.jsx("span",{children:e.label}),G&&_&&o.jsx("div",{className:"canvas-modal__parameter-actions",children:o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:M,disabled:v||!w,children:v?"Refreshing":"Refresh suggestions"})})]}),e.description&&o.jsx("p",{className:"canvas-modal__parameter-description",children:e.description}),ke.length>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Smart suggestions: ",ke.join("; ")]}),Z&&m.size>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipping ",m.size," non-numeric column",m.size===1?"":"s",le.length?` (examples: ${le.join(", ")}${m.size>le.length?", ":""})`:""," binning only supports numeric inputs."]}),ee&&d.size>0&&o.jsxs("p",{className:"canvas-modal__note",children:["Skipping ",d.size," non-numeric column",d.size===1?"":"s",pe.length?` (examples: ${pe.join(", ")}${d.size>pe.length?", ":""})`:""," scaling only supports numeric inputs."]}),G&&o.jsx(BB,{sourceId:_,availableFilters:N,activeFilterId:C,setActiveFilterId:j,recommendations:E,filteredRecommendations:k,isFetchingRecommendations:v,recommendationsError:$,relativeGeneratedAt:T,formatSignalName:P,formatMissingPercentage:as,getPriorityClass:hL,getPriorityLabel:pL,handleToggleColumn:A,selectedColumns:l}),o.jsxs("div",{className:"canvas-modal__note",children:["Selected columns: ",o.jsx("strong",{children:ye})]}),ye>0&&o.jsxs("div",{className:"canvas-modal__selection-summary",children:[o.jsx("h4",{children:"Selected columns"}),o.jsx("div",{className:"canvas-modal__selection-chips",children:l.map(ue=>o.jsxs("span",{className:"canvas-modal__selection-chip",children:[ue,o.jsx("button",{type:"button",onClick:()=>D(ue),"aria-label":`Remove ${ue}`,children:""})]},ue))})]}),o.jsxs("div",{className:"canvas-modal__multi-select-actions",children:[G&&o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:F,disabled:!E.length,children:"Use all recommendations"}),be&&o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>R(i),disabled:!Te,children:"Add recommended columns"}),Y&&o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:z,disabled:!ne.length||ge,children:"Select all columns"}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:q,disabled:!f,children:"Clear selection"})]}),o.jsxs("div",{className:"canvas-modal__all-columns",children:[o.jsx("h4",{children:"All columns"}),o.jsx("div",{className:"canvas-modal__all-columns-search",children:o.jsx("input",{type:"text",className:"canvas-modal__custom-input",value:V,onChange:ue=>U(ue.target.value),placeholder:"Search columns","aria-label":"Search columns"})}),o.jsx("div",{className:"canvas-modal__all-columns-list",role:"group","aria-label":"All columns",children:he.length?he.map(ue=>{const $e=l.includes(ue),Ye=Object.prototype.hasOwnProperty.call(W,ue)?W[ue]:void 0,et=as(typeof Ye=="number"?Ye:null),We=B[ue]??null,mt=x[ue]??[],rt=Z?I[ue]:void 0,ft=!!(rt&&(rt.min!==null&&rt.min!==void 0||rt.max!==null&&rt.max!==void 0)),bt=Z?(rt==null?void 0:rt.distinct)??null:null,zt=Z&&bt!==null&&Number.isFinite(bt),Xe=zt?bt:null,Ft=!Z,Kt=Ft||Ee||ft||zt,Et=Ft&&mt.length>0;return o.jsxs("label",{className:`canvas-modal__checkbox-item canvas-modal__checkbox-item--compact${$e?" canvas-modal__checkbox-item--selected":""}`,children:[o.jsx("input",{type:"checkbox",checked:$e,onChange:()=>A(ue)}),o.jsxs("div",{className:"canvas-modal__column-option",children:[o.jsx("span",{className:"canvas-modal__column-option-name",children:ue}),Kt&&o.jsxs("div",{className:"canvas-modal__column-option-meta",children:[Ft&&o.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Type: ",TI(We)]}),Ee&&o.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Missing: ",et]}),ft&&o.jsxs("span",{className:"canvas-modal__column-option-metric",children:[Z?"Sample range":"Range",":"," ",rt&&rt.min!==null&&rt.min!==void 0?Ps(rt.min):""," ",""," ",rt&&rt.max!==null&&rt.max!==void 0?Ps(rt.max):""]}),zt&&Xe!==null&&o.jsxs("span",{className:"canvas-modal__column-option-metric",children:["Distinct sample values: ",Ws(Xe)]})]}),Et&&o.jsxs("span",{className:"canvas-modal__column-option-hint",children:["Suggested: ",mt.join(", ")]})]})]},ue)}):o.jsx("p",{className:"canvas-modal__note",children:u.length?Z&&ne.length===0?"No eligible columns for binning (non-numeric fields are skipped).":"No columns match your search.":X?"Loading column catalog":_?w?"Column catalog unavailable for this dataset.":"Connect this step to an upstream output to load column catalog.":"Select a dataset to load column catalog."})})]})]},e.name)},HB=({parameter:e,nodeId:t,configState:n,handleNumberChange:s,handleBooleanChange:r,handleTextChange:i,thresholdParameterName:l,normalizedSuggestedThreshold:u,showRecommendations:d,canApplySuggestedThreshold:h,thresholdMatchesSuggestion:p,handleApplySuggestedThreshold:m,renderMultiSelect:f})=>{var _;if(!(e!=null&&e.name))return null;if(e.type==="multi_select")return o.jsx(o.Fragment,{children:f(e)});if(e.type==="number"){const v=`node-${t}-${e.name}`,w=n==null?void 0:n[e.name],M=typeof w=="number"?w:w??"";return o.jsxs("div",{className:"canvas-modal__parameter-field",children:[o.jsxs("label",{htmlFor:v,className:"canvas-modal__parameter-label",children:[o.jsx("span",{children:e.label}),e.unit&&o.jsx("span",{className:"canvas-modal__parameter-unit",children:e.unit})]}),e.description&&o.jsx("p",{className:"canvas-modal__parameter-description",children:e.description}),o.jsxs("div",{className:"canvas-modal__parameter-control",children:[o.jsx(Yi,{id:v,value:M,min:e.min!==void 0?e.min:void 0,max:e.max!==void 0?e.max:void 0,step:e.step!==void 0?e.step:"any",onChange:N=>s(e.name,N.target.value)}),e.unit&&o.jsx("span",{className:"canvas-modal__parameter-unit",children:e.unit})]}),l===e.name&&u!==null&&d&&o.jsxs("div",{className:"canvas-modal__note",children:["Suggested threshold from EDA:"," ",o.jsx("strong",{children:as(u)}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:m,disabled:!h,children:p?"Applied":"Apply suggestion"})]})]},e.name)}if(e.type==="boolean"){const v=`node-${t}-${e.name}`,w=!!(n!=null&&n[e.name]);return o.jsx(Ki,{id:v,label:w?"Enabled":"Disabled",fieldLabel:e.label,description:e.description,checked:w,onChange:M=>r(e.name,M.target.checked)},e.name)}if(e.type==="select"){const v=`node-${t}-${e.name}`,w=Array.isArray(e.options)?e.options:[],M=n==null?void 0:n[e.name],N=typeof e.default=="string"?e.default:((_=w.find(j=>j&&typeof j.value=="string"))==null?void 0:_.value)??"",C=typeof M=="string"&&M.trim().length?M:N;return o.jsx(vr,{label:e.label,htmlFor:v,description:e.description,children:o.jsx(Sd,{id:v,value:C,onChange:j=>i(e.name,j.target.value),options:[],children:w.map(j=>o.jsx("option",{value:j.value,title:j.description??void 0,children:j.label??j.value},j.value))})},e.name)}if(e.type==="textarea"){const v=`node-${t}-${e.name}`;if(e.name==="hyperparameters"){let M="",N=n==null?void 0:n[e.name];if(typeof N=="string"&&N.trim())try{const C=JSON.parse(N);C&&typeof C=="object"&&!Array.isArray(C)?M=Object.entries(C).map(([j,E])=>`${j}: ${JSON.stringify(E)}`).join(`
`):M=N}catch{M=N}else N&&typeof N=="object"&&!Array.isArray(N)&&(M=Object.entries(N).map(([C,j])=>`${C}: ${JSON.stringify(j)}`).join(`
`));return o.jsx(vr,{label:e.label,htmlFor:v,description:e.description||"Enter parameters as key: value pairs (one per line)",children:o.jsx(fw,{id:v,className:"canvas-modal__input--wide",value:M,placeholder:`n_estimators: 100
max_depth: 10
learning_rate: 0.01`,onChange:C=>{const E=C.target.value.split(`
`).filter($=>$.trim()),k={};for(const $ of E){const T=$.indexOf(":");if(T===-1)continue;const P=$.substring(0,T).trim(),A=$.substring(T+1).trim();if(P)try{k[P]=JSON.parse(A)}catch{k[P]=A}}i(e.name,JSON.stringify(k,null,2))},rows:6})},e.name)}const w=typeof(n==null?void 0:n[e.name])=="string"?n==null?void 0:n[e.name]:"";return o.jsx(vr,{label:e.label,htmlFor:v,description:e.description,children:o.jsx(fw,{id:v,className:"canvas-modal__input--wide",value:w,placeholder:e.placeholder??"",onChange:M=>i(e.name,M.target.value),rows:4})},e.name)}const y=`node-${t}-${e.name}`,x=(n==null?void 0:n[e.name])??"";return o.jsx(vr,{label:e.label,htmlFor:y,description:e.description,children:o.jsx(op,{id:y,className:"canvas-modal__input--wide",value:x,placeholder:e.placeholder??"",onChange:v=>i(e.name,v.target.value)})},e.name)},qB=({nodeId:e,catalogFlags:t,configState:n,previewState:s,binning:r,scaling:i,selectedColumns:l,availableColumns:u,filteredColumnOptions:d,normalizedColumnSearch:h,columnSearch:p,setColumnSearch:m,columnSuggestions:f,columnMissingMap:y,columnTypeMap:x,sourceId:_,hasReachableSource:v,recommendationsState:w,columnSelectionHandlers:M,parameterHandlers:N,thresholdRecommendations:C,numericExcludedColumns:j,selectionCount:E})=>{const{isBinningNode:k,isScalingNode:$,isCastNode:T,isImputerNode:P}=t,A=b.useCallback(F=>o.jsx(UB,{parameter:F,previewStateStatus:s.status,isBinningNode:k,isScalingNode:$,binningAllNumericColumns:r.state.allNumericColumns,binningRecommendedColumnSet:r.state.recommendedColumnSet,selectedColumns:l,availableColumns:u,scalingExcludedColumns:i.state.excludedColumns,normalizedColumnSearch:h,filteredColumnOptions:d,binningExcludedColumns:r.state.excludedColumns,selectionCount:E,isCastNode:T,columnSuggestions:f,sourceId:_,isFetchingRecommendations:w.isFetching,hasReachableSource:v,refreshRecommendations:w.refresh,availableFilters:w.availableFilters,activeFilterId:w.activeFilterId,setActiveFilterId:w.setActiveFilterId,recommendations:w.recommendations,filteredRecommendations:w.filteredRecommendations,recommendationsError:w.error,relativeGeneratedAt:w.relativeGeneratedAt,formatSignalName:w.formatSignalName,handleToggleColumn:M.handleToggleColumn,handleRemoveColumn:M.handleRemoveColumn,handleApplyAllRecommended:M.handleApplyAllRecommended,handleBinningApplyColumns:r.handlers.handleApplyColumns,handleSelectAllColumns:M.handleSelectAllColumns,handleClearColumns:M.handleClearColumns,columnSearch:p,setColumnSearch:m,columnMissingMap:y,columnTypeMap:x,binningColumnPreviewMap:r.state.columnPreviewMap,isImputerNode:P,showRecommendations:w.show}),[w.activeFilterId,u,w.availableFilters,y,p,f,x,r.state.allNumericColumns,j,d,w.filteredRecommendations,w.formatSignalName,M.handleApplyAllRecommended,r.handlers.handleApplyColumns,M.handleClearColumns,M.handleRemoveColumn,M.handleSelectAllColumns,M.handleToggleColumn,v,T,w.isFetching,k,r.state.recommendedColumnSet,r.state.columnPreviewMap,P,$,r.state.excludedColumns,s.status,w.recommendations,w.error,w.relativeGeneratedAt,l,E,w.setActiveFilterId,m,i.state.excludedColumns,w.show,_,w.refresh,h]),D=b.useCallback(F=>o.jsx(HB,{parameter:F,nodeId:e,configState:n,handleNumberChange:N.handleNumberChange,handleBooleanChange:N.handleBooleanChange,handleTextChange:N.handleTextChange,thresholdParameterName:C.thresholdParameterName,normalizedSuggestedThreshold:C.normalizedSuggestedThreshold,showRecommendations:w.show,canApplySuggestedThreshold:C.canApplySuggestedThreshold,thresholdMatchesSuggestion:C.thresholdMatchesSuggestion,handleApplySuggestedThreshold:C.handleApplySuggestedThreshold,renderMultiSelect:A}),[C.canApplySuggestedThreshold,n,C.handleApplySuggestedThreshold,N.handleBooleanChange,N.handleNumberChange,N.handleTextChange,e,C.normalizedSuggestedThreshold,A,w.show,C.thresholdMatchesSuggestion,C.thresholdParameterName]);return{renderMultiSelectField:A,renderParameterField:D}},VB=(e,t)=>{const n=b.useMemo(()=>{var p,m,f,y,x,_;const r=[],i=((p=e==null?void 0:e.data)==null?void 0:p.label)||(t==null?void 0:t.label);i&&r.push({label:"Label",value:String(i)});const l=((m=e==null?void 0:e.data)==null?void 0:m.description)||(t==null?void 0:t.description);l&&r.push({label:"Description",value:String(l)});const u=((f=e==null?void 0:e.data)==null?void 0:f.category)||(t==null?void 0:t.category);u&&r.push({label:"Category",value:String(u)}),(y=e==null?void 0:e.data)!=null&&y.catalogType&&r.push({label:"Node type",value:String(e.data.catalogType)});const d=((x=e==null?void 0:e.data)==null?void 0:x.inputs)||(t==null?void 0:t.inputs);d&&Array.isArray(d)&&d.length&&r.push({label:"Inputs",value:d.join(", ")});const h=((_=e==null?void 0:e.data)==null?void 0:_.outputs)||(t==null?void 0:t.outputs);return h&&Array.isArray(h)&&h.length&&r.push({label:"Outputs",value:h.join(", ")}),r},[e,t]),s=b.useMemo(()=>{var i;const r=((i=e==null?void 0:e.data)==null?void 0:i.label)??(t==null?void 0:t.label)??(e==null?void 0:e.id);return typeof r=="string"&&r.trim()?r:`Node ${(e==null?void 0:e.id)??""}`},[e,t]);return{metadata:n,title:s}},yj=(e,t)=>{if(!t||typeof t!="string")return null;const n=`${e}-`;if(t.startsWith(n))return t.slice(n.length);const s=t.split("-");return s.length>=2?s.slice(-2).join("-"):t},WB=(e,t)=>{var y;const n=typeof(e==null?void 0:e.id)=="string"?e.id:"",s=b.useMemo(()=>{var v;const x=(v=e==null?void 0:e.data)==null?void 0:v.connectionInfo;if(!x)return null;const _=w=>Array.isArray(w)?w.map(M=>({...M})):[];return{inputs:_(x.inputs),outputs:_(x.outputs)}},[e]),r=b.useMemo(()=>{if(!n||!t||!Array.isArray(t.edges))return new Set;const x=t.edges.filter(_=>(_==null?void 0:_.target)===n).map(_=>yj(n,_==null?void 0:_.targetHandle)).filter(_=>!!_);return new Set(x)},[t,n]),i=b.useMemo(()=>{if(!n||!t||!Array.isArray(t.edges))return new Set;const x=t.edges.filter(_=>(_==null?void 0:_.source)===n).map(_=>yj(n,_==null?void 0:_.sourceHandle)).filter(_=>!!_);return new Set(x)},[t,n]),l=((y=e==null?void 0:e.data)==null?void 0:y.hasRequiredConnections)!==!1,u=b.useMemo(()=>{var x;return(x=s==null?void 0:s.inputs)!=null&&x.length?s.inputs.filter(_=>_.required!==!1):[]},[s==null?void 0:s.inputs]),d=b.useMemo(()=>u.length?u.filter(x=>!r.has(x.key)):[],[r,u]),h=l&&d.length===0,p=b.useMemo(()=>{if(!h)return{opacity:.45,pointerEvents:"none",userSelect:"none"}},[h]),m=h?void 0:!0,f=b.useMemo(()=>{if(!(s!=null&&s.inputs)||s.inputs.length===0)return;let x=!1;const _={};return s.inputs.forEach(v=>{if(!Array.isArray(v.accepts)||v.accepts.length===0)return;const w=r.has(v.key);v.accepts.forEach(M=>{(M==="train"||M==="validation"||M==="test")&&(_[M]=w,x=!0)})}),x?_:void 0},[s==null?void 0:s.inputs,r]);return{connectionInfo:s,connectedHandleKeys:r,connectedOutputHandleKeys:i,evaluationSplitConnectivity:f,connectionReady:h,gatedSectionStyle:p,gatedAriaDisabled:m}},YB=e=>b.useMemo(()=>{const t=new Map;return e.forEach(n=>{n!=null&&n.name&&t.set(n.name,n)}),n=>t.get(n)??null},[e]),KB=(e,t)=>{const n=b.useMemo(()=>{var h;const u=(h=e==null?void 0:e.data)==null?void 0:h.parameters;let d=[];return Array.isArray(u)&&u.length>0?d=u:t!=null&&t.parameters&&(d=t.parameters),d.filter(p=>!!(p!=null&&p.name)).map(p=>({...p}))},[e,t]),s=YB(n),r=b.useCallback((u,d)=>u?s(d):null,[s]),i=b.useMemo(()=>n.some(u=>{var d;return(u==null?void 0:u.type)==="multi_select"&&((d=u==null?void 0:u.source)==null?void 0:d.type)!=="drop_column_recommendations"}),[n]),l=b.useMemo(()=>n.find(u=>{var d;return((d=u==null?void 0:u.source)==null?void 0:d.type)==="drop_column_recommendations"})??null,[n]);return{parameters:n,getParameter:s,getParameterIf:r,requiresColumnCatalog:i,dropColumnParameter:l}},GB=({isResetAvailable:e=!1,defaultConfigTemplate:t,catalogFlags:n})=>{const{isDataset:s,isScalingNode:r,isBinningNode:i,isBinnedDistributionNode:l,isSkewnessDistributionNode:u,isFeatureMathNode:d,isFeatureTargetSplitNode:h,isTrainTestSplitNode:p,isModelEvaluationNode:m,isHashEncodingNode:f,isPolynomialFeaturesNode:y,isFeatureSelectionNode:x,isDataConsistencyNode:_,isTrainModelDraftNode:v,isHyperparameterTuningNode:w,isClassUndersamplingNode:M,isClassOversamplingNode:N,isLabelEncodingNode:C,isTargetEncodingNode:j,isDummyEncodingNode:E,isOneHotEncodingNode:k,isOrdinalEncodingNode:$,isImputerNode:T,isMissingIndicatorNode:P,isReplaceAliasesNode:A,isTrimWhitespaceNode:D,isRemoveSpecialCharsNode:F,isReplaceInvalidValuesNode:R,isRegexCleanupNode:z,isNormalizeTextCaseNode:q,isStandardizeDatesNode:V,isCastNode:U,isRemoveDuplicatesNode:W,isDropMissingNode:B,isOutlierNode:I}=n,H=b.useMemo(()=>!!(e&&!s&&t),[t,s,e]),Y=[d,h,p,m,f,y,x,_,v,w,M||N,C,j,E,k,$,T,P,A,D,F,R,z,q,V,U,W,B,I].some(Boolean),X=l||u;return{canResetNode:H,headerCanResetNode:H&&!(X||r||i||Y),footerCanResetNode:H&&!X}},XB=({node:e})=>{var m;const t=typeof(e==null?void 0:e.id)=="string"?e.id:void 0,n=b.useMemo(()=>{var y;const f=wp(((y=e==null?void 0:e.data)==null?void 0:y.config)??{});return!f||typeof f!="object"||Array.isArray(f)?{}:((!f.column_overrides||typeof f.column_overrides!="object"||Array.isArray(f.column_overrides))&&(f.column_overrides={}),f)},[e==null?void 0:e.id,(m=e==null?void 0:e.data)==null?void 0:m.config]),[s,r]=b.useState(n),[i,l]=b.useState(0),u=b.useRef(t);b.useEffect(()=>{u.current!==t&&(u.current=t,r(n),l(f=>f+1))},[t]);const d=b.useMemo(()=>Mc(n),[n]),h=b.useMemo(()=>Mc(s),[s]),p=b.useCallback(()=>{r(n)},[n]);return{initialConfig:n,configState:s,setConfigState:r,stableInitialConfig:d,stableCurrentConfig:h,nodeChangeVersion:i,resetToInitialConfig:p}},QB=({setConfigState:e})=>{const t=b.useCallback((l,u)=>{l&&e(d=>{const h={...d};return u===void 0?delete h[l]:h[l]=u,h})},[e]),n=b.useCallback((l,u)=>{if(!l)return;if(u===""){t(l,void 0);return}const d=Number(u);Number.isNaN(d)||t(l,d)},[t]),s=b.useCallback((l,u)=>{if(!l)return;if(u===""){t(l,void 0);return}const d=Number(u);if(!Number.isFinite(d))return;const h=Math.min(Math.max(d,0),100);t(l,h)},[t]),r=b.useCallback((l,u)=>{t(l,u)},[t]),i=b.useCallback((l,u)=>{t(l,u)},[t]);return{handleParameterChange:t,handleNumberChange:n,handlePercentileChange:s,handleBooleanChange:r,handleTextChange:i}},ZB=(e,t)=>{const n=(s,r)=>s?e(r):null;return b.useMemo(()=>{const{isBinningNode:s,isScalingNode:r,isRemoveDuplicatesNode:i,isReplaceAliasesNode:l,isTrimWhitespaceNode:u,isRemoveSpecialCharsNode:d,isReplaceInvalidValuesNode:h,isRegexCleanupNode:p,isNormalizeTextCaseNode:m,isLabelEncodingNode:f,isHashEncodingNode:y,isPolynomialFeaturesNode:x,isFeatureSelectionNode:_,isFeatureMathNode:v,isClassUndersamplingNode:w,isClassOversamplingNode:M,isFeatureTargetSplitNode:N,isTrainModelDraftNode:C,isHyperparameterTuningNode:j,isTargetEncodingNode:E,isOrdinalEncodingNode:k,isDummyEncodingNode:$,isOneHotEncodingNode:T,isMissingIndicatorNode:P,isDropMissingRowsNode:A,isDropMissingColumnsNode:D}=t,F=w||M,R=C||j;return{binning:{columns:n(s,"columns")},scaling:{columns:n(r,"columns"),defaultMethod:n(r,"default_method"),autoDetect:n(r,"auto_detect")},removeDuplicates:{columns:n(i,"columns"),keep:n(i,"keep")},replaceAliases:{customPairs:n(l,"custom_pairs")},trimWhitespace:{columns:n(u,"columns"),mode:n(u,"mode")},removeSpecial:{columns:n(d,"columns"),mode:n(d,"mode"),replacement:n(d,"replacement")},replaceInvalid:{columns:n(h,"columns"),mode:n(h,"mode"),minValue:n(h,"min_value"),maxValue:n(h,"max_value")},regexCleanup:{columns:n(p,"columns"),mode:n(p,"mode"),pattern:n(p,"pattern"),replacement:n(p,"replacement")},normalizeCase:{columns:n(m,"columns"),mode:n(m,"mode")},labelEncoding:{columns:f?e("columns"):null,autoDetect:f?e("auto_detect"):null,maxUnique:f?e("max_unique_values"):null,outputSuffix:f?e("output_suffix"):null,dropOriginal:f?e("drop_original"):null,missingStrategy:f?e("missing_strategy"):null,missingCode:f?e("missing_code"):null},hashEncoding:{columns:y?e("columns"):null,autoDetect:y?e("auto_detect"):null,maxCategories:y?e("max_categories"):null,buckets:y?e("n_buckets"):null,outputSuffix:y?e("output_suffix"):null,dropOriginal:y?e("drop_original"):null,encodeMissing:y?e("encode_missing"):null},polynomial:{columns:n(x,"columns"),autoDetect:n(x,"auto_detect"),degree:n(x,"degree"),includeBias:n(x,"include_bias"),interactionOnly:n(x,"interaction_only"),includeInputFeatures:n(x,"include_input_features"),outputPrefix:n(x,"output_prefix")},featureSelection:{columns:n(_,"columns"),autoDetect:n(_,"auto_detect"),targetColumn:n(_,"target_column"),method:n(_,"method"),scoreFunc:n(_,"score_func"),problemType:n(_,"problem_type"),k:n(_,"k"),percentile:n(_,"percentile"),alpha:n(_,"alpha"),threshold:n(_,"threshold"),mode:n(_,"mode"),estimator:n(_,"estimator"),step:n(_,"step"),minFeatures:n(_,"min_features"),maxFeatures:n(_,"max_features"),dropUnselected:n(_,"drop_unselected")},featureMath:{errorHandling:n(v,"error_handling"),allowOverwrite:n(v,"allow_overwrite"),defaultTimezone:n(v,"default_timezone"),epsilon:n(v,"epsilon")},resampling:{method:n(F,"method"),targetColumn:n(F,"target_column"),samplingStrategy:n(F,"sampling_strategy"),randomState:n(F,"random_state"),kNeighbors:n(M,"k_neighbors"),replacement:n(w,"replacement")},featureTargetSplit:{targetColumn:n(N,"target_column")},trainModel:{targetColumn:n(R,"target_column"),problemType:n(R,"problem_type"),modelType:n(R,"model_type"),hyperparameters:n(C,"hyperparameters"),cvEnabled:n(R,"cv_enabled"),cvStrategy:n(R,"cv_strategy"),cvFolds:n(R,"cv_folds"),cvShuffle:n(R,"cv_shuffle"),cvRandomState:n(R,"cv_random_state"),cvRefitStrategy:n(C,"cv_refit_strategy")},hyperparameterTuning:{searchStrategy:n(j,"search_strategy"),searchIterations:n(j,"search_iterations"),searchRandomState:n(j,"search_random_state"),scoringMetric:n(j,"scoring_metric")},targetEncoding:{columns:E?e("columns"):null,targetColumn:E?e("target_column"):null,autoDetect:E?e("auto_detect"):null,maxCategories:E?e("max_categories"):null,outputSuffix:E?e("output_suffix"):null,dropOriginal:E?e("drop_original"):null,smoothing:E?e("smoothing"):null,encodeMissing:E?e("encode_missing"):null,handleUnknown:E?e("handle_unknown"):null},ordinalEncoding:{columns:k?e("columns"):null,autoDetect:k?e("auto_detect"):null,maxCategories:k?e("max_categories"):null,outputSuffix:k?e("output_suffix"):null,dropOriginal:k?e("drop_original"):null,encodeMissing:k?e("encode_missing"):null,handleUnknown:k?e("handle_unknown"):null,unknownValue:k?e("unknown_value"):null},dummyEncoding:{columns:$?e("columns"):null,autoDetect:$?e("auto_detect"):null,maxCategories:$?e("max_categories"):null,dropFirst:$?e("drop_first"):null,includeMissing:$?e("include_missing"):null,dropOriginal:$?e("drop_original"):null,prefixSeparator:$?e("prefix_separator"):null},oneHotEncoding:{columns:T?e("columns"):null,autoDetect:T?e("auto_detect"):null,maxCategories:T?e("max_categories"):null,dropFirst:T?e("drop_first"):null,includeMissing:T?e("include_missing"):null,dropOriginal:T?e("drop_original"):null,prefixSeparator:T?e("prefix_separator"):null},missingIndicator:{columns:n(P,"columns"),suffix:n(P,"flag_suffix")},dropRows:{any:n(A,"drop_if_any_missing")},dropMissing:{threshold:n(D||A,"missing_threshold")}}},[t,e])},JB=(e,t)=>{const{isBinningNode:n,isCastNode:s,isDropMissingColumnsNode:r,isDropMissingRowsNode:i,isImputerNode:l,isMissingIndicatorNode:u,isReplaceAliasesNode:d,isTrimWhitespaceNode:h,isRemoveSpecialCharsNode:p,isReplaceInvalidValuesNode:m,isRegexCleanupNode:f,isNormalizeTextCaseNode:y,isStandardizeDatesNode:x,isScalingNode:_,isClassUndersamplingNode:v,isClassOversamplingNode:w,isTrainModelDraftNode:M,isLabelEncodingNode:N,isOrdinalEncodingNode:C,isDummyEncodingNode:j,isOneHotEncodingNode:E,isRemoveDuplicatesNode:k,isSkewnessNode:$,isFeatureTargetSplitNode:T}=t;return b.useMemo(()=>{let P=e;return P=P.filter(A=>{var D;return((D=A==null?void 0:A.source)==null?void 0:D.type)!=="drop_column_recommendations"}),(r||i)&&(P=P.filter(A=>A.name!=="missing_threshold")),i&&(P=P.filter(A=>A.name!=="drop_if_any_missing")),l&&(P=P.filter(A=>A.name!=="strategies")),$&&(P=P.filter(A=>A.name!=="transformations")),s&&(P=P.filter(A=>A.name!=="columns")),n&&(P=P.filter(A=>A.name!=="columns")),_&&(P=P.filter(A=>!["columns","default_method","auto_detect"].includes(A.name))),k&&(P=P.filter(A=>A.name!=="columns"&&A.name!=="keep")),u&&(P=P.filter(A=>A.name!=="columns"&&A.name!=="flag_suffix")),d&&(P=P.filter(A=>!["columns","mode","custom_pairs"].includes(A.name))),h&&(P=P.filter(A=>!["columns","mode"].includes(A.name))),p&&(P=P.filter(A=>!["columns","mode","replacement"].includes(A.name))),m&&(P=P.filter(A=>!["columns","mode","min_value","max_value"].includes(A.name))),f&&(P=P.filter(A=>!["columns","mode","pattern","replacement"].includes(A.name))),y&&(P=P.filter(A=>!["columns","mode"].includes(A.name))),x&&(P=P.filter(A=>!["columns","mode"].includes(A.name))),v&&(P=P.filter(A=>!["method","target_column","sampling_strategy","random_state","replacement"].includes(A.name))),w&&(P=P.filter(A=>!["method","target_column","sampling_strategy","random_state"].includes(A.name))),M&&(P=P.filter(A=>!["target_column","problem_type","cv_enabled","cv_strategy","cv_folds","cv_shuffle","cv_random_state","cv_refit_strategy"].includes(A.name))),T&&(P=P.filter(A=>A.name!=="target_column")),N&&(P=P.filter(A=>!["columns","auto_detect","max_unique_values","output_suffix","drop_original","missing_strategy","missing_code"].includes(A.name))),C&&(P=P.filter(A=>!["columns","auto_detect","max_categories","output_suffix","drop_original","encode_missing","handle_unknown","unknown_value"].includes(A.name))),j&&(P=P.filter(A=>!["columns","auto_detect","max_categories","drop_first","include_missing","drop_original","prefix_separator"].includes(A.name))),E&&(P=P.filter(A=>!["columns","auto_detect","max_categories","drop_first","include_missing","drop_original","prefix_separator"].includes(A.name))),P},[e,n,s,r,i,l,u,d,h,p,m,f,y,x,_,v,w,M,N,C,j,E,k,$,T])},e5=e=>{const t=b.useMemo(()=>LL,[]),n=b.useMemo(()=>t.map(i=>i.value),[t]),s=b.useMemo(()=>vw(e==null?void 0:e.strategies,n),[e==null?void 0:e.strategies,n]),r=s.length;return{imputationMethodOptions:t,imputationMethodValues:n,imputerStrategies:s,imputerStrategyCount:r}},t5=(e,t)=>{const n=b.useMemo(()=>lp(xw(e==null?void 0:e.transformations)),[e==null?void 0:e.transformations]),s=b.useCallback(r=>{t(i=>{const l=lp(xw(i==null?void 0:i.transformations)),u=lp(r(l));return{...i,transformations:u.map(d=>({...d}))}})},[t]);return{skewnessTransformations:n,updateSkewnessTransformations:s}},n5=()=>{const{data:e=[],isLoading:t,error:n}=Ts({queryKey:["feature-canvas","node-catalog"],queryFn:sp,staleTime:3e5}),s=b.useMemo(()=>{const r=new Map;return e.forEach(i=>{i&&typeof i.type=="string"&&i.type.trim()&&r.set(i.type,i)}),r},[e]);return{nodeCatalog:e,catalogEntryMap:s,isLoading:t,error:n}},s5={trim_whitespace:{title:"Use after Dataset snapshot or Missing indicator nodes",body:"Great for cleaning string columns before alias replacement or case normalization. Auto-detects text columns when left blank."},normalize_text_case:{title:"Use after trimming and alias cleanup",body:"Keeps categorical values consistent for joins and grouping. Pair with Dataset profile or Preview to confirm column impacts."},replace_aliases_typos:{title:"Requires Dataset profile insights",body:"Apply after profiling so you can confirm value distributions. Combine with custom pairs to align business-specific labels."},standardize_date_formats:{title:"Run after parsing-friendly nodes",body:"Normalizes mixed date strings into the format you choose. Works best once whitespace and punctuation cleanup nodes have run."},remove_special_characters:{title:"Pair with Trim whitespace or Regex cleanup",body:"Strips punctuation or noise from text fields before alias grouping. Preview to ensure replacements retain the intent of each field."},replace_invalid_values:{title:"Use after Outlier diagnostics or Dataset profile",body:"Flags negative, zero, or out-of-range numeric placeholders and converts them to missing for downstream handling."},regex_replace_fix:{title:"Configure after reviewing Dataset snapshot",body:"Use presets for quick fixes or supply a custom regex. Ideal before date standardization or alias cleanup passes."}},r5=({node:e,graphSnapshot:t,isResetAvailable:n,defaultConfigTemplate:s})=>{const r=WB(e,t),i=_j(e),{catalogType:l,isDataset:u,isClassUndersamplingNode:d,isClassOversamplingNode:h,isDataConsistencyNode:p,isSkewnessNode:m,isSkewnessDistributionNode:f}=i,y=u,x=d||h,{catalogEntryMap:_}=n5(),v=b.useMemo(()=>l?_.get(l):null,[l,_]),{metadata:w,title:M}=VB(e,v),{parameters:N,getParameter:C,requiresColumnCatalog:j,dropColumnParameter:E}=KB(e,v),k=b.useMemo(()=>s5[l]??null,[l]),$=typeof(e==null?void 0:e.id)=="string"?e.id:"",T=GB({isResetAvailable:n,defaultConfigTemplate:s,catalogFlags:i}),P=ZB(C,i),A=JB(N,i),D=b.useMemo(()=>p?A:[],[A,p]),F=m||f,R=XB({node:e}),{setConfigState:z,configState:q}=R,V=QB({setConfigState:z}),U=e5(q),W=t5(q,z);return{metadata:w,title:M,connectionReadiness:r,catalogFlags:i,datasetBadge:y,isClassResamplingNode:x,parameters:N,getParameter:C,requiresColumnCatalog:j,dropColumnParameter:E,dataConsistencyHint:k,nodeId:$,resetPermissions:T,nodeParams:P,filteredParameters:A,dataConsistencyParameters:D,shouldLoadSkewnessInsights:F,configStateResult:R,parameterHandlers:V,imputationStrategiesResult:U,skewnessStateResult:W,catalogEntry:v}},Kd=e=>{const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):null},a5=({recommendationsGeneratedAt:e,scalingData:t,binningData:n,binnedDistributionData:s,outlierData:r})=>{const i=b.useMemo(()=>Yn(e??null),[e]),l=b.useMemo(()=>Yn((t==null?void 0:t.generated_at)??null),[t==null?void 0:t.generated_at]),u=b.useMemo(()=>Yn((n==null?void 0:n.generated_at)??null),[n==null?void 0:n.generated_at]),d=b.useMemo(()=>Yn((s==null?void 0:s.generated_at)??null),[s==null?void 0:s.generated_at]),h=b.useMemo(()=>Yn((r==null?void 0:r.generated_at)??null),[r==null?void 0:r.generated_at]),p=b.useMemo(()=>Kd((t==null?void 0:t.sample_size)??null),[t==null?void 0:t.sample_size]),m=b.useMemo(()=>Kd((n==null?void 0:n.sample_size)??null),[n==null?void 0:n.sample_size]),f=b.useMemo(()=>Kd((s==null?void 0:s.sample_size)??null),[s==null?void 0:s.sample_size]),y=b.useMemo(()=>Kd((r==null?void 0:r.sample_size)??null),[r==null?void 0:r.sample_size]);return{relativeGeneratedAt:i,relativeScalingGeneratedAt:l,relativeBinningGeneratedAt:u,relativeBinnedGeneratedAt:d,relativeOutlierGeneratedAt:h,scalingSampleSize:p,binningSampleSize:m,binnedSampleSize:f,outlierSampleSize:y}},o5=({isProfileLoading:e,isPreviewLoading:t,isFetchingScaling:n,isFetchingBinning:s,isFetchingHashEncoding:r,isFetchingBinnedDistribution:i,isFetchingRecommendations:l,catalogFlags:u})=>{const{isPreviewNode:d}=u,h=b.useMemo(()=>e||t||n||s||r||i||l,[i,s,r,n,l,t,e]),p=b.useMemo(()=>e?"Generating dataset profile":n?"Loading scaling insights":s?"Loading binning insights":r?"Loading hash encoding insights":i?"Computing binned distributions":l?"Fetching column recommendations":t?d?"Loading dataset preview":"Analyzing node outputs":null,[i,s,r,l,n,t,d,e]);return{hasActiveAsyncWork:h,busyLabel:p,footerBusyLabel:p??(h?"Processing":null)}},i5=({recommendationsGeneratedAt:e,scalingData:t,binningData:n,binnedDistributionData:s,outlierData:r,isProfileLoading:i,isPreviewLoading:l,isFetchingScaling:u,isFetchingBinning:d,isFetchingHashEncoding:h,isFetchingBinnedDistribution:p,isFetchingRecommendations:m,catalogFlags:f})=>{const y=a5({recommendationsGeneratedAt:e,scalingData:t,binningData:n,binnedDistributionData:s,outlierData:r}),x=o5({isProfileLoading:i,isPreviewLoading:l,isFetchingScaling:u,isFetchingBinning:d,isFetchingHashEncoding:h,isFetchingBinnedDistribution:p,isFetchingRecommendations:m,catalogFlags:f});return{insightSummaries:y,asyncBusyLabel:x}},l5=({catalogFlags:e,binnedDistributionData:t})=>{const{isBinnedDistributionNode:n}=e;return b.useMemo(()=>{if(!n)return[];const r=(Array.isArray(t==null?void 0:t.columns)?t==null?void 0:t.columns:[]).map(i=>{if(!i||!i.column)return null;const l=Number(i.total_rows),u=Number.isFinite(l)?Math.max(0,Math.round(l)):0;if(u<=0)return null;const h=(Array.isArray(i.bins)?i.bins:[]).map(T=>{if(!T)return null;const A=(typeof T.label=="string"?T.label.trim():String(T.label??""))||(T.is_missing?"Missing":"Unlabeled bin"),D=Number(T.count);if(!Number.isFinite(D))return null;const F=Math.max(0,Math.round(D)),R=Number(T.percentage),z=Number.isFinite(R)?Math.min(100,Math.max(0,R)):0,q=Number(z.toFixed(2));return{label:A,count:F,percentage:q,isMissing:!!T.is_missing}}).filter(T=>!!T);if(!h.length)return null;h.sort((T,P)=>T.isMissing!==P.isMissing?T.isMissing?1:-1:T.count!==P.count?P.count-T.count:T.label.localeCompare(P.label));const p=h.length,m=12,f=p>m,y=f?h.slice(0,m):h,x=Number(i.missing_rows),_=Number.isFinite(x)?Math.max(0,Math.round(x)):0,v=Number(i.distinct_bins),w=Number.isFinite(v)?Math.max(0,Math.round(v)):h.length,M=i.top_label;let N=typeof M=="string"?M.trim()||null:M??null;const C=Number(i.top_count);let j=Number.isFinite(C)?Math.max(0,Math.round(C)):null;const E=Number(i.top_percentage);let k=Number.isFinite(E)?Number(Math.min(100,Math.max(0,E)).toFixed(2)):null;(N===null||j===null||k===null)&&y.length&&(N=y[0].label,j=y[0].count,k=y[0].percentage);const $=typeof i.source_column=="string"?i.source_column.trim()||null:i.source_column??null;return{column:i.column,sourceColumn:$,totalRows:u,missingRows:_,distinctBins:w,topLabel:N,topCount:j,topPercentage:k,bins:y,hasMoreBins:f,totalBinCount:p}}).filter(i=>!!i);return r.sort((i,l)=>{const u=(l.topCount??0)-(i.topCount??0);return u!==0?u:i.column.localeCompare(l.column)}),r},[t,n])},c5=({node:e,graphContext:t,hasReachableSource:n,sourceId:s,formatRelativeTime:r,catalogFlags:i})=>{const{isDatasetProfileNode:l}=i,u=b.useMemo(()=>t?Mc(t):"",[t]),d=lL({node:e,isDatasetProfileNode:l,sourceId:s,hasReachableSource:n,graphContext:t,profilingGraphSignature:u,formatRelativeTime:r}),{profileState:h}=d;return{datasetProfileController:d,profileState:h}},u5=(e,t)=>{var r;const n=(r=e==null?void 0:e.parameter_help)==null?void 0:r[t];if(n)return n;const s=t.replace(/_/g," ").trim();return s.charAt(0).toUpperCase()+s.slice(1)},d5=e=>{if(!e)return null;const t=[];if(e.removed_rows&&e.removed_rows>0&&t.push(`Removed ${e.removed_rows} row${e.removed_rows===1?"":"s"}`),Array.isArray(e.clipped_columns)&&e.clipped_columns.length){const n=Array.from(new Set(e.clipped_columns));t.push(`Winsorized ${n.length} column${n.length===1?"":"s"}`)}if(t.length||t.push("No rows removed or clipped during the last preview"),Array.isArray(e.skipped_columns)&&e.skipped_columns.length){const n=e.skipped_columns.join(", ");t.push(`Skipped columns: ${n}`)}return t.join("  ")},m5=(e,t,n,s,r)=>{var h;const i=n[s]??{};if(Object.prototype.hasOwnProperty.call(i,t)){const p=i[t];if(typeof p=="number"&&Number.isFinite(p))return{value:p,fallback:null}}const u=(r[e]??{})[t];return typeof u=="number"&&Number.isFinite(u)?{value:"",fallback:u}:{value:"",fallback:((h=Oa[e])==null?void 0:h[t])??null??null}},vj=e=>typeof e=="number"&&Number.isFinite(e)?String(e):"",xj={lower_percentile:"%",upper_percentile:"%"},f5=({sourceId:e,hasReachableSource:t,isFetchingOutliers:n,outlierConfig:s,outlierMethodOptions:r,outlierMethodDetailMap:i,outlierDefaultDetail:l,outlierAutoDetectEnabled:u,outlierSelectedCount:d,outlierDefaultLabel:h,outlierOverrideCount:p,outlierParameterOverrideCount:m,outlierOverrideExampleSummary:f,outlierHasOverrides:y,outlierRecommendationRows:x,outlierHasRecommendations:_,outlierStatusMessage:v,outlierError:w,outlierSampleSize:M,relativeOutlierGeneratedAt:N,outlierPreviewSignal:C,formatMetricValue:j,formatNumericStat:E,onApplyAllRecommendations:k,onClearOverrides:$,onDefaultMethodChange:T,onAutoDetectToggle:P,onOverrideSelect:A,onMethodParameterChange:D,onColumnParameterChange:F})=>{const R=d5(C);return o.jsxs("section",{className:"canvas-modal__section",children:[o.jsxs("div",{className:"canvas-modal__section-header",children:[o.jsx("h3",{children:"Outlier insights"}),o.jsxs("div",{className:"canvas-modal__section-actions",children:[o.jsx("button",{type:"button",className:"btn btn-primary",onClick:k,disabled:!_,children:"Apply recommendations"}),o.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:$,disabled:!y,children:"Clear overrides"})]})]}),o.jsx("p",{className:"canvas-modal__note",children:"Diagnose numeric outliers and configure how to handle them across the dataset. Preview updates immediately, letting you validate the impact before saving this node."}),!e&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Select a dataset to surface outlier diagnostics."}),e&&!t&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--warning",children:"Connect this step to an upstream output to analyse numeric distributions."}),N&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated ",N,M!==null?` on ${j(M)} row${M===1?"":"s"}.`:"."]}),!N&&M!==null&&o.jsxs("p",{className:"canvas-modal__note",children:["Insights generated on ",j(M)," row",M===1?"":"s","."]}),R&&o.jsxs("p",{className:"canvas-modal__note",children:["Last preview: ",R]}),o.jsxs("div",{className:"canvas-modal__parameter-grid",children:[o.jsxs("div",{className:"canvas-modal__parameter-field",children:[o.jsx("div",{className:"canvas-modal__parameter-label",children:o.jsx("span",{children:"Default outlier method"})}),o.jsx("div",{className:"canvas-scaling__method-toggle",role:"group","aria-label":"Default outlier method",children:r.map(z=>{const q=i.get(z.value)??null,V=z.value===s.defaultMethod;return o.jsxs("button",{type:"button",className:`canvas-scaling__method-button${V?" canvas-scaling__method-button--active":""}`,"aria-pressed":V,onClick:()=>T(z.value),children:[o.jsx("span",{className:"canvas-scaling__method-label",children:z.label}),(q==null?void 0:q.description)&&o.jsx("span",{className:"canvas-scaling__method-description",children:q.description})]},z.value)})}),(l==null?void 0:l.description)&&o.jsx("p",{className:"canvas-modal__parameter-description",children:l.description})]}),o.jsx(Ki,{fieldLabel:"Auto-detect numeric columns",label:u?"Enabled":"Disabled",checked:u,onChange:z=>P(z.target.checked),description:"Auto-detection tracks numeric features so newly profiled columns join the node automatically."})]}),(()=>{const z=s.defaultMethod,q=Wd[z]??[];if(!q.length)return null;const V=i.get(z)??null;return o.jsxs("section",{className:"canvas-modal__parameter-field",children:[o.jsx("div",{className:"canvas-modal__parameter-label",children:o.jsx("span",{children:"Global method parameters"})}),o.jsx("p",{className:"canvas-modal__parameter-description canvas-outlier__method-note",children:"Tune default thresholds for the selected strategy. Column overrides can refine these further."}),o.jsx("div",{className:"canvas-outlier__method-grid",children:o.jsx("article",{className:"canvas-outlier__method-card",children:o.jsx("div",{className:"canvas-outlier__parameter-list",children:q.map(U=>{var I,H;const W=((I=s.methodParameters[z])==null?void 0:I[U])??null,B=xj[U]??"";return o.jsxs("label",{className:"canvas-outlier__method-parameter",children:[o.jsx("span",{className:"canvas-outlier__parameter-label",children:u5(V,U)}),o.jsxs("div",{className:"canvas-outlier__method-input",children:[o.jsx(Yi,{className:"canvas-outlier__method-input-field",value:typeof W=="number"&&Number.isFinite(W)?W:"",placeholder:vj(((H=Oa[z])==null?void 0:H[U])??null),onChange:J=>{const G=J.target.value;if(G==="")D(z,U,null);else{const Y=Number(G);D(z,U,Number.isFinite(Y)?Y:null)}}}),B&&o.jsx("span",{className:"canvas-outlier__parameter-suffix",children:B})]})]},`${z}-${U}`)})})})})]})})(),o.jsxs("p",{className:"canvas-modal__note",children:["Tracking ",o.jsx("strong",{children:d})," column",d===1?"":"s","  Default method"," ",o.jsx("strong",{children:h})," ",u?" Auto-detect on":" Auto-detect off",(()=>{if(!(p+m))return"  No overrides yet";const q=[];return p>0&&q.push(f?`${p} method override${p===1?"":"s"} (${f})`:`${p} method override${p===1?"":"s"}`),m>0&&q.push(`${m} parameter override${m===1?"":"s"}`),`  Overrides: ${q.join("; ")}`})()]}),n&&o.jsx("p",{className:"canvas-modal__note",children:"Loading outlier diagnostics"}),!n&&w&&e&&t&&o.jsx("p",{className:"canvas-modal__note canvas-modal__note--error",children:w}),!n&&!w&&o.jsxs(o.Fragment,{children:[v&&o.jsx("p",{className:"canvas-modal__note",children:v}),x.length>0&&o.jsx("div",{className:"canvas-cast__body",children:o.jsx("div",{className:"canvas-cast__table-wrapper",children:o.jsxs("table",{className:"canvas-cast__table canvas-scaling__table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Column"}),o.jsx("th",{scope:"col",children:"Recommendation"}),o.jsx("th",{scope:"col",children:"Distribution"}),o.jsx("th",{scope:"col",children:"Configured method"})]})}),o.jsx("tbody",{children:x.map(z=>{const q=!z.isSkipped&&!z.isExcluded&&z.recommendedMethod&&z.recommendedMethod!==z.currentMethod,V=["canvas-cast__row"];q&&V.push("canvas-cast__row--attention"),z.isOverrideApplied&&V.push("canvas-cast__row--override"),z.isSkipped&&V.push("canvas-cast__row--muted");const U=z.isSkipped?"__skip__":z.isOverrideApplied?z.currentMethod:"__default__",W=z.isOverrideApplied?`Override -> ${z.currentMethodLabel}`:z.isSkipped?"Skipped (column will not be altered)":z.isSelected?`Inheriting ${h}`:"Pending inclusion",B=z.stats,I=[];typeof B.valid_count=="number"&&Number.isFinite(B.valid_count)&&I.push(`${j(B.valid_count)} valid rows`);const H=typeof B.minimum=="number"&&Number.isFinite(B.minimum),J=typeof B.maximum=="number"&&Number.isFinite(B.maximum);if(H||J){const Q=H?E(B.minimum):"",ne=J?E(B.maximum):"";I.push(`Range ${Q}  ${ne}`)}typeof B.mean=="number"&&Number.isFinite(B.mean)&&I.push(`Mean ${E(B.mean)}`),typeof B.median=="number"&&Number.isFinite(B.median)&&I.push(`Median ${E(B.median)}`),typeof B.stddev=="number"&&Number.isFinite(B.stddev)&&I.push(` ${E(B.stddev)}`);const G=I.length?I.join("  "):null,Y=!z.recommendedMethod||!z.recommendedLabel?z.recommendedReason||"No outlier risk detected":z.recommendedReason?`${z.recommendedLabel}  ${z.recommendedReason}`:z.recommendedLabel,X=s.columnParameters,Z=s.methodParameters,ee=Wd[z.currentMethod]??[];return o.jsxs("tr",{className:V.join(" "),children:[o.jsx("th",{scope:"row",children:o.jsxs("div",{className:"canvas-cast__column-cell",children:[o.jsx("span",{className:"canvas-cast__column-name",children:z.column}),o.jsxs("div",{className:"canvas-cast__column-meta",children:[z.dtype&&o.jsxs("span",{className:"canvas-cast__muted",children:["dtype: ",z.dtype]}),z.isExcluded&&o.jsx("span",{className:"canvas-cast__muted",children:"Excluded from outlier evaluation (non-numeric)"}),z.isSelected&&!z.isExcluded&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--selected",children:"In node"}),z.isSkipped&&!z.isExcluded&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--skipped",children:"Skipped"}),z.isOverrideApplied&&o.jsx("span",{className:"canvas-cast__badge canvas-cast__badge--override",children:"Override"}),z.hasMissing&&o.jsx("span",{className:"canvas-cast__muted",children:"Contains missing values"})]})]})}),o.jsx("td",{children:o.jsxs("div",{className:"canvas-cast__recommendation",children:[z.recommendedLabel?o.jsx("span",{className:`canvas-cast__chip${q?" canvas-cast__chip--attention":" canvas-cast__chip--applied"}`,children:z.recommendedLabel}):o.jsx("span",{className:"canvas-cast__chip",children:"No action needed"}),Y&&o.jsx("span",{className:"canvas-cast__recommendation-note",children:Y})]})}),o.jsx("td",{children:G?o.jsx("span",{children:G}):o.jsx("span",{className:"canvas-cast__muted",children:"No distribution summary"})}),o.jsx("td",{children:o.jsxs("div",{className:"canvas-cast__target",children:[o.jsxs("select",{value:U,onChange:Q=>A(z.column,Q.target.value),disabled:z.isExcluded,children:[o.jsxs("option",{value:"__default__",children:["Inherit default (",h,")"]}),o.jsx("option",{value:"__skip__",children:"Skip outlier handling"}),r.map(Q=>o.jsx("option",{value:Q.value,children:Q.label},`${z.column}-${Q.value}`))]}),o.jsx("span",{className:"canvas-cast__target-note",children:W}),ee.length>0&&!z.isExcluded&&!z.isSkipped&&o.jsx("div",{className:"canvas-outlier__parameters",children:ee.map(Q=>{const{value:ne,fallback:he}=m5(z.currentMethod,Q,X,z.column,Z),ye=xj[Q]??"";return o.jsxs("label",{children:[o.jsx("span",{children:Q.replace(/_/g," ")}),o.jsx(Yi,{value:ne,placeholder:vj(he),onChange:ge=>{const Ee=ge.target.value;if(Ee==="")F(z.column,Q,null);else{const De=Number(Ee);F(z.column,Q,Number.isFinite(De)?De:null)}}}),ye&&o.jsx("span",{className:"canvas-outlier__parameter-suffix",children:ye})]},`${z.column}-${z.currentMethod}-${Q}`)})})]})})]},`outlier-row-${z.column}`)})})]})})})]})]})},h5=({connectionInfo:e,connectedInputHandles:t,connectedOutputHandles:n,connectionReady:s})=>e?o.jsxs("section",{className:"canvas-modal__section",children:[o.jsx("div",{className:"canvas-modal__section-header",children:o.jsx("h3",{children:"Connection requirements"})}),o.jsxs("p",{className:s?"canvas-modal__note":"canvas-modal__note canvas-modal__note--warning",children:[o.jsx("strong",{children:s?"Ready to execute.":"Missing required connections."})," ",s?"All required inputs are connected; you can continue configuring this node.":"Connect the required inputs listed below before running training or evaluation workflows."]}),e.inputs&&e.inputs.length>0&&o.jsxs("div",{className:"canvas-modal__note",children:[o.jsx("strong",{children:"Inputs"}),o.jsx("ul",{children:e.inputs.map(r=>{const i=t.has(r.key),l=r.required!==!1;return o.jsxs("li",{children:[o.jsx("span",{children:r.label}),o.jsx("span",{children:" - "}),o.jsx("span",{children:i?"Connected":l?"Missing":"Optional"})]},`inputs-${r.key}`)})})]}),e.outputs&&e.outputs.length>0&&o.jsxs("div",{className:"canvas-modal__note",children:[o.jsx("strong",{children:"Outputs"}),o.jsx("ul",{children:e.outputs.map(r=>{const i=n.has(r.key),l=r.required!==!1;return o.jsxs("li",{children:[o.jsx("span",{children:r.label}),o.jsx("span",{children:" - "}),o.jsx("span",{children:i?"Connected":l?"Unlinked":"Optional"})]},`outputs-${r.key}`)})})]})]}):null,p5=({node:e,onClose:t,onUpdateConfig:n,onUpdateNodeData:s,sourceId:r,graphSnapshot:i,onResetConfig:l,defaultConfigTemplate:u,isResetAvailable:d=!1})=>{var qt,Sr,Hn;const{metadata:h,title:p,connectionReadiness:m,catalogFlags:f,datasetBadge:y,isClassResamplingNode:x,parameters:_,requiresColumnCatalog:v,dropColumnParameter:w,dataConsistencyHint:M,nodeId:N,resetPermissions:C,nodeParams:j,dataConsistencyParameters:E,configStateResult:k,parameterHandlers:$,imputationStrategiesResult:T,skewnessStateResult:P}=r5({node:e,graphSnapshot:i??null,isResetAvailable:d,defaultConfigTemplate:u}),{connectionInfo:A,connectedHandleKeys:D,connectedOutputHandleKeys:F,evaluationSplitConnectivity:R,connectionReady:z,gatedSectionStyle:q,gatedAriaDisabled:V}=m,{catalogType:U,isDataset:W,isImputerNode:B,isMissingIndicatorNode:I,isReplaceAliasesNode:H,isTrimWhitespaceNode:J,isRemoveSpecialCharsNode:G,isReplaceInvalidValuesNode:Y,isRegexCleanupNode:X,isNormalizeTextCaseNode:Z,isStandardizeDatesNode:ee,isLabelEncodingNode:Q,isTargetEncodingNode:ne,isHashEncodingNode:he,isFeatureTargetSplitNode:ye,isTrainTestSplitNode:ge,isTrainModelDraftNode:Ee,isModelEvaluationNode:De,isModelRegistryNode:ke,isHyperparameterTuningNode:le,isClassUndersamplingNode:pe,isClassOversamplingNode:be,isOrdinalEncodingNode:Te,isDummyEncodingNode:Ie,isOneHotEncodingNode:ue,isFeatureMathNode:$e,isCastNode:Ye,isBinningNode:et,isScalingNode:We,isPolynomialFeaturesNode:mt,isFeatureSelectionNode:rt,isTransformerAuditNode:ft,isOutlierNode:bt,isSkewnessNode:zt,isSkewnessDistributionNode:Xe,isBinnedDistributionNode:Ft,isDataConsistencyNode:Kt,isInspectionNode:Et,isRemoveDuplicatesNode:Qt,isDropMissingColumnsNode:wn,isDropMissingRowsNode:Mt,isDropMissingNode:Zt,isPreviewNode:Nn,isDatasetProfileNode:Bt}=f,{canResetNode:dt,headerCanResetNode:Tn,footerCanResetNode:Xt}=C,{configState:Nt,setConfigState:at,stableInitialConfig:os,stableCurrentConfig:Vt,nodeChangeVersion:pt}=k,{handleParameterChange:yt,handleNumberChange:Gn,handlePercentileChange:mn,handleBooleanChange:vn,handleTextChange:nn}=$,jn=b.useMemo(()=>ke?Nt?{...Nt}:{}:null,[Nt,ke]),{imputationMethodOptions:Jt,imputationMethodValues:Xn,imputerStrategies:$t,imputerStrategyCount:$n}=T,{skewnessTransformations:xn,updateSkewnessTransformations:fn}=P,{graphTopology:ws,modelingConfig:Pn,previewSignatureResult:Ns,cachedPreviewSchema:Qn,setCachedPreviewSchema:is,schemaDiagnostics:js,columnCatalogState:Fn}=KF({graphSnapshot:i??null,nodeId:N,catalogFlags:f,configState:Nt,setConfigState:at,nodeParams:j,sourceId:r,requiresColumnCatalog:v,imputerStrategies:$t}),{graphContext:Zn,graphNodeCount:Ht,upstreamTargetColumn:Qe,hasReachableSource:Ue}=ws,{featureTargetSplitConfig:Ln,trainTestSplitConfig:Cs,resamplingConfig:Jn,trainModelDraftConfig:Ss,trainModelRuntimeConfig:ie,trainModelCVConfig:xe,filteredModelTypeOptions:Le}=Pn,{upstreamConfigFingerprints:jt,previewSignature:Ce}=Ns,{cachedSchemaColumns:ot,oversamplingSchemaGuard:lt,imputationSchemaDiagnostics:Rt,skipPreview:kt}=js,{availableColumns:Ut,setAvailableColumns:At,columnSearch:sn,setColumnSearch:ls,columnMissingMap:Cn,setColumnMissingMap:en,columnTypeMap:rn,setColumnTypeMap:Bn,columnSuggestions:Sn,setColumnSuggestions:aa,imputerMissingFilter:Ba,setImputerMissingFilter:vt,normalizedColumnSearch:hl,filteredColumnOptions:ti}=Fn,[Ua,pl]=b.useState("500"),[Ha,qa]=b.useState(()=>new Set);b.useEffect(()=>{qa(new Set)},[os]);const{datasetProfileController:Va,profileState:oa}=c5({node:e,graphContext:Zn,hasReachableSource:Ue,sourceId:r,formatRelativeTime:Yn,catalogFlags:f}),{nodePreview:Xs,previewSignals:te,featureMathState:_e,previewData:me}=FB({graphSnapshot:i??null,graphNodeCount:Ht,hasReachableSource:Ue,sourceId:r,node:e,nodeId:N,previewSignature:Ce,skipPreview:kt,cachedPreviewSchema:Qn,setCachedPreviewSchema:is,catalogFlags:f,upstreamTargetColumn:Qe,setConfigState:at,configState:Nt}),{previewState:Ae,refreshPreview:Me,clearCachedPreviewSchema:we,canTriggerPreview:it}=Xs,{featureMathSignals:He,polynomialSignal:ht,featureSelectionSignal:ct,outlierPreviewSignal:tt,transformerAuditSignal:Ct}=te,{featureMathOperations:Un,featureMathSummaries:Wt,collapsedFeatureMath:Rn,setCollapsedFeatureMath:Ds}=_e,{previewColumns:Es,previewColumnStats:Qs,previewSampleRows:Nr}=me,{dropMissingColumns:or,encodingRecommendations:cs,outlierRecommendations:Ms,scalingInsights:Wa,binningInsights:zs,binnedDistribution:Ya,skewnessInsights:ia,missingIndicatorState:Ka,dataCleaningState:Ga,numericColumnAnalysis:Xa,numericAnalysisState:Qa,removeDuplicatesState:En}=TB({catalogFlags:f,sourceId:r,nodeId:N,graphContext:Zn,hasReachableSource:Ue,columnTypeMap:rn,setAvailableColumns:At,setColumnSearch:ls,setColumnMissingMap:en,setColumnTypeMap:Bn,setColumnSuggestions:aa,dropColumnParameter:w,node:e,configState:Nt,setConfigState:at,nodeChangeVersion:pt,binnedSamplePreset:Ua,skewnessTransformations:xn,availableColumns:Ut,columnMissingMap:Cn,previewSampleRows:Nr}),{hasDropColumnSource:an,availableFilters:Za,activeFilterId:la,setActiveFilterId:Uc,recommendations:Ja,filteredRecommendations:on,formatSignalName:Dn,isFetchingRecommendations:es,recommendationsError:gl,recommendationsGeneratedAt:Gp,suggestedThreshold:Xp,refreshRecommendations:Qp}=or,{labelEncoding:ca,targetEncoding:ni,hashEncoding:eo,ordinalEncoding:si,dummyEncoding:ri,oneHotEncoding:ai}=cs,{outlierData:em,outlierError:Zp,isFetchingOutliers:Jp,refreshOutliers:tm}=Ms,{scalingData:eg,scalingError:Hc,isFetchingScaling:nm,refreshScaling:sm}=Wa,{binningData:tg,binningError:rm,isFetchingBinning:am,refreshBinning:om}=zs,to=b.useCallback(()=>{we(),Me(),We&&sm(),et&&om(),bt&&tm()},[et,bt,We,om,tm,we,Me,sm]),{binnedDistributionData:im,binnedDistributionError:ng,isFetchingBinnedDistribution:lm,refreshBinnedDistribution:cm}=Ya,{skewnessData:qc,skewnessError:no,isFetchingSkewness:um,refreshSkewness:dm}=ia,{activeFlagSuffix:Vc,missingIndicatorColumns:sg,missingIndicatorInsights:mm}=Ka,fm=!!r&&Ue,so=b.useMemo(()=>{var qn;return Ge((qn=e==null?void 0:e.data)==null?void 0:qn.columns)},[(qt=e==null?void 0:e.data)==null?void 0:qt.columns]),{alias:ua,trimWhitespace:Wc,removeSpecial:Yc,regexCleanup:ro,normalizeCase:oi,replaceInvalid:ir,standardizeDates:Zs}=Ga,{numericExcludedColumns:rg}=Xa,{scaling:ln,outlier:hn,binning:Ot,selectedColumns:Is}=Qa;QF({previewState:Ae,previewSampleRows:Nr,activeFlagSuffix:Vc??"",setColumnTypeMap:Bn,setColumnSuggestions:aa,hasReachableSource:Ue,requiresColumnCatalog:v,nodeColumns:so,selectedColumns:Is,setAvailableColumns:At,setColumnMissingMap:en});const _l=((Sr=j.dropMissing.threshold)==null?void 0:Sr.name)??null,{skewness:pn,imputationConfiguration:hm,thresholdRecommendations:pm}=BF({catalogFlags:f,skewnessData:qc,skewnessTransformations:xn,availableColumns:Ut,previewColumns:Es,columnTypeMap:rn,updateSkewnessTransformations:fn,imputerStrategies:$t,columnMissingMap:Cn,previewColumnStats:Qs,nodeColumns:(Hn=e==null?void 0:e.data)==null?void 0:Hn.columns,imputerMissingFilter:Ba,suggestedThreshold:Xp,thresholdParameterName:_l,configState:Nt,handleParameterChange:yt}),{imputerColumnOptions:ag,imputerMissingSliderMax:og,imputerFilteredOptionCount:ig,imputerMissingFilterActive:lg}=hm,{normalizedSuggestedThreshold:cg,thresholdMatchesSuggestion:Js,canApplySuggestedThreshold:ii,handleApplySuggestedThreshold:gm}=pm,_m=Mt&&!!(j.dropMissing.threshold||j.dropRows.any),{columnSelectionHandlers:ym,nodeSaveHandlers:vm,imputationStrategyHandlers:Kc,aliasStrategyHandlers:ug,dateStrategyHandlers:dg,featureMathHandlers:ao}=u3({catalogFlags:f,setConfigState:at,binningExcludedColumns:Ot.state.excludedColumns,scalingExcludedColumns:ln.state.excludedColumns,availableColumns:Ut,recommendations:Ja,nodeId:N,onUpdateConfig:n,onClose:t,sourceId:r??null,graphSnapshot:i??null,onUpdateNodeData:s,canResetNode:dt,defaultConfigTemplate:u,onResetConfig:l,imputationMethodValues:Xn,imputationMethodOptions:Jt,imputerStrategyCount:$n,setCollapsedStrategies:qa,setImputerMissingFilter:vt,node:e,aliasColumnSummary:ua.columnSummary,aliasStrategyCount:ua.strategyCount,dateStrategies:Zs.strategies,standardizeDatesColumnSummary:Zs.columnSummary,standardizeDatesMode:Zs.mode,setCollapsedFeatureMath:Ds,configState:Nt}),{handleManualBoundChange:xm,handleClearManualBound:yl,handleToggleColumn:jr,handleApplyAllRecommended:bm,handleSelectAllColumns:vl,handleClearColumns:oo,handleRemoveColumn:Gc}=ym,{handleSave:xl,handleResetNode:li}=vm,wm=Is.length,Nm=an&&!!r&&Ue,Xc=!y&&!Et,jm=Xc&&os!==Vt,Cm=oa.status==="loading",Sm=Ae.status==="loading",{insightSummaries:Fr,asyncBusyLabel:Qc}=i5({recommendationsGeneratedAt:Gp,scalingData:eg,binningData:tg,binnedDistributionData:im,outlierData:em,isProfileLoading:Cm,isPreviewLoading:Sm,isFetchingScaling:nm,isFetchingBinning:am,isFetchingHashEncoding:eo.isFetching,isFetchingBinnedDistribution:lm,isFetchingRecommendations:es,catalogFlags:f}),{relativeGeneratedAt:Zc,relativeScalingGeneratedAt:mg,relativeBinningGeneratedAt:fg,relativeBinnedGeneratedAt:ci,relativeOutlierGeneratedAt:hg,scalingSampleSize:Em,binningSampleSize:Mm,binnedSampleSize:Gt,outlierSampleSize:Jc}=Fr,{hasActiveAsyncWork:bl,busyLabel:wl,footerBusyLabel:km}=Qc,{updateImputerStrategies:Am,handleAddImputerStrategy:ui,handleRemoveImputerStrategy:Nl,toggleImputerStrategySection:io,handleImputerMethodChange:Om,handleImputerOptionNumberChange:pg,handleImputerColumnsChange:gg,handleImputerColumnToggle:Tm,handleImputerMissingFilterChange:jl}=Kc,{updateAliasStrategies:eu,handleAddAliasStrategy:tu,handleRemoveAliasStrategy:nu,toggleAliasStrategySection:su,handleAliasModeChange:ru,handleAliasColumnToggle:_g,handleAliasColumnsChange:$m,handleAliasAutoDetectToggle:yg}=ug,{updateDateStrategies:Gj,handleAddDateStrategy:au,handleRemoveDateStrategy:Br,toggleDateStrategySection:Pm,handleDateStrategyModeChange:lo,handleDateStrategyColumnsChange:lr,handleDateStrategyColumnToggle:di,handleDateStrategyAutoDetectToggle:Cr}=dg,{updateFeatureMathOperations:Lm,handleAddFeatureMathOperation:vg,handleDuplicateFeatureMathOperation:xg,handleRemoveFeatureMathOperation:da,handleReorderFeatureMathOperation:mi,handleToggleFeatureMathOperation:co,handleFeatureMathOperationChange:Cl}=ao,ou=b.useCallback(()=>{r&&cm()},[cm,r]),uo=l5({catalogFlags:f,binnedDistributionData:im}),{renderMultiSelectField:hs,renderParameterField:Ze}=qB({nodeId:N,catalogFlags:f,configState:Nt,previewState:Ae,binning:Ot,scaling:ln,selectedColumns:Is,availableColumns:Ut,filteredColumnOptions:ti,normalizedColumnSearch:hl,columnSearch:sn,setColumnSearch:ls,columnSuggestions:Sn,columnMissingMap:Cn,columnTypeMap:rn,sourceId:r,hasReachableSource:Ue,recommendationsState:{isFetching:es,availableFilters:Za,activeFilterId:la,setActiveFilterId:Uc,recommendations:Ja,filteredRecommendations:on,error:gl,relativeGeneratedAt:Zc,formatSignalName:Dn,refresh:Qp,show:Nm},columnSelectionHandlers:{handleToggleColumn:jr,handleRemoveColumn:Gc,handleApplyAllRecommended:bm,handleSelectAllColumns:vl,handleClearColumns:oo},parameterHandlers:{handleNumberChange:Gn,handleBooleanChange:vn,handleTextChange:nn},thresholdRecommendations:{thresholdParameterName:_l,normalizedSuggestedThreshold:cg,canApplySuggestedThreshold:ii,thresholdMatchesSuggestion:Js,handleApplySuggestedThreshold:gm},numericExcludedColumns:rg,selectionCount:wm});return o.jsxs("div",{className:"canvas-modal",role:"dialog","aria-modal":"true","aria-labelledby":"node-settings-title",children:[o.jsx("div",{className:"canvas-modal__backdrop",onClick:t}),o.jsxs("div",{className:"canvas-modal__panel",children:[o.jsx(dL,{title:p,isDataset:y,onClose:t,canResetNode:Tn,onResetNode:li}),o.jsxs("div",{className:"canvas-modal__body",children:[A&&o.jsx(h5,{connectionInfo:A,connectedInputHandles:D,connectedOutputHandles:F,connectionReady:z}),_m&&o.jsx(BP,{thresholdParameter:j.dropMissing.threshold??null,dropIfAnyParameter:j.dropRows.any,renderParameterField:Ze}),w&&o.jsx(FP,{thresholdParameter:j.dropMissing.threshold??null,dropColumnParameter:w,renderParameterField:Ze,renderMultiSelectField:hs}),I&&o.jsxs(o.Fragment,{children:[o.jsx(ZL,{suffix:Vc,insights:mm,formatMissingPercentage:as}),o.jsx(JL,{columnsParameter:j.missingIndicator.columns,suffixParameter:j.missingIndicator.suffix,renderParameterField:Ze})]}),Nn&&o.jsx(iL,{previewState:Ae,datasetSourceId:r??null,canTriggerPreview:it,onRefresh:to,formatCellValue:$N,formatMetricValue:Ws,formatMissingPercentage:as,formatNumericStat:Ps,formatModeStat:mw}),o.jsx(cL,{isDatasetProfileNode:Bt,controller:Va,formatCellValue:$N,formatNumericStat:Ps,formatMissingPercentage:as}),M&&o.jsx("section",{className:"canvas-modal__section",children:o.jsxs("p",{className:"canvas-modal__note",children:[o.jsxs("strong",{children:[M.title,"."]})," ",M.body]})}),J&&o.jsx(aD,{sourceId:r,hasReachableSource:Ue,columnsParameter:j.trimWhitespace.columns,modeParameter:j.trimWhitespace.mode,renderMultiSelectField:hs,renderParameterField:Ze,columnSummary:Wc.columnSummary,modeDetails:Wc.modeDetails,sampleMap:Wc.sampleMap}),G&&o.jsx(jD,{sourceId:r,hasReachableSource:Ue,columnsParameter:j.removeSpecial.columns,modeParameter:j.removeSpecial.mode,replacementParameter:j.removeSpecial.replacement,renderMultiSelectField:hs,renderParameterField:Ze,columnSummary:Yc.columnSummary,modeDetails:Yc.modeDetails,sampleMap:Yc.sampleMap}),Y&&o.jsx(kz,{sourceId:r,hasReachableSource:Ue,columnsParameter:j.replaceInvalid.columns,modeParameter:j.replaceInvalid.mode,minValueParameter:j.replaceInvalid.minValue,maxValueParameter:j.replaceInvalid.maxValue,renderMultiSelectField:hs,renderParameterField:Ze,columnSummary:ir.columnSummary,modeDetails:ir.modeDetails,sampleMap:ir.sampleMap,selectedMode:ir.mode,minValue:ir.minValue,maxValue:ir.maxValue}),X&&o.jsx(az,{sourceId:r,hasReachableSource:Ue,columnsParameter:j.regexCleanup.columns,modeParameter:j.regexCleanup.mode,patternParameter:j.regexCleanup.pattern,replacementParameter:j.regexCleanup.replacement,renderMultiSelectField:hs,renderParameterField:Ze,columnSummary:ro.columnSummary,modeDetails:ro.modeDetails,sampleMap:ro.sampleMap,selectedMode:ro.selectedMode,replacementValue:ro.replacementValue}),Z&&o.jsx(BD,{sourceId:r,hasReachableSource:Ue,columnsParameter:j.normalizeCase.columns,modeParameter:j.normalizeCase.mode,renderMultiSelectField:hs,renderParameterField:Ze,columnSummary:oi.columnSummary,modeDetails:oi.modeDetails,sampleMap:oi.sampleMap,selectedMode:oi.selectedMode}),$e&&o.jsx(Kz,{operations:Un,summaries:Wt,collapsed:Rn,onToggleCollapsed:co,onAddOperation:vg,onDuplicateOperation:xg,onRemoveOperation:da,onReorderOperation:mi,onOperationChange:Cl,availableColumns:Ut,signals:He,previewStatus:Ae.status,errorHandlingParameter:j.featureMath.errorHandling,allowOverwriteParameter:j.featureMath.allowOverwrite,defaultTimezoneParameter:j.featureMath.defaultTimezone,epsilonParameter:j.featureMath.epsilon,renderParameterField:Ze}),Te&&o.jsx(cI,{sourceId:r,hasReachableSource:Ue,isFetching:si.isFetching,error:si.error,suggestions:si.suggestions,metadata:si.metadata,columnsParameter:j.ordinalEncoding.columns,autoDetectParameter:j.ordinalEncoding.autoDetect,maxCategoriesParameter:j.ordinalEncoding.maxCategories,outputSuffixParameter:j.ordinalEncoding.outputSuffix,dropOriginalParameter:j.ordinalEncoding.dropOriginal,encodeMissingParameter:j.ordinalEncoding.encodeMissing,handleUnknownParameter:j.ordinalEncoding.handleUnknown,unknownValueParameter:j.ordinalEncoding.unknownValue,selectedColumns:Is,renderParameterField:Ze,onToggleColumn:jr,onApplyRecommended:si.handleApplyRecommended,formatMissingPercentage:as}),ne&&o.jsx(eI,{sourceId:r,hasReachableSource:Ue,isFetching:ni.isFetching,error:ni.error,suggestions:ni.suggestions,metadata:ni.metadata,columnsParameter:j.targetEncoding.columns,targetColumnParameter:j.targetEncoding.targetColumn,autoDetectParameter:j.targetEncoding.autoDetect,maxCategoriesParameter:j.targetEncoding.maxCategories,outputSuffixParameter:j.targetEncoding.outputSuffix,dropOriginalParameter:j.targetEncoding.dropOriginal,smoothingParameter:j.targetEncoding.smoothing,encodeMissingParameter:j.targetEncoding.encodeMissing,handleUnknownParameter:j.targetEncoding.handleUnknown,selectedColumns:Is,renderParameterField:Ze,onToggleColumn:jr,onApplyRecommended:ni.handleApplyRecommended,formatMissingPercentage:as}),Ie&&o.jsx(mI,{sourceId:r,hasReachableSource:Ue,isFetching:ri.isFetching,error:ri.error,suggestions:ri.suggestions,metadata:ri.metadata,columnsParameter:j.dummyEncoding.columns,autoDetectParameter:j.dummyEncoding.autoDetect,maxCategoriesParameter:j.dummyEncoding.maxCategories,dropFirstParameter:j.dummyEncoding.dropFirst,includeMissingParameter:j.dummyEncoding.includeMissing,dropOriginalParameter:j.dummyEncoding.dropOriginal,prefixSeparatorParameter:j.dummyEncoding.prefixSeparator,selectedColumns:Is,renderParameterField:Ze,onToggleColumn:jr,onApplyRecommended:ri.handleApplyRecommended,formatMissingPercentage:as}),ue&&o.jsx(pI,{sourceId:r,hasReachableSource:Ue,isFetching:ai.isFetching,error:ai.error,suggestions:ai.suggestions,metadata:ai.metadata,columnsParameter:j.oneHotEncoding.columns,autoDetectParameter:j.oneHotEncoding.autoDetect,maxCategoriesParameter:j.oneHotEncoding.maxCategories,dropFirstParameter:j.oneHotEncoding.dropFirst,includeMissingParameter:j.oneHotEncoding.includeMissing,dropOriginalParameter:j.oneHotEncoding.dropOriginal,prefixSeparatorParameter:j.oneHotEncoding.prefixSeparator,selectedColumns:Is,renderParameterField:Ze,onToggleColumn:jr,onApplyRecommended:ai.handleApplyRecommended,formatMissingPercentage:as}),ye&&o.jsx(jI,{nodeId:N,sourceId:r,hasReachableSource:Ue,previewState:Ae,onRefreshPreview:to,config:Ln,targetColumnParameter:j.featureTargetSplit.targetColumn,renderParameterField:Ze,formatMetricValue:Ws,formatMissingPercentage:as}),ge&&o.jsx(SI,{nodeId:N,sourceId:r,hasReachableSource:Ue,previewState:Ae,onRefreshPreview:to,config:Cs,parameters:_,renderParameterField:Ze,formatMetricValue:Ws}),x&&o.jsx(RF,{mode:be?"oversampling":"undersampling",sourceId:r,hasReachableSource:Ue,previewState:Ae,onRefreshPreview:to,config:Jn,methodParameter:j.resampling.method,targetColumnParameter:j.resampling.targetColumn,samplingStrategyParameter:j.resampling.samplingStrategy,randomStateParameter:j.resampling.randomState,kNeighborsParameter:be?j.resampling.kNeighbors:null,replacementParameter:pe?j.resampling.replacement:null,renderParameterField:Ze,formatMetricValue:Ws,formatMissingPercentage:as,schemaGuard:lt}),(Ee||le)&&o.jsx(OI,{sourceId:r,hasReachableSource:Ue,previewState:Ae,onRefreshPreview:to,config:Ss,targetColumnParameter:j.trainModel.targetColumn,problemTypeParameter:j.trainModel.problemType,renderParameterField:Ze,formatMetricValue:Ws,formatMissingPercentage:as,schemaColumns:ot}),Ee&&o.jsx("div",{style:q,"aria-disabled":V,children:o.jsx(KI,{nodeId:N,sourceId:r,graph:Zn,config:Ss,runtimeConfig:ie,cvConfig:xe,draftConfigState:Nt,renderParameterField:Ze,modelTypeParameter:j.trainModel.modelType,modelTypeOptions:Le,hyperparametersParameter:j.trainModel.hyperparameters,cvEnabledParameter:j.trainModel.cvEnabled,cvStrategyParameter:j.trainModel.cvStrategy,cvFoldsParameter:j.trainModel.cvFolds,cvShuffleParameter:j.trainModel.cvShuffle,cvRandomStateParameter:j.trainModel.cvRandomState,cvRefitStrategyParameter:j.trainModel.cvRefitStrategy,onSaveDraftConfig:xl})}),De&&o.jsx("div",{style:q,"aria-disabled":V,children:o.jsx(sF,{nodeId:N,sourceId:r,graph:Zn,config:Nt,setConfigState:at,renderParameterField:Ze,formatMetricValue:Ws,connectedSplitHandles:R})}),ke&&o.jsx("div",{style:q,"aria-disabled":V,children:o.jsx(bF,{nodeId:N,sourceId:r,graph:Zn,parameters:_,config:jn,renderParameterField:Ze})}),le&&o.jsx("div",{style:q,"aria-disabled":V,children:o.jsx(TF,{nodeId:N,sourceId:r,graph:Zn,config:Ss,runtimeConfig:ie,cvConfig:xe,draftConfigState:Nt,renderParameterField:Ze,modelTypeParameter:j.trainModel.modelType,modelTypeOptions:Le,searchStrategyParameter:j.hyperparameterTuning.searchStrategy,searchIterationsParameter:j.hyperparameterTuning.searchIterations,searchRandomStateParameter:j.hyperparameterTuning.searchRandomState,scoringMetricParameter:j.hyperparameterTuning.scoringMetric,setDraftConfigState:at,onSaveDraftConfig:xl})}),Q&&o.jsx(Qz,{sourceId:r,hasReachableSource:Ue,isFetching:ca.isFetching,error:ca.error,suggestions:ca.suggestions,metadata:ca.metadata,columnsParameter:j.labelEncoding.columns,autoDetectParameter:j.labelEncoding.autoDetect,maxUniqueParameter:j.labelEncoding.maxUnique,outputSuffixParameter:j.labelEncoding.outputSuffix,dropOriginalParameter:j.labelEncoding.dropOriginal,missingStrategyParameter:j.labelEncoding.missingStrategy,missingCodeParameter:j.labelEncoding.missingCode,selectedColumns:Is,renderParameterField:Ze,onToggleColumn:jr,onApplyRecommended:ca.handleApplyRecommended,formatMissingPercentage:as}),he&&o.jsx(sI,{sourceId:r,hasReachableSource:Ue,isFetching:eo.isFetching,error:eo.error,suggestions:eo.suggestions,metadata:eo.metadata,columnsParameter:j.hashEncoding.columns,autoDetectParameter:j.hashEncoding.autoDetect,maxCategoriesParameter:j.hashEncoding.maxCategories,bucketsParameter:j.hashEncoding.buckets,outputSuffixParameter:j.hashEncoding.outputSuffix,dropOriginalParameter:j.hashEncoding.dropOriginal,encodeMissingParameter:j.hashEncoding.encodeMissing,selectedColumns:Is,renderParameterField:Ze,onToggleColumn:jr,onApplyRecommended:eo.handleApplyRecommended,formatMissingPercentage:as}),mt&&o.jsx(rI,{columnsParameter:j.polynomial.columns,autoDetectParameter:j.polynomial.autoDetect,degreeParameter:j.polynomial.degree,includeBiasParameter:j.polynomial.includeBias,interactionOnlyParameter:j.polynomial.interactionOnly,includeInputFeaturesParameter:j.polynomial.includeInputFeatures,outputPrefixParameter:j.polynomial.outputPrefix,renderParameterField:Ze,signal:ht}),rt&&o.jsx(oI,{columnsParameter:j.featureSelection.columns,autoDetectParameter:j.featureSelection.autoDetect,targetColumnParameter:j.featureSelection.targetColumn,methodParameter:j.featureSelection.method,scoreFuncParameter:j.featureSelection.scoreFunc,problemTypeParameter:j.featureSelection.problemType,kParameter:j.featureSelection.k,percentileParameter:j.featureSelection.percentile,alphaParameter:j.featureSelection.alpha,thresholdParameter:j.featureSelection.threshold,modeParameter:j.featureSelection.mode,estimatorParameter:j.featureSelection.estimator,stepParameter:j.featureSelection.step,minFeaturesParameter:j.featureSelection.minFeatures,maxFeaturesParameter:j.featureSelection.maxFeatures,dropUnselectedParameter:j.featureSelection.dropUnselected,renderParameterField:Ze,signal:ct}),ee&&o.jsx(BR,{hasSource:!!r,hasReachableSource:Ue,strategies:Zs.strategies,columnSummary:Zs.columnSummary,columnOptions:Zs.columnOptions,sampleMap:Zs.sampleMap,collapsedStrategies:Ha,onToggleStrategy:Pm,onRemoveStrategy:Br,onAddStrategy:au,onModeChange:lo,onColumnToggle:di,onColumnsChange:lr,onAutoDetectToggle:Cr,modeOptions:fp}),H&&o.jsx(SR,{hasSource:!!r,hasReachableSource:Ue,strategies:ua.strategies,columnSummary:ua.columnSummary,columnOptions:ua.columnOptions,sampleMap:ua.sampleMap,customPairSummary:ua.customPairSummary,customPairsParameter:j.replaceAliases.customPairs,collapsedStrategies:Ha,onToggleStrategy:su,onRemoveStrategy:nu,onAddStrategy:tu,onModeChange:ru,onAutoDetectToggle:yg,onColumnToggle:_g,onColumnsChange:$m,renderParameterField:Ze}),B&&o.jsx(UL,{hasSource:!!r,hasReachableSource:Ue,strategies:$t,columnOptions:ag,methodOptions:Jt,missingFilter:Ba,missingFilterMax:og,missingFilterActive:lg,filteredOptionCount:ig,collapsedStrategies:Ha,onToggleStrategy:io,onRemoveStrategy:Nl,onAddStrategy:ui,onMethodChange:Om,onOptionNumberChange:pg,onColumnsChange:gg,onColumnToggle:Tm,onMissingFilterChange:jl,formatMissingPercentage:as,formatNumericStat:Ps,formatModeStat:mw,schemaDiagnostics:Rt}),Ye&&o.jsx(VP,{configState:Nt,setConfigState:at,availableColumns:Ut,columnTypeMap:rn,columnSuggestions:Sn,selectedColumns:Is,previewColumns:Es,previewStatus:Ae.status,sourceId:r,hasReachableSource:Ue}),bt&&o.jsx(f5,{sourceId:r,hasReachableSource:Ue,isFetchingOutliers:Jp,outlierConfig:hn.config,outlierMethodOptions:hn.state.methodOptions,outlierMethodDetailMap:hn.state.methodDetailMap,outlierDefaultDetail:hn.state.defaultDetail,outlierAutoDetectEnabled:hn.state.autoDetectEnabled,outlierSelectedCount:hn.state.selectedCount,outlierDefaultLabel:hn.state.defaultLabel,outlierOverrideCount:hn.state.overrideCount,outlierParameterOverrideCount:hn.state.parameterOverrideCount,outlierOverrideExampleSummary:hn.state.overrideExampleSummary,outlierHasOverrides:hn.state.hasOverrides,outlierRecommendationRows:hn.state.recommendationRows,outlierHasRecommendations:hn.state.hasRecommendations,outlierStatusMessage:hn.state.statusMessage,outlierError:Zp,outlierSampleSize:Jc,relativeOutlierGeneratedAt:hg,outlierPreviewSignal:tt,formatMetricValue:Ws,formatNumericStat:Ps,onApplyAllRecommendations:hn.handlers.handleApplyAllRecommendations,onClearOverrides:hn.handlers.handleClearOverrides,onDefaultMethodChange:hn.handlers.handleDefaultMethodChange,onAutoDetectToggle:hn.handlers.handleAutoDetectToggle,onOverrideSelect:hn.handlers.handleOverrideSelect,onMethodParameterChange:hn.handlers.handleMethodParameterChange,onColumnParameterChange:hn.handlers.handleColumnParameterChange}),We&&o.jsx(HL,{sourceId:r,hasReachableSource:Ue,isFetchingScaling:nm,scalingConfig:ln.config,scalingMethodOptions:ln.state.methodOptions,scalingMethodDetailMap:ln.state.methodDetailMap,scalingDefaultDetail:ln.state.defaultDetail,scalingAutoDetectEnabled:ln.state.autoDetectEnabled,scalingSelectedCount:ln.state.selectedCount,scalingDefaultLabel:ln.state.defaultLabel,scalingOverrideCount:ln.state.overrideCount,scalingOverrideExampleSummary:ln.state.overrideExampleSummary,scalingRecommendationRows:ln.state.recommendationRows,scalingHasRecommendations:ln.state.hasRecommendations,scalingStatusMessage:ln.state.statusMessage,scalingError:Hc,scalingSampleSize:Em,relativeScalingGeneratedAt:mg,formatMetricValue:Ws,formatNumericStat:Ps,formatMissingPercentage:as,onApplyAllRecommendations:ln.handlers.handleApplyAllRecommendations,onClearOverrides:ln.handlers.handleClearOverrides,onDefaultMethodChange:ln.handlers.handleDefaultMethodChange,onAutoDetectToggle:ln.handlers.handleAutoDetectToggle,onOverrideSelect:ln.handlers.handleOverrideSelect}),et&&o.jsxs(o.Fragment,{children:[o.jsx(OL,{hasSource:!!r,hasReachableSource:Ue,isFetching:am,error:rm,relativeGeneratedAt:fg,sampleSize:Mm,binningConfig:Ot.config,binningDefaultLabel:Ot.state.defaultLabel,binningOverrideCount:Ot.state.overrideCount,binningOverrideSummary:Ot.state.overrideSummary,recommendations:Ot.state.insightsRecommendations,excludedColumns:Ot.state.insightsExcludedColumns,numericColumnCount:Ot.state.allNumericColumns.length,canApplyAllNumeric:Ot.state.canApplyAllNumeric,onApplyAllNumeric:Ot.handlers.handleApplyAllNumeric,onApplyStrategies:Ot.handlers.handleApplyStrategies,onClearOverrides:Ot.handlers.handleClearOverrides,customEdgeDrafts:Ot.state.customEdgeDrafts,customLabelDrafts:Ot.state.customLabelDrafts,onOverrideStrategyChange:Ot.handlers.handleOverrideStrategyChange,onOverrideNumberChange:Ot.handlers.handleOverrideNumberChange,onOverrideKbinsEncodeChange:Ot.handlers.handleOverrideKbinsEncodeChange,onOverrideKbinsStrategyChange:Ot.handlers.handleOverrideKbinsStrategyChange,onOverrideClear:Ot.handlers.handleClearOverride,onCustomBinsChange:Ot.handlers.handleCustomBinsChange,onCustomLabelsChange:Ot.handlers.handleCustomLabelsChange,onClearCustomColumn:Ot.handlers.handleClearCustomColumn,formatMetricValue:Ws,formatNumericStat:Ps}),o.jsx(ML,{config:Ot.config,fieldIds:Ot.state.fieldIds,onIntegerChange:Ot.handlers.handleIntegerChange,onBooleanToggle:Ot.handlers.handleBooleanToggle,onSuffixChange:Ot.handlers.handleSuffixChange,onLabelFormatChange:Ot.handlers.handleLabelFormatChange,onMissingStrategyChange:Ot.handlers.handleMissingStrategyChange,onMissingLabelChange:Ot.handlers.handleMissingLabelChange})]}),zt&&o.jsx(GL,{sourceId:r,hasReachableSource:Ue,isFetchingSkewness:um,skewnessThreshold:pn.state.threshold,skewnessError:no,skewnessViewMode:pn.state.viewMode,skewnessRecommendedCount:pn.state.recommendedCount,skewnessNumericCount:pn.state.numericCount,skewnessGroupByMethod:pn.state.groupByMethod,skewnessRows:pn.state.rows,skewnessTableGroups:pn.state.tableGroups,hasSkewnessAutoRecommendations:pn.state.hasAutoRecommendations,skewnessTransformationsCount:pn.state.transformationsCount,isFetchingRecommendations:es,getSkewnessMethodLabel:pn.handlers.getMethodLabel,getSkewnessMethodStatus:pn.handlers.getMethodStatus,onApplyRecommendations:pn.handlers.applyRecommendations,onViewModeChange:pn.handlers.setViewMode,onGroupByToggle:pn.handlers.setGroupByMethod,onOverrideChange:pn.handlers.handleOverrideChange,onClearSelections:pn.handlers.clearTransformations}),Xe&&o.jsx(QL,{skewnessThreshold:pn.state.threshold,isFetchingSkewness:um,skewnessError:no,skewnessDistributionCards:pn.state.distributionCards,skewnessDistributionView:pn.state.distributionView,setSkewnessDistributionView:pn.handlers.setDistributionView,onRefresh:dm,canRefresh:fm}),Ft&&o.jsx(TL,{cards:uo,selectedPreset:Ua,onSelectPreset:qn=>pl(qn),isFetching:lm,sampleSize:Gt,relativeGeneratedAt:ci,error:ng,onRefresh:ou,canRefresh:!!r}),Qt&&o.jsx(HP,{sourceId:r,hasReachableSource:Ue,removeDuplicatesColumnsParameter:j.removeDuplicates.columns,removeDuplicatesKeepParameter:j.removeDuplicates.keep,renderMultiSelectField:hs,removeDuplicatesKeepSelectId:En.removeDuplicatesKeepSelectId,removeDuplicatesKeep:En.removeDuplicatesKeep,onKeepChange:En.handleRemoveDuplicatesKeepChange}),Kt&&o.jsx(bI,{parameters:E,renderParameterField:Ze}),ft&&o.jsx(xI,{signal:Ct,previewStatus:Ae.status,hasSource:!!r,hasReachableSource:Ue,onRefreshPreview:to}),o.jsx(fL,{metadata:h})]}),o.jsx(mL,{onClose:t,canResetNode:Xt,onResetNode:li,showSaveButton:Xc,canSave:jm,onSave:xl,isBusy:bl,busyLabel:km})]})]})},bj=[{key:"train",label:"Train"},{key:"test",label:"Test"},{key:"validation",label:"Validation"}],Zr=bj.map(e=>e.key),g5=bj.reduce((e,t)=>({...e,[t.key]:t.label}),{}),_5=e=>typeof e=="string"&&Zr.includes(e),Jr=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(n=>{_5(n)&&t.add(n)}),Zr.filter(n=>t.has(n))},wj=(e,t)=>{const n=Jr(e),s=Jr(t);return n.length!==s.length?!1:n.every((r,i)=>r===s[i])},Nj=e=>!e||typeof e!="string"?null:Zr.find(t=>e.endsWith(`-${t}`))??null,jj=(e,t)=>{if(t<=1)return"50%";const n=100/(t+1);return`${Math.round((e+1)*n)}%`},y5={train:e=>e.endsWith("-train"),validation:e=>e.endsWith("-validation"),test:e=>e.endsWith("-test"),model:e=>e.endsWith("-model-out"),params:e=>e.endsWith("-best-params-out")},Lc={hyperparameter_tuning:{inputs:[{key:"train-in",label:"Train Split",position:35,required:!0,accepts:["train"]},{key:"validation-in",label:"Validation Split",position:65,required:!0,accepts:["validation"]}],outputs:[{key:"best-params-out",label:"Best Params",position:50}]},train_model_draft:{inputs:[{key:"train-in",label:"Train Split",position:40,required:!0,accepts:["train"]},{key:"params-in",label:"Best Params",position:60,required:!1,accepts:["params"]}],outputs:[{key:"model-out",label:"Model",position:50}]},model_evaluation:{inputs:[{key:"train-in",label:"Train Split",position:20,required:!1,accepts:["train"]},{key:"test-in",label:"Test Split",position:40,required:!1,accepts:["test"]},{key:"validation-in",label:"Validation Split",position:60,required:!1,accepts:["validation"]},{key:"models-in",label:"Model",position:80,required:!0,accepts:["model"]}]},model_registry_overview:{inputs:[{key:"models-in",label:"Model",position:50,required:!0,accepts:["model"]}]}},Cj=(e,t,n)=>typeof e.position=="number"&&Number.isFinite(e.position)?`${Math.min(Math.max(e.position,5),95)}%`:jj(t,n),v5=e=>e.required===!1?`${e.label} (optional)`:`${e.label} (required)`,x5=e=>e.required===!1?`${e.label} (optional)`:`${e.label} (required)`,Sj=(e,t)=>{if(!t||typeof t!="string")return null;const n=`${e}-`;if(t.startsWith(n))return t.slice(n.length);const s=t.split("-");return s.length>=2?s.slice(-2).join("-"):t},Ej=28,Mj=320,b5=170,kj="Removes columns whose missing percentage exceeds a configurable threshold and applies EDA-backed column drop recommendations.",Aj="Drop columns",Oj=new Set(["transformer_audit"]),w5=e=>({width:`${Ej}px`,height:`${Ej}px`,borderRadius:"999px",border:e==="target"?"1px solid rgba(148, 163, 184, 0.55)":"1px solid rgba(45, 212, 191, 0.55)",background:e==="target"?"rgba(148, 163, 184, 0.22)":"rgba(45, 212, 191, 0.18)",boxShadow:e==="target"?"0 0 0 3px rgba(148, 163, 184, 0.18)":"0 0 0 3px rgba(45, 212, 191, 0.18)",backdropFilter:"blur(2px)"}),N5=({id:e,data:t,selected:n})=>{var C;const s=(t==null?void 0:t.label)??e,r=!!((t==null?void 0:t.isDataset)??e==="dataset-source"),i=(t==null?void 0:t.isRemovable)??!r,l=(t==null?void 0:t.catalogType)==="train_test_split",u=r?"Primary dataset input":void 0,d=(t==null?void 0:t.description)??u,p=(t==null?void 0:t.catalogType)==="drop_missing_columns"||d===kj?Aj:d,m=(t==null?void 0:t.backgroundExecutionStatus)??"idle",y=!((t==null?void 0:t.hasRequiredConnections)??!0),x=(t==null?void 0:t.catalogType)??"",_=["hyperparameter_tuning","train_model_draft","model_evaluation","model_registry_overview"].includes(x),v=b.useCallback(j=>{var E;j.stopPropagation(),(E=t==null?void 0:t.onRemoveNode)==null||E.call(t,e)},[t,e]),w=b.useMemo(()=>{if(r)return[];const j=(t==null?void 0:t.catalogType)??"",E=j?Lc[j]:void 0;if(E!=null&&E.inputs&&E.inputs.length){const k=E.inputs.length;return E.inputs.map(($,T)=>({position:Pe.Left,id:`${e}-${$.key}`,label:v5($),style:{top:Cj($,T,k)}}))}return[{position:Pe.Left,id:`${e}-target`},{position:Pe.Top,id:`${e}-target-top`}]},[t==null?void 0:t.catalogType,e,r]),M=b.useMemo(()=>{if(r)return[{position:Pe.Left,id:`${e}-source-left`},{position:Pe.Right,id:`${e}-source`},{position:Pe.Top,id:`${e}-source-top`},{position:Pe.Bottom,id:`${e}-source-bottom`}];const j=(t==null?void 0:t.catalogType)??"",E=j?Lc[j]:void 0;if(E!=null&&E.outputs&&E.outputs.length){const T=E.outputs.length;return E.outputs.map((P,A)=>({position:Pe.Right,id:`${e}-${P.key}`,label:P.label,style:{top:Cj(P,A,T)}}))}const k=l?Zr:Jr((t==null?void 0:t.activeSplits)??[]),$=Jr((t==null?void 0:t.connectedSplits)??[]);if(k.length){const T=k.length;return k.map((P,A)=>({position:Pe.Right,id:`${e}-${P}`,style:{top:jj(A,T)},label:(()=>{var F;const D=g5[P];if(l){if(P==="validation"&&!(Number(((F=t==null?void 0:t.config)==null?void 0:F.validation_size)??0)>0))return`${D} (disabled)`;if(!$.includes(P))return`${D} (not set)`}return D})()}))}return[{position:Pe.Right,id:`${e}-source`},{position:Pe.Bottom,id:`${e}-source-bottom`}]},[t==null?void 0:t.activeSplits,t==null?void 0:t.catalogType,t==null?void 0:t.connectedSplits,(C=t==null?void 0:t.config)==null?void 0:C.validation_size,e,r,l]),N=b.useCallback((j,E)=>{const{position:k,id:$,style:T,label:P}=j,A=$.includes("-train")||$.includes("-test")||$.includes("-validation");return o.jsxs(ve.Fragment,{children:[o.jsx(tc,{type:E,position:k,id:$,className:`feature-node__handle feature-node__handle--${E}`,style:{...w5(E),...T??{},...A?{opacity:1,visibility:"visible",pointerEvents:"all"}:{}}}),P&&E==="source"&&o.jsx("div",{className:"feature-node__handle-label",style:{position:"absolute",right:"-8px",top:(T==null?void 0:T.top)||"50%",transform:"translate(100%, calc(-100% - 8px))",fontSize:"0.7rem",fontWeight:"600",color:"rgba(148, 163, 184, 0.9)",background:"rgba(15, 23, 42, 0.95)",padding:"3px 8px",borderRadius:"4px",whiteSpace:"nowrap",pointerEvents:"none",zIndex:100,border:"1px solid rgba(71, 85, 105, 0.5)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:P}),P&&E==="target"&&o.jsx("div",{className:"feature-node__handle-label",style:{position:"absolute",left:"-8px",top:(T==null?void 0:T.top)||"50%",transform:"translate(-100%, calc(-100% - 8px))",fontSize:"0.7rem",fontWeight:"600",color:"rgba(148, 163, 184, 0.9)",background:"rgba(15, 23, 42, 0.95)",padding:"3px 8px",borderRadius:"4px",whiteSpace:"nowrap",pointerEvents:"none",zIndex:100,border:"1px solid rgba(71, 85, 105, 0.5)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"},children:P})]},$)},[]);return o.jsxs("div",{className:`feature-node${n?" feature-node--selected":""}${r?" feature-node--dataset":""}`,children:[w.map(j=>N(j,"target")),o.jsxs("div",{className:"feature-node__header",children:[o.jsxs("div",{className:"feature-node__title-group",children:[o.jsx("span",{className:"feature-node__drag-handle","aria-hidden":"true",children:""}),o.jsx("span",{className:"feature-node__title",children:s})]}),o.jsxs("div",{className:"feature-node__controls",children:[y&&_&&o.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--warning",title:"Required connections missing",style:{background:"rgba(251, 191, 36, 0.2)",color:"rgb(245, 158, 11)",border:"1px solid rgba(245, 158, 11, 0.3)"},children:""}),m==="loading"&&o.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--loading",title:"Loading full dataset in background...",children:o.jsx("svg",{className:"feature-node__spinner",viewBox:"0 0 24 24",children:o.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",fill:"none",strokeDasharray:"60",strokeDashoffset:"30",strokeLinecap:"round"})})}),m==="success"&&o.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--success",title:"Full dataset ready",children:""}),m==="error"&&o.jsx("span",{className:"feature-node__status-indicator feature-node__status-indicator--error",title:"Background execution failed",children:"!"}),i&&o.jsx("button",{className:"feature-node__control feature-node__control--danger",type:"button",onClick:v,title:"Remove node",children:""})]})]}),p&&o.jsx("p",{className:"feature-node__description",children:p}),M.map(j=>N(j,"source"))]})},Vo="__pending_confirmation__",j5=[/^columns?$/i,/_columns$/i,/_features$/i,/_list$/i,/_ids$/i,/^selected_/i,/^target_/i,/^include_/i,/^exclude_/i,/^skipped_/i,/_rules$/i,/_transformations$/i,/^strategies$/i,/^recommendations$/i],C5=[/methods$/i,/overrides$/i,/mapping$/i,/weights$/i,/assignments$/i],Gd=e=>e&&typeof e=="object"&&!Array.isArray(e),Rc=e=>{if(e==null)return{};try{return JSON.parse(JSON.stringify(e))}catch{return{...e}}},Xd=e=>typeof e=="string"&&Oj.has(e),Qd=e=>{const t=e==null?void 0:e.default_config,n=(e==null?void 0:e.type)??"",s=!Oj.has(n),r=l=>(s?l[Vo]=!0:delete l[Vo],l);if(t==null)return r({});const i=Rc(t);if(!Gd(i))return r(i&&typeof i=="object"?i:{});switch(Object.entries(i).forEach(([l,u])=>{Array.isArray(u)?j5.some(h=>h.test(l))&&(i[l]=[]):Gd(u)&&C5.some(h=>h.test(l))&&(i[l]={})}),"auto_detect"in i&&(i.auto_detect=!1),e==null?void 0:e.type){case"scale_numeric_features":i.columns=Array.isArray(i.columns)?i.columns:[],i.column_methods=Gd(i.column_methods)?i.column_methods:{},i.skipped_columns=Array.isArray(i.skipped_columns)?i.skipped_columns:[],i.default_method=typeof i.default_method=="string"&&i.default_method.trim()?i.default_method:"standard";break;case"polynomial_features":i.columns=Array.isArray(i.columns)?i.columns:[],i.auto_detect=!!i.auto_detect,i.include_bias=!!i.include_bias,i.interaction_only=!!i.interaction_only,i.include_input_features=!!i.include_input_features,i.degree=typeof i.degree=="number"&&Number.isFinite(i.degree)?i.degree:2,i.output_prefix=typeof i.output_prefix=="string"&&i.output_prefix.trim()?i.output_prefix:"poly";break;case"drop_missing_columns":"missing_threshold"in i&&(i.missing_threshold=null),i.columns=Array.isArray(i.columns)?i.columns:[];break;case"drop_missing_rows":"missing_threshold"in i&&(i.missing_threshold=null),"drop_if_any_missing"in i&&(i.drop_if_any_missing=!1);break;case"outlier_removal":i.method="manual",i.columns=Array.isArray(i.columns)?i.columns:[],i.manual_bounds=Gd(i.manual_bounds)?i.manual_bounds:{};break;case"missing_value_indicator":i.columns=Array.isArray(i.columns)?i.columns:[];break;case"remove_duplicates":if(i.columns=Array.isArray(i.columns)?i.columns:[],typeof i.keep=="string"){const l=i.keep.trim().toLowerCase();i.keep=l==="last"||l==="none"?l:"first"}else i.keep="first";break}return r(i)},S5=(e,t)=>t==="drop_missing_columns"||e===kj?Aj:e,E5=e=>Array.isArray(e)?e.map(t=>({...t})):[],M5=[{id:"dataset-source",type:"featureNode",position:{x:-200,y:0},data:{label:"Dataset input",description:"Start from the currently selected dataset",isDataset:!0,isRemovable:!1,isConfigured:!0},style:{background:"linear-gradient(165deg, rgba(30, 64, 175, 0.9), rgba(59, 130, 246, 0.85))",border:"1px solid rgba(59, 130, 246, 0.55)",color:"#e0f2fe",fontWeight:600}}],k5=[],A5=e=>({...e,data:{...e.data??{}}}),Zd=()=>M5.map(e=>A5(e)),O5=()=>k5.map(e=>({...e})),T5=12,$5=e=>{const n=`Dataset input
(${e&&e.trim()?e.trim():"Demo dataset"})`;return{nodes:[{id:"dataset-source",type:"featureNode",position:{x:-200,y:40},data:{label:n,isDataset:!0,isRemovable:!1},style:{whiteSpace:"pre-line",background:"#eef2ff",border:"1px solid rgba(99, 102, 241, 0.35)",color:"#312e81",fontWeight:600}},{id:"node-1",type:"featureNode",position:{x:260,y:40},data:{label:`Profile columns
(assess types & nulls)`},style:{whiteSpace:"pre-line",background:"linear-gradient(165deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.85))"}},{id:"node-4",type:"featureNode",position:{x:600,y:60},data:{label:`Feature preview
(sample rows)`},style:{whiteSpace:"pre-line",background:"linear-gradient(165deg, rgba(8, 145, 178, 0.42), rgba(2, 132, 199, 0.32))"}}],edges:[{id:"edge-dataset-profile",source:"dataset-source",target:"node-1",animated:!0,type:"animatedEdge",sourceHandle:"dataset-source-source",targetHandle:"node-1-target"},{id:"edge-profile-preview",source:"node-1",target:"node-4",animated:!0,type:"animatedEdge",sourceHandle:"node-1-source",targetHandle:"node-4-target"}]}},P5=(e,t,n)=>{if(!t||typeof t.project!="function"||!n)return;const s=n.getBoundingClientRect(),r=t.project({x:s.width/2,y:s.height/2});if(!r)return;const i=e.filter(m=>m.id!=="dataset-source").length,l=[{x:0,y:0},{x:220,y:0},{x:-220,y:0},{x:0,y:180},{x:220,y:180},{x:-220,y:180},{x:0,y:-180},{x:220,y:-180},{x:-220,y:-180}],u=i%l.length,d=Math.floor(i/l.length),h=l[u],p=d+1;return{x:r.x+h.x*p,y:r.y+h.y*p}},L5=new Set(["binned_distribution","skewness_distribution","skewness_transform","binning_discretization","label_encoding","target_encoding","ordinal_encoding","dummy_encoding","one_hot_encoding","hash_encoding","scale_numeric_features","polynomial_features","feature_selection","feature_math","missing_value_indicator","trim_whitespace","normalize_text_case","replace_aliases_typos","standardize_date_formats","remove_special_characters","replace_invalid_values","regex_replace_fix","class_undersampling","class_oversampling","feature_target_split","train_test_split","train_model_draft","model_evaluation","hyperparameter_tuning"]),Tj=(e,t)=>{if(!e)return!1;if(L5.has(e))return!0;const n=t==null?void 0:t.get(e);return n?(typeof n.category=="string"?n.category.toLowerCase():"").includes("preprocess"):!1},$j=(e,t)=>{var C,j,E,k,$,T;const{handleOpenSettings:n,handleRemoveNode:s,catalogEntryMap:r}=t,i=e.data??{},l=i.isDataset??e.id==="dataset-source",u={...e.style??{}},d=i.catalogType??i.type??e.id;let p=Array.isArray(i.parameters)?i.parameters:null;if((!p||p.length===0)&&typeof d=="string"){const P=r.get(d)??null;(C=P==null?void 0:P.parameters)!=null&&C.length&&(p=P.parameters)}const m=E5(p);let f;if(m.length||i.config&&typeof i.config=="object"){const P=Rc(i.config);m.forEach(A=>{A!=null&&A.name&&P[A.name]===void 0&&A.default!==void 0&&(Array.isArray(A.default)?P[A.name]=[...A.default]:A.type==="boolean"?P[A.name]=!!A.default:P[A.name]=A.default)}),f=P}u.width||(u.width=l?Mj+20:Mj),u.minHeight||(u.minHeight=b5),u.padding||(u.padding=12),u.borderRadius||(u.borderRadius=16),u.boxSizing=u.boxSizing??"border-box",u.whiteSpace=u.whiteSpace??"pre-line",u.background||(u.background=l?"linear-gradient(165deg, rgba(30, 64, 175, 0.9), rgba(59, 130, 246, 0.85))":"linear-gradient(160deg, rgba(30, 41, 59, 0.92), rgba(15, 23, 42, 0.92))"),u.border||(u.border=l?"1px solid rgba(59, 130, 246, 0.55)":"1px solid rgba(148, 163, 184, 0.22)"),u.boxShadow||(u.boxShadow=l?"0 24px 54px rgba(59, 130, 246, 0.28)":"0 18px 42px rgba(2, 6, 23, 0.45)"),u.color||(u.color=l?"#e0f2fe":"#e2e8f0"),u.fontWeight||(u.fontWeight=l?600:500);const y=S5(i.description,d),x=Xd(d),_=f??(i.config&&typeof i.config=="object"?Rc(i.config):void 0);_&&typeof _=="object"&&x&&delete _[Vo];const v={...i,label:i.label??e.id,description:y,isDataset:l,isRemovable:i.isRemovable??!l,isConfigured:l||i.isConfigured===!0?!0:i.config&&typeof i.config=="object"?x?!0:!i.config[Vo]:!1,inputs:Array.isArray(i.inputs)?[...i.inputs]:i.inputs,outputs:Array.isArray(i.outputs)?[...i.outputs]:i.outputs,category:i.category,parameters:m,config:_,catalogType:d,onRemoveNode:s,onOpenSettings:n},w=typeof d=="string"?Lc[d]:void 0;if(w){const P=((j=w.inputs)==null?void 0:j.map(D=>x5(D)))??[],A=((E=w.outputs)==null?void 0:E.map(D=>D.label))??[];P.length?v.inputs=P:delete v.inputs,A.length?v.outputs=A:delete v.outputs,v.connectionInfo={inputs:((k=w.inputs)==null?void 0:k.map(D=>({...D})))??[],outputs:(($=w.outputs)==null?void 0:$.map(D=>({...D})))??[]}}else(!v.inputs||v.inputs.length===0)&&delete v.inputs,(!v.outputs||v.outputs.length===0)&&delete v.outputs,delete v.connectionInfo;const M=Jr(v.activeSplits);M.length?v.activeSplits=M:delete v.activeSplits;const N=Jr(v.connectedSplits);return N.length?v.connectedSplits=N:delete v.connectedSplits,d==="train_test_split"&&(v.activeSplits=[...Zr],N.length||delete v.connectedSplits),(T=v.parameters)!=null&&T.length||delete v.parameters,v.config===void 0&&delete v.config,{...e,type:"featureNode",position:e.position??{x:0,y:0},data:v,style:u}},R5=(e,t,n,s,r)=>{const i=(e==null?void 0:e.label)??(e==null?void 0:e.type)??s,l=typeof i=="string"&&i.trim()?i:s,u=Qd(e),d=Xd((e==null?void 0:e.type)??null);return $j({id:t,type:"featureNode",position:n,data:{label:l,description:e==null?void 0:e.description,inputs:e==null?void 0:e.inputs,outputs:e==null?void 0:e.outputs,category:e==null?void 0:e.category,parameters:e==null?void 0:e.parameters,config:u,catalogType:e==null?void 0:e.type,isConfigured:!!d}},r)},D5=(e,t)=>{const n=e.map(r=>{const{data:i,...l}=r,u=i?{...i}:void 0;return u&&(delete u.onRemoveNode,delete u.onOpenSettings),JSON.parse(JSON.stringify({...l,data:u}))}),s=t.map(r=>JSON.parse(JSON.stringify(r)));return{nodes:n,edges:s}},z5=e=>{var y;const[t,n]=b.useState(e??null),[s,r]=b.useState(null),i=Ts({queryKey:["feature-canvas","datasets"],queryFn:()=>I0(12),staleTime:5*60*1e3}),l=i.data??[],u=b.useMemo(()=>l.filter(x=>(x==null?void 0:x.is_owned)!==!1),[l]);b.useEffect(()=>{if(!l.length){r(null);return}if(t){const _=l.find(v=>v.source_id===t);if(_){r(v=>(v==null?void 0:v.id)===_.id?v:_);return}}const x=u[0]??l[0];x&&(t||n(x.source_id??String(x.id)),r(x))},[t,l,u]);const d=b.useMemo(()=>l.map(x=>({value:x.source_id,label:x.name??x.source_id,isOwned:x.is_owned!==!1})),[l]),h=u.length>1,p=l.length>0,m=u.length,f=i.error?((y=i.error)==null?void 0:y.message)??"Unable to load datasets":null;return{datasets:l,ownedDatasets:u,selectedDataset:s,setSelectedDataset:r,activeSourceId:t,setActiveSourceId:n,datasetOptions:d,canSelectDatasets:h,hasDatasets:p,ownedDatasetsCount:m,isDatasetLoading:i.isLoading,datasetErrorMessage:f}},I5=({sourceId:e,setIsDirty:t,setSaveFeedback:n,isHydratingRef:s})=>{const r=z5(e),{datasets:i,setActiveSourceId:l,setSelectedDataset:u}=r,d=b.useCallback(h=>{const p=i.find(m=>m.source_id===h)??null;if(!p){n({message:"Dataset unavailable. Choose another option.",tone:"error"});return}if(p.is_owned===!1){n({message:"Only datasets you own can be selected.",tone:"error"});return}l(h),u(p),s.current=!0,t(!1),n(null)},[i,s,l,t,n,u]);return{...r,handleDatasetSelection:d}},F5=({nodes:e,setEdges:t,scheduleNodeInternalsUpdate:n})=>{const s=b.useCallback(i=>{var y,x;const{source:l,target:u,sourceHandle:d,targetHandle:h}=i;if(!l||!u||!h||l===u)return!1;const p=e.find(_=>_.id===u);if(!p)return!1;const m=((y=p==null?void 0:p.data)==null?void 0:y.catalogType)??"",f=m?Lc[m]:void 0;if((x=f==null?void 0:f.inputs)!=null&&x.length){const _=Sj(u,h);if(!_)return!1;const v=f.inputs.find(w=>w.key===_);return!v||!d?!1:v.accepts&&v.accepts.length>0?v.accepts.some(w=>{const M=y5[w];return M?M(d):!1}):!0}return!0},[e]),r=b.useCallback(i=>{t(u=>fv({...i,type:"animatedEdge",animated:!0},u));const l=[i.source,i.target].filter(u=>!!u);l.length&&n(l)},[n,t]);return{isValidConnection:s,onConnect:r}},B5=({setNodes:e,setEdges:t,setSelectedNodeId:n,setIsSettingsModalOpen:s,catalogEntryMapRef:r,handleOpenSettings:i,reactFlowInstanceRef:l,canvasViewportRef:u,scheduleFitView:d})=>{const h=b.useRef(0),p=b.useCallback(N=>{N!=="dataset-source"&&(e(C=>C.filter(j=>j.id!==N)),t(C=>C.filter(j=>j.source!==N&&j.target!==N)),n(C=>C===N?(s(!1),null):C))},[t,s,e,n]),m=b.useCallback(N=>$j(N,{handleOpenSettings:i,handleRemoveNode:p,catalogEntryMap:r.current}),[r,i,p]),f=b.useCallback(N=>{const C=N.reduce((j,E)=>{if(typeof E.id=="string"&&E.id.startsWith("node-")){const k=Number(E.id.replace("node-",""));if(!Number.isNaN(k))return Math.max(j,k)}return j},0);C>h.current&&(h.current=C)},[]),y=b.useCallback((N,C)=>{const j=h.current+1,E=`node-${j}`;h.current=j;const k=C??{x:160+(j-1)%4*220,y:40+Math.floor((j-1)/4)*160};return m(R5(N??null,E,k,`Step ${j}`,{handleOpenSettings:i,handleRemoveNode:p,catalogEntryMap:r.current}))},[r,i,p,m]),x=b.useCallback(N=>{e(C=>{const j=P5(C,l.current,u.current),E=y(N,j);return[...C,E]}),d()},[u,y,l,d,e]),_=b.useCallback((N,C)=>{e(j=>j.map(E=>{if(E.id!==N)return E;const k=Rc(C);k&&typeof k=="object"&&delete k[Vo];const $={...E.data??{},config:k,isConfigured:!0};return m({...E,data:$})}))},[m,e]),v=b.useCallback((N,C)=>{e(j=>j.map(E=>{if(E.id!==N)return E;const k={...E.data??{},...C};return m({...E,data:k})}))},[m,e]),w=b.useCallback((N,C)=>{e(j=>j.map(E=>{var A;if(E.id!==N)return E;const k=(A=E==null?void 0:E.data)==null?void 0:A.catalogType,$=k?r.current.get(k)??null:null,T=C&&typeof C=="object"?Rc(C):Qd($??null),P={...E.data??{},config:T,isConfigured:!1,backgroundExecutionStatus:"idle"};return m({...E,data:P})}))},[r,m,e]),M=b.useCallback(()=>{e(N=>N.map(C=>{var T,P;if(!Tj((T=C==null?void 0:C.data)==null?void 0:T.catalogType,r.current))return C;const j=(P=C==null?void 0:C.data)==null?void 0:P.catalogType,E=j?r.current.get(j)??null:null,k=Qd(E??null),$={...C.data??{},config:k,isConfigured:!1,backgroundExecutionStatus:"idle"};return m({...C,data:$})}))},[r,m,e]);return{registerNode:m,createNode:y,handleAddNode:x,handleRemoveNode:p,handleUpdateNodeConfig:_,handleUpdateNodeData:v,handleResetNodeConfig:w,handleResetAllNodes:M,updateNodeCounter:f}},U5=new Set(["train_model_draft","model_registry_overview","model_evaluation","hyperparameter_tuning"]),H5=e=>{var n;const t=e?Lc[e]:void 0;return(n=t==null?void 0:t.inputs)!=null&&n.length?t.inputs.filter(s=>s.required!==!1).map(s=>s.key):[]},q5=(e,t,n)=>{const s=H5(t);if(s.length===0)return!0;const r=n.filter(l=>l.target===e),i=new Set(r.map(l=>Sj(e,l.targetHandle)).filter(l=>!!l));return s.every(l=>i.has(l))},V5=(e,t)=>{const n=new Map,s=new Set;e.forEach(d=>{var p;const h=(p=d==null?void 0:d.data)==null?void 0:p.catalogType;if(h&&U5.has(h)){s.add(d.id);return}h==="train_test_split"&&n.set(d.id,new Set(Zr))});let r=!0,i=0;const l=e.length*3;for(;r&&i<l;)r=!1,i++,t.forEach(d=>{if(s.has(d.source)||s.has(d.target))return;const h=n.get(d.source),p=Nj(d.sourceHandle);if(!h||h.size===0)return;n.has(d.target)||n.set(d.target,new Set);const m=n.get(d.target),f=m.size;p?h.has(p)&&m.add(p):h.forEach(y=>m.add(y)),m.size>f&&(r=!0)});const u=new Map;return n.forEach((d,h)=>{!d.size||s.has(h)||u.set(h,Zr.filter(p=>d.has(p)))}),u},W5=e=>{const t=new Map;e.forEach(s=>{const r=Nj(s.sourceHandle);r&&(t.has(s.source)||t.set(s.source,new Set),t.get(s.source).add(r))});const n=new Map;return t.forEach((s,r)=>{n.set(r,Zr.filter(i=>s.has(i)))}),n},Y5=({edges:e,setNodes:t,scheduleNodeInternalsUpdate:n})=>{b.useEffect(()=>{const s=[];t(r=>{const i=V5(r,e),l=W5(e);let u=!1;const d=r.map(h=>{var E,k,$,T,P;const m=((E=h==null?void 0:h.data)==null?void 0:E.catalogType)==="train_test_split"?[...Zr]:i.get(h.id)??[],f=Jr((k=h.data)==null?void 0:k.activeSplits),y=Jr(l.get(h.id)),x=Jr(($=h.data)==null?void 0:$.connectedSplits),_=((T=h==null?void 0:h.data)==null?void 0:T.catalogType)??"",v=q5(h.id,_,e),w=((P=h.data)==null?void 0:P.hasRequiredConnections)??!0,M=!wj(f,m),N=!wj(x,y);if(!M&&!N&&!(v!==w))return h;const j={...h.data,hasRequiredConnections:v};return m.length?j.activeSplits=m:delete j.activeSplits,y.length?j.connectedSplits=y:delete j.connectedSplits,(M||N)&&s.push(h.id),u=!0,{...h,data:j}});return u?d:r}),s.length&&n(s)},[e,n,t])},Pj=(e,t)=>({nodes:JSON.parse(JSON.stringify(e??[])),edges:JSON.parse(JSON.stringify(t??[]))}),Lj=e=>Array.isArray(e)?e.some(t=>(t==null?void 0:t.id)&&t.id!=="dataset-source"):!1,Rj=e=>Array.isArray(e)?e.length>0:!1,K5=({setIsDirty:e,setSaveFeedback:t,isHydratingRef:n})=>{const s=b.useRef({nodes:[],edges:[]}),[r,i]=b.useState(!1),l=b.useCallback((d,h)=>{const p=Pj(d,h);s.current=p;const m=Lj(p.nodes),f=Rj(p.edges);return i(m||f),{hasCustomNodes:m,hasEdges:f}},[]),u=b.useCallback((d,h)=>{const p=Pj(d,h),m=s.current,f=JSON.stringify(m.nodes??[])===JSON.stringify(p.nodes??[])&&JSON.stringify(m.edges??[])===JSON.stringify(p.edges??[]);s.current=p;const y=Lj(p.nodes),x=Rj(p.edges);i(y||x),!(n.current||f)&&(e(!0),t(null))},[n,e,t]);return{graphSnapshotRef:s,canClearCanvas:r,handleGraphChange:u,applyHydratedSnapshot:l}},G5=({canvasShellRef:e,canClearCanvas:t,setSaveFeedback:n})=>b.useCallback(()=>{var s;t&&(typeof window<"u"&&!window.confirm("Clear all nodes and connections from the canvas? This cannot be undone.")||((s=e.current)==null||s.clearGraph(),n(r=>(r==null?void 0:r.tone)==="error"?r:{message:"Canvas cleared. Unsaved edits pending.",tone:"info"})))},[e,t,n]),X5=({activeSourceId:e,isDirty:t,setSaveFeedback:n,pipelineQueryKey:s,pendingHistoryIdRef:r,isHydratingRef:i,historyLimit:l=T5})=>{var p;const u=Eo(),d=Ts({queryKey:["feature-canvas","pipeline-history",e],queryFn:()=>ew(e,l),enabled:!!e,staleTime:30*1e3,retry:1}),h=b.useCallback(m=>{if(!(m!=null&&m.graph)){n({message:"Selected revision is missing pipeline data.",tone:"error"});return}t&&typeof window<"u"&&!window.confirm("You have unsaved changes. Replace the canvas with the selected revision?")||(r.current=m.id??null,i.current=!0,n({message:`Loading revision ${m.name??`#${m.id}`}`,tone:"info"}),u.setQueryData(s,m))},[t,i,r,s,u,n]);return{historyItems:d.data??[],isHistoryLoading:d.isLoading||d.isFetching,historyErrorMessage:d.error?((p=d.error)==null?void 0:p.message)??"Unable to load history":null,refetchHistory:d.refetch,handleHistorySelection:h}},Dj=e=>{if(!e)return null;let t=e.trim();if(!t)return null;/^\d{4}-\d{2}-\d{2}\s+\d/.test(t)&&(t=t.replace(" ","T")),/(Z|z|[+-]\d{2}:?\d{2})$/.test(t)||(t=`${t}Z`);const n=new Date(t);return Number.isNaN(n.getTime())?null:n},Vp=e=>{const t=Dj(e);return t?t.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"Unknown time"},Wp=e=>{const t=Dj(e);if(!t)return null;const n=t.getTime(),s=Date.now()-n,r=Math.round(s/6e4);if(r<1)return"just now";if(r===1)return"1 minute ago";if(r<60)return`${r} minutes ago`;const i=Math.round(r/60);if(i===1)return"1 hour ago";if(i<24)return`${i} hours ago`;const l=Math.round(i/24);if(l===1)return"1 day ago";if(l<7)return`${l} days ago`;const u=Math.round(l/7);return u===1?"1 week ago":`${u} weeks ago`},Q5=({applyHydratedSnapshot:e,selectedDataset:t,activeSourceId:n,setActivePipelineId:s,setActivePipelineName:r,setActivePipelineUpdatedAt:i,setIsDirty:l,setSaveFeedback:u,pendingHistoryIdRef:d,isHydratingRef:h})=>{const p=b.useCallback(f=>{const{nodes:y,edges:x,pipeline:_,context:v}=f,{hasCustomNodes:w}=e(y,x),M=(_==null?void 0:_.id)??null;if(s(M),r((_==null?void 0:_.name)??null),i((_==null?void 0:_.updated_at)??null),v==="stored"&&_)if(d.current===_.id){const C=Wp(_.updated_at)??Vp(_.updated_at);u({message:`Saved revision ${_.name??`#${_.id}`} (${C})`,tone:"info"}),d.current=null}else h.current&&u(N=>(N==null?void 0:N.tone)==="error"?N:w?{message:"Loaded saved pipeline",tone:"info"}:N);else v==="sample"?(d.current=null,u(N=>(N==null?void 0:N.tone)==="error"||w?N:{message:`Showing starter pipeline for ${(t==null?void 0:t.name)??(t==null?void 0:t.source_id)??n??"demo dataset"}`,tone:"info"})):v==="reset"?d.current=null:_||(d.current=null,u(N=>(N==null?void 0:N.tone)==="error"?N:null));h.current&&l(!1),_&&d.current&&d.current!==_.id&&(d.current=null),h.current=!1},[n,e,d,t,s,r,i,l,u,h]),m=b.useCallback(f=>{u({message:(f==null?void 0:f.message)??"Unable to load saved pipeline. Starting fresh.",tone:"error"})},[u]);return{handlePipelineHydrated:p,handlePipelineError:m}},Z5=({sourceId:e,datasetDisplayLabel:t,registerNode:n,prepareNodes:s,setNodes:r,setEdges:i,updateNodeCounter:l,scheduleFitView:u,onPipelineHydrated:d,onPipelineError:h})=>{const p=b.useRef(!1),m=Ts({queryKey:["feature-canvas","pipeline",e],queryFn:()=>Z0(e),enabled:!!e,staleTime:60*1e3,retry:1});return b.useEffect(()=>{const f=`Dataset input
(${t})`;if(!e){if(p.current)r(y=>{let x=!1;const _=y.map(v=>{var M;return v.id!=="dataset-source"||(((M=v==null?void 0:v.data)==null?void 0:M.label)??"")===f?v:(x=!0,n({...v,data:{...v.data??{},label:f,isDataset:!0,isRemovable:!1}}))});return x?_:y});else{const y=$5(t),x=s(y.nodes);p.current=!0,r(x),i(y.edges),l(x),u(),d==null||d({nodes:x,edges:y.edges,pipeline:null,context:"sample"})}return}if(p.current=!1,m.isLoading){r(y=>y.map(x=>x.id==="dataset-source"?n({...x,data:{...x.data??{},label:f,isDataset:!0,isRemovable:!1}}):x));return}if(m.isError){const y=m.error??new Error("Failed to load saved pipeline");console.error("Failed to load saved pipeline",y),h==null||h(y);const x=Zd().map(v=>v.id==="dataset-source"?{...v,data:{...v.data??{},label:f,isDataset:!0,isRemovable:!1}}:v),_=s(x);r(_),i([]),l(_),u(),d==null||d({nodes:_,edges:[],pipeline:null,context:"reset"});return}if(m.data){const y=m.data.graph??{},x=Array.isArray(y==null?void 0:y.nodes)&&y.nodes.length?y.nodes:Zd(),_=s(x),w=(Array.isArray(y==null?void 0:y.edges)?y.edges:[]).map(M=>{var P;const N=M==null?void 0:M.type,C=!N||N==="smoothstep"||N==="default"?"animatedEdge":N,j=M==null?void 0:M.source,E=M==null?void 0:M.target,k=_.find(A=>A.id===E),$=(M==null?void 0:M.sourceHandle)??(j?`${j}-source`:void 0),T=(M==null?void 0:M.targetHandle)??((P=k==null?void 0:k.data)!=null&&P.isDataset?void 0:E?`${E}-target`:void 0);return{...M,animated:(M==null?void 0:M.animated)??!0,type:C,sourceHandle:$,targetHandle:T}});r(_),i(w),l(_),u(),d==null||d({nodes:_,edges:w,pipeline:m.data??null,context:"stored"});return}if(m.isFetched&&!m.data){const y=Zd().map(_=>_.id==="dataset-source"?{..._,data:{..._.data??{},label:f,isDataset:!0,isRemovable:!1}}:_),x=s(y);r(x),i([]),l(x),u(),d==null||d({nodes:x,edges:[],pipeline:null,context:"sample"})}},[t,d,h,m.data,m.error,m.isError,m.isFetched,m.isLoading,s,n,u,i,r,e,l]),{isPipelineLoading:m.isLoading||m.isFetching}},J5=({queryClient:e,setSaveFeedback:t,setIsDirty:n,setActivePipelineId:s,setActivePipelineName:r,setActivePipelineUpdatedAt:i,pendingHistoryIdRef:l})=>{const{mutate:u,isPending:d}=Cu({mutationFn:async({sourceId:h,payload:p})=>J0(h,p),onSuccess:(h,p)=>{t({message:"Draft saved successfully.",tone:"success"}),n(!1),s(h.id??null),r(h.name??null),i(h.updated_at??null),l.current=h.id??null,e.setQueryData(["feature-canvas","pipeline",p.sourceId],h),e.invalidateQueries({queryKey:["feature-canvas","pipeline-history",p.sourceId],exact:!1})},onError:h=>{t({message:(h==null?void 0:h.message)??"Failed to save pipeline.",tone:"error"})}});return{triggerSave:u,isSaving:d}},Jd=e=>!e||!e.length?"":e.join(", "),e4=({nodes:e,onAddNode:t})=>{const[n,s]=b.useState(""),[r,i]=b.useState([]),l=n.trim().toLowerCase(),u=b.useMemo(()=>l?e.filter(f=>{const y=[f.label,f.type,f.description];return f.category&&y.push(f.category),f.tags&&f.tags.length&&y.push(f.tags.join(" ")),y.some(x=>x==null?void 0:x.toLowerCase().includes(l))}):e,[e,l]),d=b.useMemo(()=>{const f=new Map;return u.forEach(y=>{var v;const x=((v=y.category)==null?void 0:v.trim())||"Other",_=f.get(x)??[];_.push(y),f.set(x,_)}),Array.from(f.entries()).sort(([y],[x])=>y.localeCompare(x)).map(([y,x])=>({category:y,entries:x.sort((_,v)=>(_.label||_.type).localeCompare(v.label||v.type))}))},[u]);b.useEffect(()=>{if(!l){i([]);return}i(f=>{const y=new Set(f);let x=!1;return d.forEach(({category:_})=>{y.has(_)||(y.add(_),x=!0)}),x?Array.from(y):f})},[d,l]);const h=f=>{i(y=>{const x=new Set(y);return x.has(f)?x.delete(f):x.add(f),Array.from(x)})},p=u.length,m=p>0;return o.jsxs("div",{className:"feature-canvas-sidebar",role:"presentation",children:[o.jsxs("header",{className:"feature-canvas-sidebar__header",children:[o.jsx("h3",{children:"Available steps"}),o.jsxs("div",{className:"feature-canvas-sidebar__search",children:[o.jsx("input",{type:"search",value:n,onChange:f=>s(f.target.value),placeholder:"Search by name, tag, or output",className:"feature-canvas-sidebar__search-input","aria-label":"Search available steps"}),n&&o.jsx("button",{type:"button",className:"feature-canvas-sidebar__search-clear",onClick:()=>s(""),"aria-label":"Clear search",children:""})]}),o.jsxs("span",{className:"feature-canvas-sidebar__results",children:["Showing ",p," ",p===1?"step":"steps",l?` matching ${n.trim()}`:""]})]}),m?o.jsx("div",{className:"feature-canvas-sidebar__sections",children:d.map(({category:f,entries:y})=>{const x=r.includes(f);return o.jsxs("section",{className:"feature-canvas-sidebar__section",children:[o.jsxs("button",{type:"button",className:"feature-canvas-sidebar__section-toggle",onClick:()=>h(f),"aria-expanded":x,children:[o.jsx("span",{className:"feature-canvas-sidebar__section-label",children:f.charAt(0).toUpperCase()+f.slice(1)}),o.jsxs("span",{className:"feature-canvas-sidebar__section-meta",children:[y.length,o.jsx("span",{className:"feature-canvas-sidebar__section-arrow","data-expanded":x,children:""})]})]}),x&&o.jsx("div",{className:"feature-canvas-sidebar__group",children:y.map(_=>{var v,w;return o.jsx("button",{className:"feature-canvas-sidebar__card",type:"button",onClick:()=>t==null?void 0:t(_),children:o.jsxs("div",{className:"feature-canvas-sidebar__card-body",children:[o.jsx("span",{className:"feature-canvas-sidebar__card-title",children:_.label||_.type}),_.description&&o.jsx("span",{className:"feature-canvas-sidebar__card-description",children:_.description}),o.jsxs("div",{className:"feature-canvas-sidebar__card-tags",children:[(v=_.inputs)!=null&&v.length?o.jsxs("span",{className:"feature-canvas-sidebar__chip",title:`Inputs: ${Jd(_.inputs)}`,children:["In: ",Jd(_.inputs)]}):null,(w=_.outputs)!=null&&w.length?o.jsxs("span",{className:"feature-canvas-sidebar__chip",title:`Outputs: ${Jd(_.outputs)}`,children:["Out: ",Jd(_.outputs)]}):null,_.parameters&&_.parameters.length>0?o.jsxs("span",{className:"feature-canvas-sidebar__chip",children:[_.parameters.length," param",_.parameters.length>1?"s":""]}):null]})]})},_.type)})})]},f)})}):o.jsx("div",{className:"feature-canvas-sidebar__empty",children:o.jsxs("p",{children:["No steps match ",n.trim(),". Try adjusting your search or browse by category."]})})]})},t4=({nodeCatalog:e,isCatalogLoading:t,catalogErrorMessage:n,handleAddNode:s})=>({sidebarContent:b.useMemo(()=>t?o.jsx("p",{className:"text-muted",children:"Loading node catalog"}):n?o.jsx("p",{className:"text-danger",children:n}):e.length?o.jsx(e4,{nodes:e,onAddNode:s}):o.jsx("p",{className:"text-muted",children:"Node catalog unavailable. Define nodes in the backend to continue."}),[n,s,t,e])}),n4=()=>{var p;const[e,t]=b.useState(!1),n=b.useRef(new Map),s=Ts({queryKey:["feature-canvas","node-catalog"],queryFn:sp,staleTime:5*60*1e3}),r=s.data??[],i=s.isLoading||s.isFetching,l=s.error?((p=s.error)==null?void 0:p.message)??"Unable to load node catalog":null;b.useEffect(()=>{const m=new Map;r.forEach(f=>{f&&typeof f.type=="string"&&f.type.trim()&&m.set(f.type,f)}),n.current=m},[r]);const u=b.useCallback(()=>t(!0),[]),d=b.useCallback(()=>t(!1),[]),h=b.useCallback(()=>t(m=>!m),[]);return{nodeCatalog:r,catalogEntryMapRef:n,isCatalogOpen:e,openCatalog:u,closeCatalog:d,toggleCatalog:h,isCatalogLoading:i,catalogErrorMessage:l}},s4=e=>e==="success"?"":e==="error"?"":"",r4=e=>e==="error"?"text-danger":e==="success"?"text-success":"text-muted",a4=()=>{const[e,t]=b.useState(null);b.useEffect(()=>{if(!e||e.tone==="error"||typeof window>"u")return;const r=window.setTimeout(()=>t(null),e.tone==="success"?4e3:2500);return()=>window.clearTimeout(r)},[e]);const n=b.useMemo(()=>s4(e==null?void 0:e.tone),[e]),s=b.useMemo(()=>r4(e==null?void 0:e.tone),[e]);return{saveFeedback:e,setSaveFeedback:t,feedbackIcon:n,feedbackClass:s}},o4=(e=!0)=>{const[t,n]=b.useState(e),s=b.useCallback(()=>{n(r=>!r)},[]);return{isSidepanelExpanded:t,handleToggleSidepanel:s}},i4=({activePipelineUpdatedAt:e,datasetErrorMessage:t,isDatasetLoading:n,hasDatasets:s,ownedDatasetsCount:r,canSelectDatasets:i,datasetOptions:l,selectedDataset:u,activeSourceId:d,canClearCanvas:h,onDatasetSelection:p,onClearCanvas:m,onRefreshHistory:f,onSaveClick:y,isHistoryLoading:x,historyErrorMessage:_,historyItems:v,activePipelineId:w,isDirty:M,isSaving:N,saveFeedback:C,feedbackIcon:j,feedbackClass:E,onSelectHistory:k})=>({sidepanelProps:{activePipelineUpdatedAt:e,datasetErrorMessage:t,isDatasetLoading:n,hasDatasets:s,ownedDatasetsCount:r,canSelectDatasets:i,datasetOptions:l,selectedDataset:u,activeSourceId:d,canClearCanvas:h,onDatasetSelection:p,onClearCanvas:m,onRefreshHistory:f,onSaveClick:y,isHistoryLoading:x,historyErrorMessage:_,historyItems:v,activePipelineId:w,isDirty:M,isSaveDisabled:!d||N,saveButtonLabel:N?"Saving":M?"Save draft*":"Save draft",saveFeedback:C,feedbackIcon:j,feedbackClass:E,onSelectHistory:k}}),l4=(e,t,n,s)=>{if(e===n&&t===s)return`M ${e},${t}`;const r=Math.abs(n-e),i=Math.max(64,Math.min(r*.45,240)),l=Number.isFinite(i)?i:100,u=n>=e?1:-1,d=e+u*l,h=t,p=n-u*l;return`M ${e},${t} C ${d},${h} ${p},${s} ${n},${s}`},c4=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:r,targetPosition:i})=>{const l=l4(e,t,n,s),u="connection-line-gradient";return o.jsxs("g",{children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:u,gradientUnits:"userSpaceOnUse",x1:e,y1:t,x2:n,y2:s,children:[o.jsx("stop",{offset:"0%",stopColor:"#38bdf8",stopOpacity:.8}),o.jsx("stop",{offset:"50%",stopColor:"#6366f1",stopOpacity:.9}),o.jsx("stop",{offset:"100%",stopColor:"#a855f7",stopOpacity:.85})]}),o.jsxs("filter",{id:"connection-glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[o.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),o.jsx("path",{d:l,fill:"none",stroke:`url(#${u})`,strokeWidth:8,strokeOpacity:.2,strokeLinecap:"round",style:{filter:"url(#connection-glow)"}}),o.jsx("path",{d:l,fill:"none",stroke:`url(#${u})`,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",style:{strokeDasharray:"8 4",animation:"connection-line-dash 1s linear infinite"}}),o.jsx("circle",{cx:n,cy:s,r:6,fill:"#a855f7",opacity:.8,style:{animation:"connection-pulse 1.5s ease-in-out infinite"}})]})},u4=({nodes:e,edges:t,nodeTypes:n,edgeTypes:s,onNodesChange:r,onEdgesChange:i,onConnect:l,isValidConnection:u,onNodeClick:d,reactFlowInstanceRef:h,canvasViewportRef:p,handleResetAllNodes:m,openCatalog:f})=>o.jsxs("div",{className:"canvas-stage__viewport",ref:p,children:[o.jsxs(Px,{style:{width:"100%",height:"100%"},nodes:e,edges:t,nodeTypes:n,edgeTypes:s,onNodesChange:r,onEdgesChange:i,onConnect:l,isValidConnection:u,onNodeClick:d,onInit:y=>{h.current=y,requestAnimationFrame(()=>y.fitView({padding:.25}))},minZoom:.5,maxZoom:1.75,connectionRadius:180,connectionMode:To.Loose,connectOnClick:!0,nodeDragHandle:".feature-node__drag-handle",defaultEdgeOptions:{type:"animatedEdge",animated:!0,style:{strokeWidth:3}},connectionLineComponent:c4,elevateEdgesOnSelect:!0,edgesUpdatable:!1,children:[o.jsx(CA,{position:"bottom-left"}),o.jsx(AA,{gap:16})]}),o.jsx("button",{type:"button",className:"canvas-fab canvas-fab--reset",onClick:m,"aria-label":"Reset preprocessing nodes",children:""}),o.jsx("button",{type:"button",className:"canvas-fab",onClick:f,"aria-label":"Open node catalog",children:"+"})]}),d4=b.forwardRef(({sourceId:e,datasetName:t,onGraphChange:n,onPipelineHydrated:s,onPipelineError:r},i)=>{const l=b.useMemo(()=>({featureNode:N5}),[]),u=b.useMemo(()=>({animatedEdge:IP}),[]),[d,h,p]=ZO(Zd().map(ke=>({...ke,type:"featureNode"}))),[m,f,y]=JO(O5()),[x,_]=b.useState(null),[v,w]=b.useState(!1),M=b.useRef(null),N=b.useRef(null),C=b.useRef(!1),j=t??e??"Demo dataset",E=TA(),{nodeCatalog:k,catalogEntryMapRef:$,isCatalogOpen:T,openCatalog:P,closeCatalog:A,isCatalogLoading:D,catalogErrorMessage:F}=n4(),R=b.useCallback(ke=>{const le=(Array.isArray(ke)?ke:[ke]).filter(Boolean);if(!le.length)return;const pe=Array.from(new Set(le));requestAnimationFrame(()=>{requestAnimationFrame(()=>{pe.forEach(be=>{E(be)})})})},[E]);Y5({edges:m,setNodes:h,scheduleNodeInternalsUpdate:R});const z=b.useMemo(()=>d.find(ke=>ke.id===x)??null,[d,x]),q=b.useMemo(()=>D5(d,m),[m,d]),V=b.useCallback(ke=>{_(ke),w(!0)},[]),U=b.useCallback(()=>{w(!1),_(null)},[]),W=b.useCallback(()=>{C.current=!0},[]);b.useEffect(()=>{C.current&&(C.current=!1,requestAnimationFrame(()=>{var ke;(ke=M.current)==null||ke.fitView({padding:.25,duration:350})}))},[m,d]);const{registerNode:B,handleAddNode:I,handleUpdateNodeConfig:H,handleUpdateNodeData:J,handleResetNodeConfig:G,handleResetAllNodes:Y,updateNodeCounter:X}=B5({setNodes:h,setEdges:f,setSelectedNodeId:_,setIsSettingsModalOpen:w,catalogEntryMapRef:$,handleOpenSettings:V,reactFlowInstanceRef:M,canvasViewportRef:N,scheduleFitView:W});b.useEffect(()=>{X(d)},[d,X]);const Z=b.useCallback(ke=>ke.map(le=>{const pe={...le.data??{}};le.id==="dataset-source"&&(pe.label=`Dataset input
(${j})`,pe.isDataset=!0,pe.isRemovable=!1,pe.isConfigured=!0);const be=pe.catalogType??pe.type??le.id;return pe.config&&typeof pe.config=="object"&&Xd(be)&&delete pe.config[Vo],pe.isConfigured===void 0&&(pe.config&&typeof pe.config=="object"?pe.isConfigured=Xd(be)?!0:!pe.config[Vo]:pe.isConfigured=!0),B({...le,data:pe})}),[j,B]),{isPipelineLoading:ee}=Z5({sourceId:e,datasetDisplayLabel:j,registerNode:B,prepareNodes:Z,setNodes:h,setEdges:f,updateNodeCounter:X,scheduleFitView:W,onPipelineHydrated:s,onPipelineError:r}),Q=b.useCallback(()=>{h(ke=>{const le=ke.find(be=>be.id==="dataset-source");return[B(le?{...le,data:{...le.data??{},label:`Dataset input
(${j})`,isDataset:!0,isRemovable:!1,isConfigured:!0}}:{id:"dataset-source",type:"featureNode",position:{x:-200,y:40},data:{label:`Dataset input
(${j})`,isDataset:!0,isRemovable:!1,isConfigured:!0}})]}),f([]),_(null),w(!1),W()},[j,B,W,f,h,_,w]);b.useImperativeHandle(i,()=>({openCatalog:P,closeCatalog:A,clearGraph:Q}),[Q,A,P]);const{isValidConnection:ne,onConnect:he}=F5({nodes:d,setEdges:f,scheduleNodeInternalsUpdate:R});b.useEffect(()=>{n==null||n(d,m)},[m,d,n]);const ye=b.useMemo(()=>{var pe;if(!z)return null;const ke=(pe=z==null?void 0:z.data)==null?void 0:pe.catalogType;if(!ke)return null;const le=$.current.get(ke);return le?Qd(le):null},[z]),ge=b.useMemo(()=>{var le,pe;if(!z||(le=z.data)!=null&&le.isDataset)return!1;const ke=(pe=z==null?void 0:z.data)==null?void 0:pe.catalogType;return Tj(typeof ke=="string"?ke:null,$.current)},[z]),{sidebarContent:Ee}=t4({nodeCatalog:k,isCatalogLoading:D,catalogErrorMessage:F,handleAddNode:I}),De=b.useCallback((ke,le)=>{V(le.id)},[V]);return o.jsxs("div",{className:"canvas-stage","data-pipeline-loading":ee?"true":"false","aria-busy":ee,children:[o.jsx(u4,{nodes:d,edges:m,nodeTypes:l,edgeTypes:u,onNodesChange:p,onEdgesChange:y,onConnect:he,isValidConnection:ne,onNodeClick:De,reactFlowInstanceRef:M,canvasViewportRef:N,handleResetAllNodes:Y,openCatalog:P}),o.jsxs("div",{className:`canvas-drawer${T?" canvas-drawer--open":""}`,children:[o.jsxs("div",{className:"canvas-drawer__header",children:[o.jsx("h2",{children:"Node catalog"}),o.jsx("button",{type:"button",className:"canvas-drawer__close",onClick:A,"aria-label":"Close catalog",children:""})]}),o.jsx("div",{className:"canvas-drawer__body",children:Ee})]}),T&&o.jsx("div",{className:"canvas-drawer__backdrop",onClick:A}),v&&z&&o.jsx(p5,{node:z,sourceId:e??null,graphSnapshot:q,onClose:U,onUpdateConfig:H,onUpdateNodeData:J,onResetConfig:G,defaultConfigTemplate:ye,isResetAvailable:ge})]})}),m4=({activePipelineUpdatedAt:e,datasetErrorMessage:t,isDatasetLoading:n,hasDatasets:s,ownedDatasetsCount:r,canSelectDatasets:i,datasetOptions:l,selectedDataset:u,activeSourceId:d,canClearCanvas:h,onDatasetSelection:p,onClearCanvas:m,onRefreshHistory:f,onSaveClick:y,isHistoryLoading:x,historyErrorMessage:_,historyItems:v,activePipelineId:w,isDirty:M,isSaveDisabled:N,saveButtonLabel:C,saveFeedback:j,feedbackIcon:E,feedbackClass:k,onSelectHistory:$})=>{const T=d?(u==null?void 0:u.name)??d:null;return o.jsxs("aside",{id:"feature-canvas-sidepanel",className:"canvas-sidepanel",role:"complementary","aria-label":"Canvas details",children:[o.jsxs("div",{className:"canvas-sidepanel__content",role:"group","aria-label":"Canvas controls",children:[o.jsxs("section",{className:"canvas-sidepanel__section",children:[o.jsxs("div",{className:"canvas-sidepanel__section-heading",children:[o.jsx("h2",{children:"Dataset"}),e&&o.jsx("span",{className:"canvas-sidepanel__meta",children:Wp(e)??Vp(e)})]}),t?o.jsx("p",{className:"text-danger",children:t}):r?o.jsx("div",{className:"canvas-sidepanel__select-wrapper",children:o.jsx("select",{className:"canvas-sidepanel__select",value:d??"",onChange:P=>p(P.target.value),disabled:n||!i,"aria-label":"Select dataset",children:l.map(P=>o.jsx("option",{value:P.value,disabled:!P.isOwned,children:`${P.label}${P.isOwned?"":" (locked)"}`},P.value))})}):o.jsx("p",{className:"text-muted",children:"Dataset switching is limited to collections you own."}),n&&o.jsx("p",{className:"text-muted",children:"Loading datasets"}),!n&&!s&&!t&&o.jsx("p",{className:"text-muted",children:"No datasets available. Send one from EDA to get started."}),(u==null?void 0:u.description)&&o.jsx("p",{className:"canvas-sidepanel__description",children:u.description}),T&&o.jsxs("p",{className:"canvas-sidepanel__meta",children:["Working with ",o.jsx("strong",{children:T})]}),!i&&r>0&&o.jsx("p",{className:"canvas-sidepanel__hint",children:"Add more owned datasets to switch between them."})]}),o.jsxs("section",{className:"canvas-sidepanel__section",children:[o.jsx("div",{className:"canvas-sidepanel__section-action",children:o.jsxs("button",{type:"button",className:"canvas-sidepanel__action-button",onClick:m,disabled:!h,"aria-label":"Clean all nodes",title:h?"Remove all nodes and edges from the canvas":"Nothing to clean yet",children:[o.jsx("span",{"aria-hidden":"true",children:""}),o.jsx("span",{children:"Clean all nodes"})]})}),o.jsxs("div",{className:"canvas-sidepanel__section-heading",children:[o.jsx("h2",{children:"History"}),o.jsxs("div",{className:"canvas-sidepanel__section-controls",children:[o.jsx("button",{type:"button",className:"canvas-sidepanel__icon-button",onClick:f,disabled:x||!d,"aria-label":"Refresh history",title:"Refresh history",children:""}),o.jsx("button",{type:"button",className:"canvas-sidepanel__icon-button",onClick:y,disabled:N,"aria-label":C,title:C,children:""})]})]}),o.jsx("div",{className:"canvas-sidepanel__history",children:x?o.jsx("p",{className:"text-muted",children:"Loading history"}):_?o.jsx("p",{className:"text-danger",children:_}):v.length?v.map(P=>{const D=Wp(P.updated_at)??Vp(P.updated_at),F=P.id===w,R=F&&!M;return o.jsxs("button",{type:"button",className:`canvas-sidepanel__history-item${F?" canvas-sidepanel__history-item--active":""}`,onClick:()=>$(P),disabled:R,children:[o.jsx("span",{className:"canvas-sidepanel__history-title",children:P.name||`Pipeline #${P.id}`}),o.jsx("span",{className:"canvas-sidepanel__history-meta",children:D}),F&&M&&o.jsx("span",{className:"canvas-sidepanel__history-badge",children:"Unsaved edits"})]},P.id)}):o.jsx("p",{className:"text-muted",children:"No saved revisions yet. Save a draft to populate history."})})]})]}),j&&o.jsxs("p",{className:`canvas-sidepanel__feedback ${k}`,children:[o.jsx("span",{className:"canvas-sidepanel__feedback-icon","aria-hidden":"true",children:E}),o.jsx("span",{className:"canvas-sidepanel__feedback-text",children:j.message})]})]})},f4=e=>{const t=e==null?void 0:e.type;return!t||t==="smoothstep"||t==="default"?"animatedEdge":t},h4=({snapshot:e,selectedDataset:t,activeSourceId:n})=>{const s=e.nodes??[],r=e.edges??[];return{name:t!=null&&t.name?`Draft pipeline for ${t.name}`:`Draft pipeline for ${n}`,graph:{nodes:s,edges:r.map(i=>({...i,animated:(i==null?void 0:i.animated)??!0,type:f4(i)}))},metadata:{lastClientSave:new Date().toISOString(),nodeCount:s.length,edgeCount:r.length}}},p4=({sourceId:e})=>{const t=Eo(),n=b.useRef(null),s=b.useRef(!0),{isSidepanelExpanded:r,handleToggleSidepanel:i}=o4(!0),[l,u]=b.useState(!1),{saveFeedback:d,setSaveFeedback:h,feedbackIcon:p,feedbackClass:m}=a4(),{selectedDataset:f,activeSourceId:y,datasetOptions:x,canSelectDatasets:_,hasDatasets:v,ownedDatasetsCount:w,isDatasetLoading:M,datasetErrorMessage:N,handleDatasetSelection:C}=I5({sourceId:e,setIsDirty:u,setSaveFeedback:h,isHydratingRef:s}),[j,E]=b.useState(null),[k,$]=b.useState(null),[T,P]=b.useState(null),A=b.useMemo(()=>["feature-canvas","pipeline",y],[y]),D=b.useRef(null),{graphSnapshotRef:F,canClearCanvas:R,handleGraphChange:z,applyHydratedSnapshot:q}=K5({setIsDirty:u,setSaveFeedback:h,isHydratingRef:s}),V=G5({canvasShellRef:n,canClearCanvas:R,setSaveFeedback:h}),{historyItems:U,isHistoryLoading:W,historyErrorMessage:B,refetchHistory:I,handleHistorySelection:H}=X5({activeSourceId:y,isDirty:l,setSaveFeedback:h,pipelineQueryKey:A,pendingHistoryIdRef:D,isHydratingRef:s}),{triggerSave:J,isSaving:G}=J5({queryClient:t,setSaveFeedback:h,setIsDirty:u,setActivePipelineId:E,setActivePipelineName:P,setActivePipelineUpdatedAt:$,pendingHistoryIdRef:D}),{handlePipelineHydrated:Y,handlePipelineError:X}=Q5({applyHydratedSnapshot:q,selectedDataset:f,activeSourceId:y,setActivePipelineId:E,setActivePipelineName:P,setActivePipelineUpdatedAt:$,setIsDirty:u,setSaveFeedback:h,pendingHistoryIdRef:D,isHydratingRef:s}),Z=b.useCallback(()=>{if(!y){h({message:"Select a dataset before saving.",tone:"error"});return}const Q=F.current;if(!Q.nodes||!Q.nodes.length){h({message:"Add nodes to the canvas before saving.",tone:"error"});return}const ne=h4({snapshot:Q,selectedDataset:f,activeSourceId:y});h({message:"Saving draft",tone:"info"}),J({sourceId:y,payload:ne})},[y,f==null?void 0:f.name,J]),{sidepanelProps:ee}=i4({activePipelineUpdatedAt:k,datasetErrorMessage:N,isDatasetLoading:M,hasDatasets:v,ownedDatasetsCount:w,canSelectDatasets:_,datasetOptions:x,selectedDataset:f,activeSourceId:y,canClearCanvas:R,onDatasetSelection:C,onClearCanvas:V,onRefreshHistory:()=>{I()},onSaveClick:Z,isHistoryLoading:W,historyErrorMessage:B,historyItems:U,activePipelineId:j,isDirty:l,isSaving:G,saveFeedback:d,feedbackIcon:p,feedbackClass:m,onSelectHistory:H});return o.jsxs("div",{className:"feature-canvas-app","data-sidepanel-expanded":r?"true":"false",children:[o.jsx("button",{type:"button",className:"canvas-sidepanel__toggle",onClick:i,"aria-label":r?"Collapse details panel":"Expand details panel","aria-expanded":r,"aria-controls":"feature-canvas-sidepanel",children:r?"":""}),!r&&d&&o.jsxs("div",{className:`canvas-sidepanel__feedback canvas-sidepanel__feedback--floating ${m}`,children:[o.jsx("span",{className:"canvas-sidepanel__feedback-icon","aria-hidden":"true",children:p}),o.jsx("span",{className:"canvas-sidepanel__feedback-text",children:d.message})]}),r&&o.jsx(m4,{...ee}),o.jsx("div",{className:"feature-canvas-app__viewport",children:o.jsx(Lx,{children:o.jsx(d4,{ref:n,sourceId:y,datasetName:(f==null?void 0:f.name)??(f==null?void 0:f.source_id)??null,onGraphChange:z,onPipelineHydrated:Y,onPipelineError:X})})})]})},g4=new rE,Yp=document.getElementById("ml-workflow-root");if(!Yp)throw new Error("ML workflow root element not found");const _4=Nf.createRoot(Yp),y4=Yp.getAttribute("data-source-id")||void 0;_4.render(o.jsx(ve.StrictMode,{children:o.jsx(aE,{client:g4,children:o.jsx(p4,{sourceId:y4})})}))})();
//# sourceMappingURL=feature-canvas.js.map
